var _we=Object.create;var ZF=Object.defineProperty;var Twe=Object.getOwnPropertyDescriptor;var Ewe=Object.getOwnPropertyNames;var Pwe=Object.getPrototypeOf,Dwe=Object.prototype.hasOwnProperty;var Iu=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Ui=(e,t)=>{for(var r in t)ZF(e,r,{get:t[r],enumerable:!0})},kwe=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ewe(t))!Dwe.call(e,o)&&o!==r&&ZF(e,o,{get:()=>t[o],enumerable:!(n=Twe(t,o))||n.enumerable});return e};var ar=(e,t,r)=>(r=e!=null?_we(Pwe(e)):{},kwe(t||!e||!e.__esModule?ZF(r,"default",{value:e,enumerable:!0}):r,e));var DK=Iu((Wdt,PK)=>{"use strict";PK.exports=XMLHttpRequest});var sge=Iu(ho=>{"use strict";var $w=Symbol.for("react.element"),pWe=Symbol.for("react.portal"),fWe=Symbol.for("react.fragment"),hWe=Symbol.for("react.strict_mode"),gWe=Symbol.for("react.profiler"),yWe=Symbol.for("react.provider"),vWe=Symbol.for("react.context"),bWe=Symbol.for("react.forward_ref"),xWe=Symbol.for("react.suspense"),CWe=Symbol.for("react.memo"),SWe=Symbol.for("react.lazy"),Khe=Symbol.iterator;function IWe(e){return e===null||typeof e!="object"?null:(e=Khe&&e[Khe]||e["@@iterator"],typeof e=="function"?e:null)}var Qhe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Jhe=Object.assign,ege={};function kS(e,t,r){this.props=e,this.context=t,this.refs=ege,this.updater=r||Qhe}kS.prototype.isReactComponent={};kS.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};kS.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function tge(){}tge.prototype=kS.prototype;function Lz(e,t,r){this.props=e,this.context=t,this.refs=ege,this.updater=r||Qhe}var Nz=Lz.prototype=new tge;Nz.constructor=Lz;Jhe(Nz,kS.prototype);Nz.isPureReactComponent=!0;var Xhe=Array.isArray,rge=Object.prototype.hasOwnProperty,Fz={current:null},nge={key:!0,ref:!0,__self:!0,__source:!0};function oge(e,t,r){var n,o={},i=null,s=null;if(t!=null)for(n in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(i=""+t.key),t)rge.call(t,n)&&!nge.hasOwnProperty(n)&&(o[n]=t[n]);var a=arguments.length-2;if(a===1)o.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];o.children=l}if(e&&e.defaultProps)for(n in a=e.defaultProps,a)o[n]===void 0&&(o[n]=a[n]);return{$$typeof:$w,type:e,key:i,ref:s,props:o,_owner:Fz.current}}function AWe(e,t){return{$$typeof:$w,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Oz(e){return typeof e=="object"&&e!==null&&e.$$typeof===$w}function wWe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var Yhe=/\/+/g;function Bz(e,t){return typeof e=="object"&&e!==null&&e.key!=null?wWe(""+e.key):t.toString(36)}function GM(e,t,r,n,o){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case $w:case pWe:s=!0}}if(s)return s=e,o=o(s),e=n===""?"."+Bz(s,0):n,Xhe(o)?(r="",e!=null&&(r=e.replace(Yhe,"$&/")+"/"),GM(o,t,r,"",function(c){return c})):o!=null&&(Oz(o)&&(o=AWe(o,r+(!o.key||s&&s.key===o.key?"":(""+o.key).replace(Yhe,"$&/")+"/")+e)),t.push(o)),1;if(s=0,n=n===""?".":n+":",Xhe(e))for(var a=0;a<e.length;a++){i=e[a];var l=n+Bz(i,a);s+=GM(i,t,r,l,o)}else if(l=IWe(e),typeof l=="function")for(e=l.call(e),a=0;!(i=e.next()).done;)i=i.value,l=n+Bz(i,a++),s+=GM(i,t,r,l,o);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function VM(e,t,r){if(e==null)return e;var n=[],o=0;return GM(e,n,"","",function(i){return t.call(r,i,o++)}),n}function _We(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var fu={current:null},UM={transition:null},TWe={ReactCurrentDispatcher:fu,ReactCurrentBatchConfig:UM,ReactCurrentOwner:Fz};function ige(){throw Error("act(...) is not supported in production builds of React.")}ho.Children={map:VM,forEach:function(e,t,r){VM(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return VM(e,function(){t++}),t},toArray:function(e){return VM(e,function(t){return t})||[]},only:function(e){if(!Oz(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ho.Component=kS;ho.Fragment=fWe;ho.Profiler=gWe;ho.PureComponent=Lz;ho.StrictMode=hWe;ho.Suspense=xWe;ho.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TWe;ho.act=ige;ho.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=Jhe({},e.props),o=e.key,i=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,s=Fz.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)rge.call(t,l)&&!nge.hasOwnProperty(l)&&(n[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];n.children=a}return{$$typeof:$w,type:e.type,key:o,ref:i,props:n,_owner:s}};ho.createContext=function(e){return e={$$typeof:vWe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:yWe,_context:e},e.Consumer=e};ho.createElement=oge;ho.createFactory=function(e){var t=oge.bind(null,e);return t.type=e,t};ho.createRef=function(){return{current:null}};ho.forwardRef=function(e){return{$$typeof:bWe,render:e}};ho.isValidElement=Oz;ho.lazy=function(e){return{$$typeof:SWe,_payload:{_status:-1,_result:e},_init:_We}};ho.memo=function(e,t){return{$$typeof:CWe,type:e,compare:t===void 0?null:t}};ho.startTransition=function(e){var t=UM.transition;UM.transition={};try{e()}finally{UM.transition=t}};ho.unstable_act=ige;ho.useCallback=function(e,t){return fu.current.useCallback(e,t)};ho.useContext=function(e){return fu.current.useContext(e)};ho.useDebugValue=function(){};ho.useDeferredValue=function(e){return fu.current.useDeferredValue(e)};ho.useEffect=function(e,t){return fu.current.useEffect(e,t)};ho.useId=function(){return fu.current.useId()};ho.useImperativeHandle=function(e,t,r){return fu.current.useImperativeHandle(e,t,r)};ho.useInsertionEffect=function(e,t){return fu.current.useInsertionEffect(e,t)};ho.useLayoutEffect=function(e,t){return fu.current.useLayoutEffect(e,t)};ho.useMemo=function(e,t){return fu.current.useMemo(e,t)};ho.useReducer=function(e,t,r){return fu.current.useReducer(e,t,r)};ho.useRef=function(e){return fu.current.useRef(e)};ho.useState=function(e){return fu.current.useState(e)};ho.useSyncExternalStore=function(e,t,r){return fu.current.useSyncExternalStore(e,t,r)};ho.useTransition=function(){return fu.current.useTransition()};ho.version="18.3.1"});var hi=Iu((s2r,age)=>{"use strict";age.exports=sge()});var cge=Iu(zM=>{"use strict";var EWe=hi(),PWe=Symbol.for("react.element"),DWe=Symbol.for("react.fragment"),kWe=Object.prototype.hasOwnProperty,MWe=EWe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,RWe={key:!0,ref:!0,__self:!0,__source:!0};function lge(e,t,r){var n,o={},i=null,s=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(s=t.ref);for(n in t)kWe.call(t,n)&&!RWe.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)o[n]===void 0&&(o[n]=t[n]);return{$$typeof:PWe,type:e,key:i,ref:s,props:o,_owner:MWe.current}}zM.Fragment=DWe;zM.jsx=lge;zM.jsxs=lge});var un=Iu((l2r,uge)=>{"use strict";uge.exports=cge()});var a0e=Iu((oTr,s0e)=>{"use strict";var r0e=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,yZe=/\n/g,vZe=/^\s*/,bZe=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,xZe=/^:\s*/,CZe=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,SZe=/^[;\s]*/,IZe=/^\s+|\s+$/g,AZe=`
`,n0e="/",o0e="*",I1="",wZe="comment",_Ze="declaration";s0e.exports=function(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var r=1,n=1;function o(f){var C=f.match(yZe);C&&(r+=C.length);var g=f.lastIndexOf(AZe);n=~g?f.length-g:n+f.length}function i(){var f={line:r,column:n};return function(C){return C.position=new s(f),u(),C}}function s(f){this.start=f,this.end={line:r,column:n},this.source=t.source}s.prototype.content=e;var a=[];function l(f){var C=new Error(t.source+":"+r+":"+n+": "+f);if(C.reason=f,C.filename=t.source,C.line=r,C.column=n,C.source=e,t.silent)a.push(C);else throw C}function c(f){var C=f.exec(e);if(C){var g=C[0];return o(g),e=e.slice(g.length),C}}function u(){c(vZe)}function d(f){var C;for(f=f||[];C=m();)C!==!1&&f.push(C);return f}function m(){var f=i();if(!(n0e!=e.charAt(0)||o0e!=e.charAt(1))){for(var C=2;I1!=e.charAt(C)&&(o0e!=e.charAt(C)||n0e!=e.charAt(C+1));)++C;if(C+=2,I1===e.charAt(C-1))return l("End of comment missing");var g=e.slice(2,C-2);return n+=2,o(g),e=e.slice(C),n+=2,f({type:wZe,comment:g})}}function p(){var f=i(),C=c(bZe);if(C){if(m(),!c(xZe))return l("property missing ':'");var g=c(CZe),b=f({type:_Ze,property:i0e(C[0].replace(r0e,I1)),value:g?i0e(g[0].replace(r0e,I1)):I1});return c(SZe),b}}function h(){var f=[];d(f);for(var C;C=p();)C!==!1&&(f.push(C),d(f));return f}return u(),h()};function i0e(e){return e?e.replace(IZe,I1):I1}});var l0e=Iu(d_=>{"use strict";var TZe=d_&&d_.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(d_,"__esModule",{value:!0});var EZe=TZe(a0e());function PZe(e,t){var r=null;if(!e||typeof e!="string")return r;var n=(0,EZe.default)(e),o=typeof t=="function";return n.forEach(function(i){if(i.type==="declaration"){var s=i.property,a=i.value;o?t(s,a,i):a&&(r=r||{},r[s]=a)}}),r}d_.default=PZe});var kye=Iu((Fkr,Dye)=>{"use strict";var OR=Object.prototype.hasOwnProperty,Pye=Object.prototype.toString,Iye=Object.defineProperty,Aye=Object.getOwnPropertyDescriptor,wye=function(t){return typeof Array.isArray=="function"?Array.isArray(t):Pye.call(t)==="[object Array]"},_ye=function(t){if(!t||Pye.call(t)!=="[object Object]")return!1;var r=OR.call(t,"constructor"),n=t.constructor&&t.constructor.prototype&&OR.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!n)return!1;var o;for(o in t);return typeof o>"u"||OR.call(t,o)},Tye=function(t,r){Iye&&r.name==="__proto__"?Iye(t,r.name,{enumerable:!0,configurable:!0,value:r.newValue,writable:!0}):t[r.name]=r.newValue},Eye=function(t,r){if(r==="__proto__")if(OR.call(t,r)){if(Aye)return Aye(t,r).value}else return;return t[r]};Dye.exports=function e(){var t,r,n,o,i,s,a=arguments[0],l=1,c=arguments.length,u=!1;for(typeof a=="boolean"&&(u=a,a=arguments[1]||{},l=2),(a==null||typeof a!="object"&&typeof a!="function")&&(a={});l<c;++l)if(t=arguments[l],t!=null)for(r in t)n=Eye(a,r),o=Eye(t,r),a!==o&&(u&&o&&(_ye(o)||(i=wye(o)))?(i?(i=!1,s=n&&wye(n)?n:[]):s=n&&_ye(n)?n:{},Tye(a,{name:r,newValue:e(u,s,o)})):typeof o<"u"&&Tye(a,{name:r,newValue:o}));return a}});var sSe=Iu(Xi=>{"use strict";function i7(e,t){var r=e.length;e.push(t);e:for(;0<r;){var n=r-1>>>1,o=e[n];if(0<tN(o,t))e[n]=t,e[r]=o,r=n;else break e}}function hf(e){return e.length===0?null:e[0]}function nN(e){if(e.length===0)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,o=e.length,i=o>>>1;n<i;){var s=2*(n+1)-1,a=e[s],l=s+1,c=e[l];if(0>tN(a,r))l<o&&0>tN(c,a)?(e[n]=c,e[l]=r,n=l):(e[n]=a,e[s]=r,n=s);else if(l<o&&0>tN(c,r))e[n]=c,e[l]=r,n=l;else break e}}return t}function tN(e,t){var r=e.sortIndex-t.sortIndex;return r!==0?r:e.id-t.id}typeof performance=="object"&&typeof performance.now=="function"?(YCe=performance,Xi.unstable_now=function(){return YCe.now()}):(r7=Date,QCe=r7.now(),Xi.unstable_now=function(){return r7.now()-QCe});var YCe,r7,QCe,Ph=[],Pv=[],vot=1,mp=null,jc=3,oN=!1,W1=!1,mT=!1,tSe=typeof setTimeout=="function"?setTimeout:null,rSe=typeof clearTimeout=="function"?clearTimeout:null,JCe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function s7(e){for(var t=hf(Pv);t!==null;){if(t.callback===null)nN(Pv);else if(t.startTime<=e)nN(Pv),t.sortIndex=t.expirationTime,i7(Ph,t);else break;t=hf(Pv)}}function a7(e){if(mT=!1,s7(e),!W1)if(hf(Ph)!==null)W1=!0,c7(l7);else{var t=hf(Pv);t!==null&&u7(a7,t.startTime-e)}}function l7(e,t){W1=!1,mT&&(mT=!1,rSe(pT),pT=-1),oN=!0;var r=jc;try{for(s7(t),mp=hf(Ph);mp!==null&&(!(mp.expirationTime>t)||e&&!iSe());){var n=mp.callback;if(typeof n=="function"){mp.callback=null,jc=mp.priorityLevel;var o=n(mp.expirationTime<=t);t=Xi.unstable_now(),typeof o=="function"?mp.callback=o:mp===hf(Ph)&&nN(Ph),s7(t)}else nN(Ph);mp=hf(Ph)}if(mp!==null)var i=!0;else{var s=hf(Pv);s!==null&&u7(a7,s.startTime-t),i=!1}return i}finally{mp=null,jc=r,oN=!1}}var iN=!1,rN=null,pT=-1,nSe=5,oSe=-1;function iSe(){return!(Xi.unstable_now()-oSe<nSe)}function n7(){if(rN!==null){var e=Xi.unstable_now();oSe=e;var t=!0;try{t=rN(!0,e)}finally{t?dT():(iN=!1,rN=null)}}else iN=!1}var dT;typeof JCe=="function"?dT=function(){JCe(n7)}:typeof MessageChannel<"u"?(o7=new MessageChannel,eSe=o7.port2,o7.port1.onmessage=n7,dT=function(){eSe.postMessage(null)}):dT=function(){tSe(n7,0)};var o7,eSe;function c7(e){rN=e,iN||(iN=!0,dT())}function u7(e,t){pT=tSe(function(){e(Xi.unstable_now())},t)}Xi.unstable_IdlePriority=5;Xi.unstable_ImmediatePriority=1;Xi.unstable_LowPriority=4;Xi.unstable_NormalPriority=3;Xi.unstable_Profiling=null;Xi.unstable_UserBlockingPriority=2;Xi.unstable_cancelCallback=function(e){e.callback=null};Xi.unstable_continueExecution=function(){W1||oN||(W1=!0,c7(l7))};Xi.unstable_forceFrameRate=function(e){0>e||125<e||(nSe=0<e?Math.floor(1e3/e):5)};Xi.unstable_getCurrentPriorityLevel=function(){return jc};Xi.unstable_getFirstCallbackNode=function(){return hf(Ph)};Xi.unstable_next=function(e){switch(jc){case 1:case 2:case 3:var t=3;break;default:t=jc}var r=jc;jc=t;try{return e()}finally{jc=r}};Xi.unstable_pauseExecution=function(){};Xi.unstable_requestPaint=function(){};Xi.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=jc;jc=e;try{return t()}finally{jc=r}};Xi.unstable_scheduleCallback=function(e,t,r){var n=Xi.unstable_now();switch(typeof r=="object"&&r!==null?(r=r.delay,r=typeof r=="number"&&0<r?n+r:n):r=n,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return o=r+o,e={id:vot++,callback:t,priorityLevel:e,startTime:r,expirationTime:o,sortIndex:-1},r>n?(e.sortIndex=r,i7(Pv,e),hf(Ph)===null&&e===hf(Pv)&&(mT?(rSe(pT),pT=-1):mT=!0,u7(a7,r-n))):(e.sortIndex=o,i7(Ph,e),W1||oN||(W1=!0,c7(l7))),e};Xi.unstable_shouldYield=iSe;Xi.unstable_wrapCallback=function(e){var t=jc;return function(){var r=jc;jc=t;try{return e.apply(this,arguments)}finally{jc=r}}}});var lSe=Iu((Wrn,aSe)=>{"use strict";aSe.exports=sSe()});var m2e=Iu(Kd=>{"use strict";var bot=hi(),qd=lSe();function Zt(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var hIe=new Set,LT={};function ix(e,t){aA(e,t),aA(e+"Capture",t)}function aA(e,t){for(LT[e]=t,e=0;e<t.length;e++)hIe.add(t[e])}var i0=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),R7=Object.prototype.hasOwnProperty,xot=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,cSe={},uSe={};function Cot(e){return R7.call(uSe,e)?!0:R7.call(cSe,e)?!1:xot.test(e)?uSe[e]=!0:(cSe[e]=!0,!1)}function Sot(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Iot(e,t,r,n){if(t===null||typeof t>"u"||Sot(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Cu(e,t,r,n,o,i,s){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=s}var gc={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){gc[e]=new Cu(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];gc[t]=new Cu(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){gc[e]=new Cu(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){gc[e]=new Cu(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){gc[e]=new Cu(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){gc[e]=new Cu(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){gc[e]=new Cu(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){gc[e]=new Cu(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){gc[e]=new Cu(e,5,!1,e.toLowerCase(),null,!1,!1)});var w$=/[\-:]([a-z])/g;function _$(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(w$,_$);gc[t]=new Cu(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(w$,_$);gc[t]=new Cu(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(w$,_$);gc[t]=new Cu(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){gc[e]=new Cu(e,1,!1,e.toLowerCase(),null,!1,!1)});gc.xlinkHref=new Cu("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){gc[e]=new Cu(e,1,!1,e.toLowerCase(),null,!0,!0)});function T$(e,t,r,n){var o=gc.hasOwnProperty(t)?gc[t]:null;(o!==null?o.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Iot(t,r,o,n)&&(r=null),n||o===null?Cot(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):o.mustUseProperty?e[o.propertyName]=r===null?o.type===3?!1:"":r:(t=o.attributeName,n=o.attributeNamespace,r===null?e.removeAttribute(t):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var c0=bot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,sN=Symbol.for("react.element"),HI=Symbol.for("react.portal"),jI=Symbol.for("react.fragment"),E$=Symbol.for("react.strict_mode"),B7=Symbol.for("react.profiler"),gIe=Symbol.for("react.provider"),yIe=Symbol.for("react.context"),P$=Symbol.for("react.forward_ref"),L7=Symbol.for("react.suspense"),N7=Symbol.for("react.suspense_list"),D$=Symbol.for("react.memo"),kv=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var vIe=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var dSe=Symbol.iterator;function fT(e){return e===null||typeof e!="object"?null:(e=dSe&&e[dSe]||e["@@iterator"],typeof e=="function"?e:null)}var Xs=Object.assign,d7;function ST(e){if(d7===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);d7=t&&t[1]||""}return`
`+d7+e}var m7=!1;function p7(e,t){if(!e||m7)return"";m7=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&typeof c.stack=="string"){for(var o=c.stack.split(`
`),i=n.stack.split(`
`),s=o.length-1,a=i.length-1;1<=s&&0<=a&&o[s]!==i[a];)a--;for(;1<=s&&0<=a;s--,a--)if(o[s]!==i[a]){if(s!==1||a!==1)do if(s--,a--,0>a||o[s]!==i[a]){var l=`
`+o[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=s&&0<=a);break}}}finally{m7=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?ST(e):""}function Aot(e){switch(e.tag){case 5:return ST(e.type);case 16:return ST("Lazy");case 13:return ST("Suspense");case 19:return ST("SuspenseList");case 0:case 2:case 15:return e=p7(e.type,!1),e;case 11:return e=p7(e.type.render,!1),e;case 1:return e=p7(e.type,!0),e;default:return""}}function F7(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case jI:return"Fragment";case HI:return"Portal";case B7:return"Profiler";case E$:return"StrictMode";case L7:return"Suspense";case N7:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case yIe:return(e.displayName||"Context")+".Consumer";case gIe:return(e._context.displayName||"Context")+".Provider";case P$:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case D$:return t=e.displayName||null,t!==null?t:F7(e.type)||"Memo";case kv:t=e._payload,e=e._init;try{return F7(e(t))}catch{}}return null}function wot(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return F7(t);case 8:return t===E$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function $v(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function bIe(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function _ot(e){var t=bIe(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(s){n=""+s,i.call(this,s)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(s){n=""+s},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function aN(e){e._valueTracker||(e._valueTracker=_ot(e))}function xIe(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=bIe(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function LN(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function O7(e,t){var r=t.checked;return Xs({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function mSe(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=$v(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function CIe(e,t){t=t.checked,t!=null&&T$(e,"checked",t,!1)}function V7(e,t){CIe(e,t);var r=$v(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?G7(e,t.type,r):t.hasOwnProperty("defaultValue")&&G7(e,t.type,$v(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function pSe(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function G7(e,t,r){(t!=="number"||LN(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var IT=Array.isArray;function tA(e,t,r,n){if(e=e.options,t){t={};for(var o=0;o<r.length;o++)t["$"+r[o]]=!0;for(r=0;r<e.length;r++)o=t.hasOwnProperty("$"+e[r].value),e[r].selected!==o&&(e[r].selected=o),o&&n&&(e[r].defaultSelected=!0)}else{for(r=""+$v(r),t=null,o=0;o<e.length;o++){if(e[o].value===r){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function U7(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Zt(91));return Xs({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function fSe(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Zt(92));if(IT(r)){if(1<r.length)throw Error(Zt(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:$v(r)}}function SIe(e,t){var r=$v(t.value),n=$v(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function hSe(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function IIe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function z7(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?IIe(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var lN,AIe=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,o){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(lN=lN||document.createElement("div"),lN.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=lN.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function NT(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var _T={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Tot=["Webkit","ms","Moz","O"];Object.keys(_T).forEach(function(e){Tot.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_T[t]=_T[e]})});function wIe(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||_T.hasOwnProperty(e)&&_T[e]?(""+t).trim():t+"px"}function _Ie(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=wIe(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,o):e[r]=o}}var Eot=Xs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function H7(e,t){if(t){if(Eot[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Zt(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Zt(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Zt(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Zt(62))}}function j7(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $7=null;function k$(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var W7=null,rA=null,nA=null;function gSe(e){if(e=eE(e)){if(typeof W7!="function")throw Error(Zt(280));var t=e.stateNode;t&&(t=cF(t),W7(e.stateNode,e.type,t))}}function TIe(e){rA?nA?nA.push(e):nA=[e]:rA=e}function EIe(){if(rA){var e=rA,t=nA;if(nA=rA=null,gSe(e),t)for(e=0;e<t.length;e++)gSe(t[e])}}function PIe(e,t){return e(t)}function DIe(){}var f7=!1;function kIe(e,t,r){if(f7)return e(t,r);f7=!0;try{return PIe(e,t,r)}finally{f7=!1,(rA!==null||nA!==null)&&(DIe(),EIe())}}function FT(e,t){var r=e.stateNode;if(r===null)return null;var n=cF(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Zt(231,t,typeof r));return r}var q7=!1;if(i0)try{UI={},Object.defineProperty(UI,"passive",{get:function(){q7=!0}}),window.addEventListener("test",UI,UI),window.removeEventListener("test",UI,UI)}catch{q7=!1}var UI;function Pot(e,t,r,n,o,i,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(u){this.onError(u)}}var TT=!1,NN=null,FN=!1,Z7=null,Dot={onError:function(e){TT=!0,NN=e}};function kot(e,t,r,n,o,i,s,a,l){TT=!1,NN=null,Pot.apply(Dot,arguments)}function Mot(e,t,r,n,o,i,s,a,l){if(kot.apply(this,arguments),TT){if(TT){var c=NN;TT=!1,NN=null}else throw Error(Zt(198));FN||(FN=!0,Z7=c)}}function sx(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function MIe(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ySe(e){if(sx(e)!==e)throw Error(Zt(188))}function Rot(e){var t=e.alternate;if(!t){if(t=sx(e),t===null)throw Error(Zt(188));return t!==e?null:e}for(var r=e,n=t;;){var o=r.return;if(o===null)break;var i=o.alternate;if(i===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===i.child){for(i=o.child;i;){if(i===r)return ySe(o),e;if(i===n)return ySe(o),t;i=i.sibling}throw Error(Zt(188))}if(r.return!==n.return)r=o,n=i;else{for(var s=!1,a=o.child;a;){if(a===r){s=!0,r=o,n=i;break}if(a===n){s=!0,n=o,r=i;break}a=a.sibling}if(!s){for(a=i.child;a;){if(a===r){s=!0,r=i,n=o;break}if(a===n){s=!0,n=i,r=o;break}a=a.sibling}if(!s)throw Error(Zt(189))}}if(r.alternate!==n)throw Error(Zt(190))}if(r.tag!==3)throw Error(Zt(188));return r.stateNode.current===r?e:t}function RIe(e){return e=Rot(e),e!==null?BIe(e):null}function BIe(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=BIe(e);if(t!==null)return t;e=e.sibling}return null}var LIe=qd.unstable_scheduleCallback,vSe=qd.unstable_cancelCallback,Bot=qd.unstable_shouldYield,Lot=qd.unstable_requestPaint,Aa=qd.unstable_now,Not=qd.unstable_getCurrentPriorityLevel,M$=qd.unstable_ImmediatePriority,NIe=qd.unstable_UserBlockingPriority,ON=qd.unstable_NormalPriority,Fot=qd.unstable_LowPriority,FIe=qd.unstable_IdlePriority,iF=null,Rh=null;function Oot(e){if(Rh&&typeof Rh.onCommitFiberRoot=="function")try{Rh.onCommitFiberRoot(iF,e,void 0,(e.current.flags&128)===128)}catch{}}var xf=Math.clz32?Math.clz32:Uot,Vot=Math.log,Got=Math.LN2;function Uot(e){return e>>>=0,e===0?32:31-(Vot(e)/Got|0)|0}var cN=64,uN=4194304;function AT(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function VN(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,o=e.suspendedLanes,i=e.pingedLanes,s=r&268435455;if(s!==0){var a=s&~o;a!==0?n=AT(a):(i&=s,i!==0&&(n=AT(i)))}else s=r&~o,s!==0?n=AT(s):i!==0&&(n=AT(i));if(n===0)return 0;if(t!==0&&t!==n&&!(t&o)&&(o=n&-n,i=t&-t,o>=i||o===16&&(i&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-xf(t),o=1<<r,n|=e[r],t&=~o;return n}function zot(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Hot(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,i=e.pendingLanes;0<i;){var s=31-xf(i),a=1<<s,l=o[s];l===-1?(!(a&r)||a&n)&&(o[s]=zot(a,t)):l<=t&&(e.expiredLanes|=a),i&=~a}}function K7(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function OIe(){var e=cN;return cN<<=1,!(cN&4194240)&&(cN=64),e}function h7(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function QT(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-xf(t),e[t]=r}function jot(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var o=31-xf(r),i=1<<o;t[o]=0,n[o]=-1,e[o]=-1,r&=~i}}function R$(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-xf(r),o=1<<n;o&t|e[n]&t&&(e[n]|=t),r&=~o}}var Pi=0;function VIe(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var GIe,B$,UIe,zIe,HIe,X7=!1,dN=[],Fv=null,Ov=null,Vv=null,OT=new Map,VT=new Map,Rv=[],$ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bSe(e,t){switch(e){case"focusin":case"focusout":Fv=null;break;case"dragenter":case"dragleave":Ov=null;break;case"mouseover":case"mouseout":Vv=null;break;case"pointerover":case"pointerout":OT.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":VT.delete(t.pointerId)}}function hT(e,t,r,n,o,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[o]},t!==null&&(t=eE(t),t!==null&&B$(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function Wot(e,t,r,n,o){switch(t){case"focusin":return Fv=hT(Fv,e,t,r,n,o),!0;case"dragenter":return Ov=hT(Ov,e,t,r,n,o),!0;case"mouseover":return Vv=hT(Vv,e,t,r,n,o),!0;case"pointerover":var i=o.pointerId;return OT.set(i,hT(OT.get(i)||null,e,t,r,n,o)),!0;case"gotpointercapture":return i=o.pointerId,VT.set(i,hT(VT.get(i)||null,e,t,r,n,o)),!0}return!1}function jIe(e){var t=K1(e.target);if(t!==null){var r=sx(t);if(r!==null){if(t=r.tag,t===13){if(t=MIe(r),t!==null){e.blockedOn=t,HIe(e.priority,function(){UIe(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function wN(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=Y7(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);$7=n,r.target.dispatchEvent(n),$7=null}else return t=eE(r),t!==null&&B$(t),e.blockedOn=r,!1;t.shift()}return!0}function xSe(e,t,r){wN(e)&&r.delete(t)}function qot(){X7=!1,Fv!==null&&wN(Fv)&&(Fv=null),Ov!==null&&wN(Ov)&&(Ov=null),Vv!==null&&wN(Vv)&&(Vv=null),OT.forEach(xSe),VT.forEach(xSe)}function gT(e,t){e.blockedOn===t&&(e.blockedOn=null,X7||(X7=!0,qd.unstable_scheduleCallback(qd.unstable_NormalPriority,qot)))}function GT(e){function t(o){return gT(o,e)}if(0<dN.length){gT(dN[0],e);for(var r=1;r<dN.length;r++){var n=dN[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Fv!==null&&gT(Fv,e),Ov!==null&&gT(Ov,e),Vv!==null&&gT(Vv,e),OT.forEach(t),VT.forEach(t),r=0;r<Rv.length;r++)n=Rv[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<Rv.length&&(r=Rv[0],r.blockedOn===null);)jIe(r),r.blockedOn===null&&Rv.shift()}var oA=c0.ReactCurrentBatchConfig,GN=!0;function Zot(e,t,r,n){var o=Pi,i=oA.transition;oA.transition=null;try{Pi=1,L$(e,t,r,n)}finally{Pi=o,oA.transition=i}}function Kot(e,t,r,n){var o=Pi,i=oA.transition;oA.transition=null;try{Pi=4,L$(e,t,r,n)}finally{Pi=o,oA.transition=i}}function L$(e,t,r,n){if(GN){var o=Y7(e,t,r,n);if(o===null)S7(e,t,n,UN,r),bSe(e,n);else if(Wot(o,e,t,r,n))n.stopPropagation();else if(bSe(e,n),t&4&&-1<$ot.indexOf(e)){for(;o!==null;){var i=eE(o);if(i!==null&&GIe(i),i=Y7(e,t,r,n),i===null&&S7(e,t,n,UN,r),i===o)break;o=i}o!==null&&n.stopPropagation()}else S7(e,t,n,null,r)}}var UN=null;function Y7(e,t,r,n){if(UN=null,e=k$(n),e=K1(e),e!==null)if(t=sx(e),t===null)e=null;else if(r=t.tag,r===13){if(e=MIe(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return UN=e,null}function $Ie(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Not()){case M$:return 1;case NIe:return 4;case ON:case Fot:return 16;case FIe:return 536870912;default:return 16}default:return 16}}var Lv=null,N$=null,_N=null;function WIe(){if(_N)return _N;var e,t=N$,r=t.length,n,o="value"in Lv?Lv.value:Lv.textContent,i=o.length;for(e=0;e<r&&t[e]===o[e];e++);var s=r-e;for(n=1;n<=s&&t[r-n]===o[i-n];n++);return _N=o.slice(e,1<n?1-n:void 0)}function TN(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function mN(){return!0}function CSe(){return!1}function Zd(e){function t(r,n,o,i,s){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=i,this.target=s,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(r=e[a],this[a]=r?r(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?mN:CSe,this.isPropagationStopped=CSe,this}return Xs(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=mN)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=mN)},persist:function(){},isPersistent:mN}),t}var fA={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},F$=Zd(fA),JT=Xs({},fA,{view:0,detail:0}),Xot=Zd(JT),g7,y7,yT,sF=Xs({},JT,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:O$,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yT&&(yT&&e.type==="mousemove"?(g7=e.screenX-yT.screenX,y7=e.screenY-yT.screenY):y7=g7=0,yT=e),g7)},movementY:function(e){return"movementY"in e?e.movementY:y7}}),SSe=Zd(sF),Yot=Xs({},sF,{dataTransfer:0}),Qot=Zd(Yot),Jot=Xs({},JT,{relatedTarget:0}),v7=Zd(Jot),eit=Xs({},fA,{animationName:0,elapsedTime:0,pseudoElement:0}),tit=Zd(eit),rit=Xs({},fA,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),nit=Zd(rit),oit=Xs({},fA,{data:0}),ISe=Zd(oit),iit={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sit={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ait={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lit(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=ait[e])?!!t[e]:!1}function O$(){return lit}var cit=Xs({},JT,{key:function(e){if(e.key){var t=iit[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=TN(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?sit[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:O$,charCode:function(e){return e.type==="keypress"?TN(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?TN(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),uit=Zd(cit),dit=Xs({},sF,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ASe=Zd(dit),mit=Xs({},JT,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:O$}),pit=Zd(mit),fit=Xs({},fA,{propertyName:0,elapsedTime:0,pseudoElement:0}),hit=Zd(fit),git=Xs({},sF,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),yit=Zd(git),vit=[9,13,27,32],V$=i0&&"CompositionEvent"in window,ET=null;i0&&"documentMode"in document&&(ET=document.documentMode);var bit=i0&&"TextEvent"in window&&!ET,qIe=i0&&(!V$||ET&&8<ET&&11>=ET),wSe=" ",_Se=!1;function ZIe(e,t){switch(e){case"keyup":return vit.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function KIe(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var $I=!1;function xit(e,t){switch(e){case"compositionend":return KIe(t);case"keypress":return t.which!==32?null:(_Se=!0,wSe);case"textInput":return e=t.data,e===wSe&&_Se?null:e;default:return null}}function Cit(e,t){if($I)return e==="compositionend"||!V$&&ZIe(e,t)?(e=WIe(),_N=N$=Lv=null,$I=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return qIe&&t.locale!=="ko"?null:t.data;default:return null}}var Sit={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function TSe(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Sit[e.type]:t==="textarea"}function XIe(e,t,r,n){TIe(n),t=zN(t,"onChange"),0<t.length&&(r=new F$("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var PT=null,UT=null;function Iit(e){aAe(e,0)}function aF(e){var t=ZI(e);if(xIe(t))return e}function Ait(e,t){if(e==="change")return t}var YIe=!1;i0&&(i0?(fN="oninput"in document,fN||(b7=document.createElement("div"),b7.setAttribute("oninput","return;"),fN=typeof b7.oninput=="function"),pN=fN):pN=!1,YIe=pN&&(!document.documentMode||9<document.documentMode));var pN,fN,b7;function ESe(){PT&&(PT.detachEvent("onpropertychange",QIe),UT=PT=null)}function QIe(e){if(e.propertyName==="value"&&aF(UT)){var t=[];XIe(t,UT,e,k$(e)),kIe(Iit,t)}}function wit(e,t,r){e==="focusin"?(ESe(),PT=t,UT=r,PT.attachEvent("onpropertychange",QIe)):e==="focusout"&&ESe()}function _it(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return aF(UT)}function Tit(e,t){if(e==="click")return aF(t)}function Eit(e,t){if(e==="input"||e==="change")return aF(t)}function Pit(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Sf=typeof Object.is=="function"?Object.is:Pit;function zT(e,t){if(Sf(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!R7.call(t,o)||!Sf(e[o],t[o]))return!1}return!0}function PSe(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function DSe(e,t){var r=PSe(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=PSe(r)}}function JIe(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?JIe(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function eAe(){for(var e=window,t=LN();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=LN(e.document)}return t}function G$(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Dit(e){var t=eAe(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&JIe(r.ownerDocument.documentElement,r)){if(n!==null&&G$(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=r.textContent.length,i=Math.min(n.start,o);n=n.end===void 0?i:Math.min(n.end,o),!e.extend&&i>n&&(o=n,n=i,i=o),o=DSe(r,i);var s=DSe(r,n);o&&s&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var kit=i0&&"documentMode"in document&&11>=document.documentMode,WI=null,Q7=null,DT=null,J7=!1;function kSe(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;J7||WI==null||WI!==LN(n)||(n=WI,"selectionStart"in n&&G$(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),DT&&zT(DT,n)||(DT=n,n=zN(Q7,"onSelect"),0<n.length&&(t=new F$("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=WI)))}function hN(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var qI={animationend:hN("Animation","AnimationEnd"),animationiteration:hN("Animation","AnimationIteration"),animationstart:hN("Animation","AnimationStart"),transitionend:hN("Transition","TransitionEnd")},x7={},tAe={};i0&&(tAe=document.createElement("div").style,"AnimationEvent"in window||(delete qI.animationend.animation,delete qI.animationiteration.animation,delete qI.animationstart.animation),"TransitionEvent"in window||delete qI.transitionend.transition);function lF(e){if(x7[e])return x7[e];if(!qI[e])return e;var t=qI[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in tAe)return x7[e]=t[r];return e}var rAe=lF("animationend"),nAe=lF("animationiteration"),oAe=lF("animationstart"),iAe=lF("transitionend"),sAe=new Map,MSe="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qv(e,t){sAe.set(e,t),ix(t,[e])}for(gN=0;gN<MSe.length;gN++)yN=MSe[gN],RSe=yN.toLowerCase(),BSe=yN[0].toUpperCase()+yN.slice(1),qv(RSe,"on"+BSe);var yN,RSe,BSe,gN;qv(rAe,"onAnimationEnd");qv(nAe,"onAnimationIteration");qv(oAe,"onAnimationStart");qv("dblclick","onDoubleClick");qv("focusin","onFocus");qv("focusout","onBlur");qv(iAe,"onTransitionEnd");aA("onMouseEnter",["mouseout","mouseover"]);aA("onMouseLeave",["mouseout","mouseover"]);aA("onPointerEnter",["pointerout","pointerover"]);aA("onPointerLeave",["pointerout","pointerover"]);ix("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ix("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ix("onBeforeInput",["compositionend","keypress","textInput","paste"]);ix("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ix("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ix("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wT="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mit=new Set("cancel close invalid load scroll toggle".split(" ").concat(wT));function LSe(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Mot(n,t,void 0,e),e.currentTarget=null}function aAe(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],o=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var s=n.length-1;0<=s;s--){var a=n[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&o.isPropagationStopped())break e;LSe(o,a,c),i=l}else for(s=0;s<n.length;s++){if(a=n[s],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&o.isPropagationStopped())break e;LSe(o,a,c),i=l}}}if(FN)throw e=Z7,FN=!1,Z7=null,e}function ps(e,t){var r=t[o$];r===void 0&&(r=t[o$]=new Set);var n=e+"__bubble";r.has(n)||(lAe(t,e,2,!1),r.add(n))}function C7(e,t,r){var n=0;t&&(n|=4),lAe(r,e,n,t)}var vN="_reactListening"+Math.random().toString(36).slice(2);function HT(e){if(!e[vN]){e[vN]=!0,hIe.forEach(function(r){r!=="selectionchange"&&(Mit.has(r)||C7(r,!1,e),C7(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[vN]||(t[vN]=!0,C7("selectionchange",!1,t))}}function lAe(e,t,r,n){switch($Ie(t)){case 1:var o=Zot;break;case 4:o=Kot;break;default:o=L$}r=o.bind(null,t,r,e),o=void 0,!q7||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,r,{capture:!0,passive:o}):e.addEventListener(t,r,!0):o!==void 0?e.addEventListener(t,r,{passive:o}):e.addEventListener(t,r,!1)}function S7(e,t,r,n,o){var i=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var s=n.tag;if(s===3||s===4){var a=n.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(s===4)for(s=n.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===o||l.nodeType===8&&l.parentNode===o))return;s=s.return}for(;a!==null;){if(s=K1(a),s===null)return;if(l=s.tag,l===5||l===6){n=i=s;continue e}a=a.parentNode}}n=n.return}kIe(function(){var c=i,u=k$(r),d=[];e:{var m=sAe.get(e);if(m!==void 0){var p=F$,h=e;switch(e){case"keypress":if(TN(r)===0)break e;case"keydown":case"keyup":p=uit;break;case"focusin":h="focus",p=v7;break;case"focusout":h="blur",p=v7;break;case"beforeblur":case"afterblur":p=v7;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=SSe;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Qot;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=pit;break;case rAe:case nAe:case oAe:p=tit;break;case iAe:p=hit;break;case"scroll":p=Xot;break;case"wheel":p=yit;break;case"copy":case"cut":case"paste":p=nit;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=ASe}var f=(t&4)!==0,C=!f&&e==="scroll",g=f?m!==null?m+"Capture":null:m;f=[];for(var b=c,y;b!==null;){y=b;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,g!==null&&(x=FT(b,g),x!=null&&f.push(jT(b,x,y)))),C)break;b=b.return}0<f.length&&(m=new p(m,h,null,r,u),d.push({event:m,listeners:f}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",m&&r!==$7&&(h=r.relatedTarget||r.fromElement)&&(K1(h)||h[s0]))break e;if((p||m)&&(m=u.window===u?u:(m=u.ownerDocument)?m.defaultView||m.parentWindow:window,p?(h=r.relatedTarget||r.toElement,p=c,h=h?K1(h):null,h!==null&&(C=sx(h),h!==C||h.tag!==5&&h.tag!==6)&&(h=null)):(p=null,h=c),p!==h)){if(f=SSe,x="onMouseLeave",g="onMouseEnter",b="mouse",(e==="pointerout"||e==="pointerover")&&(f=ASe,x="onPointerLeave",g="onPointerEnter",b="pointer"),C=p==null?m:ZI(p),y=h==null?m:ZI(h),m=new f(x,b+"leave",p,r,u),m.target=C,m.relatedTarget=y,x=null,K1(u)===c&&(f=new f(g,b+"enter",h,r,u),f.target=y,f.relatedTarget=C,x=f),C=x,p&&h)t:{for(f=p,g=h,b=0,y=f;y;y=zI(y))b++;for(y=0,x=g;x;x=zI(x))y++;for(;0<b-y;)f=zI(f),b--;for(;0<y-b;)g=zI(g),y--;for(;b--;){if(f===g||g!==null&&f===g.alternate)break t;f=zI(f),g=zI(g)}f=null}else f=null;p!==null&&NSe(d,m,p,f,!1),h!==null&&C!==null&&NSe(d,C,h,f,!0)}}e:{if(m=c?ZI(c):window,p=m.nodeName&&m.nodeName.toLowerCase(),p==="select"||p==="input"&&m.type==="file")var A=Ait;else if(TSe(m))if(YIe)A=Eit;else{A=_it;var v=wit}else(p=m.nodeName)&&p.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(A=Tit);if(A&&(A=A(e,c))){XIe(d,A,r,u);break e}v&&v(e,m,c),e==="focusout"&&(v=m._wrapperState)&&v.controlled&&m.type==="number"&&G7(m,"number",m.value)}switch(v=c?ZI(c):window,e){case"focusin":(TSe(v)||v.contentEditable==="true")&&(WI=v,Q7=c,DT=null);break;case"focusout":DT=Q7=WI=null;break;case"mousedown":J7=!0;break;case"contextmenu":case"mouseup":case"dragend":J7=!1,kSe(d,r,u);break;case"selectionchange":if(kit)break;case"keydown":case"keyup":kSe(d,r,u)}var _;if(V$)e:{switch(e){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else $I?ZIe(e,r)&&(I="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(I="onCompositionStart");I&&(qIe&&r.locale!=="ko"&&($I||I!=="onCompositionStart"?I==="onCompositionEnd"&&$I&&(_=WIe()):(Lv=u,N$="value"in Lv?Lv.value:Lv.textContent,$I=!0)),v=zN(c,I),0<v.length&&(I=new ISe(I,e,null,r,u),d.push({event:I,listeners:v}),_?I.data=_:(_=KIe(r),_!==null&&(I.data=_)))),(_=bit?xit(e,r):Cit(e,r))&&(c=zN(c,"onBeforeInput"),0<c.length&&(u=new ISe("onBeforeInput","beforeinput",null,r,u),d.push({event:u,listeners:c}),u.data=_))}aAe(d,t)})}function jT(e,t,r){return{instance:e,listener:t,currentTarget:r}}function zN(e,t){for(var r=t+"Capture",n=[];e!==null;){var o=e,i=o.stateNode;o.tag===5&&i!==null&&(o=i,i=FT(e,r),i!=null&&n.unshift(jT(e,i,o)),i=FT(e,t),i!=null&&n.push(jT(e,i,o))),e=e.return}return n}function zI(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function NSe(e,t,r,n,o){for(var i=t._reactName,s=[];r!==null&&r!==n;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&c!==null&&(a=c,o?(l=FT(r,i),l!=null&&s.unshift(jT(r,l,a))):o||(l=FT(r,i),l!=null&&s.push(jT(r,l,a)))),r=r.return}s.length!==0&&e.push({event:t,listeners:s})}var Rit=/\r\n?/g,Bit=/\u0000|\uFFFD/g;function FSe(e){return(typeof e=="string"?e:""+e).replace(Rit,`
`).replace(Bit,"")}function bN(e,t,r){if(t=FSe(t),FSe(e)!==t&&r)throw Error(Zt(425))}function HN(){}var e$=null,t$=null;function r$(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var n$=typeof setTimeout=="function"?setTimeout:void 0,Lit=typeof clearTimeout=="function"?clearTimeout:void 0,OSe=typeof Promise=="function"?Promise:void 0,Nit=typeof queueMicrotask=="function"?queueMicrotask:typeof OSe<"u"?function(e){return OSe.resolve(null).then(e).catch(Fit)}:n$;function Fit(e){setTimeout(function(){throw e})}function I7(e,t){var r=t,n=0;do{var o=r.nextSibling;if(e.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){e.removeChild(o),GT(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);GT(t)}function Gv(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function VSe(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var hA=Math.random().toString(36).slice(2),Mh="__reactFiber$"+hA,$T="__reactProps$"+hA,s0="__reactContainer$"+hA,o$="__reactEvents$"+hA,Oit="__reactListeners$"+hA,Vit="__reactHandles$"+hA;function K1(e){var t=e[Mh];if(t)return t;for(var r=e.parentNode;r;){if(t=r[s0]||r[Mh]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=VSe(e);e!==null;){if(r=e[Mh])return r;e=VSe(e)}return t}e=r,r=e.parentNode}return null}function eE(e){return e=e[Mh]||e[s0],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ZI(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Zt(33))}function cF(e){return e[$T]||null}var i$=[],KI=-1;function Zv(e){return{current:e}}function fs(e){0>KI||(e.current=i$[KI],i$[KI]=null,KI--)}function Yi(e,t){KI++,i$[KI]=e.current,e.current=t}var Wv={},Zc=Zv(Wv),pd=Zv(!1),ex=Wv;function lA(e,t){var r=e.type.contextTypes;if(!r)return Wv;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var o={},i;for(i in r)o[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function fd(e){return e=e.childContextTypes,e!=null}function jN(){fs(pd),fs(Zc)}function GSe(e,t,r){if(Zc.current!==Wv)throw Error(Zt(168));Yi(Zc,t),Yi(pd,r)}function cAe(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in t))throw Error(Zt(108,wot(e)||"Unknown",o));return Xs({},r,n)}function $N(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Wv,ex=Zc.current,Yi(Zc,e),Yi(pd,pd.current),!0}function USe(e,t,r){var n=e.stateNode;if(!n)throw Error(Zt(169));r?(e=cAe(e,t,ex),n.__reactInternalMemoizedMergedChildContext=e,fs(pd),fs(Zc),Yi(Zc,e)):fs(pd),Yi(pd,r)}var t0=null,uF=!1,A7=!1;function uAe(e){t0===null?t0=[e]:t0.push(e)}function Git(e){uF=!0,uAe(e)}function Kv(){if(!A7&&t0!==null){A7=!0;var e=0,t=Pi;try{var r=t0;for(Pi=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}t0=null,uF=!1}catch(o){throw t0!==null&&(t0=t0.slice(e+1)),LIe(M$,Kv),o}finally{Pi=t,A7=!1}}return null}var XI=[],YI=0,WN=null,qN=0,pp=[],fp=0,tx=null,r0=1,n0="";function q1(e,t){XI[YI++]=qN,XI[YI++]=WN,WN=e,qN=t}function dAe(e,t,r){pp[fp++]=r0,pp[fp++]=n0,pp[fp++]=tx,tx=e;var n=r0;e=n0;var o=32-xf(n)-1;n&=~(1<<o),r+=1;var i=32-xf(t)+o;if(30<i){var s=o-o%5;i=(n&(1<<s)-1).toString(32),n>>=s,o-=s,r0=1<<32-xf(t)+o|r<<o|n,n0=i+e}else r0=1<<i|r<<o|n,n0=e}function U$(e){e.return!==null&&(q1(e,1),dAe(e,1,0))}function z$(e){for(;e===WN;)WN=XI[--YI],XI[YI]=null,qN=XI[--YI],XI[YI]=null;for(;e===tx;)tx=pp[--fp],pp[fp]=null,n0=pp[--fp],pp[fp]=null,r0=pp[--fp],pp[fp]=null}var Wd=null,$d=null,Ds=!1,bf=null;function mAe(e,t){var r=hp(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function zSe(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Wd=e,$d=Gv(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Wd=e,$d=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=tx!==null?{id:r0,overflow:n0}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=hp(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Wd=e,$d=null,!0):!1;default:return!1}}function s$(e){return(e.mode&1)!==0&&(e.flags&128)===0}function a$(e){if(Ds){var t=$d;if(t){var r=t;if(!zSe(e,t)){if(s$(e))throw Error(Zt(418));t=Gv(r.nextSibling);var n=Wd;t&&zSe(e,t)?mAe(n,r):(e.flags=e.flags&-4097|2,Ds=!1,Wd=e)}}else{if(s$(e))throw Error(Zt(418));e.flags=e.flags&-4097|2,Ds=!1,Wd=e}}}function HSe(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Wd=e}function xN(e){if(e!==Wd)return!1;if(!Ds)return HSe(e),Ds=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!r$(e.type,e.memoizedProps)),t&&(t=$d)){if(s$(e))throw pAe(),Error(Zt(418));for(;t;)mAe(e,t),t=Gv(t.nextSibling)}if(HSe(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Zt(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){$d=Gv(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}$d=null}}else $d=Wd?Gv(e.stateNode.nextSibling):null;return!0}function pAe(){for(var e=$d;e;)e=Gv(e.nextSibling)}function cA(){$d=Wd=null,Ds=!1}function H$(e){bf===null?bf=[e]:bf.push(e)}var Uit=c0.ReactCurrentBatchConfig;function vT(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Zt(309));var n=r.stateNode}if(!n)throw Error(Zt(147,e));var o=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(s){var a=o.refs;s===null?delete a[i]:a[i]=s},t._stringRef=i,t)}if(typeof e!="string")throw Error(Zt(284));if(!r._owner)throw Error(Zt(290,e))}return e}function CN(e,t){throw e=Object.prototype.toString.call(t),Error(Zt(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function jSe(e){var t=e._init;return t(e._payload)}function fAe(e){function t(g,b){if(e){var y=g.deletions;y===null?(g.deletions=[b],g.flags|=16):y.push(b)}}function r(g,b){if(!e)return null;for(;b!==null;)t(g,b),b=b.sibling;return null}function n(g,b){for(g=new Map;b!==null;)b.key!==null?g.set(b.key,b):g.set(b.index,b),b=b.sibling;return g}function o(g,b){return g=jv(g,b),g.index=0,g.sibling=null,g}function i(g,b,y){return g.index=y,e?(y=g.alternate,y!==null?(y=y.index,y<b?(g.flags|=2,b):y):(g.flags|=2,b)):(g.flags|=1048576,b)}function s(g){return e&&g.alternate===null&&(g.flags|=2),g}function a(g,b,y,x){return b===null||b.tag!==6?(b=k7(y,g.mode,x),b.return=g,b):(b=o(b,y),b.return=g,b)}function l(g,b,y,x){var A=y.type;return A===jI?u(g,b,y.props.children,x,y.key):b!==null&&(b.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===kv&&jSe(A)===b.type)?(x=o(b,y.props),x.ref=vT(g,b,y),x.return=g,x):(x=BN(y.type,y.key,y.props,null,g.mode,x),x.ref=vT(g,b,y),x.return=g,x)}function c(g,b,y,x){return b===null||b.tag!==4||b.stateNode.containerInfo!==y.containerInfo||b.stateNode.implementation!==y.implementation?(b=M7(y,g.mode,x),b.return=g,b):(b=o(b,y.children||[]),b.return=g,b)}function u(g,b,y,x,A){return b===null||b.tag!==7?(b=J1(y,g.mode,x,A),b.return=g,b):(b=o(b,y),b.return=g,b)}function d(g,b,y){if(typeof b=="string"&&b!==""||typeof b=="number")return b=k7(""+b,g.mode,y),b.return=g,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case sN:return y=BN(b.type,b.key,b.props,null,g.mode,y),y.ref=vT(g,null,b),y.return=g,y;case HI:return b=M7(b,g.mode,y),b.return=g,b;case kv:var x=b._init;return d(g,x(b._payload),y)}if(IT(b)||fT(b))return b=J1(b,g.mode,y,null),b.return=g,b;CN(g,b)}return null}function m(g,b,y,x){var A=b!==null?b.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return A!==null?null:a(g,b,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case sN:return y.key===A?l(g,b,y,x):null;case HI:return y.key===A?c(g,b,y,x):null;case kv:return A=y._init,m(g,b,A(y._payload),x)}if(IT(y)||fT(y))return A!==null?null:u(g,b,y,x,null);CN(g,y)}return null}function p(g,b,y,x,A){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(y)||null,a(b,g,""+x,A);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case sN:return g=g.get(x.key===null?y:x.key)||null,l(b,g,x,A);case HI:return g=g.get(x.key===null?y:x.key)||null,c(b,g,x,A);case kv:var v=x._init;return p(g,b,y,v(x._payload),A)}if(IT(x)||fT(x))return g=g.get(y)||null,u(b,g,x,A,null);CN(b,x)}return null}function h(g,b,y,x){for(var A=null,v=null,_=b,I=b=0,T=null;_!==null&&I<y.length;I++){_.index>I?(T=_,_=null):T=_.sibling;var E=m(g,_,y[I],x);if(E===null){_===null&&(_=T);break}e&&_&&E.alternate===null&&t(g,_),b=i(E,b,I),v===null?A=E:v.sibling=E,v=E,_=T}if(I===y.length)return r(g,_),Ds&&q1(g,I),A;if(_===null){for(;I<y.length;I++)_=d(g,y[I],x),_!==null&&(b=i(_,b,I),v===null?A=_:v.sibling=_,v=_);return Ds&&q1(g,I),A}for(_=n(g,_);I<y.length;I++)T=p(_,g,I,y[I],x),T!==null&&(e&&T.alternate!==null&&_.delete(T.key===null?I:T.key),b=i(T,b,I),v===null?A=T:v.sibling=T,v=T);return e&&_.forEach(function(w){return t(g,w)}),Ds&&q1(g,I),A}function f(g,b,y,x){var A=fT(y);if(typeof A!="function")throw Error(Zt(150));if(y=A.call(y),y==null)throw Error(Zt(151));for(var v=A=null,_=b,I=b=0,T=null,E=y.next();_!==null&&!E.done;I++,E=y.next()){_.index>I?(T=_,_=null):T=_.sibling;var w=m(g,_,E.value,x);if(w===null){_===null&&(_=T);break}e&&_&&w.alternate===null&&t(g,_),b=i(w,b,I),v===null?A=w:v.sibling=w,v=w,_=T}if(E.done)return r(g,_),Ds&&q1(g,I),A;if(_===null){for(;!E.done;I++,E=y.next())E=d(g,E.value,x),E!==null&&(b=i(E,b,I),v===null?A=E:v.sibling=E,v=E);return Ds&&q1(g,I),A}for(_=n(g,_);!E.done;I++,E=y.next())E=p(_,g,I,E.value,x),E!==null&&(e&&E.alternate!==null&&_.delete(E.key===null?I:E.key),b=i(E,b,I),v===null?A=E:v.sibling=E,v=E);return e&&_.forEach(function(S){return t(g,S)}),Ds&&q1(g,I),A}function C(g,b,y,x){if(typeof y=="object"&&y!==null&&y.type===jI&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case sN:e:{for(var A=y.key,v=b;v!==null;){if(v.key===A){if(A=y.type,A===jI){if(v.tag===7){r(g,v.sibling),b=o(v,y.props.children),b.return=g,g=b;break e}}else if(v.elementType===A||typeof A=="object"&&A!==null&&A.$$typeof===kv&&jSe(A)===v.type){r(g,v.sibling),b=o(v,y.props),b.ref=vT(g,v,y),b.return=g,g=b;break e}r(g,v);break}else t(g,v);v=v.sibling}y.type===jI?(b=J1(y.props.children,g.mode,x,y.key),b.return=g,g=b):(x=BN(y.type,y.key,y.props,null,g.mode,x),x.ref=vT(g,b,y),x.return=g,g=x)}return s(g);case HI:e:{for(v=y.key;b!==null;){if(b.key===v)if(b.tag===4&&b.stateNode.containerInfo===y.containerInfo&&b.stateNode.implementation===y.implementation){r(g,b.sibling),b=o(b,y.children||[]),b.return=g,g=b;break e}else{r(g,b);break}else t(g,b);b=b.sibling}b=M7(y,g.mode,x),b.return=g,g=b}return s(g);case kv:return v=y._init,C(g,b,v(y._payload),x)}if(IT(y))return h(g,b,y,x);if(fT(y))return f(g,b,y,x);CN(g,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,b!==null&&b.tag===6?(r(g,b.sibling),b=o(b,y),b.return=g,g=b):(r(g,b),b=k7(y,g.mode,x),b.return=g,g=b),s(g)):r(g,b)}return C}var uA=fAe(!0),hAe=fAe(!1),ZN=Zv(null),KN=null,QI=null,j$=null;function $$(){j$=QI=KN=null}function W$(e){var t=ZN.current;fs(ZN),e._currentValue=t}function l$(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function iA(e,t){KN=e,j$=QI=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(md=!0),e.firstContext=null)}function yp(e){var t=e._currentValue;if(j$!==e)if(e={context:e,memoizedValue:t,next:null},QI===null){if(KN===null)throw Error(Zt(308));QI=e,KN.dependencies={lanes:0,firstContext:e}}else QI=QI.next=e;return t}var X1=null;function q$(e){X1===null?X1=[e]:X1.push(e)}function gAe(e,t,r,n){var o=t.interleaved;return o===null?(r.next=r,q$(t)):(r.next=o.next,o.next=r),t.interleaved=r,a0(e,n)}function a0(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Mv=!1;function Z$(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yAe(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function o0(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Uv(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Uo&2){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,a0(e,r)}return o=n.interleaved,o===null?(t.next=t,q$(n)):(t.next=o.next,o.next=t),n.interleaved=t,a0(e,r)}function EN(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,R$(e,r)}}function $Se(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var s={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?o=i=s:i=i.next=s,r=r.next}while(r!==null);i===null?o=i=t:i=i.next=t}else o=i=t;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function XN(e,t,r,n){var o=e.updateQueue;Mv=!1;var i=o.firstBaseUpdate,s=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var l=a,c=l.next;l.next=null,s===null?i=c:s.next=c,s=l;var u=e.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==s&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=o.baseState;s=0,u=c=l=null,a=i;do{var m=a.lane,p=a.eventTime;if((n&m)===m){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var h=e,f=a;switch(m=t,p=r,f.tag){case 1:if(h=f.payload,typeof h=="function"){d=h.call(p,d,m);break e}d=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=f.payload,m=typeof h=="function"?h.call(p,d,m):h,m==null)break e;d=Xs({},d,m);break e;case 2:Mv=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,m=o.effects,m===null?o.effects=[a]:m.push(a))}else p={eventTime:p,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=d):u=u.next=p,s|=m;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;m=a,a=m.next,m.next=null,o.lastBaseUpdate=m,o.shared.pending=null}}while(!0);if(u===null&&(l=d),o.baseState=l,o.firstBaseUpdate=c,o.lastBaseUpdate=u,t=o.shared.interleaved,t!==null){o=t;do s|=o.lane,o=o.next;while(o!==t)}else i===null&&(o.shared.lanes=0);nx|=s,e.lanes=s,e.memoizedState=d}}function WSe(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(Zt(191,o));o.call(n)}}}var tE={},Bh=Zv(tE),WT=Zv(tE),qT=Zv(tE);function Y1(e){if(e===tE)throw Error(Zt(174));return e}function K$(e,t){switch(Yi(qT,t),Yi(WT,e),Yi(Bh,tE),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:z7(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=z7(t,e)}fs(Bh),Yi(Bh,t)}function dA(){fs(Bh),fs(WT),fs(qT)}function vAe(e){Y1(qT.current);var t=Y1(Bh.current),r=z7(t,e.type);t!==r&&(Yi(WT,e),Yi(Bh,r))}function X$(e){WT.current===e&&(fs(Bh),fs(WT))}var Zs=Zv(0);function YN(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var w7=[];function Y$(){for(var e=0;e<w7.length;e++)w7[e]._workInProgressVersionPrimary=null;w7.length=0}var PN=c0.ReactCurrentDispatcher,_7=c0.ReactCurrentBatchConfig,rx=0,Ks=null,ll=null,Kl=null,QN=!1,kT=!1,ZT=0,zit=0;function $c(){throw Error(Zt(321))}function Q$(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Sf(e[r],t[r]))return!1;return!0}function J$(e,t,r,n,o,i){if(rx=i,Ks=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,PN.current=e===null||e.memoizedState===null?Wit:qit,e=r(n,o),kT){i=0;do{if(kT=!1,ZT=0,25<=i)throw Error(Zt(301));i+=1,Kl=ll=null,t.updateQueue=null,PN.current=Zit,e=r(n,o)}while(kT)}if(PN.current=JN,t=ll!==null&&ll.next!==null,rx=0,Kl=ll=Ks=null,QN=!1,t)throw Error(Zt(300));return e}function eW(){var e=ZT!==0;return ZT=0,e}function kh(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Kl===null?Ks.memoizedState=Kl=e:Kl=Kl.next=e,Kl}function vp(){if(ll===null){var e=Ks.alternate;e=e!==null?e.memoizedState:null}else e=ll.next;var t=Kl===null?Ks.memoizedState:Kl.next;if(t!==null)Kl=t,ll=e;else{if(e===null)throw Error(Zt(310));ll=e,e={memoizedState:ll.memoizedState,baseState:ll.baseState,baseQueue:ll.baseQueue,queue:ll.queue,next:null},Kl===null?Ks.memoizedState=Kl=e:Kl=Kl.next=e}return Kl}function KT(e,t){return typeof t=="function"?t(e):t}function T7(e){var t=vp(),r=t.queue;if(r===null)throw Error(Zt(311));r.lastRenderedReducer=e;var n=ll,o=n.baseQueue,i=r.pending;if(i!==null){if(o!==null){var s=o.next;o.next=i.next,i.next=s}n.baseQueue=o=i,r.pending=null}if(o!==null){i=o.next,n=n.baseState;var a=s=null,l=null,c=i;do{var u=c.lane;if((rx&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),n=c.hasEagerState?c.eagerState:e(n,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,s=n):l=l.next=d,Ks.lanes|=u,nx|=u}c=c.next}while(c!==null&&c!==i);l===null?s=n:l.next=a,Sf(n,t.memoizedState)||(md=!0),t.memoizedState=n,t.baseState=s,t.baseQueue=l,r.lastRenderedState=n}if(e=r.interleaved,e!==null){o=e;do i=o.lane,Ks.lanes|=i,nx|=i,o=o.next;while(o!==e)}else o===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function E7(e){var t=vp(),r=t.queue;if(r===null)throw Error(Zt(311));r.lastRenderedReducer=e;var n=r.dispatch,o=r.pending,i=t.memoizedState;if(o!==null){r.pending=null;var s=o=o.next;do i=e(i,s.action),s=s.next;while(s!==o);Sf(i,t.memoizedState)||(md=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function bAe(){}function xAe(e,t){var r=Ks,n=vp(),o=t(),i=!Sf(n.memoizedState,o);if(i&&(n.memoizedState=o,md=!0),n=n.queue,tW(IAe.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||Kl!==null&&Kl.memoizedState.tag&1){if(r.flags|=2048,XT(9,SAe.bind(null,r,n,o,t),void 0,null),Xl===null)throw Error(Zt(349));rx&30||CAe(r,t,o)}return o}function CAe(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Ks.updateQueue,t===null?(t={lastEffect:null,stores:null},Ks.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function SAe(e,t,r,n){t.value=r,t.getSnapshot=n,AAe(t)&&wAe(e)}function IAe(e,t,r){return r(function(){AAe(t)&&wAe(e)})}function AAe(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Sf(e,r)}catch{return!0}}function wAe(e){var t=a0(e,1);t!==null&&Cf(t,e,1,-1)}function qSe(e){var t=kh();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:KT,lastRenderedState:e},t.queue=e,e=e.dispatch=$it.bind(null,Ks,e),[t.memoizedState,e]}function XT(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=Ks.updateQueue,t===null?(t={lastEffect:null,stores:null},Ks.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function _Ae(){return vp().memoizedState}function DN(e,t,r,n){var o=kh();Ks.flags|=e,o.memoizedState=XT(1|t,r,void 0,n===void 0?null:n)}function dF(e,t,r,n){var o=vp();n=n===void 0?null:n;var i=void 0;if(ll!==null){var s=ll.memoizedState;if(i=s.destroy,n!==null&&Q$(n,s.deps)){o.memoizedState=XT(t,r,i,n);return}}Ks.flags|=e,o.memoizedState=XT(1|t,r,i,n)}function ZSe(e,t){return DN(8390656,8,e,t)}function tW(e,t){return dF(2048,8,e,t)}function TAe(e,t){return dF(4,2,e,t)}function EAe(e,t){return dF(4,4,e,t)}function PAe(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function DAe(e,t,r){return r=r!=null?r.concat([e]):null,dF(4,4,PAe.bind(null,t,e),r)}function rW(){}function kAe(e,t){var r=vp();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Q$(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function MAe(e,t){var r=vp();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Q$(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function RAe(e,t,r){return rx&21?(Sf(r,t)||(r=OIe(),Ks.lanes|=r,nx|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,md=!0),e.memoizedState=r)}function Hit(e,t){var r=Pi;Pi=r!==0&&4>r?r:4,e(!0);var n=_7.transition;_7.transition={};try{e(!1),t()}finally{Pi=r,_7.transition=n}}function BAe(){return vp().memoizedState}function jit(e,t,r){var n=Hv(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},LAe(e))NAe(t,r);else if(r=gAe(e,t,r,n),r!==null){var o=xu();Cf(r,e,n,o),FAe(r,t,n)}}function $it(e,t,r){var n=Hv(e),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(LAe(e))NAe(t,o);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var s=t.lastRenderedState,a=i(s,r);if(o.hasEagerState=!0,o.eagerState=a,Sf(a,s)){var l=t.interleaved;l===null?(o.next=o,q$(t)):(o.next=l.next,l.next=o),t.interleaved=o;return}}catch{}finally{}r=gAe(e,t,o,n),r!==null&&(o=xu(),Cf(r,e,n,o),FAe(r,t,n))}}function LAe(e){var t=e.alternate;return e===Ks||t!==null&&t===Ks}function NAe(e,t){kT=QN=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function FAe(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,R$(e,r)}}var JN={readContext:yp,useCallback:$c,useContext:$c,useEffect:$c,useImperativeHandle:$c,useInsertionEffect:$c,useLayoutEffect:$c,useMemo:$c,useReducer:$c,useRef:$c,useState:$c,useDebugValue:$c,useDeferredValue:$c,useTransition:$c,useMutableSource:$c,useSyncExternalStore:$c,useId:$c,unstable_isNewReconciler:!1},Wit={readContext:yp,useCallback:function(e,t){return kh().memoizedState=[e,t===void 0?null:t],e},useContext:yp,useEffect:ZSe,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,DN(4194308,4,PAe.bind(null,t,e),r)},useLayoutEffect:function(e,t){return DN(4194308,4,e,t)},useInsertionEffect:function(e,t){return DN(4,2,e,t)},useMemo:function(e,t){var r=kh();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=kh();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=jit.bind(null,Ks,e),[n.memoizedState,e]},useRef:function(e){var t=kh();return e={current:e},t.memoizedState=e},useState:qSe,useDebugValue:rW,useDeferredValue:function(e){return kh().memoizedState=e},useTransition:function(){var e=qSe(!1),t=e[0];return e=Hit.bind(null,e[1]),kh().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=Ks,o=kh();if(Ds){if(r===void 0)throw Error(Zt(407));r=r()}else{if(r=t(),Xl===null)throw Error(Zt(349));rx&30||CAe(n,t,r)}o.memoizedState=r;var i={value:r,getSnapshot:t};return o.queue=i,ZSe(IAe.bind(null,n,i,e),[e]),n.flags|=2048,XT(9,SAe.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=kh(),t=Xl.identifierPrefix;if(Ds){var r=n0,n=r0;r=(n&~(1<<32-xf(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=ZT++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=zit++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},qit={readContext:yp,useCallback:kAe,useContext:yp,useEffect:tW,useImperativeHandle:DAe,useInsertionEffect:TAe,useLayoutEffect:EAe,useMemo:MAe,useReducer:T7,useRef:_Ae,useState:function(){return T7(KT)},useDebugValue:rW,useDeferredValue:function(e){var t=vp();return RAe(t,ll.memoizedState,e)},useTransition:function(){var e=T7(KT)[0],t=vp().memoizedState;return[e,t]},useMutableSource:bAe,useSyncExternalStore:xAe,useId:BAe,unstable_isNewReconciler:!1},Zit={readContext:yp,useCallback:kAe,useContext:yp,useEffect:tW,useImperativeHandle:DAe,useInsertionEffect:TAe,useLayoutEffect:EAe,useMemo:MAe,useReducer:E7,useRef:_Ae,useState:function(){return E7(KT)},useDebugValue:rW,useDeferredValue:function(e){var t=vp();return ll===null?t.memoizedState=e:RAe(t,ll.memoizedState,e)},useTransition:function(){var e=E7(KT)[0],t=vp().memoizedState;return[e,t]},useMutableSource:bAe,useSyncExternalStore:xAe,useId:BAe,unstable_isNewReconciler:!1};function yf(e,t){if(e&&e.defaultProps){t=Xs({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function c$(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:Xs({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var mF={isMounted:function(e){return(e=e._reactInternals)?sx(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=xu(),o=Hv(e),i=o0(n,o);i.payload=t,r!=null&&(i.callback=r),t=Uv(e,i,o),t!==null&&(Cf(t,e,o,n),EN(t,e,o))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=xu(),o=Hv(e),i=o0(n,o);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=Uv(e,i,o),t!==null&&(Cf(t,e,o,n),EN(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=xu(),n=Hv(e),o=o0(r,n);o.tag=2,t!=null&&(o.callback=t),t=Uv(e,o,n),t!==null&&(Cf(t,e,n,r),EN(t,e,n))}};function KSe(e,t,r,n,o,i,s){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,s):t.prototype&&t.prototype.isPureReactComponent?!zT(r,n)||!zT(o,i):!0}function OAe(e,t,r){var n=!1,o=Wv,i=t.contextType;return typeof i=="object"&&i!==null?i=yp(i):(o=fd(t)?ex:Zc.current,n=t.contextTypes,i=(n=n!=null)?lA(e,o):Wv),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=mF,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=i),t}function XSe(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&mF.enqueueReplaceState(t,t.state,null)}function u$(e,t,r,n){var o=e.stateNode;o.props=r,o.state=e.memoizedState,o.refs={},Z$(e);var i=t.contextType;typeof i=="object"&&i!==null?o.context=yp(i):(i=fd(t)?ex:Zc.current,o.context=lA(e,i)),o.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(c$(e,t,i,r),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&mF.enqueueReplaceState(o,o.state,null),XN(e,r,o,n),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function mA(e,t){try{var r="",n=t;do r+=Aot(n),n=n.return;while(n);var o=r}catch(i){o=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:o,digest:null}}function P7(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function d$(e,t){try{}catch(r){setTimeout(function(){throw r})}}var Kit=typeof WeakMap=="function"?WeakMap:Map;function VAe(e,t,r){r=o0(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){tF||(tF=!0,C$=n),d$(e,t)},r}function GAe(e,t,r){r=o0(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var o=t.value;r.payload=function(){return n(o)},r.callback=function(){d$(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){d$(e,t),typeof n!="function"&&(zv===null?zv=new Set([this]):zv.add(this));var s=t.stack;this.componentDidCatch(t.value,{componentStack:s!==null?s:""})}),r}function YSe(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Kit;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(r)||(o.add(r),e=cst.bind(null,e,t,r),t.then(e,e))}function QSe(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function JSe(e,t,r,n,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=o0(-1,1),t.tag=2,Uv(r,t,1))),r.lanes|=1),e)}var Xit=c0.ReactCurrentOwner,md=!1;function bu(e,t,r,n){t.child=e===null?hAe(t,null,r,n):uA(t,e.child,r,n)}function eIe(e,t,r,n,o){r=r.render;var i=t.ref;return iA(t,o),n=J$(e,t,r,n,i,o),r=eW(),e!==null&&!md?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,l0(e,t,o)):(Ds&&r&&U$(t),t.flags|=1,bu(e,t,n,o),t.child)}function tIe(e,t,r,n,o){if(e===null){var i=r.type;return typeof i=="function"&&!uW(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,UAe(e,t,i,n,o)):(e=BN(r.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&o)){var s=i.memoizedProps;if(r=r.compare,r=r!==null?r:zT,r(s,n)&&e.ref===t.ref)return l0(e,t,o)}return t.flags|=1,e=jv(i,n),e.ref=t.ref,e.return=t,t.child=e}function UAe(e,t,r,n,o){if(e!==null){var i=e.memoizedProps;if(zT(i,n)&&e.ref===t.ref)if(md=!1,t.pendingProps=n=i,(e.lanes&o)!==0)e.flags&131072&&(md=!0);else return t.lanes=e.lanes,l0(e,t,o)}return m$(e,t,r,n,o)}function zAe(e,t,r){var n=t.pendingProps,o=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yi(eA,jd),jd|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Yi(eA,jd),jd|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,Yi(eA,jd),jd|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,Yi(eA,jd),jd|=n;return bu(e,t,o,r),t.child}function HAe(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function m$(e,t,r,n,o){var i=fd(r)?ex:Zc.current;return i=lA(t,i),iA(t,o),r=J$(e,t,r,n,i,o),n=eW(),e!==null&&!md?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,l0(e,t,o)):(Ds&&n&&U$(t),t.flags|=1,bu(e,t,r,o),t.child)}function rIe(e,t,r,n,o){if(fd(r)){var i=!0;$N(t)}else i=!1;if(iA(t,o),t.stateNode===null)kN(e,t),OAe(t,r,n),u$(t,r,n,o),n=!0;else if(e===null){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=r.contextType;typeof c=="object"&&c!==null?c=yp(c):(c=fd(r)?ex:Zc.current,c=lA(t,c));var u=r.getDerivedStateFromProps,d=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";d||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==n||l!==c)&&XSe(t,s,n,c),Mv=!1;var m=t.memoizedState;s.state=m,XN(t,n,s,o),l=t.memoizedState,a!==n||m!==l||pd.current||Mv?(typeof u=="function"&&(c$(t,r,u,n),l=t.memoizedState),(a=Mv||KSe(t,r,a,n,m,l,c))?(d||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(t.flags|=4194308)):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),s.props=n,s.state=l,s.context=c,n=a):(typeof s.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{s=t.stateNode,yAe(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:yf(t.type,a),s.props=c,d=t.pendingProps,m=s.context,l=r.contextType,typeof l=="object"&&l!==null?l=yp(l):(l=fd(r)?ex:Zc.current,l=lA(t,l));var p=r.getDerivedStateFromProps;(u=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==d||m!==l)&&XSe(t,s,n,l),Mv=!1,m=t.memoizedState,s.state=m,XN(t,n,s,o);var h=t.memoizedState;a!==d||m!==h||pd.current||Mv?(typeof p=="function"&&(c$(t,r,p,n),h=t.memoizedState),(c=Mv||KSe(t,r,c,n,m,h,l)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(n,h,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(n,h,l)),typeof s.componentDidUpdate=="function"&&(t.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=h),s.props=n,s.state=h,s.context=l,n=c):(typeof s.componentDidUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),n=!1)}return p$(e,t,r,n,i,o)}function p$(e,t,r,n,o,i){HAe(e,t);var s=(t.flags&128)!==0;if(!n&&!s)return o&&USe(t,r,!1),l0(e,t,i);n=t.stateNode,Xit.current=t;var a=s&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&s?(t.child=uA(t,e.child,null,i),t.child=uA(t,null,a,i)):bu(e,t,a,i),t.memoizedState=n.state,o&&USe(t,r,!0),t.child}function jAe(e){var t=e.stateNode;t.pendingContext?GSe(e,t.pendingContext,t.pendingContext!==t.context):t.context&&GSe(e,t.context,!1),K$(e,t.containerInfo)}function nIe(e,t,r,n,o){return cA(),H$(o),t.flags|=256,bu(e,t,r,n),t.child}var f$={dehydrated:null,treeContext:null,retryLane:0};function h$(e){return{baseLanes:e,cachePool:null,transitions:null}}function $Ae(e,t,r){var n=t.pendingProps,o=Zs.current,i=!1,s=(t.flags&128)!==0,a;if((a=s)||(a=e!==null&&e.memoizedState===null?!1:(o&2)!==0),a?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),Yi(Zs,o&1),e===null)return a$(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=n.children,e=n.fallback,i?(n=t.mode,i=t.child,s={mode:"hidden",children:s},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=s):i=hF(s,n,0,null),e=J1(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=h$(r),t.memoizedState=f$,e):nW(t,s));if(o=e.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return Yit(e,t,s,n,a,o,r);if(i){i=n.fallback,s=t.mode,o=e.child,a=o.sibling;var l={mode:"hidden",children:n.children};return!(s&1)&&t.child!==o?(n=t.child,n.childLanes=0,n.pendingProps=l,t.deletions=null):(n=jv(o,l),n.subtreeFlags=o.subtreeFlags&14680064),a!==null?i=jv(a,i):(i=J1(i,s,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,s=e.child.memoizedState,s=s===null?h$(r):{baseLanes:s.baseLanes|r,cachePool:null,transitions:s.transitions},i.memoizedState=s,i.childLanes=e.childLanes&~r,t.memoizedState=f$,n}return i=e.child,e=i.sibling,n=jv(i,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function nW(e,t){return t=hF({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function SN(e,t,r,n){return n!==null&&H$(n),uA(t,e.child,null,r),e=nW(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Yit(e,t,r,n,o,i,s){if(r)return t.flags&256?(t.flags&=-257,n=P7(Error(Zt(422))),SN(e,t,s,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,o=t.mode,n=hF({mode:"visible",children:n.children},o,0,null),i=J1(i,o,s,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,t.mode&1&&uA(t,e.child,null,s),t.child.memoizedState=h$(s),t.memoizedState=f$,i);if(!(t.mode&1))return SN(e,t,s,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var a=n.dgst;return n=a,i=Error(Zt(419)),n=P7(i,n,void 0),SN(e,t,s,n)}if(a=(s&e.childLanes)!==0,md||a){if(n=Xl,n!==null){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(n.suspendedLanes|s)?0:o,o!==0&&o!==i.retryLane&&(i.retryLane=o,a0(e,o),Cf(n,e,o,-1))}return cW(),n=P7(Error(Zt(421))),SN(e,t,s,n)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=ust.bind(null,e),o._reactRetry=t,null):(e=i.treeContext,$d=Gv(o.nextSibling),Wd=t,Ds=!0,bf=null,e!==null&&(pp[fp++]=r0,pp[fp++]=n0,pp[fp++]=tx,r0=e.id,n0=e.overflow,tx=t),t=nW(t,n.children),t.flags|=4096,t)}function oIe(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),l$(e.return,t,r)}function D7(e,t,r,n,o){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=o)}function WAe(e,t,r){var n=t.pendingProps,o=n.revealOrder,i=n.tail;if(bu(e,t,n.children,r),n=Zs.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&oIe(e,r,t);else if(e.tag===19)oIe(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Yi(Zs,n),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(r=t.child,o=null;r!==null;)e=r.alternate,e!==null&&YN(e)===null&&(o=r),r=r.sibling;r=o,r===null?(o=t.child,t.child=null):(o=r.sibling,r.sibling=null),D7(t,!1,o,r,i);break;case"backwards":for(r=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&YN(e)===null){t.child=o;break}e=o.sibling,o.sibling=r,r=o,o=e}D7(t,!0,r,null,i);break;case"together":D7(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function kN(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function l0(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),nx|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Zt(153));if(t.child!==null){for(e=t.child,r=jv(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=jv(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Qit(e,t,r){switch(t.tag){case 3:jAe(t),cA();break;case 5:vAe(t);break;case 1:fd(t.type)&&$N(t);break;case 4:K$(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,o=t.memoizedProps.value;Yi(ZN,n._currentValue),n._currentValue=o;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Yi(Zs,Zs.current&1),t.flags|=128,null):r&t.child.childLanes?$Ae(e,t,r):(Yi(Zs,Zs.current&1),e=l0(e,t,r),e!==null?e.sibling:null);Yi(Zs,Zs.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return WAe(e,t,r);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Yi(Zs,Zs.current),n)break;return null;case 22:case 23:return t.lanes=0,zAe(e,t,r)}return l0(e,t,r)}var qAe,g$,ZAe,KAe;qAe=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};g$=function(){};ZAe=function(e,t,r,n){var o=e.memoizedProps;if(o!==n){e=t.stateNode,Y1(Bh.current);var i=null;switch(r){case"input":o=O7(e,o),n=O7(e,n),i=[];break;case"select":o=Xs({},o,{value:void 0}),n=Xs({},n,{value:void 0}),i=[];break;case"textarea":o=U7(e,o),n=U7(e,n),i=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=HN)}H7(r,n);var s;r=null;for(c in o)if(!n.hasOwnProperty(c)&&o.hasOwnProperty(c)&&o[c]!=null)if(c==="style"){var a=o[c];for(s in a)a.hasOwnProperty(s)&&(r||(r={}),r[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(LT.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in n){var l=n[c];if(a=o?.[c],n.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(r||(r={}),r[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(r||(r={}),r[s]=l[s])}else r||(i||(i=[]),i.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(LT.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ps("scroll",e),i||a===l||(i=[])):(i=i||[]).push(c,l))}r&&(i=i||[]).push("style",r);var c=i;(t.updateQueue=c)&&(t.flags|=4)}};KAe=function(e,t,r,n){r!==n&&(t.flags|=4)};function bT(e,t){if(!Ds)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Wc(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Jit(e,t,r){var n=t.pendingProps;switch(z$(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wc(t),null;case 1:return fd(t.type)&&jN(),Wc(t),null;case 3:return n=t.stateNode,dA(),fs(pd),fs(Zc),Y$(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(xN(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,bf!==null&&(A$(bf),bf=null))),g$(e,t),Wc(t),null;case 5:X$(t);var o=Y1(qT.current);if(r=t.type,e!==null&&t.stateNode!=null)ZAe(e,t,r,n,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Zt(166));return Wc(t),null}if(e=Y1(Bh.current),xN(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Mh]=t,n[$T]=i,e=(t.mode&1)!==0,r){case"dialog":ps("cancel",n),ps("close",n);break;case"iframe":case"object":case"embed":ps("load",n);break;case"video":case"audio":for(o=0;o<wT.length;o++)ps(wT[o],n);break;case"source":ps("error",n);break;case"img":case"image":case"link":ps("error",n),ps("load",n);break;case"details":ps("toggle",n);break;case"input":mSe(n,i),ps("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},ps("invalid",n);break;case"textarea":fSe(n,i),ps("invalid",n)}H7(r,i),o=null;for(var s in i)if(i.hasOwnProperty(s)){var a=i[s];s==="children"?typeof a=="string"?n.textContent!==a&&(i.suppressHydrationWarning!==!0&&bN(n.textContent,a,e),o=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&bN(n.textContent,a,e),o=["children",""+a]):LT.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&ps("scroll",n)}switch(r){case"input":aN(n),pSe(n,i,!0);break;case"textarea":aN(n),hSe(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=HN)}n=o,t.updateQueue=n,n!==null&&(t.flags|=4)}else{s=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=IIe(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=s.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=s.createElement(r,{is:n.is}):(e=s.createElement(r),r==="select"&&(s=e,n.multiple?s.multiple=!0:n.size&&(s.size=n.size))):e=s.createElementNS(e,r),e[Mh]=t,e[$T]=n,qAe(e,t,!1,!1),t.stateNode=e;e:{switch(s=j7(r,n),r){case"dialog":ps("cancel",e),ps("close",e),o=n;break;case"iframe":case"object":case"embed":ps("load",e),o=n;break;case"video":case"audio":for(o=0;o<wT.length;o++)ps(wT[o],e);o=n;break;case"source":ps("error",e),o=n;break;case"img":case"image":case"link":ps("error",e),ps("load",e),o=n;break;case"details":ps("toggle",e),o=n;break;case"input":mSe(e,n),o=O7(e,n),ps("invalid",e);break;case"option":o=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},o=Xs({},n,{value:void 0}),ps("invalid",e);break;case"textarea":fSe(e,n),o=U7(e,n),ps("invalid",e);break;default:o=n}H7(r,o),a=o;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?_Ie(e,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&AIe(e,l)):i==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&NT(e,l):typeof l=="number"&&NT(e,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(LT.hasOwnProperty(i)?l!=null&&i==="onScroll"&&ps("scroll",e):l!=null&&T$(e,i,l,s))}switch(r){case"input":aN(e),pSe(e,n,!1);break;case"textarea":aN(e),hSe(e);break;case"option":n.value!=null&&e.setAttribute("value",""+$v(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?tA(e,!!n.multiple,i,!1):n.defaultValue!=null&&tA(e,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=HN)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Wc(t),null;case 6:if(e&&t.stateNode!=null)KAe(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Zt(166));if(r=Y1(qT.current),Y1(Bh.current),xN(t)){if(n=t.stateNode,r=t.memoizedProps,n[Mh]=t,(i=n.nodeValue!==r)&&(e=Wd,e!==null))switch(e.tag){case 3:bN(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&bN(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Mh]=t,t.stateNode=n}return Wc(t),null;case 13:if(fs(Zs),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Ds&&$d!==null&&t.mode&1&&!(t.flags&128))pAe(),cA(),t.flags|=98560,i=!1;else if(i=xN(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(Zt(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Zt(317));i[Mh]=t}else cA(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Wc(t),i=!1}else bf!==null&&(A$(bf),bf=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||Zs.current&1?cl===0&&(cl=3):cW())),t.updateQueue!==null&&(t.flags|=4),Wc(t),null);case 4:return dA(),g$(e,t),e===null&&HT(t.stateNode.containerInfo),Wc(t),null;case 10:return W$(t.type._context),Wc(t),null;case 17:return fd(t.type)&&jN(),Wc(t),null;case 19:if(fs(Zs),i=t.memoizedState,i===null)return Wc(t),null;if(n=(t.flags&128)!==0,s=i.rendering,s===null)if(n)bT(i,!1);else{if(cl!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(s=YN(e),s!==null){for(t.flags|=128,bT(i,!1),n=s.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,s=i.alternate,s===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=s.childLanes,i.lanes=s.lanes,i.child=s.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=s.memoizedProps,i.memoizedState=s.memoizedState,i.updateQueue=s.updateQueue,i.type=s.type,e=s.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Yi(Zs,Zs.current&1|2),t.child}e=e.sibling}i.tail!==null&&Aa()>pA&&(t.flags|=128,n=!0,bT(i,!1),t.lanes=4194304)}else{if(!n)if(e=YN(s),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),bT(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!Ds)return Wc(t),null}else 2*Aa()-i.renderingStartTime>pA&&r!==1073741824&&(t.flags|=128,n=!0,bT(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(r=i.last,r!==null?r.sibling=s:t.child=s,i.last=s)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Aa(),t.sibling=null,r=Zs.current,Yi(Zs,n?r&1|2:r&1),t):(Wc(t),null);case 22:case 23:return lW(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?jd&1073741824&&(Wc(t),t.subtreeFlags&6&&(t.flags|=8192)):Wc(t),null;case 24:return null;case 25:return null}throw Error(Zt(156,t.tag))}function est(e,t){switch(z$(t),t.tag){case 1:return fd(t.type)&&jN(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return dA(),fs(pd),fs(Zc),Y$(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return X$(t),null;case 13:if(fs(Zs),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Zt(340));cA()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return fs(Zs),null;case 4:return dA(),null;case 10:return W$(t.type._context),null;case 22:case 23:return lW(),null;case 24:return null;default:return null}}var IN=!1,qc=!1,tst=typeof WeakSet=="function"?WeakSet:Set,wr=null;function JI(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){ca(e,t,n)}else r.current=null}function y$(e,t,r){try{r()}catch(n){ca(e,t,n)}}var iIe=!1;function rst(e,t){if(e$=GN,e=eAe(),G$(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var s=0,a=-1,l=-1,c=0,u=0,d=e,m=null;t:for(;;){for(var p;d!==r||o!==0&&d.nodeType!==3||(a=s+o),d!==i||n!==0&&d.nodeType!==3||(l=s+n),d.nodeType===3&&(s+=d.nodeValue.length),(p=d.firstChild)!==null;)m=d,d=p;for(;;){if(d===e)break t;if(m===r&&++c===o&&(a=s),m===i&&++u===n&&(l=s),(p=d.nextSibling)!==null)break;d=m,m=d.parentNode}d=p}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(t$={focusedElem:e,selectionRange:r},GN=!1,wr=t;wr!==null;)if(t=wr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,wr=e;else for(;wr!==null;){t=wr;try{var h=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var f=h.memoizedProps,C=h.memoizedState,g=t.stateNode,b=g.getSnapshotBeforeUpdate(t.elementType===t.type?f:yf(t.type,f),C);g.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var y=t.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Zt(163))}}catch(x){ca(t,t.return,x)}if(e=t.sibling,e!==null){e.return=t.return,wr=e;break}wr=t.return}return h=iIe,iIe=!1,h}function MT(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&e)===e){var i=o.destroy;o.destroy=void 0,i!==void 0&&y$(t,r,i)}o=o.next}while(o!==n)}}function pF(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function v$(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function XAe(e){var t=e.alternate;t!==null&&(e.alternate=null,XAe(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Mh],delete t[$T],delete t[o$],delete t[Oit],delete t[Vit])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function YAe(e){return e.tag===5||e.tag===3||e.tag===4}function sIe(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||YAe(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function b$(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=HN));else if(n!==4&&(e=e.child,e!==null))for(b$(e,t,r),e=e.sibling;e!==null;)b$(e,t,r),e=e.sibling}function x$(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(x$(e,t,r),e=e.sibling;e!==null;)x$(e,t,r),e=e.sibling}var fc=null,vf=!1;function Dv(e,t,r){for(r=r.child;r!==null;)QAe(e,t,r),r=r.sibling}function QAe(e,t,r){if(Rh&&typeof Rh.onCommitFiberUnmount=="function")try{Rh.onCommitFiberUnmount(iF,r)}catch{}switch(r.tag){case 5:qc||JI(r,t);case 6:var n=fc,o=vf;fc=null,Dv(e,t,r),fc=n,vf=o,fc!==null&&(vf?(e=fc,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):fc.removeChild(r.stateNode));break;case 18:fc!==null&&(vf?(e=fc,r=r.stateNode,e.nodeType===8?I7(e.parentNode,r):e.nodeType===1&&I7(e,r),GT(e)):I7(fc,r.stateNode));break;case 4:n=fc,o=vf,fc=r.stateNode.containerInfo,vf=!0,Dv(e,t,r),fc=n,vf=o;break;case 0:case 11:case 14:case 15:if(!qc&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var i=o,s=i.destroy;i=i.tag,s!==void 0&&(i&2||i&4)&&y$(r,t,s),o=o.next}while(o!==n)}Dv(e,t,r);break;case 1:if(!qc&&(JI(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){ca(r,t,a)}Dv(e,t,r);break;case 21:Dv(e,t,r);break;case 22:r.mode&1?(qc=(n=qc)||r.memoizedState!==null,Dv(e,t,r),qc=n):Dv(e,t,r);break;default:Dv(e,t,r)}}function aIe(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new tst),t.forEach(function(n){var o=dst.bind(null,e,n);r.has(n)||(r.add(n),n.then(o,o))})}}function gf(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var i=e,s=t,a=s;e:for(;a!==null;){switch(a.tag){case 5:fc=a.stateNode,vf=!1;break e;case 3:fc=a.stateNode.containerInfo,vf=!0;break e;case 4:fc=a.stateNode.containerInfo,vf=!0;break e}a=a.return}if(fc===null)throw Error(Zt(160));QAe(i,s,o),fc=null,vf=!1;var l=o.alternate;l!==null&&(l.return=null),o.return=null}catch(c){ca(o,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)JAe(t,e),t=t.sibling}function JAe(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gf(t,e),Dh(e),n&4){try{MT(3,e,e.return),pF(3,e)}catch(f){ca(e,e.return,f)}try{MT(5,e,e.return)}catch(f){ca(e,e.return,f)}}break;case 1:gf(t,e),Dh(e),n&512&&r!==null&&JI(r,r.return);break;case 5:if(gf(t,e),Dh(e),n&512&&r!==null&&JI(r,r.return),e.flags&32){var o=e.stateNode;try{NT(o,"")}catch(f){ca(e,e.return,f)}}if(n&4&&(o=e.stateNode,o!=null)){var i=e.memoizedProps,s=r!==null?r.memoizedProps:i,a=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&CIe(o,i),j7(a,s);var c=j7(a,i);for(s=0;s<l.length;s+=2){var u=l[s],d=l[s+1];u==="style"?_Ie(o,d):u==="dangerouslySetInnerHTML"?AIe(o,d):u==="children"?NT(o,d):T$(o,u,d,c)}switch(a){case"input":V7(o,i);break;case"textarea":SIe(o,i);break;case"select":var m=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?tA(o,!!i.multiple,p,!1):m!==!!i.multiple&&(i.defaultValue!=null?tA(o,!!i.multiple,i.defaultValue,!0):tA(o,!!i.multiple,i.multiple?[]:"",!1))}o[$T]=i}catch(f){ca(e,e.return,f)}}break;case 6:if(gf(t,e),Dh(e),n&4){if(e.stateNode===null)throw Error(Zt(162));o=e.stateNode,i=e.memoizedProps;try{o.nodeValue=i}catch(f){ca(e,e.return,f)}}break;case 3:if(gf(t,e),Dh(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{GT(t.containerInfo)}catch(f){ca(e,e.return,f)}break;case 4:gf(t,e),Dh(e);break;case 13:gf(t,e),Dh(e),o=e.child,o.flags&8192&&(i=o.memoizedState!==null,o.stateNode.isHidden=i,!i||o.alternate!==null&&o.alternate.memoizedState!==null||(sW=Aa())),n&4&&aIe(e);break;case 22:if(u=r!==null&&r.memoizedState!==null,e.mode&1?(qc=(c=qc)||u,gf(t,e),qc=c):gf(t,e),Dh(e),n&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!u&&e.mode&1)for(wr=e,u=e.child;u!==null;){for(d=wr=u;wr!==null;){switch(m=wr,p=m.child,m.tag){case 0:case 11:case 14:case 15:MT(4,m,m.return);break;case 1:JI(m,m.return);var h=m.stateNode;if(typeof h.componentWillUnmount=="function"){n=m,r=m.return;try{t=n,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(f){ca(n,r,f)}}break;case 5:JI(m,m.return);break;case 22:if(m.memoizedState!==null){cIe(d);continue}}p!==null?(p.return=m,wr=p):cIe(d)}u=u.sibling}e:for(u=null,d=e;;){if(d.tag===5){if(u===null){u=d;try{o=d.stateNode,c?(i=o.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=wIe("display",s))}catch(f){ca(e,e.return,f)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(f){ca(e,e.return,f)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gf(t,e),Dh(e),n&4&&aIe(e);break;case 21:break;default:gf(t,e),Dh(e)}}function Dh(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(YAe(r)){var n=r;break e}r=r.return}throw Error(Zt(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(NT(o,""),n.flags&=-33);var i=sIe(e);x$(e,i,o);break;case 3:case 4:var s=n.stateNode.containerInfo,a=sIe(e);b$(e,a,s);break;default:throw Error(Zt(161))}}catch(l){ca(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function nst(e,t,r){wr=e,e2e(e,t,r)}function e2e(e,t,r){for(var n=(e.mode&1)!==0;wr!==null;){var o=wr,i=o.child;if(o.tag===22&&n){var s=o.memoizedState!==null||IN;if(!s){var a=o.alternate,l=a!==null&&a.memoizedState!==null||qc;a=IN;var c=qc;if(IN=s,(qc=l)&&!c)for(wr=o;wr!==null;)s=wr,l=s.child,s.tag===22&&s.memoizedState!==null?uIe(o):l!==null?(l.return=s,wr=l):uIe(o);for(;i!==null;)wr=i,e2e(i,t,r),i=i.sibling;wr=o,IN=a,qc=c}lIe(e,t,r)}else o.subtreeFlags&8772&&i!==null?(i.return=o,wr=i):lIe(e,t,r)}}function lIe(e){for(;wr!==null;){var t=wr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:qc||pF(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!qc)if(r===null)n.componentDidMount();else{var o=t.elementType===t.type?r.memoizedProps:yf(t.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&WSe(t,i,n);break;case 3:var s=t.updateQueue;if(s!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}WSe(t,s,r)}break;case 5:var a=t.stateNode;if(r===null&&t.flags&4){r=a;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&GT(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Zt(163))}qc||t.flags&512&&v$(t)}catch(m){ca(t,t.return,m)}}if(t===e){wr=null;break}if(r=t.sibling,r!==null){r.return=t.return,wr=r;break}wr=t.return}}function cIe(e){for(;wr!==null;){var t=wr;if(t===e){wr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,wr=r;break}wr=t.return}}function uIe(e){for(;wr!==null;){var t=wr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{pF(4,t)}catch(l){ca(t,r,l)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var o=t.return;try{n.componentDidMount()}catch(l){ca(t,o,l)}}var i=t.return;try{v$(t)}catch(l){ca(t,i,l)}break;case 5:var s=t.return;try{v$(t)}catch(l){ca(t,s,l)}}}catch(l){ca(t,t.return,l)}if(t===e){wr=null;break}var a=t.sibling;if(a!==null){a.return=t.return,wr=a;break}wr=t.return}}var ost=Math.ceil,eF=c0.ReactCurrentDispatcher,oW=c0.ReactCurrentOwner,gp=c0.ReactCurrentBatchConfig,Uo=0,Xl=null,qa=null,hc=0,jd=0,eA=Zv(0),cl=0,YT=null,nx=0,fF=0,iW=0,RT=null,dd=null,sW=0,pA=1/0,e0=null,tF=!1,C$=null,zv=null,AN=!1,Nv=null,rF=0,BT=0,S$=null,MN=-1,RN=0;function xu(){return Uo&6?Aa():MN!==-1?MN:MN=Aa()}function Hv(e){return e.mode&1?Uo&2&&hc!==0?hc&-hc:Uit.transition!==null?(RN===0&&(RN=OIe()),RN):(e=Pi,e!==0||(e=window.event,e=e===void 0?16:$Ie(e.type)),e):1}function Cf(e,t,r,n){if(50<BT)throw BT=0,S$=null,Error(Zt(185));QT(e,r,n),(!(Uo&2)||e!==Xl)&&(e===Xl&&(!(Uo&2)&&(fF|=r),cl===4&&Bv(e,hc)),hd(e,n),r===1&&Uo===0&&!(t.mode&1)&&(pA=Aa()+500,uF&&Kv()))}function hd(e,t){var r=e.callbackNode;Hot(e,t);var n=VN(e,e===Xl?hc:0);if(n===0)r!==null&&vSe(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&vSe(r),t===1)e.tag===0?Git(dIe.bind(null,e)):uAe(dIe.bind(null,e)),Nit(function(){!(Uo&6)&&Kv()}),r=null;else{switch(VIe(n)){case 1:r=M$;break;case 4:r=NIe;break;case 16:r=ON;break;case 536870912:r=FIe;break;default:r=ON}r=l2e(r,t2e.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function t2e(e,t){if(MN=-1,RN=0,Uo&6)throw Error(Zt(327));var r=e.callbackNode;if(sA()&&e.callbackNode!==r)return null;var n=VN(e,e===Xl?hc:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=nF(e,n);else{t=n;var o=Uo;Uo|=2;var i=n2e();(Xl!==e||hc!==t)&&(e0=null,pA=Aa()+500,Q1(e,t));do try{ast();break}catch(a){r2e(e,a)}while(!0);$$(),eF.current=i,Uo=o,qa!==null?t=0:(Xl=null,hc=0,t=cl)}if(t!==0){if(t===2&&(o=K7(e),o!==0&&(n=o,t=I$(e,o))),t===1)throw r=YT,Q1(e,0),Bv(e,n),hd(e,Aa()),r;if(t===6)Bv(e,n);else{if(o=e.current.alternate,!(n&30)&&!ist(o)&&(t=nF(e,n),t===2&&(i=K7(e),i!==0&&(n=i,t=I$(e,i))),t===1))throw r=YT,Q1(e,0),Bv(e,n),hd(e,Aa()),r;switch(e.finishedWork=o,e.finishedLanes=n,t){case 0:case 1:throw Error(Zt(345));case 2:Z1(e,dd,e0);break;case 3:if(Bv(e,n),(n&130023424)===n&&(t=sW+500-Aa(),10<t)){if(VN(e,0)!==0)break;if(o=e.suspendedLanes,(o&n)!==n){xu(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=n$(Z1.bind(null,e,dd,e0),t);break}Z1(e,dd,e0);break;case 4:if(Bv(e,n),(n&4194240)===n)break;for(t=e.eventTimes,o=-1;0<n;){var s=31-xf(n);i=1<<s,s=t[s],s>o&&(o=s),n&=~i}if(n=o,n=Aa()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*ost(n/1960))-n,10<n){e.timeoutHandle=n$(Z1.bind(null,e,dd,e0),n);break}Z1(e,dd,e0);break;case 5:Z1(e,dd,e0);break;default:throw Error(Zt(329))}}}return hd(e,Aa()),e.callbackNode===r?t2e.bind(null,e):null}function I$(e,t){var r=RT;return e.current.memoizedState.isDehydrated&&(Q1(e,t).flags|=256),e=nF(e,t),e!==2&&(t=dd,dd=r,t!==null&&A$(t)),e}function A$(e){dd===null?dd=e:dd.push.apply(dd,e)}function ist(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],i=o.getSnapshot;o=o.value;try{if(!Sf(i(),o))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Bv(e,t){for(t&=~iW,t&=~fF,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-xf(t),n=1<<r;e[r]=-1,t&=~n}}function dIe(e){if(Uo&6)throw Error(Zt(327));sA();var t=VN(e,0);if(!(t&1))return hd(e,Aa()),null;var r=nF(e,t);if(e.tag!==0&&r===2){var n=K7(e);n!==0&&(t=n,r=I$(e,n))}if(r===1)throw r=YT,Q1(e,0),Bv(e,t),hd(e,Aa()),r;if(r===6)throw Error(Zt(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Z1(e,dd,e0),hd(e,Aa()),null}function aW(e,t){var r=Uo;Uo|=1;try{return e(t)}finally{Uo=r,Uo===0&&(pA=Aa()+500,uF&&Kv())}}function ox(e){Nv!==null&&Nv.tag===0&&!(Uo&6)&&sA();var t=Uo;Uo|=1;var r=gp.transition,n=Pi;try{if(gp.transition=null,Pi=1,e)return e()}finally{Pi=n,gp.transition=r,Uo=t,!(Uo&6)&&Kv()}}function lW(){jd=eA.current,fs(eA)}function Q1(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Lit(r)),qa!==null)for(r=qa.return;r!==null;){var n=r;switch(z$(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&jN();break;case 3:dA(),fs(pd),fs(Zc),Y$();break;case 5:X$(n);break;case 4:dA();break;case 13:fs(Zs);break;case 19:fs(Zs);break;case 10:W$(n.type._context);break;case 22:case 23:lW()}r=r.return}if(Xl=e,qa=e=jv(e.current,null),hc=jd=t,cl=0,YT=null,iW=fF=nx=0,dd=RT=null,X1!==null){for(t=0;t<X1.length;t++)if(r=X1[t],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,i=r.pending;if(i!==null){var s=i.next;i.next=o,n.next=s}r.pending=n}X1=null}return e}function r2e(e,t){do{var r=qa;try{if($$(),PN.current=JN,QN){for(var n=Ks.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}QN=!1}if(rx=0,Kl=ll=Ks=null,kT=!1,ZT=0,oW.current=null,r===null||r.return===null){cl=1,YT=t,qa=null;break}e:{var i=e,s=r.return,a=r,l=t;if(t=hc,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=QSe(s);if(p!==null){p.flags&=-257,JSe(p,s,a,i,t),p.mode&1&&YSe(i,c,t),t=p,l=c;var h=t.updateQueue;if(h===null){var f=new Set;f.add(l),t.updateQueue=f}else h.add(l);break e}else{if(!(t&1)){YSe(i,c,t),cW();break e}l=Error(Zt(426))}}else if(Ds&&a.mode&1){var C=QSe(s);if(C!==null){!(C.flags&65536)&&(C.flags|=256),JSe(C,s,a,i,t),H$(mA(l,a));break e}}i=l=mA(l,a),cl!==4&&(cl=2),RT===null?RT=[i]:RT.push(i),i=s;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var g=VAe(i,l,t);$Se(i,g);break e;case 1:a=l;var b=i.type,y=i.stateNode;if(!(i.flags&128)&&(typeof b.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(zv===null||!zv.has(y)))){i.flags|=65536,t&=-t,i.lanes|=t;var x=GAe(i,a,t);$Se(i,x);break e}}i=i.return}while(i!==null)}i2e(r)}catch(A){t=A,qa===r&&r!==null&&(qa=r=r.return);continue}break}while(!0)}function n2e(){var e=eF.current;return eF.current=JN,e===null?JN:e}function cW(){(cl===0||cl===3||cl===2)&&(cl=4),Xl===null||!(nx&268435455)&&!(fF&268435455)||Bv(Xl,hc)}function nF(e,t){var r=Uo;Uo|=2;var n=n2e();(Xl!==e||hc!==t)&&(e0=null,Q1(e,t));do try{sst();break}catch(o){r2e(e,o)}while(!0);if($$(),Uo=r,eF.current=n,qa!==null)throw Error(Zt(261));return Xl=null,hc=0,cl}function sst(){for(;qa!==null;)o2e(qa)}function ast(){for(;qa!==null&&!Bot();)o2e(qa)}function o2e(e){var t=a2e(e.alternate,e,jd);e.memoizedProps=e.pendingProps,t===null?i2e(e):qa=t,oW.current=null}function i2e(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=est(r,t),r!==null){r.flags&=32767,qa=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{cl=6,qa=null;return}}else if(r=Jit(r,t,jd),r!==null){qa=r;return}if(t=t.sibling,t!==null){qa=t;return}qa=t=e}while(t!==null);cl===0&&(cl=5)}function Z1(e,t,r){var n=Pi,o=gp.transition;try{gp.transition=null,Pi=1,lst(e,t,r,n)}finally{gp.transition=o,Pi=n}return null}function lst(e,t,r,n){do sA();while(Nv!==null);if(Uo&6)throw Error(Zt(327));r=e.finishedWork;var o=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Zt(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(jot(e,i),e===Xl&&(qa=Xl=null,hc=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||AN||(AN=!0,l2e(ON,function(){return sA(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=gp.transition,gp.transition=null;var s=Pi;Pi=1;var a=Uo;Uo|=4,oW.current=null,rst(e,r),JAe(r,e),Dit(t$),GN=!!e$,t$=e$=null,e.current=r,nst(r,e,o),Lot(),Uo=a,Pi=s,gp.transition=i}else e.current=r;if(AN&&(AN=!1,Nv=e,rF=o),i=e.pendingLanes,i===0&&(zv=null),Oot(r.stateNode,n),hd(e,Aa()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)o=t[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(tF)throw tF=!1,e=C$,C$=null,e;return rF&1&&e.tag!==0&&sA(),i=e.pendingLanes,i&1?e===S$?BT++:(BT=0,S$=e):BT=0,Kv(),null}function sA(){if(Nv!==null){var e=VIe(rF),t=gp.transition,r=Pi;try{if(gp.transition=null,Pi=16>e?16:e,Nv===null)var n=!1;else{if(e=Nv,Nv=null,rF=0,Uo&6)throw Error(Zt(331));var o=Uo;for(Uo|=4,wr=e.current;wr!==null;){var i=wr,s=i.child;if(wr.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(wr=c;wr!==null;){var u=wr;switch(u.tag){case 0:case 11:case 15:MT(8,u,i)}var d=u.child;if(d!==null)d.return=u,wr=d;else for(;wr!==null;){u=wr;var m=u.sibling,p=u.return;if(XAe(u),u===c){wr=null;break}if(m!==null){m.return=p,wr=m;break}wr=p}}}var h=i.alternate;if(h!==null){var f=h.child;if(f!==null){h.child=null;do{var C=f.sibling;f.sibling=null,f=C}while(f!==null)}}wr=i}}if(i.subtreeFlags&2064&&s!==null)s.return=i,wr=s;else e:for(;wr!==null;){if(i=wr,i.flags&2048)switch(i.tag){case 0:case 11:case 15:MT(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,wr=g;break e}wr=i.return}}var b=e.current;for(wr=b;wr!==null;){s=wr;var y=s.child;if(s.subtreeFlags&2064&&y!==null)y.return=s,wr=y;else e:for(s=b;wr!==null;){if(a=wr,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:pF(9,a)}}catch(A){ca(a,a.return,A)}if(a===s){wr=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,wr=x;break e}wr=a.return}}if(Uo=o,Kv(),Rh&&typeof Rh.onPostCommitFiberRoot=="function")try{Rh.onPostCommitFiberRoot(iF,e)}catch{}n=!0}return n}finally{Pi=r,gp.transition=t}}return!1}function mIe(e,t,r){t=mA(r,t),t=VAe(e,t,1),e=Uv(e,t,1),t=xu(),e!==null&&(QT(e,1,t),hd(e,t))}function ca(e,t,r){if(e.tag===3)mIe(e,e,r);else for(;t!==null;){if(t.tag===3){mIe(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(zv===null||!zv.has(n))){e=mA(r,e),e=GAe(t,e,1),t=Uv(t,e,1),e=xu(),t!==null&&(QT(t,1,e),hd(t,e));break}}t=t.return}}function cst(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=xu(),e.pingedLanes|=e.suspendedLanes&r,Xl===e&&(hc&r)===r&&(cl===4||cl===3&&(hc&130023424)===hc&&500>Aa()-sW?Q1(e,0):iW|=r),hd(e,t)}function s2e(e,t){t===0&&(e.mode&1?(t=uN,uN<<=1,!(uN&130023424)&&(uN=4194304)):t=1);var r=xu();e=a0(e,t),e!==null&&(QT(e,t,r),hd(e,r))}function ust(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),s2e(e,r)}function dst(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Zt(314))}n!==null&&n.delete(t),s2e(e,r)}var a2e;a2e=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||pd.current)md=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return md=!1,Qit(e,t,r);md=!!(e.flags&131072)}else md=!1,Ds&&t.flags&1048576&&dAe(t,qN,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;kN(e,t),e=t.pendingProps;var o=lA(t,Zc.current);iA(t,r),o=J$(null,t,n,e,o,r);var i=eW();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,fd(n)?(i=!0,$N(t)):i=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Z$(t),o.updater=mF,t.stateNode=o,o._reactInternals=t,u$(t,n,e,r),t=p$(null,t,n,!0,i,r)):(t.tag=0,Ds&&i&&U$(t),bu(null,t,o,r),t=t.child),t;case 16:n=t.elementType;e:{switch(kN(e,t),e=t.pendingProps,o=n._init,n=o(n._payload),t.type=n,o=t.tag=pst(n),e=yf(n,e),o){case 0:t=m$(null,t,n,e,r);break e;case 1:t=rIe(null,t,n,e,r);break e;case 11:t=eIe(null,t,n,e,r);break e;case 14:t=tIe(null,t,n,yf(n.type,e),r);break e}throw Error(Zt(306,n,""))}return t;case 0:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:yf(n,o),m$(e,t,n,o,r);case 1:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:yf(n,o),rIe(e,t,n,o,r);case 3:e:{if(jAe(t),e===null)throw Error(Zt(387));n=t.pendingProps,i=t.memoizedState,o=i.element,yAe(e,t),XN(t,n,null,r);var s=t.memoizedState;if(n=s.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){o=mA(Error(Zt(423)),t),t=nIe(e,t,n,r,o);break e}else if(n!==o){o=mA(Error(Zt(424)),t),t=nIe(e,t,n,r,o);break e}else for($d=Gv(t.stateNode.containerInfo.firstChild),Wd=t,Ds=!0,bf=null,r=hAe(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(cA(),n===o){t=l0(e,t,r);break e}bu(e,t,n,r)}t=t.child}return t;case 5:return vAe(t),e===null&&a$(t),n=t.type,o=t.pendingProps,i=e!==null?e.memoizedProps:null,s=o.children,r$(n,o)?s=null:i!==null&&r$(n,i)&&(t.flags|=32),HAe(e,t),bu(e,t,s,r),t.child;case 6:return e===null&&a$(t),null;case 13:return $Ae(e,t,r);case 4:return K$(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=uA(t,null,n,r):bu(e,t,n,r),t.child;case 11:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:yf(n,o),eIe(e,t,n,o,r);case 7:return bu(e,t,t.pendingProps,r),t.child;case 8:return bu(e,t,t.pendingProps.children,r),t.child;case 12:return bu(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,o=t.pendingProps,i=t.memoizedProps,s=o.value,Yi(ZN,n._currentValue),n._currentValue=s,i!==null)if(Sf(i.value,s)){if(i.children===o.children&&!pd.current){t=l0(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var a=i.dependencies;if(a!==null){s=i.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=o0(-1,r&-r),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),l$(i.return,r,t),a.lanes|=r;break}l=l.next}}else if(i.tag===10)s=i.type===t.type?null:i.child;else if(i.tag===18){if(s=i.return,s===null)throw Error(Zt(341));s.lanes|=r,a=s.alternate,a!==null&&(a.lanes|=r),l$(s,r,t),s=i.sibling}else s=i.child;if(s!==null)s.return=i;else for(s=i;s!==null;){if(s===t){s=null;break}if(i=s.sibling,i!==null){i.return=s.return,s=i;break}s=s.return}i=s}bu(e,t,o.children,r),t=t.child}return t;case 9:return o=t.type,n=t.pendingProps.children,iA(t,r),o=yp(o),n=n(o),t.flags|=1,bu(e,t,n,r),t.child;case 14:return n=t.type,o=yf(n,t.pendingProps),o=yf(n.type,o),tIe(e,t,n,o,r);case 15:return UAe(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:yf(n,o),kN(e,t),t.tag=1,fd(n)?(e=!0,$N(t)):e=!1,iA(t,r),OAe(t,n,o),u$(t,n,o,r),p$(null,t,n,!0,e,r);case 19:return WAe(e,t,r);case 22:return zAe(e,t,r)}throw Error(Zt(156,t.tag))};function l2e(e,t){return LIe(e,t)}function mst(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hp(e,t,r,n){return new mst(e,t,r,n)}function uW(e){return e=e.prototype,!(!e||!e.isReactComponent)}function pst(e){if(typeof e=="function")return uW(e)?1:0;if(e!=null){if(e=e.$$typeof,e===P$)return 11;if(e===D$)return 14}return 2}function jv(e,t){var r=e.alternate;return r===null?(r=hp(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function BN(e,t,r,n,o,i){var s=2;if(n=e,typeof e=="function")uW(e)&&(s=1);else if(typeof e=="string")s=5;else e:switch(e){case jI:return J1(r.children,o,i,t);case E$:s=8,o|=8;break;case B7:return e=hp(12,r,t,o|2),e.elementType=B7,e.lanes=i,e;case L7:return e=hp(13,r,t,o),e.elementType=L7,e.lanes=i,e;case N7:return e=hp(19,r,t,o),e.elementType=N7,e.lanes=i,e;case vIe:return hF(r,o,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case gIe:s=10;break e;case yIe:s=9;break e;case P$:s=11;break e;case D$:s=14;break e;case kv:s=16,n=null;break e}throw Error(Zt(130,e==null?e:typeof e,""))}return t=hp(s,r,t,o),t.elementType=e,t.type=n,t.lanes=i,t}function J1(e,t,r,n){return e=hp(7,e,n,t),e.lanes=r,e}function hF(e,t,r,n){return e=hp(22,e,n,t),e.elementType=vIe,e.lanes=r,e.stateNode={isHidden:!1},e}function k7(e,t,r){return e=hp(6,e,null,t),e.lanes=r,e}function M7(e,t,r){return t=hp(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function fst(e,t,r,n,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=h7(0),this.expirationTimes=h7(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=h7(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function dW(e,t,r,n,o,i,s,a,l){return e=new fst(e,t,r,a,l),t===1?(t=1,i===!0&&(t|=8)):t=0,i=hp(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Z$(i),e}function hst(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:HI,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function c2e(e){if(!e)return Wv;e=e._reactInternals;e:{if(sx(e)!==e||e.tag!==1)throw Error(Zt(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(fd(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Zt(171))}if(e.tag===1){var r=e.type;if(fd(r))return cAe(e,r,t)}return t}function u2e(e,t,r,n,o,i,s,a,l){return e=dW(r,n,!0,e,o,i,s,a,l),e.context=c2e(null),r=e.current,n=xu(),o=Hv(r),i=o0(n,o),i.callback=t??null,Uv(r,i,o),e.current.lanes=o,QT(e,o,n),hd(e,n),e}function gF(e,t,r,n){var o=t.current,i=xu(),s=Hv(o);return r=c2e(r),t.context===null?t.context=r:t.pendingContext=r,t=o0(i,s),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Uv(o,t,s),e!==null&&(Cf(e,o,s,i),EN(e,o,s)),s}function oF(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function pIe(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function mW(e,t){pIe(e,t),(e=e.alternate)&&pIe(e,t)}function gst(){return null}var d2e=typeof reportError=="function"?reportError:function(e){};function pW(e){this._internalRoot=e}yF.prototype.render=pW.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Zt(409));gF(e,t,null,null)};yF.prototype.unmount=pW.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ox(function(){gF(null,e,null,null)}),t[s0]=null}};function yF(e){this._internalRoot=e}yF.prototype.unstable_scheduleHydration=function(e){if(e){var t=zIe();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Rv.length&&t!==0&&t<Rv[r].priority;r++);Rv.splice(r,0,e),r===0&&jIe(e)}};function fW(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function vF(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function fIe(){}function yst(e,t,r,n,o){if(o){if(typeof n=="function"){var i=n;n=function(){var c=oF(s);i.call(c)}}var s=u2e(t,n,e,0,null,!1,!1,"",fIe);return e._reactRootContainer=s,e[s0]=s.current,HT(e.nodeType===8?e.parentNode:e),ox(),s}for(;o=e.lastChild;)e.removeChild(o);if(typeof n=="function"){var a=n;n=function(){var c=oF(l);a.call(c)}}var l=dW(e,0,!1,null,null,!1,!1,"",fIe);return e._reactRootContainer=l,e[s0]=l.current,HT(e.nodeType===8?e.parentNode:e),ox(function(){gF(t,l,r,n)}),l}function bF(e,t,r,n,o){var i=r._reactRootContainer;if(i){var s=i;if(typeof o=="function"){var a=o;o=function(){var l=oF(s);a.call(l)}}gF(t,s,e,o)}else s=yst(r,t,e,o,n);return oF(s)}GIe=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=AT(t.pendingLanes);r!==0&&(R$(t,r|1),hd(t,Aa()),!(Uo&6)&&(pA=Aa()+500,Kv()))}break;case 13:ox(function(){var n=a0(e,1);if(n!==null){var o=xu();Cf(n,e,1,o)}}),mW(e,1)}};B$=function(e){if(e.tag===13){var t=a0(e,134217728);if(t!==null){var r=xu();Cf(t,e,134217728,r)}mW(e,134217728)}};UIe=function(e){if(e.tag===13){var t=Hv(e),r=a0(e,t);if(r!==null){var n=xu();Cf(r,e,t,n)}mW(e,t)}};zIe=function(){return Pi};HIe=function(e,t){var r=Pi;try{return Pi=e,t()}finally{Pi=r}};W7=function(e,t,r){switch(t){case"input":if(V7(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var o=cF(n);if(!o)throw Error(Zt(90));xIe(n),V7(n,o)}}}break;case"textarea":SIe(e,r);break;case"select":t=r.value,t!=null&&tA(e,!!r.multiple,t,!1)}};PIe=aW;DIe=ox;var vst={usingClientEntryPoint:!1,Events:[eE,ZI,cF,TIe,EIe,aW]},xT={findFiberByHostInstance:K1,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},bst={bundleType:xT.bundleType,version:xT.version,rendererPackageName:xT.rendererPackageName,rendererConfig:xT.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:c0.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=RIe(e),e===null?null:e.stateNode},findFiberByHostInstance:xT.findFiberByHostInstance||gst,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(CT=__REACT_DEVTOOLS_GLOBAL_HOOK__,!CT.isDisabled&&CT.supportsFiber))try{iF=CT.inject(bst),Rh=CT}catch{}var CT;Kd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vst;Kd.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fW(t))throw Error(Zt(200));return hst(e,t,null,r)};Kd.createRoot=function(e,t){if(!fW(e))throw Error(Zt(299));var r=!1,n="",o=d2e;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=dW(e,1,!1,null,null,r,!1,n,o),e[s0]=t.current,HT(e.nodeType===8?e.parentNode:e),new pW(t)};Kd.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Zt(188)):(e=Object.keys(e).join(","),Error(Zt(268,e)));return e=RIe(t),e=e===null?null:e.stateNode,e};Kd.flushSync=function(e){return ox(e)};Kd.hydrate=function(e,t,r){if(!vF(t))throw Error(Zt(200));return bF(null,e,t,!0,r)};Kd.hydrateRoot=function(e,t,r){if(!fW(e))throw Error(Zt(405));var n=r!=null&&r.hydratedSources||null,o=!1,i="",s=d2e;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(s=r.onRecoverableError)),t=u2e(t,null,e,1,r??null,o,!1,i,s),e[s0]=t.current,HT(e),n)for(e=0;e<n.length;e++)r=n[e],o=r._getVersion,o=o(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,o]:t.mutableSourceEagerHydrationData.push(r,o);return new yF(t)};Kd.render=function(e,t,r){if(!vF(t))throw Error(Zt(200));return bF(null,e,t,!1,r)};Kd.unmountComponentAtNode=function(e){if(!vF(e))throw Error(Zt(40));return e._reactRootContainer?(ox(function(){bF(null,null,e,!1,function(){e._reactRootContainer=null,e[s0]=null})}),!0):!1};Kd.unstable_batchedUpdates=aW;Kd.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!vF(r))throw Error(Zt(200));if(e==null||e._reactInternals===void 0)throw Error(Zt(38));return bF(e,t,r,!1,n)};Kd.version="18.3.1-next-f1338f8080-20240426"});var hW=Iu((Zrn,f2e)=>{"use strict";function p2e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(p2e)}catch{}}p2e(),f2e.exports=m2e()});var g2e=Iu(gW=>{"use strict";var h2e=hW();gW.createRoot=h2e.createRoot,gW.hydrateRoot=h2e.hydrateRoot;var Krn});var awe=Iu((zF,EW)=>{"use strict";(function(e,t){typeof zF=="object"&&typeof EW=="object"?EW.exports=t():typeof define=="function"&&define.amd?define([],t):typeof zF=="object"?zF.JSONEditor=t():e.JSONEditor=t()})(self,function(){return t={6545:function(n,o,i){"use strict";i.d(o,{t:function(){return d}});var s=i(1925),a=i(6237),l=i(3057);function c(m){return(c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p})(m)}function u(m,p){for(var h=0;h<p.length;h++){var f=p[h];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(m,function(C){return C=function(g,b){if(c(g)!="object"||!g)return g;var y=g[Symbol.toPrimitive];if(y===void 0)return(b==="string"?String:Number)(g);if(y=y.call(g,b||"default"),c(y)!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}(C,"string"),c(C)=="symbol"?C:C+""}(f.key),f)}}var d=function(){function m(C,y){if(!(this instanceof m))throw new TypeError("Cannot call a class as a function");this.dom={};var b=this,A=this.dom,y=(this.anchor=void 0,this.items=C,this.eventListeners={},this.selection=void 0,this.onClose=y?y.close:void 0,this.limitHeight=!!y&&y.limitHeight,document.createElement("div")),x=(y.className="jsoneditor-contextmenu-root",A.root=y,document.createElement("div")),y=(x.className="jsoneditor-contextmenu",A.menu=x,y.appendChild(x),document.createElement("ul")),x=(y.className="jsoneditor-menu",x.appendChild(y),A.list=y,A.items=[],document.createElement("button")),A=(x.type="button",A.focusButton=x,document.createElement("li"));A.style.overflow="hidden",A.style.height="0",A.appendChild(x),y.appendChild(A),function v(_,I,T){T.forEach(function(E){var w,S,P,k,L,R;E.type==="separator"?((L=document.createElement("div")).className="jsoneditor-separator",(S=document.createElement("li")).appendChild(L),_.appendChild(S)):(w={},L=document.createElement("li"),_.appendChild(L),(S=document.createElement("button")).type="button",S.className=E.className,w.button=S,E.title&&(S.title=E.title),E.click&&(S.onclick=function(N){N.preventDefault(),b.hide(),E.click()}),L.appendChild(S),E.submenu?((k=document.createElement("div")).className="jsoneditor-icon",S.appendChild(k),(k=document.createElement("div")).className="jsoneditor-text"+(E.click?"":" jsoneditor-right-margin"),k.appendChild(document.createTextNode(E.text)),S.appendChild(k),(P=E.click?(S.className+=" jsoneditor-default",(k=document.createElement("button")).type="button",(w.buttonExpand=k).className="jsoneditor-expand",(R=document.createElement("div")).className="jsoneditor-expand",k.appendChild(R),L.appendChild(k),E.submenuTitle&&(k.title=E.submenuTitle),k):((R=document.createElement("div")).className="jsoneditor-expand",S.appendChild(R),S)).onclick=function(N){N.preventDefault(),b._onExpandItem(w),P.focus()},w.subItems=k=[],R=document.createElement("ul"),(w.ul=R).className="jsoneditor-menu",R.style.height="0",L.appendChild(R),v(R,k,E.submenu)):((L=document.createElement("div")).className="jsoneditor-icon",S.appendChild(L),(R=document.createElement("div")).className="jsoneditor-text",R.appendChild(document.createTextNode((0,l.Tl)(E.text))),S.appendChild(R)),I.push(w))})}(y,this.dom.items,C),this.maxHeight=0,C.forEach(function(v){v=24*(C.length+(v.submenu?v.submenu.length:0)),b.maxHeight=Math.max(b.maxHeight,v)})}return p=m,(h=[{key:"_getVisibleButtons",value:function(){var C=[],g=this;return this.dom.items.forEach(function(b){C.push(b.button),b.buttonExpand&&C.push(b.buttonExpand),b.subItems&&b===g.expandedItem&&b.subItems.forEach(function(y){C.push(y.button),y.buttonExpand&&C.push(y.buttonExpand)})}),C}},{key:"show",value:function(C,I,b){this.hide();var y=!0,A=C.parentNode,x=C.getBoundingClientRect(),A=A.getBoundingClientRect(),v=I.getBoundingClientRect(),_=this,I=(this.dom.absoluteAnchor=(0,s.p)(C,I,function(){_.hide()}),x.bottom+this.maxHeight<v.bottom||x.top-this.maxHeight>v.top&&(y=!1),b?0:x.top-A.top);y?(b=C.offsetHeight,this.dom.menu.style.left="0",this.dom.menu.style.top=I+b+"px",this.dom.menu.style.bottom=""):(this.dom.menu.style.left="0",this.dom.menu.style.top="",this.dom.menu.style.bottom="0px"),this.limitHeight&&(A=y?v.bottom-x.bottom-10:x.top-v.top-10,this.dom.list.style.maxHeight=A+"px",this.dom.list.style.overflowY="auto"),this.dom.absoluteAnchor.appendChild(this.dom.root),this.selection=(0,a.getSelection)(),this.anchor=C,setTimeout(function(){_.dom.focusButton.focus()},0),m.visibleMenu&&m.visibleMenu.hide(),m.visibleMenu=this}},{key:"hide",value:function(){this.dom.absoluteAnchor&&(this.dom.absoluteAnchor.destroy(),delete this.dom.absoluteAnchor),this.dom.root.parentNode&&(this.dom.root.parentNode.removeChild(this.dom.root),this.onClose)&&this.onClose(),m.visibleMenu===this&&(m.visibleMenu=void 0)}},{key:"_onExpandItem",value:function(C){var g,b=this,y=C===this.expandedItem,x=this.expandedItem;x&&(x.ul.style.height="0",x.ul.style.padding="",setTimeout(function(){b.expandedItem!==x&&(x.ul.style.display="",a.removeClassName)(x.ul.parentNode,"jsoneditor-selected")},300),this.expandedItem=void 0),y||((g=C.ul).style.display="block",g.clientHeight,setTimeout(function(){if(b.expandedItem===C){for(var A=0,v=0;v<g.childNodes.length;v++)A+=g.childNodes[v].clientHeight;g.style.height=A+"px",g.style.padding="5px 10px"}},0),(0,a.addClassName)(g.parentNode,"jsoneditor-selected"),this.expandedItem=C)}},{key:"_onKeyDown",value:function(C){var g,b,y,x,A=C.target,v=C.which,_=!1;v===27?(this.selection&&(0,a.setSelection)(this.selection),this.anchor&&this.anchor.focus(),this.hide(),_=!0):v===9?C.shiftKey?(b=(g=this._getVisibleButtons()).indexOf(A))===0&&(g[g.length-1].focus(),_=!0):(b=(g=this._getVisibleButtons()).indexOf(A))===g.length-1&&(g[0].focus(),_=!0):v===37?(A.className==="jsoneditor-expand"&&(b=(g=this._getVisibleButtons()).indexOf(A),y=g[b-1])&&y.focus(),_=!0):v===38?(b=(g=this._getVisibleButtons()).indexOf(A),(y=(y=(y=g[b-1])&&y.className==="jsoneditor-expand"?g[b-2]:y)||g[g.length-1])&&y.focus(),_=!0):v===39?(b=(g=this._getVisibleButtons()).indexOf(A),(x=g[b+1])&&x.className==="jsoneditor-expand"&&x.focus(),_=!0):v===40&&(b=(g=this._getVisibleButtons()).indexOf(A),(x=(x=(x=g[b+1])&&x.className==="jsoneditor-expand"?g[b+2]:x)||g[0])&&(x.focus(),_=!0),_=!0),_&&(C.stopPropagation(),C.preventDefault())}}])&&u(p.prototype,h),f&&u(p,f),Object.defineProperty(p,"prototype",{writable:!1}),p;var p,h,f}();d.visibleMenu=void 0},2115:function(n,o,i){"use strict";function s(c){return(s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u})(c)}function a(c,u){for(var d=0;d<u.length;d++){var m=u[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(c,function(p){return p=function(h,f){if(s(h)!="object"||!h)return h;var C=h[Symbol.toPrimitive];if(C===void 0)return(f==="string"?String:Number)(h);if(C=C.call(h,f||"default"),s(C)!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}(p,"string"),s(p)=="symbol"?p:p+""}(m.key),m)}}i.d(o,{N:function(){return l}});var l=function(){function c(h){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.errorTableVisible=h.errorTableVisible,this.onToggleVisibility=h.onToggleVisibility,this.onFocusLine=h.onFocusLine||function(){},this.onChangeHeight=h.onChangeHeight,this.dom={};var h=document.createElement("div"),f=(h.className="jsoneditor-validation-errors-container",this.dom.validationErrorsContainer=h,document.createElement("div")),h=(f.style.display="none",f.className="jsoneditor-additional-errors fadein",f.textContent="Scroll for more \u25BF",this.dom.additionalErrorsIndication=f,h.appendChild(f),document.createElement("span")),f=(h.className="jsoneditor-validation-error-icon",h.style.display="none",this.dom.validationErrorIcon=h,document.createElement("span"));f.className="jsoneditor-validation-error-count",f.style.display="none",this.dom.validationErrorCount=f,this.dom.parseErrorIndication=document.createElement("span"),this.dom.parseErrorIndication.className="jsoneditor-parse-error-icon",this.dom.parseErrorIndication.style.display="none"}return u=c,(d=[{key:"getErrorTable",value:function(){return this.dom.validationErrorsContainer}},{key:"getErrorCounter",value:function(){return this.dom.validationErrorCount}},{key:"getWarningIcon",value:function(){return this.dom.validationErrorIcon}},{key:"getErrorIcon",value:function(){return this.dom.parseErrorIndication}},{key:"toggleTableVisibility",value:function(){this.errorTableVisible=!this.errorTableVisible,this.onToggleVisibility(this.errorTableVisible)}},{key:"setErrors",value:function(p,h){var f,C,g=this,b=(this.dom.validationErrors&&(this.dom.validationErrors.parentNode.removeChild(this.dom.validationErrors),this.dom.validationErrors=null,this.dom.additionalErrorsIndication.style.display="none"),this.errorTableVisible&&0<p.length?((b=document.createElement("div")).className="jsoneditor-validation-errors",(C=document.createElement("table")).className="jsoneditor-text-errors",b.appendChild(C),f=document.createElement("tbody"),C.appendChild(f),p.forEach(function(y){isNaN(y.line)?y.dataPath&&(A=h.find(function(I){return I.path===y.dataPath}))&&(x=A.line+1):x=y.line;var x,A=document.createElement("tr"),v=(A.className=isNaN(x)?"":"jump-to-line",y.type==="error"?A.className+=" parse-error":A.className+=" validation-error",document.createElement("td")),_=document.createElement("button"),_=(_.className="jsoneditor-schema-error",v.appendChild(_),A.appendChild(v),document.createElement("td"));_.style="white-space: nowrap;",_.textContent=isNaN(x)?"":"Ln "+x,A.appendChild(_),typeof y=="string"?((v=document.createElement("td")).colSpan=2,(_=document.createElement("pre")).appendChild(document.createTextNode(y)),v.appendChild(_),A.appendChild(v)):((_=document.createElement("td")).appendChild(document.createTextNode(y.dataPath||"")),A.appendChild(_),v=document.createElement("td"),(_=document.createElement("pre")).appendChild(document.createTextNode(y.message.replace(/<br>/gi,`
`))),v.appendChild(_),A.appendChild(v)),A.onclick=function(){g.onFocusLine(x)},f.appendChild(A)}),this.dom.validationErrors=b,this.dom.validationErrorsContainer.appendChild(b),this.dom.additionalErrorsIndication.title=p.length+" errors total",this.dom.validationErrorsContainer.clientHeight<this.dom.validationErrorsContainer.scrollHeight?(this.dom.additionalErrorsIndication.style.display="block",this.dom.validationErrorsContainer.onscroll=function(){g.dom.additionalErrorsIndication.style.display=0<g.dom.validationErrorsContainer.clientHeight&&g.dom.validationErrorsContainer.scrollTop===0?"block":"none"}):this.dom.validationErrorsContainer.onscroll=void 0,C=this.dom.validationErrorsContainer.clientHeight+(this.dom.statusBar?this.dom.statusBar.clientHeight:0),this.onChangeHeight(C)):this.onChangeHeight(0),p.filter(function(y){return y.type!=="error"}).length);0<b?(this.dom.validationErrorCount.style.display="inline",this.dom.validationErrorCount.innerText=b,this.dom.validationErrorCount.onclick=this.toggleTableVisibility.bind(this),this.dom.validationErrorIcon.style.display="inline",this.dom.validationErrorIcon.title=b+" schema validation error(s) found",this.dom.validationErrorIcon.onclick=this.toggleTableVisibility.bind(this)):(this.dom.validationErrorCount.style.display="none",this.dom.validationErrorIcon.style.display="none"),p.some(function(y){return y.type==="error"})?(C=p[0].line,this.dom.parseErrorIndication.style.display="block",this.dom.parseErrorIndication.title=isNaN(C)?"parse error - check that the json is valid":"parse error on line "+C,this.dom.parseErrorIndication.onclick=this.toggleTableVisibility.bind(this)):this.dom.parseErrorIndication.style.display="none"}}])&&a(u.prototype,d),m&&a(u,m),Object.defineProperty(u,"prototype",{writable:!1}),u;var u,d,m}()},2877:function(n,o,i){"use strict";function s(c){return(s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u})(c)}function a(c,u){for(var d=0;d<u.length;d++){var m=u[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(c,function(p){return p=function(h,f){if(s(h)!="object"||!h)return h;var C=h[Symbol.toPrimitive];if(C===void 0)return(f==="string"?String:Number)(h);if(C=C.call(h,f||"default"),s(C)!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}(p,"string"),s(p)=="symbol"?p:p+""}(m.key),m)}}i.d(o,{$:function(){return l}});var l=function(){function c(p){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");if(this.target=p.target||null,!this.target)throw new Error('FocusTracker constructor called without a "target" to track.');this.onFocus=typeof p.onFocus=="function"?p.onFocus:null,this.onBlur=typeof p.onBlur=="function"?p.onBlur:null,this._onClick=this._onEvent.bind(this),this._onKeyUp=(function(h){h.which!==9&&h.keyCode!==9||this._onEvent(h)}).bind(this),this._onBlur=this._onEvent.bind(this),this.focusFlag=!1,this.firstEventFlag=!0,(this.onFocus||this.onBlur)&&(document.addEventListener("click",this._onClick),document.addEventListener("keyup",this._onKeyUp),document.addEventListener("blur",this._onBlur))}return u=c,(d=[{key:"destroy",value:function(){document.removeEventListener("click",this._onClick),document.removeEventListener("keyup",this._onKeyUp),document.removeEventListener("blur",this._onBlur),this._onEvent({target:document.body})}},{key:"_onEvent",value:function(p){p=p.target,p=p===this.target||!(!this.target.contains(p)&&!this.target.contains(document.activeElement)),p?this.focusFlag||(this.onFocus&&this.onFocus({type:"focus",target:this.target}),this.focusFlag=!0):(this.focusFlag||this.firstEventFlag)&&(this.onBlur&&this.onBlur({type:"blur",target:this.target}),this.focusFlag=!1,this.firstEventFlag)&&(this.firstEventFlag=!1)}}])&&a(u.prototype,d),m&&a(u,m),Object.defineProperty(u,"prototype",{writable:!1}),u;var u,d,m}()},1346:function(n,o,i){"use strict";var s=i(7413),a=i(1746),l=i(5633).treeModeMixins,c=i(1948).textModeMixins,u=i(7483).previewModeMixins,C=i(6237),d=C.clear,m=C.extend,p=C.getInnerText,h=C.getInternetExplorerVersion,f=C.parse,C=i(2870).tryRequireAjv,g=i(5609).showTransformModal,b=i(2915).showSortModal,y=C();function x(A,v,_){if(!(this instanceof x))throw new Error('JSONEditor constructor called without "new".');var I=h();if(I!==-1&&I<9)throw new Error("Unsupported browser, IE9 or newer required. Please install the newest version of your browser.");v&&(v.error&&(v.onError=v.error,delete v.error),v.change&&(v.onChange=v.change,delete v.change),v.editable&&(v.onEditable=v.editable,delete v.editable),v.onChangeJSON&&(v.mode==="text"||v.mode==="code"||v.modes&&(v.modes.indexOf("text")!==-1||v.modes.indexOf("code"))),v)&&Object.keys(v).forEach(function(T){x.VALID_OPTIONS.indexOf(T)}),arguments.length&&this._create(A,v,_)}typeof Promise>"u",x.modes={},x.prototype.DEBOUNCE_INTERVAL=150,x.VALID_OPTIONS=["ajv","schema","schemaRefs","templates","ace","theme","autocomplete","onChange","onChangeJSON","onChangeText","onExpand","onEditable","onError","onEvent","onModeChange","onNodeName","onValidate","onCreateMenu","onSelectionChange","onTextSelectionChange","onClassName","onFocus","onBlur","colorPicker","onColorPicker","timestampTag","timestampFormat","escapeUnicode","history","search","mode","modes","name","indentation","sortObjectKeys","navigationBar","statusBar","mainMenuBar","languages","language","enableSort","enableTransform","limitDragging","maxVisibleChilds","onValidationError","modalAnchor","popupAnchor","createQuery","executeQuery","queryDescription","allowSchemaSuggestions","showErrorTable"],x.prototype._create=function(A,v,_){this.container=A,this.options=v||{},this.json=_||{},A=this.options.mode||this.options.modes&&this.options.modes[0]||"tree",this.setMode(A)},x.prototype.destroy=function(){},x.prototype.set=function(A){this.json=A},x.prototype.get=function(){return this.json},x.prototype.setText=function(A){this.json=f(A)},x.prototype.getText=function(){return JSON.stringify(this.json)},x.prototype.setName=function(A){this.options||(this.options={}),this.options.name=A},x.prototype.getName=function(){return this.options&&this.options.name},x.prototype.setMode=function(A){if(A!==this.options.mode||!this.create){var v=this.container,_=m({},this.options),I=_.mode,T=(_.mode=A,x.modes[A]);if(!T)throw new Error('Unknown mode "'+_.mode+'"');var E=T.data==="text",w=this.getName(),S=this[E?"getText":"get"]();if(this.destroy(),d(this),m(this,T.mixin),this.create(v,_),this.setName(w),this[E?"setText":"set"](S),typeof T.load=="function")try{T.load.call(this)}catch{}if(typeof _.onModeChange=="function"&&A!==I)try{_.onModeChange(A,I)}catch{}}},x.prototype.getMode=function(){return this.options.mode},x.prototype._onError=function(A){this.options&&typeof this.options.onError=="function"?this.options.onError(A):window.alert(A.toString())},x.prototype.setSchema=function(A,v){if(A){var _;try{this.options.ajv?_=this.options.ajv:((_=y({allErrors:!0,verbose:!0,schemaId:"auto",$data:!0})).addMetaSchema(i(5207)),_.addMetaSchema(i(6801)))}catch{}if(_){if(v){for(var I in v)_.removeSchema(I),v[I]&&_.addSchema(v[I],I);this.options.schemaRefs=v}this.validateSchema=_.compile(A),this.options.schema=A,this.options.schemaRefs=v,this.validate()}}else this.validateSchema=null,this.options.schema=null,this.options.schemaRefs=null,this.validate();this.refresh(),typeof this._onSchemaChange=="function"&&this._onSchemaChange(A,v)},x.prototype.validate=function(){},x.prototype.refresh=function(){},(x.registerMode=function(A){var v;if(Array.isArray(A))for(T=0;T<A.length;T++)x.registerMode(A[T]);else{if(!("mode"in A))throw new Error('Property "mode" missing');if(!("mixin"in A))throw new Error('Property "mixin" missing');if(!("data"in A))throw new Error('Property "data" missing');var _=A.mode;if(_ in x.modes)throw new Error('Mode "'+_+'" already registered');if(typeof A.mixin.create!="function")throw new Error('Required function "create" missing on mixin');for(var I=["setMode","registerMode","modes"],T=0;T<I.length;T++)if((v=I[T])in A.mixin)throw new Error('Reserved property "'+v+'" not allowed in mixin');x.modes[_]=A}})(l),x.registerMode(c),x.registerMode(u),x.ace=s,x.Ajv=y,x.VanillaPicker=a,x.showTransformModal=g,x.showSortModal=b,x.getInnerText=p,n.exports=x.default=x},1389:function(n,o,i){"use strict";i.d(o,{n:function(){return u}});var s=i(6545),a=i(3057);function l(d){return(l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m})(d)}function c(d,m){for(var p=0;p<m.length;p++){var h=m[p];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(d,function(f){return f=function(C,g){if(l(C)!="object"||!C)return C;var b=C[Symbol.toPrimitive];if(b===void 0)return(g==="string"?String:Number)(C);if(b=b.call(C,g||"default"),l(b)!="object")return b;throw new TypeError("@@toPrimitive must return a primitive value.")}(f,"string"),l(f)=="symbol"?f:f+""}(h.key),h)}}var u=function(){function d(f,C,g,b){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");for(var y={code:{text:(0,a.Tl)("modeCodeText"),title:(0,a.Tl)("modeCodeTitle"),click:function(){b("code")}},form:{text:(0,a.Tl)("modeFormText"),title:(0,a.Tl)("modeFormTitle"),click:function(){b("form")}},text:{text:(0,a.Tl)("modeTextText"),title:(0,a.Tl)("modeTextTitle"),click:function(){b("text")}},tree:{text:(0,a.Tl)("modeTreeText"),title:(0,a.Tl)("modeTreeTitle"),click:function(){b("tree")}},view:{text:(0,a.Tl)("modeViewText"),title:(0,a.Tl)("modeViewTitle"),click:function(){b("view")}},preview:{text:(0,a.Tl)("modePreviewText"),title:(0,a.Tl)("modePreviewTitle"),click:function(){b("preview")}}},x=[],A=0;A<C.length;A++){var v=C[A],_=y[v];if(!_)throw new Error('Unknown mode "'+v+'"');_.className="jsoneditor-type-modes"+(g===v?" jsoneditor-selected":""),x.push(_)}var T=y[g];if(!T)throw new Error('Unknown mode "'+g+'"');var T=T.text,I=document.createElement("button"),T=(I.type="button",I.className="jsoneditor-modes jsoneditor-separator",I.textContent=T+" \u25BE",I.title=(0,a.Tl)("modeEditorTitle"),I.onclick=function(){new s.t(x).show(I,f)},document.createElement("div"));T.className="jsoneditor-modes",T.style.position="relative",T.appendChild(I),f.appendChild(T),this.dom={container:f,box:I,frame:T}}return m=d,(p=[{key:"focus",value:function(){this.dom.box.focus()}},{key:"destroy",value:function(){this.dom&&this.dom.frame&&this.dom.frame.parentNode&&this.dom.frame.parentNode.removeChild(this.dom.frame),this.dom=null}}])&&c(m.prototype,p),h&&c(m,h),Object.defineProperty(m,"prototype",{writable:!1}),m;var m,p,h}()},7413:function(n,o,i){var s;if(window.ace)s=window.ace;else try{s=i(6990),i(4221),i(6534),i(6489);var a=i(5477);s.config.setModuleUrl("ace/mode/json_worker",a)}catch{}n.exports=s},9762:function(){window.ace.define("ace/theme/jsoneditor",["require","exports","module","ace/lib/dom"],function(n,o,i){o.isDark=!1,o.cssClass="ace-jsoneditor",o.cssText=`.ace-jsoneditor .ace_gutter {
background: #ebebeb;
color: #333
}

.ace-jsoneditor.ace_editor {
line-height: 1.3;
background-color: #fff;
}
.ace-jsoneditor .ace_print-margin {
width: 1px;
background: #e8e8e8
}
.ace-jsoneditor .ace_scroller {
background-color: #FFFFFF
}
.ace-jsoneditor .ace_text-layer {
color: gray
}
.ace-jsoneditor .ace_variable {
color: #1a1a1a
}
.ace-jsoneditor .ace_cursor {
border-left: 2px solid #000000
}
.ace-jsoneditor .ace_overwrite-cursors .ace_cursor {
border-left: 0px;
border-bottom: 1px solid #000000
}
.ace-jsoneditor .ace_marker-layer .ace_selection {
background: lightgray
}
.ace-jsoneditor.ace_multiselect .ace_selection.ace_start {
box-shadow: 0 0 3px 0px #FFFFFF;
border-radius: 2px
}
.ace-jsoneditor .ace_marker-layer .ace_step {
background: rgb(255, 255, 0)
}
.ace-jsoneditor .ace_marker-layer .ace_bracket {
margin: -1px 0 0 -1px;
border: 1px solid #BFBFBF
}
.ace-jsoneditor .ace_marker-layer .ace_active-line {
background: #FFFBD1
}
.ace-jsoneditor .ace_gutter-active-line {
background-color : #dcdcdc
}
.ace-jsoneditor .ace_marker-layer .ace_selected-word {
border: 1px solid lightgray
}
.ace-jsoneditor .ace_invisible {
color: #BFBFBF
}
.ace-jsoneditor .ace_keyword,
.ace-jsoneditor .ace_meta,
.ace-jsoneditor .ace_support.ace_constant.ace_property-value {
color: #AF956F
}
.ace-jsoneditor .ace_keyword.ace_operator {
color: #484848
}
.ace-jsoneditor .ace_keyword.ace_other.ace_unit {
color: #96DC5F
}
.ace-jsoneditor .ace_constant.ace_language {
color: darkorange
}
.ace-jsoneditor .ace_constant.ace_numeric {
color: red
}
.ace-jsoneditor .ace_constant.ace_character.ace_entity {
color: #BF78CC
}
.ace-jsoneditor .ace_invalid {
color: #FFFFFF;
background-color: #FF002A;
}
.ace-jsoneditor .ace_fold {
background-color: #AF956F;
border-color: #000000
}
.ace-jsoneditor .ace_storage,
.ace-jsoneditor .ace_support.ace_class,
.ace-jsoneditor .ace_support.ace_function,
.ace-jsoneditor .ace_support.ace_other,
.ace-jsoneditor .ace_support.ace_type {
color: #C52727
}
.ace-jsoneditor .ace_string {
color: green
}
.ace-jsoneditor .ace_comment {
color: #BCC8BA
}
.ace-jsoneditor .ace_entity.ace_name.ace_tag,
.ace-jsoneditor .ace_entity.ace_other.ace_attribute-name {
color: #606060
}
.ace-jsoneditor .ace_markup.ace_underline {
text-decoration: underline
}
.ace-jsoneditor .ace_indent-guide {
background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y
}`,n("../lib/dom").importCssString(o.cssText,o.cssClass)})},5736:function(n,o){(i={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(s,a,l,c,u,d,m){var p=d.length-1;switch(u){case 1:this.$=s.replace(/\\(\\|")/g,"$1").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(s);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=d[p-1];case 13:this.$={};break;case 14:this.$=d[p-1];break;case 15:this.$=[d[p-2],d[p]];break;case 16:this.$={},this.$[d[p][0]]=d[p][1];break;case 17:this.$=d[p-2],d[p-2][d[p][0]]=d[p][1];break;case 18:this.$=[];break;case 19:this.$=d[p-1];break;case 20:this.$=[d[p]];break;case 21:this.$=d[p-2],d[p-2].push(d[p])}},table:[{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],12:1,13:2,15:7,16:8,17:[1,14],23:[1,15]},{1:[3]},{14:[1,16]},{14:[2,7],18:[2,7],22:[2,7],24:[2,7]},{14:[2,8],18:[2,8],22:[2,8],24:[2,8]},{14:[2,9],18:[2,9],22:[2,9],24:[2,9]},{14:[2,10],18:[2,10],22:[2,10],24:[2,10]},{14:[2,11],18:[2,11],22:[2,11],24:[2,11]},{14:[2,12],18:[2,12],22:[2,12],24:[2,12]},{14:[2,3],18:[2,3],22:[2,3],24:[2,3]},{14:[2,4],18:[2,4],22:[2,4],24:[2,4]},{14:[2,5],18:[2,5],22:[2,5],24:[2,5]},{14:[2,1],18:[2,1],21:[2,1],22:[2,1],24:[2,1]},{14:[2,2],18:[2,2],22:[2,2],24:[2,2]},{3:20,4:[1,12],18:[1,17],19:18,20:19},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:23,15:7,16:8,17:[1,14],23:[1,15],24:[1,21],25:22},{1:[2,6]},{14:[2,13],18:[2,13],22:[2,13],24:[2,13]},{18:[1,24],22:[1,25]},{18:[2,16],22:[2,16]},{21:[1,26]},{14:[2,18],18:[2,18],22:[2,18],24:[2,18]},{22:[1,28],24:[1,27]},{22:[2,20],24:[2,20]},{14:[2,14],18:[2,14],22:[2,14],24:[2,14]},{3:20,4:[1,12],20:29},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:30,15:7,16:8,17:[1,14],23:[1,15]},{14:[2,19],18:[2,19],22:[2,19],24:[2,19]},{3:5,4:[1,12],5:6,6:[1,13],7:3,8:[1,9],9:4,10:[1,10],11:[1,11],13:31,15:7,16:8,17:[1,14],23:[1,15]},{18:[2,17],22:[2,17]},{18:[2,15],22:[2,15]},{22:[2,21],24:[2,21]}],defaultActions:{16:[2,6]},parseError:function(s,a){throw new Error(s)},parse:function(s){var a=this,l=[0],c=[null],u=[],d=this.table,m="",p=0,h=0,f=0,C=(this.lexer.setInput(s),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.lexer.yylloc===void 0&&(this.lexer.yylloc={}),this.lexer.yylloc);function g(){var P=a.lexer.lex()||1;return P=typeof P!="number"&&a.symbols_[P]||P}u.push(C),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);for(var b,y,x,A,v,_,I,T,E,w={};;){if(x=l[l.length-1],(A=this.defaultActions[x]||(b==null&&(b=g()),d[x]&&d[x][b]))===void 0||!A.length||!A[0]){if(!f){for(v in T=[],d[x])this.terminals_[v]&&2<v&&T.push("'"+this.terminals_[v]+"'");var S="",S=this.lexer.showPosition?"Parse error on line "+(p+1)+`:
`+this.lexer.showPosition()+`
Expecting `+T.join(", ")+", got '"+this.terminals_[b]+"'":"Parse error on line "+(p+1)+": Unexpected "+(b==1?"end of input":"'"+(this.terminals_[b]||b)+"'");this.parseError(S,{text:this.lexer.match,token:this.terminals_[b]||b,line:this.lexer.yylineno,loc:C,expected:T})}if(f==3){if(b==1)throw new Error(S||"Parsing halted.");h=this.lexer.yyleng,m=this.lexer.yytext,p=this.lexer.yylineno,C=this.lexer.yylloc,b=g()}for(;!("2"in d[x]);){if(x==0)throw new Error(S||"Parsing halted.");E=1,l.length=l.length-2*E,c.length=c.length-E,u.length=u.length-E,x=l[l.length-1]}y=b,b=2,A=d[x=l[l.length-1]]&&d[x][2],f=3}if(A[0]instanceof Array&&1<A.length)throw new Error("Parse Error: multiple actions possible at state: "+x+", token: "+b);switch(A[0]){case 1:l.push(b),c.push(this.lexer.yytext),u.push(this.lexer.yylloc),l.push(A[1]),b=null,y?(b=y,y=null):(h=this.lexer.yyleng,m=this.lexer.yytext,p=this.lexer.yylineno,C=this.lexer.yylloc,0<f&&f--);break;case 2:if(_=this.productions_[A[1]][1],w.$=c[c.length-_],w._$={first_line:u[u.length-(_||1)].first_line,last_line:u[u.length-1].last_line,first_column:u[u.length-(_||1)].first_column,last_column:u[u.length-1].last_column},(I=this.performAction.call(w,m,h,p,this.yy,A[1],c,u))!==void 0)return I;_&&(l=l.slice(0,-1*_*2),c=c.slice(0,-1*_),u=u.slice(0,-1*_)),l.push(this.productions_[A[1]][0]),c.push(w.$),u.push(w._$),I=d[l[l.length-2]][l[l.length-1]],l.push(I);break;case 3:return!0}}return!0}}).lexer={EOF:1,parseError:function(s,a){if(!this.yy.parseError)throw new Error(s);this.yy.parseError(s,a)},setInput:function(s){return this._input=s,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var s=this._input[0];return this.yytext+=s,this.yyleng++,this.match+=s,this.matched+=s,s.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),s},unput:function(s){return this._input=s+this._input,this},more:function(){return this._more=!0,this},less:function(s){this._input=this.match.slice(s)+this._input},pastInput:function(){var s=this.matched.substr(0,this.matched.length-this.match.length);return(20<s.length?"...":"")+s.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var s=this.match;return s.length<20&&(s+=this._input.substr(0,20-s.length)),(s.substr(0,20)+(20<s.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var s=this.pastInput(),a=new Array(s.length+1).join("-");return s+this.upcomingInput()+`
`+a+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var s,a,l,c,u=this._currentRules(),d=0;d<u.length&&(!(a=this._input.match(this.rules[u[d]]))||s&&!(a[0].length>s[0].length)||(s=a,l=d,this.options.flex));d++);return s?((c=s[0].match(/\n.*/g))&&(this.yylineno+=c.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-1:this.yylloc.last_column+s[0].length},this.yytext+=s[0],this.match+=s[0],this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(s[0].length),this.matched+=s[0],c=this.performAction.call(this,this.yy,this,u[l],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),c||void 0):this._input===""?this.EOF:void this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var s=this.next();return s!==void 0?s:this.lex()},begin:function(s){this.conditionStack.push(s)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(s){this.begin(s)},options:{},performAction:function(s,a,l,c){switch(l){case 0:break;case 1:return 6;case 2:return a.yytext=a.yytext.substr(1,a.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};var i;o.parser=i,o.parse=i.parse.bind(i)},4772:function(n){"use strict";function o(){}o.prototype={on:function(p,h){this._events=this._events||{},this._events[p]=this._events[p]||[],this._events[p].push(h)},off:function(p,h){this._events=this._events||{},p in this._events&&this._events[p].splice(this._events[p].indexOf(h),1)},emit:function(p){if(this._events=this._events||{},p in this._events)for(var h=0;h<this._events[p].length;h++)this._events[p][h].apply(this,Array.prototype.slice.call(arguments,1))}},o.mixin=function(p){for(var h=["on","off","emit"],f=0;f<h.length;f++)typeof p=="function"?p.prototype[h[f]]=o.prototype[h[f]]:p[h[f]]=o.prototype[h[f]];return p};var i={escapeRegExp:function(p){var h=/[\\^$.*+?()[\]{}|]/g,f=new RegExp(h.source);return p&&f.test(p)?p.replace(h,"\\$&"):p},extend:function(p,h){for(var f in h){var C;h.hasOwnProperty(f)&&((C=h[f])&&Object.prototype.toString.call(C)==="[object Object]"?(p[f]=p[f]||{},i.extend(p[f],C)):p[f]=C)}return p},each:function(p,h,f){if(Object.prototype.toString.call(p)==="[object Object]")for(var C in p)Object.prototype.hasOwnProperty.call(p,C)&&h.call(f,C,p[C],p);else for(var g=0,b=p.length;g<b;g++)h.call(f,g,p[g],p)},createElement:function(p,h){var f,C=document.createElement(p);if(h&&Object.prototype.toString.call(h)==="[object Object]")for(f in h)f in C?C[f]=h[f]:f==="html"?C.innerHTML=h[f]:C.setAttribute(f,h[f]);return C},hasClass:function(p,h){if(p)return p.classList?p.classList.contains(h):!!p.className&&!!p.className.match(new RegExp("(\\s|^)"+h+"(\\s|$)"))},addClass:function(p,h){i.hasClass(p,h)||(p.classList?p.classList.add(h):p.className=p.className.trim()+" "+h)},removeClass:function(p,h){i.hasClass(p,h)&&(p.classList?p.classList.remove(h):p.className=p.className.replace(new RegExp("(^|\\s)"+h.split(" ").join("|")+"(\\s|$)","gi")," "))},closest:function(p,h){return p&&p!==document.body&&(h(p)?p:i.closest(p.parentNode,h))},isInt:function(p){return typeof p=="number"&&isFinite(p)&&Math.floor(p)===p},debounce:function(p,h,f){var C;return function(){var g=this,b=arguments,y=f&&!C;clearTimeout(C),C=setTimeout(function(){C=null,f||p.apply(g,b)},h),y&&p.apply(g,b)}},rect:function(C,b){var f=window,C=C.getBoundingClientRect(),g=b?f.pageXOffset:0,b=b?f.pageYOffset:0;return{bottom:C.bottom+b,height:C.height,left:C.left+g,right:C.right+g,top:C.top+b,width:C.width}},includes:function(p,h){return-1<p.indexOf(h)},startsWith:function(p,h){return p.substr(0,h.length)===h},truncate:function(p){for(;p.firstChild;)p.removeChild(p.firstChild)}};function s(p,h){return p.hasOwnProperty(h)&&(p[h]===!0||p[h].length)}function a(p,h,f){p.parentNode?p.parentNode.parentNode||h.appendChild(p.parentNode):h.appendChild(p),i.removeClass(p,"excluded"),f||(p.textContent=p.textContent)}function l(){var p,h;this.items.length&&(p=document.createDocumentFragment(),this.config.pagination?(h=this.pages.slice(0,this.pageIndex),i.each(h,function(f,C){i.each(C,function(g,b){a(b,p,this.customOption)},this)},this)):i.each(this.items,function(f,C){a(C,p,this.customOption)},this),p.childElementCount&&(i.removeClass(this.items[this.navIndex],"active"),this.navIndex=(p.querySelector(".selectr-option.selected")||p.querySelector(".selectr-option")).idx,i.addClass(this.items[this.navIndex],"active")),this.tree.appendChild(p))}function c(p,h){h=h||p;var f={class:"selectr-option",role:"treeitem","aria-selected":!1};return this.customOption?f.html=this.config.renderOption(h):f.textContent=p.textContent,(h=i.createElement("li",f)).idx=p.idx,this.items.push(h),p.defaultSelected&&this.defaultSelected.push(p.idx),p.disabled&&(h.disabled=!0,i.addClass(h,"disabled")),h}function u(){var p,h=this.tree,f=h.scrollTop;h.scrollHeight-h.offsetHeight<=f&&this.pageIndex<this.pages.length&&(p=document.createDocumentFragment(),i.each(this.pages[this.pageIndex],function(C,g){a(g,p,this.customOption)},this),h.appendChild(p),this.pageIndex++,this.emit("selectr.paginate",{items:this.items.length,total:this.data.length,page:this.pageIndex,pages:this.pages.length}))}function d(){(this.config.searchable||this.config.taggable)&&(this.input.value=null,this.searching=!1,this.config.searchable&&i.removeClass(this.inputContainer,"active"),i.hasClass(this.container,"notice")&&(i.removeClass(this.container,"notice"),i.addClass(this.container,"open"),this.input.focus()),i.each(this.items,function(p,h){i.removeClass(h,"excluded"),this.customOption||(h.textContent=h.textContent)},this))}function m(p,h){if(!p)throw new Error("You must supply either a HTMLSelectElement or a CSS3 selector string.");if(typeof(this.el=p)=="string"&&(this.el=document.querySelector(p)),this.el===null)throw new Error("The element you passed to Selectr can not be found.");if(this.el.nodeName.toLowerCase()!=="select")throw new Error("The element you passed to Selectr is not a HTMLSelectElement.");this.render(h)}m.prototype.render=function(p){var h;this.rendered||((this.el.selectr=this).config=i.extend({defaultSelected:!0,width:"auto",disabled:!1,disabledMobile:!1,searchable:!0,clearable:!1,sortSelected:!1,allowDeselect:!1,closeOnScroll:!1,nativeDropdown:!1,nativeKeyboard:!1,placeholder:"Select an option...",taggable:!1,tagPlaceholder:"Enter a tag...",messages:{noResults:"No results.",noOptions:"No options available.",maxSelections:"A maximum of {max} items can be selected.",tagDuplicate:"That tag is already in use.",searchPlaceholder:"Search options..."}},p),this.originalType=this.el.type,this.originalIndex=this.el.tabIndex,this.defaultSelected=[],this.originalOptionCount=this.el.options.length,(this.config.multiple||this.config.taggable)&&(this.el.multiple=!0),this.disabled=s(this.config,"disabled"),this.opened=!1,this.config.taggable&&(this.config.searchable=!1),this.navigating=!1,this.mobileDevice=!1,!this.config.disabledMobile&&/Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent)&&(this.mobileDevice=!0),this.customOption=this.config.hasOwnProperty("renderOption")&&typeof this.config.renderOption=="function",this.customSelected=this.config.hasOwnProperty("renderSelection")&&typeof this.config.renderSelection=="function",this.supportsEventPassiveOption=this.detectEventPassiveOption(),o.mixin(this),(function(){this.requiresPagination=this.config.pagination&&0<this.config.pagination,s(this.config,"width")&&(i.isInt(this.config.width)?this.width=this.config.width+"px":this.config.width==="auto"?this.width="100%":i.includes(this.config.width,"%")&&(this.width=this.config.width)),this.container=i.createElement("div",{class:"selectr-container"}),this.config.customClass&&i.addClass(this.container,this.config.customClass),this.mobileDevice?i.addClass(this.container,"selectr-mobile"):i.addClass(this.container,"selectr-desktop"),this.el.tabIndex=-1,this.config.nativeDropdown||this.mobileDevice?i.addClass(this.el,"selectr-visible"):i.addClass(this.el,"selectr-hidden"),this.selected=i.createElement("div",{class:"selectr-selected",disabled:this.disabled,tabIndex:0,"aria-expanded":!1}),this.label=i.createElement(this.el.multiple?"ul":"span",{class:"selectr-label"});var f=i.createElement("div",{class:"selectr-options-container"});if(this.tree=i.createElement("ul",{class:"selectr-options",role:"tree","aria-hidden":!0,"aria-expanded":!1}),this.notice=i.createElement("div",{class:"selectr-notice"}),this.el.setAttribute("aria-hidden",!0),this.disabled&&(this.el.disabled=!0),this.el.multiple?(i.addClass(this.label,"selectr-tags"),i.addClass(this.container,"multiple"),this.tags=[],this.selectedValues=this.config.defaultSelected?this.getSelectedProperties("value"):[],this.selectedIndexes=this.getSelectedProperties("idx")):(this.selectedValue=null,this.selectedIndex=-1),this.selected.appendChild(this.label),this.config.clearable&&(this.selectClear=i.createElement("button",{class:"selectr-clear",type:"button"}),this.container.appendChild(this.selectClear),i.addClass(this.container,"clearable")),this.config.taggable){var C=i.createElement("li",{class:"input-tag"});if(this.input=i.createElement("input",{class:"selectr-tag-input",placeholder:this.config.tagPlaceholder,tagIndex:0,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",role:"textbox",type:"search"}),C.appendChild(this.input),this.label.appendChild(C),i.addClass(this.container,"taggable"),this.tagSeperators=[","],this.config.tagSeperators){this.tagSeperators=this.tagSeperators.concat(this.config.tagSeperators);for(var g=[],b=0;b<this.tagSeperators.length;b++)g.push(i.escapeRegExp(this.tagSeperators[b]));this.tagSeperatorsRegex=new RegExp(g.join("|"),"i")}else this.tagSeperatorsRegex=new RegExp(",","i")}this.config.searchable&&(this.input=i.createElement("input",{class:"selectr-input",tagIndex:-1,autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",role:"textbox",type:"search",placeholder:this.config.messages.searchPlaceholder}),this.inputClear=i.createElement("button",{class:"selectr-input-clear",type:"button"}),this.inputContainer=i.createElement("div",{class:"selectr-input-container"}),this.inputContainer.appendChild(this.input),this.inputContainer.appendChild(this.inputClear),f.appendChild(this.inputContainer)),f.appendChild(this.notice),f.appendChild(this.tree),this.items=[],this.options=[],this.el.options.length&&(this.options=[].slice.call(this.el.options));var y,x,A,v=!1,_=0;this.el.children.length&&i.each(this.el.children,function(T,E){E.nodeName==="OPTGROUP"?(v=i.createElement("ul",{class:"selectr-optgroup",role:"group",html:"<li class='selectr-optgroup--label'>"+E.label+"</li>"}),i.each(E.children,function(w,S){S.idx=_,v.appendChild(c.call(this,S,v)),_++},this)):(E.idx=_,c.call(this,E),_++)},this),this.config.data&&Array.isArray(this.config.data)&&(y=!(this.data=[]),v=!1,_=0,i.each(this.config.data,function(T,E){s(E,"children")?(y=i.createElement("optgroup",{label:E.text}),v=i.createElement("ul",{class:"selectr-optgroup",role:"group",html:"<li class='selectr-optgroup--label'>"+E.text+"</li>"}),i.each(E.children,function(w,S){(x=new Option(S.text,S.value,!1,S.hasOwnProperty("selected")&&S.selected===!0)).disabled=s(S,"disabled"),this.options.push(x),y.appendChild(x),x.idx=_,v.appendChild(c.call(this,x,S)),this.data[_]=S,_++},this),this.el.appendChild(y)):((x=new Option(E.text,E.value,!1,E.hasOwnProperty("selected")&&E.selected===!0)).disabled=s(E,"disabled"),this.options.push(x),x.idx=_,c.call(this,x,E),this.data[_]=E,_++)},this)),this.setSelected(!0);for(var I=this.navIndex=0;I<this.items.length;I++)if(A=this.items[I],!i.hasClass(A,"disabled")){i.addClass(A,"active"),this.navIndex=I;break}this.requiresPagination&&(this.pageIndex=1,this.paginate()),this.container.appendChild(this.selected),this.container.appendChild(f),this.placeEl=i.createElement("div",{class:"selectr-placeholder"}),this.setPlaceholder(),this.selected.appendChild(this.placeEl),this.disabled&&this.disable(),this.el.parentNode.insertBefore(this.container,this.el),this.container.appendChild(this.el)}).call(this),this.bindEvents(),this.update(),this.optsRect=i.rect(this.tree),this.rendered=!0,this.el.multiple||(this.el.selectedIndex=this.selectedIndex),h=this,setTimeout(function(){h.emit("selectr.init")},20))},m.prototype.getSelected=function(){return this.el.querySelectorAll("option:checked")},m.prototype.getSelectedProperties=function(p){var h=this.getSelected();return[].slice.call(h).map(function(f){return f[p]}).filter(function(f){return f!=null})},m.prototype.detectEventPassiveOption=function(){var p=!1;try{var h=Object.defineProperty({},"passive",{get:function(){p=!0}});window.addEventListener("test",null,h)}catch{}return p},m.prototype.bindEvents=function(){var p,h=this;this.events={},this.events.dismiss=(function(f){f=f.target,this.container.contains(f)||!this.opened&&!i.hasClass(this.container,"notice")||this.close()}).bind(this),this.events.navigate=(function(f){if(f=f||window.event,this.items.length&&this.opened&&i.includes([13,38,40],f.which)){if(f.preventDefault(),f.which===13)return!(this.noResults||this.config.taggable&&0<this.input.value.length)&&this.change(this.navIndex);var C,g=this.items[this.navIndex],b=this.navIndex;switch(f.which){case 38:(C=0)<this.navIndex&&this.navIndex--;break;case 40:this.navIndex<this.items.length-(C=1)&&this.navIndex++}for(this.navigating=!0;i.hasClass(this.items[this.navIndex],"disabled")||i.hasClass(this.items[this.navIndex],"excluded");){if(!(0<this.navIndex&&this.navIndex<this.items.length-1)){this.navIndex=b;break}if(C?this.navIndex++:this.navIndex--,this.searching){if(this.navIndex>this.tree.lastElementChild.idx){this.navIndex=this.tree.lastElementChild.idx;break}if(this.navIndex<this.tree.firstElementChild.idx){this.navIndex=this.tree.firstElementChild.idx;break}}}f=i.rect(this.items[this.navIndex]),C?(this.navIndex===0?this.tree.scrollTop=0:f.top+f.height>this.optsRect.top+this.optsRect.height&&(this.tree.scrollTop=this.tree.scrollTop+(f.top+f.height-(this.optsRect.top+this.optsRect.height))),this.navIndex===this.tree.childElementCount-1&&this.requiresPagination&&u.call(this)):this.navIndex===0?this.tree.scrollTop=0:f.top-this.optsRect.top<0&&(this.tree.scrollTop=this.tree.scrollTop+(f.top-this.optsRect.top)),g&&i.removeClass(g,"active"),i.addClass(this.items[this.navIndex],"active")}else this.navigating=!1}).bind(this),this.events.reset=this.reset.bind(this),(this.config.nativeDropdown||this.mobileDevice)&&(this.container.addEventListener("touchstart",function(f){f.changedTouches[0].target===h.el&&h.toggle()},!!this.supportsEventPassiveOption&&{passive:!0}),this.container.addEventListener("click",function(f){f.target===h.el&&h.toggle()}),this.el.addEventListener("change",function(f){f.__selfTriggered||(h.el.multiple?(f=h.getSelectedProperties("idx"),f=function(C,g){for(var b,y=[],x=C.slice(0),A=0;A<g.length;A++)-1<(b=x.indexOf(g[A]))?x.splice(b,1):y.push(g[A]);return[y,x]}(h.selectedIndexes,f),i.each(f[0],function(C,g){h.select(g)},h),i.each(f[1],function(C,g){h.deselect(g)},h)):-1<h.el.selectedIndex&&h.select(h.el.selectedIndex))})),this.config.nativeDropdown&&this.container.addEventListener("keydown",function(f){f.key==="Enter"&&h.selected===document.activeElement&&(h.toggle(),setTimeout(function(){h.el.focus()},200))}),this.selected.addEventListener("click",function(f){h.disabled||h.toggle(),f.preventDefault()}),this.config.nativeKeyboard&&(p="",this.selected.addEventListener("keydown",function(f){var C;h.disabled||h.selected!==document.activeElement||f.altKey||f.ctrlKey||f.metaKey||(f.key===" "||!h.opened&&-1<["Enter","ArrowUp","ArrowDown"].indexOf(f.key)?(h.toggle(),f.preventDefault(),f.stopPropagation()):f.key.length<=2&&String[String.fromCodePoint?"fromCodePoint":"fromCharCode"](f.key[String.codePointAt?"codePointAt":"charCodeAt"](0))===f.key&&(h.config.multiple?(h.open(),h.config.searchable&&(h.input.value=f.key,h.input.focus(),h.search(null,!0))):(p+=f.key,(C=h.search(p,!0))&&C.length&&(h.clear(),h.setValue(C[0].value)),setTimeout(function(){p=""},1e3)),f.preventDefault(),f.stopPropagation()))}),this.container.addEventListener("keyup",function(f){h.opened&&f.key==="Escape"&&(h.close(),f.stopPropagation(),h.selected.focus())})),this.label.addEventListener("click",function(f){i.hasClass(f.target,"selectr-tag-remove")&&h.deselect(f.target.parentNode.idx)}),this.selectClear&&this.selectClear.addEventListener("click",this.clear.bind(this)),this.tree.addEventListener("mousedown",function(f){f.preventDefault()}),this.tree.addEventListener("click",function(f){var C=i.closest(f.target,function(g){return g&&i.hasClass(g,"selectr-option")});C&&!i.hasClass(C,"disabled")&&(i.hasClass(C,"selected")?(h.el.multiple||!h.el.multiple&&h.config.allowDeselect)&&h.deselect(C.idx):h.select(C.idx),h.opened&&!h.el.multiple)&&h.close(),f.preventDefault(),f.stopPropagation()}),this.tree.addEventListener("mouseover",function(f){!i.hasClass(f.target,"selectr-option")||i.hasClass(f.target,"disabled")||(i.removeClass(h.items[h.navIndex],"active"),i.addClass(f.target,"active"),h.navIndex=[].slice.call(h.items).indexOf(f.target))}),this.config.searchable&&(this.input.addEventListener("focus",function(f){h.searching=!0}),this.input.addEventListener("blur",function(f){h.searching=!1}),this.input.addEventListener("keyup",function(f){h.search(),h.config.taggable||(this.value.length?i.addClass(this.parentNode,"active"):i.removeClass(this.parentNode,"active"))}),this.inputClear.addEventListener("click",function(f){h.input.value=null,d.call(h),h.tree.childElementCount||l.call(h)})),this.config.taggable&&this.input.addEventListener("keyup",function(f){var C,g;h.search(),h.config.taggable&&this.value.length&&(C=this.value.trim()).length&&(f.which===13||h.tagSeperatorsRegex.test(C))&&(f=C.replace(h.tagSeperatorsRegex,""),(g=(f=(f=i.escapeRegExp(f)).trim()).length?h.add({value:f,textContent:f,selected:!0},!0):g)?(h.close(),d.call(h)):(this.value="",h.setMessage(h.config.messages.tagDuplicate)))}),this.update=i.debounce(function(){h.opened&&h.config.closeOnScroll&&h.close(),h.width&&(h.container.style.width=h.width),h.invert()},50),this.requiresPagination&&(this.paginateItems=i.debounce(function(){u.call(this)},50),this.tree.addEventListener("scroll",this.paginateItems.bind(this))),document.addEventListener("click",this.events.dismiss),window.addEventListener("keydown",this.events.navigate),window.addEventListener("resize",this.update),window.addEventListener("scroll",this.update),this.on("selectr.destroy",function(){document.removeEventListener("click",this.events.dismiss),window.removeEventListener("keydown",this.events.navigate),window.removeEventListener("resize",this.update),window.removeEventListener("scroll",this.update)}),this.el.form&&(this.el.form.addEventListener("reset",this.events.reset),this.on("selectr.destroy",function(){this.el.form.removeEventListener("reset",this.events.reset)}))},m.prototype.setSelected=function(p){var h;this.config.data||this.el.multiple||!this.el.options.length||(this.el.selectedIndex!==0||this.el.options[0].defaultSelected||this.config.defaultSelected||(this.el.selectedIndex=-1),this.selectedIndex=this.el.selectedIndex,-1<this.selectedIndex&&this.select(this.selectedIndex)),this.config.multiple&&this.originalType==="select-one"&&!this.config.data&&this.el.options[0].selected&&!this.el.options[0].defaultSelected&&(this.el.options[0].selected=!1),i.each(this.options,function(f,C){C.selected&&C.defaultSelected&&this.select(C.idx)},this),this.config.selectedValue&&this.setValue(this.config.selectedValue),this.config.data&&(!this.el.multiple&&this.config.defaultSelected&&this.el.selectedIndex<0&&0<this.config.data.length&&this.select(0),h=0,i.each(this.config.data,function(f,C){s(C,"children")?i.each(C.children,function(g,b){b.hasOwnProperty("selected")&&b.selected===!0&&this.select(h),h++},this):(C.hasOwnProperty("selected")&&C.selected===!0&&this.select(h),h++)},this))},m.prototype.destroy=function(){this.rendered&&(this.emit("selectr.destroy"),this.originalType==="select-one"&&(this.el.multiple=!1),this.config.data&&(this.el.innerHTML=""),i.removeClass(this.el,"selectr-hidden"),this.container.parentNode.replaceChild(this.el,this.container),this.rendered=!1,delete this.el.selectr)},m.prototype.change=function(p){var h=this.items[p],f=this.options[p];f.disabled||(f.selected&&i.hasClass(h,"selected")?this.deselect(p):this.select(p),this.opened&&!this.el.multiple&&this.close())},m.prototype.select=function(p){var h=this.items[p],f=[].slice.call(this.el.options),C=this.options[p];if(this.el.multiple){if(i.includes(this.selectedIndexes,p))return!1;if(this.config.maxSelections&&this.tags.length===this.config.maxSelections)return this.setMessage(this.config.messages.maxSelections.replace("{max}",this.config.maxSelections),!0),!1;this.selectedValues.push(C.value),this.selectedIndexes.push(p),(function(b){var y,x=this,A=document.createDocumentFragment(),v=this.options[b.idx],_=this.data?this.data[b.idx]:v,I={class:"selectr-tag"},_=(this.customSelected?I.html=this.config.renderSelection(_):I.textContent=v.textContent,i.createElement("li",I)),I=i.createElement("button",{class:"selectr-tag-remove",type:"button"});_.appendChild(I),_.idx=b.idx,_.tag=v.value,this.tags.push(_),this.config.sortSelected?(I=this.tags.slice(),y=function(T,E){T.replace(/(\d+)|(\D+)/g,function(w,S,P){E.push([S||1/0,P||""])})},I.sort(function(T,E){var w,S,P=[],k=[];for(x.config.sortSelected===!0?(w=T.tag,S=E.tag):x.config.sortSelected==="text"&&(w=T.textContent,S=E.textContent),y(w,P),y(S,k);P.length&&k.length;){var R=P.shift(),L=k.shift(),R=R[0]-L[0]||R[1].localeCompare(L[1]);if(R)return R}return P.length-k.length}),i.each(I,function(T,E){A.appendChild(E)}),this.label.innerHTML=""):A.appendChild(_),this.config.taggable?this.label.insertBefore(A,this.input.parentNode):this.label.appendChild(A)}).call(this,h)}else{var g=this.data?this.data[p]:C;this.customSelected?this.label.innerHTML=this.config.renderSelection(g):this.label.textContent=C.textContent,this.selectedValue=C.value,this.selectedIndex=p,i.each(this.options,function(b,y){var x=this.items[b];b!==p&&(x&&i.removeClass(x,"selected"),y.selected=!1,y.removeAttribute("selected"))},this)}i.includes(f,C)||this.el.add(C),h.setAttribute("aria-selected",!0),i.addClass(h,"selected"),i.addClass(this.container,"has-selected"),C.selected=!0,C.setAttribute("selected",""),this.emit("selectr.change",C),this.emit("selectr.select",C),"createEvent"in document?((g=document.createEvent("HTMLEvents")).initEvent("change",!0,!0),g.__selfTriggered=!0,this.el.dispatchEvent(g)):this.el.fireEvent("onchange")},m.prototype.deselect=function(p,h){var f=this.items[p],C=this.options[p];if(this.el.multiple){var g=this.selectedIndexes.indexOf(p),g=(this.selectedIndexes.splice(g,1),this.selectedValues.indexOf(C.value));this.selectedValues.splice(g,1),(function(b){var y=!1;i.each(this.tags,function(x,A){A.idx===b.idx&&(y=A)},this),y&&(this.label.removeChild(y),this.tags.splice(this.tags.indexOf(y),1))}).call(this,f),this.tags.length||i.removeClass(this.container,"has-selected")}else{if(!h&&!this.config.clearable&&!this.config.allowDeselect)return!1;this.label.innerHTML="",this.selectedValue=null,this.el.selectedIndex=this.selectedIndex=-1,i.removeClass(this.container,"has-selected")}this.items[p].setAttribute("aria-selected",!1),i.removeClass(this.items[p],"selected"),C.selected=!1,C.removeAttribute("selected"),this.emit("selectr.change",null),this.emit("selectr.deselect",C),"createEvent"in document?((g=document.createEvent("HTMLEvents")).initEvent("change",!0,!0),g.__selfTriggered=!0,this.el.dispatchEvent(g)):this.el.fireEvent("onchange")},m.prototype.setValue=function(p){var h=Array.isArray(p);if(h||(p=p.toString().trim()),!this.el.multiple&&h)return!1;i.each(this.options,function(f,C){(h&&-1<p.indexOf(C.value)||C.value===p)&&this.change(C.idx)},this)},m.prototype.getValue=function(p,h){var f,C;return this.el.multiple?p?this.selectedIndexes.length&&(C={values:[]},i.each(this.selectedIndexes,function(g,b){b=this.options[b],C.values[g]={value:b.value,text:b.textContent}},this)):C=this.selectedValues.slice():C=p?{value:(f=this.options[this.selectedIndex]).value,text:f.textContent}:this.selectedValue,C=p&&h?JSON.stringify(C):C},m.prototype.add=function(p,h){if(p){if(this.data=this.data||[],this.items=this.items||[],this.options=this.options||[],Array.isArray(p))i.each(p,function(g,b){this.add(b,h)},this);else if(Object.prototype.toString.call(p)==="[object Object]"){if(h){var f=!1;if(i.each(this.options,function(g,b){b.value.toLowerCase()===p.value.toLowerCase()&&(f=!0)}),f)return!1}var C=i.createElement("option",p);return this.data.push(p),this.mobileDevice&&this.el.add(C),this.options.push(C),C.idx=0<this.options.length?this.options.length-1:0,c.call(this,C),p.selected&&this.select(C.idx),this.setPlaceholder(),C}return this.config.pagination&&this.paginate(),!0}},m.prototype.remove=function(p){var h,f=[];Array.isArray(p)?i.each(p,function(C,g){i.isInt(g)?f.push(this.getOptionByIndex(g)):typeof g=="string"&&f.push(this.getOptionByValue(g))},this):i.isInt(p)?f.push(this.getOptionByIndex(p)):typeof p=="string"&&f.push(this.getOptionByValue(p)),f.length&&(i.each(f,function(C,g){h=g.idx,this.el.remove(g),this.options.splice(h,1),g=this.items[h].parentNode,g&&g.removeChild(this.items[h]),this.items.splice(h,1),i.each(this.options,function(b,y){y.idx=b,this.items[b].idx=b},this)},this),this.setPlaceholder(),this.config.pagination)&&this.paginate()},m.prototype.removeAll=function(){this.clear(!0),i.each(this.el.options,function(p,h){this.el.remove(h)},this),i.truncate(this.tree),this.items=[],this.options=[],this.data=[],this.navIndex=0,this.requiresPagination&&(this.requiresPagination=!1,this.pageIndex=1,this.pages=[]),this.setPlaceholder()},m.prototype.search=function(p,h){var f,C,g,b,y;if(!this.navigating)return f=!1,p||(p=this.input.value,f=!0,this.removeMessage(),i.truncate(this.tree)),C=[],g=document.createDocumentFragment(),0<(p=p.trim().toLowerCase()).length?(b=h?i.startsWith:i.includes,i.each(this.options,function(x,A){var v,_,I,T,E=this.items[A.idx];b(A.textContent.trim().toLowerCase(),p)&&!A.disabled?(C.push({text:A.textContent,value:A.value}),f&&(a(E,g,this.customOption),i.removeClass(E,"excluded"),!this.customOption)&&(v=p,I=(A=A).textContent,v=new RegExp(v,"ig"),T=v.exec(I))&&(A.innerHTML="",(_=document.createElement("span")).classList.add("selectr-match"),_.textContent=T[0],A.appendChild(document.createTextNode(I.substring(0,T.index))),A.appendChild(_),A.appendChild(document.createTextNode(I.substring(v.lastIndex))))):f&&i.addClass(E,"excluded")},this),f&&(g.childElementCount?(h=this.items[this.navIndex],y=g.querySelector(".selectr-option:not(.excluded)"),this.noResults=!1,i.removeClass(h,"active"),this.navIndex=y.idx,i.addClass(y,"active")):this.config.taggable||(this.noResults=!0,this.setMessage(this.config.messages.noResults)),this.tree.appendChild(g))):l.call(this),C},m.prototype.toggle=function(){this.disabled||(this.opened?this.close():this.open())},m.prototype.open=function(){var p=this;if(!this.options.length)return!1;this.opened||this.emit("selectr.open"),this.opened=!0,this.mobileDevice||this.config.nativeDropdown?(i.addClass(this.container,"native-open"),this.config.data&&i.each(this.options,function(h,f){this.el.add(f)},this)):(i.addClass(this.container,"open"),l.call(this),this.invert(),this.tree.scrollTop=0,i.removeClass(this.container,"notice"),this.selected.setAttribute("aria-expanded",!0),this.tree.setAttribute("aria-hidden",!1),this.tree.setAttribute("aria-expanded",!0),this.config.searchable&&!this.config.taggable&&setTimeout(function(){p.input.focus(),p.input.tabIndex=0},10))},m.prototype.close=function(){var p;this.opened&&this.emit("selectr.close"),this.opened=!1,this.navigating=!1,this.mobileDevice||this.config.nativeDropdown?i.removeClass(this.container,"native-open"):(p=i.hasClass(this.container,"notice"),this.config.searchable&&!p&&(this.input.blur(),this.input.tabIndex=-1,this.searching=!1),p&&(i.removeClass(this.container,"notice"),this.notice.textContent=""),i.removeClass(this.container,"open"),i.removeClass(this.container,"native-open"),this.selected.setAttribute("aria-expanded",!1),this.tree.setAttribute("aria-hidden",!0),this.tree.setAttribute("aria-expanded",!1),i.truncate(this.tree),d.call(this))},m.prototype.enable=function(){this.disabled=!1,this.el.disabled=!1,this.selected.tabIndex=this.originalIndex,this.el.multiple&&i.each(this.tags,function(p,h){h.lastElementChild.tabIndex=0}),i.removeClass(this.container,"selectr-disabled")},m.prototype.disable=function(p){p||(this.el.disabled=!0),this.selected.tabIndex=-1,this.el.multiple&&i.each(this.tags,function(h,f){f.lastElementChild.tabIndex=-1}),this.disabled=!0,i.addClass(this.container,"selectr-disabled")},m.prototype.reset=function(){this.disabled||(this.clear(),this.setSelected(!0),i.each(this.defaultSelected,function(p,h){this.select(h)},this),this.emit("selectr.reset"))},m.prototype.clear=function(p,h){var f;this.el.multiple?this.selectedIndexes.length&&(f=this.selectedIndexes.slice(),h?this.deselect(f.slice(-1)[0]):i.each(f,function(C,g){this.deselect(g)},this)):-1<this.selectedIndex&&this.deselect(this.selectedIndex,p),this.emit("selectr.clear")},m.prototype.serialise=function(p){var h=[];return i.each(this.options,function(f,C){var g={value:C.value,text:C.textContent};C.selected&&(g.selected=!0),C.disabled&&(g.disabled=!0),h[f]=g}),p?JSON.stringify(h):h},m.prototype.serialize=function(p){return this.serialise(p)},m.prototype.setPlaceholder=function(p){p=p||this.config.placeholder||this.el.getAttribute("placeholder"),this.options.length||(p=this.config.messages.noOptions),this.placeEl.innerHTML=p},m.prototype.paginate=function(){var p;if(this.items.length)return(p=this).pages=this.items.map(function(h,f){return f%p.config.pagination==0?p.items.slice(f,f+p.config.pagination):null}).filter(function(h){return h}),this.pages},m.prototype.setMessage=function(p,h){h&&this.close(),i.addClass(this.container,"notice"),this.notice.textContent=p},m.prototype.removeMessage=function(){i.removeClass(this.container,"notice"),this.notice.innerHTML=""},m.prototype.invert=function(){var p=i.rect(this.selected),h=this.tree.parentNode.offsetHeight,f=window.innerHeight;p.top+p.height+h>f?(i.addClass(this.container,"inverted"),this.isInverted=!0):(i.removeClass(this.container,"inverted"),this.isInverted=!1),this.optsRect=i.rect(this.tree)},m.prototype.getOptionByIndex=function(p){return this.options[p]},m.prototype.getOptionByValue=function(p){for(var h=!1,f=0,C=this.options.length;f<C;f++)if(this.options[f].value.trim()===p.toString().trim()){h=this.options[f];break}return h},n.exports=m},660:function(n,o,i){"use strict";i.d(o,{Oq:function(){return a},SC:function(){return c},ai:function(){return s},hJ:function(){return l}});var s=document.body,a=10485760,l=2e4,c=2147483648},1925:function(n,o,i){"use strict";i.d(o,{p:function(){return a}});var s=i(6237);function a(l,c,u){var d,m=3<arguments.length&&arguments[3]!==void 0&&arguments[3],p=typeof(f=l).getRootNode=="function"?f.getRootNode():window,h={},f=l.getBoundingClientRect(),C=c.getBoundingClientRect(),g=document.createElement("div");function b(){if(g&&g.parentNode){for(var x in g.parentNode.removeChild(g),h)A=x,Object.prototype.hasOwnProperty.call(h,A)&&((A=h[x])&&(0,s.removeEventListener)(p,x,A),delete h[x]);typeof u=="function"&&u(l)}var A}function y(x){(x=x.target)===g||(0,s.isChildOf)(x,g)||b()}return g.className="jsoneditor-anchor",g.style.position="absolute",g.style.left=f.left-C.left+"px",g.style.top=f.top-C.top+"px",g.style.width=f.width-2+"px",g.style.height=f.height-2+"px",g.style.boxSizing="border-box",c.appendChild(g),h.mousedown=(0,s.addEventListener)(p,"mousedown",y),h.mousewheel=(0,s.addEventListener)(p,"mousewheel",y),m&&(d=null,g.onmouseover=function(){clearTimeout(d),d=null},g.onmouseout=function(){d=d||setTimeout(b,200)}),g.destroy=b,g}},5477:function(n){n.exports="data:application/javascript;base64,Im5vIHVzZSBzdHJpY3QiOwohKGZ1bmN0aW9uKHdpbmRvdykgewppZiAodHlwZW9mIHdpbmRvdy53aW5kb3cgIT0gInVuZGVmaW5lZCIgJiYgd2luZG93LmRvY3VtZW50KQogICAgcmV0dXJuOwppZiAod2luZG93LnJlcXVpcmUgJiYgd2luZG93LmRlZmluZSkKICAgIHJldHVybjsKCmlmICghd2luZG93LmNvbnNvbGUpIHsKICAgIHdpbmRvdy5jb25zb2xlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIG1zZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOwogICAgICAgIHBvc3RNZXNzYWdlKHt0eXBlOiAibG9nIiwgZGF0YTogbXNnc30pOwogICAgfTsKICAgIHdpbmRvdy5jb25zb2xlLmVycm9yID0KICAgIHdpbmRvdy5jb25zb2xlLndhcm4gPSAKICAgIHdpbmRvdy5jb25zb2xlLmxvZyA9CiAgICB3aW5kb3cuY29uc29sZS50cmFjZSA9IHdpbmRvdy5jb25zb2xlOwp9CndpbmRvdy53aW5kb3cgPSB3aW5kb3c7CndpbmRvdy5hY2UgPSB3aW5kb3c7Cgp3aW5kb3cub25lcnJvciA9IGZ1bmN0aW9uKG1lc3NhZ2UsIGZpbGUsIGxpbmUsIGNvbCwgZXJyKSB7CiAgICBwb3N0TWVzc2FnZSh7dHlwZTogImVycm9yIiwgZGF0YTogewogICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgZGF0YTogZXJyICYmIGVyci5kYXRhLAogICAgICAgIGZpbGU6IGZpbGUsCiAgICAgICAgbGluZTogbGluZSwgCiAgICAgICAgY29sOiBjb2wsCiAgICAgICAgc3RhY2s6IGVyciAmJiBlcnIuc3RhY2sKICAgIH19KTsKfTsKCndpbmRvdy5ub3JtYWxpemVNb2R1bGUgPSBmdW5jdGlvbihwYXJlbnRJZCwgbW9kdWxlTmFtZSkgewogICAgLy8gbm9ybWFsaXplIHBsdWdpbiByZXF1aXJlcwogICAgaWYgKG1vZHVsZU5hbWUuaW5kZXhPZigiISIpICE9PSAtMSkgewogICAgICAgIHZhciBjaHVua3MgPSBtb2R1bGVOYW1lLnNwbGl0KCIhIik7CiAgICAgICAgcmV0dXJuIHdpbmRvdy5ub3JtYWxpemVNb2R1bGUocGFyZW50SWQsIGNodW5rc1swXSkgKyAiISIgKyB3aW5kb3cubm9ybWFsaXplTW9kdWxlKHBhcmVudElkLCBjaHVua3NbMV0pOwogICAgfQogICAgLy8gbm9ybWFsaXplIHJlbGF0aXZlIHJlcXVpcmVzCiAgICBpZiAobW9kdWxlTmFtZS5jaGFyQXQoMCkgPT0gIi4iKSB7CiAgICAgICAgdmFyIGJhc2UgPSBwYXJlbnRJZC5zcGxpdCgiLyIpLnNsaWNlKDAsIC0xKS5qb2luKCIvIik7CiAgICAgICAgbW9kdWxlTmFtZSA9IChiYXNlID8gYmFzZSArICIvIiA6ICIiKSArIG1vZHVsZU5hbWU7CiAgICAgICAgCiAgICAgICAgd2hpbGUgKG1vZHVsZU5hbWUuaW5kZXhPZigiLiIpICE9PSAtMSAmJiBwcmV2aW91cyAhPSBtb2R1bGVOYW1lKSB7CiAgICAgICAgICAgIHZhciBwcmV2aW91cyA9IG1vZHVsZU5hbWU7CiAgICAgICAgICAgIG1vZHVsZU5hbWUgPSBtb2R1bGVOYW1lLnJlcGxhY2UoL15cLlwvLywgIiIpLnJlcGxhY2UoL1wvXC5cLy8sICIvIikucmVwbGFjZSgvW15cL10rXC9cLlwuXC8vLCAiIik7CiAgICAgICAgfQogICAgfQogICAgCiAgICByZXR1cm4gbW9kdWxlTmFtZTsKfTsKCndpbmRvdy5yZXF1aXJlID0gZnVuY3Rpb24gcmVxdWlyZShwYXJlbnRJZCwgaWQpIHsKICAgIGlmICghaWQpIHsKICAgICAgICBpZCA9IHBhcmVudElkOwogICAgICAgIHBhcmVudElkID0gbnVsbDsKICAgIH0KICAgIGlmICghaWQuY2hhckF0KQogICAgICAgIHRocm93IG5ldyBFcnJvcigid29ya2VyLmpzIHJlcXVpcmUoKSBhY2NlcHRzIG9ubHkgKHBhcmVudElkLCBpZCkgYXMgYXJndW1lbnRzIik7CgogICAgaWQgPSB3aW5kb3cubm9ybWFsaXplTW9kdWxlKHBhcmVudElkLCBpZCk7CgogICAgdmFyIG1vZHVsZSA9IHdpbmRvdy5yZXF1aXJlLm1vZHVsZXNbaWRdOwogICAgaWYgKG1vZHVsZSkgewogICAgICAgIGlmICghbW9kdWxlLmluaXRpYWxpemVkKSB7CiAgICAgICAgICAgIG1vZHVsZS5pbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gbW9kdWxlLmZhY3RvcnkoKS5leHBvcnRzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9kdWxlLmV4cG9ydHM7CiAgICB9CiAgIAogICAgaWYgKCF3aW5kb3cucmVxdWlyZS50bG5zKQogICAgICAgIHJldHVybiBjb25zb2xlLmxvZygidW5hYmxlIHRvIGxvYWQgIiArIGlkKTsKICAgIAogICAgdmFyIHBhdGggPSByZXNvbHZlTW9kdWxlSWQoaWQsIHdpbmRvdy5yZXF1aXJlLnRsbnMpOwogICAgaWYgKHBhdGguc2xpY2UoLTMpICE9ICIuanMiKSBwYXRoICs9ICIuanMiOwogICAgCiAgICB3aW5kb3cucmVxdWlyZS5pZCA9IGlkOwogICAgd2luZG93LnJlcXVpcmUubW9kdWxlc1tpZF0gPSB7fTsgLy8gcHJldmVudCBpbmZpbml0ZSBsb29wIG9uIGJyb2tlbiBtb2R1bGVzCiAgICBpbXBvcnRTY3JpcHRzKHBhdGgpOwogICAgcmV0dXJuIHdpbmRvdy5yZXF1aXJlKHBhcmVudElkLCBpZCk7Cn07CmZ1bmN0aW9uIHJlc29sdmVNb2R1bGVJZChpZCwgcGF0aHMpIHsKICAgIHZhciB0ZXN0UGF0aCA9IGlkLCB0YWlsID0gIiI7CiAgICB3aGlsZSAodGVzdFBhdGgpIHsKICAgICAgICB2YXIgYWxpYXMgPSBwYXRoc1t0ZXN0UGF0aF07CiAgICAgICAgaWYgKHR5cGVvZiBhbGlhcyA9PSAic3RyaW5nIikgewogICAgICAgICAgICByZXR1cm4gYWxpYXMgKyB0YWlsOwogICAgICAgIH0gZWxzZSBpZiAoYWxpYXMpIHsKICAgICAgICAgICAgcmV0dXJuICBhbGlhcy5sb2NhdGlvbi5yZXBsYWNlKC9cLyokLywgIi8iKSArICh0YWlsIHx8IGFsaWFzLm1haW4gfHwgYWxpYXMubmFtZSk7CiAgICAgICAgfSBlbHNlIGlmIChhbGlhcyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0KICAgICAgICB2YXIgaSA9IHRlc3RQYXRoLmxhc3RJbmRleE9mKCIvIik7CiAgICAgICAgaWYgKGkgPT09IC0xKSBicmVhazsKICAgICAgICB0YWlsID0gdGVzdFBhdGguc3Vic3RyKGkpICsgdGFpbDsKICAgICAgICB0ZXN0UGF0aCA9IHRlc3RQYXRoLnNsaWNlKDAsIGkpOwogICAgfQogICAgcmV0dXJuIGlkOwp9CndpbmRvdy5yZXF1aXJlLm1vZHVsZXMgPSB7fTsKd2luZG93LnJlcXVpcmUudGxucyA9IHt9OwoKd2luZG93LmRlZmluZSA9IGZ1bmN0aW9uKGlkLCBkZXBzLCBmYWN0b3J5KSB7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgZmFjdG9yeSA9IGRlcHM7CiAgICAgICAgaWYgKHR5cGVvZiBpZCAhPSAic3RyaW5nIikgewogICAgICAgICAgICBkZXBzID0gaWQ7CiAgICAgICAgICAgIGlkID0gd2luZG93LnJlcXVpcmUuaWQ7CiAgICAgICAgfQogICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgICBmYWN0b3J5ID0gaWQ7CiAgICAgICAgZGVwcyA9IFtdOwogICAgICAgIGlkID0gd2luZG93LnJlcXVpcmUuaWQ7CiAgICB9CiAgICAKICAgIGlmICh0eXBlb2YgZmFjdG9yeSAhPSAiZnVuY3Rpb24iKSB7CiAgICAgICAgd2luZG93LnJlcXVpcmUubW9kdWxlc1tpZF0gPSB7CiAgICAgICAgICAgIGV4cG9ydHM6IGZhY3RvcnksCiAgICAgICAgICAgIGluaXRpYWxpemVkOiB0cnVlCiAgICAgICAgfTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCFkZXBzLmxlbmd0aCkKICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBkZXBlbmRlbmNpZXMsIHdlIGluamVjdCAicmVxdWlyZSIsICJleHBvcnRzIiBhbmQKICAgICAgICAvLyAibW9kdWxlIiBhcyBkZXBlbmRlbmNpZXMsIHRvIHByb3ZpZGUgQ29tbW9uSlMgY29tcGF0aWJpbGl0eS4KICAgICAgICBkZXBzID0gWyJyZXF1aXJlIiwgImV4cG9ydHMiLCAibW9kdWxlIl07CgogICAgdmFyIHJlcSA9IGZ1bmN0aW9uKGNoaWxkSWQpIHsKICAgICAgICByZXR1cm4gd2luZG93LnJlcXVpcmUoaWQsIGNoaWxkSWQpOwogICAgfTsKCiAgICB3aW5kb3cucmVxdWlyZS5tb2R1bGVzW2lkXSA9IHsKICAgICAgICBleHBvcnRzOiB7fSwKICAgICAgICBmYWN0b3J5OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIG1vZHVsZSA9IHRoaXM7CiAgICAgICAgICAgIHZhciByZXR1cm5FeHBvcnRzID0gZmFjdG9yeS5hcHBseSh0aGlzLCBkZXBzLnNsaWNlKDAsIGZhY3RvcnkubGVuZ3RoKS5tYXAoZnVuY3Rpb24oZGVwKSB7CiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRlcCkgewogICAgICAgICAgICAgICAgICAgIC8vIEJlY2F1c2UgInJlcXVpcmUiLCAiZXhwb3J0cyIgYW5kICJtb2R1bGUiIGFyZW4ndCBhY3R1YWwKICAgICAgICAgICAgICAgICAgICAvLyBkZXBlbmRlbmNpZXMsIHdlIG11c3QgaGFuZGxlIHRoZW0gc2VwZXJhdGVseS4KICAgICAgICAgICAgICAgICAgICBjYXNlICJyZXF1aXJlIjogcmV0dXJuIHJlcTsKICAgICAgICAgICAgICAgICAgICBjYXNlICJleHBvcnRzIjogcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgICAgICAgICAgICAgICAgIGNhc2UgIm1vZHVsZSI6ICByZXR1cm4gbW9kdWxlOwogICAgICAgICAgICAgICAgICAgIC8vIEJ1dCBmb3IgYWxsIG90aGVyIGRlcGVuZGVuY2llcywgd2UgY2FuIGp1c3QgZ28gYWhlYWQgYW5kCiAgICAgICAgICAgICAgICAgICAgLy8gcmVxdWlyZSB0aGVtLgogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6ICAgICAgICByZXR1cm4gcmVxKGRlcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgaWYgKHJldHVybkV4cG9ydHMpCiAgICAgICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IHJldHVybkV4cG9ydHM7CiAgICAgICAgICAgIHJldHVybiBtb2R1bGU7CiAgICAgICAgfQogICAgfTsKfTsKd2luZG93LmRlZmluZS5hbWQgPSB7fTsKd2luZG93LnJlcXVpcmUudGxucyA9IHt9Owp3aW5kb3cuaW5pdEJhc2VVcmxzICA9IGZ1bmN0aW9uIGluaXRCYXNlVXJscyh0b3BMZXZlbE5hbWVzcGFjZXMpIHsKICAgIGZvciAodmFyIGkgaW4gdG9wTGV2ZWxOYW1lc3BhY2VzKQogICAgICAgIHRoaXMucmVxdWlyZS50bG5zW2ldID0gdG9wTGV2ZWxOYW1lc3BhY2VzW2ldOwp9OwoKd2luZG93LmluaXRTZW5kZXIgPSBmdW5jdGlvbiBpbml0U2VuZGVyKCkgewoKICAgIHZhciBFdmVudEVtaXR0ZXIgPSB3aW5kb3cucmVxdWlyZSgiYWNlL2xpYi9ldmVudF9lbWl0dGVyIikuRXZlbnRFbWl0dGVyOwogICAgdmFyIG9vcCA9IHdpbmRvdy5yZXF1aXJlKCJhY2UvbGliL29vcCIpOwogICAgCiAgICB2YXIgU2VuZGVyID0gZnVuY3Rpb24oKSB7fTsKICAgIAogICAgKGZ1bmN0aW9uKCkgewogICAgICAgIAogICAgICAgIG9vcC5pbXBsZW1lbnQodGhpcywgRXZlbnRFbWl0dGVyKTsKICAgICAgICAgICAgICAgIAogICAgICAgIHRoaXMuY2FsbGJhY2sgPSBmdW5jdGlvbihkYXRhLCBjYWxsYmFja0lkKSB7CiAgICAgICAgICAgIHBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJjYWxsIiwKICAgICAgICAgICAgICAgIGlkOiBjYWxsYmFja0lkLAogICAgICAgICAgICAgICAgZGF0YTogZGF0YQogICAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgCiAgICAgICAgdGhpcy5lbWl0ID0gZnVuY3Rpb24obmFtZSwgZGF0YSkgewogICAgICAgICAgICBwb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAiZXZlbnQiLAogICAgICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKICAgICAgICAKICAgIH0pLmNhbGwoU2VuZGVyLnByb3RvdHlwZSk7CiAgICAKICAgIHJldHVybiBuZXcgU2VuZGVyKCk7Cn07Cgp2YXIgbWFpbiA9IHdpbmRvdy5tYWluID0gbnVsbDsKdmFyIHNlbmRlciA9IHdpbmRvdy5zZW5kZXIgPSBudWxsOwoKd2luZG93Lm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpIHsKICAgIHZhciBtc2cgPSBlLmRhdGE7CiAgICBpZiAobXNnLmV2ZW50ICYmIHNlbmRlcikgewogICAgICAgIHNlbmRlci5fc2lnbmFsKG1zZy5ldmVudCwgbXNnLmRhdGEpOwogICAgfQogICAgZWxzZSBpZiAobXNnLmNvbW1hbmQpIHsKICAgICAgICBpZiAobWFpblttc2cuY29tbWFuZF0pCiAgICAgICAgICAgIG1haW5bbXNnLmNvbW1hbmRdLmFwcGx5KG1haW4sIG1zZy5hcmdzKTsKICAgICAgICBlbHNlIGlmICh3aW5kb3dbbXNnLmNvbW1hbmRdKQogICAgICAgICAgICB3aW5kb3dbbXNnLmNvbW1hbmRdLmFwcGx5KHdpbmRvdywgbXNnLmFyZ3MpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGNvbW1hbmQ6IiArIG1zZy5jb21tYW5kKTsKICAgIH0KICAgIGVsc2UgaWYgKG1zZy5pbml0KSB7CiAgICAgICAgd2luZG93LmluaXRCYXNlVXJscyhtc2cudGxucyk7CiAgICAgICAgc2VuZGVyID0gd2luZG93LnNlbmRlciA9IHdpbmRvdy5pbml0U2VuZGVyKCk7CiAgICAgICAgdmFyIGNsYXp6ID0gdGhpcy5yZXF1aXJlKG1zZy5tb2R1bGUpW21zZy5jbGFzc25hbWVdOwogICAgICAgIG1haW4gPSB3aW5kb3cubWFpbiA9IG5ldyBjbGF6eihzZW5kZXIpOwogICAgfQp9Owp9KSh0aGlzKTsKCmFjZS5kZWZpbmUoImFjZS9saWIvb29wIixbXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKXsidXNlIHN0cmljdCI7CmV4cG9ydHMuaW5oZXJpdHMgPSBmdW5jdGlvbiAoY3Rvciwgc3VwZXJDdG9yKSB7CiAgICBjdG9yLnN1cGVyXyA9IHN1cGVyQ3RvcjsKICAgIGN0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckN0b3IucHJvdG90eXBlLCB7CiAgICAgICAgY29uc3RydWN0b3I6IHsKICAgICAgICAgICAgdmFsdWU6IGN0b3IsCiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICAgICAgfQogICAgfSk7Cn07CmV4cG9ydHMubWl4aW4gPSBmdW5jdGlvbiAob2JqLCBtaXhpbikgewogICAgZm9yICh2YXIga2V5IGluIG1peGluKSB7CiAgICAgICAgb2JqW2tleV0gPSBtaXhpbltrZXldOwogICAgfQogICAgcmV0dXJuIG9iajsKfTsKZXhwb3J0cy5pbXBsZW1lbnQgPSBmdW5jdGlvbiAocHJvdG8sIG1peGluKSB7CiAgICBleHBvcnRzLm1peGluKHByb3RvLCBtaXhpbik7Cn07Cgp9KTsKCmFjZS5kZWZpbmUoImFjZS9hcHBseV9kZWx0YSIsW10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSl7InVzZSBzdHJpY3QiOwpmdW5jdGlvbiB0aHJvd0RlbHRhRXJyb3IoZGVsdGEsIGVycm9yVGV4dCkgewogICAgY29uc29sZS5sb2coIkludmFsaWQgRGVsdGE6IiwgZGVsdGEpOwogICAgdGhyb3cgIkludmFsaWQgRGVsdGE6ICIgKyBlcnJvclRleHQ7Cn0KZnVuY3Rpb24gcG9zaXRpb25JbkRvY3VtZW50KGRvY0xpbmVzLCBwb3NpdGlvbikgewogICAgcmV0dXJuIHBvc2l0aW9uLnJvdyA+PSAwICYmIHBvc2l0aW9uLnJvdyA8IGRvY0xpbmVzLmxlbmd0aCAmJgogICAgICAgIHBvc2l0aW9uLmNvbHVtbiA+PSAwICYmIHBvc2l0aW9uLmNvbHVtbiA8PSBkb2NMaW5lc1twb3NpdGlvbi5yb3ddLmxlbmd0aDsKfQpmdW5jdGlvbiB2YWxpZGF0ZURlbHRhKGRvY0xpbmVzLCBkZWx0YSkgewogICAgaWYgKGRlbHRhLmFjdGlvbiAhPSAiaW5zZXJ0IiAmJiBkZWx0YS5hY3Rpb24gIT0gInJlbW92ZSIpCiAgICAgICAgdGhyb3dEZWx0YUVycm9yKGRlbHRhLCAiZGVsdGEuYWN0aW9uIG11c3QgYmUgJ2luc2VydCcgb3IgJ3JlbW92ZSciKTsKICAgIGlmICghKGRlbHRhLmxpbmVzIGluc3RhbmNlb2YgQXJyYXkpKQogICAgICAgIHRocm93RGVsdGFFcnJvcihkZWx0YSwgImRlbHRhLmxpbmVzIG11c3QgYmUgYW4gQXJyYXkiKTsKICAgIGlmICghZGVsdGEuc3RhcnQgfHwgIWRlbHRhLmVuZCkKICAgICAgICB0aHJvd0RlbHRhRXJyb3IoZGVsdGEsICJkZWx0YS5zdGFydC9lbmQgbXVzdCBiZSBhbiBwcmVzZW50Iik7CiAgICB2YXIgc3RhcnQgPSBkZWx0YS5zdGFydDsKICAgIGlmICghcG9zaXRpb25JbkRvY3VtZW50KGRvY0xpbmVzLCBkZWx0YS5zdGFydCkpCiAgICAgICAgdGhyb3dEZWx0YUVycm9yKGRlbHRhLCAiZGVsdGEuc3RhcnQgbXVzdCBiZSBjb250YWluZWQgaW4gZG9jdW1lbnQiKTsKICAgIHZhciBlbmQgPSBkZWx0YS5lbmQ7CiAgICBpZiAoZGVsdGEuYWN0aW9uID09ICJyZW1vdmUiICYmICFwb3NpdGlvbkluRG9jdW1lbnQoZG9jTGluZXMsIGVuZCkpCiAgICAgICAgdGhyb3dEZWx0YUVycm9yKGRlbHRhLCAiZGVsdGEuZW5kIG11c3QgY29udGFpbmVkIGluIGRvY3VtZW50IGZvciAncmVtb3ZlJyBhY3Rpb25zIik7CiAgICB2YXIgbnVtUmFuZ2VSb3dzID0gZW5kLnJvdyAtIHN0YXJ0LnJvdzsKICAgIHZhciBudW1SYW5nZUxhc3RMaW5lQ2hhcnMgPSAoZW5kLmNvbHVtbiAtIChudW1SYW5nZVJvd3MgPT0gMCA/IHN0YXJ0LmNvbHVtbiA6IDApKTsKICAgIGlmIChudW1SYW5nZVJvd3MgIT0gZGVsdGEubGluZXMubGVuZ3RoIC0gMSB8fCBkZWx0YS5saW5lc1tudW1SYW5nZVJvd3NdLmxlbmd0aCAhPSBudW1SYW5nZUxhc3RMaW5lQ2hhcnMpCiAgICAgICAgdGhyb3dEZWx0YUVycm9yKGRlbHRhLCAiZGVsdGEucmFuZ2UgbXVzdCBtYXRjaCBkZWx0YSBsaW5lcyIpOwp9CmV4cG9ydHMuYXBwbHlEZWx0YSA9IGZ1bmN0aW9uIChkb2NMaW5lcywgZGVsdGEsIGRvTm90VmFsaWRhdGUpIHsKICAgIHZhciByb3cgPSBkZWx0YS5zdGFydC5yb3c7CiAgICB2YXIgc3RhcnRDb2x1bW4gPSBkZWx0YS5zdGFydC5jb2x1bW47CiAgICB2YXIgbGluZSA9IGRvY0xpbmVzW3Jvd10gfHwgIiI7CiAgICBzd2l0Y2ggKGRlbHRhLmFjdGlvbikgewogICAgICAgIGNhc2UgImluc2VydCI6CiAgICAgICAgICAgIHZhciBsaW5lcyA9IGRlbHRhLmxpbmVzOwogICAgICAgICAgICBpZiAobGluZXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgICBkb2NMaW5lc1tyb3ddID0gbGluZS5zdWJzdHJpbmcoMCwgc3RhcnRDb2x1bW4pICsgZGVsdGEubGluZXNbMF0gKyBsaW5lLnN1YnN0cmluZyhzdGFydENvbHVtbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IFtyb3csIDFdLmNvbmNhdChkZWx0YS5saW5lcyk7CiAgICAgICAgICAgICAgICBkb2NMaW5lcy5zcGxpY2UuYXBwbHkoZG9jTGluZXMsIGFyZ3MpOwogICAgICAgICAgICAgICAgZG9jTGluZXNbcm93XSA9IGxpbmUuc3Vic3RyaW5nKDAsIHN0YXJ0Q29sdW1uKSArIGRvY0xpbmVzW3Jvd107CiAgICAgICAgICAgICAgICBkb2NMaW5lc1tyb3cgKyBkZWx0YS5saW5lcy5sZW5ndGggLSAxXSArPSBsaW5lLnN1YnN0cmluZyhzdGFydENvbHVtbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicmVtb3ZlIjoKICAgICAgICAgICAgdmFyIGVuZENvbHVtbiA9IGRlbHRhLmVuZC5jb2x1bW47CiAgICAgICAgICAgIHZhciBlbmRSb3cgPSBkZWx0YS5lbmQucm93OwogICAgICAgICAgICBpZiAocm93ID09PSBlbmRSb3cpIHsKICAgICAgICAgICAgICAgIGRvY0xpbmVzW3Jvd10gPSBsaW5lLnN1YnN0cmluZygwLCBzdGFydENvbHVtbikgKyBsaW5lLnN1YnN0cmluZyhlbmRDb2x1bW4pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgZG9jTGluZXMuc3BsaWNlKHJvdywgZW5kUm93IC0gcm93ICsgMSwgbGluZS5zdWJzdHJpbmcoMCwgc3RhcnRDb2x1bW4pICsgZG9jTGluZXNbZW5kUm93XS5zdWJzdHJpbmcoZW5kQ29sdW1uKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn07Cgp9KTsKCmFjZS5kZWZpbmUoImFjZS9saWIvZXZlbnRfZW1pdHRlciIsW10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSl7InVzZSBzdHJpY3QiOwp2YXIgRXZlbnRFbWl0dGVyID0ge307CnZhciBzdG9wUHJvcGFnYXRpb24gPSBmdW5jdGlvbiAoKSB7IHRoaXMucHJvcGFnYXRpb25TdG9wcGVkID0gdHJ1ZTsgfTsKdmFyIHByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24gKCkgeyB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlOyB9OwpFdmVudEVtaXR0ZXIuX2VtaXQgPQogICAgRXZlbnRFbWl0dGVyLl9kaXNwYXRjaEV2ZW50ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZSkgewogICAgICAgIHRoaXMuX2V2ZW50UmVnaXN0cnkgfHwgKHRoaXMuX2V2ZW50UmVnaXN0cnkgPSB7fSk7CiAgICAgICAgdGhpcy5fZGVmYXVsdEhhbmRsZXJzIHx8ICh0aGlzLl9kZWZhdWx0SGFuZGxlcnMgPSB7fSk7CiAgICAgICAgdmFyIGxpc3RlbmVycyA9IHRoaXMuX2V2ZW50UmVnaXN0cnlbZXZlbnROYW1lXSB8fCBbXTsKICAgICAgICB2YXIgZGVmYXVsdEhhbmRsZXIgPSB0aGlzLl9kZWZhdWx0SGFuZGxlcnNbZXZlbnROYW1lXTsKICAgICAgICBpZiAoIWxpc3RlbmVycy5sZW5ndGggJiYgIWRlZmF1bHRIYW5kbGVyKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKHR5cGVvZiBlICE9ICJvYmplY3QiIHx8ICFlKQogICAgICAgICAgICBlID0ge307CiAgICAgICAgaWYgKCFlLnR5cGUpCiAgICAgICAgICAgIGUudHlwZSA9IGV2ZW50TmFtZTsKICAgICAgICBpZiAoIWUuc3RvcFByb3BhZ2F0aW9uKQogICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbiA9IHN0b3BQcm9wYWdhdGlvbjsKICAgICAgICBpZiAoIWUucHJldmVudERlZmF1bHQpCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQgPSBwcmV2ZW50RGVmYXVsdDsKICAgICAgICBsaXN0ZW5lcnMgPSBsaXN0ZW5lcnMuc2xpY2UoKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBsaXN0ZW5lcnNbaV0oZSwgdGhpcyk7CiAgICAgICAgICAgIGlmIChlLnByb3BhZ2F0aW9uU3RvcHBlZCkKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoZGVmYXVsdEhhbmRsZXIgJiYgIWUuZGVmYXVsdFByZXZlbnRlZCkKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRIYW5kbGVyKGUsIHRoaXMpOwogICAgfTsKRXZlbnRFbWl0dGVyLl9zaWduYWwgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBlKSB7CiAgICB2YXIgbGlzdGVuZXJzID0gKHRoaXMuX2V2ZW50UmVnaXN0cnkgfHwge30pW2V2ZW50TmFtZV07CiAgICBpZiAoIWxpc3RlbmVycykKICAgICAgICByZXR1cm47CiAgICBsaXN0ZW5lcnMgPSBsaXN0ZW5lcnMuc2xpY2UoKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKQogICAgICAgIGxpc3RlbmVyc1tpXShlLCB0aGlzKTsKfTsKRXZlbnRFbWl0dGVyLm9uY2UgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykgewogICAgdmFyIF9zZWxmID0gdGhpczsKICAgIHRoaXMub24oZXZlbnROYW1lLCBmdW5jdGlvbiBuZXdDYWxsYmFjaygpIHsKICAgICAgICBfc2VsZi5vZmYoZXZlbnROYW1lLCBuZXdDYWxsYmFjayk7CiAgICAgICAgY2FsbGJhY2suYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgIH0pOwogICAgaWYgKCFjYWxsYmFjaykgewogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICBjYWxsYmFjayA9IHJlc29sdmU7CiAgICAgICAgfSk7CiAgICB9Cn07CkV2ZW50RW1pdHRlci5zZXREZWZhdWx0SGFuZGxlciA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7CiAgICB2YXIgaGFuZGxlcnMgPSB0aGlzLl9kZWZhdWx0SGFuZGxlcnM7CiAgICBpZiAoIWhhbmRsZXJzKQogICAgICAgIGhhbmRsZXJzID0gdGhpcy5fZGVmYXVsdEhhbmRsZXJzID0geyBfZGlzYWJsZWRfOiB7fSB9OwogICAgaWYgKGhhbmRsZXJzW2V2ZW50TmFtZV0pIHsKICAgICAgICB2YXIgb2xkID0gaGFuZGxlcnNbZXZlbnROYW1lXTsKICAgICAgICB2YXIgZGlzYWJsZWQgPSBoYW5kbGVycy5fZGlzYWJsZWRfW2V2ZW50TmFtZV07CiAgICAgICAgaWYgKCFkaXNhYmxlZCkKICAgICAgICAgICAgaGFuZGxlcnMuX2Rpc2FibGVkX1tldmVudE5hbWVdID0gZGlzYWJsZWQgPSBbXTsKICAgICAgICBkaXNhYmxlZC5wdXNoKG9sZCk7CiAgICAgICAgdmFyIGkgPSBkaXNhYmxlZC5pbmRleE9mKGNhbGxiYWNrKTsKICAgICAgICBpZiAoaSAhPSAtMSkKICAgICAgICAgICAgZGlzYWJsZWQuc3BsaWNlKGksIDEpOwogICAgfQogICAgaGFuZGxlcnNbZXZlbnROYW1lXSA9IGNhbGxiYWNrOwp9OwpFdmVudEVtaXR0ZXIucmVtb3ZlRGVmYXVsdEhhbmRsZXIgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaykgewogICAgdmFyIGhhbmRsZXJzID0gdGhpcy5fZGVmYXVsdEhhbmRsZXJzOwogICAgaWYgKCFoYW5kbGVycykKICAgICAgICByZXR1cm47CiAgICB2YXIgZGlzYWJsZWQgPSBoYW5kbGVycy5fZGlzYWJsZWRfW2V2ZW50TmFtZV07CiAgICBpZiAoaGFuZGxlcnNbZXZlbnROYW1lXSA9PSBjYWxsYmFjaykgewogICAgICAgIGlmIChkaXNhYmxlZCkKICAgICAgICAgICAgdGhpcy5zZXREZWZhdWx0SGFuZGxlcihldmVudE5hbWUsIGRpc2FibGVkLnBvcCgpKTsKICAgIH0KICAgIGVsc2UgaWYgKGRpc2FibGVkKSB7CiAgICAgICAgdmFyIGkgPSBkaXNhYmxlZC5pbmRleE9mKGNhbGxiYWNrKTsKICAgICAgICBpZiAoaSAhPSAtMSkKICAgICAgICAgICAgZGlzYWJsZWQuc3BsaWNlKGksIDEpOwogICAgfQp9OwpFdmVudEVtaXR0ZXIub24gPQogICAgRXZlbnRFbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBjYWxsYmFjaywgY2FwdHVyaW5nKSB7CiAgICAgICAgdGhpcy5fZXZlbnRSZWdpc3RyeSA9IHRoaXMuX2V2ZW50UmVnaXN0cnkgfHwge307CiAgICAgICAgdmFyIGxpc3RlbmVycyA9IHRoaXMuX2V2ZW50UmVnaXN0cnlbZXZlbnROYW1lXTsKICAgICAgICBpZiAoIWxpc3RlbmVycykKICAgICAgICAgICAgbGlzdGVuZXJzID0gdGhpcy5fZXZlbnRSZWdpc3RyeVtldmVudE5hbWVdID0gW107CiAgICAgICAgaWYgKGxpc3RlbmVycy5pbmRleE9mKGNhbGxiYWNrKSA9PSAtMSkKICAgICAgICAgICAgbGlzdGVuZXJzW2NhcHR1cmluZyA/ICJ1bnNoaWZ0IiA6ICJwdXNoIl0oY2FsbGJhY2spOwogICAgICAgIHJldHVybiBjYWxsYmFjazsKICAgIH07CkV2ZW50RW1pdHRlci5vZmYgPQogICAgRXZlbnRFbWl0dGVyLnJlbW92ZUxpc3RlbmVyID0KICAgICAgICBFdmVudEVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHRoaXMuX2V2ZW50UmVnaXN0cnkgPSB0aGlzLl9ldmVudFJlZ2lzdHJ5IHx8IHt9OwogICAgICAgICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5fZXZlbnRSZWdpc3RyeVtldmVudE5hbWVdOwogICAgICAgICAgICBpZiAoIWxpc3RlbmVycykKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgdmFyIGluZGV4ID0gbGlzdGVuZXJzLmluZGV4T2YoY2FsbGJhY2spOwogICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKQogICAgICAgICAgICAgICAgbGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgfTsKRXZlbnRFbWl0dGVyLnJlbW92ZUFsbExpc3RlbmVycyA9IGZ1bmN0aW9uIChldmVudE5hbWUpIHsKICAgIGlmICghZXZlbnROYW1lKQogICAgICAgIHRoaXMuX2V2ZW50UmVnaXN0cnkgPSB0aGlzLl9kZWZhdWx0SGFuZGxlcnMgPSB1bmRlZmluZWQ7CiAgICBpZiAodGhpcy5fZXZlbnRSZWdpc3RyeSkKICAgICAgICB0aGlzLl9ldmVudFJlZ2lzdHJ5W2V2ZW50TmFtZV0gPSB1bmRlZmluZWQ7CiAgICBpZiAodGhpcy5fZGVmYXVsdEhhbmRsZXJzKQogICAgICAgIHRoaXMuX2RlZmF1bHRIYW5kbGVyc1tldmVudE5hbWVdID0gdW5kZWZpbmVkOwp9OwpleHBvcnRzLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjsKCn0pOwoKYWNlLmRlZmluZSgiYWNlL3JhbmdlIixbXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKXsidXNlIHN0cmljdCI7CnZhciBSYW5nZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIFJhbmdlKHN0YXJ0Um93LCBzdGFydENvbHVtbiwgZW5kUm93LCBlbmRDb2x1bW4pIHsKICAgICAgICB0aGlzLnN0YXJ0ID0gewogICAgICAgICAgICByb3c6IHN0YXJ0Um93LAogICAgICAgICAgICBjb2x1bW46IHN0YXJ0Q29sdW1uCiAgICAgICAgfTsKICAgICAgICB0aGlzLmVuZCA9IHsKICAgICAgICAgICAgcm93OiBlbmRSb3csCiAgICAgICAgICAgIGNvbHVtbjogZW5kQ29sdW1uCiAgICAgICAgfTsKICAgIH0KICAgIFJhbmdlLnByb3RvdHlwZS5pc0VxdWFsID0gZnVuY3Rpb24gKHJhbmdlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnQucm93ID09PSByYW5nZS5zdGFydC5yb3cgJiYKICAgICAgICAgICAgdGhpcy5lbmQucm93ID09PSByYW5nZS5lbmQucm93ICYmCiAgICAgICAgICAgIHRoaXMuc3RhcnQuY29sdW1uID09PSByYW5nZS5zdGFydC5jb2x1bW4gJiYKICAgICAgICAgICAgdGhpcy5lbmQuY29sdW1uID09PSByYW5nZS5lbmQuY29sdW1uOwogICAgfTsKICAgIFJhbmdlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gKCJSYW5nZTogWyIgKyB0aGlzLnN0YXJ0LnJvdyArICIvIiArIHRoaXMuc3RhcnQuY29sdW1uICsKICAgICAgICAgICAgIl0gLT4gWyIgKyB0aGlzLmVuZC5yb3cgKyAiLyIgKyB0aGlzLmVuZC5jb2x1bW4gKyAiXSIpOwogICAgfTsKICAgIFJhbmdlLnByb3RvdHlwZS5jb250YWlucyA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUocm93LCBjb2x1bW4pID09IDA7CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLmNvbXBhcmVSYW5nZSA9IGZ1bmN0aW9uIChyYW5nZSkgewogICAgICAgIHZhciBjbXAsIGVuZCA9IHJhbmdlLmVuZCwgc3RhcnQgPSByYW5nZS5zdGFydDsKICAgICAgICBjbXAgPSB0aGlzLmNvbXBhcmUoZW5kLnJvdywgZW5kLmNvbHVtbik7CiAgICAgICAgaWYgKGNtcCA9PSAxKSB7CiAgICAgICAgICAgIGNtcCA9IHRoaXMuY29tcGFyZShzdGFydC5yb3csIHN0YXJ0LmNvbHVtbik7CiAgICAgICAgICAgIGlmIChjbXAgPT0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY21wID09IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoY21wID09IC0xKSB7CiAgICAgICAgICAgIHJldHVybiAtMjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNtcCA9IHRoaXMuY29tcGFyZShzdGFydC5yb3csIHN0YXJ0LmNvbHVtbik7CiAgICAgICAgICAgIGlmIChjbXAgPT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChjbXAgPT0gMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDQyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLmNvbXBhcmVQb2ludCA9IGZ1bmN0aW9uIChwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZShwLnJvdywgcC5jb2x1bW4pOwogICAgfTsKICAgIFJhbmdlLnByb3RvdHlwZS5jb250YWluc1JhbmdlID0gZnVuY3Rpb24gKHJhbmdlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZVBvaW50KHJhbmdlLnN0YXJ0KSA9PSAwICYmIHRoaXMuY29tcGFyZVBvaW50KHJhbmdlLmVuZCkgPT0gMDsKICAgIH07CiAgICBSYW5nZS5wcm90b3R5cGUuaW50ZXJzZWN0cyA9IGZ1bmN0aW9uIChyYW5nZSkgewogICAgICAgIHZhciBjbXAgPSB0aGlzLmNvbXBhcmVSYW5nZShyYW5nZSk7CiAgICAgICAgcmV0dXJuIChjbXAgPT0gLTEgfHwgY21wID09IDAgfHwgY21wID09IDEpOwogICAgfTsKICAgIFJhbmdlLnByb3RvdHlwZS5pc0VuZCA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgICAgIHJldHVybiB0aGlzLmVuZC5yb3cgPT0gcm93ICYmIHRoaXMuZW5kLmNvbHVtbiA9PSBjb2x1bW47CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLmlzU3RhcnQgPSBmdW5jdGlvbiAocm93LCBjb2x1bW4pIHsKICAgICAgICByZXR1cm4gdGhpcy5zdGFydC5yb3cgPT0gcm93ICYmIHRoaXMuc3RhcnQuY29sdW1uID09IGNvbHVtbjsKICAgIH07CiAgICBSYW5nZS5wcm90b3R5cGUuc2V0U3RhcnQgPSBmdW5jdGlvbiAocm93LCBjb2x1bW4pIHsKICAgICAgICBpZiAodHlwZW9mIHJvdyA9PSAib2JqZWN0IikgewogICAgICAgICAgICB0aGlzLnN0YXJ0LmNvbHVtbiA9IHJvdy5jb2x1bW47CiAgICAgICAgICAgIHRoaXMuc3RhcnQucm93ID0gcm93LnJvdzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc3RhcnQucm93ID0gcm93OwogICAgICAgICAgICB0aGlzLnN0YXJ0LmNvbHVtbiA9IGNvbHVtbjsKICAgICAgICB9CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLnNldEVuZCA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgICAgIGlmICh0eXBlb2Ygcm93ID09ICJvYmplY3QiKSB7CiAgICAgICAgICAgIHRoaXMuZW5kLmNvbHVtbiA9IHJvdy5jb2x1bW47CiAgICAgICAgICAgIHRoaXMuZW5kLnJvdyA9IHJvdy5yb3c7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLmVuZC5yb3cgPSByb3c7CiAgICAgICAgICAgIHRoaXMuZW5kLmNvbHVtbiA9IGNvbHVtbjsKICAgICAgICB9CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLmluc2lkZSA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgICAgIGlmICh0aGlzLmNvbXBhcmUocm93LCBjb2x1bW4pID09IDApIHsKICAgICAgICAgICAgaWYgKHRoaXMuaXNFbmQocm93LCBjb2x1bW4pIHx8IHRoaXMuaXNTdGFydChyb3csIGNvbHVtbikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CiAgICBSYW5nZS5wcm90b3R5cGUuaW5zaWRlU3RhcnQgPSBmdW5jdGlvbiAocm93LCBjb2x1bW4pIHsKICAgICAgICBpZiAodGhpcy5jb21wYXJlKHJvdywgY29sdW1uKSA9PSAwKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzRW5kKHJvdywgY29sdW1uKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKICAgIFJhbmdlLnByb3RvdHlwZS5pbnNpZGVFbmQgPSBmdW5jdGlvbiAocm93LCBjb2x1bW4pIHsKICAgICAgICBpZiAodGhpcy5jb21wYXJlKHJvdywgY29sdW1uKSA9PSAwKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmlzU3RhcnQocm93LCBjb2x1bW4pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiAocm93LCBjb2x1bW4pIHsKICAgICAgICBpZiAoIXRoaXMuaXNNdWx0aUxpbmUoKSkgewogICAgICAgICAgICBpZiAocm93ID09PSB0aGlzLnN0YXJ0LnJvdykgewogICAgICAgICAgICAgICAgcmV0dXJuIGNvbHVtbiA8IHRoaXMuc3RhcnQuY29sdW1uID8gLTEgOiAoY29sdW1uID4gdGhpcy5lbmQuY29sdW1uID8gMSA6IDApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChyb3cgPCB0aGlzLnN0YXJ0LnJvdykKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIGlmIChyb3cgPiB0aGlzLmVuZC5yb3cpCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIGlmICh0aGlzLnN0YXJ0LnJvdyA9PT0gcm93KQogICAgICAgICAgICByZXR1cm4gY29sdW1uID49IHRoaXMuc3RhcnQuY29sdW1uID8gMCA6IC0xOwogICAgICAgIGlmICh0aGlzLmVuZC5yb3cgPT09IHJvdykKICAgICAgICAgICAgcmV0dXJuIGNvbHVtbiA8PSB0aGlzLmVuZC5jb2x1bW4gPyAwIDogMTsKICAgICAgICByZXR1cm4gMDsKICAgIH07CiAgICBSYW5nZS5wcm90b3R5cGUuY29tcGFyZVN0YXJ0ID0gZnVuY3Rpb24gKHJvdywgY29sdW1uKSB7CiAgICAgICAgaWYgKHRoaXMuc3RhcnQucm93ID09IHJvdyAmJiB0aGlzLnN0YXJ0LmNvbHVtbiA9PSBjb2x1bW4pIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZShyb3csIGNvbHVtbik7CiAgICAgICAgfQogICAgfTsKICAgIFJhbmdlLnByb3RvdHlwZS5jb21wYXJlRW5kID0gZnVuY3Rpb24gKHJvdywgY29sdW1uKSB7CiAgICAgICAgaWYgKHRoaXMuZW5kLnJvdyA9PSByb3cgJiYgdGhpcy5lbmQuY29sdW1uID09IGNvbHVtbikgewogICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbXBhcmUocm93LCBjb2x1bW4pOwogICAgICAgIH0KICAgIH07CiAgICBSYW5nZS5wcm90b3R5cGUuY29tcGFyZUluc2lkZSA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgICAgIGlmICh0aGlzLmVuZC5yb3cgPT0gcm93ICYmIHRoaXMuZW5kLmNvbHVtbiA9PSBjb2x1bW4pIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHRoaXMuc3RhcnQucm93ID09IHJvdyAmJiB0aGlzLnN0YXJ0LmNvbHVtbiA9PSBjb2x1bW4pIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZShyb3csIGNvbHVtbik7CiAgICAgICAgfQogICAgfTsKICAgIFJhbmdlLnByb3RvdHlwZS5jbGlwUm93cyA9IGZ1bmN0aW9uIChmaXJzdFJvdywgbGFzdFJvdykgewogICAgICAgIGlmICh0aGlzLmVuZC5yb3cgPiBsYXN0Um93KQogICAgICAgICAgICB2YXIgZW5kID0geyByb3c6IGxhc3RSb3cgKyAxLCBjb2x1bW46IDAgfTsKICAgICAgICBlbHNlIGlmICh0aGlzLmVuZC5yb3cgPCBmaXJzdFJvdykKICAgICAgICAgICAgdmFyIGVuZCA9IHsgcm93OiBmaXJzdFJvdywgY29sdW1uOiAwIH07CiAgICAgICAgaWYgKHRoaXMuc3RhcnQucm93ID4gbGFzdFJvdykKICAgICAgICAgICAgdmFyIHN0YXJ0ID0geyByb3c6IGxhc3RSb3cgKyAxLCBjb2x1bW46IDAgfTsKICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXJ0LnJvdyA8IGZpcnN0Um93KQogICAgICAgICAgICB2YXIgc3RhcnQgPSB7IHJvdzogZmlyc3RSb3csIGNvbHVtbjogMCB9OwogICAgICAgIHJldHVybiBSYW5nZS5mcm9tUG9pbnRzKHN0YXJ0IHx8IHRoaXMuc3RhcnQsIGVuZCB8fCB0aGlzLmVuZCk7CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLmV4dGVuZCA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgICAgIHZhciBjbXAgPSB0aGlzLmNvbXBhcmUocm93LCBjb2x1bW4pOwogICAgICAgIGlmIChjbXAgPT0gMCkKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgZWxzZSBpZiAoY21wID09IC0xKQogICAgICAgICAgICB2YXIgc3RhcnQgPSB7IHJvdzogcm93LCBjb2x1bW46IGNvbHVtbiB9OwogICAgICAgIGVsc2UKICAgICAgICAgICAgdmFyIGVuZCA9IHsgcm93OiByb3csIGNvbHVtbjogY29sdW1uIH07CiAgICAgICAgcmV0dXJuIFJhbmdlLmZyb21Qb2ludHMoc3RhcnQgfHwgdGhpcy5zdGFydCwgZW5kIHx8IHRoaXMuZW5kKTsKICAgIH07CiAgICBSYW5nZS5wcm90b3R5cGUuaXNFbXB0eSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gKHRoaXMuc3RhcnQucm93ID09PSB0aGlzLmVuZC5yb3cgJiYgdGhpcy5zdGFydC5jb2x1bW4gPT09IHRoaXMuZW5kLmNvbHVtbik7CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLmlzTXVsdGlMaW5lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiAodGhpcy5zdGFydC5yb3cgIT09IHRoaXMuZW5kLnJvdyk7CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLmNsb25lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBSYW5nZS5mcm9tUG9pbnRzKHRoaXMuc3RhcnQsIHRoaXMuZW5kKTsKICAgIH07CiAgICBSYW5nZS5wcm90b3R5cGUuY29sbGFwc2VSb3dzID0gZnVuY3Rpb24gKCkgewogICAgICAgIGlmICh0aGlzLmVuZC5jb2x1bW4gPT0gMCkKICAgICAgICAgICAgcmV0dXJuIG5ldyBSYW5nZSh0aGlzLnN0YXJ0LnJvdywgMCwgTWF0aC5tYXgodGhpcy5zdGFydC5yb3csIHRoaXMuZW5kLnJvdyAtIDEpLCAwKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiBuZXcgUmFuZ2UodGhpcy5zdGFydC5yb3csIDAsIHRoaXMuZW5kLnJvdywgMCk7CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLnRvU2NyZWVuUmFuZ2UgPSBmdW5jdGlvbiAoc2Vzc2lvbikgewogICAgICAgIHZhciBzY3JlZW5Qb3NTdGFydCA9IHNlc3Npb24uZG9jdW1lbnRUb1NjcmVlblBvc2l0aW9uKHRoaXMuc3RhcnQpOwogICAgICAgIHZhciBzY3JlZW5Qb3NFbmQgPSBzZXNzaW9uLmRvY3VtZW50VG9TY3JlZW5Qb3NpdGlvbih0aGlzLmVuZCk7CiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZShzY3JlZW5Qb3NTdGFydC5yb3csIHNjcmVlblBvc1N0YXJ0LmNvbHVtbiwgc2NyZWVuUG9zRW5kLnJvdywgc2NyZWVuUG9zRW5kLmNvbHVtbik7CiAgICB9OwogICAgUmFuZ2UucHJvdG90eXBlLm1vdmVCeSA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgICAgIHRoaXMuc3RhcnQucm93ICs9IHJvdzsKICAgICAgICB0aGlzLnN0YXJ0LmNvbHVtbiArPSBjb2x1bW47CiAgICAgICAgdGhpcy5lbmQucm93ICs9IHJvdzsKICAgICAgICB0aGlzLmVuZC5jb2x1bW4gKz0gY29sdW1uOwogICAgfTsKICAgIHJldHVybiBSYW5nZTsKfSgpKTsKUmFuZ2UuZnJvbVBvaW50cyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7CiAgICByZXR1cm4gbmV3IFJhbmdlKHN0YXJ0LnJvdywgc3RhcnQuY29sdW1uLCBlbmQucm93LCBlbmQuY29sdW1uKTsKfTsKUmFuZ2UuY29tcGFyZVBvaW50cyA9IGZ1bmN0aW9uIChwMSwgcDIpIHsKICAgIHJldHVybiBwMS5yb3cgLSBwMi5yb3cgfHwgcDEuY29sdW1uIC0gcDIuY29sdW1uOwp9OwpleHBvcnRzLlJhbmdlID0gUmFuZ2U7Cgp9KTsKCmFjZS5kZWZpbmUoImFjZS9hbmNob3IiLFtdLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpeyJ1c2Ugc3RyaWN0IjsKdmFyIG9vcCA9IHJlcXVpcmUoIi4vbGliL29vcCIpOwp2YXIgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgiLi9saWIvZXZlbnRfZW1pdHRlciIpLkV2ZW50RW1pdHRlcjsKdmFyIEFuY2hvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKICAgIGZ1bmN0aW9uIEFuY2hvcihkb2MsIHJvdywgY29sdW1uKSB7CiAgICAgICAgdGhpcy4kb25DaGFuZ2UgPSB0aGlzLm9uQ2hhbmdlLmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5hdHRhY2goZG9jKTsKICAgICAgICBpZiAodHlwZW9mIHJvdyAhPSAibnVtYmVyIikKICAgICAgICAgICAgdGhpcy5zZXRQb3NpdGlvbihyb3cucm93LCByb3cuY29sdW1uKTsKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24ocm93LCBjb2x1bW4pOwogICAgfQogICAgQW5jaG9yLnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy4kY2xpcFBvc2l0aW9uVG9Eb2N1bWVudCh0aGlzLnJvdywgdGhpcy5jb2x1bW4pOwogICAgfTsKICAgIEFuY2hvci5wcm90b3R5cGUuZ2V0RG9jdW1lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZG9jdW1lbnQ7CiAgICB9OwogICAgQW5jaG9yLnByb3RvdHlwZS5vbkNoYW5nZSA9IGZ1bmN0aW9uIChkZWx0YSkgewogICAgICAgIGlmIChkZWx0YS5zdGFydC5yb3cgPT0gZGVsdGEuZW5kLnJvdyAmJiBkZWx0YS5zdGFydC5yb3cgIT0gdGhpcy5yb3cpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoZGVsdGEuc3RhcnQucm93ID4gdGhpcy5yb3cpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgcG9pbnQgPSAkZ2V0VHJhbnNmb3JtZWRQb2ludChkZWx0YSwgeyByb3c6IHRoaXMucm93LCBjb2x1bW46IHRoaXMuY29sdW1uIH0sIHRoaXMuJGluc2VydFJpZ2h0KTsKICAgICAgICB0aGlzLnNldFBvc2l0aW9uKHBvaW50LnJvdywgcG9pbnQuY29sdW1uLCB0cnVlKTsKICAgIH07CiAgICBBbmNob3IucHJvdG90eXBlLnNldFBvc2l0aW9uID0gZnVuY3Rpb24gKHJvdywgY29sdW1uLCBub0NsaXApIHsKICAgICAgICB2YXIgcG9zOwogICAgICAgIGlmIChub0NsaXApIHsKICAgICAgICAgICAgcG9zID0gewogICAgICAgICAgICAgICAgcm93OiByb3csCiAgICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbgogICAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcG9zID0gdGhpcy4kY2xpcFBvc2l0aW9uVG9Eb2N1bWVudChyb3csIGNvbHVtbik7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnJvdyA9PSBwb3Mucm93ICYmIHRoaXMuY29sdW1uID09IHBvcy5jb2x1bW4pCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgb2xkID0gewogICAgICAgICAgICByb3c6IHRoaXMucm93LAogICAgICAgICAgICBjb2x1bW46IHRoaXMuY29sdW1uCiAgICAgICAgfTsKICAgICAgICB0aGlzLnJvdyA9IHBvcy5yb3c7CiAgICAgICAgdGhpcy5jb2x1bW4gPSBwb3MuY29sdW1uOwogICAgICAgIHRoaXMuX3NpZ25hbCgiY2hhbmdlIiwgewogICAgICAgICAgICBvbGQ6IG9sZCwKICAgICAgICAgICAgdmFsdWU6IHBvcwogICAgICAgIH0pOwogICAgfTsKICAgIEFuY2hvci5wcm90b3R5cGUuZGV0YWNoID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuZG9jdW1lbnQub2ZmKCJjaGFuZ2UiLCB0aGlzLiRvbkNoYW5nZSk7CiAgICB9OwogICAgQW5jaG9yLnByb3RvdHlwZS5hdHRhY2ggPSBmdW5jdGlvbiAoZG9jKSB7CiAgICAgICAgdGhpcy5kb2N1bWVudCA9IGRvYyB8fCB0aGlzLmRvY3VtZW50OwogICAgICAgIHRoaXMuZG9jdW1lbnQub24oImNoYW5nZSIsIHRoaXMuJG9uQ2hhbmdlKTsKICAgIH07CiAgICBBbmNob3IucHJvdG90eXBlLiRjbGlwUG9zaXRpb25Ub0RvY3VtZW50ID0gZnVuY3Rpb24gKHJvdywgY29sdW1uKSB7CiAgICAgICAgdmFyIHBvcyA9IHt9OwogICAgICAgIGlmIChyb3cgPj0gdGhpcy5kb2N1bWVudC5nZXRMZW5ndGgoKSkgewogICAgICAgICAgICBwb3Mucm93ID0gTWF0aC5tYXgoMCwgdGhpcy5kb2N1bWVudC5nZXRMZW5ndGgoKSAtIDEpOwogICAgICAgICAgICBwb3MuY29sdW1uID0gdGhpcy5kb2N1bWVudC5nZXRMaW5lKHBvcy5yb3cpLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocm93IDwgMCkgewogICAgICAgICAgICBwb3Mucm93ID0gMDsKICAgICAgICAgICAgcG9zLmNvbHVtbiA9IDA7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBwb3Mucm93ID0gcm93OwogICAgICAgICAgICBwb3MuY29sdW1uID0gTWF0aC5taW4odGhpcy5kb2N1bWVudC5nZXRMaW5lKHBvcy5yb3cpLmxlbmd0aCwgTWF0aC5tYXgoMCwgY29sdW1uKSk7CiAgICAgICAgfQogICAgICAgIGlmIChjb2x1bW4gPCAwKQogICAgICAgICAgICBwb3MuY29sdW1uID0gMDsKICAgICAgICByZXR1cm4gcG9zOwogICAgfTsKICAgIHJldHVybiBBbmNob3I7Cn0oKSk7CkFuY2hvci5wcm90b3R5cGUuJGluc2VydFJpZ2h0ID0gZmFsc2U7Cm9vcC5pbXBsZW1lbnQoQW5jaG9yLnByb3RvdHlwZSwgRXZlbnRFbWl0dGVyKTsKZnVuY3Rpb24gJHBvaW50c0luT3JkZXIocG9pbnQxLCBwb2ludDIsIGVxdWFsUG9pbnRzSW5PcmRlcikgewogICAgdmFyIGJDb2xJc0FmdGVyID0gZXF1YWxQb2ludHNJbk9yZGVyID8gcG9pbnQxLmNvbHVtbiA8PSBwb2ludDIuY29sdW1uIDogcG9pbnQxLmNvbHVtbiA8IHBvaW50Mi5jb2x1bW47CiAgICByZXR1cm4gKHBvaW50MS5yb3cgPCBwb2ludDIucm93KSB8fCAocG9pbnQxLnJvdyA9PSBwb2ludDIucm93ICYmIGJDb2xJc0FmdGVyKTsKfQpmdW5jdGlvbiAkZ2V0VHJhbnNmb3JtZWRQb2ludChkZWx0YSwgcG9pbnQsIG1vdmVJZkVxdWFsKSB7CiAgICB2YXIgZGVsdGFJc0luc2VydCA9IGRlbHRhLmFjdGlvbiA9PSAiaW5zZXJ0IjsKICAgIHZhciBkZWx0YVJvd1NoaWZ0ID0gKGRlbHRhSXNJbnNlcnQgPyAxIDogLTEpICogKGRlbHRhLmVuZC5yb3cgLSBkZWx0YS5zdGFydC5yb3cpOwogICAgdmFyIGRlbHRhQ29sU2hpZnQgPSAoZGVsdGFJc0luc2VydCA/IDEgOiAtMSkgKiAoZGVsdGEuZW5kLmNvbHVtbiAtIGRlbHRhLnN0YXJ0LmNvbHVtbik7CiAgICB2YXIgZGVsdGFTdGFydCA9IGRlbHRhLnN0YXJ0OwogICAgdmFyIGRlbHRhRW5kID0gZGVsdGFJc0luc2VydCA/IGRlbHRhU3RhcnQgOiBkZWx0YS5lbmQ7IC8vIENvbGxhcHNlIGluc2VydCByYW5nZS4KICAgIGlmICgkcG9pbnRzSW5PcmRlcihwb2ludCwgZGVsdGFTdGFydCwgbW92ZUlmRXF1YWwpKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcm93OiBwb2ludC5yb3csCiAgICAgICAgICAgIGNvbHVtbjogcG9pbnQuY29sdW1uCiAgICAgICAgfTsKICAgIH0KICAgIGlmICgkcG9pbnRzSW5PcmRlcihkZWx0YUVuZCwgcG9pbnQsICFtb3ZlSWZFcXVhbCkpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICByb3c6IHBvaW50LnJvdyArIGRlbHRhUm93U2hpZnQsCiAgICAgICAgICAgIGNvbHVtbjogcG9pbnQuY29sdW1uICsgKHBvaW50LnJvdyA9PSBkZWx0YUVuZC5yb3cgPyBkZWx0YUNvbFNoaWZ0IDogMCkKICAgICAgICB9OwogICAgfQogICAgcmV0dXJuIHsKICAgICAgICByb3c6IGRlbHRhU3RhcnQucm93LAogICAgICAgIGNvbHVtbjogZGVsdGFTdGFydC5jb2x1bW4KICAgIH07Cn0KZXhwb3J0cy5BbmNob3IgPSBBbmNob3I7Cgp9KTsKCmFjZS5kZWZpbmUoImFjZS9kb2N1bWVudCIsW10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSl7InVzZSBzdHJpY3QiOwp2YXIgb29wID0gcmVxdWlyZSgiLi9saWIvb29wIik7CnZhciBhcHBseURlbHRhID0gcmVxdWlyZSgiLi9hcHBseV9kZWx0YSIpLmFwcGx5RGVsdGE7CnZhciBFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCIuL2xpYi9ldmVudF9lbWl0dGVyIikuRXZlbnRFbWl0dGVyOwp2YXIgUmFuZ2UgPSByZXF1aXJlKCIuL3JhbmdlIikuUmFuZ2U7CnZhciBBbmNob3IgPSByZXF1aXJlKCIuL2FuY2hvciIpLkFuY2hvcjsKdmFyIERvY3VtZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gRG9jdW1lbnQodGV4dE9yTGluZXMpIHsKICAgICAgICB0aGlzLiRsaW5lcyA9IFsiIl07CiAgICAgICAgaWYgKHRleHRPckxpbmVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICB0aGlzLiRsaW5lcyA9IFsiIl07CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkodGV4dE9yTGluZXMpKSB7CiAgICAgICAgICAgIHRoaXMuaW5zZXJ0TWVyZ2VkTGluZXMoeyByb3c6IDAsIGNvbHVtbjogMCB9LCB0ZXh0T3JMaW5lcyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLmluc2VydCh7IHJvdzogMCwgY29sdW1uOiAwIH0sIHRleHRPckxpbmVzKTsKICAgICAgICB9CiAgICB9CiAgICBEb2N1bWVudC5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiAodGV4dCkgewogICAgICAgIHZhciBsZW4gPSB0aGlzLmdldExlbmd0aCgpIC0gMTsKICAgICAgICB0aGlzLnJlbW92ZShuZXcgUmFuZ2UoMCwgMCwgbGVuLCB0aGlzLmdldExpbmUobGVuKS5sZW5ndGgpKTsKICAgICAgICB0aGlzLmluc2VydCh7IHJvdzogMCwgY29sdW1uOiAwIH0sIHRleHQgfHwgIiIpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxMaW5lcygpLmpvaW4odGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5jcmVhdGVBbmNob3IgPSBmdW5jdGlvbiAocm93LCBjb2x1bW4pIHsKICAgICAgICByZXR1cm4gbmV3IEFuY2hvcih0aGlzLCByb3csIGNvbHVtbik7CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLiRkZXRlY3ROZXdMaW5lID0gZnVuY3Rpb24gKHRleHQpIHsKICAgICAgICB2YXIgbWF0Y2ggPSB0ZXh0Lm1hdGNoKC9eLio/KFxyXG58XHJ8XG4pL20pOwogICAgICAgIHRoaXMuJGF1dG9OZXdMaW5lID0gbWF0Y2ggPyBtYXRjaFsxXSA6ICJcbiI7CiAgICAgICAgdGhpcy5fc2lnbmFsKCJjaGFuZ2VOZXdMaW5lTW9kZSIpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5nZXROZXdMaW5lQ2hhcmFjdGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHN3aXRjaCAodGhpcy4kbmV3TGluZU1vZGUpIHsKICAgICAgICAgICAgY2FzZSAid2luZG93cyI6CiAgICAgICAgICAgICAgICByZXR1cm4gIlxyXG4iOwogICAgICAgICAgICBjYXNlICJ1bml4IjoKICAgICAgICAgICAgICAgIHJldHVybiAiXG4iOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGF1dG9OZXdMaW5lIHx8ICJcbiI7CiAgICAgICAgfQogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5zZXROZXdMaW5lTW9kZSA9IGZ1bmN0aW9uIChuZXdMaW5lTW9kZSkgewogICAgICAgIGlmICh0aGlzLiRuZXdMaW5lTW9kZSA9PT0gbmV3TGluZU1vZGUpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB0aGlzLiRuZXdMaW5lTW9kZSA9IG5ld0xpbmVNb2RlOwogICAgICAgIHRoaXMuX3NpZ25hbCgiY2hhbmdlTmV3TGluZU1vZGUiKTsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUuZ2V0TmV3TGluZU1vZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJG5ld0xpbmVNb2RlOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5pc05ld0xpbmUgPSBmdW5jdGlvbiAodGV4dCkgewogICAgICAgIHJldHVybiAodGV4dCA9PSAiXHJcbiIgfHwgdGV4dCA9PSAiXHIiIHx8IHRleHQgPT0gIlxuIik7CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLmdldExpbmUgPSBmdW5jdGlvbiAocm93KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzW3Jvd10gfHwgIiI7CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLmdldExpbmVzID0gZnVuY3Rpb24gKGZpcnN0Um93LCBsYXN0Um93KSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzLnNsaWNlKGZpcnN0Um93LCBsYXN0Um93ICsgMSk7CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLmdldEFsbExpbmVzID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLmdldExpbmVzKDAsIHRoaXMuZ2V0TGVuZ3RoKCkpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5nZXRMZW5ndGggPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJGxpbmVzLmxlbmd0aDsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUuZ2V0VGV4dFJhbmdlID0gZnVuY3Rpb24gKHJhbmdlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TGluZXNGb3JSYW5nZShyYW5nZSkuam9pbih0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKSk7CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLmdldExpbmVzRm9yUmFuZ2UgPSBmdW5jdGlvbiAocmFuZ2UpIHsKICAgICAgICB2YXIgbGluZXM7CiAgICAgICAgaWYgKHJhbmdlLnN0YXJ0LnJvdyA9PT0gcmFuZ2UuZW5kLnJvdykgewogICAgICAgICAgICBsaW5lcyA9IFt0aGlzLmdldExpbmUocmFuZ2Uuc3RhcnQucm93KS5zdWJzdHJpbmcocmFuZ2Uuc3RhcnQuY29sdW1uLCByYW5nZS5lbmQuY29sdW1uKV07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBsaW5lcyA9IHRoaXMuZ2V0TGluZXMocmFuZ2Uuc3RhcnQucm93LCByYW5nZS5lbmQucm93KTsKICAgICAgICAgICAgbGluZXNbMF0gPSAobGluZXNbMF0gfHwgIiIpLnN1YnN0cmluZyhyYW5nZS5zdGFydC5jb2x1bW4pOwogICAgICAgICAgICB2YXIgbCA9IGxpbmVzLmxlbmd0aCAtIDE7CiAgICAgICAgICAgIGlmIChyYW5nZS5lbmQucm93IC0gcmFuZ2Uuc3RhcnQucm93ID09IGwpCiAgICAgICAgICAgICAgICBsaW5lc1tsXSA9IGxpbmVzW2xdLnN1YnN0cmluZygwLCByYW5nZS5lbmQuY29sdW1uKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxpbmVzOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5pbnNlcnRMaW5lcyA9IGZ1bmN0aW9uIChyb3csIGxpbmVzKSB7CiAgICAgICAgY29uc29sZS53YXJuKCJVc2Ugb2YgZG9jdW1lbnQuaW5zZXJ0TGluZXMgaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSBpbnNlcnRGdWxsTGluZXMgbWV0aG9kIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0RnVsbExpbmVzKHJvdywgbGluZXMpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5yZW1vdmVMaW5lcyA9IGZ1bmN0aW9uIChmaXJzdFJvdywgbGFzdFJvdykgewogICAgICAgIGNvbnNvbGUud2FybigiVXNlIG9mIGRvY3VtZW50LnJlbW92ZUxpbmVzIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgcmVtb3ZlRnVsbExpbmVzIG1ldGhvZCBpbnN0ZWFkLiIpOwogICAgICAgIHJldHVybiB0aGlzLnJlbW92ZUZ1bGxMaW5lcyhmaXJzdFJvdywgbGFzdFJvdyk7CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLmluc2VydE5ld0xpbmUgPSBmdW5jdGlvbiAocG9zaXRpb24pIHsKICAgICAgICBjb25zb2xlLndhcm4oIlVzZSBvZiBkb2N1bWVudC5pbnNlcnROZXdMaW5lIGlzIGRlcHJlY2F0ZWQuIFVzZSBpbnNlcnRNZXJnZWRMaW5lcyhwb3NpdGlvbiwgWycnLCAnJ10pIGluc3RlYWQuIik7CiAgICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0TWVyZ2VkTGluZXMocG9zaXRpb24sIFsiIiwgIiJdKTsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24gKHBvc2l0aW9uLCB0ZXh0KSB7CiAgICAgICAgaWYgKHRoaXMuZ2V0TGVuZ3RoKCkgPD0gMSkKICAgICAgICAgICAgdGhpcy4kZGV0ZWN0TmV3TGluZSh0ZXh0KTsKICAgICAgICByZXR1cm4gdGhpcy5pbnNlcnRNZXJnZWRMaW5lcyhwb3NpdGlvbiwgdGhpcy4kc3BsaXQodGV4dCkpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5pbnNlcnRJbkxpbmUgPSBmdW5jdGlvbiAocG9zaXRpb24sIHRleHQpIHsKICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLmNsaXBwZWRQb3MocG9zaXRpb24ucm93LCBwb3NpdGlvbi5jb2x1bW4pOwogICAgICAgIHZhciBlbmQgPSB0aGlzLnBvcyhwb3NpdGlvbi5yb3csIHBvc2l0aW9uLmNvbHVtbiArIHRleHQubGVuZ3RoKTsKICAgICAgICB0aGlzLmFwcGx5RGVsdGEoewogICAgICAgICAgICBzdGFydDogc3RhcnQsCiAgICAgICAgICAgIGVuZDogZW5kLAogICAgICAgICAgICBhY3Rpb246ICJpbnNlcnQiLAogICAgICAgICAgICBsaW5lczogW3RleHRdCiAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmVQb3MoZW5kKTsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUuY2xpcHBlZFBvcyA9IGZ1bmN0aW9uIChyb3csIGNvbHVtbikgewogICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldExlbmd0aCgpOwogICAgICAgIGlmIChyb3cgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICByb3cgPSBsZW5ndGg7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKHJvdyA8IDApIHsKICAgICAgICAgICAgcm93ID0gMDsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAocm93ID49IGxlbmd0aCkgewogICAgICAgICAgICByb3cgPSBsZW5ndGggLSAxOwogICAgICAgICAgICBjb2x1bW4gPSB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIHZhciBsaW5lID0gdGhpcy5nZXRMaW5lKHJvdyk7CiAgICAgICAgaWYgKGNvbHVtbiA9PSB1bmRlZmluZWQpCiAgICAgICAgICAgIGNvbHVtbiA9IGxpbmUubGVuZ3RoOwogICAgICAgIGNvbHVtbiA9IE1hdGgubWluKE1hdGgubWF4KGNvbHVtbiwgMCksIGxpbmUubGVuZ3RoKTsKICAgICAgICByZXR1cm4geyByb3c6IHJvdywgY29sdW1uOiBjb2x1bW4gfTsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUuY2xvbmVQb3MgPSBmdW5jdGlvbiAocG9zKSB7CiAgICAgICAgcmV0dXJuIHsgcm93OiBwb3Mucm93LCBjb2x1bW46IHBvcy5jb2x1bW4gfTsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUucG9zID0gZnVuY3Rpb24gKHJvdywgY29sdW1uKSB7CiAgICAgICAgcmV0dXJuIHsgcm93OiByb3csIGNvbHVtbjogY29sdW1uIH07CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLiRjbGlwUG9zaXRpb24gPSBmdW5jdGlvbiAocG9zaXRpb24pIHsKICAgICAgICB2YXIgbGVuZ3RoID0gdGhpcy5nZXRMZW5ndGgoKTsKICAgICAgICBpZiAocG9zaXRpb24ucm93ID49IGxlbmd0aCkgewogICAgICAgICAgICBwb3NpdGlvbi5yb3cgPSBNYXRoLm1heCgwLCBsZW5ndGggLSAxKTsKICAgICAgICAgICAgcG9zaXRpb24uY29sdW1uID0gdGhpcy5nZXRMaW5lKGxlbmd0aCAtIDEpLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHBvc2l0aW9uLnJvdyA9IE1hdGgubWF4KDAsIHBvc2l0aW9uLnJvdyk7CiAgICAgICAgICAgIHBvc2l0aW9uLmNvbHVtbiA9IE1hdGgubWluKE1hdGgubWF4KHBvc2l0aW9uLmNvbHVtbiwgMCksIHRoaXMuZ2V0TGluZShwb3NpdGlvbi5yb3cpLmxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwb3NpdGlvbjsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUuaW5zZXJ0RnVsbExpbmVzID0gZnVuY3Rpb24gKHJvdywgbGluZXMpIHsKICAgICAgICByb3cgPSBNYXRoLm1pbihNYXRoLm1heChyb3csIDApLCB0aGlzLmdldExlbmd0aCgpKTsKICAgICAgICB2YXIgY29sdW1uID0gMDsKICAgICAgICBpZiAocm93IDwgdGhpcy5nZXRMZW5ndGgoKSkgewogICAgICAgICAgICBsaW5lcyA9IGxpbmVzLmNvbmNhdChbIiJdKTsKICAgICAgICAgICAgY29sdW1uID0gMDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGxpbmVzID0gWyIiXS5jb25jYXQobGluZXMpOwogICAgICAgICAgICByb3ctLTsKICAgICAgICAgICAgY29sdW1uID0gdGhpcy4kbGluZXNbcm93XS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHRoaXMuaW5zZXJ0TWVyZ2VkTGluZXMoeyByb3c6IHJvdywgY29sdW1uOiBjb2x1bW4gfSwgbGluZXMpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5pbnNlcnRNZXJnZWRMaW5lcyA9IGZ1bmN0aW9uIChwb3NpdGlvbiwgbGluZXMpIHsKICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLmNsaXBwZWRQb3MocG9zaXRpb24ucm93LCBwb3NpdGlvbi5jb2x1bW4pOwogICAgICAgIHZhciBlbmQgPSB7CiAgICAgICAgICAgIHJvdzogc3RhcnQucm93ICsgbGluZXMubGVuZ3RoIC0gMSwKICAgICAgICAgICAgY29sdW1uOiAobGluZXMubGVuZ3RoID09IDEgPyBzdGFydC5jb2x1bW4gOiAwKSArIGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLmxlbmd0aAogICAgICAgIH07CiAgICAgICAgdGhpcy5hcHBseURlbHRhKHsKICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0LAogICAgICAgICAgICBlbmQ6IGVuZCwKICAgICAgICAgICAgYWN0aW9uOiAiaW5zZXJ0IiwKICAgICAgICAgICAgbGluZXM6IGxpbmVzCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmVQb3MoZW5kKTsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKHJhbmdlKSB7CiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5jbGlwcGVkUG9zKHJhbmdlLnN0YXJ0LnJvdywgcmFuZ2Uuc3RhcnQuY29sdW1uKTsKICAgICAgICB2YXIgZW5kID0gdGhpcy5jbGlwcGVkUG9zKHJhbmdlLmVuZC5yb3csIHJhbmdlLmVuZC5jb2x1bW4pOwogICAgICAgIHRoaXMuYXBwbHlEZWx0YSh7CiAgICAgICAgICAgIHN0YXJ0OiBzdGFydCwKICAgICAgICAgICAgZW5kOiBlbmQsCiAgICAgICAgICAgIGFjdGlvbjogInJlbW92ZSIsCiAgICAgICAgICAgIGxpbmVzOiB0aGlzLmdldExpbmVzRm9yUmFuZ2UoeyBzdGFydDogc3RhcnQsIGVuZDogZW5kIH0pCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmVQb3Moc3RhcnQpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5yZW1vdmVJbkxpbmUgPSBmdW5jdGlvbiAocm93LCBzdGFydENvbHVtbiwgZW5kQ29sdW1uKSB7CiAgICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5jbGlwcGVkUG9zKHJvdywgc3RhcnRDb2x1bW4pOwogICAgICAgIHZhciBlbmQgPSB0aGlzLmNsaXBwZWRQb3Mocm93LCBlbmRDb2x1bW4pOwogICAgICAgIHRoaXMuYXBwbHlEZWx0YSh7CiAgICAgICAgICAgIHN0YXJ0OiBzdGFydCwKICAgICAgICAgICAgZW5kOiBlbmQsCiAgICAgICAgICAgIGFjdGlvbjogInJlbW92ZSIsCiAgICAgICAgICAgIGxpbmVzOiB0aGlzLmdldExpbmVzRm9yUmFuZ2UoeyBzdGFydDogc3RhcnQsIGVuZDogZW5kIH0pCiAgICAgICAgfSwgdHJ1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmVQb3Moc3RhcnQpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5yZW1vdmVGdWxsTGluZXMgPSBmdW5jdGlvbiAoZmlyc3RSb3csIGxhc3RSb3cpIHsKICAgICAgICBmaXJzdFJvdyA9IE1hdGgubWluKE1hdGgubWF4KDAsIGZpcnN0Um93KSwgdGhpcy5nZXRMZW5ndGgoKSAtIDEpOwogICAgICAgIGxhc3RSb3cgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBsYXN0Um93KSwgdGhpcy5nZXRMZW5ndGgoKSAtIDEpOwogICAgICAgIHZhciBkZWxldGVGaXJzdE5ld0xpbmUgPSBsYXN0Um93ID09IHRoaXMuZ2V0TGVuZ3RoKCkgLSAxICYmIGZpcnN0Um93ID4gMDsKICAgICAgICB2YXIgZGVsZXRlTGFzdE5ld0xpbmUgPSBsYXN0Um93IDwgdGhpcy5nZXRMZW5ndGgoKSAtIDE7CiAgICAgICAgdmFyIHN0YXJ0Um93ID0gKGRlbGV0ZUZpcnN0TmV3TGluZSA/IGZpcnN0Um93IC0gMSA6IGZpcnN0Um93KTsKICAgICAgICB2YXIgc3RhcnRDb2wgPSAoZGVsZXRlRmlyc3ROZXdMaW5lID8gdGhpcy5nZXRMaW5lKHN0YXJ0Um93KS5sZW5ndGggOiAwKTsKICAgICAgICB2YXIgZW5kUm93ID0gKGRlbGV0ZUxhc3ROZXdMaW5lID8gbGFzdFJvdyArIDEgOiBsYXN0Um93KTsKICAgICAgICB2YXIgZW5kQ29sID0gKGRlbGV0ZUxhc3ROZXdMaW5lID8gMCA6IHRoaXMuZ2V0TGluZShlbmRSb3cpLmxlbmd0aCk7CiAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKHN0YXJ0Um93LCBzdGFydENvbCwgZW5kUm93LCBlbmRDb2wpOwogICAgICAgIHZhciBkZWxldGVkTGluZXMgPSB0aGlzLiRsaW5lcy5zbGljZShmaXJzdFJvdywgbGFzdFJvdyArIDEpOwogICAgICAgIHRoaXMuYXBwbHlEZWx0YSh7CiAgICAgICAgICAgIHN0YXJ0OiByYW5nZS5zdGFydCwKICAgICAgICAgICAgZW5kOiByYW5nZS5lbmQsCiAgICAgICAgICAgIGFjdGlvbjogInJlbW92ZSIsCiAgICAgICAgICAgIGxpbmVzOiB0aGlzLmdldExpbmVzRm9yUmFuZ2UocmFuZ2UpCiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGRlbGV0ZWRMaW5lczsKICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUucmVtb3ZlTmV3TGluZSA9IGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICBpZiAocm93IDwgdGhpcy5nZXRMZW5ndGgoKSAtIDEgJiYgcm93ID49IDApIHsKICAgICAgICAgICAgdGhpcy5hcHBseURlbHRhKHsKICAgICAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnBvcyhyb3csIHRoaXMuZ2V0TGluZShyb3cpLmxlbmd0aCksCiAgICAgICAgICAgICAgICBlbmQ6IHRoaXMucG9zKHJvdyArIDEsIDApLAogICAgICAgICAgICAgICAgYWN0aW9uOiAicmVtb3ZlIiwKICAgICAgICAgICAgICAgIGxpbmVzOiBbIiIsICIiXQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbiAocmFuZ2UsIHRleHQpIHsKICAgICAgICBpZiAoIShyYW5nZSBpbnN0YW5jZW9mIFJhbmdlKSkKICAgICAgICAgICAgcmFuZ2UgPSBSYW5nZS5mcm9tUG9pbnRzKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQpOwogICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA9PT0gMCAmJiByYW5nZS5pc0VtcHR5KCkpCiAgICAgICAgICAgIHJldHVybiByYW5nZS5zdGFydDsKICAgICAgICBpZiAodGV4dCA9PSB0aGlzLmdldFRleHRSYW5nZShyYW5nZSkpCiAgICAgICAgICAgIHJldHVybiByYW5nZS5lbmQ7CiAgICAgICAgdGhpcy5yZW1vdmUocmFuZ2UpOwogICAgICAgIHZhciBlbmQ7CiAgICAgICAgaWYgKHRleHQpIHsKICAgICAgICAgICAgZW5kID0gdGhpcy5pbnNlcnQocmFuZ2Uuc3RhcnQsIHRleHQpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgZW5kID0gcmFuZ2Uuc3RhcnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBlbmQ7CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLmFwcGx5RGVsdGFzID0gZnVuY3Rpb24gKGRlbHRhcykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGVsdGFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRoaXMuYXBwbHlEZWx0YShkZWx0YXNbaV0pOwogICAgICAgIH0KICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUucmV2ZXJ0RGVsdGFzID0gZnVuY3Rpb24gKGRlbHRhcykgewogICAgICAgIGZvciAodmFyIGkgPSBkZWx0YXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgdGhpcy5yZXZlcnREZWx0YShkZWx0YXNbaV0pOwogICAgICAgIH0KICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUuYXBwbHlEZWx0YSA9IGZ1bmN0aW9uIChkZWx0YSwgZG9Ob3RWYWxpZGF0ZSkgewogICAgICAgIHZhciBpc0luc2VydCA9IGRlbHRhLmFjdGlvbiA9PSAiaW5zZXJ0IjsKICAgICAgICBpZiAoaXNJbnNlcnQgPyBkZWx0YS5saW5lcy5sZW5ndGggPD0gMSAmJiAhZGVsdGEubGluZXNbMF0KICAgICAgICAgICAgOiAhUmFuZ2UuY29tcGFyZVBvaW50cyhkZWx0YS5zdGFydCwgZGVsdGEuZW5kKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChpc0luc2VydCAmJiBkZWx0YS5saW5lcy5sZW5ndGggPiAyMDAwMCkgewogICAgICAgICAgICB0aGlzLiRzcGxpdEFuZGFwcGx5TGFyZ2VEZWx0YShkZWx0YSwgMjAwMDApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgYXBwbHlEZWx0YSh0aGlzLiRsaW5lcywgZGVsdGEsIGRvTm90VmFsaWRhdGUpOwogICAgICAgICAgICB0aGlzLl9zaWduYWwoImNoYW5nZSIsIGRlbHRhKTsKICAgICAgICB9CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLiRzYWZlQXBwbHlEZWx0YSA9IGZ1bmN0aW9uIChkZWx0YSkgewogICAgICAgIHZhciBkb2NMZW5ndGggPSB0aGlzLiRsaW5lcy5sZW5ndGg7CiAgICAgICAgaWYgKGRlbHRhLmFjdGlvbiA9PSAicmVtb3ZlIiAmJiBkZWx0YS5zdGFydC5yb3cgPCBkb2NMZW5ndGggJiYgZGVsdGEuZW5kLnJvdyA8IGRvY0xlbmd0aAogICAgICAgICAgICB8fCBkZWx0YS5hY3Rpb24gPT0gImluc2VydCIgJiYgZGVsdGEuc3RhcnQucm93IDw9IGRvY0xlbmd0aCkgewogICAgICAgICAgICB0aGlzLmFwcGx5RGVsdGEoZGVsdGEpOwogICAgICAgIH0KICAgIH07CiAgICBEb2N1bWVudC5wcm90b3R5cGUuJHNwbGl0QW5kYXBwbHlMYXJnZURlbHRhID0gZnVuY3Rpb24gKGRlbHRhLCBNQVgpIHsKICAgICAgICB2YXIgbGluZXMgPSBkZWx0YS5saW5lczsKICAgICAgICB2YXIgbCA9IGxpbmVzLmxlbmd0aCAtIE1BWCArIDE7CiAgICAgICAgdmFyIHJvdyA9IGRlbHRhLnN0YXJ0LnJvdzsKICAgICAgICB2YXIgY29sdW1uID0gZGVsdGEuc3RhcnQuY29sdW1uOwogICAgICAgIGZvciAodmFyIGZyb20gPSAwLCB0byA9IDA7IGZyb20gPCBsOyBmcm9tID0gdG8pIHsKICAgICAgICAgICAgdG8gKz0gTUFYIC0gMTsKICAgICAgICAgICAgdmFyIGNodW5rID0gbGluZXMuc2xpY2UoZnJvbSwgdG8pOwogICAgICAgICAgICBjaHVuay5wdXNoKCIiKTsKICAgICAgICAgICAgdGhpcy5hcHBseURlbHRhKHsKICAgICAgICAgICAgICAgIHN0YXJ0OiB0aGlzLnBvcyhyb3cgKyBmcm9tLCBjb2x1bW4pLAogICAgICAgICAgICAgICAgZW5kOiB0aGlzLnBvcyhyb3cgKyB0bywgY29sdW1uID0gMCksCiAgICAgICAgICAgICAgICBhY3Rpb246IGRlbHRhLmFjdGlvbiwKICAgICAgICAgICAgICAgIGxpbmVzOiBjaHVuawogICAgICAgICAgICB9LCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgZGVsdGEubGluZXMgPSBsaW5lcy5zbGljZShmcm9tKTsKICAgICAgICBkZWx0YS5zdGFydC5yb3cgPSByb3cgKyBmcm9tOwogICAgICAgIGRlbHRhLnN0YXJ0LmNvbHVtbiA9IGNvbHVtbjsKICAgICAgICB0aGlzLmFwcGx5RGVsdGEoZGVsdGEsIHRydWUpOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS5yZXZlcnREZWx0YSA9IGZ1bmN0aW9uIChkZWx0YSkgewogICAgICAgIHRoaXMuJHNhZmVBcHBseURlbHRhKHsKICAgICAgICAgICAgc3RhcnQ6IHRoaXMuY2xvbmVQb3MoZGVsdGEuc3RhcnQpLAogICAgICAgICAgICBlbmQ6IHRoaXMuY2xvbmVQb3MoZGVsdGEuZW5kKSwKICAgICAgICAgICAgYWN0aW9uOiAoZGVsdGEuYWN0aW9uID09ICJpbnNlcnQiID8gInJlbW92ZSIgOiAiaW5zZXJ0IiksCiAgICAgICAgICAgIGxpbmVzOiBkZWx0YS5saW5lcy5zbGljZSgpCiAgICAgICAgfSk7CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLmluZGV4VG9Qb3NpdGlvbiA9IGZ1bmN0aW9uIChpbmRleCwgc3RhcnRSb3cpIHsKICAgICAgICB2YXIgbGluZXMgPSB0aGlzLiRsaW5lcyB8fCB0aGlzLmdldEFsbExpbmVzKCk7CiAgICAgICAgdmFyIG5ld2xpbmVMZW5ndGggPSB0aGlzLmdldE5ld0xpbmVDaGFyYWN0ZXIoKS5sZW5ndGg7CiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0Um93IHx8IDAsIGwgPSBsaW5lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgaW5kZXggLT0gbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aDsKICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkKICAgICAgICAgICAgICAgIHJldHVybiB7IHJvdzogaSwgY29sdW1uOiBpbmRleCArIGxpbmVzW2ldLmxlbmd0aCArIG5ld2xpbmVMZW5ndGggfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgcm93OiBsIC0gMSwgY29sdW1uOiBpbmRleCArIGxpbmVzW2wgLSAxXS5sZW5ndGggKyBuZXdsaW5lTGVuZ3RoIH07CiAgICB9OwogICAgRG9jdW1lbnQucHJvdG90eXBlLnBvc2l0aW9uVG9JbmRleCA9IGZ1bmN0aW9uIChwb3MsIHN0YXJ0Um93KSB7CiAgICAgICAgdmFyIGxpbmVzID0gdGhpcy4kbGluZXMgfHwgdGhpcy5nZXRBbGxMaW5lcygpOwogICAgICAgIHZhciBuZXdsaW5lTGVuZ3RoID0gdGhpcy5nZXROZXdMaW5lQ2hhcmFjdGVyKCkubGVuZ3RoOwogICAgICAgIHZhciBpbmRleCA9IDA7CiAgICAgICAgdmFyIHJvdyA9IE1hdGgubWluKHBvcy5yb3csIGxpbmVzLmxlbmd0aCk7CiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0Um93IHx8IDA7IGkgPCByb3c7ICsraSkKICAgICAgICAgICAgaW5kZXggKz0gbGluZXNbaV0ubGVuZ3RoICsgbmV3bGluZUxlbmd0aDsKICAgICAgICByZXR1cm4gaW5kZXggKyBwb3MuY29sdW1uOwogICAgfTsKICAgIERvY3VtZW50LnByb3RvdHlwZS4kc3BsaXQgPSBmdW5jdGlvbiAodGV4dCkgewogICAgICAgIHJldHVybiB0ZXh0LnNwbGl0KC9cclxufFxyfFxuLyk7CiAgICB9OwogICAgcmV0dXJuIERvY3VtZW50Owp9KCkpOwpEb2N1bWVudC5wcm90b3R5cGUuJGF1dG9OZXdMaW5lID0gIiI7CkRvY3VtZW50LnByb3RvdHlwZS4kbmV3TGluZU1vZGUgPSAiYXV0byI7Cm9vcC5pbXBsZW1lbnQoRG9jdW1lbnQucHJvdG90eXBlLCBFdmVudEVtaXR0ZXIpOwpleHBvcnRzLkRvY3VtZW50ID0gRG9jdW1lbnQ7Cgp9KTsKCmFjZS5kZWZpbmUoImFjZS9saWIvZGVlcF9jb3B5IixbXSwgZnVuY3Rpb24ocmVxdWlyZSwgZXhwb3J0cywgbW9kdWxlKXtleHBvcnRzLmRlZXBDb3B5ID0gZnVuY3Rpb24gZGVlcENvcHkob2JqKSB7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gIm9iamVjdCIgfHwgIW9iaikKICAgICAgICByZXR1cm4gb2JqOwogICAgdmFyIGNvcHk7CiAgICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7CiAgICAgICAgY29weSA9IFtdOwogICAgICAgIGZvciAodmFyIGtleSA9IDA7IGtleSA8IG9iai5sZW5ndGg7IGtleSsrKSB7CiAgICAgICAgICAgIGNvcHlba2V5XSA9IGRlZXBDb3B5KG9ialtrZXldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvcHk7CiAgICB9CiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG9iaikgIT09ICJbb2JqZWN0IE9iamVjdF0iKQogICAgICAgIHJldHVybiBvYmo7CiAgICBjb3B5ID0ge307CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKQogICAgICAgIGNvcHlba2V5XSA9IGRlZXBDb3B5KG9ialtrZXldKTsKICAgIHJldHVybiBjb3B5Owp9OwoKfSk7CgphY2UuZGVmaW5lKCJhY2UvbGliL2xhbmciLFtdLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpeyJ1c2Ugc3RyaWN0IjsKZXhwb3J0cy5sYXN0ID0gZnVuY3Rpb24gKGEpIHsKICAgIHJldHVybiBhW2EubGVuZ3RoIC0gMV07Cn07CmV4cG9ydHMuc3RyaW5nUmV2ZXJzZSA9IGZ1bmN0aW9uIChzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcuc3BsaXQoIiIpLnJldmVyc2UoKS5qb2luKCIiKTsKfTsKZXhwb3J0cy5zdHJpbmdSZXBlYXQgPSBmdW5jdGlvbiAoc3RyaW5nLCBjb3VudCkgewogICAgdmFyIHJlc3VsdCA9ICcnOwogICAgd2hpbGUgKGNvdW50ID4gMCkgewogICAgICAgIGlmIChjb3VudCAmIDEpCiAgICAgICAgICAgIHJlc3VsdCArPSBzdHJpbmc7CiAgICAgICAgaWYgKGNvdW50ID4+PSAxKQogICAgICAgICAgICBzdHJpbmcgKz0gc3RyaW5nOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKfTsKdmFyIHRyaW1CZWdpblJlZ2V4cCA9IC9eXHNccyovOwp2YXIgdHJpbUVuZFJlZ2V4cCA9IC9cc1xzKiQvOwpleHBvcnRzLnN0cmluZ1RyaW1MZWZ0ID0gZnVuY3Rpb24gKHN0cmluZykgewogICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKHRyaW1CZWdpblJlZ2V4cCwgJycpOwp9OwpleHBvcnRzLnN0cmluZ1RyaW1SaWdodCA9IGZ1bmN0aW9uIChzdHJpbmcpIHsKICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSh0cmltRW5kUmVnZXhwLCAnJyk7Cn07CmV4cG9ydHMuY29weU9iamVjdCA9IGZ1bmN0aW9uIChvYmopIHsKICAgIHZhciBjb3B5ID0ge307CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgY29weVtrZXldID0gb2JqW2tleV07CiAgICB9CiAgICByZXR1cm4gY29weTsKfTsKZXhwb3J0cy5jb3B5QXJyYXkgPSBmdW5jdGlvbiAoYXJyYXkpIHsKICAgIHZhciBjb3B5ID0gW107CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGlmIChhcnJheVtpXSAmJiB0eXBlb2YgYXJyYXlbaV0gPT0gIm9iamVjdCIpCiAgICAgICAgICAgIGNvcHlbaV0gPSB0aGlzLmNvcHlPYmplY3QoYXJyYXlbaV0pOwogICAgICAgIGVsc2UKICAgICAgICAgICAgY29weVtpXSA9IGFycmF5W2ldOwogICAgfQogICAgcmV0dXJuIGNvcHk7Cn07CmV4cG9ydHMuZGVlcENvcHkgPSByZXF1aXJlKCIuL2RlZXBfY29weSIpLmRlZXBDb3B5OwpleHBvcnRzLmFycmF5VG9NYXAgPSBmdW5jdGlvbiAoYXJyKSB7CiAgICB2YXIgbWFwID0ge307CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICAgIG1hcFthcnJbaV1dID0gMTsKICAgIH0KICAgIHJldHVybiBtYXA7Cn07CmV4cG9ydHMuY3JlYXRlTWFwID0gZnVuY3Rpb24gKHByb3BzKSB7CiAgICB2YXIgbWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAodmFyIGkgaW4gcHJvcHMpIHsKICAgICAgICBtYXBbaV0gPSBwcm9wc1tpXTsKICAgIH0KICAgIHJldHVybiBtYXA7Cn07CmV4cG9ydHMuYXJyYXlSZW1vdmUgPSBmdW5jdGlvbiAoYXJyYXksIHZhbHVlKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBhcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICh2YWx1ZSA9PT0gYXJyYXlbaV0pIHsKICAgICAgICAgICAgYXJyYXkuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgIH0KfTsKZXhwb3J0cy5lc2NhcGVSZWdFeHAgPSBmdW5jdGlvbiAoc3RyKSB7CiAgICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbLiorP14ke30oKXxbXF1cL1xcXSkvZywgJ1xcJDEnKTsKfTsKZXhwb3J0cy5lc2NhcGVIVE1MID0gZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuICgiIiArIHN0cikucmVwbGFjZSgvJi9nLCAiJiMzODsiKS5yZXBsYWNlKC8iL2csICImIzM0OyIpLnJlcGxhY2UoLycvZywgIiYjMzk7IikucmVwbGFjZSgvPC9nLCAiJiM2MDsiKTsKfTsKZXhwb3J0cy5nZXRNYXRjaE9mZnNldHMgPSBmdW5jdGlvbiAoc3RyaW5nLCByZWdFeHApIHsKICAgIHZhciBtYXRjaGVzID0gW107CiAgICBzdHJpbmcucmVwbGFjZShyZWdFeHAsIGZ1bmN0aW9uIChzdHIpIHsKICAgICAgICBtYXRjaGVzLnB1c2goewogICAgICAgICAgICBvZmZzZXQ6IGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMl0sCiAgICAgICAgICAgIGxlbmd0aDogc3RyLmxlbmd0aAogICAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gbWF0Y2hlczsKfTsKZXhwb3J0cy5kZWZlcnJlZENhbGwgPSBmdW5jdGlvbiAoZmNuKSB7CiAgICB2YXIgdGltZXIgPSBudWxsOwogICAgdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRpbWVyID0gbnVsbDsKICAgICAgICBmY24oKTsKICAgIH07CiAgICB2YXIgZGVmZXJyZWQgPSBmdW5jdGlvbiAodGltZW91dCkgewogICAgICAgIGRlZmVycmVkLmNhbmNlbCgpOwogICAgICAgIHRpbWVyID0gc2V0VGltZW91dChjYWxsYmFjaywgdGltZW91dCB8fCAwKTsKICAgICAgICByZXR1cm4gZGVmZXJyZWQ7CiAgICB9OwogICAgZGVmZXJyZWQuc2NoZWR1bGUgPSBkZWZlcnJlZDsKICAgIGRlZmVycmVkLmNhbGwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5jYW5jZWwoKTsKICAgICAgICBmY24oKTsKICAgICAgICByZXR1cm4gZGVmZXJyZWQ7CiAgICB9OwogICAgZGVmZXJyZWQuY2FuY2VsID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7CiAgICAgICAgdGltZXIgPSBudWxsOwogICAgICAgIHJldHVybiBkZWZlcnJlZDsKICAgIH07CiAgICBkZWZlcnJlZC5pc1BlbmRpbmcgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHRpbWVyOwogICAgfTsKICAgIHJldHVybiBkZWZlcnJlZDsKfTsKZXhwb3J0cy5kZWxheWVkQ2FsbCA9IGZ1bmN0aW9uIChmY24sIGRlZmF1bHRUaW1lb3V0KSB7CiAgICB2YXIgdGltZXIgPSBudWxsOwogICAgdmFyIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRpbWVyID0gbnVsbDsKICAgICAgICBmY24oKTsKICAgIH07CiAgICB2YXIgX3NlbGYgPSBmdW5jdGlvbiAodGltZW91dCkgewogICAgICAgIGlmICh0aW1lciA9PSBudWxsKQogICAgICAgICAgICB0aW1lciA9IHNldFRpbWVvdXQoY2FsbGJhY2ssIHRpbWVvdXQgfHwgZGVmYXVsdFRpbWVvdXQpOwogICAgfTsKICAgIF9zZWxmLmRlbGF5ID0gZnVuY3Rpb24gKHRpbWVvdXQpIHsKICAgICAgICB0aW1lciAmJiBjbGVhclRpbWVvdXQodGltZXIpOwogICAgICAgIHRpbWVyID0gc2V0VGltZW91dChjYWxsYmFjaywgdGltZW91dCB8fCBkZWZhdWx0VGltZW91dCk7CiAgICB9OwogICAgX3NlbGYuc2NoZWR1bGUgPSBfc2VsZjsKICAgIF9zZWxmLmNhbGwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5jYW5jZWwoKTsKICAgICAgICBmY24oKTsKICAgIH07CiAgICBfc2VsZi5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGltZXIgJiYgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgICAgICB0aW1lciA9IG51bGw7CiAgICB9OwogICAgX3NlbGYuaXNQZW5kaW5nID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aW1lcjsKICAgIH07CiAgICByZXR1cm4gX3NlbGY7Cn07CmV4cG9ydHMuc3VwcG9ydHNMb29rYmVoaW5kID0gZnVuY3Rpb24gKCkgewogICAgdHJ5IHsKICAgICAgICBuZXcgUmVnRXhwKCcoPzw9LiknKTsKICAgIH0KICAgIGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7Cn07CmV4cG9ydHMuc2tpcEVtcHR5TWF0Y2ggPSBmdW5jdGlvbiAobGluZSwgbGFzdCwgc3VwcG9ydHNVbmljb2RlRmxhZykgewogICAgcmV0dXJuIHN1cHBvcnRzVW5pY29kZUZsYWcgJiYgbGluZS5jb2RlUG9pbnRBdChsYXN0KSA+IDB4ZmZmZiA/IDIgOiAxOwp9OwoKfSk7CgphY2UuZGVmaW5lKCJhY2Uvd29ya2VyL21pcnJvciIsW10sIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewoidXNlIHN0cmljdCI7Cgp2YXIgRG9jdW1lbnQgPSByZXF1aXJlKCIuLi9kb2N1bWVudCIpLkRvY3VtZW50Owp2YXIgbGFuZyA9IHJlcXVpcmUoIi4uL2xpYi9sYW5nIik7CiAgICAKdmFyIE1pcnJvciA9IGV4cG9ydHMuTWlycm9yID0gZnVuY3Rpb24oc2VuZGVyKSB7CiAgICB0aGlzLnNlbmRlciA9IHNlbmRlcjsKICAgIHZhciBkb2MgPSB0aGlzLmRvYyA9IG5ldyBEb2N1bWVudCgiIik7CiAgICAKICAgIHZhciBkZWZlcnJlZFVwZGF0ZSA9IHRoaXMuZGVmZXJyZWRVcGRhdGUgPSBsYW5nLmRlbGF5ZWRDYWxsKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSk7CiAgICAKICAgIHZhciBfc2VsZiA9IHRoaXM7CiAgICBzZW5kZXIub24oImNoYW5nZSIsIGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgZGF0YSA9IGUuZGF0YTsKICAgICAgICBpZiAoZGF0YVswXS5zdGFydCkgewogICAgICAgICAgICBkb2MuYXBwbHlEZWx0YXMoZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgICAgICAgICB2YXIgZCwgZXJyOyAKICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGFbaSsxXSkpIHsKICAgICAgICAgICAgICAgICAgICBkID0ge2FjdGlvbjogImluc2VydCIsIHN0YXJ0OiBkYXRhW2ldLCBsaW5lczogZGF0YVtpKzFdfTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZCA9IHthY3Rpb246ICJyZW1vdmUiLCBzdGFydDogZGF0YVtpXSwgZW5kOiBkYXRhW2krMV19OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoKGQuYWN0aW9uID09ICJpbnNlcnQiID8gZC5zdGFydCA6IGQuZW5kKS5yb3cgPj0gZG9jLiRsaW5lcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBlcnIgPSBuZXcgRXJyb3IoIkludmFsaWQgZGVsdGEiKTsKICAgICAgICAgICAgICAgICAgICBlcnIuZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogX3NlbGYuJHBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzTGVuZ3RoOiBkb2MuJGxpbmVzLmxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGQuc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogZC5lbmQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHRocm93IGVycjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkb2MuYXBwbHlEZWx0YShkLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoX3NlbGYuJHRpbWVvdXQpCiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZFVwZGF0ZS5zY2hlZHVsZShfc2VsZi4kdGltZW91dCk7CiAgICAgICAgX3NlbGYub25VcGRhdGUoKTsKICAgIH0pOwp9OwoKKGZ1bmN0aW9uKCkgewogICAgCiAgICB0aGlzLiR0aW1lb3V0ID0gNTAwOwogICAgCiAgICB0aGlzLnNldFRpbWVvdXQgPSBmdW5jdGlvbih0aW1lb3V0KSB7CiAgICAgICAgdGhpcy4kdGltZW91dCA9IHRpbWVvdXQ7CiAgICB9OwogICAgCiAgICB0aGlzLnNldFZhbHVlID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICB0aGlzLmRvYy5zZXRWYWx1ZSh2YWx1ZSk7CiAgICAgICAgdGhpcy5kZWZlcnJlZFVwZGF0ZS5zY2hlZHVsZSh0aGlzLiR0aW1lb3V0KTsKICAgIH07CiAgICAKICAgIHRoaXMuZ2V0VmFsdWUgPSBmdW5jdGlvbihjYWxsYmFja0lkKSB7CiAgICAgICAgdGhpcy5zZW5kZXIuY2FsbGJhY2sodGhpcy5kb2MuZ2V0VmFsdWUoKSwgY2FsbGJhY2tJZCk7CiAgICB9OwogICAgCiAgICB0aGlzLm9uVXBkYXRlID0gZnVuY3Rpb24oKSB7CiAgICB9OwogICAgCiAgICB0aGlzLmlzUGVuZGluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB0aGlzLmRlZmVycmVkVXBkYXRlLmlzUGVuZGluZygpOwogICAgfTsKICAgIAp9KS5jYWxsKE1pcnJvci5wcm90b3R5cGUpOwoKfSk7CgphY2UuZGVmaW5lKCJhY2UvbW9kZS9qc29uL2pzb25fcGFyc2UiLFtdLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKInVzZSBzdHJpY3QiOwoKICAgIHZhciBhdCwgICAgIC8vIFRoZSBpbmRleCBvZiB0aGUgY3VycmVudCBjaGFyYWN0ZXIKICAgICAgICBjaCwgICAgIC8vIFRoZSBjdXJyZW50IGNoYXJhY3RlcgogICAgICAgIGVzY2FwZWUgPSB7CiAgICAgICAgICAgICciJzogICciJywKICAgICAgICAgICAgJ1xcJzogJ1xcJywKICAgICAgICAgICAgJy8nOiAgJy8nLAogICAgICAgICAgICBiOiAgICAnXGInLAogICAgICAgICAgICBmOiAgICAnXGYnLAogICAgICAgICAgICBuOiAgICAnXG4nLAogICAgICAgICAgICByOiAgICAnXHInLAogICAgICAgICAgICB0OiAgICAnXHQnCiAgICAgICAgfSwKICAgICAgICB0ZXh0LAoKICAgICAgICBlcnJvciA9IGZ1bmN0aW9uIChtKSB7CgogICAgICAgICAgICB0aHJvdyB7CiAgICAgICAgICAgICAgICBuYW1lOiAgICAnU3ludGF4RXJyb3InLAogICAgICAgICAgICAgICAgbWVzc2FnZTogbSwKICAgICAgICAgICAgICAgIGF0OiAgICAgIGF0LAogICAgICAgICAgICAgICAgdGV4dDogICAgdGV4dAogICAgICAgICAgICB9OwogICAgICAgIH0sCgogICAgICAgIG5leHQgPSBmdW5jdGlvbiAoYykgewoKICAgICAgICAgICAgaWYgKGMgJiYgYyAhPT0gY2gpIHsKICAgICAgICAgICAgICAgIGVycm9yKCJFeHBlY3RlZCAnIiArIGMgKyAiJyBpbnN0ZWFkIG9mICciICsgY2ggKyAiJyIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjaCA9IHRleHQuY2hhckF0KGF0KTsKICAgICAgICAgICAgYXQgKz0gMTsKICAgICAgICAgICAgcmV0dXJuIGNoOwogICAgICAgIH0sCgogICAgICAgIG51bWJlciA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIHZhciBudW1iZXIsCiAgICAgICAgICAgICAgICBzdHJpbmcgPSAnJzsKCiAgICAgICAgICAgIGlmIChjaCA9PT0gJy0nKSB7CiAgICAgICAgICAgICAgICBzdHJpbmcgPSAnLSc7CiAgICAgICAgICAgICAgICBuZXh0KCctJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hpbGUgKGNoID49ICcwJyAmJiBjaCA8PSAnOScpIHsKICAgICAgICAgICAgICAgIHN0cmluZyArPSBjaDsKICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2ggPT09ICcuJykgewogICAgICAgICAgICAgICAgc3RyaW5nICs9ICcuJzsKICAgICAgICAgICAgICAgIHdoaWxlIChuZXh0KCkgJiYgY2ggPj0gJzAnICYmIGNoIDw9ICc5JykgewogICAgICAgICAgICAgICAgICAgIHN0cmluZyArPSBjaDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY2ggPT09ICdlJyB8fCBjaCA9PT0gJ0UnKSB7CiAgICAgICAgICAgICAgICBzdHJpbmcgKz0gY2g7CiAgICAgICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoY2ggPT09ICctJyB8fCBjaCA9PT0gJysnKSB7CiAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IGNoOwogICAgICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdoaWxlIChjaCA+PSAnMCcgJiYgY2ggPD0gJzknKSB7CiAgICAgICAgICAgICAgICAgICAgc3RyaW5nICs9IGNoOwogICAgICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBudW1iZXIgPSArc3RyaW5nOwogICAgICAgICAgICBpZiAoaXNOYU4obnVtYmVyKSkgewogICAgICAgICAgICAgICAgZXJyb3IoIkJhZCBudW1iZXIiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudW1iZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBzdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICB2YXIgaGV4LAogICAgICAgICAgICAgICAgaSwKICAgICAgICAgICAgICAgIHN0cmluZyA9ICcnLAogICAgICAgICAgICAgICAgdWZmZmY7CgogICAgICAgICAgICBpZiAoY2ggPT09ICciJykgewogICAgICAgICAgICAgICAgd2hpbGUgKG5leHQoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gJyInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09PSAnXFwnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09PSAndScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVmZmZmID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA0OyBpICs9IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZXggPSBwYXJzZUludChuZXh0KCksIDE2KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRmluaXRlKGhleCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVmZmZmID0gdWZmZmYgKiAxNiArIGhleDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHVmZmZmKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZXNjYXBlZVtjaF0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmcgKz0gZXNjYXBlZVtjaF07CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT0gIlxuIiB8fCBjaCA9PSAiXHIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmluZyArPSBjaDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3IoIkJhZCBzdHJpbmciKTsKICAgICAgICB9LAoKICAgICAgICB3aGl0ZSA9IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgIHdoaWxlIChjaCAmJiBjaCA8PSAnICcpIHsKICAgICAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHdvcmQgPSBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgICBzd2l0Y2ggKGNoKSB7CiAgICAgICAgICAgIGNhc2UgJ3QnOgogICAgICAgICAgICAgICAgbmV4dCgndCcpOwogICAgICAgICAgICAgICAgbmV4dCgncicpOwogICAgICAgICAgICAgICAgbmV4dCgndScpOwogICAgICAgICAgICAgICAgbmV4dCgnZScpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNhc2UgJ2YnOgogICAgICAgICAgICAgICAgbmV4dCgnZicpOwogICAgICAgICAgICAgICAgbmV4dCgnYScpOwogICAgICAgICAgICAgICAgbmV4dCgnbCcpOwogICAgICAgICAgICAgICAgbmV4dCgncycpOwogICAgICAgICAgICAgICAgbmV4dCgnZScpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBjYXNlICduJzoKICAgICAgICAgICAgICAgIG5leHQoJ24nKTsKICAgICAgICAgICAgICAgIG5leHQoJ3UnKTsKICAgICAgICAgICAgICAgIG5leHQoJ2wnKTsKICAgICAgICAgICAgICAgIG5leHQoJ2wnKTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yKCJVbmV4cGVjdGVkICciICsgY2ggKyAiJyIpOwogICAgICAgIH0sCgogICAgICAgIHZhbHVlLCAgLy8gUGxhY2UgaG9sZGVyIGZvciB0aGUgdmFsdWUgZnVuY3Rpb24uCgogICAgICAgIGFycmF5ID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgdmFyIGFycmF5ID0gW107CgogICAgICAgICAgICBpZiAoY2ggPT09ICdbJykgewogICAgICAgICAgICAgICAgbmV4dCgnWycpOwogICAgICAgICAgICAgICAgd2hpdGUoKTsKICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gJ10nKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dCgnXScpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBhcnJheTsgICAvLyBlbXB0eSBhcnJheQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKGNoKSB7CiAgICAgICAgICAgICAgICAgICAgYXJyYXkucHVzaCh2YWx1ZSgpKTsKICAgICAgICAgICAgICAgICAgICB3aGl0ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gJ10nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQoJ10nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBuZXh0KCcsJyk7CiAgICAgICAgICAgICAgICAgICAgd2hpdGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvcigiQmFkIGFycmF5Iik7CiAgICAgICAgfSwKCiAgICAgICAgb2JqZWN0ID0gZnVuY3Rpb24gKCkgewoKICAgICAgICAgICAgdmFyIGtleSwKICAgICAgICAgICAgICAgIG9iamVjdCA9IHt9OwoKICAgICAgICAgICAgaWYgKGNoID09PSAneycpIHsKICAgICAgICAgICAgICAgIG5leHQoJ3snKTsKICAgICAgICAgICAgICAgIHdoaXRlKCk7CiAgICAgICAgICAgICAgICBpZiAoY2ggPT09ICd9JykgewogICAgICAgICAgICAgICAgICAgIG5leHQoJ30nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqZWN0OyAgIC8vIGVtcHR5IG9iamVjdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKGNoKSB7CiAgICAgICAgICAgICAgICAgICAga2V5ID0gc3RyaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgd2hpdGUoKTsKICAgICAgICAgICAgICAgICAgICBuZXh0KCc6Jyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KSkgewogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcignRHVwbGljYXRlIGtleSAiJyArIGtleSArICciJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG9iamVjdFtrZXldID0gdmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICB3aGl0ZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gJ30nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQoJ30nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9iamVjdDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbmV4dCgnLCcpOwogICAgICAgICAgICAgICAgICAgIHdoaXRlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXJyb3IoIkJhZCBvYmplY3QiKTsKICAgICAgICB9OwoKICAgIHZhbHVlID0gZnVuY3Rpb24gKCkgewoKICAgICAgICB3aGl0ZSgpOwogICAgICAgIHN3aXRjaCAoY2gpIHsKICAgICAgICBjYXNlICd7JzoKICAgICAgICAgICAgcmV0dXJuIG9iamVjdCgpOwogICAgICAgIGNhc2UgJ1snOgogICAgICAgICAgICByZXR1cm4gYXJyYXkoKTsKICAgICAgICBjYXNlICciJzoKICAgICAgICAgICAgcmV0dXJuIHN0cmluZygpOwogICAgICAgIGNhc2UgJy0nOgogICAgICAgICAgICByZXR1cm4gbnVtYmVyKCk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIGNoID49ICcwJyAmJiBjaCA8PSAnOScgPyBudW1iZXIoKSA6IHdvcmQoKTsKICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiBmdW5jdGlvbiAoc291cmNlLCByZXZpdmVyKSB7CiAgICAgICAgdmFyIHJlc3VsdDsKCiAgICAgICAgdGV4dCA9IHNvdXJjZTsKICAgICAgICBhdCA9IDA7CiAgICAgICAgY2ggPSAnICc7CiAgICAgICAgcmVzdWx0ID0gdmFsdWUoKTsKICAgICAgICB3aGl0ZSgpOwogICAgICAgIGlmIChjaCkgewogICAgICAgICAgICBlcnJvcigiU3ludGF4IGVycm9yIik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHlwZW9mIHJldml2ZXIgPT09ICdmdW5jdGlvbicgPyBmdW5jdGlvbiB3YWxrKGhvbGRlciwga2V5KSB7CiAgICAgICAgICAgIHZhciBrLCB2LCB2YWx1ZSA9IGhvbGRlcltrZXldOwogICAgICAgICAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgZm9yIChrIGluIHZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZhbHVlLCBrKSkgewogICAgICAgICAgICAgICAgICAgICAgICB2ID0gd2Fsayh2YWx1ZSwgayk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlW2tdID0gdjsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB2YWx1ZVtrXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV2aXZlci5jYWxsKGhvbGRlciwga2V5LCB2YWx1ZSk7CiAgICAgICAgfSh7Jyc6IHJlc3VsdH0sICcnKSA6IHJlc3VsdDsKICAgIH07Cn0pOwoKYWNlLmRlZmluZSgiYWNlL21vZGUvanNvbl93b3JrZXIiLFtdLCBmdW5jdGlvbihyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKInVzZSBzdHJpY3QiOwoKdmFyIG9vcCA9IHJlcXVpcmUoIi4uL2xpYi9vb3AiKTsKdmFyIE1pcnJvciA9IHJlcXVpcmUoIi4uL3dvcmtlci9taXJyb3IiKS5NaXJyb3I7CnZhciBwYXJzZSA9IHJlcXVpcmUoIi4vanNvbi9qc29uX3BhcnNlIik7Cgp2YXIgSnNvbldvcmtlciA9IGV4cG9ydHMuSnNvbldvcmtlciA9IGZ1bmN0aW9uKHNlbmRlcikgewogICAgTWlycm9yLmNhbGwodGhpcywgc2VuZGVyKTsKICAgIHRoaXMuc2V0VGltZW91dCgyMDApOwp9OwoKb29wLmluaGVyaXRzKEpzb25Xb3JrZXIsIE1pcnJvcik7CgooZnVuY3Rpb24oKSB7CgogICAgdGhpcy5vblVwZGF0ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZG9jLmdldFZhbHVlKCk7CiAgICAgICAgdmFyIGVycm9ycyA9IFtdOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSkKICAgICAgICAgICAgICAgIHBhcnNlKHZhbHVlKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHZhciBwb3MgPSB0aGlzLmRvYy5pbmRleFRvUG9zaXRpb24oZS5hdC0xKTsKICAgICAgICAgICAgZXJyb3JzLnB1c2goewogICAgICAgICAgICAgICAgcm93OiBwb3Mucm93LAogICAgICAgICAgICAgICAgY29sdW1uOiBwb3MuY29sdW1uLAogICAgICAgICAgICAgICAgdGV4dDogZS5tZXNzYWdlLAogICAgICAgICAgICAgICAgdHlwZTogImVycm9yIgogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgdGhpcy5zZW5kZXIuZW1pdCgiYW5ub3RhdGUiLCBlcnJvcnMpOwogICAgfTsKCn0pLmNhbGwoSnNvbldvcmtlci5wcm90b3R5cGUpOwoKfSk7Cg=="},3057:function(n,o,i){"use strict";i.d(o,{AI:function(){return m},Tl:function(){return p},xC:function(){return d}}),i(1081);var s={en:{array:"Array",auto:"Auto",appendText:"Append",appendTitle:"Append a new field with type 'auto' after this field (Ctrl+Shift+Ins)",appendSubmenuTitle:"Select the type of the field to be appended",appendTitleAuto:"Append a new field with type 'auto' (Ctrl+Shift+Ins)",ascending:"Ascending",ascendingTitle:"Sort the childs of this ${type} in ascending order",actionsMenu:"Click to open the actions menu (Ctrl+M)",cannotParseFieldError:"Cannot parse field into JSON",cannotParseValueError:"Cannot parse value into JSON",collapseAll:"Collapse all fields",compactTitle:"Compact JSON data, remove all whitespaces (Ctrl+Shift+I)",descending:"Descending",descendingTitle:"Sort the childs of this ${type} in descending order",drag:"Drag to move this field (Alt+Shift+Arrows)",duplicateKey:"duplicate key",duplicateText:"Duplicate",duplicateTitle:"Duplicate selected fields (Ctrl+D)",duplicateField:"Duplicate this field (Ctrl+D)",duplicateFieldError:"Duplicate field name",empty:"empty",expandAll:"Expand all fields",expandTitle:`Click to expand/collapse this field (Ctrl+E). 
Ctrl+Click to expand/collapse including all childs.`,formatTitle:"Format JSON data, with proper indentation and line feeds (Ctrl+I)",insert:"Insert",insertTitle:"Insert a new field with type 'auto' before this field (Ctrl+Ins)",insertSub:"Select the type of the field to be inserted",object:"Object",ok:"Ok",redo:"Redo (Ctrl+Shift+Z)",removeText:"Remove",removeTitle:"Remove selected fields (Ctrl+Del)",removeField:"Remove this field (Ctrl+Del)",repairTitle:"Repair JSON: fix quotes and escape characters, remove comments and JSONP notation, turn JavaScript objects into JSON.",searchTitle:"Search fields and values",searchNextResultTitle:"Next result (Enter)",searchPreviousResultTitle:"Previous result (Shift + Enter)",selectNode:"Select a node...",showAll:"show all",showMore:"show more",showMoreStatus:"displaying ${visibleChilds} of ${totalChilds} items.",sort:"Sort",sortTitle:"Sort the childs of this ${type}",sortTitleShort:"Sort contents",sortFieldLabel:"Field:",sortDirectionLabel:"Direction:",sortFieldTitle:"Select the nested field by which to sort the array or object",sortAscending:"Ascending",sortAscendingTitle:"Sort the selected field in ascending order",sortDescending:"Descending",sortDescendingTitle:"Sort the selected field in descending order",string:"String",transform:"Transform",transformTitle:"Filter, sort, or transform the childs of this ${type}",transformTitleShort:"Filter, sort, or transform contents",extract:"Extract",extractTitle:"Extract this ${type}",transformQueryTitle:"Enter a JMESPath query",transformWizardLabel:"Wizard",transformWizardFilter:"Filter",transformWizardSortBy:"Sort by",transformWizardSelectFields:"Select fields",transformQueryLabel:"Query",transformPreviewLabel:"Preview",type:"Type",typeTitle:"Change the type of this field",openUrl:"Ctrl+Click or Ctrl+Enter to open url in new window",undo:"Undo last action (Ctrl+Z)",validationCannotMove:"Cannot move a field into a child of itself",autoType:'Field type "auto". The field type is automatically determined from the value and can be a string, number, boolean, or null.',objectType:'Field type "object". An object contains an unordered set of key/value pairs.',arrayType:'Field type "array". An array contains an ordered collection of values.',stringType:'Field type "string". Field type is not determined from the value, but always returned as string.',modeEditorTitle:"Switch Editor Mode",modeCodeText:"Code",modeCodeTitle:"Switch to code highlighter",modeFormText:"Form",modeFormTitle:"Switch to form editor",modeTextText:"Text",modeTextTitle:"Switch to plain text editor",modeTreeText:"Tree",modeTreeTitle:"Switch to tree editor",modeViewText:"View",modeViewTitle:"Switch to tree view",modePreviewText:"Preview",modePreviewTitle:"Switch to preview mode",examples:"Examples",default:"Default",containsInvalidProperties:"Contains invalid properties",containsInvalidItems:"Contains invalid items"},es:{array:"Matriz",auto:"Auto",appendText:"Agregar",appendTitle:"Agregue un nuevo campo con el tipo 'auto' despu\xE9s de este campo (Ctrl + Shift + Ins)",appendSubmenuTitle:"Seleccione el tipo de campo que se agregar\xE1",appendTitleAuto:"Agregue un nuevo campo con el tipo 'auto' (Ctrl + Shift + Ins)",ascending:"Ascendente",ascendingTitle:"Ordene los elementos secundarios de este ${type} en orden ascendente",actionsMenu:"Haga clic para abrir el men\xFA de acciones (Ctrl + M)",cannotParseFieldError:"No se puede parsear el campo en JSON",cannotParseValueError:"No se puede parsear el valor en JSON",collapseAll:"Contraer todos los campos",compactTitle:"Compactar datos JSON, eliminar todos los espacios en blanco (Ctrl + Shift + I)",descending:"Descendente",descendingTitle:"Ordene los hijos de este ${type} en orden descendente",drag:"Arrastre para mover este campo (Alt + May\xFAs + Flechas)",duplicateKey:"llave duplicada",duplicateText:"Duplicar",duplicateTitle:"Duplicar campos seleccionados (Ctrl + D)",duplicateField:"Duplicar este campo (Ctrl + D)",duplicateFieldError:"Nombre de campo duplicado",empty:"vacio",expandAll:"Expandir todos los campos",expandTitle:`Haga clic para expandir/contraer este campo (Ctrl + E). 
  Ctrl+Clic para expandir/contraer incluyendo todos los ni\xF1os.`,formatTitle:"Formatee los datos JSON, con la sangr\xEDa y los avances de l\xEDnea adecuados (Ctrl + I)",insert:"Insertar",insertTitle:"Inserte un nuevo campo con el tipo 'auto' antes de este campo (Ctrl + Ins)",insertSub:"Seleccione el tipo de campo a insertar",object:"Objeto",ok:"Ok",redo:"Rehacer (Ctrl+May\xFAs+Z)",removeText:"Eliminar",removeTitle:"Eliminar campos seleccionados (Ctrl+Supr)",removeField:"Eliminar este campo (Ctrl+Supr)",repairTitle:"Reparar JSON: corrija comillas y caracteres de escape, elimine comentarios y notaci\xF3n JSONP, convierta objetos JavaScript en JSON.",searchTitle:"Campos de b\xFAsqueda y valores",searchNextResultTitle:"Siguiente resultado (Entrar)",searchPreviousResultTitle:"Resultado anterior (Shift + Enter)",selectNode:"Seleccione un nodo...",showAll:"mostrar todo",showMore:"mostrar m\xE1s",showMoreStatus:"mostrando ${visibleChilds} de ${totalChilds} elementos.",sort:"Ordenar",sortTitle:"Ordene los hijos de este ${type}",sortTitleShort:"Ordenar contenidos",sortFieldLabel:"Campo:",sortDirectionLabel:"Direcci\xF3n:",sortFieldTitle:"Seleccione el campo anidado por el cual ordenar la matriz u objeto",sortAscending:"Ascendente",sortAscendingTitle:"Ordenar el campo seleccionado en orden ascendente",sortDescending:"Descendente",sortDescendingTitle:"Ordenar por el campo seleccionado, en orden descendente",string:"Texto",transform:"Transformar",transformTitle:"Filtrar, ordenar o transformar los hijos de este ${type}",transformTitleShort:"Filtrar, ordenar o transformar contenidos",extract:"Extraer",extractTitle:"Extrae este ${type}",transformQueryTitle:"Ingrese una consulta JMESPath",transformWizardLabel:"Wizard",transformWizardFilter:"Filtro",transformWizardSortBy:"Ordenar por",transformWizardSelectFields:"Seleccione un campo",transformQueryLabel:"Consulta",transformPreviewLabel:"Vista Previa",type:"Tipo",typeTitle:"Cambiar el tipo de campo",openUrl:"Ctrl+Click o Ctrl+Enter para abrir la URL en una nueva ventana",undo:"Deshacer la \xFAltima acci\xF3n (Ctrl+Z)",validationCannotMove:"No se puede mover un campo a un hijo de s\xED mismo.",autoType:'Tipo de campo "auto". El tipo de campo se determina autom\xE1ticamente a partir del valor y puede ser una cadena, un n\xFAmero, un booleano o un valor nulo.',objectType:'Tipo de campo "objeto".  Un objeto contiene un conjunto desordenado de pares clave/valor.',arrayType:'Tipo de campo "matriz".  Una matriz contiene una colecci\xF3n ordenada de valores.',stringType:'Tipo de campo "cadena".  El tipo de campo no se determina a partir del valor,  pero siempre se devuelve como una cadena.',modeEditorTitle:"Cambiar modo de editor",modeCodeText:"C\xF3digo",modeCodeTitle:"Cambiar al resaltador de c\xF3digo",modeFormText:"Formulario",modeFormTitle:"Cambiar al editor de formularios",modeTextText:"Texto",modeTextTitle:"Cambiar al editor de texto sin formato",modeTreeText:"\xC1rbol",modeTreeTitle:"Cambiar al editor de \xE1rbol",modeViewText:"Vista",modeViewTitle:"Cambiar a la vista de \xE1rbol",modePreviewText:"Vista Previa",modePreviewTitle:"Cambiar al modo de vista previa",examples:"Ejemplos",default:"Predeterminado",containsInvalidProperties:"Contiene propiedades no v\xE1lidas",containsInvalidItems:"Contiene \xEDtems no v\xE1lidos"},"zh-CN":{array:"\u6570\u7EC4",auto:"\u81EA\u52A8",appendText:"\u8FFD\u52A0",appendTitle:"\u5728\u6B64\u5B57\u6BB5\u540E\u8FFD\u52A0\u4E00\u4E2A\u7C7B\u578B\u4E3A\u201Cauto\u201D\u7684\u65B0\u5B57\u6BB5 (Ctrl+Shift+Ins)",appendSubmenuTitle:"\u9009\u62E9\u8981\u8FFD\u52A0\u7684\u5B57\u6BB5\u7C7B\u578B",appendTitleAuto:"\u8FFD\u52A0\u7C7B\u578B\u4E3A\u201Cauto\u201D\u7684\u65B0\u5B57\u6BB5 (Ctrl+Shift+Ins)",ascending:"\u5347\u5E8F",ascendingTitle:"\u5347\u5E8F\u6392\u5217${type}\u7684\u5B50\u8282\u70B9",actionsMenu:"\u70B9\u51FB\u6253\u5F00\u52A8\u4F5C\u83DC\u5355(Ctrl+M)",cannotParseFieldError:"\u65E0\u6CD5\u5C06\u5B57\u6BB5\u89E3\u6790\u4E3AJSON",cannotParseValueError:"\u65E0\u6CD5\u5C06\u503C\u89E3\u6790\u4E3AJSON",collapseAll:"\u7F29\u8FDB\u6240\u6709\u5B57\u6BB5",compactTitle:"\u538B\u7F29JSON\u6570\u636E\uFF0C\u5220\u9664\u6240\u6709\u7A7A\u683C (Ctrl+Shift+I)",descending:"\u964D\u5E8F",descendingTitle:"\u964D\u5E8F\u6392\u5217${type}\u7684\u5B50\u8282\u70B9",drag:"\u62D6\u62FD\u79FB\u52A8\u8BE5\u8282\u70B9(Alt+Shift+Arrows)",duplicateKey:"\u91CD\u590D\u952E",duplicateText:"\u590D\u5236",duplicateTitle:"\u590D\u5236\u9009\u4E2D\u5B57\u6BB5(Ctrl+D)",duplicateField:"\u590D\u5236\u8BE5\u5B57\u6BB5(Ctrl+D)",duplicateFieldError:"\u91CD\u590D\u7684\u5B57\u6BB5\u540D\u79F0",empty:"\u6E05\u7A7A",expandAll:"\u5C55\u5F00\u6240\u6709\u5B57\u6BB5",expandTitle:`\u70B9\u51FB \u5C55\u5F00/\u6536\u7F29 \u8BE5\u5B57\u6BB5(Ctrl+E). 
Ctrl+Click \u5C55\u5F00/\u6536\u7F29 \u5305\u542B\u6240\u6709\u5B50\u8282\u70B9.`,formatTitle:"\u4F7F\u7528\u9002\u5F53\u7684\u7F29\u8FDB\u548C\u6362\u884C\u7B26\u683C\u5F0F\u5316JSON\u6570\u636E (Ctrl+I)",insert:"\u63D2\u5165",insertTitle:"\u5728\u6B64\u5B57\u6BB5\u524D\u63D2\u5165\u7C7B\u578B\u4E3A\u201Cauto\u201D\u7684\u65B0\u5B57\u6BB5 (Ctrl+Ins)",insertSub:"\u9009\u62E9\u8981\u63D2\u5165\u7684\u5B57\u6BB5\u7C7B\u578B",object:"\u5BF9\u8C61",ok:"Ok",redo:"\u91CD\u505A (Ctrl+Shift+Z)",removeText:"\u79FB\u9664",removeTitle:"\u79FB\u9664\u9009\u4E2D\u5B57\u6BB5 (Ctrl+Del)",removeField:"\u79FB\u9664\u8BE5\u5B57\u6BB5 (Ctrl+Del)",repairTitle:"\u4FEE\u590DJSON\uFF1A\u4FEE\u590D\u5F15\u53F7\u548C\u8F6C\u4E49\u7B26\uFF0C\u5220\u9664\u6CE8\u91CA\u548CJSONP\u8868\u793A\u6CD5\uFF0C\u5C06JavaScript\u5BF9\u8C61\u8F6C\u6362\u4E3AJSON\u3002",selectNode:"\u9009\u62E9\u4E00\u4E2A\u8282\u70B9...",showAll:"\u5C55\u793A\u5168\u90E8",showMore:"\u5C55\u793A\u66F4\u591A",showMoreStatus:"\u663E\u793A${totalChilds}\u7684${visibleChilds}\u9879\u76EE.",sort:"\u6392\u5E8F",sortTitle:"\u6392\u5E8F${type}\u7684\u5B50\u8282\u70B9",sortTitleShort:"\u5185\u5BB9\u6392\u5E8F",sortFieldLabel:"\u5B57\u6BB5\uFF1A",sortDirectionLabel:"\u65B9\u5411\uFF1A",sortFieldTitle:"\u9009\u62E9\u7528\u4E8E\u5BF9\u6570\u7EC4\u6216\u5BF9\u8C61\u6392\u5E8F\u7684\u5D4C\u5957\u5B57\u6BB5",sortAscending:"\u5347\u5E8F\u6392\u5E8F",sortAscendingTitle:"\u6309\u7167\u8BE5\u5B57\u6BB5\u5347\u5E8F\u6392\u5E8F",sortDescending:"\u964D\u5E8F\u6392\u5E8F",sortDescendingTitle:"\u6309\u7167\u8BE5\u5B57\u6BB5\u964D\u5E8F\u6392\u5E8F",string:"\u5B57\u7B26\u4E32",transform:"\u53D8\u6362",transformTitle:"\u7B5B\u9009\uFF0C\u6392\u5E8F\uFF0C\u6216\u8005\u8F6C\u6362${type}\u7684\u5B50\u8282\u70B9",transformTitleShort:"\u7B5B\u9009\uFF0C\u6392\u5E8F\uFF0C\u6216\u8005\u8F6C\u6362\u5185\u5BB9",extract:"\u63D0\u53D6",extractTitle:"\u63D0\u53D6\u8FD9\u4E2A ${type}",transformQueryTitle:"\u8F93\u5165JMESPath\u67E5\u8BE2",transformWizardLabel:"\u5411\u5BFC",transformWizardFilter:"\u7B5B\u9009",transformWizardSortBy:"\u6392\u5E8F",transformWizardSelectFields:"\u9009\u62E9\u5B57\u6BB5",transformQueryLabel:"\u67E5\u8BE2",transformPreviewLabel:"\u9884\u89C8",type:"\u7C7B\u578B",typeTitle:"\u66F4\u6539\u5B57\u6BB5\u7C7B\u578B",openUrl:"Ctrl+Click \u6216\u8005 Ctrl+Enter \u5728\u65B0\u7A97\u53E3\u6253\u5F00\u94FE\u63A5",undo:"\u64A4\u9500\u4E0A\u6B21\u52A8\u4F5C (Ctrl+Z)",validationCannotMove:"\u65E0\u6CD5\u5C06\u5B57\u6BB5\u79FB\u5165\u5176\u5B50\u8282\u70B9",autoType:'\u5B57\u6BB5\u7C7B\u578B "auto". \u5B57\u6BB5\u7C7B\u578B\u7531\u503C\u81EA\u52A8\u786E\u5B9A \u53EF\u4EE5\u4E3A string\uFF0Cnumber\uFF0Cboolean\uFF0C\u6216\u8005 null.',objectType:'\u5B57\u6BB5\u7C7B\u578B "object". \u5BF9\u8C61\u5305\u542B\u4E00\u7EC4\u65E0\u5E8F\u7684\u952E/\u503C\u5BF9.',arrayType:'\u5B57\u6BB5\u7C7B\u578B "array". \u6570\u7EC4\u5305\u542B\u503C\u7684\u6709\u5E8F\u96C6\u5408.',stringType:'\u5B57\u6BB5\u7C7B\u578B "string". \u5B57\u6BB5\u7C7B\u578B\u7531\u503C\u81EA\u52A8\u786E\u5B9A\uFF0C\u4F46\u59CB\u7EC8\u4F5C\u4E3A\u5B57\u7B26\u4E32\u8FD4\u56DE.',modeCodeText:"\u4EE3\u7801",modeCodeTitle:"\u5207\u6362\u81F3\u4EE3\u7801\u9AD8\u4EAE",modeFormText:"\u8868\u5355",modeFormTitle:"\u5207\u6362\u81F3\u8868\u5355\u7F16\u8F91",modeTextText:"\u6587\u672C",modeTextTitle:"\u5207\u6362\u81F3\u6587\u672C\u7F16\u8F91",modeTreeText:"\u6811",modeTreeTitle:"\u5207\u6362\u81F3\u6811\u7F16\u8F91",modeViewText:"\u89C6\u56FE",modeViewTitle:"\u5207\u6362\u81F3\u6811\u89C6\u56FE",modePreviewText:"\u9884\u89C8",modePreviewTitle:"\u5207\u6362\u81F3\u9884\u89C8\u6A21\u5F0F",examples:"\u4F8B\u5B50",default:"\u7F3A\u7701",containsInvalidProperties:"\u5305\u542B\u65E0\u6548\u7684\u5C5E\u6027",containsInvalidItems:"\u5305\u542B\u65E0\u6548\u9879\u76EE"},"pt-BR":{array:"Lista",auto:"Automatico",appendText:"Adicionar",appendTitle:"Adicionar novo campo com tipo 'auto' depois deste campo (Ctrl+Shift+Ins)",appendSubmenuTitle:"Selecione o tipo do campo a ser adicionado",appendTitleAuto:"Adicionar novo campo com tipo 'auto' (Ctrl+Shift+Ins)",ascending:"Ascendente",ascendingTitle:"Organizar filhor do tipo ${type} em crescente",actionsMenu:"Clique para abrir o menu de a\xE7\xF5es (Ctrl+M)",cannotParseFieldError:"N\xE3o \xE9 poss\xEDvel analisar o campo no JSON",cannotParseValueError:"N\xE3o \xE9 poss\xEDvel analisar o valor em JSON",collapseAll:"Fechar todos campos",compactTitle:"Dados JSON compactos, remova todos os espa\xE7os em branco (Ctrl+Shift+I)",descending:"Descendente",descendingTitle:"Organizar o filhos do tipo ${type} em decrescente",duplicateKey:"chave duplicada",drag:"Arraste para mover este campo (Alt+Shift+Arrows)",duplicateText:"Duplicar",duplicateTitle:"Duplicar campos selecionados (Ctrl+D)",duplicateField:"Duplicar este campo (Ctrl+D)",duplicateFieldError:"Nome do campo duplicado",empty:"vazio",expandAll:"Expandir todos campos",expandTitle:`Clique para expandir/encolher este campo (Ctrl+E). 
Ctrl+Click para expandir/encolher incluindo todos os filhos.`,formatTitle:"Formate dados JSON, com recuo e feeds de linha adequados (Ctrl+I)",insert:"Inserir",insertTitle:"Inserir um novo campo do tipo 'auto' antes deste campo (Ctrl+Ins)",insertSub:"Selecionar o tipo de campo a ser inserido",object:"Objeto",ok:"Ok",redo:"Refazer (Ctrl+Shift+Z)",removeText:"Remover",removeTitle:"Remover campos selecionados (Ctrl+Del)",removeField:"Remover este campo (Ctrl+Del)",repairTitle:"Repare JSON: corrija aspas e caracteres de escape, remova coment\xE1rios e nota\xE7\xE3o JSONP, transforme objetos JavaScript em JSON.",selectNode:"Selecione um n\xF3dulo...",showAll:"mostrar todos",showMore:"mostrar mais",showMoreStatus:"exibindo ${visibleChilds} de ${totalChilds} itens.",sort:"Organizar",sortTitle:"Organizar os filhos deste ${type}",sortTitleShort:"Organizar os filhos",sortFieldLabel:"Campo:",sortDirectionLabel:"Dire\xE7\xE3o:",sortFieldTitle:"Selecione um campo filho pelo qual ordenar o array ou objeto",sortAscending:"Ascendente",sortAscendingTitle:"Ordenar o campo selecionado por ordem ascendente",sortDescending:"Descendente",sortDescendingTitle:"Ordenar o campo selecionado por ordem descendente",string:"Texto",transform:"Transformar",transformTitle:"Filtrar, ordenar ou transformar os filhos deste ${type}",transformTitleShort:"Filtrar, ordenar ou transformar conte\xFAdos",transformQueryTitle:"Insira uma express\xE3o JMESPath",transformWizardLabel:"Assistente",transformWizardFilter:"Filtro",transformWizardSortBy:"Ordenar por",transformWizardSelectFields:"Selecionar campos",transformQueryLabel:"Express\xE3o",transformPreviewLabel:"Visualizar",type:"Tipo",typeTitle:"Mudar o tipo deste campo",openUrl:"Ctrl+Click ou Ctrl+Enter para abrir link em nova janela",undo:"Desfazer \xFAltimo a\xE7\xE3o (Ctrl+Z)",validationCannotMove:"N\xE3o pode mover um campo como filho dele mesmo",autoType:'Campo do tipo "auto". O tipo do campo \xE9 determinao automaticamente a partir do seu valor e pode ser texto, n\xFAmero, verdade/falso ou nulo.',objectType:'Campo do tipo "objeto". Um objeto cont\xE9m uma lista de pares com chave e valor.',arrayType:'Campo do tipo "lista". Uma lista contem uma cole\xE7\xE3o de valores ordenados.',stringType:'Campo do tipo "string". Campo do tipo nao \xE9 determinado atrav\xE9s do seu valor, mas sempre retornara um texto.',examples:"Exemplos",default:"Revelia",containsInvalidProperties:"Cont\xE9m propriedades inv\xE1lidas",containsInvalidItems:"Cont\xE9m itens inv\xE1lidos"},tr:{array:"Dizin",auto:"Otomatik",appendText:"Ekle",appendTitle:"Bu alan\u0131n alt\u0131na 'otomatik' tipinde yeni bir alan ekle (Ctrl+Shift+Ins)",appendSubmenuTitle:"Eklenecek alan\u0131n tipini se\xE7",appendTitleAuto:"'Otomatik' tipinde yeni bir alan ekle (Ctrl+Shift+Ins)",ascending:"Artan",ascendingTitle:"${type}'\u0131n alt tiplerini artan d\xFCzende s\u0131rala",actionsMenu:"Aksiyon men\xFCs\xFCn\xFC a\xE7mak i\xE7in t\u0131klay\u0131n (Ctrl+M)",collapseAll:"T\xFCm alanlar\u0131 kapat",descending:"Azalan",descendingTitle:"${type}'\u0131n alt tiplerini azalan d\xFCzende s\u0131rala",drag:"Bu alan\u0131 ta\u015F\u0131mak i\xE7in s\xFCr\xFCkleyin (Alt+Shift+Arrows)",duplicateKey:"Var olan anahtar",duplicateText:"A\u015Fa\u011F\u0131ya kopyala",duplicateTitle:"Se\xE7ili alanlardan bir daha olu\u015Ftur (Ctrl+D)",duplicateField:"Bu alandan bir daha olu\u015Ftur (Ctrl+D)",duplicateFieldError:"Duplicate field name",cannotParseFieldError:"Alan JSON'a ayr\u0131\u015Ft\u0131r\u0131lam\u0131yor",cannotParseValueError:"JSON'a de\u011Fer ayr\u0131\u015Ft\u0131r\u0131lam\u0131yor",empty:"bo\u015F",expandAll:"T\xFCm alanlar\u0131 a\xE7",expandTitle:`Bu alan\u0131 a\xE7mak/kapatmak i\xE7in t\u0131kla (Ctrl+E). 
Alt alanlarda dahil t\xFCm alanlar\u0131 a\xE7mak i\xE7in Ctrl+Click `,insert:"Ekle",insertTitle:"Bu alan\u0131n \xFCst\xFCne 'otomatik' tipinde yeni bir alan ekle (Ctrl+Ins)",insertSub:"Araya eklenecek alan\u0131n tipini se\xE7",object:"Nesne",ok:"Tamam",redo:"Yeniden yap (Ctrl+Shift+Z)",removeText:"Kald\u0131r",removeTitle:"Se\xE7ilen alanlar\u0131 kald\u0131r (Ctrl+Del)",removeField:"Bu alan\u0131 kald\u0131r (Ctrl+Del)",selectNode:"Bir nesne se\xE7...",showAll:"t\xFCm\xFCn\xFC g\xF6ster",showMore:"daha fazla g\xF6ster",showMoreStatus:"${totalChilds} alan\u0131n ${visibleChilds} alt alanlar\u0131 g\xF6steriliyor",sort:"S\u0131rala",sortTitle:"${type}'\u0131n alt alanlar\u0131n\u0131 s\u0131rala",sortTitleShort:"\u0130\xE7erikleri s\u0131rala",sortFieldLabel:"Alan:",sortDirectionLabel:"Y\xF6n:",sortFieldTitle:"Diziyi veya nesneyi s\u0131ralamak i\xE7in i\xE7 i\xE7e ge\xE7mi\u015F alan\u0131 se\xE7in",sortAscending:"Artan",sortAscendingTitle:"Se\xE7ili alan\u0131 artan d\xFCzende s\u0131rala",sortDescending:"Azalan",sortDescendingTitle:"Se\xE7ili alan\u0131 azalan d\xFCzende s\u0131rala",string:"Karakter Dizisi",transform:"D\xF6n\xFC\u015Ft\xFCr",transformTitle:"${type}'\u0131n alt alanlar\u0131n\u0131 filtrele, s\u0131rala veya d\xF6n\xFC\u015Ft\xFCr",transformTitleShort:"\u0130\xE7erikleri filterele, s\u0131rala veya d\xF6n\xFC\u015Ft\xFCr",transformQueryTitle:"JMESPath sorgusu gir",transformWizardLabel:"Sihirbaz",transformWizardFilter:"Filtre",transformWizardSortBy:"S\u0131rala",transformWizardSelectFields:"Alanlar\u0131 se\xE7",transformQueryLabel:"Sorgu",transformPreviewLabel:"\xD6nizleme",type:"Tip",typeTitle:"Bu alan\u0131n tipini de\u011Fi\u015Ftir",openUrl:"URL'i yeni bir pencerede a\xE7mak i\xE7in Ctrl+Click veya Ctrl+Enter",undo:"Son de\u011Fi\u015Fikli\u011Fi geri al (Ctrl+Z)",validationCannotMove:"Alt alan olarak ta\u015F\u0131nam\u0131yor",autoType:'Alan tipi "otomatik". Alan t\xFCr\xFC otomatik olarak de\u011Ferden belirlenirve bir dize, say\u0131, boolean veya null olabilir.',objectType:'Alan tipi "nesne". Bir nesne, s\u0131ralanmam\u0131\u015F bir anahtar / de\u011Fer \xE7ifti k\xFCmesi i\xE7erir.',arrayType:'Alan tipi "dizi". Bir dizi, d\xFCzenli de\u011Ferler koleksiyonu i\xE7erir.',stringType:'Alan tipi "karakter dizisi". Alan t\xFCr\xFC de\u011Ferden belirlenmez,ancak her zaman karakter dizisi olarak d\xF6nd\xFCr\xFCl\xFCr.',modeCodeText:"Kod",modeCodeTitle:"Kod vurgulay\u0131c\u0131ya ge\xE7",modeFormText:"Form",modeFormTitle:"Form d\xFCzenleyiciye ge\xE7",modeTextText:"Metin",modeTextTitle:"D\xFCz metin d\xFCzenleyiciye ge\xE7",modeTreeText:"A\u011Fa\xE7",modeTreeTitle:"A\u011Fa\xE7 d\xFCzenleyiciye ge\xE7",modeViewText:"G\xF6r\xFCn\xFCm",modeViewTitle:"A\u011Fa\xE7 g\xF6r\xFCn\xFCm\xFCne ge\xE7",examples:"\xD6rnekler",default:"Varsay\u0131lan",containsInvalidProperties:"Ge\xE7ersiz \xF6zellikler i\xE7eriyor",containsInvalidItems:"Ge\xE7ersiz \xF6\u011Feler i\xE7eriyor"},ja:{array:"\u914D\u5217",auto:"\u30AA\u30FC\u30C8",appendText:"\u8FFD\u52A0",appendTitle:'\u6B21\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u306B"\u30AA\u30FC\u30C8"\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u8FFD\u52A0 (Ctrl+Shift+Ins)',appendSubmenuTitle:"\u8FFD\u52A0\u3059\u308B\u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u578B\u3092\u9078\u629E\u3057\u3066\u304F\u3060\u3055\u3044",appendTitleAuto:'"\u30AA\u30FC\u30C8"\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u8FFD\u52A0 (Ctrl+Shift+Ins)',ascending:"\u6607\u9806",ascendingTitle:"${type}\u306E\u5B50\u8981\u7D20\u3092\u6607\u9806\u306B\u4E26\u3079\u66FF\u3048",actionsMenu:"\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u30A2\u30AF\u30B7\u30E7\u30F3\u30E1\u30CB\u30E5\u30FC\u3092\u958B\u304F (Ctrl+M)",collapseAll:"\u3059\u3079\u3066\u3092\u6298\u308A\u305F\u305F\u3080",descending:"\u964D\u9806",descendingTitle:"${type}\u306E\u5B50\u8981\u7D20\u3092\u964D\u9806\u306B\u4E26\u3079\u66FF\u3048",drag:"\u30C9\u30E9\u30C3\u30B0\u3057\u3066\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u79FB\u52D5 (Alt+Shift+Arrows)",duplicateKey:"\u8907\u88FD\u30AD\u30FC",duplicateText:"\u8907\u88FD",duplicateTitle:"\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u8907\u88FD (Ctrl+D)",duplicateField:"\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u8907\u88FD (Ctrl+D)",duplicateFieldError:"\u30D5\u30A3\u30FC\u30EB\u30C9\u540D\u304C\u91CD\u8907\u3057\u3066\u3044\u307E\u3059",cannotParseFieldError:"JSON\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u89E3\u6790\u3067\u304D\u307E\u305B\u3093",cannotParseValueError:"JSON\u306E\u5024\u3092\u89E3\u6790\u3067\u304D\u307E\u305B\u3093",empty:"\u7A7A",expandAll:"\u3059\u3079\u3066\u3092\u5C55\u958B",expandTitle:`\u30AF\u30EA\u30C3\u30AF\u3057\u3066\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u5C55\u958B/\u6298\u308A\u305F\u305F\u3080 (Ctrl+E). 
Ctrl+Click \u3067\u3059\u3079\u3066\u306E\u5B50\u8981\u7D20\u3092\u5C55\u958B/\u6298\u308A\u305F\u305F\u3080`,insert:"\u633F\u5165",insertTitle:"\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u524D\u306B\u65B0\u3057\u3044\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u633F\u5165 (Ctrl+Ins)",insertSub:"\u633F\u5165\u3059\u308B\u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u578B\u3092\u9078\u629E",object:"\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8",ok:"\u5B9F\u884C",redo:"\u3084\u308A\u76F4\u3059 (Ctrl+Shift+Z)",removeText:"\u524A\u9664",removeTitle:"\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u524A\u9664 (Ctrl+Del)",removeField:"\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u524A\u9664 (Ctrl+Del)",selectNode:"\u30CE\u30FC\u30C9\u3092\u9078\u629E...",showAll:"\u3059\u3079\u3066\u3092\u8868\u793A",showMore:"\u3082\u3063\u3068\u898B\u308B",showMoreStatus:"${totalChilds}\u500B\u306E\u30A2\u30A4\u30C6\u30E0\u306E\u3046\u3061 ${visibleChilds}\u500B\u3092\u8868\u793A\u3057\u3066\u3044\u307E\u3059\u3002",sort:"\u4E26\u3079\u66FF\u3048",sortTitle:"${type}\u306E\u5B50\u8981\u7D20\u3092\u4E26\u3079\u66FF\u3048",sortTitleShort:"\u4E26\u3079\u66FF\u3048",sortFieldLabel:"\u30D5\u30A3\u30FC\u30EB\u30C9:",sortDirectionLabel:"\u9806\u5E8F:",sortFieldTitle:"\u914D\u5217\u307E\u305F\u306F\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u3092\u4E26\u3073\u66FF\u3048\u308B\u305F\u3081\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u9078\u629E",sortAscending:"\u6607\u9806",sortAscendingTitle:"\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u6607\u9806\u306B\u4E26\u3073\u66FF\u3048",sortDescending:"\u964D\u9806",sortDescendingTitle:"\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u964D\u9806\u306B\u4E26\u3073\u66FF\u3048",string:"\u6587\u5B57\u5217",transform:"\u5909\u63DB",transformTitle:"${type}\u306E\u5B50\u8981\u7D20\u3092\u30D5\u30A3\u30EB\u30BF\u30FC\u30FB\u4E26\u3073\u66FF\u3048\u30FB\u5909\u63DB\u3059\u308B",transformTitleShort:"\u5185\u5BB9\u3092\u30D5\u30A3\u30EB\u30BF\u30FC\u30FB\u4E26\u3073\u66FF\u3048\u30FB\u5909\u63DB\u3059\u308B",extract:"\u62BD\u51FA",extractTitle:"${type}\u3092\u62BD\u51FA",transformQueryTitle:"JMESPath\u30AF\u30A8\u30EA\u3092\u5165\u529B",transformWizardLabel:"\u30A6\u30A3\u30B6\u30FC\u30C9",transformWizardFilter:"\u30D5\u30A3\u30EB\u30BF\u30FC",transformWizardSortBy:"\u4E26\u3073\u66FF\u3048",transformWizardSelectFields:"\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u9078\u629E",transformQueryLabel:"\u30AF\u30A8\u30EA",transformPreviewLabel:"\u30D7\u30EC\u30D3\u30E5\u30FC",type:"\u578B",typeTitle:"\u9078\u629E\u4E2D\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u578B\u3092\u5909\u66F4",openUrl:"Ctrl+Click \u307E\u305F\u306F Ctrl+Enter \u3067 \u65B0\u898F\u30A6\u30A3\u30F3\u30C9\u30A6\u3067URL\u3092\u958B\u304F",undo:"\u5143\u306B\u623B\u3059 (Ctrl+Z)",validationCannotMove:"\u5B50\u8981\u7D20\u306B\u79FB\u52D5\u3067\u304D\u307E\u305B\u3093 ",autoType:"\u30AA\u30FC\u30C8\uFF1A \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u578B\u306F\u5024\u304B\u3089\u81EA\u52D5\u7684\u306B\u6C7A\u5B9A\u3055\u308C\u307E\u3059\u3002 (\u6587\u5B57\u5217\u30FB\u6570\u5024\u30FB\u30D6\u30FC\u30EB\u30FBnull)",objectType:"\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\uFF1A \u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u306F\u9806\u5E8F\u304C\u6C7A\u307E\u3063\u3066\u3044\u306A\u3044\u30AD\u30FC\u3068\u5024\u306E\u30DA\u30A2\u7D44\u307F\u5408\u308F\u305B\u3067\u3059\u3002",arrayType:"\u914D\u5217\uFF1A \u914D\u5217\u306F\u9806\u5E8F\u304C\u6C7A\u307E\u3063\u3066\u3044\u308B\u5024\u306E\u96C6\u5408\u4F53\u3067\u3059\u3002",stringType:"\u6587\u5B57\u5217\uFF1A \u30D5\u30A3\u30FC\u30EB\u30C9\u578B\u306F\u5024\u304B\u3089\u6C7A\u5B9A\u3055\u308C\u307E\u305B\u3093\u304C\u3001\u5E38\u306B\u6587\u5B57\u5217\u3068\u3057\u3066\u8FD4\u3055\u308C\u307E\u3059\u3002",modeCodeText:"\u30B3\u30FC\u30C9\u30E2\u30FC\u30C9",modeCodeTitle:"\u30CF\u30A4\u30E9\u30A4\u30C8\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048",modeFormText:"\u30D5\u30A9\u30FC\u30E0\u30E2\u30FC\u30C9",modeFormTitle:"\u30D5\u30A9\u30FC\u30E0\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048",modeTextText:"\u30C6\u30AD\u30B9\u30C8\u30E2\u30FC\u30C9",modeTextTitle:"\u30C6\u30AD\u30B9\u30C8\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048",modeTreeText:"\u30C4\u30EA\u30FC\u30E2\u30FC\u30C9",modeTreeTitle:"\u30C4\u30EA\u30FC\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048",modeViewText:"\u30D3\u30E5\u30FC\u30E2\u30FC\u30C9",modeViewTitle:"\u30D3\u30E5\u30FC\u30E2\u30FC\u30C9\u306B\u5207\u308A\u66FF\u3048",modePreviewText:"\u30D7\u30EC\u30D3\u30E5\u30FC",modePreviewTitle:"\u30D7\u30EC\u30D3\u30E5\u30FC\u306B\u5207\u308A\u66FF\u3048",examples:"\u4F8B",default:"\u30C7\u30D5\u30A9\u30EB\u30C8",containsInvalidProperties:"\u7121\u52B9\u306A\u30D7\u30ED\u30D1\u30C6\u30A3\u304C\u542B\u307E\u308C\u3066\u3044\u307E\u3059",containsInvalidItems:"\u7121\u52B9\u306A\u30A2\u30A4\u30C6\u30E0\u304C\u542B\u307E\u308C\u3066\u3044\u307E\u3059"},"fr-FR":{array:"Liste",auto:"Auto",appendText:"Ajouter",appendTitle:"Ajouter un champ de type 'auto' apr\xE8s ce champ (Ctrl+Shift+Ins)",appendSubmenuTitle:"S\xE9lectionner le type du champ \xE0 ajouter",appendTitleAuto:"Ajouter un champ de type 'auto' (Ctrl+Shift+Ins)",ascending:"Ascendant",ascendingTitle:"Trier les enfants de ce ${type} par ordre ascendant",actionsMenu:"Ouvrir le menu des actions (Ctrl+M)",collapseAll:"Regrouper",descending:"Descendant",descendingTitle:"Trier les enfants de ce ${type} par ordre descendant",drag:"D\xE9placer (Alt+Shift+Arrows)",duplicateKey:"Dupliquer la cl\xE9",duplicateText:"Dupliquer",duplicateTitle:"Dupliquer les champs s\xE9lectionn\xE9s (Ctrl+D)",duplicateField:"Dupliquer ce champ (Ctrl+D)",duplicateFieldError:"Dupliquer le nom de champ",cannotParseFieldError:"Champ impossible \xE0 parser en JSON",cannotParseValueError:"Valeur impossible \xE0 parser en JSON",empty:"vide",expandAll:"\xC9tendre",expandTitle:`\xC9tendre/regrouper ce champ (Ctrl+E). 
Ctrl+Click pour \xE9tendre/regrouper avec tous les champs.`,insert:"Ins\xE9rer",insertTitle:"Ins\xE9rer un champ de type 'auto' avant ce champ (Ctrl+Ins)",insertSub:"S\xE9lectionner le type de champ \xE0 ins\xE9rer",object:"Objet",ok:"Ok",redo:"Rejouer (Ctrl+Shift+Z)",removeText:"Supprimer",removeTitle:"Supprimer les champs s\xE9lectionn\xE9s (Ctrl+Del)",removeField:"Supprimer ce champ (Ctrl+Del)",searchTitle:"Rechercher champs et valeurs",searchNextResultTitle:"R\xE9sultat suivant (Enter)",searchPreviousResultTitle:"R\xE9sultat pr\xE9c\xE9dent (Shift + Enter)",selectNode:"S\xE9lectionner un n\u0153ud...",showAll:"voir tout",showMore:"voir plus",showMoreStatus:"${visibleChilds} \xE9l\xE9ments affich\xE9s de ${totalChilds}.",sort:"Trier",sortTitle:"Trier les champs de ce ${type}",sortTitleShort:"Trier",sortFieldLabel:"Champ:",sortDirectionLabel:"Direction:",sortFieldTitle:"S\xE9lectionner les champs permettant de trier les listes et objet",sortAscending:"Ascendant",sortAscendingTitle:"Trier les champs s\xE9lectionn\xE9s par ordre ascendant",sortDescending:"Descendant",sortDescendingTitle:"Trier les champs s\xE9lectionn\xE9s par ordre descendant",string:"Cha\xEEne",transform:"Transformer",transformTitle:"Filtrer, trier, or transformer les enfants de ce ${type}",transformTitleShort:"Filtrer, trier ou transformer le contenu",extract:"Extraire",extractTitle:"Extraire ce ${type}",transformQueryTitle:"Saisir une requ\xEAte JMESPath",transformWizardLabel:"Assistant",transformWizardFilter:"Filtrer",transformWizardSortBy:"Trier par",transformWizardSelectFields:"S\xE9lectionner les champs",transformQueryLabel:"Requ\xEAte",transformPreviewLabel:"Pr\xE9visualisation",type:"Type",typeTitle:"Changer le type de ce champ",openUrl:"Ctrl+Click ou Ctrl+Enter pour ouvrir l'url dans une autre fen\xEAtre",undo:"Annuler la derni\xE8re action (Ctrl+Z)",validationCannotMove:"Cannot move a field into a child of itself",autoType:'Champe de type "auto". Ce type de champ est automatiquement d\xE9termin\xE9 en fonction de la valeur et peut \xEAtre de type "cha\xEEne", "nombre", "bool\xE9en" ou null.',objectType:'Champ de type "objet". Un objet contient un ensemble non ordonn\xE9 de paires cl\xE9/valeur.',arrayType:'Champ de type "liste". Une liste contient une collection ordonn\xE9e de valeurs.',stringType:`Champ de type "cha\xEEne". Ce type de champ n'est pas d\xE9termin\xE9 en fonction de la valeur, mais retourne syst\xE9matiquement une cha\xEEne de caract\xE8res.`,modeEditorTitle:"Changer mode d'\xE9dition",modeCodeText:"Code",modeCodeTitle:"Activer surlignage code",modeFormText:"Formulaire",modeFormTitle:"Activer formulaire",modeTextText:"Texte",modeTextTitle:"Activer \xE9diteur texte",modeTreeText:"Arbre",modeTreeTitle:"Activer \xE9diteur arbre",modeViewText:"Lecture seule",modeViewTitle:"Activer vue arbre",modePreviewText:"Pr\xE9visualisation",modePreviewTitle:"Activer mode pr\xE9visualiser",examples:"Exemples",default:"D\xE9faut",containsInvalidProperties:"Contient des propri\xE9t\xE9s non valides",containsInvalidItems:"Contient des \xE9l\xE9ments invalides"},de:{array:"Auflistung",auto:"Auto",appendText:"anh\xE4ngen",appendTitle:"F\xFCgen Sie nach diesem Feld ein neues Feld mit dem Typ 'auto' ein (Strg+Umschalt+Ein)",appendSubmenuTitle:"W\xE4hlen Sie den Typ des neuen Feldes",appendTitleAuto:"Ein neues Feld vom Typ 'auto' hinzuf\xFCgen (Strg+Umschalt+Ein)",ascending:"Aufsteigend",ascendingTitle:"Sortieren Sie die Elemente dieses ${type} in aufsteigender Reihenfolge",actionsMenu:"Klicken Sie zum \xD6ffnen des Aktionsmen\xFCs (Strg+M)",cannotParseFieldError:"Feld kann nicht in JSON geparst werden",cannotParseValueError:"Wert kann nicht in JSON geparst werden",collapseAll:"Alle Felder zuklappen",compactTitle:"JSON-Daten verdichten, alle Leerzeichen entfernen (Strg+Umschalt+\\)",descending:"Absteigend",descendingTitle:"Sortieren Sie die Elemente dieses ${type} in absteigender Reihenfolge",drag:"Ziehen, um dieses Feld zu verschieben (Alt+Umschalt+Pfeile)",duplicateKey:"Doppelter Schl\xFCssel",duplicateText:"Duplikat",duplicateTitle:"Ausgew\xE4hlte Felder duplizieren (Strg+D)",duplicateField:"Dieses Feld duplizieren (Strg+D)",duplicateFieldError:"Doppelter Feldname",empty:"leer",expandAll:"Alle Felder anzeigen",expandTitle:`Klicken Sie, um dieses Feld zu erweitern/zu kollabieren (Strg+E). 
Strg+Klicken Sie, um dieses Feld einschlie\xDFlich aller Elemente zu erweitern/zu kollabieren.`,formatTitle:"JSON-Daten mit korrekter Einr\xFCckung und Zeilenvorsch\xFCben formatieren (Strg+\\)",insert:"einf\xFCgen",insertTitle:"F\xFCgen Sie vor diesem Feld ein neues Feld mit dem Typ 'auto' ein (Strg+Einfg)",insertSub:"W\xE4hlen Sie den Typ des neuen Feldes",object:"Objekt",ok:"Ok",redo:"Wiederholen (Strg+Umschalt+Z)",removeText:"entfernen",removeTitle:"Ausgew\xE4hlte Felder entfernen (Strg+Entf)",removeField:"Dieses Feld entfernen (Strg+Entf)",repairTitle:"JSON reparieren: Anf\xFChrungszeichen und Escape-Zeichen korrigieren, Kommentare und JSONP-Notation entfernen, JavaScript-Objekte in JSON umwandeln.",searchTitle:"Suchfelder und Werte",searchNextResultTitle:"N\xE4chstes Ergebnis (Enter)",searchPreviousResultTitle:"Vorheriges Ergebnis (Umschalt + Eingabe)",selectNode:"W\xE4hlen Sie einen Knoten aus...",showAll:"alle anzeigen",showMore:"mehr anzeigen",showMoreStatus:"Anzeige von ${visibleChilds} von ${totalChilds}-Elementen.",sort:"Sortieren",sortTitle:"Sortieren Sie die Elemente dieses ${type}",sortTitleShort:"Inhalt sortieren",sortFieldLabel:"Feld:",sortDirectionLabel:"Richtung:",sortFieldTitle:"W\xE4hlen Sie das verschachtelte Feld, nach dem das Array oder Objekt sortiert werden soll.",sortAscending:"Aufsteigend",sortAscendingTitle:"Sortieren Sie das ausgew\xE4hlte Feld in aufsteigender Reihenfolge",sortDescending:"Absteigend",sortDescendingTitle:"Sortieren Sie das ausgew\xE4hlte Feld in absteigender Reihenfolge",string:"Zeichenfolge",transform:"Verwandeln",transformTitle:"Die Elemente dieses ${type} filtern, sortieren oder transformieren",transformTitleShort:"Inhalte filtern, sortieren oder transformieren",extract:"Auszug",extractTitle:"Extrahieren Sie diesen ${type}",transformQueryTitle:"Eine JMESPath-Abfrage eingeben",transformWizardLabel:"Zauberer",transformWizardFilter:"Filter",transformWizardSortBy:"Sortieren nach",transformWizardSelectFields:"Felder ausw\xE4hlen",transformQueryLabel:"Anfrage",transformPreviewLabel:"Vorschau",type:"Geben Sie  ein.",typeTitle:"\xC4ndern Sie den Typ dieses Feldes",openUrl:"Strg+Klicken oder Strg+Eingabe, um die URL in einem neuen Fenster zu \xF6ffnen",undo:"Letzte Aktion r\xFCckg\xE4ngig machen (Strg+Z)",validationCannotMove:"Kann ein Feld nicht in ein Kind seiner selbst verschieben",autoType:'Feldtyp "auto". Der Feldtyp wird automatisch aus dem Wert bestimmt und kann ein String, eine Zahl, boolesch oder null sein.',objectType:'Feldtyp "Objekt". Ein Objekt enth\xE4lt eine ungeordnete Menge von Schl\xFCssel/Wert-Paaren.',arrayType:'Feldtyp "Array". Ein Array enth\xE4lt eine geordnete Sammlung von Werten.',stringType:'Feldtyp "Zeichenfolge". Der Feldtyp wird nicht aus dem Wert bestimmt, sondern immer als Zeichenfolge zur\xFCckgegeben.',modeEditorTitle:"Editor-Modus umschalten",modeCodeText:"Code",modeCodeTitle:"Umschalten auf Code-Highlighter",modeFormText:"Formular",modeFormTitle:"Zum Formular-Editor wechseln",modeTextText:"Text",modeTextTitle:"Zum Editor f\xFCr einfachen Text wechseln",modeTreeText:"Baum",modeTreeTitle:"Zum Baum-Editor wechseln",modeViewText:"Siehe",modeViewTitle:"Zur Baumansicht wechseln",modePreviewText:"Vorschau",modePreviewTitle:"In den Vorschau-Modus wechseln",examples:"Beispiele",default:"Standardm\xE4\xDFig",containsInvalidProperties:"Enth\xE4lt ung\xFCltige Eigenschaften",containsInvalidItems:"Enth\xE4lt ung\xFCltige Elemente"},ru:{array:"\u041C\u0430\u0441\u0441\u0438\u0432",auto:"\u0410\u0432\u0442\u043E",appendText:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C",appendTitle:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u043E\u0435 \u043F\u043E\u043B\u0435 \u0441 \u0442\u0438\u043F\u043E\u043C '\u0430\u0432\u0442\u043E' \u043F\u043E\u0441\u043B\u0435 \u044D\u0442\u043E\u0433\u043E \u043F\u043E\u043B\u044F (Ctrl+Shift+Ins)",appendSubmenuTitle:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0442\u0438\u043F \u043F\u043E\u043B\u044F \u0434\u043B\u044F \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u044F",appendTitleAuto:"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u043E\u0435 \u043F\u043E\u043B\u0435 \u0441 \u0442\u0438\u043F\u043E\u043C '\u0430\u0432\u0442\u043E' (Ctrl+Shift+Ins)",ascending:"\u041F\u043E \u0432\u043E\u0437\u0440\u0430\u0441\u0442\u0430\u043D\u0438\u044E",ascendingTitle:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C ${type} \u043F\u043E \u0432\u043E\u0437\u0440\u0430\u0441\u0442\u0430\u043D\u0438\u044E",actionsMenu:"\u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u0434\u043B\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u044F \u043C\u0435\u043D\u044E \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439 (Ctrl+M)",cannotParseFieldError:"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043F\u0440\u0435\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u043B\u0435 \u0432 JSON",cannotParseValueError:"\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u043F\u0440\u0435\u043E\u0431\u0440\u0430\u0437\u043E\u0432\u0430\u0442\u044C \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0432 JSON",collapseAll:"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u0432\u0441\u0435",compactTitle:"\u041C\u0438\u043D\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u044F JSON (Ctrl+Shift+I)",descending:"\u041F\u043E \u0443\u0431\u044B\u0432\u0430\u043D\u0438\u044E",descendingTitle:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C ${type} \u043F\u043E \u0443\u0431\u044B\u0432\u0430\u043D\u0438\u044E",drag:"\u041F\u043E\u0442\u044F\u043D\u0438\u0442\u0435 \u0434\u043B\u044F \u043F\u0435\u0440\u0435\u043C\u0435\u0449\u0435\u043D\u0438\u044F \u044D\u0442\u043E\u0433\u043E \u043F\u043E\u043B\u044F (Alt+Shift+Arrows)",duplicateKey:"\u043F\u043E\u0432\u0442\u043E\u0440\u044F\u044E\u0449\u0438\u0439\u0441\u044F \u043A\u043B\u044E\u0447",duplicateText:"\u0414\u0443\u0431\u043B\u0438\u0440\u043E\u0432\u0430\u0442\u044C",duplicateTitle:"\u0414\u0443\u0431\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u043F\u043E\u043B\u0435\u0439 (Ctrl+D)",duplicateField:"\u0414\u0443\u0431\u043B\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u043E\u043B\u0435 (Ctrl+D)",duplicateFieldError:"\u0414\u0443\u0431\u043B\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044F \u043F\u043E\u043B\u044F",empty:"\u043F\u0443\u0441\u0442\u043E\u0439",expandAll:"\u0420\u0430\u0437\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u0432\u0441\u0435",expandTitle:`\u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u0434\u043B\u044F \u0440\u0430\u0441\u043A\u0440\u044B\u0442\u0438\u044F/\u0441\u043A\u0440\u044B\u0442\u0438\u044F \u043F\u043E\u043B\u044F (Ctrl+E)
\u0438\u043B\u0438 Ctrl+Click \u0434\u043B\u044F \u0440\u0430\u0441\u043A\u0440\u044B\u0442\u0438\u044F/\u0441\u043A\u0440\u044B\u0442\u0438\u044F \u0432\u0441\u0435\u0445 \u043F\u043E\u0442\u043E\u043C\u043A\u043E\u0432.`,formatTitle:"\u0424\u043E\u0440\u043C\u0430\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 JSON (Ctrl+I)",insert:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044C",insertTitle:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u043D\u043E\u0432\u043E\u0435 \u043F\u043E\u043B\u0435 \u0441 \u0442\u0438\u043F\u043E\u043C '\u0430\u0432\u0442\u043E' \u043F\u0435\u0440\u0435\u0434 \u044D\u0442\u0438\u043C \u043F\u043E\u043B\u0435\u043C (Ctrl+Ins)",insertSub:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u0442\u0438\u043F \u043F\u043E\u043B\u044F \u0434\u043B\u044F \u0432\u0441\u0442\u0430\u0432\u043A\u0438",object:"\u041E\u0431\u044A\u0435\u043A\u0442",ok:"\u041E\u041A",redo:"\u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u044C (Ctrl+Shift+Z)",removeText:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",removeTitle:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u043F\u043E\u043B\u044F (Ctrl+Del)",removeField:"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043E\u043B\u0435 (Ctrl+Del)",repairTitle:"\u0412\u043E\u0441\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u0442\u0435 JSON: \u0438\u0441\u043F\u0440\u0430\u0432\u044C\u0442\u0435 \u043A\u0430\u0432\u044B\u0447\u043A\u0438 \u0438 escape-\u0441\u0438\u043C\u0432\u043E\u043B\u044B, \u0443\u0434\u0430\u043B\u0438\u0442\u0435 \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438 \u0438 \u043D\u043E\u0442\u0430\u0446\u0438\u044E JSONP, \u043C\u043E\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u0443\u0439\u0442\u0435 \u043E\u0431\u044A\u0435\u043A\u0442\u044B JavaScript \u0432 JSON.",searchTitle:"\u041F\u043E\u0438\u0441\u043A",searchNextResultTitle:"\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442 (Enter)",searchPreviousResultTitle:"\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0438\u0439 \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442 (Shift + Enter)",selectNode:"\u0412\u044B\u0431\u043E\u0440 \u0443\u0437\u043B\u0430...",showAll:"\u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0432\u0441\u0435",showMore:"\u0431\u043E\u043B\u044C\u0448\u0435",showMoreStatus:"${visibleChilds} \u0438\u0437 ${totalChilds}",sort:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430",sortTitle:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u043F\u043E\u0442\u043E\u043C\u043A\u043E\u0432 \u0442\u0438\u043F\u0430 ${type}",sortTitleShort:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u043C\u043E\u0433\u043E",sortFieldLabel:"\u041F\u043E\u043B\u0435:",sortDirectionLabel:"\u041D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435:",sortFieldTitle:"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u043E\u043B\u0435 \u0434\u043B\u044F \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0438 \u043C\u0430\u0441\u0441\u0438\u0432\u0430 \u0438\u043B\u0438 \u043E\u0431\u044A\u0435\u043A\u0442\u0430",sortAscending:"\u041F\u043E \u0432\u043E\u0437\u0440\u0430\u0441\u0442\u0430\u043D\u0438\u044E",sortAscendingTitle:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u0440\u044F \u043F\u043E \u0432\u043E\u0437\u0440\u0430\u0441\u0442\u0430\u043D\u0438\u044E",sortDescending:"\u041F\u043E \u0443\u0431\u044B\u0432\u0430\u043D\u0438\u044E",sortDescendingTitle:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u043E\u0433\u043E \u043F\u043E\u0440\u044F \u043F\u043E \u0443\u0431\u044B\u0432\u0430\u043D\u0438\u044E",string:"\u0421\u0442\u0440\u043E\u043A\u0430",transform:"\u041C\u043E\u0434\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u044F",transformTitle:"\u0424\u0438\u043B\u044C\u0442\u0440\u0430\u0446\u0438\u044F, \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u0438\u043B\u0438 \u043C\u043E\u0434\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445 \u0442\u0438\u043F\u0430 ${type}",transformTitleShort:"\u0424\u0438\u043B\u044C\u0442\u0440\u0430\u0446\u0438\u044F, \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430 \u0438\u043B\u0438 \u043C\u043E\u0434\u0438\u0444\u0438\u043A\u0430\u0446\u0438\u044F \u0434\u0430\u043D\u043D\u044B\u0445",extract:"\u0418\u0437\u0432\u043B\u0435\u0447\u0435\u043D\u0438\u0435",extractTitle:"\u0418\u0437\u0432\u043B\u0435\u0447\u044C \u0442\u0438\u043F ${type}",transformQueryTitle:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 JMESpath \u0437\u0430\u043F\u0440\u043E\u0441",transformWizardLabel:"\u041C\u0430\u0441\u0442\u0435\u0440",transformWizardFilter:"\u0424\u0438\u043B\u044C\u0442\u0440",transformWizardSortBy:"\u0421\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u0430",transformWizardSelectFields:"\u041F\u043E\u043B\u044F",transformQueryLabel:"\u0417\u0430\u043F\u0440\u043E\u0441",transformPreviewLabel:"\u041F\u0440\u043E\u0441\u043C\u043E\u0442\u0440",type:"\u0422\u0438\u043F",typeTitle:"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0442\u0438\u043F \u044D\u0442\u043E\u0433\u043E \u043F\u043E\u043B\u044F",openUrl:"Ctrl+Click \u0438\u043B\u0438 Ctrl+Enter \u0434\u043B\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u044F url \u0432 \u043D\u043E\u0432\u043E\u043C \u043E\u043A\u043D\u0435",undo:"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C (Ctrl+Z)",validationCannotMove:"\u041F\u043E\u043B\u0435 \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u043F\u0435\u0440\u0435\u043C\u0435\u0449\u0435\u043D\u043E \u0432 \u043F\u043E\u0442\u043E\u043C\u043A\u0430",autoType:"\u0422\u0438\u043F \u043F\u043E\u043B\u044F \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u044F\u0435\u0442\u0441\u044F \u043F\u043E \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044E \u0438 \u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C \u0441\u0442\u0440\u043E\u043A\u043E\u0439, \u0447\u0438\u0441\u043B\u043E\u043C, \u043B\u043E\u0433\u0438\u0447\u0435\u0441\u043A\u0438\u043C \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435\u043C \u0438\u043B\u0438 null.",objectType:"\u041E\u0431\u044A\u0435\u043A\u0442 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u043D\u0435\u0443\u043F\u043E\u0440\u044F\u0434\u043E\u0447\u0435\u043D\u043D\u044B\u0439 \u043D\u0430\u0431\u043E\u0440 \u043F\u0430\u0440 \u043A\u043B\u044E\u0447/\u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435.",arrayType:"\u041C\u0430\u0441\u0441\u0438\u0432 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u0443\u043F\u043E\u0440\u044F\u0434\u043E\u0447\u0435\u043D\u043D\u044B\u0439 \u043D\u0430\u0431\u043E\u0440 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0439.",stringType:"\u0422\u0438\u043F \u043F\u043E\u043B\u044F \u043D\u0435 \u043E\u043F\u0440\u0435\u0434\u0435\u043B\u044F\u0435\u0442\u0441\u044F \u0438\u0437 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F, \u043D\u043E \u0432\u0441\u0435\u0433\u0434\u0430 \u0432\u043E\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044F \u043A\u0430\u043A \u0441\u0442\u0440\u043E\u043A\u0430.",modeEditorTitle:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u0440\u0435\u0436\u0438\u043C\u0430 \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0430",modeCodeText:"\u041A\u043E\u0434",modeCodeTitle:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0432 \u0440\u0435\u0436\u0438\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0430 \u043A\u043E\u0434\u0430",modeFormText:"\u0424\u043E\u0440\u043C\u0430",modeFormTitle:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0432 \u0440\u0435\u0436\u0438\u043C \u0444\u043E\u0440\u043C\u044B",modeTextText:"\u0422\u0435\u043A\u0441\u0442",modeTextTitle:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0432 \u0440\u0435\u0436\u0438\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0430 \u0442\u0435\u043A\u0441\u0442\u0430",modeTreeText:"\u0414\u0435\u0440\u0435\u0432\u043E",modeTreeTitle:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0432 \u0440\u0435\u0436\u0438\u043C \u0440\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0430 \u0434\u0435\u0440\u0435\u0432\u0430",modeViewText:"\u041F\u0440\u043E\u0441\u043C\u043E\u0442\u0440 \u0434\u0435\u0440\u0435\u0432\u0430",modeViewTitle:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0432 \u0440\u0435\u0436\u0438\u043C \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0430 \u0434\u0435\u0440\u0435\u0432\u0430",modePreviewText:"\u041F\u0440\u043E\u0441\u043C\u043E\u0442\u0440",modePreviewTitle:"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0432 \u0440\u0435\u0436\u0438\u043C \u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440\u0430",examples:"\u041F\u0440\u0438\u043C\u0435\u0440\u044B",default:"\u041F\u043E \u0443\u043C\u043E\u043B\u0447\u0430\u043D\u0438\u044E",containsInvalidProperties:"\u0421\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u043D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0435 \u0441\u0432\u043E\u0439\u0441\u0442\u0432\u0430",containsInvalidItems:"\u0421\u043E\u0434\u0435\u0440\u0436\u0438\u0442 \u043D\u0435\u0434\u043E\u043F\u0443\u0441\u0442\u0438\u043C\u044B\u0435 \u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B"},ko:{array:"\uBC30\uC5F4",auto:"\uC790\uB3D9",appendText:"\uCD94\uAC00",appendTitle:'\uC120\uD0DD\uD55C \uC694\uC18C \uC544\uB798\uC5D0 "\uC790\uB3D9" \uC694\uC18C\uB97C \uCD94\uAC00\uD569\uB2C8\uB2E4. (Ctrl + Shift + Ins)',appendSubmenuTitle:"\uCD94\uAC00\uD560 \uC694\uC18C\uC758 \uC720\uD615\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.",appendTitleAuto:'"\uC790\uB3D9" \uC694\uC18C\uB97C \uCD94\uAC00\uD569\uB2C8\uB2E4. (Ctrl + Shift + Ins)',ascending:"\uC624\uB984\uCC28\uC21C",ascendingTitle:"\uC120\uD0DD\uD55C ${type}\uC758 \uD558\uC704 \uC694\uC18C\uB97C \uC624\uB984\uCC28\uC21C \uC815\uB82C\uD569\uB2C8\uB2E4.",actionsMenu:"\uBA54\uB274 \uC5F4\uAE30 (Ctrl + M)",cannotParseFieldError:"JSON\uC758 \uC694\uC18C\uB97C \uD574\uC11D\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",cannotParseValueError:"JSON\uC758 \uAC12\uC744 \uD574\uC11D\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",collapseAll:"\uBAA8\uB450 \uC811\uAE30",compactTitle:"\uBAA8\uB4E0 \uACF5\uBC31\uC744 \uC81C\uAC70\uD558\uC5EC JSON \uB370\uC774\uD130\uB97C \uC791\uAC8C \uB9CC\uB4ED\uB2C8\uB2E4. (Ctrl + Shift + I)",descending:"\uB0B4\uB9BC\uCC28\uC21C",descendingTitle:"\uC120\uD0DD\uD55C ${type}\uC758 \uD558\uC704 \uC694\uC18C\uB97C \uB0B4\uB9BC\uCC28\uC21C\uC73C\uB85C \uC815\uB82C",drag:"\uB4DC\uB798\uADF8\uD558\uC5EC \uC694\uC18C\uB97C \uC774\uB3D9\uD569\uB2C8\uB2E4. (Alt + Shift + Arrows)",duplicateKey:"\uBCF5\uC81C\uD0A4",duplicateText:"\uBCF5\uC81C",duplicateTitle:"\uC120\uD0DD\uD55C \uC694\uC18C\uB97C \uBCF5\uC81C\uD569\uB2C8\uB2E4. (Ctrl + D)",duplicateField:"\uC120\uD0DD\uD55C \uC694\uC18C\uB97C \uBCF5\uC81C\uD569\uB2C8\uB2E4. (Ctrl + D)",duplicateFieldError:"\uC694\uC18C \uC774\uB984\uC774 \uC911\uBCF5\uB418\uC5C8\uC2B5\uB2C8\uB2E4.",empty:"\uBE44\uC5B4\uC788\uC74C",expandAll:"\uBAA8\uB450 \uC5F4\uAE30",expandTitle:`\uD074\uB9AD\uD558\uC5EC \uC694\uC18C\uB97C \uC5F4\uAC70\uB098 \uB2EB\uC2B5\uB2C8\uB2E4. (Ctrl + E) 
Ctrl + Click\uC73C\uB85C \uBAA8\uB4E0 \uD558\uC704 \uC694\uC18C\uB97C \uC5F4\uAC70\uB098 \uB2EB\uC2B5\uB2C8\uB2E4.`,formatTitle:"\uC801\uC808\uD55C \uB4E4\uC5EC\uC4F0\uAE30 \uBC0F \uC904\uBC14\uAFC8\uC73C\uB85C JSON \uB370\uC774\uD130\uB97C \uC815\uD615\uD654\uD569\uB2C8\uB2E4. (Ctrl + I)",insert:"\uC0BD\uC785",insertTitle:"\uC120\uD0DD\uD55C \uC694\uC18C \uC704\uC5D0 \uC0C8\uC694\uC18C\uB97C \uC0BD\uC785\uD569\uB2C8\uB2E4. (Ctrl + Ins)",insertSub:"\uC0BD\uC785\uD560 \uC694\uC18C\uC758 \uC720\uD615\uC744 \uC120\uD0DD\uD574\uC8FC\uC138\uC694.",object:"\uAC1D\uCCB4",ok:"\uD655\uC778",redo:"\uB2E4\uC2DC \uC2E4\uD589 (Ctrl + Shift + Z)",removeText:"\uC0AD\uC81C",removeTitle:"\uC120\uD0DD\uD55C \uC694\uC18C\uB97C \uC0AD\uC81C\uD569\uB2C8\uB2E4. (Ctrl + Del)",removeField:"\uC120\uD0DD\uD55C \uC694\uC18C\uB97C \uC0AD\uC81C\uD569\uB2C8\uB2E4. (Ctrl + Del)",repairTitle:"JSON \uAD50\uC815: JSON \uB0B4\uC758 \uC8FC\uC11D\uACFC JSONP \uD45C\uAE30\uBC95\uC744 \uC9C0\uC6B0\uACE0 \uB530\uC634\uD45C\uC640 \uC774\uC2A4\uCF00\uC774\uD504 \uBB38\uC790\uB97C \uC218\uC815\uD569\uB2C8\uB2E4.",searchTitle:"\uC694\uC18C \uB610\uB294 \uAC12 \uCC3E\uAE30",searchNextResultTitle:"\uB2E4\uC74C\uC73C\uB85C \uCC3E\uAE30 (Enter)",searchPreviousResultTitle:"\uC774\uC804\uC73C\uB85C \uCC3E\uAE30 (Shift + Enter)",selectNode:"\uC694\uC18C\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694...",showAll:"\uBAA8\uB450\uBCF4\uAE30",showMore:"\uB354\uBCF4\uAE30",showMoreStatus:"${totalChilds} \uAC1C\uC758 \uD56D\uBAA9 \uC911 ${visibleChilds} \uAC1C\uB97C \uD45C\uC2DC\uD569\uB2C8\uB2E4.",sort:"\uC815\uB82C",sortTitle:"\uC120\uD0DD\uD55C ${type}\uC758 \uD558\uC704 \uC694\uC18C\uB97C \uC815\uB82C\uD569\uB2C8\uB2E4.",sortTitleShort:"\uC815\uB82C",sortFieldLabel:"\uC694\uC18C:",sortDirectionLabel:"\uC21C\uC11C:",sortFieldTitle:"\uBC30\uC5F4\uC774\uB098 \uAC1D\uCCB4\uB97C \uC815\uB82C\uD558\uB294 \uC694\uC18C\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694.",sortAscending:"\uC624\uB984\uCC28\uC21C",sortAscendingTitle:"\uC120\uD0DD\uD55C \uC694\uC18C\uB97C \uC624\uB984\uCC28\uC21C\uC73C\uB85C \uC815\uB82C\uD569\uB2C8\uB2E4.",sortDescending:"\uB0B4\uB9BC\uCC28\uC21C",sortDescendingTitle:"\uC120\uD0DD\uD55C \uC694\uC18C\uB97C \uB0B4\uB9BC\uCC28\uC21C\uC73C\uB85C \uC815\uB82C\uD569\uB2C8\uB2E4.",string:"\uBB38\uC790",transform:"\uBCC0\uD658",transformTitle:"\uC120\uD0DD\uD55C ${type}\uC758 \uD558\uC704 \uC694\uC18C\uB97C \uD544\uD130\uD558\uAC70\uB098 \uC815\uB82C \uB610\uB294 \uBCC0\uD658\uD569\uB2C8\uB2E4.",transformTitleShort:"\uB0B4\uC6A9\uC744 \uD544\uD130\uD558\uAC70\uB098 \uC815\uB82C \uB610\uB294 \uBCC0\uD658\uD569\uB2C8\uB2E4.",extract:"\uCD94\uCD9C",extractTitle:"\uC120\uD0DD\uD55C ${type}\uC758 \uAC12\uC744 \uCD5C\uC0C1\uC704\uC5D0 \uC704\uCE58\uC2DC\uD0B5\uB2C8\uB2E4.",transformQueryTitle:"JMESPath \uCFFC\uB9AC\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.",transformWizardLabel:"\uB9C8\uBC95\uC0AC",transformWizardFilter:"\uD544\uD130",transformWizardSortBy:"\uC815\uB82C",transformWizardSelectFields:"\uC694\uC18C\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694.",transformQueryLabel:"\uCFFC\uB9AC",transformPreviewLabel:"\uBBF8\uB9AC\uBCF4\uAE30",type:"\uC720\uD615",typeTitle:"\uC120\uD0DD\uD55C \uC694\uC18C\uC758 \uC720\uD615\uC744 \uBCC0\uACBD\uD569\uB2C8\uB2E4.",openUrl:"Ctrl + Click \uB610\uB294 Ctrl + Enter\uB85C \uC0C8 \uCC3D\uC5D0\uC11C URL \uC5F4\uAE30",undo:"\uC2E4\uD589 \uCDE8\uC18C (Ctrl + Z)",validationCannotMove:"\uD558\uC704 \uC694\uC18C\uB85C \uC774\uB3D9\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.",autoType:"\uC790\uB3D9: \uC694\uC18C\uC758 \uD615\uC2DD\uC774 \uAC12\uC758 \uC720\uD615\uC73C\uB85C \uACB0\uC815\uB429\uB2C8\uB2E4. \uBB38\uC790, \uC22B\uC790, \uBD80\uC6B8, \uB610\uB294 null\uB9CC \uD5C8\uC6A9\uB429\uB2C8\uB2E4.",objectType:"\uAC1D\uCCB4: \uC21C\uC11C\uB300\uB85C \uB098\uC5F4\uB418\uC9C0 \uC54A\uC740 \uC774\uB984/\uAC12 \uC30D\uC73C\uB85C \uC774\uB8E8\uC5B4\uC9C4 \uC9D1\uD569\uC785\uB2C8\uB2E4.",arrayType:"\uBC30\uC5F4: \uC21C\uC11C\uB300\uB85C \uB098\uC5F4\uB41C \uAC12\uC758 \uC9D1\uD569\uC785\uB2C8\uB2E4.",stringType:"\uBB38\uC790: \uC694\uC18C\uC758 \uC720\uD615\uC774 \uAC12\uC5D0\uC11C \uACB0\uC815\uB418\uC9C0 \uC54A\uC9C0\uB9CC \uD56D\uC0C1 \uBB38\uC790\uB85C \uBC18\uD658\uB429\uB2C8\uB2E4.",modeEditorTitle:"\uD3B8\uC9D1\uAE30 \uC720\uD615 \uBCC0\uACBD",modeCodeText:"\uCF54\uB4DC",modeCodeTitle:"\uD615\uC2DD \uAD50\uC815\uC744 \uB3C4\uC640\uC8FC\uB294 \uAE30\uB2A5\uC774 \uD3EC\uD568\uB41C \uBB38\uC790 \uD3B8\uC9D1\uAE30",modeFormText:"\uC785\uB825 \uC591\uC2DD",modeFormTitle:"\uC815\uD574\uC9C4 \uC694\uC18C\uC5D0 \uAC12\uC744 \uC785\uB825\uD558\uB294 \uD3B8\uC9D1\uAE30",modeTextText:"\uBB38\uC790",modeTextTitle:"\uB2E8\uC21C \uBB38\uC790 \uD3B8\uC9D1\uAE30",modeTreeText:"\uD2B8\uB9AC",modeTreeTitle:"\uD2B8\uB9AC \uAD6C\uC870\uB85C \uD45C\uC2DC\uB418\uB294 \uD3B8\uC9D1\uAE30",modeViewText:"\uBCF4\uAE30",modeViewTitle:"\uC77D\uAE30\uC804\uC6A9 \uD2B8\uB9AC \uAD6C\uC870\uB85C JSON\uC744 \uD45C\uC2DC",modePreviewText:"\uBBF8\uB9AC\uBCF4\uAE30",modePreviewTitle:"\uC77D\uAE30\uC804\uC6A9 \uBB38\uC790\uB85C JSON\uC744 \uD45C\uC2DC",examples:"\uC608\uC81C",default:"\uAE30\uBCF8\uAC12",containsInvalidProperties:"\uC798\uBABB\uB41C \uC18D\uC131\uC774 \uD3EC\uD568\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4.",containsInvalidItems:"\uC798\uBABB\uB41C \uD56D\uBAA9\uC774 \uD3EC\uD568\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4"}},a=Object.keys(s),l="en",c=typeof navigator<"u"?navigator.language||navigator.userLanguage:void 0,u=a.find(function(h){return h===c})||l;function d(h){var f;h&&((f=a.find(function(C){return C===h}))&&(u=f))}function m(h){if(h)for(var f in h)(function(C){a.find(function(g){return g===C})||a.push(C),s[C]=Object.assign({},s[l],s[C],h[C])})(f)}function p(h,f,C){var g=s[C=C||u][h]||s[l][h]||h;if(f)for(var b in f)g=g.replace("${"+b+"}",f[b]);return g}},359:function(n,s,i){"use strict";i.d(s,{V:function(){return c},e:function(){return u}});var s=i(9151),a=i.n(s),l=i(6237);function c(d,C){var p,h=C.sort,f=C.filter,C=C.projection,g="";return f?(p=f.field!=="@"?["0"].concat((0,l.parsePath)("."+f.field)):["0"],p=typeof(0,l.get)(d,p)=="string"?f.value:(0,l.parseString)(f.value),g+="[? "+f.field+" "+f.relation+" `"+JSON.stringify(p)+"`]"):g+=Array.isArray(d)?"[*]":"@",h&&(h.direction==="desc"?g+=" | reverse(sort_by(@, &"+h.field+"))":g+=" | sort_by(@, &"+h.field+")"),C&&(g[g.length-1]!=="]"&&(g+=" | [*]"),C.fields.length===1?g+="."+C.fields[0]:1<C.fields.length&&(g+=".{"+C.fields.map(function(b){var y=b.split(".");return y[y.length-1]+": "+b}).join(", ")+"}")),g}function u(d,m){return a().search(d,m)}},1081:function(){function n(o){o===void 0||"remove"in o||Object.defineProperty(o,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode!==void 0&&this.parentNode.removeChild(this)}})}typeof Element<"u"&&(window.Element!==void 0&&n(window.Element.prototype),window.CharacterData!==void 0&&n(window.CharacterData.prototype),window.DocumentType!==void 0)&&n(window.DocumentType.prototype),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(o){for(var i=0;i<this.length;i++){var s=this[i];if(o.call(this,s,i,this))return i}return-1},configurable:!0,writable:!0}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(o){return o=this.findIndex(o),this[o]},configurable:!0,writable:!0}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")})},7483:function(n,x,y){"use strict";y.r(x),y.d(x,{previewModeMixins:function(){return A}});var s=y(9857),a=y(660),l=y(2115),c=y(2877);function u(v){return(u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _})(v)}function d(v,_){for(var I=0;I<_.length;I++){var T=_[I];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(v,function(E){return E=function(w,S){if(u(w)!="object"||!w)return w;var P=w[Symbol.toPrimitive];if(P===void 0)return(S==="string"?String:Number)(w);if(P=P.call(w,S||"default"),u(P)!="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}(E,"string"),u(E)=="symbol"?E:E+""}(T.key),T)}}var m=function(){function v(E,w,S){if(!(this instanceof v))throw new TypeError("Cannot call a class as a function");this.onChange=E,this.calculateItemSize=w||function(){return 1},this.limit=S,this.items=[],this.index=-1}return _=v,(I=[{key:"add",value:function(E){for(;this._calculateHistorySize()>this.limit&&1<this.items.length;)this.items.shift(),this.index--;this.items=this.items.slice(0,this.index+1),this.items.push(E),this.index++,this.onChange()}},{key:"_calculateHistorySize",value:function(){var E=this.calculateItemSize,w=0;return this.items.forEach(function(S){w+=E(S)}),w}},{key:"undo",value:function(){if(this.canUndo())return this.index--,this.onChange(),this.items[this.index]}},{key:"redo",value:function(){if(this.canRedo())return this.index++,this.onChange(),this.items[this.index]}},{key:"canUndo",value:function(){return 0<this.index}},{key:"canRedo",value:function(){return this.index<this.items.length-1}},{key:"clear",value:function(){this.items=[],this.index=-1,this.onChange()}}])&&d(_.prototype,I),T&&d(_,T),Object.defineProperty(_,"prototype",{writable:!1}),_;var _,I,T}(),p=y(3057),h=y(359),f=y(1389),C=y(2915),g=y(5609),x=y(1948),b=y(6237),y=x.textModeMixins[0].mixin,x={create:function(T){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},I=(_.statusBar===void 0&&(_.statusBar=!0),_.mainMenuBar=_.mainMenuBar!==!1,_.enableSort=_.enableSort!==!1,_.enableTransform=_.enableTransform!==!1,_.createQuery=_.createQuery||h.V,_.executeQuery=_.executeQuery||h.e,typeof(this.options=_).indentation=="number"?this.indentation=Number(_.indentation):this.indentation=2,(0,p.AI)(this.options.languages),(0,p.xC)(this.options.language),this.mode="preview",this),T=(this.container=T,this.dom={},this.json=void 0,this.text="",this._debouncedValidate=(0,b.debounce)(this.validate.bind(this),this.DEBOUNCE_INTERVAL),this.width=T.clientWidth,this.height=T.clientHeight,this.frame=document.createElement("div"),this.frame.className="jsoneditor jsoneditor-mode-preview",this.frame.onclick=function(E){E.preventDefault()},{target:this.frame,onFocus:this.options.onFocus||null,onBlur:this.options.onBlur||null}),T=(this.frameFocusTracker=new c.$(T),this.content=document.createElement("div"),this.content.className="jsoneditor-outer",this.dom.busy=document.createElement("div"),this.dom.busy.className="jsoneditor-busy",this.dom.busyContent=document.createElement("span"),this.dom.busyContent.textContent="busy...",this.dom.busy.appendChild(this.dom.busyContent),this.content.appendChild(this.dom.busy),this.dom.previewContent=document.createElement("pre"),this.dom.previewContent.className="jsoneditor-preview",this.dom.previewText=document.createTextNode(""),this.dom.previewContent.appendChild(this.dom.previewText),this.content.appendChild(this.dom.previewContent),this.options.mainMenuBar&&((0,b.addClassName)(this.content,"has-main-menu-bar"),this.menu=document.createElement("div"),this.menu.className="jsoneditor-menu",this.frame.appendChild(this.menu),(T=document.createElement("button")).type="button",T.className="jsoneditor-format",T.title=(0,p.Tl)("formatTitle"),this.menu.appendChild(T),T.onclick=function(){I.executeWithBusyMessage(function(){try{I.format()}catch(E){I._onError(E)}},"formatting...")},(T=document.createElement("button")).type="button",T.className="jsoneditor-compact",T.title=(0,p.Tl)("compactTitle"),this.menu.appendChild(T),T.onclick=function(){I.executeWithBusyMessage(function(){try{I.compact()}catch(E){I._onError(E)}},"compacting...")},this.options.enableSort&&((T=document.createElement("button")).type="button",T.className="jsoneditor-sort",T.title=(0,p.Tl)("sortTitleShort"),T.onclick=function(){I._showSortModal()},this.menu.appendChild(T)),this.options.enableTransform&&((T=document.createElement("button")).type="button",T.title=(0,p.Tl)("transformTitleShort"),T.className="jsoneditor-transform",T.onclick=function(){I._showTransformModal()},this.dom.transform=T,this.menu.appendChild(T)),(T=document.createElement("button")).type="button",T.className="jsoneditor-repair",T.title=(0,p.Tl)("repairTitle"),this.menu.appendChild(T),!(T.onclick=function(){I.json===void 0&&I.executeWithBusyMessage(function(){try{I.repair()}catch(E){I._onError(E)}},"repairing...")})!==this.options.history&&(this.history=new m(function(){I.dom.undo.disabled=!I.history.canUndo(),I.dom.redo.disabled=!I.history.canRedo()},function(E){return 2*E.text.length},a.SC),(T=document.createElement("button")).type="button",T.className="jsoneditor-undo jsoneditor-separator",T.title=(0,p.Tl)("undo"),T.onclick=function(){var E=I.history.undo();E&&I._applyHistory(E)},this.menu.appendChild(T),this.dom.undo=T,(T=document.createElement("button")).type="button",T.className="jsoneditor-redo",T.title=(0,p.Tl)("redo"),T.onclick=function(){var E=I.history.redo();E&&I._applyHistory(E)},this.menu.appendChild(T),this.dom.redo=T,this.history.onChange()),this.options)&&this.options.modes&&this.options.modes.length&&(this.modeSwitcher=new f.n(this.menu,this.options.modes,this.options.mode,function(E){try{I.setMode(E),I.modeSwitcher.focus()}catch(w){I._onError(w)}})),Array.isArray(this.options.showErrorTable)?this.options.showErrorTable.includes(this.mode):this.options.showErrorTable===!0);this.errorTable=new l.N({errorTableVisible:T,onToggleVisibility:function(){I.validate()},onFocusLine:null,onChangeHeight:function(E){E=E+(I.dom.statusBar?I.dom.statusBar.clientHeight:0)+1,I.content.style.marginBottom=-E+"px",I.content.style.paddingBottom=E+"px"}}),this.frame.appendChild(this.content),this.frame.appendChild(this.errorTable.getErrorTable()),this.container.appendChild(this.frame),_.statusBar&&((0,b.addClassName)(this.content,"has-status-bar"),T=document.createElement("div"),(this.dom.statusBar=T).className="jsoneditor-statusbar",this.frame.appendChild(T),this.dom.fileSizeInfo=document.createElement("span"),this.dom.fileSizeInfo.className="jsoneditor-size-info",this.dom.fileSizeInfo.innerText="",T.appendChild(this.dom.fileSizeInfo),this.dom.arrayInfo=document.createElement("span"),this.dom.arrayInfo.className="jsoneditor-size-info",this.dom.arrayInfo.innerText="",T.appendChild(this.dom.arrayInfo),T.appendChild(this.errorTable.getErrorCounter()),T.appendChild(this.errorTable.getWarningIcon()),T.appendChild(this.errorTable.getErrorIcon())),this._renderPreview(),this.setSchema(this.options.schema,this.options.schemaRefs)},_renderPreview:function(){var v=this.getText();this.dom.previewText.nodeValue=(0,b.limitCharacters)(v,a.hJ),this.dom.fileSizeInfo&&(this.dom.fileSizeInfo.innerText="Size: "+(0,b.formatSize)(v.length)),this.dom.arrayInfo&&(Array.isArray(this.json)?this.dom.arrayInfo.innerText="Array: "+this.json.length+" items":this.dom.arrayInfo.innerText="")},_onChange:function(){if(this._debouncedValidate(),this.options.onChange)try{this.options.onChange()}catch{}if(this.options.onChangeJSON)try{this.options.onChangeJSON(this.get())}catch{}if(this.options.onChangeText)try{this.options.onChangeText(this.getText())}catch{}}},A=(x._showSortModal=function(){var v=this;this.executeWithBusyMessage(function(){var _=v.options.modalAnchor||a.ai,I=v.get();v._renderPreview(),(0,C.showSortModal)(_,I,function(T){v.executeWithBusyMessage(function(){var E,w,S;E=I,w=T,Array.isArray(E)&&(S=(0,b.sort)(E,w.path,w.direction),v.sortedBy=w,v._setAndFireOnChange(S)),(0,b.isObject)(E)&&(S=(0,b.sortObjectKeys)(E,w.direction),v.sortedBy=w,v._setAndFireOnChange(S))},"sorting...")},v.sortedBy)},"parsing...")},x._showTransformModal=function(){var v=this;this.executeWithBusyMessage(function(){var E=v.options,_=E.createQuery,I=E.executeQuery,T=E.modalAnchor,E=E.queryDescription,w=v.get();v._renderPreview(),(0,g.showTransformModal)({container:T||a.ai,json:w,queryDescription:E,createQuery:_,executeQuery:I,onTransform:function(S){v.executeWithBusyMessage(function(){var P=I(w,S);v._setAndFireOnChange(P)},"transforming...")}})},"parsing...")},x.destroy=function(){this.frame&&this.container&&this.frame.parentNode===this.container&&this.container.removeChild(this.frame),this.modeSwitcher&&(this.modeSwitcher.destroy(),this.modeSwitcher=null),this._debouncedValidate=null,this.history&&(this.history.clear(),this.history=null),this.frameFocusTracker.destroy()},x.compact=function(){var v=this.get(),_=JSON.stringify(v);this._setTextAndFireOnChange(_,v)},x.format=function(){var v=this.get(),_=JSON.stringify(v,null,this.indentation);this._setTextAndFireOnChange(_,v)},x.repair=function(){var v=this.getText();try{var _=(0,s.m)(v);this._setTextAndFireOnChange(_)}catch{}},x.focus=function(){this.dom.transform.focus()},x.set=function(v){this.history&&this.history.clear(),this._set(v)},x.update=function(v){this._set(v)},x._set=function(v){this.text=void 0,this.json=v,this._renderPreview(),this._pushHistory(),this._debouncedValidate()},x._setAndFireOnChange=function(v){this._set(v),this._onChange()},x.get=function(){var v;return this.json===void 0&&(v=this.getText(),this.json=(0,b.parse)(v)),this.json},x.getText=function(){return this.text===void 0&&(this.text=JSON.stringify(this.json,null,this.indentation),this.options.escapeUnicode===!0)&&(this.text=(0,b.escapeUnicodeChars)(this.text)),this.text},x.setText=function(v){this.history&&this.history.clear(),this._setText(v)},x.updateText=function(v){this.getText()!==v&&this._setText(v)},x._setText=function(v,_){var I;this.options.escapeUnicode===!0?this.text=(0,b.escapeUnicodeChars)(v):this.text=v,this.json=_,this._renderPreview(),this.json===void 0?(I=this).executeWithBusyMessage(function(){try{I.json=I.get(),I._renderPreview(),I._pushHistory()}catch{}},"parsing..."):this._pushHistory(),this._debouncedValidate()},x._setTextAndFireOnChange=function(v,_){this._setText(v,_),this._onChange()},x._applyHistory=function(v){this.json=v.json,this.text=v.text,this._renderPreview(),this._debouncedValidate()},x._pushHistory=function(){var v;this.history&&(v={text:this.text,json:this.json},this.history.add(v))},x.executeWithBusyMessage=function(v,_){var I;this.getText().length>a.Oq?((0,b.addClassName)((I=this).frame,"busy"),I.dom.busyContent.innerText=_,setTimeout(function(){v(),(0,b.removeClassName)(I.frame,"busy"),I.dom.busyContent.innerText=""},100)):v()},x.validate=y.validate,x._renderErrors=y._renderErrors,[{mode:"preview",mixin:x,data:"json"}])},2915:function(n,s,i){"use strict";i.r(s),i.d(s,{showSortModal:function(){return u}});var s=i(8340),a=i.n(s),l=i(3057),c=i(6237);function u(d,b,p,h){var f=Array.isArray(b)?(0,c.getChildPaths)(b):[""],C=h&&h.path&&(0,c.contains)(f,h.path)?h.path:f[0],g=h&&h.direction||"asc",b='<div class="pico-modal-contents"><div class="pico-modal-header">'+(0,l.Tl)("sort")+"</div><form><table><tbody><tr>  <td>"+(0,l.Tl)("sortFieldLabel")+' </td>  <td class="jsoneditor-modal-input">  <div class="jsoneditor-select-wrapper">    <select id="field" title="'+(0,l.Tl)("sortFieldTitle")+'">    </select>  </div>  </td></tr><tr>  <td>'+(0,l.Tl)("sortDirectionLabel")+' </td>  <td class="jsoneditor-modal-input">  <div id="direction" class="jsoneditor-button-group"><input type="button" value="'+(0,l.Tl)("sortAscending")+'" title="'+(0,l.Tl)("sortAscendingTitle")+'" data-value="asc" class="jsoneditor-button-first jsoneditor-button-asc"/><input type="button" value="'+(0,l.Tl)("sortDescending")+'" title="'+(0,l.Tl)("sortDescendingTitle")+'" data-value="desc" class="jsoneditor-button-last jsoneditor-button-desc"/>  </div>  </td></tr><tr><td colspan="2" class="jsoneditor-modal-input jsoneditor-modal-actions">  <input type="submit" id="ok" value="'+(0,l.Tl)("ok")+'" /></td></tr></tbody></table></form></div>';a()({parent:d,content:b,overlayClass:"jsoneditor-modal-overlay",overlayStyles:{backgroundColor:"rgb(1,1,1)",opacity:.3},modalClass:"jsoneditor-modal jsoneditor-modal-sort"}).afterCreate(function(y){var x=y.modalElem().querySelector("form"),A=y.modalElem().querySelector("#ok"),v=y.modalElem().querySelector("#field"),_=y.modalElem().querySelector("#direction");function I(T){_.value=T,_.className="jsoneditor-button-group jsoneditor-button-group-value-"+_.value}f.forEach(function(T){var E,w=document.createElement("option");w.text=(E=T)===""?"@":E[0]==="."?E.slice(1):E,w.value=T,v.appendChild(w)}),v.value=C||f[0],I(g||"asc"),_.onclick=function(T){I(T.target.getAttribute("data-value"))},A.onclick=function(T){T.preventDefault(),T.stopPropagation(),y.close(),p({path:v.value,direction:_.value})},x&&(x.onsubmit=A.onclick)}).afterClose(function(y){y.destroy()}).show()}},5609:function(n,a,i){"use strict";i.r(a),i.d(a,{showTransformModal:function(){return C}});var a=i(8340),s=i.n(a),a=i(4772),l=i.n(a),c=i(3057);function u(g){return(u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b})(g)}function d(g,b,y,x){if(typeof g=="boolean"||g instanceof Boolean||g===null||typeof g=="number"||g instanceof Number||typeof g=="string"||g instanceof String||g instanceof Date)return JSON.stringify(g);if(Array.isArray(g)){for(var A=g,v=b,_=y,I=x,T=v?_+v:void 0,E=v?`[
`:"[",w=0;w<A.length;w++){var S=A[w];if(v&&(E+=T),E+=S!==void 0&&typeof S!="function"?d(S,v,T,I):"null",w<A.length-1&&(E+=v?`,
`:","),E.length>I)return E+"..."}return E+=v?`
`+_+"]":"]"}if(g&&u(g)==="object"){var P,k=g,L=b,_=y,R=x,N=L?_+L:void 0,F=!0,H=L?`{
`:"{";if(typeof k.toJSON=="function")return d(k.toJSON(),L,_,R);for(P in k)if(function(Q,O){return Object.prototype.hasOwnProperty.call(Q,O)}(k,P)){var V=k[P];if(F?F=!1:H+=L?`,
`:",",(H=(H+=L?N+'"'+P+'": ':'"'+P+'":')+d(V,L,N,R)).length>R)return H+"..."}return H+=L?`
`+_+"}":"}"}}function m(g,b){for(var y="";0<b--;)y+=g;return y}var p=i(6237),h=i(660),f='Enter a <a href="http://jmespath.org" target="_blank">JMESPath</a> query to filter, sort, or transform the JSON data.<br/>To learn JMESPath, go to <a href="http://jmespath.org/tutorial.html" target="_blank">the interactive tutorial</a>.';function C(T){var b=T.container,y=T.json,x=T.queryDescription,x=x===void 0?f:x,A=T.createQuery,v=T.executeQuery,_=T.onTransform,I=y,T='<div class="pico-modal-contents"><div class="pico-modal-header">'+(0,c.Tl)("transform")+"</div><p>"+x+'</p><div class="jsoneditor-jmespath-label">'+(0,c.Tl)("transformWizardLabel")+' </div><div id="wizard" class="jsoneditor-jmespath-block jsoneditor-jmespath-wizard">  <table class="jsoneditor-jmespath-wizard-table">    <tbody>      <tr>        <th>'+(0,c.Tl)("transformWizardFilter")+'</th>        <td class="jsoneditor-jmespath-filter">          <div class="jsoneditor-inline jsoneditor-jmespath-filter-field" >            <select id="filterField">            </select>          </div>          <div class="jsoneditor-inline jsoneditor-jmespath-filter-relation" >            <select id="filterRelation">              <option value="==">==</option>              <option value="!=">!=</option>              <option value="<">&lt;</option>              <option value="<=">&lt;=</option>              <option value=">">&gt;</option>              <option value=">=">&gt;=</option>            </select>          </div>          <div class="jsoneditor-inline jsoneditor-jmespath-filter-value" >            <input type="text" class="value" placeholder="value..." id="filterValue" />          </div>        </td>      </tr>      <tr>        <th>'+(0,c.Tl)("transformWizardSortBy")+'</th>        <td class="jsoneditor-jmespath-filter">          <div class="jsoneditor-inline jsoneditor-jmespath-sort-field">            <select id="sortField">            </select>          </div>          <div class="jsoneditor-inline jsoneditor-jmespath-sort-order" >            <select id="sortOrder">              <option value="asc">Ascending</option>              <option value="desc">Descending</option>            </select>          </div>        </td>      </tr>      <tr id="selectFieldsPart">        <th>'+(0,c.Tl)("transformWizardSelectFields")+'</th>        <td class="jsoneditor-jmespath-filter">          <select class="jsoneditor-jmespath-select-fields" id="selectFields" multiple></select>        </td>      </tr>    </tbody>  </table></div><div class="jsoneditor-jmespath-label">'+(0,c.Tl)("transformQueryLabel")+' </div><div class="jsoneditor-jmespath-block">  <textarea id="query"             rows="4"             autocomplete="off"             autocorrect="off"             autocapitalize="off"             spellcheck="false"            title="'+(0,c.Tl)("transformQueryTitle")+'">[*]</textarea></div><div class="jsoneditor-jmespath-label">'+(0,c.Tl)("transformPreviewLabel")+' </div><div class="jsoneditor-jmespath-block">  <textarea id="preview"       class="jsoneditor-transform-preview"      readonly> </textarea></div><div class="jsoneditor-jmespath-block jsoneditor-modal-actions">  <input type="submit" id="ok" value="'+(0,c.Tl)("ok")+'" autofocus /></div></div>';s()({parent:b,content:T,overlayClass:"jsoneditor-modal-overlay",overlayStyles:{backgroundColor:"rgb(1,1,1)",opacity:.3},modalClass:"jsoneditor-modal jsoneditor-modal-transform",focus:!1}).afterCreate(function(E){var w=E.modalElem(),q=w.querySelector("#wizard"),S=w.querySelector("#ok"),P=w.querySelector("#filterField"),k=w.querySelector("#filterRelation"),L=w.querySelector("#filterValue"),R=w.querySelector("#sortField"),N=w.querySelector("#sortOrder"),F=w.querySelector("#selectFields"),H=w.querySelector("#query"),V=w.querySelector("#preview");Array.isArray(I)||(q.style.fontStyle="italic",q.textContent="(wizard not available for objects, only for arrays)"),(0,p.getChildPaths)(y).forEach(function(ie){var ie=U(ie),ne=document.createElement("option"),ne=(ne.text=ie,ne.value=ie,P.appendChild(ne),document.createElement("option"));ne.text=ie,ne.value=ie,R.appendChild(ne)});var q=(0,p.getChildPaths)(y,!0).filter(function(J){return J!==""}),q=(0<q.length?q.forEach(function(ie){var ie=U(ie),ne=document.createElement("option");ne.text=ie,ne.value=ie,F.appendChild(ne)}):(q=w.querySelector("#selectFieldsPart"))&&(q.style.display="none"),new(l())(P,{defaultSelected:!1,clearable:!0,allowDeselect:!0,placeholder:"field..."})),Q=new(l())(k,{defaultSelected:!1,clearable:!0,allowDeselect:!0,placeholder:"compare..."}),O=new(l())(R,{defaultSelected:!1,clearable:!0,allowDeselect:!0,placeholder:"field..."}),B=new(l())(N,{defaultSelected:!1,clearable:!0,allowDeselect:!0,placeholder:"order..."}),j=new(l())(F,{multiple:!0,clearable:!0,defaultSelected:!1,placeholder:"select fields..."});function U(J){return J===""?"@":J[0]==="."?J.slice(1):J}q.on("selectr.change",Z),Q.on("selectr.change",Z),L.oninput=Z,O.on("selectr.change",Z),B.on("selectr.change",Z),j.on("selectr.change",Z),w.querySelector(".pico-modal-contents").onclick=function(J){J.target.nodeName!=="A"&&J.preventDefault()};var z=(0,p.debounce)(function(){try{var J=v(I,H.value);V.className="jsoneditor-transform-preview",V.value=(ie=J,ne=2,le=h.hJ,typeof ne=="number"?10<ne?ee=m(" ",10):1<=ne&&(ee=m(" ",ne)):typeof ne=="string"&&ne!==""&&(ee=ne),(ne=d(ie,ee,"",le)).length>le?(ie=ne,(typeof(ee=le)=="number"?ie.slice(0,ee):ie)+"..."):ne),S.disabled=!1}catch(oe){V.className="jsoneditor-transform-preview jsoneditor-error",V.value=oe.toString(),S.disabled=!0}var ie,ne,le,ee},300);function $(J,ie){try{H.value=A(J,ie),S.disabled=!1,z()}catch(ne){J='Error: an error happened when executing "createQuery": '+(ne.message||ne.toString()),H.value="",S.disabled=!0,V.className="jsoneditor-transform-preview jsoneditor-error",V.value=J}}function Z(){var J={};if(P.value&&k.value&&L.value&&(J.filter={field:P.value,relation:k.value,value:L.value}),R.value&&N.value&&(J.sort={field:R.value,direction:N.value}),F.value){for(var ie,ne=[],le=0;le<F.options.length;le++)F.options[le].selected&&(ie=F.options[le].value,ne.push(ie));J.projection={fields:ne}}$(y,J)}H.oninput=z,S.onclick=function(J){J.preventDefault(),J.stopPropagation(),E.close(),_(H.value)},$(y,{}),setTimeout(function(){H.select(),H.focus(),H.selectionStart=3,H.selectionEnd=3})}).afterClose(function(E){E.destroy()}).show()}},1948:function(n,_,i){"use strict";i.r(_),i.d(_,{textModeMixins:function(){return E}});var s=i(9857),_=i(7413),a=i.n(_),l=i(660),c=i(2115),u=i(2877),d=i(3057),m=i(359),p=i(1389),h=i(2915),f=i(5609),C=i(5467),g=i(3094),b=i(6237);function y(w){return(y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(w)}function x(w,S){for(var P=0;P<S.length;P++){var k=S[P];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(w,function(L){return L=function(R,N){if(y(R)!="object"||!R)return R;var F=R[Symbol.toPrimitive];if(F===void 0)return(N==="string"?String:Number)(R);if(F=F.call(R,N||"default"),y(F)!="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}(L,"string"),y(L)=="symbol"?L:L+""}(k.key),k)}}var A=function(){function w(L,R){if(!(this instanceof w))throw new TypeError("Cannot call a class as a function");this.schema=L,this.schemaRefs=R||{},this.suggestions={},this.suggestionsRefs={},this._buildSuggestions()}return S=w,(P=[{key:"_buildSuggestions",value:function(){for(var L in this._handleSchemaEntry("",this.schema,this.suggestions),this.schemaRefs)this.suggestionsRefs[L]={},this._handleSchemaEntry("",this.schemaRefs[L],this.suggestionsRefs[L])}},{key:"_handleRef",value:function(L,R,N){N[L]=N[L]||{},N[L].refs=N[L].refs||[],N[L].refs=(0,b.uniqueMergeArrays)(N[L].refs,[R])}},{key:"_handleSchemaEntry",value:function(L,R,N){if(R)if(R.$ref)this._handleRef(L,R.$ref,N);else{var F=this._checkOfConditon(R);if(F)this._handleOfCondition(L,R[F],N);else switch(R.type){case"object":this._handleObject(L,R,N);break;case"string":case"number":case"integer":this._handlePrimitive(L,R,N);break;case"boolean":this._handleBoolean(L,R,N);break;case"array":this._handleArray(L,R,N)}}}},{key:"_handleObject",value:function(L,R,N){var F,H=this;(0,b.isObject)(R.properties)&&(F=Object.keys(R.properties),N[L]=N[L]||{},N[L].props=N[L].props||[],N[L].props=(0,b.uniqueMergeArrays)(N[L].props,F),F.forEach(function(V){(0,b.asyncExec)(function(){H._handleSchemaEntry("".concat(L,"/").concat(V),R.properties[V],N)})}))}},{key:"_handlePrimitive",value:function(L,R,N){N[L]=N[L]||{},(0,b.isArray)(R.examples)&&(N[L].examples=N[L].examples||[],N[L].examples=(0,b.uniqueMergeArrays)(N[L].examples,R.examples)),(0,b.isArray)(R.enum)&&(N[L].enum=N[L].enum||[],N[L].enum=(0,b.uniqueMergeArrays)(N[L].enum,R.enum))}},{key:"_handleBoolean",value:function(L,R,N){N[L]||(N[L]={bool:[!0,!1]})}},{key:"_handleArray",value:function(L,R,N){var F=this;R.items&&(0,b.asyncExec)(function(){F._handleSchemaEntry("".concat(L,"/\\d+"),R.items,N)})}},{key:"_handleOfCondition",value:function(L,R,N){var F=this;R&&R.length&&R.forEach(function(H){(0,b.asyncExec)(function(){F._handleSchemaEntry(L,H,N)})})}},{key:"_checkOfConditon",value:function(L){if(L)return L.oneOf?"oneOf":L.anyOf?"anyOf":L.allOf?"allOf":void 0}},{key:"getCompletions",value:function(L,R,N,F,H){var V=this;try{var q=g.parse(R.getValue()).pointers||{},Q=function(O){function B(z){var $,Z={props:"property",enum:"enum",bool:"boolean",examples:"examples"};O&&($=O[z])!=null&&$.length&&(j=j.concat(O[z].map(function(J){return{caption:J+"",meta:"schema [".concat(Z[z],"]"),score:U++,value:J+""}})))}var j=[],U=0;B("props"),B("enum"),B("bool"),B("examples"),j.length&&H(null,j)};Object.keys(q).forEach(function(O){(0,b.asyncExec)(function(){function B(z,$,Z){var J,ie=Object.keys($).reduce(function(oe,te){return new RegExp("^".concat(Z).concat(te)).test(z)&&(!oe||oe.length<te.length)?te:oe},null);if(typeof ie=="string"){if((J=$[ie])!=null&&(J=J.refs)!=null&&J.length){var ne,le={};for(ne in $[ie].refs){var ee=$[ie].refs[ne];V.suggestionsRefs[ee]&&((ee=B(z,V.suggestionsRefs[ee],"".concat(Z).concat(ie)))!=null&&ee.enum&&(le.enum=(0,b.uniqueMergeArrays)(le.enum,ee.enum)),ee!=null&&ee.examples&&(le.examples=(0,b.uniqueMergeArrays)(le.examples,ee.examples)),ee!=null&&ee.bool&&(le.bool=(0,b.uniqueMergeArrays)(le.bool,ee.bool)),ee!=null)&&ee.props&&(le.props=(0,b.uniqueMergeArrays)(le.props,ee.props))}return le}if(new RegExp("^".concat(Z).concat(ie,"$")).test(z))return $[ie]}}var j,U;((U=q[O].key)==null?void 0:U.line)===N.row&&N.column>=q[O].key.column&&N.column<=q[O].keyEnd.column&&(j=O.slice(0,O.lastIndexOf("/"))),(j=((U=q[O].value)==null?void 0:U.line)===N.row&&((U=q[O].value)==null?void 0:U.line)===((U=q[O].valueEnd)==null?void 0:U.line)&&N.column>=q[O].value.column&&N.column<=q[O].valueEnd.column?O:j)&&(U=B(j,V.suggestions,""),Q(U))})})}catch{}}}])&&x(S.prototype,P),k&&x(S,k),Object.defineProperty(S,"prototype",{writable:!1}),S;var S,P,k}();function v(w){return(v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(w)}var _={},I="ace/theme/jsoneditor";function T(){try{this.format()}catch{}}_.create=function(F){var S,P,k,L=this,R=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},H=(R.statusBar===void 0&&(R.statusBar=!0),R.mainMenuBar=R.mainMenuBar!==!1,R.enableSort=R.enableSort!==!1,R.enableTransform=R.enableTransform!==!1,R.createQuery=R.createQuery||m.V,R.executeQuery=R.executeQuery||m.e,R.showErrorTable=R.showErrorTable!==void 0?R.showErrorTable:["text","preview"],typeof(this.options=R).indentation=="number"?this.indentation=Number(R.indentation):this.indentation=2,(0,d.AI)(this.options.languages),(0,d.xC)(this.options.language),R.ace||a()),N=(this.mode=R.mode==="code"?"code":"text",this.mode==="code"&&H===void 0&&(this.mode="text"),this.theme=R.theme||I,this.theme===I&&H&&(0,C.J)(),R.onTextSelectionChange&&this.onTextSelectionChange(R.onTextSelectionChange),this),F=(this.container=F,this.dom={},this.aceEditor=void 0,this.textarea=void 0,this.validateSchema=null,this.annotations=[],this.lastSchemaErrors=void 0,this._debouncedValidate=(0,b.debounce)(this._validateAndCatch.bind(this),this.DEBOUNCE_INTERVAL),this.width=F.clientWidth,this.height=F.clientHeight,this.frame=document.createElement("div"),this.frame.className="jsoneditor jsoneditor-mode-"+this.options.mode,this.frame.onclick=function(V){V.preventDefault()},this.frame.onkeydown=function(V){N._onKeyDown(V)},{target:this.frame,onFocus:this.options.onFocus||null,onBlur:this.options.onBlur||null}),F=(this.frameFocusTracker=new u.$(F),this.content=document.createElement("div"),this.content.className="jsoneditor-outer",this.options.mainMenuBar&&((0,b.addClassName)(this.content,"has-main-menu-bar"),this.menu=document.createElement("div"),this.menu.className="jsoneditor-menu",this.frame.appendChild(this.menu),(F=document.createElement("button")).type="button",F.className="jsoneditor-format",F.title=(0,d.Tl)("formatTitle"),this.menu.appendChild(F),F.onclick=function(){try{N.format(),N._onChange()}catch(V){N._onError(V)}},(F=document.createElement("button")).type="button",F.className="jsoneditor-compact",F.title=(0,d.Tl)("compactTitle"),this.menu.appendChild(F),F.onclick=function(){try{N.compact(),N._onChange()}catch(V){N._onError(V)}},this.options.enableSort&&((F=document.createElement("button")).type="button",F.className="jsoneditor-sort",F.title=(0,d.Tl)("sortTitleShort"),F.onclick=function(){N._showSortModal()},this.menu.appendChild(F)),this.options.enableTransform&&((F=document.createElement("button")).type="button",F.title=(0,d.Tl)("transformTitleShort"),F.className="jsoneditor-transform",F.onclick=function(){N._showTransformModal()},this.menu.appendChild(F)),(F=document.createElement("button")).type="button",F.className="jsoneditor-repair",F.title=(0,d.Tl)("repairTitle"),this.menu.appendChild(F),F.onclick=function(){try{N.repair(),N._onChange()}catch(V){N._onError(V)}},this.mode==="code"&&((F=document.createElement("button")).type="button",F.className="jsoneditor-undo jsoneditor-separator",F.title=(0,d.Tl)("undo"),F.onclick=function(){L.aceEditor.getSession().getUndoManager().undo()},this.menu.appendChild(F),this.dom.undo=F,(F=document.createElement("button")).type="button",F.className="jsoneditor-redo",F.title=(0,d.Tl)("redo"),F.onclick=function(){L.aceEditor.getSession().getUndoManager().redo()},this.menu.appendChild(F),this.dom.redo=F),this.options&&this.options.modes&&this.options.modes.length&&(this.modeSwitcher=new p.n(this.menu,this.options.modes,this.options.mode,function(V){try{N.setMode(V),N.modeSwitcher.focus()}catch(q){N._onError(q)}})),this.mode==="code")&&((S=document.createElement("a")).appendChild(document.createTextNode("powered by ace")),S.href="https://ace.c9.io/",S.target="_blank",S.className="jsoneditor-poweredBy",S.onclick=function(){window.open(S.href,S.target,"noreferrer")},this.menu.appendChild(S)),this.options.onEditable&&v(this.options.onEditable==="function")&&!this.options.onEditable({})),H=(this.frame.appendChild(this.content),this.container.appendChild(this.frame),this.mode==="code"?(this.editorDom=document.createElement("div"),this.editorDom.style.height="100%",this.editorDom.style.width="100%",this.content.appendChild(this.editorDom),k=(H=H.edit(this.editorDom)).getSession(),H.$blockScrolling=1/0,H.setTheme(this.theme),H.setOptions({readOnly:F}),H.setShowPrintMargin(!1),H.setFontSize("14px"),k.setMode("ace/mode/json"),k.setTabSize(this.indentation),k.setUseSoftTabs(!0),k.setUseWrapMode(!0),P=k.setAnnotations,k.setAnnotations=function(V){P.call(this,V&&V.length?V:N.annotations)},H.commands.bindKey("Ctrl-L",null),H.commands.bindKey("Command-L",null),H.commands.bindKey("Ctrl-\\",null),H.commands.bindKey("Command-\\",null),H.commands.bindKey("Ctrl-Shift-\\",null),H.commands.bindKey("Command-Shift-\\",null),(this.aceEditor=H).on("change",this._onChange.bind(this)),H.on("changeSelection",this._onSelect.bind(this))):((k=document.createElement("textarea")).className="jsoneditor-text",k.spellcheck=!1,this.content.appendChild(k),this.textarea=k,this.textarea.readOnly=F,this.textarea.oninput===null?this.textarea.oninput=this._onChange.bind(this):this.textarea.onchange=this._onChange.bind(this),k.onselect=this._onSelect.bind(this),k.onmousedown=this._onMouseDown.bind(this),k.onblur=this._onBlur.bind(this)),this._updateHistoryButtons(),Array.isArray(this.options.showErrorTable)?this.options.showErrorTable.includes(this.mode):this.options.showErrorTable===!0);this.errorTable=new c.N({errorTableVisible:H,onToggleVisibility:function(){N._validateAndCatch()},onFocusLine:function(V){N.isFocused=!0,isNaN(V)||N.setTextSelection({row:V,column:1},{row:V,column:1e3})},onChangeHeight:function(V){V=V+(N.dom.statusBar?N.dom.statusBar.clientHeight:0)+1,N.content.style.marginBottom=-V+"px",N.content.style.paddingBottom=V+"px"}}),this.frame.appendChild(this.errorTable.getErrorTable()),R.statusBar&&((0,b.addClassName)(this.content,"has-status-bar"),this.curserInfoElements={},F=document.createElement("div"),(this.dom.statusBar=F).className="jsoneditor-statusbar",this.frame.appendChild(F),(k=document.createElement("span")).className="jsoneditor-curserinfo-label",k.innerText="Ln:",(H=document.createElement("span")).className="jsoneditor-curserinfo-val",H.innerText="1",F.appendChild(k),F.appendChild(H),(R=document.createElement("span")).className="jsoneditor-curserinfo-label",R.innerText="Col:",(k=document.createElement("span")).className="jsoneditor-curserinfo-val",k.innerText="1",F.appendChild(R),F.appendChild(k),this.curserInfoElements.colVal=k,this.curserInfoElements.lnVal=H,(R=document.createElement("span")).className="jsoneditor-curserinfo-label",R.innerText="characters selected",R.style.display="none",(k=document.createElement("span")).className="jsoneditor-curserinfo-count",k.innerText="0",k.style.display="none",this.curserInfoElements.countLabel=R,this.curserInfoElements.countVal=k,F.appendChild(k),F.appendChild(R),F.appendChild(this.errorTable.getErrorCounter()),F.appendChild(this.errorTable.getWarningIcon()),F.appendChild(this.errorTable.getErrorIcon())),this.setSchema(this.options.schema,this.options.schemaRefs)},_._onSchemaChange=function(w,S){this.aceEditor&&(this.options.allowSchemaSuggestions&&w?(this.aceEditor.setOption("enableBasicAutocompletion",[new A(w,S)]),this.aceEditor.setOption("enableLiveAutocompletion",!0)):(this.aceEditor.setOption("enableBasicAutocompletion",void 0),this.aceEditor.setOption("enableLiveAutocompletion",!1)))},_._onChange=function(){var w=this;if(!this.onChangeDisabled){if(setTimeout(function(){w._updateHistoryButtons&&w._updateHistoryButtons()}),this._debouncedValidate(),this.options.onChange)try{this.options.onChange()}catch{}if(this.options.onChangeText)try{this.options.onChangeText(this.getText())}catch{}}},_._updateHistoryButtons=function(){var w;this.aceEditor&&this.dom.undo&&this.dom.redo&&(w=this.aceEditor.getSession().getUndoManager())&&w.hasUndo&&w.hasRedo&&(this.dom.undo.disabled=!w.hasUndo(),this.dom.redo.disabled=!w.hasRedo())},_._showSortModal=function(){try{var w=this,S=this.options.modalAnchor||l.ai,P=this.get();(0,h.showSortModal)(S,P,function(k){var L;Array.isArray(P)&&(L=(0,b.sort)(P,k.path,k.direction),w.sortedBy=k,w.update(L)),(0,b.isObject)(P)&&(L=(0,b.sortObjectKeys)(P,k.direction),w.sortedBy=k,w.update(L))},w.sortedBy)}catch(k){this._onError(k)}},_._showTransformModal=function(){var w=this;try{var S=this.options,P=S.modalAnchor,k=S.createQuery,L=S.executeQuery,R=S.queryDescription,N=this.get();(0,f.showTransformModal)({container:P||l.ai,json:N,queryDescription:R,createQuery:k,executeQuery:L,onTransform:function(F){F=L(N,F),w.update(F)}})}catch(F){this._onError(F)}},_._onSelect=function(){this._updateCursorInfo(),this._emitSelectionChange()},_._onKeyDown=function(w){var S=!1;(w.which||w.keyCode)===73&&w.ctrlKey&&(w.shiftKey?this.compact():this.format(),this._onChange(),S=!0),S&&(w.preventDefault(),w.stopPropagation()),this._updateCursorInfo(),this._emitSelectionChange()},_._onMouseDown=function(){this._updateCursorInfo(),this._emitSelectionChange()},_._onBlur=function(){var w=this;setTimeout(function(){w.isFocused||(w._updateCursorInfo(),w._emitSelectionChange()),w.isFocused=!1})},_._updateCursorInfo=function(){var w,S,P,k,L,R=this;function N(){R.curserInfoElements.countVal.innerText!==L&&(R.curserInfoElements.countVal.innerText=L,R.curserInfoElements.countVal.style.display=L?"inline":"none",R.curserInfoElements.countLabel.style.display=L?"inline":"none"),R.curserInfoElements.lnVal.innerText=P,R.curserInfoElements.colVal.innerText=k}this.textarea?setTimeout(function(){var F=(0,b.getInputSelection)(R.textarea);F.startIndex!==F.endIndex&&(L=F.endIndex-F.startIndex),k=(L&&R.cursorInfo&&R.cursorInfo.line===F.end.row&&R.cursorInfo.column===F.end.column?(P=F.start.row,F.start):(P=F.end.row,F.end)).column,R.cursorInfo={line:P,column:k,count:L},R.options.statusBar&&N()},0):this.aceEditor&&this.curserInfoElements&&(w=this.aceEditor.getCursorPosition(),S=this.aceEditor.getSelectedText(),P=w.row+1,k=w.column+1,L=S.length,R.cursorInfo={line:P,column:k,count:L},this.options.statusBar)&&N()},_._emitSelectionChange=function(){var w;this._selectionChangedHandler&&(w=this.getTextSelection(),this._selectionChangedHandler(w.start,w.end,w.text))},_._refreshAnnotations=function(){var w,S=this.aceEditor&&this.aceEditor.getSession();S&&(w=S.getAnnotations().filter(function(P){return P.type==="error"}),S.setAnnotations(w))},_.destroy=function(){this.aceEditor&&(this.aceEditor.destroy(),this.aceEditor=null),this.frame&&this.container&&this.frame.parentNode===this.container&&this.container.removeChild(this.frame),this.modeSwitcher&&(this.modeSwitcher.destroy(),this.modeSwitcher=null),this.textarea=null,this._debouncedValidate=null,this.frameFocusTracker.destroy()},_.compact=function(){var w=this.get(),w=JSON.stringify(w);this.updateText(w)},_.format=function(){var w=this.get(),w=JSON.stringify(w,null,this.indentation);this.updateText(w)},_.repair=function(){var w=this.getText();try{var S=(0,s.m)(w);this.updateText(S)}catch{}},_.focus=function(){this.textarea&&this.textarea.focus(),this.aceEditor&&this.aceEditor.focus()},_.resize=function(){this.aceEditor&&this.aceEditor.resize(!1)},_.set=function(w){this.setText(JSON.stringify(w,null,this.indentation))},_.update=function(w){this.updateText(JSON.stringify(w,null,this.indentation))},_.get=function(){var w=this.getText();return(0,b.parse)(w)},_.getText=function(){return this.textarea?this.textarea.value:this.aceEditor?this.aceEditor.getValue():""},_._setText=function(L,S){var P,k=this,L=this.options.escapeUnicode===!0?(0,b.escapeUnicodeChars)(L):L;this.textarea&&(this.textarea.value=L),this.aceEditor&&(this.onChangeDisabled=!0,this.aceEditor.setValue(L,-1),this.onChangeDisabled=!1,S&&(P=this,setTimeout(function(){P.aceEditor&&P.aceEditor.session.getUndoManager().reset()})),setTimeout(function(){k._updateHistoryButtons&&k._updateHistoryButtons()})),this._debouncedValidate()},_.setText=function(w){this._setText(w,!0)},_.updateText=function(w){this.getText()!==w&&this._setText(w,!1)},_.validate=function(){var w,S=this,P=[],k=[];try{var L=this.get(),R=(this.validateSchema&&!this.validateSchema(L)&&(P=this.validateSchema.errors.map(function(F){return F.type="validation",(0,b.improveSchemaError)(F)})),this.validationSequence=(this.validationSequence||0)+1,this),N=this.validationSequence;return function(F,H){if(!H)return Promise.resolve([]);try{var V=H(F);return((0,b.isPromise)(V)?V:Promise.resolve(V)).then(function(q){return Array.isArray(q)?q.filter(function(Q){var O=(0,b.isValidValidationError)(Q);return O}).map(function(Q){return{dataPath:(0,b.stringifyPath)(Q.path),message:Q.message,type:"customValidation"}}):[]})}catch(q){return Promise.reject(q)}}(L,this.options.onValidate).then(function(F){return N===R.validationSequence&&(F=P.concat(k).concat(F),R._renderErrors(F),typeof S.options.onValidationError=="function"&&(0,b.isValidationErrorChanged)(F,S.lastSchemaErrors)&&S.options.onValidationError.call(S,F),S.lastSchemaErrors=F),S.lastSchemaErrors})}catch(F){return this.getText()&&((L=/\w*line\s*(\d+)\w*/g.exec(F.message))&&(w=+L[1]),k=[{type:"error",message:F.message.replace(/\n/g,"<br>"),line:w}]),this._renderErrors(k),typeof this.options.onValidationError=="function"&&(0,b.isValidationErrorChanged)(k,this.lastSchemaErrors)&&this.options.onValidationError.call(this,k),this.lastSchemaErrors=k,Promise.resolve(this.lastSchemaErrors)}},_._validateAndCatch=function(){this.validate().catch(function(w){})},_._renderErrors=function(w){var P=this.getText(),S=[],P=(w.reduce(function(k,L){return typeof L.dataPath=="string"&&k.indexOf(L.dataPath)===-1&&k.push(L.dataPath),k},S),(0,b.getPositionForPath)(P,S));this.aceEditor&&(this.annotations=P.map(function(k){var L=w.filter(function(N){return N.dataPath===k.path}),R=L.map(function(N){return N.message}).join(`
`);return R?{row:k.line,column:k.column,text:"Schema validation error"+(L.length!==1?"s":"")+`: 
`+R,type:"warning",source:"jsoneditor"}:{}}),this._refreshAnnotations()),this.errorTable.setErrors(w,P),this.aceEditor&&this.aceEditor.resize(!1)},_.getTextSelection=function(){var w,S,P,k={};return this.textarea?(P=(0,b.getInputSelection)(this.textarea),this.cursorInfo&&this.cursorInfo.line===P.end.row&&this.cursorInfo.column===P.end.column?(k.start=P.end,k.end=P.start):k=P,{start:k.start,end:k.end,text:this.textarea.value.substring(P.startIndex,P.endIndex)}):this.aceEditor?(P=this.aceEditor.getSelection(),w=this.aceEditor.getSelectedText(),S=P.getRange(),(P=P.getSelectionLead()).row===S.end.row&&P.column===S.end.column?k=S:(k.start=S.end,k.end=S.start),{start:{row:k.start.row+1,column:k.start.column+1},end:{row:k.end.row+1,column:k.end.column+1},text:w}):void 0},_.onTextSelectionChange=function(w){typeof w=="function"&&(this._selectionChangedHandler=(0,b.debounce)(w,this.DEBOUNCE_INTERVAL))},_.setTextSelection=function(w,S){var P,k,L;w&&S&&(this.textarea?(P=(0,b.getIndexForPosition)(this.textarea,w.row,w.column),L=(0,b.getIndexForPosition)(this.textarea,S.row,S.column),-1<P&&-1<L&&(this.textarea.setSelectionRange?(this.textarea.focus(),this.textarea.setSelectionRange(P,L)):this.textarea.createTextRange&&((k=this.textarea.createTextRange()).collapse(!0),k.moveEnd("character",L),k.moveStart("character",P),k.select()),L=(this.textarea.value.match(/\n/g)||[]).length+1,P=this.textarea.scrollHeight/L,k=w.row*P,this.textarea.scrollTop=k>this.textarea.clientHeight?k-this.textarea.clientHeight/2:0)):this.aceEditor&&(L={start:{row:w.row-1,column:w.column-1},end:{row:S.row-1,column:S.column-1}},this.aceEditor.selection.setRange(L),this.aceEditor.scrollToLine(w.row-1,!0)))};var E=[{mode:"text",mixin:_,data:"text",load:T},{mode:"code",mixin:_,data:"text",load:T}]},5633:function(n,J,ne){"use strict";ne.r(J),ne.d(J,{treeModeMixins:function(){return le}});var s={start:function(ee,oe,te){return oe.indexOf(ee)===0},contain:function(ee,oe,te){return-1<oe.indexOf(ee)}},a=ne(6545),l=ne(2877);function c(ee){return(c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe})(ee)}function u(ee,oe){for(var te=0;te<oe.length;te++){var X=oe[te];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(ee,function(W){return W=function(K,re){if(c(K)!="object"||!K)return K;var se=K[Symbol.toPrimitive];if(se===void 0)return(re==="string"?String:Number)(K);if(se=se.call(K,re||"default"),c(se)!="object")return se;throw new TypeError("@@toPrimitive must return a primitive value.")}(W,"string"),c(W)=="symbol"?W:W+""}(X.key),X)}}var d=function(){function ee(){if(!(this instanceof ee))throw new TypeError("Cannot call a class as a function");this.locked=!1}return oe=ee,(te=[{key:"highlight",value:function(W){this.locked||(this.node!==W&&(this.node&&this.node.setHighlight(!1),this.node=W,this.node.setHighlight(!0)),this._cancelUnhighlight())}},{key:"unhighlight",value:function(){var W;this.locked||(W=this).node&&(this._cancelUnhighlight(),this.unhighlightTimer=setTimeout(function(){W.node.setHighlight(!1),W.node=void 0,W.unhighlightTimer=void 0},0))}},{key:"_cancelUnhighlight",value:function(){this.unhighlightTimer&&(clearTimeout(this.unhighlightTimer),this.unhighlightTimer=void 0)}},{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}}])&&u(oe.prototype,te),X&&u(oe,X),Object.defineProperty(oe,"prototype",{writable:!1}),oe;var oe,te,X}(),m=ne(3057),p=ne(359),h=ne(1389),J=ne(1342),f=ne.n(J),C=ne(1925),g=ne(6237),b=ne(2915),y=ne(5609),x=ne(660);function A(ee){return function(oe){if(Array.isArray(oe))return T(oe)}(ee)||function(oe){if(typeof Symbol<"u"&&oe[Symbol.iterator]!=null||oe["@@iterator"]!=null)return Array.from(oe)}(ee)||I(ee)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function v(ee,oe){return function(te){if(Array.isArray(te))return te}(ee)||function(te,X){var W=te==null?null:typeof Symbol<"u"&&te[Symbol.iterator]||te["@@iterator"];if(W!=null){var K,re,se,me,Y=[],ae=!0,ve=!1;try{if(se=(W=W.call(te)).next,X===0){if(Object(W)!==W)return;ae=!1}else for(;!(ae=(K=se.call(W)).done)&&(Y.push(K.value),Y.length!==X);ae=!0);}catch(ge){ve=!0,re=ge}finally{try{if(!ae&&W.return!=null&&(me=W.return(),Object(me)!==me))return}finally{if(ve)throw re}}return Y}}(ee,oe)||I(ee,oe)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function _(ee,oe){var te,X,W,K,re=typeof Symbol<"u"&&ee[Symbol.iterator]||ee["@@iterator"];if(re)return X=!(te=!0),{s:function(){re=re.call(ee)},n:function(){var se=re.next();return te=se.done,se},e:function(se){X=!0,W=se},f:function(){try{te||re.return==null||re.return()}finally{if(X)throw W}}};if(Array.isArray(ee)||(re=I(ee))||oe&&ee&&typeof ee.length=="number")return re&&(ee=re),K=0,{s:oe=function(){},n:function(){return K>=ee.length?{done:!0}:{done:!1,value:ee[K++]}},e:function(se){throw se},f:oe};throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I(ee,oe){var te;if(ee)return typeof ee=="string"?T(ee,oe):(te=(te=Object.prototype.toString.call(ee).slice(8,-1))==="Object"&&ee.constructor?ee.constructor.name:te)==="Map"||te==="Set"?Array.from(ee):te==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(te)?T(ee,oe):void 0}function T(ee,oe){(oe==null||oe>ee.length)&&(oe=ee.length);for(var te=0,X=new Array(oe);te<oe;te++)X[te]=ee[te];return X}function E(ee){return(E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe})(ee)}function w(ee,oe){for(var te=0;te<oe.length;te++){var X=oe[te];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(ee,function(W){return W=function(K,re){if(E(K)!="object"||!K)return K;var se=K[Symbol.toPrimitive];if(se===void 0)return(re==="string"?String:Number)(K);if(se=se.call(K,re||"default"),E(se)!="object")return se;throw new TypeError("@@toPrimitive must return a primitive value.")}(W,"string"),E(W)=="symbol"?W:W+""}(X.key),X)}}var S=function(){function ee(W,K){if(!(this instanceof ee))throw new TypeError("Cannot call a class as a function");this.editor=W,this.dom={},this.expanded=!1,K&&K instanceof Object?(this.setField(K.field,K.fieldEditable),"value"in K&&this.setValue(K.value,K.type),"internalValue"in K&&this.setInternalValue(K.internalValue)):(this.setField(""),this.setValue(null)),this._debouncedOnChangeValue=(0,g.debounce)(this._onChangeValue.bind(this),ee.prototype.DEBOUNCE_INTERVAL),this._debouncedOnChangeField=(0,g.debounce)(this._onChangeField.bind(this),ee.prototype.DEBOUNCE_INTERVAL),this.visibleChilds=this.getMaxVisibleChilds()}return oe=ee,(te=[{key:"getMaxVisibleChilds",value:function(){return this.editor&&this.editor.options&&this.editor.options.maxVisibleChilds?this.editor.options.maxVisibleChilds:P}},{key:"_updateEditability",value:function(){var W,K;this.editable={field:!0,value:!0},this.editor&&(this.editable.field=this.editor.options.mode==="tree",this.editable.value=this.editor.options.mode!=="view",this.editor.options.mode!=="tree"&&this.editor.options.mode!=="form"||typeof this.editor.options.onEditable!="function"||(W=this.getValue.bind(this),typeof(K=this.editor.options.onEditable({field:this.field,get value(){return W()},path:this.getPath()}))=="boolean"?(this.editable.field=K,this.editable.value=K):E(K)==="object"&&K!==null?(typeof K.field=="boolean"&&(this.editable.field=K.field),typeof K.value=="boolean"&&(this.editable.value=K.value)):(this.editable.field=!1,this.editable.value=!1)))}},{key:"getPath",value:function(){for(var W=this,K=[];W;){var re=W.getName();re!==void 0&&K.unshift(re),W=W.parent}return K}},{key:"getInternalPath",value:function(){for(var W=this,K=[];W;)W.parent&&K.unshift(W.getIndex()),W=W.parent;return K}},{key:"getName",value:function(){return this.parent?this.parent.type!=="array"?this.field:this.index:void 0}},{key:"findNodeByPath",value:function(W){if(W){if(W.length===0)return this;if(W.length&&this.childs&&this.childs.length){for(var K=0;K<this.childs.length;++K)if(""+W[0]==""+this.childs[K].getName())return this.childs[K].findNodeByPath(W.slice(1))}}}},{key:"findNodeByInternalPath",value:function(W){if(W){for(var se=this,K=0;K<W.length&&se;K++)var re=W[K],se=se.childs[re];return se}}},{key:"serialize",value:function(){return{value:this.getValue(),path:this.getPath()}}},{key:"findNode",value:function(W){for(var K=(0,g.parsePath)(W),re=this;re&&0<K.length;)(function(){var se=K.shift();if(typeof se=="number"){if(re.type!=="array")throw new Error("Cannot get child node at index "+se+": node is no array");re=re.childs[se]}else{if(re.type!=="object")throw new Error("Cannot get child node "+se+": node is no object");re=re.childs.filter(function(me){return me.field===se})[0]}})();return re}},{key:"findParents",value:function(){for(var W=[],K=this.parent;K;)W.unshift(K),K=K.parent;return W}},{key:"setError",value:function(W,K){this.error=W,this.errorChild=K,this.dom&&this.dom.tr&&this.updateError()}},{key:"updateError",value:function(){var W=this,K=this.fieldError||this.valueError||this.error,re=this.dom.tdError;if(K&&this.dom&&this.dom.tr){(0,g.addClassName)(this.dom.tr,"jsoneditor-validation-error"),re||(re=document.createElement("td"),this.dom.tdError=re,this.dom.tdValue.parentNode.appendChild(re));var se=document.createElement("button"),me=(se.type="button",se.className="jsoneditor-button jsoneditor-schema-error",function(){W.dom.popupAnchor&&W.dom.popupAnchor.destroy()}),Y=function(){delete W.dom.popupAnchor},ae=function(Ee){var Se=W.editor.frame,Ee=(W.dom.popupAnchor=(0,C.p)(se,W.editor.getPopupAnchor(),Y,Ee),se.getBoundingClientRect()),Se=120<Se.getBoundingClientRect().width-Ee.x?"jsoneditor-above":"jsoneditor-left",Ee=document.createElement("div");Ee.className="jsoneditor-popover "+Se,Ee.appendChild(document.createTextNode(K.message)),W.dom.popupAnchor.appendChild(Ee)},ve=(se.onmouseover=function(){W.dom.popupAnchor||ae(!0)},se.onfocus=function(){me(),ae(!1)},se.onblur=function(){me()},this.errorChild);for(ve&&(se.onclick=function(){ve.findParents().forEach(function(ge){ge.expand(!1)}),ve.scrollTo(function(){ve.focus()})});re.firstChild;)re.removeChild(re.firstChild);re.appendChild(se)}else this.dom.tr&&(0,g.removeClassName)(this.dom.tr,"jsoneditor-validation-error"),re&&(this.dom.tdError.parentNode.removeChild(this.dom.tdError),delete this.dom.tdError)}},{key:"getIndex",value:function(){var W;return this.parent?(W=this.parent.childs.indexOf(this))!==-1?W:null:-1}},{key:"setParent",value:function(W){this.parent=W}},{key:"setField",value:function(W,K){this.field=W,this.previousField=W,this.fieldEditable=K===!0}},{key:"getField",value:function(){return this.field===void 0&&this._getDomField(),this.field}},{key:"setValue",value:function(W,K){var re,se,me,Y,ae,ve,ge=this.childs;if(this.type=this._getType(W),K&&K!==this.type){if(K!=="string"||this.type!=="auto")throw new Error('Type mismatch: cannot cast value of type "'+this.type+' to the specified type "'+K+'"');this.type=K}if(this.type==="array"){for(this.childs||(this.childs=[]),re=0;re<W.length;re++)(ae=W[re])===void 0||ae instanceof Function||(re<this.childs.length?((me=this.childs[re]).fieldEditable=!1,me.index=re,me.setValue(ae)):(me=new ee(this.editor,{value:ae}),Y=re<this.getMaxVisibleChilds(),this.appendChild(me,Y,!1)));for(se=this.childs.length;se>=W.length;se--)this.removeChild(this.childs[se],!1)}else if(this.type==="object"){for(this.childs||(this.childs=[]),se=this.childs.length-1;0<=se;se--)R(W,this.childs[se].field)||this.removeChild(this.childs[se],!1);for(var Se in re=0,W)R(W,Se)&&((ae=W[Se])===void 0||ae instanceof Function||((ve=this.findChildByProperty(Se))?(ve.setField(Se,!0),ve.setValue(ae)):(ve=new ee(this.editor,{field:Se,value:ae}),Se=re<this.getMaxVisibleChilds(),this.appendChild(ve,Se,!1))),re++);!(this.value="")===this.editor.options.sortObjectKeys&&this.sort([],"asc",!1)}else this.hideChilds(),delete this.append,delete this.showMore,delete this.expanded,delete this.childs,this.value=W;Array.isArray(ge)!==Array.isArray(this.childs)&&this.recreateDom(),this.updateDom({updateIndexes:!0}),this.previousValue=this.value}},{key:"setInternalValue",value:function(W){var K,re,se,me,Y,ae=this.childs;if(this.type=W.type,W.type==="array"){for(this.childs||(this.childs=[]),me=0;me<W.childs.length;me++)(K=W.childs[me])===void 0||K instanceof Function||(me<this.childs.length?((re=this.childs[me]).fieldEditable=!1,re.index=me,re.setInternalValue(K)):(re=new ee(this.editor,{internalValue:K}),se=me<this.getMaxVisibleChilds(),this.appendChild(re,se,!1)));for(Y=this.childs.length;Y>=W.childs.length;Y--)this.removeChild(this.childs[Y],!1)}else if(W.type==="object"){for(this.childs||(this.childs=[]),me=0;me<W.childs.length;me++)(K=W.childs[me])===void 0||K instanceof Function||(me<this.childs.length?(delete(re=this.childs[me]).index,re.setField(K.field,!0),re.setInternalValue(K.value)):(re=new ee(this.editor,{field:K.field,internalValue:K.value}),se=me<this.getMaxVisibleChilds(),this.appendChild(re,se,!1)));for(Y=this.childs.length;Y>=W.childs.length;Y--)this.removeChild(this.childs[Y],!1)}else this.hideChilds(),delete this.append,delete this.showMore,delete this.expanded,delete this.childs,this.value=W.value;Array.isArray(ae)!==Array.isArray(this.childs)&&this.recreateDom(),this.updateDom({updateIndexes:!0}),this.previousValue=this.value}},{key:"recreateDom",value:function(){var W;this.dom&&this.dom.tr&&this.dom.tr.parentNode?(W=this._detachFromDom(),this.clearDom(),this._attachToDom(W)):this.clearDom()}},{key:"getValue",value:function(){var W,K;return this.type==="array"?(W=[],this.childs.forEach(function(re){W.push(re.getValue())}),W):this.type==="object"?(K={},this.childs.forEach(function(re){K[re.getField()]=re.getValue()}),K):(this.value===void 0&&this._getDomValue(),this.value)}},{key:"getInternalValue",value:function(){return this.type==="array"?{type:this.type,childs:this.childs.map(function(W){return W.getInternalValue()})}:this.type==="object"?{type:this.type,childs:this.childs.map(function(W){return{field:W.getField(),value:W.getInternalValue()}})}:(this.value===void 0&&this._getDomValue(),{type:this.type,value:this.value})}},{key:"getLevel",value:function(){return this.parent?this.parent.getLevel()+1:0}},{key:"getNodePath",value:function(){var W=this.parent?this.parent.getNodePath():[];return W.push(this),W}},{key:"clone",value:function(){var W,K;return(W=new ee(this.editor)).type=this.type,W.field=this.field,W.fieldInnerText=this.fieldInnerText,W.fieldEditable=this.fieldEditable,W.previousField=this.previousField,W.value=this.value,W.valueInnerText=this.valueInnerText,W.previousValue=this.previousValue,W.expanded=this.expanded,W.visibleChilds=this.visibleChilds,this.childs?(K=[],this.childs.forEach(function(re){re=re.clone(),re.setParent(W),K.push(re)}),W.childs=K):W.childs=void 0,W}},{key:"expand",value:function(W){this.childs&&(this.expanded=!0,this.dom.expand&&(this.dom.expand.className="jsoneditor-button jsoneditor-expanded"),this.showChilds(),W!==!1&&this.childs.forEach(function(K){K.expand(W)}),this.updateDom({recurse:!1}))}},{key:"collapse",value:function(W){this.childs&&(this.hideChilds(),W!==!1&&this.childs.forEach(function(K){K.collapse(W)}),this.dom.expand&&(this.dom.expand.className="jsoneditor-button jsoneditor-collapsed"),this.expanded=!1,this.updateDom({recurse:!1}))}},{key:"showChilds",value:function(){var W=this.childs;if(W&&this.expanded){var W=this.dom.tr,K=W?W.parentNode:void 0;if(K){for(var re=this.getAppendDom(),se=(re.parentNode||((me=W.nextSibling)?K.insertBefore(re,me):K.appendChild(re)),Math.min(this.childs.length,this.visibleChilds)),me=this._getNextTr(),Y=0;Y<se;Y++){var ae=this.childs[Y];ae.getDom().parentNode||K.insertBefore(ae.getDom(),me),ae.showChilds()}W=this.getShowMoreDom(),me=this._getNextTr(),W.parentNode||K.insertBefore(W,me),this.showMore.updateDom()}}}},{key:"_getNextTr",value:function(){return this.showMore&&this.showMore.getDom().parentNode?this.showMore.getDom():this.append&&this.append.getDom().parentNode?this.append.getDom():void 0}},{key:"hide",value:function(W){var K=this.dom.tr,re=K?K.parentNode:void 0;re&&re.removeChild(K),this.dom.popupAnchor&&this.dom.popupAnchor.destroy(),this.hideChilds(W)}},{key:"hideChilds",value:function(W){var K;this.childs&&this.expanded&&((K=this.getAppendDom()).parentNode&&K.parentNode.removeChild(K),this.childs.forEach(function(re){re.hide()}),(K=this.getShowMoreDom()).parentNode&&K.parentNode.removeChild(K),W&&!W.resetVisibleChilds||(this.visibleChilds=this.getMaxVisibleChilds()))}},{key:"_updateCssClassName",value:function(){var W,K;this.dom.field&&this.editor&&this.editor.options&&typeof this.editor.options.onClassName=="function"&&this.dom.tree&&((0,g.removeAllClassNames)(this.dom.tree),W=this.getValue.bind(this),K=this.editor.options.onClassName({path:this.getPath(),field:this.field,get value(){return W()}})||"",(0,g.addClassName)(this.dom.tree,"jsoneditor-values "+K))}},{key:"recursivelyUpdateCssClassesOnNodes",value:function(){if(this._updateCssClassName(),Array.isArray(this.childs))for(var W=0;W<this.childs.length;W++)this.childs[W].recursivelyUpdateCssClassesOnNodes()}},{key:"expandTo",value:function(){for(var W=this.parent;W;)W.expanded||W.expand(),W=W.parent}},{key:"appendChild",value:function(W,K,re){var se,me;this._hasChilds()&&(W.setParent(this),W.fieldEditable=this.type==="object",this.type==="array"&&(W.index=this.childs.length),this.type==="object"&&W.field===void 0&&W.setField(""),this.childs.push(W),this.expanded&&K!==!1&&(K=W.getDom(),me=(se=this._getNextTr())?se.parentNode:void 0,se&&me&&me.insertBefore(K,se),W.showChilds(),this.visibleChilds++),re!==!1)&&(this.updateDom({updateIndexes:!0}),W.updateDom({recurse:!0}))}},{key:"moveBefore",value:function(W,K,re){var se,me,Y;this._hasChilds()&&((se=this.dom.tr?this.dom.tr.parentNode:void 0)&&((me=document.createElement("tr")).style.height=se.clientHeight+"px",se.appendChild(me)),W.parent&&W.parent.removeChild(W),K instanceof N||!K?this.childs.length+1>this.visibleChilds?(Y=this.childs[this.visibleChilds-1],this.insertBefore(W,Y,re)):this.appendChild(W,!0,re):this.insertBefore(W,K,re),se)&&me&&se.removeChild(me)}},{key:"insertBefore",value:function(W,K,re){if(this._hasChilds()){if(this.visibleChilds++,this.type==="object"&&W.field===void 0&&W.setField(""),K===this.append)W.setParent(this),W.fieldEditable=this.type==="object",this.childs.push(W);else{var se=this.childs.indexOf(K);if(se===-1)throw new Error("Node not found");W.setParent(this),W.fieldEditable=this.type==="object",this.childs.splice(se,0,W)}var me;this.expanded&&(se=W.getDom(),me=(K=K.getDom())?K.parentNode:void 0,K&&me&&me.insertBefore(se,K),W.showChilds(),this.showChilds()),re!==!1&&(this.updateDom({updateIndexes:!0}),W.updateDom({recurse:!0}))}}},{key:"insertAfter",value:function(W,K){this._hasChilds()&&(K=this.childs.indexOf(K),(K=this.childs[K+1])?this.insertBefore(W,K):this.appendChild(W))}},{key:"search",value:function(W,K){Array.isArray(K)||(K=[]);var re=W?W.toLowerCase():void 0;return delete this.searchField,delete this.searchValue,this.field!==void 0&&K.length<=this.MAX_SEARCH_RESULTS&&(String(this.field).toLowerCase().indexOf(re)!==-1&&(this.searchField=!0,K.push({node:this,elem:"field"})),this._updateDomField()),this._hasChilds()?this.childs&&this.childs.forEach(function(se){se.search(W,K)}):this.value!==void 0&&K.length<=this.MAX_SEARCH_RESULTS&&(String(this.value).toLowerCase().indexOf(re)!==-1&&(this.searchValue=!0,K.push({node:this,elem:"value"})),this._updateDomValue()),K}},{key:"scrollTo",value:function(W){this.expandPathToNode(),this.dom.tr&&this.dom.tr.parentNode&&this.editor.scrollTo(this.dom.tr.offsetTop,W)}},{key:"expandPathToNode",value:function(){for(var W=this;W&&W.parent;){for(var K=W.parent.type==="array"?W.index:W.parent.childs.indexOf(W);W.parent.visibleChilds<K+1;)W.parent.visibleChilds+=this.getMaxVisibleChilds();W.parent.expand(!1),W=W.parent}}},{key:"focus",value:function(W){if(ee.focusElement=W,this.dom.tr&&this.dom.tr.parentNode){var K=this.dom;switch(W){case"drag":(K.drag||K.menu).focus();break;case"menu":K.menu.focus();break;case"expand":this._hasChilds()?K.expand.focus():K.field&&this.fieldEditable?(K.field.focus(),(0,g.selectContentEditable)(K.field)):K.value&&!this._hasChilds()?(K.value.focus(),(0,g.selectContentEditable)(K.value)):K.menu.focus();break;case"field":K.field&&this.fieldEditable?(K.field.focus(),(0,g.selectContentEditable)(K.field)):K.value&&!this._hasChilds()?(K.value.focus(),(0,g.selectContentEditable)(K.value)):(this._hasChilds()?K.expand:K.menu).focus();break;default:K.select?K.select.focus():K.value&&!this._hasChilds()?(K.value.focus(),(0,g.selectContentEditable)(K.value)):K.field&&this.fieldEditable?(K.field.focus(),(0,g.selectContentEditable)(K.field)):(this._hasChilds()?K.expand:K.menu).focus()}}}},{key:"containsNode",value:function(W){if(this===W)return!0;var K=this.childs;if(K){for(var re=0,se=K.length;re<se;re++)if(K[re].containsNode(W))return!0}return!1}},{key:"removeChild",value:function(W,K){if(this.childs){var re=this.childs.indexOf(W);if(re!==-1)return re<this.visibleChilds&&this.expanded&&this.visibleChilds--,W.hide(),delete W.searchField,delete W.searchValue,(W=this.childs.splice(re,1)[0]).parent=null,K!==!1&&this.updateDom({updateIndexes:!0}),W}}},{key:"_remove",value:function(W){this.removeChild(W)}},{key:"changeType",value:function(W){var K,re=this.type;re!==W&&(W!=="string"&&W!=="auto"||re!=="string"&&re!=="auto"?(K=this._detachFromDom(),this.clearDom(),(this.type=W)==="object"?(this.childs||(this.childs=[]),this.childs.forEach(function(se){se.clearDom(),delete se.index,se.fieldEditable=!0,se.field===void 0&&(se.field="")}),re!=="string"&&re!=="auto"||(this.expanded=!0)):W==="array"?(this.childs||(this.childs=[]),this.childs.forEach(function(se,me){se.clearDom(),se.fieldEditable=!1,se.index=me}),re!=="string"&&re!=="auto"||(this.expanded=!0)):this.expanded=!1,this._attachToDom(K)):this.type=W,W!=="auto"&&W!=="string"||(this.value=W==="string"?String(this.value):(0,g.parseString)(String(this.value)),this.focus()),this.updateDom({updateIndexes:!0}))}},{key:"deepEqual",value:function(W){var K;if(this.type==="array"){if(!Array.isArray(W)||this.childs.length!==W.length)return!1;for(K=0;K<this.childs.length;K++)if(!this.childs[K].deepEqual(W[K]))return!1}else if(this.type==="object"){if(E(W)!=="object"||!W)return!1;var re=Object.keys(W);if(this.childs.length!==re.length)return!1;for(K=0;K<re.length;K++){var se=this.childs[K];if(se.field!==re[K]||!se.deepEqual(W[se.field]))return!1}}else if(this.value!==W)return!1;return!0}},{key:"_getDomValue",value:function(){if(this._clearValueError(),this.dom.value&&this.type!=="array"&&this.type!=="object"&&(this.valueInnerText=(0,g.getInnerText)(this.dom.value),this.valueInnerText==="")&&this.dom.value.innerHTML!==""&&(this.dom.value.textContent=""),this.valueInnerText!==void 0)try{var W,K;(K=this.type==="string"?this._unescapeHTML(this.valueInnerText):(W=this._unescapeHTML(this.valueInnerText),(0,g.parseString)(W)))!==this.value&&(this.value=K,this._debouncedOnChangeValue())}catch{this._setValueError((0,m.Tl)("cannotParseValueError"))}}},{key:"_setValueError",value:function(W){this.valueError={message:W},this.updateError()}},{key:"_clearValueError",value:function(){this.valueError&&(this.valueError=null,this.updateError())}},{key:"_setFieldError",value:function(W){this.fieldError={message:W},this.updateError()}},{key:"_clearFieldError",value:function(){this.fieldError&&(this.fieldError=null,this.updateError())}},{key:"_onChangeValue",value:function(){var W,K=this.editor.getDomSelection(),re=(K.range&&(re=(0,g.textDiff)(String(this.value),String(this.previousValue)),K.range.startOffset=re.start,K.range.endOffset=re.end),this.editor.getDomSelection());re.range&&(W=(0,g.textDiff)(String(this.previousValue),String(this.value)),re.range.startOffset=W.start,re.range.endOffset=W.end),this.editor._onAction("editValue",{path:this.getInternalPath(),oldValue:this.previousValue,newValue:this.value,oldSelection:K,newSelection:re}),this.previousValue=this.value}},{key:"_onChangeField",value:function(){var W=this.editor.getDomSelection(),K=this.previousField||"",re=(W.range&&(re=(0,g.textDiff)(this.field,K),W.range.startOffset=re.start,W.range.endOffset=re.end),this.editor.getDomSelection());re.range&&(K=(0,g.textDiff)(K,this.field),re.range.startOffset=K.start,re.range.endOffset=K.end),this.editor._onAction("editField",{parentPath:this.parent.getInternalPath(),index:this.getIndex(),oldValue:this.previousField,newValue:this.field,oldSelection:W,newSelection:re}),this.previousField=this.field}},{key:"_updateDomValue",value:function(){var W=this.dom.value;if(W){var K=["jsoneditor-value"],re=this.value,se=this.type==="auto"?(0,g.getType)(re):this.type,me=se==="string"&&(0,g.isUrl)(re);if(K.push("jsoneditor-"+se),me&&K.push("jsoneditor-url"),String(this.value)===""&&this.type!=="array"&&this.type!=="object"&&K.push("jsoneditor-empty"),this.searchValueActive&&K.push("jsoneditor-highlight-active"),this.searchValue&&K.push("jsoneditor-highlight"),W.className=K.join(" "),se==="array"||se==="object"?(K=this.childs?this.childs.length:0,W.title=this.type+" containing "+K+" items"):me&&this.editable.value?W.title=(0,m.Tl)("openUrl"):W.title="",se==="boolean"&&this.editable.value?(this.dom.checkbox||(this.dom.checkbox=document.createElement("input"),this.dom.checkbox.type="checkbox",this.dom.tdCheckbox=document.createElement("td"),this.dom.tdCheckbox.className="jsoneditor-tree",this.dom.tdCheckbox.appendChild(this.dom.checkbox),this.dom.tdValue.parentNode.insertBefore(this.dom.tdCheckbox,this.dom.tdValue)),this.dom.checkbox.checked=this.value):this.dom.tdCheckbox&&(this.dom.tdCheckbox.parentNode.removeChild(this.dom.tdCheckbox),delete this.dom.tdCheckbox,delete this.dom.checkbox),this.enum&&this.editable.value?(this.dom.select||(this.dom.select=document.createElement("select"),this.id=this.field+"_"+new Date().getUTCMilliseconds(),this.dom.select.id=this.id,this.dom.select.name=this.dom.select.id,(K=document.createElement("option")).value="",K.textContent="--",this.dom.select.appendChild(K),this._updateEnumOptions(),this.dom.tdSelect=document.createElement("td"),this.dom.tdSelect.className="jsoneditor-tree",this.dom.tdSelect.appendChild(this.dom.select),this.dom.tdValue.parentNode.insertBefore(this.dom.tdSelect,this.dom.tdValue)),this.dom.select.value=this.enum.indexOf(this.value)!==-1?this.value:"",!this.schema||R(this.schema,"oneOf")||R(this.schema,"anyOf")||R(this.schema,"allOf")?delete this.valueFieldHTML:(this.valueFieldHTML=this.dom.tdValue.innerHTML,this.dom.tdValue.style.visibility="hidden",this.dom.tdValue.textContent="")):this.dom.tdSelect&&(this.dom.tdSelect.parentNode.removeChild(this.dom.tdSelect),delete this.dom.tdSelect,delete this.dom.select,this.dom.tdValue.innerHTML=this.valueFieldHTML,this.dom.tdValue.style.visibility="",delete this.valueFieldHTML,this.dom.tdValue.appendChild(this.dom.value)),this.editor.options.colorPicker&&typeof re=="string"&&(0,g.isValidColor)(re)?(this.dom.color||(this.dom.color=document.createElement("div"),this.dom.color.className="jsoneditor-color",this.dom.tdColor=document.createElement("td"),this.dom.tdColor.className="jsoneditor-tree",this.dom.tdColor.appendChild(this.dom.color),this.dom.tdValue.parentNode.insertBefore(this.dom.tdColor,this.dom.tdValue)),(0,g.addClassName)(this.dom.value,"jsoneditor-color-value"),(this.editable.value?g.removeClassName:g.addClassName)(this.dom.color,"jsoneditor-color-readonly"),this.dom.color.style.backgroundColor=re):this._deleteDomColor(),this._showTimestampTag()){if(this.dom.date||(this.dom.date=document.createElement("div"),this.dom.date.className="jsoneditor-date",this.dom.value.parentNode.appendChild(this.dom.date)),me=null,me=typeof this.editor.options.timestampFormat=="function"?this.editor.options.timestampFormat({field:this.field,value:this.value,path:this.getPath()}):me){for(;this.dom.date.firstChild;)this.dom.date.removeChild(this.dom.date.firstChild);this.dom.date.appendChild(document.createTextNode(me))}else this.dom.date.textContent=new Date(re).toISOString();this.dom.date.title=new Date(re).toString()}else this.dom.date&&(this.dom.date.parentNode.removeChild(this.dom.date),delete this.dom.date);(0,g.stripFormatting)(W),this._updateDomDefault()}}},{key:"_updateEnumOptions",value:function(){if(this.enum&&this.dom.select){this.dom.select.innerHTML="";for(var W=0;W<this.enum.length;W++){var K=document.createElement("option");K.value=this.enum[W],K.textContent=this.enum[W],this.dom.select.appendChild(K)}}}},{key:"_deleteDomColor",value:function(){this.dom.color&&(this.dom.tdColor.parentNode.removeChild(this.dom.tdColor),delete this.dom.tdColor,delete this.dom.color,(0,g.removeClassName)(this.dom.value,"jsoneditor-color-value"))}},{key:"_updateDomField",value:function(){var W,K=this.dom.field;K&&((W=(0,g.makeFieldTooltip)(this.schema,this.editor.options.language))&&(K.title=W),(String(this.field)===""&&this.parent&&this.parent.type!=="array"?g.addClassName:g.removeClassName)(K,"jsoneditor-empty"),(this.searchFieldActive?g.addClassName:g.removeClassName)(K,"jsoneditor-highlight-active"),(this.searchField?g.addClassName:g.removeClassName)(K,"jsoneditor-highlight"),(0,g.stripFormatting)(K))}},{key:"_getDomField",value:function(W){if(this._clearFieldError(),this.dom.field&&this.fieldEditable&&(this.fieldInnerText=(0,g.getInnerText)(this.dom.field),this.fieldInnerText==="")&&this.dom.field.innerHTML!==""&&(this.dom.field.textContent=""),this.fieldInnerText!==void 0)try{var K=this._unescapeHTML(this.fieldInnerText),re=this.parent.getFieldNames(this);re.indexOf(K)!==-1?W?(K=(0,g.findUniqueName)(K,re))!==this.field&&(this.field=K,this._debouncedOnChangeField()):this._setFieldError((0,m.Tl)("duplicateFieldError")):K!==this.field&&(this.field=K,this._debouncedOnChangeField())}catch{this._setFieldError((0,m.Tl)("cannotParseFieldError"))}}},{key:"_updateDomDefault",value:function(){var W;this.schema&&this.schema.default!==void 0&&!this._hasChilds()&&(W=this.dom.select||this.dom.value)&&(this.value===this.schema.default?(W.title=(0,m.Tl)("default"),(0,g.addClassName)(W,"jsoneditor-is-default"),g.removeClassName):(W.removeAttribute("title"),(0,g.removeClassName)(W,"jsoneditor-is-default"),g.addClassName))(W,"jsoneditor-is-not-default")}},{key:"_showTimestampTag",value:function(){var W,K;return typeof this.value=="number"&&(typeof(W=this.editor.options.timestampTag)=="function"?typeof(K=W({field:this.field,value:this.value,path:this.getPath()}))=="boolean"?K:(0,g.isTimestamp)(this.field,this.value):W===!0&&(0,g.isTimestamp)(this.field,this.value))}},{key:"clearDom",value:function(){this.dom={}}},{key:"getDom",value:function(){var W,K,re=this.dom;return re.tr||(this._updateEditability(),re.tr=document.createElement("tr"),(re.tr.node=this).editor.options.mode==="tree"&&(K=document.createElement("td"),this.editable.field&&this.parent&&((W=document.createElement("button")).type="button",(re.drag=W).className="jsoneditor-button jsoneditor-dragarea",W.title=(0,m.Tl)("drag"),K.appendChild(W)),re.tr.appendChild(K),W=document.createElement("td"),(K=document.createElement("button")).type="button",(re.menu=K).className="jsoneditor-button jsoneditor-contextmenu-button",K.title=(0,m.Tl)("actionsMenu"),W.appendChild(re.menu),re.tr.appendChild(W)),K=document.createElement("td"),re.tr.appendChild(K),re.tree=this._createDomTree(),K.appendChild(re.tree),this.updateDom({updateIndexes:!0})),re.tr}},{key:"isVisible",value:function(){return this.dom&&this.dom.tr&&this.dom.tr.parentNode||!1}},{key:"isDescendantOf",value:function(W){for(var K=this.parent;K;){if(K===W)return!0;K=K.parent}return!1}},{key:"_createDomField",value:function(){return document.createElement("div")}},{key:"setHighlight",value:function(W){this.dom.tr&&((W?g.addClassName:g.removeClassName)(this.dom.tr,"jsoneditor-highlight"),this.append&&this.append.setHighlight(W),this.childs)&&this.childs.forEach(function(K){K.setHighlight(W)})}},{key:"setSelected",value:function(W,K){this.selected=W,this.dom.tr&&((W?g.addClassName:g.removeClassName)(this.dom.tr,"jsoneditor-selected"),(K?g.addClassName:g.removeClassName)(this.dom.tr,"jsoneditor-first"),this.append&&this.append.setSelected(W),this.showMore&&this.showMore.setSelected(W),this.childs)&&this.childs.forEach(function(re){re.setSelected(W)})}},{key:"updateValue",value:function(W){this.value=W,this.previousValue=W,this.valueError=void 0,this.updateDom()}},{key:"updateField",value:function(W){this.field=W,this.previousField=W,this.fieldError=void 0,this.updateDom()}},{key:"updateDom",value:function(W){var K,re=this.dom.tree,re=(re&&(re.style.marginLeft=24*this.getLevel()+"px"),this.dom.field),re=(re&&(this.fieldEditable?(re.contentEditable=this.editable.field,re.spellcheck=!1,re.className="jsoneditor-field"):(re.contentEditable=!1,re.className="jsoneditor-readonly"),K=this.index!==void 0?this.index:this.field!==void 0?this.field:(K=this.editor.options.schema?ee._findSchema(this.editor.options.schema,this.editor.options.schemaRefs||{},this.getPath()):void 0)&&K.title?K.title:this._hasChilds()?this.type:"",K=this._escapeHTML(K),document.activeElement!==re&&K!==this._unescapeHTML((0,g.getInnerText)(re))&&(re.innerHTML=K),this._updateSchema(),this._updateEnumOptions()),this.dom.value),re=(re&&(this.type==="array"||this.type==="object"?this.updateNodeName():(K=this._escapeHTML(this.value),document.activeElement!==re&&K!==this._unescapeHTML((0,g.getInnerText)(re))&&(re.innerHTML=K))),this.dom.tr);re&&(this.type==="array"||this.type==="object"?((0,g.addClassName)(re,"jsoneditor-expandable"),this.expanded?((0,g.addClassName)(re,"jsoneditor-expanded"),(0,g.removeClassName)(re,"jsoneditor-collapsed")):((0,g.addClassName)(re,"jsoneditor-collapsed"),(0,g.removeClassName)(re,"jsoneditor-expanded"))):((0,g.removeClassName)(re,"jsoneditor-expandable"),(0,g.removeClassName)(re,"jsoneditor-expanded"),(0,g.removeClassName)(re,"jsoneditor-collapsed"))),this._updateDomField(),this._updateDomValue(),W&&W.updateIndexes===!0&&this._updateDomIndexes(),W&&W.recurse===!0&&this.childs&&this.childs.forEach(function(se){se.updateDom(W)}),this.error&&this.updateError(),this.append&&this.append.updateDom(),this.showMore&&this.showMore.updateDom(),this._updateCssClassName()}},{key:"_updateSchema",value:function(){this.editor&&this.editor.options&&(this.schema=this.editor.options.schema?ee._findSchema(this.editor.options.schema,this.editor.options.schemaRefs||{},this.getPath()):null,this.schema?this.enum=ee._findEnum(this.schema):delete this.enum)}},{key:"_updateDomIndexes",value:function(){var W=this.dom.value,K=this.childs;W&&K&&(this.type==="array"?K.forEach(function(re,se){re.index=se,re=re.dom.field,re&&(re.textContent=se)}):this.type==="object"&&K.forEach(function(re){re.index!==void 0&&(delete re.index,re.field===void 0)&&(re.field="")}))}},{key:"_createDomValue",value:function(){var W;return this.type==="array"?(W=document.createElement("div")).textContent="[...]":this.type==="object"?(W=document.createElement("div")).textContent="{...}":(!this.editable.value&&(0,g.isUrl)(this.value)?(W=document.createElement("a")).href=this.value:((W=document.createElement("div")).contentEditable=this.editable.value,W.spellcheck=!1),W.innerHTML=this._escapeHTML(this.value)),W}},{key:"_createDomExpandButton",value:function(){var W=document.createElement("button");return W.type="button",this._hasChilds()?(W.className=this.expanded?"jsoneditor-button jsoneditor-expanded":"jsoneditor-button jsoneditor-collapsed",W.title=(0,m.Tl)("expandTitle")):(W.className="jsoneditor-button jsoneditor-invisible",W.title=""),W}},{key:"_createDomTree",value:function(){var W=this.dom,K=document.createElement("table"),se=document.createElement("tbody"),re=(K.style.borderCollapse="collapse",K.className="jsoneditor-values",K.appendChild(se),document.createElement("tr")),se=(se.appendChild(re),document.createElement("td")),se=(se.className="jsoneditor-tree",re.appendChild(se),W.expand=this._createDomExpandButton(),se.appendChild(W.expand),W.tdExpand=se,document.createElement("td")),se=(se.className="jsoneditor-tree",re.appendChild(se),W.field=this._createDomField(),se.appendChild(W.field),W.tdField=se,document.createElement("td")),se=(se.className="jsoneditor-tree",re.appendChild(se),this.type!=="object"&&this.type!=="array"&&(se.appendChild(document.createTextNode(":")),se.className="jsoneditor-separator"),W.tdSeparator=se,document.createElement("td"));return se.className="jsoneditor-tree",re.appendChild(se),W.value=this._createDomValue(),se.appendChild(W.value),W.tdValue=se,K}},{key:"onEvent",value:function(W){var K,re=W.type,se=W.target||W.srcElement,me=this.dom,Y=this,ae=this._hasChilds(),ve=(se!==me.drag&&se!==me.menu||(re==="mouseover"?this.editor.highlighter.highlight(this):re==="mouseout"&&this.editor.highlighter.unhighlight()),re==="click"&&se===me.menu&&((K=Y.editor.highlighter).highlight(Y),K.lock(),(0,g.addClassName)(me.menu,"jsoneditor-selected"),this.showContextMenu(me.menu,function(){(0,g.removeClassName)(me.menu,"jsoneditor-selected"),K.unlock(),K.unhighlight()})),re==="click"&&se===me.expand&&ae&&(Fe=W.ctrlKey,this._onExpand(Fe)),re!=="click"||W.target!==Y.dom.tdColor&&W.target!==Y.dom.color||!this.editable.value||this._showColorPicker(),re==="change"&&se===me.checkbox&&(this.dom.value.textContent=String(!this.value),this._getDomValue(),this._updateDomDefault()),re==="change"&&se===me.select&&(this.dom.value.innerHTML=this._escapeHTML(me.select.value),this._getDomValue(),this._updateDomValue()),me.value);if(se===ve)switch(re){case"blur":case"change":this._getDomValue(),this._clearValueError(),this._updateDomValue();var ge=this._escapeHTML(this.value);ge!==this._unescapeHTML((0,g.getInnerText)(ve))&&(ve.innerHTML=ge);break;case"input":this._getDomValue(),this._updateDomValue();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getDomSelection();break;case"click":W.ctrlKey&&this.editable.value&&(0,g.isUrl)(this.value)&&(W.preventDefault(),window.open(this.value,"_blank","noreferrer"));break;case"keyup":this._getDomValue(),this._updateDomValue();break;case"cut":case"paste":setTimeout(function(){Y._getDomValue(),Y._updateDomValue()},1)}var Se=me.field;if(se===Se)switch(re){case"blur":this._getDomField(!0),this._updateDomField();var Ee=this._escapeHTML(this.field);Ee!==this._unescapeHTML((0,g.getInnerText)(Se))&&(Se.innerHTML=Ee);break;case"input":this._getDomField(),this._updateSchema(),this._updateDomField(),this._updateDomValue();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getDomSelection();break;case"keyup":this._getDomField(),this._updateDomField();break;case"cut":case"paste":setTimeout(function(){Y._getDomField(),Y._updateDomField()},1)}var Fe=me.tree;Fe&&se===Fe.parentNode&&re==="click"&&!W.hasMoved&&((W.offsetX!==void 0?W.offsetX<24*(this.getLevel()+1):W.pageX<(0,g.getAbsoluteLeft)(me.tdSeparator))||ae?Se&&((0,g.setEndOfContentEditable)(Se),Se.focus()):ve&&!this.enum&&((0,g.setEndOfContentEditable)(ve),ve.focus())),(se!==me.tdExpand||ae)&&se!==me.tdField&&se!==me.tdSeparator||re!=="click"||W.hasMoved||Se&&((0,g.setEndOfContentEditable)(Se),Se.focus()),re==="keydown"&&this.onKeyDown(W),typeof this.editor.options.onEvent=="function"&&this._onEvent(W)}},{key:"_onEvent",value:function(W){var re=W.target,K=re===this.dom.field,re=re===this.dom.value||re===this.dom.checkbox||re===this.dom.select;(K||re)&&(K={field:this.getField(),path:this.getPath()},re&&!this._hasChilds()&&(K.value=this.getValue()),this.editor.options.onEvent(K,W))}},{key:"onKeyDown",value:function(W){var K,re,se,me,Y,ae,ve,ge,Se,Ee,Fe,Ae,we,_e,Ke=W.which||W.keyCode,rt=W.target||W.srcElement,pt=W.ctrlKey,Ne=W.shiftKey,je=W.altKey,Ye=!1,mt=this.editor.options.mode==="tree",vt=0<this.editor.multiselection.nodes.length?this.editor.multiselection.nodes:[this],yt=vt[0],$e=vt[vt.length-1];Ke===13?rt===this.dom.value?this.editable.value&&!W.ctrlKey||(0,g.isUrl)(this.value)&&(window.open(this.value,"_blank","noreferrer"),Ye=!0):rt===this.dom.expand&&this._hasChilds()&&(we=W.ctrlKey,this._onExpand(we),rt.focus(),Ye=!0):Ke===68?pt&&mt&&(ee.onDuplicate(vt),Ye=!0):Ke===69?pt&&(this._onExpand(Ne),rt.focus(),Ye=!0):Ke===77&&mt?pt&&(this.showContextMenu(rt),Ye=!0):Ke===46&&mt?pt&&(ee.onRemove(vt),Ye=!0):Ke===45&&mt?pt&&!Ne?(this._onInsertBefore(),Ye=!0):pt&&Ne&&(this._onInsertAfter(),Ye=!0):Ke===35?je&&((we=this._lastNode())&&we.focus(ee.focusElement||this._getElementName(rt)),Ye=!0):Ke===36?je&&((we=this._firstNode())&&we.focus(ee.focusElement||this._getElementName(rt)),Ye=!0):Ke===37?je&&!Ne?((we=this._previousElement(rt))&&this.focus(this._getElementName(we)),Ye=!0):je&&Ne&&mt&&(we=$e.expanded?(we=$e.getAppendDom())?we.nextSibling:void 0:$e.getDom().nextSibling)&&(Fe=ee.getNodeFromTarget(we),we=we.nextSibling,Ae=ee.getNodeFromTarget(we),Fe)&&Fe instanceof N&&$e.parent.childs.length!==1&&Ae&&Ae.parent&&(re=this.editor.getDomSelection(),se=(me=yt.parent).childs[$e.getIndex()+1]||me.append,Y=yt.getIndex(),ae=Ae.getIndex(),ve=me.getInternalPath(),ge=Ae.parent.getInternalPath(),vt.forEach(function(be){Ae.parent.moveBefore(be,Ae)}),this.focus(ee.focusElement||this._getElementName(rt)),this.editor._onAction("moveNodes",{count:vt.length,fieldNames:vt.map(L),oldParentPath:me.getInternalPath(),newParentPath:yt.parent.getInternalPath(),oldIndex:se.getIndex(),newIndex:yt.getIndex(),oldIndexRedo:Y,newIndexRedo:ae,oldParentPathRedo:ve,newParentPathRedo:ge,oldSelection:re,newSelection:this.editor.getDomSelection()})):Ke===38?je&&!Ne?((K=this._previousNode())&&(this.editor.deselect(!0),K.focus(ee.focusElement||this._getElementName(rt))),Ye=!0):!je&&pt&&Ne&&mt?((K=this._previousNode())&&((Ee=this.editor.multiselection).start=Ee.start||this,Ee.end=K,Se=this.editor._findTopLevelNodes(Ee.start,Ee.end),this.editor.select(Se),K.focus("field")),Ye=!0):je&&Ne&&mt&&((K=yt._previousNode())&&K.parent&&(re=this.editor.getDomSelection(),se=(me=yt.parent).childs[$e.getIndex()+1]||me.append,Y=yt.getIndex(),ae=K.getIndex(),ve=me.getInternalPath(),ge=K.parent.getInternalPath(),vt.forEach(function(be){K.parent.moveBefore(be,K)}),this.focus(ee.focusElement||this._getElementName(rt)),this.editor._onAction("moveNodes",{count:vt.length,fieldNames:vt.map(L),oldParentPath:me.getInternalPath(),newParentPath:yt.parent.getInternalPath(),oldIndex:se.getIndex(),newIndex:yt.getIndex(),oldIndexRedo:Y,newIndexRedo:ae,oldParentPathRedo:ve,newParentPathRedo:ge,oldSelection:re,newSelection:this.editor.getDomSelection()})),Ye=!0):Ke===39?je&&!Ne?((we=this._nextElement(rt))&&this.focus(this._getElementName(we)),Ye=!0):je&&Ne&&mt&&(we=yt.getDom().previousSibling)&&(K=ee.getNodeFromTarget(we))&&K.parent&&!K.isVisible()&&(re=this.editor.getDomSelection(),se=(me=yt.parent).childs[$e.getIndex()+1]||me.append,Y=yt.getIndex(),ae=K.getIndex(),ve=me.getInternalPath(),ge=K.parent.getInternalPath(),vt.forEach(function(be){K.parent.moveBefore(be,K)}),this.focus(ee.focusElement||this._getElementName(rt)),this.editor._onAction("moveNodes",{count:vt.length,fieldNames:vt.map(L),oldParentPath:me.getInternalPath(),newParentPath:yt.parent.getInternalPath(),oldIndex:se.getIndex(),newIndex:yt.getIndex(),oldIndexRedo:Y,newIndexRedo:ae,oldParentPathRedo:ve,newParentPathRedo:ge,oldSelection:re,newSelection:this.editor.getDomSelection()})):Ke===40&&(je&&!Ne?((Fe=this._nextNode())&&(this.editor.deselect(!0),Fe.focus(ee.focusElement||this._getElementName(rt))),Ye=!0):!je&&pt&&Ne&&mt?((Fe=this._nextNode())&&((Ee=this.editor.multiselection).start=Ee.start||this,Ee.end=Fe,Se=this.editor._findTopLevelNodes(Ee.start,Ee.end),this.editor.select(Se),Fe.focus("field")),Ye=!0):je&&Ne&&mt&&((_e=(Fe=(Fe=(Fe=$e.expanded?$e.append?$e.append._nextNode():void 0:$e._nextNode())&&!Fe.isVisible()?Fe.parent.showMore:Fe)&&Fe instanceof N?$e:Fe)&&(Fe._nextNode()||Fe.parent.append))&&_e.parent&&(re=this.editor.getDomSelection(),se=(me=yt.parent).childs[$e.getIndex()+1]||me.append,Y=yt.getIndex(),ae=_e.getIndex(),ve=me.getInternalPath(),ge=_e.parent.getInternalPath(),vt.forEach(function(be){_e.parent.moveBefore(be,_e)}),this.focus(ee.focusElement||this._getElementName(rt)),this.editor._onAction("moveNodes",{count:vt.length,fieldNames:vt.map(L),oldParentPath:me.getInternalPath(),newParentPath:yt.parent.getInternalPath(),oldParentPathRedo:ve,newParentPathRedo:ge,oldIndexRedo:Y,newIndexRedo:ae,oldIndex:se.getIndex(),newIndex:yt.getIndex(),oldSelection:re,newSelection:this.editor.getDomSelection()})),Ye=!0)),Ye&&(W.preventDefault(),W.stopPropagation())}},{key:"_onExpand",value:function(W){var K,re,se;W&&(se=(re=(K=this.dom.tr.parentNode).parentNode).scrollTop,re.removeChild(K)),this.expanded?this.collapse(W):this.expand(W),W&&(re.appendChild(K),re.scrollTop=se),typeof this.editor.options.onExpand=="function"&&this.editor.options.onExpand({path:this.getPath(),isExpand:this.expanded,recursive:W})}},{key:"_showColorPicker",value:function(){var W,K;typeof this.editor.options.onColorPicker=="function"&&this.dom.color&&((W=this)._deleteDomColor(),W.updateDom(),K=(0,C.p)(this.dom.color,this.editor.getPopupAnchor()),this.editor.options.onColorPicker(K,this.value,function(re){typeof re=="string"&&re!==W.value&&(W._deleteDomColor(),W.value=re,W.updateDom(),W._debouncedOnChangeValue())}))}},{key:"getFieldNames",value:function(W){return this.type==="object"?this.childs.filter(function(K){return K!==W}).map(function(K){return K.field}):[]}},{key:"_onInsertBefore",value:function(me,Y,ae){var se=this.editor.getDomSelection(),me=new ee(this.editor,{field:me!==void 0?me:"",value:Y!==void 0?Y:"",type:ae}),Y=(me.expand(!0),this.getInternalPath()),ae=(this.parent.insertBefore(me,this),this.editor.highlighter.unhighlight(),me.focus("field"),this.editor.getDomSelection());this.editor._onAction("insertBeforeNodes",{nodes:[me],paths:[me.getInternalPath()],beforePath:Y,parentPath:this.parent.getInternalPath(),oldSelection:se,newSelection:ae})}},{key:"_onInsertAfter",value:function(me,Y,re){var se=this.editor.getDomSelection(),me=new ee(this.editor,{field:me!==void 0?me:"",value:Y!==void 0?Y:"",type:re}),Y=(me.expand(!0),this.parent.insertAfter(me,this),this.editor.highlighter.unhighlight(),me.focus("field"),this.editor.getDomSelection());this.editor._onAction("insertAfterNodes",{nodes:[me],paths:[me.getInternalPath()],afterPath:this.getInternalPath(),parentPath:this.parent.getInternalPath(),oldSelection:se,newSelection:Y})}},{key:"_onAppend",value:function(me,Y,re){var se=this.editor.getDomSelection(),me=new ee(this.editor,{field:me!==void 0?me:"",value:Y!==void 0?Y:"",type:re}),Y=(me.expand(!0),this.parent.appendChild(me),this.editor.highlighter.unhighlight(),me.focus("field"),this.editor.getDomSelection());this.editor._onAction("appendNodes",{nodes:[me],paths:[me.getInternalPath()],parentPath:this.parent.getInternalPath(),oldSelection:se,newSelection:Y})}},{key:"_onChangeType",value:function(W){var K,re,se=this.type;W!==se&&(K=this.editor.getDomSelection(),this.changeType(W),re=this.editor.getDomSelection(),this.editor._onAction("changeType",{path:this.getInternalPath(),oldType:se,newType:W,oldSelection:K,newSelection:re}))}},{key:"sort",value:function(W,K){var re,se,me=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2];typeof W=="string"&&(W=(0,g.parsePath)(W)),this._hasChilds()&&(this.hideChilds(),re=this.childs,this.childs=this.childs.concat(),se=K==="desc"?-1:1,this.type==="object"?this.childs.sort(function(Y,ae){return se*f()(Y.field,ae.field)}):this.childs.sort(function(ve,ge){var ve=ve.getNestedChild(W),ge=ge.getNestedChild(W);return ve?ge?(ve=ve.value,ge=ge.value,typeof ve!="string"&&typeof ge!="string"?ge<ve?se:ve<ge?-se:0:se*f()(ve,ge)):-se:se}),this._updateDomIndexes(),this.showChilds(),me===!0)&&this.editor._onAction("sort",{path:this.getInternalPath(),oldChilds:re,newChilds:this.childs})}},{key:"update",value:function(W){var K=this.getInternalValue();this.setValue(W),this.editor._onAction("transform",{path:this.getInternalPath(),oldValue:K,newValue:this.getInternalValue()})}},{key:"_detachFromDom",value:function(){var W=this.dom.tr?this.dom.tr.parentNode:void 0,K=this.expanded?this.getAppendDom():this.getDom(),K=K&&K.parentNode?K.nextSibling:void 0;return this.hide({resetVisibleChilds:!1}),{table:W,nextTr:K}}},{key:"_attachToDom",value:function(W){W.table&&(W.nextTr?W.table.insertBefore(this.getDom(),W.nextTr):W.table.appendChild(this.getDom())),this.expanded&&this.showChilds()}},{key:"transform",value:function(W){if(this._hasChilds()){this.hideChilds();try{var K=this.getInternalValue(),re=this.getValue(),se=this.editor.options.executeQuery(re,W),me=(this.setValue(se),this.getInternalValue());this.editor._onAction("transform",{path:this.getInternalPath(),oldValue:K,newValue:me}),this.showChilds()}catch(Y){this.showChilds(),this.editor._onError(Y)}}}},{key:"extract",value:function(){this.editor.node.hideChilds(),this.hideChilds();try{var W=this.editor.node.getInternalValue(),K=(this.editor._setRoot(this),this.editor.node.getInternalValue());this.editor._onAction("transform",{path:this.editor.node.getInternalPath(),oldValue:W,newValue:K})}catch(re){this.editor._onError(re)}finally{this.updateDom({recurse:!0}),this.showChilds()}}},{key:"getNestedChild",value:function(W){for(var K=0,re=this;re&&K<W.length;)re=re.findChildByProperty(W[K]),K++;return re}},{key:"findChildByProperty",value:function(W){if(this.type==="object")return this.childs.find(function(K){return K.field===W})}},{key:"getAppendDom",value:function(){return this.append||(this.append=new N(this.editor),this.append.setParent(this)),this.append.getDom()}},{key:"getShowMoreDom",value:function(){return this.showMore||(this.showMore=new H(this.editor,this)),this.showMore.getDom()}},{key:"nextSibling",value:function(){var W=this.parent.childs.indexOf(this);return this.parent.childs[W+1]||this.parent.append}},{key:"_previousNode",value:function(){var W=null,K=this.getDom();if(K&&K.parentNode)for(var re=K;re=re.previousSibling,W=ee.getNodeFromTarget(re),re&&W&&W instanceof N&&!W.isVisible(););return W}},{key:"_nextNode",value:function(){var W=null,K=this.getDom();if(K&&K.parentNode)for(var re=K;re=re.nextSibling,W=ee.getNodeFromTarget(re),re&&W&&W instanceof N&&!W.isVisible(););return W}},{key:"_firstNode",value:function(){var W=null,K=this.getDom();return K&&K.parentNode&&(K=K.parentNode.firstChild,W=ee.getNodeFromTarget(K)),W}},{key:"_lastNode",value:function(){var W=null,K=this.getDom();if(K&&K.parentNode)for(var re=K.parentNode.lastChild,W=ee.getNodeFromTarget(re);re&&W&&!W.isVisible();)re=re.previousSibling,W=ee.getNodeFromTarget(re);return W}},{key:"_previousElement",value:function(W){var K=this.dom;switch(W){case K.value:if(this.fieldEditable)return K.field;case K.field:if(this._hasChilds())return K.expand;case K.expand:return K.menu;case K.menu:if(K.drag)return K.drag;default:return null}}},{key:"_nextElement",value:function(W){var K=this.dom;switch(W){case K.drag:return K.menu;case K.menu:if(this._hasChilds())return K.expand;case K.expand:if(this.fieldEditable)return K.field;case K.field:if(!this._hasChilds())return K.value;default:return null}}},{key:"_getElementName",value:function(W){var K=this;return Object.keys(this.dom).find(function(re){return K.dom[re]===W})}},{key:"_hasChilds",value:function(){return this.type==="array"||this.type==="object"}},{key:"addTemplates",value:function(W,K){var re=this,se=re.editor.options.templates;se!=null&&(se.length&&W.push({type:"separator"}),se.forEach(function(me){W.push({text:me.text,className:me.className||"jsoneditor-type-object",title:me.title,click:(K?function(Y,ae){re._onAppend(Y,ae)}:function(Y,ae){re._onInsertBefore(Y,ae)}).bind(this,me.field,me.value)})}))}},{key:"showContextMenu",value:function(W,K){var re,se=this,me=[];this.editable.value&&me.push({text:(0,m.Tl)("type"),title:(0,m.Tl)("typeTitle"),className:"jsoneditor-type-"+this.type,submenu:[{text:(0,m.Tl)("auto"),className:"jsoneditor-type-auto"+(this.type==="auto"?" jsoneditor-selected":""),title:(0,m.Tl)("autoType"),click:function(){se._onChangeType("auto")}},{text:(0,m.Tl)("array"),className:"jsoneditor-type-array"+(this.type==="array"?" jsoneditor-selected":""),title:(0,m.Tl)("arrayType"),click:function(){se._onChangeType("array")}},{text:(0,m.Tl)("object"),className:"jsoneditor-type-object"+(this.type==="object"?" jsoneditor-selected":""),title:(0,m.Tl)("objectType"),click:function(){se._onChangeType("object")}},{text:(0,m.Tl)("string"),className:"jsoneditor-type-string"+(this.type==="string"?" jsoneditor-selected":""),title:(0,m.Tl)("stringType"),click:function(){se._onChangeType("string")}}]}),this._hasChilds()&&(this.editor.options.enableSort&&me.push({text:(0,m.Tl)("sort"),title:(0,m.Tl)("sortTitle",{type:this.type}),className:"jsoneditor-sort-asc",click:function(){se.showSortModal()}}),this.editor.options.enableTransform&&me.push({text:(0,m.Tl)("transform"),title:(0,m.Tl)("transformTitle",{type:this.type}),className:"jsoneditor-transform",click:function(){se.showTransformModal()}}),this.parent)&&me.push({text:(0,m.Tl)("extract"),title:(0,m.Tl)("extractTitle",{type:this.type}),className:"jsoneditor-extract",click:function(){se.extract()}}),this.parent&&this.parent._hasChilds()&&(me.length&&me.push({type:"separator"}),re=se.parent.childs,se===re[re.length-1]&&(re=[{text:(0,m.Tl)("auto"),className:"jsoneditor-type-auto",title:(0,m.Tl)("autoType"),click:function(){se._onAppend("","","auto")}},{text:(0,m.Tl)("array"),className:"jsoneditor-type-array",title:(0,m.Tl)("arrayType"),click:function(){se._onAppend("",[])}},{text:(0,m.Tl)("object"),className:"jsoneditor-type-object",title:(0,m.Tl)("objectType"),click:function(){se._onAppend("",{})}},{text:(0,m.Tl)("string"),className:"jsoneditor-type-string",title:(0,m.Tl)("stringType"),click:function(){se._onAppend("","","string")}}],se.addTemplates(re,!0),me.push({text:(0,m.Tl)("appendText"),title:(0,m.Tl)("appendTitle"),submenuTitle:(0,m.Tl)("appendSubmenuTitle"),className:"jsoneditor-append",click:function(){se._onAppend("","","auto")},submenu:re})),re=[{text:(0,m.Tl)("auto"),className:"jsoneditor-type-auto",title:(0,m.Tl)("autoType"),click:function(){se._onInsertBefore("","","auto")}},{text:(0,m.Tl)("array"),className:"jsoneditor-type-array",title:(0,m.Tl)("arrayType"),click:function(){se._onInsertBefore("",[])}},{text:(0,m.Tl)("object"),className:"jsoneditor-type-object",title:(0,m.Tl)("objectType"),click:function(){se._onInsertBefore("",{})}},{text:(0,m.Tl)("string"),className:"jsoneditor-type-string",title:(0,m.Tl)("stringType"),click:function(){se._onInsertBefore("","","string")}}],se.addTemplates(re,!1),me.push({text:(0,m.Tl)("insert"),title:(0,m.Tl)("insertTitle"),submenuTitle:(0,m.Tl)("insertSub"),className:"jsoneditor-insert",click:function(){se._onInsertBefore("","","auto")},submenu:re}),this.editable.field)&&(me.push({text:(0,m.Tl)("duplicateText"),title:(0,m.Tl)("duplicateField"),className:"jsoneditor-duplicate",click:function(){ee.onDuplicate(se)}}),me.push({text:(0,m.Tl)("removeText"),title:(0,m.Tl)("removeField"),className:"jsoneditor-remove",click:function(){ee.onRemove(se)}})),this.editor.options.onCreateMenu&&(re=se.getPath(),me=this.editor.options.onCreateMenu(me,{type:"single",path:re,paths:[re]})),new a.t(me,{close:K}).show(W,this.editor.getPopupAnchor())}},{key:"showSortModal",value:function(){var W=this,K=this.editor.options.modalAnchor||x.ai,re=this.getValue();(0,b.showSortModal)(K,re,function(se){var me=se.path,me=(0,g.parsePath)(me);W.sortedBy=se,W.sort(me,se.direction)},W.sortedBy)}},{key:"showTransformModal",value:function(){var W=this,me=this.editor.options,K=me.modalAnchor,re=me.createQuery,se=me.executeQuery,me=me.queryDescription,Y=this.getValue();(0,y.showTransformModal)({container:K||x.ai,json:Y,queryDescription:me,createQuery:re,executeQuery:se,onTransform:function(ae){W.transform(ae)}})}},{key:"_getType",value:function(W){return W instanceof Array?"array":W instanceof Object?"object":typeof W=="string"&&typeof(0,g.parseString)(W)!="string"?"string":"auto"}},{key:"_escapeHTML",value:function(W){return typeof W!="string"?String(W):(W=String(W).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ {2}/g," &nbsp;").replace(/^ /,"&nbsp;").replace(/ $/,"&nbsp;"),W=(W=JSON.stringify(W)).substring(1,W.length-1),this.editor.options.escapeUnicode===!0?(0,g.escapeUnicodeChars)(W):W)}},{key:"_unescapeHTML",value:function(W){return W='"'+this._escapeJSON(W)+'"',(0,g.parse)(W).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;|\u00A0/g," ").replace(/&amp;/g,"&")}},{key:"_escapeJSON",value:function(W){for(var K="",re=0;re<W.length;){var se=W.charAt(re);se===`
`?K+="\\n":se==="\\"?(K+=se,re++,(se=W.charAt(re))!==""&&'"\\/bfnrtu'.indexOf(se)!==-1||(K+="\\"),K+=se):K+=se==='"'?'\\"':se,re++}return K}},{key:"updateNodeName",value:function(){var W=this.childs?this.childs.length:0;if(this.type==="object"||this.type==="array"){if(this.editor.options.onNodeName)try{var K=this.getValue.bind(this),re=this.editor.options.onNodeName({path:this.getPath(),size:W,type:this.type,get value(){return K()}})}catch{}this.dom.value.textContent=this.type==="object"?"{"+(re||W)+"}":"["+(re||W)+"]"}}},{key:"recursivelyUpdateNodeName",value:function(){if(this.expanded&&(this.updateNodeName(),this.childs!=="undefined"))for(var W in this.childs)this.childs[W].recursivelyUpdateNodeName()}}])&&w(oe.prototype,te),X&&w(oe,X),Object.defineProperty(oe,"prototype",{writable:!1}),oe;var oe,te,X}(),P=(S.prototype.DEBOUNCE_INTERVAL=150,S.prototype.MAX_SEARCH_RESULTS=999,100);function k(ee){return ee.getInternalPath()}function L(ee){return ee.getField()}function R(ee,oe){return Object.prototype.hasOwnProperty.call(ee,oe)}S.focusElement=void 0,S.select=function(ee){setTimeout(function(){(0,g.selectContentEditable)(ee)},0)},S.onDragStart=function(ee,oe){if(!Array.isArray(ee))return S.onDragStart([ee],oe);var te,X,W,K,re;ee.length!==0&&(te=ee[0],X=ee[ee.length-1],W=te.parent,re=S.getNodeFromTarget(oe.target),K=te.editor,re=(0,g.getAbsoluteTop)(re.dom.tr)-(0,g.getAbsoluteTop)(te.dom.tr),K.mousemove||(K.mousemove=(0,g.addEventListener)(oe.view,"mousemove",function(se){S.onDrag(ee,se)})),K.mouseup||(K.mouseup=(0,g.addEventListener)(oe.view,"mouseup",function(se){S.onDragEnd(ee,se)})),K.highlighter.lock(),K.drag={oldCursor:document.body.style.cursor,oldSelection:K.getDomSelection(),oldPaths:ee.map(k),oldParent:W,oldNextNode:W.childs[X.getIndex()+1]||W.append,oldParentPathRedo:W.getInternalPath(),oldIndexRedo:te.getIndex(),mouseX:oe.pageX,offsetY:re,level:te.getLevel()},document.body.style.cursor="move",oe.preventDefault())},S.onDrag=function(ee,oe){if(!Array.isArray(ee))return S.onDrag([ee],oe);if(ee.length!==0){var te,X,W,K,re,se=ee[0].editor,me=oe.pageY-se.drag.offsetY,Y=oe.pageX,ae=!1,ve=ee[0],ge=ve.dom.tr,Se=(0,g.getAbsoluteTop)(ge),Ee=ge.offsetHeight;if(me<Se){for(_e=ge;_e=_e.previousSibling,Ke=S.getNodeFromTarget(_e),W=_e?(0,g.getAbsoluteTop)(_e):0,_e&&me<W;);(Ke=Ke&&!Ke.parent?void 0:Ke)||(_e=(ge=ge.parentNode.firstChild)?ge.nextSibling:void 0,(Ke=S.getNodeFromTarget(_e))===ve&&(Ke=void 0)),!(Ke=Ke&&Ke.isVisible()&&(W=(_e=Ke.dom.tr)?(0,g.getAbsoluteTop)(_e):0)+Ee<me?void 0:Ke)||se.options.limitDragging!==!1&&Ke.parent!==ee[0].parent||(ee.forEach(function(pt){Ke.parent.moveBefore(pt,Ke)}),ae=!0)}else{var Fe=ee[ee.length-1];if(Ee=(ge=Fe.expanded&&Fe.append?Fe.append.getDom():Fe.dom.tr)?ge.nextSibling:void 0){for(K=(0,g.getAbsoluteTop)(Ee),te=Ee;X=S.getNodeFromTarget(te),te&&(re=te.nextSibling?(0,g.getAbsoluteTop)(te.nextSibling):0,re=te?re-K:0,X&&X.parent.childs.length===ee.length&&X.parent.childs[ee.length-1]===Fe&&(Se+=27),te=te.nextSibling),te&&Se+re<me;);if(X&&X.parent){for(var Ee=Y-se.drag.mouseX,Ee=Math.round(Ee/24/2),Ae=se.drag.level+Ee,we=X.getLevel(),_e=X.dom.tr&&X.dom.tr.previousSibling;we<Ae&&_e;){var Ke=S.getNodeFromTarget(_e),rt=ee.some(function(Ne){return Ne===Ke||Ke.isDescendantOf(Ne)});if(!rt){if(!(Ke instanceof N)||(rt=Ke.parent.childs,rt.length===ee.length&&rt[ee.length-1]===Fe))break;we=(X=S.getNodeFromTarget(_e)).getLevel()}_e=_e.previousSibling}(X=X instanceof N&&!X.isVisible()&&X.parent.showMore.isVisible()?X._nextNode():X)&&(se.options.limitDragging===!1||X.parent===ee[0].parent)&&X.dom.tr&&X.dom.tr!==ge.nextSibling&&(ee.forEach(function(pt){X.parent.moveBefore(pt,X)}),ae=!0)}}}ae&&(se.drag.mouseX=Y,se.drag.level=ve.getLevel()),se.startAutoScroll(me),oe.preventDefault()}},S.onDragEnd=function(ee,oe){if(!Array.isArray(ee))return S.onDrag([ee],oe);var te,X,W,K,re,se,me,Y,ae;ee.length!==0&&(se=ee[0],te=se.editor,se&&se.dom.menu&&se.dom.menu.focus(),X=te.drag.oldParent.getInternalPath(),W=se.parent.getInternalPath(),K=te.drag.oldParent===se.parent,re=te.drag.oldNextNode.getIndex(),se=se.getIndex(),me=te.drag.oldParentPathRedo,Y=te.drag.oldIndexRedo,ae=K&&Y<se?se+ee.length:se,K&&Y===se||te._onAction("moveNodes",{count:ee.length,fieldNames:ee.map(L),oldParentPath:X,newParentPath:W,oldIndex:re,newIndex:se,oldIndexRedo:Y,newIndexRedo:ae,oldParentPathRedo:me,newParentPathRedo:null,oldSelection:te.drag.oldSelection,newSelection:te.getDomSelection()}),document.body.style.cursor=te.drag.oldCursor,te.highlighter.unlock(),ee.forEach(function(ve){ve.updateDom(),oe.target!==ve.dom.drag&&oe.target!==ve.dom.menu&&te.highlighter.unhighlight()}),delete te.drag,te.mousemove&&((0,g.removeEventListener)(oe.view,"mousemove",te.mousemove),delete te.mousemove),te.mouseup&&((0,g.removeEventListener)(oe.view,"mouseup",te.mouseup),delete te.mouseup),te.stopAutoScroll(),oe.preventDefault())},S._findEnum=function(ee){return ee.enum?ee.enum:(ee=ee.oneOf||ee.anyOf||ee.allOf,ee&&(ee=ee.filter(function(oe){return oe.enum}),0<ee.length)?ee[0].enum:null)},S._findSchema=function(ee,oe,te){for(var X=3<arguments.length&&arguments[3]!==void 0?arguments[3]:ee,W=te.slice(1,te.length),K=te[0],re=[X],se=0,me=[X.oneOf,X.anyOf,X.allOf];se<me.length;se++){var Y=me[se];Array.isArray(Y)&&(re=re.concat(Y))}var ae,ve=_(re);try{for(ve.s();!(ae=ve.n()).done;){if("$ref"in(X=ae.value)&&typeof X.$ref=="string"){var ge,Se=X.$ref;if(Se in oe)X=oe[Se];else{if(!Se.startsWith("#/")){if(((ge=Se.match(/#\//g))==null?void 0:ge.length)===1){var Ee,Fe,Ae,we=v(Se.split("#/"),2),_e=we[0],Ke=we[1];if(_e in oe)return Ee=oe[_e],Fe={$ref:"#/".concat(Ke)},(Ae=[]).push(K),0<W.length&&Ae.push.apply(Ae,A(W)),S._findSchema(Ee,oe,Ae,Fe)}throw Error("Unable to resolve reference ".concat(Se))}var rt,pt=Se.substring(2).split("/"),X=ee,Ne=_(pt);try{for(Ne.s();!(rt=Ne.n()).done;){var je=rt.value;if(!(je in X))throw Error("Unable to resolve reference ".concat(Se));X=X[je]}}catch(vt){Ne.e(vt)}finally{Ne.f()}}}if(K===void 0)return X;if(typeof K=="string"){if(E(X.properties)==="object"&&X.properties!==null&&K in X.properties)return X=X.properties[K],S._findSchema(ee,oe,W,X);if(E(X.patternProperties)==="object"&&X.patternProperties!==null){for(var Ye in X.patternProperties)if(K.match(Ye))return X=X.patternProperties[Ye],S._findSchema(ee,oe,W,X)}if(E(X.additionalProperties)==="object")return X=X.additionalProperties,S._findSchema(ee,oe,W,X)}else if(typeof K=="number"&&E(X.items)==="object"&&X.items!==null)return X=X.items,S._findSchema(ee,oe,W,X)}}catch(mt){ve.e(mt)}finally{ve.f()}return null},S.onRemove=function(ee){if(!Array.isArray(ee))return S.onRemove([ee]);var oe,te,X,W,K,re;ee&&0<ee.length&&(oe=(X=ee[0]).parent,te=X.editor,X=X.getIndex(),te.highlighter.unhighlight(),W=te.getDomSelection(),S.blurNodes(ee),K=te.getDomSelection(),re=ee.map(k),ee.forEach(function(se){se.parent._remove(se)}),te._onAction("removeNodes",{nodes:ee,paths:re,parentPath:oe.getInternalPath(),index:X,oldSelection:W,newSelection:K}))},S.onDuplicate=function(ee){if(!Array.isArray(ee))return S.onDuplicate([ee]);var oe,te,X,W,K,re,se;ee&&0<ee.length&&(oe=ee[ee.length-1],te=oe.parent,(X=oe.editor).deselect(X.multiselection.nodes),W=X.getDomSelection(),K=oe,re=ee.map(function(me){var Y,ae=me.clone();return me.parent.type==="object"&&(Y=me.parent.getFieldNames(),ae.field=(0,g.findUniqueName)(me.field,Y)),te.insertAfter(ae,K),K=ae}),ee.length===1?re[0].parent.type==="object"?(re[0].dom.field.innerHTML=ee[0]._escapeHTML(ee[0].field),re[0].focus("field")):re[0].focus():X.select(re),se=X.getDomSelection(),X._onAction("duplicateNodes",{paths:ee.map(k),clonePaths:re.map(k),afterPath:oe.getInternalPath(),parentPath:te.getInternalPath(),oldSelection:W,newSelection:se}))},S.getNodeFromTarget=function(ee){for(;ee;){if(ee.node)return ee.node;ee=ee.parentNode}},S.targetIsColorPicker=function(ee){var oe=S.getNodeFromTarget(ee);if(oe)for(var te=ee&&ee.parentNode;te;){if(te===oe.dom.color)return!0;te=te.parentNode}return!1},S.blurNodes=function(ee){var oe,te;Array.isArray(ee)?(oe=(te=ee[0]).parent,te=te.getIndex(),(oe.childs[te+ee.length]?oe.childs[te+ee.length]:oe.childs[te-1]||oe).focus()):S.blurNodes([ee])},(F.prototype=new S).getDom=function(){var ee=this.dom;if(ee.tr)return ee.tr;this._updateEditability();var oe=document.createElement("tr"),te=(oe.className="jsoneditor-append",oe.node=this,ee.tr=oe,this.editor.options.mode==="tree"&&(ee.tdDrag=document.createElement("td"),X=document.createElement("td"),ee.tdMenu=X,(te=document.createElement("button")).type="button",te.className="jsoneditor-button jsoneditor-contextmenu-button",te.title="Click to open the actions menu (Ctrl+M)",ee.menu=te,X.appendChild(ee.menu)),document.createElement("td")),X=document.createElement("div");return X.appendChild(document.createTextNode("("+(0,m.Tl)("empty")+")")),X.className="jsoneditor-readonly",te.appendChild(X),ee.td=te,ee.text=X,this.updateDom(),oe},F.prototype.getPath=function(){return null},F.prototype.getIndex=function(){return null},F.prototype.updateDom=function(ee){var oe=this.dom,te=oe.td,X=(te&&(te.style.paddingLeft=24*this.getLevel()+26+"px"),oe.text),X=(X&&(X.firstChild.nodeValue="("+(0,m.Tl)("empty")+" "+this.parent.type+")"),oe.tr);this.isVisible()?oe.tr.firstChild||(oe.tdDrag&&X.appendChild(oe.tdDrag),oe.tdMenu&&X.appendChild(oe.tdMenu),X.appendChild(te)):oe.tr.firstChild&&(oe.tdDrag&&X.removeChild(oe.tdDrag),oe.tdMenu&&X.removeChild(oe.tdMenu),X.removeChild(te))},F.prototype.isVisible=function(){return this.parent.childs.length===0},F.prototype.showContextMenu=function(ee,oe){var te,X=this,W=[{text:(0,m.Tl)("auto"),className:"jsoneditor-type-auto",title:(0,m.Tl)("autoType"),click:function(){X._onAppend("","","auto")}},{text:(0,m.Tl)("array"),className:"jsoneditor-type-array",title:(0,m.Tl)("arrayType"),click:function(){X._onAppend("",[])}},{text:(0,m.Tl)("object"),className:"jsoneditor-type-object",title:(0,m.Tl)("objectType"),click:function(){X._onAppend("",{})}},{text:(0,m.Tl)("string"),className:"jsoneditor-type-string",title:(0,m.Tl)("stringType"),click:function(){X._onAppend("","","string")}}],W=(X.addTemplates(W,!0),[{text:(0,m.Tl)("appendText"),title:(0,m.Tl)("appendTitleAuto"),submenuTitle:(0,m.Tl)("appendSubmenuTitle"),className:"jsoneditor-insert",click:function(){X._onAppend("","","auto")},submenu:W}]);this.editor.options.onCreateMenu&&(te=X.parent.getPath(),W=this.editor.options.onCreateMenu(W,{type:"append",path:te,paths:[te]})),new a.t(W,{close:oe}).show(ee,this.editor.getPopupAnchor())},F.prototype.onEvent=function(ee){var oe,te=ee.type,X=ee.target||ee.srcElement,W=this.dom;X===W.menu&&(te==="mouseover"?this.editor.highlighter.highlight(this.parent):te==="mouseout"&&this.editor.highlighter.unhighlight()),te==="click"&&X===W.menu&&((oe=this.editor.highlighter).highlight(this.parent),oe.lock(),(0,g.addClassName)(W.menu,"jsoneditor-selected"),this.showContextMenu(W.menu,function(){(0,g.removeClassName)(W.menu,"jsoneditor-selected"),oe.unlock(),oe.unhighlight()})),te==="keydown"&&this.onKeyDown(ee)};var N=F;function F(ee){this.editor=ee,this.dom={}}(V.prototype=new S).getDom=function(){var ee,oe,te,X,W,K;return this.dom.tr||(this._updateEditability(),this.dom.tr||(oe=(ee=this).parent,(W=document.createElement("a")).appendChild(document.createTextNode((0,m.Tl)("showMore"))),W.href="#",W.onclick=function(re){return oe.visibleChilds=Math.floor(oe.visibleChilds/oe.getMaxVisibleChilds()+1)*oe.getMaxVisibleChilds(),ee.updateDom(),oe.showChilds(),re.preventDefault(),!1},(K=document.createElement("a")).appendChild(document.createTextNode((0,m.Tl)("showAll"))),K.href="#",K.onclick=function(re){return oe.visibleChilds=1/0,ee.updateDom(),oe.showChilds(),re.preventDefault(),!1},te=document.createElement("div"),X=document.createTextNode(this._getShowMoreText()),te.className="jsoneditor-show-more",te.appendChild(X),te.appendChild(W),te.appendChild(document.createTextNode(". ")),te.appendChild(K),te.appendChild(document.createTextNode(". ")),(W=document.createElement("td")).appendChild(te),K=document.createElement("tr"),this.editor.options.mode==="tree"&&(K.appendChild(document.createElement("td")),K.appendChild(document.createElement("td"))),K.appendChild(W),K.className="jsoneditor-show-more",this.dom.tr=K,this.dom.moreContents=te,this.dom.moreText=X),this.updateDom()),this.dom.tr},V.prototype.updateDom=function(ee){var oe;this.isVisible()?(this.dom.tr.node=this.parent.childs[this.parent.visibleChilds],this.dom.tr.parentNode||(oe=this.parent._getNextTr())&&oe.parentNode.insertBefore(this.dom.tr,oe),this.dom.moreText.nodeValue=this._getShowMoreText(),this.dom.moreContents.style.marginLeft=24*(this.getLevel()+1)+"px"):this.dom.tr&&this.dom.tr.parentNode&&this.dom.tr.parentNode.removeChild(this.dom.tr)},V.prototype._getShowMoreText=function(){return(0,m.Tl)("showMoreStatus",{visibleChilds:this.parent.visibleChilds,totalChilds:this.parent.childs.length})+" "},V.prototype.isVisible=function(){return this.parent.expanded&&this.parent.childs.length>this.parent.visibleChilds},V.prototype.onEvent=function(ee){ee.type==="keydown"&&this.onKeyDown(ee)};var H=V;function V(ee,oe){this.editor=ee,this.parent=oe,this.dom={}}function q(ee){return(q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe})(ee)}function Q(ee,oe){for(var te=0;te<oe.length;te++){var X=oe[te];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(ee,function(W){return W=function(K,re){if(q(K)!="object"||!K)return K;var se=K[Symbol.toPrimitive];if(se===void 0)return(re==="string"?String:Number)(K);if(se=se.call(K,re||"default"),q(se)!="object")return se;throw new TypeError("@@toPrimitive must return a primitive value.")}(W,"string"),q(W)=="symbol"?W:W+""}(X.key),X)}}var O=function(){function ee(W){if(!(this instanceof ee))throw new TypeError("Cannot call a class as a function");function K(re){return W.node.findNodeByInternalPath(re)}this.editor=W,this.history=[],this.index=-1,this.clear(),this.actions={editField:{undo:function(re){K(re.parentPath).childs[re.index].updateField(re.oldValue)},redo:function(re){K(re.parentPath).childs[re.index].updateField(re.newValue)}},editValue:{undo:function(re){K(re.path).updateValue(re.oldValue)},redo:function(re){K(re.path).updateValue(re.newValue)}},changeType:{undo:function(re){K(re.path).changeType(re.oldType)},redo:function(re){K(re.path).changeType(re.newType)}},appendNodes:{undo:function(re){var se=K(re.parentPath);re.paths.map(K).forEach(function(me){se.removeChild(me)})},redo:function(re){var se=K(re.parentPath);re.nodes.forEach(function(me){se.appendChild(me)})}},insertBeforeNodes:{undo:function(re){var se=K(re.parentPath);re.paths.map(K).forEach(function(me){se.removeChild(me)})},redo:function(re){var se=K(re.parentPath),me=K(re.beforePath);re.nodes.forEach(function(Y){se.insertBefore(Y,me)})}},insertAfterNodes:{undo:function(re){var se=K(re.parentPath);re.paths.map(K).forEach(function(me){se.removeChild(me)})},redo:function(re){var se=K(re.parentPath),me=K(re.afterPath);re.nodes.forEach(function(Y){se.insertAfter(Y,me),me=Y})}},removeNodes:{undo:function(re){var se=K(re.parentPath),me=se.childs[re.index]||se.append;re.nodes.forEach(function(Y){se.insertBefore(Y,me)})},redo:function(re){var se=K(re.parentPath);re.paths.map(K).forEach(function(me){se.removeChild(me)})}},duplicateNodes:{undo:function(re){var se=K(re.parentPath);re.clonePaths.map(K).forEach(function(me){se.removeChild(me)})},redo:function(re){var se=K(re.parentPath),me=K(re.afterPath);re.paths.map(K).forEach(function(Y){var ae,ve=Y.clone();se.type==="object"&&(ae=se.getFieldNames(),ve.field=(0,g.findUniqueName)(Y.field,ae)),se.insertAfter(ve,me),me=ve})}},moveNodes:{undo:function(re){var se=K(re.oldParentPath),me=K(re.newParentPath),Y=se.childs[re.oldIndex]||se.append;me.childs.slice(re.newIndex,re.newIndex+re.count).forEach(function(ae,ve){ae.field=re.fieldNames[ve],se.moveBefore(ae,Y)}),re.newParentPathRedo===null&&(re.newParentPathRedo=me.getInternalPath())},redo:function(re){var se=K(re.oldParentPathRedo),me=K(re.newParentPathRedo),Y=me.childs[re.newIndexRedo]||me.append;se.childs.slice(re.oldIndexRedo,re.oldIndexRedo+re.count).forEach(function(ae,ve){ae.field=re.fieldNames[ve],me.moveBefore(ae,Y)})}},sort:{undo:function(re){var se=K(re.path);se.hideChilds(),se.childs=re.oldChilds,se.updateDom({updateIndexes:!0}),se.showChilds()},redo:function(re){var se=K(re.path);se.hideChilds(),se.childs=re.newChilds,se.updateDom({updateIndexes:!0}),se.showChilds()}},transform:{undo:function(re){K(re.path).setInternalValue(re.oldValue)},redo:function(re){K(re.path).setInternalValue(re.newValue)}}}}return oe=ee,(te=[{key:"onChange",value:function(){}},{key:"add",value:function(W,K){this.index++,this.history[this.index]={action:W,params:K,timestamp:new Date},this.index<this.history.length-1&&this.history.splice(this.index+1,this.history.length-this.index-1),this.onChange()}},{key:"clear",value:function(){this.history=[],this.index=-1,this.onChange()}},{key:"canUndo",value:function(){return 0<=this.index}},{key:"canRedo",value:function(){return this.index<this.history.length-1}},{key:"undo",value:function(){if(this.canUndo()){var W=this.history[this.index];if(W){var K=this.actions[W.action];if(K&&K.undo&&(K.undo(W.params),W.params.oldSelection))try{this.editor.setDomSelection(W.params.oldSelection)}catch{}}this.index--,this.onChange()}}},{key:"redo",value:function(){if(this.canRedo()){this.index++;var W=this.history[this.index];if(W){var K=this.actions[W.action];if(K&&K.redo&&(K.redo(W.params),W.params.newSelection))try{this.editor.setDomSelection(W.params.newSelection)}catch{}}this.onChange()}}},{key:"destroy",value:function(){this.editor=null,this.history=[],this.index=-1}}])&&Q(oe.prototype,te),X&&Q(oe,X),Object.defineProperty(oe,"prototype",{writable:!1}),oe;var oe,te,X}();function B(ee){return(B=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe})(ee)}function j(ee,oe){for(var te=0;te<oe.length;te++){var X=oe[te];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(ee,function(W){return W=function(K,re){if(B(K)!="object"||!K)return K;var se=K[Symbol.toPrimitive];if(se===void 0)return(re==="string"?String:Number)(K);if(se=se.call(K,re||"default"),B(se)!="object")return se;throw new TypeError("@@toPrimitive must return a primitive value.")}(W,"string"),B(W)=="symbol"?W:W+""}(X.key),X)}}var U=function(){function ee(Y,se){if(!(this instanceof ee))throw new TypeError("Cannot call a class as a function");var re=this,Y=(this.editor=Y,this.timeout=void 0,this.delay=200,this.lastText=void 0,this.results=null,this.dom={},this.dom.container=se,document.createElement("div")),se=((this.dom.wrapper=Y).className="jsoneditor-search",se.appendChild(Y),document.createElement("div")),se=((this.dom.results=se).className="jsoneditor-results",Y.appendChild(se),document.createElement("div")),Y=((this.dom.input=se).className="jsoneditor-frame",se.title=(0,m.Tl)("searchTitle"),Y.appendChild(se),document.createElement("button")),me=(Y.type="button",Y.className="jsoneditor-refresh",se.appendChild(Y),document.createElement("input")),Y=(me.type="text",(this.dom.search=me).oninput=function(ae){re._onDelayedSearch(ae)},me.onchange=function(ae){re._onSearch()},me.onkeydown=function(ae){re._onKeyDown(ae)},me.onkeyup=function(ae){re._onKeyUp(ae)},Y.onclick=function(ae){me.select()},se.appendChild(me),document.createElement("button")),Y=(Y.type="button",Y.title=(0,m.Tl)("searchNextResultTitle"),Y.className="jsoneditor-next",Y.onclick=function(){re.next()},se.appendChild(Y),document.createElement("button"));Y.type="button",Y.title=(0,m.Tl)("searchPreviousResultTitle"),Y.className="jsoneditor-previous",Y.onclick=function(){re.previous()},se.appendChild(Y)}return oe=ee,(te=[{key:"next",value:function(W){var K;this.results&&((K=this.resultIndex!==null?this.resultIndex+1:0)>this.results.length-1&&(K=0),this._setActiveResult(K,W))}},{key:"previous",value:function(W){var K,re;this.results&&(K=this.results.length-1,re=this.resultIndex!==null?this.resultIndex-1:K,this._setActiveResult(re=re<0?K:re,W))}},{key:"_setActiveResult",value:function(W,K){var re,se,me;this.activeResult&&(re=this.activeResult.node,this.activeResult.elem==="field"?delete re.searchFieldActive:delete re.searchValueActive,re.updateDom()),this.results&&this.results[W]?(this.resultIndex=W,se=this.results[this.resultIndex].node,(me=this.results[this.resultIndex].elem)==="field"?se.searchFieldActive=!0:se.searchValueActive=!0,this.activeResult=this.results[this.resultIndex],se.updateDom(),se.scrollTo(function(){K&&se.focus(me)})):(this.resultIndex=void 0,this.activeResult=void 0)}},{key:"_clearDelay",value:function(){this.timeout!==void 0&&(clearTimeout(this.timeout),delete this.timeout)}},{key:"_onDelayedSearch",value:function(W){this._clearDelay();var K=this;this.timeout=setTimeout(function(re){K._onSearch()},this.delay)}},{key:"_onSearch",value:function(W){this._clearDelay();var K=this.dom.search.value,K=0<K.length?K:void 0;if(K!==this.lastText||W){this.lastText=K,this.results=this.editor.search(K);var W=this.results[0]?this.results[0].node.MAX_SEARCH_RESULTS:1/0,re=0;if(this.activeResult){for(var se=0;se<this.results.length;se++)if(this.results[se].node===this.activeResult.node){re=se;break}}this._setActiveResult(re,!1),K!==void 0?(K=this.results.length,this.dom.results.textContent=K===0?"no\xA0results":K===1?"1\xA0result":W<K?W+"+\xA0results":K+"\xA0results"):this.dom.results.textContent=""}}},{key:"_onKeyDown",value:function(W){var K=W.which;K===27?(this.dom.search.value="",this._onSearch(),W.preventDefault(),W.stopPropagation()):K===13&&(W.ctrlKey?this._onSearch(!0):W.shiftKey?this.previous():this.next(),W.preventDefault(),W.stopPropagation())}},{key:"_onKeyUp",value:function(W){var K=W.keyCode;K!==27&&K!==13&&this._onDelayedSearch(W)}},{key:"clear",value:function(){this.dom.search.value="",this._onSearch()}},{key:"forceSearch",value:function(){this._onSearch(!0)}},{key:"isEmpty",value:function(){return this.dom.search.value===""}},{key:"destroy",value:function(){this.editor=null,this.dom.container.removeChild(this.dom.wrapper),this.dom=null,this.results=null,this.activeResult=null,this._clearDelay()}}])&&j(oe.prototype,te),X&&j(oe,X),Object.defineProperty(oe,"prototype",{writable:!1}),oe;var oe,te,X}();function z(ee){return(z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe})(ee)}function $(ee,oe){for(var te=0;te<oe.length;te++){var X=oe[te];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(ee,function(W){return W=function(K,re){if(z(K)!="object"||!K)return K;var se=K[Symbol.toPrimitive];if(se===void 0)return(re==="string"?String:Number)(K);if(se=se.call(K,re||"default"),z(se)!="object")return se;throw new TypeError("@@toPrimitive must return a primitive value.")}(W,"string"),z(W)=="symbol"?W:W+""}(X.key),X)}}var Z=function(){function ee(W,K){if(!(this instanceof ee))throw new TypeError("Cannot call a class as a function");W&&(this.root=K,this.path=document.createElement("div"),this.path.className="jsoneditor-treepath",this.path.setAttribute("tabindex",0),this.contentMenuClicked=!1,W.appendChild(this.path),this.reset())}return oe=ee,(te=[{key:"reset",value:function(){this.path.textContent=(0,m.Tl)("selectNode")}},{key:"setPath",value:function(W){var K=this;this.path.textContent="",W&&W.length&&W.forEach(function(re,se){var me,Y=document.createElement("span");Y.className="jsoneditor-treepath-element",Y.innerText=re.name,Y.onclick=(function(ae){this.selectionCallback&&this.selectionCallback(ae)}).bind(K,re),K.path.appendChild(Y),re.children.length&&((me=document.createElement("span")).className="jsoneditor-treepath-seperator",me.textContent="\u25BA",me.onclick=function(){K.contentMenuClicked=!0;var ae=[];re.children.forEach(function(ve){ae.push({text:ve.name,className:"jsoneditor-type-modes"+(W[se+1]+1&&W[se+1].name===ve.name?" jsoneditor-selected":""),click:(function(ge,Se){this.contextMenuCallback&&this.contextMenuCallback(ge,Se)}).bind(K,re,ve.name)})}),new a.t(ae,{limitHeight:!0}).show(me,K.root,!0)},K.path.appendChild(me)),se===W.length-1&&(Y=(me||Y).getBoundingClientRect().right,K.path.offsetWidth<Y&&(K.path.scrollLeft=Y),K.path.scrollLeft)&&((Y=document.createElement("span")).className="jsoneditor-treepath-show-all-btn",Y.title="show all path",Y.textContent="...",Y.onclick=(function(ae){(K.contentMenuClicked=!1,g.addClassName)(K.path,"show-all"),K.path.style.width=K.path.parentNode.getBoundingClientRect().width-10+"px",K.path.onblur=function(){K.contentMenuClicked?(K.contentMenuClicked=!1,K.path.focus()):((0,g.removeClassName)(K.path,"show-all"),K.path.onblur=void 0,K.path.style.width="",K.setPath(ae))}}).bind(K,W),K.path.insertBefore(Y,K.path.firstChild))})}},{key:"onSectionSelected",value:function(W){typeof W=="function"&&(this.selectionCallback=W)}},{key:"onContextMenuItemSelected",value:function(W){typeof W=="function"&&(this.contextMenuCallback=W)}}])&&$(oe.prototype,te),X&&$(oe,X),Object.defineProperty(oe,"prototype",{writable:!1}),oe;var oe,te,X}(),J=ne(1746),ie=ne.n(J),ne={},le=(ne.create=function(ee,oe){if(!ee)throw new Error("No container element provided.");function te(je){var Ye,mt;document.createRange?((Ye=document.createRange()).selectNodeContents(je),Ye.collapse(!1),(mt=window.getSelection()).removeAllRanges(),mt.addRange(Ye)):document.selection&&((Ye=document.body.createTextRange()).moveToElementText(je),Ye.collapse(!1),Ye.select())}function X(je){return me===void 0&&((me=document.createElement("span")).style.visibility="hidden",me.style.position="fixed",me.style.outline="0",me.style.margin="0",me.style.padding="0",me.style.border="0",me.style.left="0",me.style.whiteSpace="pre",me.style.fontSize=ae,me.style.fontFamily=ve,me.style.fontWeight="normal",document.body.appendChild(me)),me.textContent=je,me.getBoundingClientRect().right}function W(){this.style.backgroundColor="#ddd"}function K(){this.style.backgroundColor=""}function re(){_e.hide(),_e.onmouseselection(this.__hint,_e.rs)}var se,me,Y,ae,ve,ge,Se,Ee,Fe,Ae,we,_e,Ke,rt,pt,Ne;this.container=ee,this.dom={},this.highlighter=new d,this.selection=void 0,this.multiselection={nodes:[]},this.validateSchema=null,this.validationSequence=0,this.errorNodes=[],this.lastSchemaErrors=void 0,this.node=null,this.focusTarget=null,this._setOptions(oe),oe.autocomplete&&(this.autocomplete=((se=(se=oe.autocomplete)||{}).filter=se.filter||"start",se.trigger=se.trigger||"keydown",se.confirmKeys=se.confirmKeys||[39,35,9],se.caseSensitive=se.caseSensitive||!1,ve=ae="",(ge=document.createElement("div")).style.position="relative",ge.style.outline="0",ge.style.border="0",ge.style.margin="0",ge.style.padding="0",(Se=document.createElement("div")).className="autocomplete dropdown",Se.style.position="absolute",Se.style.visibility="hidden",Ee=Se,Fe=[],we=-1,rt=_e={rs:Ke={onArrowDown:function(){},onArrowUp:function(){},onEnter:function(){},onTab:function(){},startFrom:Ae=0,options:[],element:null,elementHint:null,elementStyle:null,wrapper:ge,show:function(je,Ye,mt){var vt=this;this.startFrom=Ye,this.wrapper.remove(),this.elementHint&&(this.elementHint.remove(),this.elementHint=null),ae===""&&(ae=window.getComputedStyle(je).getPropertyValue("font-size")),ve===""&&(ve=window.getComputedStyle(je).getPropertyValue("font-family")),Se.style.marginLeft="0",Se.style.marginTop=je.getBoundingClientRect().height+"px",this.options=mt.map(String),this.element!==je&&(this.element=je,this.elementStyle={zIndex:this.element.style.zIndex,position:this.element.style.position,backgroundColor:this.element.style.backgroundColor,borderColor:this.element.style.borderColor}),this.element.style.zIndex=3,this.element.style.position="relative",this.element.style.backgroundColor="transparent",this.element.style.borderColor="transparent",this.elementHint=je.cloneNode(),this.elementHint.className="autocomplete hint",this.elementHint.style.zIndex=2,this.elementHint.style.position="absolute",this.elementHint.onfocus=function(){vt.element.focus()},this.element.addEventListener&&(this.element.removeEventListener("keydown",pt),this.element.addEventListener("keydown",pt,!1),this.element.removeEventListener("blur",Ne),this.element.addEventListener("blur",Ne,!1)),ge.appendChild(this.elementHint),ge.appendChild(Se),je.parentElement.appendChild(ge),this.repaint(je)},setText:function(je){this.element.innerText=je},getText:function(){return this.element.innerText},hideDropDown:function(){this.wrapper.remove(),this.elementHint&&(this.elementHint.remove(),this.elementHint=null,rt.hide(),this.element.style.zIndex=this.elementStyle.zIndex,this.element.style.position=this.elementStyle.position,this.element.style.backgroundColor=this.elementStyle.backgroundColor,this.element.style.borderColor=this.elementStyle.borderColor)},repaint:function(Ye){var Ye=(Ye=Ye.innerText).replace(`
`,""),mt=this.options.length,vt=Ye.substring(this.startFrom);Y=Ye.substring(0,this.startFrom);for(var yt=0;yt<mt;yt++){var $e=this.options[yt];if(!se.caseSensitive&&$e.toLowerCase().indexOf(vt.toLowerCase())===0||se.caseSensitive&&$e.indexOf(vt)===0){this.elementHint.innerText=Y+vt+$e.substring(vt.length),this.elementHint.realInnerText=Y+$e;break}}Se.style.left=X(Y)+"px",rt.refresh(vt,this.options),this.elementHint.style.width=X(this.elementHint.innerText)+10+"px",Se.style.visibility!=="hidden"&&(this.elementHint.style.width=X(this.elementHint.innerText)+Se.clientWidth+"px")}},hide:function(){Ee.style.visibility="hidden"},refresh:function(je,Ye){Ee.style.visibility="hidden",Ae=0,Ee.textContent="";var vt=window.innerHeight||document.documentElement.clientHeight,$e=Ee.parentNode.getBoundingClientRect(),mt=$e.top-6,vt=vt-$e.bottom-6,yt=(Fe=[],typeof se.filter=="function"?se.filter:s[se.filter]),$e=yt?Ye.filter(function(be){return yt(se.caseSensitive?je:je.toLowerCase(),se.caseSensitive?be:be.toLowerCase(),se)}):[];(Fe=$e.map(function(be){var Te=document.createElement("div"),De=(Te.className="item",Te.onmouseover=W,Te.onmouseout=K,Te.onmousedown=re,Te.__hint=be,Te.textContent="",Te.appendChild(document.createTextNode(be.substring(0,je.length))),document.createElement("b"));return De.appendChild(document.createTextNode(be.substring(je.length))),Te.appendChild(De),Ee.appendChild(Te),Te})).length===0||Fe.length===1&&(je.toLowerCase()===Fe[0].__hint.toLowerCase()&&!se.caseSensitive||je===Fe[0].__hint&&se.caseSensitive)||Fe.length<2||(_e.highlight(0),3*vt<mt?(Ee.style.maxHeight=mt+"px",Ee.style.top="",Ee.style.bottom="100%"):(Ee.style.top="100%",Ee.style.bottom="",Ee.style.maxHeight=vt+"px"),Ee.style.visibility="visible")},highlight:function(je){we!==-1&&Fe[we]&&(Fe[we].className="item"),Fe[je].className="item hover",we=je},move:function(je){return Ee.style.visibility==="hidden"?"":(Ae+je!==-1&&Ae+je!==Fe.length&&(Ae+=je,_e.highlight(Ae)),Fe[Ae].__hint)},onmouseselection:function(){}},pt=(function(je){var Ye=(je=je||window.event).keyCode;if(this.elementHint!=null&&Ye!==33&&Ye!==34)if(Ye===27)Ke.hideDropDown(),Ke.element.focus(),je.preventDefault(),je.stopPropagation();else{var mt,vt=(vt=this.element.innerText).replace(`
`,"");if(0<=se.confirmKeys.indexOf(Ye))Ye===9&&this.elementHint.innerText.length===0&&Ke.onTab(),0<this.elementHint.innerText.length&&this.element.innerText!==this.elementHint.realInnerText&&(this.element.innerText=this.elementHint.realInnerText,Ke.hideDropDown(),te(this.element),Ye===9)&&(Ke.element.focus(),je.preventDefault(),je.stopPropagation());else if(Ye===13)if(this.elementHint.innerText.length===0)Ke.onEnter();else{var yt=Se.style.visibility==="hidden";if(rt.hide(),yt)return Ke.hideDropDown(),Ke.element.focus(),void Ke.onEnter();this.element.innerText=this.elementHint.realInnerText,Ke.hideDropDown(),te(this.element),je.preventDefault(),je.stopPropagation()}else Ye===40?(yt=vt.substring(this.startFrom),(mt=rt.move(1))===""&&Ke.onArrowDown(),this.elementHint.innerText=Y+yt+mt.substring(yt.length),this.elementHint.realInnerText=Y+mt,je.preventDefault(),je.stopPropagation()):Ye===38&&(yt=vt.substring(this.startFrom),(mt=rt.move(-1))===""&&Ke.onArrowUp(),this.elementHint.innerText=Y+yt+mt.substring(yt.length),this.elementHint.realInnerText=Y+mt,je.preventDefault(),je.stopPropagation())}}).bind(Ke),Ne=function(je){Ke.hideDropDown()},rt.onmouseselection=function(je,Ye){Ye.element.innerText=Ye.elementHint.innerText=Y+je,Ye.hideDropDown(),window.setTimeout(function(){Ye.element.focus(),te(Ye.element)},1)},Ke)),this.options.history&&this.options.mode!=="view"&&(this.history=new O(this)),this._createFrame(),this._createTable()},ne.destroy=function(){this.frame&&this.container&&this.frame.parentNode===this.container&&(this.container.removeChild(this.frame),this.frame=null),this.container=null,this.dom=null,this.clear(),this.node=null,this.focusTarget=null,this.selection=null,this.multiselection=null,this.errorNodes=null,this.validateSchema=null,this._debouncedValidate=null,this.history&&(this.history.destroy(),this.history=null),this.searchBox&&(this.searchBox.destroy(),this.searchBox=null),this.modeSwitcher&&(this.modeSwitcher.destroy(),this.modeSwitcher=null),this.frameFocusTracker.destroy()},ne._setOptions=function(ee){var oe=this;this.options={search:!0,history:!0,mode:"tree",name:void 0,schema:null,schemaRefs:null,autocomplete:null,navigationBar:!0,mainMenuBar:!0,limitDragging:!1,onSelectionChange:null,colorPicker:!0,onColorPicker:function(te,X,W){var K;ie()&&(K=te.getBoundingClientRect().top,K=(0,g.getWindow)(te).innerHeight-K<300&&300<K,new(ie())({parent:te,color:X,popup:K?"top":"bottom",onDone:function(re){re=re.rgba[3]===1?re.hex.substr(0,7):re.hex,W(re)}}).show())},timestampTag:!0,timestampFormat:null,createQuery:p.V,executeQuery:p.e,onEvent:null,enableSort:!0,enableTransform:!0},ee&&(Object.keys(ee).forEach(function(te){oe.options[te]=ee[te]}),ee.limitDragging==null)&&ee.schema!=null&&(this.options.limitDragging=!0),this.setSchema(this.options.schema,this.options.schemaRefs),this._debouncedValidate=(0,g.debounce)(this._validateAndCatch.bind(this),this.DEBOUNCE_INTERVAL),ee.onSelectionChange&&this.onSelectionChange(ee.onSelectionChange),(0,m.AI)(this.options.languages),(0,m.xC)(this.options.language)},ne.set=function(ee){ee instanceof Function||ee===void 0?this.clear():(this.content.removeChild(this.table),ee={field:this.options.name,value:ee},ee=new S(this,ee),this._setRoot(ee),this._validateAndCatch(),this.node.expand(!1),this.content.appendChild(this.table)),this.history&&this.history.clear(),this.searchBox&&this.searchBox.clear()},ne.update=function(ee){var oe,te;this.node.deepEqual(ee)||(oe=this.getSelection(),this.onChangeDisabled=!0,this.node.update(ee),this.onChangeDisabled=!1,this._validateAndCatch(),this.searchBox&&!this.searchBox.isEmpty()&&this.searchBox.forceSearch(),oe&&oe.start&&oe.end&&(ee=this.node.findNodeByPath(oe.start.path),te=this.node.findNodeByPath(oe.end.path),ee)&&te?this.setSelection(oe.start,oe.end):this.setSelection({},{}))},ne.get=function(){if(this.node)return this.node.getValue()},ne.getText=function(){return JSON.stringify(this.get())},ne.setText=function(ee){try{this.set((0,g.parse)(ee))}catch{ee=(0,g.tryJsonRepair)(ee),this.set((0,g.parse)(ee))}},ne.updateText=function(ee){try{this.update((0,g.parse)(ee))}catch{ee=(0,g.tryJsonRepair)(ee),this.update((0,g.parse)(ee))}},ne.setName=function(ee){this.options.name=ee,this.node&&this.node.updateField(this.options.name)},ne.getName=function(){return this.options.name},ne.focus=function(){var ee=this.scrollableContent.querySelector("[contenteditable=true]");ee?ee.focus():this.node.dom.expand?this.node.dom.expand.focus():this.node.dom.menu?this.node.dom.menu.focus():(ee=this.frame.querySelector("button"))&&ee.focus()},ne.clear=function(){this.node&&(this.node.hide(),delete this.node),this.treePath&&this.treePath.reset()},ne._setRoot=function(ee){this.clear(),(this.node=ee).setParent(null),ee.setField(this.getName(),!1),delete ee.index,this.tbody.appendChild(ee.getDom())},ne.search=function(ee){var oe;return this.node?(this.content.removeChild(this.table),oe=this.node.search(ee),this.content.appendChild(this.table)):oe=[],oe},ne.expandAll=function(){this.node&&(this.content.removeChild(this.table),this.node.expand(),this.content.appendChild(this.table))},ne.collapseAll=function(){this.node&&(this.content.removeChild(this.table),this.node.collapse(),this.content.appendChild(this.table))},ne.expand=function(ee){var oe;ee&&(oe=this.node?this.node.findNodeByPath(ee.path):null)&&(ee.isExpand?oe.expand(ee.recursive):oe.collapse(ee.recursive))},ne._onAction=function(ee,oe){this.history&&this.history.add(ee,oe),this._onChange()},ne._onChange=function(){if(!this.onChangeDisabled){var ee;if(this.selection=this.getDomSelection(),this._debouncedValidate(),this.treePath&&((ee=this.node&&this.selection?this.node.findNodeByInternalPath(this.selection.path):this.multiselection?this.multiselection.nodes[0]:void 0)?this._updateTreePath(ee.getNodePath()):this.treePath.reset()),this.options.onChange)try{this.options.onChange()}catch{}if(this.options.onChangeJSON)try{this.options.onChangeJSON(this.get())}catch{}if(this.options.onChangeText)try{this.options.onChangeText(this.getText())}catch{}if(this.options.onClassName&&this.node.recursivelyUpdateCssClassesOnNodes(),this.options.onNodeName&&this.node.childs)try{this.node.recursivelyUpdateNodeName()}catch{}}},ne.validate=function(){var ee=this,oe=this.node;if(oe){var te=oe.getValue(),X=[];this.validateSchema&&!this.validateSchema(te)&&(X=this.validateSchema.errors.map(function(re){return(0,g.improveSchemaError)(re)}).map(function(re){return{node:oe.findNode(re.dataPath),error:re,type:"validation"}}).filter(function(re){return re.node!=null}));try{this.validationSequence++;var W=this,K=this.validationSequence;return this._validateCustom(te).then(function(re){return K===W.validationSequence&&(re=[].concat(X,re||[]),W._renderValidationErrors(re),typeof ee.options.onValidationError=="function"&&(0,g.isValidationErrorChanged)(re,ee.lastSchemaErrors)&&ee.options.onValidationError.call(ee,re),ee.lastSchemaErrors=re),ee.lastSchemaErrors})}catch(re){return Promise.reject(re)}}},ne._validateAndCatch=function(){this.validate().catch(function(ee){})},ne._renderValidationErrors=function(ee){this.errorNodes&&this.errorNodes.forEach(function(te){te.setError(null)});var oe=ee.reduce(function(te,X){return X.node.findParents().filter(function(W){return!te.some(function(K){return K[0]===W})}).map(function(W){return[W,X.node]}).concat(te)},[]);this.errorNodes=oe.map(function(te){return{node:te[0],child:te[1],error:{message:te[0].type==="object"?(0,m.Tl)("containsInvalidProperties"):(0,m.Tl)("containsInvalidItems")}}}).concat(ee).map(function(te){return te.node.setError(te.error,te.child),te.node})},ne._validateCustom=function(ee){try{var oe,te;if(this.options.onValidate)return oe=this.node,te=this.options.onValidate(ee),((0,g.isPromise)(te)?te:Promise.resolve(te)).then(function(X){return Array.isArray(X)?X.filter(function(W){var K=(0,g.isValidValidationError)(W);return K}).map(function(W){var K;try{K=W&&W.path?oe.findNodeByPath(W.path):null}catch{}return{node:K,error:W,type:"customValidation"}}).filter(function(W){return W&&W.node&&W.error&&W.error.message}):null})}catch(X){return Promise.reject(X)}return Promise.resolve(null)},ne.refresh=function(){this.node&&this.node.updateDom({recurse:!0})},ne.startAutoScroll=function(ee){var oe=this,te=this.scrollableContent,X=(0,g.getAbsoluteTop)(te),W=te.clientHeight,K=X+W;ee<X+24&&0<te.scrollTop?this.autoScrollStep=(X+24-ee)/3:K-24<ee&&W+te.scrollTop<te.scrollHeight?this.autoScrollStep=(K-24-ee)/3:this.autoScrollStep=void 0,this.autoScrollStep?this.autoScrollTimer||(this.autoScrollTimer=setInterval(function(){oe.autoScrollStep?te.scrollTop-=oe.autoScrollStep:oe.stopAutoScroll()},50)):this.stopAutoScroll()},ne.stopAutoScroll=function(){this.autoScrollTimer&&(clearTimeout(this.autoScrollTimer),delete this.autoScrollTimer),this.autoScrollStep&&delete this.autoScrollStep},ne.setDomSelection=function(ee){var oe,te,X;ee&&("scrollTop"in ee&&this.scrollableContent&&(this.scrollableContent.scrollTop=ee.scrollTop),ee.paths?(oe=this,te=ee.paths.map(function(W){return oe.node.findNodeByInternalPath(W)}),this.select(te)):(X=(te=ee.path?this.node.findNodeByInternalPath(ee.path):null)&&ee.domName?te.dom[ee.domName]:null,ee.range&&X?(ee=Object.assign({},ee.range,{container:X}),(0,g.setSelectionOffset)(ee)):te&&te.focus()))},ne.getDomSelection=function(){var ee=S.getNodeFromTarget(this.focusTarget),oe=this.focusTarget,te=ee?Object.keys(ee.dom).find(function(W){return ee.dom[W]===oe}):null,X=(0,g.getSelectionOffset)();return(X=(X=X&&X.container.nodeName!=="DIV"?null:X)&&X.container!==oe?null:X)&&delete X.container,{path:ee?ee.getInternalPath():null,domName:te,range:X,paths:0<this.multiselection.length?this.multiselection.nodes.map(function(W){return W.getInternalPath()}):null,scrollTop:this.scrollableContent?this.scrollableContent.scrollTop:0}},ne.scrollTo=function(ee,oe){var te,X,W,K,re=this.scrollableContent;re?((te=this).animateTimeout&&(clearTimeout(te.animateTimeout),delete te.animateTimeout),te.animateCallback&&(te.animateCallback(!1),delete te.animateCallback),X=re.clientHeight,W=re.scrollHeight-X,K=Math.min(Math.max(ee-X/4,0),W),function se(){var me=re.scrollTop,me=K-me;3<Math.abs(me)?(re.scrollTop+=me/3,te.animateCallback=oe,te.animateTimeout=setTimeout(se,50)):(oe&&oe(!0),re.scrollTop=K,delete te.animateTimeout,delete te.animateCallback)}()):oe&&oe(!1)},ne._createFrame=function(){var ee=this,oe=(this.frame=document.createElement("div"),this.frame.className="jsoneditor jsoneditor-mode-"+this.options.mode,this.container.appendChild(this.frame),this.contentOuter=document.createElement("div"),this.contentOuter.className="jsoneditor-outer",this);function te(se){oe._onEvent&&oe._onEvent(se)}var X,W,K,re={target:this.frame,onFocus:this.options.onFocus||null,onBlur:this.options.onBlur||null};this.frameFocusTracker=new l.$(re),this.frame.onclick=function(se){var me=se.target;te(se),me.nodeName==="BUTTON"&&se.preventDefault()},this.frame.oninput=te,this.frame.onchange=te,this.frame.onkeydown=te,this.frame.onkeyup=te,this.frame.oncut=te,this.frame.onpaste=te,this.frame.onmousedown=te,this.frame.onmouseup=te,this.frame.onmouseover=te,this.frame.onmouseout=te,(0,g.addEventListener)(this.frame,"focus",te,!0),(0,g.addEventListener)(this.frame,"blur",te,!0),this.frame.onfocusin=te,this.frame.onfocusout=te,this.options.mainMenuBar&&((0,g.addClassName)(this.contentOuter,"has-main-menu-bar"),this.menu=document.createElement("div"),this.menu.className="jsoneditor-menu",this.frame.appendChild(this.menu),(re=document.createElement("button")).type="button",re.className="jsoneditor-expand-all",re.title=(0,m.Tl)("expandAll"),re.onclick=function(){oe.expandAll(),typeof ee.options.onExpand=="function"&&ee.options.onExpand({path:[],isExpand:!0,recursive:!0})},this.menu.appendChild(re),(re=document.createElement("button")).type="button",re.title=(0,m.Tl)("collapseAll"),re.className="jsoneditor-collapse-all",re.onclick=function(){oe.collapseAll(),typeof ee.options.onExpand=="function"&&ee.options.onExpand({path:[],isExpand:!1,recursive:!0})},this.menu.appendChild(re),this.options.enableSort&&((re=document.createElement("button")).type="button",re.className="jsoneditor-sort",re.title=(0,m.Tl)("sortTitleShort"),re.onclick=function(){oe.node.showSortModal()},this.menu.appendChild(re)),this.options.enableTransform&&((re=document.createElement("button")).type="button",re.title=(0,m.Tl)("transformTitleShort"),re.className="jsoneditor-transform",re.onclick=function(){oe.node.showTransformModal()},this.menu.appendChild(re)),this.history&&((X=document.createElement("button")).type="button",X.className="jsoneditor-undo jsoneditor-separator",X.title=(0,m.Tl)("undo"),X.onclick=function(){oe._onUndo()},this.menu.appendChild(X),this.dom.undo=X,(W=document.createElement("button")).type="button",W.className="jsoneditor-redo",W.title=(0,m.Tl)("redo"),W.onclick=function(){oe._onRedo()},this.menu.appendChild(W),this.dom.redo=W,this.history.onChange=function(){X.disabled=!oe.history.canUndo(),W.disabled=!oe.history.canRedo()},this.history.onChange()),this.options&&this.options.modes&&this.options.modes.length&&((K=this).modeSwitcher=new h.n(this.menu,this.options.modes,this.options.mode,function(se){try{K.setMode(se),K.modeSwitcher.focus()}catch(me){K._onError(me)}})),this.options.search)&&(this.searchBox=new U(this,this.menu)),this.options.navigationBar&&(this.navBar=document.createElement("div"),this.navBar.className="jsoneditor-navigation-bar nav-bar-empty",this.frame.appendChild(this.navBar),this.treePath=new Z(this.navBar,this.getPopupAnchor()),this.treePath.onSectionSelected(this._onTreePathSectionSelected.bind(this)),this.treePath.onContextMenuItemSelected(this._onTreePathMenuItemSelected.bind(this)))},ne._onUndo=function(){this.history&&(this.history.undo(),this._onChange())},ne._onRedo=function(){this.history&&(this.history.redo(),this._onChange())},ne._onEvent=function(ee){if(!S.targetIsColorPicker(ee.target)){var oe,te=S.getNodeFromTarget(ee.target);if(ee.type==="keydown"&&this._onKeyDown(ee),te&&ee.type==="focus"&&(this.focusTarget=ee.target,this.options.autocomplete)&&this.options.autocomplete.trigger==="focus"&&this._showAutoComplete(ee.target),ee.type==="mousedown"&&this._startDragDistance(ee),ee.type!=="mousemove"&&ee.type!=="mouseup"&&ee.type!=="click"||this._updateDragDistance(ee),te&&this.options&&this.options.navigationBar&&te&&(ee.type==="keydown"||ee.type==="mousedown")&&(oe=this,setTimeout(function(){oe._updateTreePath(te.getNodePath())})),te&&te.selected){if(ee.type==="click"){if(ee.target===te.dom.menu)return void this.showContextMenu(ee.target);ee.hasMoved||this.deselect()}ee.type==="mousedown"&&S.onDragStart(this.multiselection.nodes,ee)}else ee.type==="mousedown"&&(0,g.hasParentNode)(ee.target,this.content)&&(this.deselect(),te&&ee.target===te.dom.drag?S.onDragStart(te,ee):te&&(ee.target===te.dom.field||ee.target===te.dom.value||ee.target===te.dom.select)||this._onMultiSelectStart(ee));te&&te.onEvent(ee)}},ne._updateTreePath=function(ee){var oe;function te(X){return X.parent?X.parent.type==="array"?X.index:X.field:X.field||X.type}ee&&ee.length?((0,g.removeClassName)(this.navBar,"nav-bar-empty"),oe=[],ee.forEach(function(X){var W={name:te(X),node:X,children:[]};X.childs&&X.childs.length&&X.childs.forEach(function(K){W.children.push({name:te(K),node:K})}),oe.push(W)}),this.treePath.setPath(oe)):(0,g.addClassName)(this.navBar,"nav-bar-empty")},ne._onTreePathSectionSelected=function(ee){ee&&ee.node&&(ee.node.expandTo(),ee.node.focus())},ne._onTreePathMenuItemSelected=function(ee,oe){ee&&ee.children.length&&(ee=ee.children.find(function(te){return te.name===oe}))&&ee.node&&(this._updateTreePath(ee.node.getNodePath()),ee.node.expandTo(),ee.node.focus())},ne._startDragDistance=function(ee){this.dragDistanceEvent={initialTarget:ee.target,initialPageX:ee.pageX,initialPageY:ee.pageY,dragDistance:0,hasMoved:!1}},ne._updateDragDistance=function(ee){this.dragDistanceEvent||this._startDragDistance(ee);var oe=ee.pageX-this.dragDistanceEvent.initialPageX,te=ee.pageY-this.dragDistanceEvent.initialPageY;return this.dragDistanceEvent.dragDistance=Math.sqrt(oe*oe+te*te),this.dragDistanceEvent.hasMoved=this.dragDistanceEvent.hasMoved||10<this.dragDistanceEvent.dragDistance,ee.dragDistance=this.dragDistanceEvent.dragDistance,ee.hasMoved=this.dragDistanceEvent.hasMoved,ee.dragDistance},ne._onMultiSelectStart=function(ee){var oe,te=S.getNodeFromTarget(ee.target);this.options.mode==="tree"&&this.options.onEditable===void 0&&(this.multiselection={start:te||null,end:null,nodes:[]},this._startDragDistance(ee),(oe=this).mousemove||(this.mousemove=(0,g.addEventListener)(ee.view,"mousemove",function(X){oe._onMultiSelect(X)})),this.mouseup||(this.mouseup=(0,g.addEventListener)(ee.view,"mouseup",function(X){oe._onMultiSelectEnd(X)})),ee.preventDefault())},ne._onMultiSelect=function(ee){var oe;ee.preventDefault(),this._updateDragDistance(ee),ee.hasMoved&&((ee=S.getNodeFromTarget(ee.target))&&(this.multiselection.start==null&&(this.multiselection.start=ee),this.multiselection.end=ee),this.deselect(),ee=this.multiselection.start,oe=this.multiselection.end||this.multiselection.start,ee)&&oe&&(this.multiselection.nodes=this._findTopLevelNodes(ee,oe),this.multiselection.nodes&&this.multiselection.nodes.length&&(ee=this.multiselection.nodes[0],this.multiselection.start===ee||this.multiselection.start.isDescendantOf(ee)?this.multiselection.direction="down":this.multiselection.direction="up"),this.select(this.multiselection.nodes))},ne._onMultiSelectEnd=function(ee){var oe=this.multiselection.nodes[0];oe&&oe.dom.menu&&oe.dom.menu.focus(),this.multiselection.start=null,this.multiselection.end=null,this.mousemove&&((0,g.removeEventListener)(ee.view,"mousemove",this.mousemove),delete this.mousemove),this.mouseup&&((0,g.removeEventListener)(ee.view,"mouseup",this.mouseup),delete this.mouseup)},ne.deselect=function(ee){var oe=!!this.multiselection.nodes.length;this.multiselection.nodes.forEach(function(te){te.setSelected(!1)}),this.multiselection.nodes=[],ee&&(this.multiselection.start=null,this.multiselection.end=null),oe&&this._selectionChangedHandler&&this._selectionChangedHandler()},ne.select=function(ee){if(!Array.isArray(ee))return this.select([ee]);var oe;ee&&(this.deselect(),this.multiselection.nodes=ee.slice(0),oe=ee[0],ee.forEach(function(te){te.expandPathToNode(),te.setSelected(!0,te===oe)}),this._selectionChangedHandler)&&(ee=this.getSelection(),this._selectionChangedHandler(ee.start,ee.end))},ne._findTopLevelNodes=function(re,se){for(var te=re.getNodePath(),X=se.getNodePath(),W=0;W<te.length&&te[W]===X[W];)W++;var K,re=te[W-1],se=te[W],me=X[W];return se&&me||(re.parent?re=(me=se=re).parent:(se=re.childs[0],me=re.childs[re.childs.length-1])),re&&se&&me?(se=re.childs.indexOf(se),me=re.childs.indexOf(me),K=Math.min(se,me),se=Math.max(se,me),re.childs.slice(K,se+1)):[]},ne._showAutoComplete=function(ee){var oe,te=S.getNodeFromTarget(ee),X="";0<=ee.className.indexOf("jsoneditor-value")&&(X="value"),(X=0<=ee.className.indexOf("jsoneditor-field")?"field":X)!==""&&(oe=this,setTimeout(function(){var W;!te||!(oe.options.autocomplete.trigger==="focus"||0<ee.innerText.length)||(W=oe.options.autocomplete.getOptions(ee.innerText,te.getPath(),X,te.editor))===null?oe.autocomplete.hideDropDown():typeof W.then=="function"?W.then(function(K){K===null?oe.autocomplete.hideDropDown():K.options?oe.autocomplete.show(ee,K.startFrom,K.options):oe.autocomplete.show(ee,0,K)}).catch(function(K){}):W.options?oe.autocomplete.show(ee,W.startFrom,W.options):oe.autocomplete.show(ee,0,W)},50))},ne._onKeyDown=function(ee){var oe,te=ee.which||ee.keyCode,X=ee.altKey,W=ee.ctrlKey,K=ee.metaKey,re=ee.shiftKey,se=!1,me=this.focusTarget;te===9&&(oe=this,setTimeout(function(){oe.focusTarget!==me&&(0,g.selectContentEditable)(oe.focusTarget)},0)),this.searchBox&&(W&&te===70?(this.searchBox.dom.search.focus(),this.searchBox.dom.search.select(),se=!0):(te===114||W&&te===71)&&(re?this.searchBox.previous(!0):this.searchBox.next(!0),se=!0)),this.history&&(W&&!re&&te===90?(this._onUndo(),se=!0):W&&re&&te===90&&(this._onRedo(),se=!0)),!this.options.autocomplete||se||W||X||K||ee.key.length!==1&&te!==8&&te!==46||(se=!1,this._showAutoComplete(ee.target)),se&&(ee.preventDefault(),ee.stopPropagation())},ne._createTable=function(){var ee;this.options.navigationBar&&(0,g.addClassName)(this.contentOuter,"has-nav-bar"),this.scrollableContent=document.createElement("div"),this.scrollableContent.className="jsoneditor-tree",this.contentOuter.appendChild(this.scrollableContent),this.content=document.createElement("div"),this.content.className="jsoneditor-tree-inner",this.scrollableContent.appendChild(this.content),this.table=document.createElement("table"),this.table.className="jsoneditor-tree",this.content.appendChild(this.table),this.colgroupContent=document.createElement("colgroup"),this.options.mode==="tree"&&((ee=document.createElement("col")).width="24px",this.colgroupContent.appendChild(ee)),(ee=document.createElement("col")).width="24px",this.colgroupContent.appendChild(ee),ee=document.createElement("col"),this.colgroupContent.appendChild(ee),this.table.appendChild(this.colgroupContent),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.frame.appendChild(this.contentOuter)},ne.showContextMenu=function(ee,oe){var te,X=[],W=this.multiselection.nodes.slice();X.push({text:(0,m.Tl)("duplicateText"),title:(0,m.Tl)("duplicateTitle"),className:"jsoneditor-duplicate",click:function(){S.onDuplicate(W)}}),X.push({text:(0,m.Tl)("remove"),title:(0,m.Tl)("removeTitle"),className:"jsoneditor-remove",click:function(){S.onRemove(W)}}),this.options.onCreateMenu&&(te=W.map(function(K){return K.getPath()}),X=this.options.onCreateMenu(X,{type:"multiple",path:te[0],paths:te})),new a.t(X,{close:oe}).show(ee,this.getPopupAnchor())},ne.getPopupAnchor=function(){return this.options.popupAnchor||this.frame},ne.getSelection=function(){var ee,oe,te={start:null,end:null};return this.multiselection.nodes&&this.multiselection.nodes.length&&this.multiselection.nodes.length&&(ee=this.multiselection.nodes[0],oe=this.multiselection.nodes[this.multiselection.nodes.length-1],this.multiselection.direction==="down"?(te.start=ee.serialize(),te.end=oe.serialize()):(te.start=oe.serialize(),te.end=ee.serialize())),te},ne.onSelectionChange=function(ee){typeof ee=="function"&&(this._selectionChangedHandler=(0,g.debounce)(ee,this.DEBOUNCE_INTERVAL))},ne.setSelection=function(ee,oe){ee&&ee.dom&&ee.range&&this.setDomSelection(ee),ee=this._getNodeInstancesByRange(ee,oe),ee.forEach(function(te){te.expandTo()}),this.select(ee)},ne._getNodeInstancesByRange=function(ee,oe){ee&&ee.path&&(te=this.node.findNodeByPath(ee.path),oe)&&oe.path&&(X=this.node.findNodeByPath(oe.path));var te,X,W=[];if(te instanceof S)if(X instanceof S&&X!==te)if(te.parent===X.parent){oe=te.getIndex()<X.getIndex()?(ee=te,X):(ee=X,te);var K=ee;for(W.push(K);K=K.nextSibling(),W.push(K),K&&K!==oe;);}else W=this._findTopLevelNodes(te,X);else W.push(te);return W},ne.getNodesByRange=function(te,oe){var te=this._getNodeInstancesByRange(te,oe),X=[];return te.forEach(function(W){X.push(W.serialize())}),X},[{mode:"tree",mixin:ne,data:"json"},{mode:"view",mixin:ne,data:"json"},{mode:"form",mixin:ne,data:"json"}])},2870:function(n,o,i){o.tryRequireAjv=function(){try{return i(2229)}catch{}}},5467:function(n,o,i){o.J=function(){try{i(9762)}catch{}}},6237:function(n,s,i){"use strict";i.r(s),i.d(s,{addClassName:function(){return k},addEventListener:function(){return J},asyncExec:function(){return yt},clear:function(){return v},compileJSONPointer:function(){return ae},contains:function(){return Ye},debounce:function(){return K},escapeUnicodeChars:function(){return y},extend:function(){return A},findUniqueName:function(){return Fe},formatSize:function(){return pt},get:function(){return Ee},getAbsoluteLeft:function(){return S},getAbsoluteTop:function(){return P},getChildPaths:function(){return Ae},getColorCSS:function(){return ve},getIndexForPosition:function(){return me},getInnerText:function(){return B},getInputSelection:function(){return se},getInternetExplorerVersion:function(){return z},getPositionForPath:function(){return Y},getSelection:function(){return V},getSelectionOffset:function(){return Q},getType:function(){return _},getWindow:function(){return w},hasParentNode:function(){return U},improveSchemaError:function(){return oe},insideRect:function(){return W},isArray:function(){return E},isChildOf:function(){return ne},isFirefox:function(){return Z},isObject:function(){return je},isPromise:function(){return te},isTimestamp:function(){return rt},isUrl:function(){return T},isValidColor:function(){return ge},isValidValidationError:function(){return X},isValidationErrorChanged:function(){return mt},limitCharacters:function(){return Ne},makeFieldTooltip:function(){return Se},parse:function(){return g},parsePath:function(){return le},parseString:function(){return Ke},removeAllClassNames:function(){return L},removeClassName:function(){return R},removeEventListener:function(){return ie},removeReturnsAndSurroundingWhitespace:function(){return j},selectContentEditable:function(){return H},setEndOfContentEditable:function(){return F},setSelection:function(){return q},setSelectionOffset:function(){return O},sort:function(){return we},sortObjectKeys:function(){return _e},stringifyPath:function(){return ee},stripFormatting:function(){return N},textDiff:function(){return re},tryJsonRepair:function(){return b},uniqueMergeArrays:function(){return vt},validate:function(){return x}}),i(1081);var s=i(1342),a=i.n(s),l=i(9857),c=i(5736),u=i(3094),d=i(3057);function m(be){return function(Te){if(Array.isArray(Te))return p(Te)}(be)||function(Te){if(typeof Symbol<"u"&&Te[Symbol.iterator]!=null||Te["@@iterator"]!=null)return Array.from(Te)}(be)||function(Te,De){var pe;if(Te)return typeof Te=="string"?p(Te,De):(pe=(pe=Object.prototype.toString.call(Te).slice(8,-1))==="Object"&&Te.constructor?Te.constructor.name:pe)==="Map"||pe==="Set"?Array.from(Te):pe==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(pe)?p(Te,De):void 0}(be)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function p(be,Te){(Te==null||Te>be.length)&&(Te=be.length);for(var De=0,pe=new Array(Te);De<Te;De++)pe[De]=be[De];return pe}function h(be){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Te){return typeof Te}:function(Te){return Te&&typeof Symbol=="function"&&Te.constructor===Symbol&&Te!==Symbol.prototype?"symbol":typeof Te})(be)}var f=1e4,C=9466848e5;function g(be){try{return JSON.parse(be)}catch(Te){throw x(be),Te}}function b(be){try{return(0,l.m)(be)}catch{return be}}function y(be){return be.replace(/[\u007F-\uFFFF]/g,function(Te){return"\\u"+("0000"+Te.charCodeAt(0).toString(16)).slice(-4)})}function x(be){(c!==void 0?c:JSON).parse(be)}function A(be,Te){for(var De in Te)$e(Te,De)&&(be[De]=Te[De]);return be}function v(be){for(var Te in be)$e(be,Te)&&delete be[Te];return be}function _(be){return be===null?"null":be===void 0?"undefined":be instanceof Number||typeof be=="number"?"number":be instanceof String||typeof be=="string"?"string":be instanceof Boolean||typeof be=="boolean"?"boolean":be instanceof RegExp?"regexp":E(be)?"array":"object"}var I=/^https?:\/\/\S+$/;function T(be){return(typeof be=="string"||be instanceof String)&&I.test(be)}function E(be){return Object.prototype.toString.call(be)==="[object Array]"}function w(be){return be.ownerDocument.defaultView}function S(be){return be.getBoundingClientRect().left+window.pageXOffset||document.scrollLeft||0}function P(be){return be.getBoundingClientRect().top+window.pageYOffset||document.scrollTop||0}function k(be,Te){var De=be.className.split(" ");De.indexOf(Te)===-1&&(De.push(Te),be.className=De.join(" "))}function L(be){be.className=""}function R(be,pe){var De=be.className.split(" "),pe=De.indexOf(pe);pe!==-1&&(De.splice(pe,1),be.className=De.join(" "))}function N(be){for(var Te=be.childNodes,De=0,pe=Te.length;De<pe;De++){var Ce=Te[De],he=(Ce.style&&Ce.removeAttribute("style"),Ce.attributes);if(he)for(var We=he.length-1;0<=We;We--){var It=he[We];It.specified===!0&&Ce.removeAttribute(It.name)}N(Ce)}}function F(be){var Te;document.createRange&&((Te=document.createRange()).selectNodeContents(be),Te.collapse(!1),(be=window.getSelection()).removeAllRanges(),be.addRange(Te))}function H(be){var Te;be&&be.nodeName==="DIV"&&window.getSelection&&document.createRange&&((Te=document.createRange()).selectNodeContents(be),(be=window.getSelection()).removeAllRanges(),be.addRange(Te))}function V(){if(window.getSelection){var be=window.getSelection();if(be.getRangeAt&&be.rangeCount)return be.getRangeAt(0)}return null}function q(be){var Te;be&&window.getSelection&&((Te=window.getSelection()).removeAllRanges(),Te.addRange(be))}function Q(){var be=V();return be&&"startOffset"in be&&"endOffset"in be&&be.startContainer&&be.startContainer===be.endContainer?{startOffset:be.startOffset,endOffset:be.endOffset,container:be.startContainer.parentNode}:null}function O(be){var Te;document.createRange&&window.getSelection&&window.getSelection()&&(Te=document.createRange(),be.container.firstChild||be.container.appendChild(document.createTextNode("")),Te.setStart(be.container.firstChild,be.startOffset),Te.setEnd(be.container.firstChild,be.endOffset),q(Te))}function B(be,Te){var De;if(Te===void 0&&(Te={_text:"",flush:function(){var Yt=this._text;return this._text="",Yt},set:function(Yt){this._text=Yt}}),be.nodeValue)return(De=j(be.nodeValue))!==""?Te.flush()+De:"";if(be.hasChildNodes()){for(var pe=be.childNodes,Ce="",he=0,We=pe.length;he<We;he++){var It,St=pe[he];St.nodeName==="DIV"||St.nodeName==="P"?((It=(It=pe[he-1])?It.nodeName:void 0)&&It!=="DIV"&&It!=="P"&&It!=="BR"&&(Ce!==""&&(Ce+=`
`),Te.flush()),Ce+=B(St,Te),Te.set(`
`)):St.nodeName==="BR"?(Ce+=Te.flush(),Te.set(`
`)):Ce+=B(St,Te)}return Ce}return""}function j(be){return be.replace(/(\b|^)\s*(\b|$)/g,function(Te){return/\n/.exec(Te)?"":Te})}function U(be,Te){for(var De=be?be.parentNode:void 0;De;){if(De===Te)return!0;De=De.parentNode}return!1}function z(){var be;return $===-1&&(be=-1,typeof navigator<"u"&&navigator.appName==="Microsoft Internet Explorer"&&/MSIE ([0-9]+[.0-9]+)/.exec(navigator.userAgent)!=null&&(be=parseFloat(RegExp.$1)),$=be),$}var $=-1;function Z(){return typeof navigator<"u"&&navigator.userAgent.indexOf("Firefox")!==-1}function J(be,Te,De,pe){return be.addEventListener?(pe===void 0&&(pe=!1),Te==="mousewheel"&&Z()&&(Te="DOMMouseScroll"),be.addEventListener(Te,De,pe),De):be.attachEvent?(be.attachEvent("on"+Te,pe=function(){return De.call(be,window.event)}),pe):void 0}function ie(be,Te,De,pe){be.removeEventListener?(pe===void 0&&(pe=!1),Te==="mousewheel"&&Z()&&(Te="DOMMouseScroll"),be.removeEventListener(Te,De,pe)):be.detachEvent&&be.detachEvent("on"+Te,De)}function ne(be,Te){for(var De=be.parentNode;De;){if(De===Te)return!0;De=De.parentNode}return!1}function le(be){var Te=[],De=0;function pe(he){for(var We="";be[De]!==void 0&&be[De]!==he;)We+=be[De],De++;if(be[De]!==he)throw new Error("Invalid JSON path: unexpected end, character "+he+" expected");return We}for(;be[De]!==void 0;)if(be[De]===".")De++,Te.push(function(){for(var he="";be[De]!==void 0&&/[\w$]/.test(be[De]);)he+=be[De],De++;if(he==="")throw new Error("Invalid JSON path: property name expected at index "+De);return he}());else{if(be[De]!=="[")throw new Error('Invalid JSON path: unexpected character "'+be[De]+'" at index '+De);if(be[++De]==="'"||be[De]==='"'){var Ce=be[De];if(De++,Te.push(pe(Ce)),be[De]!==Ce)throw new Error("Invalid JSON path: closing quote ' expected at index "+De);De++}else{if(Ce=pe("]").trim(),Ce.length===0)throw new Error("Invalid JSON path: array value expected at index "+De);Ce=Ce==="*"?Ce:JSON.parse(Ce),Te.push(Ce)}if(be[De]!=="]")throw new Error("Invalid JSON path: closing bracket ] expected at index "+De);De++}return Te}function ee(be){return be.map(function(Te){return typeof Te=="number"?"["+Te+"]":typeof Te=="string"&&Te.match(/^[A-Za-z0-9_$]+$/)?"."+Te:'["'+Te+'"]'}).join("")}function oe(be){var Te,De;return be.keyword==="enum"&&Array.isArray(be.schema)&&(De=be.schema)&&(5<(De=De.map(function(pe){return JSON.stringify(pe)})).length&&(Te=["("+(De.length-5)+" more...)"],(De=De.slice(0,5)).push(Te)),be.message="should be equal to one of: "+De.join(", ")),be.keyword==="additionalProperties"&&(be.message="should NOT have additional property: "+be.params.additionalProperty),be}function te(be){return be&&typeof be.then=="function"&&typeof be.catch=="function"}function X(be){return h(be)==="object"&&Array.isArray(be.path)&&typeof be.message=="string"}function W(be,Te,De){return De=De!==void 0?De:0,Te.left-De>=be.left&&Te.right+De<=be.right&&Te.top-De>=be.top&&Te.bottom+De<=be.bottom}function K(be,Te,De){var pe;return function(){var Ce=this,he=arguments,We=De&&!pe;clearTimeout(pe),pe=setTimeout(function(){pe=null,De||be.apply(Ce,he)},Te),We&&be.apply(Ce,he)}}function re(be,Te){for(var De=Te.length,pe=0,Ce=be.length,he=Te.length;Te.charAt(pe)===be.charAt(pe)&&pe<De;)pe++;for(;Te.charAt(he-1)===be.charAt(Ce-1)&&pe<he&&0<Ce;)he--,Ce--;return{start:pe,end:he}}function se(be){var Te,De,pe,Ce,he=0,We=0;return typeof be.selectionStart=="number"&&typeof be.selectionEnd=="number"?(he=be.selectionStart,We=be.selectionEnd):(Ce=document.selection.createRange())&&Ce.parentElement()===be&&(pe=be.value.length,Te=be.value.replace(/\r\n/g,`
`),(De=be.createTextRange()).moveToBookmark(Ce.getBookmark()),(Ce=be.createTextRange()).collapse(!1),-1<De.compareEndPoints("StartToEnd",Ce)?he=We=pe:(he=-De.moveStart("character",-pe),he+=Te.slice(0,he).split(`
`).length-1,-1<De.compareEndPoints("EndToEnd",Ce)?We=pe:(We=-De.moveEnd("character",-pe),We+=Te.slice(0,We).split(`
`).length-1))),{startIndex:he,endIndex:We,start:It(he),end:It(We)};function It(St){return St=be.value.substring(0,St),{row:(St.match(/\n/g)||[]).length+1,column:St.length-St.lastIndexOf(`
`)}}}function me(pe,Te,De){var pe=pe.value||"";return 0<Te&&0<De?(pe=pe.split(`
`,Te),Te=Math.min(pe.length,Te),De=Math.min(pe[Te-1].length,De-1),De=Te===1?De:De+1,pe.slice(0,Te-1).join(`
`).length+De):-1}function Y(be,Te){var De,pe=[];if(Te&&Te.length){try{De=u.parse(be)}catch{return pe}Te.forEach(function(Ce){var he=ae(le(Ce)),he=De.pointers[he];he&&pe.push({path:Ce,line:he.key?he.key.line:he.value?he.value.line:0,column:he.key?he.key.column:he.value?he.value.column:0})})}return pe}function ae(be){return be.map(function(Te){return"/"+String(Te).replace(/~/g,"~0").replace(/\//g,"~1")}).join("")}function ve(be){var Te=document.createElement("div");return Te.style.color=be,Te.style.color.split(/\s+/).join("").toLowerCase()||null}function ge(be){return!!ve(be)}function Se(be,Te){var De;return be?(De="",be.title&&(De+=be.title),be.description&&(0<De.length&&(De+=`
`),De+=be.description),be.default&&(0<De.length&&(De+=`

`),De=(De+=(0,d.Tl)("default",void 0,Te)+`
`)+JSON.stringify(be.default,null,2)),Array.isArray(be.examples)&&0<be.examples.length&&(0<De.length&&(De+=`

`),De+=(0,d.Tl)("examples",void 0,Te)+`
`,be.examples.forEach(function(pe,Ce){De+=JSON.stringify(pe,null,2),Ce!==be.examples.length-1&&(De+=`
`)})),De):""}function Ee(be,Te){for(var De=be,pe=0;pe<Te.length&&De!=null;pe++)De=De[Te[pe]];return De}function Fe(be,Te){for(var De=be.replace(/ \(copy( \d+)?\)$/,""),pe=De,Ce=1;Te.indexOf(pe)!==-1;)pe=De+" ("+("copy"+(1<Ce?" "+Ce:""))+")",Ce++;return pe}function Ae(be,Te){var De={};if(Array.isArray(be))for(var pe=Math.min(be.length,f),Ce=0;Ce<pe;Ce++)(function he(We,It,St,Yt){(Array.isArray(We)||je(We))&&!Yt||(It[St||""]=!0),je(We)&&Object.keys(We).forEach(function(sr){he(We[sr],It,St+"."+sr,Yt)})})(be[Ce],De,"",Te);else De[""]=!0;return Object.keys(De).sort()}function we(be,he,De){var pe=he&&he!=="."?le(he):[],Ce=De==="desc"?-1:1,he=be.slice();return he.sort(function(We,It){return We=Ee(We,pe),It=Ee(It,pe),Ce*(It<We?1:We<It?-1:0)}),he}function _e(be,pe){var De=pe==="desc"?-1:1,pe=Object.keys(be).sort(function(he,We){return De*a()(he,We)}),Ce={};return pe.forEach(function(he){Ce[he]=be[he]}),Ce}function Ke(be){var Te,De;return be===""?"":(Te=be.toLowerCase())==="null"?null:Te==="true"||Te!=="false"&&(/^0\d+$/.test(be)||(Te=Number(be),De=parseFloat(be),isNaN(Te))||isNaN(De)?be:Te)}function rt(be,Te){return typeof Te=="number"&&C<Te&&isFinite(Te)&&Math.floor(Te)===Te&&!isNaN(new Date(Te).valueOf())}function pt(be){return be<900?be.toFixed()+" B":(be=be/1e3)<900?be.toFixed(1)+" KB":(be=be/1e3)<900?be.toFixed(1)+" MB":(be=be/1e3)<900?be.toFixed(1)+" GB":(be/1e3).toFixed(1)+" TB"}function Ne(be,Te){return be.length<=Te?be:be.slice(0,Te)+"..."}function je(be){return h(be)==="object"&&be!==null&&!Array.isArray(be)}function Ye(be,Te){return be.indexOf(Te)!==-1}function mt(be,Te){if(Te||be){if(Te&&!be||!Te&&be||Te.length!==be.length)return!0;for(var De,pe=0;pe<be.length;++pe)if(De=function(Ce){var he=be[Ce].type==="error"?Te.find(function(We){return We.line===be[Ce].line}):Te.find(function(We){return We.dataPath===be[Ce].dataPath&&We.schemaPath===be[Ce].schemaPath});if(!he)return{v:!0}}(pe))return De.v}return!1}function vt(be,Te){return be=be!=null&&be.length?be:[],Te=Te!=null&&Te.length?Te:[],m(new Set(be.concat(Te)))}function yt(be){setTimeout(be)}function $e(be,Te){return Object.prototype.hasOwnProperty.call(be,Te)}},1746:function(n,o,i){var s;if(window.Picker)s=window.Picker;else try{s=i(7598)}catch{}n.exports=s},6990:function(n,o,i){function s(h,f){var C,g;return f=p(h,f),(h=u.modules[f])||(typeof(h=u.payloads[f])=="function"&&(C={id:f,uri:"",exports:g={},packaged:!0},g=h(function(b,y){return d(f,b,y)},g,C)||C.exports,u.modules[f]=g,delete u.payloads[f]),h=u.modules[f]=g||h),h}var a,l,c,u,d,m,p;n=i.nmd(n),(c=function(){return this}())||typeof window>"u"||(c=window),(u=function(h,f,C){typeof h!="string"?u.original&&u.original.apply(this,arguments):(arguments.length==2&&(C=f),u.modules[h]||(u.payloads[h]=C,u.modules[h]=null))}).modules={},u.payloads={},d=function(h,f,C){if(typeof f=="string"){var g=s(h,f);if(g!=null)return C&&C(),g}else if(Object.prototype.toString.call(f)==="[object Array]"){for(var b=[],y=0,x=f.length;y<x;++y){var A=s(h,f[y]);if(A==null&&m.original)return;b.push(A)}return C&&C.apply(null,b)||!0}},m=function(h,f){var C=d("",h,f);return C==null&&m.original?m.original.apply(this,arguments):C},p=function(h,f){var C;if(f.indexOf("!")!==-1)return C=f.split("!"),p(h,C[0])+"!"+p(h,C[1]);if(f.charAt(0)==".")for(f=h.split("/").slice(0,-1).join("/")+"/"+f;f.indexOf(".")!==-1&&g!=f;){var g=f;f=f.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}return f},l=c,(a="ace")&&(c[a]||(c[a]={}),l=c[a]),l.define&&l.define.packaged||(u.original=l.define,l.define=u,l.define.packaged=!0),l.require&&l.require.packaged||(m.original=l.require,l.require=m,l.require.packaged=!0),ace.define("ace/lib/es6-shim",["require","exports","module"],function(h,f,C){function g(b,y,x){Object.defineProperty(b,y,{value:x,enumerable:!1,writable:!0,configurable:!0})}String.prototype.startsWith||g(String.prototype,"startsWith",function(b,y){return this.lastIndexOf(b,y=y||0)===y}),String.prototype.endsWith||g(String.prototype,"endsWith",function(b,y){return(y===void 0||y>this.length)&&(y=this.length),y-=b.length,b=this.indexOf(b,y),b!==-1&&b===y}),String.prototype.repeat||g(String.prototype,"repeat",function(b){for(var y="",x=this;0<b;)1&b&&(y+=x),(b>>=1)&&(x+=x);return y}),String.prototype.includes||g(String.prototype,"includes",function(b,y){return this.indexOf(b,y)!=-1}),Object.assign||(Object.assign=function(b){if(b==null)throw new TypeError("Cannot convert undefined or null to object");for(var y=Object(b),x=1;x<arguments.length;x++){var A=arguments[x];A!=null&&Object.keys(A).forEach(function(v){y[v]=A[v]})}return y}),Object.values||(Object.values=function(b){return Object.keys(b).map(function(y){return b[y]})}),Array.prototype.find||g(Array.prototype,"find",function(b){for(var y=this.length,x=arguments[1],A=0;A<y;A++){var v=this[A];if(b.call(x,v,A,this))return v}}),Array.prototype.findIndex||g(Array.prototype,"findIndex",function(b){for(var y=this.length,x=arguments[1],A=0;A<y;A++){var v=this[A];if(b.call(x,v,A,this))return A}}),Array.prototype.includes||g(Array.prototype,"includes",function(b,y){return this.indexOf(b,y)!=-1}),Array.prototype.fill||g(Array.prototype,"fill",function(b){for(var y=this.length>>>0,A=arguments[1]>>0,x=A<0?Math.max(y+A,0):Math.min(A,y),A=arguments[2],A=A===void 0?y:A>>0,v=A<0?Math.max(y+A,0):Math.min(A,y);x<v;)this[x]=b,x++;return this}),Array.of||g(Array,"of",function(){return Array.prototype.slice.call(arguments)})}),ace.define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/es6-shim"],function(h,f,C){"use strict";h("./es6-shim")}),ace.define("ace/lib/deep_copy",["require","exports","module"],function(h,f,C){f.deepCopy=function g(b){if(typeof b!="object"||!b)return b;if(Array.isArray(b))for(var y=[],x=0;x<b.length;x++)y[x]=g(b[x]);else{if(Object.prototype.toString.call(b)!=="[object Object]")return b;for(var x in y={},b)y[x]=g(b[x])}return y}}),ace.define("ace/lib/lang",["require","exports","module","ace/lib/deep_copy"],function(h,f,C){"use strict";f.last=function(y){return y[y.length-1]},f.stringReverse=function(y){return y.split("").reverse().join("")},f.stringRepeat=function(y,x){for(var A="";0<x;)1&x&&(A+=y),(x>>=1)&&(y+=y);return A};var g=/^\s\s*/,b=/\s\s*$/;f.stringTrimLeft=function(y){return y.replace(g,"")},f.stringTrimRight=function(y){return y.replace(b,"")},f.copyObject=function(y){var x,A={};for(x in y)A[x]=y[x];return A},f.copyArray=function(y){for(var x=[],A=0,v=y.length;A<v;A++)y[A]&&typeof y[A]=="object"?x[A]=this.copyObject(y[A]):x[A]=y[A];return x},f.deepCopy=h("./deep_copy").deepCopy,f.arrayToMap=function(y){for(var x={},A=0;A<y.length;A++)x[y[A]]=1;return x},f.createMap=function(y){var x,A=Object.create(null);for(x in y)A[x]=y[x];return A},f.arrayRemove=function(y,x){for(var A=0;A<=y.length;A++)x===y[A]&&y.splice(A,1)},f.escapeRegExp=function(y){return y.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},f.escapeHTML=function(y){return(""+y).replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")},f.getMatchOffsets=function(y,x){var A=[];return y.replace(x,function(v){A.push({offset:arguments[arguments.length-2],length:v.length})}),A},f.deferredCall=function(y){function x(){v=null,y()}function A(_){return A.cancel(),v=setTimeout(x,_||0),A}var v=null;return(A.schedule=A).call=function(){return this.cancel(),y(),A},A.cancel=function(){return clearTimeout(v),v=null,A},A.isPending=function(){return v},A},f.delayedCall=function(y,x){function A(){_=null,y()}function v(I){_==null&&(_=setTimeout(A,I||x))}var _=null;return v.delay=function(I){_&&clearTimeout(_),_=setTimeout(A,I||x)},(v.schedule=v).call=function(){this.cancel(),y()},v.cancel=function(){_&&clearTimeout(_),_=null},v.isPending=function(){return _},v},f.supportsLookbehind=function(){try{new RegExp("(?<=.)")}catch{return!1}return!0},f.skipEmptyMatch=function(y,x,A){return A&&65535<y.codePointAt(x)?2:1}}),ace.define("ace/lib/useragent",["require","exports","module"],function(h,f,C){"use strict";f.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},f.getOS=function(){return f.isMac?f.OS.MAC:f.isLinux?f.OS.LINUX:f.OS.WINDOWS};var y=typeof navigator=="object"?navigator:{},g=(/mac|win|linux/i.exec(y.platform)||["other"])[0].toLowerCase(),b=y.userAgent||"",y=y.appName||"";f.isWin=g=="win",f.isMac=g=="mac",f.isLinux=g=="linux",f.isIE=y=="Microsoft Internet Explorer"||0<=y.indexOf("MSAppHost")?parseFloat((b.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]):parseFloat((b.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]),f.isOldIE=f.isIE&&f.isIE<9,f.isGecko=f.isMozilla=b.match(/ Gecko\/\d+/),f.isOpera=typeof opera=="object"&&Object.prototype.toString.call(window.opera)=="[object Opera]",f.isWebKit=parseFloat(b.split("WebKit/")[1])||void 0,f.isChrome=parseFloat(b.split(" Chrome/")[1])||void 0,f.isSafari=parseFloat(b.split(" Safari/")[1])&&!f.isChrome||void 0,f.isEdge=parseFloat(b.split(" Edge/")[1])||void 0,f.isAIR=0<=b.indexOf("AdobeAIR"),f.isAndroid=0<=b.indexOf("Android"),f.isChromeOS=0<=b.indexOf(" CrOS "),f.isIOS=/iPad|iPhone|iPod/.test(b)&&!window.MSStream,f.isIOS&&(f.isMac=!0),f.isMobile=f.isIOS||f.isAndroid}),ace.define("ace/lib/dom",["require","exports","module","ace/lib/useragent"],function(y,f,C){"use strict";var g,b,y=y("./useragent"),x=(f.buildDom=function _(I,T,E){if(typeof I=="string"&&I)return R=document.createTextNode(I),T&&T.appendChild(R),R;if(!Array.isArray(I))return I&&I.appendChild&&T&&T.appendChild(I),I;if(typeof I[0]!="string"||!I[0]){for(var w=[],S=0;S<I.length;S++){var P=_(I[S],T,E);P&&w.push(P)}return w}for(var k=document.createElement(I[0]),L=I[1],R=1,S=R=L&&typeof L=="object"&&!Array.isArray(L)?2:R;S<I.length;S++)_(I[S],k,E);return R==2&&Object.keys(L).forEach(function(N){var F=L[N];N==="class"?k.className=Array.isArray(F)?F.join(" "):F:typeof F=="function"||N=="value"||N[0]=="$"?k[N]=F:N==="ref"?E&&(E[F]=k):N==="style"?typeof F=="string"&&(k.style.cssText=F):F!=null&&k.setAttribute(N,F)}),T&&T.appendChild(k),k},f.getDocumentHead=function(_){return(_=_||document).head||_.getElementsByTagName("head")[0]||_.documentElement},f.createElement=function(_,I){return document.createElementNS?document.createElementNS(I||"http://www.w3.org/1999/xhtml",_):document.createElement(_)},f.removeChildren=function(_){_.innerHTML=""},f.createTextNode=function(_,I){return(I?I.ownerDocument:document).createTextNode(_)},f.createFragment=function(_){return(_?_.ownerDocument:document).createDocumentFragment()},f.hasCssClass=function(_,I){return(_.className+"").split(/\s+/g).indexOf(I)!==-1},f.addCssClass=function(_,I){f.hasCssClass(_,I)||(_.className+=" "+I)},f.removeCssClass=function(_,I){for(var T=_.className.split(/\s+/g);;){var E=T.indexOf(I);if(E==-1)break;T.splice(E,1)}_.className=T.join(" ")},f.toggleCssClass=function(_,I){for(var T=_.className.split(/\s+/g),E=!0;;){var w=T.indexOf(I);if(w==-1)break;E=!1,T.splice(w,1)}return E&&T.push(I),_.className=T.join(" "),E},f.setCssClass=function(_,I,T){T?f.addCssClass(_,I):f.removeCssClass(_,I)},f.hasCssString=function(_,I){var T,E=0;if(T=(I=I||document).querySelectorAll("style")){for(;E<T.length;)if(T[E++].id===_)return!0}},f.removeElementById=function(_,I){(I=I||document).getElementById(_)&&I.getElementById(_).remove()},[]);function A(){var _=x;x=null,_&&_.forEach(function(I){v(I[0],I[1])})}function v(_,I,T){if(typeof document<"u"){if(x){if(T)A();else if(T===!1)return x.push([_,I])}if(!g){var E=T,T=(E=T&&T.getRootNode&&(E=T.getRootNode())&&E!=T?E:document).ownerDocument||E;if(I&&f.hasCssString(I,E))return null;I&&(_+=`
/*# sourceURL=ace/css/`+I+" */");var w=f.createElement("style");w.appendChild(T.createTextNode(_)),I&&(w.id=I),(E=E==T?f.getDocumentHead(T):E).insertBefore(w,E.firstChild)}}}f.useStrictCSP=function(_){(g=_)==0?A():x=x||[]},f.importCssString=v,f.importCssStylsheet=function(_,I){f.buildDom(["link",{rel:"stylesheet",href:_}],f.getDocumentHead(I))},f.scrollbarWidth=function(E){var I=f.createElement("ace_inner"),T=(I.style.width="100%",I.style.minWidth="0px",I.style.height="200px",I.style.display="block",f.createElement("ace_outer")),S=T.style,E=(S.position="absolute",S.left="-10000px",S.overflow="hidden",S.width="200px",S.minWidth="0px",S.height="150px",S.display="block",T.appendChild(I),E&&E.documentElement||document&&document.documentElement);if(!E)return 0;E.appendChild(T);var w=I.offsetWidth,S=(S.overflow="scroll",I.offsetWidth);return w===S&&(S=T.clientWidth),E.removeChild(T),w-S},f.computedStyle=function(_,I){return window.getComputedStyle(_,"")||{}},f.setStyle=function(_,I,T){_[I]!==T&&(_[I]=T)},f.HAS_CSS_ANIMATION=!1,f.HAS_CSS_TRANSFORMS=!1,f.HI_DPI=!y.isWin||typeof window<"u"&&1.5<=window.devicePixelRatio,y.isChromeOS&&(f.HI_DPI=!1),typeof document<"u"&&(b=document.createElement("div"),f.HI_DPI&&b.style.transform!==void 0&&(f.HAS_CSS_TRANSFORMS=!0),y.isEdge||b.style.animationName===void 0||(f.HAS_CSS_ANIMATION=!0),b=null),f.HAS_CSS_TRANSFORMS?f.translate=function(_,I,T){_.style.transform="translate("+Math.round(I)+"px, "+Math.round(T)+"px)"}:f.translate=function(_,I,T){_.style.top=Math.round(T)+"px",_.style.left=Math.round(I)+"px"}}),ace.define("ace/lib/net",["require","exports","module","ace/lib/dom"],function(h,f,C){"use strict";var g=h("./dom");f.get=function(b,y){var x=new XMLHttpRequest;x.open("GET",b,!0),x.onreadystatechange=function(){x.readyState===4&&y(x.responseText)},x.send(null)},f.loadScript=function(b,y){var x=g.getDocumentHead(),A=document.createElement("script");A.src=b,x.appendChild(A),A.onload=A.onreadystatechange=function(v,_){!_&&A.readyState&&A.readyState!="loaded"&&A.readyState!="complete"||(A=A.onload=A.onreadystatechange=null,_)||y()}},f.qualifyURL=function(b){var y=document.createElement("a");return y.href=b,y.href}}),ace.define("ace/lib/oop",["require","exports","module"],function(h,f,C){"use strict";f.inherits=function(g,b){g.super_=b,g.prototype=Object.create(b.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})},f.mixin=function(g,b){for(var y in b)g[y]=b[y];return g},f.implement=function(g,b){f.mixin(g,b)}}),ace.define("ace/lib/event_emitter",["require","exports","module"],function(h,f,C){"use strict";function g(){this.propagationStopped=!0}function b(){this.defaultPrevented=!0}var y={};y._emit=y._dispatchEvent=function(x,A){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var v=this._eventRegistry[x]||[],_=this._defaultHandlers[x];if(v.length||_){(A=typeof A=="object"&&A?A:{}).type||(A.type=x),A.stopPropagation||(A.stopPropagation=g),A.preventDefault||(A.preventDefault=b);for(var v=v.slice(),I=0;I<v.length&&(v[I](A,this),!A.propagationStopped);I++);return _&&!A.defaultPrevented?_(A,this):void 0}},y._signal=function(x,A){if(v=(this._eventRegistry||{})[x])for(var v=v.slice(),_=0;_<v.length;_++)v[_](A,this)},y.once=function(x,A){var v=this;if(this.on(x,function _(){v.off(x,_),A.apply(null,arguments)}),!A)return new Promise(function(_){A=_})},y.setDefaultHandler=function(x,A){var v,_,I=this._defaultHandlers;(I=I||(this._defaultHandlers={_disabled_:{}}))[x]&&(_=I[x],(v=I._disabled_[x])||(I._disabled_[x]=v=[]),v.push(_),(_=v.indexOf(A))!=-1)&&v.splice(_,1),I[x]=A},y.removeDefaultHandler=function(x,A){var v,_=this._defaultHandlers;_&&(v=_._disabled_[x],_[x]==A?v&&this.setDefaultHandler(x,v.pop()):v&&(_=v.indexOf(A))!=-1&&v.splice(_,1))},y.on=y.addEventListener=function(x,A,v){this._eventRegistry=this._eventRegistry||{};var _=this._eventRegistry[x];return(_=_||(this._eventRegistry[x]=[])).indexOf(A)==-1&&_[v?"unshift":"push"](A),A},y.off=y.removeListener=y.removeEventListener=function(x,A){this._eventRegistry=this._eventRegistry||{},x=this._eventRegistry[x],x&&(A=x.indexOf(A))!==-1&&x.splice(A,1)},y.removeAllListeners=function(x){x||(this._eventRegistry=this._defaultHandlers=void 0),this._eventRegistry&&(this._eventRegistry[x]=void 0),this._defaultHandlers&&(this._defaultHandlers[x]=void 0)},f.EventEmitter=y}),ace.define("ace/lib/report_error",["require","exports","module"],function(h,f,C){f.reportError=function(g,b){var y=new Error(g);y.data=b,setTimeout(function(){throw y})}}),ace.define("ace/lib/default_english_messages",["require","exports","module"],function(h,f,C){f.defaultEnglishMessages={"autocomplete.popup.aria-roledescription":"Autocomplete suggestions","autocomplete.popup.aria-label":"Autocomplete suggestions","autocomplete.popup.item.aria-roledescription":"item","autocomplete.loading":"Loading...","editor.scroller.aria-roledescription":"editor","editor.scroller.aria-label":"Editor content, press Enter to start editing, press Escape to exit","editor.gutter.aria-roledescription":"editor","editor.gutter.aria-label":"Editor gutter, press Enter to interact with controls using arrow keys, press Escape to exit","error-marker.good-state":"Looks good!","prompt.recently-used":"Recently used","prompt.other-commands":"Other commands","prompt.no-matching-commands":"No matching commands","search-box.find.placeholder":"Search for","search-box.find-all.text":"All","search-box.replace.placeholder":"Replace with","search-box.replace-next.text":"Replace","search-box.replace-all.text":"All","search-box.toggle-replace.title":"Toggle Replace mode","search-box.toggle-regexp.title":"RegExp Search","search-box.toggle-case.title":"CaseSensitive Search","search-box.toggle-whole-word.title":"Whole Word Search","search-box.toggle-in-selection.title":"Search In Selection","search-box.search-counter":"$0 of $1","text-input.aria-roledescription":"editor","text-input.aria-label":"Cursor at row $0","gutter.code-folding.range.aria-label":"Toggle code folding, rows $0 through $1","gutter.code-folding.closed.aria-label":"Toggle code folding, rows $0 through $1","gutter.code-folding.open.aria-label":"Toggle code folding, row $0","gutter.code-folding.closed.title":"Unfold code","gutter.code-folding.open.title":"Fold code","gutter.annotation.aria-label.error":"Error, read annotations row $0","gutter.annotation.aria-label.warning":"Warning, read annotations row $0","gutter.annotation.aria-label.info":"Info, read annotations row $0","inline-fold.closed.title":"Unfold code","gutter-tooltip.aria-label.error.singular":"error","gutter-tooltip.aria-label.error.plural":"errors","gutter-tooltip.aria-label.warning.singular":"warning","gutter-tooltip.aria-label.warning.plural":"warnings","gutter-tooltip.aria-label.info.singular":"information message","gutter-tooltip.aria-label.info.plural":"information messages"}}),ace.define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/lib/report_error","ace/lib/default_english_messages"],function(h,f,C){var g,b=h("./oop"),y=h("./event_emitter").EventEmitter,x=h("./report_error").reportError,A=h("./default_english_messages").defaultEnglishMessages,v={setOptions:function(T){Object.keys(T).forEach(function(E){this.setOption(E,T[E])},this)},getOptions:function(T){var E,w={};return T?Array.isArray(T)||(w=T,T=Object.keys(w)):(E=this.$options,T=Object.keys(E).filter(function(S){return!E[S].hidden})),T.forEach(function(S){w[S]=this.getOption(S)},this),w},setOption:function(T,E){var w;if(this["$"+T]!==E)return(w=this.$options[T])?w.forwardTo?this[w.forwardTo]&&this[w.forwardTo].setOption(T,E):(w.handlesSet||(this["$"+T]=E),void(w&&w.set&&w.set.call(this,E))):_('misspelled option "'+T+'"')},getOption:function(T){var E=this.$options[T];return E?E.forwardTo?this[E.forwardTo]&&this[E.forwardTo].getOption(T):E&&E.get?E.get.call(this):this["$"+T]:_('misspelled option "'+T+'"')}};function _(T){typeof console<"u"}I.prototype.defineOptions=function(T,E,w){return T.$options||(this.$defaultOptions[E]=T.$options={}),Object.keys(w).forEach(function(S){var P=w[S];(P=typeof P=="string"?{forwardTo:P}:P).name||(P.name=S),"initialValue"in(T.$options[P.name]=P)&&(T["$"+P.name]=P.initialValue)}),b.implement(T,v),this},I.prototype.resetOptions=function(T){Object.keys(T.$options).forEach(function(E){var w=T.$options[E];"value"in w&&T.setOption(E,w.value)})},I.prototype.setDefaultValue=function(T,E,w){if(!T){for(T in this.$defaultOptions)if(this.$defaultOptions[T][E])break;if(!this.$defaultOptions[T][E])return!1}var S=this.$defaultOptions[T]||(this.$defaultOptions[T]={});S[E]&&(S.forwardTo?this.setDefaultValue(S.forwardTo,E,w):S[E].value=w)},I.prototype.setDefaultValues=function(T,E){Object.keys(E).forEach(function(w){this.setDefaultValue(T,w,E[w])},this)},I.prototype.setMessages=function(T){g=T},I.prototype.nls=function(T,E,w){return g[T]||(_("No message found for the key '"+T+"' in the provided messages, trying to find a translation for the default string '"+E+"'."),g[E])||_("No message found for the default string '"+E+"' in the provided messages. Falling back to the default English message."),T=g[T]||g[E]||E,T=w?T.replace(/\$(\$|[\d]+)/g,function(S,P){return P=="$"?"$":w[P]}):T},h=I;function I(){this.$defaultOptions={},g=A}h.prototype.warn=_,h.prototype.reportError=x,b.implement(h.prototype,y),f.AppConfig=h}),ace.define("ace/theme/textmate-css",["require","exports","module"],function(h,f,C){C.exports=`.ace-tm .ace_gutter {
  background: #f0f0f0;
  color: #333;
}

.ace-tm .ace_print-margin {
  width: 1px;
  background: #e8e8e8;
}

.ace-tm .ace_fold {
    background-color: #6B72E6;
}

.ace-tm {
  background-color: #FFFFFF;
  color: black;
}

.ace-tm .ace_cursor {
  color: black;
}
        
.ace-tm .ace_invisible {
  color: rgb(191, 191, 191);
}

.ace-tm .ace_storage,
.ace-tm .ace_keyword {
  color: blue;
}

.ace-tm .ace_constant {
  color: rgb(197, 6, 11);
}

.ace-tm .ace_constant.ace_buildin {
  color: rgb(88, 72, 246);
}

.ace-tm .ace_constant.ace_language {
  color: rgb(88, 92, 246);
}

.ace-tm .ace_constant.ace_library {
  color: rgb(6, 150, 14);
}

.ace-tm .ace_invalid {
  background-color: rgba(255, 0, 0, 0.1);
  color: red;
}

.ace-tm .ace_support.ace_function {
  color: rgb(60, 76, 114);
}

.ace-tm .ace_support.ace_constant {
  color: rgb(6, 150, 14);
}

.ace-tm .ace_support.ace_type,
.ace-tm .ace_support.ace_class {
  color: rgb(109, 121, 222);
}

.ace-tm .ace_keyword.ace_operator {
  color: rgb(104, 118, 135);
}

.ace-tm .ace_string {
  color: rgb(3, 106, 7);
}

.ace-tm .ace_comment {
  color: rgb(76, 136, 107);
}

.ace-tm .ace_comment.ace_doc {
  color: rgb(0, 102, 255);
}

.ace-tm .ace_comment.ace_doc.ace_tag {
  color: rgb(128, 159, 191);
}

.ace-tm .ace_constant.ace_numeric {
  color: rgb(0, 0, 205);
}

.ace-tm .ace_variable {
  color: rgb(49, 132, 149);
}

.ace-tm .ace_xml-pe {
  color: rgb(104, 104, 91);
}

.ace-tm .ace_entity.ace_name.ace_function {
  color: #0000A2;
}


.ace-tm .ace_heading {
  color: rgb(12, 7, 255);
}

.ace-tm .ace_list {
  color:rgb(185, 6, 144);
}

.ace-tm .ace_meta.ace_tag {
  color:rgb(0, 22, 142);
}

.ace-tm .ace_string.ace_regex {
  color: rgb(255, 0, 0)
}

.ace-tm .ace_marker-layer .ace_selection {
  background: rgb(181, 213, 255);
}
.ace-tm.ace_multiselect .ace_selection.ace_start {
  box-shadow: 0 0 3px 0px white;
}
.ace-tm .ace_marker-layer .ace_step {
  background: rgb(252, 255, 0);
}

.ace-tm .ace_marker-layer .ace_stack {
  background: rgb(164, 229, 101);
}

.ace-tm .ace_marker-layer .ace_bracket {
  margin: -1px 0 0 -1px;
  border: 1px solid rgb(192, 192, 192);
}

.ace-tm .ace_marker-layer .ace_active-line {
  background: rgba(0, 0, 0, 0.07);
}

.ace-tm .ace_gutter-active-line {
    background-color : #dcdcdc;
}

.ace-tm .ace_marker-layer .ace_selected-word {
  background: rgb(250, 250, 255);
  border: 1px solid rgb(200, 200, 250);
}

.ace-tm .ace_indent-guide {
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;
}

.ace-tm .ace_indent-guide-active {
  background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAAZSURBVHjaYvj///9/hivKyv8BAAAA//8DACLqBhbvk+/eAAAAAElFTkSuQmCC") right repeat-y;
}
`}),ace.define("ace/theme/textmate",["require","exports","module","ace/theme/textmate-css","ace/lib/dom"],function(h,f,C){"use strict";f.isDark=!1,f.cssClass="ace-tm",f.cssText=h("./textmate-css"),f.$id="ace/theme/textmate",h("../lib/dom").importCssString(f.cssText,f.cssClass,!1)}),ace.define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/net","ace/lib/dom","ace/lib/app_config","ace/theme/textmate"],function(h,f,C){var g,b=h("./lib/lang"),y=h("./lib/net"),x=h("./lib/dom"),A=h("./lib/app_config").AppConfig,v=(C.exports=f=new A,{packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{},loadWorkerFromBlob:!0,sharedPopups:!1,useStrictCSP:null}),_=(f.get=function(I){if(v.hasOwnProperty(I))return v[I];throw new Error("Unknown config key: "+I)},f.set=function(I,T){if(v.hasOwnProperty(I))v[I]=T;else if(this.setDefaultValue("",I,T)==0)throw new Error("Unknown config key: "+I);I=="useStrictCSP"&&x.useStrictCSP(T)},f.all=function(){return b.copyObject(v)},f.$modes={},f.moduleUrl=function(I,T){var E,w,S;return v.$moduleUrls[I]||(I=I.split("/"),E=(T=T||I[I.length-2]||"")=="snippets"?"/":"-",w=I[I.length-1],T=="worker"&&E=="-"&&(S=new RegExp("^"+T+"[\\-_]|[\\-_]"+T+"$","g"),w=w.replace(S,"")),(!w||w==T)&&1<I.length&&(w=I[I.length-2]),(S=v[T+"Path"])==null?S=v.basePath:E=="/"&&(T=E=""),S&&S.slice(-1)!="/"&&(S+="/"),S+T+E+w+this.get("suffix"))},f.setModuleUrl=function(I,T){return v.$moduleUrls[I]=T},f.setLoader=function(I){g=I},f.dynamicModules=Object.create(null),f.$loading={},f.$loaded={},f.loadModule=function(I,T){function E(k){if(k&&!f.$loading[P])return T&&T(k);if(f.$loading[P]||(f.$loading[P]=[]),f.$loading[P].push(T),!(1<f.$loading[P].length)){let R=function(){var N,F;F=function(H,V){V&&(f.$loaded[P]=V),f._emit("load.module",{name:P,module:V});var q=f.$loading[P];f.$loading[P]=null,q.forEach(function(Q){Q&&Q(V)})},(N=P)==="ace/theme/textmate"||N==="./theme/textmate"?F(null,h("./theme/textmate")):g&&g(N,F)};var L=R;if(!f.get("packaged"))return R();y.loadScript(f.moduleUrl(P,S),R),_()}}var w,S,P;if(Array.isArray(I)?(S=I[0],P=I[1]):typeof I=="string"&&(P=I),f.dynamicModules[P])f.dynamicModules[P]().then(function(k){k.default?E(k.default):E(k)});else{try{w=this.$require(P)}catch{}E(w||f.$loaded[P])}},f.$require=function(I){if(typeof C.require=="function")return C.require(I)},f.setModuleLoader=function(I,T){f.dynamicModules[I]=T},function(){v.basePath||v.workerPath||v.modePath||v.themePath||Object.keys(v.$moduleUrls).length||(_=function(){})});f.version="1.33.1"}),ace.define("ace/loader_build",["require","exports","module","ace/lib/fixoldbrowsers","ace/config"],function(h,f,C){"use strict";h("./lib/fixoldbrowsers");var g=h("./config"),b=(g.setLoader(function(x,A){h([x],function(v){A(null,v)})}),function(){return this||typeof window<"u"&&window}());function y(x){if(b&&b.document){g.set("packaged",x||h.packaged||C.packaged||b.define&&i.amdD.packaged);for(var A,v={},_="",x=document.currentScript||document._currentScript,I=x&&x.ownerDocument||document,T=(x&&x.src&&(_=x.src.split(/[?#]/)[0].split("/").slice(0,-1).join("/")||""),I.getElementsByTagName("script")),E=0;E<T.length;E++){var w=T[E],S=w.src||w.getAttribute("src");if(S){for(var P=w.attributes,k=0,L=P.length;k<L;k++){var R=P[k];R.name.indexOf("data-ace-")===0&&(v[R.name.replace(/^data-ace-/,"").replace(/-(.)/g,function(F,H){return H.toUpperCase()})]=R.value)}w=S.match(/^(.*)\/ace([\-.]\w+)?\.js(\?|$)/),w&&(_=w[1])}}for(A in _&&(v.base=v.base||_,v.packaged=!0),v.basePath=v.base,v.workerPath=v.workerPath||v.base,v.modePath=v.modePath||v.base,v.themePath=v.themePath||v.base,delete v.base,v)v[A]!==void 0&&g.set(A,v[A])}}C.exports=function(x){g.init=y,g.$require=h,x.require=h,x.define=i.amdD},y(!0)}),ace.define("ace/range",["require","exports","module"],function(h,f,C){"use strict";b.prototype.isEqual=function(y){return this.start.row===y.start.row&&this.end.row===y.end.row&&this.start.column===y.start.column&&this.end.column===y.end.column},b.prototype.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},b.prototype.contains=function(y,x){return this.compare(y,x)==0},b.prototype.compareRange=function(x){var A=x.end,x=x.start,A=this.compare(A.row,A.column);return A==1?(A=this.compare(x.row,x.column))==1?2:A==0?1:0:A==-1?-2:(A=this.compare(x.row,x.column))==-1?-1:A==1?42:0},b.prototype.comparePoint=function(y){return this.compare(y.row,y.column)},b.prototype.containsRange=function(y){return this.comparePoint(y.start)==0&&this.comparePoint(y.end)==0},b.prototype.intersects=function(y){return y=this.compareRange(y),y==-1||y==0||y==1},b.prototype.isEnd=function(y,x){return this.end.row==y&&this.end.column==x},b.prototype.isStart=function(y,x){return this.start.row==y&&this.start.column==x},b.prototype.setStart=function(y,x){typeof y=="object"?(this.start.column=y.column,this.start.row=y.row):(this.start.row=y,this.start.column=x)},b.prototype.setEnd=function(y,x){typeof y=="object"?(this.end.column=y.column,this.end.row=y.row):(this.end.row=y,this.end.column=x)},b.prototype.inside=function(y,x){return this.compare(y,x)==0&&!this.isEnd(y,x)&&!this.isStart(y,x)},b.prototype.insideStart=function(y,x){return this.compare(y,x)==0&&!this.isEnd(y,x)},b.prototype.insideEnd=function(y,x){return this.compare(y,x)==0&&!this.isStart(y,x)},b.prototype.compare=function(y,x){return this.isMultiLine()||y!==this.start.row?y<this.start.row?-1:y>this.end.row?1:this.start.row===y?x>=this.start.column?0:-1:this.end.row!==y||x<=this.end.column?0:1:x<this.start.column?-1:x>this.end.column?1:0},b.prototype.compareStart=function(y,x){return this.start.row==y&&this.start.column==x?-1:this.compare(y,x)},b.prototype.compareEnd=function(y,x){return this.end.row==y&&this.end.column==x?1:this.compare(y,x)},b.prototype.compareInside=function(y,x){return this.end.row==y&&this.end.column==x?1:this.start.row==y&&this.start.column==x?-1:this.compare(y,x)},b.prototype.clipRows=function(y,x){var A,v;return this.end.row>x?A={row:x+1,column:0}:this.end.row<y&&(A={row:y,column:0}),this.start.row>x?v={row:x+1,column:0}:this.start.row<y&&(v={row:y,column:0}),b.fromPoints(v||this.start,A||this.end)},b.prototype.extend=function(y,x){var A,v,_=this.compare(y,x);return _==0?this:(_==-1?A={row:y,column:x}:v={row:y,column:x},b.fromPoints(A||this.start,v||this.end))},b.prototype.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},b.prototype.isMultiLine=function(){return this.start.row!==this.end.row},b.prototype.clone=function(){return b.fromPoints(this.start,this.end)},b.prototype.collapseRows=function(){return this.end.column==0?new b(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new b(this.start.row,0,this.end.row,0)},b.prototype.toScreenRange=function(A){var x=A.documentToScreenPosition(this.start),A=A.documentToScreenPosition(this.end);return new b(x.row,x.column,A.row,A.column)},b.prototype.moveBy=function(y,x){this.start.row+=y,this.start.column+=x,this.end.row+=y,this.end.column+=x};var g=b;function b(y,x,A,v){this.start={row:y,column:x},this.end={row:A,column:v}}g.fromPoints=function(y,x){return new g(y.row,y.column,x.row,x.column)},g.comparePoints=function(y,x){return y.row-x.row||y.column-x.column},f.Range=g}),ace.define("ace/lib/keys",["require","exports","module","ace/lib/oop"],function(h,f,C){"use strict";var g=h("./oop"),b=function(){var y,x,A={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta",91:"MetaLeft",92:"MetaRight",93:"ContextMenu"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,super:8,meta:8,command:8,cmd:8,control:1},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}};for(x in A.PRINTABLE_KEYS[173]="-",A.FUNCTION_KEYS)y=A.FUNCTION_KEYS[x].toLowerCase(),A[y]=parseInt(x,10);for(x in A.PRINTABLE_KEYS)y=A.PRINTABLE_KEYS[x].toLowerCase(),A[y]=parseInt(x,10);g.mixin(A,A.MODIFIER_KEYS),g.mixin(A,A.PRINTABLE_KEYS),g.mixin(A,A.FUNCTION_KEYS),A.enter=A.return,A.escape=A.esc,A.del=A.delete;for(var v=["cmd","ctrl","alt","shift"],_=Math.pow(2,v.length);_--;)A.KEY_MODS[_]=v.filter(function(I){return _&A.KEY_MODS[I]}).join("-")+"-";return A.KEY_MODS[0]="",A.KEY_MODS[-1]="input-",A}();g.mixin(f,b),(f.default=f).keyCodeToString=function(y){var x=b[y];return(x=typeof x!="string"?String.fromCharCode(y):x).toLowerCase()}}),ace.define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(h,f,C){"use strict";var g,b=h("./keys"),y=h("./useragent"),x=null,A=0;function v(){if(g==null){g=!1;try{document.createComment("").addEventListener("test",function(){},{get passive(){return g={passive:!1},!0}})}catch{}}return g}function _(P,k,L){this.elem=P,this.type=k,this.callback=L}_.prototype.destroy=function(){E(this.elem,this.type,this.callback),this.elem=this.type=this.callback=void 0};var I,T=f.addListener=function(P,k,L,R){P.addEventListener(k,L,v()),R&&R.$toDestroy.push(new _(P,k,L))},E=f.removeListener=function(P,k,L){P.removeEventListener(k,L,v())};function w(P){return 0|(P.ctrlKey?1:0)|(P.altKey?2:0)|(P.shiftKey?4:0)|(P.metaKey?8:0)}function S(){x=Object.create(null)}f.stopEvent=function(P){return f.stopPropagation(P),f.preventDefault(P),!1},f.stopPropagation=function(P){P.stopPropagation&&P.stopPropagation()},f.preventDefault=function(P){P.preventDefault&&P.preventDefault()},f.getButton=function(P){return P.type=="dblclick"?0:P.type=="contextmenu"||y.isMac&&P.ctrlKey&&!P.altKey&&!P.shiftKey?2:P.button},f.capture=function(P,k,L){var R=P&&P.ownerDocument||document;function N(F){k&&k(F),L&&L(F),E(R,"mousemove",k),E(R,"mouseup",N),E(R,"dragstart",N)}return T(R,"mousemove",k),T(R,"mouseup",N),T(R,"dragstart",N),N},f.addMouseWheelListener=function(P,k,L){T(P,"wheel",function(R){var N=R.deltaX||0,F=R.deltaY||0;switch(R.deltaMode){case R.DOM_DELTA_PIXEL:R.wheelX=.15*N,R.wheelY=.15*F;break;case R.DOM_DELTA_LINE:R.wheelX=15*N,R.wheelY=15*F;break;case R.DOM_DELTA_PAGE:R.wheelX=150*N,R.wheelY=150*F}k(R)},L)},f.addMultiMouseDownListener=function(P,k,L,R,N){var F,H,V,q=0,Q={2:"dblclick",3:"tripleclick",4:"quadclick"};function O(B){var j;if(f.getButton(B)!==0?q=0:1<B.detail&&!(4<++q)||(q=1),y.isIE&&(j=5<Math.abs(B.clientX-F)||5<Math.abs(B.clientY-H),V&&!j||(q=1),V&&clearTimeout(V),V=setTimeout(function(){V=null},k[q-1]||600),q==1)&&(F=B.clientX,H=B.clientY),B._clicks=q,L[R]("mousedown",B),4<q)q=0;else if(1<q)return L[R](Q[q],B)}(P=Array.isArray(P)?P:[P]).forEach(function(B){T(B,"mousedown",O,N)})},f.getModifierString=function(P){return b.KEY_MODS[w(P)]},f.addCommandKeyListener=function(P,k,L){var R=null;T(P,"keydown",function(N){x[N.keyCode]=(x[N.keyCode]||0)+1;var F=function(H,V,q){var Q,O=w(V);if(!y.isMac&&x){if(V.getModifierState&&(V.getModifierState("OS")||V.getModifierState("Win"))&&(O|=8),x.altGr){if((3&O)==3)return;x.altGr=0}q!==18&&q!==17||(Q=V.location,q===17&&Q===1?x[q]==1&&(A=V.timeStamp):q===18&&O===3&&Q===2&&V.timeStamp-A<50&&(x.altGr=!0))}if(q in b.MODIFIER_KEYS&&(q=-1),O||q!==13||V.location!==3||(H(V,O,-q),!V.defaultPrevented)){if(y.isChromeOS&&8&O){if(H(V,O,q),V.defaultPrevented)return;O&=-9}return O||q in b.FUNCTION_KEYS||q in b.PRINTABLE_KEYS?H(V,O,q):!1}}(k,N,N.keyCode);return R=N.defaultPrevented,F},L),T(P,"keypress",function(N){R&&(N.ctrlKey||N.altKey||N.shiftKey||N.metaKey)&&(f.stopEvent(N),R=null)},L),T(P,"keyup",function(N){x[N.keyCode]=null},L),x||(S(),T(window,"focus",S))},typeof window=="object"&&window.postMessage&&!y.isOldIE&&(I=1,f.nextTick=function(P,k){k=k||window;function L(N){N.data==R&&(f.stopPropagation(N),E(k,"message",L),P())}var R="zero-timeout-message-"+I++;T(k,"message",L),k.postMessage(R,"*")}),f.$idleBlocked=!1,f.onIdle=function(P,k){return setTimeout(function L(){f.$idleBlocked?setTimeout(L,100):P()},k)},f.$idleBlockId=null,f.blockIdle=function(P){f.$idleBlockId&&clearTimeout(f.$idleBlockId),f.$idleBlocked=!0,f.$idleBlockId=setTimeout(function(){f.$idleBlocked=!1},P||100)},f.nextFrame=typeof window=="object"&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),f.nextFrame?f.nextFrame=f.nextFrame.bind(window):f.nextFrame=function(P){setTimeout(P,17)}}),ace.define("ace/clipboard",["require","exports","module"],function(h,f,C){"use strict";var g;C.exports={lineMode:!1,pasteCancelled:function(){return!!(g&&g>Date.now()-50)||(g=!1)},cancel:function(){g=Date.now()}}}),ace.define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/config","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/clipboard","ace/lib/keys"],function(h,f,C){"use strict";var g=h("../lib/event"),b=h("../config").nls,y=h("../lib/useragent"),x=h("../lib/dom"),A=h("../lib/lang"),v=h("../clipboard"),_=y.isChrome<18,I=y.isIE,T=63<y.isChrome,E=h("../lib/keys"),w=E.KEY_MODS,S=y.isIOS,P=S?/\s/:/\n/,k=y.isMobile;f.TextInput=function(L,R){var N=x.createElement("textarea"),F=(N.className="ace_text-input",N.setAttribute("wrap","off"),N.setAttribute("autocorrect","off"),N.setAttribute("autocapitalize","off"),N.setAttribute("spellcheck","false"),N.style.opacity="0",L.insertBefore(N,L.firstChild),!1),H=!1,V=!1,q=!1,Q="",O=(k||(N.style.fontSize="1px"),!1),B=!1,j="",U=0,z=0,$=0,Z=Number.MAX_SAFE_INTEGER,J=Number.MIN_SAFE_INTEGER,ie=0;try{var ne=document.activeElement===N}catch{}this.setNumberOfExtraLines=function(Ne){Z=Number.MAX_SAFE_INTEGER,J=Number.MIN_SAFE_INTEGER,ie=Ne<0?0:Ne},this.setAriaOptions=function(Ne){Ne.activeDescendant?(N.setAttribute("aria-haspopup","true"),N.setAttribute("aria-autocomplete",Ne.inline?"both":"list"),N.setAttribute("aria-activedescendant",Ne.activeDescendant)):(N.setAttribute("aria-haspopup","false"),N.setAttribute("aria-autocomplete","both"),N.removeAttribute("aria-activedescendant")),Ne.role&&N.setAttribute("role",Ne.role),Ne.setLabel&&(N.setAttribute("aria-roledescription",b("text-input.aria-roledescription","editor")),R.session)&&(Ne=R.session.selection.cursor.row,N.setAttribute("aria-label",b("text-input.aria-label","Cursor at row $0",[Ne+1])))},this.setAriaOptions({role:"textbox"}),g.addListener(N,"blur",function(Ne){B||(R.onBlur(Ne),ne=!1)},R),g.addListener(N,"focus",function(Ne){if(!B){if(ne=!0,y.isEdge)try{if(!document.hasFocus())return}catch{}R.onFocus(Ne),y.isEdge?setTimeout(X):X()}},R),this.$focusScroll=!1,this.focus=function(){if(this.setAriaOptions({setLabel:R.renderer.enableKeyboardAccessibility}),Q||T||this.$focusScroll=="browser")return N.focus({preventScroll:!0});var Ne=N.style.top;N.style.position="fixed",N.style.top="0px";try{var je=N.getBoundingClientRect().top!=0}catch{return}var Ye=[];if(je)for(var mt=N.parentElement;mt&&mt.nodeType==1;)Ye.push(mt),mt.setAttribute("ace_nocontext","true"),mt=!mt.parentElement&&mt.getRootNode?mt.getRootNode().host:mt.parentElement;N.focus({preventScroll:!0}),je&&Ye.forEach(function(vt){vt.removeAttribute("ace_nocontext")}),setTimeout(function(){N.style.position="",N.style.top=="0px"&&(N.style.top=Ne)},0)},this.blur=function(){N.blur()},this.isFocused=function(){return ne},R.on("beforeEndOperation",function(){var Ne=R.curOp,je=Ne&&Ne.command&&Ne.command.name;je!="insertstring"&&(je=je&&(Ne.docChanged||Ne.selectionChanged),V&&je&&(j=N.value="",ge()),X())});function le(Ne,je){for(var Ye=je,mt=1;mt<=Ne-Z&&mt<2*ie+1;mt++)Ye+=R.session.getLine(Ne-mt).length+1;return Ye}function ee(Ne){ae(Ne,!0)}function oe(Ne){ae(Ne,!1)}function te(Ne){var je=Y(Ne);v.pasteCancelled()||(typeof je=="string"?(je&&R.onPaste(je,Ne),y.isIE&&setTimeout(X),g.preventDefault(Ne)):(N.value="",H=!0))}var X=S?function(Ne){var je;!ne||F&&!Ne||q||((je=`
 ab`+(Ne=Ne||"")+`cde fg
`)!=N.value&&(N.value=j=je),je=4+(Ne.length||(R.selection.isEmpty()?0:1)),U==4&&z==je||N.setSelectionRange(4,je),U=4,z=je)}:function(){if(!V&&!q&&(ne||re)){V=!0;var Ne=0,je=0,Ye="";if(R.session){for(var mt,yt=R.selection,vt=yt.getRange(),yt=yt.cursor.row,$e=(yt===J+1?J=(Z=J+1)+2*ie:yt===Z-1?Z=(J=Z-1)-2*ie:(yt<Z-1||J+1<yt)&&(Z=ie<yt?yt-ie:0,J=ie<yt?yt+ie:2*ie),[]),be=Z;be<=J;be++)$e.push(R.session.getLine(be));Ye=$e.join(`
`),Ne=le(vt.start.row,vt.start.column),je=le(vt.end.row,vt.end.column),vt.start.row<Z?(mt=R.session.getLine(Z-1),Ne=vt.start.row<Z-1?0:Ne,je+=mt.length+1,Ye=mt+`
`+Ye):vt.end.row>J?(mt=R.session.getLine(J+1),je=vt.end.row>J+1?mt.length:vt.end.column,je+=Ye.length+1,Ye=Ye+`
`+mt):k&&0<yt&&(Ye=`
`+Ye,je+=1,Ne+=1),400<Ye.length&&(Ne<400&&je<400?Ye=Ye.slice(0,400):(Ye=`
`,Ne==je?Ne=je=0:(Ne=0,je=1))),vt=Ye+`

`,vt!=j&&(N.value=j=vt,U=z=vt.length)}if(re&&(U=N.selectionStart,z=N.selectionEnd),z!=je||U!=Ne||N.selectionEnd!=z)try{N.setSelectionRange(Ne,je),U=Ne,z=je}catch{}V=!1}},W=(this.resetSelection=X,ne&&R.onFocus(),function(Ne){return Ne.selectionStart===0&&Ne.selectionEnd>=j.length&&Ne.value===j&&j&&Ne.selectionEnd!==z}),K=null,re=(this.setInputHandler=function(Ne){K=Ne},!(this.getInputHandler=function(){return K})),se=function(Ne,je){if(re=re&&!1,H)return X(),Ne&&R.onPaste(Ne),H=!1,"";for(var Ye=N.selectionStart,mt=N.selectionEnd,vt=U,yt=j.length-z,$e=Ne,be=Ne.length-Ye,Te=Ne.length-mt,De=0;0<vt&&j[De]==Ne[De];)De++,vt--;for($e=$e.slice(De),De=1;0<yt&&j.length-De>U-1&&j[j.length-De]==Ne[Ne.length-De];)De++,yt--;be-=De-1,Te-=De-1;var pe=$e.length-De+1;return pe<0&&(vt=-pe,pe=0),$e=$e.slice(0,pe),je||$e||be||vt||yt||Te?(pe=!(q=!0),y.isAndroid&&$e==". "&&($e="  ",pe=!0),$e&&!vt&&!yt&&!be&&!Te||O?R.onTextInput($e):R.onTextInput($e,{extendLeft:vt,extendRight:yt,restoreStart:be,restoreEnd:Te}),q=!1,j=Ne,U=Ye,z=mt,$=Te,pe?`
`:$e):""},me=function(je){if(V)return ve();if(je&&je.inputType){if(je.inputType=="historyUndo")return R.execCommand("undo");if(je.inputType=="historyRedo")return R.execCommand("redo")}var je=N.value,Ye=se(je,!0);(500<je.length||P.test(Ye)||k&&U<1&&U==z)&&X()},Y=function(Ne,je,Ye){var mt=Ne.clipboardData||window.clipboardData;if(mt&&!_){var vt=I||Ye?"Text":"text/plain";try{return je?mt.setData(vt,je)!==!1:mt.getData(vt)}catch(yt){if(!Ye)return Y(yt,je,!0)}}},ae=function(Ne,je){var Ye=R.getCopyText();if(!Ye)return g.preventDefault(Ne);Y(Ne,Ye)?(S&&(X(Ye),F=Ye,setTimeout(function(){F=!1},10)),je?R.onCut():R.onCopy(),g.preventDefault(Ne)):(F=!0,N.value=Ye,N.select(),setTimeout(function(){F=!1,X(),je?R.onCut():R.onCopy()}))},ve=(g.addCommandKeyListener(N,function(Ne,je,Ye){if(!V)return R.onCommandKey(Ne,je,Ye)},R),g.addListener(N,"select",function(Ne){V||(F?F=!1:W(N)?(R.selectAll(),X()):k&&N.selectionStart!=U&&X())},R),g.addListener(N,"input",me,R),g.addListener(N,"cut",ee,R),g.addListener(N,"copy",oe,R),g.addListener(N,"paste",te,R),"oncut"in N&&"oncopy"in N&&"onpaste"in N||g.addListener(L,"keydown",function(Ne){if((!y.isMac||Ne.metaKey)&&Ne.ctrlKey)switch(Ne.keyCode){case 67:oe(Ne);break;case 86:te(Ne);break;case 88:ee(Ne)}},R),function(){var Ne;if(V&&R.onCompositionUpdate&&!R.$readOnly)return O?Se():void(V.useTextareaForIME?R.onCompositionUpdate(N.value):(Ne=N.value,se(Ne),V.markerRange&&(V.context&&(V.markerRange.start.column=V.selectionStart=V.context.compositionStartOffset),V.markerRange.end.column=V.markerRange.start.column+z-V.selectionStart+$)))}),ge=function(Ne){R.onCompositionEnd&&!R.$readOnly&&(V=!1,R.onCompositionEnd(),R.off("mousedown",Se),Ne)&&me()};function Se(){B=!0,N.blur(),N.focus(),B=!1}var Ee,Fe=A.delayedCall(ve,50).schedule.bind(null,null);function Ae(){clearTimeout(Ee),Ee=setTimeout(function(){Q&&(N.style.cssText=Q,Q=""),R.renderer.$isMousePressed=!1,R.renderer.$keepTextAreaAtCursor&&R.renderer.$moveTextAreaToCursor()},0)}g.addListener(N,"compositionstart",function(Ne){V||!R.onCompositionStart||R.$readOnly||(V={},O)||(Ne.data&&(V.useTextareaForIME=!1),setTimeout(ve,0),R._signal("compositionStart"),R.on("mousedown",Se),(Ne=R.getSelectionRange()).end.row=Ne.start.row,Ne.end.column=Ne.start.column,V.markerRange=Ne,V.selectionStart=U,R.onCompositionStart(V),V.useTextareaForIME?(j=N.value="",z=U=0):(N.msGetInputContext&&(V.context=N.msGetInputContext()),N.getInputContext&&(V.context=N.getInputContext())))},R),g.addListener(N,"compositionupdate",ve,R),g.addListener(N,"keyup",function(Ne){Ne.keyCode==27&&N.value.length<N.selectionStart&&(V||(j=N.value),U=z=-1,X()),Fe()},R),g.addListener(N,"keydown",Fe,R),g.addListener(N,"compositionend",ge,R),this.getElement=function(){return N},this.setCommandMode=function(Ne){O=Ne,N.readOnly=!1},this.setReadOnly=function(Ne){O||(N.readOnly=Ne)},this.setCopyWithEmptySelection=function(Ne){},this.onContextMenu=function(Ne){re=!0,X(),R._emit("nativecontextmenu",{target:R,domEvent:Ne}),this.moveToMouse(Ne,!0)},this.moveToMouse=function(Ne,mt){Q=Q||N.style.cssText,N.style.cssText=(mt?"z-index:100000;":"")+(y.isIE?"opacity:0.1;":"")+"text-indent: -"+(U+z)*R.renderer.characterWidth*.5+"px;";function Ye(Te){x.translate(N,Te.clientX-$e-2,Math.min(Te.clientY-yt-2,be))}var mt=R.container.getBoundingClientRect(),vt=x.computedStyle(R.container),yt=mt.top+(parseInt(vt.borderTopWidth)||0),$e=mt.left+(parseInt(mt.borderLeftWidth)||0),be=mt.bottom-yt-N.clientHeight-2;Ye(Ne),Ne.type=="mousedown"&&(R.renderer.$isMousePressed=!0,clearTimeout(Ee),y.isWin)&&g.capture(R.container,Ye,Ae)},this.onContextMenuClose=Ae;function we(Ne){R.textInput.onContextMenu(Ne),Ae()}if(g.addListener(N,"mouseup",we,R),g.addListener(N,"mousedown",function(Ne){Ne.preventDefault(),Ae()},R),g.addListener(R.renderer.scroller,"contextmenu",we,R),g.addListener(N,"contextmenu",we,R),S){let Ne=function(je){var Ye,mt,vt,yt;document.activeElement!==Ke||pt||V||_e.$mouseHandler.isMousePressed||F||(Ye=Ke.selectionStart,mt=Ke.selectionEnd,vt=null,(yt=0)==Ye?vt=E.up:Ye==1?vt=E.home:z<mt&&j[mt]==`
`?vt=E.end:Ye<U&&j[Ye-1]==" "?(vt=E.left,yt=w.option):Ye<U||Ye==U&&z!=U&&Ye==mt?vt=E.left:z<mt&&2<j.slice(0,mt).split(`
`).length?vt=E.down:z<mt&&j[mt-1]==" "?(vt=E.right,yt=w.option):(z<mt||mt==z&&z!=U&&Ye==mt)&&(vt=E.right),Ye!==mt&&(yt|=w.shift),vt&&(!_e.onCommandKey({},yt,vt)&&_e.commands&&(vt=E.keyCodeToString(vt),yt=_e.commands.findKeyCommand(yt,vt))&&_e.execCommand(yt),U=Ye,z=mt,X("")))};var _e=R,Ke=N,rt=null,pt=!1;Ke.addEventListener("keydown",function(je){rt&&clearTimeout(rt),pt=!0},!0),Ke.addEventListener("keyup",function(je){rt=setTimeout(function(){pt=!1},100)},!0),document.addEventListener("selectionchange",Ne),_e.on("destroy",function(){document.removeEventListener("selectionchange",Ne)})}this.destroy=function(){N.parentElement&&N.parentElement.removeChild(N)}},f.$setUserAgentForTests=function(L,R){k=L,S=R}}),ace.define("ace/mouse/default_handlers",["require","exports","module","ace/lib/useragent"],function(b,f,C){"use strict";var g=b("../lib/useragent"),b=(y.prototype.onMouseDown=function(A){var v=A.inSelection(),_=A.getDocumentPosition(),I=(this.mousedownEvent=A,this.editor),T=A.getButton();if(T!==0)!I.getSelectionRange().isEmpty()&&T!=1||I.selection.moveToPosition(_),T==2&&(I.textInput.onContextMenu(A.domEvent),g.isMozilla||A.preventDefault());else{if(this.mousedownEvent.time=Date.now(),!v||I.isFocused()||(I.focus(),!this.$focusTimeout)||this.$clickSelection||I.inMultiSelectMode)return this.captureMouse(A),this.startSelect(_,1<A.domEvent._clicks),A.preventDefault();this.setState("focusWait"),this.captureMouse(A)}},y.prototype.startSelect=function(A,v){A=A||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var _=this.editor;this.mousedownEvent&&(this.mousedownEvent.getShiftKey()?_.selection.selectToPosition(A):v||_.selection.moveToPosition(A),v||this.select(),_.setStyle("ace_selecting"),this.setState("select"))},y.prototype.select=function(){var A,v=this.editor,_=v.renderer.screenToTextCoordinates(this.x,this.y);this.$clickSelection&&(A=(A=this.$clickSelection.comparePoint(_))==-1?this.$clickSelection.end:A==1?this.$clickSelection.start:(_=(A=x(this.$clickSelection,_)).cursor,A.anchor),v.selection.setSelectionAnchor(A.row,A.column)),v.selection.selectToPosition(_),v.renderer.scrollCursorIntoView()},y.prototype.extendSelectionBy=function(w){var v,_,I,T=this.editor,E=T.renderer.screenToTextCoordinates(this.x,this.y),w=T.selection[w](E.row,E.column);this.$clickSelection&&(_=this.$clickSelection.comparePoint(w.start),v=this.$clickSelection.comparePoint(w.end),_==-1&&v<=0?(I=this.$clickSelection.end,w.end.row==E.row&&w.end.column==E.column||(E=w.start)):v==1&&0<=_?(I=this.$clickSelection.start,w.start.row==E.row&&w.start.column==E.column||(E=w.end)):I=_==-1&&v==1?(E=w.end,w.start):(E=(_=x(this.$clickSelection,E)).cursor,_.anchor),T.selection.setSelectionAnchor(I.row,I.column)),T.selection.selectToPosition(E),T.renderer.scrollCursorIntoView()},y.prototype.selectByLinesEnd=function(){this.$clickSelection=null,this.editor.unsetStyle("ace_selecting")},y.prototype.focusWait=function(){I=this.mousedownEvent.x,A=this.mousedownEvent.y,_=this.x,v=this.y;var A,v,_=Math.sqrt(Math.pow(_-I,2)+Math.pow(v-A,2)),I=Date.now();(0<_||I-this.mousedownEvent.time>this.$focusTimeout)&&this.startSelect(this.mousedownEvent.getDocumentPosition())},y.prototype.onDoubleClick=function(v){var v=v.getDocumentPosition(),_=this.editor,I=_.session.getBracketRange(v);I?(I.isEmpty()&&(I.start.column--,I.end.column++),this.setState("select")):(I=_.selection.getWordRange(v.row,v.column),this.setState("selectByWords")),this.$clickSelection=I,this.select()},y.prototype.onTripleClick=function(v){var v=v.getDocumentPosition(),_=this.editor,I=(this.setState("selectByLines"),_.getSelectionRange());I.isMultiLine()&&I.contains(v.row,v.column)?(this.$clickSelection=_.selection.getLineRange(I.start.row),this.$clickSelection.end=_.selection.getLineRange(I.end.row).end):this.$clickSelection=_.selection.getLineRange(v.row),this.select()},y.prototype.onQuadClick=function(A){var v=this.editor;v.selectAll(),this.$clickSelection=v.getSelectionRange(),this.setState("selectAll")},y.prototype.onMouseWheel=function(A){var v,_,I,T,E,w,S;if(!A.getAccelKey())return A.getShiftKey()&&A.wheelY&&!A.wheelX&&(A.wheelX=A.wheelY,A.wheelY=0),v=this.editor,this.$lastScroll||(this.$lastScroll={t:0,vx:0,vy:0,allowed:0}),_=this.$lastScroll,T=(S=(I=A.domEvent.timeStamp)-_.t)?A.wheelX/S:_.vx,E=S?A.wheelY/S:_.vy,S<550&&(T=(T+_.vx)/2,E=(E+_.vy)/2),S=!1,1<=(w=Math.abs(T/E))&&v.renderer.isScrollableBy(A.wheelX*A.speed,0)&&(S=!0),(S=w<=1&&v.renderer.isScrollableBy(0,A.wheelY*A.speed)?!0:S)?_.allowed=I:I-_.allowed<550&&(Math.abs(T)<=1.5*Math.abs(_.vx)&&Math.abs(E)<=1.5*Math.abs(_.vy)?(S=!0,_.allowed=I):_.allowed=0),_.t=I,_.vx=T,_.vy=E,S?(v.renderer.scrollBy(A.wheelX*A.speed,A.wheelY*A.speed),A.stop()):void 0},y);function y(A){A.$clickSelection=null;var v=A.editor;v.setDefaultHandler("mousedown",this.onMouseDown.bind(A)),v.setDefaultHandler("dblclick",this.onDoubleClick.bind(A)),v.setDefaultHandler("tripleclick",this.onTripleClick.bind(A)),v.setDefaultHandler("quadclick",this.onQuadClick.bind(A)),v.setDefaultHandler("mousewheel",this.onMouseWheel.bind(A)),["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"].forEach(function(_){A[_]=this[_]},this),A.selectByLines=this.extendSelectionBy.bind(A,"getLineRange"),A.selectByWords=this.extendSelectionBy.bind(A,"getWordRange")}function x(A,v){return(A.start.row==A.end.row?2*v.column-A.start.column-A.end.column:A.start.row!=A.end.row-1||A.start.column||A.end.column?2*v.row-A.start.row-A.end.row:v.column-4)<0?{cursor:A.start,anchor:A.end}:{cursor:A.end,anchor:A.start}}b.prototype.selectEnd=b.prototype.selectByLinesEnd,b.prototype.selectAllEnd=b.prototype.selectByLinesEnd,b.prototype.selectByWordsEnd=b.prototype.selectByLinesEnd,f.DefaultHandlers=b}),ace.define("ace/lib/scroll",["require","exports","module"],function(h,f,C){f.preventParentScroll=function(g){g.stopPropagation();var b=g.currentTarget;b.scrollHeight>b.clientHeight||g.preventDefault()}}),ace.define("ace/tooltip",["require","exports","module","ace/lib/dom","ace/lib/event","ace/range","ace/lib/scroll"],function(_,f,C){"use strict";var g,S=this&&this.__extends||(g=function(k,L){return(g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(R,N){R.__proto__=N}:function(R,N){for(var F in N)Object.prototype.hasOwnProperty.call(N,F)&&(R[F]=N[F])}))(k,L)},function(k,L){if(typeof L!="function"&&L!==null)throw new TypeError("Class extends value "+String(L)+" is not a constructor or null");function R(){this.constructor=k}g(k,L),k.prototype=L===null?Object.create(L):(R.prototype=L.prototype,new R)}),b=this&&this.__values||function(k){var L=typeof Symbol=="function"&&Symbol.iterator,R=L&&k[L],N=0;if(R)return R.call(k);if(k&&typeof k.length=="number")return{next:function(){return{value:(k=k&&N>=k.length?void 0:k)&&k[N++],done:!k}}};throw new TypeError(L?"Object is not iterable.":"Symbol.iterator is not defined.")},y=_("./lib/dom"),x=(_("./lib/event"),_("./range").Range),A=_("./lib/scroll").preventParentScroll,v="ace_tooltip",_=(I.prototype.$init=function(){return this.$element=y.createElement("div"),this.$element.className=v,this.$element.style.display="none",this.$parentNode.appendChild(this.$element),this.$element},I.prototype.getElement=function(){return this.$element||this.$init()},I.prototype.setText=function(k){this.getElement().textContent=k},I.prototype.setHtml=function(k){this.getElement().innerHTML=k},I.prototype.setPosition=function(k,L){this.getElement().style.left=k+"px",this.getElement().style.top=L+"px"},I.prototype.setClassName=function(k){y.addCssClass(this.getElement(),k)},I.prototype.setTheme=function(k){this.$element.className=v+" "+(k.isDark?"ace_dark ":"")+(k.cssClass||"")},I.prototype.show=function(k,L,R){k!=null&&this.setText(k),L!=null&&R!=null&&this.setPosition(L,R),this.isOpen||(this.getElement().style.display="block",this.isOpen=!0)},I.prototype.hide=function(k){this.isOpen&&(this.getElement().style.display="none",this.getElement().className=v,this.isOpen=!1)},I.prototype.getHeight=function(){return this.getElement().offsetHeight},I.prototype.getWidth=function(){return this.getElement().offsetWidth},I.prototype.destroy=function(){this.isOpen=!1,this.$element&&this.$element.parentNode&&this.$element.parentNode.removeChild(this.$element)},I);function I(k){this.isOpen=!1,this.$element=null,this.$parentNode=k}function T(){this.popups=[]}T.prototype.addPopup=function(k){this.popups.push(k),this.updatePopups()},T.prototype.removePopup=function(k){k=this.popups.indexOf(k),k!==-1&&(this.popups.splice(k,1),this.updatePopups())},T.prototype.updatePopups=function(){this.popups.sort(function(U,z){return z.priority-U.priority});var k,L,R,N,F=[];try{for(var H=b(this.popups),V=H.next();!V.done;V=H.next()){var q=V.value,Q=!0;try{R=void 0;for(var O=b(F),B=O.next();!B.done;B=O.next()){var j=B.value;if(this.doPopupsOverlap(j,q)){Q=!1;break}}}catch(U){R={error:U}}finally{try{B&&!B.done&&(N=O.return)&&N.call(O)}finally{if(R)throw R.error}}Q?F.push(q):q.hide()}}catch(U){k={error:U}}finally{try{V&&!V.done&&(L=H.return)&&L.call(H)}finally{if(k)throw k.error}}},T.prototype.doPopupsOverlap=function(k,L){return k=k.getElement().getBoundingClientRect(),L=L.getElement().getBoundingClientRect(),k.left<L.right&&k.right>L.left&&k.top<L.bottom&&k.bottom>L.top};var E,w=new T,S=(f.popupManager=w,f.Tooltip=_,S(P,E=_),P.prototype.addToEditor=function(k){k.on("mousemove",this.onMouseMove),k.on("mousedown",this.hide),k.renderer.getMouseEventTarget().addEventListener("mouseout",this.onMouseOut,!0)},P.prototype.removeFromEditor=function(k){k.off("mousemove",this.onMouseMove),k.off("mousedown",this.hide),k.renderer.getMouseEventTarget().removeEventListener("mouseout",this.onMouseOut,!0),this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},P.prototype.onMouseMove=function(k,N){this.lastEvent=k,this.lastT=Date.now();var R,N=N.$mouseHandler.isMousePressed;this.isOpen&&(R=this.lastEvent&&this.lastEvent.getDocumentPosition(),this.range&&this.range.contains(R.row,R.column)&&!N&&!this.isOutsideOfText(this.lastEvent)||this.hide()),this.timeout||N||(this.lastEvent=k,this.timeout=setTimeout(this.waitForHover,this.idleTime))},P.prototype.waitForHover=function(){this.timeout&&clearTimeout(this.timeout);var k=Date.now()-this.lastT;10<this.idleTime-k?this.timeout=setTimeout(this.waitForHover,this.idleTime-k):(this.timeout=null,this.lastEvent&&!this.isOutsideOfText(this.lastEvent)&&this.$gatherData(this.lastEvent,this.lastEvent.editor))},P.prototype.isOutsideOfText=function(k){var L=k.editor,R=k.getDocumentPosition(),N=L.session.getLine(R.row);return R.column==N.length&&(N=L.renderer.pixelToScreenCoordinates(k.clientX,k.clientY),k=L.session.documentToScreenPosition(R.row,R.column),k.column!=N.column||k.row!=N.row)},P.prototype.setDataProvider=function(k){this.$gatherData=k},P.prototype.showForRange=function(k,L,R,N){var F,H,V;N&&N!=this.lastEvent||this.isOpen&&document.activeElement==this.getElement()||(N=k.renderer,this.isOpen||(w.addPopup(this),this.$registerCloseEvents(),this.setTheme(N.theme)),this.isOpen=!0,this.addMarker(L,k.session),this.range=x.fromPoints(L.start,L.end),k=N.textToScreenCoordinates(L.start.row,L.start.column),L=N.scroller.getBoundingClientRect(),k.pageX<L.left&&(k.pageX=L.left),(L=this.getElement()).innerHTML="",L.appendChild(R),L.style.maxHeight="",L.style.display="block",R=L.clientHeight,F=L.clientWidth,H=window.innerHeight-k.pageY-N.lineHeight,V=!0,k.pageY-R<0&&k.pageY<H&&(V=!1),L.style.maxHeight=(V?k.pageY:H)-10+"px",L.style.top=V?"":k.pageY+N.lineHeight+"px",L.style.bottom=V?window.innerHeight-k.pageY+"px":"",L.style.left=Math.min(k.pageX,window.innerWidth-F-10)+"px")},P.prototype.addMarker=function(k,L){this.marker&&this.$markerSession.removeMarker(this.marker),this.$markerSession=L,this.marker=L&&L.addMarker(k,"ace_highlight-marker","text")},P.prototype.hide=function(k){!k&&document.activeElement==this.getElement()||k&&k.target&&(k.type!="keydown"||k.ctrlKey||k.metaKey)&&this.$element.contains(k.target)||(this.lastEvent=null,this.timeout&&clearTimeout(this.timeout),this.timeout=null,this.addMarker(null),this.isOpen&&(this.$removeCloseEvents(),this.getElement().style.display="none",this.isOpen=!1,w.removePopup(this)))},P.prototype.$registerCloseEvents=function(){window.addEventListener("keydown",this.hide,!0),window.addEventListener("wheel",this.hide,!0),window.addEventListener("mousedown",this.hide,!0)},P.prototype.$removeCloseEvents=function(){window.removeEventListener("keydown",this.hide,!0),window.removeEventListener("wheel",this.hide,!0),window.removeEventListener("mousedown",this.hide,!0)},P.prototype.onMouseOut=function(k){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.lastEvent=null,!this.isOpen||!k.relatedTarget||this.getElement().contains(k.relatedTarget)||k&&k.currentTarget.contains(k.relatedTarget)||k.relatedTarget.classList.contains("ace_content")||this.hide()},P);function P(L){L===void 0&&(L=document.body);var L=E.call(this,L)||this,R=(L.timeout=void 0,L.lastT=0,L.idleTime=350,L.lastEvent=void 0,L.onMouseOut=L.onMouseOut.bind(L),L.onMouseMove=L.onMouseMove.bind(L),L.waitForHover=L.waitForHover.bind(L),L.hide=L.hide.bind(L),L.getElement());return R.style.whiteSpace="pre-wrap",R.style.pointerEvents="auto",R.addEventListener("mouseout",L.onMouseOut),R.tabIndex=-1,R.addEventListener("blur",(function(){R.contains(document.activeElement)||this.hide()}).bind(L)),R.addEventListener("wheel",A),L}f.HoverTooltip=S}),ace.define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/tooltip","ace/config"],function(h,f,C){"use strict";var g,b=this&&this.__extends||(g=function(w,S){return(g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(P,k){P.__proto__=k}:function(P,k){for(var L in k)Object.prototype.hasOwnProperty.call(k,L)&&(P[L]=k[L])}))(w,S)},function(w,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function P(){this.constructor=w}g(w,S),w.prototype=S===null?Object.create(S):(P.prototype=S.prototype,new P)}),y=this&&this.__values||function(w){var S=typeof Symbol=="function"&&Symbol.iterator,P=S&&w[S],k=0;if(P)return P.call(w);if(w&&typeof w.length=="number")return{next:function(){return{value:(w=w&&k>=w.length?void 0:w)&&w[k++],done:!w}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")},x=h("../lib/dom"),A=h("../lib/event"),v=h("../tooltip").Tooltip,_=h("../config").nls;f.GutterHandler=function(w){var S,P,k=w.editor,L=k.renderer.$gutterLayer,R=new T(k);function N(){S=S&&clearTimeout(S),R.isOpen&&(R.hideTooltip(),k.off("mousewheel",N))}function F(H){R.setPosition(H.x,H.y)}w.editor.setDefaultHandler("guttermousedown",function(H){if(k.isFocused()&&H.getButton()==0){var V=L.getRegion(H);if(V!="foldWidgets"){var V=H.getDocumentPosition().row,q=k.session.selection;if(H.getShiftKey())q.selectTo(V,0);else{if(H.domEvent.detail==2)return k.selectAll(),H.preventDefault();w.$clickSelection=k.selection.getLineRange(V)}return w.setState("selectByLines"),w.captureMouse(H),H.preventDefault()}}}),w.editor.setDefaultHandler("guttermousemove",function(H){var V=H.domEvent.target||H.domEvent.srcElement;if(x.hasCssClass(V,"ace_fold-widget"))return N();R.isOpen&&w.$tooltipFollowsMouse&&F(H),P=H,S=S||setTimeout(function(){if(S=null,P&&!w.isMousePressed){var q=P.getDocumentPosition().row;if(q==k.session.getLength()){var Q=k.renderer.pixelToScreenCoordinates(0,P.y).row,O=P.$pos;if(Q>k.session.documentToScreenRow(O.row,O.column))return void N()}R.showTooltip(q),R.isOpen&&(k.on("mousewheel",N),!w.$tooltipFollowsMouse&&(Q=P.getGutterRow(),O=L.$lines.get(Q))?(q=O.element.querySelector(".ace_gutter_annotation").getBoundingClientRect(),(Q=R.getElement().style).left=q.right+"px",Q.top=q.bottom+"px"):F(P))}else N()},50)}),A.addListener(k.renderer.$gutter,"mouseout",function(H){P=null,R.isOpen&&(S=S||setTimeout(function(){S=null,N()},50))},k),k.on("changeSession",N),k.on("input",N)},b(E,I=v),E.prototype.setPosition=function(w,S){var P=window.innerWidth||document.documentElement.clientWidth,k=window.innerHeight||document.documentElement.clientHeight,L=this.getWidth(),R=this.getHeight();P<(w+=15)+L&&(w-=w+L-P),k<(S+=15)+R&&(S-=20+R),v.prototype.setPosition.call(this,w,S)},Object.defineProperty(E,"annotationLabels",{get:function(){return{error:{singular:_("gutter-tooltip.aria-label.error.singular","error"),plural:_("gutter-tooltip.aria-label.error.plural","errors")},warning:{singular:_("gutter-tooltip.aria-label.warning.singular","warning"),plural:_("gutter-tooltip.aria-label.warning.plural","warnings")},info:{singular:_("gutter-tooltip.aria-label.info.singular","information message"),plural:_("gutter-tooltip.aria-label.info.plural","information messages")}}},enumerable:!1,configurable:!0}),E.prototype.showTooltip=function(w){var S=this.editor.renderer.$gutterLayer,P=S.$annotations[w],k=P?{text:Array.from(P.text),type:Array.from(P.type)}:{text:[],type:[]},L=S.session.getFoldLine(w);if(L&&S.$showFoldedAnnotations){for(var R,N={error:[],warning:[],info:[]},F=w+1;F<=L.end.row;F++)if(S.$annotations[F])for(var H=0;H<S.$annotations[F].text.length;H++){var V=S.$annotations[F].type[H];N[V].push(S.$annotations[F].text[H]),V==="error"?R="error_fold":V==="warning"&&(R="warning_fold")}R!=="error_fold"&&R!=="warning_fold"||(P="".concat(E.annotationsToSummaryString(N)," in folded code."),k.text.push(P),k.type.push(R))}if(k.text.length===0)return this.hide();for(var q={error:[],warning:[],info:[]},Q=S.$useSvgGutterIcons?"ace_icon_svg":"ace_icon",F=0;F<k.text.length;F++){var O="<span class='ace_".concat(k.type[F]," ").concat(Q,"' aria-label='").concat(E.annotationLabels[k.type[F].replace("_fold","")].singular,"' role=img> </span> ").concat(k.text[F]);q[k.type[F].replace("_fold","")].push(O)}w=[].concat(q.error,q.warning,q.info).join("<br>"),this.setHtml(w),this.$element.setAttribute("aria-live","polite"),this.isOpen||(this.setTheme(this.editor.renderer.theme),this.setClassName("ace_gutter-tooltip")),this.show(),this.editor._signal("showGutterTooltip",this)},E.prototype.hideTooltip=function(){this.$element.removeAttribute("aria-live"),this.hide(),this.editor._signal("hideGutterTooltip",this)},E.annotationsToSummaryString=function(w){var S,P,k=[];try{for(var L=y(["error","warning","info"]),R=L.next();!R.done;R=L.next()){var N,F=R.value;w[F].length&&(N=w[F].length===1?E.annotationLabels[F].singular:E.annotationLabels[F].plural,k.push("".concat(w[F].length," ").concat(N)))}}catch(H){S={error:H}}finally{try{R&&!R.done&&(P=L.return)&&P.call(L)}finally{if(S)throw S.error}}return k.join(", ")};var I,T=E;function E(w){var S=I.call(this,w.container)||this;return S.editor=w,S}f.GutterTooltip=T}),ace.define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(h,f,C){"use strict";var g=h("../lib/event"),b=h("../lib/useragent");function y(x,A){this.speed,this.wheelX,this.wheelY,this.domEvent=x,this.editor=A,this.x=this.clientX=x.clientX,this.y=this.clientY=x.clientY,this.$pos=null,this.$inSelection=null,this.propagationStopped=!1,this.defaultPrevented=!1}y.prototype.stopPropagation=function(){g.stopPropagation(this.domEvent),this.propagationStopped=!0},y.prototype.preventDefault=function(){g.preventDefault(this.domEvent),this.defaultPrevented=!0},y.prototype.stop=function(){this.stopPropagation(),this.preventDefault()},y.prototype.getDocumentPosition=function(){return this.$pos||(this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY)),this.$pos},y.prototype.getGutterRow=function(){var x=this.getDocumentPosition().row;return this.editor.session.documentToScreenRow(x,0)-this.editor.session.documentToScreenRow(this.editor.renderer.$gutterLayer.$lines.get(0).row,0)},y.prototype.inSelection=function(){var x,A;return this.$inSelection===null&&((x=this.editor.getSelectionRange()).isEmpty()?this.$inSelection=!1:(A=this.getDocumentPosition(),this.$inSelection=x.contains(A.row,A.column))),this.$inSelection},y.prototype.getButton=function(){return g.getButton(this.domEvent)},y.prototype.getShiftKey=function(){return this.domEvent.shiftKey},y.prototype.getAccelKey=function(){return b.isMac?this.domEvent.metaKey:this.domEvent.ctrlKey},f.MouseEvent=y}),ace.define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],function(h,f,C){"use strict";var g=h("../lib/dom"),b=h("../lib/event"),y=h("../lib/useragent");function x(v){var _,I,T,E,w,S,P,k,L,R,N,F=v.editor,H=g.createElement("div"),V=(H.style.cssText="top:-100px;position:absolute;z-index:2147483647;opacity:0.5",H.textContent="\xA0",["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"].forEach(function(Z){v[Z]=this[Z]},this),F.on("mousedown",this.onMouseDown.bind(v)),F.container),q=0;function Q(){var Z,J,ie,ne,le,ee,oe,te,X=S;S=F.renderer.screenToTextCoordinates(I,T),ie=S,J=X,ne=Date.now(),Z=!J||ie.row!=J.row,J=!J||ie.column!=J.column,!R||Z||J?(F.moveCursorToPosition(ie),R=ne,N={x:I,y:T}):5<A(N.x,N.y,I,T)?R=null:200<=ne-R&&(F.renderer.scrollCursorIntoView(),R=null),Z=S,J=X,ie=Date.now(),ne=F.renderer.layerConfig.lineHeight,X=F.renderer.layerConfig.characterWidth,le=F.renderer.scroller.getBoundingClientRect(),le={x:{left:I-le.left,right:le.right-I},y:{top:T-le.top,bottom:le.bottom-T}},ee=Math.min(le.x.left,le.x.right),oe=Math.min(le.y.top,le.y.bottom),te={row:Z.row,column:Z.column},ee/X<=2&&(te.column+=le.x.left<le.x.right?-3:2),oe/ne<=1&&(te.row+=le.y.top<le.y.bottom?-1:1),ee=Z.row!=te.row,X=Z.column!=te.column,oe=!J||Z.row!=J.row,ee||X&&!oe?L?200<=ie-L&&F.renderer.scrollCursorIntoView(te):L=ie:L=null}function O(){w=F.selection.toOrientedRange(),_=F.session.addMarker(w,"ace_selection",F.getSelectionStyle()),F.clearSelection(),F.isFocused()&&F.renderer.$cursorLayer.setBlinking(!1),clearInterval(E),Q(),E=setInterval(Q,20),q=0,b.addListener(document,"mousemove",U)}function B(){clearInterval(E),F.session.removeMarker(_),_=null,F.selection.fromOrientedRange(w),F.isFocused()&&!k&&F.$resetCursorStyle(),q=0,R=L=S=w=null,b.removeListener(document,"mousemove",U)}this.onDragStart=function(Z){var J;if(this.cancelDrag||!V.draggable)return J=this,setTimeout(function(){J.startSelect(),J.captureMouse(Z)},0),Z.preventDefault();w=F.getSelectionRange();var ie=Z.dataTransfer;ie.effectAllowed=F.getReadOnly()?"copy":"copyMove",F.container.appendChild(H),ie.setDragImage&&ie.setDragImage(H,0,0),setTimeout(function(){F.container.removeChild(H)}),ie.clearData(),ie.setData("Text",F.session.getTextRange()),k=!0,this.setState("drag")},this.onDragEnd=function(Z){V.draggable=!1,k=!1,this.setState(null),F.getReadOnly()||(Z=Z.dataTransfer.dropEffect,P||Z!="move"||F.session.remove(F.getSelectionRange()),F.$resetCursorStyle()),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle("")},this.onDragEnter=function(Z){if(!F.getReadOnly()&&z(Z.dataTransfer))return I=Z.clientX,T=Z.clientY,_||O(),q++,Z.dataTransfer.dropEffect=P=$(Z),b.preventDefault(Z)},this.onDragOver=function(Z){if(!F.getReadOnly()&&z(Z.dataTransfer))return I=Z.clientX,T=Z.clientY,_||(O(),q++),j!==null&&(j=null),Z.dataTransfer.dropEffect=P=$(Z),b.preventDefault(Z)},this.onDragLeave=function(Z){if(--q<=0&&_)return B(),P=null,b.preventDefault(Z)},this.onDrop=function(Z){if(S){var J=Z.dataTransfer;if(k)switch(P){case"move":w=w.contains(S.row,S.column)?{start:S,end:S}:F.moveText(w,S);break;case"copy":w=F.moveText(w,S,!0)}else J=J.getData("Text"),w={start:S,end:F.session.insert(S,J)},F.focus(),P=null;return B(),b.preventDefault(Z)}},b.addListener(V,"dragstart",this.onDragStart.bind(v),F),b.addListener(V,"dragend",this.onDragEnd.bind(v),F),b.addListener(V,"dragenter",this.onDragEnter.bind(v),F),b.addListener(V,"dragover",this.onDragOver.bind(v),F),b.addListener(V,"dragleave",this.onDragLeave.bind(v),F),b.addListener(V,"drop",this.onDrop.bind(v),F);var j=null;function U(){j==null&&(j=setTimeout(function(){j!=null&&_&&B()},20))}function z(Z){return Z=Z.types,!Z||Array.prototype.some.call(Z,function(J){return J=="text/plain"||J=="Text"})}function $(Z){var J=["copy","copymove","all","uninitialized"],ie=y.isMac?Z.altKey:Z.ctrlKey,ne="uninitialized";try{ne=Z.dataTransfer.effectAllowed.toLowerCase()}catch{}var le="none";return ie&&0<=J.indexOf(ne)?le="copy":0<=["move","copymove","linkmove","all","uninitialized"].indexOf(ne)?le="move":0<=J.indexOf(ne)&&(le="copy"),le}}function A(v,_,I,T){return Math.sqrt(Math.pow(I-v,2)+Math.pow(T-_,2))}(function(){this.dragWait=function(){Date.now()-this.mousedownEvent.time>this.editor.getDragDelay()&&this.startDrag()},this.dragWaitEnd=function(){this.editor.container.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()),this.selectEnd()},this.dragReadyEnd=function(v){this.editor.$resetCursorStyle(),this.editor.unsetStyle("ace_dragging"),this.editor.renderer.setCursorStyle(""),this.dragWaitEnd()},this.startDrag=function(){this.cancelDrag=!1;var v=this.editor,_=(v.container.draggable=!0,v.renderer.$cursorLayer.setBlinking(!1),v.setStyle("ace_dragging"),y.isWin?"default":"move");v.renderer.setCursorStyle(_),this.setState("dragReady")},this.onMouseDrag=function(v){var _=this.editor.container;y.isIE&&this.state=="dragReady"&&3<A(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y)&&_.dragDrop(),this.state==="dragWait"&&0<A(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y)&&(_.draggable=!1,this.startSelect(this.mousedownEvent.getDocumentPosition()))},this.onMouseDown=function(v){var _,I,T;this.$dragEnabled&&(this.mousedownEvent=v,_=this.editor,I=v.inSelection(),T=v.getButton(),(v.domEvent.detail||1)!==1||T!==0||!I||v.editor.inMultiSelectMode&&(v.getAccelKey()||v.getShiftKey())||(this.mousedownEvent.time=Date.now(),"unselectable"in(T=v.domEvent.target||v.domEvent.srcElement)&&(T.unselectable="on"),_.getDragDelay()?(y.isWebKit&&(this.cancelDrag=!0,_.container.draggable=!0),this.setState("dragWait")):this.startDrag(),this.captureMouse(v,this.onMouseDrag.bind(this)),v.defaultPrevented=!0))}}).call(x.prototype),f.DragdropHandler=x}),ace.define("ace/mouse/touch_handler",["require","exports","module","ace/mouse/mouse_event","ace/lib/event","ace/lib/dom"],function(h,f,C){"use strict";var g=h("./mouse_event").MouseEvent,b=h("../lib/event"),y=h("../lib/dom");f.addTouchListeners=function(x,A){var v,_,I,T,E,w,S,P,k,L="scroll",R=0,N=0,F=0,H=0;function V(){function B(z){var $,Z=z.target.getAttribute("action");Z!="more"&&U?(Z=="paste"?j.readText().then(function(J){A.execCommand(Z,J)}):Z&&(Z!="cut"&&Z!="copy"||(j?j.writeText(A.getCopyText()):document.execCommand("copy")),A.execCommand(Z)),k.firstChild.style.display="none",U=!1,Z!="openCommandPalette"&&A.focus()):(U=!U,z=A.getCopyText(),$=A.session.getUndoManager().hasUndo(),k.replaceChild(y.buildDom(U?["span",!z&&["span",{class:"ace_mobile-button",action:"selectall"},"Select All"],z&&["span",{class:"ace_mobile-button",action:"copy"},"Copy"],z&&["span",{class:"ace_mobile-button",action:"cut"},"Cut"],j&&["span",{class:"ace_mobile-button",action:"paste"},"Paste"],$&&["span",{class:"ace_mobile-button",action:"undo"},"Undo"],["span",{class:"ace_mobile-button",action:"find"},"Find"],["span",{class:"ace_mobile-button",action:"openCommandPalette"},"Palette"]]:["span"]),k.firstChild))}var j=window.navigator&&window.navigator.clipboard,U=!1;k=y.buildDom(["div",{class:"ace_mobile-menu",ontouchstart:function(z){L="menu",z.stopPropagation(),z.preventDefault(),A.textInput.focus()},ontouchend:function(z){z.stopPropagation(),z.preventDefault(),B(z)},onclick:B},["span"],["span",{class:"ace_mobile-button",action:"more"},"..."]],A.container)}function q(){k||V();var B=A.selection.cursor,B=A.renderer.textToScreenCoordinates(B.row,B.column),j=A.renderer.textToScreenCoordinates(0,0).pageX,U=A.renderer.scrollLeft,z=A.container.getBoundingClientRect();k.style.top=B.pageY-z.top-3+"px",B.pageX-z.left<z.width-70?(k.style.left="",k.style.right="10px"):(k.style.right="",k.style.left=j+U-z.left+"px"),k.style.display="",k.firstChild.style.display="none",A.on("input",Q)}function Q(B){k&&(k.style.display="none"),A.off("input",Q)}function O(){E=null,clearTimeout(E);var B=A.selection.getRange(),j=B.contains(S.row,S.column);!B.isEmpty()&&j||(A.selection.moveToPosition(S),A.selection.selectWord()),L="wait",q()}b.addListener(x,"contextmenu",function(B){P&&A.textInput.getElement().focus()},A),b.addListener(x,"touchstart",function(B){var j=B.touches;if(E||1<j.length)clearTimeout(E),E=null,I=-1,L="zoom";else{P=A.$mouseHandler.isMousePressed=!0;var U=A.renderer.layerConfig.lineHeight,z=A.renderer.layerConfig.lineHeight,$=B.timeStamp,Z=(T=$,j[0]),J=Z.clientX,Z=Z.clientY,J=(Math.abs(v-J)+Math.abs(_-Z)>U&&(I=-1),v=B.clientX=J,_=B.clientY=Z,F=H=0,new g(B,A));if(S=J.getDocumentPosition(),$-I<500&&j.length==1&&!R)N++,B.preventDefault(),B.button=0,E=null,clearTimeout(E),A.selection.moveToPosition(S),(Z=2<=N?A.selection.getLineRange(S.row):A.session.getBracketRange(S))&&!Z.isEmpty()?A.selection.setRange(Z):A.selection.selectWord(),L="wait";else{N=0;var J=A.selection.cursor,j=A.selection.isEmpty()?J:A.selection.anchor,Z=A.renderer.$cursorLayer.getPixelPosition(J,!0),J=A.renderer.$cursorLayer.getPixelPosition(j,!0),j=A.renderer.scroller.getBoundingClientRect(),ie=A.renderer.layerConfig.offset,ne=A.renderer.scrollLeft,le=function(X,W){return(X/=z)*X+(W=W/U-.75)*W};if(B.clientX<j.left)return void(L="zoom");Z=le(B.clientX-j.left-Z.left+ne,B.clientY-j.top-Z.top+ie),le=le(B.clientX-j.left-J.left+ne,B.clientY-j.top-J.top+ie),Z<3.5&&le<3.5&&(L=le<Z?"cursor":"anchor"),L=le<3.5?"anchor":Z<3.5?"cursor":"scroll",E=setTimeout(O,450)}I=$}},A),b.addListener(x,"touchend",function(B){P=A.$mouseHandler.isMousePressed=!1,w&&clearInterval(w),L=="zoom"?(L="",R=0):(E?(A.selection.moveToPosition(S),R=0,q):L=="scroll"?(R+=60,w=setInterval(function(){R--<=0&&(clearInterval(w),w=null),Math.abs(F)<.01&&(F=0),Math.abs(H)<.01&&(H=0),R<20&&(F*=.9),R<20&&(H*=.9);var j=A.session.getScrollTop();A.renderer.scrollBy(10*F,10*H),j==A.session.getScrollTop()&&(R=0)},10),Q):q)(),clearTimeout(E),E=null},A),b.addListener(x,"touchmove",function(B){E&&(clearTimeout(E),E=null);var j=B.touches;if(!(1<j.length||L=="zoom")){var j=j[0],U=v-j.clientX,z=_-j.clientY;if(L=="wait"){if(!(4<U*U+z*z))return B.preventDefault();L="cursor"}v=j.clientX,_=j.clientY,B.clientX=j.clientX,B.clientY=j.clientY;var j=B.timeStamp,$=j-T;T=j,L=="scroll"?((j=new g(B,A)).speed=1,j.wheelX=U,j.wheelY=z,10*Math.abs(U)<Math.abs(z)&&(U=0),10*Math.abs(z)<Math.abs(U)&&(z=0),$!=0&&(F=U/$,H=z/$),A._emit("mousewheel",j),j.propagationStopped||(F=H=0)):(U=new g(B,A).getDocumentPosition(),L=="cursor"?A.selection.moveCursorToPosition(U):L=="anchor"&&A.selection.setSelectionAnchor(U.row,U.column),A.renderer.scrollCursorIntoView(U),B.preventDefault())}},A)}}),ace.define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/mouse/touch_handler","ace/config"],function(I,f,C){"use strict";var g=I("../lib/event"),b=I("../lib/useragent"),y=I("./default_handlers").DefaultHandlers,x=I("./default_gutter_handler").GutterHandler,A=I("./mouse_event").MouseEvent,v=I("./dragdrop_handler").DragdropHandler,_=I("./touch_handler").addTouchListeners,I=I("../config"),T=(E.prototype.onMouseEvent=function(w,S){this.editor.session&&this.editor._emit(w,new A(S,this.editor))},E.prototype.onMouseMove=function(w,S){var P=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;P&&P.length&&this.editor._emit(w,new A(S,this.editor))},E.prototype.onMouseWheel=function(w,S){var P=new A(S,this.editor);P.speed=2*this.$scrollSpeed,P.wheelX=S.wheelX,P.wheelY=S.wheelY,this.editor._emit(w,P)},E.prototype.setState=function(w){this.state=w},E.prototype.captureMouse=function(w,S){this.x=w.x,this.y=w.y,this.isMousePressed=!0;function P(q){if(q){if(b.isWebKit&&!q.which&&F.releaseMouse)return F.releaseMouse();F.x=q.clientX,F.y=q.clientY,S&&S(q),F.mouseEvent=new A(q,F.editor),F.$mouseMoved=!0}}function k(q){R.off("beforeEndOperation",H),clearInterval(V),R.session&&L(),F[F.state+"End"]&&F[F.state+"End"](q),F.state="",F.isMousePressed=N.$isMousePressed=!1,N.$keepTextAreaAtCursor&&N.$moveTextAreaToCursor(),F.$onCaptureMouseMove=F.releaseMouse=null,q&&F.onMouseEvent("mouseup",q),R.endOperation()}function L(){F[F.state]&&F[F.state](),F.$mouseMoved=!1}var R=this.editor,N=this.editor.renderer,F=(N.$isMousePressed=!0,this);if(b.isOldIE&&w.domEvent.type=="dblclick")return setTimeout(function(){k(w)});var H=function(q){F.releaseMouse&&R.curOp.command.name&&R.curOp.selectionChanged&&(F[F.state+"End"]&&F[F.state+"End"](),F.state="",F.releaseMouse())},V=(R.on("beforeEndOperation",H),R.startOperation({command:{name:"mouse"}}),F.$onCaptureMouseMove=P,F.releaseMouse=g.capture(this.editor.container,P,k),setInterval(L,20))},E.prototype.cancelContextMenu=function(){var w=(function(S){S&&S.domEvent&&S.domEvent.type!="contextmenu"||(this.editor.off("nativecontextmenu",w),S&&S.domEvent&&g.stopEvent(S.domEvent))}).bind(this);setTimeout(w,10),this.editor.on("nativecontextmenu",w)},E.prototype.destroy=function(){this.releaseMouse&&this.releaseMouse()},E);function E(w){this.$dragDelay,this.$dragEnabled,this.$mouseMoved,this.mouseEvent,this.$focusTimeout;function S(R){document.hasFocus&&document.hasFocus()&&(w.isFocused()||document.activeElement!=(w.textInput&&w.textInput.getElement()))||window.focus(),w.focus(),setTimeout(function(){w.isFocused()||w.focus()})}var P=this,k=(this.editor=w,new y(this),new x(this),new v(this),w.renderer.getMouseEventTarget()),L=(g.addListener(k,"click",this.onMouseEvent.bind(this,"click"),w),g.addListener(k,"mousemove",this.onMouseMove.bind(this,"mousemove"),w),g.addMultiMouseDownListener([k,w.renderer.scrollBarV&&w.renderer.scrollBarV.inner,w.renderer.scrollBarH&&w.renderer.scrollBarH.inner,w.textInput&&w.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent",w),g.addMouseWheelListener(w.container,this.onMouseWheel.bind(this,"mousewheel"),w),_(w.container,w),w.renderer.$gutter);g.addListener(L,"mousedown",this.onMouseEvent.bind(this,"guttermousedown"),w),g.addListener(L,"click",this.onMouseEvent.bind(this,"gutterclick"),w),g.addListener(L,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick"),w),g.addListener(L,"mousemove",this.onMouseEvent.bind(this,"guttermousemove"),w),g.addListener(k,"mousedown",S,w),g.addListener(L,"mousedown",S,w),b.isIE&&w.renderer.scrollBarV&&(g.addListener(w.renderer.scrollBarV.element,"mousedown",S,w),g.addListener(w.renderer.scrollBarH.element,"mousedown",S,w)),w.on("mousemove",function(R){var N,F;P.state||P.$dragDelay||!P.$dragEnabled||(R=w.renderer.screenToTextCoordinates(R.x,R.y),N=w.session.selection.getRange(),F=w.renderer,!N.isEmpty()&&N.insideStart(R.row,R.column)?F.setCursorStyle("default"):F.setCursorStyle(""))},w)}T.prototype.releaseMouse=null,I.defineOptions(T.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:b.isMac?150:0},dragEnabled:{initialValue:!0},focusTimeout:{initialValue:0},tooltipFollowsMouse:{initialValue:!0}}),f.MouseHandler=T}),ace.define("ace/mouse/fold_handler",["require","exports","module","ace/lib/dom"],function(h,f,C){"use strict";var g=h("../lib/dom");f.FoldHandler=function(b){b.on("click",function(y){var A=y.getDocumentPosition(),x=b.session,A=x.getFoldAt(A.row,A.column,1),A=(A&&(y.getAccelKey()?x.removeFold(A):x.expandFold(A),y.stop()),y.domEvent&&y.domEvent.target);A&&g.hasCssClass(A,"ace_inline_button")&&g.hasCssClass(A,"ace_toggle_wrap")&&(x.setOption("wrap",!x.getUseWrapMode()),b.renderer.scrollCursorIntoView())}),b.on("gutterclick",function(y){var x,A;b.renderer.$gutterLayer.getRegion(y)=="foldWidgets"&&(x=y.getDocumentPosition().row,(A=b.session).foldWidgets&&A.foldWidgets[x]&&b.session.onFoldWidgetClick(x,y),b.isFocused()||b.focus(),y.stop())}),b.on("gutterdblclick",function(y){var x,A,v;b.renderer.$gutterLayer.getRegion(y)=="foldWidgets"&&(v=y.getDocumentPosition().row,(A=(A=(x=b.session).getParentFoldRangeData(v,!0)).range||A.firstRange)&&(v=A.start.row,(v=x.getFoldAt(v,x.getLine(v).length,1))?x.removeFold(v):(x.addFold("...",A),b.renderer.scrollCursorIntoView({row:A.start.row,column:0}))),y.stop())})}}),ace.define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],function(h,f,C){"use strict";var g=h("../lib/keys"),b=h("../lib/event");function y(x){this.$editor=x,this.$data={editor:x},this.$handlers=[],this.setDefaultHandler(x.commands)}y.prototype.setDefaultHandler=function(x){this.removeKeyboardHandler(this.$defaultHandler),this.$defaultHandler=x,this.addKeyboardHandler(x,0)},y.prototype.setKeyboardHandler=function(x){var A=this.$handlers;if(A[A.length-1]!=x){for(;A[A.length-1]&&A[A.length-1]!=this.$defaultHandler;)this.removeKeyboardHandler(A[A.length-1]);this.addKeyboardHandler(x,1)}},y.prototype.addKeyboardHandler=function(x,A){var v;x&&(typeof x!="function"||x.handleKeyboard||(x.handleKeyboard=x),(v=this.$handlers.indexOf(x))!=-1&&this.$handlers.splice(v,1),A==null?this.$handlers.push(x):this.$handlers.splice(A,0,x),v==-1)&&x.attach&&x.attach(this.$editor)},y.prototype.removeKeyboardHandler=function(x){var A=this.$handlers.indexOf(x);return A!=-1&&(this.$handlers.splice(A,1),x.detach&&x.detach(this.$editor),!0)},y.prototype.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]},y.prototype.getStatusText=function(){var x=this.$data,A=x.editor;return this.$handlers.map(function(v){return v.getStatusText&&v.getStatusText(A,x)||""}).filter(Boolean).join(" ")},y.prototype.$callKeyboardHandlers=function(x,A,v,_){for(var I,T=!1,E=this.$editor.commands,w=this.$handlers.length;w--&&!((I=this.$handlers[w].handleKeyboard(this.$data,x,A,v,_))&&I.command&&((T=I.command=="null"||E.exec(I.command,this.$editor,I.args,_))&&_&&x!=-1&&I.passEvent!=1&&I.command.passEvent!=1&&b.stopEvent(_),T)););return T||x!=-1||(I={command:"insertstring"},T=E.exec("insertstring",this.$editor,A)),T&&this.$editor._signal&&this.$editor._signal("keyboardActivity",I),T},y.prototype.onCommandKey=function(x,A,v){var _=g.keyCodeToString(v);return this.$callKeyboardHandlers(A,_,v,x)},y.prototype.onTextInput=function(x){return this.$callKeyboardHandlers(-1,x)},f.KeyBinding=y}),ace.define("ace/lib/bidiutil",["require","exports","module"],function(h,f,C){"use strict";var g=0,b=0,y=!1,x=!1,A=!1,v=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],_=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],I=0,T=1,E=2,w=3,S=4,P=5,k=6,L=7,R=8,N=9,F=10,H=11,V=12,q=13,Q=14,O=15,B=16,j=17,U=18,z=[U,U,U,U,U,U,U,U,U,k,P,k,R,P,U,U,U,U,U,U,U,U,U,U,U,U,U,U,P,P,P,k,R,S,S,H,H,H,S,S,S,S,S,F,N,F,N,N,E,E,E,E,E,E,E,E,E,E,N,S,S,S,S,S,S,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,S,S,S,S,S,S,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,S,S,S,S,U,U,U,U,U,U,P,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,U,N,S,H,H,H,H,S,S,S,S,I,S,S,U,S,S,H,H,E,E,S,I,S,S,S,E,I,S,S,S,S,S],$=[R,R,R,R,R,R,R,R,R,R,R,U,U,U,I,T,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,R,P,q,Q,O,B,j,N,H,H,H,H,H,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,N,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,S,R];function Z(ne,le,ee,oe){var te,X,W,K=g?_:v,re=0,se=-1,me=null,Y=null,ae=[];if(!oe)for(me=0,oe=[];me<ee;me++)oe[me]=ie(ne[me]);for(b=g,A=x=y=!1,Y=0;Y<ee;Y++){if(W=re,ae[Y]=te=function(ge,Se,Ee,Fe){var Ae,we,_e,Ke=Se[Fe];switch(Ke){case I:case T:y=!1;case S:case w:return Ke;case E:return y?w:E;case L:return y=!0,T;case R:return S;case N:return Fe<1||Fe+1>=Se.length||(Ae=Ee[Fe-1])!=E&&Ae!=w||(rt=Se[Fe+1])!=E&&rt!=w?S:(rt=y?w:rt)==Ae?rt:S;case F:return(Ae=0<Fe?Ee[Fe-1]:P)==E&&Fe+1<Se.length&&Se[Fe+1]==E?E:S;case H:if(0<Fe&&Ee[Fe-1]==E)return E;if(y)return S;for(_e=Fe+1,we=Se.length;_e<we&&Se[_e]==H;)_e++;return _e<we&&Se[_e]==E?E:S;case V:for(we=Se.length,_e=Fe+1;_e<we&&Se[_e]==V;)_e++;if(_e<we){var rt=ge[Fe],rt=1425<=rt&&rt<=2303||rt==64286;if(Ae=Se[_e],rt&&(Ae==T||Ae==L))return T}return Fe<1||(Ae=Se[Fe-1])==P?S:Ee[Fe-1];case P:return x=!(y=!1),g;case k:return A=!0,S;case q:case Q:case B:case j:case O:y=!1;case U:return S}}(ne,oe,ae,Y),W=240&(re=K[W][te]),re&=15,le[Y]=X=K[re][5],0<W){if(W==16)for(me=se;me<Y;me++)le[me]=1;se=-1}if(K[re][6])se==-1&&(se=Y);else if(-1<se){for(me=se;me<Y;me++)le[me]=X;se=-1}oe[Y]==P&&(le[Y]=0),b|=X}if(A){for(me=0;me<ee;me++)if(oe[me]==k){le[me]=g;for(var ve=me-1;0<=ve&&oe[ve]==R;ve--)le[ve]=g}}}function J(ne,le,ee){if(!(b<ne))if(ne!=1||g!=1||x)for(var oe,te,X,W,K=ee.length,re=0;re<K;){if(le[re]>=ne){for(oe=re+1;oe<K&&le[oe]>=ne;)oe++;for(te=re,X=oe-1;te<X;te++,X--)W=ee[te],ee[te]=ee[X],ee[X]=W;re=oe}re++}else ee.reverse()}function ie(ne){var le=ne.charCodeAt(0),ee=le>>8;return ee==0?191<le?I:z[le]:ee==5?/[\u0591-\u05f4]/.test(ne)?T:I:ee==6?/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(ne)?V:/[\u0660-\u0669\u066b-\u066c]/.test(ne)?w:le==1642?H:/[\u06f0-\u06f9]/.test(ne)?E:L:ee==32&&le<=8287?$[255&le]:ee==254&&65136<=le?L:S}f.L=I,f.R=T,f.EN=E,f.ON_R=3,f.AN=4,f.R_H=5,f.B=6,f.RLE=7,f.DOT="\xB7",f.doBidiReorder=function(ne,le,ee){if(ne.length<2)return{};var oe=ne.split(""),te=new Array(oe.length),X=new Array(oe.length),W=[];g=ee?1:0,Z(oe,W,oe.length,le);for(var K=0;K<te.length;te[K]=K,K++);for(J(2,W,te),J(1,W,te),K=0;K<te.length-1;K++)le[K]===w?W[K]=f.AN:W[K]===T&&(le[K]>L&&le[K]<q||le[K]===S||le[K]===U)?W[K]=f.ON_R:0<K&&oe[K-1]==="\u0644"&&/\u0622|\u0623|\u0625|\u0627/.test(oe[K])&&(W[K-1]=W[K]=f.R_H,K++);for(oe[oe.length-1]===f.DOT&&(W[oe.length-1]=f.B),oe[0]==="\u202B"&&(W[0]=f.RLE),K=0;K<te.length;K++)X[K]=W[te[K]];return{logicalFromVisual:te,bidiLevels:X}},f.hasBidiCharacters=function(ne,le){for(var ee=!1,oe=0;oe<ne.length;oe++)le[oe]=ie(ne.charAt(oe)),ee||le[oe]!=T&&le[oe]!=L&&le[oe]!=w||(ee=!0);return ee},f.getVisualFromLogicalIdx=function(ne,le){for(var ee=0;ee<le.logicalFromVisual.length;ee++)if(le.logicalFromVisual[ee]==ne)return ee;return 0}}),ace.define("ace/bidihandler",["require","exports","module","ace/lib/bidiutil","ace/lib/lang"],function(h,f,C){"use strict";var g=h("./lib/bidiutil"),b=h("./lib/lang"),y=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\u202B]/;function x(A){this.session=A,this.bidiMap={},this.currentRow=null,this.bidiUtil=g,this.charWidths=[],this.EOL="\xAC",this.showInvisibles=!0,this.isRtlDir=!1,this.$isRtl=!1,this.line="",this.wrapIndent=0,this.EOF="\xB6",this.RLE="\u202B",this.contentWidth=0,this.fontMetrics=null,this.rtlLineOffset=0,this.wrapOffset=0,this.isMoveLeftOperation=!1,this.seenBidi=y.test(A.getValue())}x.prototype.isBidiRow=function(A,v,_){return!!this.seenBidi&&(A!==this.currentRow&&(this.currentRow=A,this.updateRowLine(v,_),this.updateBidiMap()),this.bidiMap.bidiLevels)},x.prototype.onChange=function(A){this.seenBidi?this.currentRow=null:A.action=="insert"&&y.test(A.lines.join(`
`))&&(this.seenBidi=!0,this.currentRow=null)},x.prototype.getDocumentRow=function(){var A=0,v=this.session.$screenRowCache;return A=v.length&&0<=(v=this.session.$getRowCacheIndex(v,this.currentRow))?this.session.$docRowCache[v]:A},x.prototype.getSplitIndex=function(){var A=0,v=this.session.$screenRowCache;if(v.length)for(var _,I=this.session.$getRowCacheIndex(v,this.currentRow);0<this.currentRow-A&&(_=this.session.$getRowCacheIndex(v,this.currentRow-A-1))===I;)I=_,A++;else A=this.currentRow;return A},x.prototype.updateRowLine=function(A,v){var _,I=(A=A===void 0?this.getDocumentRow():A)===this.session.getLength()-1?this.EOF:this.EOL,T=(this.wrapIndent=0,this.line=this.session.getLine(A),this.isRtlDir=this.$isRtl||this.line.charAt(0)===this.RLE,(!this.session.$useWrapMode||(A=this.session.$wrapData[A])&&(0<(v=v===void 0?this.getSplitIndex():v)&&A.length?(this.wrapIndent=A.indent,this.wrapOffset=this.wrapIndent*this.charWidths[g.L],this.line=v<A.length?this.line.substring(A[v-1],A[v]):this.line.substring(A[A.length-1])):this.line=this.line.substring(0,A[v]),v==A.length))&&(this.line+=this.showInvisibles?I:g.DOT),this.session),E=0;this.line=this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g,function(w,S){return w==="	"||T.isFullWidth(w.charCodeAt(0))?(_=w==="	"?T.getScreenTabSize(S+E):2,E+=_-1,b.stringRepeat(g.DOT,_)):w}),this.isRtlDir&&(this.fontMetrics.$main.textContent=this.line.charAt(this.line.length-1)==g.DOT?this.line.substr(0,this.line.length-1):this.line,this.rtlLineOffset=this.contentWidth-this.fontMetrics.$main.getBoundingClientRect().width)},x.prototype.updateBidiMap=function(){var A=[];g.hasBidiCharacters(this.line,A)||this.isRtlDir?this.bidiMap=g.doBidiReorder(this.line,A,this.isRtlDir):this.bidiMap={}},x.prototype.markAsDirty=function(){this.currentRow=null},x.prototype.updateCharacterWidths=function(A){var v;this.characterWidth!==A.$characterSize.width&&(this.fontMetrics=A,v=this.characterWidth=A.$characterSize.width,A=A.$measureCharWidth("\u05D4"),this.charWidths[g.L]=this.charWidths[g.EN]=this.charWidths[g.ON_R]=v,this.charWidths[g.R]=this.charWidths[g.AN]=A,this.charWidths[g.R_H]=.45*A,this.charWidths[g.B]=this.charWidths[g.RLE]=0,this.currentRow=null)},x.prototype.setShowInvisibles=function(A){this.showInvisibles=A,this.currentRow=null},x.prototype.setEolChar=function(A){this.EOL=A},x.prototype.setContentWidth=function(A){this.contentWidth=A},x.prototype.isRtlLine=function(A){return!!this.$isRtl||(A!=null?this.session.getLine(A).charAt(0)==this.RLE:this.isRtlDir)},x.prototype.setRtlDirection=function(A,v){for(var _=A.getCursorPosition(),I=A.selection.getSelectionAnchor().row;I<=_.row;I++)v||A.session.getLine(I).charAt(0)!==A.session.$bidiHandler.RLE?v&&A.session.getLine(I).charAt(0)!==A.session.$bidiHandler.RLE&&A.session.doc.insert({column:0,row:I},A.session.$bidiHandler.RLE):A.session.doc.removeInLine(I,0,1)},x.prototype.getPosLeft=function(A){A-=this.wrapIndent;var v=this.line.charAt(0)===this.RLE?1:0,_=v<A?this.session.getOverwrite()?A:A-1:v,I=g.getVisualFromLogicalIdx(_,this.bidiMap),T=this.bidiMap.bidiLevels,E=0;!this.session.getOverwrite()&&A<=v&&T[I]%2!=0&&I++;for(var w=0;w<I;w++)E+=this.charWidths[T[w]];return!this.session.getOverwrite()&&v<A&&T[I]%2==0&&(E+=this.charWidths[T[I]]),this.wrapIndent&&(E+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset),this.isRtlDir&&(E+=this.rtlLineOffset),E},x.prototype.getSelections=function(A,v){var _,I=this.bidiMap,T=I.bidiLevels,E=[],w=0,S=Math.min(A,v)-this.wrapIndent,P=Math.max(A,v)-this.wrapIndent,k=!1,L=!1,R=0;this.wrapIndent&&(w+=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);for(var N,F=0;F<T.length;F++)N=I.logicalFromVisual[F],_=T[F],(k=S<=N&&N<P)&&!L?R=w:!k&&L&&E.push({left:R,width:w-R}),w+=this.charWidths[_],L=k;if(k&&F===T.length&&E.push({left:R,width:w-R}),this.isRtlDir)for(var H=0;H<E.length;H++)E[H].left+=this.rtlLineOffset;return E},x.prototype.offsetToCol=function(_){this.isRtlDir&&(_-=this.rtlLineOffset);var v=0,_=Math.max(_,0),I=0,T=0,E=this.bidiMap.bidiLevels,w=this.charWidths[E[T]];for(this.wrapIndent&&(_-=this.isRtlDir?-1*this.wrapOffset:this.wrapOffset);I+w/2<_;){if(I+=w,T===E.length-1){w=0;break}w=this.charWidths[E[++T]]}return(v=0<T&&E[T-1]%2!=0&&E[T]%2==0?(_<I&&T--,this.bidiMap.logicalFromVisual[T]):0<T&&E[T-1]%2==0&&E[T]%2!=0?1+(I<_?this.bidiMap.logicalFromVisual[T]:this.bidiMap.logicalFromVisual[T-1]):this.isRtlDir&&T===E.length-1&&w===0&&E[T-1]%2==0||!this.isRtlDir&&T===0&&E[T]%2!=0?1+this.bidiMap.logicalFromVisual[T]:(0<T&&E[T-1]%2!=0&&w!==0&&T--,this.bidiMap.logicalFromVisual[T]))===0&&this.isRtlDir&&v++,v+this.wrapIndent},f.BidiHandler=x}),ace.define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"],function(A,f,C){"use strict";var g=A("./lib/oop"),b=A("./lib/lang"),y=A("./lib/event_emitter").EventEmitter,x=A("./range").Range,A=(v.prototype.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column},v.prototype.isMultiLine=function(){return!this.$isEmpty&&this.anchor.row!=this.cursor.row},v.prototype.getCursor=function(){return this.lead.getPosition()},v.prototype.setAnchor=function(_,I){this.$isEmpty=!1,this.anchor.setPosition(_,I)},v.prototype.getAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.anchor.getPosition()},v.prototype.getSelectionLead=function(){return this.lead.getPosition()},v.prototype.isBackwards=function(){var _=this.anchor,I=this.lead;return _.row>I.row||_.row==I.row&&_.column>I.column},v.prototype.getRange=function(){var _=this.anchor,I=this.lead;return this.$isEmpty?x.fromPoints(I,I):this.isBackwards()?x.fromPoints(I,_):x.fromPoints(_,I)},v.prototype.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._emit("changeSelection"))},v.prototype.selectAll=function(){this.$setSelection(0,0,Number.MAX_VALUE,Number.MAX_VALUE)},v.prototype.setRange=function(_,E){var T=E?_.end:_.start,E=E?_.start:_.end;this.$setSelection(T.row,T.column,E.row,E.column)},v.prototype.$setSelection=function(_,I,T,E){var w,S;!this.$silent&&(w=this.$isEmpty,S=this.inMultiSelectMode,this.$silent=!0,this.$cursorChanged=this.$anchorChanged=!1,this.anchor.setPosition(_,I),this.cursor.setPosition(T,E),this.$isEmpty=!x.comparePoints(this.anchor,this.cursor),this.$silent=!1,this.$cursorChanged&&this._emit("changeCursor"),this.$cursorChanged||this.$anchorChanged||w!=this.$isEmpty||S)&&this._emit("changeSelection")},v.prototype.$moveSelection=function(_){var I=this.lead;this.$isEmpty&&this.setSelectionAnchor(I.row,I.column),_.call(this)},v.prototype.selectTo=function(_,I){this.$moveSelection(function(){this.moveCursorTo(_,I)})},v.prototype.selectToPosition=function(_){this.$moveSelection(function(){this.moveCursorToPosition(_)})},v.prototype.moveTo=function(_,I){this.clearSelection(),this.moveCursorTo(_,I)},v.prototype.moveToPosition=function(_){this.clearSelection(),this.moveCursorToPosition(_)},v.prototype.selectUp=function(){this.$moveSelection(this.moveCursorUp)},v.prototype.selectDown=function(){this.$moveSelection(this.moveCursorDown)},v.prototype.selectRight=function(){this.$moveSelection(this.moveCursorRight)},v.prototype.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},v.prototype.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},v.prototype.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},v.prototype.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},v.prototype.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},v.prototype.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},v.prototype.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},v.prototype.getWordRange=function(_,I){var T;return I===void 0&&(_=(T=_||this.lead).row,I=T.column),this.session.getWordRange(_,I)},v.prototype.selectWord=function(){this.setSelectionRange(this.getWordRange())},v.prototype.selectAWord=function(){var _=this.getCursor(),_=this.session.getAWordRange(_.row,_.column);this.setSelectionRange(_)},v.prototype.getLineRange=function(T,I){var T=typeof T=="number"?T:this.lead.row,E=this.session.getFoldLine(T),E=E?(T=E.start.row,E.end.row):T;return I===!0?new x(T,0,E,this.session.getLine(E).length):new x(T,0,E+1,0)},v.prototype.selectLine=function(){this.setSelectionRange(this.getLineRange())},v.prototype.moveCursorUp=function(){this.moveCursorBy(-1,0)},v.prototype.moveCursorDown=function(){this.moveCursorBy(1,0)},v.prototype.wouldMoveIntoSoftTab=function(_,I,T){var E=_.column,w=_.column+I;return T<0&&(E=_.column-I,w=_.column),this.session.isTabStop(_)&&this.doc.getLine(_.row).slice(E,w).split(" ").length-1==I},v.prototype.moveCursorLeft=function(){var _,I=this.lead.getPosition();(_=this.session.getFoldAt(I.row,I.column,-1))?this.moveCursorTo(_.start.row,_.start.column):I.column===0?0<I.row&&this.moveCursorTo(I.row-1,this.doc.getLine(I.row-1).length):(_=this.session.getTabSize(),this.wouldMoveIntoSoftTab(I,_,-1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,-_):this.moveCursorBy(0,-1))},v.prototype.moveCursorRight=function(){var _,I=this.lead.getPosition();(_=this.session.getFoldAt(I.row,I.column,1))?this.moveCursorTo(_.end.row,_.end.column):this.lead.column==this.doc.getLine(this.lead.row).length?this.lead.row<this.doc.getLength()-1&&this.moveCursorTo(this.lead.row+1,0):(_=this.session.getTabSize(),I=this.lead,this.wouldMoveIntoSoftTab(I,_,1)&&!this.session.getNavigateWithinSoftTabs()?this.moveCursorBy(0,_):this.moveCursorBy(0,1))},v.prototype.moveCursorLineStart=function(){var T=this.lead.row,_=this.lead.column,I=this.session.documentToScreenRow(T,_),I=this.session.screenToDocumentPosition(I,0),T=this.session.getDisplayLine(T,null,I.row,I.column).match(/^\s*/);T[0].length==_||this.session.$useEmacsStyleLineStart||(I.column+=T[0].length),this.moveCursorToPosition(I)},v.prototype.moveCursorLineEnd=function(){var _,I=this.lead,I=this.session.getDocumentLastRowColumnPosition(I.row,I.column);this.lead.column==I.column&&(_=this.session.getLine(I.row),I.column==_.length)&&0<(_=_.search(/\s+$/))&&(I.column=_),this.moveCursorTo(I.row,I.column)},v.prototype.moveCursorFileEnd=function(){var _=this.doc.getLength()-1,I=this.doc.getLine(_).length;this.moveCursorTo(_,I)},v.prototype.moveCursorFileStart=function(){this.moveCursorTo(0,0)},v.prototype.moveCursorLongWordRight=function(){var _=this.lead.row,I=this.lead.column,T=this.doc.getLine(_),E=T.substring(I),w=(this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.getFoldAt(_,I,1));w?this.moveCursorTo(w.end.row,w.end.column):(this.session.nonTokenRe.exec(E)&&(I+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0,E=T.substring(I)),I>=T.length?(this.moveCursorTo(_,T.length),this.moveCursorRight(),_<this.doc.getLength()-1&&this.moveCursorWordRight()):(this.session.tokenRe.exec(E)&&(I+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(_,I)))},v.prototype.moveCursorLongWordLeft=function(){var _,I=this.lead.row,T=this.lead.column;(_=this.session.getFoldAt(I,T,-1))?this.moveCursorTo(_.start.row,_.start.column):((_=this.session.getFoldStringAt(I,T,-1))==null&&(_=this.doc.getLine(I).substring(0,T)),_=b.stringReverse(_),this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0,this.session.nonTokenRe.exec(_)&&(T-=this.session.nonTokenRe.lastIndex,_=_.slice(this.session.nonTokenRe.lastIndex),this.session.nonTokenRe.lastIndex=0),T<=0?(this.moveCursorTo(I,0),this.moveCursorLeft(),0<I&&this.moveCursorWordLeft()):(this.session.tokenRe.exec(_)&&(T-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0),this.moveCursorTo(I,T)))},v.prototype.$shortWordEndIndex=function(_){var I,T=0,E=/\s/,w=this.session.tokenRe;if(w.lastIndex=0,this.session.tokenRe.exec(_))T=this.session.tokenRe.lastIndex;else{for(;(I=_[T])&&E.test(I);)T++;if(T<1){for(w.lastIndex=0;(I=_[T])&&!w.test(I);)if(w.lastIndex=0,T++,E.test(I)){if(2<T){T--;break}for(;(I=_[T])&&E.test(I);)T++;if(2<T)break}}}return w.lastIndex=0,T},v.prototype.moveCursorShortWordRight=function(){var _=this.lead.row,I=this.lead.column,T=this.doc.getLine(_),E=T.substring(I),w=this.session.getFoldAt(_,I,1);if(w)return this.moveCursorTo(w.end.row,w.end.column);if(I==T.length){for(var S=this.doc.getLength();E=this.doc.getLine(++_),_<S&&/^\s*$/.test(E););/^\s+/.test(E)||(E=""),I=0}w=this.$shortWordEndIndex(E),this.moveCursorTo(_,I+w)},v.prototype.moveCursorShortWordLeft=function(){var _=this.lead.row,I=this.lead.column;if(E=this.session.getFoldAt(_,I,-1))return this.moveCursorTo(E.start.row,E.start.column);var T=this.session.getLine(_).substring(0,I);if(I===0){for(;T=this.doc.getLine(--_),0<_&&/^\s*$/.test(T););I=T.length,/\s+$/.test(T)||(T="")}var E=b.stringReverse(T),E=this.$shortWordEndIndex(E);return this.moveCursorTo(_,I-E)},v.prototype.moveCursorWordRight=function(){this.session.$selectLongWords?this.moveCursorLongWordRight():this.moveCursorShortWordRight()},v.prototype.moveCursorWordLeft=function(){this.session.$selectLongWords?this.moveCursorLongWordLeft():this.moveCursorShortWordLeft()},v.prototype.moveCursorBy=function(_,I){var T,E=this.session.documentToScreenPosition(this.lead.row,this.lead.column),w=(I===0&&(_!==0&&(this.session.$bidiHandler.isBidiRow(E.row,this.lead.row)?(T=this.session.$bidiHandler.getPosLeft(E.column),E.column=Math.round(T/this.session.$bidiHandler.charWidths[0])):T=E.column*this.session.$bidiHandler.charWidths[0]),this.$desiredColumn?E.column=this.$desiredColumn:this.$desiredColumn=E.column),_!=0&&this.session.lineWidgets&&this.session.lineWidgets[this.lead.row]&&(w=this.session.lineWidgets[this.lead.row],_<0?_-=w.rowsAbove||0:0<_&&(_+=w.rowCount-(w.rowsAbove||0))),this.session.screenToDocumentPosition(E.row+_,E.column,T));_!==0&&I===0&&w.row===this.lead.row&&(w.column,this.lead.column),this.moveCursorTo(w.row,w.column+I,I===0)},v.prototype.moveCursorToPosition=function(_){this.moveCursorTo(_.row,_.column)},v.prototype.moveCursorTo=function(_,I,T){var E=this.session.getFoldAt(_,I,1),E=(E&&(_=E.start.row,I=E.start.column),this.$keepDesiredColumnOnChange=!0,this.session.getLine(_));/[\uDC00-\uDFFF]/.test(E.charAt(I))&&E.charAt(I-1)&&(this.lead.row==_&&this.lead.column==I+1?I-=1:I+=1),this.lead.setPosition(_,I),this.$keepDesiredColumnOnChange=!1,T||(this.$desiredColumn=null)},v.prototype.moveCursorToScreen=function(_,I,T){_=this.session.screenToDocumentPosition(_,I),this.moveCursorTo(_.row,_.column,T)},v.prototype.detach=function(){this.lead.detach(),this.anchor.detach()},v.prototype.fromOrientedRange=function(_){this.setSelectionRange(_,_.cursor==_.start),this.$desiredColumn=_.desiredColumn||this.$desiredColumn},v.prototype.toOrientedRange=function(_){var I=this.getRange();return _?(_.start.column=I.start.column,_.start.row=I.start.row,_.end.column=I.end.column,_.end.row=I.end.row):_=I,_.cursor=this.isBackwards()?_.start:_.end,_.desiredColumn=this.$desiredColumn,_},v.prototype.getRangeOfMovements=function(_){var I=this.getCursor();try{_(this);var T=this.getCursor();return x.fromPoints(I,T)}catch{return x.fromPoints(I,I)}finally{this.moveCursorToPosition(I)}},v.prototype.toJSON=function(){var _;return this.rangeCount?_=this.ranges.map(function(I){var T=I.clone();return T.isBackwards=I.cursor==I.start,T}):(_=this.getRange()).isBackwards=this.isBackwards(),_},v.prototype.fromJSON=function(_){if(_.start==null){if(this.rangeList&&1<_.length){this.toSingleRange(_[0]);for(var I=_.length;I--;){var T=x.fromPoints(_[I].start,_[I].end);_[I].isBackwards&&(T.cursor=T.start),this.addRange(T,!0)}return}_=_[0]}this.rangeList&&this.toSingleRange(_),this.setSelectionRange(_,_.isBackwards)},v.prototype.isEqual=function(_){if((_.length||this.rangeCount)&&_.length!=this.rangeCount)return!1;if(!_.length||!this.ranges)return this.getRange().isEqual(_);for(var I=this.ranges.length;I--;)if(!this.ranges[I].isEqual(_[I]))return!1;return!0},v);function v(_){this.session=_,this.doc=_.getDocument(),this.clearSelection(),this.cursor=this.lead=this.doc.createAnchor(0,0),this.anchor=this.doc.createAnchor(0,0),this.$silent=!1;var I=this;this.cursor.on("change",function(T){I.$cursorChanged=!0,I.$silent||I._emit("changeCursor"),I.$isEmpty||I.$silent||I._emit("changeSelection"),I.$keepDesiredColumnOnChange||T.old.column==T.value.column||(I.$desiredColumn=null)}),this.anchor.on("change",function(){I.$anchorChanged=!0,I.$isEmpty||I.$silent||I._emit("changeSelection")})}A.prototype.setSelectionAnchor=A.prototype.setAnchor,A.prototype.getSelectionAnchor=A.prototype.getAnchor,A.prototype.setSelectionRange=A.prototype.setRange,g.implement(A.prototype,y),f.Selection=A}),ace.define("ace/tokenizer",["require","exports","module","ace/lib/report_error"],function(g,f,C){"use strict";var g=g("./lib/report_error").reportError,b=2e3,y=(x.prototype.$setMaxTokenCount=function(A){b=0|A},x.prototype.$applyToken=function(A){var v=this.splitRegex.exec(A).slice(1),_=this.token.apply(this,v);if(typeof _=="string")return[{type:_,value:A}];for(var I=[],T=0,E=_.length;T<E;T++)v[T]&&(I[I.length]={type:_[T],value:v[T]});return I},x.prototype.$arrayTokens=function(A){if(!A)return[];var v=this.splitRegex.exec(A);if(!v)return"text";for(var _=[],I=this.tokenArray,T=0,E=I.length;T<E;T++)v[T+1]&&(_[_.length]={type:I[T],value:v[T+1]});return _},x.prototype.removeCapturingGroups=function(A){return A.replace(/\\.|\[(?:\\.|[^\\\]])*|\(\?[:=!<]|(\()/g,function(v,_){return _?"(?:":v})},x.prototype.createSplitterRegexp=function(A,v){var _,I,T;return(A=(A=A.indexOf("(?=")!=-1&&(_=0,I=!1,T={},A.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,function(E,w,S,P,k,L){return I?I=k!="]":k?I=!0:P?(_==T.stack&&(T.end=L+1,T.stack=-1),_--):S&&(_++,S.length!=1)&&(T.stack=_,T.start=L),E}),T.end!=null)&&/^\)*$/.test(A.substr(T.end))?A.substring(0,T.start)+A.substr(T.end):A).charAt(0)!="^"?"^"+A:A).charAt(A.length-1)!="$"&&(A+="$"),new RegExp(A,(v||"").replace("g",""))},x.prototype.getLineTokens=function(A,v){v&&typeof v!="string"?(v=(_=v.slice(0))[0])==="#tmp"&&(_.shift(),v=_.shift()):_=[];for(var _,I,T=v||"start",E=(E=this.states[T])||this.states[T="start"],w=this.matchMappings[T],S=this.regExps[T],P=[],k=S.lastIndex=0,L=0,R={type:null,value:""};I=S.exec(A);){var N,F=w.defaultToken,H=null,V=I[0],q=S.lastIndex;q-V.length>k&&(N=A.substring(k,q-V.length),R.type==F?R.value+=N:(R.type&&P.push(R),R={type:F,value:N}));for(var Q=0;Q<I.length-2;Q++)if(I[Q+1]!==void 0){F=(H=E[w[Q]]).onMatch?H.onMatch(V,T,_,A):H.token,H.next&&(T=typeof H.next=="string"?H.next:H.next(T,_),(E=this.states[T])||(this.reportError("state doesn't exist",T),E=this.states[T="start"]),w=this.matchMappings[T],(S=this.regExps[T]).lastIndex=k=q),H.consumeLineEnd&&(k=q);break}if(V){if(typeof F=="string")H&&H.merge===!1||R.type!==F?(R.type&&P.push(R),R={type:F,value:V}):R.value+=V;else if(F)for(R.type&&P.push(R),R={type:null,value:""},Q=0;Q<F.length;Q++)P.push(F[Q])}if(k==A.length)break;if(k=q,L++>b){for(L>2*A.length&&this.reportError("infinite loop with in ace tokenizer",{startState:v,line:A});k<A.length;)R.type&&P.push(R),R={value:A.substring(k,k+=500),type:"overflow"};T="start",_=[];break}}return R.type&&P.push(R),1<_.length&&_[0]!==T&&_.unshift("#tmp",T),{tokens:P,state:_.length?_:T}},x);function x(A){for(var v in this.splitRegex,this.states=A,this.regExps={},this.matchMappings={},this.states){for(var _=this.states[v],I=[],T=0,E=this.matchMappings[v]={defaultToken:"text"},w="g",S=[],P=0;P<_.length;P++){var k,L,R=_[P];R.defaultToken&&(E.defaultToken=R.defaultToken),R.caseInsensitive&&w.indexOf("i")===-1&&(w+="i"),R.unicode&&w.indexOf("u")===-1&&(w+="u"),R.regex==null||(R.regex instanceof RegExp&&(R.regex=R.regex.toString().slice(1,-1)),k=R.regex,L=new RegExp("(?:("+k+")|(.))").exec("a").length-2,Array.isArray(R.token)?R.token.length==1||L==1?R.token=R.token[0]:L-1!=R.token.length?(this.reportError("number of classes and regexp groups doesn't match",{rule:R,groupCount:L-1}),R.token=R.token[0]):(R.tokenArray=R.token,R.token=null,R.onMatch=this.$arrayTokens):typeof R.token!="function"||R.onMatch||(R.onMatch=1<L?this.$applyToken:R.token),1<L&&(k=/\\\d/.test(R.regex)?R.regex.replace(/\\([0-9]+)/g,function(N,F){return"\\"+(parseInt(F,10)+T+1)}):(L=1,this.removeCapturingGroups(R.regex)),R.splitRegex||typeof R.token=="string"||S.push(R)),E[T]=P,T+=L,I.push(k),R.onMatch)||(R.onMatch=null)}I.length||(E[0]=0,I.push("$")),S.forEach(function(N){N.splitRegex=this.createSplitterRegexp(N.regex,w)},this),this.regExps[v]=new RegExp("("+I.join(")|(")+")|($)",w)}}y.prototype.reportError=g,f.Tokenizer=y}),ace.define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/deep_copy"],function(b,f,C){"use strict";var g=b("../lib/deep_copy").deepCopy,b=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}};(function(){this.addRules=function(A,v){if(v)for(var _ in A){for(var I=A[_],T=0;T<I.length;T++){var E=I[T];(E.next||E.onMatch)&&(typeof E.next=="string"&&E.next.indexOf(v)!==0&&(E.next=v+E.next),E.nextState)&&E.nextState.indexOf(v)!==0&&(E.nextState=v+E.nextState)}this.$rules[v+_]=I}else for(var _ in A)this.$rules[_]=A[_]},this.getRules=function(){return this.$rules},this.embedRules=function(A,v,_,I,T){if(A=typeof A=="function"?new A().getRules():A,I)for(var E=0;E<I.length;E++)I[E]=v+I[E];else for(var w in I=[],A)I.push(v+w);if(this.addRules(A,v),_)for(var S=Array.prototype[T?"push":"unshift"],E=0;E<I.length;E++)S.apply(this.$rules[I[E]],g(_));this.$embeds||(this.$embeds=[]),this.$embeds.push(v)},this.getEmbeds=function(){return this.$embeds};function y(A,v){return A=="start"&&!v.length||v.unshift(this.nextState,A),this.nextState}function x(A,v){return v.shift(),v.shift()||"start"}this.normalizeRules=function(){var A=0,v=this.$rules;Object.keys(v).forEach(function _(I){var T=v[I];T.processed=!0;for(var E=0;E<T.length;E++){var w=T[E],S=null,P=(Array.isArray(w)&&(S=w,w={}),!w.regex&&w.start&&(w.regex=w.start,w.next||(w.next=[]),w.next.push({defaultToken:w.token},{token:w.token+".end",regex:w.end||w.start,next:"pop"}),w.token=w.token+".start",w.push=!0),w.next||w.push);if(P&&Array.isArray(P)?((L=w.stateName)||(typeof(L=w.token)!="string"&&(L=L[0]||""),v[L]&&(L+=A++)),v[L]=P,_(w.next=L)):P=="pop"&&(w.next=x),w.push&&(w.nextState=w.next||w.push,w.next=y,delete w.push),w.rules)for(var k in w.rules)v[k]?v[k].push&&v[k].push.apply(v[k],w.rules[k]):v[k]=w.rules[k];var L=typeof w=="string"?w:w.include;L&&(L==="$self"&&(L="start"),S=Array.isArray(L)?L.map(function(R){return v[R]}):v[L]),S&&(P=[E,1].concat(S),w.noEscape&&(P=P.filter(function(R){return!R.next})),T.splice.apply(T,P),E--),w.keywordMap&&(w.token=this.createKeywordMapper(w.keywordMap,w.defaultToken||"text",w.caseInsensitive),delete w.defaultToken)}},this)},this.createKeywordMapper=function(A,v,_,I){var T=Object.create(null);return this.$keywordList=[],Object.keys(A).forEach(function(E){for(var w=A[E].split(I||"|"),S=w.length;S--;){var P=w[S];this.$keywordList.push(P),_&&(P=P.toLowerCase()),T[P]=E}},this),A=null,_?function(E){return T[E.toLowerCase()]||v}:function(E){return T[E]||v}},this.getKeywords=function(){return this.$keywords}}).call(b.prototype),f.TextHighlightRules=b}),ace.define("ace/mode/behaviour",["require","exports","module"],function(h,f,C){"use strict";var g=function(){this.$behaviours={}};(function(){this.add=function(b,y,x){switch(void 0){case this.$behaviours:this.$behaviours={};case this.$behaviours[b]:this.$behaviours[b]={}}this.$behaviours[b][y]=x},this.addBehaviours=function(b){for(var y in b)for(var x in b[y])this.add(y,x,b[y][x])},this.remove=function(b){this.$behaviours&&this.$behaviours[b]&&delete this.$behaviours[b]},this.inherit=function(b,y){b=(typeof b=="function"?new b:b).getBehaviours(y),this.addBehaviours(b)},this.getBehaviours=function(b){if(b){for(var y={},x=0;x<b.length;x++)this.$behaviours[b[x]]&&(y[b[x]]=this.$behaviours[b[x]]);return y}return this.$behaviours}}).call(g.prototype),f.Behaviour=g}),ace.define("ace/token_iterator",["require","exports","module","ace/range"],function(h,f,C){"use strict";var g=h("./range").Range;function b(y,x,A){this.$session=y,this.$row=x,this.$rowTokens=y.getTokens(x),y=y.getTokenAt(x,A),this.$tokenIndex=y?y.index:-1}b.prototype.stepBackward=function(){for(--this.$tokenIndex;this.$tokenIndex<0;){if(--this.$row,this.$row<0)return this.$row=0,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]},b.prototype.stepForward=function(){var y;for(this.$tokenIndex+=1;this.$tokenIndex>=this.$rowTokens.length;){if(this.$row+=1,y=y||this.$session.getLength(),this.$row>=y)return this.$row=y-1,null;this.$rowTokens=this.$session.getTokens(this.$row),this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]},b.prototype.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]},b.prototype.getCurrentTokenRow=function(){return this.$row},b.prototype.getCurrentTokenColumn=function(){var y=this.$rowTokens,x=this.$tokenIndex,A=y[x].start;if(A===void 0)for(A=0;0<x;)A+=y[--x].value.length;return A},b.prototype.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}},b.prototype.getCurrentTokenRange=function(){var y=this.$rowTokens[this.$tokenIndex],x=this.getCurrentTokenColumn();return new g(this.$row,x,this.$row,x+y.value.length)},f.TokenIterator=b}),ace.define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],function(h,f,C){"use strict";function g(P){var k=-1;if((E=P.multiSelect&&(k=P.selection.index,E.rangeCount!=P.multiSelect.rangeCount)?{rangeCount:P.multiSelect.rangeCount}:E)[k])return y=E[k];y=E[k]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}}function b(P,k,L,R){var N=P.end.row-P.start.row;return{text:L+k+R,selection:[0,P.start.column+1,N,P.end.column+(N?0:1)]}}var y,x=h("../../lib/oop"),A=h("../behaviour").Behaviour,v=h("../../token_iterator").TokenIterator,_=h("../../lib/lang"),I=["text","paren.rparen","rparen","paren","punctuation.operator"],T=["text","paren.rparen","rparen","paren","punctuation.operator","comment"],E={},w={'"':'"',"'":"'"},S=function(P){P=P||{},this.add("braces","insertion",function(k,L,R,N,F){var H=R.getCursorPosition(),V=N.doc.getLine(H.row);if(F=="{"){g(R);var q=R.getSelectionRange(),Q=N.doc.getTextRange(q),O=N.getTokenAt(H.row,H.column);if(Q!==""&&Q!=="{"&&R.getWrapBehavioursEnabled())return b(q,Q,"{","}");if(O&&/(?:string)\.quasi|\.xml/.test(O.type)){if(!([/tag\-(?:open|name)/,/attribute\-name/].some(function(U){return U.test(O.type)})||/(string)\.quasi/.test(O.type)&&O.value[H.column-O.start-1]!=="$"))return S.recordAutoInsert(R,N,"}"),{text:"{}",selection:[1,1]}}else if(S.isSaneInsertion(R,N))return/[\]\}\)]/.test(V[H.column])||R.inMultiSelectMode||P.braces?(S.recordAutoInsert(R,N,"}"),{text:"{}",selection:[1,1]}):(S.recordMaybeInsert(R,N,"{"),{text:"{",selection:[1,1]})}else if(F=="}"){g(R);var B=V.substring(H.column,H.column+1);if(B=="}"&&N.$findOpeningBracket("}",{column:H.column+1,row:H.row})!==null&&S.isAutoInsertedClosing(H,V,F))return S.popAutoInsertedClosing(),{text:"",selection:[1,1]}}else{if(F==`
`||F==`\r
`){if(g(R),q="",S.isMaybeInsertedClosing(H,V)&&(q=_.stringRepeat("}",y.maybeInsertedBrackets),S.clearMaybeInsertedClosing()),(B=V.substring(H.column,H.column+1))==="}"){if(Q=N.findMatchingBracket({row:H.row,column:H.column+1},"}"),!Q)return null;var j=this.$getIndent(N.getLine(Q.row))}else{if(!q)return void S.clearMaybeInsertedClosing();j=this.$getIndent(V)}return F=j+N.getTabString(),{text:`
`+F+`
`+j+q,selection:[1,F.length,1,F.length]}}S.clearMaybeInsertedClosing()}}),this.add("braces","deletion",function(k,L,R,N,F){var H=N.doc.getTextRange(F);if(!F.isMultiLine()&&H=="{"){if(g(R),N.doc.getLine(F.start.row).substring(F.end.column,F.end.column+1)=="}")return F.end.column++,F;y.maybeInsertedBrackets--}}),this.add("parens","insertion",function(k,L,R,N,F){if(F=="(")return g(R),H=R.getSelectionRange(),(V=N.doc.getTextRange(H))!==""&&R.getWrapBehavioursEnabled()?b(H,V,"(",")"):S.isSaneInsertion(R,N)?(S.recordAutoInsert(R,N,")"),{text:"()",selection:[1,1]}):void 0;if(F==")"){g(R);var H=R.getCursorPosition(),V=N.doc.getLine(H.row),R=V.substring(H.column,H.column+1);if(R==")"&&N.$findOpeningBracket(")",{column:H.column+1,row:H.row})!==null&&S.isAutoInsertedClosing(H,V,F))return S.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}),this.add("parens","deletion",function(k,L,R,N,F){var H=N.doc.getTextRange(F);if(!F.isMultiLine()&&H=="("&&(g(R),N.doc.getLine(F.start.row).substring(F.start.column+1,F.start.column+2)==")"))return F.end.column++,F}),this.add("brackets","insertion",function(k,L,R,N,F){if(F=="[")return g(R),H=R.getSelectionRange(),(V=N.doc.getTextRange(H))!==""&&R.getWrapBehavioursEnabled()?b(H,V,"[","]"):S.isSaneInsertion(R,N)?(S.recordAutoInsert(R,N,"]"),{text:"[]",selection:[1,1]}):void 0;if(F=="]"){g(R);var H=R.getCursorPosition(),V=N.doc.getLine(H.row),R=V.substring(H.column,H.column+1);if(R=="]"&&N.$findOpeningBracket("]",{column:H.column+1,row:H.row})!==null&&S.isAutoInsertedClosing(H,V,F))return S.popAutoInsertedClosing(),{text:"",selection:[1,1]}}}),this.add("brackets","deletion",function(k,L,R,N,F){var H=N.doc.getTextRange(F);if(!F.isMultiLine()&&H=="["&&(g(R),N.doc.getLine(F.start.row).substring(F.start.column+1,F.start.column+2)=="]"))return F.end.column++,F}),this.add("string_dquotes","insertion",function(k,L,R,N,F){var H=N.$mode.$quotes||w;if(F.length==1&&H[F]&&(!this.lineCommentStart||this.lineCommentStart.indexOf(F)==-1)){g(R);var V=R.getSelectionRange(),q=N.doc.getTextRange(V);if(!(q===""||q.length==1&&H[q])&&R.getWrapBehavioursEnabled())return b(V,q,F,F);if(!q){var H=R.getCursorPosition(),V=N.doc.getLine(H.row),q=V.substring(H.column-1,H.column),R=V.substring(H.column,H.column+1),B=N.getTokenAt(H.row,H.column),Q=N.getTokenAt(H.row,H.column+1);if(q=="\\"&&B&&/escape/.test(B.type))return null;var O,B=B&&/string|escape/.test(B.type),j=!Q||/string|escape/.test(Q.type);if(R==F)(O=B!==j)&&/string\.end/.test(Q.type)&&(O=!1);else{if(B&&!j||B&&j||(Q=N.$mode.tokenRe,B=(Q.lastIndex=0,Q.test(q)),j=(Q.lastIndex=0,Q.test(R)),N=N.$mode.$pairQuotesAfter,!(N&&N[F]&&N[F].test(q))&&B||j)||R&&!/[\s;,.})\]\\]/.test(R)||(N=V[H.column-2],q==F&&(N==F||Q.test(N))))return null;O=!0}return{text:O?F+F:"",selection:[1,1]}}}}),this.add("string_dquotes","deletion",function(k,L,R,N,F){var H=N.$mode.$quotes||w,V=N.doc.getTextRange(F);if(!F.isMultiLine()&&H.hasOwnProperty(V)&&(g(R),N.doc.getLine(F.start.row).substring(F.start.column+1,F.start.column+2)==V))return F.end.column++,F}),P.closeDocComment!==!1&&this.add("doc comment end","insertion",function(k,L,R,N,F){var H;if(k==="doc-start"&&(F===`
`||F===`\r
`)&&R.selection.isEmpty())return k=R.getCursorPosition(),R=N.doc.getLine(k.row),N=N.doc.getLine(k.row+1),H=this.$getIndent(R),/\s*\*/.test(N)?/^\s*\*/.test(R)?{text:F+H+"* ",selection:[1,3+H.length,1,3+H.length]}:{text:F+H+" * ",selection:[1,3+H.length,1,3+H.length]}:/\/\*\*/.test(R.substring(0,k.column))?{text:F+H+" * "+F+" "+H+"*/",selection:[1,4+H.length,1,4+H.length]}:void 0})};S.isSaneInsertion=function(P,k){var L=P.getCursorPosition(),R=new v(k,L.row,L.column);if(!this.$matchTokenType(R.getCurrentToken()||"text",I)){if(/[)}\]]/.test(P.session.getLine(L.row)[L.column]))return!0;if(P=new v(k,L.row,L.column+1),!this.$matchTokenType(P.getCurrentToken()||"text",I))return!1}return R.stepForward(),R.getCurrentTokenRow()!==L.row||this.$matchTokenType(R.getCurrentToken()||"text",T)},S.$matchTokenType=function(P,k){return-1<k.indexOf(P.type||P)},S.recordAutoInsert=function(P,k,L){P=P.getCursorPosition(),k=k.doc.getLine(P.row),this.isAutoInsertedClosing(P,k,y.autoInsertedLineEnd[0])||(y.autoInsertedBrackets=0),y.autoInsertedRow=P.row,y.autoInsertedLineEnd=L+k.substr(P.column),y.autoInsertedBrackets++},S.recordMaybeInsert=function(P,k,L){P=P.getCursorPosition(),k=k.doc.getLine(P.row),this.isMaybeInsertedClosing(P,k)||(y.maybeInsertedBrackets=0),y.maybeInsertedRow=P.row,y.maybeInsertedLineStart=k.substr(0,P.column)+L,y.maybeInsertedLineEnd=k.substr(P.column),y.maybeInsertedBrackets++},S.isAutoInsertedClosing=function(P,k,L){return 0<y.autoInsertedBrackets&&P.row===y.autoInsertedRow&&L===y.autoInsertedLineEnd[0]&&k.substr(P.column)===y.autoInsertedLineEnd},S.isMaybeInsertedClosing=function(P,k){return 0<y.maybeInsertedBrackets&&P.row===y.maybeInsertedRow&&k.substr(P.column)===y.maybeInsertedLineEnd&&k.substr(0,P.column)==y.maybeInsertedLineStart},S.popAutoInsertedClosing=function(){y.autoInsertedLineEnd=y.autoInsertedLineEnd.substr(1),y.autoInsertedBrackets--},S.clearMaybeInsertedClosing=function(){y&&(y.maybeInsertedBrackets=0,y.maybeInsertedRow=-1)},x.inherits(S,A),f.CstyleBehaviour=S}),ace.define("ace/unicode",["require","exports","module"],function(h,f,C){"use strict";for(var g=[48,9,8,25,5,0,2,25,48,0,11,0,5,0,6,22,2,30,2,457,5,11,15,4,8,0,2,0,18,116,2,1,3,3,9,0,2,2,2,0,2,19,2,82,2,138,2,4,3,155,12,37,3,0,8,38,10,44,2,0,2,1,2,1,2,0,9,26,6,2,30,10,7,61,2,9,5,101,2,7,3,9,2,18,3,0,17,58,3,100,15,53,5,0,6,45,211,57,3,18,2,5,3,11,3,9,2,1,7,6,2,2,2,7,3,1,3,21,2,6,2,0,4,3,3,8,3,1,3,3,9,0,5,1,2,4,3,11,16,2,2,5,5,1,3,21,2,6,2,1,2,1,2,1,3,0,2,4,5,1,3,2,4,0,8,3,2,0,8,15,12,2,2,8,2,2,2,21,2,6,2,1,2,4,3,9,2,2,2,2,3,0,16,3,3,9,18,2,2,7,3,1,3,21,2,6,2,1,2,4,3,8,3,1,3,2,9,1,5,1,2,4,3,9,2,0,17,1,2,5,4,2,2,3,4,1,2,0,2,1,4,1,4,2,4,11,5,4,4,2,2,3,3,0,7,0,15,9,18,2,2,7,2,2,2,22,2,9,2,4,4,7,2,2,2,3,8,1,2,1,7,3,3,9,19,1,2,7,2,2,2,22,2,9,2,4,3,8,2,2,2,3,8,1,8,0,2,3,3,9,19,1,2,7,2,2,2,22,2,15,4,7,2,2,2,3,10,0,9,3,3,9,11,5,3,1,2,17,4,23,2,8,2,0,3,6,4,0,5,5,2,0,2,7,19,1,14,57,6,14,2,9,40,1,2,0,3,1,2,0,3,0,7,3,2,6,2,2,2,0,2,0,3,1,2,12,2,2,3,4,2,0,2,5,3,9,3,1,35,0,24,1,7,9,12,0,2,0,2,0,5,9,2,35,5,19,2,5,5,7,2,35,10,0,58,73,7,77,3,37,11,42,2,0,4,328,2,3,3,6,2,0,2,3,3,40,2,3,3,32,2,3,3,6,2,0,2,3,3,14,2,56,2,3,3,66,5,0,33,15,17,84,13,619,3,16,2,25,6,74,22,12,2,6,12,20,12,19,13,12,2,2,2,1,13,51,3,29,4,0,5,1,3,9,34,2,3,9,7,87,9,42,6,69,11,28,4,11,5,11,11,39,3,4,12,43,5,25,7,10,38,27,5,62,2,28,3,10,7,9,14,0,89,75,5,9,18,8,13,42,4,11,71,55,9,9,4,48,83,2,2,30,14,230,23,280,3,5,3,37,3,5,3,7,2,0,2,0,2,0,2,30,3,52,2,6,2,0,4,2,2,6,4,3,3,5,5,12,6,2,2,6,67,1,20,0,29,0,14,0,17,4,60,12,5,0,4,11,18,0,5,0,3,9,2,0,4,4,7,0,2,0,2,0,2,3,2,10,3,3,6,4,5,0,53,1,2684,46,2,46,2,132,7,6,15,37,11,53,10,0,17,22,10,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,31,48,0,470,1,36,5,2,4,6,1,5,85,3,1,3,2,2,89,2,3,6,40,4,93,18,23,57,15,513,6581,75,20939,53,1164,68,45,3,268,4,27,21,31,3,13,13,1,2,24,9,69,11,1,38,8,3,102,3,1,111,44,25,51,13,68,12,9,7,23,4,0,5,45,3,35,13,28,4,64,15,10,39,54,10,13,3,9,7,22,4,1,5,66,25,2,227,42,2,1,3,9,7,11171,13,22,5,48,8453,301,3,61,3,105,39,6,13,4,6,11,2,12,2,4,2,0,2,1,2,1,2,107,34,362,19,63,3,53,41,11,5,15,17,6,13,1,25,2,33,4,2,134,20,9,8,25,5,0,2,25,12,88,4,5,3,5,3,5,3,2],b=0,y=[],x=0;x<g.length;x+=2)y.push(b+=g[x]),g[x+1]&&y.push(45,b+=g[x+1]);f.wordChars=String.fromCharCode.apply(null,y)}),ace.define("ace/mode/text",["require","exports","module","ace/config","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour/cstyle","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"],function(T,f,C){"use strict";var g=T("../config"),b=T("../tokenizer").Tokenizer,y=T("./text_highlight_rules").TextHighlightRules,x=T("./behaviour/cstyle").CstyleBehaviour,A=T("../unicode"),v=T("../lib/lang"),_=T("../token_iterator").TokenIterator,I=T("../range").Range,T=function(){this.HighlightRules=y};(function(){this.$defaultBehaviour=new x,this.tokenRe=new RegExp("^["+A.wordChars+"\\$_]+","g"),this.nonTokenRe=new RegExp("^(?:[^"+A.wordChars+"\\$_]|\\s])+","g"),this.getTokenizer=function(){return this.$tokenizer||(this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig),this.$tokenizer=new b(this.$highlightRules.getRules())),this.$tokenizer},this.lineCommentStart="",this.blockComment="",this.toggleCommentLines=function(E,w,S,P){var k=w.doc,L=!0,R=!0,N=1/0,F=w.getTabSize(),H=!1;if(this.lineCommentStart){j=Array.isArray(this.lineCommentStart)?(z=this.lineCommentStart.map(v.escapeRegExp).join("|"),this.lineCommentStart[0]):(z=v.escapeRegExp(this.lineCommentStart),this.lineCommentStart),z=new RegExp("^(\\s*)(?:"+z+") ?"),H=w.getUseSoftTabs();var V=function(ie,ne){var le,ee,oe=ie.match(z);oe&&(le=oe[1].length,ee=oe[0].length,B(ie,le,ee)||oe[0][ee-1]!=" "||ee--,k.removeInLine(ne,le,ee))},q=j+" ",Q=function(ie,ne){L&&!/\S/.test(ie)||(B(ie,N,N)?k.insertInLine({row:ne,column:N},q):k.insertInLine({row:ne,column:N},j))},O=function(ie,ne){return z.test(ie)},B=function(ie,ne,le){for(var ee=0;ne--&&ie.charAt(ne)==" ";)ee++;if(ee%F!=0)return!1;for(ee=0;ie.charAt(le++)==" ";)ee++;return 2<F?ee%F!=F-1:ee%F==0}}else{if(!this.blockComment)return!1;var j=this.blockComment.start,U=this.blockComment.end,z=new RegExp("^(\\s*)(?:"+v.escapeRegExp(j)+")"),$=new RegExp("(?:"+v.escapeRegExp(U)+")\\s*$"),Q=function(ee,oe){O(ee,oe)||L&&!/\S/.test(ee)||(k.insertInLine({row:oe,column:ee.length},U),k.insertInLine({row:oe,column:N},j))},V=function(ee,oe){var te;(te=ee.match($))&&k.removeInLine(oe,ee.length-te[0].length,ee.length),(te=ee.match(z))&&k.removeInLine(oe,te[1].length,te[0].length)},O=function(ee,oe){if(z.test(ee))return!0;for(var te=w.getTokens(oe),X=0;X<te.length;X++)if(te[X].type==="comment")return!0}}function Z(ie){for(var ne=S;ne<=P;ne++)ie(k.getLine(ne),ne)}var J=1/0;Z(function(ie,ne){var le=ie.search(/\S/);le!==-1?(le<N&&(N=le),R&&!O(ie,ne)&&(R=!1)):J>ie.length&&(J=ie.length)}),N==1/0&&(N=J,R=L=!1),H&&N%F!=0&&(N=Math.floor(N/F)*F),Z(R?V:Q)},this.toggleBlockComment=function(E,w,S,P){var k=this.blockComment;if(k){!k.start&&k[0]&&(k=k[0]);var L,R,N=(Q=new _(w,P.row,P.column)).getCurrentToken(),F=(w.selection,w.selection.toOrientedRange());if(N&&/comment/.test(N.type)){for(;N&&/comment/.test(N.type);){if((O=N.value.indexOf(k.start))!=-1){var H=Q.getCurrentTokenRow(),V=Q.getCurrentTokenColumn()+O,q=new I(H,V,H,V+k.start.length);break}N=Q.stepBackward()}for(var Q,O,N=(Q=new _(w,P.row,P.column)).getCurrentToken();N&&/comment/.test(N.type);){if((O=N.value.indexOf(k.end))!=-1){var H=Q.getCurrentTokenRow(),V=Q.getCurrentTokenColumn()+O,B=new I(H,V,H,V+k.end.length);break}N=Q.stepForward()}B&&w.remove(B),q&&(w.remove(q),L=q.start.row,R=-k.start.length)}else R=k.start.length,L=S.start.row,w.insert(S.end,k.end),w.insert(S.start,k.start);F.start.row==L&&(F.start.column+=R),F.end.row==L&&(F.end.column+=R),w.selection.fromOrientedRange(F)}},this.getNextLineIndent=function(E,w,S){return this.$getIndent(w)},this.checkOutdent=function(E,w,S){return!1},this.autoOutdent=function(E,w,S){},this.$getIndent=function(E){return E.match(/^\s*/)[0]},this.createWorker=function(E){return null},this.createModeDelegates=function(E){for(var w in this.$embeds=[],this.$modes={},E){var S,P,k;E[w]&&(P=(S=E[w]).prototype.$id,(k=g.$modes[P])||(g.$modes[P]=k=new S),g.$modes[w]||(g.$modes[w]=k),this.$embeds.push(w),this.$modes[w]=k)}for(var L=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"],R=this,w=0;w<L.length;w++)(function(F){var H,V;H=L[F],V=R[H],R[L[F]]=function(){return this.$delegator(H,arguments,V)}})(w)},this.$delegator=function(E,w,S){var P=w[0]||"start";if(typeof P!="string"){if(Array.isArray(P[2])){var k=P[2][P[2].length-1];if(R=this.$modes[k])return R[E].apply(R,[P[1]].concat([].slice.call(w,1)))}P=P[0]||"start"}for(var L=0;L<this.$embeds.length;L++)if(this.$modes[this.$embeds[L]]){var R,N=P.split(this.$embeds[L]);if(!N[0]&&N[1])return w[0]=N[1],(R=this.$modes[this.$embeds[L]])[E].apply(R,w)}return k=S.apply(this,w),S?k:void 0},this.transformAction=function(E,w,S,P,k){if(this.$behaviour){var L,R=this.$behaviour.getBehaviours();for(L in R)if(R[L][w]){var N=R[L][w].apply(this,arguments);if(N)return N}}},this.getKeywords=function(E){if(!this.completionKeywords){var w=this.$tokenizer.rules,S=[];for(R in w)for(var P=w[R],k=0,L=P.length;k<L;k++)if(typeof P[k].token=="string")/keyword|support|storage/.test(P[k].token)&&S.push(P[k].regex);else if(typeof P[k].token=="object")for(var R,N=0,F=P[k].token.length;N<F;N++)/keyword|support|storage/.test(P[k].token[N])&&(R=P[k].regex.match(/\(.+?\)/g)[N],S.push(R.substr(1,R.length-2)));this.completionKeywords=S}return E?S.concat(this.$keywordList||[]):this.$keywordList},this.$createKeywordList=function(){return this.$highlightRules||this.getTokenizer(),this.$keywordList=this.$highlightRules.$keywordList||[]},this.getCompletions=function(E,w,S,P){return(this.$keywordList||this.$createKeywordList()).map(function(k){return{name:k,value:k,score:0,meta:"keyword"}})},this.$id="ace/mode/text"}).call(T.prototype),f.Mode=T}),ace.define("ace/apply_delta",["require","exports","module"],function(h,f,C){"use strict";f.applyDelta=function(g,b,y){var x=b.start.row,A=b.start.column,v=g[x]||"";switch(b.action){case"insert":b.lines.length===1?g[x]=v.substring(0,A)+b.lines[0]+v.substring(A):(_=[x,1].concat(b.lines),g.splice.apply(g,_),g[x]=v.substring(0,A)+g[x],g[x+b.lines.length-1]+=v.substring(A));break;case"remove":var _=b.end.column,I=b.end.row;x===I?g[x]=v.substring(0,A)+v.substring(_):g.splice(x,I-x+1,v.substring(0,A)+g[I].substring(_))}}}),ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(b,f,C){"use strict";var g=b("./lib/oop"),b=b("./lib/event_emitter").EventEmitter,y=(x.prototype.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},x.prototype.getDocument=function(){return this.document},x.prototype.onChange=function(v){v.start.row==v.end.row&&v.start.row!=this.row||v.start.row>this.row||(v=function(_,I,T){var P=_.action=="insert",E=(P?1:-1)*(_.end.row-_.start.row),w=(P?1:-1)*(_.end.column-_.start.column),S=_.start,P=P?S:_.end;return A(I,S,T)?{row:I.row,column:I.column}:A(P,I,!T)?{row:I.row+E,column:I.column+(I.row==P.row?w:0)}:{row:S.row,column:S.column}}(v,{row:this.row,column:this.column},this.$insertRight),this.setPosition(v.row,v.column,!0))},x.prototype.setPosition=function(v,_,I){I=I?{row:v,column:_}:this.$clipPositionToDocument(v,_),this.row==I.row&&this.column==I.column||(v={row:this.row,column:this.column},this.row=I.row,this.column=I.column,this._signal("change",{old:v,value:I}))},x.prototype.detach=function(){this.document.off("change",this.$onChange)},x.prototype.attach=function(v){this.document=v||this.document,this.document.on("change",this.$onChange)},x.prototype.$clipPositionToDocument=function(v,_){var I={};return v>=this.document.getLength()?(I.row=Math.max(0,this.document.getLength()-1),I.column=this.document.getLine(I.row).length):v<0?(I.row=0,I.column=0):(I.row=v,I.column=Math.min(this.document.getLine(I.row).length,Math.max(0,_))),_<0&&(I.column=0),I},x);function x(v,_,I){this.$onChange=this.onChange.bind(this),this.attach(v),typeof _!="number"?this.setPosition(_.row,_.column):this.setPosition(_,I)}function A(v,_,I){return I=I?v.column<=_.column:v.column<_.column,v.row<_.row||v.row==_.row&&I}y.prototype.$insertRight=!1,g.implement(y.prototype,b),f.Anchor=y}),ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],function(v,f,C){"use strict";var g=v("./lib/oop"),b=v("./apply_delta").applyDelta,y=v("./lib/event_emitter").EventEmitter,x=v("./range").Range,A=v("./anchor").Anchor,v=(_.prototype.setValue=function(I){var T=this.getLength()-1;this.remove(new x(0,0,T,this.getLine(T).length)),this.insert({row:0,column:0},I||"")},_.prototype.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},_.prototype.createAnchor=function(I,T){return new A(this,I,T)},_.prototype.$detectNewLine=function(I){I=I.match(/^.*?(\r\n|\r|\n)/m),this.$autoNewLine=I?I[1]:`
`,this._signal("changeNewLineMode")},_.prototype.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return`\r
`;case"unix":return`
`;default:return this.$autoNewLine||`
`}},_.prototype.setNewLineMode=function(I){this.$newLineMode!==I&&(this.$newLineMode=I,this._signal("changeNewLineMode"))},_.prototype.getNewLineMode=function(){return this.$newLineMode},_.prototype.isNewLine=function(I){return I==`\r
`||I=="\r"||I==`
`},_.prototype.getLine=function(I){return this.$lines[I]||""},_.prototype.getLines=function(I,T){return this.$lines.slice(I,T+1)},_.prototype.getAllLines=function(){return this.getLines(0,this.getLength())},_.prototype.getLength=function(){return this.$lines.length},_.prototype.getTextRange=function(I){return this.getLinesForRange(I).join(this.getNewLineCharacter())},_.prototype.getLinesForRange=function(I){var T,E;return I.start.row===I.end.row?T=[this.getLine(I.start.row).substring(I.start.column,I.end.column)]:((T=this.getLines(I.start.row,I.end.row))[0]=(T[0]||"").substring(I.start.column),E=T.length-1,I.end.row-I.start.row==E&&(T[E]=T[E].substring(0,I.end.column))),T},_.prototype.insertLines=function(I,T){return this.insertFullLines(I,T)},_.prototype.removeLines=function(I,T){return this.removeFullLines(I,T)},_.prototype.insertNewLine=function(I){return this.insertMergedLines(I,["",""])},_.prototype.insert=function(I,T){return this.getLength()<=1&&this.$detectNewLine(T),this.insertMergedLines(I,this.$split(T))},_.prototype.insertInLine=function(w,T){var E=this.clippedPos(w.row,w.column),w=this.pos(w.row,w.column+T.length);return this.applyDelta({start:E,end:w,action:"insert",lines:[T]},!0),this.clonePos(w)},_.prototype.clippedPos=function(I,T){var E=this.getLength(),E=(I===void 0?I=E:I<0?I=0:E<=I&&(I=E-1,T=void 0),this.getLine(I));return T==null&&(T=E.length),{row:I,column:T=Math.min(Math.max(T,0),E.length)}},_.prototype.clonePos=function(I){return{row:I.row,column:I.column}},_.prototype.pos=function(I,T){return{row:I,column:T}},_.prototype.$clipPosition=function(I){var T=this.getLength();return I.row>=T?(I.row=Math.max(0,T-1),I.column=this.getLine(T-1).length):(I.row=Math.max(0,I.row),I.column=Math.min(Math.max(I.column,0),this.getLine(I.row).length)),I},_.prototype.insertFullLines=function(I,T){var E=0,E=(I=Math.min(Math.max(I,0),this.getLength()))<this.getLength()?(T=T.concat([""]),0):(T=[""].concat(T),this.$lines[--I].length);this.insertMergedLines({row:I,column:E},T)},_.prototype.insertMergedLines=function(E,T){var E=this.clippedPos(E.row,E.column),w={row:E.row+T.length-1,column:(T.length==1?E.column:0)+T[T.length-1].length};return this.applyDelta({start:E,end:w,action:"insert",lines:T}),this.clonePos(w)},_.prototype.remove=function(E){var T=this.clippedPos(E.start.row,E.start.column),E=this.clippedPos(E.end.row,E.end.column);return this.applyDelta({start:T,end:E,action:"remove",lines:this.getLinesForRange({start:T,end:E})}),this.clonePos(T)},_.prototype.removeInLine=function(I,T,E){return T=this.clippedPos(I,T),I=this.clippedPos(I,E),this.applyDelta({start:T,end:I,action:"remove",lines:this.getLinesForRange({start:T,end:I})},!0),this.clonePos(T)},_.prototype.removeFullLines=function(I,T){I=Math.min(Math.max(0,I),this.getLength()-1);var P=(T=Math.min(Math.max(0,T),this.getLength()-1))==this.getLength()-1&&0<I,w=T<this.getLength()-1,S=P?I-1:I,P=P?this.getLine(S).length:0,E=w?T+1:T,w=w?0:this.getLine(E).length,S=new x(S,P,E,w),P=this.$lines.slice(I,T+1);return this.applyDelta({start:S.start,end:S.end,action:"remove",lines:this.getLinesForRange(S)}),P},_.prototype.removeNewLine=function(I){I<this.getLength()-1&&0<=I&&this.applyDelta({start:this.pos(I,this.getLine(I).length),end:this.pos(I+1,0),action:"remove",lines:["",""]})},_.prototype.replace=function(I,T){return I instanceof x||(I=x.fromPoints(I.start,I.end)),T.length===0&&I.isEmpty()?I.start:T==this.getTextRange(I)?I.end:(this.remove(I),T?this.insert(I.start,T):I.start)},_.prototype.applyDeltas=function(I){for(var T=0;T<I.length;T++)this.applyDelta(I[T])},_.prototype.revertDeltas=function(I){for(var T=I.length-1;0<=T;T--)this.revertDelta(I[T])},_.prototype.applyDelta=function(I,T){var E=I.action=="insert";(E?I.lines.length<=1&&!I.lines[0]:!x.comparePoints(I.start,I.end))||(E&&2e4<I.lines.length?this.$splitAndapplyLargeDelta(I,2e4):(b(this.$lines,I,T),this._signal("change",I)))},_.prototype.$safeApplyDelta=function(I){var T=this.$lines.length;(I.action=="remove"&&I.start.row<T&&I.end.row<T||I.action=="insert"&&I.start.row<=T)&&this.applyDelta(I)},_.prototype.$splitAndapplyLargeDelta=function(I,T){for(var E=I.lines,w=E.length-T+1,S=I.start.row,P=I.start.column,k=0,L=0;k<w;k=L){L+=T-1;var R=E.slice(k,L);R.push(""),this.applyDelta({start:this.pos(S+k,P),end:this.pos(S+L,P=0),action:I.action,lines:R},!0)}I.lines=E.slice(k),I.start.row=S+k,I.start.column=P,this.applyDelta(I,!0)},_.prototype.revertDelta=function(I){this.$safeApplyDelta({start:this.clonePos(I.start),end:this.clonePos(I.end),action:I.action=="insert"?"remove":"insert",lines:I.lines.slice()})},_.prototype.indexToPosition=function(I,T){for(var E=this.$lines||this.getAllLines(),w=this.getNewLineCharacter().length,S=T||0,P=E.length;S<P;S++)if((I-=E[S].length+w)<0)return{row:S,column:I+E[S].length+w};return{row:P-1,column:I+E[P-1].length+w}},_.prototype.positionToIndex=function(I,T){for(var E=this.$lines||this.getAllLines(),w=this.getNewLineCharacter().length,S=0,P=Math.min(I.row,E.length),k=T||0;k<P;++k)S+=E[k].length+w;return S+I.column},_.prototype.$split=function(I){return I.split(/\r\n|\r|\n/)},_);function _(I){this.$lines=[""],I.length===0?this.$lines=[""]:Array.isArray(I)?this.insertMergedLines({row:0,column:0},I):this.insert({row:0,column:0},I)}v.prototype.$autoNewLine="",v.prototype.$newLineMode="auto",g.implement(v.prototype,y),f.Document=v}),ace.define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(b,f,C){"use strict";var g=b("./lib/oop"),b=b("./lib/event_emitter").EventEmitter,y=(x.prototype.setTokenizer=function(A){this.tokenizer=A,this.lines=[],this.states=[],this.start(0)},x.prototype.setDocument=function(A){this.doc=A,this.lines=[],this.states=[],this.stop()},x.prototype.fireUpdateEvent=function(A,v){this._signal("update",{data:{first:A,last:v}})},x.prototype.start=function(A){this.currentLine=Math.min(A||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.states.splice(this.currentLine,this.states.length),this.stop(),this.running=setTimeout(this.$worker,700)},x.prototype.scheduleStart=function(){this.running||(this.running=setTimeout(this.$worker,700))},x.prototype.$updateOnChange=function(A){var v=A.start.row,_=A.end.row-v;_==0?this.lines[v]=null:A.action=="remove"?(this.lines.splice(v,1+_,null),this.states.splice(v,1+_,null)):((A=Array(1+_)).unshift(v,1),this.lines.splice.apply(this.lines,A),this.states.splice.apply(this.states,A)),this.currentLine=Math.min(v,this.currentLine,this.doc.getLength()),this.stop()},x.prototype.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},x.prototype.getTokens=function(A){return this.lines[A]||this.$tokenizeRow(A)},x.prototype.getState=function(A){return this.currentLine==A&&this.$tokenizeRow(A),this.states[A]||"start"},x.prototype.$tokenizeRow=function(A){var _=this.doc.getLine(A),v=this.states[A-1],_=this.tokenizer.getLineTokens(_,v,A);return this.states[A]+""!=_.state+""?(this.states[A]=_.state,this.lines[A+1]=null,this.currentLine>A+1&&(this.currentLine=A+1)):this.currentLine==A&&(this.currentLine=A+1),this.lines[A]=_.tokens},x.prototype.cleanup=function(){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.removeAllListeners()},x);function x(A,v){this.running=!1,this.lines=[],this.states=[],this.currentLine=0,this.tokenizer=A;var _=this;this.$worker=function(){if(_.running){for(var I=new Date,T=_.currentLine,E=-1,w=_.doc,S=T;_.lines[T];)T++;var P=w.getLength(),k=0;for(_.running=!1;T<P;){for(_.$tokenizeRow(T),E=T;T++,_.lines[T];);if(++k%5==0&&20<new Date-I){_.running=setTimeout(_.$worker,20);break}}_.currentLine=T,S<=(E=E==-1?T:E)&&_.fireUpdateEvent(S,E)}}}g.implement(y.prototype,b),f.BackgroundTokenizer=y}),ace.define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/range"],function(y,f,C){"use strict";var g=y("./lib/lang"),b=y("./range").Range,y=(x.prototype.setRegexp=function(A){this.regExp+""!=A+""&&(this.regExp=A,this.cache=[])},x.prototype.update=function(A,v,_,I){if(this.regExp)for(var T=I.firstRow,E=I.lastRow,w={},S=T;S<=E;S++){var P=this.cache[S];P==null&&(P=(P=(P=g.getMatchOffsets(_.getLine(S),this.regExp)).length>this.MAX_RANGES?P.slice(0,this.MAX_RANGES):P).map(function(N){return new b(S,N.offset,S,N.offset+N.length)}),this.cache[S]=P.length?P:"");for(var k=P.length;k--;){var L=P[k].toScreenRange(_),R=L.toString();w[R]||(w[R]=!0,v.drawSingleLineMarker(A,L,this.clazz,I))}}},x);function x(A,v,_){_===void 0&&(_="text"),this.setRegexp(A),this.clazz=v,this.type=_}y.prototype.MAX_RANGES=500,f.SearchHighlight=y}),ace.define("ace/undomanager",["require","exports","module","ace/range"],function(h,f,C){"use strict";b.prototype.addSession=function(S){this.$session=S},b.prototype.add=function(S,P,k){this.$fromUndo||S!=this.$lastDelta&&(this.$keepRedoStack||(this.$redoStack.length=0),P!==!1&&this.lastDeltas||(this.lastDeltas=[],(P=this.$undoStack.length)>this.$undoDepth-1&&this.$undoStack.splice(0,P-this.$undoDepth+1),this.$undoStack.push(this.lastDeltas),S.id=this.$rev=++this.$maxRev),S.action!="remove"&&S.action!="insert"||(this.$lastDelta=S),this.lastDeltas.push(S))},b.prototype.addSelection=function(S,P){this.selections.push({value:S,rev:P||this.$rev})},b.prototype.startNewGroup=function(){return this.lastDeltas=null,this.$rev},b.prototype.markIgnored=function(S,P){P==null&&(P=this.$rev+1);for(var k=this.$undoStack,L=k.length;L--;){var R=k[L][0];if(R.id<=S)break;R.id<P&&(R.ignore=!0)}this.lastDeltas=null},b.prototype.getSelection=function(S,P){for(var k=this.selections,L=k.length;L--;){var R=k[L];if(R.rev<S)return R=P?k[L+1]:R}},b.prototype.getRevision=function(){return this.$rev},b.prototype.getDeltas=function(S,P){P==null&&(P=this.$rev+1);for(var k=this.$undoStack,L=null,R=0,N=k.length;N--;){var F=k[N][0];if(F.id<P&&!L&&(L=N+1),F.id<=S){R=N+1;break}}return k.slice(R,L)},b.prototype.getChangedRanges=function(S,P){P==null&&this.$rev},b.prototype.getChangedLines=function(S,P){P==null&&this.$rev},b.prototype.undo=function(S,P){this.lastDeltas=null;var k,L=this.$undoStack;if(function(R,N){for(var F=N;F--;){var H=R[F];if(H&&!H[0].ignore){for(;F<N-1;){var V=function(q,Q){for(var O=q.length;O--;)for(var B=0;B<Q.length;B++)if(!I(q[O],Q[B])){for(;O<q.length;){for(;B--;)I(Q[B],q[O]);B=Q.length,O++}return[q,Q]}return q.selectionBefore=Q.selectionBefore=q.selectionAfter=Q.selectionAfter=null,[Q,q]}(R[F],R[F+1]);R[F]=V[0],R[F+1]=V[1],F++}return 1}}}(L,L.length))return S=S||this.$session,this.$redoStackBaseRev!==this.$rev&&this.$redoStack.length&&(this.$redoStack=[]),this.$fromUndo=!0,k=null,(L=L.pop())&&(k=S.undoChanges(L,P),this.$redoStack.push(L),this.$syncRev()),this.$fromUndo=!1,k},b.prototype.redo=function(S,P){if(this.lastDeltas=null,S=S||this.$session,this.$fromUndo=!0,this.$redoStackBaseRev!=this.$rev){for(var j=this.getDeltas(this.$redoStackBaseRev,this.$rev+1),k=this.$redoStack,L=j,R=0;R<L.length;R++)for(var N=L[R],F=0;F<N.length;F++){H=void 0,V=void 0,q=void 0,Q=void 0,O=void 0,B=void 0;var H=k,V=N[F];V=function($){return{start:A($.start),end:A($.end),action:$.action,lines:$.lines.slice()}}(V);for(var q=H.length;q--;){for(var Q=H[q],O=0;O<Q.length;O++){var B=function($,Z){var J,ie,ne=$.action=="insert",le=Z.action=="insert";if(ne&&le)x($.start,Z.start)<0?T(Z,$,1):T($,Z,1);else if(ne&&!le)0<=x($.start,Z.end)?T($,Z,-1):(x($.start,Z.start)<=0||T($,y.fromPoints(Z.start,$.start),-1),T(Z,$,1));else if(!ne&&le)0<=x(Z.start,$.end)?T(Z,$,-1):(x(Z.start,$.start)<=0||T(Z,y.fromPoints($.start,Z.start),-1),T($,Z,1));else if(!ne&&!le)if(0<=x(Z.start,$.end))T(Z,$,-1);else{if(!(x(Z.end,$.start)<=0))return x($.start,Z.start)<0&&($=w(J=$,Z.start)),0<x($.end,Z.end)&&(ie=w($,Z.end)),E(Z.end,$.start,$.end,-1),ie&&!J&&($.lines=ie.lines,$.start=ie.start,$.end=ie.end,ie=$),[Z,J,ie].filter(Boolean);T($,Z,-1)}return[Z,$]}(Q[O],V);V=B[0],B.length!=2&&(B[2]?(Q.splice(O+1,1,B[1],B[2]),O++):B[1]||(Q.splice(O,1),O--))}Q.length||H.splice(q,1)}}this.$redoStackBaseRev=this.$rev,this.$redoStack.forEach(function(z){z[0].id=++this.$maxRev},this)}var j=this.$redoStack.pop(),U=null;return j&&(U=S.redoChanges(j,P),this.$undoStack.push(j),this.$syncRev()),this.$fromUndo=!1,U},b.prototype.$syncRev=function(){var S=this.$undoStack,S=S[S.length-1],S=S&&S[0].id||0;this.$redoStackBaseRev=S,this.$rev=S},b.prototype.reset=function(){this.lastDeltas=null,this.$lastDelta=null,this.$undoStack=[],this.$redoStack=[],this.$rev=0,this.mark=0,this.$redoStackBaseRev=this.$rev,this.selections=[]},b.prototype.canUndo=function(){return 0<this.$undoStack.length},b.prototype.canRedo=function(){return 0<this.$redoStack.length},b.prototype.bookmark=function(S){S==null&&(S=this.$rev),this.mark=S},b.prototype.isAtBookmark=function(){return this.$rev===this.mark},b.prototype.toJSON=function(){return{$redoStack:this.$redoStack,$undoStack:this.$undoStack}},b.prototype.fromJSON=function(S){this.reset(),this.$undoStack=S.$undoStack,this.$redoStack=S.$redoStack},b.prototype.$prettyPrint=function(S){return S?v(S):v(this.$undoStack)+`
---
`+v(this.$redoStack)};var g=b;function b(){this.$keepRedoStack,this.$maxRev=0,this.$fromUndo=!1,this.$undoDepth=1/0,this.reset()}g.prototype.hasUndo=g.prototype.canUndo,g.prototype.hasRedo=g.prototype.canRedo,g.prototype.isClean=g.prototype.isAtBookmark,g.prototype.markClean=g.prototype.bookmark;var y=h("./range").Range,x=y.comparePoints;y.comparePoints;function A(S){return{row:S.row,column:S.column}}function v(S){var P;return S=S||this,Array.isArray(S)?S.map(v).join(`
`):(P="",S.action?(P=S.action=="insert"?"+":"-",P+="["+S.lines+"]"):S.value&&(P=Array.isArray(S.value)?S.value.map(_).join(`
`):_(S.value)),S.start&&(P+=_(S)),(S.id||S.rev)&&(P+="	("+(S.id||S.rev)+")"),P)}function _(S){return S.start.row+":"+S.start.column+"=>"+S.end.row+":"+S.end.column}function I(S,P){var k=S.action=="insert",L=P.action=="insert";if(k&&L)if(0<=x(P.start,S.end))T(P,S,-1);else{if(!(x(P.start,S.start)<=0))return;T(S,P,1)}else if(k&&!L)if(0<=x(P.start,S.end))T(P,S,-1);else{if(!(x(P.end,S.start)<=0))return;T(S,P,-1)}else if(!k&&L)if(0<=x(P.start,S.start))T(P,S,1);else{if(!(x(P.start,S.start)<=0))return;T(S,P,1)}else if(!k&&!L)if(0<=x(P.start,S.start))T(P,S,1);else{if(!(x(P.end,S.start)<=0))return;T(S,P,-1)}return 1}function T(S,P,k){E(S.start,P.start,P.end,k),E(S.end,P.start,P.end,k)}function E(S,P,k,L){S.row==(L==1?P:k).row&&(S.column+=L*(k.column-P.column)),S.row+=L*(k.row-P.row)}function w(S,P){var k=S.lines,L=S.end,N=(S.end=A(P),S.end.row-S.start.row),R=k.splice(N,k.length),N=N?P.column:P.column-S.start.column;return k.push(R[0].substring(0,N)),R[0]=R[0].substr(N),{start:A(P),end:L,lines:R,action:S.action}}f.UndoManager=g}),ace.define("ace/edit_session/fold_line",["require","exports","module","ace/range"],function(h,f,C){"use strict";var g=h("../range").Range;function b(y,x){this.foldData=y,Array.isArray(x)?this.folds=x:x=this.folds=[x],y=x[x.length-1],this.range=new g(x[0].start.row,x[0].start.column,y.end.row,y.end.column),this.start=this.range.start,this.end=this.range.end,this.folds.forEach(function(A){A.setFoldLine(this)},this)}b.prototype.shiftRow=function(y){this.start.row+=y,this.end.row+=y,this.folds.forEach(function(x){x.start.row+=y,x.end.row+=y})},b.prototype.addFold=function(y){if(y.sameRow){if(y.start.row<this.startRow||y.endRow>this.endRow)throw new Error("Can't add a fold to this FoldLine as it has no connection");this.folds.push(y),this.folds.sort(function(x,A){return-x.range.compareEnd(A.start.row,A.start.column)}),0<this.range.compareEnd(y.start.row,y.start.column)?(this.end.row=y.end.row,this.end.column=y.end.column):this.range.compareStart(y.end.row,y.end.column)<0&&(this.start.row=y.start.row,this.start.column=y.start.column)}else if(y.start.row==this.end.row)this.folds.push(y),this.end.row=y.end.row,this.end.column=y.end.column;else{if(y.end.row!=this.start.row)throw new Error("Trying to add fold to FoldRow that doesn't have a matching row");this.folds.unshift(y),this.start.row=y.start.row,this.start.column=y.start.column}y.foldLine=this},b.prototype.containsRow=function(y){return y>=this.start.row&&y<=this.end.row},b.prototype.walk=function(y,x,A){var v,_,I=0,T=this.folds,E=!0;x==null&&(x=this.end.row,A=this.end.column);for(var w=0;w<T.length;w++){if((_=(v=T[w]).range.compareStart(x,A))==-1)return void y(null,x,A,I,E);if(!y(null,v.start.row,v.start.column,I,E)&&y(v.placeholder,v.start.row,v.start.column,I)||_===0)return;E=!v.sameRow,I=v.end.column}y(null,x,A,I,E)},b.prototype.getNextFoldTo=function(y,x){for(var A,v,_=0;_<this.folds.length;_++){if((v=(A=this.folds[_]).range.compareEnd(y,x))==-1)return{fold:A,kind:"after"};if(v===0)return{fold:A,kind:"inside"}}return null},b.prototype.addRemoveChars=function(y,x,A){var v,_=this.getNextFoldTo(y,x);if(_){if(v=_.fold,_.kind=="inside"&&v.start.column!=x&&v.start.row!=y)window.console&&window.console.log(y,x,v);else if(v.start.row==y){var I,T=(I=this.folds).indexOf(v);for(T===0&&(this.start.column+=A);T<I.length;T++){if((v=I[T]).start.column+=A,!v.sameRow)return;v.end.column+=A}this.end.column+=A}}},b.prototype.split=function(_,x){var A,v,_=this.getNextFoldTo(_,x);return _&&_.kind!="inside"?(x=_.fold,_=this.folds,A=this.foldData,x=_.indexOf(x),v=_[x-1],this.end.row=v.end.row,this.end.column=v.end.column,v=new b(A,_=_.splice(x,_.length-x)),A.splice(A.indexOf(this)+1,0,v),v):null},b.prototype.merge=function(y){for(var x=y.folds,A=0;A<x.length;A++)this.addFold(x[A]);var v=this.foldData;v.splice(v.indexOf(y),1)},b.prototype.toString=function(){var y=[this.range.toString()+": ["];return this.folds.forEach(function(x){y.push("  "+x.toString())}),y.push("]"),y.join(`
`)},b.prototype.idxToPosition=function(y){for(var x=0,A=0;A<this.folds.length;A++){var v=this.folds[A];if((y-=v.start.column-x)<0)return{row:v.start.row,column:v.start.column+y};if((y-=v.placeholder.length)<0)return v.start;x=v.end.column}return{row:this.end.row,column:this.end.column+y}},f.FoldLine=b}),ace.define("ace/range_list",["require","exports","module","ace/range"],function(b,f,C){"use strict";var g=b("./range").Range.comparePoints,b=(y.prototype.pointIndex=function(x,A,v){for(var _=this.ranges,I=v||0;I<_.length;I++){var T=_[I],E=g(x,T.end);if(!(0<E))return T=g(x,T.start),E===0?A&&T!==0?-I-2:I:0<T||T===0&&!A?I:-I-1}return-I-1},y.prototype.add=function(x){var v=!x.isEmpty(),A=this.pointIndex(x.start,v),v=this.pointIndex(x.end,v,A=A<0?-A-1:A);return v<0?v=-v-1:v++,this.ranges.splice(A,v-A,x)},y.prototype.addList=function(x){for(var A=[],v=x.length;v--;)A.push.apply(A,this.add(x[v]));return A},y.prototype.substractPoint=function(x){if(x=this.pointIndex(x),0<=x)return this.ranges.splice(x,1)},y.prototype.merge=function(){for(var x=[],A=this.ranges,v=(A=A.sort(function(E,w){return g(E.start,w.start)}))[0],_=1;_<A.length;_++){var I=v,v=A[_],T=g(I.end,v.start);T<0||(T!=0||I.isEmpty()||v.isEmpty())&&(g(I.end,v.end)<0&&(I.end.row=v.end.row,I.end.column=v.end.column),A.splice(_,1),x.push(v),v=I,_--)}return this.ranges=A,x},y.prototype.contains=function(x,A){return 0<=this.pointIndex({row:x,column:A})},y.prototype.containsPoint=function(x){return 0<=this.pointIndex(x)},y.prototype.rangeAtPoint=function(x){if(x=this.pointIndex(x),0<=x)return this.ranges[x]},y.prototype.clipRows=function(x,A){var v=this.ranges;if(v[0].start.row>A||v[v.length-1].start.row<x)return[];for(var x=this.pointIndex({row:x,column:0}),_=this.pointIndex({row:A,column:0},x=x<0?-x-1:x),I=(_<0&&(_=-_-1),[]),T=x;T<_;T++)I.push(v[T]);return I},y.prototype.removeAll=function(){return this.ranges.splice(0,this.ranges.length)},y.prototype.attach=function(x){this.session&&this.detach(),this.session=x,this.onChange=this.$onChange.bind(this),this.session.on("change",this.onChange)},y.prototype.detach=function(){this.session&&(this.session.removeListener("change",this.onChange),this.session=null)},y.prototype.$onChange=function(x){for(var A=x.start,v=x.end,_=A.row,I=v.row,T=this.ranges,E=0,w=T.length;E<w&&!((k=T[E]).end.row>=_);E++);if(x.action=="insert")for(var S=I-_,P=-A.column+v.column;E<w&&!((k=T[E]).start.row>_);E++)k.start.row==_&&k.start.column>=A.column&&(k.start.column==A.column&&this.$bias<=0||(k.start.column+=P,k.start.row+=S)),k.end.row==_&&k.end.column>=A.column&&(k.end.column==A.column&&this.$bias<0||(k.end.column==A.column&&0<P&&E<w-1&&k.end.column>k.start.column&&k.end.column==T[E+1].start.column&&(k.end.column-=P),k.end.column+=P,k.end.row+=S));else for(var k,S=_-I,P=A.column-v.column;E<w&&!((k=T[E]).start.row>I);E++)k.end.row<I&&(_<k.end.row||_==k.end.row&&A.column<k.end.column)?(k.end.row=_,k.end.column=A.column):k.end.row==I?k.end.column<=v.column?(S||k.end.column>A.column)&&(k.end.column=A.column,k.end.row=A.row):(k.end.column+=P,k.end.row+=S):k.end.row>I&&(k.end.row+=S),k.start.row<I&&(_<k.start.row||_==k.start.row&&A.column<k.start.column)?(k.start.row=_,k.start.column=A.column):k.start.row==I?k.start.column<=v.column?(S||k.start.column>A.column)&&(k.start.column=A.column,k.start.row=A.row):(k.start.column+=P,k.start.row+=S):k.start.row>I&&(k.start.row+=S);if(S!=0&&E<w)for(;E<w;E++)(k=T[E]).start.row+=S,k.end.row+=S},y);function y(){this.ranges=[],this.$bias=1}b.prototype.comparePoints=g,f.RangeList=b}),ace.define("ace/edit_session/fold",["require","exports","module","ace/range_list"],function(y,f,C){"use strict";var g,b,x=this&&this.__extends||(g=function(I,T){return(g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(E,w){E.__proto__=w}:function(E,w){for(var S in w)Object.prototype.hasOwnProperty.call(w,S)&&(E[S]=w[S])}))(I,T)},function(I,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function E(){this.constructor=I}g(I,T),I.prototype=T===null?Object.create(T):(E.prototype=T.prototype,new E)}),y=y("../range_list").RangeList,x=(x(A,b=y),A.prototype.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()},A.prototype.setFoldLine=function(I){this.foldLine=I,this.subFolds.forEach(function(T){T.setFoldLine(I)})},A.prototype.clone=function(){var I=new A(this.range.clone(),this.placeholder);return this.subFolds.forEach(function(T){I.subFolds.push(T.clone())}),I.collapseChildren=this.collapseChildren,I},A.prototype.addSubFold=function(I){if(!this.range.isEqual(I)){P=I,k=this.start,v(P.start,k),v(P.end,k);for(var T=I.start.row,E=I.start.column,w=0,S=-1;w<this.subFolds.length&&(S=this.subFolds[w].range.compare(T,E))==1;w++);var P=this.subFolds[w],k=0;if(S==0){if(P.range.containsRange(I))return P.addSubFold(I);k=1}for(var T=I.range.end.row,E=I.range.end.column,L=w,S=-1;L<this.subFolds.length&&(S=this.subFolds[L].range.compare(T,E))==1;L++);S==0&&L++;for(var R=this.subFolds.splice(w,L-w,I),N=S==0?R.length-1:R.length,F=k;F<N;F++)I.addSubFold(R[F]);return I.setFoldLine(this.foldLine),I}},A.prototype.restoreRange=function(I){return I=I,T=this.start,_(I.start,T),void _(I.end,T);var T},A);function A(I,T){var E=b.call(this)||this;return E.foldLine=null,E.placeholder=T,E.range=I,E.start=I.start,E.end=I.end,E.sameRow=I.start.row==I.end.row,E.subFolds=E.ranges=[],E}function v(I,T){I.row-=T.row,I.row==0&&(I.column-=T.column)}function _(I,T){I.row==0&&(I.column+=T.column),I.row+=T.row}f.Fold=x}),ace.define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator","ace/mouse/mouse_event"],function(h,f,C){"use strict";var g=h("../range").Range,b=h("./fold_line").FoldLine,y=h("./fold").Fold,x=h("../token_iterator").TokenIterator,A=h("../mouse/mouse_event").MouseEvent;f.Folding=function(){this.getFoldAt=function(v,_,I){var T=this.getFoldLine(v);if(!T)return null;for(var E=T.folds,w=0;w<E.length;w++){var S=E[w].range;if(S.contains(v,_)&&(I!=1||!S.isEnd(v,_)||S.isEmpty())&&(I!=-1||!S.isStart(v,_)||S.isEmpty()))return E[w]}},this.getFoldsInRange=function(v){var _=v.start,I=v.end,T=this.$foldData,E=[];_.column+=1,--I.column;for(var w=0;w<T.length;w++){var S=T[w].range.compareRange(v);if(S!=2){if(S==-2)break;for(var P=T[w].folds,k=0;k<P.length;k++){var L=P[k];if((S=L.range.compareRange(v))==-2)break;if(S!=2){if(S==42)break;E.push(L)}}}}return--_.column,I.column+=1,E},this.getFoldsInRangeList=function(v){var _;return Array.isArray(v)?(_=[],v.forEach(function(I){_=_.concat(this.getFoldsInRange(I))},this)):_=this.getFoldsInRange(v),_},this.getAllFolds=function(){for(var v=[],_=this.$foldData,I=0;I<_.length;I++)for(var T=0;T<_[I].folds.length;T++)v.push(_[I].folds[T]);return v},this.getFoldStringAt=function(v,_,I,T){if(!(T=T||this.getFoldLine(v)))return null;for(var E,w={end:{column:0}},S=0;S<T.folds.length;S++){var P,k=(P=T.folds[S]).range.compareEnd(v,_);if(k==-1){E=this.getLine(P.start.row).substring(w.end.column,P.start.column);break}if(k===0)return null;w=P}return E=E||this.getLine(P.start.row).substring(w.end.column),I==-1?E.substring(0,_-w.end.column):I==1?E.substring(_-w.end.column):E},this.getFoldLine=function(v,_){var I=this.$foldData,T=0;for((T=_?I.indexOf(_):T)==-1&&(T=0);T<I.length;T++){var E=I[T];if(E.start.row<=v&&E.end.row>=v)return E;if(E.end.row>v)return null}return null},this.getNextFoldLine=function(v,_){var I=this.$foldData,T=0;for((T=_?I.indexOf(_):T)==-1&&(T=0);T<I.length;T++){var E=I[T];if(E.end.row>=v)return E}return null},this.getFoldedRowCount=function(v,_){for(var I=this.$foldData,T=_-v+1,E=0;E<I.length;E++){var S=I[E],w=S.end.row,S=S.start.row;if(_<=w){S<_&&(v<=S?T-=_-S:T=0);break}v<=w&&(T-=v<=S?w-S:w-v+1)}return T},this.$addFoldLine=function(v){return this.$foldData.push(v),this.$foldData.sort(function(_,I){return _.start.row-I.start.row}),v},this.addFold=function(S,k){var I,T=this.$foldData,E=!1,w=(S instanceof y?I=S:(I=new y(k,S)).collapseChildren=k.collapseChildren,this.$clipRangeToDocument(I.range),I.start.row),S=I.start.column,P=I.end.row,k=I.end.column,L=this.getFoldAt(w,S,1),R=this.getFoldAt(P,k,-1);if(L&&R==L)return L.addSubFold(I);L&&!L.range.isStart(w,S)&&this.removeFold(L),R&&!R.range.isEnd(P,k)&&this.removeFold(R),S=this.getFoldsInRange(I.range),0<S.length&&(this.removeFolds(S),I.collapseChildren||S.forEach(function(V){I.addSubFold(V)}));for(var N=0;N<T.length;N++){var F=T[N];if(P==F.start.row){F.addFold(I),E=!0;break}if(w==F.end.row){if(F.addFold(I),E=!0,!I.sameRow){var H=T[N+1];if(H&&H.start.row==P){F.merge(H);break}}break}if(P<=F.start.row)break}return E||(F=this.$addFoldLine(new b(this.$foldData,I))),this.$useWrapMode?this.$updateWrapData(F.start.row,F.start.row):this.$updateRowLengthCache(F.start.row,F.start.row),this.$modified=!0,this._signal("changeFold",{data:I,action:"add"}),I},this.addFolds=function(v){v.forEach(function(_){this.addFold(_)},this)},this.removeFold=function(v){var _=v.foldLine,I=_.start.row,T=_.end.row,E=this.$foldData,w=_.folds;w.length==1?E.splice(E.indexOf(_),1):_.range.isEnd(v.end.row,v.end.column)?(w.pop(),_.end.row=w[w.length-1].end.row,_.end.column=w[w.length-1].end.column):_.range.isStart(v.start.row,v.start.column)?(w.shift(),_.start.row=w[0].start.row,_.start.column=w[0].start.column):v.sameRow?w.splice(w.indexOf(v),1):((w=(E=_.split(v.start.row,v.start.column)).folds).shift(),E.start.row=w[0].start.row,E.start.column=w[0].start.column),this.$updating||(this.$useWrapMode?this.$updateWrapData(I,T):this.$updateRowLengthCache(I,T)),this.$modified=!0,this._signal("changeFold",{data:v,action:"remove"})},this.removeFolds=function(v){for(var _=[],I=0;I<v.length;I++)_.push(v[I]);_.forEach(function(T){this.removeFold(T)},this),this.$modified=!0},this.expandFold=function(v){this.removeFold(v),v.subFolds.forEach(function(_){v.restoreRange(_),this.addFold(_)},this),0<v.collapseChildren&&this.foldAll(v.start.row+1,v.end.row,v.collapseChildren-1),v.subFolds=[]},this.expandFolds=function(v){v.forEach(function(_){this.expandFold(_)},this)},this.unfold=function(v,_){var I;if(v==null)I=new g(0,0,this.getLength(),0),_==null&&(_=!0);else if(typeof v=="number")I=new g(v,0,v,this.getLine(v).length);else if("row"in v)I=g.fromPoints(v,v);else{if(Array.isArray(v))return T=[],v.forEach(function(E){T=T.concat(this.unfold(E))},this),T;I=v}for(var T,v=T=this.getFoldsInRangeList(I);T.length==1&&g.comparePoints(T[0].start,I.start)<0&&0<g.comparePoints(T[0].end,I.end);)this.expandFolds(T),T=this.getFoldsInRangeList(I);if(_!=0?this.removeFolds(T):this.expandFolds(T),v.length)return v},this.isRowFolded=function(v,_){return!!this.getFoldLine(v,_)},this.getRowFoldEnd=function(v,_){return _=this.getFoldLine(v,_),_?_.end.row:v},this.getRowFoldStart=function(v,_){return _=this.getFoldLine(v,_),_?_.start.row:v},this.getFoldDisplayLine=function(v,_,I,T,E){T==null&&(T=v.start.row),E==null&&(E=0),_==null&&(_=v.end.row),I==null&&(I=this.getLine(_).length);var w=this.doc,S="";return v.walk(function(P,k,L,R){if(!(k<T)){if(k==T){if(L<E)return;R=Math.max(E,R)}S+=P??w.getLine(k).substring(R,L)}},_,I),S},this.getDisplayLine=function(v,_,I,T){var E=this.getFoldLine(v);return E?this.getFoldDisplayLine(E,v,_,I,T):(E=this.doc.getLine(v)).substring(T||0,_||E.length)},this.$cloneFoldData=function(){var v=[];return v=this.$foldData.map(function(_){return _=_.folds.map(function(I){return I.clone()}),new b(v,_)})},this.toggleFold=function(v){var _=this.selection.getRange();if(_.isEmpty()){var I,T=_.start;if(I=this.getFoldAt(T.row,T.column))return void this.expandFold(I);(E=this.findMatchingBracket(T))?_.comparePoint(E)==1?_.end=E:(_.start=E,_.start.column++,_.end.column--):(E=this.findMatchingBracket({row:T.row,column:T.column+1}))?(_.comparePoint(E)==1?_.end=E:_.start=E,_.start.column++):_=this.getCommentFoldRange(T.row,T.column)||_}else{var E=this.getFoldsInRange(_);if(v&&E.length)return void this.expandFolds(E);E.length==1&&(I=E[0])}if((I=I||this.getFoldAt(_.start.row,_.start.column))&&I.range.toString()==_.toString())this.expandFold(I);else{if(T="...",!_.isMultiLine()){if((T=this.getTextRange(_)).length<4)return;T=T.trim().substring(0,2)+".."}this.addFold(T,_)}},this.getCommentFoldRange=function(v,_,I){var T=new x(this,v,_),E=T.getCurrentToken(),w=E&&E.type;if(E&&/^comment|string/.test(w)){(w=w.match(/comment|string/)[0])=="comment"&&(w+="|doc-start|\\.doc");var S=new RegExp(w),w=new g;if(I!=1){for(;(E=T.stepBackward())&&S.test(E.type)&&!/^comment.end/.test(E.type););E=T.stepForward()}if(w.start.row=T.getCurrentTokenRow(),w.start.column=T.getCurrentTokenColumn()+(/^comment.start/.test(E.type)?E.value.length:2),T=new x(this,v,_),I!=-1){var P=-1;do if(E=T.stepForward(),P==-1){var k=this.getState(T.$row);S.test(k)||(P=T.$row)}else if(T.$row>P)break;while(E&&S.test(E.type)&&!/^comment.start/.test(E.type));E=T.stepBackward()}else E=T.getCurrentToken();return w.end.row=T.getCurrentTokenRow(),w.end.column=T.getCurrentTokenColumn(),/^comment.end/.test(E.type)||(w.end.column+=E.value.length-2),w}},this.foldAll=function(v,_,I,T){I==null&&(I=1e5);var E=this.foldWidgets;if(E){_=_||this.getLength();for(var w,S=v=v||0;S<_;S++)E[S]==null&&(E[S]=this.getFoldWidget(S)),E[S]!="start"||T&&!T(S)||(w=this.getFoldWidgetRange(S))&&w.isMultiLine()&&w.end.row<=_&&w.start.row>=v&&(S=w.end.row,w.collapseChildren=I,this.addFold("...",w))}},this.foldToLevel=function(v){for(this.foldAll();0<v--;)this.unfold(null,!1)},this.foldAllComments=function(){var v=this;this.foldAll(null,null,null,function(_){for(var I=v.getTokens(_),T=0;T<I.length;T++){var E=I[T];if(E.type!="text"||!/^\s+$/.test(E.value))return!!/comment/.test(E.type)}})},this.$foldStyles={manual:1,markbegin:1,markbeginend:1},this.$foldStyle="markbegin",this.setFoldStyle=function(v){if(!this.$foldStyles[v])throw new Error("invalid fold style: "+v+"["+Object.keys(this.$foldStyles).join(", ")+"]");this.$foldStyle!=v&&((this.$foldStyle=v)=="manual"&&this.unfold(),v=this.$foldMode,this.$setFolding(null),this.$setFolding(v))},this.$setFolding=function(v){this.$foldMode!=v&&(this.$foldMode=v,this.off("change",this.$updateFoldWidgets),this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets),this._signal("changeAnnotation"),v&&this.$foldStyle!="manual"?(this.foldWidgets=[],this.getFoldWidget=v.getFoldWidget.bind(v,this,this.$foldStyle),this.getFoldWidgetRange=v.getFoldWidgetRange.bind(v,this,this.$foldStyle),this.$updateFoldWidgets=this.updateFoldWidgets.bind(this),this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this),this.on("change",this.$updateFoldWidgets),this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)):this.foldWidgets=null)},this.getParentFoldRangeData=function(v,_){var I=this.foldWidgets;if(!I||_&&I[v])return{};for(var T=v-1;0<=T;){var E=I[T];if((E=E??(I[T]=this.getFoldWidget(T)))=="start"){var w=this.getFoldWidgetRange(T),S=S||w;if(w&&w.end.row>=v)break}T--}return{range:T!==-1&&w,firstRange:S}},this.onFoldWidgetClick=function(v,_){var I={children:(_=_ instanceof A?_.domEvent:_).shiftKey,all:_.ctrlKey||_.metaKey,siblings:_.altKey};this.$toggleFoldWidget(v,I)||(v=_.target||_.srcElement)&&/ace_fold-widget/.test(v.className)&&(v.className+=" ace_invalid")},this.$toggleFoldWidget=function(v,_){var I,T,E,w;if(this.getFoldWidget)return I=this.getFoldWidget(v),T=this.getLine(v),(T=this.getFoldAt(v,(I=I==="end"?-1:1)==-1?0:T.length,I))?(_.children||_.all?this.removeFold(T):this.expandFold(T),T):(I=this.getFoldWidgetRange(v,!0))&&!I.isMultiLine()&&(T=this.getFoldAt(I.start.row,I.start.column,1))&&I.isEqual(T.range)?(this.removeFold(T),T):(_.siblings?((T=this.getParentFoldRangeData(v)).range&&(E=T.range.start.row+1,w=T.range.end.row),this.foldAll(E,w,_.all?1e4:0)):_.children?(w=I?I.end.row:this.getLength(),this.foldAll(v+1,w,_.all?1e4:0)):I&&(_.all&&(I.collapseChildren=1e4),this.addFold("...",I)),I)},this.toggleFoldWidget=function(v){var _,I=this.selection.getCursor().row;I=this.getRowFoldStart(I),!this.$toggleFoldWidget(I,{})&&(_=(_=this.getParentFoldRangeData(I,!0)).range||_.firstRange)&&(I=_.start.row,(I=this.getFoldAt(I,this.getLine(I).length,1))?this.removeFold(I):this.addFold("...",_))},this.updateFoldWidgets=function(v){var _=v.start.row,I=v.end.row-_;I==0?this.foldWidgets[_]=null:v.action=="remove"?this.foldWidgets.splice(_,1+I,null):((v=Array(1+I)).unshift(_,1),this.foldWidgets.splice.apply(this.foldWidgets,v))},this.tokenizerUpdateFoldWidgets=function(v){v=v.data,v.first!=v.last&&this.foldWidgets.length>v.first&&this.foldWidgets.splice(v.first,this.foldWidgets.length)}}}),ace.define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],function(h,f,C){"use strict";var g=h("../token_iterator").TokenIterator,b=h("../range").Range;f.BracketMatch=function(){this.findMatchingBracket=function(y,x){return y.column!=0&&(x=x||this.getLine(y.row).charAt(y.column-1))!=""&&(x=x.match(/([\(\[\{])|([\)\]\}])/))?x[1]?this.$findClosingBracket(x[1],y):this.$findOpeningBracket(x[2],y):null},this.getBracketRange=function(y){var x,A,v=this.getLine(y.row),_=!0,I=v.charAt(y.column-1),T=I&&I.match(/([\(\[\{])|([\)\]\}])/);if(T||(I=v.charAt(y.column),y={row:y.row,column:y.column+1},T=I&&I.match(/([\(\[\{])|([\)\]\}])/),_=!1),!T)return null;if(T[1]){if(!(A=this.$findClosingBracket(T[1],y)))return null;x=b.fromPoints(y,A),_||(x.end.column++,x.start.column--),x.cursor=x.end}else{if(!(A=this.$findOpeningBracket(T[2],y)))return null;x=b.fromPoints(A,y),_||(x.start.column++,x.end.column--),x.cursor=x.start}return x},this.getMatchingBracketRanges=function(y,x){var A=this.getLine(y.row),v=/([\(\[\{])|([\)\]\}])/,_=!x&&A.charAt(y.column-1),I=_&&_.match(v);return I||(_=(x===void 0||x)&&A.charAt(y.column),y={row:y.row,column:y.column+1},I=_&&_.match(v)),I?(x=new b(y.row,y.column-1,y.row,y.column),(A=I[1]?this.$findClosingBracket(I[1],y):this.$findOpeningBracket(I[2],y))?[x,new b(A.row,A.column,A.row,A.column+1)]:[x]):null},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{","<":">",">":"<"},this.$findOpeningBracket=function(y,x,A){var v=this.$brackets[y],_=1,I=new g(this,x.row,x.column),T=I.getCurrentToken();if(T=T||I.stepForward()){A=A||new RegExp("(\\.?"+T.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)").replace(/-close\b/,"-(close|open)")+")+");for(var E=x.column-I.getCurrentTokenColumn()-2,w=T.value;;){for(;0<=E;){var S=w.charAt(E);if(S==v){if(--_==0)return{row:I.getCurrentTokenRow(),column:E+I.getCurrentTokenColumn()}}else S==y&&(_+=1);--E}for(;(T=I.stepBackward())&&!A.test(T.type););if(T==null)break;E=(w=T.value).length-1}return null}},this.$findClosingBracket=function(y,x,A){var v=this.$brackets[y],_=1,I=new g(this,x.row,x.column),T=I.getCurrentToken();if(T=T||I.stepForward()){A=A||new RegExp("(\\.?"+T.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)").replace(/-open\b/,"-(close|open)")+")+");for(var E=x.column-I.getCurrentTokenColumn();;){for(var w=T.value,S=w.length;E<S;){var P=w.charAt(E);if(P==v){if(--_==0)return{row:I.getCurrentTokenRow(),column:E+I.getCurrentTokenColumn()}}else P==y&&(_+=1);E+=1}for(;(T=I.stepForward())&&!A.test(T.type););if(T==null)break;E=0}return null}},this.getMatchingTags=function(x){var x=new g(this,x.row,x.column),A=this.$findTagName(x);if(A)return x.stepBackward().value==="<"?this.$findClosingTag(x,A):this.$findOpeningTag(x,A)},this.$findTagName=function(y){var x=y.getCurrentToken(),A=!1,v=!1;if(x&&x.type.indexOf("tag-name")===-1)for(;(x=v?y.stepBackward():y.stepForward())&&(x.value==="/>"?v=!0:x.type.indexOf("tag-name")!==-1&&(A=!0)),x&&!A;);return x},this.$findClosingTag=function(y,x){var A=x.value,v=x.value,_=0,I=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+1),T=(x=y.stepForward(),new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+x.value.length)),E=!1;do{var w,S=x;if(S.type.indexOf("tag-close")===-1||E||(w=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+1),E=!0),x=y.stepForward())if(x.value!==">"||E||(w=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+1),E=!0),x.type.indexOf("tag-name")!==-1){if(v===(A=x.value)){if(S.value==="<")_++;else if(S.value==="</"&&--_<0){y.stepBackward();var P=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+2),k=(x=y.stepForward(),new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+x.value.length));if(!(x=x.type.indexOf("tag-close")===-1?y.stepForward():x)||x.value!==">")return;var L=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+1)}}}else v===A&&x.value==="/>"&&--_<0&&(L=k=P=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+2),w=new b(T.end.row,T.end.column,T.end.row,T.end.column+1))}while(x&&0<=_);if(I&&w&&P&&L&&T&&k)return{openTag:new b(I.start.row,I.start.column,w.end.row,w.end.column),closeTag:new b(P.start.row,P.start.column,L.end.row,L.end.column),openTagName:T,closeTagName:k}},this.$findOpeningTag=function(y,x){var A,v=y.getCurrentToken(),_=x.value,I=0,T=y.getCurrentTokenRow(),E=y.getCurrentTokenColumn(),w=new b(T,E,T,E+2),S=(y.stepForward(),new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+x.value.length));if((x=x.type.indexOf("tag-close")===-1?y.stepForward():x)&&x.value===">"){var P=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+1);y.stepBackward(),y.stepBackward();do if(x=v,T=y.getCurrentTokenRow(),A=(E=y.getCurrentTokenColumn())+x.value.length,v=y.stepBackward(),x){if(x.type.indexOf("tag-name")!==-1){if(_===x.value)if(v.value==="<"){if(0<++I){for(var k=new b(T,E,T,A),L=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+1);(x=y.stepForward())&&x.value!==">";);var R=new b(y.getCurrentTokenRow(),y.getCurrentTokenColumn(),y.getCurrentTokenRow(),y.getCurrentTokenColumn()+1)}}else v.value==="</"&&I--}else if(x.value==="/>"){for(var N=0,F=v;F;){if(F.type.indexOf("tag-name")!==-1&&F.value===_){I--;break}if(F.value==="<")break;F=y.stepBackward(),N++}for(var H=0;H<N;H++)y.stepForward()}}while(v&&I<=0);return L&&R&&w&&P&&k&&S?{openTag:new b(L.start.row,L.start.column,R.end.row,R.end.column),closeTag:new b(w.start.row,w.start.column,P.end.row,P.end.column),openTagName:k,closeTagName:S}:void 0}}}}),ace.define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/bidihandler","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document","ace/background_tokenizer","ace/search_highlight","ace/undomanager","ace/edit_session/folding","ace/edit_session/bracket_match"],function(h,f,C){"use strict";var g=h("./lib/oop"),b=h("./lib/lang"),y=h("./bidihandler").BidiHandler,x=h("./config"),A=h("./lib/event_emitter").EventEmitter,v=h("./selection").Selection,_=h("./mode/text").Mode,I=h("./range").Range,T=h("./document").Document,E=h("./background_tokenizer").BackgroundTokenizer,w=h("./search_highlight").SearchHighlight,S=h("./undomanager").UndoManager,P=(k.prototype.setDocument=function(B){this.doc&&this.doc.off("change",this.$onChange),(this.doc=B).on("change",this.$onChange,!0),this.bgTokenizer.setDocument(this.getDocument()),this.resetCaches()},k.prototype.getDocument=function(){return this.doc},k.prototype.$resetRowCache=function(B){var j;B?(j=this.$docRowCache.length,(B=this.$getRowCacheIndex(this.$docRowCache,B)+1)<j&&(this.$docRowCache.splice(B,j),this.$screenRowCache.splice(B,j))):(this.$docRowCache=[],this.$screenRowCache=[])},k.prototype.$getRowCacheIndex=function(B,j){for(var U=0,z=B.length-1;U<=z;){var $=U+z>>1,Z=B[$];if(Z<j)U=1+$;else{if(!(j<Z))return $;z=$-1}}return U-1},k.prototype.resetCaches=function(){this.$modified=!0,this.$wrapData=[],this.$rowLengthCache=[],this.$resetRowCache(0),this.destroyed||this.bgTokenizer.start(0)},k.prototype.onChangeFold=function(B){B=B.data,this.$resetRowCache(B.start.row)},k.prototype.onChange=function(B){this.$modified=!0,this.$bidiHandler.onChange(B),this.$resetRowCache(B.start.row);var j=this.$updateInternalDataOnChange(B);!this.$fromUndo&&this.$undoManager&&(j&&j.length&&(this.$undoManager.add({action:"removeFolds",folds:j},this.mergeUndoDeltas),this.mergeUndoDeltas=!0),this.$undoManager.add(B,this.mergeUndoDeltas),this.mergeUndoDeltas=!0,this.$informUndoManager.schedule()),this.bgTokenizer.$updateOnChange(B),this._signal("change",B)},k.prototype.setValue=function(B){this.doc.setValue(B),this.selection.moveTo(0,0),this.$resetRowCache(0),this.setUndoManager(this.$undoManager),this.getUndoManager().reset()},k.fromJSON=function(B){typeof B=="string"&&(B=JSON.parse(B));var j=new S,U=(j.$undoStack=B.history.undo,j.$redoStack=B.history.redo,j.mark=B.history.mark,j.$rev=B.history.rev,new k(B.value));return B.folds.forEach(function(z){U.addFold("...",I.fromPoints(z.start,z.end))}),U.setAnnotations(B.annotations),U.setBreakpoints(B.breakpoints),U.setMode(B.mode),U.setScrollLeft(B.scrollLeft),U.setScrollTop(B.scrollTop),U.setUndoManager(j),U.selection.fromJSON(B.selection),U},k.prototype.toJSON=function(){return{annotations:this.$annotations,breakpoints:this.$breakpoints,folds:this.getAllFolds().map(function(B){return B.range}),history:this.getUndoManager(),mode:this.$mode.$id,scrollLeft:this.$scrollLeft,scrollTop:this.$scrollTop,selection:this.selection.toJSON(),value:this.doc.getValue()}},k.prototype.toString=function(){return this.doc.getValue()},k.prototype.getSelection=function(){return this.selection},k.prototype.getState=function(B){return this.bgTokenizer.getState(B)},k.prototype.getTokens=function(B){return this.bgTokenizer.getTokens(B)},k.prototype.getTokenAt=function(B,j){var U=this.bgTokenizer.getTokens(B),$=0;if(j==null)var z=U.length-1,$=this.getLine(B).length;else for(z=0;z<U.length&&!(j<=($+=U[z].value.length));z++);return(B=U[z])?(B.index=z,B.start=$-B.value.length,B):null},k.prototype.setUndoManager=function(B){var j;this.$undoManager=B,this.$informUndoManager&&this.$informUndoManager.cancel(),B?(B.addSession(j=this),this.$syncInformUndoManager=function(){j.$informUndoManager.cancel(),j.mergeUndoDeltas=!1},this.$informUndoManager=b.delayedCall(this.$syncInformUndoManager)):this.$syncInformUndoManager=function(){}},k.prototype.markUndoGroup=function(){this.$syncInformUndoManager&&this.$syncInformUndoManager()},k.prototype.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},k.prototype.getTabString=function(){return this.getUseSoftTabs()?b.stringRepeat(" ",this.getTabSize()):"	"},k.prototype.setUseSoftTabs=function(B){this.setOption("useSoftTabs",B)},k.prototype.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs},k.prototype.setTabSize=function(B){this.setOption("tabSize",B)},k.prototype.getTabSize=function(){return this.$tabSize},k.prototype.isTabStop=function(B){return this.$useSoftTabs&&B.column%this.$tabSize==0},k.prototype.setNavigateWithinSoftTabs=function(B){this.setOption("navigateWithinSoftTabs",B)},k.prototype.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs},k.prototype.setOverwrite=function(B){this.setOption("overwrite",B)},k.prototype.getOverwrite=function(){return this.$overwrite},k.prototype.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},k.prototype.addGutterDecoration=function(B,j){this.$decorations[B]||(this.$decorations[B]=""),this.$decorations[B]+=" "+j,this._signal("changeBreakpoint",{})},k.prototype.removeGutterDecoration=function(B,j){this.$decorations[B]=(this.$decorations[B]||"").replace(" "+j,""),this._signal("changeBreakpoint",{})},k.prototype.getBreakpoints=function(){return this.$breakpoints},k.prototype.setBreakpoints=function(B){this.$breakpoints=[];for(var j=0;j<B.length;j++)this.$breakpoints[B[j]]="ace_breakpoint";this._signal("changeBreakpoint",{})},k.prototype.clearBreakpoints=function(){this.$breakpoints=[],this._signal("changeBreakpoint",{})},k.prototype.setBreakpoint=function(B,j){(j=j===void 0?"ace_breakpoint":j)?this.$breakpoints[B]=j:delete this.$breakpoints[B],this._signal("changeBreakpoint",{})},k.prototype.clearBreakpoint=function(B){delete this.$breakpoints[B],this._signal("changeBreakpoint",{})},k.prototype.addMarker=function(Z,j,U,z){var $=this.$markerId++,Z={range:Z,type:U||"line",renderer:typeof U=="function"?U:null,clazz:j,inFront:!!z,id:$};return z?(this.$frontMarkers[$]=Z,this._signal("changeFrontMarker")):(this.$backMarkers[$]=Z,this._signal("changeBackMarker")),$},k.prototype.addDynamicMarker=function(B,j){var U;if(B.update)return U=this.$markerId++,B.id=U,B.inFront=!!j,j?(this.$frontMarkers[U]=B,this._signal("changeFrontMarker")):(this.$backMarkers[U]=B,this._signal("changeBackMarker")),B},k.prototype.removeMarker=function(B){var j=this.$frontMarkers[B]||this.$backMarkers[B];j&&(delete(j.inFront?this.$frontMarkers:this.$backMarkers)[B],this._signal(j.inFront?"changeFrontMarker":"changeBackMarker"))},k.prototype.getMarkers=function(B){return B?this.$frontMarkers:this.$backMarkers},k.prototype.highlight=function(B){var j;this.$searchHighlight||(j=new w(null,"ace_selected-word","text"),this.$searchHighlight=this.addDynamicMarker(j)),this.$searchHighlight.setRegexp(B)},k.prototype.highlightLines=function(B,j,U,z){return typeof j!="number"&&(U=j,j=B),U=U||"ace_step",B=new I(B,0,j,1/0),B.id=this.addMarker(B,U,"fullLine",z),B},k.prototype.setAnnotations=function(B){this.$annotations=B,this._signal("changeAnnotation",{})},k.prototype.getAnnotations=function(){return this.$annotations||[]},k.prototype.clearAnnotations=function(){this.setAnnotations([])},k.prototype.$detectNewLine=function(B){B=B.match(/^.*?(\r?\n)/m),this.$autoNewLine=B?B[1]:`
`},k.prototype.getWordRange=function(B,j){var U,z=this.getLine(B),$=!1,Z=(U=($=($=0<j?!!z.charAt(j-1).match(this.tokenRe):$)||!!z.charAt(j).match(this.tokenRe))?this.tokenRe:/^\s+$/.test(z.slice(j-1,j+1))?/\s/:this.nonTokenRe,j);if(0<Z){for(;0<=--Z&&z.charAt(Z).match(U););Z++}for(var J=j;J<z.length&&z.charAt(J).match(U);)J++;return new I(B,Z,B,J)},k.prototype.getAWordRange=function(B,j){for(var U=this.getWordRange(B,j),z=this.getLine(U.end.row);z.charAt(U.end.column).match(/[ \t]/);)U.end.column+=1;return U},k.prototype.setNewLineMode=function(B){this.doc.setNewLineMode(B)},k.prototype.getNewLineMode=function(){return this.doc.getNewLineMode()},k.prototype.setUseWorker=function(B){this.setOption("useWorker",B)},k.prototype.getUseWorker=function(){return this.$useWorker},k.prototype.onReloadTokenizer=function(B){var j=B.data;this.bgTokenizer.start(j.first),this._signal("tokenizerUpdate",B)},k.prototype.setMode=function(B,j){if(B&&typeof B=="object"){if(B.getTokenizer)return this.$onChangeMode(B);var U=B,z=U.path}else z=B||"ace/mode/text";this.$modes["ace/mode/text"]||(this.$modes["ace/mode/text"]=new _),this.$modes[z]&&!U?(this.$onChangeMode(this.$modes[z]),j&&j()):(this.$modeId=z,x.loadModule(["mode",z],(function($){if(this.$modeId!==z)return j&&j();this.$modes[z]&&!U?this.$onChangeMode(this.$modes[z]):$&&$.Mode&&($=new $.Mode(U),U||((this.$modes[z]=$).$id=z),this.$onChangeMode($)),j&&j()}).bind(this)),this.$mode||this.$onChangeMode(this.$modes["ace/mode/text"],!0))},k.prototype.$onChangeMode=function(B,j){var U,z,$;j||(this.$modeId=B.$id),this.$mode===B||(U=this.$mode,this.$mode=B,this.$stopWorker(),this.$useWorker&&this.$startWorker(),(z=B.getTokenizer()).on!==void 0&&($=this.onReloadTokenizer.bind(this),z.on("update",$)),this.bgTokenizer.setTokenizer(z),this.bgTokenizer.setDocument(this.getDocument()),this.tokenRe=B.tokenRe,this.nonTokenRe=B.nonTokenRe,j)||(B.attachToSession&&B.attachToSession(this),this.$options.wrapMethod.set.call(this,this.$wrapMethod),this.$setFolding(B.foldingRules),this.bgTokenizer.start(0),this._emit("changeMode",{oldMode:U,mode:B}))},k.prototype.$stopWorker=function(){this.$worker&&(this.$worker.terminate(),this.$worker=null)},k.prototype.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(B){x.warn("Could not load worker",B),this.$worker=null}},k.prototype.getMode=function(){return this.$mode},k.prototype.setScrollTop=function(B){this.$scrollTop===B||isNaN(B)||(this.$scrollTop=B,this._signal("changeScrollTop",B))},k.prototype.getScrollTop=function(){return this.$scrollTop},k.prototype.setScrollLeft=function(B){this.$scrollLeft===B||isNaN(B)||(this.$scrollLeft=B,this._signal("changeScrollLeft",B))},k.prototype.getScrollLeft=function(){return this.$scrollLeft},k.prototype.getScreenWidth=function(){return this.$computeWidth(),this.lineWidgets?Math.max(this.getLineWidgetMaxWidth(),this.screenWidth):this.screenWidth},k.prototype.getLineWidgetMaxWidth=function(){var B;return this.lineWidgetsWidth!=null?this.lineWidgetsWidth:(B=0,this.lineWidgets.forEach(function(j){j&&j.screenWidth>B&&(B=j.screenWidth)}),this.lineWidgetWidth=B)},k.prototype.$computeWidth=function(B){if(this.$modified||B){if(this.$modified=!1,this.$useWrapMode)return this.screenWidth=this.$wrapLimit;for(var j=this.doc.getAllLines(),U=this.$rowLengthCache,z=0,$=0,Z=this.$foldData[$],J=Z?Z.start.row:1/0,ie=j.length,ne=0;ne<ie;ne++){if(J<ne){if(ie<=(ne=Z.end.row+1))break;J=(Z=this.$foldData[$++])?Z.start.row:1/0}U[ne]==null&&(U[ne]=this.$getStringScreenWidth(j[ne])[0]),U[ne]>z&&(z=U[ne])}this.screenWidth=z}},k.prototype.getLine=function(B){return this.doc.getLine(B)},k.prototype.getLines=function(B,j){return this.doc.getLines(B,j)},k.prototype.getLength=function(){return this.doc.getLength()},k.prototype.getTextRange=function(B){return this.doc.getTextRange(B||this.selection.getRange())},k.prototype.insert=function(B,j){return this.doc.insert(B,j)},k.prototype.remove=function(B){return this.doc.remove(B)},k.prototype.removeFullLines=function(B,j){return this.doc.removeFullLines(B,j)},k.prototype.undoChanges=function(B,j){if(B.length){this.$fromUndo=!0;for(var U=B.length-1;U!=-1;U--){var z=B[U];z.action=="insert"||z.action=="remove"?this.doc.revertDelta(z):z.folds&&this.addFolds(z.folds)}!j&&this.$undoSelect&&(B.selectionBefore?this.selection.fromJSON(B.selectionBefore):this.selection.setRange(this.$getUndoSelection(B,!0))),this.$fromUndo=!1}},k.prototype.redoChanges=function(B,j){if(B.length){this.$fromUndo=!0;for(var U=0;U<B.length;U++){var z=B[U];z.action!="insert"&&z.action!="remove"||this.doc.$safeApplyDelta(z)}!j&&this.$undoSelect&&(B.selectionAfter?this.selection.fromJSON(B.selectionAfter):this.selection.setRange(this.$getUndoSelection(B,!1))),this.$fromUndo=!1}},k.prototype.setUndoSelect=function(B){this.$undoSelect=B},k.prototype.$getUndoSelection=function(B,j){function U(ie){return j?ie.action!=="insert":ie.action==="insert"}for(var z,$,Z=0;Z<B.length;Z++){var J=B[Z];J.start&&(z?U(J)?($=J.start,z.compare($.row,$.column)==-1&&z.setStart($),$=J.end,z.compare($.row,$.column)==1&&z.setEnd($)):($=J.start,z.compare($.row,$.column)==-1&&(z=I.fromPoints(J.start,J.start))):z=U(J)?I.fromPoints(J.start,J.end):I.fromPoints(J.start,J.start))}return z},k.prototype.replace=function(B,j){return this.doc.replace(B,j)},k.prototype.moveText=function(B,ne,U){var z,$,Z,J=this.getTextRange(B),ie=this.getFoldsInRange(B),ne=I.fromPoints(ne,ne);return U||(this.remove(B),$=B.start.row-B.end.row,(Z=$?-B.end.column:B.start.column-B.end.column)&&(ne.start.row==B.end.row&&ne.start.column>B.end.column&&(ne.start.column+=Z),ne.end.row==B.end.row)&&ne.end.column>B.end.column&&(ne.end.column+=Z),$&&ne.start.row>=B.end.row&&(ne.start.row+=$,ne.end.row+=$)),ne.end=this.insert(ne.start,J),ie.length&&(z=B.start,U=ne.start,$=U.row-z.row,Z=U.column-z.column,this.addFolds(ie.map(function(le){return(le=le.clone()).start.row==z.row&&(le.start.column+=Z),le.end.row==z.row&&(le.end.column+=Z),le.start.row+=$,le.end.row+=$,le}))),ne},k.prototype.indentRows=function(B,j,U){U=U.replace(/\t/g,this.getTabString());for(var z=B;z<=j;z++)this.doc.insertInLine({row:z,column:0},U)},k.prototype.outdentRows=function(B){for(var j=B.collapseRows(),U=new I(0,0,0,0),z=this.getTabSize(),$=j.start.row;$<=j.end.row;++$){var Z=this.getLine($);U.start.row=$,U.end.row=$;for(var J=0;J<z&&Z.charAt(J)==" ";++J);J<z&&Z.charAt(J)=="	"?(U.start.column=J,U.end.column=J+1):(U.start.column=0,U.end.column=J),this.remove(U)}},k.prototype.$moveLines=function(B,j,Z){if(B=this.getRowFoldStart(B),j=this.getRowFoldEnd(j),Z<0){if(($=this.getRowFoldStart(B+Z))<0)return 0;var z=$-B}else if(0<Z){if(($=this.getRowFoldEnd(j+Z))>this.doc.getLength()-1)return 0;z=$-j}else B=this.$clipRowToDocument(B),z=(j=this.$clipRowToDocument(j))-B+1;var $=new I(B,0,j,Number.MAX_VALUE),$=this.getFoldsInRange($).map(function(J){return(J=J.clone()).start.row+=z,J.end.row+=z,J}),Z=Z==0?this.doc.getLines(B,j):this.doc.removeFullLines(B,j);return this.doc.insertFullLines(B+z,Z),$.length&&this.addFolds($),z},k.prototype.moveLinesUp=function(B,j){return this.$moveLines(B,j,-1)},k.prototype.moveLinesDown=function(B,j){return this.$moveLines(B,j,1)},k.prototype.duplicateLines=function(B,j){return this.$moveLines(B,j,0)},k.prototype.$clipRowToDocument=function(B){return Math.max(0,Math.min(B,this.doc.getLength()-1))},k.prototype.$clipColumnToRow=function(B,j){return j<0?0:Math.min(this.doc.getLine(B).length,j)},k.prototype.$clipPositionToDocument=function(B,j){var U;return j=Math.max(0,j),j=B<0?B=0:(U=this.doc.getLength())<=B?this.doc.getLine(B=U-1).length:Math.min(this.doc.getLine(B).length,j),{row:B,column:j}},k.prototype.$clipRangeToDocument=function(B){B.start.row<0?(B.start.row=0,B.start.column=0):B.start.column=this.$clipColumnToRow(B.start.row,B.start.column);var j=this.doc.getLength()-1;return B.end.row>j?(B.end.row=j,B.end.column=this.doc.getLine(j).length):B.end.column=this.$clipColumnToRow(B.end.row,B.end.column),B},k.prototype.setUseWrapMode=function(B){B!=this.$useWrapMode&&(this.$useWrapMode=B,this.$modified=!0,this.$resetRowCache(0),B&&(B=this.getLength(),this.$wrapData=Array(B),this.$updateWrapData(0,B-1)),this._signal("changeWrapMode"))},k.prototype.getUseWrapMode=function(){return this.$useWrapMode},k.prototype.setWrapLimitRange=function(B,j){this.$wrapLimitRange.min===B&&this.$wrapLimitRange.max===j||(this.$wrapLimitRange={min:B,max:j},this.$modified=!0,this.$bidiHandler.markAsDirty(),this.$useWrapMode&&this._signal("changeWrapMode"))},k.prototype.adjustWrapLimit=function(B,z){var U=this.$wrapLimitRange,z=(U.max<0&&(U={min:z,max:z}),this.$constrainWrapLimit(B,U.min,U.max));return z!=this.$wrapLimit&&1<z&&(this.$wrapLimit=z,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this.$resetRowCache(0),this._signal("changeWrapLimit")),!0)},k.prototype.$constrainWrapLimit=function(B,j,U){return j&&(B=Math.max(j,B)),B=U?Math.min(U,B):B},k.prototype.getWrapLimit=function(){return this.$wrapLimit},k.prototype.setWrapLimit=function(B){this.setWrapLimitRange(B,B)},k.prototype.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},k.prototype.$updateInternalDataOnChange=function(B){var j=this.$useWrapMode,U=B.action,z=B.start,$=B.end,Z=z.row,J=$.row,ie=J-Z,ne=null;if(this.$updating=!0,ie!=0)if(U==="remove"){this[j?"$wrapData":"$rowLengthCache"].splice(Z,ie);var le=this.$foldData,ne=this.getFoldsInRange(B);this.removeFolds(ne);var ee=0;for((X=this.getFoldLine($.row))&&(X.addRemoveChars($.row,$.column,z.column-$.column),X.shiftRow(-ie),(oe=this.getFoldLine(Z))&&oe!==X&&(oe.merge(X),X=oe),ee=le.indexOf(X)+1);ee<le.length;ee++)(X=le[ee]).start.row>=$.row&&X.shiftRow(-ie);J=Z}else{var oe=Array(ie),te=(oe.unshift(Z,0),j?this.$wrapData:this.$rowLengthCache),le=(te.splice.apply(te,oe),this.$foldData),ee=0;for((X=this.getFoldLine(Z))&&((te=X.range.compareInside(z.row,z.column))==0?(X=X.split(z.row,z.column))&&(X.shiftRow(ie),X.addRemoveChars(J,0,$.column-z.column)):te==-1&&(X.addRemoveChars(Z,0,$.column-z.column),X.shiftRow(ie)),ee=le.indexOf(X)+1);ee<le.length;ee++)(X=le[ee]).start.row>=Z&&X.shiftRow(ie)}else{var X,ie=Math.abs(B.start.column-B.end.column);U==="remove"&&(ne=this.getFoldsInRange(B),this.removeFolds(ne),ie=-ie),(X=this.getFoldLine(Z))&&X.addRemoveChars(Z,z.column,ie)}return j&&this.$wrapData.length!=this.doc.getLength(),this.$updating=!1,j?this.$updateWrapData(Z,J):this.$updateRowLengthCache(Z,J),ne},k.prototype.$updateRowLengthCache=function(B,j){this.$rowLengthCache[B]=null,this.$rowLengthCache[j]=null},k.prototype.$updateWrapData=function(B,j){var U,z,$=this.doc.getAllLines(),Z=this.getTabSize(),J=this.$wrapData,ie=this.$wrapLimit,ne=B;for(j=Math.min(j,$.length-1);ne<=j;)(z=this.getFoldLine(ne,z))?(U=[],z.walk((function(le,ee,oe,te){var X;if(le!=null){(X=this.$getDisplayTokens(le,U.length))[0]=N;for(var W=1;W<X.length;W++)X[W]=F}else X=this.$getDisplayTokens($[ee].substring(te,oe),U.length);U=U.concat(X)}).bind(this),z.end.row,$[z.end.row].length+1),J[z.start.row]=this.$computeWrapSplits(U,ie,Z),ne=z.end.row+1):(U=this.$getDisplayTokens($[ne]),J[ne]=this.$computeWrapSplits(U,ie,Z),ne++)},k.prototype.$computeWrapSplits=function(B,j,U){if(B.length==0)return[];var z=[],$=B.length,Z=0,J=0,ie=this.$wrapAsCode,ne=this.$indentedSoftWrap,le=j<=Math.max(2*U,8)||ne===!1?0:Math.floor(j/2);function ee(W){for(var K=W-Z,re=Z;re<W;re++){var se=B[re];se!==12&&se!==2||--K}z.length||(oe=function(){var me=0;if(le===0)return me;if(ne)for(var Y=0;Y<B.length;Y++){var ae=B[Y];if(ae==V)me+=1;else if(ae==q)me+=U;else if(ae!=Q)break}return ie&&ne!==!1&&(me+=U),Math.min(me,le)}(),z.indent=oe),J+=K,z.push(J),Z=W}for(var oe=0;j-oe<$-Z;){var te=Z+j-oe;if(B[te-1]>=V&&B[te]>=V)ee(te);else if(B[te]==N||B[te]==F){for(;te!=Z-1&&B[te]!=N;te--);if(!(Z<te)){for(te=Z+j;te<B.length&&B[te]==F;te++);if(te==B.length)break}ee(te)}else{for(var X=Math.max(te-(j-(j>>2)),Z-1);X<te&&B[te]<N;)te--;if(ie){for(;X<te&&B[te]<N;)te--;for(;X<te&&B[te]==H;)te--}else for(;X<te&&B[te]<V;)te--;X<te?ee(++te):(B[te=Z+j]==R&&te--,ee(te-oe))}}return z},k.prototype.$getDisplayTokens=function(B,j){var U,z=[];j=j||0;for(var $=0;$<B.length;$++){var Z=B.charCodeAt($);if(Z==9){U=this.getScreenTabSize(z.length+j),z.push(q);for(var J=1;J<U;J++)z.push(Q)}else Z==32?z.push(V):39<Z&&Z<48||57<Z&&Z<64?z.push(H):4352<=Z&&O(Z)?z.push(L,R):z.push(L)}return z},k.prototype.$getStringScreenWidth=function(B,j,U){if(j==0)return[0,0];var z,$;for(j==null&&(j=1/0),U=U||0,$=0;$<B.length&&((z=B.charCodeAt($))==9?U+=this.getScreenTabSize(U):4352<=z&&O(z)?U+=2:U+=1,!(j<U));$++);return[U,$]},k.prototype.getRowLength=function(B){var j=1;return this.lineWidgets&&(j+=this.lineWidgets[B]&&this.lineWidgets[B].rowCount||0),this.$useWrapMode&&this.$wrapData[B]?this.$wrapData[B].length+j:j},k.prototype.getRowLineCount=function(B){return this.$useWrapMode&&this.$wrapData[B]?this.$wrapData[B].length+1:1},k.prototype.getRowWrapIndent=function(B){var j;return this.$useWrapMode&&(B=this.screenToDocumentPosition(B,Number.MAX_VALUE),(j=this.$wrapData[B.row]).length)&&j[0]<B.column?j.indent:0},k.prototype.getScreenLastRowColumn=function(B){return B=this.screenToDocumentPosition(B,Number.MAX_VALUE),this.documentToScreenColumn(B.row,B.column)},k.prototype.getDocumentLastRowColumn=function(B,j){return B=this.documentToScreenRow(B,j),this.getScreenLastRowColumn(B)},k.prototype.getDocumentLastRowColumnPosition=function(B,j){return B=this.documentToScreenRow(B,j),this.screenToDocumentPosition(B,Number.MAX_VALUE/10)},k.prototype.getRowSplitData=function(B){if(this.$useWrapMode)return this.$wrapData[B]},k.prototype.getScreenTabSize=function(B){return this.$tabSize-(B%this.$tabSize|0)},k.prototype.screenToDocumentRow=function(B,j){return this.screenToDocumentPosition(B,j).row},k.prototype.screenToDocumentColumn=function(B,j){return this.screenToDocumentPosition(B,j).column},k.prototype.screenToDocumentPosition=function(B,j,U){if(B<0)return{row:0,column:0};for(var z,$,Z,J=0,ie=0,ne=0,le=0,ee=this.$screenRowCache,oe=this.$getRowCacheIndex(ee,B),te=ee.length,X=(Z=te&&0<=oe?(ne=ee[oe],J=this.$docRowCache[oe],B>ee[te-1]):!te,this.getLength()-1),W=this.getNextFoldLine(J),K=W?W.start.row:1/0;ne<=B&&!(B<ne+(le=this.getRowLength(J))||X<=J);)ne+=le,K<++J&&(J=W.end.row+1,K=(W=this.getNextFoldLine(J,W))?W.start.row:1/0),Z&&(this.$docRowCache.push(J),this.$screenRowCache.push(ne));if(W&&W.start.row<=J)z=this.getFoldDisplayLine(W),J=W.start.row;else{if(ne+le<=B||X<J)return{row:X,column:this.getLine(X).length};z=this.getLine(J),W=null}return oe=0,ee=Math.floor(B-ne),this.$useWrapMode&&(te=this.$wrapData[J])&&($=te[ee],0<ee)&&te.length&&(oe=te.indent,ie=te[ee-1]||te[te.length-1],z=z.substring(ie)),U!==void 0&&this.$bidiHandler.isBidiRow(ne+ee,J,ee)&&(j=this.$bidiHandler.offsetToCol(U)),ie+=this.$getStringScreenWidth(z,j-oe)[1],this.$useWrapMode&&$<=ie&&(ie=$-1),W?W.idxToPosition(ie):{row:J,column:ie}},k.prototype.documentToScreenPosition=function(B,j){var oe=j===void 0?this.$clipPositionToDocument(B.row,B.column):this.$clipPositionToDocument(B,j),U=(B=oe.row,j=oe.column,0),oe=null;(J=this.getFoldAt(B,j,1))&&(B=J.start.row,j=J.start.column);for(var z,$,Z=0,J=this.$docRowCache,te=this.$getRowCacheIndex(J,B),ie=J.length,ne=($=ie&&0<=te?(Z=J[te],U=this.$screenRowCache[te],B>J[ie-1]):!ie,this.getNextFoldLine(Z)),le=ne?ne.start.row:1/0;Z<B;){if(le<=Z){if(B<(z=ne.end.row+1))break;le=(ne=this.getNextFoldLine(z,ne))?ne.start.row:1/0}else z=Z+1;U+=this.getRowLength(Z),Z=z,$&&(this.$docRowCache.push(Z),this.$screenRowCache.push(U))}var ee="",oe=ne&&le<=Z?(ee=this.getFoldDisplayLine(ne,B,j),ne.start.row):(ee=this.getLine(B).substring(0,j),B),te=0;if(this.$useWrapMode){var X=this.$wrapData[oe];if(X){for(var W=0;ee.length>=X[W];)U++,W++;ee=ee.substring(X[W-1]||0,ee.length),te=0<W?X.indent:0}}return this.lineWidgets&&this.lineWidgets[Z]&&this.lineWidgets[Z].rowsAbove&&(U+=this.lineWidgets[Z].rowsAbove),{row:U,column:te+this.$getStringScreenWidth(ee)[0]}},k.prototype.documentToScreenColumn=function(B,j){return this.documentToScreenPosition(B,j).column},k.prototype.documentToScreenRow=function(B,j){return this.documentToScreenPosition(B,j).row},k.prototype.getScreenLength=function(){var B=0,j=null;if(this.$useWrapMode)for(var U=this.$wrapData.length,z=0,$=0,Z=(j=this.$foldData[$++])?j.start.row:1/0;z<U;){var J=this.$wrapData[z];B+=J?J.length+1:1,Z<++z&&(z=j.end.row+1,Z=(j=this.$foldData[$++])?j.start.row:1/0)}else for(var B=this.getLength(),ie=this.$foldData,$=0;$<ie.length;$++)B-=(j=ie[$]).end.row-j.start.row;return this.lineWidgets&&(B+=this.$getWidgetScreenLength()),B},k.prototype.$setFontMetrics=function(B){this.$enableVarChar&&(this.$getStringScreenWidth=function(j,U,z){if(U===0)return[0,0];var $,Z;for(U=U||1/0,z=z||0,Z=0;Z<j.length&&!(U<(z+=($=j.charAt(Z))==="	"?this.getScreenTabSize(z):B.getCharacterWidth($)));Z++);return[z,Z]})},k.prototype.getPrecedingCharacter=function(){var B=this.selection.getCursor();return B.column===0?B.row===0?"":this.doc.getNewLineCharacter():this.getLine(B.row)[B.column-1]},k.prototype.destroy=function(){this.destroyed||(this.bgTokenizer.setDocument(null),this.bgTokenizer.cleanup(),this.destroyed=!0),this.$stopWorker(),this.removeAllListeners(),this.doc&&this.doc.off("change",this.$onChange),this.selection.detach()},k);function k(B,j){this.doc,this.$breakpoints=[],this.$decorations=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$undoSelect=!0,this.$foldData=[],this.id="session"+ ++k.$uid,this.$foldData.toString=function(){return this.join(`
`)},this.bgTokenizer=new E(new _().getTokenizer(),this);var U=this;this.bgTokenizer.on("update",function(z){U._signal("tokenizerUpdate",z)}),this.on("changeFold",this.onChangeFold.bind(this)),this.$onChange=this.onChange.bind(this),typeof B=="object"&&B.getLine||(B=new T(B)),this.setDocument(B),this.selection=new v(this),this.$bidiHandler=new y(this),x.resetOptions(this),this.setMode(j),x._signal("session",this),this.destroyed=!1}P.$uid=0,P.prototype.$modes=x.$modes,P.prototype.getValue=P.prototype.toString,P.prototype.$defaultUndoManager={undo:function(){},redo:function(){},hasUndo:function(){},hasRedo:function(){},reset:function(){},add:function(){},addSelection:function(){},startNewGroup:function(){},addSession:function(){}},P.prototype.$overwrite=!1,P.prototype.$mode=null,P.prototype.$modeId=null,P.prototype.$scrollTop=0,P.prototype.$scrollLeft=0,P.prototype.$wrapLimit=80,P.prototype.$useWrapMode=!1,P.prototype.$wrapLimitRange={min:null,max:null},P.prototype.lineWidgets=null,P.prototype.isFullWidth=O,g.implement(P.prototype,A);var L=1,R=2,N=3,F=4,H=9,V=10,q=11,Q=12;function O(B){return!(B<4352)&&(4352<=B&&B<=4447||4515<=B&&B<=4519||4602<=B&&B<=4607||9001<=B&&B<=9002||11904<=B&&B<=11929||11931<=B&&B<=12019||12032<=B&&B<=12245||12272<=B&&B<=12283||12288<=B&&B<=12350||12353<=B&&B<=12438||12441<=B&&B<=12543||12549<=B&&B<=12589||12593<=B&&B<=12686||12688<=B&&B<=12730||12736<=B&&B<=12771||12784<=B&&B<=12830||12832<=B&&B<=12871||12880<=B&&B<=13054||13056<=B&&B<=19903||19968<=B&&B<=42124||42128<=B&&B<=42182||43360<=B&&B<=43388||44032<=B&&B<=55203||55216<=B&&B<=55238||55243<=B&&B<=55291||63744<=B&&B<=64255||65040<=B&&B<=65049||65072<=B&&B<=65106||65108<=B&&B<=65126||65128<=B&&B<=65131||65281<=B&&B<=65376||65504<=B&&B<=65510)}h("./edit_session/folding").Folding.call(P.prototype),h("./edit_session/bracket_match").BracketMatch.call(P.prototype),x.defineOptions(P.prototype,"session",{wrap:{set:function(B){B&&B!="off"?B=="free"?B=!0:B=="printMargin"?B=-1:typeof B=="string"&&(B=parseInt(B,10)||!1):B=!1,this.$wrap!=B&&((this.$wrap=B)?(this.setWrapLimitRange(B=typeof B=="number"?B:null,B),this.setUseWrapMode(!0)):this.setUseWrapMode(!1))},get:function(){return this.getUseWrapMode()?this.$wrap==-1?"printMargin":this.getWrapLimitRange().min?this.$wrap:"free":"off"},handlesSet:!0},wrapMethod:{set:function(B){(B=B=="auto"?this.$mode.type!="text":B!="text")!=this.$wrapAsCode&&(this.$wrapAsCode=B,this.$useWrapMode)&&(this.$useWrapMode=!1,this.setUseWrapMode(!0))},initialValue:"auto"},indentedSoftWrap:{set:function(){this.$useWrapMode&&(this.$useWrapMode=!1,this.setUseWrapMode(!0))},initialValue:!0},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(B){this.$useWorker=B,this.$stopWorker(),B&&this.$startWorker()},initialValue:!0},useSoftTabs:{initialValue:!0},tabSize:{set:function(B){0<(B=parseInt(B))&&this.$tabSize!==B&&(this.$modified=!0,this.$rowLengthCache=[],this.$tabSize=B,this._signal("changeTabSize"))},initialValue:4,handlesSet:!0},navigateWithinSoftTabs:{initialValue:!1},foldStyle:{set:function(B){this.setFoldStyle(B)},handlesSet:!0},overwrite:{set:function(B){this._signal("changeOverwrite")},initialValue:!1},newLineMode:{set:function(B){this.doc.setNewLineMode(B)},get:function(){return this.doc.getNewLineMode()},handlesSet:!0},mode:{set:function(B){this.setMode(B)},get:function(){return this.$modeId},handlesSet:!0}}),f.EditSession=P}),ace.define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],function(h,f,C){"use strict";var g=h("./lib/lang"),b=h("./lib/oop"),y=h("./range").Range;function x(){this.$options={}}x.prototype.set=function(A){return b.mixin(this.$options,A),this},x.prototype.getOptions=function(){return g.copyObject(this.$options)},x.prototype.setOptions=function(A){this.$options=A},x.prototype.find=function(I){var v,_=this.$options,I=this.$matchIterator(I,_);return!!I&&(v=null,I.forEach(function(T,E,w,S){return v=new y(T,E,w,S),!(E==S&&_.start&&_.start.start&&_.skipCurrent!=0&&v.isEqual(_.start)&&(v=null,1))}),v)},x.prototype.findAll=function(A){var v=this.$options;if(!v.needle)return[];this.$assembleRegExp(v);var _=v.range,I=_?A.getLines(_.start.row,_.end.row):A.doc.getAllLines(),T=[],E=v.re;if(v.$isMultiLine){var w,S=E.length,P=I.length-S;e:for(var k=E.offset||0;k<=P;k++){for(var L=0;L<S;L++)if(I[k+L].search(E[L])==-1)continue e;var R=I[k],N=I[k+S-1],R=R.length-R.match(E[0])[0].length,N=N.match(E[S-1])[0].length;w&&w.end.row===k&&w.end.column>R||(T.push(w=new y(k,R,k+S-1,N)),2<S&&(k=k+S-2))}}else for(var F=0;F<I.length;F++)for(var H=g.getMatchOffsets(I[F],E),L=0;L<H.length;L++){var V=H[L];T.push(new y(F,V.offset,F,V.offset+V.length))}if(_){for(var q=_.start.column,Q=_.end.column,F=0,L=T.length-1;F<L&&T[F].start.column<q&&T[F].start.row==0;)F++;for(var O=_.end.row-_.start.row;F<L&&T[L].end.column>Q&&T[L].end.row==O;)L--;for(T=T.slice(F,L+1),F=0,L=T.length;F<L;F++)T[F].start.row+=_.start.row,T[F].end.row+=_.start.row}return T},x.prototype.replace=function(A,v){var _=this.$options,I=this.$assembleRegExp(_);if(_.$isMultiLine)return v;if(I){var T=I.exec(A);if(!T||T[0].length!=A.length)return null;if(_.regExp||(v=v.replace(/\$/g,"$$$$")),v=A.replace(I,v),_.preserveCase){v=v.split("");for(var E=Math.min(A.length,A.length);E--;){var w=A[E];w&&w.toLowerCase()!=w?v[E]=v[E].toUpperCase():v[E]=v[E].toLowerCase()}v=v.join("")}return v}},x.prototype.$assembleRegExp=function(A,v){if(A.needle instanceof RegExp)return A.re=A.needle;var _=A.needle;if(!A.needle)return A.re=!1;A.regExp||(_=g.escapeRegExp(_));var I,T,E,w,S,P=A.caseSensitive?"gm":"gmi";try{new RegExp(_,"u"),A.$supportsUnicodeFlag=!0,P+="u"}catch{A.$supportsUnicodeFlag=!1}function k(R,N){return N===void 0&&(N=!0),(E&&T.$supportsUnicodeFlag?new RegExp("[\\p{L}\\p{N}_]","u"):new RegExp("\\w")).test(R)||T.regExp?E&&T.$supportsUnicodeFlag?N?"(?<=^|[^\\p{L}\\p{N}_])":"(?=[^\\p{L}\\p{N}_]|$)":"\\b":""}if(A.wholeWord&&(I=_,T=A,E=g.supportsLookbehind(),w=Array.from(I),S=w[0],w=w[w.length-1],_=k(S)+I+k(w,!1)),A.$isMultiLine=!v&&/[\n\r]/.test(_),A.$isMultiLine)return A.re=this.$assembleMultilineRegExp(_,P);try{var L=new RegExp(_,P)}catch{L=!1}return A.re=L},x.prototype.$assembleMultilineRegExp=function(A,v){for(var _=A.replace(/\r\n|\r|\n/g,`$
^`).split(`
`),I=[],T=0;T<_.length;T++)try{I.push(new RegExp(_[T],v))}catch{return!1}return I},x.prototype.$matchIterator=function(A,v){var _,I,T,E,w,S,P,k,L,R=this.$assembleRegExp(v);return!!R&&(_=v.backwards==1,I=v.skipCurrent!=0,T=R.unicode,E=v.range,(w=(w=v.start)||(E?E[_?"end":"start"]:A.selection.getRange())).start&&(w=w[I!=_?"end":"start"]),S=E?E.start.row:0,P=E?E.end.row:A.getLength()-1,L=v.$isMultiLine?(k=R.length,function(N,F,H){var V=_?N-k+1:N;if(!(V<0||V+k>A.getLength())){var q=A.getLine(V),N=q.search(R[0]);if(!(!_&&N<F||N===-1)){for(var Q=1;Q<k;Q++)if((q=A.getLine(V+Q)).search(R[Q])==-1)return;var O=q.match(R[k-1])[0].length;if(!(_&&F<O))return!!H(V,N,V+k-1,O)||void 0}}}):_?function(N,F,H){var V,q=A.getLine(N),Q=[];for(R.lastIndex=0;V=R.exec(q);){var O=V[0].length,B=V.index;if(!O){if(B>=q.length)break;R.lastIndex=B+=g.skipEmptyMatch(q,B,T)}if(V.index+O>F)break;Q.push(V.index,O)}for(var j=Q.length-1;0<=j;j-=2){var U=Q[j-1];if(H(N,U,N,U+(O=Q[j])))return!0}}:function(N,F,H){var V=A.getLine(N);for(R.lastIndex=F;q=R.exec(V);){var q,Q=q[0].length;if(H(N,q=q.index,N,q+Q))return!0;if(!Q&&(R.lastIndex=q+=g.skipEmptyMatch(V,q,T),q>=V.length))return!1}},{forEach:_?function(N){var F=w.row;if(!L(F,w.column,N)){for(F--;S<=F;F--)if(L(F,Number.MAX_VALUE,N))return;if(v.wrap!=0){for(F=P,S=w.row;S<=F;F--)if(L(F,Number.MAX_VALUE,N))return}}}:function(N){var F=w.row;if(!L(F,w.column,N)){for(F+=1;F<=P;F++)if(L(F,0,N))return;if(v.wrap!=0){for(F=S,P=w.row;F<=P;F++)if(L(F,0,N))return}}}})},f.Search=x}),ace.define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],function(E,f,C){"use strict";var g,b=this&&this.__extends||(g=function(S,P){return(g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(k,L){k.__proto__=L}:function(k,L){for(var R in L)Object.prototype.hasOwnProperty.call(L,R)&&(k[R]=L[R])}))(S,P)},function(S,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function k(){this.constructor=S}g(S,P),S.prototype=P===null?Object.create(P):(k.prototype=P.prototype,new k)}),y=E("../lib/keys"),x=E("../lib/useragent"),A=y.KEY_MODS,v=(_.prototype.$init=function(S,P,k){this.platform=P||(x.isMac?"mac":"win"),this.commands={},this.commandKeyBinding={},this.addCommands(S),this.$singleCommand=k},_.prototype.addCommand=function(S){this.commands[S.name]&&this.removeCommand(S),(this.commands[S.name]=S).bindKey&&this._buildKeyHash(S)},_.prototype.removeCommand=function(S,P){var k,L=S&&(typeof S=="string"?S:S.name),R=(S=this.commands[L],P||delete this.commands[L],this.commandKeyBinding);for(k in R){var N,F=R[k];F==S?delete R[k]:Array.isArray(F)&&(N=F.indexOf(S))!=-1&&(F.splice(N,1),F.length==1)&&(R[k]=F[0])}},_.prototype.bindKey=function(S,P,k){if(typeof S=="object"&&S&&(k==null&&(k=S.position),S=S[this.platform]),S)return typeof P=="function"?this.addCommand({exec:P,bindKey:S,name:P.name||S}):void S.split("|").forEach(function(F){var R="",N=(F.indexOf(" ")!=-1&&(F=(N=F.split(/\s+/)).pop(),N.forEach(function(H){H=this.parseKeys(H),H=A[H.hashId]+H.key,R+=(R?" ":"")+H,this._addCommandToBinding(R,"chainKeys")},this),R+=" "),this.parseKeys(F)),F=A[N.hashId]+N.key;this._addCommandToBinding(R+F,P,k)},this)},_.prototype._addCommandToBinding=function(S,P,k){var L=this.commandKeyBinding;if(P)if(!L[S]||this.$singleCommand)L[S]=P;else{Array.isArray(L[S])?(N=L[S].indexOf(P))!=-1&&L[S].splice(N,1):L[S]=[L[S]],typeof k!="number"&&(k=I(P));for(var R=L[S],N=0;N<R.length&&!(k<I(R[N]));N++);R.splice(N,0,P)}else delete L[S]},_.prototype.addCommands=function(S){S&&Object.keys(S).forEach(function(P){var k=S[P];if(k){if(typeof k=="string")return this.bindKey(k,P);typeof(k=typeof k=="function"?{exec:k}:k)=="object"&&(k.name||(k.name=P),this.addCommand(k))}},this)},_.prototype.removeCommands=function(S){Object.keys(S).forEach(function(P){this.removeCommand(S[P])},this)},_.prototype.bindKeys=function(S){Object.keys(S).forEach(function(P){this.bindKey(P,S[P])},this)},_.prototype._buildKeyHash=function(S){this.bindKey(S.bindKey,S)},_.prototype.parseKeys=function(S){var P=S.toLowerCase().split(/[\-\+]([\-\+])?/).filter(function(H){return H}),k=P.pop(),L=y[k];if(y.FUNCTION_KEYS[L])k=y.FUNCTION_KEYS[L].toLowerCase();else{if(!P.length)return{key:k,hashId:-1};if(P.length==1&&P[0]=="shift")return{key:k.toUpperCase(),hashId:-1}}for(var R=0,N=P.length;N--;){var F=y.KEY_MODS[P[N]];if(F==null)return typeof console<"u",!1;R|=F}return{key:k,hashId:R}},_.prototype.findKeyCommand=function(S,P){return S=A[S]+P,this.commandKeyBinding[S]},_.prototype.handleKeyboard=function(S,P,k,L){var R,N;if(!(L<0))return R=A[P]+k,N=this.commandKeyBinding[R],S.$keyChain&&(S.$keyChain+=" "+R,N=this.commandKeyBinding[S.$keyChain]||N),!N||N!="chainKeys"&&N[N.length-1]!="chainKeys"?(S.$keyChain&&(P&&P!=4||k.length!=1?(P==-1||0<L)&&(S.$keyChain=""):S.$keyChain=S.$keyChain.slice(0,-R.length-1)),{command:N}):(S.$keyChain=S.$keyChain||R,{command:"null"})},_.prototype.getStatusText=function(S,P){return P.$keyChain||""},_);function _(S,P){this.$init(S,P,!1)}function I(S){return typeof S=="object"&&S.bindKey&&S.bindKey.position||(S.isDefault?-100:0)}b(w,T=v);var T,E=w;function w(S,P){return S=T.call(this,S,P)||this,S.$singleCommand=!0,S}E.call=function(S,P,k){v.prototype.$init.call(S,P,k,!0)},v.call=function(S,P,k){v.prototype.$init.call(S,P,k,!1)},f.HashHandler=E,f.MultiHashHandler=v}),ace.define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"],function(A,f,C){"use strict";var g,b,v=this&&this.__extends||(g=function(I,T){return(g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(E,w){E.__proto__=w}:function(E,w){for(var S in w)Object.prototype.hasOwnProperty.call(w,S)&&(E[S]=w[S])}))(I,T)},function(I,T){if(typeof T!="function"&&T!==null)throw new TypeError("Class extends value "+String(T)+" is not a constructor or null");function E(){this.constructor=I}g(I,T),I.prototype=T===null?Object.create(T):(E.prototype=T.prototype,new E)}),y=A("../lib/oop"),x=A("../keyboard/hash_handler").MultiHashHandler,A=A("../lib/event_emitter").EventEmitter,v=(v(_,b=x),_.prototype.exec=function(I,T,E){if(Array.isArray(I)){for(var w=I.length;w--;)if(this.exec(I[w],T,E))return!0;return!1}var S;return!!(I=typeof I=="string"?this.commands[I]:I)&&!(T&&T.$readOnly&&!I.readOnly||this.$checkCommandState!=0&&I.isAvailable&&!I.isAvailable(T)||((S={editor:T,command:I,args:E}).returnValue=this._emit("exec",S),this._signal("afterExec",S),S.returnValue===!1))},_.prototype.toggleRecording=function(I){if(!this.$inReplay)return I&&I._emit("changeStatus"),this.recording?(this.macro.pop(),this.off("exec",this.$addCommandToMacro),this.macro.length||(this.macro=this.oldMacro),this.recording=!1):(this.$addCommandToMacro||(this.$addCommandToMacro=(function(T){this.macro.push([T.command,T.args])}).bind(this)),this.oldMacro=this.macro,this.macro=[],this.on("exec",this.$addCommandToMacro),this.recording=!0)},_.prototype.replay=function(I){if(!this.$inReplay&&this.macro){if(this.recording)return this.toggleRecording(I);try{this.$inReplay=!0,this.macro.forEach(function(T){typeof T=="string"?this.exec(T,I):this.exec(T[0],I,T[1])},this)}finally{this.$inReplay=!1}}},_.prototype.trimMacro=function(I){return I.map(function(T){return typeof T[0]!="string"&&(T[0]=T[0].name),T=T[1]?T:T[0]})},_);function _(I,T){return T=b.call(this,T,I)||this,T.byName=T.commands,T.setDefaultHandler("exec",function(E){return E.args?E.command.exec(E.editor,E.args,E.event,!1):E.command.exec(E.editor,{},E.event,!0)}),T}y.implement(v.prototype,A),f.CommandManager=v}),ace.define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config","ace/range"],function(h,f,C){"use strict";var g=h("../lib/lang"),b=h("../config"),y=h("../range").Range;function x(v,_){return{win:v,mac:_}}f.commands=[{name:"showSettingsMenu",description:"Show settings menu",bindKey:x("Ctrl-,","Command-,"),exec:function(v){b.loadModule("ace/ext/settings_menu",function(_){_.init(v),v.showSettingsMenu()})},readOnly:!0},{name:"goToNextError",description:"Go to next error",bindKey:x("Alt-E","F4"),exec:function(v){b.loadModule("ace/ext/error_marker",function(_){_.showErrorMarker(v,1)})},scrollIntoView:"animate",readOnly:!0},{name:"goToPreviousError",description:"Go to previous error",bindKey:x("Alt-Shift-E","Shift-F4"),exec:function(v){b.loadModule("ace/ext/error_marker",function(_){_.showErrorMarker(v,-1)})},scrollIntoView:"animate",readOnly:!0},{name:"selectall",description:"Select all",bindKey:x("Ctrl-A","Command-A"),exec:function(v){v.selectAll()},readOnly:!0},{name:"centerselection",description:"Center selection",bindKey:x(null,"Ctrl-L"),exec:function(v){v.centerSelection()},readOnly:!0},{name:"gotoline",description:"Go to line...",bindKey:x("Ctrl-L","Command-L"),exec:function(v,_){typeof _!="number"||isNaN(_)||v.gotoLine(_),v.prompt({$type:"gotoLine"})},readOnly:!0},{name:"fold",bindKey:x("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(v){v.session.toggleFold(!1)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"unfold",bindKey:x("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(v){v.session.toggleFold(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleFoldWidget",description:"Toggle fold widget",bindKey:x("F2","F2"),exec:function(v){v.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"toggleParentFoldWidget",description:"Toggle parent fold widget",bindKey:x("Alt-F2","Alt-F2"),exec:function(v){v.session.toggleFoldWidget(!0)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"foldall",description:"Fold all",bindKey:x(null,"Ctrl-Command-Option-0"),exec:function(v){v.session.foldAll()},scrollIntoView:"center",readOnly:!0},{name:"foldAllComments",description:"Fold all comments",bindKey:x(null,"Ctrl-Command-Option-0"),exec:function(v){v.session.foldAllComments()},scrollIntoView:"center",readOnly:!0},{name:"foldOther",description:"Fold other",bindKey:x("Alt-0","Command-Option-0"),exec:function(v){v.session.foldAll(),v.session.unfold(v.selection.getAllRanges())},scrollIntoView:"center",readOnly:!0},{name:"unfoldall",description:"Unfold all",bindKey:x("Alt-Shift-0","Command-Option-Shift-0"),exec:function(v){v.session.unfold()},scrollIntoView:"center",readOnly:!0},{name:"findnext",description:"Find next",bindKey:x("Ctrl-K","Command-G"),exec:function(v){v.findNext()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"findprevious",description:"Find previous",bindKey:x("Ctrl-Shift-K","Command-Shift-G"),exec:function(v){v.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:!0},{name:"selectOrFindNext",description:"Select or find next",bindKey:x("Alt-K","Ctrl-G"),exec:function(v){v.selection.isEmpty()?v.selection.selectWord():v.findNext()},readOnly:!0},{name:"selectOrFindPrevious",description:"Select or find previous",bindKey:x("Alt-Shift-K","Ctrl-Shift-G"),exec:function(v){v.selection.isEmpty()?v.selection.selectWord():v.findPrevious()},readOnly:!0},{name:"find",description:"Find",bindKey:x("Ctrl-F","Command-F"),exec:function(v){b.loadModule("ace/ext/searchbox",function(_){_.Search(v)})},readOnly:!0},{name:"overwrite",description:"Overwrite",bindKey:"Insert",exec:function(v){v.toggleOverwrite()},readOnly:!0},{name:"selecttostart",description:"Select to start",bindKey:x("Ctrl-Shift-Home","Command-Shift-Home|Command-Shift-Up"),exec:function(v){v.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",description:"Go to start",bindKey:x("Ctrl-Home","Command-Home|Command-Up"),exec:function(v){v.navigateFileStart()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",description:"Select up",bindKey:x("Shift-Up","Shift-Up|Ctrl-Shift-P"),exec:function(v){v.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golineup",description:"Go line up",bindKey:x("Up","Up|Ctrl-P"),exec:function(v,_){v.navigateUp(_.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttoend",description:"Select to end",bindKey:x("Ctrl-Shift-End","Command-Shift-End|Command-Shift-Down"),exec:function(v){v.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",description:"Go to end",bindKey:x("Ctrl-End","Command-End|Command-Down"),exec:function(v){v.navigateFileEnd()},multiSelectAction:"forEach",readOnly:!0,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",description:"Select down",bindKey:x("Shift-Down","Shift-Down|Ctrl-Shift-N"),exec:function(v){v.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"golinedown",description:"Go line down",bindKey:x("Down","Down|Ctrl-N"),exec:function(v,_){v.navigateDown(_.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordleft",description:"Select word left",bindKey:x("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(v){v.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordleft",description:"Go to word left",bindKey:x("Ctrl-Left","Option-Left"),exec:function(v){v.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolinestart",description:"Select to line start",bindKey:x("Alt-Shift-Left","Command-Shift-Left|Ctrl-Shift-A"),exec:function(v){v.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolinestart",description:"Go to line start",bindKey:x("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(v){v.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectleft",description:"Select left",bindKey:x("Shift-Left","Shift-Left|Ctrl-Shift-B"),exec:function(v){v.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoleft",description:"Go to left",bindKey:x("Left","Left|Ctrl-B"),exec:function(v,_){v.navigateLeft(_.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectwordright",description:"Select word right",bindKey:x("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(v){v.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotowordright",description:"Go to word right",bindKey:x("Ctrl-Right","Option-Right"),exec:function(v){v.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selecttolineend",description:"Select to line end",bindKey:x("Alt-Shift-Right","Command-Shift-Right|Shift-End|Ctrl-Shift-E"),exec:function(v){v.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotolineend",description:"Go to line end",bindKey:x("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(v){v.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectright",description:"Select right",bindKey:x("Shift-Right","Shift-Right"),exec:function(v){v.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"gotoright",description:"Go to right",bindKey:x("Right","Right|Ctrl-F"),exec:function(v,_){v.navigateRight(_.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectpagedown",description:"Select page down",bindKey:"Shift-PageDown",exec:function(v){v.selectPageDown()},readOnly:!0},{name:"pagedown",description:"Page down",bindKey:x(null,"Option-PageDown"),exec:function(v){v.scrollPageDown()},readOnly:!0},{name:"gotopagedown",description:"Go to page down",bindKey:x("PageDown","PageDown|Ctrl-V"),exec:function(v){v.gotoPageDown()},readOnly:!0},{name:"selectpageup",description:"Select page up",bindKey:"Shift-PageUp",exec:function(v){v.selectPageUp()},readOnly:!0},{name:"pageup",description:"Page up",bindKey:x(null,"Option-PageUp"),exec:function(v){v.scrollPageUp()},readOnly:!0},{name:"gotopageup",description:"Go to page up",bindKey:"PageUp",exec:function(v){v.gotoPageUp()},readOnly:!0},{name:"scrollup",description:"Scroll up",bindKey:x("Ctrl-Up",null),exec:function(v){v.renderer.scrollBy(0,-2*v.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"scrolldown",description:"Scroll down",bindKey:x("Ctrl-Down",null),exec:function(v){v.renderer.scrollBy(0,2*v.renderer.layerConfig.lineHeight)},readOnly:!0},{name:"selectlinestart",description:"Select line start",bindKey:"Shift-Home",exec:function(v){v.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"selectlineend",description:"Select line end",bindKey:"Shift-End",exec:function(v){v.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"togglerecording",description:"Toggle recording",bindKey:x("Ctrl-Alt-E","Command-Option-E"),exec:function(v){v.commands.toggleRecording(v)},readOnly:!0},{name:"replaymacro",description:"Replay macro",bindKey:x("Ctrl-Shift-E","Command-Shift-E"),exec:function(v){v.commands.replay(v)},readOnly:!0},{name:"jumptomatching",description:"Jump to matching",bindKey:x("Ctrl-\\|Ctrl-P","Command-\\"),exec:function(v){v.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"selecttomatching",description:"Select to matching",bindKey:x("Ctrl-Shift-\\|Ctrl-Shift-P","Command-Shift-\\"),exec:function(v){v.jumpToMatching(!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"expandToMatching",description:"Expand to matching",bindKey:x("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(v){v.jumpToMatching(!0,!0)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:!0},{name:"passKeysToBrowser",description:"Pass keys to browser",bindKey:x(null,null),exec:function(){},passEvent:!0,readOnly:!0},{name:"copy",description:"Copy",exec:function(v){},readOnly:!0},{name:"cut",description:"Cut",exec:function(v){var _=v.$copyWithEmptySelection&&v.selection.isEmpty()?v.selection.getLineRange():v.selection.getRange();v._emit("cut",_),_.isEmpty()||v.session.remove(_),v.clearSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",description:"Paste",exec:function(v,_){v.$handlePaste(_)},scrollIntoView:"cursor"},{name:"removeline",description:"Remove line",bindKey:x("Ctrl-D","Command-D"),exec:function(v){v.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",description:"Duplicate selection",bindKey:x("Ctrl-Shift-D","Command-Shift-D"),exec:function(v){v.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",description:"Sort lines",bindKey:x("Ctrl-Alt-S","Command-Alt-S"),exec:function(v){v.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",description:"Toggle comment",bindKey:x("Ctrl-/","Command-/"),exec:function(v){v.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",description:"Toggle block comment",bindKey:x("Ctrl-Shift-/","Command-Shift-/"),exec:function(v){v.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",description:"Modify number up",bindKey:x("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(v){v.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",description:"Modify number down",bindKey:x("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(v){v.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",description:"Replace",bindKey:x("Ctrl-H","Command-Option-F"),exec:function(v){b.loadModule("ace/ext/searchbox",function(_){_.Search(v,!0)})}},{name:"undo",description:"Undo",bindKey:x("Ctrl-Z","Command-Z"),exec:function(v){v.undo()}},{name:"redo",description:"Redo",bindKey:x("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(v){v.redo()}},{name:"copylinesup",description:"Copy lines up",bindKey:x("Alt-Shift-Up","Command-Option-Up"),exec:function(v){v.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",description:"Move lines up",bindKey:x("Alt-Up","Option-Up"),exec:function(v){v.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",description:"Copy lines down",bindKey:x("Alt-Shift-Down","Command-Option-Down"),exec:function(v){v.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",description:"Move lines down",bindKey:x("Alt-Down","Option-Down"),exec:function(v){v.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",description:"Delete",bindKey:x("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(v){v.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",description:"Backspace",bindKey:x("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(v){v.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",description:"Cut or delete",bindKey:x("Shift-Delete",null),exec:function(v){if(!v.selection.isEmpty())return!1;v.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",description:"Remove to line start",bindKey:x("Alt-Backspace","Command-Backspace"),exec:function(v){v.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",description:"Remove to line end",bindKey:x("Alt-Delete","Ctrl-K|Command-Delete"),exec:function(v){v.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestarthard",description:"Remove to line start hard",bindKey:x("Ctrl-Shift-Backspace",null),exec:function(v){var _=v.selection.getRange();_.start.column=0,v.session.remove(_)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineendhard",description:"Remove to line end hard",bindKey:x("Ctrl-Shift-Delete",null),exec:function(v){var _=v.selection.getRange();_.end.column=Number.MAX_VALUE,v.session.remove(_)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",description:"Remove word left",bindKey:x("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(v){v.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",description:"Remove word right",bindKey:x("Ctrl-Delete","Alt-Delete"),exec:function(v){v.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",description:"Outdent",bindKey:x("Shift-Tab","Shift-Tab"),exec:function(v){v.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",description:"Indent",bindKey:x("Tab","Tab"),exec:function(v){v.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",description:"Block outdent",bindKey:x("Ctrl-[","Ctrl-["),exec:function(v){v.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",description:"Block indent",bindKey:x("Ctrl-]","Ctrl-]"),exec:function(v){v.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",description:"Insert string",exec:function(v,_){v.insert(_)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",description:"Insert text",exec:function(v,_){v.insert(g.stringRepeat(_.text||"",_.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",description:"Split line",bindKey:x(null,"Ctrl-O"),exec:function(v){v.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",description:"Transpose letters",bindKey:x("Alt-Shift-X","Ctrl-T"),exec:function(v){v.transposeLetters()},multiSelectAction:function(v){v.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",description:"To uppercase",bindKey:x("Ctrl-U","Ctrl-U"),exec:function(v){v.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",description:"To lowercase",bindKey:x("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(v){v.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"autoindent",description:"Auto Indent",bindKey:x(null,null),exec:function(v){v.autoIndent()},scrollIntoView:"animate"},{name:"expandtoline",description:"Expand to line",bindKey:x("Ctrl-Shift-L","Command-Shift-L"),exec:function(v){var _=v.selection.getRange();_.start.column=_.end.column=0,_.end.row++,v.selection.setRange(_,!1)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:!0},{name:"openlink",bindKey:x("Ctrl+F3","F3"),exec:function(v){v.openLink()}},{name:"joinlines",description:"Join lines",bindKey:x(null,null),exec:function(v){for(var T=v.selection.isBackwards(),_=T?v.selection.getSelectionLead():v.selection.getSelectionAnchor(),I=T?v.selection.getSelectionAnchor():v.selection.getSelectionLead(),T=v.session.doc.getLine(_.row).length,E=v.session.doc.getTextRange(v.selection.getRange()).replace(/\n\s*/," ").length,w=v.session.doc.getLine(_.row),S=_.row+1;S<=I.row+1;S++){var P=g.stringTrimLeft(g.stringTrimRight(v.session.doc.getLine(S)));w+=P=P.length!==0?" "+P:P}I.row+1<v.session.doc.getLength()-1&&(w+=v.session.doc.getNewLineCharacter()),v.clearSelection(),v.session.doc.replace(new y(_.row,0,I.row+2,0),w),0<E?(v.selection.moveCursorTo(_.row,_.column),v.selection.selectTo(_.row,_.column+E)):(T=v.session.doc.getLine(_.row).length>T?T+1:T,v.selection.moveCursorTo(_.row,T))},multiSelectAction:"forEach",readOnly:!0},{name:"invertSelection",description:"Invert selection",bindKey:x(null,null),exec:function(v){var _=v.session.doc.getLength()-1,I=v.session.doc.getLine(_).length,T=v.selection.rangeList.ranges,E=[];T.length<1&&(T=[v.selection.getRange()]);for(var w=0;w<T.length;w++)w!=T.length-1||T[w].end.row===_&&T[w].end.column===I||E.push(new y(T[w].end.row,T[w].end.column,_,I)),w===0?T[w].start.row===0&&T[w].start.column===0||E.push(new y(0,0,T[w].start.row,T[w].start.column)):E.push(new y(T[w-1].end.row,T[w-1].end.column,T[w].start.row,T[w].start.column));for(v.exitMultiSelectMode(),v.clearSelection(),w=0;w<E.length;w++)v.selection.addRange(E[w],!1)},readOnly:!0,scrollIntoView:"none"},{name:"addLineAfter",description:"Add new line after the current line",exec:function(v){v.selection.clearSelection(),v.navigateLineEnd(),v.insert(`
`)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"addLineBefore",description:"Add new line before the current line",exec:function(v){v.selection.clearSelection();var _=v.getCursorPosition();v.selection.moveTo(_.row-1,Number.MAX_VALUE),v.insert(`
`),_.row===0&&v.navigateUp()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"openCommandPallete",exec:function(v){v.prompt({$type:"commands"})},readOnly:!0},{name:"openCommandPalette",description:"Open command palette",bindKey:x("F1","F1"),exec:function(v){v.prompt({$type:"commands"})},readOnly:!0},{name:"modeSelect",description:"Change language mode...",bindKey:x(null,null),exec:function(v){v.prompt({$type:"modes"})},readOnly:!0}];for(var A=1;A<9;A++)f.commands.push({name:"foldToLevel"+A,description:"Fold To Level "+A,level:A,exec:function(v){v.session.foldToLevel(this.level)},scrollIntoView:"center",readOnly:!0})}),ace.define("ace/line_widgets",["require","exports","module","ace/lib/dom"],function(h,f,C){"use strict";var g=h("./lib/dom");function b(y){this.session=y,(this.session.widgetManager=this).session.getRowLength=this.getRowLength,this.session.$getWidgetScreenLength=this.$getWidgetScreenLength,this.updateOnChange=this.updateOnChange.bind(this),this.renderWidgets=this.renderWidgets.bind(this),this.measureWidgets=this.measureWidgets.bind(this),this.session._changedWidgets=[],this.$onChangeEditor=this.$onChangeEditor.bind(this),this.session.on("change",this.updateOnChange),this.session.on("changeFold",this.updateOnFold),this.session.on("changeEditor",this.$onChangeEditor)}b.prototype.getRowLength=function(y){var x=this.lineWidgets&&this.lineWidgets[y]&&this.lineWidgets[y].rowCount||0;return this.$useWrapMode&&this.$wrapData[y]?this.$wrapData[y].length+1+x:1+x},b.prototype.$getWidgetScreenLength=function(){var y=0;return this.lineWidgets.forEach(function(x){x&&x.rowCount&&!x.hidden&&(y+=x.rowCount)}),y},b.prototype.$onChangeEditor=function(y){this.attach(y.editor)},b.prototype.attach=function(y){y&&y.widgetManager&&y.widgetManager!=this&&y.widgetManager.detach(),this.editor!=y&&(this.detach(),this.editor=y)&&(y.widgetManager=this,y.renderer.on("beforeRender",this.measureWidgets),y.renderer.on("afterRender",this.renderWidgets))},b.prototype.detach=function(y){var x=this.editor;x&&(this.editor=null,x.widgetManager=null,x.renderer.off("beforeRender",this.measureWidgets),x.renderer.off("afterRender",this.renderWidgets),x=this.session.lineWidgets)&&x.forEach(function(A){A&&A.el&&A.el.parentNode&&(A._inDocument=!1,A.el.parentNode.removeChild(A.el))})},b.prototype.updateOnFold=function(y,x){var A=x.lineWidgets;if(A&&y.action){for(var x=y.data,v=x.start.row,_=x.end.row,I=y.action=="add",T=v+1;T<_;T++)A[T]&&(A[T].hidden=I);A[_]&&(I?A[v]?A[_].hidden=I:A[v]=A[_]:(A[v]==A[_]&&(A[v]=void 0),A[_].hidden=I))}},b.prototype.updateOnChange=function(y){var x,A,v,_=this.session.lineWidgets;_&&(x=y.start.row,(A=y.end.row-x)!=0)&&(y.action=="remove"?(v=_.splice(x+1,A),!_[x]&&v[v.length-1]&&(_[x]=v.pop()),v.forEach(function(I){I&&this.removeLineWidget(I)},this)):(v=new Array(A),_[x]&&_[x].column!=null&&y.start.column>_[x].column&&x++,v.unshift(x,0),_.splice.apply(_,v)),this.$updateRows())},b.prototype.$updateRows=function(){var y,x=this.session.lineWidgets;x&&(y=!0,x.forEach(function(A,v){if(A)for(y=!1,A.row=v;A.$oldWidget;)A.$oldWidget.row=v,A=A.$oldWidget}),y)&&(this.session.lineWidgets=null)},b.prototype.$registerLineWidget=function(y){this.session.lineWidgets||(this.session.lineWidgets=new Array(this.session.getLength()));var x=this.session.lineWidgets[y.row];return x&&(y.$oldWidget=x).el&&x.el.parentNode&&(x.el.parentNode.removeChild(x.el),x._inDocument=!1),this.session.lineWidgets[y.row]=y},b.prototype.addLineWidget=function(y){var x,A,v;return this.$registerLineWidget(y),y.session=this.session,this.editor&&(x=this.editor.renderer,y.html&&!y.el&&(y.el=g.createElement("div"),y.el.innerHTML=y.html),y.text&&!y.el&&(y.el=g.createElement("div"),y.el.textContent=y.text),y.el&&(g.addCssClass(y.el,"ace_lineWidgetContainer"),y.className&&g.addCssClass(y.el,y.className),y.el.style.position="absolute",y.el.style.zIndex="5",x.container.appendChild(y.el),y._inDocument=!0,y.coverGutter||(y.el.style.zIndex="3"),y.pixelHeight==null)&&(y.pixelHeight=y.el.offsetHeight),y.rowCount==null&&(y.rowCount=y.pixelHeight/x.layerConfig.lineHeight),A=this.session.getFoldAt(y.row,0),(y.$fold=A)&&(v=this.session.lineWidgets,y.row!=A.end.row||v[A.start.row]?y.hidden=!0:v[A.start.row]=y),this.session._emit("changeFold",{data:{start:{row:y.row}}}),this.$updateRows(),this.renderWidgets(null,x),this.onWidgetChanged(y)),y},b.prototype.removeLineWidget=function(y){if(y._inDocument=!1,y.session=null,y.el&&y.el.parentNode&&y.el.parentNode.removeChild(y.el),y.editor&&y.editor.destroy)try{y.editor.destroy()}catch{}if(this.session.lineWidgets){var x=this.session.lineWidgets[y.row];if(x==y)this.session.lineWidgets[y.row]=y.$oldWidget,y.$oldWidget&&this.onWidgetChanged(y.$oldWidget);else for(;x;){if(x.$oldWidget==y){x.$oldWidget=y.$oldWidget;break}x=x.$oldWidget}}this.session._emit("changeFold",{data:{start:{row:y.row}}}),this.$updateRows()},b.prototype.getWidgetsAtRow=function(y){for(var x=this.session.lineWidgets,A=x&&x[y],v=[];A;)v.push(A),A=A.$oldWidget;return v},b.prototype.onWidgetChanged=function(y){this.session._changedWidgets.push(y),this.editor&&this.editor.renderer.updateFull()},b.prototype.measureWidgets=function(y,x){var A=this.session._changedWidgets,v=x.layerConfig;if(A&&A.length){for(var _=1/0,I=0;I<A.length;I++){var T=A[I];if(T&&T.el&&T.session==this.session){if(!T._inDocument){if(this.session.lineWidgets[T.row]!=T)continue;T._inDocument=!0,x.container.appendChild(T.el)}T.h=T.el.offsetHeight,T.fixedWidth||(T.w=T.el.offsetWidth,T.screenWidth=Math.ceil(T.w/v.characterWidth));var E=T.h/v.lineHeight;T.coverLine&&(E-=this.session.getRowLineCount(T.row))<0&&(E=0),T.rowCount!=E&&(T.rowCount=E,T.row<_)&&(_=T.row)}}_!=1/0&&(this.session._emit("changeFold",{data:{start:{row:_}}}),this.session.lineWidgetWidth=null),this.session._changedWidgets=[]}},b.prototype.renderWidgets=function(y,x){var A=x.layerConfig,v=this.session.lineWidgets;if(v){for(var _=Math.min(this.firstRow,A.firstRow),I=Math.max(this.lastRow,A.lastRow,v.length);0<_&&!v[_];)_--;this.firstRow=A.firstRow,this.lastRow=A.lastRow,x.$cursorLayer.config=A;for(var T=_;T<=I;T++){var E,w=v[T];w&&w.el&&(w.hidden?w.el.style.top=-100-(w.pixelHeight||0)+"px":(w._inDocument||(w._inDocument=!0,x.container.appendChild(w.el)),E=x.$cursorLayer.getPixelPosition({row:T,column:0},!0).top,w.coverLine||(E+=A.lineHeight*this.session.getRowLineCount(w.row)),w.el.style.top=E-A.offset+"px",E=w.coverGutter?0:x.gutterWidth,w.fixedWidth||(E-=x.scrollLeft),w.el.style.left=E+"px",w.fullWidth&&w.screenWidth&&(w.el.style.minWidth=A.width+2*A.padding+"px"),w.fixedWidth?w.el.style.right=x.scrollBar.getWidth()+"px":w.el.style.right=""))}}},f.LineWidgets=b}),ace.define("ace/keyboard/gutter_handler",["require","exports","module","ace/lib/keys","ace/mouse/default_gutter_handler"],function(h,f,C){"use strict";var g=h("../lib/keys"),b=h("../mouse/default_gutter_handler").GutterTooltip;function y(v){this.editor=v,this.gutterLayer=v.renderer.$gutterLayer,this.element=v.renderer.$gutter,this.lines=v.renderer.$gutterLayer.$lines,this.activeRowIndex=null,this.activeLane=null,this.annotationTooltip=new b(this.editor)}y.prototype.addListener=function(){this.element.addEventListener("keydown",this.$onGutterKeyDown.bind(this)),this.element.addEventListener("focusout",this.$blurGutter.bind(this)),this.editor.on("mousewheel",this.$blurGutter.bind(this))},y.prototype.removeListener=function(){this.element.removeEventListener("keydown",this.$onGutterKeyDown.bind(this)),this.element.removeEventListener("focusout",this.$blurGutter.bind(this)),this.editor.off("mousewheel",this.$blurGutter.bind(this))},y.prototype.$onGutterKeyDown=function(v){var _;this.annotationTooltip.isOpen?(v.preventDefault(),v.keyCode===g.escape&&this.annotationTooltip.hideTooltip()):v.target===this.element?v.keyCode==g.enter&&(v.preventDefault(),_=this.editor.getCursorPosition().row,this.editor.isRowVisible(_)||this.editor.scrollToLine(_,!0,!0),setTimeout((function(){var I=this.$rowToRowIndex(this.gutterLayer.$cursorCell.row),T=this.$findNearestFoldWidget(I),E=this.$findNearestAnnotation(I);T===null&&E===null||(T===null&&E!==null||(T===null||E!==null)&&Math.abs(E-I)<Math.abs(T-I)?(this.activeRowIndex=E,this.activeLane="annotation",this.$focusAnnotation(this.activeRowIndex)):(this.activeRowIndex=T,this.activeLane="fold",this.$focusFoldWidget(this.activeRowIndex)))}).bind(this),10)):(this.$handleGutterKeyboardInteraction(v),setTimeout((function(){this.editor._signal("gutterkeydown",new x(v,this))}).bind(this),10))},y.prototype.$handleGutterKeyboardInteraction=function(v){if(v.keyCode===g.tab)v.preventDefault();else if(v.keyCode===g.escape)v.preventDefault(),this.$blurGutter(),this.element.focus(),this.lane=null;else if(v.keyCode===g.up)switch(v.preventDefault(),this.activeLane){case"fold":this.$moveFoldWidgetUp();break;case"annotation":this.$moveAnnotationUp()}else if(v.keyCode===g.down)switch(v.preventDefault(),this.activeLane){case"fold":this.$moveFoldWidgetDown();break;case"annotation":this.$moveAnnotationDown()}else if(v.keyCode===g.left)v.preventDefault(),this.$switchLane("annotation");else if(v.keyCode===g.right)v.preventDefault(),this.$switchLane("fold");else if(v.keyCode===g.enter||v.keyCode===g.space)switch(v.preventDefault(),this.activeLane){case"fold":if(this.gutterLayer.session.foldWidgets[this.$rowIndexToRow(this.activeRowIndex)]==="start"){var _=this.$rowIndexToRow(this.activeRowIndex);this.editor.session.onFoldWidgetClick(this.$rowIndexToRow(this.activeRowIndex),v),setTimeout((function(){this.$rowIndexToRow(this.activeRowIndex)!==_&&(this.$blurFoldWidget(this.activeRowIndex),this.activeRowIndex=this.$rowToRowIndex(_),this.$focusFoldWidget(this.activeRowIndex))}).bind(this),10);break}if(this.gutterLayer.session.foldWidgets[this.$rowIndexToRow(this.activeRowIndex)]==="end")break;return;case"annotation":var I=this.lines.cells[this.activeRowIndex].element.childNodes[2].getBoundingClientRect(),T=this.annotationTooltip.getElement().style;T.left=I.right+"px",T.top=I.bottom+"px",this.annotationTooltip.showTooltip(this.$rowIndexToRow(this.activeRowIndex))}},y.prototype.$blurGutter=function(){if(this.activeRowIndex!==null)switch(this.activeLane){case"fold":this.$blurFoldWidget(this.activeRowIndex);break;case"annotation":this.$blurAnnotation(this.activeRowIndex)}this.annotationTooltip.isOpen&&this.annotationTooltip.hideTooltip()},y.prototype.$isFoldWidgetVisible=function(I){var _=this.editor.isRowFullyVisible(this.$rowIndexToRow(I)),I=this.$getFoldWidget(I).style.display!=="none";return _&&I},y.prototype.$isAnnotationVisible=function(I){var _=this.editor.isRowFullyVisible(this.$rowIndexToRow(I)),I=this.$getAnnotation(I).style.display!=="none";return _&&I},y.prototype.$getFoldWidget=function(v){return this.lines.get(v).element.childNodes[1]},y.prototype.$getAnnotation=function(v){return this.lines.get(v).element.childNodes[2]},y.prototype.$findNearestFoldWidget=function(v){if(this.$isFoldWidgetVisible(v))return v;for(var _=0;0<v-_||v+_<this.lines.getLength()-1;){if(0<=v-++_&&this.$isFoldWidgetVisible(v-_))return v-_;if(v+_<=this.lines.getLength()-1&&this.$isFoldWidgetVisible(v+_))return v+_}return null},y.prototype.$findNearestAnnotation=function(v){if(this.$isAnnotationVisible(v))return v;for(var _=0;0<v-_||v+_<this.lines.getLength()-1;){if(0<=v-++_&&this.$isAnnotationVisible(v-_))return v-_;if(v+_<=this.lines.getLength()-1&&this.$isAnnotationVisible(v+_))return v+_}return null},y.prototype.$focusFoldWidget=function(v){v!=null&&((v=this.$getFoldWidget(v)).classList.add(this.editor.renderer.keyboardFocusClassName),v.focus())},y.prototype.$focusAnnotation=function(v){v!=null&&((v=this.$getAnnotation(v)).classList.add(this.editor.renderer.keyboardFocusClassName),v.focus())},y.prototype.$blurFoldWidget=function(v){v=this.$getFoldWidget(v),v.classList.remove(this.editor.renderer.keyboardFocusClassName),v.blur()},y.prototype.$blurAnnotation=function(v){v=this.$getAnnotation(v),v.classList.remove(this.editor.renderer.keyboardFocusClassName),v.blur()},y.prototype.$moveFoldWidgetUp=function(){for(var v=this.activeRowIndex;0<v;)if(this.$isFoldWidgetVisible(--v))return this.$blurFoldWidget(this.activeRowIndex),this.activeRowIndex=v,void this.$focusFoldWidget(this.activeRowIndex)},y.prototype.$moveFoldWidgetDown=function(){for(var v=this.activeRowIndex;v<this.lines.getLength()-1;)if(this.$isFoldWidgetVisible(++v))return this.$blurFoldWidget(this.activeRowIndex),this.activeRowIndex=v,void this.$focusFoldWidget(this.activeRowIndex)},y.prototype.$moveAnnotationUp=function(){for(var v=this.activeRowIndex;0<v;)if(this.$isAnnotationVisible(--v))return this.$blurAnnotation(this.activeRowIndex),this.activeRowIndex=v,void this.$focusAnnotation(this.activeRowIndex)},y.prototype.$moveAnnotationDown=function(){for(var v=this.activeRowIndex;v<this.lines.getLength()-1;)if(this.$isAnnotationVisible(++v))return this.$blurAnnotation(this.activeRowIndex),this.activeRowIndex=v,void this.$focusAnnotation(this.activeRowIndex)},y.prototype.$switchLane=function(v){switch(v){case"annotation":this.activeLane!=="annotation"&&(_=this.$findNearestAnnotation(this.activeRowIndex))!=null&&(this.activeLane="annotation",this.$blurFoldWidget(this.activeRowIndex),this.activeRowIndex=_,this.$focusAnnotation(this.activeRowIndex));break;case"fold":var _;this.activeLane!=="fold"&&(_=this.$findNearestFoldWidget(this.activeRowIndex))!=null&&(this.activeLane="fold",this.$blurAnnotation(this.activeRowIndex),this.activeRowIndex=_,this.$focusFoldWidget(this.activeRowIndex))}},y.prototype.$rowIndexToRow=function(v){return v=this.lines.get(v),v?v.row:null},y.prototype.$rowToRowIndex=function(v){for(var _=0;_<this.lines.getLength();_++)if(this.lines.get(_).row==v)return _;return null},f.GutterKeyboardHandler=y,A.prototype.getKey=function(){return g.keyCodeToString(this.domEvent.keyCode)},A.prototype.getRow=function(){return this.gutterKeyboardHandler.$rowIndexToRow(this.gutterKeyboardHandler.activeRowIndex)},A.prototype.isInAnnotationLane=function(){return this.gutterKeyboardHandler.activeLane==="annotation"},A.prototype.isInFoldLane=function(){return this.gutterKeyboardHandler.activeLane==="fold"};var x=A;function A(v,_){this.gutterKeyboardHandler=_,this.domEvent=v}f.GutterKeyboardEvent=x}),ace.define("ace/editor",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config","ace/token_iterator","ace/line_widgets","ace/keyboard/gutter_handler","ace/config","ace/clipboard","ace/lib/keys"],function(O,f,C){"use strict";var g=this&&this.__values||function(U){var z=typeof Symbol=="function"&&Symbol.iterator,$=z&&U[z],Z=0;if($)return $.call(U);if(U&&typeof U.length=="number")return{next:function(){return{value:(U=U&&Z>=U.length?void 0:U)&&U[Z++],done:!U}}};throw new TypeError(z?"Object is not iterable.":"Symbol.iterator is not defined.")},b=O("./lib/oop"),y=O("./lib/dom"),x=O("./lib/lang"),A=O("./lib/useragent"),v=O("./keyboard/textinput").TextInput,_=O("./mouse/mouse_handler").MouseHandler,I=O("./mouse/fold_handler").FoldHandler,T=O("./keyboard/keybinding").KeyBinding,E=O("./edit_session").EditSession,w=O("./search").Search,S=O("./range").Range,P=O("./lib/event_emitter").EventEmitter,k=O("./commands/command_manager").CommandManager,L=O("./commands/default_commands").commands,R=O("./config"),N=O("./token_iterator").TokenIterator,F=O("./line_widgets").LineWidgets,H=O("./keyboard/gutter_handler").GutterKeyboardHandler,V=O("./config").nls,q=O("./clipboard"),Q=O("./lib/keys"),O=(B.prototype.$initOperationListeners=function(){this.commands.on("exec",this.startOperation.bind(this),!0),this.commands.on("afterExec",this.endOperation.bind(this),!0),this.$opResetTimer=x.delayedCall(this.endOperation.bind(this,!0)),this.on("change",(function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.docChanged=!0}).bind(this),!0),this.on("changeSelection",(function(){this.curOp||(this.startOperation(),this.curOp.selectionBefore=this.$lastSel),this.curOp.selectionChanged=!0}).bind(this),!0)},B.prototype.startOperation=function(U){if(this.curOp){if(!U||this.curOp.command)return;this.prevOp=this.curOp}U||(this.previousCommand=null,U={}),this.$opResetTimer.schedule(),this.curOp=this.session.curOp={command:U.command||{},args:U.args,scrollTop:this.renderer.scrollTop},this.curOp.selectionBefore=this.selection.toJSON()},B.prototype.endOperation=function(U){if(this.curOp&&this.session){if(U&&U.returnValue===!1||!this.session)return this.curOp=null;if((U!=1||!this.curOp.command||this.curOp.command.name!="mouse")&&(this._signal("beforeEndOperation"),this.curOp)){var U=this.curOp.command,z=U&&U.scrollIntoView;if(z){switch(z){case"center-animate":z="animate";case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var $=this.selection.getRange(),Z=this.renderer.layerConfig;($.start.row>=Z.lastRow||$.end.row<=Z.firstRow)&&this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead)}z=="animate"&&this.renderer.animateScrolling(this.curOp.scrollTop)}U=this.selection.toJSON(),this.curOp.selectionAfter=U,this.$lastSel=this.selection.toJSON(),this.session.getUndoManager().addSelection(U),this.prevOp=this.curOp,this.curOp=null}}},B.prototype.$historyTracker=function(U){var z,$,Z,J;this.$mergeUndoDeltas&&(z=this.prevOp,$=this.$mergeableCommands,Z=z.command&&U.command.name==z.command.name,U.command.name=="insertstring"?(J=U.args,this.mergeNextCommand===void 0&&(this.mergeNextCommand=!0),Z=Z&&this.mergeNextCommand&&(!/\s/.test(J)||/\s/.test(z.args)),this.mergeNextCommand=!0):Z=Z&&$.indexOf(U.command.name)!==-1,(Z=this.$mergeUndoDeltas!="always"&&2e3<Date.now()-this.sequenceStartTime?!1:Z)?this.session.mergeUndoDeltas=!0:$.indexOf(U.command.name)!==-1&&(this.sequenceStartTime=Date.now()))},B.prototype.setKeyboardHandler=function(U,z){var $;U&&typeof U=="string"&&U!="ace"?(this.$keybindingId=U,$=this,R.loadModule(["keybinding",U],function(Z){$.$keybindingId==U&&$.keyBinding.setKeyboardHandler(Z&&Z.handler),z&&z()})):(this.$keybindingId=null,this.keyBinding.setKeyboardHandler(U),z&&z())},B.prototype.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},B.prototype.setSession=function(U){var z,$;this.session!=U&&(this.curOp&&this.endOperation(),this.curOp={},(z=this.session)&&(this.session.off("change",this.$onDocumentChange),this.session.off("changeMode",this.$onChangeMode),this.session.off("tokenizerUpdate",this.$onTokenizerUpdate),this.session.off("changeTabSize",this.$onChangeTabSize),this.session.off("changeWrapLimit",this.$onChangeWrapLimit),this.session.off("changeWrapMode",this.$onChangeWrapMode),this.session.off("changeFold",this.$onChangeFold),this.session.off("changeFrontMarker",this.$onChangeFrontMarker),this.session.off("changeBackMarker",this.$onChangeBackMarker),this.session.off("changeBreakpoint",this.$onChangeBreakpoint),this.session.off("changeAnnotation",this.$onChangeAnnotation),this.session.off("changeOverwrite",this.$onCursorChange),this.session.off("changeScrollTop",this.$onScrollTopChange),this.session.off("changeScrollLeft",this.$onScrollLeftChange),($=this.session.getSelection()).off("changeCursor",this.$onCursorChange),$.off("changeSelection",this.$onSelectionChange)),(this.session=U)?(this.$onDocumentChange=this.onDocumentChange.bind(this),U.on("change",this.$onDocumentChange),this.renderer.setSession(U),this.$onChangeMode=this.onChangeMode.bind(this),U.on("changeMode",this.$onChangeMode),this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this),U.on("tokenizerUpdate",this.$onTokenizerUpdate),this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer),U.on("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),U.on("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),U.on("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFold=this.onChangeFold.bind(this),U.on("changeFold",this.$onChangeFold),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.on("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.on("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.on("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.on("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.on("changeOverwrite",this.$onCursorChange),this.$onScrollTopChange=this.onScrollTopChange.bind(this),this.session.on("changeScrollTop",this.$onScrollTopChange),this.$onScrollLeftChange=this.onScrollLeftChange.bind(this),this.session.on("changeScrollLeft",this.$onScrollLeftChange),this.selection=U.getSelection(),this.selection.on("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.on("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.onCursorChange(),this.onScrollTopChange(),this.onScrollLeftChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit(),this.renderer.updateFull()):(this.selection=null,this.renderer.setSession(U)),this._signal("changeSession",{session:U,oldSession:z}),this.curOp=null,z&&z._signal("changeEditor",{oldEditor:this}),U&&U._signal("changeEditor",{editor:this}),U)&&!U.destroyed&&U.bgTokenizer.scheduleStart()},B.prototype.getSession=function(){return this.session},B.prototype.setValue=function(U,z){return this.session.doc.setValue(U),z?z==1?this.navigateFileEnd():z==-1&&this.navigateFileStart():this.selectAll(),U},B.prototype.getValue=function(){return this.session.getValue()},B.prototype.getSelection=function(){return this.selection},B.prototype.resize=function(U){this.renderer.onResize(U)},B.prototype.setTheme=function(U,z){this.renderer.setTheme(U,z)},B.prototype.getTheme=function(){return this.renderer.getTheme()},B.prototype.setStyle=function(U){this.renderer.setStyle(U)},B.prototype.unsetStyle=function(U){this.renderer.unsetStyle(U)},B.prototype.getFontSize=function(){return this.getOption("fontSize")||y.computedStyle(this.container).fontSize},B.prototype.setFontSize=function(U){this.setOption("fontSize",U)},B.prototype.$highlightBrackets=function(){var U;this.$highlightPending||((U=this).$highlightPending=!0,setTimeout(function(){U.$highlightPending=!1;var z,$,Z,J,ie=U.session;ie&&!ie.destroyed&&(ie.$bracketHighlight&&(ie.$bracketHighlight.markerIds.forEach(function(ne){ie.removeMarker(ne)}),ie.$bracketHighlight=null),z=U.getCursorPosition(),$=($=U.getKeyboardHandler())&&$.$getDirectionForHighlight&&$.$getDirectionForHighlight(U),($=ie.getMatchingBracketRanges(z,$))||(Z=new N(ie,z.row,z.column).getCurrentToken())&&/\b(?:tag-open|tag-name)/.test(Z.type)&&(Z=ie.getMatchingTags(z))&&($=[Z.openTagName.isEmpty()?Z.openTag:Z.openTagName,Z.closeTagName.isEmpty()?Z.closeTag:Z.closeTagName]),($=!$&&ie.$mode.getMatching?ie.$mode.getMatching(U.session):$)&&(J="ace_bracket",Array.isArray($)?$.length==1&&(J="ace_error_bracket"):$=[$],$.length==2&&(S.comparePoints($[0].end,$[1].start)==0?$=[S.fromPoints($[0].start,$[1].end)]:S.comparePoints($[0].start,$[1].end)==0&&($=[S.fromPoints($[1].start,$[0].end)])),ie.$bracketHighlight={ranges:$,markerIds:$.map(function(ne){return ie.addMarker(ne,J,"text")})}),U.getHighlightIndentGuides())&&U.renderer.$textLayer.$highlightIndentGuide()},50))},B.prototype.focus=function(){this.textInput.focus()},B.prototype.isFocused=function(){return this.textInput.isFocused()},B.prototype.blur=function(){this.textInput.blur()},B.prototype.onFocus=function(U){this.$isFocused||(this.$isFocused=!0,this.renderer.showCursor(),this.renderer.visualizeFocus(),this._emit("focus",U))},B.prototype.onBlur=function(U){this.$isFocused&&(this.$isFocused=!1,this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._emit("blur",U))},B.prototype.$cursorChange=function(){this.renderer.updateCursor(),this.$highlightBrackets(),this.$updateHighlightActiveLine()},B.prototype.onDocumentChange=function(U){var z=this.session.$useWrapMode,$=U.start.row==U.end.row?U.end.row:1/0;this.renderer.updateLines(U.start.row,$,z),this._signal("change",U),this.$cursorChange()},B.prototype.onTokenizerUpdate=function(U){U=U.data,this.renderer.updateLines(U.first,U.last)},B.prototype.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())},B.prototype.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())},B.prototype.onCursorChange=function(){this.$cursorChange(),this._signal("changeSelection")},B.prototype.$updateHighlightActiveLine=function(){var U,z,$=this.getSession();this.$highlightActiveLine&&(this.$selectionStyle=="line"&&this.selection.isMultiLine()||(U=this.getCursorPosition()),this.renderer.theme&&this.renderer.theme.$selectionColorConflict&&!this.selection.isEmpty()&&(U=!1),!this.renderer.$maxLines||this.session.getLength()!==1||1<this.renderer.$minLines||(U=!1)),$.$highlightLineMarker&&!U?($.removeMarker($.$highlightLineMarker.id),$.$highlightLineMarker=null):!$.$highlightLineMarker&&U?((z=new S(U.row,U.column,U.row,1/0)).id=$.addMarker(z,"ace_active-line","screenLine"),$.$highlightLineMarker=z):U&&($.$highlightLineMarker.start.row=U.row,$.$highlightLineMarker.end.row=U.row,$.$highlightLineMarker.start.column=U.column,$._signal("changeBackMarker"))},B.prototype.onSelectionChange=function(U){var z,$,Z=this.session,Z=(Z.$selectionMarker&&Z.removeMarker(Z.$selectionMarker),Z.$selectionMarker=null,this.selection.isEmpty()?this.$updateHighlightActiveLine():(z=this.selection.getRange(),$=this.getSelectionStyle(),Z.$selectionMarker=Z.addMarker(z,"ace_selection",$)),this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp());this.session.highlight(Z),this._signal("changeSelection")},B.prototype.$getSelectionHighLightRegexp=function(){var U=this.session,z=this.getSelectionRange();if(!z.isEmpty()&&!z.isMultiLine()){var $=z.start.column,Z=z.end.column,U=U.getLine(z.start.row),z=U.substring($,Z);if(!(5e3<z.length)&&/[\w\d]/.test(z)&&(z=this.$search.$assembleRegExp({wholeWord:!0,caseSensitive:!0,needle:z}),U=U.substring($-1,Z+1),z.test(U)))return z}},B.prototype.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},B.prototype.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},B.prototype.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()},B.prototype.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},B.prototype.onChangeMode=function(U){this.renderer.updateText(),this._emit("changeMode",U)},B.prototype.onChangeWrapLimit=function(){this.renderer.updateFull()},B.prototype.onChangeWrapMode=function(){this.renderer.onResize(!0)},B.prototype.onChangeFold=function(){this.$updateHighlightActiveLine(),this.renderer.updateFull()},B.prototype.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())},B.prototype.getCopyText=function(){var U=this.getSelectedText(),z=this.session.doc.getNewLineCharacter(),$=!1;if(!U&&this.$copyWithEmptySelection)for(var $=!0,Z=this.selection.getAllRanges(),J=0;J<Z.length;J++){var ie=Z[J];J&&Z[J-1].start.row==ie.start.row||(U+=this.session.getLine(ie.start.row)+z)}var ne={text:U};return this._signal("copy",ne),q.lineMode=!!$&&ne.text,ne.text},B.prototype.onCopy=function(){this.commands.exec("copy",this)},B.prototype.onCut=function(){this.commands.exec("cut",this)},B.prototype.onPaste=function(U,z){this.commands.exec("paste",this,{text:U,event:z})},B.prototype.$handlePaste=function($){this._signal("paste",$=typeof $=="string"?{text:$}:$);var z=$.text,$=z===q.lineMode,Z=this.session;if(!this.inMultiSelectMode||this.inVirtualSelectionMode)$?Z.insert({row:this.selection.lead.row,column:0},z):this.insert(z);else if($)this.selection.rangeList.ranges.forEach(function(ee){Z.insert({row:ee.start.row,column:0},z)});else{var J=z.split(/\r\n|\r|\n/),ie=this.selection.rangeList.ranges,$=!(J.length!=2||J[0]&&J[1]);if(J.length!=ie.length||$)return this.commands.exec("insertstring",this,z);for(var ne=ie.length;ne--;){var le=ie[ne];le.isEmpty()||Z.remove(le),Z.insert(le.start,J[ne])}}},B.prototype.execCommand=function(U,z){return this.commands.exec(U,this,z)},B.prototype.insert=function(U,le){var $,Z=this.session,J=Z.getMode(),ie=this.getCursorPosition(),ne=(this.getBehavioursEnabled()&&!le&&($=J.transformAction(Z.getState(ie.row),"insertion",this,Z,U))&&(U===$.text||this.inVirtualSelectionMode||(this.session.mergeUndoDeltas=!1,this.mergeNextCommand=!1),U=$.text),U=="	"&&(U=this.session.getTabString()),this.selection.isEmpty()?this.session.getOverwrite()&&U.indexOf(`
`)==-1&&((ne=S.fromPoints(ie,ie)).end.column+=U.length,this.session.remove(ne)):(ne=this.getSelectionRange(),ie=this.session.remove(ne),this.clearSelection()),U!=`
`&&U!=`\r
`||(ee=Z.getLine(ie.row),ie.column>ee.search(/\S|$/)&&(le=ee.substr(ie.column).search(/\S|$/),Z.doc.removeInLine(ie.row,ie.column,ie.column+le))),this.clearSelection(),ie.column),le=Z.getState(ie.row),ee=Z.getLine(ie.row),oe=J.checkOutdent(le,ee,U);Z.insert(ie,U),$&&$.selection&&($.selection.length==2?this.selection.setSelectionRange(new S(ie.row,ne+$.selection[0],ie.row,ne+$.selection[1])):this.selection.setSelectionRange(new S(ie.row+$.selection[0],$.selection[1],ie.row+$.selection[2],$.selection[3]))),this.$enableAutoIndent&&(Z.getDocument().isNewLine(U)&&(ne=J.getNextLineIndent(le,ee.slice(0,ie.column),Z.getTabString()),Z.insert({row:ie.row+1,column:0},ne)),oe)&&J.autoOutdent(le,Z,ie.row)},B.prototype.autoIndent=function(){for(var U=this.session,z=U.getMode(),$=this.selection.isEmpty()?[new S(0,0,U.doc.getLength()-1,0)]:this.selection.getAllRanges(),Z="",J="",ie=U.getTabString(),ne=0;ne<$.length;ne++)for(var le=$[ne].start.row,ee=$[ne].end.row,oe=le;oe<=ee;oe++){0<oe&&(Z=U.getState(oe-1),te=U.getLine(oe-1),J=z.getNextLineIndent(Z,te,ie));var te=U.getLine(oe),X=z.$getIndent(te);J!==X&&(0<X.length&&(X=new S(oe,0,oe,X.length),U.remove(X)),0<J.length)&&U.insert({row:oe,column:0},J),z.autoOutdent(Z,U,oe)}},B.prototype.onTextInput=function(U,z){if(!z)return this.keyBinding.onTextInput(U);this.startOperation({command:{name:"insertstring"}}),U=this.applyComposition.bind(this,U,z),this.selection.rangeCount?this.forEachSelection(U):U(),this.endOperation()},B.prototype.applyComposition=function(U,z){var $;(z.extendLeft||z.extendRight)&&(($=this.selection.getRange()).start.column-=z.extendLeft,$.end.column+=z.extendRight,$.start.column<0&&($.start.row--,$.start.column+=this.session.getLine($.start.row).length+1),this.selection.setRange($),U||$.isEmpty()||this.remove()),!U&&this.selection.isEmpty()||this.insert(U,!0),(z.restoreStart||z.restoreEnd)&&(($=this.selection.getRange()).start.column-=z.restoreStart,$.end.column-=z.restoreEnd,this.selection.setRange($))},B.prototype.onCommandKey=function(U,z,$){return this.keyBinding.onCommandKey(U,z,$)},B.prototype.setOverwrite=function(U){this.session.setOverwrite(U)},B.prototype.getOverwrite=function(){return this.session.getOverwrite()},B.prototype.toggleOverwrite=function(){this.session.toggleOverwrite()},B.prototype.setScrollSpeed=function(U){this.setOption("scrollSpeed",U)},B.prototype.getScrollSpeed=function(){return this.getOption("scrollSpeed")},B.prototype.setDragDelay=function(U){this.setOption("dragDelay",U)},B.prototype.getDragDelay=function(){return this.getOption("dragDelay")},B.prototype.setSelectionStyle=function(U){this.setOption("selectionStyle",U)},B.prototype.getSelectionStyle=function(){return this.getOption("selectionStyle")},B.prototype.setHighlightActiveLine=function(U){this.setOption("highlightActiveLine",U)},B.prototype.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")},B.prototype.setHighlightGutterLine=function(U){this.setOption("highlightGutterLine",U)},B.prototype.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},B.prototype.setHighlightSelectedWord=function(U){this.setOption("highlightSelectedWord",U)},B.prototype.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},B.prototype.setAnimatedScroll=function(U){this.renderer.setAnimatedScroll(U)},B.prototype.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()},B.prototype.setShowInvisibles=function(U){this.renderer.setShowInvisibles(U)},B.prototype.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},B.prototype.setDisplayIndentGuides=function(U){this.renderer.setDisplayIndentGuides(U)},B.prototype.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()},B.prototype.setHighlightIndentGuides=function(U){this.renderer.setHighlightIndentGuides(U)},B.prototype.getHighlightIndentGuides=function(){return this.renderer.getHighlightIndentGuides()},B.prototype.setShowPrintMargin=function(U){this.renderer.setShowPrintMargin(U)},B.prototype.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},B.prototype.setPrintMarginColumn=function(U){this.renderer.setPrintMarginColumn(U)},B.prototype.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},B.prototype.setReadOnly=function(U){this.setOption("readOnly",U)},B.prototype.getReadOnly=function(){return this.getOption("readOnly")},B.prototype.setBehavioursEnabled=function(U){this.setOption("behavioursEnabled",U)},B.prototype.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")},B.prototype.setWrapBehavioursEnabled=function(U){this.setOption("wrapBehavioursEnabled",U)},B.prototype.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")},B.prototype.setShowFoldWidgets=function(U){this.setOption("showFoldWidgets",U)},B.prototype.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")},B.prototype.setFadeFoldWidgets=function(U){this.setOption("fadeFoldWidgets",U)},B.prototype.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},B.prototype.remove=function(J){this.selection.isEmpty()&&(J=="left"?this.selection.selectLeft():this.selection.selectRight());var z,$,Z,J=this.getSelectionRange();this.getBehavioursEnabled()&&($=(z=this.session).getState(J.start.row),$=z.getMode().transformAction($,"deletion",this,z,J),J.end.column===0&&(Z=z.getTextRange(J))[Z.length-1]==`
`&&(Z=z.getLine(J.end.row),/^\s+$/.test(Z))&&(J.end.column=Z.length),$)&&(J=$),this.session.remove(J),this.clearSelection()},B.prototype.removeWordRight=function(){this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection()},B.prototype.removeWordLeft=function(){this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},B.prototype.removeToLineStart=function(){this.selection.isEmpty()&&this.selection.selectLineStart(),this.selection.isEmpty()&&this.selection.selectLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection()},B.prototype.removeToLineEnd=function(){this.selection.isEmpty()&&this.selection.selectLineEnd();var U=this.getSelectionRange();U.start.column==U.end.column&&U.start.row==U.end.row&&(U.end.column=0,U.end.row++),this.session.remove(U),this.clearSelection()},B.prototype.splitLine=function(){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var U=this.getCursorPosition();this.insert(`
`),this.moveCursorToPosition(U)},B.prototype.setGhostText=function(U,z){this.session.widgetManager||(this.session.widgetManager=new F(this.session),this.session.widgetManager.attach(this)),this.renderer.setGhostText(U,z)},B.prototype.removeGhostText=function(){this.session.widgetManager&&this.renderer.removeGhostText()},B.prototype.transposeLetters=function(){var U,z,$,Z;this.selection.isEmpty()&&(z=(U=this.getCursorPosition()).column)!==0&&(Z=z<(Z=this.session.getLine(U.row)).length?($=Z.charAt(z)+Z.charAt(z-1),new S(U.row,z-1,U.row,z+1)):($=Z.charAt(z-1)+Z.charAt(z-2),new S(U.row,z-2,U.row,z)),this.session.replace(Z,$),this.session.selection.moveToPosition(Z.end))},B.prototype.toLowerCase=function(){var U=this.getSelectionRange(),z=(this.selection.isEmpty()&&this.selection.selectWord(),this.getSelectionRange()),$=this.session.getTextRange(z);this.session.replace(z,$.toLowerCase()),this.selection.setSelectionRange(U)},B.prototype.toUpperCase=function(){var U=this.getSelectionRange(),z=(this.selection.isEmpty()&&this.selection.selectWord(),this.getSelectionRange()),$=this.session.getTextRange(z);this.session.replace(z,$.toUpperCase()),this.selection.setSelectionRange(U)},B.prototype.indent=function(){var U=this.session,z=this.getSelectionRange();if(!(z.start.row<z.end.row)){if(z.start.column<z.end.column){var $,ie=U.getTextRange(z);if(!/^\s+$/.test(ie))return $=this.$getSelectedRows(),void U.indentRows($.first,$.last,"	")}var Z=U.getLine(z.start.row),ie=z.start,J=U.getTabSize(),ie=U.documentToScreenColumn(ie.row,ie.column);if(this.session.getUseSoftTabs())var ne=J-ie%J,le=x.stringRepeat(" ",ne);else{for(ne=ie%J;Z[z.start.column-1]==" "&&ne;)z.start.column--,ne--;this.selection.setSelectionRange(z),le="	"}return this.insert(le)}$=this.$getSelectedRows(),U.indentRows($.first,$.last,"	")},B.prototype.blockIndent=function(){var U=this.$getSelectedRows();this.session.indentRows(U.first,U.last,"	")},B.prototype.blockOutdent=function(){var U=this.session.getSelection();this.session.outdentRows(U.getRange())},B.prototype.sortLines=function(){for(var U=this.$getSelectedRows(),z=this.session,$=[],Z=U.first;Z<=U.last;Z++)$.push(z.getLine(Z));$.sort(function(ne,le){return ne.toLowerCase()<le.toLowerCase()?-1:ne.toLowerCase()>le.toLowerCase()?1:0});for(var J=new S(0,0,0,0),Z=U.first;Z<=U.last;Z++){var ie=z.getLine(Z);J.start.row=Z,J.end.row=Z,J.end.column=ie.length,z.replace(J,$[Z-U.first])}},B.prototype.toggleCommentLines=function(){var U=this.session.getState(this.getCursorPosition().row),z=this.$getSelectedRows();this.session.getMode().toggleCommentLines(U,this.session,z.first,z.last)},B.prototype.toggleBlockComment=function(){var U=this.getCursorPosition(),z=this.session.getState(U.row),$=this.getSelectionRange();this.session.getMode().toggleBlockComment(z,this.session,$,U)},B.prototype.getNumberAt=function(U,z){for(var $=/[\-]?[0-9]+(?:\.[0-9]+)?/g,Z=($.lastIndex=0,this.session.getLine(U));$.lastIndex<z;){var J=$.exec(Z);if(J.index<=z&&J.index+J[0].length>=z)return{value:J[0],start:J.index,end:J.index+J[0].length}}return null},B.prototype.modifyNumber=function(U){var z,$,Z,J=this.selection.getCursor().row,ie=this.selection.getCursor().column,ne=new S(J,ie-1,J,ie),ne=this.session.getTextRange(ne);!isNaN(parseFloat(ne))&&isFinite(ne)?(ne=this.getNumberAt(J,ie))&&(Z=0<=ne.value.indexOf(".")?ne.start+ne.value.indexOf(".")+1:ne.end,z=ne.start+ne.value.length-Z,$=parseFloat(ne.value),$*=Math.pow(10,z),Z!==ne.end&&ie<Z?U*=Math.pow(10,ne.end-ie-1):U*=Math.pow(10,ne.end-ie),Z=($=($+=U)/Math.pow(10,z)).toFixed(z),U=new S(J,ne.start,J,ne.end),this.session.replace(U,Z),this.moveCursorTo(J,Math.max(ne.start+1,ie+Z.length-ne.value.length))):this.toggleWord()},B.prototype.toggleWord=function(){for(var U,z=this.selection.getCursor().row,$=this.selection.getCursor().column,Z=(this.selection.selectWord(),this.getSelectedText()),J=this.selection.getWordRange().start.column,ie=Z.replace(/([a-z]+|[A-Z]+)(?=[A-Z_]|$)/g,"$1 ").split(/\s/),ne=$-J-1,le=(ne<0&&(ne=0),0),ee=this,oe=(Z.match(/[A-Za-z0-9_]+/)&&ie.forEach(function(se,me){U=le+se.length,le<=ne&&ne<=U&&(Z=se,ee.selection.clearSelection(),ee.moveCursorTo(z,le+J),ee.selection.selectTo(z,U+J)),le=U}),this.$toggleWordPairs),te=0;te<oe.length;te++)for(var X=oe[te],W=0;W<=1;W++){var K=+!W,re=Z.match(new RegExp("^\\s?_?("+x.escapeRegExp(X[W])+")\\s?$","i"));re&&Z.match(new RegExp("([_]|^|\\s)("+x.escapeRegExp(re[1])+")($|\\s)","g"))&&(re=Z.replace(new RegExp(x.escapeRegExp(X[W]),"i"),function(se){var me=X[K];return se.toUpperCase()==se?me=me.toUpperCase():se.charAt(0).toUpperCase()==se.charAt(0)&&(me=me.substr(0,0)+X[K].charAt(0).toUpperCase()+me.substr(1)),me}),this.insert(re))}},B.prototype.findLinkAt=function(ie,z){var $,Z,J,ie=this.session.getLine(ie).split(/((?:https?|ftp):\/\/[\S]+)/),ne=z,le=(ne<0&&(ne=0),0);try{for(var ee=g(ie),oe=ee.next();!oe.done;oe=ee.next()){var te=oe.value,X=le+te.length;if(le<=ne&&ne<=X&&te.match(/((?:https?|ftp):\/\/[\S]+)/)){J=te.replace(/[\s:.,'";}\]]+$/,"");break}le=X}}catch(W){$={error:W}}finally{try{oe&&!oe.done&&(Z=ee.return)&&Z.call(ee)}finally{if($)throw $.error}}return J},B.prototype.openLink=function(){var U=this.selection.getCursor(),U=this.findLinkAt(U.row,U.column);return U&&window.open(U,"_blank"),U!=null},B.prototype.removeLines=function(){var U=this.$getSelectedRows();this.session.removeFullLines(U.first,U.last),this.clearSelection()},B.prototype.duplicateSelection=function(){var U,z=this.selection,$=this.session,Z=z.getRange(),J=z.isBackwards();Z.isEmpty()?(U=Z.start.row,$.duplicateLines(U,U)):(U=J?Z.start:Z.end,$=$.insert(U,$.getTextRange(Z)),Z.start=U,Z.end=$,z.setSelectionRange(Z,J))},B.prototype.moveLinesDown=function(){this.$moveLines(1,!1)},B.prototype.moveLinesUp=function(){this.$moveLines(-1,!1)},B.prototype.moveText=function(U,z,$){return this.session.moveText(U,z,$)},B.prototype.copyLinesUp=function(){this.$moveLines(-1,!0)},B.prototype.copyLinesDown=function(){this.$moveLines(1,!0)},B.prototype.$moveLines=function(U,z){var $=this.selection;if(!$.inMultiSelectMode||this.inVirtualSelectionMode){var Z=$.toOrientedRange(),J=this.$getSelectedRows(Z),ie=this.session.$moveLines(J.first,J.last,z?0:U);Z.moveBy(ie=z&&U==-1?0:ie,0),$.fromOrientedRange(Z)}else{for(var ne=$.rangeList.ranges,le=($.rangeList.detach(this.session),this.inVirtualSelectionMode=!0,0),ee=0,oe=ne.length,te=0;te<oe;te++){for(var X=te,W=(ne[te].moveBy(le,0),(J=this.$getSelectedRows(ne[te])).first),K=J.last;++te<oe;){ee&&ne[te].moveBy(ee,0);var re=this.$getSelectedRows(ne[te]);if(z&&re.first!=K||!z&&re.first>K+1)break;K=re.last}for(te--,le=this.session.$moveLines(W,K,z?0:U),z&&U==-1&&(X=te+1);X<=te;)ne[X].moveBy(le,0),X++;ee+=le=z?le:0}$.fromOrientedRange($.ranges[0]),$.rangeList.attach(this.session),this.inVirtualSelectionMode=!1}},B.prototype.$getSelectedRows=function(U){return U=(U||this.getSelectionRange()).collapseRows(),{first:this.session.getRowFoldStart(U.start.row),last:this.session.getRowFoldEnd(U.end.row)}},B.prototype.onCompositionStart=function(U){this.renderer.showComposition(U)},B.prototype.onCompositionUpdate=function(U){this.renderer.setCompositionText(U)},B.prototype.onCompositionEnd=function(){this.renderer.hideComposition()},B.prototype.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},B.prototype.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},B.prototype.isRowVisible=function(U){return U>=this.getFirstVisibleRow()&&U<=this.getLastVisibleRow()},B.prototype.isRowFullyVisible=function(U){return U>=this.renderer.getFirstFullyVisibleRow()&&U<=this.renderer.getLastFullyVisibleRow()},B.prototype.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},B.prototype.$moveByPage=function(ie,z){var $=this.renderer,Z=this.renderer.layerConfig,J=ie*Math.floor(Z.height/Z.lineHeight),ie=(z===!0?this.selection.$moveSelection(function(){this.moveCursorBy(J,0)}):z===!1&&(this.selection.moveCursorBy(J,0),this.selection.clearSelection()),$.scrollTop);$.scrollBy(0,J*Z.lineHeight),z!=null&&$.scrollCursorIntoView(null,.5),$.animateScrolling(ie)},B.prototype.selectPageDown=function(){this.$moveByPage(1,!0)},B.prototype.selectPageUp=function(){this.$moveByPage(-1,!0)},B.prototype.gotoPageDown=function(){this.$moveByPage(1,!1)},B.prototype.gotoPageUp=function(){this.$moveByPage(-1,!1)},B.prototype.scrollPageDown=function(){this.$moveByPage(1)},B.prototype.scrollPageUp=function(){this.$moveByPage(-1)},B.prototype.scrollToRow=function(U){this.renderer.scrollToRow(U)},B.prototype.scrollToLine=function(U,z,$,Z){this.renderer.scrollToLine(U,z,$,Z)},B.prototype.centerSelection=function(){var U=this.getSelectionRange(),U={row:Math.floor(U.start.row+(U.end.row-U.start.row)/2),column:Math.floor(U.start.column+(U.end.column-U.start.column)/2)};this.renderer.alignCursor(U,.5)},B.prototype.getCursorPosition=function(){return this.selection.getCursor()},B.prototype.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},B.prototype.getSelectionRange=function(){return this.selection.getRange()},B.prototype.selectAll=function(){this.selection.selectAll()},B.prototype.clearSelection=function(){this.selection.clearSelection()},B.prototype.moveCursorTo=function(U,z){this.selection.moveCursorTo(U,z)},B.prototype.moveCursorToPosition=function(U){this.selection.moveCursorToPosition(U)},B.prototype.jumpToMatching=function(U,z){var $=this.getCursorPosition(),Z=new N(this.session,$.row,$.column),J=Z.getCurrentToken(),ie=0,ne=(J=J&&J.type.indexOf("tag-name")!==-1?Z.stepBackward():J)||Z.stepForward();if(ne){var le,ee,oe=!1,te={},X=$.column-ne.start,W={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do if(ne.value.match(/[{}()\[\]]/g)){for(;X<ne.value.length&&!oe;X++)if(W[ne.value[X]])switch(ee=W[ne.value[X]]+"."+ne.type.replace("rparen","lparen"),isNaN(te[ee])&&(te[ee]=0),ne.value[X]){case"(":case"[":case"{":te[ee]++;break;case")":case"]":case"}":te[ee]--,te[ee]===-1&&(le="bracket",oe=!0)}}else ne.type.indexOf("tag-name")!==-1&&(isNaN(te[ne.value])&&(te[ne.value]=0),J.value==="<"&&1<ie?te[ne.value]++:J.value==="</"&&te[ne.value]--,te[ne.value]===-1)&&(le="tag",oe=!0);while(oe||(J=ne,ie++,ne=Z.stepForward(),X=0),ne&&!oe);if(le){if(le==="bracket")!(re=this.session.getBracketRange($))&&(se=(re=new S(Z.getCurrentTokenRow(),Z.getCurrentTokenColumn()+X-1,Z.getCurrentTokenRow(),Z.getCurrentTokenColumn()+X-1)).start,z||se.row===$.row&&Math.abs(se.column-$.column)<2)&&(re=this.session.getBracketRange(se));else if(le==="tag"){if(!ne||ne.type.indexOf("tag-name")===-1)return;var K,re,se=(se=(re=new S(Z.getCurrentTokenRow(),Z.getCurrentTokenColumn()-2,Z.getCurrentTokenRow(),Z.getCurrentTokenColumn()-2)).compare($.row,$.column)===0&&(K=this.session.getMatchingTags($))?K.openTag.contains($.row,$.column)?(re=K.closeTag).start:(re=K.openTag,K.closeTag.start.row===$.row&&K.closeTag.start.column===$.column?re.end:re.start):se)||re.start}(se=re&&re.cursor||se)&&(U?re&&z?this.selection.setRange(re):re&&re.isEqual(this.getSelectionRange())?this.clearSelection():this.selection.selectTo(se.row,se.column):this.selection.moveTo(se.row,se.column))}}},B.prototype.gotoLine=function(U,z,$){this.selection.clearSelection(),this.session.unfold({row:U-1,column:z||0}),this.exitMultiSelectMode&&this.exitMultiSelectMode(),this.moveCursorTo(U-1,z||0),this.isRowFullyVisible(U-1)||this.scrollToLine(U-1,!0,$)},B.prototype.navigateTo=function(U,z){this.selection.moveTo(U,z)},B.prototype.navigateUp=function(U){var z;if(this.selection.isMultiLine()&&!this.selection.isBackwards())return z=this.selection.anchor.getPosition(),this.moveCursorToPosition(z);this.selection.clearSelection(),this.selection.moveCursorBy(-U||-1,0)},B.prototype.navigateDown=function(U){var z;if(this.selection.isMultiLine()&&this.selection.isBackwards())return z=this.selection.anchor.getPosition(),this.moveCursorToPosition(z);this.selection.clearSelection(),this.selection.moveCursorBy(U||1,0)},B.prototype.navigateLeft=function(U){if(this.selection.isEmpty())for(U=U||1;U--;)this.selection.moveCursorLeft();else{var z=this.getSelectionRange().start;this.moveCursorToPosition(z)}this.clearSelection()},B.prototype.navigateRight=function(U){if(this.selection.isEmpty())for(U=U||1;U--;)this.selection.moveCursorRight();else{var z=this.getSelectionRange().end;this.moveCursorToPosition(z)}this.clearSelection()},B.prototype.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},B.prototype.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},B.prototype.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},B.prototype.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},B.prototype.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},B.prototype.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},B.prototype.replace=function(U,$){$&&this.$search.set($);var $=this.$search.find(this.session),Z=0;return $&&(this.$tryReplace($,U)&&(Z=1),this.selection.setSelectionRange($),this.renderer.scrollSelectionIntoView($.start,$.end)),Z},B.prototype.replaceAll=function(U,z){z&&this.$search.set(z);var $=this.$search.findAll(this.session),Z=0;if($.length){z=this.getSelectionRange(),this.selection.moveTo(0,0);for(var J=$.length-1;0<=J;--J)this.$tryReplace($[J],U)&&Z++;this.selection.setSelectionRange(z)}return Z},B.prototype.$tryReplace=function(U,z){var $=this.session.getTextRange(U);return(z=this.$search.replace($,z))!==null?(U.end=this.session.replace(U,z),U):null},B.prototype.getLastSearchOptions=function(){return this.$search.getOptions()},B.prototype.find=function(J,z,$){z=z||{},typeof J=="string"||J instanceof RegExp?z.needle=J:typeof J=="object"&&b.mixin(z,J);var Z=this.selection.getRange(),J=(z.needle==null&&((J=this.session.getTextRange(Z)||this.$search.$options.needle)||(Z=this.session.getWordRange(Z.start.row,Z.start.column),J=this.session.getTextRange(Z)),this.$search.set({needle:J})),this.$search.set(z),z.start||this.$search.set({start:Z}),this.$search.find(this.session));return z.preventScroll?J:J?(this.revealRange(J,$),J):(z.backwards?Z.start=Z.end:Z.end=Z.start,void this.selection.setRange(Z))},B.prototype.findNext=function(U,z){this.find({skipCurrent:!0,backwards:!1},U,z)},B.prototype.findPrevious=function(U,z){this.find(U,{skipCurrent:!0,backwards:!0},z)},B.prototype.revealRange=function(U,z){this.session.unfold(U),this.selection.setSelectionRange(U);var $=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(U.start,U.end,.5),z!==!1&&this.renderer.animateScrolling($)},B.prototype.undo=function(){this.session.getUndoManager().undo(this.session),this.renderer.scrollCursorIntoView(null,.5)},B.prototype.redo=function(){this.session.getUndoManager().redo(this.session),this.renderer.scrollCursorIntoView(null,.5)},B.prototype.destroy=function(){this.$toDestroy&&(this.$toDestroy.forEach(function(U){U.destroy()}),this.$toDestroy=null),this.$mouseHandler&&this.$mouseHandler.destroy(),this.renderer.destroy(),this._signal("destroy",this),this.session&&this.session.destroy(),this._$emitInputEvent&&this._$emitInputEvent.cancel(),this.removeAllListeners()},B.prototype.setAutoScrollEditorIntoView=function(U){var z,$,Z,J,ie,ne,le;U&&(Z=!1,($=this).$scrollAnchor||(this.$scrollAnchor=document.createElement("div")),(J=this.$scrollAnchor).style.cssText="position:absolute",this.container.insertBefore(J,this.container.firstChild),ie=this.on("changeSelection",function(){Z=!0}),ne=this.renderer.on("beforeRender",function(){Z&&(z=$.renderer.container.getBoundingClientRect())}),le=this.renderer.on("afterRender",function(){var ee,oe,te;Z&&z&&($.isFocused()||$.searchBox&&$.searchBox.isFocused())&&(ee=(oe=$.renderer).$cursorLayer.$pixelPos,oe=oe.layerConfig,te=ee.top-oe.offset,(Z=0<=ee.top&&te+z.top<0||!(ee.top<oe.height&&ee.top+z.top+oe.lineHeight>window.innerHeight)&&null)!=null&&(J.style.top=te+"px",J.style.left=ee.left+"px",J.style.height=oe.lineHeight+"px",J.scrollIntoView(Z)),Z=z=null)}),this.setAutoScrollEditorIntoView=function(ee){ee||(delete this.setAutoScrollEditorIntoView,this.off("changeSelection",ie),this.renderer.off("afterRender",le),this.renderer.off("beforeRender",ne))})},B.prototype.$resetCursorStyle=function(){var U=this.$cursorStyle||"ace",z=this.renderer.$cursorLayer;z&&(z.setSmoothBlinking(/smooth/.test(U)),z.isBlinking=!this.$readOnly&&U!="wide",y.setCssClass(z.element,"ace_slim-cursors",/slim/.test(U)))},B.prototype.prompt=function(U,z,$){var Z=this;R.loadModule("ace/ext/prompt",function(J){J.prompt(Z,U,z,$)})},B);function B(U,z,$){this.session,this.$toDestroy=[];var Z=U.getContainerElement();this.container=Z,this.renderer=U,this.id="editor"+ ++B.$uid,this.commands=new k(A.isMac?"mac":"win",L),typeof document=="object"&&(this.textInput=new v(U.getTextAreaContainer(),this),this.renderer.textarea=this.textInput.getElement(),this.$mouseHandler=new _(this),new I(this)),this.keyBinding=new T(this),this.$search=new w().set({wrap:!0}),this.$historyTracker=this.$historyTracker.bind(this),this.commands.on("exec",this.$historyTracker),this.$initOperationListeners(),this._$emitInputEvent=x.delayedCall((function(){this._signal("input",{}),this.session&&!this.session.destroyed&&this.session.bgTokenizer.scheduleStart()}).bind(this)),this.on("change",function(J,ie){ie._$emitInputEvent.schedule(31)}),this.setSession(z||$&&$.session||new E("")),R.resetOptions(this),$&&this.setOptions($),R._signal("editor",this)}O.$uid=0,O.prototype.curOp=null,O.prototype.prevOp={},O.prototype.$mergeableCommands=["backspace","del","insertstring"],O.prototype.$toggleWordPairs=[["first","last"],["true","false"],["yes","no"],["width","height"],["top","bottom"],["right","left"],["on","off"],["x","y"],["get","set"],["max","min"],["horizontal","vertical"],["show","hide"],["add","remove"],["up","down"],["before","after"],["even","odd"],["in","out"],["inside","outside"],["next","previous"],["increase","decrease"],["attach","detach"],["&&","||"],["==","!="]],b.implement(O.prototype,P),R.defineOptions(O.prototype,"editor",{selectionStyle:{set:function(U){this.onSelectionChange(),this._signal("changeSelectionStyle",{data:U})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:!0},highlightSelectedWord:{set:function(U){this.$onSelectionChange()},initialValue:!0},readOnly:{set:function(U){this.textInput.setReadOnly(U),this.$resetCursorStyle()},initialValue:!1},copyWithEmptySelection:{set:function(U){this.textInput.setCopyWithEmptySelection(U)},initialValue:!1},cursorStyle:{set:function(U){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[!1,!0,"always"],initialValue:!0},behavioursEnabled:{initialValue:!0},wrapBehavioursEnabled:{initialValue:!0},enableAutoIndent:{initialValue:!0},autoScrollEditorIntoView:{set:function(U){this.setAutoScrollEditorIntoView(U)}},keyboardHandler:{set:function(U){this.setKeyboardHandler(U)},get:function(){return this.$keybindingId},handlesSet:!0},value:{set:function(U){this.session.setValue(U)},get:function(){return this.getValue()},handlesSet:!0,hidden:!0},session:{set:function(U){this.setSession(U)},get:function(){return this.session},handlesSet:!0,hidden:!0},showLineNumbers:{set:function(U){this.renderer.$gutterLayer.setShowLineNumbers(U),this.renderer.$loop.schedule(this.renderer.CHANGE_GUTTER),U&&this.$relativeLineNumbers?j.attach(this):j.detach(this)},initialValue:!0},relativeLineNumbers:{set:function(U){this.$showLineNumbers&&U?j.attach(this):j.detach(this)}},placeholder:{set:function(U){this.$updatePlaceholder||(this.$updatePlaceholder=(function(){var z=this.session&&(this.renderer.$composition||1<this.session.getLength()||0<this.session.getLine(0).length);z&&this.renderer.placeholderNode?(this.renderer.off("afterRender",this.$updatePlaceholder),y.removeCssClass(this.container,"ace_hasPlaceholder"),this.renderer.placeholderNode.remove(),this.renderer.placeholderNode=null):z||this.renderer.placeholderNode?!z&&this.renderer.placeholderNode&&(this.renderer.placeholderNode.textContent=this.$placeholder||""):(this.renderer.on("afterRender",this.$updatePlaceholder),y.addCssClass(this.container,"ace_hasPlaceholder"),(z=y.createElement("div")).className="ace_placeholder",z.textContent=this.$placeholder||"",this.renderer.placeholderNode=z,this.renderer.content.appendChild(this.renderer.placeholderNode))}).bind(this),this.on("input",this.$updatePlaceholder)),this.$updatePlaceholder()}},enableKeyboardAccessibility:{set:function(U){function z(J){J.target==this.renderer.scroller&&J.keyCode===Q.enter&&(J.preventDefault(),J=this.getCursorPosition().row,this.isRowVisible(J)||this.scrollToLine(J,!0,!0),this.focus())}var $,Z={name:"blurTextInput",description:"Set focus to the editor content div to allow tabbing through the page",bindKey:"Esc",exec:function(J){J.blur(),J.renderer.scroller.focus()},readOnly:!0};U?(this.renderer.enableKeyboardAccessibility=!0,this.renderer.keyboardFocusClassName="ace_keyboard-focus",this.textInput.getElement().setAttribute("tabindex",-1),this.textInput.setNumberOfExtraLines(A.isWin?3:0),this.renderer.scroller.setAttribute("tabindex",0),this.renderer.scroller.setAttribute("role","group"),this.renderer.scroller.setAttribute("aria-roledescription",V("editor.scroller.aria-roledescription","editor")),this.renderer.scroller.classList.add(this.renderer.keyboardFocusClassName),this.renderer.scroller.setAttribute("aria-label",V("editor.scroller.aria-label","Editor content, press Enter to start editing, press Escape to exit")),this.renderer.scroller.addEventListener("keyup",z.bind(this)),this.commands.addCommand(Z),this.renderer.$gutter.setAttribute("tabindex",0),this.renderer.$gutter.setAttribute("aria-hidden",!1),this.renderer.$gutter.setAttribute("role","group"),this.renderer.$gutter.setAttribute("aria-roledescription",V("editor.gutter.aria-roledescription","editor")),this.renderer.$gutter.setAttribute("aria-label",V("editor.gutter.aria-label","Editor gutter, press Enter to interact with controls using arrow keys, press Escape to exit")),this.renderer.$gutter.classList.add(this.renderer.keyboardFocusClassName),this.renderer.content.setAttribute("aria-hidden",!0),($=$||new H(this)).addListener()):(this.renderer.enableKeyboardAccessibility=!1,this.textInput.getElement().setAttribute("tabindex",0),this.textInput.setNumberOfExtraLines(0),this.renderer.scroller.setAttribute("tabindex",-1),this.renderer.scroller.removeAttribute("role"),this.renderer.scroller.removeAttribute("aria-roledescription"),this.renderer.scroller.classList.remove(this.renderer.keyboardFocusClassName),this.renderer.scroller.removeAttribute("aria-label"),this.renderer.scroller.removeEventListener("keyup",z.bind(this)),this.commands.removeCommand(Z),this.renderer.content.removeAttribute("aria-hidden"),this.renderer.$gutter.setAttribute("tabindex",-1),this.renderer.$gutter.setAttribute("aria-hidden",!0),this.renderer.$gutter.removeAttribute("role"),this.renderer.$gutter.removeAttribute("aria-roledescription"),this.renderer.$gutter.removeAttribute("aria-label"),this.renderer.$gutter.classList.remove(this.renderer.keyboardFocusClassName),$&&$.removeListener())},initialValue:!1},customScrollbar:"renderer",hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",displayIndentGuides:"renderer",highlightIndentGuides:"renderer",showGutter:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",hasCssTransforms:"renderer",maxPixelHeight:"renderer",useTextareaForIME:"renderer",useResizeObserver:"renderer",useSvgGutterIcons:"renderer",showFoldedAnnotations:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimeout:"$mouseHandler",tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",navigateWithinSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"});var j={getText:function(U,z){return(Math.abs(U.selection.lead.row-z)||z+1+(z<9?"\xB7":""))+""},getWidth:function(U,z,$){return Math.max(z.toString().length,($.lastRow+1).toString().length,2)*$.characterWidth},update:function(U,z){z.renderer.$loop.schedule(z.renderer.CHANGE_GUTTER)},attach:function(U){U.renderer.$gutterLayer.$renderer=this,U.on("changeSelection",this.update),this.update(null,U)},detach:function(U){U.renderer.$gutterLayer.$renderer==this&&(U.renderer.$gutterLayer.$renderer=null),U.off("changeSelection",this.update),this.update(null,U)}};f.Editor=O}),ace.define("ace/layer/lines",["require","exports","module","ace/lib/dom"],function(h,f,C){"use strict";var g=h("../lib/dom");function b(y,x){this.element=y,this.canvasHeight=x||5e5,this.element.style.height=2*this.canvasHeight+"px",this.cells=[],this.cellCache=[],this.$offsetCoefficient=0}b.prototype.moveContainer=function(y){g.translate(this.element,0,-(y.firstRowScreen*y.lineHeight%this.canvasHeight)-y.offset*this.$offsetCoefficient)},b.prototype.pageChanged=function(y,x){return Math.floor(y.firstRowScreen*y.lineHeight/this.canvasHeight)!==Math.floor(x.firstRowScreen*x.lineHeight/this.canvasHeight)},b.prototype.computeLineTop=function(y,x,A){var v=x.firstRowScreen*x.lineHeight,v=Math.floor(v/this.canvasHeight);return A.documentToScreenRow(y,0)*x.lineHeight-v*this.canvasHeight},b.prototype.computeLineHeight=function(y,x,A){return x.lineHeight*A.getRowLineCount(y)},b.prototype.getLength=function(){return this.cells.length},b.prototype.get=function(y){return this.cells[y]},b.prototype.shift=function(){this.$cacheCell(this.cells.shift())},b.prototype.pop=function(){this.$cacheCell(this.cells.pop())},b.prototype.push=function(y){if(Array.isArray(y)){this.cells.push.apply(this.cells,y);for(var x=g.createFragment(this.element),A=0;A<y.length;A++)x.appendChild(y[A].element);this.element.appendChild(x)}else this.cells.push(y),this.element.appendChild(y.element)},b.prototype.unshift=function(y){if(Array.isArray(y)){this.cells.unshift.apply(this.cells,y);for(var x=g.createFragment(this.element),A=0;A<y.length;A++)x.appendChild(y[A].element);this.element.firstChild?this.element.insertBefore(x,this.element.firstChild):this.element.appendChild(x)}else this.cells.unshift(y),this.element.insertAdjacentElement("afterbegin",y.element)},b.prototype.last=function(){return this.cells.length?this.cells[this.cells.length-1]:null},b.prototype.$cacheCell=function(y){y&&(y.element.remove(),this.cellCache.push(y))},b.prototype.createCell=function(y,x,A,v){var _,I=this.cellCache.pop();return I||(_=g.createElement("div"),v&&v(_),this.element.appendChild(_),I={element:_,text:"",row:y}),I.row=y,I},f.Lines=b}),ace.define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/layer/lines","ace/config"],function(_,f,C){"use strict";var g=_("../lib/dom"),b=_("../lib/oop"),y=_("../lib/lang"),x=_("../lib/event_emitter").EventEmitter,A=_("./lines").Lines,v=_("../config").nls,_=(I.prototype.setSession=function(E){this.session&&this.session.off("change",this.$updateAnnotations),(this.session=E)&&E.on("change",this.$updateAnnotations)},I.prototype.addGutterDecoration=function(E,w){window.console,this.session.addGutterDecoration(E,w)},I.prototype.removeGutterDecoration=function(E,w){window.console,this.session.removeGutterDecoration(E,w)},I.prototype.setAnnotations=function(E){this.$annotations=[];for(var w=0;w<E.length;w++){var S=E[w],L=S.row,P=(P=this.$annotations[L])||(this.$annotations[L]={text:[],type:[]}),L=S.text,k=S.type,L=L?y.escapeHTML(L):S.html||"",L=(P.text.indexOf(L)===-1&&(P.text.push(L),P.type.push(k)),S.className);L?P.className=L:k=="error"?P.className=" ace_error":k=="warning"&&P.className!=" ace_error"?P.className=" ace_warning":k!="info"||P.className||(P.className=" ace_info")}},I.prototype.$updateAnnotations=function(E){var w,S;this.$annotations.length&&(w=E.start.row,(S=E.end.row-w)!=0)&&(E.action=="remove"?this.$annotations.splice(w,1+S,null):((E=new Array(1+S)).unshift(w,1),this.$annotations.splice.apply(this.$annotations,E)))},I.prototype.update=function(E){this.config=E;for(var w=this.session,S=E.firstRow,P=Math.min(E.lastRow+E.gutterOffset,w.getLength()-1),k=(this.oldLastRow=P,this.config=E,this.$lines.moveContainer(E),this.$updateCursorRow(),w.getNextFoldLine(S)),L=k?k.start.row:1/0,R=null,N=-1,F=S;;){if(L<F&&(F=k.end.row+1,L=(k=w.getNextFoldLine(F,k))?k.start.row:1/0),P<F){for(;this.$lines.getLength()>N+1;)this.$lines.pop();break}(R=this.$lines.get(++N))?R.row=F:(R=this.$lines.createCell(F,E,this.session,T),this.$lines.push(R)),this.$renderCell(R,E,k,F),F++}this._signal("afterRender"),this.$updateGutterWidth(E)},I.prototype.$updateGutterWidth=function(E){var w=this.session,k=w.gutterRenderer||this.$renderer,P=w.$firstLineNumber,S=this.$lines.last()?this.$lines.last().text:"",P=((this.$fixedWidth||w.$useWrapMode)&&(S=w.getLength()+P-1),k?k.getWidth(w,S,E):S.toString().length*E.characterWidth),k=this.$padding||this.$computePadding();(P+=k.left+k.right)===this.gutterWidth||isNaN(P)||(this.gutterWidth=P,this.element.parentNode.style.width=this.element.style.width=Math.ceil(this.gutterWidth)+"px",this._signal("changeGutterWidth",P))},I.prototype.$updateCursorRow=function(){var E;this.$highlightGutterLine&&(E=this.session.selection.getCursor(),this.$cursorRow!==E.row)&&(this.$cursorRow=E.row)},I.prototype.updateLineHighlight=function(){if(this.$highlightGutterLine){var E=this.session.selection.cursor.row;if(this.$cursorRow=E,!this.$cursorCell||this.$cursorCell.row!=E){this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ",""));var w=this.$lines.cells;this.$cursorCell=null;for(var S=0;S<w.length;S++){var P=w[S];if(P.row>=this.$cursorRow){if(P.row>this.$cursorRow){var k=this.session.getFoldLine(this.$cursorRow);if(!(0<S&&k&&k.start.row==w[S-1].row))break;P=w[S-1]}P.element.className="ace_gutter-active-line "+P.element.className,this.$cursorCell=P;break}}}}},I.prototype.scrollLines=function(E){var w=this.config;if(this.config=E,this.$updateCursorRow(),this.$lines.pageChanged(w,E))return this.update(E);this.$lines.moveContainer(E);var S=Math.min(E.lastRow+E.gutterOffset,this.session.getLength()-1),P=this.oldLastRow;if(this.oldLastRow=S,!w||P<E.firstRow)return this.update(E);if(S<w.firstRow)return this.update(E);if(w.firstRow<E.firstRow)for(var k=this.session.getFoldedRowCount(w.firstRow,E.firstRow-1);0<k;k--)this.$lines.shift();if(S<P)for(k=this.session.getFoldedRowCount(S+1,P);0<k;k--)this.$lines.pop();E.firstRow<w.firstRow&&this.$lines.unshift(this.$renderLines(E,E.firstRow,w.firstRow-1)),P<S&&this.$lines.push(this.$renderLines(E,P+1,S)),this.updateLineHighlight(),this._signal("afterRender"),this.$updateGutterWidth(E)},I.prototype.$renderLines=function(E,w,S){for(var P=[],k=w,L=this.session.getNextFoldLine(k),R=L?L.start.row:1/0;R<k&&(k=L.end.row+1,R=(L=this.session.getNextFoldLine(k,L))?L.start.row:1/0),!(S<k);){var N=this.$lines.createCell(k,E,this.session,T);this.$renderCell(N,E,L,k),P.push(N),k++}return P},I.prototype.$renderCell=function(E,w,S,P){var k,L,R=E.element,N=this.session,F=R.childNodes[0],H=R.childNodes[1],V=R.childNodes[2],q=V.firstChild,Q=N.$firstLineNumber,O=N.$breakpoints,B=N.$decorations,j=N.gutterRenderer||this.$renderer,U=this.$showFoldWidgets&&N.foldWidgets,z=S?S.start.row:Number.MAX_VALUE,$=w.lineHeight+"px",Z=this.$useSvgGutterIcons?"ace_gutter-cell_svg-icons ":"ace_gutter-cell ",J=this.$useSvgGutterIcons?"ace_icon_svg":"ace_icon",ie=(j?j.getText(N,P):P+Q).toString();if(this.$highlightGutterLine&&(P==this.$cursorRow||S&&P<this.$cursorRow&&z<=P&&this.$cursorRow<=S.end.row)&&(Z+="ace_gutter-active-line ",this.$cursorCell!=E)&&(this.$cursorCell&&(this.$cursorCell.element.className=this.$cursorCell.element.className.replace("ace_gutter-active-line ","")),this.$cursorCell=E),O[P]&&(Z+=O[P]),B[P]&&(Z+=B[P]),this.$annotations[P]&&P!==z&&(Z+=this.$annotations[P].className),k=U&&(k=U[P])==null?U[P]=N.getFoldWidget(P):k){if(j="ace_fold-widget ace_"+k,Q=k=="start"&&P==z&&P<S.end.row,Q){j+=" ace_closed";for(var ne="",le=!1,ee=P+1;ee<=S.end.row;ee++)if(this.$annotations[ee]){if(this.$annotations[ee].className===" ace_error"){le=!0,ne=" ace_error_fold";break}this.$annotations[ee].className===" ace_warning"&&(le=!0,ne=" ace_warning_fold")}Z+=ne}else j+=" ace_open";H.className!=j&&(H.className=j),g.setStyle(H.style,"height",$),g.setStyle(H.style,"display","inline-block"),H.setAttribute("role","button"),H.setAttribute("tabindex","-1"),O=N.getFoldWidgetRange(P),O?H.setAttribute("aria-label",v("gutter.code-folding.range.aria-label","Toggle code folding, rows $0 through $1",[O.start.row+1,O.end.row+1])):S?H.setAttribute("aria-label",v("gutter.code-folding.closed.aria-label","Toggle code folding, rows $0 through $1",[S.start.row+1,S.end.row+1])):H.setAttribute("aria-label",v("gutter.code-folding.open.aria-label","Toggle code folding, row $0",[P+1])),Q?(H.setAttribute("aria-expanded","false"),H.setAttribute("title",v("gutter.code-folding.closed.title","Unfold code"))):(H.setAttribute("aria-expanded","true"),H.setAttribute("title",v("gutter.code-folding.open.title","Fold code")))}else H&&(g.setStyle(H.style,"display","none"),H.setAttribute("tabindex","0"),H.removeAttribute("role"),H.removeAttribute("aria-label"));if(le&&this.$showFoldedAnnotations){switch(V.className="ace_gutter_annotation",q.className=J,q.className+=ne,g.setStyle(q.style,"height",$),g.setStyle(V.style,"display","block"),g.setStyle(V.style,"height",$),ne){case" ace_error_fold":L=v("gutter.annotation.aria-label.error","Read annotations row $0",[ie]);break;case" ace_warning_fold":L=v("gutter.annotation.aria-label.warning","Read annotations row $0",[ie])}V.setAttribute("aria-label",L),V.setAttribute("tabindex","-1"),V.setAttribute("role","button")}else if(this.$annotations[P]){switch(V.className="ace_gutter_annotation",q.className=J,this.$useSvgGutterIcons?q.className+=this.$annotations[P].className:R.classList.add(this.$annotations[P].className.replace(" ","")),g.setStyle(q.style,"height",$),g.setStyle(V.style,"display","block"),g.setStyle(V.style,"height",$),this.$annotations[P].className){case" ace_error":L=v("gutter.annotation.aria-label.error","Read annotations row $0",[ie]);break;case" ace_warning":L=v("gutter.annotation.aria-label.warning","Read annotations row $0",[ie]);break;case" ace_info":L=v("gutter.annotation.aria-label.info","Read annotations row $0",[ie])}V.setAttribute("aria-label",L),V.setAttribute("tabindex","-1"),V.setAttribute("role","button")}else g.setStyle(V.style,"display","none"),V.removeAttribute("aria-label"),V.removeAttribute("role"),V.setAttribute("tabindex","0");return ie!==F.data&&(F.data=ie),R.className!=Z&&(R.className=Z),g.setStyle(E.element.style,"height",this.$lines.computeLineHeight(P,w,N)+"px"),g.setStyle(E.element.style,"top",this.$lines.computeLineTop(P,w,N)+"px"),E.text=ie,V.style.display==="none"&&H.style.display==="none"?E.element.setAttribute("aria-hidden",!0):E.element.setAttribute("aria-hidden",!1),E},I.prototype.setHighlightGutterLine=function(E){this.$highlightGutterLine=E},I.prototype.setShowLineNumbers=function(E){this.$renderer=!E&&{getWidth:function(){return 0},getText:function(){return""}}},I.prototype.getShowLineNumbers=function(){return this.$showLineNumbers},I.prototype.setShowFoldWidgets=function(E){E?g.addCssClass(this.element,"ace_folding-enabled"):g.removeCssClass(this.element,"ace_folding-enabled"),this.$showFoldWidgets=E,this.$padding=null},I.prototype.getShowFoldWidgets=function(){return this.$showFoldWidgets},I.prototype.$computePadding=function(){var E;return this.element.firstChild?(E=g.computedStyle(this.element.firstChild),this.$padding={},this.$padding.left=(parseInt(E.borderLeftWidth)||0)+(parseInt(E.paddingLeft)||0)+1,this.$padding.right=(parseInt(E.borderRightWidth)||0)+(parseInt(E.paddingRight)||0),this.$padding):{left:0,right:0}},I.prototype.getRegion=function(E){var w=this.$padding||this.$computePadding(),S=this.element.getBoundingClientRect();return E.x<w.left+S.left?"markers":this.$showFoldWidgets&&E.x>S.right-w.right?"foldWidgets":void 0},I);function I(E){this.element=g.createElement("div"),this.element.className="ace_layer ace_gutter-layer",E.appendChild(this.element),this.setShowFoldWidgets(this.$showFoldWidgets),this.gutterWidth=0,this.$annotations=[],this.$updateAnnotations=this.$updateAnnotations.bind(this),this.$lines=new A(this.element),this.$lines.$offsetCoefficient=1}function T(E){var w=document.createTextNode(""),w=(E.appendChild(w),g.createElement("span")),w=(E.appendChild(w),g.createElement("span")),S=(E.appendChild(w),g.createElement("span"));return w.appendChild(S),E}_.prototype.$fixedWidth=!1,_.prototype.$highlightGutterLine=!0,_.prototype.$renderer="",_.prototype.$showLineNumbers=!0,_.prototype.$showFoldWidgets=!0,b.implement(_.prototype,x),f.Gutter=_}),ace.define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],function(y,f,C){"use strict";var g=y("../range").Range,b=y("../lib/dom"),y=(x.prototype.setPadding=function(A){this.$padding=A},x.prototype.setSession=function(A){this.session=A},x.prototype.setMarkers=function(A){this.markers=A},x.prototype.elt=function(A,v){var _=this.i!=-1&&this.element.childNodes[this.i];_?this.i++:(_=document.createElement("div"),this.element.appendChild(_),this.i=-1),_.style.cssText=v,_.className=A},x.prototype.update=function(A){if(A){var v,_;for(_ in this.config=A,this.i=0,this.markers){var I,T,E,w=this.markers[_];w.range?(E=w.range.clipRows(A.firstRow,A.lastRow)).isEmpty()||(E=E.toScreenRange(this.session),w.renderer?(I=this.$getTop(E.start.row,A),T=this.$padding+E.start.column*A.characterWidth,w.renderer(v,E,T,I,A)):w.type=="fullLine"?this.drawFullLineMarker(v,E,w.clazz,A):w.type=="screenLine"?this.drawScreenLineMarker(v,E,w.clazz,A):E.isMultiLine()?w.type=="text"?this.drawTextMarker(v,E,w.clazz,A):this.drawMultiLineMarker(v,E,w.clazz,A):this.drawSingleLineMarker(v,E,w.clazz+" ace_start ace_br15",A)):w.update(v,this,this.session,A)}if(this.i!=-1)for(;this.i<this.element.childElementCount;)this.element.removeChild(this.element.lastChild)}},x.prototype.$getTop=function(A,v){return(A-v.firstRowScreen)*v.lineHeight},x.prototype.drawTextMarker=function(A,v,_,I,T){for(var E,w=this.session,S=v.start.row,P=v.end.row,k=S,L=0,R=w.getScreenLastRowColumn(k),N=new g(k,v.start.column,k,L);k<=P;k++)N.start.row=N.end.row=k,N.start.column=k==S?v.start.column:w.getRowWrapIndent(k),N.end.column=R,E=L,L=R,R=k+1<P?w.getScreenLastRowColumn(k+1):k==P?0:v.end.column,this.drawSingleLineMarker(A,N,_+(k==S?" ace_start":"")+" ace_br"+((k==S||k==S+1&&v.start.column?1:0)|(E<L?2:0)|(R<L?4:0)|(k==P?8:0)),I,k==P?0:1,T)},x.prototype.drawMultiLineMarker=function(A,v,_,I,T){var E,w=this.$padding,S=I.lineHeight,P=this.$getTop(v.start.row,I),k=w+v.start.column*I.characterWidth;T=T||"",this.session.$bidiHandler.isBidiRow(v.start.row)?((E=v.clone()).end.row=E.start.row,E.end.column=this.session.getLine(E.start.row).length,this.drawBidiSingleLineMarker(A,E,_+" ace_br1 ace_start",I,null,T)):this.elt(_+" ace_br1 ace_start","height:"+S+"px;right:0;top:"+P+"px;left:"+k+"px;"+(T||"")),this.session.$bidiHandler.isBidiRow(v.end.row)?((E=v.clone()).start.row=E.end.row,E.start.column=0,this.drawBidiSingleLineMarker(A,E,_+" ace_br12",I,null,T)):(P=this.$getTop(v.end.row,I),k=v.end.column*I.characterWidth,this.elt(_+" ace_br12","height:"+S+"px;width:"+k+"px;top:"+P+"px;left:"+w+"px;"+(T||""))),(S=(v.end.row-v.start.row-1)*I.lineHeight)<=0||(P=this.$getTop(v.start.row+1,I),A=(v.start.column?1:0)|(v.end.column?0:8),this.elt(_+(A?" ace_br"+A:""),"height:"+S+"px;right:0;top:"+P+"px;left:"+w+"px;"+(T||"")))},x.prototype.drawSingleLineMarker=function(w,k,_,I,S,E){if(this.session.$bidiHandler.isBidiRow(k.start.row))return this.drawBidiSingleLineMarker(w,k,_,I,S,E);var w=I.lineHeight,S=(k.end.column+(S||0)-k.start.column)*I.characterWidth,P=this.$getTop(k.start.row,I),k=this.$padding+k.start.column*I.characterWidth;this.elt(_,"height:"+w+"px;width:"+S+"px;top:"+P+"px;left:"+k+"px;"+(E||""))},x.prototype.drawBidiSingleLineMarker=function(A,v,_,I,T,E){var w=I.lineHeight,S=this.$getTop(v.start.row,I),P=this.$padding;this.session.$bidiHandler.getSelections(v.start.column,v.end.column).forEach(function(k){this.elt(_,"height:"+w+"px;width:"+(k.width+(T||0))+"px;top:"+S+"px;left:"+(P+k.left)+"px;"+(E||""))},this)},x.prototype.drawFullLineMarker=function(A,v,_,I,T){var E=this.$getTop(v.start.row,I),w=I.lineHeight;v.start.row!=v.end.row&&(w+=this.$getTop(v.end.row,I)-E),this.elt(_,"height:"+w+"px;top:"+E+"px;left:0;right:0;"+(T||""))},x.prototype.drawScreenLineMarker=function(A,v,_,I,T){v=this.$getTop(v.start.row,I),I=I.lineHeight,this.elt(_,"height:"+I+"px;top:"+v+"px;left:0;right:0;"+(T||""))},x);function x(A){this.element=b.createElement("div"),this.element.className="ace_layer ace_marker-layer",A.appendChild(this.element)}y.prototype.$padding=0,f.Marker=y}),ace.define("ace/layer/text_util",["require","exports","module"],function(h,f,C){var g=new Set(["text","rparen","lparen"]);f.isTextToken=function(b){return g.has(b)}}),ace.define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/layer/lines","ace/lib/event_emitter","ace/config","ace/layer/text_util"],function(I,f,C){"use strict";var g=I("../lib/oop"),b=I("../lib/dom"),y=I("../lib/lang"),x=I("./lines").Lines,A=I("../lib/event_emitter").EventEmitter,v=I("../config").nls,_=I("./text_util").isTextToken,I=(T.prototype.$updateEolChar=function(){var E=this.session.doc,E=E.getNewLineCharacter()==`
`&&E.getNewLineMode()!="windows"?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=E)return this.EOL_CHAR=E,!0},T.prototype.setPadding=function(E){this.$padding=E,this.element.style.margin="0 "+E+"px"},T.prototype.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0},T.prototype.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0},T.prototype.$setFontMetrics=function(E){this.$fontMetrics=E,this.$fontMetrics.on("changeCharacterSize",(function(w){this._signal("changeCharacterSize",w)}).bind(this)),this.$pollSizeChanges()},T.prototype.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()},T.prototype.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()},T.prototype.setSession=function(E){(this.session=E)&&this.$computeTabString()},T.prototype.setShowInvisibles=function(E){return this.showInvisibles!=E&&(typeof(this.showInvisibles=E)=="string"?(this.showSpaces=/tab/i.test(E),this.showTabs=/space/i.test(E),this.showEOL=/eol/i.test(E)):this.showSpaces=this.showTabs=this.showEOL=E,this.$computeTabString(),!0)},T.prototype.setDisplayIndentGuides=function(E){return this.displayIndentGuides!=E&&(this.displayIndentGuides=E,this.$computeTabString(),!0)},T.prototype.setHighlightIndentGuides=function(E){return this.$highlightIndentGuides!==E&&(this.$highlightIndentGuides=E)},T.prototype.$computeTabString=function(){for(var E,w,S,P,k,L,R=this.session.getTabSize(),N=(this.tabSize=R,this.$tabStrings=[0]),F=1;F<R+1;F++)this.showTabs?((L=this.dom.createElement("span")).className="ace_invisible ace_invisible_tab",L.textContent=y.stringRepeat(this.TAB_CHAR,F),N.push(L)):N.push(this.dom.createTextNode(y.stringRepeat(" ",F),this.element));this.displayIndentGuides&&(this.$indentGuideRe=/\s\S| \t|\t |\s$/,E="ace_indent-guide",w=this.showSpaces?" ace_invisible ace_invisible_space":"",S=this.showSpaces?y.stringRepeat(this.SPACE_CHAR,this.tabSize):y.stringRepeat(" ",this.tabSize),P=this.showTabs?" ace_invisible ace_invisible_tab":"",k=this.showTabs?y.stringRepeat(this.TAB_CHAR,this.tabSize):S,(L=this.dom.createElement("span")).className=E+w,L.textContent=S,this.$tabStrings[" "]=L,(L=this.dom.createElement("span")).className=E+P,L.textContent=k,this.$tabStrings["	"]=L)},T.prototype.updateLines=function(E,w,S){if(this.config.lastRow!=E.lastRow||this.config.firstRow!=E.firstRow)return this.update(E);this.config=E;for(var P=Math.max(w,E.firstRow),k=Math.min(S,E.lastRow),L=this.element.childNodes,R=0,N=E.firstRow;N<P;N++){if(F=this.session.getFoldLine(N)){if(F.containsRow(P)){P=F.start.row;break}N=F.end.row}R++}for(var F,H=!1,N=P,V=(F=this.session.getNextFoldLine(N))?F.start.row:1/0;V<N&&(N=F.end.row+1,V=(F=this.session.getNextFoldLine(N,F))?F.start.row:1/0),!(k<N);){var q,Q=L[R++];Q&&(this.dom.removeChildren(Q),this.$renderLine(Q,N,N==V&&F),H&&(Q.style.top=this.$lines.computeLineTop(N,E,this.session)+"px"),q=E.lineHeight*this.session.getRowLength(N)+"px",Q.style.height!=q)&&(H=!0,Q.style.height=q),N++}if(H)for(;R<this.$lines.cells.length;){var O=this.$lines.cells[R++];O.element.style.top=this.$lines.computeLineTop(O.row,E,this.session)+"px"}},T.prototype.scrollLines=function(E){var w=this.config;if(this.config=E,this.$lines.pageChanged(w,E))return this.update(E);this.$lines.moveContainer(E);var S=E.lastRow,P=w?w.lastRow:-1;if(!w||P<E.firstRow)return this.update(E);if(S<w.firstRow)return this.update(E);if(!w||w.lastRow<E.firstRow)return this.update(E);if(E.lastRow<w.firstRow)return this.update(E);if(w.firstRow<E.firstRow)for(var k=this.session.getFoldedRowCount(w.firstRow,E.firstRow-1);0<k;k--)this.$lines.shift();if(w.lastRow>E.lastRow)for(k=this.session.getFoldedRowCount(E.lastRow+1,w.lastRow);0<k;k--)this.$lines.pop();E.firstRow<w.firstRow&&this.$lines.unshift(this.$renderLinesFragment(E,E.firstRow,w.firstRow-1)),E.lastRow>w.lastRow&&this.$lines.push(this.$renderLinesFragment(E,w.lastRow+1,E.lastRow)),this.$highlightIndentGuide()},T.prototype.$renderLinesFragment=function(E,w,S){for(var P=[],k=w,L=this.session.getNextFoldLine(k),R=L?L.start.row:1/0;R<k&&(k=L.end.row+1,R=(L=this.session.getNextFoldLine(k,L))?L.start.row:1/0),!(S<k);){var N=this.$lines.createCell(k,E,this.session),F=N.element;this.dom.removeChildren(F),b.setStyle(F.style,"height",this.$lines.computeLineHeight(k,E,this.session)+"px"),b.setStyle(F.style,"top",this.$lines.computeLineTop(k,E,this.session)+"px"),this.$renderLine(F,k,k==R&&L),this.$useLineGroups()?F.className="ace_line_group":F.className="ace_line",P.push(N),k++}return P},T.prototype.update=function(E){this.$lines.moveContainer(E);for(var w=(this.config=E).firstRow,S=E.lastRow,P=this.$lines;P.getLength();)P.pop();P.push(this.$renderLinesFragment(E,w,S))},T.prototype.$renderToken=function(E,w,S,P){for(var k,L,R=this,N=/(\t)|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\uFEFF\uFFF9-\uFFFC\u2066\u2067\u2068\u202A\u202B\u202D\u202E\u202C\u2069]+)|(\u3000)|([\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3001-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF])/g,F=this.dom.createFragment(this.element),H=0;k=N.exec(P);){var V,q,Q=k[1],O=k[2],B=k[3],j=k[4],U=k[5];!R.showSpaces&&O||(V=H!=k.index?P.slice(H,k.index):"",H=k.index+k[0].length,V&&F.appendChild(this.dom.createTextNode(V,this.element)),Q?(V=R.session.getScreenTabSize(w+k.index),F.appendChild(R.$tabStrings[V].cloneNode(!0)),w+=V-1):O?R.showSpaces?((q=this.dom.createElement("span")).className="ace_invisible ace_invisible_space",q.textContent=y.stringRepeat(R.SPACE_CHAR,O.length),F.appendChild(q)):F.appendChild(this.dom.createTextNode(O,this.element)):B?((q=this.dom.createElement("span")).className="ace_invisible ace_invisible_space ace_invalid",q.textContent=y.stringRepeat(R.SPACE_CHAR,B.length),F.appendChild(q)):j?(w+=1,(q=this.dom.createElement("span")).style.width=2*R.config.characterWidth+"px",q.className=R.showSpaces?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk",q.textContent=R.showSpaces?R.SPACE_CHAR:j,F.appendChild(q)):U&&(w+=1,(q=this.dom.createElement("span")).style.width=2*R.config.characterWidth+"px",q.className="ace_cjk",q.textContent=U,F.appendChild(q)))}return F.appendChild(this.dom.createTextNode(H?P.slice(H):P,this.element)),_(S.type)?E.appendChild(F):(L="ace_"+S.type.replace(/\./g," ace_"),q=this.dom.createElement("span"),S.type=="fold"&&(q.style.width=S.value.length*this.config.characterWidth+"px",q.setAttribute("title",v("inline-fold.closed.title","Unfold code"))),q.className=L,q.appendChild(F),E.appendChild(q)),w+P.length},T.prototype.renderIndentGuide=function(E,w,S){var P=w.search(this.$indentGuideRe);if(!(P<=0||S<=P)){if(w[0]==" "){for(var k=(P-=P%this.tabSize)/this.tabSize,L=0;L<k;L++)E.appendChild(this.$tabStrings[" "].cloneNode(!0));return this.$highlightIndentGuide(),w.substr(P)}if(w[0]=="	"){for(L=0;L<P;L++)E.appendChild(this.$tabStrings["	"].cloneNode(!0));return this.$highlightIndentGuide(),w.substr(P)}this.$highlightIndentGuide()}return w},T.prototype.$highlightIndentGuide=function(){if(this.$highlightIndentGuides&&this.displayIndentGuides){this.$highlightIndentGuideMarker={indentLevel:void 0,start:void 0,end:void 0,dir:void 0};var E=this.session.doc.$lines;if(E){var w=this.session.selection.getCursor(),S=/^\s*/.exec(this.session.doc.getLine(w.row))[0].length,P=Math.floor(S/this.tabSize);if(this.$highlightIndentGuideMarker={indentLevel:P,start:w.row},this.session.$bracketHighlight){for(var k=this.session.$bracketHighlight.ranges,L=0;L<k.length;L++)if(w.row!==k[L].start.row){this.$highlightIndentGuideMarker.end=k[L].start.row,w.row>k[L].start.row?this.$highlightIndentGuideMarker.dir=-1:this.$highlightIndentGuideMarker.dir=1;break}}if(!this.$highlightIndentGuideMarker.end&&E[w.row]!==""&&w.column===E[w.row].length)for(this.$highlightIndentGuideMarker.dir=1,L=w.row+1;L<E.length;L++){var R=E[L],N=/^\s*/.exec(R)[0].length;if(R!==""&&(this.$highlightIndentGuideMarker.end=L,N<=S))break}this.$renderHighlightIndentGuide()}}},T.prototype.$clearActiveIndentGuide=function(){for(var E=this.$lines.cells,w=0;w<E.length;w++){var S=E[w].element.childNodes;if(0<S.length){for(var P=0;P<S.length;P++)if(S[P].classList&&S[P].classList.contains("ace_indent-guide-active")){S[P].classList.remove("ace_indent-guide-active");break}}}},T.prototype.$setIndentGuideActive=function(E,w){this.session.doc.getLine(E.row)!==""&&(E=E.element.childNodes)&&(E=E[w-1])&&E.classList&&E.classList.contains("ace_indent-guide")&&E.classList.add("ace_indent-guide-active")},T.prototype.$renderHighlightIndentGuide=function(){if(this.$lines){var E=this.$lines.cells,w=(this.$clearActiveIndentGuide(),this.$highlightIndentGuideMarker.indentLevel);if(w!==0){if(this.$highlightIndentGuideMarker.dir===1)for(var S=0;S<E.length;S++){var P=E[S];if(this.$highlightIndentGuideMarker.end&&P.row>=this.$highlightIndentGuideMarker.start+1){if(P.row>=this.$highlightIndentGuideMarker.end)break;this.$setIndentGuideActive(P,w)}}else for(S=E.length-1;0<=S;S--)if(P=E[S],this.$highlightIndentGuideMarker.end&&P.row<this.$highlightIndentGuideMarker.start){if(P.row<=this.$highlightIndentGuideMarker.end)break;this.$setIndentGuideActive(P,w)}}}},T.prototype.$createLineElement=function(E){var w=this.dom.createElement("div");return w.className="ace_line",w.style.height=this.config.lineHeight+"px",w},T.prototype.$renderWrappedLine=function(E,w,S){var P=0,k=0,L=S[0],R=0,N=this.$createLineElement();E.appendChild(N);for(var F=0;F<w.length;F++){var H=w[F],V=H.value;if(F==0&&this.displayIndentGuides){if(P=V.length,!(V=this.renderIndentGuide(N,V,L)))continue;P-=V.length}if(P+V.length<L)R=this.$renderToken(N,R,H,V),P+=V.length;else{for(;P+V.length>=L;)R=this.$renderToken(N,R,H,V.substring(0,L-P)),V=V.substring(L-P),P=L,N=this.$createLineElement(),E.appendChild(N),N.appendChild(this.dom.createTextNode(y.stringRepeat("\xA0",S.indent),this.element)),R=0,L=S[++k]||Number.MAX_VALUE;V.length!=0&&(P+=V.length,R=this.$renderToken(N,R,H,V))}}S[S.length-1]>this.MAX_LINE_LENGTH&&this.$renderOverflowMessage(N,R,null,"",!0)},T.prototype.$renderSimpleLine=function(E,w){for(var S=0,P=0;P<w.length;P++){var k=w[P],L=k.value;if(P!=0||!this.displayIndentGuides||(L=this.renderIndentGuide(E,L))){if(S+L.length>this.MAX_LINE_LENGTH)return this.$renderOverflowMessage(E,S,k,L);S=this.$renderToken(E,S,k,L)}}},T.prototype.$renderOverflowMessage=function(E,w,S,P,k){S&&this.$renderToken(E,w,S,P.slice(0,this.MAX_LINE_LENGTH-w)),S=this.dom.createElement("span"),S.className="ace_inline_button ace_keyword ace_toggle_wrap",S.textContent=k?"<hide>":"<click to see more...>",E.appendChild(S)},T.prototype.$renderLine=function(E,w,S){var P,k,L=E;(P=(S=S||S==0?S:this.session.getFoldLine(w))?this.$getFoldLineTokens(w,S):this.session.getTokens(w)).length?(k=this.session.getRowSplitData(w))&&k.length?(this.$renderWrappedLine(E,P,k),L=E.lastChild):(L=E,this.$useLineGroups()&&(L=this.$createLineElement(),E.appendChild(L)),this.$renderSimpleLine(L,P)):this.$useLineGroups()&&(L=this.$createLineElement(),E.appendChild(L)),this.showEOL&&L&&(S&&(w=S.end.row),(k=this.dom.createElement("span")).className="ace_invisible ace_invisible_eol",k.textContent=w==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,L.appendChild(k))},T.prototype.$getFoldLineTokens=function(E,w){var S=this.session,P=[],k=S.getTokens(E);return w.walk(function(L,R,N,F,H){if(L!=null)P.push({type:"fold",value:L});else if((k=H?S.getTokens(R):k).length){for(var V,q=k,Q=F,O=N,B=0,j=0;j+q[B].value.length<Q;)if(j+=q[B].value.length,++B==q.length)return;for(j!=Q&&((V=q[B].value.substring(Q-j)).length>O-Q&&(V=V.substring(0,O-Q)),P.push({type:q[B].type,value:V}),j=Q+V.length,B+=1);j<O&&B<q.length;)(V=q[B].value).length+j>O?P.push({type:q[B].type,value:V.substring(0,O-j)}):P.push(q[B]),j+=V.length,B+=1}},w.end.row,this.session.getLine(w.end.row).length),P},T.prototype.$useLineGroups=function(){return this.session.getUseWrapMode()},T);function T(E){this.dom=b,this.element=this.dom.createElement("div"),this.element.className="ace_layer ace_text-layer",E.appendChild(this.element),this.$updateEolChar=this.$updateEolChar.bind(this),this.$lines=new x(this.element)}I.prototype.EOF_CHAR="\xB6",I.prototype.EOL_CHAR_LF="\xAC",I.prototype.EOL_CHAR_CRLF="\xA4",I.prototype.EOL_CHAR=I.prototype.EOL_CHAR_LF,I.prototype.TAB_CHAR="\u2014",I.prototype.SPACE_CHAR="\xB7",I.prototype.$padding=0,I.prototype.MAX_LINE_LENGTH=1e4,I.prototype.showInvisibles=!1,I.prototype.showSpaces=!1,I.prototype.showTabs=!1,I.prototype.showEOL=!1,I.prototype.displayIndentGuides=!0,I.prototype.$highlightIndentGuides=!0,I.prototype.$tabStrings=[],I.prototype.destroy={},I.prototype.onChangeTabSize=I.prototype.$computeTabString,g.implement(I.prototype,A),f.Text=I}),ace.define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],function(b,f,C){"use strict";var g=b("../lib/dom"),b=(y.prototype.$updateOpacity=function(x){for(var A=this.cursors,v=A.length;v--;)g.setStyle(A[v].style,"opacity",x?"":"0")},y.prototype.$startCssAnimation=function(){for(var x=this.cursors,A=x.length;A--;)x[A].style.animationDuration=this.blinkInterval+"ms";this.$isAnimating=!0,setTimeout((function(){this.$isAnimating&&g.addCssClass(this.element,"ace_animate-blinking")}).bind(this))},y.prototype.$stopCssAnimation=function(){this.$isAnimating=!1,g.removeCssClass(this.element,"ace_animate-blinking")},y.prototype.setPadding=function(x){this.$padding=x},y.prototype.setSession=function(x){this.session=x},y.prototype.setBlinking=function(x){x!=this.isBlinking&&(this.isBlinking=x,this.restartTimer())},y.prototype.setBlinkInterval=function(x){x!=this.blinkInterval&&(this.blinkInterval=x,this.restartTimer())},y.prototype.setSmoothBlinking=function(x){x!=this.smoothBlinking&&(this.smoothBlinking=x,g.setCssClass(this.element,"ace_smooth-blinking",x),this.$updateCursors(!0),this.restartTimer())},y.prototype.addCursor=function(){var x=g.createElement("div");return x.className="ace_cursor",this.element.appendChild(x),this.cursors.push(x),x},y.prototype.removeCursor=function(){var x;if(1<this.cursors.length)return(x=this.cursors.pop()).parentNode.removeChild(x),x},y.prototype.hideCursor=function(){this.isVisible=!1,g.addCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},y.prototype.showCursor=function(){this.isVisible=!0,g.removeCssClass(this.element,"ace_hidden-cursors"),this.restartTimer()},y.prototype.restartTimer=function(){var x,A=this.$updateCursors;clearInterval(this.intervalId),clearTimeout(this.timeoutId),this.$stopCssAnimation(),this.smoothBlinking&&(this.$isSmoothBlinking=!1,g.removeCssClass(this.element,"ace_smooth-blinking")),A(!0),this.isBlinking&&this.blinkInterval&&this.isVisible?(this.smoothBlinking&&(this.$isSmoothBlinking=!0,setTimeout((function(){this.$isSmoothBlinking&&g.addCssClass(this.element,"ace_smooth-blinking")}).bind(this))),g.HAS_CSS_ANIMATION?this.$startCssAnimation():(x=(function(){this.timeoutId=setTimeout(function(){A(!1)},.6*this.blinkInterval)}).bind(this),this.intervalId=setInterval(function(){A(!0),x()},this.blinkInterval),x())):this.$stopCssAnimation()},y.prototype.getPixelPosition=function(x,A){if(!this.config||!this.session)return{left:0,top:0};x=x||this.session.selection.getCursor();var v=this.session.documentToScreenPosition(x);return{left:this.$padding+(this.session.$bidiHandler.isBidiRow(v.row,x.row)?this.session.$bidiHandler.getPosLeft(v.column):v.column*this.config.characterWidth),top:(v.row-(A?this.config.firstRowScreen:0))*this.config.lineHeight}},y.prototype.isCursorInView=function(x,A){return 0<=x.top&&x.top<A.maxHeight},y.prototype.update=function(x){this.config=x;for(var A=this.session.$selectionMarkers,_=0,v=0,_=0,I=(A=A!==void 0&&A.length!==0?A:[{cursor:null}]).length;_<I;_++){var T,E,w=this.getPixelPosition(A[_].cursor,!0);(w.top>x.height+x.offset||w.top<0)&&1<_||(E=(T=this.cursors[v++]||this.addCursor()).style,this.drawCursor?this.drawCursor(T,w,x,A[_],this.session):this.isCursorInView(w,x)?(g.setStyle(E,"display","block"),g.translate(T,w.left,w.top),g.setStyle(E,"width",Math.round(x.characterWidth)+"px"),g.setStyle(E,"height",x.lineHeight+"px")):g.setStyle(E,"display","none"))}for(;this.cursors.length>v;)this.removeCursor();var S=this.session.getOverwrite();this.$setOverwrite(S),this.$pixelPos=w,this.restartTimer()},y.prototype.$setOverwrite=function(x){x!=this.overwrite&&((this.overwrite=x)?g.addCssClass(this.element,"ace_overwrite-cursors"):g.removeCssClass(this.element,"ace_overwrite-cursors"))},y.prototype.destroy=function(){clearInterval(this.intervalId),clearTimeout(this.timeoutId)},y);function y(x){this.element=g.createElement("div"),this.element.className="ace_layer ace_cursor-layer",x.appendChild(this.element),this.isVisible=!1,this.isBlinking=!0,this.blinkInterval=1e3,this.smoothBlinking=!1,this.cursors=[],this.cursor=this.addCursor(),g.addCssClass(this.element,"ace_hidden-cursors"),this.$updateCursors=this.$updateOpacity.bind(this)}b.prototype.$padding=0,b.prototype.drawCursor=null,f.Cursor=b}),ace.define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],function(w,f,C){"use strict";var g,b=this&&this.__extends||(g=function(P,k){return(g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(L,R){L.__proto__=R}:function(L,R){for(var N in R)Object.prototype.hasOwnProperty.call(R,N)&&(L[N]=R[N])}))(P,k)},function(P,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function L(){this.constructor=P}g(P,k),P.prototype=k===null?Object.create(k):(L.prototype=k.prototype,new L)}),I=w("./lib/oop"),y=w("./lib/dom"),x=w("./lib/event"),w=w("./lib/event_emitter").EventEmitter,A=(v.prototype.setVisible=function(P){this.element.style.display=P?"":"none",this.isVisible=P,this.coeff=1},v);function v(P,k){this.element=y.createElement("div"),this.element.className="ace_scrollbar ace_scrollbar"+k,this.inner=y.createElement("div"),this.inner.className="ace_scrollbar-inner",this.inner.textContent="\xA0",this.element.appendChild(this.inner),P.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,x.addListener(this.element,"scroll",this.onScroll.bind(this)),x.addListener(this.element,"mousedown",x.preventDefault)}I.implement(A.prototype,w),b(T,_=A),T.prototype.onScroll=function(){var P;this.skipEvent||(this.scrollTop=this.element.scrollTop,this.coeff!=1&&(P=this.element.clientHeight/this.scrollHeight,this.scrollTop=this.scrollTop*(1-P)/(this.coeff-P)),this._emit("scroll",{data:this.scrollTop})),this.skipEvent=!1},T.prototype.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},T.prototype.setHeight=function(P){this.element.style.height=P+"px"},T.prototype.setScrollHeight=function(P){32768<(this.scrollHeight=P)?(this.coeff=32768/P,P=32768):this.coeff!=1&&(this.coeff=1),this.inner.style.height=P+"px"},T.prototype.setScrollTop=function(P){this.scrollTop!=P&&(this.skipEvent=!0,this.scrollTop=P,this.element.scrollTop=P*this.coeff)};var _,I=T;function T(P,k){var L=_.call(this,P,"-v")||this;return L.scrollTop=0,L.scrollHeight=0,k.$scrollbarWidth=L.width=y.scrollbarWidth(P.ownerDocument),L.inner.style.width=L.element.style.width=(L.width||15)+5+"px",L.$minWidth=0,L}I.prototype.setInnerHeight=I.prototype.setScrollHeight,b(S,E=A),S.prototype.onScroll=function(){this.skipEvent||(this.scrollLeft=this.element.scrollLeft,this._emit("scroll",{data:this.scrollLeft})),this.skipEvent=!1},S.prototype.getHeight=function(){return this.isVisible?this.height:0},S.prototype.setWidth=function(P){this.element.style.width=P+"px"},S.prototype.setInnerWidth=function(P){this.inner.style.width=P+"px"},S.prototype.setScrollWidth=function(P){this.inner.style.width=P+"px"},S.prototype.setScrollLeft=function(P){this.scrollLeft!=P&&(this.skipEvent=!0,this.scrollLeft=this.element.scrollLeft=P)};var E,w=S;function S(P,k){return P=E.call(this,P,"-h")||this,P.scrollLeft=0,P.height=k.$scrollbarWidth,P.inner.style.height=P.element.style.height=(P.height||15)+5+"px",P}f.ScrollBar=I,f.ScrollBarV=I,f.ScrollBarH=w,f.VScrollBar=I,f.HScrollBar=w}),ace.define("ace/scrollbar_custom",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],function(w,f,C){"use strict";var g,b=this&&this.__extends||(g=function(P,k){return(g=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(L,R){L.__proto__=R}:function(L,R){for(var N in R)Object.prototype.hasOwnProperty.call(R,N)&&(L[N]=R[N])}))(P,k)},function(P,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function L(){this.constructor=P}g(P,k),P.prototype=k===null?Object.create(k):(L.prototype=k.prototype,new L)}),I=w("./lib/oop"),y=w("./lib/dom"),x=w("./lib/event"),w=w("./lib/event_emitter").EventEmitter,A=(y.importCssString(`.ace_editor>.ace_sb-v div, .ace_editor>.ace_sb-h div{
  position: absolute;
  background: rgba(128, 128, 128, 0.6);
  -moz-box-sizing: border-box;
  box-sizing: border-box;
  border: 1px solid #bbb;
  border-radius: 2px;
  z-index: 8;
}
.ace_editor>.ace_sb-v, .ace_editor>.ace_sb-h {
  position: absolute;
  z-index: 6;
  background: none;
  overflow: hidden!important;
}
.ace_editor>.ace_sb-v {
  z-index: 6;
  right: 0;
  top: 0;
  width: 12px;
}
.ace_editor>.ace_sb-v div {
  z-index: 8;
  right: 0;
  width: 100%;
}
.ace_editor>.ace_sb-h {
  bottom: 0;
  left: 0;
  height: 12px;
}
.ace_editor>.ace_sb-h div {
  bottom: 0;
  height: 100%;
}
.ace_editor>.ace_sb_grabbed {
  z-index: 8;
  background: #000;
}`,"ace_scrollbar.css",!1),v.prototype.setVisible=function(P){this.element.style.display=P?"":"none",this.isVisible=P,this.coeff=1},v);function v(P,k){this.element=y.createElement("div"),this.element.className="ace_sb"+k,this.inner=y.createElement("div"),this.inner.className="",this.element.appendChild(this.inner),this.VScrollWidth=12,this.HScrollHeight=12,P.appendChild(this.element),this.setVisible(!1),this.skipEvent=!1,x.addMultiMouseDownListener(this.element,[500,300,300],this,"onMouseDown")}I.implement(A.prototype,w),b(T,_=A),T.prototype.onMouseDown=function(P,k){var L,R,N,F,H;if(P==="mousedown"&&x.getButton(k)===0&&k.detail!==2)return k.target===this.inner?(L=this,R=k.clientY,N=k.clientY,F=this.thumbTop,x.capture(this.inner,function(V){R=V.clientY},function(){clearInterval(H)}),H=setInterval(function(){var V;R!==void 0&&(V=L.scrollTopFromThumbTop(F+R-N))!==L.scrollTop&&L._emit("scroll",{data:V})},20)):(P=k.clientY-this.element.getBoundingClientRect().top-this.thumbHeight/2,this._emit("scroll",{data:this.scrollTopFromThumbTop(P)})),x.preventDefault(k)},T.prototype.getHeight=function(){return this.height},T.prototype.scrollTopFromThumbTop=function(P){return P=P*(this.pageHeight-this.viewHeight)/(this.slideHeight-this.thumbHeight),(P>>=0)<0?P=0:P>this.pageHeight-this.viewHeight&&(P=this.pageHeight-this.viewHeight),P},T.prototype.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)},T.prototype.setHeight=function(P){this.height=Math.max(0,P),this.slideHeight=this.height,this.viewHeight=this.height,this.setScrollHeight(this.pageHeight,!0)},T.prototype.setScrollHeight=function(P,k){(this.pageHeight!==P||k)&&(this.pageHeight=P,this.thumbHeight=this.slideHeight*this.viewHeight/this.pageHeight,this.thumbHeight>this.slideHeight&&(this.thumbHeight=this.slideHeight),this.thumbHeight<15&&(this.thumbHeight=15),this.inner.style.height=this.thumbHeight+"px",this.scrollTop>this.pageHeight-this.viewHeight)&&(this.scrollTop=this.pageHeight-this.viewHeight,this.scrollTop<0&&(this.scrollTop=0),this._emit("scroll",{data:this.scrollTop}))},T.prototype.setScrollTop=function(P){this.scrollTop=P,this.thumbTop=(P=P<0?0:P)*(this.slideHeight-this.thumbHeight)/(this.pageHeight-this.viewHeight),this.inner.style.top=this.thumbTop+"px"};var _,I=T;function T(P,k){var L=_.call(this,P,"-v")||this;return L.scrollTop=0,L.scrollHeight=0,L.parent=P,L.width=L.VScrollWidth,L.renderer=k,L.inner.style.width=L.element.style.width=(L.width||15)+"px",L.$minWidth=0,L}I.prototype.setInnerHeight=I.prototype.setScrollHeight,b(S,E=A),S.prototype.onMouseDown=function(P,k){var L,R,N,F,H;if(P==="mousedown"&&x.getButton(k)===0&&k.detail!==2)return k.target===this.inner?(L=this,R=k.clientX,N=k.clientX,F=this.thumbLeft,x.capture(this.inner,function(V){R=V.clientX},function(){clearInterval(H)}),H=setInterval(function(){var V;R!==void 0&&(V=L.scrollLeftFromThumbLeft(F+R-N))!==L.scrollLeft&&L._emit("scroll",{data:V})},20)):(P=k.clientX-this.element.getBoundingClientRect().left-this.thumbWidth/2,this._emit("scroll",{data:this.scrollLeftFromThumbLeft(P)})),x.preventDefault(k)},S.prototype.getHeight=function(){return this.isVisible?this.height:0},S.prototype.scrollLeftFromThumbLeft=function(P){return P=P*(this.pageWidth-this.viewWidth)/(this.slideWidth-this.thumbWidth),(P>>=0)<0?P=0:P>this.pageWidth-this.viewWidth&&(P=this.pageWidth-this.viewWidth),P},S.prototype.setWidth=function(P){this.width=Math.max(0,P),this.element.style.width=this.width+"px",this.slideWidth=this.width,this.viewWidth=this.width,this.setScrollWidth(this.pageWidth,!0)},S.prototype.setScrollWidth=function(P,k){(this.pageWidth!==P||k)&&(this.pageWidth=P,this.thumbWidth=this.slideWidth*this.viewWidth/this.pageWidth,this.thumbWidth>this.slideWidth&&(this.thumbWidth=this.slideWidth),this.thumbWidth<15&&(this.thumbWidth=15),this.inner.style.width=this.thumbWidth+"px",this.scrollLeft>this.pageWidth-this.viewWidth)&&(this.scrollLeft=this.pageWidth-this.viewWidth,this.scrollLeft<0&&(this.scrollLeft=0),this._emit("scroll",{data:this.scrollLeft}))},S.prototype.setScrollLeft=function(P){this.scrollLeft=P,this.thumbLeft=(P=P<0?0:P)*(this.slideWidth-this.thumbWidth)/(this.pageWidth-this.viewWidth),this.inner.style.left=this.thumbLeft+"px"};var E,w=S;function S(P,k){return P=E.call(this,P,"-h")||this,P.scrollLeft=0,P.scrollWidth=0,P.height=P.HScrollHeight,P.inner.style.height=P.element.style.height=(P.height||12)+"px",P.renderer=k,P}w.prototype.setInnerWidth=w.prototype.setScrollWidth,f.ScrollBar=I,f.ScrollBarV=I,f.ScrollBarH=w,f.VScrollBar=I,f.HScrollBar=w}),ace.define("ace/renderloop",["require","exports","module","ace/lib/event"],function(h,f,C){"use strict";var g=h("./lib/event");function b(y,x){this.onRender=y,this.pending=!1,this.changes=0,this.$recursionLimit=2,this.window=x||window;var A=this;this._flush=function(v){A.pending=!1;var _=A.changes;_&&(g.blockIdle(100),A.changes=0,A.onRender(_)),A.changes?A.$recursionLimit--<0||A.schedule():A.$recursionLimit=2}}b.prototype.schedule=function(y){this.changes=this.changes|y,this.changes&&!this.pending&&(g.nextFrame(this._flush),this.pending=!0)},b.prototype.clear=function(y){var x=this.changes;return this.changes=0,x},f.RenderLoop=b}),ace.define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/lib/useragent","ace/lib/event_emitter"],function(v,f,C){var g=v("../lib/oop"),b=v("../lib/dom"),y=v("../lib/lang"),x=v("../lib/event"),A=v("../lib/useragent"),v=v("../lib/event_emitter").EventEmitter,_=typeof ResizeObserver=="function",I=(T.prototype.$setMeasureNodeStyles=function(E,w){E.width=E.height="auto",E.left=E.top="0px",E.visibility="hidden",E.position="absolute",E.whiteSpace="pre",A.isIE<8?E["font-family"]="inherit":E.font="inherit",E.overflow=w?"hidden":"visible"},T.prototype.checkForSizeChanges=function(E){var w;!(E=E===void 0?this.$measureSizes():E)||this.$characterSize.width===E.width&&this.$characterSize.height===E.height||(this.$measureNode.style.fontWeight="bold",w=this.$measureSizes(),this.$measureNode.style.fontWeight="",this.$characterSize=E,this.charSizes=Object.create(null),this.allowBoldFonts=w&&w.width===E.width&&w.height===E.height,this._emit("changeCharacterSize",{data:E}))},T.prototype.$addObserver=function(){var E=this;this.$observer=new window.ResizeObserver(function(w){E.checkForSizeChanges()}),this.$observer.observe(this.$measureNode)},T.prototype.$pollSizeChanges=function(){var E;return this.$pollSizeChangesTimer||this.$observer?this.$pollSizeChangesTimer:(E=this).$pollSizeChangesTimer=x.onIdle(function w(){E.checkForSizeChanges(),x.onIdle(w,500)},500)},T.prototype.setPolling=function(E){E?this.$pollSizeChanges():this.$pollSizeChangesTimer&&(clearInterval(this.$pollSizeChangesTimer),this.$pollSizeChangesTimer=0)},T.prototype.$measureSizes=function(E){return E={height:(E||this.$measureNode).clientHeight,width:(E||this.$measureNode).clientWidth/512},E.width===0||E.height===0?null:E},T.prototype.$measureCharWidth=function(E){return this.$main.textContent=y.stringRepeat(E,512),this.$main.getBoundingClientRect().width/512},T.prototype.getCharacterWidth=function(E){var w=this.charSizes[E];return w=w===void 0?this.charSizes[E]=this.$measureCharWidth(E)/this.$characterSize.width:w},T.prototype.destroy=function(){clearInterval(this.$pollSizeChangesTimer),this.$observer&&this.$observer.disconnect(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)},T.prototype.$getZoom=function(E){return E&&E.parentElement?(window.getComputedStyle(E).zoom||1)*this.$getZoom(E.parentElement):1},T.prototype.$initTransformMeasureNodes=function(){function E(w,S){return["div",{style:"position: absolute;top:"+w+"px;left:"+S+"px;"}]}this.els=b.buildDom([E(0,0),E(200,0),E(0,200),E(200,200)],this.el)},T.prototype.transformCoordinates=function(E,w){function S(Q,O,B){var j=Q[1]*O[0]-Q[0]*O[1];return[(-O[1]*B[0]+O[0]*B[1])/j,(+Q[1]*B[0]-Q[0]*B[1])/j]}function P(Q,O){return[Q[0]-O[0],Q[1]-O[1]]}function k(Q,O){return[Q[0]+O[0],Q[1]+O[1]]}function L(Q,O){return[Q*O[0],Q*O[1]]}function R(Q){return Q=Q.getBoundingClientRect(),[Q.left,Q.top]}E=E&&L(1/this.$getZoom(this.el),E),this.els||this.$initTransformMeasureNodes();var N,F=R(this.els[0]),V=R(this.els[1]),q=R(this.els[2]),H=R(this.els[3]),H=S(P(H,V),P(H,q),P(k(V,q),k(H,F))),V=L(1+H[0],P(V,F)),q=L(1+H[1],P(q,F));return w?(N=H[0]*w[0]/200+H[1]*w[1]/200+1,w=k(L(w[0],V),L(w[1],q)),k(L(1/N/200,w),F)):(N=P(E,F),w=S(P(V,L(H[0],N)),P(q,L(H[1],N)),N),L(200,w))},T);function T(E){this.el=b.createElement("div"),this.$setMeasureNodeStyles(this.el.style,!0),this.$main=b.createElement("div"),this.$setMeasureNodeStyles(this.$main.style),this.$measureNode=b.createElement("div"),this.$setMeasureNodeStyles(this.$measureNode.style),this.el.appendChild(this.$main),this.el.appendChild(this.$measureNode),E.appendChild(this.el),this.$measureNode.textContent=y.stringRepeat("X",512),this.$characterSize={width:0,height:0},_?this.$addObserver():this.checkForSizeChanges()}I.prototype.$characterSize={width:0,height:0},g.implement(I.prototype,v),f.FontMetrics=I}),ace.define("ace/css/editor-css",["require","exports","module"],function(h,f,C){C.exports=`
.ace_br1 {border-top-left-radius    : 3px;}
.ace_br2 {border-top-right-radius   : 3px;}
.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}
.ace_br4 {border-bottom-right-radius: 3px;}
.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}
.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}
.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}
.ace_br8 {border-bottom-left-radius : 3px;}
.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}
.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}
.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}
.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}
.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}
.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}
.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}


.ace_editor {
    position: relative;
    overflow: hidden;
    padding: 0;
    font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'Source Code Pro', 'source-code-pro', monospace;
    direction: ltr;
    text-align: left;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.ace_scroller {
    position: absolute;
    overflow: hidden;
    top: 0;
    bottom: 0;
    background-color: inherit;
    -ms-user-select: none;
    -moz-user-select: none;
    -webkit-user-select: none;
    user-select: none;
    cursor: text;
}

.ace_content {
    position: absolute;
    box-sizing: border-box;
    min-width: 100%;
    contain: style size layout;
    font-variant-ligatures: no-common-ligatures;
}

.ace_keyboard-focus:focus {
    box-shadow: inset 0 0 0 2px #5E9ED6;
    outline: none;
}

.ace_dragging .ace_scroller:before{
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    content: '';
    background: rgba(250, 250, 250, 0.01);
    z-index: 1000;
}
.ace_dragging.ace_dark .ace_scroller:before{
    background: rgba(0, 0, 0, 0.01);
}

.ace_gutter {
    position: absolute;
    overflow : hidden;
    width: auto;
    top: 0;
    bottom: 0;
    left: 0;
    cursor: default;
    z-index: 4;
    -ms-user-select: none;
    -moz-user-select: none;
    -webkit-user-select: none;
    user-select: none;
    contain: style size layout;
}

.ace_gutter-active-line {
    position: absolute;
    left: 0;
    right: 0;
}

.ace_scroller.ace_scroll-left:after {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;
    pointer-events: none;
}

.ace_gutter-cell, .ace_gutter-cell_svg-icons {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    padding-left: 19px;
    padding-right: 6px;
    background-repeat: no-repeat;
}

.ace_gutter-cell_svg-icons .ace_gutter_annotation {
    margin-left: -14px;
    float: left;
}

.ace_gutter-cell .ace_gutter_annotation {
    margin-left: -19px;
    float: left;
}

.ace_gutter-cell.ace_error, .ace_icon.ace_error, .ace_icon.ace_error_fold {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");
    background-repeat: no-repeat;
    background-position: 2px center;
}

.ace_gutter-cell.ace_warning, .ace_icon.ace_warning, .ace_icon.ace_warning_fold {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");
    background-repeat: no-repeat;
    background-position: 2px center;
}

.ace_gutter-cell.ace_info, .ace_icon.ace_info {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");
    background-repeat: no-repeat;
    background-position: 2px center;
}
.ace_dark .ace_gutter-cell.ace_info, .ace_dark .ace_icon.ace_info {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");
}

.ace_icon_svg.ace_error {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAxNiI+CjxnIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlPSJyZWQiIHNoYXBlLXJlbmRlcmluZz0iZ2VvbWV0cmljUHJlY2lzaW9uIj4KPGNpcmNsZSBmaWxsPSJub25lIiBjeD0iOCIgY3k9IjgiIHI9IjciIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPGxpbmUgeDE9IjExIiB5MT0iNSIgeDI9IjUiIHkyPSIxMSIvPgo8bGluZSB4MT0iMTEiIHkxPSIxMSIgeDI9IjUiIHkyPSI1Ii8+CjwvZz4KPC9zdmc+");
    background-color: crimson;
}
.ace_icon_svg.ace_warning {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAxNiI+CjxnIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlPSJkYXJrb3JhbmdlIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiI+Cjxwb2x5Z29uIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGZpbGw9Im5vbmUiIHBvaW50cz0iOCAxIDE1IDE1IDEgMTUgOCAxIi8+CjxyZWN0IHg9IjgiIHk9IjEyIiB3aWR0aD0iMC4wMSIgaGVpZ2h0PSIwLjAxIi8+CjxsaW5lIHgxPSI4IiB5MT0iNiIgeDI9IjgiIHkyPSIxMCIvPgo8L2c+Cjwvc3ZnPg==");
    background-color: darkorange;
}
.ace_icon_svg.ace_info {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAxNiI+CjxnIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlPSJibHVlIiBzaGFwZS1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiI+CjxjaXJjbGUgZmlsbD0ibm9uZSIgY3g9IjgiIGN5PSI4IiByPSI3IiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+Cjxwb2x5bGluZSBwb2ludHM9IjggMTEgOCA4Ii8+Cjxwb2x5bGluZSBwb2ludHM9IjkgOCA2IDgiLz4KPGxpbmUgeDE9IjEwIiB5MT0iMTEiIHgyPSI2IiB5Mj0iMTEiLz4KPHJlY3QgeD0iOCIgeT0iNSIgd2lkdGg9IjAuMDEiIGhlaWdodD0iMC4wMSIvPgo8L2c+Cjwvc3ZnPg==");
    background-color: royalblue;
}

.ace_icon_svg.ace_error_fold {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAxNiIgZmlsbD0ibm9uZSI+CiAgPHBhdGggZD0ibSAxOC45Mjk4NTEsNy44Mjk4MDc2IGMgMC4xNDYzNTMsNi4zMzc0NjA0IC02LjMyMzE0Nyw3Ljc3Nzg0NDQgLTcuNDc3OTEyLDcuNzc3ODQ0NCAtMi4xMDcyNzI2LC0wLjEyODc1IDUuMTE3Njc4LDAuMzU2MjQ5IDUuMDUxNjk4LC03Ljg3MDA2MTggLTAuNjA0NjcyLC04LjAwMzk3MzQ5IC03LjA3NzI3MDYsLTcuNTYzMTE4OSAtNC44NTczLC03LjQzMDM5NTU2IDEuNjA2LC0wLjExNTE0MjI1IDYuODk3NDg1LDEuMjYyNTQ1OTYgNy4yODM1MTQsNy41MjI2MTI5NiB6IiBmaWxsPSJjcmltc29uIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0ibSA4LjExNDc1NjIsMi4wNTI5ODI4IGMgMy4zNDkxNjk4LDAgNi4wNjQxMzI4LDIuNjc2ODYyNyA2LjA2NDEzMjgsNS45Nzg5NTMgMCwzLjMwMjExMjIgLTIuNzE0OTYzLDUuOTc4OTIwMiAtNi4wNjQxMzI4LDUuOTc4OTIwMiAtMy4zNDkxNDczLDAgLTYuMDY0MTc3MiwtMi42NzY4MDggLTYuMDY0MTc3MiwtNS45Nzg5MjAyIDAuMDA1MzksLTMuMjk5ODg2MSAyLjcxNzI2NTYsLTUuOTczNjQwOCA2LjA2NDE3NzIsLTUuOTc4OTUzIHogbSAwLC0xLjczNTgyNzE5IGMgLTQuMzIxNDgzNiwwIC03LjgyNDc0MDM4LDMuNDU0MDE4NDkgLTcuODI0NzQwMzgsNy43MTQ3ODAxOSAwLDQuMjYwNzI4MiAzLjUwMzI1Njc4LDcuNzE0NzQ1MiA3LjgyNDc0MDM4LDcuNzE0NzQ1MiA0LjMyMTQ0OTgsMCA3LjgyNDY5OTgsLTMuNDU0MDE3IDcuODI0Njk5OCwtNy43MTQ3NDUyIDAsLTIuMDQ2MDkxNCAtMC44MjQzOTIsLTQuMDA4MzY3MiAtMi4yOTE3NTYsLTUuNDU1MTc0NiBDIDEyLjE4MDIyNSwxLjEyOTk2NDggMTAuMTkwMDEzLDAuMzE3MTU1NjEgOC4xMTQ3NTYyLDAuMzE3MTU1NjEgWiBNIDYuOTM3NDU2Myw4LjI0MDU5ODUgNC42NzE4Njg1LDEwLjQ4NTg1MiA2LjAwODY4MTQsMTEuODc2NzI4IDguMzE3MDAzNSw5LjYwMDc5MTEgMTAuNjI1MzM3LDExLjg3NjcyOCAxMS45NjIxMzgsMTAuNDg1ODUyIDkuNjk2NTUwOCw4LjI0MDU5ODUgMTEuOTYyMTM4LDYuMDA2ODA2NiAxMC41NzMyNDYsNC42Mzc0MzM1IDguMzE3MDAzNSw2Ljg3MzQyOTcgNi4wNjA3NjA3LDQuNjM3NDMzNSA0LjY3MTg2ODUsNi4wMDY4MDY2IFoiIGZpbGw9ImNyaW1zb24iIHN0cm9rZS13aWR0aD0iMiIvPgo8L3N2Zz4=");
    background-color: crimson;
}
.ace_icon_svg.ace_warning_fold {
    -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyMCAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNC43NzY5IDE0LjczMzdMOC42NTE5MiAyLjQ4MzY5QzguMzI5NDYgMS44Mzg3NyA3LjQwOTEzIDEuODM4NzcgNy4wODY2NyAyLjQ4MzY5TDAuOTYxNjY5IDE0LjczMzdDMC42NzA3NzUgMTUuMzE1NSAxLjA5MzgzIDE2IDEuNzQ0MjkgMTZIMTMuOTk0M0MxNC42NDQ4IDE2IDE1LjA2NzggMTUuMzE1NSAxNC43NzY5IDE0LjczMzdaTTMuMTYwMDcgMTQuMjVMNy44NjkyOSA0LjgzMTU2TDEyLjU3ODUgMTQuMjVIMy4xNjAwN1pNOC43NDQyOSAxMS42MjVWMTMuMzc1SDYuOTk0MjlWMTEuNjI1SDguNzQ0MjlaTTYuOTk0MjkgMTAuNzVWNy4yNUg4Ljc0NDI5VjEwLjc1SDYuOTk0MjlaIiBmaWxsPSIjRUM3MjExIi8+CjxwYXRoIGQ9Ik0xMS4xOTkxIDIuOTUyMzhDMTAuODgwOSAyLjMxNDY3IDEwLjM1MzcgMS44MDUyNiA5LjcwNTUgMS41MDlMMTEuMDQxIDEuMDY5NzhDMTEuNjg4MyAwLjk0OTgxNCAxMi4zMzcgMS4yNzI2MyAxMi42MzE3IDEuODYxNDFMMTcuNjEzNiAxMS44MTYxQzE4LjM1MjcgMTMuMjkyOSAxNy41OTM4IDE1LjA4MDQgMTYuMDE4IDE1LjU3NDVDMTYuNDA0NCAxNC40NTA3IDE2LjMyMzEgMTMuMjE4OCAxNS43OTI0IDEyLjE1NTVMMTEuMTk5MSAyLjk1MjM4WiIgZmlsbD0iI0VDNzIxMSIvPgo8L3N2Zz4=");
    background-color: darkorange;
}

.ace_scrollbar {
    contain: strict;
    position: absolute;
    right: 0;
    bottom: 0;
    z-index: 6;
}

.ace_scrollbar-inner {
    position: absolute;
    cursor: text;
    left: 0;
    top: 0;
}

.ace_scrollbar-v{
    overflow-x: hidden;
    overflow-y: scroll;
    top: 0;
}

.ace_scrollbar-h {
    overflow-x: scroll;
    overflow-y: hidden;
    left: 0;
}

.ace_print-margin {
    position: absolute;
    height: 100%;
}

.ace_text-input {
    position: absolute;
    z-index: 0;
    width: 0.5em;
    height: 1em;
    opacity: 0;
    background: transparent;
    -moz-appearance: none;
    appearance: none;
    border: none;
    resize: none;
    outline: none;
    overflow: hidden;
    font: inherit;
    padding: 0 1px;
    margin: 0 -1px;
    contain: strict;
    -ms-user-select: text;
    -moz-user-select: text;
    -webkit-user-select: text;
    user-select: text;
    /*with \`pre-line\` chrome inserts &nbsp; instead of space*/
    white-space: pre!important;
}
.ace_text-input.ace_composition {
    background: transparent;
    color: inherit;
    z-index: 1000;
    opacity: 1;
}
.ace_composition_placeholder { color: transparent }
.ace_composition_marker { 
    border-bottom: 1px solid;
    position: absolute;
    border-radius: 0;
    margin-top: 1px;
}

[ace_nocontext=true] {
    transform: none!important;
    filter: none!important;
    clip-path: none!important;
    mask : none!important;
    contain: none!important;
    perspective: none!important;
    mix-blend-mode: initial!important;
    z-index: auto;
}

.ace_layer {
    z-index: 1;
    position: absolute;
    overflow: hidden;
    /* workaround for chrome bug https://github.com/ajaxorg/ace/issues/2312*/
    word-wrap: normal;
    white-space: pre;
    height: 100%;
    width: 100%;
    box-sizing: border-box;
    /* setting pointer-events: auto; on node under the mouse, which changes
        during scroll, will break mouse wheel scrolling in Safari */
    pointer-events: none;
}

.ace_gutter-layer {
    position: relative;
    width: auto;
    text-align: right;
    pointer-events: auto;
    height: 1000000px;
    contain: style size layout;
}

.ace_text-layer {
    font: inherit !important;
    position: absolute;
    height: 1000000px;
    width: 1000000px;
    contain: style size layout;
}

.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {
    contain: style size layout;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
}

.ace_hidpi .ace_text-layer,
.ace_hidpi .ace_gutter-layer,
.ace_hidpi .ace_content,
.ace_hidpi .ace_gutter {
    contain: strict;
}
.ace_hidpi .ace_text-layer > .ace_line, 
.ace_hidpi .ace_text-layer > .ace_line_group {
    contain: strict;
}

.ace_cjk {
    display: inline-block;
    text-align: center;
}

.ace_cursor-layer {
    z-index: 4;
}

.ace_cursor {
    z-index: 4;
    position: absolute;
    box-sizing: border-box;
    border-left: 2px solid;
    /* workaround for smooth cursor repaintng whole screen in chrome */
    transform: translatez(0);
}

.ace_multiselect .ace_cursor {
    border-left-width: 1px;
}

.ace_slim-cursors .ace_cursor {
    border-left-width: 1px;
}

.ace_overwrite-cursors .ace_cursor {
    border-left-width: 0;
    border-bottom: 1px solid;
}

.ace_hidden-cursors .ace_cursor {
    opacity: 0.2;
}

.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {
    opacity: 0;
}

.ace_smooth-blinking .ace_cursor {
    transition: opacity 0.18s;
}

.ace_animate-blinking .ace_cursor {
    animation-duration: 1000ms;
    animation-timing-function: step-end;
    animation-name: blink-ace-animate;
    animation-iteration-count: infinite;
}

.ace_animate-blinking.ace_smooth-blinking .ace_cursor {
    animation-duration: 1000ms;
    animation-timing-function: ease-in-out;
    animation-name: blink-ace-animate-smooth;
}
    
@keyframes blink-ace-animate {
    from, to { opacity: 1; }
    60% { opacity: 0; }
}

@keyframes blink-ace-animate-smooth {
    from, to { opacity: 1; }
    45% { opacity: 1; }
    60% { opacity: 0; }
    85% { opacity: 0; }
}

.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {
    position: absolute;
    z-index: 3;
}

.ace_marker-layer .ace_selection {
    position: absolute;
    z-index: 5;
}

.ace_marker-layer .ace_bracket {
    position: absolute;
    z-index: 6;
}

.ace_marker-layer .ace_error_bracket {
    position: absolute;
    border-bottom: 1px solid #DE5555;
    border-radius: 0;
}

.ace_marker-layer .ace_active-line {
    position: absolute;
    z-index: 2;
}

.ace_marker-layer .ace_selected-word {
    position: absolute;
    z-index: 4;
    box-sizing: border-box;
}

.ace_line .ace_fold {
    box-sizing: border-box;

    display: inline-block;
    height: 11px;
    margin-top: -2px;
    vertical-align: middle;

    background-image:
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");
    background-repeat: no-repeat, repeat-x;
    background-position: center center, top left;
    color: transparent;

    border: 1px solid black;
    border-radius: 2px;

    cursor: pointer;
    pointer-events: auto;
}

.ace_dark .ace_fold {
}

.ace_fold:hover{
    background-image:
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),
        url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");
}

.ace_tooltip {
    background-color: #f5f5f5;
    border: 1px solid gray;
    border-radius: 1px;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    color: black;
    max-width: 100%;
    padding: 3px 4px;
    position: fixed;
    z-index: 999999;
    box-sizing: border-box;
    cursor: default;
    white-space: pre-wrap;
    word-wrap: break-word;
    line-height: normal;
    font-style: normal;
    font-weight: normal;
    letter-spacing: normal;
    pointer-events: none;
    overflow: auto;
    max-width: min(60em, 66vw);
    overscroll-behavior: contain;
}
.ace_tooltip pre {
    white-space: pre-wrap;
}

.ace_tooltip.ace_dark {
    background-color: #636363;
    color: #fff;
}

.ace_tooltip:focus {
    outline: 1px solid #5E9ED6;
}

.ace_icon {
    display: inline-block;
    width: 18px;
    vertical-align: top;
}

.ace_icon_svg {
    display: inline-block;
    width: 12px;
    vertical-align: top;
    -webkit-mask-repeat: no-repeat;
    -webkit-mask-size: 12px;
    -webkit-mask-position: center;
}

.ace_folding-enabled > .ace_gutter-cell, .ace_folding-enabled > .ace_gutter-cell_svg-icons {
    padding-right: 13px;
}

.ace_fold-widget {
    box-sizing: border-box;

    margin: 0 -12px 0 1px;
    display: none;
    width: 11px;
    vertical-align: top;

    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");
    background-repeat: no-repeat;
    background-position: center;

    border-radius: 3px;
    
    border: 1px solid transparent;
    cursor: pointer;
}

.ace_folding-enabled .ace_fold-widget {
    display: inline-block;   
}

.ace_fold-widget.ace_end {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");
}

.ace_fold-widget.ace_closed {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");
}

.ace_fold-widget:hover {
    border: 1px solid rgba(0, 0, 0, 0.3);
    background-color: rgba(255, 255, 255, 0.2);
    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);
}

.ace_fold-widget:active {
    border: 1px solid rgba(0, 0, 0, 0.4);
    background-color: rgba(0, 0, 0, 0.05);
    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);
}
/**
 * Dark version for fold widgets
 */
.ace_dark .ace_fold-widget {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");
}
.ace_dark .ace_fold-widget.ace_end {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");
}
.ace_dark .ace_fold-widget.ace_closed {
    background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");
}
.ace_dark .ace_fold-widget:hover {
    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);
    background-color: rgba(255, 255, 255, 0.1);
}
.ace_dark .ace_fold-widget:active {
    box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);
}

.ace_inline_button {
    border: 1px solid lightgray;
    display: inline-block;
    margin: -1px 8px;
    padding: 0 5px;
    pointer-events: auto;
    cursor: pointer;
}
.ace_inline_button:hover {
    border-color: gray;
    background: rgba(200,200,200,0.2);
    display: inline-block;
    pointer-events: auto;
}

.ace_fold-widget.ace_invalid {
    background-color: #FFB4B4;
    border-color: #DE5555;
}

.ace_fade-fold-widgets .ace_fold-widget {
    transition: opacity 0.4s ease 0.05s;
    opacity: 0;
}

.ace_fade-fold-widgets:hover .ace_fold-widget {
    transition: opacity 0.05s ease 0.05s;
    opacity:1;
}

.ace_underline {
    text-decoration: underline;
}

.ace_bold {
    font-weight: bold;
}

.ace_nobold .ace_bold {
    font-weight: normal;
}

.ace_italic {
    font-style: italic;
}


.ace_error-marker {
    background-color: rgba(255, 0, 0,0.2);
    position: absolute;
    z-index: 9;
}

.ace_highlight-marker {
    background-color: rgba(255, 255, 0,0.2);
    position: absolute;
    z-index: 8;
}

.ace_mobile-menu {
    position: absolute;
    line-height: 1.5;
    border-radius: 4px;
    -ms-user-select: none;
    -moz-user-select: none;
    -webkit-user-select: none;
    user-select: none;
    background: white;
    box-shadow: 1px 3px 2px grey;
    border: 1px solid #dcdcdc;
    color: black;
}
.ace_dark > .ace_mobile-menu {
    background: #333;
    color: #ccc;
    box-shadow: 1px 3px 2px grey;
    border: 1px solid #444;

}
.ace_mobile-button {
    padding: 2px;
    cursor: pointer;
    overflow: hidden;
}
.ace_mobile-button:hover {
    background-color: #eee;
    opacity:1;
}
.ace_mobile-button:active {
    background-color: #ddd;
}

.ace_placeholder {
    font-family: arial;
    transform: scale(0.9);
    transform-origin: left;
    white-space: pre;
    opacity: 0.7;
    margin: 0 10px;
}

.ace_ghost_text {
    opacity: 0.5;
    font-style: italic;
    white-space: pre;
}

.ace_screenreader-only {
    position:absolute;
    left:-10000px;
    top:auto;
    width:1px;
    height:1px;
    overflow:hidden;
}`}),ace.define("ace/layer/decorators",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event_emitter"],function(y,f,C){"use strict";var g=y("../lib/dom"),b=y("../lib/oop"),y=y("../lib/event_emitter").EventEmitter,x=(A.prototype.$updateDecorators=function(v){var _=this.renderer.theme.isDark===!0?this.colors.dark:this.colors.light,I=(v&&(this.maxHeight=v.maxHeight,this.lineHeight=v.lineHeight,this.canvasHeight=v.height,(v.lastRow+1)*this.lineHeight<this.canvasHeight?this.heightRatio=1:this.heightRatio=this.canvasHeight/this.maxHeight),this.canvas.getContext("2d")),T=this.renderer.session.$annotations;if(I.clearRect(0,0,this.canvas.width,this.canvas.height),T)for(var E={info:1,warning:2,error:3},w=(T.forEach(function(F){F.priority=E[F.type]||null}),T=T.sort(function(F,H){return F.priority<H.priority?-1:F.priority>H.priority?1:0}),this.renderer.session.$foldData),S=0;S<T.length;S++){var P,N=T[S].row,k=this.compensateFoldRows(N,w),L=Math.round((N-k)*this.lineHeight*this.heightRatio),R=Math.round((N-k)*this.lineHeight*this.heightRatio),N=Math.round(((N-k)*this.lineHeight+this.lineHeight)*this.heightRatio);N-R<this.minDecorationHeight&&((P=(R+N)/2|0)<this.halfMinDecorationHeight?P=this.halfMinDecorationHeight:P+this.halfMinDecorationHeight>this.canvasHeight&&(P=this.canvasHeight-this.halfMinDecorationHeight),R=Math.round(P-this.halfMinDecorationHeight),N=Math.round(P+this.halfMinDecorationHeight)),I.fillStyle=_[T[S].type]||null,I.fillRect(0,L,this.canvasWidth,N-R)}v=this.renderer.session.selection.getCursor(),v&&(k=this.compensateFoldRows(v.row,w),L=Math.round((v.row-k)*this.lineHeight*this.heightRatio),I.fillStyle="rgba(0, 0, 0, 0.5)",I.fillRect(0,L,this.canvasWidth,2))},A.prototype.compensateFoldRows=function(v,_){var I=0;if(_&&0<_.length)for(var T=0;T<_.length;T++)v>_[T].start.row&&v<_[T].end.row?I+=v-_[T].start.row:v>=_[T].end.row&&(I+=_[T].end.row-_[T].start.row);return I},A);function A(v,_){this.canvas=g.createElement("canvas"),this.renderer=_,this.pixelRatio=1,this.maxHeight=_.layerConfig.maxHeight,this.lineHeight=_.layerConfig.lineHeight,this.canvasHeight=v.parent.scrollHeight,this.heightRatio=this.canvasHeight/this.maxHeight,this.canvasWidth=v.width,this.minDecorationHeight=2*this.pixelRatio|0,this.halfMinDecorationHeight=this.minDecorationHeight/2|0,this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.canvas.style.top="0px",this.canvas.style.right="0px",this.canvas.style.zIndex="7px",this.canvas.style.position="absolute",this.colors={},this.colors.dark={error:"rgba(255, 18, 18, 1)",warning:"rgba(18, 136, 18, 1)",info:"rgba(18, 18, 136, 1)"},this.colors.light={error:"rgb(255,51,51)",warning:"rgb(32,133,72)",info:"rgb(35,68,138)"},v.element.appendChild(this.canvas)}b.implement(x.prototype,y),f.Decorator=x}),ace.define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/config","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/scrollbar","ace/scrollbar_custom","ace/scrollbar_custom","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter","ace/css/editor-css","ace/layer/decorators","ace/lib/useragent"],function(H,f,C){"use strict";var g=H("./lib/oop"),b=H("./lib/dom"),y=H("./lib/lang"),x=H("./config"),A=H("./layer/gutter").Gutter,v=H("./layer/marker").Marker,_=H("./layer/text").Text,I=H("./layer/cursor").Cursor,T=H("./scrollbar").HScrollBar,E=H("./scrollbar").VScrollBar,w=H("./scrollbar_custom").HScrollBar,S=H("./scrollbar_custom").VScrollBar,P=H("./renderloop").RenderLoop,k=H("./layer/font_metrics").FontMetrics,L=H("./lib/event_emitter").EventEmitter,R=H("./css/editor-css"),N=H("./layer/decorators").Decorator,F=H("./lib/useragent"),H=(b.importCssString(R,"ace_editor.css",!1),V.prototype.updateCharacterSize=function(){this.$textLayer.allowBoldFonts!=this.$allowBoldFonts&&(this.$allowBoldFonts=this.$textLayer.allowBoldFonts,this.setStyle("ace_nobold",!this.$allowBoldFonts)),this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth(),this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight(),this.$updatePrintMargin(),b.setStyle(this.scroller.style,"line-height",this.lineHeight+"px")},V.prototype.setSession=function(q){this.session&&this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode),(this.session=q)&&this.scrollMargin.top&&q.getScrollTop()<=0&&q.setScrollTop(-this.scrollMargin.top),this.$cursorLayer.setSession(q),this.$markerBack.setSession(q),this.$markerFront.setSession(q),this.$gutterLayer.setSession(q),this.$textLayer.setSession(q),q&&(this.$loop.schedule(this.CHANGE_FULL),this.session.$setFontMetrics(this.$fontMetrics),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this),this.onChangeNewLineMode(),this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode))},V.prototype.updateLines=function(q,Q,O){if(Q===void 0&&(Q=1/0),this.$changedLines?(this.$changedLines.firstRow>q&&(this.$changedLines.firstRow=q),this.$changedLines.lastRow<Q&&(this.$changedLines.lastRow=Q)):this.$changedLines={firstRow:q,lastRow:Q},this.$changedLines.lastRow<this.layerConfig.firstRow){if(!O)return;this.$changedLines.lastRow=this.layerConfig.lastRow}this.$changedLines.firstRow>this.layerConfig.lastRow||this.$loop.schedule(this.CHANGE_LINES)},V.prototype.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT),this.$textLayer.$updateEolChar(),this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)},V.prototype.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER),this.$textLayer.onChangeTabSize()},V.prototype.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},V.prototype.updateFull=function(q){q?this.$renderChanges(this.CHANGE_FULL,!0):this.$loop.schedule(this.CHANGE_FULL)},V.prototype.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},V.prototype.$updateSizeAsync=function(){this.$loop.pending?this.$size.$dirty=!0:this.onResize()},V.prototype.onResize=function(q,Q,O,B){if(!(2<this.resizing)){0<this.resizing?this.resizing++:this.resizing=q?1:0;var j=this.container,j=(B=B||j.clientHeight||j.scrollHeight,O=O||j.clientWidth||j.scrollWidth,this.$updateCachedSize(q,Q,O,B));if(this.$resizeTimer&&this.$resizeTimer.cancel(),!this.$size.scrollerHeight||!O&&!B)return this.resizing=0;q&&(this.$gutterLayer.$padding=null),q?this.$renderChanges(j|this.$changes,!0):this.$loop.schedule(j|this.$changes),this.resizing&&(this.resizing=0),this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null,this.$customScrollbar&&this.$updateCustomScrollbar(!0)}},V.prototype.$updateCachedSize=function(q,Q,O,B){B-=this.$extraHeight||0;var j=0,U=this.$size,z={width:U.width,height:U.height,scrollerHeight:U.scrollerHeight,scrollerWidth:U.scrollerWidth};return B&&(q||U.height!=B)&&(U.height=B,j|=this.CHANGE_SIZE,U.scrollerHeight=U.height,this.$horizScroll&&(U.scrollerHeight-=this.scrollBarH.getHeight()),this.scrollBarV.setHeight(U.scrollerHeight),this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px",j|=this.CHANGE_SCROLL),O&&(q||U.width!=O)&&(j|=this.CHANGE_SIZE,U.width=O,Q==null&&(Q=this.$showGutter?this.$gutter.offsetWidth:0),this.gutterWidth=Q,b.setStyle(this.scrollBarH.element.style,"left",Q+"px"),b.setStyle(this.scroller.style,"left",Q+this.margin.left+"px"),U.scrollerWidth=Math.max(0,O-Q-this.scrollBarV.getWidth()-this.margin.h),b.setStyle(this.$gutter.style,"left",this.margin.left+"px"),Q=this.scrollBarV.getWidth()+"px",b.setStyle(this.scrollBarH.element.style,"right",Q),b.setStyle(this.scroller.style,"right",Q),b.setStyle(this.scroller.style,"bottom",this.scrollBarH.getHeight()),this.scrollBarH.setWidth(U.scrollerWidth),this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||q)&&(j|=this.CHANGE_FULL),U.$dirty=!O||!B,j&&this._signal("resize",z),j},V.prototype.onGutterResize=function(q){q=this.$showGutter?q:0,q!=this.gutterWidth&&(this.$changes|=this.$updateCachedSize(!0,q,this.$size.width,this.$size.height)),this.session.getUseWrapMode()&&this.adjustWrapLimit()||this.$size.$dirty?this.$loop.schedule(this.CHANGE_FULL):this.$computeLayerConfig()},V.prototype.adjustWrapLimit=function(){var q=this.$size.scrollerWidth-2*this.$padding,q=Math.floor(q/this.characterWidth);return this.session.adjustWrapLimit(q,this.$showPrintMargin&&this.$printMarginColumn)},V.prototype.setAnimatedScroll=function(q){this.setOption("animatedScroll",q)},V.prototype.getAnimatedScroll=function(){return this.$animatedScroll},V.prototype.setShowInvisibles=function(q){this.setOption("showInvisibles",q),this.session.$bidiHandler.setShowInvisibles(q)},V.prototype.getShowInvisibles=function(){return this.getOption("showInvisibles")},V.prototype.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")},V.prototype.setDisplayIndentGuides=function(q){this.setOption("displayIndentGuides",q)},V.prototype.getHighlightIndentGuides=function(){return this.getOption("highlightIndentGuides")},V.prototype.setHighlightIndentGuides=function(q){this.setOption("highlightIndentGuides",q)},V.prototype.setShowPrintMargin=function(q){this.setOption("showPrintMargin",q)},V.prototype.getShowPrintMargin=function(){return this.getOption("showPrintMargin")},V.prototype.setPrintMarginColumn=function(q){this.setOption("printMarginColumn",q)},V.prototype.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")},V.prototype.getShowGutter=function(){return this.getOption("showGutter")},V.prototype.setShowGutter=function(q){return this.setOption("showGutter",q)},V.prototype.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")},V.prototype.setFadeFoldWidgets=function(q){this.setOption("fadeFoldWidgets",q)},V.prototype.setHighlightGutterLine=function(q){this.setOption("highlightGutterLine",q)},V.prototype.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")},V.prototype.$updatePrintMargin=function(){var q;(this.$showPrintMargin||this.$printMarginEl)&&(this.$printMarginEl||((q=b.createElement("div")).className="ace_layer ace_print-margin-layer",this.$printMarginEl=b.createElement("div"),this.$printMarginEl.className="ace_print-margin",q.appendChild(this.$printMarginEl),this.content.insertBefore(q,this.content.firstChild)),(q=this.$printMarginEl.style).left=Math.round(this.characterWidth*this.$printMarginColumn+this.$padding)+"px",q.visibility=this.$showPrintMargin?"visible":"hidden",this.session)&&this.session.$wrap==-1&&this.adjustWrapLimit()},V.prototype.getContainerElement=function(){return this.container},V.prototype.getMouseEventTarget=function(){return this.scroller},V.prototype.getTextAreaContainer=function(){return this.container},V.prototype.$moveTextAreaToCursor=function(){var q,Q,O,B,j,U,z;this.$isMousePressed||(q=this.textarea.style,U=this.$composition,this.$keepTextAreaAtCursor||U?(O=this.$cursorLayer.$pixelPos)&&(U&&U.markerRange&&(O=this.$cursorLayer.getPixelPosition(U.markerRange.start,!0)),z=this.layerConfig,Q=O.top,O=O.left,Q-=z.offset,B=U&&U.useTextareaForIME||F.isMobile?this.lineHeight:1,Q<0||Q>z.height-B?b.translate(this.textarea,0,0):(z=1,j=this.$size.height-B,U?U.useTextareaForIME?(U=this.textarea.value,z=this.characterWidth*this.session.$getStringScreenWidth(U)[0]):Q+=this.lineHeight+2:Q+=this.lineHeight,(O-=this.scrollLeft)>this.$size.scrollerWidth-z&&(O=this.$size.scrollerWidth-z),O+=this.gutterWidth+this.margin.left,b.setStyle(q,"height",B+"px"),b.setStyle(q,"width",z+"px"),b.translate(this.textarea,Math.min(O,this.$size.scrollerWidth-z),Math.min(Q,j)))):b.translate(this.textarea,-100,0))},V.prototype.getFirstVisibleRow=function(){return this.layerConfig.firstRow},V.prototype.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(this.layerConfig.offset===0?0:1)},V.prototype.getLastFullyVisibleRow=function(){var q=this.layerConfig,Q=q.lastRow;return this.session.documentToScreenRow(Q,0)*q.lineHeight-this.session.getScrollTop()>q.height-q.lineHeight?Q-1:Q},V.prototype.getLastVisibleRow=function(){return this.layerConfig.lastRow},V.prototype.setPadding=function(q){this.$padding=q,this.$textLayer.setPadding(q),this.$cursorLayer.setPadding(q),this.$markerFront.setPadding(q),this.$markerBack.setPadding(q),this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},V.prototype.setScrollMargin=function(q,Q,O,B){var j=this.scrollMargin;j.top=0|q,j.bottom=0|Q,j.right=0|B,j.left=0|O,j.v=j.top+j.bottom,j.h=j.left+j.right,j.top&&this.scrollTop<=0&&this.session&&this.session.setScrollTop(-j.top),this.updateFull()},V.prototype.setMargin=function(q,Q,O,B){var j=this.margin;j.top=0|q,j.bottom=0|Q,j.right=0|B,j.left=0|O,j.v=j.top+j.bottom,j.h=j.left+j.right,this.$updateCachedSize(!0,this.gutterWidth,this.$size.width,this.$size.height),this.updateFull()},V.prototype.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible},V.prototype.setHScrollBarAlwaysVisible=function(q){this.setOption("hScrollBarAlwaysVisible",q)},V.prototype.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible},V.prototype.setVScrollBarAlwaysVisible=function(q){this.setOption("vScrollBarAlwaysVisible",q)},V.prototype.$updateScrollBarV=function(){var q=this.layerConfig.maxHeight,Q=this.$size.scrollerHeight;!this.$maxLines&&this.$scrollPastEnd&&(q-=(Q-this.lineHeight)*this.$scrollPastEnd,this.scrollTop>q-Q)&&(q=this.scrollTop+Q,this.scrollBarV.scrollTop=null),this.scrollBarV.setScrollHeight(q+this.scrollMargin.v),this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)},V.prototype.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h),this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)},V.prototype.freeze=function(){this.$frozen=!0},V.prototype.unfreeze=function(){this.$frozen=!1},V.prototype.$renderChanges=function(q,Q){if(this.$changes&&(q|=this.$changes,this.$changes=0),this.session&&this.container.offsetWidth&&!this.$frozen&&(q||Q)){if(this.$size.$dirty)return this.$changes|=q,this.onResize(!0);this.lineHeight||this.$textLayer.checkForSizeChanges(),this._signal("beforeRender",q),this.session&&this.session.$bidiHandler&&this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var O,B,Q=this.layerConfig;(q&this.CHANGE_FULL||q&this.CHANGE_SIZE||q&this.CHANGE_TEXT||q&this.CHANGE_LINES||q&this.CHANGE_SCROLL||q&this.CHANGE_H_SCROLL)&&(q|=this.$computeLayerConfig()|this.$loop.clear(),Q.firstRow!=this.layerConfig.firstRow&&Q.firstRowScreen==this.layerConfig.firstRowScreen&&0<(O=this.scrollTop+(Q.firstRow-Math.max(this.layerConfig.firstRow,0))*this.lineHeight)&&(this.scrollTop=O,q=(q|=this.CHANGE_SCROLL)|(this.$computeLayerConfig()|this.$loop.clear())),Q=this.layerConfig,this.$updateScrollBarV(),q&this.CHANGE_H_SCROLL&&this.$updateScrollBarH(),b.translate(this.content,-this.scrollLeft,-Q.offset),O=Q.width+2*this.$padding+"px",B=Q.minHeight+"px",b.setStyle(this.content.style,"width",O),b.setStyle(this.content.style,"height",B)),q&this.CHANGE_H_SCROLL&&(b.translate(this.content,-this.scrollLeft,-Q.offset),this.scroller.className=this.scrollLeft<=0?"ace_scroller ":"ace_scroller ace_scroll-left ",this.enableKeyboardAccessibility)&&(this.scroller.className+=this.keyboardFocusClassName),q&this.CHANGE_FULL?(this.$changedLines=null,this.$textLayer.update(Q),this.$showGutter&&this.$gutterLayer.update(Q),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(Q),this.$markerBack.update(Q),this.$markerFront.update(Q),this.$cursorLayer.update(Q),this.$moveTextAreaToCursor()):q&this.CHANGE_SCROLL?(this.$changedLines=null,q&this.CHANGE_TEXT||q&this.CHANGE_LINES?this.$textLayer.update(Q):this.$textLayer.scrollLines(Q),this.$showGutter&&(q&this.CHANGE_GUTTER||q&this.CHANGE_LINES?this.$gutterLayer.update(Q):this.$gutterLayer.scrollLines(Q)),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(Q),this.$markerBack.update(Q),this.$markerFront.update(Q),this.$cursorLayer.update(Q),this.$moveTextAreaToCursor()):(q&this.CHANGE_TEXT?(this.$changedLines=null,this.$textLayer.update(Q),this.$showGutter&&this.$gutterLayer.update(Q),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(Q)):q&this.CHANGE_LINES?((this.$updateLines()||q&this.CHANGE_GUTTER&&this.$showGutter)&&this.$gutterLayer.update(Q),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(Q)):q&this.CHANGE_TEXT||q&this.CHANGE_GUTTER?(this.$showGutter&&this.$gutterLayer.update(Q),this.$customScrollbar&&this.$scrollDecorator.$updateDecorators(Q)):q&this.CHANGE_CURSOR&&(this.$highlightGutterLine&&this.$gutterLayer.updateLineHighlight(Q),this.$customScrollbar)&&this.$scrollDecorator.$updateDecorators(Q),q&this.CHANGE_CURSOR&&(this.$cursorLayer.update(Q),this.$moveTextAreaToCursor()),q&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(Q),q&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(Q)),this._signal("afterRender",q)}else this.$changes|=q},V.prototype.$autosize=function(){var q=this.session.getScreenLength()*this.lineHeight,Q=this.$maxLines*this.lineHeight,O=Math.min(Q,Math.max((this.$minLines||1)*this.lineHeight,q))+this.scrollMargin.v+(this.$extraHeight||0);this.$horizScroll&&(O+=this.scrollBarH.getHeight()),Q=!((O=this.$maxPixelHeight&&O>this.$maxPixelHeight?this.$maxPixelHeight:O)<=2*this.lineHeight)&&Q<q,O==this.desiredHeight&&this.$size.height==this.desiredHeight&&Q==this.$vScroll||(Q!=this.$vScroll&&(this.$vScroll=Q,this.scrollBarV.setVisible(Q)),q=this.container.clientWidth,this.container.style.height=O+"px",this.$updateCachedSize(!0,this.$gutterWidth,q,O),this.desiredHeight=O,this._signal("autosize"))},V.prototype.$computeLayerConfig=function(){var q,le=this.session,Q=this.$size,ie=Q.height<=2*this.lineHeight,O=this.session.getScreenLength()*this.lineHeight,B=this.$getLongestLine(),Z=!ie&&(this.$hScrollBarAlwaysVisible||Q.scrollerWidth-B-2*this.$padding<0),j=this.$horizScroll!==Z,Z=(j&&(this.$horizScroll=Z,this.scrollBarH.setVisible(Z)),this.$vScroll),U=(this.$maxLines&&1<this.lineHeight&&this.$autosize(),Q.scrollerHeight+this.lineHeight),z=!this.$maxLines&&this.$scrollPastEnd?(Q.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0,$=(O+=z,this.scrollMargin),ie=(this.session.setScrollTop(Math.max(-$.top,Math.min(this.scrollTop,O-Q.scrollerHeight+$.bottom))),this.session.setScrollLeft(Math.max(-$.left,Math.min(this.scrollLeft,B+2*this.$padding-Q.scrollerWidth+$.right))),!ie&&(this.$vScrollBarAlwaysVisible||Q.scrollerHeight-O+z<0||this.scrollTop>$.top)),z=Z!==ie,$=(z&&(this.$vScroll=ie,this.scrollBarV.setVisible(ie)),this.scrollTop%this.lineHeight),Z=Math.ceil(U/this.lineHeight)-1,Z=(ie=Math.max(0,Math.round((this.scrollTop-$)/this.lineHeight)))+Z,J=this.lineHeight,ie=le.screenToDocumentRow(ie,0),ne=le.getFoldLine(ie),le=(ne&&(ie=ne.start.row),ne=le.documentToScreenRow(ie,0),q=le.getRowLength(ie)*J,Z=Math.min(le.screenToDocumentRow(Z,0),le.getLength()-1),U=Q.scrollerHeight+le.getRowLength(Z)*J+q,$=this.scrollTop-ne*J,0);return this.layerConfig.width==B&&!j||(le=this.CHANGE_H_SCROLL),(j||z)&&(le|=this.$updateCachedSize(!0,this.gutterWidth,Q.width,Q.height),this._signal("scrollbarVisibilityChanged"),z)&&(B=this.$getLongestLine()),this.layerConfig={width:B,padding:this.$padding,firstRow:ie,firstRowScreen:ne,lastRow:Z,lineHeight:J,characterWidth:this.characterWidth,minHeight:U,maxHeight:O,offset:$,gutterOffset:J?Math.max(0,Math.ceil(($+Q.height-Q.scrollerHeight)/J)):0,height:this.$size.scrollerHeight},this.session.$bidiHandler&&this.session.$bidiHandler.setContentWidth(B-this.$padding),le},V.prototype.$updateLines=function(){if(this.$changedLines){var q=this.$changedLines.firstRow,Q=this.$changedLines.lastRow,O=(this.$changedLines=null,this.layerConfig);if(!(q>O.lastRow+1||Q<O.firstRow)){if(Q!==1/0)return this.$textLayer.updateLines(O,q,Q),!0;this.$showGutter&&this.$gutterLayer.update(O),this.$textLayer.update(O)}}},V.prototype.$getLongestLine=function(){var q=this.session.getScreenWidth();return this.showInvisibles&&!this.session.$useWrapMode&&(q+=1),this.$textLayer&&q>this.$textLayer.MAX_LINE_LENGTH&&(q=this.$textLayer.MAX_LINE_LENGTH+30),Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(q*this.characterWidth))},V.prototype.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},V.prototype.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},V.prototype.addGutterDecoration=function(q,Q){this.$gutterLayer.addGutterDecoration(q,Q)},V.prototype.removeGutterDecoration=function(q,Q){this.$gutterLayer.removeGutterDecoration(q,Q)},V.prototype.updateBreakpoints=function(q){this._rows=q,this.$loop.schedule(this.CHANGE_GUTTER)},V.prototype.setAnnotations=function(q){this.$gutterLayer.setAnnotations(q),this.$loop.schedule(this.CHANGE_GUTTER)},V.prototype.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},V.prototype.hideCursor=function(){this.$cursorLayer.hideCursor()},V.prototype.showCursor=function(){this.$cursorLayer.showCursor()},V.prototype.scrollSelectionIntoView=function(q,Q,O){this.scrollCursorIntoView(q,O),this.scrollCursorIntoView(Q,O)},V.prototype.scrollCursorIntoView=function(q,Q,O){var B,j,U;this.$size.scrollerHeight!==0&&(B=(q=this.$cursorLayer.getPixelPosition(q)).left,q=q.top,j=O&&O.top||0,O=O&&O.bottom||0,this.$scrollAnimation&&(this.$stopAnimation=!0),q<(U=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop)+j?(Q&&U+j>q+this.lineHeight&&(q-=Q*this.$size.scrollerHeight),q===0&&(q=-this.scrollMargin.top),this.session.setScrollTop(q)):U+this.$size.scrollerHeight-O<q+this.lineHeight&&(Q&&U+this.$size.scrollerHeight-O<q-this.lineHeight&&(q+=Q*this.$size.scrollerHeight),this.session.setScrollTop(q+this.lineHeight+O-this.$size.scrollerHeight)),j=this.scrollLeft,B-(U=2*this.layerConfig.characterWidth)<j?((B-=U)<this.$padding+U&&(B=-this.scrollMargin.left),this.session.setScrollLeft(B)):j+this.$size.scrollerWidth<(B+=U)+this.characterWidth?this.session.setScrollLeft(Math.round(B+this.characterWidth-this.$size.scrollerWidth)):j<=this.$padding&&B-j<this.characterWidth&&this.session.setScrollLeft(0))},V.prototype.getScrollTop=function(){return this.session.getScrollTop()},V.prototype.getScrollLeft=function(){return this.session.getScrollLeft()},V.prototype.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},V.prototype.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},V.prototype.scrollToRow=function(q){this.session.setScrollTop(q*this.lineHeight)},V.prototype.alignCursor=function(B,Q){var B=this.$cursorLayer.getPixelPosition(B=typeof B=="number"?{row:B,column:0}:B),O=this.$size.scrollerHeight-this.lineHeight,B=B.top-O*(Q||0);return this.session.setScrollTop(B),B},V.prototype.$calcSteps=function(q,Q){for(var O,B,z=0,j=this.STEPS,U=[],z=0;z<j;++z)U.push((O=z/this.STEPS,(Q-(B=q))*(Math.pow(O-1,3)+1)+B));return U},V.prototype.scrollToLine=function(q,Q,O,B){q=this.$cursorLayer.getPixelPosition({row:q,column:0}).top,Q&&(q-=this.$size.scrollerHeight/2),Q=this.scrollTop,this.session.setScrollTop(q),O!==!1&&this.animateScrolling(Q,B)},V.prototype.animateScrolling=function(q,Q){var O=this.scrollTop;if(this.$animatedScroll){var B=this;if(q!=O){if(this.$scrollAnimation){var j=this.$scrollAnimation.steps;if(j.length&&(q=j[0])==O)return}var U=B.$calcSteps(q,O);this.$scrollAnimation={from:q,to:O,steps:U},clearInterval(this.$timer),B.session.setScrollTop(U.shift()),B.session.$scrollTop=O,this.$timer=setInterval(function(){if(!B.$stopAnimation)return B.session?void(U.length?(B.session.setScrollTop(U.shift()),B.session.$scrollTop=O):O!=null?(B.session.$scrollTop=-1,B.session.setScrollTop(O),O=null):z()):clearInterval(B.$timer);z()},10)}}function z(){B.$timer=clearInterval(B.$timer),B.$scrollAnimation=null,B.$stopAnimation=!1,Q&&Q()}},V.prototype.scrollToY=function(q){this.scrollTop!==q&&(this.$loop.schedule(this.CHANGE_SCROLL),this.scrollTop=q)},V.prototype.scrollToX=function(q){this.scrollLeft!==q&&(this.scrollLeft=q),this.$loop.schedule(this.CHANGE_H_SCROLL)},V.prototype.scrollTo=function(q,Q){this.session.setScrollTop(Q),this.session.setScrollLeft(q)},V.prototype.scrollBy=function(q,Q){Q&&this.session.setScrollTop(this.session.getScrollTop()+Q),q&&this.session.setScrollLeft(this.session.getScrollLeft()+q)},V.prototype.isScrollableBy=function(q,Q){return Q<0&&this.session.getScrollTop()>=1-this.scrollMargin.top||0<Q&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom||q<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left||0<q&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right||void 0},V.prototype.pixelToScreenCoordinates=function(B,j){this.$hasCssTransforms?(U={top:0,left:0},B=(O=this.$fontMetrics.transformCoordinates([B,j]))[1]-this.gutterWidth-this.margin.left,j=O[0]):U=this.scroller.getBoundingClientRect();var O=B+this.scrollLeft-U.left-this.$padding,B=O/this.characterWidth,j=Math.floor((j+this.scrollTop-U.top)/this.lineHeight),U=this.$blockCursor?Math.floor(B):Math.round(B);return{row:j,column:U,side:0<B-U?1:-1,offsetX:O}},V.prototype.screenToTextCoordinates=function(j,U){this.$hasCssTransforms?(O={top:0,left:0},j=(B=this.$fontMetrics.transformCoordinates([j,U]))[1]-this.gutterWidth-this.margin.left,U=B[0]):O=this.scroller.getBoundingClientRect();var O,B=j+this.scrollLeft-O.left-this.$padding,j=B/this.characterWidth,j=this.$blockCursor?Math.floor(j):Math.round(j),U=Math.floor((U+this.scrollTop-O.top)/this.lineHeight);return this.session.screenToDocumentPosition(U,Math.max(j,0),B)},V.prototype.textToScreenCoordinates=function(B,j){var O=this.scroller.getBoundingClientRect(),j=this.session.documentToScreenPosition(B,j),B=this.$padding+(this.session.$bidiHandler.isBidiRow(j.row,B)?this.session.$bidiHandler.getPosLeft(j.column):Math.round(j.column*this.characterWidth)),j=j.row*this.lineHeight;return{pageX:O.left+B-this.scrollLeft,pageY:O.top+j-this.scrollTop}},V.prototype.visualizeFocus=function(){b.addCssClass(this.container,"ace_focus")},V.prototype.visualizeBlur=function(){b.removeCssClass(this.container,"ace_focus")},V.prototype.showComposition=function(q){(this.$composition=q).cssText||(q.cssText=this.textarea.style.cssText),q.useTextareaForIME==null&&(q.useTextareaForIME=this.$useTextareaForIME),this.$useTextareaForIME?(b.addCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText="",this.$moveTextAreaToCursor(),this.$cursorLayer.element.style.display="none"):q.markerId=this.session.addMarker(q.markerRange,"ace_composition_marker","text")},V.prototype.setCompositionText=function(q){var Q=this.session.selection.cursor;this.addToken(q,"composition_placeholder",Q.row,Q.column),this.$moveTextAreaToCursor()},V.prototype.hideComposition=function(){var q;this.$composition&&(this.$composition.markerId&&this.session.removeMarker(this.$composition.markerId),b.removeCssClass(this.textarea,"ace_composition"),this.textarea.style.cssText=this.$composition.cssText,q=this.session.selection.cursor,this.removeExtraToken(q.row,q.column),this.$composition=null,this.$cursorLayer.element.style.display="")},V.prototype.setGhostText=function(q,j){var O,B,U=this.session.selection.cursor,j=j||{row:U.row,column:U.column},U=(this.removeGhostText(),q.split(`
`));this.addToken(U[0],"ghost_text",j.row,j.column),this.$ghostText={text:q,position:{row:j.row,column:j.column}},1<U.length&&(this.$ghostTextWidget={text:U.slice(1).join(`
`),row:j.row,column:j.column,className:"ace_ghost_text"},this.session.widgetManager.addLineWidget(this.$ghostTextWidget),q=this.$cursorLayer.getPixelPosition(j,!0),O=this.container.getBoundingClientRect().height,(B=U.length*this.lineHeight)<O-q.top||(B<O?this.scrollBy(0,(U.length-1)*this.lineHeight):this.scrollToRow(j.row)))},V.prototype.removeGhostText=function(){var q;this.$ghostText&&(q=this.$ghostText.position,this.removeExtraToken(q.row,q.column),this.$ghostTextWidget&&(this.session.widgetManager.removeLineWidget(this.$ghostTextWidget),this.$ghostTextWidget=null),this.$ghostText=null)},V.prototype.addToken=function(q,Q,O,B){var j=this.session,U=(j.bgTokenizer.lines[O]=null,{type:Q,value:q}),z=j.getTokens(O);if(B!=null&&z.length)for(var $=0,Z=0;Z<z.length;Z++){var J=z[Z];if(B<=($+=J.value.length)){var ne=J.value.length-($-B),ie=J.value.slice(0,ne),ne=J.value.slice(ne);z.splice(Z,1,{type:J.type,value:ie},U,{type:J.type,value:ne});break}}else z.push(U);this.updateLines(O,O)},V.prototype.removeExtraToken=function(q,Q){this.session.bgTokenizer.lines[q]=null,this.updateLines(q,q)},V.prototype.setTheme=function(q,Q){var O,B=this;function j(U){if(B.$themeId!=q)return Q&&Q();if(!U||!U.cssClass)throw new Error("couldn't load module "+q+" or it didn't call define");U.$id&&(B.$themeId=U.$id),b.importCssString(U.cssText,U.cssClass,B.container),B.theme&&b.removeCssClass(B.container,B.theme.cssClass);var z="padding"in U?U.padding:"padding"in(B.theme||{})?4:B.$padding;B.$padding&&z!=B.$padding&&B.setPadding(z),B.$theme=U.cssClass,B.theme=U,b.addCssClass(B.container,U.cssClass),b.setCssClass(B.container,"ace_dark",U.isDark),B.$size&&(B.$size.width=0,B.$updateSizeAsync()),B._dispatchEvent("themeLoaded",{theme:U}),Q&&Q()}this.$themeId=q,B._dispatchEvent("themeChange",{theme:q}),q&&typeof q!="string"?j(q):(O=q||this.$options.theme.initialValue,x.loadModule(["theme",O],j))},V.prototype.getTheme=function(){return this.$themeId},V.prototype.setStyle=function(q,Q){b.setCssClass(this.container,q,Q!==!1)},V.prototype.unsetStyle=function(q){b.removeCssClass(this.container,q)},V.prototype.setCursorStyle=function(q){b.setStyle(this.scroller.style,"cursor",q)},V.prototype.setMouseCursor=function(q){b.setStyle(this.scroller.style,"cursor",q)},V.prototype.attachToShadowRoot=function(){b.importCssString(R,"ace_editor.css",this.container)},V.prototype.destroy=function(){this.freeze(),this.$fontMetrics.destroy(),this.$cursorLayer.destroy(),this.removeAllListeners(),this.container.textContent="",this.setOption("useResizeObserver",!1)},V.prototype.$updateCustomScrollbar=function(q){var Q=this;this.$horizScroll=this.$vScroll=null,this.scrollBarV.element.remove(),this.scrollBarH.element.remove(),this.$scrollDecorator&&delete this.$scrollDecorator,q===!0?(this.scrollBarV=new S(this.container,this),this.scrollBarH=new w(this.container,this),this.scrollBarV.setHeight(this.$size.scrollerHeight),this.scrollBarH.setWidth(this.$size.scrollerWidth),this.scrollBarV.addEventListener("scroll",function(O){Q.$scrollAnimation||Q.session.setScrollTop(O.data-Q.scrollMargin.top)}),this.scrollBarH.addEventListener("scroll",function(O){Q.$scrollAnimation||Q.session.setScrollLeft(O.data-Q.scrollMargin.left)}),this.$scrollDecorator=new N(this.scrollBarV,this),this.$scrollDecorator.$updateDecorators()):(this.scrollBarV=new E(this.container,this),this.scrollBarH=new T(this.container,this),this.scrollBarV.addEventListener("scroll",function(O){Q.$scrollAnimation||Q.session.setScrollTop(O.data-Q.scrollMargin.top)}),this.scrollBarH.addEventListener("scroll",function(O){Q.$scrollAnimation||Q.session.setScrollLeft(O.data-Q.scrollMargin.left)}))},V.prototype.$addResizeObserver=function(){var q;window.ResizeObserver&&!this.$resizeObserver&&((q=this).$resizeTimer=y.delayedCall(function(){q.destroyed||q.onResize()},50),this.$resizeObserver=new window.ResizeObserver(function(B){var O=B[0].contentRect.width,B=B[0].contentRect.height;1<Math.abs(q.$size.width-O)||1<Math.abs(q.$size.height-B)?q.$resizeTimer.delay():q.$resizeTimer.cancel()}),this.$resizeObserver.observe(this.container))},V);function V(B,Q){var O=this,B=(this.container=B||b.createElement("div"),b.addCssClass(this.container,"ace_editor"),b.HI_DPI&&b.addCssClass(this.container,"ace_hidpi"),this.setTheme(Q),x.get("useStrictCSP")==null&&x.set("useStrictCSP",!1),this.$gutter=b.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.$gutter.setAttribute("aria-hidden","true"),this.scroller=b.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=b.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new A(this.$gutter),this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this)),this.$markerBack=new v(this.content),this.$textLayer=new _(this.content));this.canvas=B.element,this.$markerFront=new v(this.content),this.$cursorLayer=new I(this.content),this.$horizScroll=!1,this.$vScroll=!1,this.scrollBar=this.scrollBarV=new E(this.container,this),this.scrollBarH=new T(this.container,this),this.scrollBarV.on("scroll",function(j){O.$scrollAnimation||O.session.setScrollTop(j.data-O.scrollMargin.top)}),this.scrollBarH.on("scroll",function(j){O.$scrollAnimation||O.session.setScrollLeft(j.data-O.scrollMargin.left)}),this.scrollTop=0,this.scrollLeft=0,this.cursorPos={row:0,column:0},this.$fontMetrics=new k(this.container),this.$textLayer.$setFontMetrics(this.$fontMetrics),this.$textLayer.on("changeCharacterSize",function(j){O.updateCharacterSize(),O.onResize(!0,O.gutterWidth,O.$size.width,O.$size.height),O._signal("changeCharacterSize",j)}),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:!0},this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1},this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.margin={left:0,right:0,top:0,bottom:0,v:0,h:0},this.$keepTextAreaAtCursor=!F.isIOS,this.$loop=new P(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView),this.$loop.schedule(this.CHANGE_FULL),this.updateCharacterSize(),this.setPadding(4),this.$addResizeObserver(),x.resetOptions(this),x._signal("renderer",this)}H.prototype.CHANGE_CURSOR=1,H.prototype.CHANGE_MARKER=2,H.prototype.CHANGE_GUTTER=4,H.prototype.CHANGE_SCROLL=8,H.prototype.CHANGE_LINES=16,H.prototype.CHANGE_TEXT=32,H.prototype.CHANGE_SIZE=64,H.prototype.CHANGE_MARKER_BACK=128,H.prototype.CHANGE_MARKER_FRONT=256,H.prototype.CHANGE_FULL=512,H.prototype.CHANGE_H_SCROLL=1024,H.prototype.$changes=0,H.prototype.$padding=null,H.prototype.$frozen=!1,H.prototype.STEPS=8,g.implement(H.prototype,L),x.defineOptions(H.prototype,"renderer",{useResizeObserver:{set:function(q){!q&&this.$resizeObserver?(this.$resizeObserver.disconnect(),this.$resizeTimer.cancel(),this.$resizeTimer=this.$resizeObserver=null):q&&!this.$resizeObserver&&this.$addResizeObserver()}},animatedScroll:{initialValue:!1},showInvisibles:{set:function(q){this.$textLayer.setShowInvisibles(q)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!1},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:!0},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(q){typeof q=="number"&&(this.$printMarginColumn=q),this.$showPrintMargin=!!q,this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(q){this.$gutter.style.display=q?"block":"none",this.$loop.schedule(this.CHANGE_FULL),this.onGutterResize()},initialValue:!0},useSvgGutterIcons:{set:function(q){this.$gutterLayer.$useSvgGutterIcons=q},initialValue:!1},showFoldedAnnotations:{set:function(q){this.$gutterLayer.$showFoldedAnnotations=q},initialValue:!1},fadeFoldWidgets:{set:function(q){b.setCssClass(this.$gutter,"ace_fade-fold-widgets",q)},initialValue:!1},showFoldWidgets:{set:function(q){this.$gutterLayer.setShowFoldWidgets(q),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},displayIndentGuides:{set:function(q){this.$textLayer.setDisplayIndentGuides(q)&&this.$loop.schedule(this.CHANGE_TEXT)},initialValue:!0},highlightIndentGuides:{set:function(q){this.$textLayer.setHighlightIndentGuides(q)==1?this.$textLayer.$highlightIndentGuide():this.$textLayer.$clearActiveIndentGuide(this.$textLayer.$lines.cells)},initialValue:!0},highlightGutterLine:{set:function(q){this.$gutterLayer.setHighlightGutterLine(q),this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:!0},hScrollBarAlwaysVisible:{set:function(q){this.$hScrollBarAlwaysVisible&&this.$horizScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},vScrollBarAlwaysVisible:{set:function(q){this.$vScrollBarAlwaysVisible&&this.$vScroll||this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:!1},fontSize:{set:function(q){typeof q=="number"&&(q+="px"),this.container.style.fontSize=q,this.updateFontSize()},initialValue:12},fontFamily:{set:function(q){this.container.style.fontFamily=q,this.updateFontSize()}},maxLines:{set:function(q){this.updateFull()}},minLines:{set:function(q){this.$minLines<562949953421311||(this.$minLines=0),this.updateFull()}},maxPixelHeight:{set:function(q){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(q){this.$scrollPastEnd!=(q=+q||0)&&(this.$scrollPastEnd=q,this.$loop.schedule(this.CHANGE_SCROLL))},initialValue:0,handlesSet:!0},fixedWidthGutter:{set:function(q){this.$gutterLayer.$fixedWidth=!!q,this.$loop.schedule(this.CHANGE_GUTTER)}},customScrollbar:{set:function(q){this.$updateCustomScrollbar(q)},initialValue:!1},theme:{set:function(q){this.setTheme(q)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:!0},hasCssTransforms:{},useTextareaForIME:{initialValue:!F.isMobile&&!F.isIE}}),f.VirtualRenderer=H}),ace.define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/net","ace/lib/event_emitter","ace/config"],function(h,f,C){"use strict";var g=h("../lib/oop"),b=h("../lib/net"),y=h("../lib/event_emitter").EventEmitter,x=h("../config");function A(_){var I;return typeof Worker>"u"?{postMessage:function(){},terminate:function(){}}:x.get("loadWorkerFromBlob")?(I=function(T){T="importScripts('"+b.qualifyURL(T)+"');";try{return new Blob([T],{type:"application/javascript"})}catch{var E=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);return E.append(T),E.getBlob("application/javascript")}}(_),I=(window.URL||window.webkitURL).createObjectURL(I),new Worker(I)):new Worker(_)}function v(_){_.postMessage||(_=this.$createWorkerFromOldConfig.apply(this,arguments)),this.$worker=_,this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this),this.changeListener=this.changeListener.bind(this),this.onMessage=this.onMessage.bind(this),this.callbackId=1,this.callbacks={},this.$worker.onmessage=this.onMessage}(function(){g.implement(this,y),this.$createWorkerFromOldConfig=function(_,I,T,E,w){var S,P;return h.nameToUrl&&!h.toUrl&&(h.toUrl=h.nameToUrl),x.get("packaged")||!h.toUrl?E=E||x.moduleUrl(I,"worker"):(S=this.$normalizePath,E=E||S(h.toUrl("ace/worker/worker.js",null,"_")),P={},_.forEach(function(k){P[k]=S(h.toUrl(k,null,"_").replace(/(\.js)?(\?.*)?$/,""))})),this.$worker=A(E),w&&this.send("importScripts",w),this.$worker.postMessage({init:!0,tlns:P,module:I,classname:T}),this.$worker},this.onMessage=function(_){var I=_.data;switch(I.type){case"event":this._signal(I.name,{data:I.data});break;case"call":var T=this.callbacks[I.id];T&&(T(I.data),delete this.callbacks[I.id]);break;case"error":this.reportError(I.data);break;case"log":window.console}},this.reportError=function(_){window.console},this.$normalizePath=function(_){return b.qualifyURL(_)},this.terminate=function(){this._signal("terminate",{}),this.deltaQueue=null,this.$worker.terminate(),this.$worker.onerror=function(_){_.preventDefault()},this.$worker=null,this.$doc&&this.$doc.off("change",this.changeListener),this.$doc=null},this.send=function(_,I){this.$worker.postMessage({command:_,args:I})},this.call=function(_,I,T){var E;T&&(E=this.callbackId++,this.callbacks[E]=T,I.push(E)),this.send(_,I)},this.emit=function(_,I){try{I.data&&I.data.err&&(I.data.err={message:I.data.err.message,stack:I.data.err.stack,code:I.data.err.code}),this.$worker&&this.$worker.postMessage({event:_,data:{data:I.data}})}catch{}},this.attachToDocument=function(_){this.$doc&&this.terminate(),this.$doc=_,this.call("setValue",[_.getValue()]),_.on("change",this.changeListener,!0)},this.changeListener=function(_){this.deltaQueue||(this.deltaQueue=[],setTimeout(this.$sendDeltaQueue,0)),_.action=="insert"?this.deltaQueue.push(_.start,_.lines):this.deltaQueue.push(_.start,_.end)},this.$sendDeltaQueue=function(){var _=this.deltaQueue;_&&(this.deltaQueue=null,50<_.length&&_.length>this.$doc.getLength()>>1?this.call("setValue",[this.$doc.getValue()]):this.emit("change",{data:_}))}}).call(v.prototype),f.UIWorkerClient=function(_,I,T){var E=null,w=!1,S=Object.create(y),P=[],k=new v({messageBuffer:P,terminate:function(){},postMessage:function(R){P.push(R),E&&(w?setTimeout(L):L())}}),L=(k.setEmitSync=function(R){w=R},function(){var R=P.shift();R.command?E[R.command].apply(E,R.args):R.event&&S._signal(R.event,R.data)});return S.postMessage=function(R){k.onMessage({data:R})},S.callback=function(R,N){this.postMessage({type:"call",id:N,data:R})},S.emit=function(R,N){this.postMessage({type:"event",name:R,data:N})},x.loadModule(["worker",I],function(R){for(E=new R[T](S);P.length;)L()}),k},f.WorkerClient=v,f.createWorker=A}),ace.define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"],function(y,f,C){"use strict";var g=y("./range").Range,b=y("./lib/event_emitter").EventEmitter,y=y("./lib/oop"),x=(A.prototype.setup=function(){var v=this,_=this.doc,I=this.session,T=(this.selectionBefore=I.selection.toJSON(),I.selection.inMultiSelectMode&&I.selection.toSingleRange(),this.pos=_.createAnchor(this.$pos.row,this.$pos.column),this.pos);T.$insertRight=!0,T.detach(),T.markerId=I.addMarker(new g(T.row,T.column,T.row,T.column+this.length),this.mainClass,null,!1),this.others=[],this.$others.forEach(function(E){E=_.createAnchor(E.row,E.column),E.$insertRight=!0,E.detach(),v.others.push(E)}),I.setUndoSelect(!1)},A.prototype.showOtherMarkers=function(){var v,_;this.othersActive||(v=this.session,(_=this).othersActive=!0,this.others.forEach(function(I){I.markerId=v.addMarker(new g(I.row,I.column,I.row,I.column+_.length),_.othersClass,null,!1)}))},A.prototype.hideOtherMarkers=function(){if(this.othersActive){this.othersActive=!1;for(var v=0;v<this.others.length;v++)this.session.removeMarker(this.others[v].markerId)}},A.prototype.onUpdate=function(v){if(this.$updating)return this.updateAnchors(v);var _=v;if(_.start.row===_.end.row&&_.start.row===this.pos.row){this.$updating=!0;var I=v.action==="insert"?_.end.column-_.start.column:_.start.column-_.end.column,T=_.start.column>=this.pos.column&&_.start.column<=this.pos.column+this.length+1,E=_.start.column-this.pos.column;if(this.updateAnchors(v),T&&(this.length+=I),T&&!this.session.$fromUndo){if(v.action==="insert")for(var w=this.others.length-1;0<=w;w--){var S={row:(P=this.others[w]).row,column:P.column+E};this.doc.insertMergedLines(S,v.lines)}else if(v.action==="remove")for(w=this.others.length-1;0<=w;w--){var P,S={row:(P=this.others[w]).row,column:P.column+E};this.doc.remove(new g(S.row,S.column,S.row,S.column-I))}}this.$updating=!1,this.updateMarkers()}},A.prototype.updateAnchors=function(v){this.pos.onChange(v);for(var _=this.others.length;_--;)this.others[_].onChange(v);this.updateMarkers()},A.prototype.updateMarkers=function(){if(!this.$updating){var v=this,_=this.session,I=function(E,w){_.removeMarker(E.markerId),E.markerId=_.addMarker(new g(E.row,E.column,E.row,E.column+v.length),w,null,!1)};I(this.pos,this.mainClass);for(var T=this.others.length;T--;)I(this.others[T],this.othersClass)}},A.prototype.onCursorChange=function(v){var _;!this.$updating&&this.session&&((_=this.session.selection.getCursor()).row===this.pos.row&&_.column>=this.pos.column&&_.column<=this.pos.column+this.length?(this.showOtherMarkers(),this._emit("cursorEnter",v)):(this.hideOtherMarkers(),this._emit("cursorLeave",v)))},A.prototype.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId),this.hideOtherMarkers(),this.doc.off("change",this.$onUpdate),this.session.selection.off("changeCursor",this.$onCursorChange),this.session.setUndoSelect(!0),this.session=null},A.prototype.cancel=function(){if(this.$undoStackDepth!==-1){for(var v=this.session.getUndoManager(),_=(v.$undoStack||v.$undostack).length-this.$undoStackDepth,I=0;I<_;I++)v.undo(this.session,!0);this.selectionBefore&&this.session.selection.fromJSON(this.selectionBefore)}},A);function A(v,P,I,T,E,w){var S=this,P=(this.length=P,this.session=v,this.doc=v.getDocument(),this.mainClass=E,this.othersClass=w,this.$onUpdate=this.onUpdate.bind(this),this.doc.on("change",this.$onUpdate,!0),this.$others=T,this.$onCursorChange=function(){setTimeout(function(){S.onCursorChange()})},this.$pos=I,v.getUndoManager().$undoStack||v.getUndoManager().$undostack||{length:-1});this.$undoStackDepth=P.length,this.setup(),v.selection.on("changeCursor",this.$onCursorChange)}y.implement(x.prototype,b),f.PlaceHolder=x}),ace.define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"],function(h,f,C){var g=h("../lib/event"),b=h("../lib/useragent");function y(x,A){return x.row==A.row&&x.column==A.column}f.onMouseDown=function(x){var A=x.domEvent,v=A.altKey,_=A.shiftKey,I=A.ctrlKey,T=x.getAccelKey(),E=x.getButton();if(I&&b.isMac&&(E=A.button),x.editor.inMultiSelectMode&&E==2)x.editor.textInput.onContextMenu(x.domEvent);else if(I||v||T){if(E===0){var w,S,P,k,L,R,N,F,H=x.editor,V=H.selection,q=H.inMultiSelectMode,Q=x.getDocumentPosition(),O=V.getCursor(),O=x.inSelection()||V.isEmpty()&&y(Q,O),B=x.x,j=x.y,U=H.session,z=H.renderer.pixelToScreenCoordinates(B,j),$=z;if(H.$mouseHandler.$enableJumpToDef)I&&v||T&&v?w=_?"block":"add":v&&H.$blockSelectEnabled&&(w="block");else if(T&&!v){if(w="add",!q&&_)return}else v&&H.$blockSelectEnabled&&(w="block");if(w&&b.isMac&&A.ctrlKey&&H.$mouseHandler.cancelContextMenu(),w=="add")!q&&O||(q||(S=V.toOrientedRange(),H.addSelectionMarker(S)),P=V.rangeList.rangeAtPoint(Q),H.inVirtualSelectionMode=!0,_&&(P=null,S=V.ranges[0]||S,H.removeSelectionMarker(S)),H.once("mouseup",function(){var Z=V.toOrientedRange();P&&Z.isEmpty()&&y(P.cursor,Z.cursor)?V.substractPoint(Z.cursor):(_?V.substractPoint(S.cursor):S&&(H.removeSelectionMarker(S),V.addRange(S)),V.addRange(Z)),H.inVirtualSelectionMode=!1}));else if(w=="block")return x.stop(),H.inVirtualSelectionMode=!0,L=[],R=function(){var Z=H.renderer.pixelToScreenCoordinates(B,j),J=U.screenToDocumentPosition(Z.row,Z.column,Z.offsetX);y($,Z)&&y(J,V.lead)||($=Z,H.selection.moveToPosition(J),H.renderer.scrollCursorIntoView(),H.removeSelectionMarkers(L),L=V.rectangularRangeBlock($,z),H.$mouseHandler.$clickSelection&&L.length==1&&L[0].isEmpty()&&(L[0]=H.$mouseHandler.$clickSelection.clone()),L.forEach(H.addSelectionMarker,H),H.updateSelectionMarkers())},q&&!T?V.toSingleRange():!q&&T&&(k=V.toOrientedRange(),H.addSelectionMarker(k)),_?z=U.documentToScreenPosition(V.lead):V.moveToPosition(Q),$={row:-1,column:-1},N=R,g.capture(H.container,function(Z){B=Z.clientX,j=Z.clientY},function(Z){R(),clearInterval(F),H.removeSelectionMarkers(L),L.length||(L=[V.toOrientedRange()]),k&&(H.removeSelectionMarker(k),V.toSingleRange(k));for(var J=0;J<L.length;J++)V.addRange(L[J]);H.inVirtualSelectionMode=!1,H.$mouseHandler.$clickSelection=null}),F=setInterval(function(){N()},20),x.preventDefault()}}else E===0&&x.editor.inMultiSelectMode&&x.editor.exitMultiSelectMode()}}),ace.define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],function(h,f,C){f.defaultCommands=[{name:"addCursorAbove",description:"Add cursor above",exec:function(g){g.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelow",description:"Add cursor below",exec:function(g){g.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorAboveSkipCurrent",description:"Add cursor above (skip current)",exec:function(g){g.selectMoreLines(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:!0},{name:"addCursorBelowSkipCurrent",description:"Add cursor below (skip current)",exec:function(g){g.selectMoreLines(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreBefore",description:"Select more before",exec:function(g){g.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectMoreAfter",description:"Select more after",exec:function(g){g.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextBefore",description:"Select next before",exec:function(g){g.selectMore(-1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:!0},{name:"selectNextAfter",description:"Select next after",exec:function(g){g.selectMore(1,!0)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:!0},{name:"toggleSplitSelectionIntoLines",description:"Split selection into lines",exec:function(g){1<g.multiSelect.rangeCount?g.multiSelect.joinSelections():g.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:!0},{name:"splitSelectionIntoLines",description:"Split into lines",exec:function(g){g.multiSelect.splitIntoLines()},readOnly:!0},{name:"alignCursors",description:"Align cursors",exec:function(g){g.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",description:"Find all",exec:function(g){g.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:!0}],f.multiSelectCommands=[{name:"singleSelection",description:"Single selection",bindKey:"esc",exec:function(g){g.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:!0,isAvailable:function(g){return g&&g.inMultiSelectMode}}],h=h("../keyboard/hash_handler").HashHandler,f.keyboardHandler=new h(f.multiSelectCommands)}),ace.define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"],function(h,f,C){var g=h("./range_list").RangeList,b=h("./range").Range,y=h("./selection").Selection,x=h("./mouse/multi_select_handler").onMouseDown,A=h("./lib/event"),v=h("./lib/lang"),_=h("./commands/multi_select_commands");f.commands=_.defaultCommands.concat(_.multiSelectCommands);var I=new(h("./search")).Search,T=h("./edit_session").EditSession,T=((function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(T.prototype),(function(){this.ranges=null,this.rangeList=null,this.addRange=function(w,S){if(w){if(!this.inMultiSelectMode&&this.rangeCount===0){var P=this.toOrientedRange();if(this.rangeList.add(P),this.rangeList.add(w),this.rangeList.ranges.length!=2)return this.rangeList.removeAll(),S||this.fromOrientedRange(w);this.rangeList.removeAll(),this.rangeList.add(P),this.$onAddRange(P)}return w.cursor||(w.cursor=w.end),P=this.rangeList.add(w),this.$onAddRange(w),P.length&&this.$onRemoveRange(P),1<this.rangeCount&&!this.inMultiSelectMode&&(this._signal("multiSelect"),this.inMultiSelectMode=!0,this.session.$undoSelect=!1,this.rangeList.attach(this.session)),S||this.fromOrientedRange(w)}},this.toSingleRange=function(w){w=w||this.ranges[0];var S=this.rangeList.removeAll();S.length&&this.$onRemoveRange(S),w&&this.fromOrientedRange(w)},this.substractPoint=function(w){if(w=this.rangeList.substractPoint(w),w)return this.$onRemoveRange(w),w[0]},this.mergeOverlappingRanges=function(){var w=this.rangeList.merge();w.length&&this.$onRemoveRange(w)},this.$onAddRange=function(w){this.rangeCount=this.rangeList.ranges.length,this.ranges.unshift(w),this._signal("addRange",{range:w})},this.$onRemoveRange=function(w){var S;this.rangeCount=this.rangeList.ranges.length,this.rangeCount==1&&this.inMultiSelectMode&&(S=this.rangeList.ranges.pop(),w.push(S),this.rangeCount=0);for(var P=w.length;P--;){var k=this.ranges.indexOf(w[P]);this.ranges.splice(k,1)}this._signal("removeRange",{ranges:w}),this.rangeCount===0&&this.inMultiSelectMode&&(this.inMultiSelectMode=!1,this._signal("singleSelect"),this.session.$undoSelect=!0,this.rangeList.detach(this.session)),(S=S||this.ranges[0])&&!S.isEqual(this.getRange())&&this.fromOrientedRange(S)},this.$initRangeList=function(){this.rangeList||(this.rangeList=new g,this.ranges=[],this.rangeCount=0)},this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]},this.splitIntoLines=function(){for(var w=this.ranges.length?this.ranges:[this.getRange()],S=[],P=0;P<w.length;P++){var k=w[P],L=k.start.row,R=k.end.row;if(L===R)S.push(k.clone());else{for(S.push(new b(L,k.start.column,L,this.session.getLine(L).length));++L<R;)S.push(this.getLineRange(L,!0));S.push(new b(R,0,R,k.end.column))}P!=0||this.isBackwards()||(S=S.reverse())}for(this.toSingleRange(),P=S.length;P--;)this.addRange(S[P])},this.joinSelections=function(){var S=this.rangeList.ranges,w=S[S.length-1],S=b.fromPoints(S[0].start,w.end);this.toSingleRange(),this.setSelectionRange(S,w.cursor==w.start)},this.toggleBlockSelection=function(){var w,S;1<this.rangeCount?(S=(w=this.rangeList.ranges)[w.length-1],w=b.fromPoints(w[0].start,S.end),this.toSingleRange(),this.setSelectionRange(w,S.cursor==S.start)):(w=this.session.documentToScreenPosition(this.cursor),S=this.session.documentToScreenPosition(this.anchor),this.rectangularRangeBlock(w,S).forEach(this.addRange,this))},this.rectangularRangeBlock=function(w,S,P){var k,L,R,N,F,H,V,q=[],Q=w.column<S.column,O=(N=(Q?(k=w.column,L=S.column,R=w.offsetX,S):(k=S.column,L=w.column,R=S.offsetX,w)).offsetX,w.row<S.row);H=(O?(F=w.row,S):(F=S.row,w)).row,k<0&&(k=0),(F=F<0?0:F)==H&&(P=!0);for(var B,j,U=F;U<=H;U++){var z=b.fromPoints(this.session.screenToDocumentPosition(U,k,R),this.session.screenToDocumentPosition(U,L,N));if(z.isEmpty()){if(V&&(B=z.end,j=V,B.row==j.row)&&B.column==j.column)break;V=z.end}z.cursor=Q?z.start:z.end,q.push(z)}if(O&&q.reverse(),!P){for(var $=q.length-1;q[$].isEmpty()&&0<$;)$--;if(0<$)for(var Z=0;q[Z].isEmpty();)Z++;for(var J=$;Z<=J;J--)q[J].isEmpty()&&q.splice(J,1)}return q}}).call(y.prototype),h("./editor").Editor);function E(w){var S,P;function k(L){P&&(S.renderer.setMouseCursor(""),P=!1)}w.$multiselectOnSessionChange||(w.$onAddRange=w.$onAddRange.bind(w),w.$onRemoveRange=w.$onRemoveRange.bind(w),w.$onMultiSelect=w.$onMultiSelect.bind(w),w.$onSingleSelect=w.$onSingleSelect.bind(w),w.$multiselectOnSessionChange=f.onSessionChange.bind(w),w.$checkMultiselectChange=w.$checkMultiselectChange.bind(w),w.$multiselectOnSessionChange(w),w.on("changeSession",w.$multiselectOnSessionChange),w.on("mousedown",x),w.commands.addCommands(_.defaultCommands),(S=w).textInput&&(w=S.textInput.getElement(),P=!1,A.addListener(w,"keydown",function(L){L=L.keyCode==18&&!(L.ctrlKey||L.shiftKey||L.metaKey),S.$blockSelectEnabled&&L?P||(S.renderer.setMouseCursor("crosshair"),P=!0):P&&k()},S),A.addListener(w,"keyup",k,S),A.addListener(w,"blur",k,S)))}(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.addSelectionMarker=function(w){w.cursor||(w.cursor=w.end);var S=this.getSelectionStyle();return w.marker=this.session.addMarker(w,"ace_selection",S),this.session.$selectionMarkers.push(w),this.session.selectionMarkerCount=this.session.$selectionMarkers.length,w},this.removeSelectionMarker=function(w){w.marker&&(this.session.removeMarker(w.marker),(w=this.session.$selectionMarkers.indexOf(w))!=-1&&this.session.$selectionMarkers.splice(w,1),this.session.selectionMarkerCount=this.session.$selectionMarkers.length)},this.removeSelectionMarkers=function(w){for(var S=this.session.$selectionMarkers,P=w.length;P--;){var k=w[P];k.marker&&(this.session.removeMarker(k.marker),(k=S.indexOf(k))!=-1)&&S.splice(k,1)}this.session.selectionMarkerCount=S.length},this.$onAddRange=function(w){this.addSelectionMarker(w.range),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onRemoveRange=function(w){this.removeSelectionMarkers(w.ranges),this.renderer.updateCursor(),this.renderer.updateBackMarkers()},this.$onMultiSelect=function(w){this.inMultiSelectMode||(this.inMultiSelectMode=!0,this.setStyle("ace_multiselect"),this.keyBinding.addKeyboardHandler(_.keyboardHandler),this.commands.setDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers())},this.$onSingleSelect=function(w){this.session.multiSelect.inVirtualMode||(this.inMultiSelectMode=!1,this.unsetStyle("ace_multiselect"),this.keyBinding.removeKeyboardHandler(_.keyboardHandler),this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec),this.renderer.updateCursor(),this.renderer.updateBackMarkers(),this._emit("changeSelection"))},this.$onMultiSelectExec=function(w){var S,P=w.command,k=w.editor;if(k.multiSelect)return P.multiSelectAction?S=P.multiSelectAction=="forEach"?k.forEachSelection(P,w.args):P.multiSelectAction=="forEachLine"?k.forEachSelection(P,w.args,!0):P.multiSelectAction=="single"?(k.exitMultiSelectMode(),P.exec(k,w.args||{})):P.multiSelectAction(k,w.args||{}):(S=P.exec(k,w.args||{}),k.multiSelect.addRange(k.multiSelect.toOrientedRange()),k.multiSelect.mergeOverlappingRanges()),S},this.forEachSelection=function(w,S,P){if(!this.inVirtualSelectionMode){var k,H=P&&P.keepOrder,L=P==1||P&&P.$byLines,R=this.session,P=this.selection,N=P.rangeList,F=(H?P:N).ranges;if(!F.length)return w.exec?w.exec(this,S||{}):w(this,S||{});var H=P._eventRegistry,V=(P._eventRegistry={},new y(R));this.inVirtualSelectionMode=!0;for(var q=F.length;q--;){if(L)for(;0<q&&F[q].start.row==F[q-1].end.row;)q--;V.fromOrientedRange(F[q]),V.index=q,this.selection=R.selection=V;var Q=w.exec?w.exec(this,S||{}):w(this,S||{});k||Q===void 0||(k=Q),V.toOrientedRange(F[q])}return V.detach(),this.selection=R.selection=P,this.inVirtualSelectionMode=!1,P._eventRegistry=H,P.mergeOverlappingRanges(),P.ranges[0]&&P.fromOrientedRange(P.ranges[0]),N=this.renderer.$scrollAnimation,this.onCursorChange(),this.onSelectionChange(),N&&N.from==N.to&&this.renderer.animateScrolling(N.from),k}},this.exitMultiSelectMode=function(){this.inMultiSelectMode&&!this.inVirtualSelectionMode&&this.multiSelect.toSingleRange()},this.getSelectedText=function(){var w="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){for(var S=this.multiSelect.rangeList.ranges,P=[],k=0;k<S.length;k++)P.push(this.session.getTextRange(S[k]));var L=this.session.getDocument().getNewLineCharacter();(w=P.join(L)).length==(P.length-1)*L.length&&(w="")}else this.selection.isEmpty()||(w=this.session.getTextRange(this.getSelectionRange()));return w},this.$checkMultiselectChange=function(w,S){var P;this.inMultiSelectMode&&!this.inVirtualSelectionMode&&(P=this.multiSelect.ranges[0],this.multiSelect.isEmpty()&&S==this.multiSelect.anchor||((P=S==this.multiSelect.anchor?P.cursor==P.start?P.end:P.start:P.cursor).row!=S.row||this.session.$clipPositionToDocument(P.row,P.column).column!=S.column?this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange()):this.multiSelect.mergeOverlappingRanges()))},this.findAll=function(w,S,P){(S=S||{}).needle=w||S.needle,S.needle==null&&(k=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange(),S.needle=this.session.getTextRange(k)),this.$search.set(S);var k,L=this.$search.findAll(this.session);if(!L.length)return 0;var R=this.multiSelect;P||R.toSingleRange(L[0]);for(var N=L.length;N--;)R.addRange(L[N],!0);return k&&R.rangeList.rangeAtPoint(k.start)&&R.addRange(k,!0),L.length},this.selectMoreLines=function(w,S){var P,k,L,R=this.selection.toOrientedRange(),N=R.cursor==R.end,F=this.session.documentToScreenPosition(R.cursor),H=(this.selection.$desiredColumn&&(F.column=this.selection.$desiredColumn),this.session.screenToDocumentPosition(F.row+w,F.column));w=R.isEmpty()?H:(P=this.session.documentToScreenPosition(N?R.end:R.start),this.session.screenToDocumentPosition(P.row+w,P.column)),N?(k=b.fromPoints(H,w)).cursor=k.start:(k=b.fromPoints(w,H)).cursor=k.end,k.desiredColumn=F.column,this.selection.inMultiSelectMode?S&&(L=R.cursor):this.selection.addRange(R),this.selection.addRange(k),L&&this.selection.substractPoint(L)},this.transposeSelections=function(w){for(var S,P=this.session,k=P.multiSelect,L=k.ranges,R=L.length;R--;)(F=L[R]).isEmpty()&&(S=P.getWordRange(F.start.row,F.start.column),F.start.row=S.start.row,F.start.column=S.start.column,F.end.row=S.end.row,F.end.column=S.end.column);k.mergeOverlappingRanges();for(var N=[],R=L.length;R--;){var F=L[R];N.unshift(P.getTextRange(F))}for(w<0?N.unshift(N.pop()):N.push(N.shift()),R=L.length;R--;){var H=(F=L[R]).clone();P.replace(F,N[R]),F.start.row=H.start.row,F.start.column=H.start.column}k.fromOrientedRange(k.ranges[0])},this.selectMore=function(w,S,P){var k,L=this.session,R=L.multiSelect.toOrientedRange();R.isEmpty()&&((R=L.getWordRange(R.start.row,R.start.column)).cursor=w==-1?R.start:R.end,this.multiSelect.addRange(R),P)||(P=L.getTextRange(R),L=L,P=P,k=w,I.$options.wrap=!0,I.$options.needle=P,I.$options.backwards=k==-1,(P=I.find(L))&&(P.cursor=w==-1?P.start:P.end,this.session.unfold(P),this.multiSelect.addRange(P),this.renderer.scrollCursorIntoView(null,.5)),S&&this.multiSelect.substractPoint(R.cursor))},this.alignCursors=function(){var w=this.session,S=w.multiSelect,P=S.ranges,k=-1,L=P.filter(function(B){if(B.cursor.row==k)return!0;k=B.cursor.row});if(P.length&&L.length!=P.length-1){L.forEach(function(B){S.substractPoint(B.cursor)});var R=0,N=1/0,F=P.map(function(j){var j=j.cursor,U=w.getLine(j.row).substr(j.column).search(/\S/g);return j.column>R&&(R=j.column),(U=U==-1?0:U)<N&&(N=U),U});P.forEach(function(B,$){var U=B.cursor,z=R-U.column,$=F[$]-N;$<z?w.insert(U,v.stringRepeat(" ",z-$)):w.remove(new b(U.row,U.column,U.row,U.column-z+$)),B.start.column=B.end.column=R,B.start.row=B.end.row=U.row,B.cursor=B.end}),S.fromOrientedRange(P[0]),this.renderer.updateCursor(),this.renderer.updateBackMarkers()}else{var L=this.selection.getRange(),H=L.start.row,V=L.end.row,P=H==V;if(P){for(var q,Q=this.session.getLength();q=this.session.getLine(V),/[=:]/.test(q)&&++V<Q;);for(;q=this.session.getLine(H),/[=:]/.test(q)&&0<--H;);H<0&&(H=0),Q<=V&&(V=Q-1)}var O=this.session.removeFullLines(H,V),O=this.$reAlignText(O,P);this.session.insert({row:H,column:0},O.join(`
`)+`
`),P||(L.start.column=0,L.end.column=O[O.length-1].length),this.selection.setRange(L)}},this.$reAlignText=function(w,S){var P,k,L,R=!0,N=!0;return w.map(function(V){var q=V.match(/(\s*)(.*?)(\s*)([=:].*)/);return q?(P==null?(P=q[1].length,k=q[2].length,L=q[3].length):(P+k+L!=q[1].length+q[2].length+q[3].length&&(N=!1),P!=q[1].length&&(R=!1),P>q[1].length&&(P=q[1].length),k<q[2].length&&(k=q[2].length),L>q[3].length&&(L=q[3].length)),q):[V]}).map(S?H:R?N?function(V){return V[2]?F(P+k-V[2].length)+V[2]+F(L)+V[4].replace(/^([=:])\s+/,"$1 "):V[0]}:H:function(V){return V[2]?F(P)+V[2]+F(L)+V[4].replace(/^([=:])\s+/,"$1 "):V[0]});function F(V){return v.stringRepeat(" ",V)}function H(V){return V[2]?F(P)+V[2]+F(k-V[2].length+L)+V[4].replace(/^([=:])\s+/,"$1 "):V[0]}}}).call(T.prototype),f.onSessionChange=function(P){var S=P.session,P=(S&&!S.multiSelect&&(S.$selectionMarkers=[],S.selection.$initRangeList(),S.multiSelect=S.selection),this.multiSelect=S&&S.multiSelect,P.oldSession);P&&(P.multiSelect.off("addRange",this.$onAddRange),P.multiSelect.off("removeRange",this.$onRemoveRange),P.multiSelect.off("multiSelect",this.$onMultiSelect),P.multiSelect.off("singleSelect",this.$onSingleSelect),P.multiSelect.lead.off("change",this.$checkMultiselectChange),P.multiSelect.anchor.off("change",this.$checkMultiselectChange)),S&&(S.multiSelect.on("addRange",this.$onAddRange),S.multiSelect.on("removeRange",this.$onRemoveRange),S.multiSelect.on("multiSelect",this.$onMultiSelect),S.multiSelect.on("singleSelect",this.$onSingleSelect),S.multiSelect.lead.on("change",this.$checkMultiselectChange),S.multiSelect.anchor.on("change",this.$checkMultiselectChange)),S&&this.inMultiSelectMode!=S.selection.inMultiSelectMode&&(S.selection.inMultiSelectMode?this.$onMultiSelect():this.$onSingleSelect())},f.MultiSelect=E,h("./config").defineOptions(T.prototype,"editor",{enableMultiselect:{set:function(w){E(this),w?this.on("mousedown",x):this.off("mousedown",x)},value:!0},enableBlockSelect:{set:function(w){this.$blockSelectEnabled=w},value:!0}})}),ace.define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],function(b,f,C){"use strict";var g=b("../../range").Range,b=f.FoldMode=function(){};(function(){this.foldingStartMarker=null,this.foldingStopMarker=null,this.getFoldWidget=function(y,x,A){return y=y.getLine(A),this.foldingStartMarker.test(y)?"start":x=="markbeginend"&&this.foldingStopMarker&&this.foldingStopMarker.test(y)?"end":""},this.getFoldWidgetRange=function(y,x,A){return null},this.indentationBlock=function(y,x,A){var v=/\S/,_=y.getLine(x),I=_.search(v);if(I!=-1){for(var T,A=A||_.length,E=y.getLength(),_=x,w=x;++x<E;){var S=y.getLine(x).search(v);if(S!=-1){if(S<=I&&(S=y.getTokenAt(x,0),!S||S.type!=="string"))break;w=x}}return _<w?(T=y.getLine(w).length,new g(_,A,w,T)):void 0}},this.openingBracketBlock=function(y,x,A,v,_){if(A={row:A,column:v+1},v=y.$findClosingBracket(x,A,_),v)return(x=(x=y.foldWidgets[v.row])==null?y.getFoldWidget(v.row):x)=="start"&&v.row>A.row&&(v.row--,v.column=y.getLine(v.row).length),g.fromPoints(A,v)},this.closingBracketBlock=function(y,x,A,v,_){if(A={row:A,column:v},v=y.$findOpeningBracket(x,A),v)return v.column++,A.column--,g.fromPoints(v,A)}}).call(b.prototype)}),ace.define("ace/ext/error_marker",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range","ace/config"],function(h,f,C){"use strict";var g=h("../line_widgets").LineWidgets,b=h("../lib/dom"),y=h("../range").Range,x=h("../config").nls;function A(v,_,I){var T=v.getAnnotations().sort(y.comparePoints);if(T.length){var E=function(P,k,L){for(var R=0,N=P.length-1;R<=N;){var F=R+N>>1,H=L(k,P[F]);if(0<H)R=1+F;else{if(!(H<0))return F;N=F-1}}return-(R+1)}(T,{row:_,column:-1},y.comparePoints),w=((E=E<0?-E-1:E)>=T.length?E=0<I?0:T.length-1:E===0&&I<0&&(E=T.length-1),T[E]);if(w&&I){if(w.row===_){for(;(w=T[E+=I])&&w.row===_;);if(!w)return T.slice()}var S=[];for(_=w.row;S[I<0?"unshift":"push"](w),(w=T[E+=I])&&w.row==_;);return S.length&&S}}}f.showErrorMarker=function(v,k){var I,T=v.session,E=(T.widgetManager||(T.widgetManager=new g(T),T.widgetManager.attach(v)),v.getCursorPosition()),P=E.row,L=T.widgetManager.getWidgetsAtRow(P).filter(function(R){return R.type=="errorMarker"})[0],P=(L?L.destroy():P-=k,A(T,P,k));if(P)k=P[0],E.column=(k.pos&&typeof k.column!="number"?k.pos.sc:k.column)||0,E.row=k.row,I=v.renderer.$gutterLayer.$annotations[E.row];else{if(L)return;I={text:[x("error-marker.good-state","Looks good!")],className:"ace_ok"}}v.session.unfold(E.row),v.selection.moveToPosition(E);function w(R,N,F){if(N===0&&(F==="esc"||F==="return"))return S.destroy(),{command:"null"}}var S={row:E.row,fixedWidth:!0,coverGutter:!0,el:b.createElement("div"),type:"errorMarker"},P=S.el.appendChild(b.createElement("div")),k=S.el.appendChild(b.createElement("div")),L=(k.className="error_widget_arrow "+I.className,v.renderer.$cursorLayer.getPixelPosition(E).left);k.style.left=L+v.renderer.gutterWidth-5+"px",S.el.className="error_widget_wrapper",P.className="error_widget "+I.className,P.innerHTML=I.text.join("<br>"),P.appendChild(b.createElement("div")),S.destroy=function(){v.$mouseHandler.isMousePressed||(v.keyBinding.removeKeyboardHandler(w),T.widgetManager.removeLineWidget(S),v.off("changeSelection",S.destroy),v.off("changeSession",S.destroy),v.off("mouseup",S.destroy),v.off("change",S.destroy))},v.keyBinding.addKeyboardHandler(w),v.on("changeSelection",S.destroy),v.on("changeSession",S.destroy),v.on("mouseup",S.destroy),v.on("change",S.destroy),v.session.widgetManager.addLineWidget(S),S.el.onmousedown=v.focus.bind(v),v.renderer.scrollCursorIntoView(null,.5,{bottom:S.el.offsetHeight})},b.importCssString(`
    .error_widget_wrapper {
        background: inherit;
        color: inherit;
        border:none
    }
    .error_widget {
        border-top: solid 2px;
        border-bottom: solid 2px;
        margin: 5px 0;
        padding: 10px 40px;
        white-space: pre-wrap;
    }
    .error_widget.ace_error, .error_widget_arrow.ace_error{
        border-color: #ff5a5a
    }
    .error_widget.ace_warning, .error_widget_arrow.ace_warning{
        border-color: #F1D817
    }
    .error_widget.ace_info, .error_widget_arrow.ace_info{
        border-color: #5a5a5a
    }
    .error_widget.ace_ok, .error_widget_arrow.ace_ok{
        border-color: #5aaa5a
    }
    .error_widget_arrow {
        position: absolute;
        border: solid 5px;
        border-top-color: transparent!important;
        border-right-color: transparent!important;
        border-left-color: transparent!important;
        top: -5px;
    }
`,"error_marker.css",!1)}),ace.define("ace/ace",["require","exports","module","ace/lib/dom","ace/range","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/multi_select","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config","ace/loader_build"],function(h,f,C){"use strict";h("./loader_build")(f);var g=h("./lib/dom"),b=h("./range").Range,y=h("./editor").Editor,x=h("./edit_session").EditSession,A=h("./undomanager").UndoManager,v=h("./virtual_renderer").VirtualRenderer;h("./worker/worker_client"),h("./keyboard/hash_handler"),h("./placeholder"),h("./multi_select"),h("./mode/folding/fold_mode"),h("./theme/textmate"),h("./ext/error_marker"),f.config=h("./config"),f.edit=function(_,I){if(typeof _=="string"){var T=_;if(!(_=document.getElementById(T)))throw new Error("ace.edit can't find div #"+T)}var E,w;return _&&_.env&&_.env.editor instanceof y?_.env.editor:(T="",_&&/input|textarea/i.test(_.tagName)?(T=(E=_).value,_=g.createElement("pre"),E.parentNode.replaceChild(_,E)):_&&(T=_.textContent,_.innerHTML=""),T=f.createEditSession(T),_=new y(new v(_),T,I),w={document:T,editor:_,onResize:_.resize.bind(_,null)},E&&(w.textarea=E),_.on("destroy",function(){w.editor.container.env=null}),_.container.env=_.env=w,_)},f.createEditSession=function(_,I){return _=new x(_,I),_.setUndoManager(new A),_},f.Range=b,f.Editor=y,f.EditSession=x,f.UndoManager=A,f.VirtualRenderer=v,f.version=f.config.version}),ace.require(["ace/ace"],function(h){h&&(h.config.init(!0),h.define=ace.define);var f,C=function(){return this}();for(f in(C=(C=C||typeof window>"u"?C:window)||typeof self>"u"?C:self).ace||(C.ace=h),h)h.hasOwnProperty(f)&&(C.ace[f]=h[f]);C.ace.default=C.ace,n&&(n.exports=C.ace)})},6489:function(n,o,i){n=i.nmd(n),ace.define("ace/snippets",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/range_list","ace/keyboard/hash_handler","ace/tokenizer","ace/clipboard","ace/editor"],function(s,a,l){"use strict";var c=s("./lib/dom"),E=s("./lib/oop"),u=s("./lib/event_emitter").EventEmitter,d=s("./lib/lang"),m=s("./range").Range,p=s("./range_list").RangeList,h=s("./keyboard/hash_handler").HashHandler,f=s("./tokenizer").Tokenizer,C=s("./clipboard"),g={CURRENT_WORD:function(w){return w.session.getTextRange(w.session.getWordRange())},SELECTION:function(w,S,P){return w=w.session.getTextRange(),P?w.replace(/\n\r?([ \t]*\S)/g,`
`+P+"$1"):w},CURRENT_LINE:function(w){return w.session.getLine(w.getCursorPosition().row)},PREV_LINE:function(w){return w.session.getLine(w.getCursorPosition().row-1)},LINE_INDEX:function(w){return w.getCursorPosition().row},LINE_NUMBER:function(w){return w.getCursorPosition().row+1},SOFT_TABS:function(w){return w.session.getUseSoftTabs()?"YES":"NO"},TAB_SIZE:function(w){return w.session.getTabSize()},CLIPBOARD:function(w){return C.getText&&C.getText()},FILENAME:function(w){return/[^/\\]*$/.exec(this.FILEPATH(w))[0]},FILENAME_BASE:function(w){return/[^/\\]*$/.exec(this.FILEPATH(w))[0].replace(/\.[^.]*$/,"")},DIRECTORY:function(w){return this.FILEPATH(w).replace(/[^/\\]*$/,"")},FILEPATH:function(w){return"/not implemented.txt"},WORKSPACE_NAME:function(){return"Unknown"},FULLNAME:function(){return"Unknown"},BLOCK_COMMENT_START:function(w){return w=w.session.$mode||{},w.blockComment&&w.blockComment.start||""},BLOCK_COMMENT_END:function(w){return w=w.session.$mode||{},w.blockComment&&w.blockComment.end||""},LINE_COMMENT:function(w){return(w.session.$mode||{}).lineCommentStart||""},CURRENT_YEAR:b.bind(null,{year:"numeric"}),CURRENT_YEAR_SHORT:b.bind(null,{year:"2-digit"}),CURRENT_MONTH:b.bind(null,{month:"numeric"}),CURRENT_MONTH_NAME:b.bind(null,{month:"long"}),CURRENT_MONTH_NAME_SHORT:b.bind(null,{month:"short"}),CURRENT_DATE:b.bind(null,{day:"2-digit"}),CURRENT_DAY_NAME:b.bind(null,{weekday:"long"}),CURRENT_DAY_NAME_SHORT:b.bind(null,{weekday:"short"}),CURRENT_HOUR:b.bind(null,{hour:"2-digit",hour12:!1}),CURRENT_MINUTE:b.bind(null,{minute:"2-digit"}),CURRENT_SECOND:b.bind(null,{second:"2-digit"})};function b(w){return w=new Date().toLocaleString("en-us",w),w.length==1?"0"+w:w}g.SELECTED_TEXT=g.SELECTION,x.prototype.getTokenizer=function(){return x.$tokenizer||this.createTokenizer()},x.prototype.createTokenizer=function(){function w(k){return k=k.substr(1),/^\d+$/.test(k)?[{tabstopId:parseInt(k,10)}]:[{text:k}]}function S(k){return"(?:[^\\\\"+k+"]|\\\\.)"}var P={regex:"/("+S("/")+"+)/",onMatch:function(k,L,R){return R=R[0],R.fmtString=!0,R.guard=k.slice(1,-1),R.flag=""},next:"formatString"};return x.$tokenizer=new f({start:[{regex:/\\./,onMatch:function(k,L,R){var N=k[1];return[k=N=="}"&&R.length||"`$\\".indexOf(N)!=-1?N:k]}},{regex:/}/,onMatch:function(k,L,R){return[R.length?R.shift():k]}},{regex:/\$(?:\d+|\w+)/,onMatch:w},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(k,L,R){return k=w(k.substr(1)),R.unshift(k[0]),k},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+S("\\|")+"*\\|",onMatch:function(k,L,R){return k=k.slice(1,-1).replace(/\\[,|\\]|,/g,function(N){return N.length==2?N[1]:"\0"}).split("\0").map(function(N){return{value:N}}),[(R[0].choices=k)[0]]},next:"start"},P,{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:/:/,onMatch:function(k,L,R){return R.length&&R[0].expectElse?(R[0].expectElse=!1,R[0].ifEnd={elseEnd:R[0]},[R[0].ifEnd]):":"}},{regex:/\\./,onMatch:function(k,L,R){var N=k[1];return N=="}"&&R.length||"`$\\".indexOf(N)!=-1?k=N:N=="n"?k=`
`:N=="t"?k="	":"ulULE".indexOf(N)!=-1&&(k={changeCase:N,local:"a"<N}),[k]}},{regex:"/\\w*}",onMatch:function(k,L,R){return R=R.shift(),R&&(R.flag=k.slice(1,-1)),this.next=R&&R.tabstopId?"start":"",[R||k]},next:"start"},{regex:/\$(?:\d+|\w+)/,onMatch:function(k,L,R){return[{text:k.slice(1)}]}},{regex:/\${\w+/,onMatch:function(k,L,R){return k={text:k.slice(2)},R.unshift(k),[k]},next:"formatStringVar"},{regex:/\n/,token:"newline",merge:!1},{regex:/}/,onMatch:function(k,L,R){return R=R.shift(),this.next=R&&R.tabstopId?"start":"",[R||k]},next:"start"}],formatStringVar:[{regex:/:\/\w+}/,onMatch:function(k,L,R){return R[0].formatFunction=k.slice(2,-1),[R.shift()]},next:"formatString"},P,{regex:/:[\?\-+]?/,onMatch:function(k,L,R){k[1]=="+"&&(R[0].ifEnd=R[0]),k[1]=="?"&&(R[0].expectElse=!0)},next:"formatString"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"formatString"}]})},x.prototype.tokenizeTmSnippet=function(w,S){return this.getTokenizer().getLineTokens(w,S).tokens.map(function(P){return P.value||P})},x.prototype.getVariableValue=function(w,S,P){var k;return/^\d+$/.test(S)?(this.variables.__||{})[S]||"":/^[A-Z]\d+$/.test(S)?(this.variables[S[0]+"__"]||{})[S.substr(1)]||"":(S=S.replace(/^TM_/,""),!this.variables.hasOwnProperty(S)||(k=typeof(k=this.variables[S])=="function"?this.variables[S](w,S,P):k)==null?"":k)},x.prototype.tmStrFormat=function(w,S,P){var k,L,R,N;return S.fmt?(k=S.flag||"",L=S.guard,L=new RegExp(L,k.replace(/[^gim]/g,"")),R=typeof S.fmt=="string"?this.tokenizeTmSnippet(S.fmt,"formatString"):S.fmt,N=this,w.replace(L,function(){for(var F=N.variables.__,H=(N.variables.__=[].slice.call(arguments),N.resolveVariables(R,P)),V="E",q=0;q<H.length;q++){var Q,O=H[q];typeof O=="object"?(H[q]="",O.changeCase&&O.local?(Q=H[q+1])&&typeof Q=="string"&&(O.changeCase=="u"?H[q]=Q[0].toUpperCase():H[q]=Q[0].toLowerCase(),H[q+1]=Q.substr(1)):O.changeCase&&(V=O.changeCase)):V=="U"?H[q]=O.toUpperCase():V=="L"&&(H[q]=O.toLowerCase())}return N.variables.__=F,H.join("")})):w},x.prototype.tmFormatFunction=function(w,S,P){return S.formatFunction=="upcase"?w.toUpperCase():S.formatFunction=="downcase"?w.toLowerCase():w},x.prototype.resolveVariables=function(w,S){for(var P=[],k="",L=!0,R=0;R<w.length;R++){var N,F=w[R];typeof F=="string"?(P.push(F),F==`
`?(L=!0,k=""):L&&(k=/^\t*/.exec(F)[0],L=/\S/.test(F))):F&&(L=!1,F.fmtString&&((N=w.indexOf(F,R+1))==-1&&(N=w.length),F.fmt=w.slice(R+1,N),R=N),F.text?(N=this.getVariableValue(S,F.text,k)+"",F.fmtString&&(N=this.tmStrFormat(N,F,S)),(N=F.formatFunction?this.tmFormatFunction(N,F,S):N)&&!F.ifEnd?(P.push(N),H(F)):!N&&F.ifEnd&&H(F.ifEnd)):F.elseEnd?H(F.elseEnd):F.tabstopId==null&&F.changeCase==null||P.push(F))}function H(V){V=w.indexOf(V,R+1),V!=-1&&(R=V)}return P},x.prototype.getDisplayTextForSnippet=function(w,S){return A.call(this,w,S).text},x.prototype.insertSnippetForSelection=function(F,k,L){var k=A.call(this,F,k,L=L===void 0?{}:L),L=F.getSelectionRange(),R=F.session.replace(L,k.text),N=new v(F),F=F.inVirtualSelectionMode&&F.selection.index;N.addTabstops(k.tabstops,L.start,R,F)},x.prototype.insertSnippet=function(w,S,P){P===void 0&&(P={});var k=this;if(w.inVirtualSelectionMode)return k.insertSnippetForSelection(w,S,P);w.forEachSelection(function(){k.insertSnippetForSelection(w,S,P)},null,{keepOrder:!0}),w.tabstopManager&&w.tabstopManager.tabNext()},x.prototype.$getScope=function(w){var S,P=w.session.$mode.$id||"";return(P=P.split("/").pop())!=="html"&&P!=="php"||(P!=="php"||w.session.$mode.inlinePhp||(P="html"),S=w.getCursorPosition(),(w=typeof(w=w.session.getState(S.row))=="object"?w[0]:w).substring&&(w.substring(0,3)=="js-"?P="javascript":w.substring(0,4)=="css-"?P="css":w.substring(0,4)=="php-"&&(P="php"))),P},x.prototype.getActiveScopes=function(S){var S=this.$getScope(S),P=[S],k=this.snippetMap;return k[S]&&k[S].includeScopes&&P.push.apply(P,k[S].includeScopes),P.push("_"),P},x.prototype.expandWithTab=function(w,S){var P=this,k=w.forEachSelection(function(){return P.expandSnippetForSelection(w,S)},null,{keepOrder:!0});return k&&w.tabstopManager&&w.tabstopManager.tabNext(),k},x.prototype.expandSnippetForSelection=function(w,S){var P,k=w.getCursorPosition(),L=w.session.getLine(k.row),R=L.substring(0,k.column),N=L.substr(k.column),F=this.snippetMap;return this.getActiveScopes(w).some(function(H){return H=F[H],!!(P=H?this.findMatchingSnippet(H,R,N):P)},this),!!P&&(S&&S.dryRun||(w.session.doc.removeInLine(k.row,k.column-P.replaceBefore.length,k.column+P.replaceAfter.length),this.variables.M__=P.matchBefore,this.variables.T__=P.matchAfter,this.insertSnippetForSelection(w,P.content),this.variables.M__=this.variables.T__=null),!0)},x.prototype.findMatchingSnippet=function(w,S,P){for(var k=w.length;k--;){var L=w[k];if((!L.startRe||L.startRe.test(S))&&(!L.endRe||L.endRe.test(P))&&(L.startRe||L.endRe))return L.matchBefore=L.startRe?L.startRe.exec(S):[""],L.matchAfter=L.endRe?L.endRe.exec(P):[""],L.replaceBefore=L.triggerRe?L.triggerRe.exec(S)[0]:"",L.replaceAfter=L.endTriggerRe?L.endTriggerRe.exec(P)[0]:"",L}},x.prototype.register=function(w,S){var P=this.snippetMap,k=this.snippetNameMap,L=this;function R(H){return(H=H&&!/^\^?\(.*\)\$?$|^\\b$/.test(H)?"(?:"+H+")":H)||""}function N(H,V,q){return H=R(H),V=R(V),q?(H=V+H)&&H[H.length-1]!="$"&&(H+="$"):(H+=V)&&H[0]!="^"&&(H="^"+H),new RegExp(H)}function F(H){H.scope||(H.scope=S||"_"),S=H.scope,P[S]||(P[S]=[],k[S]={});var V,q=k[S];H.name&&((V=q[H.name])&&L.unregister(V),q[H.name]=H),P[S].push(H),H.prefix&&(H.tabTrigger=H.prefix),!H.content&&H.body&&(H.content=Array.isArray(H.body)?H.body.join(`
`):H.body),H.tabTrigger&&!H.trigger&&(!H.guard&&/^\w/.test(H.tabTrigger)&&(H.guard="\\b"),H.trigger=d.escapeRegExp(H.tabTrigger)),(H.trigger||H.guard||H.endTrigger||H.endGuard)&&(H.startRe=N(H.trigger,H.guard,!0),H.triggerRe=new RegExp(H.trigger),H.endRe=N(H.endTrigger,H.endGuard,!0),H.endTriggerRe=new RegExp(H.endTrigger))}w=w||[],Array.isArray(w)?w.forEach(F):Object.keys(w).forEach(function(H){F(w[H])}),this._signal("registerSnippets",{scope:S})},x.prototype.unregister=function(w,S){var P=this.snippetMap,k=this.snippetNameMap;function L(R){var N=k[R.scope||S];N&&N[R.name]&&(delete N[R.name],0<=(R=(N=P[R.scope||S])&&N.indexOf(R)))&&N.splice(R,1)}w.content?L(w):Array.isArray(w)&&w.forEach(L)},x.prototype.parseSnippetFile=function(w){w=w.replace(/\r/g,"");for(var S,P,k,L=[],R={},N=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;P=N.exec(w);){if(P[1])try{R=JSON.parse(P[1]),L.push(R)}catch{}P[4]?(R.content=P[4].replace(/^\t/gm,""),L.push(R),R={}):(S=P[2],P=P[3],S=="regex"?(R.guard=(k=/\/((?:[^\/\\]|\\.)*)|$/g).exec(P)[1],R.trigger=k.exec(P)[1],R.endTrigger=k.exec(P)[1],R.endGuard=k.exec(P)[1]):S=="snippet"?(R.tabTrigger=P.match(/^\S*/)[0],R.name||(R.name=P)):S&&(R[S]=P))}return L},x.prototype.getSnippetByName=function(w,S){var P,k=this.snippetNameMap;return this.getActiveScopes(S).some(function(L){return L=k[L],!!(P=L?L[w]:P)},this),P};var y=x;function x(){this.snippetMap={},this.snippetNameMap={},this.variables=g}E.implement(y.prototype,u);var A=function(w,S,P){P===void 0&&(P={});for(var k=w.getCursorPosition(),L=w.session.getLine(k.row),R=w.session.getTabString(),N=L.match(/^\s*/)[0],F=(k.column<N.length&&(N=N.slice(0,k.column)),S=S.replace(/\r/g,""),this.tokenizeTmSnippet(S)),H=(F=(F=this.resolveVariables(F,w)).map(function(Z){return Z!=`
`||P.excludeExtraIndent?typeof Z=="string"?Z.replace(/\t/g,R):Z:Z+N}),[]),V=(F.forEach(function(Z,J){var ie,ne,le;typeof Z=="object"&&(le=Z.tabstopId,(ie=H[le])||((ie=H[le]=[]).index=le,ie.value="",ie.parents={}),ie.indexOf(Z)===-1)&&(Z.choices&&!ie.choices&&(ie.choices=Z.choices),ie.push(Z),(ne=F.indexOf(Z,J+1))!==-1)&&((le=F.slice(J+1,ne)).some(function(ee){return typeof ee=="object"})&&!ie.value?ie.value=le:!le.length||ie.value&&typeof ie.value=="string"||(ie.value=le.join("")))}),H.forEach(function(Z){Z.length=0}),{}),q=0;q<F.length;q++){var Q,O,B,j=F[q];typeof j=="object"&&(B=j.tabstopId,Q=H[B],O=F.indexOf(j,q+1),V[B]?V[B]===j&&(delete V[B],Object.keys(V).forEach(function(Z){Q.parents[Z]=!0})):(V[B]=j,typeof(B=Q.value)!="string"?B=function(Z){for(var J=[],ie=0;ie<Z.length;ie++){if(typeof(ne=Z[ie])=="object"){if(V[ne.tabstopId])continue;var ne=J[Z.lastIndexOf(ne,ie-1)]||{tabstopId:ne.tabstopId}}J[ie]=ne}return J}(B):j.fmt&&(B=this.tmStrFormat(B,j,w)),F.splice.apply(F,[q+1,Math.max(0,O-q)].concat(B,j)),Q.indexOf(j)===-1&&Q.push(j)))}var U=0,z=0,$="";return F.forEach(function(Z){var J;typeof Z=="string"?(1<(J=Z.split(`
`)).length?(z=J[J.length-1].length,U+=J.length-1):z+=Z.length,$+=Z):Z&&(Z.start?Z.end={row:U,column:z}:Z.start={row:U,column:z})}),{text:$,tabstops:H,tokens:F}},v=(_.prototype.attach=function(w){this.$openTabstops=null,this.selectedTabstop=null,this.editor=w,this.session=w.session,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},_.prototype.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges.length=0,this.tabstops.length=0,this.selectedTabstop=null,this.editor.off("change",this.$onChange),this.editor.off("changeSelection",this.$onChangeSelection),this.editor.off("changeSession",this.$onChangeSession),this.editor.commands.off("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.session=null,this.editor=null},_.prototype.onChange=function(w){for(var S=w.action[0]=="r",P=this.selectedTabstop||{},k=P.parents||{},L=this.tabstops.slice(),R=0;R<L.length;R++){var N=L[R],F=N==P||k[N.index];if(N.rangeList.$bias=F?0:1,w.action=="remove"&&N!==P)for(var F=N.parents&&N.parents[P.index],H=(H=N.rangeList.pointIndex(w.start,F))<0?-H-1:H+1,F=N.rangeList.pointIndex(w.end,F),V=N.rangeList.ranges.slice(H,F<0?-F-1:F-1),q=0;q<V.length;q++)this.removeRange(V[q]);N.rangeList.$onChange(w)}var Q=this.session;this.$inChange||!S||Q.getLength()!=1||Q.getValue()||this.detach()},_.prototype.updateLinkedFields=function(){var w=this.selectedTabstop;if(w&&w.hasLinkedRanges&&w.firstNonLinked){this.$inChange=!0;for(var S=this.session,P=S.getTextRange(w.firstNonLinked),k=0;k<w.length;k++){var L,R=w[k];R.linked&&(L=R.original,L=a.snippetManager.tmStrFormat(P,L,this.editor),S.replace(R,L))}this.$inChange=!1}},_.prototype.onAfterExec=function(w){w.command&&!w.command.readOnly&&this.updateLinkedFields()},_.prototype.onChangeSelection=function(){if(this.editor){for(var w=this.editor.selection.lead,S=this.editor.selection.anchor,P=this.editor.selection.isEmpty(),k=0;k<this.ranges.length;k++)if(!this.ranges[k].linked){var L=this.ranges[k].contains(w.row,w.column),R=P||this.ranges[k].contains(S.row,S.column);if(L&&R)return}this.detach()}},_.prototype.onChangeSession=function(){this.detach()},_.prototype.tabNext=function(P){var S=this.tabstops.length,P=this.index+(P||1),P=Math.min(Math.max(P,1),S);this.selectTabstop(P=P==S?0:P),this.updateTabstopMarkers(),P===0&&this.detach()},_.prototype.selectTabstop=function(w){this.$openTabstops=null;var S=this.tabstops[this.index];if(S&&this.addTabstopMarkers(S),this.index=w,(S=this.tabstops[this.index])&&S.length){if(w=(this.selectedTabstop=S).firstNonLinked||S,S.choices&&(w.cursor=w.start),this.editor.inVirtualSelectionMode)this.editor.selection.fromOrientedRange(w);else{var P=this.editor.multiSelect;P.toSingleRange(w);for(var k=0;k<S.length;k++)S.hasLinkedRanges&&S[k].linked||P.addRange(S[k].clone(),!0)}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler),this.selectedTabstop&&this.selectedTabstop.choices&&this.editor.execCommand("startAutocomplete",{matches:this.selectedTabstop.choices})}},_.prototype.addTabstops=function(w,S,P){var k=this.useLink||!this.editor.getOption("enableMultiselect");this.$openTabstops||(this.$openTabstops=[]),w[0]||(P=m.fromPoints(P,P),T(P.start,S),T(P.end,S),w[0]=[P],w[0].index=0);var L=[this.index+1,0],R=this.ranges,N=this.snippetId=(this.snippetId||0)+1;w.forEach(function(F,H){var V=this.$openTabstops[H]||F;V.snippetId=N;for(var q=0;q<F.length;q++){var Q=F[q],O=m.fromPoints(Q.start,Q.end||Q.start);I(O.start,S),I(O.end,S),O.original=Q,O.tabstop=V,R.push(O),V!=F?V.unshift(O):V[q]=O,Q.fmtString||V.firstNonLinked&&k?(O.linked=!0,V.hasLinkedRanges=!0):V.firstNonLinked||(V.firstNonLinked=O)}V.firstNonLinked||(V.hasLinkedRanges=!1),V===F&&(L.push(V),this.$openTabstops[H]=V),this.addTabstopMarkers(V),V.rangeList=V.rangeList||new p,V.rangeList.$bias=0,V.rangeList.addList(V)},this),2<L.length&&(this.tabstops.length&&L.push(L.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,L))},_.prototype.addTabstopMarkers=function(w){var S=this.session;w.forEach(function(P){P.markerId||(P.markerId=S.addMarker(P,"ace_snippet-marker","text"))})},_.prototype.removeTabstopMarkers=function(w){var S=this.session;w.forEach(function(P){S.removeMarker(P.markerId),P.markerId=null})},_.prototype.updateTabstopMarkers=function(){var w;this.selectedTabstop&&(w=this.selectedTabstop.snippetId,this.selectedTabstop.index===0&&w--,this.tabstops.forEach(function(S){S.snippetId===w?this.addTabstopMarkers(S):this.removeTabstopMarkers(S)},this))},_.prototype.removeRange=function(w){var S=w.tabstop.indexOf(w);S!=-1&&w.tabstop.splice(S,1),(S=this.ranges.indexOf(w))!=-1&&this.ranges.splice(S,1),(S=w.tabstop.rangeList.ranges.indexOf(w))!=-1&&w.tabstop.splice(S,1),this.session.removeMarker(w.markerId),w.tabstop.length||((S=this.tabstops.indexOf(w.tabstop))!=-1&&this.tabstops.splice(S,1),this.tabstops.length)||this.detach()},_);function _(w){if(this.index=0,this.ranges=[],this.tabstops=[],w.tabstopManager)return w.tabstopManager;(w.tabstopManager=this).$onChange=this.onChange.bind(this),this.$onChangeSelection=d.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(w)}v.prototype.keyboardHandler=new h,v.prototype.keyboardHandler.bindKeys({Tab:function(w){a.snippetManager&&a.snippetManager.expandWithTab(w)||(w.tabstopManager.tabNext(1),w.renderer.scrollCursorIntoView())},"Shift-Tab":function(w){w.tabstopManager.tabNext(-1),w.renderer.scrollCursorIntoView()},Esc:function(w){w.tabstopManager.detach()}});var I=function(w,S){w.row==0&&(w.column+=S.column),w.row+=S.row},T=function(w,S){w.row==S.row&&(w.column-=S.column),w.row-=S.row},E=(c.importCssString(`
.ace_snippet-marker {
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    background: rgba(194, 193, 208, 0.09);
    border: 1px dotted rgba(211, 208, 235, 0.62);
    position: absolute;
}`,"snippets.css",!1),a.snippetManager=new y,s("./editor").Editor);(function(){this.insertSnippet=function(w,S){return a.snippetManager.insertSnippet(this,w,S)},this.expandSnippet=function(w){return a.snippetManager.expandWithTab(this,w)}}).call(E.prototype)}),ace.define("ace/autocomplete/popup",["require","exports","module","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom","ace/config","ace/lib/useragent"],function(y,a,l){"use strict";function c(_){return"suggest-aria-id:".concat(_)}function u(_){return(_=new m(_)).$maxLines=4,(_=new p(_)).setHighlightActiveLine(!1),_.setShowPrintMargin(!1),_.renderer.setShowGutter(!1),_.renderer.setHighlightGutterLine(!1),_.$mouseHandler.$focusTimeout=0,_.$highlightTagPending=!0,_}function d(_){function I(){}function T(){L(-1)}var E,w=g.createElement("div"),S=u(w),P=(_&&_.appendChild(w),w.style.display="none",S.renderer.content.style.cursor="default",S.renderer.setStyle("ace_autocomplete"),S.renderer.$textLayer.element.setAttribute("role",x),S.renderer.$textLayer.element.setAttribute("aria-roledescription",b("autocomplete.popup.aria-roledescription","Autocomplete suggestions")),S.renderer.$textLayer.element.setAttribute("aria-label",b("autocomplete.popup.aria-label","Autocomplete suggestions")),S.renderer.textarea.setAttribute("aria-hidden","true"),S.setOption("displayIndentGuides",!1),S.setOption("dragDelay",150),S.focus=I,S.$isFocused=!0,S.renderer.$cursorLayer.restartTimer=I,S.renderer.$cursorLayer.element.style.opacity="0",S.renderer.$maxLines=8,S.renderer.$keepTextAreaAtCursor=!1,S.setHighlightActiveLine(!1),S.session.highlight(""),S.session.$searchHighlight.clazz="ace_highlight-marker",S.on("mousedown",function(R){var N=R.getDocumentPosition();S.selection.moveToPosition(N),k.start.row=k.end.row=N.row,R.stop()}),new h(-1,0,-1,1/0)),k=new h(-1,0,-1,1/0),L=(k.id=S.session.addMarker(k,"ace_active-line","fullLine"),S.setSelectOnHover=function(R){R?P.id&&(S.session.removeMarker(P.id),P.id=null):P.id=S.session.addMarker(P,"ace_line-hover","fullLine")},S.setSelectOnHover(!1),S.on("mousemove",function(R){var N;E?E.x==R.x&&E.y==R.y||((E=R).scrollTop=S.renderer.scrollTop,S.isMouseOver=!0,N=E.getDocumentPosition().row,P.start.row!=N&&(P.id||S.setRow(N),L(N))):E=R}),S.renderer.on("beforeRender",function(){var R;E&&P.start.row!=-1&&(E.$pos=null,R=E.getDocumentPosition().row,P.id||S.setRow(R),L(R,!0))}),S.renderer.on("afterRender",function(){var R,N=S.getRow(),F=S.renderer.$textLayer,H=F.element.childNodes[N-F.config.firstRow],V=document.activeElement;H!==S.selectedNode&&S.selectedNode&&(g.removeCssClass(S.selectedNode,"ace_selected"),V.removeAttribute("aria-activedescendant"),S.selectedNode.removeAttribute(v),S.selectedNode.removeAttribute("id")),(S.selectedNode=H)&&(g.addCssClass(H,"ace_selected"),R=c(N),H.id=R,F.element.setAttribute("aria-activedescendant",R),V.setAttribute("aria-activedescendant",R),H.setAttribute("role",A),H.setAttribute("aria-roledescription",b("autocomplete.popup.item.aria-roledescription","item")),H.setAttribute("aria-label",S.getData(N).caption||S.getData(N).value),H.setAttribute("aria-setsize",S.data.length),H.setAttribute("aria-posinset",N+1),H.setAttribute("aria-describedby","doc-tooltip"),H.setAttribute(v,"true"))}),function(R,N){R!==P.start.row&&(P.start.row=P.end.row=R,N||S.session._emit("changeBackMarker"),S._emit("changeHoverMarker"))});return S.getHoveredRow=function(){return P.start.row},f.addListener(S.container,"mouseout",function(){S.isMouseOver=!1,T()}),S.on("hide",T),S.on("changeSelection",T),S.session.doc.getLength=function(){return S.data.length},S.session.doc.getLine=function(R){return R=S.data[R],typeof R=="string"?R:R&&R.value||""},(_=S.session.bgTokenizer).$tokenizeRow=function(R){var N=S.data[R],F=[];if(N){for(var H,V,q=(N=typeof N=="string"?{value:N}:N).caption||N.value||N.name,Q=q.toLowerCase(),O=(S.filterText||"").toLowerCase(),B=0,j=0,U=0;U<=O.length;U++)U!=j&&(N.matchMask&1<<U||U==O.length)&&(H=O.slice(j,U),j=U,(V=Q.indexOf(H,B))!=-1)&&(z(q.slice(B,V),""),B=V+H.length,z(q.slice(V,B),"completion-highlight"));z(q.slice(B,q.length),""),F.push({type:"completion-spacer",value:" "}),N.meta&&F.push({type:"completion-meta",value:N.meta}),N.message&&F.push({type:"completion-message",value:N.message})}return F;function z($,Z){$&&F.push({type:(N.className||"")+(Z||""),value:$})}},_.$updateOnChange=I,_.start=I,S.session.$computeWidth=function(){return this.screenWidth=0},S.isOpen=!1,S.isTopdown=!1,S.autoSelect=!0,S.filterText="",S.isMouseOver=!1,S.data=[],S.setData=function(R,N){S.filterText=N||"",S.setValue(C.stringRepeat(`
`,R.length),-1),S.data=R||[],S.setRow(0)},S.getData=function(R){return S.data[R]},S.getRow=function(){return k.start.row},S.setRow=function(R){R=Math.max(this.autoSelect?0:-1,Math.min(this.data.length-1,R)),k.start.row!=R&&(S.selection.clearSelection(),k.start.row=k.end.row=R||0,S.session._emit("changeBackMarker"),S.moveCursorTo(R||0,0),S.isOpen)&&S._signal("select")},S.on("changeSelection",function(){S.isOpen&&S.setRow(S.selection.lead.row),S.renderer.scrollCursorIntoView()}),S.hide=function(){this.container.style.display="none",S.anchorPos=null,S.anchor=null,S.isOpen&&(S.isOpen=!1,this._signal("hide"))},S.tryShow=function(R,N,F,H){if(H||!S.isOpen||!S.anchorPos||!S.anchor||S.anchorPos.top!==R.top||S.anchorPos.left!==R.left||S.anchor!==F){var V=this.container,q=window.innerHeight,Q=window.innerWidth,O=this.renderer,B=O.$maxLines*N*1.4,j={top:0,bottom:0,left:0},U=q-R.top-3*this.$borderSize-N,z=R.top-3*this.$borderSize,N=((F=F||(z<=U||B<=U?"bottom":"top"))==="top"?(j.bottom=R.top-this.$borderSize,j.top=j.bottom-B):F==="bottom"&&(j.top=R.top+N+this.$borderSize,j.bottom=j.top+B),0<=j.top&&j.bottom<=q);if(!H&&!N)return!1;O.$maxPixelHeight=N?null:F==="top"?z:U,F==="top"?(V.style.top="",V.style.bottom=q-j.bottom+"px",S.isTopdown=!1):(V.style.top=j.top+"px",V.style.bottom="",S.isTopdown=!0),V.style.display="",B=R.left,B+V.offsetWidth>Q&&(B=Q-V.offsetWidth),V.style.left=B+"px",V.style.right="",S.isOpen||(S.isOpen=!0,this._signal("show"),E=null),S.anchorPos=R,S.anchor=F}return!0},S.show=function(R,N,F){this.tryShow(R,N,F?"bottom":void 0,!0)},S.goTo=function(R){var N=this.getRow(),F=this.session.getLength()-1;switch(R){case"up":N=N<=0?F:N-1;break;case"down":N=F<=N?-1:N+1;break;case"start":N=0;break;case"end":N=F}this.setRow(N)},S.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},S.$imageSize=0,S.$borderSize=1,S}var m=y("../virtual_renderer").VirtualRenderer,p=y("../editor").Editor,h=y("../range").Range,f=y("../lib/event"),C=y("../lib/lang"),g=y("../lib/dom"),b=y("../config").nls,y=y("./../lib/useragent"),x=y.isSafari?"menu":"listbox",A=y.isSafari?"menuitem":"option",v=y.isSafari?"aria-current":"aria-selected";g.importCssString(`
.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {
    background-color: #CAD6FA;
    z-index: 1;
}
.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {
    background-color: #3a674e;
}
.ace_editor.ace_autocomplete .ace_line-hover {
    border: 1px solid #abbffe;
    margin-top: -1px;
    background: rgba(233,233,253,0.4);
    position: absolute;
    z-index: 2;
}
.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {
    border: 1px solid rgba(109, 150, 13, 0.8);
    background: rgba(58, 103, 78, 0.62);
}
.ace_completion-meta {
    opacity: 0.5;
    margin-left: 0.9em;
}
.ace_completion-message {
    margin-left: 0.9em;
    color: blue;
}
.ace_editor.ace_autocomplete .ace_completion-highlight{
    color: #2d69c7;
}
.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{
    color: #93ca12;
}
.ace_editor.ace_autocomplete {
    width: 300px;
    z-index: 200000;
    border: 1px lightgray solid;
    position: fixed;
    box-shadow: 2px 3px 5px rgba(0,0,0,.2);
    line-height: 1.4;
    background: #fefefe;
    color: #111;
}
.ace_dark.ace_editor.ace_autocomplete {
    border: 1px #484747 solid;
    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);
    line-height: 1.4;
    background: #25282c;
    color: #c1c1c1;
}
.ace_autocomplete .ace_text-layer  {
    width: calc(100% - 8px);
}
.ace_autocomplete .ace_line {
    display: flex;
    align-items: center;
}
.ace_autocomplete .ace_line > * {
    min-width: 0;
    flex: 0 0 auto;
}
.ace_autocomplete .ace_line .ace_ {
    flex: 0 1 auto;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}
.ace_autocomplete .ace_completion-spacer {
    flex: 1;
}
.ace_autocomplete.ace_loading:after  {
    content: "";
    position: absolute;
    top: 0px;
    height: 2px;
    width: 8%;
    background: blue;
    z-index: 100;
    animation: ace_progress 3s infinite linear;
    animation-delay: 300ms;
    transform: translateX(-100%) scaleX(1);
}
@keyframes ace_progress {
    0% { transform: translateX(-100%) scaleX(1) }
    50% { transform: translateX(625%) scaleX(2) } 
    100% { transform: translateX(1500%) scaleX(3) } 
}
@media (prefers-reduced-motion) {
    .ace_autocomplete.ace_loading:after {
        transform: translateX(625%) scaleX(2);
        animation: none;
     }
}
`,"autocompletion.css",!1),a.AcePopup=d,a.$singleLineEditor=u,a.getAriaId=c}),ace.define("ace/autocomplete/inline_screenreader",["require","exports","module"],function(s,a,l){"use strict";function c(u){this.editor=u,this.screenReaderDiv=document.createElement("div"),this.screenReaderDiv.classList.add("ace_screenreader-only"),this.editor.container.appendChild(this.screenReaderDiv)}c.prototype.setScreenReaderContent=function(u){for(!this.popup&&this.editor.completer&&this.editor.completer.popup&&(this.popup=this.editor.completer.popup,this.popup.renderer.on("afterRender",(function(){var m=this.popup.getRow(),d=this.popup.renderer.$textLayer,m=d.element.childNodes[m-d.config.firstRow];if(m){for(var p="doc-tooltip ",h=0;h<this._lines.length;h++)p+="ace-inline-screenreader-line-".concat(h," ");m.setAttribute("aria-describedby",p)}}).bind(this)));this.screenReaderDiv.firstChild;)this.screenReaderDiv.removeChild(this.screenReaderDiv.firstChild);this._lines=u.split(/\r\n|\r|\n/),u=this.createCodeBlock(),this.screenReaderDiv.appendChild(u)},c.prototype.destroy=function(){this.screenReaderDiv.remove()},c.prototype.createCodeBlock=function(){var u=document.createElement("pre");u.setAttribute("id","ace-inline-screenreader");for(var d=0;d<this._lines.length;d++){var m=document.createElement("code"),p=(m.setAttribute("id","ace-inline-screenreader-line-".concat(d)),document.createTextNode(this._lines[d]));m.appendChild(p),u.appendChild(m)}return u},a.AceInlineScreenReader=c}),ace.define("ace/autocomplete/inline",["require","exports","module","ace/snippets","ace/autocomplete/inline_screenreader"],function(s,a,l){"use strict";var c=s("../snippets").snippetManager,u=s("./inline_screenreader").AceInlineScreenReader;function d(){this.editor=null}d.prototype.show=function(m,p,h){if(h=h||"",m&&this.editor&&this.editor!==m&&(this.hide(),this.editor=null,this.inlineScreenReader=null),!m||!p)return!1;this.inlineScreenReader||(this.inlineScreenReader=new u(m));var f=p.snippet?c.getDisplayTextForSnippet(m,p.snippet):p.value;return!(p.hideInlinePreview||!f||!f.startsWith(h)||(this.editor=m,this.inlineScreenReader.setScreenReaderContent(f),(f=f.slice(h.length))===""?m.removeGhostText():m.setGhostText(f),0))},d.prototype.isOpen=function(){return!!this.editor&&!!this.editor.renderer.$ghostText},d.prototype.hide=function(){return!!this.editor&&(this.editor.removeGhostText(),!0)},d.prototype.destroy=function(){this.hide(),this.editor=null,this.inlineScreenReader&&(this.inlineScreenReader.destroy(),this.inlineScreenReader=null)},a.AceInline=d}),ace.define("ace/autocomplete/util",["require","exports","module"],function(s,a,l){"use strict";a.parForEach=function(u,d,m){var p=0,h=u.length;h===0&&m();for(var f=0;f<h;f++)d(u[f],function(C,g){++p===h&&m(C,g)})};var c=/[a-zA-Z_0-9\$\-\u00A2-\u2000\u2070-\uFFFF]/;a.retrievePrecedingIdentifier=function(u,d,m){m=m||c;for(var p=[],h=d-1;0<=h&&m.test(u[h]);h--)p.push(u[h]);return p.reverse().join("")},a.retrieveFollowingIdentifier=function(u,d,m){m=m||c;for(var p=[],h=d;h<u.length&&m.test(u[h]);h++)p.push(u[h]);return p},a.getCompletionPrefix=function(u){var d,m=u.getCursorPosition(),p=u.session.getLine(m.row);return u.completers.forEach((function(h){h.identifierRegexps&&h.identifierRegexps.forEach((function(f){!d&&f&&(d=this.retrievePrecedingIdentifier(p,m.column,f))}).bind(this))}).bind(this)),d||this.retrievePrecedingIdentifier(p,m.column)},a.triggerAutocomplete=function(u,d){return d=d??u.session.getPrecedingCharacter(),u.completers.some(function(m){if(m.triggerCharacters&&Array.isArray(m.triggerCharacters))return m.triggerCharacters.includes(d)})}}),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/inline","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/lang","ace/lib/dom","ace/snippets","ace/config","ace/lib/event","ace/lib/scroll"],function(s,a,l){"use strict";function c(w,S){S.completer&&S.completer.destroy()}var u=s("./keyboard/hash_handler").HashHandler,d=s("./autocomplete/popup").AcePopup,m=s("./autocomplete/inline").AceInline,p=s("./autocomplete/popup").getAriaId,h=s("./autocomplete/util"),f=s("./lib/lang"),C=s("./lib/dom"),g=s("./snippets").snippetManager,b=s("./config"),y=s("./lib/event"),x=s("./lib/scroll").preventParentScroll,A=(Object.defineProperty(v,"completionsForLoading",{get:function(){return[{caption:b.nls("autocomplete.loading","Loading..."),value:""}]},enumerable:!1,configurable:!0}),v.prototype.$init=function(){return this.popup=new d(this.parentNode||document.body||document.documentElement),this.popup.on("click",(function(w){this.insertMatch(),w.stop()}).bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.$onPopupShow.bind(this)),this.popup.on("hide",this.$onHidePopup.bind(this)),this.popup.on("select",this.$onPopupChange.bind(this)),y.addListener(this.popup.container,"mouseout",this.mouseOutListener.bind(this)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup.renderer.on("afterRender",this.$onPopupRender.bind(this)),this.popup},v.prototype.$initInline=function(){if(this.inlineEnabled&&!this.inlineRenderer)return this.inlineRenderer=new m,this.inlineRenderer},v.prototype.getPopup=function(){return this.popup||this.$init()},v.prototype.$onHidePopup=function(){this.inlineRenderer&&this.inlineRenderer.hide(),this.hideDocTooltip(),this.stickySelectionTimer.cancel(),this.popupTimer.cancel(),this.stickySelection=!1},v.prototype.$seen=function(w){!this.hasSeen.has(w)&&w&&w.completer&&w.completer.onSeen&&typeof w.completer.onSeen=="function"&&(w.completer.onSeen(this.editor,w),this.hasSeen.add(w))},v.prototype.$onPopupChange=function(w){this.inlineRenderer&&this.inlineEnabled?(w=w?null:this.popup.getData(this.popup.getRow()),this.$updateGhostText(w),this.popup.isMouseOver&&this.setSelectOnHover?this.tooltipTimer.call(null,null):(this.popupTimer.schedule(),this.tooltipTimer.schedule())):(this.popupTimer.call(null,null),this.tooltipTimer.call(null,null))},v.prototype.$updateGhostText=function(w){var k=this.base.row,S=this.base.column,P=this.editor.getCursorPosition().column,k=this.editor.session.getLine(k).slice(S,P);this.inlineRenderer.show(this.editor,w,k)?this.$seen(w):this.inlineRenderer.hide()},v.prototype.$onPopupRender=function(){var w=this.inlineRenderer&&this.inlineEnabled;if(this.completions&&this.completions.filtered&&0<this.completions.filtered.length)for(var S=this.popup.getFirstVisibleRow();S<=this.popup.getLastVisibleRow();S++){var P=this.popup.getData(S);!P||w&&!P.hideInlinePreview||this.$seen(P)}},v.prototype.$onPopupShow=function(w){this.$onPopupChange(w),this.stickySelection=!1,0<=this.stickySelectionDelay&&this.stickySelectionTimer.schedule(this.stickySelectionDelay)},v.prototype.observeLayoutChanges=function(){if(!this.$elements&&this.editor){window.addEventListener("resize",this.onLayoutChange,{passive:!0}),window.addEventListener("wheel",this.mousewheelListener);for(var w=this.editor.container.parentNode,S=[];w;)S.push(w),w.addEventListener("scroll",this.onLayoutChange,{passive:!0}),w=w.parentNode;this.$elements=S}},v.prototype.unObserveLayoutChanges=function(){var w=this;window.removeEventListener("resize",this.onLayoutChange,{passive:!0}),window.removeEventListener("wheel",this.mousewheelListener),this.$elements&&this.$elements.forEach(function(S){S.removeEventListener("scroll",w.onLayoutChange,{passive:!0})}),this.$elements=null},v.prototype.onLayoutChange=function(){if(!this.popup.isOpen)return this.unObserveLayoutChanges();this.$updatePopupPosition(),this.updateDocTooltip()},v.prototype.$updatePopupPosition=function(){var w=this.editor,L=w.renderer,S=L.layerConfig.lineHeight,P=L.$cursorLayer.getPixelPosition(this.base,!0),k=(P.left-=this.popup.getTextLeftOffset(),w.container.getBoundingClientRect()),k=(P.top+=k.top-L.layerConfig.offset,P.left+=k.left-w.renderer.scrollLeft,P.left+=L.gutterWidth,{top:P.top,left:P.left}),L=(L.$ghostText&&L.$ghostTextWidget&&this.base.row===L.$ghostText.position.row&&(k.top+=L.$ghostTextWidget.el.offsetHeight),w.container.getBoundingClientRect().bottom-S);this.popup.tryShow(L<k.top?{top:L,left:k.left}:k,S,"bottom")||this.popup.tryShow(P,S,"top")||this.popup.show(P,S)},v.prototype.openPopup=function(w,S,P){this.$firstOpenTimer.cancel(),this.popup||this.$init(),this.inlineEnabled&&!this.inlineRenderer&&this.$initInline(),this.popup.autoSelect=this.autoSelect,this.popup.setSelectOnHover(this.setSelectOnHover);var k,L=this.popup.getRow(),R=this.popup.data[L],R=(this.popup.setData(this.completions.filtered,this.completions.filterText),this.editor.textInput.setAriaOptions&&this.editor.textInput.setAriaOptions({activeDescendant:p(this.popup.getRow()),inline:this.inlineEnabled}),w.keyBinding.addKeyboardHandler(this.keyboardHandler),(k=this.stickySelection?this.popup.data.indexOf(R):k)&&k!==-1||(k=0),this.popup.setRow(this.autoSelect?k:-1),k===L&&R!==this.completions.filtered[k]&&this.$onPopupChange(),this.inlineRenderer&&this.inlineEnabled);k===L&&R&&(k=this.popup.getData(this.popup.getRow()),this.$updateGhostText(k)),P||(this.popup.setTheme(w.getTheme()),this.popup.setFontSize(w.getFontSize()),this.$updatePopupPosition(),this.tooltipNode&&this.updateDocTooltip()),this.changeTimer.cancel(),this.observeLayoutChanges()},v.prototype.detach=function(){this.editor&&(this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener)),this.$firstOpenTimer.cancel(),this.changeTimer.cancel(),this.hideDocTooltip(),this.completionProvider&&this.completionProvider.detach(),this.popup&&this.popup.isOpen&&this.popup.hide(),this.popup&&this.popup.renderer&&this.popup.renderer.off("afterRender",this.$onPopupRender),this.base&&this.base.detach(),this.activated=!1,this.completionProvider=this.completions=this.base=null,this.unObserveLayoutChanges()},v.prototype.changeListener=function(w){var S=this.editor.selection.lead;(S.row!=this.base.row||S.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},v.prototype.blurListener=function(w){var S=document.activeElement,P=this.editor.textInput.getElement(),k=w.relatedTarget&&this.tooltipNode&&this.tooltipNode.contains(w.relatedTarget),L=this.popup&&this.popup.container;S==P||S.parentNode==L||k||S==this.tooltipNode||w.relatedTarget==P||this.detach()},v.prototype.mousedownListener=function(w){this.detach()},v.prototype.mousewheelListener=function(w){this.popup&&!this.popup.isMouseOver&&this.detach()},v.prototype.mouseOutListener=function(w){this.popup.isOpen&&this.$updatePopupPosition()},v.prototype.goTo=function(w){this.popup.goTo(w)},v.prototype.insertMatch=function(w,S){var P;return!!(w=w||this.popup.getData(this.popup.getRow()))&&(w.value===""?this.detach():(P=this.completions,w=this.getCompletionProvider().insertMatch(this.editor,w,P.filterText,S),this.completions==P&&this.detach(),w))},v.prototype.showPopup=function(w,S){this.editor&&this.detach(),this.activated=!0,(this.editor=w).completer!=this&&(w.completer&&w.completer.detach(),w.completer=this),w.on("changeSelection",this.changeListener),w.on("blur",this.blurListener),w.on("mousedown",this.mousedownListener),w.on("mousewheel",this.mousewheelListener),this.updateCompletions(!1,S)},v.prototype.getCompletionProvider=function(w){return this.completionProvider||(this.completionProvider=new _(w)),this.completionProvider},v.prototype.gatherCompletions=function(w,S){return this.getCompletionProvider().gatherCompletions(w,S)},v.prototype.updateCompletions=function(w,S){var P,k;return w&&this.base&&this.completions?(P=this.editor.getCursorPosition(),(k=this.editor.session.getTextRange({start:this.base,end:P}))==this.completions.filterText?void 0:(this.completions.setFilter(k),this.completions.filtered.length&&(this.completions.filtered.length!=1||this.completions.filtered[0].value!=k||this.completions.filtered[0].snippet)?void this.openPopup(this.editor,k,w):this.detach())):S&&S.matches?(P=this.editor.getSelectionRange().start,this.base=this.editor.session.doc.createAnchor(P.row,P.column),this.base.$insertRight=!0,this.completions=new T(S.matches),this.getCompletionProvider().completions=this.completions,this.openPopup(this.editor,"",w)):(S=this.editor.getSession(),P=this.editor.getCursorPosition(),k=h.getCompletionPrefix(this.editor),this.base=S.doc.createAnchor(P.row,P.column-k.length),this.base.$insertRight=!0,S={exactMatch:this.exactMatch,ignoreCaption:this.ignoreCaption},this.getCompletionProvider({prefix:k,pos:P}).provideCompletions(this.editor,S,(function(L,R,N){var F,H=R.filtered,V=h.getCompletionPrefix(this.editor);if(this.$firstOpenTimer.cancel(),N){if(!H.length)return(F=typeof(F=!this.autoShown&&this.emptyMessage)=="function"?this.emptyMessage(V):F)?(this.completions=new T([{caption:F,value:""}]),this.openPopup(this.editor,V,w),this.popup.renderer.setStyle("ace_loading",!1),void this.popup.renderer.setStyle("ace_empty-message",!0)):this.detach();if(H.length==1&&H[0].value==V&&!H[0].snippet)return this.detach();if(this.autoInsert&&!this.autoShown&&H.length==1)return this.insertMatch(H[0])}this.completions=!N&&this.showLoadingState?new T(v.completionsForLoading.concat(H),R.filterText):R,this.openPopup(this.editor,V,w),this.popup.renderer.setStyle("ace_empty-message",!1),this.popup.renderer.setStyle("ace_loading",!N)}).bind(this)),void(!this.showLoadingState||this.autoShown||this.popup&&this.popup.isOpen||this.$firstOpenTimer.delay(this.stickySelectionDelay/2)))},v.prototype.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},v.prototype.updateDocTooltip=function(){var w=this.popup,S=this.completions.filtered,P=S&&(S[w.getHoveredRow()]||S[w.getRow()]),k=null;if(!P||!this.editor||!this.popup.isOpen)return this.hideDocTooltip();for(var L=this.editor.completers.length,R=0;R<L;R++){var N=this.editor.completers[R];if(N.getDocTooltip&&P.completerId===N.id){k=N.getDocTooltip(P);break}}if(!(k=typeof(k=k||typeof P=="string"?k:P)=="string"?{docText:k}:k)||!k.docHTML&&!k.docText)return this.hideDocTooltip();this.showDocTooltip(k)},v.prototype.showDocTooltip=function(P){this.tooltipNode||(this.tooltipNode=C.createElement("div"),this.tooltipNode.style.margin="0",this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.style.overscrollBehavior="contain",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this),this.tooltipNode.onclick=this.onTooltipClick.bind(this),this.tooltipNode.id="doc-tooltip",this.tooltipNode.setAttribute("role","tooltip"),this.tooltipNode.addEventListener("wheel",x));var S=this.editor.renderer.theme,S=(this.tooltipNode.className="ace_tooltip ace_doc-tooltip "+(S.isDark?"ace_dark ":"")+(S.cssClass||""),this.tooltipNode),P=(P.docHTML?S.innerHTML=P.docHTML:P.docText&&(S.textContent=P.docText),S.parentNode||this.popup.container.appendChild(this.tooltipNode),this.popup),k=P.container.getBoundingClientRect();S.style.top=P.container.style.top,S.style.bottom=P.container.style.bottom,S.style.display="block",window.innerWidth-k.right<320?k.left<320?(P.isTopdown?S.style.top=k.bottom+"px":S.style.top=P.container.offsetTop-S.offsetHeight+"px",S.style.left=k.left+"px",S.style.right="",S.style.bottom=""):(S.style.right=window.innerWidth-k.left+"px",S.style.left=""):(S.style.left=k.right+1+"px",S.style.right="")},v.prototype.hideDocTooltip=function(){var w;this.tooltipTimer.cancel(),this.tooltipNode&&(w=this.tooltipNode,this.editor.isFocused()||document.activeElement!=w||this.editor.focus(),this.tooltipNode=null,w.parentNode)&&w.parentNode.removeChild(w)},v.prototype.onTooltipClick=function(w){for(var S=w.target;S&&S!=this.tooltipNode;){if(S.nodeName=="A"&&S.href){S.rel="noreferrer",S.target="_blank";break}S=S.parentNode}},v.prototype.destroy=function(){var w;this.detach(),this.popup&&(this.popup.destroy(),w=this.popup.container)&&w.parentNode&&w.parentNode.removeChild(w),this.editor&&this.editor.completer==this&&(this.editor.off("destroy",c),this.editor.completer=null),this.inlineRenderer=this.popup=this.editor=null},v);function v(){this.autoInsert=!1,this.autoSelect=!0,this.autoShown=!1,this.exactMatch=!1,this.inlineEnabled=!1,this.keyboardHandler=new u,this.keyboardHandler.bindKeys(this.commands),this.parentNode=null,this.setSelectOnHover=!1,this.hasSeen=new Set,this.showLoadingState=!1,this.stickySelectionDelay=500,this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.onLayoutChange=this.onLayoutChange.bind(this),this.changeTimer=f.delayedCall((function(){this.updateCompletions(!0)}).bind(this)),this.tooltipTimer=f.delayedCall(this.updateDocTooltip.bind(this),50),this.popupTimer=f.delayedCall(this.$updatePopupPosition.bind(this),50),this.stickySelectionTimer=f.delayedCall((function(){this.stickySelection=!0}).bind(this),this.stickySelectionDelay),this.$firstOpenTimer=f.delayedCall((function(){var w=this.completionProvider&&this.completionProvider.initialPosition;this.autoShown||this.popup&&this.popup.isOpen||!w||this.editor.completers.length===0||(this.completions=new T(v.completionsForLoading),this.openPopup(this.editor,w.prefix,!1),this.popup.renderer.setStyle("ace_loading",!0))}).bind(this),this.stickySelectionDelay)}A.prototype.commands={Up:function(w){w.completer.goTo("up")},Down:function(w){w.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(w){w.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(w){w.completer.goTo("end")},Esc:function(w){w.completer.detach()},Return:function(w){return w.completer.insertMatch()},"Shift-Return":function(w){w.completer.insertMatch(null,{deleteSuffix:!0})},Tab:function(w){var S=w.completer.insertMatch();if(S||w.tabstopManager)return S;w.completer.goTo("down")},Backspace:function(w){w.execCommand("backspace"),!h.getCompletionPrefix(w)&&w.completer&&w.completer.detach()},PageUp:function(w){w.completer.popup.gotoPageUp()},PageDown:function(w){w.completer.popup.gotoPageDown()}},A.for=function(w){return w.completer instanceof A||(w.completer&&(w.completer.destroy(),w.completer=null),b.get("sharedPopups")?(A.$sharedInstance||(A.$sharedInstance=new A),w.completer=A.$sharedInstance):(w.completer=new A,w.once("destroy",c))),w.completer},A.startCommand={name:"startAutocomplete",exec:function(w,S){var P=A.for(w);P.autoInsert=!1,P.autoSelect=!0,P.autoShown=!1,P.showPopup(w,S),P.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"},I.prototype.insertByIndex=function(w,S,P){return!(!this.completions||!this.completions.filtered)&&this.insertMatch(w,this.completions.filtered[S],P)},I.prototype.insertMatch=function(w,S,P){if(!S)return!1;if(w.startOperation({command:{name:"insertMatch"}}),S.completer&&S.completer.insertMatch)S.completer.insertMatch(w,S);else{if(!this.completions)return!1;var k=this.completions.filterText.length,L=0;if(S.range&&S.range.start.row===S.range.end.row&&(k=(k-=this.initialPosition.prefix.length)+(this.initialPosition.pos.column-S.range.start.column),L+=S.range.end.column-this.initialPosition.pos.column),k||L)for(var R,N=w.selection.getAllRanges?w.selection.getAllRanges():[w.getSelectionRange()],F=0;R=N[F];F++)R.start.column-=k,R.end.column+=L,w.session.remove(R);S.snippet?g.insertSnippet(w,S.snippet):this.$insertString(w,S),S.completer&&S.completer.onInsert&&typeof S.completer.onInsert=="function"&&S.completer.onInsert(w,S),S.command&&S.command==="startAutocomplete"&&w.execCommand(S.command)}return w.endOperation(),!0},I.prototype.$insertString=function(w,S){S=S.value||S,w.execCommand("insertstring",S)},I.prototype.gatherCompletions=function(w,S){var P=w.getSession(),k=w.getCursorPosition(),L=h.getCompletionPrefix(w),R=[],N=(this.completers=w.completers,w.completers.length);return w.completers.forEach(function(F,H){F.getCompletions(w,P,k,L,function(V,q){F.hideInlinePreview&&(q=q.map(function(Q){return Object.assign(Q,{hideInlinePreview:F.hideInlinePreview})})),!V&&q&&(R=R.concat(q)),S(null,{prefix:h.getCompletionPrefix(w),matches:R,finished:--N==0})})}),!0},I.prototype.provideCompletions=function(w,S,P){var k=(function(N){var F=N.prefix,H=N.matches;this.completions=new T(H),S.exactMatch&&(this.completions.exactMatch=!0),S.ignoreCaption&&(this.completions.ignoreCaption=!0),this.completions.setFilter(F),(N.finished||this.completions.filtered.length)&&P(null,this.completions,N.finished)}).bind(this),L=!0,R=null;this.gatherCompletions(w,(function(N,F){this.active&&(N&&(P(N,[],!0),this.detach()),F.prefix.indexOf(F.prefix)===0)&&(L?R=F:k(F))}).bind(this)),L=!1,R&&(w=R,R=null,k(w))},I.prototype.detach=function(){this.active=!1,this.completers&&this.completers.forEach(function(w){typeof w.cancel=="function"&&w.cancel()})};var _=I;function I(w){this.initialPosition=w,this.active=!0}E.prototype.setFilter=function(w){S=w.length>this.filterText&&w.lastIndexOf(this.filterText,0)===0?this.filtered:this.all,this.filterText=w,S=(S=this.filterCompletions(S,this.filterText)).sort(function(k,L){return L.exactMatch-k.exactMatch||L.$score-k.$score||(k.caption||k.value).localeCompare(L.caption||L.value)});var S,P=null;S=S.filter(function(k){return k=k.snippet||k.caption||k.value,k!==P&&(P=k,!0)}),this.filtered=S},E.prototype.filterCompletions=function(w,S){var P=[],k=S.toUpperCase(),L=S.toLowerCase();e:for(var R,N=0;R=w[N];N++){var F=!this.ignoreCaption&&R.caption||R.value||R.snippet;if(F){var H=-1,V=0,q=0;if(this.exactMatch){if(S!==F.substr(0,S.length))continue}else{var Q=F.toLowerCase().indexOf(L);if(-1<Q)q=Q;else for(var O=0;O<S.length;O++){var B=F.indexOf(L[O],H+1),j=F.indexOf(k[O],H+1);if((B=0<=B&&(j<0||B<j)?B:j)<0)continue e;0<(j=B-H-1)&&(H===-1&&(q+=10),q+=j,V|=1<<O),H=B}}R.matchMask=V,R.exactMatch=q?0:1,R.$score=(R.score||0)-q,P.push(R)}}return P};var T=E;function E(w,S){this.all=w,this.filtered=w,this.filterText=S||"",this.exactMatch=!1,this.ignoreCaption=!1}a.Autocomplete=A,a.CompletionProvider=_,a.FilteredList=T}),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],function(s,a,l){var c=s("../range").Range,u=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;function d(m,p){var h=m.getTextRange(c.fromPoints({row:0,column:0},p)).split(u).length-1,f=m.getValue().split(u),C=Object.create(null),g=f[h];return f.forEach(function(b,y){b&&b!==g&&(y=Math.abs(h-y),y=f.length-y,C[b]?C[b]=Math.max(y,C[b]):C[b]=y)}),C}a.getCompletions=function(m,p,h,f,C){var g=d(p,h);C(null,Object.keys(g).map(function(b){return{caption:b,value:b,score:g[b],meta:"local"}}))}}),ace.define("ace/ext/language_tools",["require","exports","module","ace/snippets","ace/autocomplete","ace/config","ace/lib/lang","ace/autocomplete/util","ace/autocomplete/text_completer","ace/editor","ace/config"],function(s,a,l){"use strict";function c(E,w){A(w.session.$mode)}function u(E){var w=E.editor,S=w.completer&&w.completer.activated;E.command.name==="backspace"?S&&!C.getCompletionPrefix(w)&&w.completer.detach():E.command.name!=="insertstring"||S||((w=(d=E).editor.$liveAutocompletionDelay)?_.delay(w):I(E))}var d,m=s("../snippets").snippetManager,p=s("../autocomplete").Autocomplete,h=s("../config"),f=s("../lib/lang"),C=s("../autocomplete/util"),T=s("../autocomplete/text_completer"),g={getCompletions:function(E,w,S,P,k){if(w.$mode.completer)return w.$mode.completer.getCompletions(E,w,S,P,k);E=E.session.getState(S.row),k(null,w.$mode.getCompletions(E,w,S,P).map(function(L){return L.completerId=g.id,L}))},id:"keywordCompleter"},b={getCompletions:function(E,R,S,P,k){var L=[],R=R.getTokenAt(S.row,S.column),N=(R&&R.type.match(/(tag-name|tag-open|tag-whitespace|attribute-name|attribute-value)\.xml$/)?L.push("html-tag"):L=m.getActiveScopes(E),m.snippetMap),F=[];L.forEach(function(H){for(var V=N[H]||[],q=V.length;q--;){var Q=V[q],O=Q.name||Q.tabTrigger;O&&F.push({caption:O,snippet:Q.content,meta:Q.tabTrigger&&!Q.name?Q.tabTrigger+"\u21E5 ":"snippet",completerId:b.id})}},this),k(null,F)},getDocTooltip:function(E){var w;E.snippet&&!E.docHTML&&(E.docHTML=["<b>",f.escapeHTML(E.caption),"</b>","<hr></hr>",f.escapeHTML((E=E.snippet,w={},E.replace(/\${(\d+)(:(.*?))?}/g,function(S,P,k,L){return w[P]=L||""}).replace(/\$(\d+?)/g,function(S,P){return w[P]})))].join(""))},id:"snippetCompleter"},y=[b,T,g],x=(a.setCompleters=function(E){y.length=0,E&&y.push.apply(y,E)},a.addCompleter=function(E){y.push(E)},a.textCompleter=T,a.keyWordCompleter=g,a.snippetCompleter=b,{name:"expandSnippet",exec:function(E){return m.expandWithTab(E)},bindKey:"Tab"}),A=function(E){(E=typeof E=="string"?h.$modes[E]:E)&&(m.files||(m.files={}),v(E.$id,E.snippetFileId),E.modes)&&E.modes.forEach(A)},v=function(E,w){w&&E&&!m.files[E]&&(m.files[E]={},h.loadModule(w,function(S){S&&(!(m.files[E]=S).snippets&&S.snippetText&&(S.snippets=m.parseSnippetFile(S.snippetText)),m.register(S.snippets||[],S.scope),S.includeScopes)&&(m.snippetMap[S.scope].includeScopes=S.includeScopes,S.includeScopes.forEach(function(P){A("ace/mode/"+P)}))}))},_=f.delayedCall(function(){I(d)},0),I=function(P){var w=P.editor,S=C.getCompletionPrefix(w),P=P.args,P=C.triggerAutocomplete(w,P);(S&&S.length>=w.$liveAutocompletionThreshold||P)&&((S=p.for(w)).autoShown=!0,S.showPopup(w))},T=s("../editor").Editor;s("../config").defineOptions(T.prototype,"editor",{enableBasicAutocompletion:{set:function(E){E?(this.completers||(this.completers=Array.isArray(E)?E:y),this.commands.addCommand(p.startCommand)):this.commands.removeCommand(p.startCommand)},value:!1},enableLiveAutocompletion:{set:function(E){E?(this.completers||(this.completers=Array.isArray(E)?E:y),this.commands.on("afterExec",u)):this.commands.off("afterExec",u)},value:!1},liveAutocompletionDelay:{initialValue:0},liveAutocompletionThreshold:{initialValue:0},enableSnippets:{set:function(E){E?(this.commands.addCommand(x),this.on("changeMode",c),c(0,this)):(this.commands.removeCommand(x),this.off("changeMode",c))},value:!1}})}),ace.require(["ace/ext/language_tools"],function(s){n&&(n.exports=s)})},6534:function(n,o,i){n=i.nmd(n),ace.define("ace/ext/searchbox-css",["require","exports","module"],function(s,a,l){l.exports=`

/* ------------------------------------------------------------------------------------------
 * Editor Search Form
 * --------------------------------------------------------------------------------------- */
.ace_search {
    background-color: #ddd;
    color: #666;
    border: 1px solid #cbcbcb;
    border-top: 0 none;
    overflow: hidden;
    margin: 0;
    padding: 4px 6px 0 4px;
    position: absolute;
    top: 0;
    z-index: 99;
    white-space: normal;
}
.ace_search.left {
    border-left: 0 none;
    border-radius: 0px 0px 5px 0px;
    left: 0;
}
.ace_search.right {
    border-radius: 0px 0px 0px 5px;
    border-right: 0 none;
    right: 0;
}

.ace_search_form, .ace_replace_form {
    margin: 0 20px 4px 0;
    overflow: hidden;
    line-height: 1.9;
}
.ace_replace_form {
    margin-right: 0;
}
.ace_search_form.ace_nomatch {
    outline: 1px solid red;
}

.ace_search_field {
    border-radius: 3px 0 0 3px;
    background-color: white;
    color: black;
    border: 1px solid #cbcbcb;
    border-right: 0 none;
    outline: 0;
    padding: 0;
    font-size: inherit;
    margin: 0;
    line-height: inherit;
    padding: 0 6px;
    min-width: 17em;
    vertical-align: top;
    min-height: 1.8em;
    box-sizing: content-box;
}
.ace_searchbtn {
    border: 1px solid #cbcbcb;
    line-height: inherit;
    display: inline-block;
    padding: 0 6px;
    background: #fff;
    border-right: 0 none;
    border-left: 1px solid #dcdcdc;
    cursor: pointer;
    margin: 0;
    position: relative;
    color: #666;
}
.ace_searchbtn:last-child {
    border-radius: 0 3px 3px 0;
    border-right: 1px solid #cbcbcb;
}
.ace_searchbtn:disabled {
    background: none;
    cursor: default;
}
.ace_searchbtn:hover {
    background-color: #eef1f6;
}
.ace_searchbtn.prev, .ace_searchbtn.next {
     padding: 0px 0.7em
}
.ace_searchbtn.prev:after, .ace_searchbtn.next:after {
     content: "";
     border: solid 2px #888;
     width: 0.5em;
     height: 0.5em;
     border-width:  2px 0 0 2px;
     display:inline-block;
     transform: rotate(-45deg);
}
.ace_searchbtn.next:after {
     border-width: 0 2px 2px 0 ;
}
.ace_searchbtn_close {
    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAcCAYAAABRVo5BAAAAZ0lEQVR42u2SUQrAMAhDvazn8OjZBilCkYVVxiis8H4CT0VrAJb4WHT3C5xU2a2IQZXJjiQIRMdkEoJ5Q2yMqpfDIo+XY4k6h+YXOyKqTIj5REaxloNAd0xiKmAtsTHqW8sR2W5f7gCu5nWFUpVjZwAAAABJRU5ErkJggg==) no-repeat 50% 0;
    border-radius: 50%;
    border: 0 none;
    color: #656565;
    cursor: pointer;
    font: 16px/16px Arial;
    padding: 0;
    height: 14px;
    width: 14px;
    top: 9px;
    right: 7px;
    position: absolute;
}
.ace_searchbtn_close:hover {
    background-color: #656565;
    background-position: 50% 100%;
    color: white;
}

.ace_button {
    margin-left: 2px;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -o-user-select: none;
    -ms-user-select: none;
    user-select: none;
    overflow: hidden;
    opacity: 0.7;
    border: 1px solid rgba(100,100,100,0.23);
    padding: 1px;
    box-sizing:    border-box!important;
    color: black;
}

.ace_button:hover {
    background-color: #eee;
    opacity:1;
}
.ace_button:active {
    background-color: #ddd;
}

.ace_button.checked {
    border-color: #3399ff;
    opacity:1;
}

.ace_search_options{
    margin-bottom: 3px;
    text-align: right;
    -webkit-user-select: none;
    -moz-user-select: none;
    -o-user-select: none;
    -ms-user-select: none;
    user-select: none;
    clear: both;
}

.ace_search_counter {
    float: left;
    font-family: arial;
    padding: 0 8px;
}`}),ace.define("ace/ext/searchbox",["require","exports","module","ace/lib/dom","ace/lib/lang","ace/lib/event","ace/ext/searchbox-css","ace/keyboard/hash_handler","ace/lib/keys","ace/config"],function(s,a,l){"use strict";var c=s("../lib/dom"),u=s("../lib/lang"),d=s("../lib/event"),m=s("./searchbox-css"),p=s("../keyboard/hash_handler").HashHandler,h=s("../lib/keys"),f=s("../config").nls,C=(c.importCssString(m,"ace_searchbox",!1),g.prototype.setEditor=function(b){b.searchBox=this,b.renderer.scroller.appendChild(this.element),this.editor=b},g.prototype.setSession=function(b){this.searchRange=null,this.$syncOptions(!0)},g.prototype.$initElements=function(b){this.searchBox=b.querySelector(".ace_search_form"),this.replaceBox=b.querySelector(".ace_replace_form"),this.searchOption=b.querySelector("[action=searchInSelection]"),this.replaceOption=b.querySelector("[action=toggleReplace]"),this.regExpOption=b.querySelector("[action=toggleRegexpMode]"),this.caseSensitiveOption=b.querySelector("[action=toggleCaseSensitive]"),this.wholeWordOption=b.querySelector("[action=toggleWholeWords]"),this.searchInput=this.searchBox.querySelector(".ace_search_field"),this.replaceInput=this.replaceBox.querySelector(".ace_search_field"),this.searchCounter=b.querySelector(".ace_search_counter")},g.prototype.$init=function(){var b=this.element,y=(this.$initElements(b),this);d.addListener(b,"mousedown",function(x){setTimeout(function(){y.activeInput.focus()},0),d.stopPropagation(x)}),d.addListener(b,"click",function(x){var A=(x.target||x.srcElement).getAttribute("action");A&&y[A]?y[A]():y.$searchBarKb.commands[A]&&y.$searchBarKb.commands[A].exec(y),d.stopPropagation(x)}),d.addCommandKeyListener(b,function(x,A,v){v=h.keyCodeToString(v),A=y.$searchBarKb.findKeyCommand(A,v),A&&A.exec&&(A.exec(y),d.stopEvent(x))}),this.$onChange=u.delayedCall(function(){y.find(!1,!1)}),d.addListener(this.searchInput,"input",function(){y.$onChange.schedule(20)}),d.addListener(this.searchInput,"focus",function(){y.activeInput=y.searchInput,y.searchInput.value&&y.highlight()}),d.addListener(this.replaceInput,"focus",function(){y.activeInput=y.replaceInput,y.searchInput.value&&y.highlight()})},g.prototype.setSearchRange=function(b){(this.searchRange=b)?this.searchRangeMarker=this.editor.session.addMarker(b,"ace_active-line"):this.searchRangeMarker&&(this.editor.session.removeMarker(this.searchRangeMarker),this.searchRangeMarker=null)},g.prototype.$syncOptions=function(b){c.setCssClass(this.replaceOption,"checked",this.searchRange),c.setCssClass(this.searchOption,"checked",this.searchOption.checked),this.replaceOption.textContent=this.replaceOption.checked?"-":"+",c.setCssClass(this.regExpOption,"checked",this.regExpOption.checked),c.setCssClass(this.wholeWordOption,"checked",this.wholeWordOption.checked),c.setCssClass(this.caseSensitiveOption,"checked",this.caseSensitiveOption.checked);var y=this.editor.getReadOnly();this.replaceOption.style.display=y?"none":"",this.replaceBox.style.display=this.replaceOption.checked&&!y?"":"none",this.find(!1,!1,b)},g.prototype.highlight=function(b){this.editor.session.highlight(b||this.editor.$search.$options.re),this.editor.renderer.updateBackMarkers()},g.prototype.find=function(b,y,x){b=!this.editor.find(this.searchInput.value,{skipCurrent:b,backwards:y,wrap:!0,regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked,preventScroll:x,range:this.searchRange})&&this.searchInput.value,c.setCssClass(this.searchBox,"ace_nomatch",b),this.editor._emit("findSearchBox",{match:!b}),this.highlight(),this.updateCounter()},g.prototype.updateCounter=function(){var b=this.editor,y=b.$search.$options.re,x=y.unicode,A=0,v=0;if(y){var _,I,T=this.searchRange?b.session.getTextRange(this.searchRange):b.getValue(),E=b.session.doc.positionToIndex(b.selection.anchor);for(this.searchRange&&(E-=b.session.doc.positionToIndex(this.searchRange.start)),y.lastIndex=0;(I=y.exec(T))&&((_=I.index)<=E&&v++,!(999<++A))&&(I[0]||(y.lastIndex=_+=u.skipEmptyMatch(T,_,x),!(_>=T.length))););}this.searchCounter.textContent=f("search-box.search-counter","$0 of $1",[v,999<A?"999+":A])},g.prototype.findNext=function(){this.find(!0,!1)},g.prototype.findPrev=function(){this.find(!0,!0)},g.prototype.findAll=function(){var b=!this.editor.findAll(this.searchInput.value,{regExp:this.regExpOption.checked,caseSensitive:this.caseSensitiveOption.checked,wholeWord:this.wholeWordOption.checked})&&this.searchInput.value;c.setCssClass(this.searchBox,"ace_nomatch",b),this.editor._emit("findSearchBox",{match:!b}),this.highlight(),this.hide()},g.prototype.replace=function(){this.editor.getReadOnly()||this.editor.replace(this.replaceInput.value)},g.prototype.replaceAndFindNext=function(){this.editor.getReadOnly()||(this.editor.replace(this.replaceInput.value),this.findNext())},g.prototype.replaceAll=function(){this.editor.getReadOnly()||this.editor.replaceAll(this.replaceInput.value)},g.prototype.hide=function(){this.active=!1,this.setSearchRange(null),this.editor.off("changeSession",this.setSession),this.element.style.display="none",this.editor.keyBinding.removeKeyboardHandler(this.$closeSearchBarKb),this.editor.focus()},g.prototype.show=function(b,y){this.active=!0,this.editor.on("changeSession",this.setSession),this.element.style.display="",this.replaceOption.checked=y,b&&(this.searchInput.value=b),this.searchInput.focus(),this.searchInput.select(),this.editor.keyBinding.addKeyboardHandler(this.$closeSearchBarKb),this.$syncOptions(!0)},g.prototype.isFocused=function(){var b=document.activeElement;return b==this.searchInput||b==this.replaceInput},g);function g(b,y,x){this.activeInput;var A=c.createElement("div");c.buildDom(["div",{class:"ace_search right"},["span",{action:"hide",class:"ace_searchbtn_close"}],["div",{class:"ace_search_form"},["input",{class:"ace_search_field",placeholder:f("search-box.find.placeholder","Search for"),spellcheck:"false"}],["span",{action:"findPrev",class:"ace_searchbtn prev"},"\u200B"],["span",{action:"findNext",class:"ace_searchbtn next"},"\u200B"],["span",{action:"findAll",class:"ace_searchbtn",title:"Alt-Enter"},f("search-box.find-all.text","All")]],["div",{class:"ace_replace_form"},["input",{class:"ace_search_field",placeholder:f("search-box.replace.placeholder","Replace with"),spellcheck:"false"}],["span",{action:"replaceAndFindNext",class:"ace_searchbtn"},f("search-box.replace-next.text","Replace")],["span",{action:"replaceAll",class:"ace_searchbtn"},f("search-box.replace-all.text","All")]],["div",{class:"ace_search_options"},["span",{action:"toggleReplace",class:"ace_button",title:f("search-box.toggle-replace.title","Toggle Replace mode"),style:"float:left;margin-top:-2px;padding:0 5px;"},"+"],["span",{class:"ace_search_counter"}],["span",{action:"toggleRegexpMode",class:"ace_button",title:f("search-box.toggle-regexp.title","RegExp Search")},".*"],["span",{action:"toggleCaseSensitive",class:"ace_button",title:f("search-box.toggle-case.title","CaseSensitive Search")},"Aa"],["span",{action:"toggleWholeWords",class:"ace_button",title:f("search-box.toggle-whole-word.title","Whole Word Search")},"\\b"],["span",{action:"searchInSelection",class:"ace_button",title:f("search-box.toggle-in-selection.title","Search In Selection")},"S"]]],A),this.element=A.firstChild,this.setSession=this.setSession.bind(this),this.$init(),this.setEditor(b),c.importCssString(m,"ace_searchbox",b.container)}s=new p,s.bindKeys({"Ctrl-f|Command-f":function(b){var y=b.isReplace=!b.isReplace;b.replaceBox.style.display=y?"":"none",b.replaceOption.checked=!1,b.$syncOptions(),b.searchInput.focus()},"Ctrl-H|Command-Option-F":function(b){b.editor.getReadOnly()||(b.replaceOption.checked=!0,b.$syncOptions(),b.replaceInput.focus())},"Ctrl-G|Command-G":function(b){b.findNext()},"Ctrl-Shift-G|Command-Shift-G":function(b){b.findPrev()},esc:function(b){setTimeout(function(){b.hide()})},Return:function(b){b.activeInput==b.replaceInput&&b.replace(),b.findNext()},"Shift-Return":function(b){b.activeInput==b.replaceInput&&b.replace(),b.findPrev()},"Alt-Return":function(b){b.activeInput==b.replaceInput&&b.replaceAll(),b.findAll()},Tab:function(b){(b.activeInput==b.replaceInput?b.searchInput:b.replaceInput).focus()}}),s.addCommands([{name:"toggleRegexpMode",bindKey:{win:"Alt-R|Alt-/",mac:"Ctrl-Alt-R|Ctrl-Alt-/"},exec:function(b){b.regExpOption.checked=!b.regExpOption.checked,b.$syncOptions()}},{name:"toggleCaseSensitive",bindKey:{win:"Alt-C|Alt-I",mac:"Ctrl-Alt-R|Ctrl-Alt-I"},exec:function(b){b.caseSensitiveOption.checked=!b.caseSensitiveOption.checked,b.$syncOptions()}},{name:"toggleWholeWords",bindKey:{win:"Alt-B|Alt-W",mac:"Ctrl-Alt-B|Ctrl-Alt-W"},exec:function(b){b.wholeWordOption.checked=!b.wholeWordOption.checked,b.$syncOptions()}},{name:"toggleReplace",exec:function(b){b.replaceOption.checked=!b.replaceOption.checked,b.$syncOptions()}},{name:"searchInSelection",exec:function(b){b.searchOption.checked=!b.searchRange,b.setSearchRange(b.searchOption.checked&&b.editor.getSelectionRange()),b.$syncOptions()}}]),p=new p([{bindKey:"Esc",name:"closeSearchBar",exec:function(b){b.searchBox.hide()}}]),C.prototype.$searchBarKb=s,C.prototype.$closeSearchBarKb=p,a.SearchBox=C,a.Search=function(b,y){(b.searchBox||new C(b)).show(b.session.getTextRange(),y)}}),ace.require(["ace/ext/searchbox"],function(s){n&&(n.exports=s)})},4221:function(n,o,i){n=i.nmd(n),ace.define("ace/mode/json_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(d,a,l){"use strict";function c(){this.$rules={start:[{token:"variable",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]\\s*(?=:)'},{token:"string",regex:'"',next:"string"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:"text",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"comment",regex:"\\/\\/.*$"},{token:"comment.start",regex:"\\/\\*",next:"comment"},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"punctuation.operator",regex:/[,]/},{token:"text",regex:"\\s+"}],string:[{token:"constant.language.escape",regex:/\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|["\\\/bfnrt])/},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],comment:[{token:"comment.end",regex:"\\*\\/",next:"start"},{defaultToken:"comment"}]}}var u=d("../lib/oop"),d=d("./text_highlight_rules").TextHighlightRules;u.inherits(c,d),a.JsonHighlightRules=c}),ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],function(s,a,l){"use strict";function c(){}var u=s("../range").Range;(function(){this.checkOutdent=function(d,m){return!!/^\s+$/.test(d)&&/^\s*\}/.test(m)},this.autoOutdent=function(d,m){var p,h=d.getLine(m).match(/^(\s*\})/);return h&&(h=h[1].length,p=d.findMatchingBracket({row:m,column:h}))&&p.row!=m?(p=this.$getIndent(d.getLine(p.row)),void d.replace(new u(m,0,m,h-1),p)):0},this.$getIndent=function(d){return d.match(/^\s*/)[0]}}).call(c.prototype),a.MatchingBraceOutdent=c}),ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],function(d,m,l){"use strict";var c=d("../../lib/oop"),u=d("../../range").Range,d=d("./fold_mode").FoldMode,m=m.FoldMode=function(p){p&&(this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+p.start)),this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+p.end)))};c.inherits(m,d),(function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/,this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/,this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/,this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/,this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/,this._getFoldWidgetBase=this.getFoldWidget,this.getFoldWidget=function(p,h,f){var C=p.getLine(f);return!this.singleLineBlockCommentRe.test(C)||this.startRegionRe.test(C)||this.tripleStarBlockCommentRe.test(C)?!(p=this._getFoldWidgetBase(p,h,f))&&this.startRegionRe.test(C)?"start":p:""},this.getFoldWidgetRange=function(p,h,f,C){var g,b,y,x=p.getLine(f);return this.startRegionRe.test(x)?this.getCommentRegionBlock(p,x,f):(b=x.match(this.foldingStartMarker))?(y=b.index,b[1]?this.openingBracketBlock(p,b[1],f,y):((g=p.getCommentFoldRange(f,y+b[0].length,1))&&!g.isMultiLine()&&(C?g=this.getSectionRange(p,f):h!="all"&&(g=null)),g)):h!=="markbegin"&&(b=x.match(this.foldingStopMarker))?(y=b.index+b[0].length,b[1]?this.closingBracketBlock(p,b[1],f,y):p.getCommentFoldRange(f,y,-1)):void 0},this.getSectionRange=function(p,h){for(var f=(x=p.getLine(h)).search(/\S/),C=h,g=x.length,b=h+=1,y=p.getLength();++h<y;){var x,A=(x=p.getLine(h)).search(/\S/);if(A!==-1){if(A<f)break;var v=this.getFoldWidgetRange(p,"all",h);if(v){if(v.start.row<=C)break;if(v.isMultiLine())h=v.end.row;else if(f==A)break}b=h}}return new u(C,g,b,p.getLine(b).length)},this.getCommentRegionBlock=function(p,h,f){for(var C=h.search(/\s*$/),g=p.getLength(),b=f,y=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/,x=1;++f<g;){h=p.getLine(f);var A=y.exec(h);if(A&&(A[1]?x--:x++,!x))break}if(b<f)return new u(b,C,f,h.length)}}).call(m.prototype)}),ace.define("ace/mode/json",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/json_highlight_rules","ace/mode/matching_brace_outdent","ace/mode/folding/cstyle","ace/worker/worker_client"],function(s,a,l){"use strict";function c(){this.HighlightRules=m,this.$outdent=new p,this.$behaviour=this.$defaultBehaviour,this.foldingRules=new h}var u=s("../lib/oop"),d=s("./text").Mode,m=s("./json_highlight_rules").JsonHighlightRules,p=s("./matching_brace_outdent").MatchingBraceOutdent,h=s("./folding/cstyle").FoldMode,f=s("../worker/worker_client").WorkerClient;u.inherits(c,d),(function(){this.lineCommentStart="//",this.blockComment={start:"/*",end:"*/"},this.getNextLineIndent=function(C,g,b){var y=this.$getIndent(g);return C=="start"&&g.match(/^.*[\{\(\[]\s*$/)&&(y+=b),y},this.checkOutdent=function(C,g,b){return this.$outdent.checkOutdent(g,b)},this.autoOutdent=function(C,g,b){this.$outdent.autoOutdent(g,b)},this.createWorker=function(C){var g=new f(["ace"],"ace/mode/json_worker","JsonWorker");return g.attachToDocument(C.getDocument()),g.on("annotate",function(b){C.setAnnotations(b.data)}),g.on("terminate",function(){C.clearAnnotations()}),g},this.$id="ace/mode/json"}).call(c.prototype),a.Mode=c}),ace.require(["ace/mode/json"],function(s){n&&(n.exports=s)})},2229:function(f,o,i){"use strict";var s=i(2620),a=i(4292),l=i(9336),c=i(4427),u=i(9306),d=i(2084),m=i(3483),p=i(8852),h=i(6862),f=((f.exports=y).prototype.validate=function(w,S){var P;if(typeof w=="string"){if(!(P=this.getSchema(w)))throw new Error('no schema with key or ref "'+w+'"')}else w=this._addSchema(w),P=w.validate||this._compile(w);return w=P(S),P.$async!==!0&&(this.errors=P.errors),w},y.prototype.compile=function(w,S){return w=this._addSchema(w,void 0,S),w.validate||this._compile(w)},y.prototype.addSchema=function(w,S,P,k){if(Array.isArray(w))for(var L=0;L<w.length;L++)this.addSchema(w[L],void 0,P,k);else{var R=this._getId(w);if(R!==void 0&&typeof R!="string")throw new Error("schema id must be string");T(this,S=a.normalizeId(S||R)),this._schemas[S]=this._addSchema(w,P,k,!0)}return this},y.prototype.addMetaSchema=function(w,S,P){return this.addSchema(w,S,P,!0),this},y.prototype.validateSchema=function(w,S){var P=w.$schema;if(P!==void 0&&typeof P!="string")throw new Error("$schema must be a string");if(!(P=P||this._opts.defaultMeta||function(k){var L=k._opts.meta;return k._opts.defaultMeta=typeof L=="object"?k._getId(L)||L:k.getSchema(C)?C:void 0,k._opts.defaultMeta}(this)))return this.logger.warn("meta-schema not available"),!(this.errors=null);if(P=this.validate(P,w),!P&&S){if(w="schema is invalid: "+this.errorsText(),this._opts.validateSchema!="log")throw new Error(w);this.logger.error(w)}return P},y.prototype.getSchema=function(w){var S=x(this,w);switch(typeof S){case"object":return S.validate||this._compile(S);case"string":return this.getSchema(S);case"undefined":return function(P,k){var L=a.schema.call(P,{schema:{}},k);{var R,N,F;if(L)return R=L.schema,N=L.root,L=L.baseId,F=s.call(P,R,N,void 0,L),P._fragments[k]=new c({ref:k,fragment:!0,schema:R,root:N,baseId:L,validate:F}),F}}(this,w)}},y.prototype.removeSchema=function(w){if(w instanceof RegExp)A(this,this._schemas,w),A(this,this._refs,w);else switch(typeof w){case"undefined":return A(this,this._schemas),A(this,this._refs),this._cache.clear(),this;case"string":var S=x(this,w);return S&&this._cache.del(S.cacheKey),delete this._schemas[w],delete this._refs[w],this;case"object":S=this._opts.serialize,S=S?S(w):w,S=(this._cache.del(S),this._getId(w)),S&&(S=a.normalizeId(S),delete this._schemas[S],delete this._refs[S])}return this},y.prototype.addFormat=function(w,S){return typeof S=="string"&&(S=new RegExp(S)),this._formats[w]=S,this},y.prototype.errorsText=function(w,S){if(!(w=w||this.errors))return"No errors";for(var P=(S=S||{}).separator===void 0?", ":S.separator,k=S.dataVar===void 0?"data":S.dataVar,L="",R=0;R<w.length;R++){var N=w[R];N&&(L+=k+N.dataPath+" "+N.message+P)}return L.slice(0,-P.length)},y.prototype._addSchema=function(w,F,P,k){if(typeof w!="object"&&typeof w!="boolean")throw new Error("schema should be object or boolean");var L=this._opts.serialize,L=L?L(w):w,R=this._cache.get(L);if(R)return R;k=k||this._opts.addUsedSchema!==!1,R=a.normalizeId(this._getId(w)),R&&k&&T(this,R);var N,F=this._opts.validateSchema!==!1&&!F;F&&!(N=R&&R==a.normalizeId(w.$schema))&&this.validateSchema(w,!0);var H=a.ids.call(this,w),H=new c({id:R,schema:w,localRefs:H,cacheKey:L,meta:P});return R[0]!="#"&&k&&(this._refs[R]=H),this._cache.put(L,H),F&&N&&this.validateSchema(w,!0),H},y.prototype._compile=function(w,S){if(w.compiling)return(w.validate=L).schema=w.schema,L.errors=null,L.root=S||L,w.schema.$async===!0&&(L.$async=!0),L;var P,k;w.compiling=!0,w.meta&&(P=this._opts,this._opts=this._metaOpts);try{k=s.call(this,w.schema,S,w.localRefs)}catch(R){throw delete w.validate,R}finally{w.compiling=!1,w.meta&&(this._opts=P)}return w.validate=k,w.refs=k.refs,w.refVal=k.refVal,w.root=k.root,k;function L(){var R=w.validate,N=R.apply(this,arguments);return L.errors=R.errors,N}},y.prototype.compileAsync=i(600),i(413)),f=(y.prototype.addKeyword=f.add,y.prototype.getKeyword=f.get,y.prototype.removeKeyword=f.remove,y.prototype.validateKeyword=f.validate,i(3689)),C=(y.ValidationError=f.Validation,y.MissingRefError=f.MissingRef,y.$dataMetaSchema=p,"http://json-schema.org/draft-07/schema"),g=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],b=["/properties"];function y(w){if(!(this instanceof y))return new y(w);w=this._opts=h.copy(w)||{};var V=this,S=V._opts.logger;if(S===!1)V.logger={log:E,warn:E,error:E};else{if(!(typeof(S=S===void 0?console:S)=="object"&&S.log&&S.warn&&S.error))throw new Error("logger must implement log, warn and error methods");V.logger=S}if(this._schemas={},this._refs={},this._fragments={},this._formats=d(w.format),this._cache=w.cache||new l,this._loadingSchemas={},this._compilations=[],this.RULES=m(),this._getId=function(B){switch(B.schemaId){case"auto":return I;case"id":return v;default:return _}}(w),w.loopRequired=w.loopRequired||1/0,w.errorDataPath=="property"&&(w._errorDataPathProperty=!0),w.serialize===void 0&&(w.serialize=u),this._metaOpts=function(B){for(var j=h.copy(B._opts),U=0;U<g.length;U++)delete j[g[U]];return j}(this),w.formats){var P,k=this;for(P in k._opts.formats){var L=k._opts.formats[P];k.addFormat(P,L)}}if(w.keywords){var R,N=this;for(R in N._opts.keywords){var F=N._opts.keywords[R];N.addKeyword(R,F)}}var H,V=this,q=(V._opts.$data&&(H=i(3420),V.addMetaSchema(H,H.$id,!0)),V._opts.meta!==!1&&(H=i(8198),V._opts.$data&&(H=p(H,b)),V.addMetaSchema(H,C,!0),V._refs["http://json-schema.org/schema"]=C),typeof w.meta=="object"&&this.addMetaSchema(w.meta),w.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),this),Q=q._opts.schemas;if(Q)if(Array.isArray(Q))q.addSchema(Q);else for(var O in Q)q.addSchema(Q[O],O)}function x(w,S){return S=a.normalizeId(S),w._schemas[S]||w._refs[S]||w._fragments[S]}function A(w,S,P){for(var k in S){var L=S[k];L.meta||P&&!P.test(k)||(w._cache.del(L.cacheKey),delete S[k])}}function v(w){return w.$id&&this.logger.warn("schema $id ignored",w.$id),w.id}function _(w){return w.id&&this.logger.warn("schema id ignored",w.id),w.$id}function I(w){if(w.$id&&w.id&&w.$id!=w.id)throw new Error("schema $id is different from id");return w.$id||w.id}function T(w,S){if(w._schemas[S]||w._refs[S])throw new Error('schema with key or id "'+S+'" already exists')}function E(){}},9336:function(n){"use strict";n=n.exports=function(){this._cache={}},n.prototype.put=function(o,i){this._cache[o]=i},n.prototype.get=function(o){return this._cache[o]},n.prototype.del=function(o){delete this._cache[o]},n.prototype.clear=function(){this._cache={}}},600:function(n,o,i){"use strict";var s=i(3689).MissingRef;function a(l,c,u){var d=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof c=="function"&&(u=c,c=void 0);var m=p(l).then(function(){var h=d._addSchema(l,void 0,c);return h.validate||function f(C){try{return d._compile(C)}catch(b){if(b instanceof s)return g(b);throw b}function g(b){var y=b.missingSchema;if(A(y))throw new Error("Schema "+y+" is loaded but "+b.missingRef+" cannot be resolved");return b=d._loadingSchemas[y],b||(b=d._loadingSchemas[y]=d._opts.loadSchema(y)).then(x,x),b.then(function(v){if(!A(y))return p(v).then(function(){A(y)||d.addSchema(v,y,void 0,c)})}).then(function(){return f(C)});function x(){delete d._loadingSchemas[y]}function A(v){return d._refs[v]||d._schemas[v]}}}(h)});return u&&m.then(function(h){u(null,h)},u),m;function p(h){return h=h.$schema,h&&!d.getSchema(h)?a.call(d,{$ref:h},!0):Promise.resolve()}}n.exports=a},3689:function(n,o,i){"use strict";var s=i(4292);function a(c,u,d){this.message=d||a.message(c,u),this.missingRef=s.url(c,u),this.missingSchema=s.normalizeId(s.fullPath(this.missingRef))}function l(c){return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c}n.exports={Validation:l(function(c){this.message="validation failed",this.errors=c,this.ajv=this.validation=!0}),MissingRef:l(a)},a.message=function(c,u){return"can't resolve reference "+u+" from id "+c}},2084:function(n,o,u){"use strict";var s=u(6862),a=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,l=[0,31,28,31,30,31,30,31,31,30,31,30,31],c=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,u=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,d=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,m=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,p=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,h=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,f=/^(?:\/(?:[^~/]|~0|~1)*)*$/,C=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,g=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;function b(T){return s.copy(b[T=T=="full"?"full":"fast"])}function y(S){var E,w,S=S.match(a);return!!S&&(E=+S[1],w=+S[2],S=+S[3],1<=w)&&w<=12&&1<=S&&S<=(w!=2||(S=E)%4!=0||S%100==0&&S%400!=0?l[w]:29)}function x(k,E){var w,S,P,k=k.match(c);return!!k&&(w=k[1],S=k[2],P=k[3],k=k[5],w<=23&&S<=59&&P<=59||w==23&&S==59&&P==60)&&(!E||k)}(n.exports=b).fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":m,url:p,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:u,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:I,uuid:h,"json-pointer":f,"json-pointer-uri-fragment":C,"relative-json-pointer":g},b.full={date:y,time:x,"date-time":function(T){return T=T.split(A),T.length==2&&y(T[0])&&x(T[1],!0)},uri:function(T){return v.test(T)&&d.test(T)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":m,url:p,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:u,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:I,uuid:h,"json-pointer":f,"json-pointer-uri-fragment":C,"relative-json-pointer":g};var A=/t|\s/i,v=/\/|:/,_=/[^\\]\\Z/;function I(T){if(_.test(T))return!1;try{return new RegExp(T),!0}catch{return!1}}},2620:function(n,o,i){"use strict";var s=i(4292),a=i(6862),l=i(3689),c=i(9306),u=i(1035),d=a.ucs2length,m=i(5215),p=l.Validation;function h(A,v,_,I){var T=this,E=this._opts,w=[void 0],S={},P=[],k={},L=[],R={},N=[],F=(v=v||{schema:A,refVal:w,refs:S},(function(ne,le,ee){var oe=f.call(this,ne,le,ee);return 0<=oe?{index:oe,compiling:!0}:(oe=this._compilations.length,this._compilations[oe]={schema:ne,root:le,baseId:ee},{index:oe,compiling:!1})}).call(this,A,v,I)),H=this._compilations[F.index];if(F.compiling)return H.callValidate=B;var V=this._formats,q=this.RULES;try{var Q=j(A,v,_,I),O=(H.validate=Q,H.callValidate);return O&&(O.schema=Q.schema,O.errors=null,O.refs=Q.refs,O.refVal=Q.refVal,O.root=Q.root,O.$async=Q.$async,E.sourceCode)&&(O.source=Q.source),Q}finally{(function(ne,le,ee){ne=f.call(this,ne,le,ee),0<=ne&&this._compilations.splice(ne,1)}).call(this,A,v,I)}function B(){var ne=H.validate,le=ne.apply(this,arguments);return B.errors=ne.errors,le}function j(ne,le,ee,oe){var te=!le||le.schema==ne;if(le.schema!=v.schema)return h.call(T,ne,le,ee,oe);ee=ne.$async===!0,oe=u({isTop:!0,schema:ne,isRoot:te,baseId:oe,root:le,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:l.MissingRef,RULES:q,validate:u,util:a,resolve:s,resolveRef:U,usePattern:Z,useDefault:J,useCustomRule:ie,opts:E,formats:V,logger:T.logger,self:T}),oe=x(w,b)+x(P,C)+x(L,g)+x(N,y)+oe,E.processCode&&(oe=E.processCode(oe,ne));try{var X=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",oe)(T,q,V,v,w,L,N,m,d,p);w[0]=X}catch(W){throw T.logger.error("Error compiling schema, function code:",oe),W}return X.schema=ne,X.errors=null,X.refs=S,X.refVal=w,X.root=te?X:le,ee&&(X.$async=!0),E.sourceCode===!0&&(X.source={code:oe,patterns:P,defaults:L}),X}function U(ne,le,W){le=s.url(ne,le);var oe=S[le];if(oe!==void 0)return $(te=w[oe],X="refVal["+oe+"]");if(!W&&v.refs&&(oe=v.refs[le],oe!==void 0))return $(te=v.refVal[oe],X=z(le,te));var te,X=z(le),W=s.call(T,j,v,le);if((W=W===void 0&&(oe=_&&_[le])?s.inlineRef(oe,E.inlineRefs)?oe:h.call(T,oe,v,_,ne):W)!==void 0)return te=W,oe=S[oe=le],w[oe]=te,$(W,X);delete S[le]}function z(ne,le){var ee=w.length;return w[ee]=le,"refVal"+(S[ne]=ee)}function $(ne,le){return typeof ne=="object"||typeof ne=="boolean"?{code:le,schema:ne,inline:!0}:{code:le,$async:ne&&!!ne.$async}}function Z(ne){var le=k[ne];return le===void 0&&(le=k[ne]=P.length,P[le]=ne),"pattern"+le}function J(ne){switch(typeof ne){case"boolean":case"number":return""+ne;case"string":return a.toQuotedString(ne);case"object":var le,ee;return ne===null?"null":(le=c(ne),(ee=R[le])===void 0&&(ee=R[le]=L.length,L[ee]=ne),"default"+ee)}}function ie(ne,le,ee,oe){if(T._opts.validateSchema!==!1){var X=ne.definition.dependencies;if(X&&!X.every(function(se){return Object.prototype.hasOwnProperty.call(ee,se)}))throw new Error("parent schema must have all required keywords: "+X.join(","));if(X=ne.definition.validateSchema,X&&!X(le)){if(X="keyword schema is invalid: "+T.errorsText(X.errors),T._opts.validateSchema!="log")throw new Error(X);T.logger.error(X)}}var te,X=ne.definition.compile,W=ne.definition.inline,K=ne.definition.macro;if(X)te=X.call(T,le,ee,oe);else if(K)te=K.call(T,le,ee,oe),E.validateSchema!==!1&&T.validateSchema(te,!0);else if(W)te=W.call(T,oe,ne.keyword,le,ee);else if(!(te=ne.definition.validate))return;if(te===void 0)throw new Error('custom keyword "'+ne.keyword+'"failed to compile');return X=N.length,{code:"customRule"+X,validate:N[X]=te}}}function f(A,v,_){for(var I=0;I<this._compilations.length;I++){var T=this._compilations[I];if(T.schema==A&&T.root==v&&T.baseId==_)return I}return-1}function C(A,v){return"var pattern"+A+" = new RegExp("+a.toQuotedString(v[A])+");"}function g(A){return"var default"+A+" = defaults["+A+"];"}function b(A,v){return v[A]===void 0?"":"var refVal"+A+" = refVal["+A+"];"}function y(A){return"var customRule"+A+" = customRules["+A+"];"}function x(A,v){if(!A.length)return"";for(var _="",I=0;I<A.length;I++)_+=v(I,A);return _}n.exports=h},4292:function(n,o,i){"use strict";var s=i(6777),a=i(5215),l=i(6862),c=i(4427),u=i(4316);function d(v,_,I){var T,E,w,S=this._refs[I];if(typeof S=="string"){if(!this._refs[S])return d.call(this,v,_,S);S=this._refs[S]}return(S=S||this._schemas[I])instanceof c?C(S.schema,this._opts.inlineRefs)?S.schema:S.validate||this._compile(S):((S=m.call(this,_,I))&&(T=S.schema,_=S.root,w=S.baseId),T instanceof c?E=T.validate||v.call(this,T.schema,_,void 0,w):T!==void 0&&(E=C(T,this._opts.inlineRefs)?T:v.call(this,T,_,void 0,w)),E)}function m(v,_){var I=s.parse(_),T=b(I),E=g(this._getId(v.schema));if(Object.keys(v.schema).length===0||T!==E){var T=x(T),w=this._refs[T];if(typeof w=="string")return(function(P,k,L){k=m.call(this,P,k);{var R,N;if(k)return R=k.schema,N=k.baseId,P=k.root,(k=this._getId(R))&&(N=A(N,k)),h.call(this,L,N,R,P)}}).call(this,v,w,I);if(w instanceof c)w.validate||this._compile(w);else{if(!((w=this._schemas[T])instanceof c))return;if(w.validate||this._compile(w),T==x(_))return{schema:w,root:v,baseId:E}}if(!(v=w).schema)return;E=g(this._getId(v.schema))}return h.call(this,I,E,v.schema,v)}(n.exports=d).normalizeId=x,d.fullPath=g,d.url=A,d.ids=function(v){var _=x(this._getId(v)),I={"":_},T={"":g(_,!1)},E={},w=this;return u(v,{allKeys:!0},function(S,P,k,L,R,N,F){if(P!==""){var H=w._getId(S),V=I[L],L=T[L]+"/"+R;if(F!==void 0&&(L+="/"+(typeof F=="number"?F:l.escapeFragment(F))),typeof H=="string"){if(H=V=x(V?s.resolve(V,H):H),R=w._refs[H],(R=typeof R=="string"?w._refs[R]:R)&&R.schema){if(!a(S,R.schema))throw new Error('id "'+H+'" resolves to more than one schema')}else if(H!=x(L))if(H[0]=="#"){if(E[H]&&!a(S,E[H]))throw new Error('id "'+H+'" resolves to more than one schema');E[H]=S}else w._refs[H]=L}I[P]=V,T[P]=L}}),E},d.inlineRef=C,d.schema=m;var p=l.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function h(v,_,I,T){if(v.fragment=v.fragment||"",v.fragment.slice(0,1)=="/"){for(var E=v.fragment.split("/"),w=1;w<E.length;w++){var S=E[w];if(S){if((I=I[S=l.unescapeFragment(S)])===void 0)break;p[S]||((S=this._getId(I))&&(_=A(_,S)),I.$ref&&(S=A(_,I.$ref),S=m.call(this,T,S))&&(I=S.schema,T=S.root,_=S.baseId))}}return I!==void 0&&I!==T.schema?{schema:I,root:T,baseId:_}:void 0}}var f=l.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function C(v,_){return _!==!1&&(_===void 0||_===!0?function I(T){var E;if(Array.isArray(T)){for(var w=0;w<T.length;w++)if(typeof(E=T[w])=="object"&&!I(E))return!1}else for(var S in T)if(S=="$ref"||typeof(E=T[S])=="object"&&!I(E))return!1;return!0}(v):_?function I(T){var E,w=0;if(Array.isArray(T)){for(var S=0;S<T.length;S++)if(typeof(E=T[S])=="object"&&(w+=I(E)),w==1/0)return 1/0}else for(var P in T){if(P=="$ref")return 1/0;if(f[P])w++;else if(typeof(E=T[P])=="object"&&(w+=I(E)+1),w==1/0)return 1/0}return w}(v)<=_:void 0)}function g(v,_){return _!==!1&&(v=x(v)),b(s.parse(v))}function b(v){return s.serialize(v).split("#")[0]+"#"}var y=/#\/?$/;function x(v){return v?v.replace(y,""):""}function A(v,_){return _=x(_),s.resolve(v,_)}},3483:function(n,o,i){"use strict";var s=i(8161),a=i(6862).toHash;n.exports=function(){var l=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],c=["type","$comment"];return l.all=a(c),l.types=a(["number","integer","string","array","object","boolean","null"]),l.forEach(function(u){u.rules=u.rules.map(function(d){var m,p;return typeof d=="object"&&(p=d[m=Object.keys(d)[0]],d=m,p.forEach(function(h){c.push(h),l.all[h]=!0})),c.push(d),l.all[d]={keyword:d,code:s[d],implements:p}}),l.all.$comment={keyword:"$comment",code:s.$comment},u.type&&(l.types[u.type]=u)}),l.keywords=a(c.concat(["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"])),l.custom={},l}},4427:function(n,o,i){"use strict";var s=i(6862);n.exports=function(a){s.copy(a,this)}},611:function(n){"use strict";n.exports=function(o){for(var i,s=0,a=o.length,l=0;l<a;)s++,55296<=(i=o.charCodeAt(l++))&&i<=56319&&l<a&&(64512&o.charCodeAt(l))==56320&&l++;return s}},6862:function(n,o,i){"use strict";function s(y,x,A,v){var _=v?" !== ":" === ",I=v?" || ":" && ",T=v?"!":"",E=v?"":"!";switch(y){case"null":return x+_+"null";case"array":return T+"Array.isArray("+x+")";case"object":return"("+T+x+I+"typeof "+x+_+'"object"'+I+E+"Array.isArray("+x+"))";case"integer":return"(typeof "+x+_+'"number"'+I+E+"("+x+" % 1)"+I+x+_+x+(A?I+T+"isFinite("+x+")":"")+")";case"number":return"(typeof "+x+_+'"'+y+'"'+(A?I+T+"isFinite("+x+")":"")+")";default:return"typeof "+x+_+'"'+y+'"'}}n.exports={copy:function(y,x){for(var A in x=x||{},y)x[A]=y[A];return x},checkDataType:s,checkDataTypes:function(y,x,A){{if(y.length===1)return s(y[0],x,A,!0);var v,_="",y=l(y);for(v in y.array&&y.object&&(_=y.null?"(":"(!"+x+" || ",_+="typeof "+x+' !== "object")',delete y.null,delete y.array,delete y.object),y.number&&delete y.integer,y)_+=(_?" && ":"")+s(v,x,A,!0);return _}},coerceToTypes:function(y,x){{if(!Array.isArray(x))return a[x]?[x]:y==="array"&&x==="array"?["array"]:void 0;for(var A=[],v=0;v<x.length;v++){var _=x[v];(a[_]||y==="array"&&_==="array")&&(A[A.length]=_)}return A.length?A:void 0}},toHash:l,getProperty:d,escapeQuotes:m,equal:i(5215),ucs2length:i(611),varOccurences:function(y,x){return x+="[^0-9]",y=y.match(new RegExp(x,"g")),y?y.length:0},varReplace:function(y,x,A){return x+="([^0-9])",A=A.replace(/\$/g,"$$$$"),y.replace(new RegExp(x,"g"),A+"$1")},schemaHasRules:function(y,x){if(typeof y=="boolean")return!y;for(var A in y)if(x[A])return!0},schemaHasRulesExcept:function(y,x,A){if(typeof y=="boolean")return!y&&A!="not";for(var v in y)if(v!=A&&x[v])return!0},schemaUnknownRules:function(y,x){if(typeof y!="boolean"){for(var A in y)if(!x[A])return A}},toQuotedString:p,getPathExpr:function(y,x,A,v){return C(y,A?"'/' + "+x+(v?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):v?"'[' + "+x+" + ']'":"'[\\'' + "+x+" + '\\']'")},getPath:function(y,x,A){return A=p(A?"/"+g(x):d(x)),C(y,A)},getData:function(y,x,A){var v,_,I;if(y==="")return"rootData";if(y[0]=="/"){if(!h.test(y))throw new Error("Invalid JSON-pointer: "+y);v=y,_="rootData"}else{if(!(I=y.match(f)))throw new Error("Invalid JSON-pointer: "+y);if(y=+I[1],(v=I[2])=="#"){if(x<=y)throw new Error("Cannot access property/index "+y+" levels up, current level is "+x);return A[x-y]}if(x<y)throw new Error("Cannot access data "+y+" levels up, current level is "+x);if(_="data"+(x-y||""),!v)return _}for(var T=_,E=v.split("/"),w=0;w<E.length;w++){var S=E[w];S&&(_+=d(b(S)),T+=" && "+_)}return T},unescapeFragment:function(y){return b(decodeURIComponent(y))},unescapeJsonPointer:b,escapeFragment:function(y){return encodeURIComponent(g(y))},escapeJsonPointer:g};var a=l(["string","number","integer","boolean","null"]);function l(y){for(var x={},A=0;A<y.length;A++)x[y[A]]=!0;return x}var c=/^[a-z$_][a-z$_0-9]*$/i,u=/'|\\/g;function d(y){return typeof y=="number"?"["+y+"]":c.test(y)?"."+y:"['"+m(y)+"']"}function m(y){return y.replace(u,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function p(y){return"'"+m(y)+"'"}var h=/^\/(?:[^~]|~0|~1)*$/,f=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function C(y,x){return y=='""'?x:(y+" + "+x).replace(/([^\\])' \+ '/g,"$1")}function g(y){return y.replace(/~/g,"~0").replace(/\//g,"~1")}function b(y){return y.replace(/~1/g,"/").replace(/~0/g,"~")}},8852:function(n){"use strict";var o=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];n.exports=function(i,s){for(var a=0;a<s.length;a++){i=JSON.parse(JSON.stringify(i));for(var l=s[a].split("/"),c=i,u=1;u<l.length;u++)c=c[l[u]];for(u=0;u<o.length;u++){var d=o[u],m=c[d];m&&(c[d]={anyOf:[m,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return i}},9407:function(n,o,i){"use strict";i=i(8198),n.exports={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:i.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:i.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}},1765:function(n){"use strict";n.exports=function(o,i,s){var a,l,c,u,d,m=" ",p=o.level,h=o.dataLevel,f=o.schema[i],C=o.schemaPath+o.util.getProperty(i),g=o.errSchemaPath+"/"+i,b=!o.opts.allErrors,y="data"+(h||""),x=o.opts.$data&&f&&f.$data,A=x?(m+=" var schema"+p+" = "+o.util.getData(f.$data,h,o.dataPathArr)+"; ","schema"+p):f,v=i=="maximum",_=v?"exclusiveMaximum":"exclusiveMinimum",I=o.schema[_],T=o.opts.$data&&I&&I.$data,E=v?"<":">",w=v?">":"<",S=void 0;if(!x&&typeof f!="number"&&f!==void 0)throw new Error(i+" must be number");if(!T&&I!==void 0&&typeof I!="number"&&typeof I!="boolean")throw new Error(_+" must be number or boolean");T?(h=o.util.getData(I.$data,h,o.dataPathArr),c="exclIsNumber"+p,u="' + "+(d="op"+p)+" + '",S=_,(P=P||[]).push(m=m+(" var schemaExcl"+p+" = "+h+"; ")+(" var "+(a="exclusive"+p)+"; var "+(l="exclType"+p)+" = typeof "+(h="schemaExcl"+p)+"; if ("+l+" != 'boolean' && "+l+" != 'undefined' && "+l+" != 'number') { ")),m="",o.createErrors!==!1?(m+=" { keyword: '"+(S||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(g)+" , params: {} ",o.opts.messages!==!1&&(m+=" , message: '"+_+" should be boolean' "),o.opts.verbose&&(m+=" , schema: validate.schema"+C+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+y+" "),m+=" } "):m+=" {} ",k=m,m=P.pop(),!o.compositeRule&&b?o.async?m+=" throw new ValidationError(["+k+"]); ":m+=" validate.errors = ["+k+"]; return false; ":m+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",m+=" } else if ( ",x&&(m+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),m+=" "+l+" == 'number' ? ( ("+a+" = "+A+" === undefined || "+h+" "+E+"= "+A+") ? "+y+" "+w+"= "+h+" : "+y+" "+w+" "+A+" ) : ( ("+a+" = "+h+" === true) ? "+y+" "+w+"= "+A+" : "+y+" "+w+" "+A+" ) || "+y+" !== "+y+") { var op"+p+" = "+a+" ? '"+E+"' : '"+E+"='; ",f===void 0&&(g=o.errSchemaPath+"/"+(S=_),A=h,x=T)):(u=E,(c=typeof I=="number")&&x?(d="'"+u+"'",m+=" if ( ",x&&(m+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),m+=" ( "+A+" === undefined || "+I+" "+E+"= "+A+" ? "+y+" "+w+"= "+I+" : "+y+" "+w+" "+A+" ) || "+y+" !== "+y+") { "):(c&&f===void 0?(a=!0,g=o.errSchemaPath+"/"+(S=_),A=I,w+="="):(c&&(A=Math[v?"min":"max"](I,f)),I===(!c||A)?(a=!0,g=o.errSchemaPath+"/"+(S=_),w+="="):(a=!1,u+="=")),d="'"+u+"'",m+=" if ( ",x&&(m+=" ("+A+" !== undefined && typeof "+A+" != 'number') || "),m+=" "+y+" "+w+" "+A+" || "+y+" !== "+y+") { ")),S=S||i,(P=P||[]).push(m),m="",o.createErrors!==!1?(m+=" { keyword: '"+(S||"_limit")+"' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(g)+" , params: { comparison: "+d+", limit: "+A+", exclusive: "+a+" } ",o.opts.messages!==!1&&(m=m+" , message: 'should be "+u+" "+(x?"' + "+A:A+"'")),o.opts.verbose&&(m=(m+=" , schema:  ")+(x?"validate.schema"+C:""+f)+"         , parentSchema: validate.schema"+o.schemaPath+" , data: "+y+" "),m+=" } "):m+=" {} ";var P,k=m;return m=P.pop(),!o.compositeRule&&b?o.async?m+=" throw new ValidationError(["+k+"]); ":m+=" validate.errors = ["+k+"]; return false; ":m+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",m+=" } ",b&&(m+=" else { "),m}},9337:function(n){"use strict";n.exports=function(o,i,s){var a,l=" ",c=o.level,C=o.dataLevel,u=o.schema[i],d=o.schemaPath+o.util.getProperty(i),m=o.errSchemaPath+"/"+i,p=!o.opts.allErrors,h="data"+(C||""),f=o.opts.$data&&u&&u.$data,C=f?(l+=" var schema"+c+" = "+o.util.getData(u.$data,C,o.dataPathArr)+"; ","schema"+c):u;if(f||typeof u=="number")return l+="if ( ",f&&(l+=" ("+C+" !== undefined && typeof "+C+" != 'number') || "),(c=[]).push(l+=" "+h+".length "+((a=i)=="maxItems"?">":"<")+" "+C+") { "),l="",o.createErrors!==!1?(l+=" { keyword: '"+(a||"_limitItems")+"' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { limit: "+C+" } ",o.opts.messages!==!1&&(l=(l=(l+=" , message: 'should NOT have ")+(i=="maxItems"?"more":"fewer")+" than ")+(f?"' + "+C+" + '":""+u)+" items' "),o.opts.verbose&&(l=(l+=" , schema:  ")+(f?"validate.schema"+d:""+u)+"         , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),l+=" } "):l+=" {} ",a=l,l=c.pop(),!o.compositeRule&&p?o.async?l+=" throw new ValidationError(["+a+"]); ":l+=" validate.errors = ["+a+"]; return false; ":l+=" var err = "+a+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l+="} ",p&&(l+=" else { "),l;throw new Error(i+" must be number")}},5433:function(n){"use strict";n.exports=function(o,i,s){var a,l=" ",c=o.level,C=o.dataLevel,u=o.schema[i],d=o.schemaPath+o.util.getProperty(i),m=o.errSchemaPath+"/"+i,p=!o.opts.allErrors,h="data"+(C||""),f=o.opts.$data&&u&&u.$data,C=f?(l+=" var schema"+c+" = "+o.util.getData(u.$data,C,o.dataPathArr)+"; ","schema"+c):u;if(f||typeof u=="number")return l+="if ( ",f&&(l+=" ("+C+" !== undefined && typeof "+C+" != 'number') || "),o.opts.unicode===!1?l+=" "+h+".length ":l+=" ucs2length("+h+") ",(c=[]).push(l+=" "+((a=i)=="maxLength"?">":"<")+" "+C+") { "),l="",o.createErrors!==!1?(l+=" { keyword: '"+(a||"_limitLength")+"' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { limit: "+C+" } ",o.opts.messages!==!1&&(l=(l=(l+=" , message: 'should NOT be ")+(i=="maxLength"?"longer":"shorter")+" than ")+(f?"' + "+C+" + '":""+u)+" characters' "),o.opts.verbose&&(l=(l+=" , schema:  ")+(f?"validate.schema"+d:""+u)+"         , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),l+=" } "):l+=" {} ",a=l,l=c.pop(),!o.compositeRule&&p?o.async?l+=" throw new ValidationError(["+a+"]); ":l+=" validate.errors = ["+a+"]; return false; ":l+=" var err = "+a+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l+="} ",p&&(l+=" else { "),l;throw new Error(i+" must be number")}},7724:function(n){"use strict";n.exports=function(o,i,s){var a,l=" ",c=o.level,C=o.dataLevel,u=o.schema[i],d=o.schemaPath+o.util.getProperty(i),m=o.errSchemaPath+"/"+i,p=!o.opts.allErrors,h="data"+(C||""),f=o.opts.$data&&u&&u.$data,C=f?(l+=" var schema"+c+" = "+o.util.getData(u.$data,C,o.dataPathArr)+"; ","schema"+c):u;if(f||typeof u=="number")return l+="if ( ",f&&(l+=" ("+C+" !== undefined && typeof "+C+" != 'number') || "),(c=[]).push(l+=" Object.keys("+h+").length "+((a=i)=="maxProperties"?">":"<")+" "+C+") { "),l="",o.createErrors!==!1?(l+=" { keyword: '"+(a||"_limitProperties")+"' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { limit: "+C+" } ",o.opts.messages!==!1&&(l=(l=(l+=" , message: 'should NOT have ")+(i=="maxProperties"?"more":"fewer")+" than ")+(f?"' + "+C+" + '":""+u)+" properties' "),o.opts.verbose&&(l=(l+=" , schema:  ")+(f?"validate.schema"+d:""+u)+"         , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),l+=" } "):l+=" {} ",a=l,l=c.pop(),!o.compositeRule&&p?o.async?l+=" throw new ValidationError(["+a+"]); ":l+=" validate.errors = ["+a+"]; return false; ":l+=" var err = "+a+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l+="} ",p&&(l+=" else { "),l;throw new Error(i+" must be number")}},3531:function(n){"use strict";n.exports=function(o,i,s){var a=" ",l=o.schema[i],c=o.schemaPath+o.util.getProperty(i),u=o.errSchemaPath+"/"+i,d=!o.opts.allErrors,m=o.util.copy(o),p="",h=(m.level++,"valid"+m.level),f=m.baseId,C=!0,g=l;if(g)for(var b,y=-1,x=g.length-1;y<x;)b=g[y+=1],(o.opts.strictKeywords?typeof b=="object"&&0<Object.keys(b).length||b===!1:o.util.schemaHasRules(b,o.RULES.all))&&(C=!1,m.schema=b,m.schemaPath=c+"["+y+"]",m.errSchemaPath=u+"/"+y,a+="  "+o.validate(m)+" ",m.baseId=f,d)&&(a+=" if ("+h+") { ",p+="}");return d&&(a+=C?" if (true) { ":" "+p.slice(0,-1)+" "),a}},8854:function(n){"use strict";n.exports=function(o,d,s){var a=" ",h=o.level,m=o.dataLevel,l=o.schema[d],c=o.schemaPath+o.util.getProperty(d),u=o.errSchemaPath+"/"+d,d=!o.opts.allErrors,m="data"+(m||""),p="valid"+h,h="errs__"+h,f=o.util.copy(o),C="",g=(f.level++,"valid"+f.level);if(l.every(function(I){return o.opts.strictKeywords?typeof I=="object"&&0<Object.keys(I).length||I===!1:o.util.schemaHasRules(I,o.RULES.all)})){var b=f.baseId,y=(a+=" var "+h+" = errors; var "+p+" = false;  ",o.compositeRule),x=(o.compositeRule=f.compositeRule=!0,l);if(x)for(var A,v=-1,_=x.length-1;v<_;)A=x[v+=1],f.schema=A,f.schemaPath=c+"["+v+"]",f.errSchemaPath=u+"/"+v,a+="  "+o.validate(f)+" ",f.baseId=b,a+=" "+p+" = "+p+" || "+g+"; if (!"+p+") { ",C+="}";o.compositeRule=f.compositeRule=y,a+=" "+C+" if (!"+p+") {   var err =   ",o.createErrors!==!1?(a+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(u)+" , params: {} ",o.opts.messages!==!1&&(a+=" , message: 'should match some schema in anyOf' "),o.opts.verbose&&(a+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+m+" "),a+=" } "):a+=" {} ",a+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!o.compositeRule&&d&&(o.async?a+=" throw new ValidationError(vErrors); ":a+=" validate.errors = vErrors; return false; "),a+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",o.opts.allErrors&&(a+=" } ")}else d&&(a+=" if (true) { ");return a}},8372:function(n){"use strict";n.exports=function(o,l,s){var a=" ",c=o.schema[l],l=o.errSchemaPath+"/"+l,c=(o.opts.allErrors,o.util.toQuotedString(c));return o.opts.$comment===!0?a+=" console.log("+c+");":typeof o.opts.$comment=="function"&&(a+=" self._opts.$comment("+c+", "+o.util.toQuotedString(l)+", validate.root.schema);"),a}},9650:function(n){"use strict";n.exports=function(o,c,s){var C=" ",a=o.level,f=o.dataLevel,h=o.schema[c],l=o.schemaPath+o.util.getProperty(c),c=o.errSchemaPath+"/"+c,u=!o.opts.allErrors,d="data"+(f||""),m="valid"+a,p=o.opts.$data&&h&&h.$data,h=(p&&(C+=" var schema"+a+" = "+o.util.getData(h.$data,f,o.dataPathArr)+"; "),p||(C+=" var schema"+a+" = validate.schema"+l+";"),[]),f=(h.push(C+="var "+m+" = equal("+d+", schema"+a+"); if (!"+m+") {   "),C="",o.createErrors!==!1?(C+=" { keyword: 'const' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(c)+" , params: { allowedValue: schema"+a+" } ",o.opts.messages!==!1&&(C+=" , message: 'should be equal to constant' "),o.opts.verbose&&(C+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+d+" "),C+=" } "):C+=" {} ",C),C=h.pop();return!o.compositeRule&&u?o.async?C+=" throw new ValidationError(["+f+"]); ":C+=" validate.errors = ["+f+"]; return false; ":C+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",C+=" }",u&&(C+=" else { "),C}},1292:function(n){"use strict";n.exports=function(o,c,s){var A=" ",y=o.level,d=o.dataLevel,a=o.schema[c],l=o.schemaPath+o.util.getProperty(c),c=o.errSchemaPath+"/"+c,u=!o.opts.allErrors,d="data"+(d||""),m="valid"+y,p="errs__"+y,h=o.util.copy(o),f=(h.level++,"valid"+h.level),y="i"+y,C=h.dataLevel=o.dataLevel+1,g="data"+C,x=o.baseId,b=o.opts.strictKeywords?typeof a=="object"&&0<Object.keys(a).length||a===!1:o.util.schemaHasRules(a,o.RULES.all),y=(A+="var "+p+" = errors;var "+m+";",b?(m=o.compositeRule,o.compositeRule=h.compositeRule=!0,h.schema=a,h.schemaPath=l,h.errSchemaPath=c,A+=" var "+f+" = false; for (var "+y+" = 0; "+y+" < "+d+".length; "+y+"++) { ",h.errorPath=o.util.getPathExpr(o.errorPath,y,o.opts.jsonPointers,!0),a=d+"["+y+"]",h.dataPathArr[C]=y,C=o.validate(h),h.baseId=x,o.util.varOccurences(C,g)<2?A+=" "+o.util.varReplace(C,g,a)+" ":A+=" var "+g+" = "+a+"; "+C+" ",A+=" if ("+f+") break; }  ",o.compositeRule=h.compositeRule=m,A+="  if (!"+f+") {"):A+=" if ("+d+".length == 0) {",[]),x=(y.push(A),A="",o.createErrors!==!1?(A+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(c)+" , params: {} ",o.opts.messages!==!1&&(A+=" , message: 'should contain a valid item' "),o.opts.verbose&&(A+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+d+" "),A+=" } "):A+=" {} ",A),A=y.pop();return!o.compositeRule&&u?o.async?A+=" throw new ValidationError(["+x+"]); ":A+=" validate.errors = ["+x+"]; return false; ":A+=" var err = "+x+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A+=" } else { ",b&&(A+="  errors = "+p+"; if (vErrors !== null) { if ("+p+") vErrors.length = "+p+"; else vErrors = null; } "),o.opts.allErrors&&(A+=" } "),A}},8050:function(n){"use strict";n.exports=function(o,L,s){var a,l,c,u=" ",d=o.level,m=o.dataLevel,R=o.schema[L],p=o.schemaPath+o.util.getProperty(L),h=o.errSchemaPath+"/"+L,f=!o.opts.allErrors,C="data"+(m||""),g="valid"+d,b="errs__"+d,y=o.opts.$data&&R&&R.$data,x=y?(u+=" var schema"+d+" = "+o.util.getData(R.$data,m,o.dataPathArr)+"; ","schema"+d):R,A="definition"+d,v=this.definition,_="";if(y&&v.$data){var I="keywordValidate"+d,T=v.validateSchema;u+=" var "+A+" = RULES.custom['"+L+"'].definition; var "+I+" = "+A+".validate;"}else{if(!(P=o.useCustomRule(this,R,o.schema,o)))return;x="validate.schema"+p,I=P.code,a=v.compile,l=v.inline,c=v.macro}var E,w,S,P,k,L=I+".errors",R="i"+d,N="ruleErr"+d,F=v.async;if(F&&!o.async)throw new Error("async keyword in sync schema");return l||c||(u+=L+" = null;"),u+="var "+b+" = errors;var "+g+";",y&&v.$data&&(_+="}",u+=" if ("+x+" === undefined) { "+g+" = true; } else { ",T)&&(_+="}",u+=" "+g+" = "+A+".validateSchema("+x+"); if ("+g+") { "),l?v.statements?u+=" "+P.validate+" ":u+=" "+g+" = "+P.validate+"; ":c?(_="",(y=o.util.copy(o)).level++,E="valid"+y.level,y.schema=P.validate,y.schemaPath="",T=o.compositeRule,o.compositeRule=y.compositeRule=!0,A=o.validate(y).replace(/validate\.schema/g,I),o.compositeRule=y.compositeRule=T,u+=" "+A):((k=k||[]).push(u),u="",u+="  "+I+".call( ",o.opts.passContext?u+="this":u+="self",a||v.schema===!1?u+=" , "+C+" ":u+=" , "+x+" , "+C+" , validate.schema"+o.schemaPath+" ",u+=" , (dataPath || '')",o.errorPath!='""'&&(u+=" + "+o.errorPath),P=u+=" , "+(w=m?"data"+(m-1||""):"parentData")+" , "+(S=m?o.dataPathArr[m]:"parentDataProperty")+" , rootData )  ",u=k.pop(),v.errors===!1?(u+=" "+g+" = ",F&&(u+="await "),u+=P+"; "):u+=F?" var "+(L="customErrors"+d)+" = null; try { "+g+" = await "+P+"; } catch (e) { "+g+" = false; if (e instanceof ValidationError) "+L+" = e.errors; else throw e; } ":" "+L+" = null; "+g+" = "+P+"; "),v.modifying&&(u+=" if ("+w+") "+C+" = "+w+"["+S+"];"),u+=""+_,v.valid?f&&(u+=" if (true) { "):(u+=" if ( ",v.valid===void 0?u=u+" !"+(c?""+E:g):u+=" "+!v.valid+" ",y=this.keyword,(k=k||[]).push(u+=") { "),(k=k||[]).push(u=""),u="",o.createErrors!==!1?(u+=" { keyword: '"+(y||"custom")+"' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(h)+" , params: { keyword: '"+this.keyword+"' } ",o.opts.messages!==!1&&(u+=` , message: 'should pass "`+this.keyword+`" keyword validation' `),o.opts.verbose&&(u+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+C+" "),u+=" } "):u+=" {} ",T=u,u=k.pop(),!o.compositeRule&&f?o.async?u+=" throw new ValidationError(["+T+"]); ":u+=" validate.errors = ["+T+"]; return false; ":u+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",A=u,u=k.pop(),l?v.errors?v.errors!="full"&&(u+="  for (var "+R+"="+b+"; "+R+"<errors; "+R+"++) { var "+N+" = vErrors["+R+"]; if ("+N+".dataPath === undefined) "+N+".dataPath = (dataPath || '') + "+o.errorPath+"; if ("+N+".schemaPath === undefined) { "+N+'.schemaPath = "'+h+'"; } ',o.opts.verbose&&(u+=" "+N+".schema = "+x+"; "+N+".data = "+C+"; "),u+=" } "):v.errors===!1?u+=" "+A+" ":(u+=" if ("+b+" == errors) { "+A+" } else {  for (var "+R+"="+b+"; "+R+"<errors; "+R+"++) { var "+N+" = vErrors["+R+"]; if ("+N+".dataPath === undefined) "+N+".dataPath = (dataPath || '') + "+o.errorPath+"; if ("+N+".schemaPath === undefined) { "+N+'.schemaPath = "'+h+'"; } ',o.opts.verbose&&(u+=" "+N+".schema = "+x+"; "+N+".data = "+C+"; "),u+=" } } "):c?(u+="   var err =   ",o.createErrors!==!1?(u+=" { keyword: '"+(y||"custom")+"' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(h)+" , params: { keyword: '"+this.keyword+"' } ",o.opts.messages!==!1&&(u+=` , message: 'should pass "`+this.keyword+`" keyword validation' `),o.opts.verbose&&(u+=" , schema: validate.schema"+p+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+C+" "),u+=" } "):u+=" {} ",u+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!o.compositeRule&&f&&(o.async?u+=" throw new ValidationError(vErrors); ":u+=" validate.errors = vErrors; return false; ")):v.errors===!1?u+=" "+A+" ":(u+=" if (Array.isArray("+L+")) { if (vErrors === null) vErrors = "+L+"; else vErrors = vErrors.concat("+L+"); errors = vErrors.length;  for (var "+R+"="+b+"; "+R+"<errors; "+R+"++) { var "+N+" = vErrors["+R+"]; if ("+N+".dataPath === undefined) "+N+".dataPath = (dataPath || '') + "+o.errorPath+";  "+N+'.schemaPath = "'+h+'";  ',o.opts.verbose&&(u+=" "+N+".schema = "+x+"; "+N+".data = "+C+"; "),u+=" } } else { "+A+" } "),u+=" } ",f&&(u+=" else { ")),u}},2860:function(n){"use strict";n.exports=function(o,C,s){var a,l=" ",c=o.level,u=o.dataLevel,d=o.schema[C],m=o.schemaPath+o.util.getProperty(C),p=o.errSchemaPath+"/"+C,h=!o.opts.allErrors,f="data"+(u||""),C="errs__"+c,g=o.util.copy(o),b="",y=(g.level++,"valid"+g.level),x={},A={},v=o.opts.ownProperties;for(V in d)V!="__proto__"&&(Q=d[V],(a=Array.isArray(Q)?A:x)[V]=Q);var _=o.errorPath;for(V in l=l+("var "+C+" = errors;")+("var missing"+c+";"),A)if((a=A[V]).length){if(l+=" if ( "+f+o.util.getProperty(V)+" !== undefined ",v&&(l+=" && Object.prototype.hasOwnProperty.call("+f+", '"+o.util.escapeQuotes(V)+"') "),h){l+=" && ( ";var I=a;if(I)for(var T=-1,E=I.length-1;T<E;)L=I[T+=1],T&&(l+=" || "),l+=" ( ( "+(H=f+(F=o.util.getProperty(L)))+" === undefined ",v&&(l+=" || ! Object.prototype.hasOwnProperty.call("+f+", '"+o.util.escapeQuotes(L)+"') "),l+=") && (missing"+c+" = "+o.util.toQuotedString(o.opts.jsonPointers?L:F)+") ) ";l+=")) {  ";var P="missing"+c,w="' + "+P+" + '",S=(o.opts._errorDataPathProperty&&(o.errorPath=o.opts.jsonPointers?o.util.getPathExpr(_,P,!0):_+" + "+P),S||[]),P=(S.push(l),l="",o.createErrors!==!1?(l+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(p)+" , params: { property: '"+o.util.escapeQuotes(V)+"', missingProperty: '"+w+"', depsCount: "+a.length+", deps: '"+o.util.escapeQuotes(a.length==1?a[0]:a.join(", "))+"' } ",o.opts.messages!==!1&&(l+=" , message: 'should have ",a.length==1?l+="property "+o.util.escapeQuotes(a[0]):l+="properties "+o.util.escapeQuotes(a.join(", ")),l+=" when property "+o.util.escapeQuotes(V)+" is present' "),o.opts.verbose&&(l+=" , schema: validate.schema"+m+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+f+" "),l+=" } "):l+=" {} ",l),l=S.pop();!o.compositeRule&&h?o.async?l+=" throw new ValidationError(["+P+"]); ":l+=" validate.errors = ["+P+"]; return false; ":l+=" var err = "+P+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{l+=" ) { ";var k=a;if(k)for(var L,R=-1,N=k.length-1;R<N;){L=k[R+=1];var F=o.util.getProperty(L),w=o.util.escapeQuotes(L),H=f+F;o.opts._errorDataPathProperty&&(o.errorPath=o.util.getPath(_,L,o.opts.jsonPointers)),l+=" if ( "+H+" === undefined ",v&&(l+=" || ! Object.prototype.hasOwnProperty.call("+f+", '"+o.util.escapeQuotes(L)+"') "),l+=") {  var err =   ",o.createErrors!==!1?(l+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(p)+" , params: { property: '"+o.util.escapeQuotes(V)+"', missingProperty: '"+w+"', depsCount: "+a.length+", deps: '"+o.util.escapeQuotes(a.length==1?a[0]:a.join(", "))+"' } ",o.opts.messages!==!1&&(l+=" , message: 'should have ",a.length==1?l+="property "+o.util.escapeQuotes(a[0]):l+="properties "+o.util.escapeQuotes(a.join(", ")),l+=" when property "+o.util.escapeQuotes(V)+" is present' "),o.opts.verbose&&(l+=" , schema: validate.schema"+m+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+f+" "),l+=" } "):l+=" {} ",l+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}l+=" }   ",h&&(b+="}",l+=" else { ")}o.errorPath=_;var V,q=g.baseId;for(V in x){var Q=x[V];(o.opts.strictKeywords?typeof Q=="object"&&0<Object.keys(Q).length||Q===!1:o.util.schemaHasRules(Q,o.RULES.all))&&(l+=" "+y+" = true; if ( "+f+o.util.getProperty(V)+" !== undefined ",v&&(l+=" && Object.prototype.hasOwnProperty.call("+f+", '"+o.util.escapeQuotes(V)+"') "),l+=") { ",g.schema=Q,g.schemaPath=m+o.util.getProperty(V),g.errSchemaPath=p+"/"+o.util.escapeFragment(V),l+="  "+o.validate(g)+" ",g.baseId=q,l+=" }  ",h)&&(l+=" if ("+y+") { ",b+="}")}return h&&(l+="   "+b+" if ("+C+" == errors) {"),l}},7112:function(n){"use strict";n.exports=function(o,c,s){var C=" ",a=o.level,h=o.dataLevel,f=o.schema[c],l=o.schemaPath+o.util.getProperty(c),c=o.errSchemaPath+"/"+c,u=!o.opts.allErrors,d="data"+(h||""),m="valid"+a,p=o.opts.$data&&f&&f.$data,f=(p&&(C+=" var schema"+a+" = "+o.util.getData(f.$data,h,o.dataPathArr)+"; "),"i"+a),h="schema"+a,h=(p||(C+=" var "+h+" = validate.schema"+l+";"),C+="var "+m+";",p&&(C+=" if (schema"+a+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+a+")) "+m+" = false; else {"),C+=m+" = false;for (var "+f+"=0; "+f+"<"+h+".length; "+f+"++) if (equal("+d+", "+h+"["+f+"])) { "+m+" = true; break; }",p&&(C+="  }  "),[]),f=(h.push(C+=" if (!"+m+") {   "),C="",o.createErrors!==!1?(C+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(c)+" , params: { allowedValues: schema"+a+" } ",o.opts.messages!==!1&&(C+=" , message: 'should be equal to one of the allowed values' "),o.opts.verbose&&(C+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+d+" "),C+=" } "):C+=" {} ",C),C=h.pop();return!o.compositeRule&&u?o.async?C+=" throw new ValidationError(["+f+"]); ":C+=" validate.errors = ["+f+"]; return false; ":C+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",C+=" }",u&&(C+=" else { "),C}},4682:function(n){"use strict";n.exports=function(o,m,s){var a=" ",l=o.level,c=o.dataLevel,u=o.schema[m],d=o.schemaPath+o.util.getProperty(m),m=o.errSchemaPath+"/"+m,p=!o.opts.allErrors,h="data"+(c||"");if(o.opts.format===!1)p&&(a+=" if (true) { ");else{var f,C=o.opts.$data&&u&&u.$data,c=C?(a+=" var schema"+l+" = "+o.util.getData(u.$data,c,o.dataPathArr)+"; ","schema"+l):u,g=o.opts.unknownFormats,b=Array.isArray(g);if(C)a+=" var "+(f="format"+l)+" = formats["+c+"]; var "+(y="isObject"+l)+" = typeof "+f+" == 'object' && !("+f+" instanceof RegExp) && "+f+".validate; var "+(A="formatType"+l)+" = "+y+" && "+f+".type || 'string'; if ("+y+") { ",o.async&&(a+=" var async"+l+" = "+f+".async; "),a+=" "+f+" = "+f+".validate; } if (  ",C&&(a+=" ("+c+" !== undefined && typeof "+c+" != 'string') || "),a+=" (",g!="ignore"&&(a+=" ("+c+" && !"+f+" ",b&&(a+=" && self._opts.unknownFormats.indexOf("+c+") == -1 "),a+=") || "),a+=" ("+f+" && "+A+" == '"+s+"' && !(typeof "+f+" == 'function' ? ",o.async?a+=" (async"+l+" ? await "+f+"("+h+") : "+f+"("+h+")) ":a+=" "+f+"("+h+") ",a+=" : "+f+".test("+h+"))))) {";else{if(!(f=o.formats[u])){if(g=="ignore")return o.logger.warn('unknown format "'+u+'" ignored in schema at path "'+o.errSchemaPath+'"'),p&&(a+=" if (true) { "),a;if(b&&0<=g.indexOf(u))return p&&(a+=" if (true) { "),a;throw new Error('unknown format "'+u+'" is used in schema at path "'+o.errSchemaPath+'"')}var y,x,A=(y=typeof f=="object"&&!(f instanceof RegExp)&&f.validate)&&f.type||"string";if(y&&(x=f.async===!0,f=f.validate),A!=s)return p&&(a+=" if (true) { "),a;if(x){if(!o.async)throw new Error("async format in sync schema");a+=" if (!(await "+(v="formats"+o.util.getProperty(u)+".validate")+"("+h+"))) { "}else{a+=" if (! ";var v="formats"+o.util.getProperty(u);y&&(v+=".validate"),a=a+(typeof f=="function"?" "+v+"("+h+") ":" "+v+".test("+h+") ")+") { "}}l=[],b=(l.push(a),a="",o.createErrors!==!1?(a=(a+=" { keyword: 'format' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { format:  ")+(C?""+c:""+o.util.toQuotedString(u))+"  } ",o.opts.messages!==!1&&(a=(a+=` , message: 'should match format "`)+(C?"' + "+c+" + '":""+o.util.escapeQuotes(u))+`"' `),o.opts.verbose&&(a=(a=(a+=" , schema:  ")+(C?"validate.schema"+d:""+o.util.toQuotedString(u)))+"         , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),a+=" } "):a+=" {} ",a),a=l.pop(),!o.compositeRule&&p?o.async?a+=" throw new ValidationError(["+b+"]); ":a+=" validate.errors = ["+b+"]; return false; ":a+=" var err = "+b+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } ",p&&(a+=" else { ")}return a}},1678:function(n){"use strict";n.exports=function(o,m,s){var a,l=" ",c=o.level,h=o.dataLevel,u=o.schema[m],d=o.schemaPath+o.util.getProperty(m),m=o.errSchemaPath+"/"+m,p=!o.opts.allErrors,h="data"+(h||""),f="valid"+c,C="errs__"+c,g=o.util.copy(o),b=(g.level++,"valid"+g.level),y=o.schema.then,x=o.schema.else,y=y!==void 0&&(o.opts.strictKeywords?typeof y=="object"&&0<Object.keys(y).length||y===!1:o.util.schemaHasRules(y,o.RULES.all)),x=x!==void 0&&(o.opts.strictKeywords?typeof x=="object"&&0<Object.keys(x).length||x===!1:o.util.schemaHasRules(x,o.RULES.all)),A=g.baseId;return y||x?(g.createErrors=!1,g.schema=u,g.schemaPath=d,g.errSchemaPath=m,l+=" var "+C+" = errors; var "+f+" = true;  ",u=o.compositeRule,o.compositeRule=g.compositeRule=!0,l+="  "+o.validate(g)+" ",g.baseId=A,g.createErrors=!0,l+="  errors = "+C+"; if (vErrors !== null) { if ("+C+") vErrors.length = "+C+"; else vErrors = null; }  ",o.compositeRule=g.compositeRule=u,y?(l+=" if ("+b+") {  ",g.schema=o.schema.then,g.schemaPath=o.schemaPath+".then",g.errSchemaPath=o.errSchemaPath+"/then",l+="  "+o.validate(g)+" ",g.baseId=A,l+=" "+f+" = "+b+"; ",y&&x?l+=" var "+(a="ifClause"+c)+" = 'then'; ":a="'then'",l+=" } ",x&&(l+=" else { ")):l+=" if (!"+b+") { ",x&&(g.schema=o.schema.else,g.schemaPath=o.schemaPath+".else",g.errSchemaPath=o.errSchemaPath+"/else",l+="  "+o.validate(g)+" ",g.baseId=A,l+=" "+f+" = "+b+"; ",y&&x?l+=" var "+(a="ifClause"+c)+" = 'else'; ":a="'else'",l+=" } "),l+=" if (!"+f+") {   var err =   ",o.createErrors!==!1?(l+=" { keyword: 'if' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { failingKeyword: "+a+" } ",o.opts.messages!==!1&&(l+=` , message: 'should match "' + `+a+` + '" schema' `),o.opts.verbose&&(l+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),l+=" } "):l+=" {} ",l+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!o.compositeRule&&p&&(o.async?l+=" throw new ValidationError(vErrors); ":l+=" validate.errors = vErrors; return false; "),l+=" }   ",p&&(l+=" else { ")):p&&(l+=" if (true) { "),l}},8161:function(n,o,i){"use strict";n.exports={$ref:i(7096),allOf:i(3531),anyOf:i(8854),$comment:i(8372),const:i(9650),contains:i(1292),dependencies:i(2860),enum:i(7112),format:i(4682),if:i(1678),items:i(3913),maximum:i(1765),minimum:i(1765),maxItems:i(9337),minItems:i(9337),maxLength:i(5433),minLength:i(5433),maxProperties:i(7724),minProperties:i(7724),multipleOf:i(812),not:i(1004),oneOf:i(6288),pattern:i(2079),properties:i(2124),propertyNames:i(4926),required:i(2e3),uniqueItems:i(7812),validate:i(1035)}},3913:function(n){"use strict";n.exports=function(o,p,s){var a=" ",b=o.level,h=o.dataLevel,l=o.schema[p],c=o.schemaPath+o.util.getProperty(p),u=o.errSchemaPath+"/"+p,d=!o.opts.allErrors,m="data"+(h||""),p="valid"+b,h="errs__"+b,f=o.util.copy(o),C="",g=(f.level++,"valid"+f.level),b="i"+b,y=f.dataLevel=o.dataLevel+1,x="data"+y,A=o.baseId;if(a+="var "+h+" = errors;var "+p+";",Array.isArray(l)){var v,_,I=o.schema.additionalItems,T=(I===!1&&(a+=" "+p+" = "+m+".length <= "+l.length+"; ",v=u,u=o.errSchemaPath+"/additionalItems",(_=_||[]).push(a+="  if (!"+p+") {   "),a="",o.createErrors!==!1?(a+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(u)+" , params: { limit: "+l.length+" } ",o.opts.messages!==!1&&(a+=" , message: 'should NOT have more than "+l.length+" items' "),o.opts.verbose&&(a+=" , schema: false , parentSchema: validate.schema"+o.schemaPath+" , data: "+m+" "),a+=" } "):a+=" {} ",p=a,a=_.pop(),!o.compositeRule&&d?o.async?a+=" throw new ValidationError(["+p+"]); ":a+=" validate.errors = ["+p+"]; return false; ":a+=" var err = "+p+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } ",u=v,d)&&(C+="}",a+=" else { "),l);if(T)for(var E=-1,w=T.length-1;E<w;){var S,P,k=T[E+=1];(o.opts.strictKeywords?typeof k=="object"&&0<Object.keys(k).length||k===!1:o.util.schemaHasRules(k,o.RULES.all))&&(a+=" "+g+" = true; if ("+m+".length > "+E+") { ",S=m+"["+E+"]",f.schema=k,f.schemaPath=c+"["+E+"]",f.errSchemaPath=u+"/"+E,f.errorPath=o.util.getPathExpr(o.errorPath,E,o.opts.jsonPointers,!0),f.dataPathArr[y]=E,P=o.validate(f),f.baseId=A,o.util.varOccurences(P,x)<2?a+=" "+o.util.varReplace(P,x,S)+" ":a+=" var "+x+" = "+S+"; "+P+" ",a+=" }  ",d)&&(a+=" if ("+g+") { ",C+="}")}typeof I=="object"&&(o.opts.strictKeywords?typeof I=="object"&&0<Object.keys(I).length||I===!1:o.util.schemaHasRules(I,o.RULES.all))&&(f.schema=I,f.schemaPath=o.schemaPath+".additionalItems",f.errSchemaPath=o.errSchemaPath+"/additionalItems",a+=" "+g+" = true; if ("+m+".length > "+l.length+") {  for (var "+b+" = "+l.length+"; "+b+" < "+m+".length; "+b+"++) { ",f.errorPath=o.util.getPathExpr(o.errorPath,b,o.opts.jsonPointers,!0),S=m+"["+b+"]",f.dataPathArr[y]=b,P=o.validate(f),f.baseId=A,o.util.varOccurences(P,x)<2?a+=" "+o.util.varReplace(P,x,S)+" ":a+=" var "+x+" = "+S+"; "+P+" ",d&&(a+=" if (!"+g+") break; "),a+=" } }  ",d)&&(a+=" if ("+g+") { ",C+="}")}else(o.opts.strictKeywords?typeof l=="object"&&0<Object.keys(l).length||l===!1:o.util.schemaHasRules(l,o.RULES.all))&&(f.schema=l,f.schemaPath=c,f.errSchemaPath=u,a+="  for (var "+b+" = 0; "+b+" < "+m+".length; "+b+"++) { ",f.errorPath=o.util.getPathExpr(o.errorPath,b,o.opts.jsonPointers,!0),S=m+"["+b+"]",f.dataPathArr[y]=b,P=o.validate(f),f.baseId=A,o.util.varOccurences(P,x)<2?a+=" "+o.util.varReplace(P,x,S)+" ":a+=" var "+x+" = "+S+"; "+P+" ",d&&(a+=" if (!"+g+") break; "),a+=" }");return d&&(a+=" "+C+" if ("+h+" == errors) {"),a}},812:function(n){"use strict";n.exports=function(o,i,s){var a=" ",l=o.level,f=o.dataLevel,c=o.schema[i],u=o.schemaPath+o.util.getProperty(i),d=o.errSchemaPath+"/"+i,m=!o.opts.allErrors,p="data"+(f||""),h=o.opts.$data&&c&&c.$data,f=h?(a+=" var schema"+l+" = "+o.util.getData(c.$data,f,o.dataPathArr)+"; ","schema"+l):c;if(!h&&typeof c!="number")throw new Error(i+" must be number");return a+="var division"+l+";if (",h&&(a+=" "+f+" !== undefined && ( typeof "+f+" != 'number' || "),a+=" (division"+l+" = "+p+" / "+f+", ",o.opts.multipleOfPrecision?a+=" Math.abs(Math.round(division"+l+") - division"+l+") > 1e-"+o.opts.multipleOfPrecision+" ":a+=" division"+l+" !== parseInt(division"+l+") ",a+=" ) ",h&&(a+="  )  "),i=[],i.push(a+=" ) {   "),a="",o.createErrors!==!1?(a+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(d)+" , params: { multipleOf: "+f+" } ",o.opts.messages!==!1&&(a=a+" , message: 'should be multiple of "+(h?"' + "+f:f+"'")),o.opts.verbose&&(a=(a+=" , schema:  ")+(h?"validate.schema"+u:""+c)+"         , parentSchema: validate.schema"+o.schemaPath+" , data: "+p+" "),a+=" } "):a+=" {} ",l=a,a=i.pop(),!o.compositeRule&&m?o.async?a+=" throw new ValidationError(["+l+"]); ":a+=" validate.errors = ["+l+"]; return false; ":a+=" var err = "+l+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+="} ",m&&(a+=" else { "),a}},1004:function(n){"use strict";n.exports=function(o,m,s){var a,l,c=" ",f=o.level,h=o.dataLevel,u=o.schema[m],d=o.schemaPath+o.util.getProperty(m),m=o.errSchemaPath+"/"+m,p=!o.opts.allErrors,h="data"+(h||""),f="errs__"+f,C=o.util.copy(o),g=(C.level++,"valid"+C.level);return(o.opts.strictKeywords?typeof u=="object"&&0<Object.keys(u).length||u===!1:o.util.schemaHasRules(u,o.RULES.all))?(C.schema=u,C.schemaPath=d,C.errSchemaPath=m,c+=" var "+f+" = errors;  ",u=o.compositeRule,o.compositeRule=C.compositeRule=!0,C.createErrors=!1,C.opts.allErrors&&(l=C.opts.allErrors,C.opts.allErrors=!1),c+=" "+o.validate(C)+" ",C.createErrors=!0,l&&(C.opts.allErrors=l),o.compositeRule=C.compositeRule=u,(a=a||[]).push(c+=" if ("+g+") {   "),c="",o.createErrors!==!1?(c+=" { keyword: 'not' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: {} ",o.opts.messages!==!1&&(c+=" , message: 'should NOT be valid' "),o.opts.verbose&&(c+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),c+=" } "):c+=" {} ",l=c,c=a.pop(),!o.compositeRule&&p?o.async?c+=" throw new ValidationError(["+l+"]); ":c+=" validate.errors = ["+l+"]; return false; ":c+=" var err = "+l+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c+=" } else {  errors = "+f+"; if (vErrors !== null) { if ("+f+") vErrors.length = "+f+"; else vErrors = null; } ",o.opts.allErrors&&(c+=" } ")):(c+="  var err =   ",o.createErrors!==!1?(c+=" { keyword: 'not' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: {} ",o.opts.messages!==!1&&(c+=" , message: 'should NOT be valid' "),o.opts.verbose&&(c+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),c+=" } "):c+=" {} ",c+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",p&&(c+=" if (false) { ")),c}},6288:function(n){"use strict";n.exports=function(o,d,s){var a=" ",A=o.level,m=o.dataLevel,l=o.schema[d],c=o.schemaPath+o.util.getProperty(d),u=o.errSchemaPath+"/"+d,d=!o.opts.allErrors,m="data"+(m||""),p="valid"+A,h="errs__"+A,f=o.util.copy(o),C="",g=(f.level++,"valid"+f.level),b=f.baseId,y="prevValid"+A,x="passingSchemas"+A,A=(a+="var "+h+" = errors , "+y+" = false , "+p+" = false , "+x+" = null; ",o.compositeRule),v=(o.compositeRule=f.compositeRule=!0,l);if(v)for(var _,I=-1,T=v.length-1;I<T;)_=v[I+=1],(o.opts.strictKeywords?typeof _=="object"&&0<Object.keys(_).length||_===!1:o.util.schemaHasRules(_,o.RULES.all))?(f.schema=_,f.schemaPath=c+"["+I+"]",f.errSchemaPath=u+"/"+I,a+="  "+o.validate(f)+" ",f.baseId=b):a+=" var "+g+" = true; ",I&&(a+=" if ("+g+" && "+y+") { "+p+" = false; "+x+" = ["+x+", "+I+"]; } else { ",C+="}"),a+=" if ("+g+") { "+p+" = "+y+" = true; "+x+" = "+I+"; }";return o.compositeRule=f.compositeRule=A,a+=C+"if (!"+p+") {   var err =   ",o.createErrors!==!1?(a+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(u)+" , params: { passingSchemas: "+x+" } ",o.opts.messages!==!1&&(a+=" , message: 'should match exactly one schema in oneOf' "),o.opts.verbose&&(a+=" , schema: validate.schema"+c+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+m+" "),a+=" } "):a+=" {} ",a+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!o.compositeRule&&d&&(o.async?a+=" throw new ValidationError(vErrors); ":a+=" validate.errors = vErrors; return false; "),a+="} else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; }",o.opts.allErrors&&(a+=" } "),a}},2079:function(n){"use strict";n.exports=function(o,c,s){var C=" ",f=o.level,p=o.dataLevel,a=o.schema[c],l=o.schemaPath+o.util.getProperty(c),c=o.errSchemaPath+"/"+c,u=!o.opts.allErrors,d="data"+(p||""),m=o.opts.$data&&a&&a.$data,p=m?(C+=" var schema"+f+" = "+o.util.getData(a.$data,p,o.dataPathArr)+"; ","schema"+f):a,f=m?"(new RegExp("+p+"))":o.usePattern(a),h=(C+="if ( ",m&&(C+=" ("+p+" !== undefined && typeof "+p+" != 'string') || "),[]),f=(h.push(C+=" !"+f+".test("+d+") ) {   "),C="",o.createErrors!==!1?(C=(C+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(c)+" , params: { pattern:  ")+(m?""+p:""+o.util.toQuotedString(a))+"  } ",o.opts.messages!==!1&&(C=(C+=` , message: 'should match pattern "`)+(m?"' + "+p+" + '":""+o.util.escapeQuotes(a))+`"' `),o.opts.verbose&&(C=(C=(C+=" , schema:  ")+(m?"validate.schema"+l:""+o.util.toQuotedString(a)))+"         , parentSchema: validate.schema"+o.schemaPath+" , data: "+d+" "),C+=" } "):C+=" {} ",C),C=h.pop();return!o.compositeRule&&u?o.async?C+=" throw new ValidationError(["+f+"]); ":C+=" validate.errors = ["+f+"]; return false; ":C+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",C+="} ",u&&(C+=" else { "),C}},2124:function(n){"use strict";n.exports=function(o,f,s){var a,l=" ",c=o.level,I=o.dataLevel,u=o.schema[f],d=o.schemaPath+o.util.getProperty(f),m=o.errSchemaPath+"/"+f,p=!o.opts.allErrors,h="data"+(I||""),f="errs__"+c,C=o.util.copy(o),g="",b=(C.level++,"valid"+C.level),y="key"+c,x="idx"+c,A=C.dataLevel=o.dataLevel+1,v="data"+A,_="dataProperties"+c,I=Object.keys(u||{}).filter(V),T=o.schema.patternProperties||{},E=Object.keys(T).filter(V),w=o.schema.additionalProperties,S=I.length||E.length,P=w===!1,k=typeof w=="object"&&Object.keys(w).length,L=o.opts.removeAdditional,R=P||k||L,N=o.opts.ownProperties,F=o.baseId,H=o.schema.required;function V(ge){return ge!=="__proto__"}if(H&&(!o.opts.$data||!H.$data)&&H.length<o.opts.loopRequired&&(a=o.util.toHash(H)),l+="var "+f+" = errors;var "+b+" = true;",N&&(l+=" var "+_+" = undefined;"),R){if(l+=N?" "+_+" = "+_+" || Object.keys("+h+"); for (var "+x+"=0; "+x+"<"+_+".length; "+x+"++) { var "+y+" = "+_+"["+x+"]; ":" for (var "+y+" in "+h+") { ",S){if(l+=" var isAdditional"+c+" = !(false ",I.length)if(8<I.length)l+=" || validate.schema"+d+".hasOwnProperty("+y+") ";else{var q=I;if(q)for(var Q=-1,O=q.length-1;Q<O;)Z=q[Q+=1],l+=" || "+y+" == "+o.util.toQuotedString(Z)+" "}if(E.length){var B=E;if(B)for(var j=-1,U=B.length-1;j<U;)se=B[j+=1],l+=" || "+o.usePattern(se)+".test("+y+") "}l+=" ); if (isAdditional"+c+") { "}L=="all"?l+=" delete "+h+"["+y+"]; ":(ee=o.errorPath,H="' + "+y+" + '",o.opts._errorDataPathProperty&&(o.errorPath=o.util.getPathExpr(o.errorPath,y,o.opts.jsonPointers)),P?L?l+=" delete "+h+"["+y+"]; ":(oe=m,m=o.errSchemaPath+"/additionalProperties",(X=X||[]).push(l+=" "+b+" = false; "),l="",o.createErrors!==!1?(l+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { additionalProperty: '"+H+"' } ",o.opts.messages!==!1&&(l+=" , message: '",o.opts._errorDataPathProperty?l+="is an invalid additional property":l+="should NOT have additional properties",l+="' "),o.opts.verbose&&(l+=" , schema: false , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),l+=" } "):l+=" {} ",W=l,l=X.pop(),!o.compositeRule&&p?o.async?l+=" throw new ValidationError(["+W+"]); ":l+=" validate.errors = ["+W+"]; return false; ":l+=" var err = "+W+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",m=oe,p&&(l+=" break; ")):k&&(L=="failing"?(l+=" var "+f+" = errors;  ",R=o.compositeRule,o.compositeRule=C.compositeRule=!0,C.schema=w,C.schemaPath=o.schemaPath+".additionalProperties",C.errSchemaPath=o.errSchemaPath+"/additionalProperties",C.errorPath=o.opts._errorDataPathProperty?o.errorPath:o.util.getPathExpr(o.errorPath,y,o.opts.jsonPointers),ae=h+"["+y+"]",C.dataPathArr[A]=y,ve=o.validate(C),C.baseId=F,o.util.varOccurences(ve,v)<2?l+=" "+o.util.varReplace(ve,v,ae)+" ":l+=" var "+v+" = "+ae+"; "+ve+" ",l+=" if (!"+b+") { errors = "+f+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+h+"["+y+"]; }  ",o.compositeRule=C.compositeRule=R):(C.schema=w,C.schemaPath=o.schemaPath+".additionalProperties",C.errSchemaPath=o.errSchemaPath+"/additionalProperties",C.errorPath=o.opts._errorDataPathProperty?o.errorPath:o.util.getPathExpr(o.errorPath,y,o.opts.jsonPointers),ae=h+"["+y+"]",C.dataPathArr[A]=y,ve=o.validate(C),C.baseId=F,o.util.varOccurences(ve,v)<2?l+=" "+o.util.varReplace(ve,v,ae)+" ":l+=" var "+v+" = "+ae+"; "+ve+" ",p&&(l+=" if (!"+b+") break; "))),o.errorPath=ee),S&&(l+=" } "),l+=" }  ",p&&(l+=" if ("+b+") { ",g+="}")}var z=o.opts.useDefaults&&!o.compositeRule;if(I.length){var $=I;if($)for(var Z,J=-1,ie=$.length-1;J<ie;){var ne,le,ee,oe,te,X,W,K=u[Z=$[J+=1]];(o.opts.strictKeywords?typeof K=="object"&&0<Object.keys(K).length||K===!1:o.util.schemaHasRules(K,o.RULES.all))&&(ae=h+(te=o.util.getProperty(Z)),ne=z&&K.default!==void 0,C.schema=K,C.schemaPath=d+te,C.errSchemaPath=m+"/"+o.util.escapeFragment(Z),C.errorPath=o.util.getPath(o.errorPath,Z,o.opts.jsonPointers),C.dataPathArr[A]=o.util.toQuotedString(Z),ve=o.validate(C),C.baseId=F,o.util.varOccurences(ve,v)<2?(ve=o.util.varReplace(ve,v,ae),le=ae):l+=" var "+(le=v)+" = "+ae+"; ",ne?l+=" "+ve+" ":(a&&a[Z]?(l+=" if ( "+le+" === undefined ",N&&(l+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+o.util.escapeQuotes(Z)+"') "),l+=") { "+b+" = false; ",ee=o.errorPath,oe=m,te=o.util.escapeQuotes(Z),o.opts._errorDataPathProperty&&(o.errorPath=o.util.getPath(ee,Z,o.opts.jsonPointers)),m=o.errSchemaPath+"/required",(X=X||[]).push(l),l="",o.createErrors!==!1?(l+=" { keyword: 'required' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { missingProperty: '"+te+"' } ",o.opts.messages!==!1&&(l+=" , message: '",o.opts._errorDataPathProperty?l+="is a required property":l+="should have required property \\'"+te+"\\'",l+="' "),o.opts.verbose&&(l+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),l+=" } "):l+=" {} ",W=l,l=X.pop(),!o.compositeRule&&p?o.async?l+=" throw new ValidationError(["+W+"]); ":l+=" validate.errors = ["+W+"]; return false; ":l+=" var err = "+W+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",m=oe,o.errorPath=ee,l+=" } else { "):p?(l+=" if ( "+le+" === undefined ",N&&(l+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+o.util.escapeQuotes(Z)+"') "),l+=") { "+b+" = true; } else { "):(l+=" if ("+le+" !== undefined ",N&&(l+=" &&   Object.prototype.hasOwnProperty.call("+h+", '"+o.util.escapeQuotes(Z)+"') "),l+=" ) { "),l+=" "+ve+" } ")),p&&(l+=" if ("+b+") { ",g+="}")}}if(E.length){var re=E;if(re)for(var se,me=-1,Y=re.length-1;me<Y;){var ae,ve,K=T[se=re[me+=1]];(o.opts.strictKeywords?typeof K=="object"&&0<Object.keys(K).length||K===!1:o.util.schemaHasRules(K,o.RULES.all))&&(C.schema=K,C.schemaPath=o.schemaPath+".patternProperties"+o.util.getProperty(se),C.errSchemaPath=o.errSchemaPath+"/patternProperties/"+o.util.escapeFragment(se),l=(l+=N?" "+_+" = "+_+" || Object.keys("+h+"); for (var "+x+"=0; "+x+"<"+_+".length; "+x+"++) { var "+y+" = "+_+"["+x+"]; ":" for (var "+y+" in "+h+") { ")+" if ("+o.usePattern(se)+".test("+y+")) { ",C.errorPath=o.util.getPathExpr(o.errorPath,y,o.opts.jsonPointers),ae=h+"["+y+"]",C.dataPathArr[A]=y,ve=o.validate(C),C.baseId=F,o.util.varOccurences(ve,v)<2?l+=" "+o.util.varReplace(ve,v,ae)+" ":l+=" var "+v+" = "+ae+"; "+ve+" ",p&&(l+=" if (!"+b+") break; "),l+=" } ",p&&(l+=" else "+b+" = true; "),l+=" }  ",p)&&(l+=" if ("+b+") { ",g+="}")}}return p&&(l+=" "+g+" if ("+f+" == errors) {"),l}},4926:function(n){"use strict";n.exports=function(o,b,s){var a,l,c,u,d,m,p,h=" ",f=o.level,x=o.dataLevel,C=o.schema[b],g=o.schemaPath+o.util.getProperty(b),b=o.errSchemaPath+"/"+b,y=!o.opts.allErrors,x="data"+(x||""),A="errs__"+f,v=o.util.copy(o),_=(v.level++,"valid"+v.level);return h+="var "+A+" = errors;",(o.opts.strictKeywords?typeof C=="object"&&0<Object.keys(C).length||C===!1:o.util.schemaHasRules(C,o.RULES.all))&&(v.schema=C,v.schemaPath=g,v.errSchemaPath=b,C="idx"+f,l="i"+f,c="' + "+(a="key"+f)+" + '",u="data"+(v.dataLevel=o.dataLevel+1),p="dataProperties"+f,m=o.opts.ownProperties,d=o.baseId,m&&(h+=" var "+p+" = undefined; "),h=h+(m?" "+p+" = "+p+" || Object.keys("+x+"); for (var "+C+"=0; "+C+"<"+p+".length; "+C+"++) { var "+a+" = "+p+"["+C+"]; ":" for (var "+a+" in "+x+") { ")+" var startErrs"+f+" = errors; ",m=a,p=o.compositeRule,o.compositeRule=v.compositeRule=!0,C=o.validate(v),v.baseId=d,o.util.varOccurences(C,u)<2?h+=" "+o.util.varReplace(C,u,m)+" ":h+=" var "+u+" = "+m+"; "+C+" ",o.compositeRule=v.compositeRule=p,h+=" if (!"+_+") { for (var "+l+"=startErrs"+f+"; "+l+"<errors; "+l+"++) { vErrors["+l+"].propertyName = "+a+"; }   var err =   ",o.createErrors!==!1?(h+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(b)+" , params: { propertyName: '"+c+"' } ",o.opts.messages!==!1&&(h+=" , message: 'property name \\'"+c+"\\' is invalid' "),o.opts.verbose&&(h+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+x+" "),h+=" } "):h+=" {} ",h+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!o.compositeRule&&y&&(o.async?h+=" throw new ValidationError(vErrors); ":h+=" validate.errors = vErrors; return false; "),y&&(h+=" break; "),h+=" } }"),y&&(h+="  if ("+A+" == errors) {"),h}},7096:function(n){"use strict";n.exports=function(o,m,s){var a,l,c=" ",f=o.level,u=o.dataLevel,d=o.schema[m],m=o.errSchemaPath+"/"+m,p=!o.opts.allErrors,h="data"+(u||""),f="valid"+f;if(d=="#"||d=="#/")l=o.isRoot?(a=o.async,"validate"):(a=o.root.schema.$async===!0,"root.refVal[0]");else{var C=o.resolveRef(o.baseId,d,o.isRoot);if(C===void 0){var g=o.MissingRefError.message(o.baseId,d);if(o.opts.missingRefs=="fail")o.logger.error(g),(b=b||[]).push(c),c="",o.createErrors!==!1?(c+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { ref: '"+o.util.escapeQuotes(d)+"' } ",o.opts.messages!==!1&&(c+=" , message: 'can\\'t resolve reference "+o.util.escapeQuotes(d)+"' "),o.opts.verbose&&(c+=" , schema: "+o.util.toQuotedString(d)+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),c+=" } "):c+=" {} ",m=c,c=b.pop(),!o.compositeRule&&p?o.async?c+=" throw new ValidationError(["+m+"]); ":c+=" validate.errors = ["+m+"]; return false; ":c+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",p&&(c+=" if (false) { ");else{if(o.opts.missingRefs!="ignore")throw new o.MissingRefError(o.baseId,d,g);o.logger.warn(g),p&&(c+=" if (true) { ")}}else C.inline?((m=o.util.copy(o)).level++,g="valid"+m.level,m.schema=C.schema,m.schemaPath="",m.errSchemaPath=d,c+=" "+o.validate(m).replace(/validate\.schema/g,C.code)+" ",p&&(c+=" if ("+g+") { ")):(a=C.$async===!0||o.async&&C.$async!==!1,l=C.code)}if(l){(b=b||[]).push(c),c="",o.opts.passContext?c+=" "+l+".call(this, ":c+=" "+l+"( ",c+=" "+h+", (dataPath || '')",o.errorPath!='""'&&(c+=" + "+o.errorPath);var b,d=u?"data"+(u-1||""):"parentData",m=c+=" , "+d+" , "+(u?o.dataPathArr[u]:"parentDataProperty")+", rootData)  ";if(c=b.pop(),a){if(!o.async)throw new Error("async schema referenced by sync schema");p&&(c+=" var "+f+"; "),c+=" try { await "+m+"; ",p&&(c+=" "+f+" = true; "),c+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",p&&(c+=" "+f+" = false; "),c+=" } ",p&&(c+=" if ("+f+") { ")}else c+=" if (!"+m+") { if (vErrors === null) vErrors = "+l+".errors; else vErrors = vErrors.concat("+l+".errors); errors = vErrors.length; } ",p&&(c+=" else { ")}return c}},2e3:function(n){"use strict";n.exports=function(o,m,s){var a=" ",l=o.level,C=o.dataLevel,c=o.schema[m],u=o.schemaPath+o.util.getProperty(m),d=o.errSchemaPath+"/"+m,m=!o.opts.allErrors,p="data"+(C||""),h="valid"+l,f=o.opts.$data&&c&&c.$data,C=(f&&(a+=" var schema"+l+" = "+o.util.getData(c.$data,C,o.dataPathArr)+"; "),"schema"+l);if(!f)if(c.length<o.opts.loopRequired&&o.schema.properties&&Object.keys(o.schema.properties).length){var g=[],b=c;if(b)for(var y=-1,x=b.length-1;y<x;){var A=b[y+=1],v=o.schema.properties[A];v&&(o.opts.strictKeywords?typeof v=="object"&&0<Object.keys(v).length||v===!1:o.util.schemaHasRules(v,o.RULES.all))||(g[g.length]=A)}}else g=c;if(f||g.length){var _=o.errorPath,c=f||g.length>=o.opts.loopRequired,I=o.opts.ownProperties;if(m){if(a+=" var missing"+l+"; ",c){f||(a+=" var "+C+" = validate.schema"+u+"; ");var T="' + "+(L="schema"+l+"["+(S="i"+l)+"]")+" + '";o.opts._errorDataPathProperty&&(o.errorPath=o.util.getPathExpr(_,L,o.opts.jsonPointers)),a+=" var "+h+" = true; ",f&&(a+=" if (schema"+l+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+l+")) "+h+" = false; else {"),a+=" for (var "+S+" = 0; "+S+" < "+C+".length; "+S+"++) { "+h+" = "+p+"["+C+"["+S+"]] !== undefined ",I&&(a+=" &&   Object.prototype.hasOwnProperty.call("+p+", "+C+"["+S+"]) "),a+="; if (!"+h+") break; } ",f&&(a+="  }  "),(k=k||[]).push(a+="  if (!"+h+") {   "),a="",o.createErrors!==!1?(a+=" { keyword: 'required' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(d)+" , params: { missingProperty: '"+T+"' } ",o.opts.messages!==!1&&(a+=" , message: '",o.opts._errorDataPathProperty?a+="is a required property":a+="should have required property \\'"+T+"\\'",a+="' "),o.opts.verbose&&(a+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+p+" "),a+=" } "):a+=" {} ";var E=a,a=k.pop()}else{a+=" if ( ";var w=g;if(w)for(var S=-1,P=w.length-1;S<P;)N=w[S+=1],S&&(a+=" || "),a+=" ( ( "+(q=p+(V=o.util.getProperty(N)))+" === undefined ",I&&(a+=" || ! Object.prototype.hasOwnProperty.call("+p+", '"+o.util.escapeQuotes(N)+"') "),a+=") && (missing"+l+" = "+o.util.toQuotedString(o.opts.jsonPointers?N:V)+") ) ";a+=") {  ",T="' + "+(L="missing"+l)+" + '",o.opts._errorDataPathProperty&&(o.errorPath=o.opts.jsonPointers?o.util.getPathExpr(_,L,!0):_+" + "+L),(k=k||[]).push(a),a="",o.createErrors!==!1?(a+=" { keyword: 'required' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(d)+" , params: { missingProperty: '"+T+"' } ",o.opts.messages!==!1&&(a+=" , message: '",o.opts._errorDataPathProperty?a+="is a required property":a+="should have required property \\'"+T+"\\'",a+="' "),o.opts.verbose&&(a+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+p+" "),a+=" } "):a+=" {} ";var k,E=a;a=k.pop()}!o.compositeRule&&m?o.async?a+=" throw new ValidationError(["+E+"]); ":a+=" validate.errors = ["+E+"]; return false; ":a+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } else { "}else if(c){f||(a+=" var "+C+" = validate.schema"+u+"; ");var L,T="' + "+(L="schema"+l+"["+(S="i"+l)+"]")+" + '";o.opts._errorDataPathProperty&&(o.errorPath=o.util.getPathExpr(_,L,o.opts.jsonPointers)),f&&(a+=" if ("+C+" && !Array.isArray("+C+")) {  var err =   ",o.createErrors!==!1?(a+=" { keyword: 'required' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(d)+" , params: { missingProperty: '"+T+"' } ",o.opts.messages!==!1&&(a+=" , message: '",o.opts._errorDataPathProperty?a+="is a required property":a+="should have required property \\'"+T+"\\'",a+="' "),o.opts.verbose&&(a+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+p+" "),a+=" } "):a+=" {} ",a+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+C+" !== undefined) { "),a+=" for (var "+S+" = 0; "+S+" < "+C+".length; "+S+"++) { if ("+p+"["+C+"["+S+"]] === undefined ",I&&(a+=" || ! Object.prototype.hasOwnProperty.call("+p+", "+C+"["+S+"]) "),a+=") {  var err =   ",o.createErrors!==!1?(a+=" { keyword: 'required' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(d)+" , params: { missingProperty: '"+T+"' } ",o.opts.messages!==!1&&(a+=" , message: '",o.opts._errorDataPathProperty?a+="is a required property":a+="should have required property \\'"+T+"\\'",a+="' "),o.opts.verbose&&(a+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+p+" "),a+=" } "):a+=" {} ",a+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",f&&(a+="  }  ")}else{var R=g;if(R)for(var N,F=-1,H=R.length-1;F<H;){N=R[F+=1];var V=o.util.getProperty(N),T=o.util.escapeQuotes(N),q=p+V;o.opts._errorDataPathProperty&&(o.errorPath=o.util.getPath(_,N,o.opts.jsonPointers)),a+=" if ( "+q+" === undefined ",I&&(a+=" || ! Object.prototype.hasOwnProperty.call("+p+", '"+o.util.escapeQuotes(N)+"') "),a+=") {  var err =   ",o.createErrors!==!1?(a+=" { keyword: 'required' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(d)+" , params: { missingProperty: '"+T+"' } ",o.opts.messages!==!1&&(a+=" , message: '",o.opts._errorDataPathProperty?a+="is a required property":a+="should have required property \\'"+T+"\\'",a+="' "),o.opts.verbose&&(a+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+p+" "),a+=" } "):a+=" {} ",a+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}o.errorPath=_}else m&&(a+=" if (true) {");return a}},7812:function(n){"use strict";n.exports=function(o,m,s){var a,l=" ",c=o.level,g=o.dataLevel,u=o.schema[m],d=o.schemaPath+o.util.getProperty(m),m=o.errSchemaPath+"/"+m,p=!o.opts.allErrors,h="data"+(g||""),f="valid"+c,C=o.opts.$data&&u&&u.$data,g=C?(l+=" var schema"+c+" = "+o.util.getData(u.$data,g,o.dataPathArr)+"; ","schema"+c):u;return(u||C)&&o.opts.uniqueItems!==!1?(C&&(l+=" var "+f+"; if ("+g+" === false || "+g+" === undefined) "+f+" = true; else if (typeof "+g+" != 'boolean') "+f+" = false; else { "),l+=" var i = "+h+".length , "+f+" = true , j; if (i > 1) { ",c=o.schema.items&&o.schema.items.type,g=Array.isArray(c),!c||c=="object"||c=="array"||g&&(0<=c.indexOf("object")||0<=c.indexOf("array"))?l+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+h+"[i], "+h+"[j])) { "+f+" = false; break outer; } } } ":(l=(l+=" var itemIndices = {}, item; for (;i--;) { var item = "+h+"[i]; ")+" if ("+o.util["checkDataType"+(g?"s":"")](c,"item",o.opts.strictNumbers,!0)+") continue; ",g&&(l+=` if (typeof item == 'string') item = '"' + item; `),l+=" if (typeof itemIndices[item] == 'number') { "+f+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "),l+=" } ",C&&(l+="  }  "),(a=a||[]).push(l+=" if (!"+f+") {   "),l="",o.createErrors!==!1?(l+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(m)+" , params: { i: i, j: j } ",o.opts.messages!==!1&&(l+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),o.opts.verbose&&(l=(l+=" , schema:  ")+(C?"validate.schema"+d:""+u)+"         , parentSchema: validate.schema"+o.schemaPath+" , data: "+h+" "),l+=" } "):l+=" {} ",c=l,l=a.pop(),!o.compositeRule&&p?o.async?l+=" throw new ValidationError(["+c+"]); ":l+=" validate.errors = ["+c+"]; return false; ":l+=" var err = "+c+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l+=" } ",p&&(l+=" else { ")):p&&(l+=" if (true) { "),l}},1035:function(n){"use strict";n.exports=function(o,i,s){var a="",l=o.schema.$async===!0,c=o.util.schemaHasRulesExcept(o.schema,o.RULES.all,"$ref"),u=o.self._getId(o.schema);if(o.opts.strictKeywords){var d=o.util.schemaUnknownRules(o.schema,o.RULES.keywords);if(d){if(d="unknown keyword: "+d,o.opts.strictKeywords!=="log")throw new Error(d);o.logger.warn(d)}}if(o.isTop&&(a+=" var validate = ",l&&(o.async=!0,a+="async "),a+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",u)&&(o.opts.sourceCode||o.opts.processCode)&&(a+=" /*# sourceURL="+u+" */ "),typeof o.schema=="boolean"||!c&&!o.schema.$ref)p=o.level,h=o.dataLevel,q=o.schema[i="false schema"],T=o.schemaPath+o.util.getProperty(i),E=o.errSchemaPath+"/"+i,b=!o.opts.allErrors,f="data"+(h||""),g="valid"+p,o.schema===!1?(o.isTop?b=!0:a+=" var "+g+" = false; ",(J=J||[]).push(a),a="",o.createErrors!==!1?(a+=" { keyword: 'false schema' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(E)+" , params: {} ",o.opts.messages!==!1&&(a+=" , message: 'boolean schema is false' "),o.opts.verbose&&(a+=" , schema: false , parentSchema: validate.schema"+o.schemaPath+" , data: "+f+" "),a+=" } "):a+=" {} ",N=a,a=J.pop(),!o.compositeRule&&b?o.async?a+=" throw new ValidationError(["+N+"]); ":a+=" validate.errors = ["+N+"]; return false; ":a+=" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "):o.isTop?a+=l?" return data; ":" validate.errors = null; return true; ":a+=" var "+g+" = true; ",o.isTop&&(a+=" }; return validate; ");else{if(o.isTop){var m=o.isTop,p=o.level=0,h=o.dataLevel=0,f="data";if(o.rootId=o.resolve.fullPath(o.self._getId(o.root.schema)),o.baseId=o.baseId||o.rootId,delete o.isTop,o.dataPathArr=[""],o.schema.default!==void 0&&o.opts.useDefaults&&o.opts.strictDefaults){var C="default is ignored in the schema root";if(o.opts.strictDefaults!=="log")throw new Error(C);o.logger.warn(C)}a=(a+=" var vErrors = null; ")+" var errors = 0;      if (rootData === undefined) rootData = data; "}else{if(p=o.level,f="data"+((h=o.dataLevel)||""),u&&(o.baseId=o.resolve.url(o.baseId,u)),l&&!o.async)throw new Error("async schema in sync schema");a+=" var errs_"+p+" = errors;"}var g="valid"+p,b=!o.opts.allErrors,y="",x="",A=o.schema.type,v=Array.isArray(A);if(A&&o.opts.nullable&&o.schema.nullable===!0&&(v?A.indexOf("null")==-1&&(A=A.concat("null")):A!="null"&&(A=[A,"null"],v=!0)),v&&A.length==1&&(A=A[0],v=!1),o.schema.$ref&&c){if(o.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+o.errSchemaPath+'" (see option extendRefs)');o.opts.extendRefs!==!0&&(c=!1,o.logger.warn('$ref: keywords ignored in schema at path "'+o.errSchemaPath+'"'))}if(o.schema.$comment&&o.opts.$comment&&(a+=" "+o.RULES.all.$comment.code(o,"$comment")),A){o.opts.coerceTypes&&(_=o.util.coerceToTypes(o.opts.coerceTypes,A));var _,I=o.RULES.types[A];if(_||v||I===!0||I&&!oe(I)){var T=o.schemaPath+".type",E=o.errSchemaPath+"/type",T=o.schemaPath+".type",E=o.errSchemaPath+"/type";if(a+=" if ("+o.util[v?"checkDataTypes":"checkDataType"](A,f,o.opts.strictNumbers,!0)+") { ",_){var w="dataType"+p,S="coerced"+p,P=(a+=" var "+w+" = typeof "+f+"; var "+S+" = undefined; ",o.opts.coerceTypes=="array"&&(a+=" if ("+w+" == 'object' && Array.isArray("+f+") && "+f+".length == 1) { "+f+" = "+f+"[0]; "+w+" = typeof "+f+"; if ("+o.util.checkDataType(o.schema.type,f,o.opts.strictNumbers)+") "+S+" = "+f+"; } "),a+=" if ("+S+" !== undefined) ; ",_);if(P)for(var k,L=-1,R=P.length-1;L<R;)(k=P[L+=1])=="string"?a+=" else if ("+w+" == 'number' || "+w+" == 'boolean') "+S+" = '' + "+f+"; else if ("+f+" === null) "+S+" = ''; ":k=="number"||k=="integer"?(a+=" else if ("+w+" == 'boolean' || "+f+" === null || ("+w+" == 'string' && "+f+" && "+f+" == +"+f+" ",k=="integer"&&(a+=" && !("+f+" % 1)"),a+=")) "+S+" = +"+f+"; "):k=="boolean"?a+=" else if ("+f+" === 'false' || "+f+" === 0 || "+f+" === null) "+S+" = false; else if ("+f+" === 'true' || "+f+" === 1) "+S+" = true; ":k=="null"?a+=" else if ("+f+" === '' || "+f+" === 0 || "+f+" === false) "+S+" = null; ":o.opts.coerceTypes=="array"&&k=="array"&&(a+=" else if ("+w+" == 'string' || "+w+" == 'number' || "+w+" == 'boolean' || "+f+" == null) "+S+" = ["+f+"]; ");(J=J||[]).push(a+=" else {   "),a="",o.createErrors!==!1?(a=(a+=" { keyword: 'type' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(E)+" , params: { type: '")+(v?""+A.join(","):""+A)+"' } ",o.opts.messages!==!1&&(a=(a+=" , message: 'should be ")+(v?""+A.join(","):""+A)+"' "),o.opts.verbose&&(a+=" , schema: validate.schema"+T+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+f+" "),a+=" } "):a+=" {} ";var N=a,d=(a=J.pop(),!o.compositeRule&&b?o.async?a+=" throw new ValidationError(["+N+"]); ":a+=" validate.errors = ["+N+"]; return false; ":a+=" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",h?"data"+(h-1||""):"parentData");a=a+(" } if ("+S+" !== undefined) {  ")+(" "+f+" = "+S+"; "),h||(a+="if ("+d+" !== undefined)"),a+=" "+d+"["+(h?o.dataPathArr[h]:"parentDataProperty")+"] = "+S+"; } "}else N=((J=J||[]).push(a),a="",o.createErrors!==!1?(a=(a+=" { keyword: 'type' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(E)+" , params: { type: '")+(v?""+A.join(","):""+A)+"' } ",o.opts.messages!==!1&&(a=(a+=" , message: 'should be ")+(v?""+A.join(","):""+A)+"' "),o.opts.verbose&&(a+=" , schema: validate.schema"+T+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+f+" "),a+=" } "):a+=" {} ",a),a=J.pop(),!o.compositeRule&&b?o.async?a+=" throw new ValidationError(["+N+"]); ":a+=" validate.errors = ["+N+"]; return false; ":a+=" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";a+=" } "}}if(o.schema.$ref&&!c)a+=" "+o.RULES.all.$ref.code(o,"$ref")+" ",b&&(a=(a+=" } if (errors === ")+(m?"0":"errs_"+p)+") { ",x+="}");else{var F=o.RULES;if(F){for(var H=-1,V=F.length-1;H<V;)if(oe(I=F[H+=1])){if(I.type&&(a+=" if ("+o.util.checkDataType(I.type,f,o.opts.strictNumbers)+") { "),o.opts.useDefaults){if(I.type=="object"&&o.schema.properties){var q=o.schema.properties,Q=Object.keys(q);if(Q){for(var O,B=-1,j=Q.length-1;B<j;)if(($=q[O=Q[B+=1]]).default!==void 0){var U=f+o.util.getProperty(O);if(o.compositeRule){if(o.opts.strictDefaults){if(C="default is ignored for: "+U,o.opts.strictDefaults!=="log")throw new Error(C);o.logger.warn(C)}}else a+=" if ("+U+" === undefined ",o.opts.useDefaults=="empty"&&(a+=" || "+U+" === null || "+U+" === '' "),a+=" ) "+U+" = ",o.opts.useDefaults=="shared"?a+=" "+o.useDefault($.default)+" ":a+=" "+JSON.stringify($.default)+" ",a+="; "}}}else if(I.type=="array"&&Array.isArray(o.schema.items)){var z=o.schema.items;if(z){for(var $,L=-1,Z=z.length-1;L<Z;)if(($=z[L+=1]).default!==void 0)if(U=f+"["+L+"]",o.compositeRule){if(o.opts.strictDefaults){if(C="default is ignored for: "+U,o.opts.strictDefaults!=="log")throw new Error(C);o.logger.warn(C)}}else a+=" if ("+U+" === undefined ",o.opts.useDefaults=="empty"&&(a+=" || "+U+" === null || "+U+" === '' "),a+=" ) "+U+" = ",o.opts.useDefaults=="shared"?a+=" "+o.useDefault($.default)+" ":a+=" "+JSON.stringify($.default)+" ",a+="; "}}}var J,ie=I.rules;if(ie)for(var ne,le=-1,ee=ie.length-1;le<ee;)te(ne=ie[le+=1])&&(ne=ne.code(o,ne.keyword,I.type))&&(a+=" "+ne+" ",b)&&(y+="}");b&&(a+=" "+y+" ",y=""),I.type&&(a+=" } ",A)&&A===I.type&&!_&&(a+=" else { ",T=o.schemaPath+".type",E=o.errSchemaPath+"/type",(J=J||[]).push(a),a="",o.createErrors!==!1?(a=(a+=" { keyword: 'type' , dataPath: (dataPath || '') + "+o.errorPath+" , schemaPath: "+o.util.toQuotedString(E)+" , params: { type: '")+(v?""+A.join(","):""+A)+"' } ",o.opts.messages!==!1&&(a=(a+=" , message: 'should be ")+(v?""+A.join(","):""+A)+"' "),o.opts.verbose&&(a+=" , schema: validate.schema"+T+" , parentSchema: validate.schema"+o.schemaPath+" , data: "+f+" "),a+=" } "):a+=" {} ",N=a,a=J.pop(),!o.compositeRule&&b?o.async?a+=" throw new ValidationError(["+N+"]); ":a+=" validate.errors = ["+N+"]; return false; ":a+=" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",a+=" } "),b&&(a=(a+=" if (errors === ")+(m?"0":"errs_"+p)+") { ",x+="}")}}}b&&(a+=" "+x+" "),m?a=a+(l?" if (errors === 0) return data;            else throw new ValidationError(vErrors); ":" validate.errors = vErrors;  return errors === 0;       ")+" }; return validate;":a+=" var "+g+" = errors === errs_"+p+";"}return a;function oe(X){for(var W=X.rules,K=0;K<W.length;K++)if(te(W[K]))return 1}function te(X){return o.schema[X.keyword]!==void 0||X.implements&&function(W){for(var K=W.implements,re=0;re<K.length;re++)if(o.schema[K[re]]!==void 0)return 1}(X)}}},413:function(n,o,i){"use strict";var s=/^[a-z_$][a-z0-9_$-]*$/i,a=i(8050),l=i(9407);function c(u,d){c.errors=null;var m=this._validateKeyword=this._validateKeyword||this.compile(l,!0);if(m(u))return!0;if(c.errors=m.errors,d)throw new Error("custom keyword definition is invalid: "+this.errorsText(m.errors));return!1}n.exports={add:function(u,d){var m=this.RULES;if(m.keywords[u])throw new Error("Keyword "+u+" is already defined");if(!s.test(u))throw new Error("Keyword "+u+" is not a valid identifier");if(d){this.validateKeyword(d,!0);var p=d.type;if(Array.isArray(p))for(var h=0;h<p.length;h++)C(u,p[h],d);else C(u,p,d);var f=d.metaSchema;f&&(d.$data&&this._opts.$data&&(f={anyOf:[f,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),d.validateSchema=this.compile(f,!0))}function C(g,b,y){for(var x,A=0;A<m.length;A++){var v=m[A];if(v.type==b){x=v;break}}x||m.push(x={type:b,rules:[]}),y={keyword:g,definition:y,custom:!0,code:a,implements:y.implements},x.rules.push(y),m.custom[g]=y}return m.keywords[u]=m.all[u]=!0,this},get:function(u){var d=this.RULES.custom[u];return d?d.definition:this.RULES.keywords[u]||!1},remove:function(u){var d=this.RULES;delete d.keywords[u],delete d.all[u],delete d.custom[u];for(var m=0;m<d.length;m++)for(var p=d[m].rules,h=0;h<p.length;h++)if(p[h].keyword==u){p.splice(h,1);break}return this},validate:c}},5215:function(n){"use strict";n.exports=function o(i,s){if(i===s)return!0;if(i&&s&&typeof i=="object"&&typeof s=="object"){if(i.constructor!==s.constructor)return!1;var a,l,c;if(Array.isArray(i)){if((a=i.length)!=s.length)return!1;for(l=a;l--!=0;)if(!o(i[l],s[l]))return!1}else{if(i.constructor===RegExp)return i.source===s.source&&i.flags===s.flags;if(i.valueOf!==Object.prototype.valueOf)return i.valueOf()===s.valueOf();if(i.toString!==Object.prototype.toString)return i.toString()===s.toString();if((a=(c=Object.keys(i)).length)!==Object.keys(s).length)return!1;for(l=a;l--!=0;)if(!Object.prototype.hasOwnProperty.call(s,c[l]))return!1;for(l=a;l--!=0;){var u=c[l];if(!o(i[u],s[u]))return!1}}return!0}return i!=i&&s!=s}},9306:function(n){"use strict";n.exports=function(o,i){var s,a=typeof(i=typeof(i=i||{})=="function"?{cmp:i}:i).cycles=="boolean"&&i.cycles,l=i.cmp&&(s=i.cmp,function(u){return function(d,m){return d={key:d,value:u[d]},m={key:m,value:u[m]},s(d,m)}}),c=[];return function u(d){if((d=d&&d.toJSON&&typeof d.toJSON=="function"?d.toJSON():d)!==void 0){if(typeof d=="number")return isFinite(d)?""+d:"null";if(typeof d!="object")return JSON.stringify(d);if(Array.isArray(d)){for(h="[",f=0;f<d.length;f++)f&&(h+=","),h+=u(d[f])||"null";return h+"]"}if(d===null)return"null";if(c.indexOf(d)!==-1){if(a)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}for(var m=c.push(d)-1,p=Object.keys(d).sort(l&&l(d)),h="",f=0;f<p.length;f++){var C=p[f],g=u(d[C]);g&&(h&&(h+=","),h+=JSON.stringify(C)+":"+g)}return c.splice(m,1),"{"+h+"}"}}(o)}},1342:function(n){n.exports=function o(p,h){"use strict";function a(A){return o.insensitive&&(""+A).toLowerCase()||""+A}var l,c,b=/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,g=/(^[ ]*|[ ]*$)/g,u=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=/^0x[0-9a-f]+$/i,m=/^0/,p=a(p).replace(g,"")||"",h=a(h).replace(g,"")||"",f=p.replace(b,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),C=h.replace(b,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=parseInt(p.match(d),16)||f.length!==1&&p.match(u)&&Date.parse(p),b=parseInt(h.match(d),16)||g&&h.match(u)&&Date.parse(h)||null;if(b){if(g<b)return-1;if(b<g)return 1}for(var y=0,x=Math.max(f.length,C.length);y<x;y++){if(l=!(f[y]||"").match(m)&&parseFloat(f[y])||f[y]||0,c=!(C[y]||"").match(m)&&parseFloat(C[y])||C[y]||0,isNaN(l)!==isNaN(c))return isNaN(l)?1:-1;if(typeof l!=typeof c&&(l+="",c+=""),l<c)return-1;if(c<l)return 1}return 0}},9151:function(n,o){(function(i){"use strict";function s(O){return O!==null&&Object.prototype.toString.call(O)==="[object Array]"}function a(O){return O!==null&&Object.prototype.toString.call(O)==="[object Object]"}function l(O,B){if(O!==B){if(Object.prototype.toString.call(O)!==Object.prototype.toString.call(B))return!1;if(s(O)===!0){if(O.length!==B.length)return!1;for(var j=0;j<O.length;j++)if(l(O[j],B[j])===!1)return!1}else{if(a(O)!==!0)return!1;var U,z,$={};for(U in O)if(hasOwnProperty.call(O,U)){if(l(O[U],B[U])===!1)return!1;$[U]=!0}for(z in B)if(hasOwnProperty.call(B,z)&&$[z]!==!0)return!1}}return!0}function c(O){if(O===""||O===!1||O===null||s(O)&&O.length===0)return!0;if(a(O)){for(var B in O)if(O.hasOwnProperty(B))return!1;return!0}return!1}var u=typeof String.prototype.trimLeft=="function"?function(O){return O.trimLeft()}:function(O){return O.match(/^\s*(.*)/)[1]},d={0:"number",1:"any",2:"string",3:"array",4:"object",5:"boolean",6:"expression",7:"null",8:"Array<number>",9:"Array<string>"},m="UnquotedIdentifier",p="QuotedIdentifier",h="Rbracket",f="Rparen",C="Comma",g="Colon",b="Rbrace",y="Number",x="Current",A="Expref",v="Pipe",_="Flatten",I="Star",T="Filter",E="Lbrace",w="Lbracket",S="Lparen",P="Literal",k={".":"Dot","*":I,",":C,":":g,"{":E,"}":b,"]":h,"(":S,")":f,"@":x},L={"<":!0,">":!0,"=":!0,"!":!0},R={" ":!0,"	":!0,"\n":!0};function N(O){return"0"<=O&&O<="9"||O==="-"}function F(){}F.prototype={tokenize:function(O){var B,j,U=[];for(this._current=0;this._current<O.length;)if("a"<=($=O[this._current])&&$<="z"||"A"<=$&&$<="Z"||$==="_")z=this._current,B=this._consumeUnquotedIdentifier(O),U.push({type:m,value:B,start:z});else if(k[O[this._current]]!==void 0)U.push({type:k[O[this._current]],value:O[this._current],start:this._current}),this._current++;else if(N(O[this._current]))j=this._consumeNumber(O),U.push(j);else if(O[this._current]==="[")j=this._consumeLBracket(O),U.push(j);else if(O[this._current]==='"')z=this._current,B=this._consumeQuotedIdentifier(O),U.push({type:p,value:B,start:z});else if(O[this._current]==="'")z=this._current,B=this._consumeRawStringLiteral(O),U.push({type:P,value:B,start:z});else if(O[this._current]==="`"){var z=this._current,$=this._consumeLiteral(O);U.push({type:P,value:$,start:z})}else if(L[O[this._current]]!==void 0)U.push(this._consumeOperator(O));else if(R[O[this._current]]!==void 0)this._current++;else if(O[this._current]==="&")z=this._current,this._current++,O[this._current]==="&"?(this._current++,U.push({type:"And",value:"&&",start:z})):U.push({type:A,value:"&",start:z});else{if(O[this._current]!=="|")throw($=new Error("Unknown character:"+O[this._current])).name="LexerError",$;z=this._current,this._current++,O[this._current]==="|"?(this._current++,U.push({type:"Or",value:"||",start:z})):U.push({type:v,value:"|",start:z})}return U},_consumeUnquotedIdentifier:function(O){var B,j=this._current;for(this._current++;this._current<O.length&&("a"<=(B=O[this._current])&&B<="z"||"A"<=B&&B<="Z"||"0"<=B&&B<="9"||B==="_");)this._current++;return O.slice(j,this._current)},_consumeQuotedIdentifier:function(O){for(var B=this._current,j=(this._current++,O.length);O[this._current]!=='"'&&this._current<j;){var U=this._current;O[U]!=="\\"||O[U+1]!=="\\"&&O[U+1]!=='"'?U++:U+=2,this._current=U}return this._current++,JSON.parse(O.slice(B,this._current))},_consumeRawStringLiteral:function(O){for(var B=this._current,j=(this._current++,O.length);O[this._current]!=="'"&&this._current<j;){var U=this._current;O[U]!=="\\"||O[U+1]!=="\\"&&O[U+1]!=="'"?U++:U+=2,this._current=U}return this._current++,O.slice(B+1,this._current-1).replace("\\'","'")},_consumeNumber:function(O){for(var B=this._current,j=(this._current++,O.length);N(O[this._current])&&this._current<j;)this._current++;var U=parseInt(O.slice(B,this._current));return{type:y,value:U,start:B}},_consumeLBracket:function(O){var B=this._current;return this._current++,O[this._current]==="?"?(this._current++,{type:T,value:"[?",start:B}):O[this._current]==="]"?(this._current++,{type:_,value:"[]",start:B}):{type:w,value:"[",start:B}},_consumeOperator:function(O){var B=this._current,j=O[B];return this._current++,j==="!"?O[this._current]==="="?(this._current++,{type:"NE",value:"!=",start:B}):{type:"Not",value:"!",start:B}:j==="<"?O[this._current]==="="?(this._current++,{type:"LTE",value:"<=",start:B}):{type:"LT",value:"<",start:B}:j===">"?O[this._current]==="="?(this._current++,{type:"GTE",value:">=",start:B}):{type:"GT",value:">",start:B}:j==="="&&O[this._current]==="="?(this._current++,{type:"EQ",value:"==",start:B}):void 0},_consumeLiteral:function(O){this._current++;for(var B=this._current,j=O.length;O[this._current]!=="`"&&this._current<j;){var U=this._current;O[U]!=="\\"||O[U+1]!=="\\"&&O[U+1]!=="`"?U++:U+=2,this._current=U}return B=(B=u(O.slice(B,this._current))).replace("\\`","`"),B=this._looksLikeJSON(B)?JSON.parse(B):JSON.parse('"'+B+'"'),this._current++,B},_looksLikeJSON:function(O){if(O==="")return!1;if(0<='[{"'.indexOf(O[0])||0<=["true","false","null"].indexOf(O))return!0;if(!(0<="-0123456789".indexOf(O[0])))return!1;try{return JSON.parse(O),!0}catch{return!1}}};var H={};function V(){}function q(O){this.runtime=O}function Q(O){this._interpreter=O,this.functionTable={abs:{_func:this._functionAbs,_signature:[{types:[0]}]},avg:{_func:this._functionAvg,_signature:[{types:[8]}]},ceil:{_func:this._functionCeil,_signature:[{types:[0]}]},contains:{_func:this._functionContains,_signature:[{types:[2,3]},{types:[1]}]},ends_with:{_func:this._functionEndsWith,_signature:[{types:[2]},{types:[2]}]},floor:{_func:this._functionFloor,_signature:[{types:[0]}]},length:{_func:this._functionLength,_signature:[{types:[2,3,4]}]},map:{_func:this._functionMap,_signature:[{types:[6]},{types:[3]}]},max:{_func:this._functionMax,_signature:[{types:[8,9]}]},merge:{_func:this._functionMerge,_signature:[{types:[4],variadic:!0}]},max_by:{_func:this._functionMaxBy,_signature:[{types:[3]},{types:[6]}]},sum:{_func:this._functionSum,_signature:[{types:[8]}]},starts_with:{_func:this._functionStartsWith,_signature:[{types:[2]},{types:[2]}]},min:{_func:this._functionMin,_signature:[{types:[8,9]}]},min_by:{_func:this._functionMinBy,_signature:[{types:[3]},{types:[6]}]},type:{_func:this._functionType,_signature:[{types:[1]}]},keys:{_func:this._functionKeys,_signature:[{types:[4]}]},values:{_func:this._functionValues,_signature:[{types:[4]}]},sort:{_func:this._functionSort,_signature:[{types:[9,8]}]},sort_by:{_func:this._functionSortBy,_signature:[{types:[3]},{types:[6]}]},join:{_func:this._functionJoin,_signature:[{types:[2]},{types:[9]}]},reverse:{_func:this._functionReverse,_signature:[{types:[2,3]}]},to_array:{_func:this._functionToArray,_signature:[{types:[1]}]},to_string:{_func:this._functionToString,_signature:[{types:[1]}]},to_number:{_func:this._functionToNumber,_signature:[{types:[1]}]},not_null:{_func:this._functionNotNull,_signature:[{types:[1],variadic:!0}]}}}H.EOF=0,H[m]=0,H[p]=0,H[h]=0,H[f]=0,H[C]=0,H[b]=0,H[y]=0,H[x]=0,H[A]=0,H.Pipe=1,H.Or=2,H.And=3,H.EQ=5,H.GT=5,H.LT=5,H.GTE=5,H.LTE=5,H.NE=5,H[_]=9,H.Star=20,H[T]=21,H.Dot=40,H.Not=45,H[E]=50,H[w]=55,H[S]=60,V.prototype={parse:function(j){this._loadTokens(j),this.index=0;var B,j=this.expression(0);if(this._lookahead(0)!=="EOF")throw B=this._lookaheadToken(0),(B=new Error("Unexpected token type: "+B.type+", value: "+B.value)).name="ParserError",B;return j},_loadTokens:function(O){var B=new F().tokenize(O);B.push({type:"EOF",value:"",start:O.length}),this.tokens=B},expression:function(O){for(var B=this._lookaheadToken(0),j=(this._advance(),this.nud(B)),U=this._lookahead(0);O<H[U];)this._advance(),j=this.led(U,j),U=this._lookahead(0);return j},_lookahead:function(O){return this.tokens[this.index+O].type},_lookaheadToken:function(O){return this.tokens[this.index+O]},_advance:function(){this.index++},nud:function(O){var B,j;switch(O.type){case P:return{type:"Literal",value:O.value};case m:return{type:"Field",name:O.value};case p:var U={type:"Field",name:O.value};if(this._lookahead(0)===S)throw new Error("Quoted identifier not allowed for function names.");return U;case"Not":return{type:"NotExpression",children:[B=this.expression(H.Not)]};case I:return B=null,{type:"ValueProjection",children:[{type:"Identity"},B=this._lookahead(0)===h?{type:"Identity"}:this._parseProjectionRHS(H.Star)]};case T:return this.led(O.type,{type:"Identity"});case E:return this._parseMultiselectHash();case _:return{type:"Projection",children:[{type:_,children:[{type:"Identity"}]},B=this._parseProjectionRHS(H.Flatten)]};case w:return this._lookahead(0)===y||this._lookahead(0)===g?(B=this._parseIndexExpression(),this._projectIfSlice({type:"Identity"},B)):this._lookahead(0)===I&&this._lookahead(1)===h?(this._advance(),this._advance(),{type:"Projection",children:[{type:"Identity"},B=this._parseProjectionRHS(H.Star)]}):this._parseMultiselectList();case x:return{type:x};case A:return{type:"ExpressionReference",children:[j=this.expression(H.Expref)]};case S:for(var z=[];this._lookahead(0)!==f;)this._lookahead(0)===x?(j={type:x},this._advance()):j=this.expression(0),z.push(j);return this._match(f),z[0];default:this._errorToken(O)}},led:function(O,B){var j;switch(O){case"Dot":var U=H.Dot;return this._lookahead(0)!==I?{type:"Subexpression",children:[B,j=this._parseDotRHS(U)]}:(this._advance(),{type:"ValueProjection",children:[B,j=this._parseProjectionRHS(U)]});case v:return j=this.expression(H.Pipe),{type:v,children:[B,j]};case"Or":return{type:"OrExpression",children:[B,j=this.expression(H.Or)]};case"And":return{type:"AndExpression",children:[B,j=this.expression(H.And)]};case S:for(var z,U=B.name,$=[];this._lookahead(0)!==f;)this._lookahead(0)===x?(z={type:x},this._advance()):z=this.expression(0),this._lookahead(0)===C&&this._match(C),$.push(z);return this._match(f),{type:"Function",name:U,children:$};case T:return U=this.expression(0),this._match(h),{type:"FilterProjection",children:[B,j=this._lookahead(0)===_?{type:"Identity"}:this._parseProjectionRHS(H.Filter),U]};case _:return{type:"Projection",children:[{type:_,children:[B]},this._parseProjectionRHS(H.Flatten)]};case"EQ":case"NE":case"GT":case"GTE":case"LT":case"LTE":return this._parseComparator(B,O);case w:return U=this._lookaheadToken(0),U.type===y||U.type===g?(j=this._parseIndexExpression(),this._projectIfSlice(B,j)):(this._match(I),this._match(h),{type:"Projection",children:[B,j=this._parseProjectionRHS(H.Star)]});default:this._errorToken(this._lookaheadToken(0))}},_match:function(O){var B;if(this._lookahead(0)!==O)throw B=this._lookaheadToken(0),(O=new Error("Expected "+O+", got: "+B.type)).name="ParserError",O;this._advance()},_errorToken:function(O){throw O=new Error("Invalid token ("+O.type+'): "'+O.value+'"'),O.name="ParserError",O},_parseIndexExpression:function(){var O;return this._lookahead(0)===g||this._lookahead(1)===g?this._parseSliceExpression():(O={type:"Index",value:this._lookaheadToken(0).value},this._advance(),this._match(h),O)},_projectIfSlice:function(O,B){return O={type:"IndexExpression",children:[O,B]},B.type==="Slice"?{type:"Projection",children:[O,this._parseProjectionRHS(H.Star)]}:O},_parseSliceExpression:function(){for(var O,B=[null,null,null],j=0,U=this._lookahead(0);U!==h&&j<3;){if(U===g)j++;else{if(U!==y)throw O=this._lookahead(0),(O=new Error("Syntax error, unexpected token: "+O.value+"("+O.type+")")).name="Parsererror",O;B[j]=this._lookaheadToken(0).value}this._advance(),U=this._lookahead(0)}return this._match(h),{type:"Slice",children:B}},_parseComparator:function(O,B){return{type:"Comparator",name:B,children:[O,this.expression(H[B])]}},_parseDotRHS:function(O){var B=this._lookahead(0);return 0<=[m,p,I].indexOf(B)?this.expression(O):B===w?(this._match(w),this._parseMultiselectList()):B===E?(this._match(E),this._parseMultiselectHash()):void 0},_parseProjectionRHS:function(O){var B,j;if(H[this._lookahead(0)]<10)B={type:"Identity"};else if(this._lookahead(0)===w)B=this.expression(O);else if(this._lookahead(0)===T)B=this.expression(O);else{if(this._lookahead(0)!=="Dot")throw j=this._lookaheadToken(0),(j=new Error("Sytanx error, unexpected token: "+j.value+"("+j.type+")")).name="ParserError",j;this._match("Dot"),B=this._parseDotRHS(O)}return B},_parseMultiselectList:function(){for(var O=[];this._lookahead(0)!==h;){var B=this.expression(0);if(O.push(B),this._lookahead(0)===C&&(this._match(C),this._lookahead(0)===h))throw new Error("Unexpected token Rbracket")}return this._match(h),{type:"MultiSelectList",children:O}},_parseMultiselectHash:function(){for(var O,B,j=[],U=[m,p];;){if(O=this._lookaheadToken(0),U.indexOf(O.type)<0)throw new Error("Expecting an identifier token, got: "+O.type);if(O=O.value,this._advance(),this._match(g),B=this.expression(0),j.push({type:"KeyValuePair",name:O,value:B}),this._lookahead(0)===C)this._match(C);else if(this._lookahead(0)===b){this._match(b);break}}return{type:"MultiSelectHash",children:j}}},q.prototype={search:function(O,B){return this.visit(O,B)},visit:function(O,B){var j,U,z,$,Z,J;switch(O.type){case"Field":return B!==null&&a(B)?(ie=B[O.name])===void 0?null:ie:null;case"Subexpression":for(oe=this.visit(O.children[0],B),K=1;K<O.children.length;K++)if((oe=this.visit(O.children[1],oe))===null)return null;return oe;case"IndexExpression":return Z=this.visit(O.children[0],B),this.visit(O.children[1],Z);case"Index":return s(B)?(oe=B[ie=(ie=O.value)<0?B.length+ie:ie])===void 0?null:oe:null;case"Slice":if(!s(B))return null;var ie=O.children.slice(0),ie=this.computeSliceParams(B.length,ie),ne=ie[0],le=ie[1],ee=ie[2],oe=[];if(0<ee)for(K=ne;K<le;K+=ee)oe.push(B[K]);else for(K=ne;le<K;K+=ee)oe.push(B[K]);return oe;case"Projection":var te=this.visit(O.children[0],B);if(!s(te))return null;for(X=[],K=0;K<te.length;K++)(U=this.visit(O.children[1],te[K]))!==null&&X.push(U);return X;case"ValueProjection":if(!a(te=this.visit(O.children[0],B)))return null;for(var X=[],W=function(ge){for(var Se=Object.keys(ge),Ee=[],Fe=0;Fe<Se.length;Fe++)Ee.push(ge[Se[Fe]]);return Ee}(te),K=0;K<W.length;K++)(U=this.visit(O.children[1],W[K]))!==null&&X.push(U);return X;case"FilterProjection":if(!s(te=this.visit(O.children[0],B)))return null;var re=[],se=[];for(K=0;K<te.length;K++)c(j=this.visit(O.children[2],te[K]))||re.push(te[K]);for(var me=0;me<re.length;me++)(U=this.visit(O.children[1],re[me]))!==null&&se.push(U);return se;case"Comparator":switch(z=this.visit(O.children[0],B),$=this.visit(O.children[1],B),O.name){case"EQ":oe=l(z,$);break;case"NE":oe=!l(z,$);break;case"GT":oe=$<z;break;case"GTE":oe=$<=z;break;case"LT":oe=z<$;break;case"LTE":oe=z<=$;break;default:throw new Error("Unknown comparator: "+O.name)}return oe;case _:var Y=this.visit(O.children[0],B);if(!s(Y))return null;var ae=[];for(K=0;K<Y.length;K++)s(U=Y[K])?ae.push.apply(ae,U):ae.push(U);return ae;case"Identity":return B;case"MultiSelectList":if(B===null)return null;for(X=[],K=0;K<O.children.length;K++)X.push(this.visit(O.children[K],B));return X;case"MultiSelectHash":if(B===null)return null;for(X={},K=0;K<O.children.length;K++)X[(J=O.children[K]).name]=this.visit(J.value,B);return X;case"OrExpression":return j=c(j=this.visit(O.children[0],B))?this.visit(O.children[1],B):j;case"AndExpression":return c(z=this.visit(O.children[0],B))===!0?z:this.visit(O.children[1],B);case"NotExpression":return c(z=this.visit(O.children[0],B));case"Literal":return O.value;case v:return Z=this.visit(O.children[0],B),this.visit(O.children[1],Z);case x:return B;case"Function":var ve=[];for(K=0;K<O.children.length;K++)ve.push(this.visit(O.children[K],B));return this.runtime.callFunction(O.name,ve);case"ExpressionReference":return ie=O.children[0],ie.jmespathType=A,ie;default:throw new Error("Unknown node type: "+O.type)}},computeSliceParams:function(O,j){var $=j[0],Z=j[1],j=j[2],U=[null,null,null];if(j===null)j=1;else if(j===0)throw(z=new Error("Invalid slice, step cannot be 0")).name="RuntimeError",z;var z=j<0,$=$===null?z?O-1:0:this.capSliceRange(O,$,j),Z=Z===null?z?-1:O:this.capSliceRange(O,Z,j);return U[0]=$,U[1]=Z,U[2]=j,U},capSliceRange:function(O,B,j){return B<0?(B+=O)<0&&(B=j<0?-1:0):O<=B&&(B=j<0?O-1:O),B}},Q.prototype={callFunction:function(O,B){var j=this.functionTable[O];if(j===void 0)throw new Error("Unknown function: "+O+"()");return this._validateArgs(O,B,j._signature),j._func.call(this,B)},_validateArgs:function(O,B,j){var U;if(j[j.length-1].variadic){if(B.length<j.length)throw U=j.length===1?" argument":" arguments",new Error("ArgumentError: "+O+"() takes at least"+j.length+U+" but received "+B.length)}else if(B.length!==j.length)throw U=j.length===1?" argument":" arguments",new Error("ArgumentError: "+O+"() takes "+j.length+U+" but received "+B.length);for(var z=0;z<j.length;z++){for(var $,Z=!1,J=j[z].types,ie=this._getTypeName(B[z]),ne=0;ne<J.length;ne++)if(this._typeMatches(ie,J[ne],B[z])){Z=!0;break}if(!Z)throw $=J.map(function(le){return d[le]}).join(","),new Error("TypeError: "+O+"() expected argument "+(z+1)+" to be type "+$+" but received type "+d[ie]+" instead.")}},_typeMatches:function(O,B,j){if(B===1)return!0;if(B!==9&&B!==8&&B!==3)return O===B;if(B===3)return O===3;if(O===3){var U;B===8?U=0:B===9&&(U=2);for(var z=0;z<j.length;z++)if(!this._typeMatches(this._getTypeName(j[z]),U,j[z]))return!1;return!0}},_getTypeName:function(O){switch(Object.prototype.toString.call(O)){case"[object String]":return 2;case"[object Number]":return 0;case"[object Array]":return 3;case"[object Boolean]":return 5;case"[object Null]":return 7;case"[object Object]":return O.jmespathType===A?6:4}},_functionStartsWith:function(O){return O[0].lastIndexOf(O[1])===0},_functionEndsWith:function(j){var B=j[0],j=j[1];return B.indexOf(j,B.length-j.length)!==-1},_functionReverse:function(O){var B;if(this._getTypeName(O[0])!==2)return(B=O[0].slice(0)).reverse(),B;for(var j=O[0],U="",z=j.length-1;0<=z;z--)U+=j[z];return U},_functionAbs:function(O){return Math.abs(O[0])},_functionCeil:function(O){return Math.ceil(O[0])},_functionAvg:function(O){for(var B=0,j=O[0],U=0;U<j.length;U++)B+=j[U];return B/j.length},_functionContains:function(O){return 0<=O[0].indexOf(O[1])},_functionFloor:function(O){return Math.floor(O[0])},_functionLength:function(O){return(a(O[0])?Object.keys(O[0]):O[0]).length},_functionMap:function(O){for(var B=[],j=this._interpreter,U=O[0],z=O[1],$=0;$<z.length;$++)B.push(j.visit(U,z[$]));return B},_functionMerge:function(O){for(var B={},j=0;j<O.length;j++){var U,z=O[j];for(U in z)B[U]=z[U]}return B},_functionMax:function(O){if(0<O[0].length){if(this._getTypeName(O[0][0])===0)return Math.max.apply(Math,O[0]);for(var B=O[0],j=B[0],U=1;U<B.length;U++)j.localeCompare(B[U])<0&&(j=B[U]);return j}return null},_functionMin:function(O){if(0<O[0].length){if(this._getTypeName(O[0][0])===0)return Math.min.apply(Math,O[0]);for(var B=O[0],j=B[0],U=1;U<B.length;U++)B[U].localeCompare(j)<0&&(j=B[U]);return j}return null},_functionSum:function(O){for(var B=0,j=O[0],U=0;U<j.length;U++)B+=j[U];return B},_functionType:function(O){switch(this._getTypeName(O[0])){case 0:return"number";case 2:return"string";case 3:return"array";case 4:return"object";case 5:return"boolean";case 6:return"expref";case 7:return"null"}},_functionKeys:function(O){return Object.keys(O[0])},_functionValues:function(O){for(var B=O[0],j=Object.keys(B),U=[],z=0;z<j.length;z++)U.push(B[j[z]]);return U},_functionJoin:function(O){var B=O[0];return O[1].join(B)},_functionToArray:function(O){return this._getTypeName(O[0])===3?O[0]:[O[0]]},_functionToString:function(O){return this._getTypeName(O[0])===2?O[0]:JSON.stringify(O[0])},_functionToNumber:function(O){var B=this._getTypeName(O[0]);return B===0?O[0]:B!==2||(B=+O[0],isNaN(B))?null:B},_functionNotNull:function(O){for(var B=0;B<O.length;B++)if(this._getTypeName(O[B])!==7)return O[B];return null},_functionSort:function(O){return O=O[0].slice(0),O.sort(),O},_functionSortBy:function(O){var B=O[0].slice(0);if(B.length!==0){var j=this._interpreter,U=O[1],z=this._getTypeName(j.visit(U,B[0]));if([0,2].indexOf(z)<0)throw new Error("TypeError");for(var $=this,Z=[],J=0;J<B.length;J++)Z.push([J,B[J]]);Z.sort(function(ne,le){var ee=j.visit(U,ne[1]),oe=j.visit(U,le[1]);if($._getTypeName(ee)!==z)throw new Error("TypeError: expected "+z+", received "+$._getTypeName(ee));if($._getTypeName(oe)!==z)throw new Error("TypeError: expected "+z+", received "+$._getTypeName(oe));return oe<ee?1:ee<oe?-1:ne[0]-le[0]});for(var ie=0;ie<Z.length;ie++)B[ie]=Z[ie][1]}return B},_functionMaxBy:function(O){for(var B,j,U=O[1],z=O[0],$=this.createKeyFunction(U,[0,2]),Z=-1/0,J=0;J<z.length;J++)Z<(j=$(z[J]))&&(Z=j,B=z[J]);return B},_functionMinBy:function(O){for(var B,j,U=O[1],z=O[0],$=this.createKeyFunction(U,[0,2]),Z=1/0,J=0;J<z.length;J++)(j=$(z[J]))<Z&&(Z=j,B=z[J]);return B},createKeyFunction:function(O,B){var j=this,U=this._interpreter;return function(Z){var $,Z=U.visit(O,Z);if(B.indexOf(j._getTypeName(Z))<0)throw $="TypeError: expected one of "+B+", received "+j._getTypeName(Z),new Error($);return Z}}},i.tokenize=function(O){return new F().tokenize(O)},i.compile=function(O){return new V().parse(O)},i.search=function(O,B){var j=new V,U=new q(z=new Q),z=(z._interpreter=U,j.parse(B));return U.search(z,O)},i.strictDeepEqual=l})(o)},4316:function(n){"use strict";var o=n.exports=function(s,a,l){typeof a=="function"&&(l=a,a={}),function c(u,d,m,p,h,f,C,g,b,y){if(p&&typeof p=="object"&&!Array.isArray(p)){for(var x in d(p,h,f,C,g,b,y),p){var A=p[x];if(Array.isArray(A)){if(x in o.arrayKeywords)for(var v=0;v<A.length;v++)c(u,d,m,A[v],h+"/"+x+"/"+v,f,h,x,p,v)}else if(x in o.propsKeywords){if(A&&typeof A=="object")for(var _ in A)c(u,d,m,A[_],h+"/"+x+"/"+i(_),f,h,x,p,_)}else(x in o.keywords||u.allKeys&&!(x in o.skipKeywords))&&c(u,d,m,A,h+"/"+x,f,h,x,p)}m(p,h,f,C,g,b,y)}}(a,typeof(l=a.cb||l)=="function"?l:l.pre||function(){},l.post||function(){},s,"",s)};function i(s){return s.replace(/~/g,"~0").replace(/\//g,"~1")}o.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},o.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},o.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},o.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},3094:function(n,o){"use strict";var i={b:"\b",f:"\f",n:`
`,r:"\r",t:"	",'"':'"',"/":"/","\\":"\\"},s=97,a=(o.parse=function(y,x,A){var v={},_=0,I=0,T=0,E=A&&A.bigint&&typeof BigInt<"u";return{data:w("",!0),pointers:v};function w(B,j){S(),F(B,"value");var U,z=L();switch(z){case"t":k("rue"),U=!0;break;case"f":k("alse"),U=!1;break;case"n":k("ull"),U=null;break;case'"':U=P();break;case"[":U=function($){S();var Z=[],J=0;if(L()!="]")for(R();;){Z.push(w($+"/"+J)),S();var ie=L();if(ie=="]")break;ie!=","&&Q(),S(),J++}return Z}(B);break;case"{":U=function($){S();var Z={};if(L()!="}")for(R();;){var ne=V(),J=(L()!='"'&&Q(),P()),ie=$+"/"+b(J),ne=(H(ie,"key",ne),F(ie,"keyEnd"),S(),L()!=":"&&Q(),S(),Z[J]=w(ie),S(),L());if(ne=="}")break;ne!=","&&Q(),S()}return Z}(B);break;default:R(),0<="-0123456789".indexOf(z)?U=function(){var $="",Z=!0;y[T]=="-"&&($+=L()),$+=(y[T]=="0"?L:N)(),y[T]=="."&&($+=L()+N(),Z=!1),y[T]!="e"&&y[T]!="E"||($+=L(),y[T]!="+"&&y[T]!="-"||($+=L()),$+=N(),Z=!1);var J=+$;return E&&Z&&(J>Number.MAX_SAFE_INTEGER||J<Number.MIN_SAFE_INTEGER)?BigInt($):J}():q()}return F(B,"valueEnd"),S(),j&&T<y.length&&q(),U}function S(){e:for(;T<y.length;){switch(y[T]){case" ":I++;break;case"	":I+=4;break;case"\r":I=0;break;case`
`:I=0,_++;break;default:break e}T++}}function P(){for(var B,j="";(B=L())!='"';)B=="\\"?(B=L())in i?j+=i[B]:B=="u"?j+=function(){for(var U=4,z=0;U--;){z<<=4;var $=L().toLowerCase();"a"<=$&&$<="f"?z+=$.charCodeAt()-s+10:"0"<=$&&$<="9"?z+=+$:Q()}return String.fromCharCode(z)}():Q():j+=B;return j}function k(B){for(var j=0;j<B.length;j++)L()!==B[j]&&Q()}function L(){O();var B=y[T];return T++,I++,B}function R(){T--,I--}function N(){for(var B="";"0"<=y[T]&&y[T]<="9";)B+=L();if(B.length)return B;O(),q()}function F(B,j){H(B,j,V())}function H(B,j,U){v[B]=v[B]||{},v[B][j]=U}function V(){return{line:_,column:I,pos:T}}function q(){throw new SyntaxError("Unexpected token "+y[T]+" in JSON at position "+T)}function Q(){R(),q()}function O(){if(T>=y.length)throw new SyntaxError("Unexpected end of JSON input")}},o.stringify=function(y,x,A){if(l(y)){var v=0;switch(typeof(I=typeof A=="object"?A.space:A)){case"number":var _=10<I?10:I<0?0:Math.floor(I),I=_&&q(_," "),T=_,E=_;break;case"string":I=I.slice(0,10);for(var w=E=T=0;w<I.length;w++){switch(I[w]){case" ":E++;break;case"	":E+=4;break;case"\r":E=0;break;case`
`:E=0,v++;break;default:throw new Error("whitespace characters not allowed in JSON")}T++}break;default:I=void 0}var S="",P={},k=0,L=0,R=0,N=A&&A.es6&&typeof Map=="function";return function Q(O,B,j){switch(V(j,"value"),typeof O){case"number":case"bigint":case"boolean":F(""+O);break;case"string":F(f(O));break;case"object":O===null?F("null"):typeof O.toJSON=="function"?F(f(O.toJSON())):Array.isArray(O)?U():N?O.constructor.BYTES_PER_ELEMENT?U():O instanceof Map?$():O instanceof Set?$(!0):z():z()}V(j,"valueEnd");function U(){if(O.length){F("[");for(var Z=B+1,J=0;J<O.length;J++){J&&F(","),H(Z);var ie=l(O[J])?O[J]:null,ne=j+"/"+J;Q(ie,Z,ne)}H(B),F("]")}else F("[]")}function z(){var Z=Object.keys(O);if(Z.length){F("{");for(var J=B+1,ie=0;ie<Z.length;ie++){var ne,le=Z[ie],ee=O[le];l(ee)&&(ie&&F(","),ne=j+"/"+b(le),H(J),V(ne,"key"),F(f(le)),V(ne,"keyEnd"),F(":"),I&&F(" "),Q(ee,J,ne))}H(B),F("}")}else F("{}")}function $(Z){if(O.size){F("{");for(var J=B+1,ie=!0,ne=O.entries(),le=ne.next();!le.done;){var ee,te=le.value,oe=te[0],te=!!Z||te[1];l(te)&&(ie||F(","),ie=!1,ee=j+"/"+b(oe),H(J),V(ee,"key"),F(f(oe)),V(ee,"keyEnd"),F(":"),I&&F(" "),Q(te,J,ee)),le=ne.next()}H(B),F("}")}else F("{}")}}(y,0,""),{json:S,pointers:P}}function F(Q){L+=Q.length,R+=Q.length,S+=Q}function H(Q){if(I){for(S+=`
`+q(Q,I),k++,L=0;Q--;)v?(k+=v,L=E):L+=E,R+=T;R+=1}}function V(Q,O){P[Q]=P[Q]||{},P[Q][O]={line:k,column:L,pos:R}}function q(Q,O){return Array(Q+1).join(O)}},["number","bigint","boolean","string","object"]);function l(y){return 0<=a.indexOf(typeof y)}var c=/"|\\/g,u=/[\b]/g,d=/\f/g,m=/\n/g,p=/\r/g,h=/\t/g;function f(y){return'"'+(y=y.replace(c,"\\$&").replace(d,"\\f").replace(u,"\\b").replace(m,"\\n").replace(p,"\\r").replace(h,"\\t"))+'"'}var C=/~/g,g=/\//g;function b(y){return y.replace(C,"~0").replace(g,"~1")}},8340:function(n,o){var i,s;(function(){"use strict";s=[],(s=typeof(i=function(){"use strict";function a(A){return typeof Node=="object"?A instanceof Node:A&&typeof A=="object"&&typeof A.nodeType=="number"}function l(A){return typeof A=="string"}function c(){var A=[];return{watch:A.push.bind(A),trigger:function(v,_){for(var I=!0,T={detail:_,preventDefault:function(){I=!1}},E=0;E<A.length;E++)A[E](v,T);return I}}}function u(A){return window.getComputedStyle(A).display==="none"}function d(A){this.elem=A}function m(A,v){return d.make(A("parent")).clazz("pico-overlay").clazz(A("overlayClass","")).stylize({display:"none",position:"fixed",top:"0px",left:"0px",height:"100%",width:"100%",zIndex:1e4}).stylize(A("overlayStyles",{opacity:.5,background:"#000"})).onClick(function(){A("overlayClose",!0)&&v()})}d.make=function(A,v){typeof A=="string"&&(A=document.querySelector(A));var _=document.createElement(v||"div");return(A||document.body).appendChild(_),new d(_)},d.prototype={child:function(A){return d.make(this.elem,A)},stylize:function(A){A=A||{},typeof A.opacity<"u"&&(A.filter="alpha(opacity="+A.opacity*100+")");for(var v in A)A.hasOwnProperty(v)&&(this.elem.style[v]=A[v]);return this},clazz:function(A){return this.elem.className+=" "+A,this},html:function(A){return a(A)?this.elem.appendChild(A):this.elem.innerHTML=A,this},onClick:function(A){return this.elem.addEventListener("click",A),this},destroy:function(){this.elem.parentNode.removeChild(this.elem)},hide:function(){this.elem.style.display="none"},show:function(){this.elem.style.display="block"},attr:function(A,v){return v!==void 0&&this.elem.setAttribute(A,v),this},anyAncestor:function(A){for(var v=this.elem;v;){if(A(new d(v)))return!0;v=v.parentNode}return!1},isVisible:function(){return!u(this.elem)}};var p=1;function h(A,v){var _=A("width","auto");typeof _=="number"&&(_=""+_+"px");var I=A("modalId","pico-"+p++),T=d.make(A("parent")).clazz("pico-content").clazz(A("modalClass","")).stylize({display:"none",position:"fixed",zIndex:10001,left:"50%",top:"38.1966%",maxHeight:"90%",boxSizing:"border-box",width:_,"-ms-transform":"translate(-50%,-38.1966%)","-moz-transform":"translate(-50%,-38.1966%)","-webkit-transform":"translate(-50%,-38.1966%)","-o-transform":"translate(-50%,-38.1966%)",transform:"translate(-50%,-38.1966%)"}).stylize(A("modalStyles",{overflow:"auto",backgroundColor:"white",padding:"20px",borderRadius:"5px"})).html(A("content")).attr("id",I).attr("role","dialog").attr("aria-labelledby",A("ariaLabelledBy")).attr("aria-describedby",A("ariaDescribedBy",I)).onClick(function(E){var w=new d(E.target).anyAncestor(function(S){return/\bpico-close\b/.test(S.elem.className)});w&&v()});return T}function f(A,v){if(v("closeButton",!0))return A.child("button").html(v("closeHtml","&#xD7;")).clazz("pico-close").clazz(v("closeClass","")).stylize(v("closeStyles",{borderRadius:"2px",border:0,padding:0,cursor:"pointer",height:"15px",width:"15px",position:"absolute",top:"5px",right:"5px",fontSize:"16px",textAlign:"center",lineHeight:"15px",background:"#CCC"})).attr("aria-label",v("close-label","Close"))}function C(A){return function(){return A().elem}}var g=c(),b=c();function y(A,v){function _(S,P){var k=S.msMatchesSelector||S.webkitMatchesSelector||S.matches;return k.call(S,P)}function I(S){return u(S)||_(S,":disabled")||S.hasAttribute("contenteditable")?!1:S.hasAttribute("tabindex")||_(S,"input,select,textarea,button,a[href],area[href],iframe")}function T(S){for(var P=S.getElementsByTagName("*"),k=0;k<P.length;k++)if(I(P[k]))return P[k]}function E(S){for(var P=S.getElementsByTagName("*"),k=P.length;k--;)if(I(P[k]))return P[k]}var w;A.beforeShow(function(){w=document.activeElement}),A.afterShow(function(){if(v()){var P=T(A.modalElem());P&&P.focus()}}),A.afterClose(function(){v()&&w&&w.focus(),w=null}),b.watch(function(P){if(v()&&A.isVisible()){var k=T(A.modalElem()),L=E(A.modalElem()),R=P.shiftKey?k:L;R===document.activeElement&&((P.shiftKey?L:k).focus(),P.preventDefault())}})}function x(A,v){var _,I=new d(document.body);A.beforeShow(function(){_=I.elem.style.overflow,v()&&I.stylize({overflow:"hidden"})}),A.afterClose(function(){I.stylize({overflow:_})})}return document.documentElement.addEventListener("keydown",function(v){var _=v.which||v.keyCode;_===27?g.trigger():_===9&&b.trigger(v)}),function(v){(l(v)||a(v))&&(v={content:v});var _=c(),I=c(),T=c(),E=c(),w=c();function S(Q,O){var B=v[Q];return typeof B=="function"&&(B=B(O)),B===void 0?O:B}var P=q.bind(window,"modal"),k=q.bind(window,"overlay"),L=q.bind(window,"close"),R;function N(Q){k().hide(),P().hide(),w.trigger(R,Q)}function F(Q){E.trigger(R,Q)&&N(Q)}function H(Q){return function(){return Q.apply(this,arguments),R}}var V;function q(Q,O){if(!V){var B=h(S,F);V={modal:B,overlay:m(S,F),close:f(B,S)},_.trigger(R,O)}return V[Q]}return R={modalElem:C(P),closeElem:C(L),overlayElem:C(k),buildDom:H(q.bind(null,null)),isVisible:function(){return!!(V&&P&&P().isVisible())},show:function(Q){return I.trigger(R,Q)&&(k().show(),L(),P().show(),T.trigger(R,Q)),this},close:H(F),forceClose:H(N),destroy:function(){P().destroy(),k().destroy(),k=P=L=void 0},options:function(Q){Object.keys(Q).map(function(O){v[O]=Q[O]})},afterCreate:H(_.watch),beforeShow:H(I.watch),afterShow:H(T.watch),beforeClose:H(E.watch),afterClose:H(w.watch)},y(R,S.bind(null,"focus",!0)),x(R,S.bind(null,"bodyOverflow",!0)),g.watch(function(){S("escCloses",!0)&&R.isVisible()&&R.close()}),R}})=="function"?i.apply(o,s):i)!==void 0&&(n.exports=s)})()},6777:function(n,o){(function(i){"use strict";function s(){for(var Ze=arguments.length,Me=Array(Ze),Ie=0;Ie<Ze;Ie++)Me[Ie]=arguments[Ie];if(Me.length>1){Me[0]=Me[0].slice(0,-1);for(var et=Me.length-1,Ue=1;Ue<et;++Ue)Me[Ue]=Me[Ue].slice(1,-1);return Me[et]=Me[et].slice(1),Me.join("")}else return Me[0]}function a(Ze){return"(?:"+Ze+")"}function l(Ze){return Ze===void 0?"undefined":Ze===null?"null":Object.prototype.toString.call(Ze).split(" ").pop().split("]").shift().toLowerCase()}function c(Ze){return Ze.toUpperCase()}function u(Ze){return Ze!=null?Ze instanceof Array?Ze:typeof Ze.length!="number"||Ze.split||Ze.setInterval||Ze.call?[Ze]:Array.prototype.slice.call(Ze):[]}function d(Ze,Me){var Ie=Ze;if(Me)for(var et in Me)Ie[et]=Me[et];return Ie}function m(Ze){var Me="[A-Za-z]",Ie="[\\x0D]",et="[0-9]",Ue="[\\x22]",ft=s(et,"[A-Fa-f]"),Dt="[\\x0A]",vr="[\\x20]",nn=a(a("%[EFef]"+ft+"%"+ft+ft+"%"+ft+ft)+"|"+a("%[89A-Fa-f]"+ft+"%"+ft+ft)+"|"+a("%"+ft+ft)),co="[\\:\\/\\?\\#\\[\\]\\@]",Jr="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Yn=s(co,Jr),vi=Ze?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",Fo=Ze?"[\\uE000-\\uF8FF]":"[]",Qn=s(Me,et,"[\\-\\.\\_\\~]",vi),ui=a(Me+s(Me,et,"[\\+\\-\\.]")+"*"),So=a(a(nn+"|"+s(Qn,Jr,"[\\:]"))+"*"),Kc=a(a("25[0-5]")+"|"+a("2[0-4]"+et)+"|"+a("1"+et+et)+"|"+a("[1-9]"+et)+"|"+et),wa=a(a("25[0-5]")+"|"+a("2[0-4]"+et)+"|"+a("1"+et+et)+"|"+a("0?[1-9]"+et)+"|0?0?"+et),Za=a(wa+"\\."+wa+"\\."+wa+"\\."+wa),Do=a(ft+"{1,4}"),ua=a(a(Do+"\\:"+Do)+"|"+Za),Bi=a(a(Do+"\\:")+"{6}"+ua),ks=a("\\:\\:"+a(Do+"\\:")+"{5}"+ua),Qv=a(a(Do)+"?\\:\\:"+a(Do+"\\:")+"{4}"+ua),Fh=a(a(a(Do+"\\:")+"{0,1}"+Do)+"?\\:\\:"+a(Do+"\\:")+"{3}"+ua),_A=a(a(a(Do+"\\:")+"{0,2}"+Do)+"?\\:\\:"+a(Do+"\\:")+"{2}"+ua),hE=a(a(a(Do+"\\:")+"{0,3}"+Do)+"?\\:\\:"+Do+"\\:"+ua),gE=a(a(a(Do+"\\:")+"{0,4}"+Do)+"?\\:\\:"+ua),dx=a(a(a(Do+"\\:")+"{0,5}"+Do)+"?\\:\\:"+Do),mx=a(a(a(Do+"\\:")+"{0,6}"+Do)+"?\\:\\:"),Oh=a([Bi,ks,Qv,Fh,_A,hE,gE,dx,mx].join("|")),px=a(a(Qn+"|"+nn)+"+"),WF=a(Oh+"\\%25"+px),Jv=a(Oh+a("\\%25|\\%(?!"+ft+"{2})")+px),bwe=a("[vV]"+ft+"+\\."+s(Qn,Jr,"[\\:]")+"+"),xwe=a("\\["+a(Jv+"|"+Oh+"|"+bwe)+"\\]"),MW=a(a(nn+"|"+s(Qn,Jr))+"*"),TA=a(xwe+"|"+Za+"(?!"+MW+")|"+MW),EA=a(et+"*"),RW=a(a(So+"@")+"?"+TA+a("\\:"+EA)+"?"),PA=a(nn+"|"+s(Qn,Jr,"[\\:\\@]")),Cwe=a(PA+"*"),BW=a(PA+"+"),Swe=a(a(nn+"|"+s(Qn,Jr,"[\\@]"))+"+"),Vh=a(a("\\/"+Cwe)+"*"),fx=a("\\/"+a(BW+Vh)+"?"),qF=a(Swe+Vh),yE=a(BW+Vh),hx="(?!"+PA+")",fat=a(Vh+"|"+fx+"|"+qF+"|"+yE+"|"+hx),gx=a(a(PA+"|"+s("[\\/\\?]",Fo))+"*"),DA=a(a(PA+"|[\\/\\?]")+"*"),LW=a(a("\\/\\/"+RW+Vh)+"|"+fx+"|"+yE+"|"+hx),Iwe=a(ui+"\\:"+LW+a("\\?"+gx)+"?"+a("\\#"+DA)+"?"),Awe=a(a("\\/\\/"+RW+Vh)+"|"+fx+"|"+qF+"|"+hx),wwe=a(Awe+a("\\?"+gx)+"?"+a("\\#"+DA)+"?"),hat=a(Iwe+"|"+wwe),gat=a(ui+"\\:"+LW+a("\\?"+gx)+"?"),yat="^("+ui+")\\:"+a(a("\\/\\/("+a("("+So+")@")+"?("+TA+")"+a("\\:("+EA+")")+"?)")+"?("+Vh+"|"+fx+"|"+yE+"|"+hx+")")+a("\\?("+gx+")")+"?"+a("\\#("+DA+")")+"?$",vat="^(){0}"+a(a("\\/\\/("+a("("+So+")@")+"?("+TA+")"+a("\\:("+EA+")")+"?)")+"?("+Vh+"|"+fx+"|"+qF+"|"+hx+")")+a("\\?("+gx+")")+"?"+a("\\#("+DA+")")+"?$",bat="^("+ui+")\\:"+a(a("\\/\\/("+a("("+So+")@")+"?("+TA+")"+a("\\:("+EA+")")+"?)")+"?("+Vh+"|"+fx+"|"+yE+"|"+hx+")")+a("\\?("+gx+")")+"?$",xat="^"+a("\\#("+DA+")")+"?$",Cat="^"+a("("+So+")@")+"?("+TA+")"+a("\\:("+EA+")")+"?$";return{NOT_SCHEME:new RegExp(s("[^]",Me,et,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(s("[^\\%\\:]",Qn,Jr),"g"),NOT_HOST:new RegExp(s("[^\\%\\[\\]\\:]",Qn,Jr),"g"),NOT_PATH:new RegExp(s("[^\\%\\/\\:\\@]",Qn,Jr),"g"),NOT_PATH_NOSCHEME:new RegExp(s("[^\\%\\/\\@]",Qn,Jr),"g"),NOT_QUERY:new RegExp(s("[^\\%]",Qn,Jr,"[\\:\\@\\/\\?]",Fo),"g"),NOT_FRAGMENT:new RegExp(s("[^\\%]",Qn,Jr,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(s("[^]",Qn,Jr),"g"),UNRESERVED:new RegExp(Qn,"g"),OTHER_CHARS:new RegExp(s("[^\\%]",Qn,Yn),"g"),PCT_ENCODED:new RegExp(nn,"g"),IPV4ADDRESS:new RegExp("^("+Za+")$"),IPV6ADDRESS:new RegExp("^\\[?("+Oh+")"+a(a("\\%25|\\%(?!"+ft+"{2})")+"("+px+")")+"?\\]?$")}}var p=m(!1),h=m(!0),f=function(){function Ze(Me,Ie){var et=[],Ue=!0,ft=!1,Dt=void 0;try{for(var vr=Me[Symbol.iterator](),nn;!(Ue=(nn=vr.next()).done)&&(et.push(nn.value),!(Ie&&et.length===Ie));Ue=!0);}catch(co){ft=!0,Dt=co}finally{try{!Ue&&vr.return&&vr.return()}finally{if(ft)throw Dt}}return et}return function(Me,Ie){if(Array.isArray(Me))return Me;if(Symbol.iterator in Object(Me))return Ze(Me,Ie);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),C=function(Ze){if(Array.isArray(Ze)){for(var Me=0,Ie=Array(Ze.length);Me<Ze.length;Me++)Ie[Me]=Ze[Me];return Ie}else return Array.from(Ze)},g=2147483647,b=36,y=1,x=26,A=38,v=700,_=72,I=128,T="-",E=/^xn--/,w=/[^\0-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,P={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},k=b-y,L=Math.floor,R=String.fromCharCode;function N(Ze){throw new RangeError(P[Ze])}function F(Ze,Me){for(var Ie=[],et=Ze.length;et--;)Ie[et]=Me(Ze[et]);return Ie}function H(Ze,Me){var Ie=Ze.split("@"),et="";Ie.length>1&&(et=Ie[0]+"@",Ze=Ie[1]),Ze=Ze.replace(S,".");var Ue=Ze.split("."),ft=F(Ue,Me).join(".");return et+ft}function V(Ze){for(var Me=[],Ie=0,et=Ze.length;Ie<et;){var Ue=Ze.charCodeAt(Ie++);if(Ue>=55296&&Ue<=56319&&Ie<et){var ft=Ze.charCodeAt(Ie++);(ft&64512)==56320?Me.push(((Ue&1023)<<10)+(ft&1023)+65536):(Me.push(Ue),Ie--)}else Me.push(Ue)}return Me}var q,Q=function(Me){return Me-48<10?Me-22:Me-65<26?Me-65:Me-97<26?Me-97:b},O=function(Me,Ie){return Me+22+75*(Me<26)-((Ie!=0)<<5)},B=function(Me,Ie,et){var Ue=0;for(Me=et?L(Me/v):Me>>1,Me+=L(Me/Ie);Me>k*x>>1;Ue+=b)Me=L(Me/k);return L(Ue+(k+1)*Me/(Me+A))},j=function(Me){var Ie=[],et=Me.length,Ue=0,ft=I,Dt=_,vr=Me.lastIndexOf(T);vr<0&&(vr=0);for(var nn=0;nn<vr;++nn)Me.charCodeAt(nn)>=128&&N("not-basic"),Ie.push(Me.charCodeAt(nn));for(var co=vr>0?vr+1:0;co<et;){for(var Jr=Ue,Yn=1,vi=b;;vi+=b){co>=et&&N("invalid-input");var Fo=Q(Me.charCodeAt(co++));(Fo>=b||Fo>L((g-Ue)/Yn))&&N("overflow"),Ue+=Fo*Yn;var Qn=vi<=Dt?y:vi>=Dt+x?x:vi-Dt;if(Fo<Qn)break;var ui=b-Qn;Yn>L(g/ui)&&N("overflow"),Yn*=ui}var So=Ie.length+1;Dt=B(Ue-Jr,So,Jr==0),L(Ue/So)>g-ft&&N("overflow"),ft+=L(Ue/So),Ue%=So,Ie.splice(Ue++,0,ft)}return String.fromCodePoint.apply(String,Ie)},U=function(Me){var Ie=[];Me=V(Me);var et=Me.length,Ue=I,ft=0,Dt=_,vr=!0,nn=!1,co=void 0;try{for(var Jr=Me[Symbol.iterator](),Yn;!(vr=(Yn=Jr.next()).done);vr=!0){var vi=Yn.value;vi<128&&Ie.push(R(vi))}}catch(Jv){nn=!0,co=Jv}finally{try{!vr&&Jr.return&&Jr.return()}finally{if(nn)throw co}}var Fo=Ie.length,Qn=Fo;for(Fo&&Ie.push(T);Qn<et;){var ui=g,So=!0,Kc=!1,wa=void 0;try{for(var Za=Me[Symbol.iterator](),Do;!(So=(Do=Za.next()).done);So=!0){var ua=Do.value;ua>=Ue&&ua<ui&&(ui=ua)}}catch(Jv){Kc=!0,wa=Jv}finally{try{!So&&Za.return&&Za.return()}finally{if(Kc)throw wa}}var Bi=Qn+1;ui-Ue>L((g-ft)/Bi)&&N("overflow"),ft+=(ui-Ue)*Bi,Ue=ui;var ks=!0,Qv=!1,Fh=void 0;try{for(var _A=Me[Symbol.iterator](),hE;!(ks=(hE=_A.next()).done);ks=!0){var gE=hE.value;if(gE<Ue&&++ft>g&&N("overflow"),gE==Ue){for(var dx=ft,mx=b;;mx+=b){var Oh=mx<=Dt?y:mx>=Dt+x?x:mx-Dt;if(dx<Oh)break;var px=dx-Oh,WF=b-Oh;Ie.push(R(O(Oh+px%WF,0))),dx=L(px/WF)}Ie.push(R(O(dx,0))),Dt=B(ft,Bi,Qn==Fo),ft=0,++Qn}}}catch(Jv){Qv=!0,Fh=Jv}finally{try{!ks&&_A.return&&_A.return()}finally{if(Qv)throw Fh}}++ft,++Ue}return Ie.join("")},z,$,Z={version:"2.1.0",ucs2:{decode:V,encode:function(Me){return String.fromCodePoint.apply(String,C(Me))}},decode:j,encode:U,toASCII:function(Me){return H(Me,function(Ie){return w.test(Ie)?"xn--"+U(Ie):Ie})},toUnicode:function(Me){return H(Me,function(Ie){return E.test(Ie)?j(Ie.slice(4).toLowerCase()):Ie})}},J={};function ie(Ze){var Me=Ze.charCodeAt(0),Ie=void 0;return Me<16?Ie="%0"+Me.toString(16).toUpperCase():Me<128?Ie="%"+Me.toString(16).toUpperCase():Me<2048?Ie="%"+(Me>>6|192).toString(16).toUpperCase()+"%"+(Me&63|128).toString(16).toUpperCase():Ie="%"+(Me>>12|224).toString(16).toUpperCase()+"%"+(Me>>6&63|128).toString(16).toUpperCase()+"%"+(Me&63|128).toString(16).toUpperCase(),Ie}function ne(Ze){for(var Me="",Ie=0,et=Ze.length;Ie<et;){var Ue=parseInt(Ze.substr(Ie+1,2),16);if(Ue<128)Me+=String.fromCharCode(Ue),Ie+=3;else if(Ue>=194&&Ue<224){if(et-Ie>=6){var ft=parseInt(Ze.substr(Ie+4,2),16);Me+=String.fromCharCode((Ue&31)<<6|ft&63)}else Me+=Ze.substr(Ie,6);Ie+=6}else if(Ue>=224){if(et-Ie>=9){var Dt=parseInt(Ze.substr(Ie+4,2),16),vr=parseInt(Ze.substr(Ie+7,2),16);Me+=String.fromCharCode((Ue&15)<<12|(Dt&63)<<6|vr&63)}else Me+=Ze.substr(Ie,9);Ie+=9}else Me+=Ze.substr(Ie,3),Ie+=3}return Me}function le(Ze,Me){function Ie(et){var Ue=ne(et);return Ue.match(Me.UNRESERVED)?Ue:et}return Ze.scheme&&(Ze.scheme=String(Ze.scheme).replace(Me.PCT_ENCODED,Ie).toLowerCase().replace(Me.NOT_SCHEME,"")),Ze.userinfo!==void 0&&(Ze.userinfo=String(Ze.userinfo).replace(Me.PCT_ENCODED,Ie).replace(Me.NOT_USERINFO,ie).replace(Me.PCT_ENCODED,c)),Ze.host!==void 0&&(Ze.host=String(Ze.host).replace(Me.PCT_ENCODED,Ie).toLowerCase().replace(Me.NOT_HOST,ie).replace(Me.PCT_ENCODED,c)),Ze.path!==void 0&&(Ze.path=String(Ze.path).replace(Me.PCT_ENCODED,Ie).replace(Ze.scheme?Me.NOT_PATH:Me.NOT_PATH_NOSCHEME,ie).replace(Me.PCT_ENCODED,c)),Ze.query!==void 0&&(Ze.query=String(Ze.query).replace(Me.PCT_ENCODED,Ie).replace(Me.NOT_QUERY,ie).replace(Me.PCT_ENCODED,c)),Ze.fragment!==void 0&&(Ze.fragment=String(Ze.fragment).replace(Me.PCT_ENCODED,Ie).replace(Me.NOT_FRAGMENT,ie).replace(Me.PCT_ENCODED,c)),Ze}function ee(Ze){return Ze.replace(/^0*(.*)/,"$1")||"0"}function oe(Ze,Me){var Ie=Ze.match(Me.IPV4ADDRESS)||[],et=f(Ie,2),Ue=et[1];return Ue?Ue.split(".").map(ee).join("."):Ze}function te(Ze,Me){var Ie=Ze.match(Me.IPV6ADDRESS)||[],et=f(Ie,3),Ue=et[1],ft=et[2];if(Ue){for(var Dt=Ue.toLowerCase().split("::").reverse(),vr=f(Dt,2),nn=vr[0],co=vr[1],Jr=co?co.split(":").map(ee):[],Yn=nn.split(":").map(ee),vi=Me.IPV4ADDRESS.test(Yn[Yn.length-1]),Fo=vi?7:8,Qn=Yn.length-Fo,ui=Array(Fo),So=0;So<Fo;++So)ui[So]=Jr[So]||Yn[Qn+So]||"";vi&&(ui[Fo-1]=oe(ui[Fo-1],Me));var Kc=ui.reduce(function(Bi,ks,Qv){if(!ks||ks==="0"){var Fh=Bi[Bi.length-1];Fh&&Fh.index+Fh.length===Qv?Fh.length++:Bi.push({index:Qv,length:1})}return Bi},[]),wa=Kc.sort(function(Bi,ks){return ks.length-Bi.length})[0],Za=void 0;if(wa&&wa.length>1){var Do=ui.slice(0,wa.index),ua=ui.slice(wa.index+wa.length);Za=Do.join(":")+"::"+ua.join(":")}else Za=ui.join(":");return ft&&(Za+="%"+ft),Za}else return Ze}var X=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,W="".match(/(){0}/)[1]===void 0;function K(Ze){var Me=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ie={},et=Me.iri!==!1?h:p;Me.reference==="suffix"&&(Ze=(Me.scheme?Me.scheme+":":"")+"//"+Ze);var Ue=Ze.match(X);if(Ue){W?(Ie.scheme=Ue[1],Ie.userinfo=Ue[3],Ie.host=Ue[4],Ie.port=parseInt(Ue[5],10),Ie.path=Ue[6]||"",Ie.query=Ue[7],Ie.fragment=Ue[8],isNaN(Ie.port)&&(Ie.port=Ue[5])):(Ie.scheme=Ue[1]||void 0,Ie.userinfo=Ze.indexOf("@")!==-1?Ue[3]:void 0,Ie.host=Ze.indexOf("//")!==-1?Ue[4]:void 0,Ie.port=parseInt(Ue[5],10),Ie.path=Ue[6]||"",Ie.query=Ze.indexOf("?")!==-1?Ue[7]:void 0,Ie.fragment=Ze.indexOf("#")!==-1?Ue[8]:void 0,isNaN(Ie.port)&&(Ie.port=Ze.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?Ue[4]:void 0)),Ie.host&&(Ie.host=te(oe(Ie.host,et),et)),Ie.scheme===void 0&&Ie.userinfo===void 0&&Ie.host===void 0&&Ie.port===void 0&&!Ie.path&&Ie.query===void 0?Ie.reference="same-document":Ie.scheme===void 0?Ie.reference="relative":Ie.fragment===void 0?Ie.reference="absolute":Ie.reference="uri",Me.reference&&Me.reference!=="suffix"&&Me.reference!==Ie.reference&&(Ie.error=Ie.error||"URI is not a "+Me.reference+" reference.");var ft=J[(Me.scheme||Ie.scheme||"").toLowerCase()];if(!Me.unicodeSupport&&(!ft||!ft.unicodeSupport)){if(Ie.host&&(Me.domainHost||ft&&ft.domainHost))try{Ie.host=Z.toASCII(Ie.host.replace(et.PCT_ENCODED,ne).toLowerCase())}catch(Dt){Ie.error=Ie.error||"Host's domain name can not be converted to ASCII via punycode: "+Dt}le(Ie,p)}else le(Ie,et);ft&&ft.parse&&ft.parse(Ie,Me)}else Ie.error=Ie.error||"URI can not be parsed.";return Ie}function re(Ze,Me){var Ie=Me.iri!==!1?h:p,et=[];return Ze.userinfo!==void 0&&(et.push(Ze.userinfo),et.push("@")),Ze.host!==void 0&&et.push(te(oe(String(Ze.host),Ie),Ie).replace(Ie.IPV6ADDRESS,function(Ue,ft,Dt){return"["+ft+(Dt?"%25"+Dt:"")+"]"})),(typeof Ze.port=="number"||typeof Ze.port=="string")&&(et.push(":"),et.push(String(Ze.port))),et.length?et.join(""):void 0}var se=/^\.\.?\//,me=/^\/\.(\/|$)/,Y=/^\/\.\.(\/|$)/,ae=/^\/?(?:.|\n)*?(?=\/|$)/;function ve(Ze){for(var Me=[];Ze.length;)if(Ze.match(se))Ze=Ze.replace(se,"");else if(Ze.match(me))Ze=Ze.replace(me,"/");else if(Ze.match(Y))Ze=Ze.replace(Y,"/"),Me.pop();else if(Ze==="."||Ze==="..")Ze="";else{var Ie=Ze.match(ae);if(Ie){var et=Ie[0];Ze=Ze.slice(et.length),Me.push(et)}else throw new Error("Unexpected dot segment condition")}return Me.join("")}function ge(Ze){var Me=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ie=Me.iri?h:p,et=[],Ue=J[(Me.scheme||Ze.scheme||"").toLowerCase()];if(Ue&&Ue.serialize&&Ue.serialize(Ze,Me),Ze.host&&!Ie.IPV6ADDRESS.test(Ze.host)){if(Me.domainHost||Ue&&Ue.domainHost)try{Ze.host=Me.iri?Z.toUnicode(Ze.host):Z.toASCII(Ze.host.replace(Ie.PCT_ENCODED,ne).toLowerCase())}catch(vr){Ze.error=Ze.error||"Host's domain name can not be converted to "+(Me.iri?"Unicode":"ASCII")+" via punycode: "+vr}}le(Ze,Ie),Me.reference!=="suffix"&&Ze.scheme&&(et.push(Ze.scheme),et.push(":"));var ft=re(Ze,Me);if(ft!==void 0&&(Me.reference!=="suffix"&&et.push("//"),et.push(ft),Ze.path&&Ze.path.charAt(0)!=="/"&&et.push("/")),Ze.path!==void 0){var Dt=Ze.path;!Me.absolutePath&&(!Ue||!Ue.absolutePath)&&(Dt=ve(Dt)),ft===void 0&&(Dt=Dt.replace(/^\/\//,"/%2F")),et.push(Dt)}return Ze.query!==void 0&&(et.push("?"),et.push(Ze.query)),Ze.fragment!==void 0&&(et.push("#"),et.push(Ze.fragment)),et.join("")}function Se(Ze,Me){var Ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},et=arguments[3],Ue={};return et||(Ze=K(ge(Ze,Ie),Ie),Me=K(ge(Me,Ie),Ie)),Ie=Ie||{},!Ie.tolerant&&Me.scheme?(Ue.scheme=Me.scheme,Ue.userinfo=Me.userinfo,Ue.host=Me.host,Ue.port=Me.port,Ue.path=ve(Me.path||""),Ue.query=Me.query):(Me.userinfo!==void 0||Me.host!==void 0||Me.port!==void 0?(Ue.userinfo=Me.userinfo,Ue.host=Me.host,Ue.port=Me.port,Ue.path=ve(Me.path||""),Ue.query=Me.query):(Me.path?(Me.path.charAt(0)==="/"?Ue.path=ve(Me.path):((Ze.userinfo!==void 0||Ze.host!==void 0||Ze.port!==void 0)&&!Ze.path?Ue.path="/"+Me.path:Ze.path?Ue.path=Ze.path.slice(0,Ze.path.lastIndexOf("/")+1)+Me.path:Ue.path=Me.path,Ue.path=ve(Ue.path)),Ue.query=Me.query):(Ue.path=Ze.path,Me.query!==void 0?Ue.query=Me.query:Ue.query=Ze.query),Ue.userinfo=Ze.userinfo,Ue.host=Ze.host,Ue.port=Ze.port),Ue.scheme=Ze.scheme),Ue.fragment=Me.fragment,Ue}function Ee(Ze,Me,Ie){var et=d({scheme:"null"},Ie);return ge(Se(K(Ze,et),K(Me,et),et,!0),et)}function Fe(Ze,Me){return typeof Ze=="string"?Ze=ge(K(Ze,Me),Me):l(Ze)==="object"&&(Ze=K(ge(Ze,Me),Me)),Ze}function Ae(Ze,Me,Ie){return typeof Ze=="string"?Ze=ge(K(Ze,Ie),Ie):l(Ze)==="object"&&(Ze=ge(Ze,Ie)),typeof Me=="string"?Me=ge(K(Me,Ie),Ie):l(Me)==="object"&&(Me=ge(Me,Ie)),Ze===Me}function we(Ze,Me){return Ze&&Ze.toString().replace(!Me||!Me.iri?p.ESCAPE:h.ESCAPE,ie)}function _e(Ze,Me){return Ze&&Ze.toString().replace(!Me||!Me.iri?p.PCT_ENCODED:h.PCT_ENCODED,ne)}var Ke={scheme:"http",domainHost:!0,parse:function(Me,Ie){return Me.host||(Me.error=Me.error||"HTTP URIs must have a host."),Me},serialize:function(Me,Ie){var et=String(Me.scheme).toLowerCase()==="https";return(Me.port===(et?443:80)||Me.port==="")&&(Me.port=void 0),Me.path||(Me.path="/"),Me}},rt={scheme:"https",domainHost:Ke.domainHost,parse:Ke.parse,serialize:Ke.serialize};function pt(Ze){return typeof Ze.secure=="boolean"?Ze.secure:String(Ze.scheme).toLowerCase()==="wss"}var Ne={scheme:"ws",domainHost:!0,parse:function(Me,Ie){var et=Me;return et.secure=pt(et),et.resourceName=(et.path||"/")+(et.query?"?"+et.query:""),et.path=void 0,et.query=void 0,et},serialize:function(Me,Ie){if((Me.port===(pt(Me)?443:80)||Me.port==="")&&(Me.port=void 0),typeof Me.secure=="boolean"&&(Me.scheme=Me.secure?"wss":"ws",Me.secure=void 0),Me.resourceName){var et=Me.resourceName.split("?"),Ue=f(et,2),ft=Ue[0],Dt=Ue[1];Me.path=ft&&ft!=="/"?ft:void 0,Me.query=Dt,Me.resourceName=void 0}return Me.fragment=void 0,Me}},je={scheme:"wss",domainHost:Ne.domainHost,parse:Ne.parse,serialize:Ne.serialize},Ye={},mt,vt="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",yt="[0-9A-Fa-f]",$e=a(a("%[EFef]"+yt+"%"+yt+yt+"%"+yt+yt)+"|"+a("%[89A-Fa-f]"+yt+"%"+yt+yt)+"|"+a("%"+yt+yt)),be="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Te,De=s("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),pe="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Ce=new RegExp(vt,"g"),he=new RegExp($e,"g"),We=new RegExp(s("[^]",be,"[\\.]",'[\\"]',De),"g"),It=new RegExp(s("[^]",vt,pe),"g"),St=It;function Yt(Ze){var Me=ne(Ze);return Me.match(Ce)?Me:Ze}var sr={scheme:"mailto",parse:function(Me,Ie){var et=Me,Ue=et.to=et.path?et.path.split(","):[];if(et.path=void 0,et.query){for(var ft=!1,Dt={},vr=et.query.split("&"),nn=0,co=vr.length;nn<co;++nn){var Jr=vr[nn].split("=");switch(Jr[0]){case"to":for(var Yn=Jr[1].split(","),vi=0,Fo=Yn.length;vi<Fo;++vi)Ue.push(Yn[vi]);break;case"subject":et.subject=_e(Jr[1],Ie);break;case"body":et.body=_e(Jr[1],Ie);break;default:ft=!0,Dt[_e(Jr[0],Ie)]=_e(Jr[1],Ie);break}}ft&&(et.headers=Dt)}et.query=void 0;for(var Qn=0,ui=Ue.length;Qn<ui;++Qn){var So=Ue[Qn].split("@");if(So[0]=_e(So[0]),Ie.unicodeSupport)So[1]=_e(So[1],Ie).toLowerCase();else try{So[1]=Z.toASCII(_e(So[1],Ie).toLowerCase())}catch(Kc){et.error=et.error||"Email address's domain name can not be converted to ASCII via punycode: "+Kc}Ue[Qn]=So.join("@")}return et},serialize:function(Me,Ie){var et=Me,Ue=u(Me.to);if(Ue){for(var ft=0,Dt=Ue.length;ft<Dt;++ft){var vr=String(Ue[ft]),nn=vr.lastIndexOf("@"),co=vr.slice(0,nn).replace(he,Yt).replace(he,c).replace(We,ie),Jr=vr.slice(nn+1);try{Jr=Ie.iri?Z.toUnicode(Jr):Z.toASCII(_e(Jr,Ie).toLowerCase())}catch(Qn){et.error=et.error||"Email address's domain name can not be converted to "+(Ie.iri?"Unicode":"ASCII")+" via punycode: "+Qn}Ue[ft]=co+"@"+Jr}et.path=Ue.join(",")}var Yn=Me.headers=Me.headers||{};Me.subject&&(Yn.subject=Me.subject),Me.body&&(Yn.body=Me.body);var vi=[];for(var Fo in Yn)Yn[Fo]!==Ye[Fo]&&vi.push(Fo.replace(he,Yt).replace(he,c).replace(It,ie)+"="+Yn[Fo].replace(he,Yt).replace(he,c).replace(St,ie));return vi.length&&(et.query=vi.join("&")),et}},Xr=/^([^\:]+)\:(.*)/,mn={scheme:"urn",parse:function(Me,Ie){var et=Me.path&&Me.path.match(Xr),Ue=Me;if(et){var ft=Ie.scheme||Ue.scheme||"urn",Dt=et[1].toLowerCase(),vr=et[2],nn=ft+":"+(Ie.nid||Dt),co=J[nn];Ue.nid=Dt,Ue.nss=vr,Ue.path=void 0,co&&(Ue=co.parse(Ue,Ie))}else Ue.error=Ue.error||"URN can not be parsed.";return Ue},serialize:function(Me,Ie){var et=Ie.scheme||Me.scheme||"urn",Ue=Me.nid,ft=et+":"+(Ie.nid||Ue),Dt=J[ft];Dt&&(Me=Dt.serialize(Me,Ie));var vr=Me,nn=Me.nss;return vr.path=(Ue||Ie.nid)+":"+nn,vr}},no=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,qn={scheme:"urn:uuid",parse:function(Me,Ie){var et=Me;return et.uuid=et.nss,et.nss=void 0,!Ie.tolerant&&(!et.uuid||!et.uuid.match(no))&&(et.error=et.error||"UUID is not valid."),et},serialize:function(Me,Ie){var et=Me;return et.nss=(Me.uuid||"").toLowerCase(),et}};J[Ke.scheme]=Ke,J[rt.scheme]=rt,J[Ne.scheme]=Ne,J[je.scheme]=je,J[sr.scheme]=sr,J[mn.scheme]=mn,J[qn.scheme]=qn,i.SCHEMES=J,i.pctEncChar=ie,i.pctDecChars=ne,i.parse=K,i.removeDotSegments=ve,i.serialize=ge,i.resolveComponents=Se,i.resolve=Ee,i.normalize=Fe,i.equal=Ae,i.escapeComponent=we,i.unescapeComponent=_e,Object.defineProperty(i,"__esModule",{value:!0})})(o)},7598:function(n){n.exports=function(){"use strict";var o=function(_,I){if(!(_ instanceof I))throw new TypeError("Cannot call a class as a function")},i=function(){function _(I,T){for(var E=0;E<T.length;E++){var w=T[E];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(I,w.key,w)}}return function(I,T,E){return T&&_(I.prototype,T),E&&_(I,E),I}}(),s=function(){function _(I,T){var E=[],w=!0,S=!1,P=void 0;try{for(var k=I[Symbol.iterator](),L;!(w=(L=k.next()).done)&&(E.push(L.value),!(T&&E.length===T));w=!0);}catch(R){S=!0,P=R}finally{try{!w&&k.return&&k.return()}finally{if(S)throw P}}return E}return function(I,T){if(Array.isArray(I))return I;if(Symbol.iterator in Object(I))return _(I,T);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=(String.prototype.startsWith=String.prototype.startsWith||function(_){return this.indexOf(_)===0},String.prototype.padStart=String.prototype.padStart||function(_,I){for(var T=this;T.length<_;)T=I+T;return T},{cb:"0f8ff",tqw:"aebd7",q:"-ffff",qmrn:"7fffd4",zr:"0ffff",bg:"5f5dc",bsq:"e4c4",bck:"---",nch:"ebcd",b:"--ff",bvt:"8a2be2",brwn:"a52a2a",brw:"deb887",ctb:"5f9ea0",hrt:"7fff-",chcT:"d2691e",cr:"7f50",rnw:"6495ed",crns:"8dc",crms:"dc143c",cn:"-ffff",Db:"--8b",Dcn:"-8b8b",Dgnr:"b8860b",Dgr:"a9a9a9",Dgrn:"-64-",Dkhk:"bdb76b",Dmgn:"8b-8b",Dvgr:"556b2f",Drng:"8c-",Drch:"9932cc",Dr:"8b--",Dsmn:"e9967a",Dsgr:"8fbc8f",DsTb:"483d8b",DsTg:"2f4f4f",Dtrq:"-ced1",Dvt:"94-d3",ppnk:"1493",pskb:"-bfff",mgr:"696969",grb:"1e90ff",rbrc:"b22222",rwht:"af0",stg:"228b22",chs:"-ff",gnsb:"dcdcdc",st:"8f8ff",g:"d7-",gnr:"daa520",gr:"808080",grn:"-8-0",grnw:"adff2f",hnw:"0fff0",htpn:"69b4",nnr:"cd5c5c",ng:"4b-82",vr:"0",khk:"0e68c",vnr:"e6e6fa",nrb:"0f5",wngr:"7cfc-",mnch:"acd",Lb:"add8e6",Lcr:"08080",Lcn:"e0ffff",Lgnr:"afad2",Lgr:"d3d3d3",Lgrn:"90ee90",Lpnk:"b6c1",Lsmn:"a07a",Lsgr:"20b2aa",Lskb:"87cefa",LsTg:"778899",Lstb:"b0c4de",Lw:"e0",m:"-ff-",mgrn:"32cd32",nn:"af0e6",mgnt:"-ff",mrn:"8--0",mqm:"66cdaa",mmb:"--cd",mmrc:"ba55d3",mmpr:"9370db",msg:"3cb371",mmsT:"7b68ee","":"-fa9a",mtr:"48d1cc",mmvt:"c71585",mnLb:"191970",ntc:"5fffa",mstr:"e4e1",mccs:"e4b5",vjw:"dead",nv:"--80",c:"df5e6",v:"808-0",vrb:"6b8e23",rng:"a5-",rngr:"45-",rch:"da70d6",pgnr:"eee8aa",pgrn:"98fb98",ptrq:"afeeee",pvtr:"db7093",ppwh:"efd5",pchp:"dab9",pr:"cd853f",pnk:"c0cb",pm:"dda0dd",pwrb:"b0e0e6",prp:"8-080",cc:"663399",r:"--",sbr:"bc8f8f",rb:"4169e1",sbrw:"8b4513",smn:"a8072",nbr:"4a460",sgrn:"2e8b57",ssh:"5ee",snn:"a0522d",svr:"c0c0c0",skb:"87ceeb",sTb:"6a5acd",sTgr:"708090",snw:"afa",n:"-ff7f",stb:"4682b4",tn:"d2b48c",t:"-8080",thst:"d8bfd8",tmT:"6347",trqs:"40e0d0",vt:"ee82ee",whT:"5deb3",wht:"",hts:"5f5f5",w:"-",wgrn:"9acd32"});function l(_){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,T=I>0?_.toFixed(I).replace(/0+$/,"").replace(/\.$/,""):_.toString();return T||"0"}var c=function(){function _(I,T,E,w){o(this,_);var S=this;function P(L){if(L.startsWith("hsl")){var R=L.match(/([\-\d\.e]+)/g).map(Number),N=s(R,4),F=N[0],H=N[1],V=N[2],q=N[3];q===void 0&&(q=1),F/=360,H/=100,V/=100,S.hsla=[F,H,V,q]}else if(L.startsWith("rgb")){var Q=L.match(/([\-\d\.e]+)/g).map(Number),O=s(Q,4),B=O[0],j=O[1],U=O[2],z=O[3];z===void 0&&(z=1),S.rgba=[B,j,U,z]}else L.startsWith("#")?S.rgba=_.hexToRgb(L):S.rgba=_.nameToRgb(L)||_.hexToRgb(L)}if(I!==void 0)if(Array.isArray(I))this.rgba=I;else if(E===void 0){var k=I&&""+I;k&&P(k.toLowerCase())}else this.rgba=[I,T,E,w===void 0?1:w]}return i(_,[{key:"printRGB",value:function(T){var E=T?this.rgba:this.rgba.slice(0,3),w=E.map(function(S,P){return l(S,P===3?3:0)});return T?"rgba("+w+")":"rgb("+w+")"}},{key:"printHSL",value:function(T){var E=[360,100,100,1],w=["","%","%",""],S=T?this.hsla:this.hsla.slice(0,3),P=S.map(function(k,L){return l(k*E[L],L===3?3:1)+w[L]});return T?"hsla("+P+")":"hsl("+P+")"}},{key:"printHex",value:function(T){var E=this.hex;return T?E:E.substring(0,7)}},{key:"rgba",get:function(){if(this._rgba)return this._rgba;if(!this._hsla)throw new Error("No color is set");return this._rgba=_.hslToRgb(this._hsla)},set:function(T){T.length===3&&(T[3]=1),this._rgba=T,this._hsla=null}},{key:"rgbString",get:function(){return this.printRGB()}},{key:"rgbaString",get:function(){return this.printRGB(!0)}},{key:"hsla",get:function(){if(this._hsla)return this._hsla;if(!this._rgba)throw new Error("No color is set");return this._hsla=_.rgbToHsl(this._rgba)},set:function(T){T.length===3&&(T[3]=1),this._hsla=T,this._rgba=null}},{key:"hslString",get:function(){return this.printHSL()}},{key:"hslaString",get:function(){return this.printHSL(!0)}},{key:"hex",get:function(){var T=this.rgba,E=T.map(function(w,S){return S<3?w.toString(16):Math.round(w*255).toString(16)});return"#"+E.map(function(w){return w.padStart(2,"0")}).join("")},set:function(T){this.rgba=_.hexToRgb(T)}}],[{key:"hexToRgb",value:function(T){var E=(T.startsWith("#")?T.slice(1):T).replace(/^(\w{3})$/,"$1F").replace(/^(\w)(\w)(\w)(\w)$/,"$1$1$2$2$3$3$4$4").replace(/^(\w{6})$/,"$1FF");if(!E.match(/^([0-9a-fA-F]{8})$/))throw new Error("Unknown hex color; "+T);var w=E.match(/^(\w\w)(\w\w)(\w\w)(\w\w)$/).slice(1).map(function(S){return parseInt(S,16)});return w[3]=w[3]/255,w}},{key:"nameToRgb",value:function(T){var E=T.toLowerCase().replace("at","T").replace(/[aeiouyldf]/g,"").replace("ght","L").replace("rk","D").slice(-5,4),w=a[E];return w===void 0?w:_.hexToRgb(w.replace(/\-/g,"00").padStart(6,"f"))}},{key:"rgbToHsl",value:function(T){var E=s(T,4),w=E[0],S=E[1],P=E[2],k=E[3];w/=255,S/=255,P/=255;var L=Math.max(w,S,P),R=Math.min(w,S,P),N=void 0,F=void 0,H=(L+R)/2;if(L===R)N=F=0;else{var V=L-R;switch(F=H>.5?V/(2-L-R):V/(L+R),L){case w:N=(S-P)/V+(S<P?6:0);break;case S:N=(P-w)/V+2;break;case P:N=(w-S)/V+4;break}N/=6}return[N,F,H,k]}},{key:"hslToRgb",value:function(T){var E=s(T,4),w=E[0],S=E[1],P=E[2],k=E[3],L=void 0,R=void 0,N=void 0;if(S===0)L=R=N=P;else{var F=function(O,B,j){return j<0&&(j+=1),j>1&&(j-=1),j<.16666666666666666?O+(B-O)*6*j:j<.5?B:j<.6666666666666666?O+(B-O)*(.6666666666666666-j)*6:O},H=P<.5?P*(1+S):P+S-P*S,V=2*P-H;L=F(V,H,w+1/3),R=F(V,H,w),N=F(V,H,w-1/3)}var q=[L*255,R*255,N*255].map(Math.round);return q[3]=k,q}}]),_}(),u=function(){function _(){o(this,_),this._events=[]}return i(_,[{key:"add",value:function(T,E,w){T.addEventListener(E,w,!1),this._events.push({target:T,type:E,handler:w})}},{key:"remove",value:function(T,E,w){this._events=this._events.filter(function(S){var P=!0;return T&&T!==S.target&&(P=!1),E&&E!==S.type&&(P=!1),w&&w!==S.handler&&(P=!1),P&&_._doRemove(S.target,S.type,S.handler),!P})}},{key:"destroy",value:function(){this._events.forEach(function(T){return _._doRemove(T.target,T.type,T.handler)}),this._events=[]}}],[{key:"_doRemove",value:function(T,E,w){T.removeEventListener(E,w,!1)}}]),_}();function d(_){var I=document.createElement("div");return I.innerHTML=_,I.firstElementChild}function m(_,I,T){var E=!1;function w(L,R,N){return Math.max(R,Math.min(L,N))}function S(L,R,N){if(N&&(E=!0),!!E){L.preventDefault();var F=I.getBoundingClientRect(),H=F.width,V=F.height,q=R.clientX,Q=R.clientY,O=w(q-F.left,0,H),B=w(Q-F.top,0,V);T(O/H,B/V)}}function P(L,R){var N=L.buttons===void 0?L.which:L.buttons;N===1?S(L,L,R):E=!1}function k(L,R){L.touches.length===1?S(L,L.touches[0],R):E=!1}_.add(I,"mousedown",function(L){P(L,!0)}),_.add(I,"touchstart",function(L){k(L,!0)}),_.add(window,"mousemove",P),_.add(I,"touchmove",k),_.add(window,"mouseup",function(L){E=!1}),_.add(I,"touchend",function(L){E=!1}),_.add(I,"touchcancel",function(L){E=!1})}var p=`linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0 / 2em 2em,
                   linear-gradient(45deg, lightgrey 25%,       white 25%,       white 75%, lightgrey 75%) 1em 1em / 2em 2em`,h=360,f="keydown",C="mousedown",g="focusin";function b(_,I){return(I||document).querySelector(_)}function y(_){_.preventDefault(),_.stopPropagation()}function x(_,I,T,E,w){_.add(I,f,function(S){T.indexOf(S.key)>=0&&(w&&y(S),E(S))})}var A=function(){function _(I){o(this,_),this.settings={popup:"right",layout:"default",alpha:!0,editor:!0,editorFormat:"hex",cancelButton:!1,defaultColor:"#0cf"},this._events=new u,this.onChange=null,this.onDone=null,this.onOpen=null,this.onClose=null,this.setOptions(I)}return i(_,[{key:"setOptions",value:function(T){var E=this;if(!T)return;var w=this.settings;function S(R,N,F){for(var H in R)F&&F.indexOf(H)>=0||(N[H]=R[H])}if(T instanceof HTMLElement)w.parent=T;else{w.parent&&T.parent&&w.parent!==T.parent&&(this._events.remove(w.parent),this._popupInited=!1),S(T,w),T.onChange&&(this.onChange=T.onChange),T.onDone&&(this.onDone=T.onDone),T.onOpen&&(this.onOpen=T.onOpen),T.onClose&&(this.onClose=T.onClose);var P=T.color||T.colour;P&&this._setColor(P)}var k=w.parent;if(k&&w.popup&&!this._popupInited){var L=function(N){return E.openHandler(N)};this._events.add(k,"click",L),x(this._events,k,[" ","Spacebar","Enter"],L),this._popupInited=!0}else T.parent&&!w.popup&&this.show()}},{key:"openHandler",value:function(T){if(this.show()){T&&T.preventDefault(),this.settings.parent.style.pointerEvents="none";var E=T&&T.type===f?this._domEdit:this.domElement;setTimeout(function(){return E.focus()},100),this.onOpen&&this.onOpen(this.colour)}}},{key:"closeHandler",value:function(T){var E=T&&T.type,w=!1;if(!T)w=!0;else if(E===C||E===g){var S=(this.__containedEvent||0)+100;T.timeStamp>S&&(w=!0)}else y(T),w=!0;w&&this.hide()&&(this.settings.parent.style.pointerEvents="",E!==C&&this.settings.parent.focus(),this.onClose&&this.onClose(this.colour))}},{key:"movePopup",value:function(T,E){this.closeHandler(),this.setOptions(T),E&&this.openHandler()}},{key:"setColor",value:function(T,E){this._setColor(T,{silent:E})}},{key:"_setColor",value:function(T,E){if(typeof T=="string"&&(T=T.trim()),!!T){E=E||{};var w=void 0;try{w=new c(T)}catch(P){if(E.failSilently)return;throw P}if(!this.settings.alpha){var S=w.hsla;S[3]=1,w.hsla=S}this.colour=this.color=w,this._setHSLA(null,null,null,null,E)}}},{key:"setColour",value:function(T,E){this.setColor(T,E)}},{key:"show",value:function(){var T=this.settings.parent;if(!T)return!1;if(this.domElement){var E=this._toggleDOM(!0);return this._setPosition(),E}var w=this.settings.template||'<div class="picker_wrapper" tabindex="-1"><div class="picker_arrow"></div><div class="picker_hue picker_slider"><div class="picker_selector"></div></div><div class="picker_sl"><div class="picker_selector"></div></div><div class="picker_alpha picker_slider"><div class="picker_selector"></div></div><div class="picker_editor"><input aria-label="Type a color name or hex value"/></div><div class="picker_sample"></div><div class="picker_done"><button>Ok</button></div><div class="picker_cancel"><button>Cancel</button></div></div>',S=d(w);return this.domElement=S,this._domH=b(".picker_hue",S),this._domSL=b(".picker_sl",S),this._domA=b(".picker_alpha",S),this._domEdit=b(".picker_editor input",S),this._domSample=b(".picker_sample",S),this._domOkay=b(".picker_done button",S),this._domCancel=b(".picker_cancel button",S),S.classList.add("layout_"+this.settings.layout),this.settings.alpha||S.classList.add("no_alpha"),this.settings.editor||S.classList.add("no_editor"),this.settings.cancelButton||S.classList.add("no_cancel"),this._ifPopup(function(){return S.classList.add("popup")}),this._setPosition(),this.colour?this._updateUI():this._setColor(this.settings.defaultColor),this._bindEvents(),!0}},{key:"hide",value:function(){return this._toggleDOM(!1)}},{key:"destroy",value:function(){this._events.destroy(),this.domElement&&this.settings.parent.removeChild(this.domElement)}},{key:"_bindEvents",value:function(){var T=this,E=this,w=this.domElement,S=this._events;function P(R,N,F){S.add(R,N,F)}P(w,"click",function(R){return R.preventDefault()}),m(S,this._domH,function(R,N){return E._setHSLA(R)}),m(S,this._domSL,function(R,N){return E._setHSLA(null,R,1-N)}),this.settings.alpha&&m(S,this._domA,function(R,N){return E._setHSLA(null,null,null,1-N)});var k=this._domEdit;P(k,"input",function(R){E._setColor(this.value,{fromEditor:!0,failSilently:!0})}),P(k,"focus",function(R){var N=this;N.selectionStart===N.selectionEnd&&N.select()}),this._ifPopup(function(){var R=function(H){return T.closeHandler(H)};P(window,C,R),P(window,g,R),x(S,w,["Esc","Escape"],R);var N=function(H){T.__containedEvent=H.timeStamp};P(w,C,N),P(w,g,N),P(T._domCancel,"click",R)});var L=function(N){T._ifPopup(function(){return T.closeHandler(N)}),T.onDone&&T.onDone(T.colour)};P(this._domOkay,"click",L),x(S,w,["Enter"],L)}},{key:"_setPosition",value:function(){var T=this.settings.parent,E=this.domElement;T!==E.parentNode&&T.appendChild(E),this._ifPopup(function(w){getComputedStyle(T).position==="static"&&(T.style.position="relative");var S=w===!0?"popup_right":"popup_"+w;["popup_top","popup_bottom","popup_left","popup_right"].forEach(function(P){P===S?E.classList.add(P):E.classList.remove(P)}),E.classList.add(S)})}},{key:"_setHSLA",value:function(T,E,w,S,P){P=P||{};var k=this.colour,L=k.hsla;[T,E,w,S].forEach(function(R,N){(R||R===0)&&(L[N]=R)}),k.hsla=L,this._updateUI(P),this.onChange&&!P.silent&&this.onChange(k)}},{key:"_updateUI",value:function(T){if(!this.domElement)return;T=T||{};var E=this.colour,w=E.hsla,S="hsl("+w[0]*h+", 100%, 50%)",P=E.hslString,k=E.hslaString,L=this._domH,R=this._domSL,N=this._domA,F=b(".picker_selector",L),H=b(".picker_selector",R),V=b(".picker_selector",N);function q(Z,J,ie){J.style.left=ie*100+"%"}function Q(Z,J,ie){J.style.top=ie*100+"%"}q(L,F,w[0]),this._domSL.style.backgroundColor=this._domH.style.color=S,q(R,H,w[1]),Q(R,H,1-w[2]),R.style.color=P,Q(N,V,1-w[3]);var O=P,B=O.replace("hsl","hsla").replace(")",", 0)"),j="linear-gradient("+[O,B]+")";if(this._domA.style.background=j+", "+p,!T.fromEditor){var U=this.settings.editorFormat,z=this.settings.alpha,$=void 0;switch(U){case"rgb":$=E.printRGB(z);break;case"hsl":$=E.printHSL(z);break;default:$=E.printHex(z)}this._domEdit.value=$}this._domSample.style.color=k}},{key:"_ifPopup",value:function(T,E){this.settings.parent&&this.settings.popup?T&&T(this.settings.popup):E&&E()}},{key:"_toggleDOM",value:function(T){var E=this.domElement;if(!E)return!1;var w=T?"":"none",S=E.style.display!==w;return S&&(E.style.display=w),S}}]),_}(),v=document.createElement("style");return v.textContent='.picker_wrapper.no_alpha .picker_alpha{display:none}.picker_wrapper.no_editor .picker_editor{position:absolute;z-index:-1;opacity:0}.picker_wrapper.no_cancel .picker_cancel{display:none}.layout_default.picker_wrapper{display:flex;flex-flow:row wrap;justify-content:space-between;align-items:stretch;font-size:10px;width:25em;padding:.5em}.layout_default.picker_wrapper input,.layout_default.picker_wrapper button{font-size:1rem}.layout_default.picker_wrapper>*{margin:.5em}.layout_default.picker_wrapper::before{content:"";display:block;width:100%;height:0;order:1}.layout_default .picker_slider,.layout_default .picker_selector{padding:1em}.layout_default .picker_hue{width:100%}.layout_default .picker_sl{flex:1 1 auto}.layout_default .picker_sl::before{content:"";display:block;padding-bottom:100%}.layout_default .picker_editor{order:1;width:6.5rem}.layout_default .picker_editor input{width:100%;height:100%}.layout_default .picker_sample{order:1;flex:1 1 auto}.layout_default .picker_done,.layout_default .picker_cancel{order:1}.picker_wrapper{box-sizing:border-box;background:#f2f2f2;box-shadow:0 0 0 1px silver;cursor:default;font-family:sans-serif;color:#444;pointer-events:auto}.picker_wrapper:focus{outline:none}.picker_wrapper button,.picker_wrapper input{box-sizing:border-box;border:none;box-shadow:0 0 0 1px silver;outline:none}.picker_wrapper button:focus,.picker_wrapper button:active,.picker_wrapper input:focus,.picker_wrapper input:active{box-shadow:0 0 2px 1px #1e90ff}.picker_wrapper button{padding:.4em .6em;cursor:pointer;background-color:#f5f5f5;background-image:linear-gradient(0deg, gainsboro, transparent)}.picker_wrapper button:active{background-image:linear-gradient(0deg, transparent, gainsboro)}.picker_wrapper button:hover{background-color:#fff}.picker_selector{position:absolute;z-index:1;display:block;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%);border:2px solid #fff;border-radius:100%;box-shadow:0 0 3px 1px #67b9ff;background:currentColor;cursor:pointer}.picker_slider .picker_selector{border-radius:2px}.picker_hue{position:relative;background-image:linear-gradient(90deg, red, yellow, lime, cyan, blue, magenta, red);box-shadow:0 0 0 1px silver}.picker_sl{position:relative;box-shadow:0 0 0 1px silver;background-image:linear-gradient(180deg, white, rgba(255, 255, 255, 0) 50%),linear-gradient(0deg, black, rgba(0, 0, 0, 0) 50%),linear-gradient(90deg, #808080, rgba(128, 128, 128, 0))}.picker_alpha,.picker_sample{position:relative;background:linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%) 0 0/2em 2em,linear-gradient(45deg, lightgrey 25%, white 25%, white 75%, lightgrey 75%) 1em 1em/2em 2em;box-shadow:0 0 0 1px silver}.picker_alpha .picker_selector,.picker_sample .picker_selector{background:none}.picker_editor input{font-family:monospace;padding:.2em .4em}.picker_sample::before{content:"";position:absolute;display:block;width:100%;height:100%;background:currentColor}.picker_arrow{position:absolute;z-index:-1}.picker_wrapper.popup{position:absolute;z-index:2;margin:1.5em}.picker_wrapper.popup,.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{background:#f2f2f2;box-shadow:0 0 10px 1px rgba(0,0,0,.4)}.picker_wrapper.popup .picker_arrow{width:3em;height:3em;margin:0}.picker_wrapper.popup .picker_arrow::before,.picker_wrapper.popup .picker_arrow::after{content:"";display:block;position:absolute;top:0;left:0;z-index:-99}.picker_wrapper.popup .picker_arrow::before{width:100%;height:100%;-webkit-transform:skew(45deg);transform:skew(45deg);-webkit-transform-origin:0 100%;transform-origin:0 100%}.picker_wrapper.popup .picker_arrow::after{width:150%;height:150%;box-shadow:none}.popup.popup_top{bottom:100%;left:0}.popup.popup_top .picker_arrow{bottom:0;left:0;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.popup.popup_bottom{top:100%;left:0}.popup.popup_bottom .picker_arrow{top:0;left:0;-webkit-transform:rotate(90deg) scale(1, -1);transform:rotate(90deg) scale(1, -1)}.popup.popup_left{top:0;right:100%}.popup.popup_left .picker_arrow{top:0;right:0;-webkit-transform:scale(-1, 1);transform:scale(-1, 1)}.popup.popup_right{top:0;left:100%}.popup.popup_right .picker_arrow{top:0;left:0}',document.documentElement.firstElementChild.appendChild(v),A.StyleElement=v,A}()},9857:function(n,o,i){"use strict";i.d(o,{m:function(){return Fe}});class s extends Error{constructor(we,_e){super(we+" at position "+_e),this.position=_e}}let a=92,l=47,c=42,u=123,d=125,m=91,p=93,h=40,f=41,C=32,g=10,b=9,y=13,x=8,A=12,v=34,_=43,I=45,T=39,E=48,w=57,S=44,P=46,k=58,L=59,R=65,N=97,F=69,H=101,V=70,q=102,Q=160,O=8192,B=8202,j=8239,U=8287,z=12288,$=8220,Z=8221,J=8216,ie=8217,ne=96,le=180;function ee(Ae){return Ae>=E&&Ae<=w}function oe(Ae){return te.test(Ae)}let te=/^[,:[\]/{}()\n+]$/;function X(Ae){return W.test(Ae)||Ae&&re(Ae.charCodeAt(0))}let W=/^[[{\w-]$/;function K(Ae){return Ae===C||Ae===g||Ae===b||Ae===y}function re(Ae){return se(Ae)||Y(Ae)}function se(Ae){return Ae===v||Ae===$||Ae===Z}function me(Ae){return Ae===v}function Y(Ae){return Ae===T||Ae===J||Ae===ie||Ae===ne||Ae===le}function ae(Ae){return Ae===T}function ve(Ae,we,_e){return _e=2<arguments.length&&_e!==void 0&&_e,we=Ae.lastIndexOf(we),we!==-1?Ae.substring(0,we)+(_e?"":Ae.substring(we+1)):Ae}function ge(Ae,we){let _e=Ae.length;if(!K(Ae.charCodeAt(_e-1)))return Ae+we;for(;K(Ae.charCodeAt(_e-1));)_e--;return Ae.substring(0,_e)+we+Ae.substring(_e)}let Se={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},Ee={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function Fe(Ae){let we=0,_e="";if(!rt())throw new s("Unexpected end of json string",Ae.length);var Ke=je(S);if(Ke&&pt(),X(Ae[we])&&/[,\n][ \t\r]*$/.test(_e)){Ke||(_e=ge(_e,","));{let Ce=!0,he=!0;for(;he;)Ce?Ce=!1:je(S)||(_e=ge(_e,",")),he=rt();he||(_e=ve(_e,",")),_e=`[
`.concat(_e,`
]`)}}else Ke&&(_e=ve(_e,","));for(;Ae.charCodeAt(we)===d||Ae.charCodeAt(we)===p;)we++,pt();if(we>=Ae.length)return _e;throw new s("Unexpected character "+JSON.stringify(Ae[we]),we);function rt(){pt();var Ce=function(){if(Ae.charCodeAt(we)!==u)return!1;{_e+="{",we++,pt();let St=!0;for(;we<Ae.length&&Ae.charCodeAt(we)!==d;){let Yt;if(St?(Yt=!0,St=!1):((Yt=je(S))||(_e=ge(_e,",")),pt()),!(mt()||$e())){Ae.charCodeAt(we)===d||Ae.charCodeAt(we)===u||Ae.charCodeAt(we)===p||Ae.charCodeAt(we)===m||Ae[we]===void 0?_e=ve(_e,","):function(){throw new s("Object key expected",we)}();break}pt();var he=je(k),We=we>=Ae.length,It=(he||(X(Ae[we])||We?_e=ge(_e,":"):pe()),rt());It||(he||We?_e+="null":pe())}return Ae.charCodeAt(we)===d?(_e+="}",we++):_e=ge(_e,"}"),!0}}()||function(){if(Ae.charCodeAt(we)!==m)return!1;{_e+="[",we++,pt();let We=!0;for(;we<Ae.length&&Ae.charCodeAt(we)!==p;){We?We=!1:je(S)||(_e=ge(_e,","));var he=rt();if(!he){_e=ve(_e,",");break}}return Ae.charCodeAt(we)===p?(_e+="]",we++):_e=ge(_e,"]"),!0}}()||mt()||function(){var he=we;if(Ae.charCodeAt(we)===I){if(we++,Te())return De(he),!0;if(!ee(Ae.charCodeAt(we)))return we=he,!1}for(;ee(Ae.charCodeAt(we));)we++;if(Ae.charCodeAt(we)===P){if(we++,Te())return De(he),!0;if(!ee(Ae.charCodeAt(we)))return we=he,!1;for(;ee(Ae.charCodeAt(we));)we++}if(Ae.charCodeAt(we)===H||Ae.charCodeAt(we)===F){if(we++,Ae.charCodeAt(we)!==I&&Ae.charCodeAt(we)!==_||we++,Te())return De(he),!0;if(!ee(Ae.charCodeAt(we)))return we=he,!1;for(;ee(Ae.charCodeAt(we));)we++}var We,It;if(Te()){if(we>he)return We=Ae.slice(he,we),It=/^0\d/.test(We),_e+=It?'"'.concat(We,'"'):We,!0}else we=he;return!1}()||yt("true","true")||yt("false","false")||yt("null","null")||yt("True","true")||yt("False","false")||yt("None","null")||$e();return pt(),Ce}function pt(){let Ce=Ne();for(;Ce=(Ce=function(){if(Ae.charCodeAt(we)===l&&Ae.charCodeAt(we+1)===c){for(;we<Ae.length&&!function(he,We){return he[We]==="*"&&he[We+1]==="/"}(Ae,we);)we++;we+=2}else{if(Ae.charCodeAt(we)!==l||Ae.charCodeAt(we+1)!==l)return!1;for(;we<Ae.length&&Ae.charCodeAt(we)!==g;)we++}return!0}())&&Ne(););}function Ne(){let Ce="";for(var he,We;(he=K(Ae.charCodeAt(we)))||(We=Ae.charCodeAt(we))===Q||We>=O&&We<=B||We===j||We===U||We===z;)Ce+=he?Ae[we]:" ",we++;return 0<Ce.length&&(_e+=Ce,!0)}function je(Ce){return Ae.charCodeAt(we)===Ce&&(_e+=Ae[we],we++,!0)}function Ye(){var Ce;Ce=a,Ae.charCodeAt(we)===Ce&&we++}function mt(Ce){var he,We,It=0<arguments.length&&Ce!==void 0&&Ce;let St=Ae.charCodeAt(we)===a;if(St&&(we++,St=!0),re(Ae.charCodeAt(we))){var Yt=me(Ae.charCodeAt(we))?me:ae(Ae.charCodeAt(we))?ae:Y(Ae.charCodeAt(we))?Y:se,sr=we,Xr=_e.length;let Me='"';for(we++;;){if(we>=Ae.length)return mn=be(we-1),!It&&oe(Ae.charAt(mn))?(we=sr,_e=_e.substring(0,Xr),mt(!0)):(Me=ge(Me,'"'),_e+=Me,!0);if(Yt(Ae.charCodeAt(we))){var mn=we,no=Me.length;if(Me+='"',we++,_e+=Me,pt(),It||we>=Ae.length||oe(Ae.charAt(we))||re(Ae.charCodeAt(we))||ee(Ae.charCodeAt(we)))return vt(),!0;if(oe(Ae.charAt(be(mn-1))))return we=sr,_e=_e.substring(0,Xr),mt(!0);_e=_e.substring(0,Xr),we=mn+1,Me=Me.substring(0,no)+"\\"+Me.substring(no)}else{if(It&&oe(Ae[we]))return Me=ge(Me,'"'),_e+=Me,vt(),!0;if(Ae.charCodeAt(we)===a)if(no=Ae.charAt(we+1),Ee[no]!==void 0)Me+=Ae.slice(we,we+2),we+=2;else if(no==="u"){let Ie=2;for(;Ie<6&&((We=Ae.charCodeAt(we+Ie))>=E&&We<=w||We>=R&&We<=V||We>=N&&We<=q);)Ie++;if(Ie===6)Me+=Ae.slice(we,we+6),we+=6;else{if(!(we+Ie>=Ae.length))throw qn=void 0,qn=Ae.slice(we,we+6),new s('Invalid unicode character "'.concat(qn,'"'),we);we=Ae.length}}else Me+=no,we+=2;else{var qn=Ae.charAt(we),Ze=Ae.charCodeAt(we);if(Ze===v&&Ae.charCodeAt(we-1)!==a)Me+="\\"+qn;else if((he=Ze)===g||he===y||he===b||he===x||he===A)Me+=Se[qn];else{if(!(32<=(he=Ze)&&he<=1114111))throw Ze=void 0,Ze=qn,new s("Invalid character "+JSON.stringify(Ze),we);Me+=qn}we++}}St&&Ye()}}return!1}function vt(){let Ce=!1;for(pt();Ae.charCodeAt(we)===_;){Ce=!0,we++,pt();var he=(_e=ve(_e,'"',!0)).length,We=mt();_e=We?(We=_e,he=he,It=1,We.substring(0,he)+We.substring(he+It)):ge(_e,'"')}var It}function yt(Ce,he){return Ae.slice(we,we+Ce.length)===Ce&&(_e+=he,we+=Ce.length,!0)}function $e(){for(var Ce,he=we;we<Ae.length&&(!oe(Ce=Ae[we])||Ce==="/")&&!re(Ae.charCodeAt(we));)we++;if(we>he){if(Ae.charCodeAt(we)===h)we++,rt(),Ae.charCodeAt(we)===f&&(we++,Ae.charCodeAt(we)===L)&&we++;else{for(;K(Ae.charCodeAt(we-1))&&0<we;)we--;he=Ae.slice(he,we),_e+=he==="undefined"?"null":JSON.stringify(he),Ae.charCodeAt(we)===v&&we++}return!0}}function be(Ce){let he=Ce;for(;0<he&&K(Ae.charCodeAt(he));)he--;return he}function Te(){return we>=Ae.length||oe(Ae[we])||K(Ae.charCodeAt(we))}function De(Ce){_e+=Ae.slice(Ce,we)+"0"}function pe(){throw new s("Colon expected",we)}}},3420:function(n){"use strict";n.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#","description":"Meta-schema for $data reference (JSON Schema extension proposal)","type":"object","required":["$data"],"properties":{"$data":{"type":"string","anyOf":[{"format":"relative-json-pointer"},{"format":"json-pointer"}]}},"additionalProperties":false}')},5207:function(n){"use strict";n.exports=JSON.parse('{"id":"http://json-schema.org/draft-04/schema#","$schema":"http://json-schema.org/draft-04/schema#","description":"Core schema meta-schema","definitions":{"schemaArray":{"type":"array","minItems":1,"items":{"$ref":"#"}},"positiveInteger":{"type":"integer","minimum":0},"positiveIntegerDefault0":{"allOf":[{"$ref":"#/definitions/positiveInteger"},{"default":0}]},"simpleTypes":{"enum":["array","boolean","integer","null","number","object","string"]},"stringArray":{"type":"array","items":{"type":"string"},"minItems":1,"uniqueItems":true}},"type":"object","properties":{"id":{"type":"string"},"$schema":{"type":"string"},"title":{"type":"string"},"description":{"type":"string"},"default":{},"multipleOf":{"type":"number","minimum":0,"exclusiveMinimum":true},"maximum":{"type":"number"},"exclusiveMaximum":{"type":"boolean","default":false},"minimum":{"type":"number"},"exclusiveMinimum":{"type":"boolean","default":false},"maxLength":{"$ref":"#/definitions/positiveInteger"},"minLength":{"$ref":"#/definitions/positiveIntegerDefault0"},"pattern":{"type":"string","format":"regex"},"additionalItems":{"anyOf":[{"type":"boolean"},{"$ref":"#"}],"default":{}},"items":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/schemaArray"}],"default":{}},"maxItems":{"$ref":"#/definitions/positiveInteger"},"minItems":{"$ref":"#/definitions/positiveIntegerDefault0"},"uniqueItems":{"type":"boolean","default":false},"maxProperties":{"$ref":"#/definitions/positiveInteger"},"minProperties":{"$ref":"#/definitions/positiveIntegerDefault0"},"required":{"$ref":"#/definitions/stringArray"},"additionalProperties":{"anyOf":[{"type":"boolean"},{"$ref":"#"}],"default":{}},"definitions":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"properties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"patternProperties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"dependencies":{"type":"object","additionalProperties":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/stringArray"}]}},"enum":{"type":"array","minItems":1,"uniqueItems":true},"type":{"anyOf":[{"$ref":"#/definitions/simpleTypes"},{"type":"array","items":{"$ref":"#/definitions/simpleTypes"},"minItems":1,"uniqueItems":true}]},"format":{"type":"string"},"allOf":{"$ref":"#/definitions/schemaArray"},"anyOf":{"$ref":"#/definitions/schemaArray"},"oneOf":{"$ref":"#/definitions/schemaArray"},"not":{"$ref":"#"}},"dependencies":{"exclusiveMaximum":["maximum"],"exclusiveMinimum":["minimum"]},"default":{}}')},6801:function(n){"use strict";n.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-06/schema#","$id":"http://json-schema.org/draft-06/schema#","title":"Core schema meta-schema","definitions":{"schemaArray":{"type":"array","minItems":1,"items":{"$ref":"#"}},"nonNegativeInteger":{"type":"integer","minimum":0},"nonNegativeIntegerDefault0":{"allOf":[{"$ref":"#/definitions/nonNegativeInteger"},{"default":0}]},"simpleTypes":{"enum":["array","boolean","integer","null","number","object","string"]},"stringArray":{"type":"array","items":{"type":"string"},"uniqueItems":true,"default":[]}},"type":["object","boolean"],"properties":{"$id":{"type":"string","format":"uri-reference"},"$schema":{"type":"string","format":"uri"},"$ref":{"type":"string","format":"uri-reference"},"title":{"type":"string"},"description":{"type":"string"},"default":{},"examples":{"type":"array","items":{}},"multipleOf":{"type":"number","exclusiveMinimum":0},"maximum":{"type":"number"},"exclusiveMaximum":{"type":"number"},"minimum":{"type":"number"},"exclusiveMinimum":{"type":"number"},"maxLength":{"$ref":"#/definitions/nonNegativeInteger"},"minLength":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"pattern":{"type":"string","format":"regex"},"additionalItems":{"$ref":"#"},"items":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/schemaArray"}],"default":{}},"maxItems":{"$ref":"#/definitions/nonNegativeInteger"},"minItems":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"uniqueItems":{"type":"boolean","default":false},"contains":{"$ref":"#"},"maxProperties":{"$ref":"#/definitions/nonNegativeInteger"},"minProperties":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"required":{"$ref":"#/definitions/stringArray"},"additionalProperties":{"$ref":"#"},"definitions":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"properties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"patternProperties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"dependencies":{"type":"object","additionalProperties":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/stringArray"}]}},"propertyNames":{"$ref":"#"},"const":{},"enum":{"type":"array","minItems":1,"uniqueItems":true},"type":{"anyOf":[{"$ref":"#/definitions/simpleTypes"},{"type":"array","items":{"$ref":"#/definitions/simpleTypes"},"minItems":1,"uniqueItems":true}]},"format":{"type":"string"},"allOf":{"$ref":"#/definitions/schemaArray"},"anyOf":{"$ref":"#/definitions/schemaArray"},"oneOf":{"$ref":"#/definitions/schemaArray"},"not":{"$ref":"#"}},"default":{}}')},8198:function(n){"use strict";n.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"http://json-schema.org/draft-07/schema#","title":"Core schema meta-schema","definitions":{"schemaArray":{"type":"array","minItems":1,"items":{"$ref":"#"}},"nonNegativeInteger":{"type":"integer","minimum":0},"nonNegativeIntegerDefault0":{"allOf":[{"$ref":"#/definitions/nonNegativeInteger"},{"default":0}]},"simpleTypes":{"enum":["array","boolean","integer","null","number","object","string"]},"stringArray":{"type":"array","items":{"type":"string"},"uniqueItems":true,"default":[]}},"type":["object","boolean"],"properties":{"$id":{"type":"string","format":"uri-reference"},"$schema":{"type":"string","format":"uri"},"$ref":{"type":"string","format":"uri-reference"},"$comment":{"type":"string"},"title":{"type":"string"},"description":{"type":"string"},"default":true,"readOnly":{"type":"boolean","default":false},"examples":{"type":"array","items":true},"multipleOf":{"type":"number","exclusiveMinimum":0},"maximum":{"type":"number"},"exclusiveMaximum":{"type":"number"},"minimum":{"type":"number"},"exclusiveMinimum":{"type":"number"},"maxLength":{"$ref":"#/definitions/nonNegativeInteger"},"minLength":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"pattern":{"type":"string","format":"regex"},"additionalItems":{"$ref":"#"},"items":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/schemaArray"}],"default":true},"maxItems":{"$ref":"#/definitions/nonNegativeInteger"},"minItems":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"uniqueItems":{"type":"boolean","default":false},"contains":{"$ref":"#"},"maxProperties":{"$ref":"#/definitions/nonNegativeInteger"},"minProperties":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"required":{"$ref":"#/definitions/stringArray"},"additionalProperties":{"$ref":"#"},"definitions":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"properties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"patternProperties":{"type":"object","additionalProperties":{"$ref":"#"},"propertyNames":{"format":"regex"},"default":{}},"dependencies":{"type":"object","additionalProperties":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/stringArray"}]}},"propertyNames":{"$ref":"#"},"const":true,"enum":{"type":"array","items":true,"minItems":1,"uniqueItems":true},"type":{"anyOf":[{"$ref":"#/definitions/simpleTypes"},{"type":"array","items":{"$ref":"#/definitions/simpleTypes"},"minItems":1,"uniqueItems":true}]},"format":{"type":"string"},"contentMediaType":{"type":"string"},"contentEncoding":{"type":"string"},"if":{"$ref":"#"},"then":{"$ref":"#"},"else":{"$ref":"#"},"allOf":{"$ref":"#/definitions/schemaArray"},"anyOf":{"$ref":"#/definitions/schemaArray"},"oneOf":{"$ref":"#/definitions/schemaArray"},"not":{"$ref":"#"}},"default":true}')}},r={},e.amdD=function(){throw new Error("define cannot be used indirect")},e.n=function(n){var o=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(o,{a:o}),o},e.d=function(n,o){for(var i in o)e.o(o,i)&&!e.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:o[i]})},e.o=function(n,o){return Object.prototype.hasOwnProperty.call(n,o)},e.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.nmd=function(n){return n.paths=[],n.children||(n.children=[]),n},e(1346);function e(n){var o=r[n];return o!==void 0||(o=r[n]={id:n,loaded:!1,exports:{}},t[n].call(o.exports,o,o.exports,e),o.loaded=!0),o.exports}var t,r})});var t5={};Ui(t5,{Download:()=>Ru,DownloadBlob:()=>Q4,ImportJson:()=>hDe,ImportString:()=>fDe,LazyVolume:()=>yDe,ParseBlob:()=>iDe,ParseCcp4:()=>dDe,ParseCif:()=>bb,ParseCube:()=>sDe,ParseDsn6:()=>mDe,ParseDx:()=>pDe,ParseJson:()=>gDe,ParsePly:()=>uDe,ParsePrmtop:()=>lDe,ParsePsf:()=>aDe,ParseTop:()=>cDe,RawData:()=>J4,ReadFile:()=>e5});var Zn=function(){if(typeof window<"u"&&window.performance){let e=window.performance;return()=>e.now()}else return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?()=>{let e=process.hrtime();return e[0]*1e3+e[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();function yx(e,t=!0){if(isNaN(e))return"n/a";let r=Math.floor(e/(60*60*1e3)),n=Math.floor(e/(60*1e3)%60),o=Math.floor(e/1e3%60),i=Math.floor(e%1e3).toString();for(;i.length<3;)i="0"+i;for(;!t&&i.length>1&&i[i.length-1]==="0";)i=i.substr(0,i.length-1);return r>0?`${r}h${n}m${o}.${i}s`:n>0?`${n}m${o}.${i}s`:o>0?`${o}.${i}s`:`${e.toFixed(0)}ms`}function Mwe(){let e=function(){let f=typeof window<"u"&&window,C=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return f||typeof global<"u"&&global||C}(),t={},r=typeof document<"u"?document:void 0,n=1,o;function i(f,...C){typeof f!="function"&&(f=new Function(""+f));let g={callback:f,args:C};return t[n]=g,o(n),n++}function s(f){delete t[f]}function a(f){let C=f.callback,g=f.args;switch(g.length){case 0:C();break;case 1:C(g[0]);break;case 2:C(g[0],g[1]);break;case 3:C(g[0],g[1],g[2]);break;default:C.apply(void 0,g);break}}function l(f){let C=t[f];s(f),a(C)}function c(){o=function(f){process.nextTick(function(){l(f)})}}function u(){if(e&&e.postMessage&&!e.importScripts){let f=!0,C=e.onmessage;return e.onmessage=function(){f=!1},e.postMessage("","*"),e.onmessage=C,f}}function d(){let f="setImmediate$"+Math.random()+"$",C=function(g){g.source===e&&typeof g.data=="string"&&g.data.indexOf(f)===0&&l(+g.data.slice(f.length))};window.addEventListener?window.addEventListener("message",C,!1):window.attachEvent("onmessage",C),o=function(g){window.postMessage(f+g,"*")}}function m(){let f=new MessageChannel;f.port1.onmessage=function(C){let g=C.data;l(g)},o=function(C){f.port2.postMessage(C)}}function p(){let f=r.documentElement;o=function(C){let g=r.createElement("script");g.onreadystatechange=function(){l(C),g.onreadystatechange=null,f.removeChild(g),g=null},f.appendChild(g)}}function h(){o=function(f){setTimeout(l,0,f)}}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?c():u()?d():typeof MessageChannel<"u"?m():r&&"onreadystatechange"in r.createElement("script")?p():h(),{setImmediate:i,clearImmediate:s}}var KF=function(){return typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(e,...t)=>window.setImmediate(e,...t),clearImmediate:e=>window.clearImmediate(e)}:{setImmediate,clearImmediate}:Mwe()}();function Rwe(e){KF.setImmediate(e)}var Gh={setImmediate:KF.setImmediate,clearImmediate:KF.clearImmediate,immediatePromise(){return new Promise(Rwe)},delay(e,t=void 0){return new Promise(r=>setTimeout(r,e,t))}};var Uh=function(){try{return!0}catch{return!1}}(),lr=function(){try{let t=process.env.DEBUG;return t==="*"||t==="molstar"}catch{return!1}}(),bt=!1;function Bwe(e){typeof e<"u"&&(Uh=e)}function Lwe(e){typeof e<"u"&&(lr=e)}function Nwe(e){typeof e<"u"&&(bt=e)}var kA=[];function NW(e){kA.includes(e)||kA.push(e)}function FW(e){let t=kA.indexOf(e);t!==-1&&kA.splice(t,1)}function Fwe(){for(let e of kA)e()}var Owe=typeof performance<"u"&&!!performance.mark&&performance.measure,XF=Owe&&bt,vx;(function(e){function t(s){return`startTask${s.id}`}function r(s){return`endTask${s.id}`}function n(s){XF&&performance.mark(t(s))}e.markStart=n;function o(s){XF&&performance.mark(r(s))}e.markEnd=o;function i(s){XF&&performance.measure(`\u2733\uFE0F ${s.name}`,t(s),r(s))}e.measure=i})(vx||(vx={}));function OW(e,t,r=250){let n=zW(e,t,r),o=new vE(n,n.root);return YF(e,o)}function VW(e,t,r=250){let n=zW(e,t,r);return new vE(n,n.root)}function bE(e,t){return YF(t,e)}function GW(e,t,r){return e.runChild(t,r)}function UW(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function zW(e,t,r){let n={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:r,lastNotified:Zn(),observer:t,abortToken:n,taskId:e.id,root:{progress:UW(e),children:[]},tryAbort:Vwe(n)}}function Vwe(e){return t=>{e.abortRequested=!0,e.reason=t||e.reason}}function HW(e){return{progress:{...e.progress},children:e.children.map(HW)}}function jW(e){return e.progress.canAbort&&e.children.every(jW)}function Gwe(e){return{root:HW(e.root),canAbort:jW(e.root),requestAbort:e.tryAbort}}async function YF(e,t){vx.markStart(e),t.node.progress.startedTime=Zn();try{let r=await e.f(t);return vx.markEnd(e),vx.measure(e),t.info.abortToken.abortRequested&&$W(t.info),r}catch(r){throw ke.isAbort(r)&&(t.isAborted=!0,t.node.children.length>0&&await new Promise(n=>{t.onChildrenFinished=n}),e.onAbort&&e.onAbort()),r}}function $W(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,WW(e.root),qW(e,Zn())),ke.Aborted(e.abortToken.reason)}function WW(e){let t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(let r of e.children)WW(r)}function qW(e,t){e.lastNotified=t;let r=Gwe(e);e.observer(r)}var vE=class e{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,$W(this.info))}get shouldUpdate(){return this.checkAborted(),Zn()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(t){if(this.checkAborted(),!t)return;let r=this.node.progress;typeof t=="string"?(r.message=t,r.isIndeterminate=!0):(typeof t.canAbort<"u"&&(r.canAbort=t.canAbort),typeof t.message<"u"&&(r.message=t.message),typeof t.current<"u"&&(r.current=t.current),typeof t.max<"u"&&(r.max=t.max),r.isIndeterminate=typeof r.current>"u"||typeof r.max>"u",typeof t.isIndeterminate<"u"&&(r.isIndeterminate=t.isIndeterminate))}update(t,r){if(this.lastUpdatedTime=Zn(),this.updateProgress(t),!r)return qW(this.info,this.lastUpdatedTime),this.checkAborted(),Gh.immediatePromise()}async runChild(t,r){this.updateProgress(r);let n={progress:UW(t),children:[]},o=this.node.children;o.push(n);let i=new e(this.info,n);try{return await YF(t,i)}catch(s){if(ke.isAbort(s)&&this.isAborted)return;throw s}finally{let s=o.indexOf(n);if(s>=0){for(let a=s,l=o.length-1;a<l;a++)o[a]=o[a+1];o.pop()}o.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(t,r){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=r,this.info=t}};var QF=class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(t,r){}},bx=new QF;function ei(e=0,t=Number.MAX_SAFE_INTEGER){let r=e;return()=>{let n=r;return r=(r+1)%t,n}}var ke;(function(e){class t{run(m,p=250){return m?OW(this,m,p):this.f(bx)}runAsChild(m,p){return m.isSynchronous?this.f(bx):GW(m,this,p)}runInContext(m){return m.isSynchronous?this.f(bx):bE(m,this)}constructor(m,p,h){this.name=m,this.f=p,this.onAbort=h,this.id=u()}}function r(d){let m=d;return!!d&&typeof m.id=="number"&&typeof m.name=="string"&&!!m.run}e.is=r;function n(d){return!!d&&!!d.isAborted}e.isAbort=n;function o(d){return{isAborted:!0,reason:d,toString(){return`Aborted${d?": "+d:""}`}}}e.Aborted=o;function i(d,m,p){return new t(d,m,p)}e.create=i;function s(d,m){return i(d,async p=>m)}e.constant=s;function a(){return i("",async d=>{})}e.empty=a;function l(d,m){return i(d,async p=>{throw new Error(m)})}e.fail=l;function c(d,m){return r(d)?m?d.runInContext(m):d.run():d}e.resolveInContext=c;let u=ei(0,1073741823)})(ke||(ke={}));var JF;(function(e){e.Synchronous=bx})(JF||(JF={}));var eO;(function(e){function t(n,o=""){let i=n.progress;if(!n.children.length)return i.isIndeterminate?`${o}${i.taskName}: ${i.message}`:`${o}${i.taskName}: [${i.current}/${i.max}] ${i.message}`;let s=o+"  |_ ",a=n.children.map(l=>t(l,s));return i.isIndeterminate?`${o}${i.taskName}: ${i.message}
${a.join(`
`)}`:`${o}${i.taskName}: [${i.current}/${i.max}] ${i.message}
${a.join(`
`)}`}function r(n){return t(n.root)}e.format=r})(eO||(eO={}));async function yc(e,t,r,n,o){let i=Math.max(t,0),s=0,a=0;if(e.isSynchronous)return n(Number.MAX_SAFE_INTEGER,r),r;let l=Zn(),c=0,u=0;for(;(c=n(i,r))>0;){s+=c;let d=Zn()-l;u+=d,a+=d,e.shouldUpdate&&(await o(e,r,s),i=Math.round(u*s/a)+1,l=Zn(),u=0)}return e.shouldUpdate&&await o(e,r,s),r}var Hr;(function(e){function t(i,s=-1){return new n(i,s)}e.error=t;function r(i,s=[]){return new o(i,s)}e.success=r;class n{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(s,a){this.message=s,this.line=a,this.isError=!0}}e.Error=n;class o{constructor(s,a){this.result=s,this.warnings=a,this.isError=!1}}e.Success=o})(Hr||(Hr={}));var zi;(function(e){function t(o){return o}e.create=t;function r(o,i){return(o&i)!==0}e.has=r;function n(o,i){return!!i&&(o&i)===i}e.hasAll=n})(zi||(zi={}));var _n;(function(e){function t(x=512){return{current:[],offset:0,capacity:x,chunks:[]}}e.create=t;function r(x){return x.chunks.length?(x.offset>0&&(x.chunks[x.chunks.length]=x.current.length===x.offset?x.current.join(""):x.current.slice(0,x.offset).join("")),x.chunks.join("")):x.current.length===x.offset?x.current.join(""):x.current.splice(0,x.offset).join("")}e.getString=r;function n(x){let A=0;for(let v of x.chunks)A+=v.length;for(let v=0;v<x.offset;v++)A+=x.current[v].length;return A}e.getSize=n;function o(x){return x.offset>0&&(x.current.length===x.offset?x.chunks[x.chunks.length]=x.current.join(""):x.chunks[x.chunks.length]=x.current.slice(0,x.offset).join(""),x.offset=0),x.chunks}e.getChunks=o;let i=[];(function(){let x="";for(let A=0;A<512;A++)i[A]=x,x=x+" "})();function s(x){u(x,`
`)}e.newline=s;function a(x,A){A>0&&u(x,i[A])}e.whitespace=a;function l(x){u(x," ")}e.whitespace1=l;function c(x,A){A&&(x.offset===x.capacity&&(x.chunks[x.chunks.length]=x.current.join(""),x.offset=0),x.current[x.offset++]=A)}e.write=c;function u(x,A){x.offset===x.capacity&&(x.chunks[x.chunks.length]=x.current.join(""),x.offset=0),x.current[x.offset++]=A}e.writeSafe=u;function d(x,A,v){if(!A){a(x,v);return}let _=v-A.length;a(x,_),u(x,A)}e.writePadLeft=d;function m(x,A,v){if(!A){a(x,v);return}let _=v-A.length;u(x,A),a(x,_)}e.writePadRight=m;function p(x,A){u(x,""+A)}e.writeInteger=p;function h(x,A){u(x,""+A+" ")}e.writeIntegerAndSpace=h;function f(x,A,v){let _=""+A,I=v-_.length;a(x,I),u(x,_)}e.writeIntegerPadLeft=f;function C(x,A,v){let _=""+A,I=v-_.length;u(x,_),a(x,I)}e.writeIntegerPadRight=C;function g(x,A,v){u(x,""+Math.round(v*A)/v)}e.writeFloat=g;function b(x,A,v,_){let I=""+Math.round(v*A)/v,T=_-I.length;a(x,T),u(x,I)}e.writeFloatPadLeft=b;function y(x,A,v,_){let I=""+Math.round(v*A)/v,T=_-I.length;u(x,I),a(x,T)}e.writeFloatPadRight=y})(_n||(_n={}));var jr;(function(e){let t=typeof btoa<"u"?btoa:s=>Buffer.from(s).toString("base64"),r=[];function n(){let s=+new Date+Zn();for(let a=0;a<16;a++)r[a]=String.fromCharCode((s+Math.random()*255)%255|0),s=Math.floor(s/255);return t(r.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)}e.create22=n;function o(){let s=+new Date+Zn();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){let c=(s+Math.random()*16)%16|0;return s=Math.floor(s/16),(l==="x"?c:c&3|8).toString(16)})}e.createv4=o;function i(s){return typeof s=="string"}e.is=i})(jr||(jr={}));function Uwe(e,t){return e-t}function zwe(e){return Array.prototype.sort.call(e,Uwe),e}var tO;(function(e){class t{has(h){return!1}forEach(h,f){return f}constructor(){this.size=0}}class r{has(h){return h===this.idx}forEach(h,f){return h(this.idx,f),f}constructor(h){this.idx=h,this.size=1}}class n{has(h){return h<this.length&&!!this.mask[h]}_forEach(h,f){for(let C=0;C<this.length;C++)this.mask[C]&&h(C,f)}forEach(h,f){return this._forEach(h,f),f}constructor(h,f){this.mask=h,this.size=f,this.length=h.length}}class o{has(h){return!0}_forEach(h,f){for(let C=0;C<this.size;C++)h(C,f)}forEach(h,f){return this._forEach(h,f),f}constructor(h){this.size=h}}class i{has(h){return this.set.has(h)}_forEach(h,f){for(let C of this.flatten())h(C,f)}flatten(){if(this._flat)return this._flat;let h=new Int32Array(this.size),f=0;return this.set.forEach(C=>h[f++]=C),zwe(h),this._flat=h,this._flat}forEach(h,f){return this._forEach(h,f),f}constructor(h){this.set=h,this._flat=void 0,this.size=h.size}}function s(p){return new o(p)}e.always=s,e.never=new t;function a(p){return new i(p)}e.ofSet=a;function l(p){return new r(p)}e.singleton=l;function c(p){let h=p.length;if(h===0)return new t;if(h===1)return new r(p[0]);let f=0;for(let b of p)b>f&&(f=b);if(h===f)return new o(h);if(h/f<1/12){let b=new Set;for(let y of p)b.add(y);return new i(b)}let g=new Int8Array(f+1);for(let b of p)g[b]=1;return new n(g,p.length)}e.ofUniqueIndices=c;function u(p,h){return new n(p,h)}e.ofMask=u;function d(p,h){for(let f of h)if(p.has(f))return!0;return!1}e.hasAny=d;function m(p,h){let f=0,C=0;if(h.forEach(g=>{p.has(g)||(f++,g>C&&(C=g))}),f/C<1/12){let g=new Set;return h.forEach(b=>{p.has(b)||g.add(b)}),a(g)}else{let g=new Uint8Array(C+1);return h.forEach(b=>{p.has(b)||(g[b]=1)}),u(g,f)}}e.complement=m})(tO||(tO={}));var MA;(function(e){function t(n){return{ref:n}}e.create=t;function r(n,o){return n.ref=o,n}e.set=r})(MA||(MA={}));var Hwe=ei(0,2147483647),Af;(function(e){function t(n,o){return{id:Hwe(),version:0,value:n,metadata:o}}e.create=t;function r(n,o){return{id:n.id,version:n.version+1,value:o,metadata:n.metadata}}e.withValue=r})(Af||(Af={}));var G;(function(e){function t(i,s){return MA.create(Af.create(i,s))}e.create=t;function r(i,s){return MA.set(i,Af.withValue(i.ref,s))}e.update=r;function n(i,s){return MA.set(i,s)}e.set=n;function o(i,s){return i.ref.value!==s?r(i,s):i}e.updateIfChanged=o})(G||(G={}));var vc=function(){};function da(e,t){let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}var KW=Object.prototype.hasOwnProperty;function ul(e,t){if(e===t)return!0;let r=Array.isArray(e),n=Array.isArray(t);if(r&&n){if(e.length!==t.length)return!1;for(let o=0;o<e.length;o++)if(!ul(e[o],t[o]))return!1;return!0}if(r!==n)return!1;if(e&&t&&typeof e=="object"&&typeof t=="object"){let o=Object.keys(e);if(o.length!==Object.keys(t).length)return!1;let i=e instanceof Date,s=t instanceof Date;if(i&&s)return e.getTime()===t.getTime();if(i!==s)return!1;let a=e instanceof RegExp,l=t instanceof RegExp;if(a&&l)return e.toString()===t.toString();if(a!==l)return!1;for(let c=0;c<o.length;c++)if(!KW.call(t,o[c]))return!1;for(let c=0;c<o.length;c++)if(!ul(e[o[c]],t[o[c]]))return!1;return!0}return!1}function zh(e,t){if(e===t)return!0;let r=Array.isArray(e),n=Array.isArray(t);return r&&n?RA(e,t):r!==n?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Au(e,t):!1}function Au(e,t){if(e===t)return!0;if(!e||!t)return!1;let r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(let n of r)if(!KW.call(e,n)||e[n]!==t[n])return!1;return!0}function RA(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let r=0,n=e.length;r<n;++r)if(e[r]!==t[r])return!1;return!0}function Qi(e,t){return e!==void 0?e:t}function ZW(e){return(e<10?"0":"")+e}function XW(e){let t=e.getHours(),r=e.getMinutes(),n=e.getSeconds();return`${t}:${ZW(r)}:${ZW(n)}`}var Xc;(function(e){function t(a){let l=new DataView(a.buffer);return Object.assign(a.subarray(0),{readInt8:c=>l.getInt8(c),readUInt8:c=>l.getUint8(c),writeInt8:(c,u)=>l.setInt8(u,c),writeUInt8:(c,u)=>l.setUint8(u,c),readInt16LE:c=>l.getInt16(c,!0),readInt32LE:c=>l.getInt32(c,!0),readUInt16LE:c=>l.getUint16(c,!0),readUInt32LE:c=>l.getUint32(c,!0),readFloatLE:c=>l.getFloat32(c,!0),readDoubleLE:c=>l.getFloat64(c,!0),writeInt16LE:(c,u)=>l.setInt16(u,c,!0),writeInt32LE:(c,u)=>l.setInt32(u,c,!0),writeUInt16LE:(c,u)=>l.setUint16(u,c,!0),writeUInt32LE:(c,u)=>l.setUint32(u,c,!0),writeFloatLE:(c,u)=>l.setFloat32(u,c,!0),writeDoubleLE:(c,u)=>l.setFloat64(u,c,!0),readInt16BE:c=>l.getInt16(c,!1),readInt32BE:c=>l.getInt32(c,!1),readUInt16BE:c=>l.getUint16(c,!1),readUInt32BE:c=>l.getUint32(c,!1),readFloatBE:c=>l.getFloat32(c,!1),readDoubleBE:c=>l.getFloat64(c,!1),writeInt16BE:(c,u)=>l.setInt16(u,c,!1),writeInt32BE:(c,u)=>l.setInt32(u,c,!1),writeUInt16BE:(c,u)=>l.setUint16(u,c,!1),writeUInt32BE:(c,u)=>l.setUint32(u,c,!1),writeFloatBE:(c,u)=>l.setFloat32(u,c,!1),writeDoubleBE:(c,u)=>l.setFloat64(u,c,!1),copy:(c,u,d,m)=>(u=Qi(u,0),d=Qi(d,0),m=Qi(m,a.length),c.set(a.subarray(d,m),u),m-d)})}e.fromUint8Array=t;function r(a){return t(new Uint8Array(a))}e.fromArrayBuffer=r;function n(a){return a}e.fromBuffer=n,e.IsNativeEndianLittle=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function o(a,l,c,u,d){for(let m=0,p=c;m<p;m+=u)for(let h=0;h<u;h++)l[d+m+u-h-1]=a[d+m+h]}e.flipByteOrder=o;function i(a,l=0,c){let u=new Int16Array(a,l,c);for(let d=0,m=u.length;d<m;++d){let p=u[d];u[d]=(p&255)<<8|p>>8&255}}e.flipByteOrderInPlace2=i;function s(a,l,c,u,d){e.IsNativeEndianLittle||!c||u<=1||o(a,l,c,u,d)}e.ensureLittleEndian=s})(Xc||(Xc={}));var xx;(function(e){function t(r,n){return{name:n,readBuffer:(o,i,s,a)=>{let l,c;if(typeof i=="number"){s=Qi(s,i);let u=o,d=Math.min(r.length,u+s);l=d-u,c=Xc.fromUint8Array(new Uint8Array(r.buffer,u,d-u))}else{s=Qi(s,i.length);let u=o,d=Math.min(r.length,u+s);i.set(r.subarray(u,d),a),l=d-u,c=i}return Promise.resolve({bytesRead:l,buffer:c})},writeBuffer:(o,i,s)=>(s=Qi(s,i.length),Promise.resolve(0)),writeBufferSync:(o,i,s)=>(s=Qi(s,i.length),0),close:vc}}e.fromBuffer=t})(xx||(xx={}));var Ka;(function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"})(Ka||(Ka={}));function rO(e){return e===Ka.Float32?4:e===Ka.Int16||e===Ka.Uint16?2:1}function jwe(e,t,r=0,n){return e===Ka.Float32?new Float32Array(t,r,n):e===Ka.Int16?new Int16Array(t,r,n):e===Ka.Uint16?new Uint16Array(t,r,n):new Int8Array(t,r,n)}function YW(e,t){let r=rO(t),n=new ArrayBuffer(r*e),o=Xc.fromArrayBuffer(n),i=Xc.IsNativeEndianLittle?n:new ArrayBuffer(r*e);return{type:t,elementByteSize:r,readBuffer:o,valuesBuffer:new Uint8Array(i),values:jwe(t,i)}}async function QW(e,t,r,n,o,i){return await t.readBuffer(r,e.readBuffer,n,o),e.elementByteSize>1&&(i!==void 0&&i!==Xc.IsNativeEndianLittle||!Xc.IsNativeEndianLittle)&&Xc.flipByteOrder(e.readBuffer,e.valuesBuffer,n,e.elementByteSize,o),e.values}async function $we(e){let{buffer:r}=await e.readBuffer(0,1024),n=String.fromCharCode(r.readUInt8(52*4),r.readUInt8(52*4+1),r.readUInt8(52*4+2),r.readUInt8(52*4+3));if(n!=="MAP ")throw new Error('ccp4 format error, missing "MAP " string');let o=[r.readUInt8(53*4),r.readUInt8(53*4+1)],i=!1;o[0]===68&&o[1]===65?i=!0:o[0]===17&&o[1]===17?i=!1:r.readInt32LE(12)<=16&&(i=!0);let s=i?c=>r.readInt32LE(c*4):c=>r.readInt32BE(c*4),a=i?c=>r.readFloatLE(c*4):c=>r.readFloatBE(c*4);return{header:{NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:a(10),yLength:a(11),zLength:a(12),alpha:a(13),beta:a(14),gamma:a(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:a(19),AMAX:a(20),AMEAN:a(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:a(49),originY:a(50),originZ:a(51),MAP:n,MACHST:o,ARMS:a(54)},littleEndian:i}}async function Wwe(e,t,r,n,o,i){if(eq(e)){let s=3*o;await r.readBuffer(n,t.readBuffer,o,s);let a=new Int8Array(t.valuesBuffer.buffer,s),l=(e.AMAX-e.AMIN)/255,c=.5*(e.AMIN+e.AMAX+l);for(let u=0,d=o;u<d;++u)t.values[u]=l*a[u]+c}else await QW(t,r,n,o,0,i)}function JW(e){switch(e){case 0:return Ka.Int8;case 1:return Ka.Int16;case 2:return Ka.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:Ka.Uint16;case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error(`unknown mode '${e}'`)}function eq(e){return e.userFlag1===-128&&e.userFlag2===127}function nO(e){return eq(e)?Ka.Float32:JW(e.MODE)}function qwe(e){return 256*4+e.NSYMBT}async function Zwe(e,t,r){await r.update({message:"Parsing CCP4/MRC/MAP file..."});let{header:n,littleEndian:o}=await $we(e),i=qwe(n),s=JW(n.MODE),a=nO(n),l=n.NC*n.NR*n.NS,c=rO(s),u=l*c,d=YW(l,a);return Wwe(n,d,e,i,u,o),{header:n,values:d.values,name:e.name}}function Kwe(e,t){return ke.create("Parse CCP4/MRC/MAP",async r=>{try{return Hr.success(await Zwe(e,t,r))}catch(n){return Hr.error(n)}})}function tq(e,t){return Kwe(xx.fromBuffer(Xc.fromUint8Array(e),t),e.length)}var bi={};Ui(bi,{createAndFillArray:()=>Ywe,createArray:()=>eb,fillArrayValues:()=>rq,getArrayBounds:()=>d0,isTypedArray:()=>xE,typedArrayWindow:()=>CE});function d0(e,t){let r=t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,n=t&&typeof t.end<"u"?Math.min(t.end,e):e;return{start:r,end:n}}function eb(e,t){let r=t&&typeof t.array<"u"?t.array:Array,{start:n,end:o}=d0(e,t);return{array:new r(o-n),start:n,end:o}}function rq(e,t,r){for(let n=0,o=t.length;n<o;n++)t[n]=e(r+n);return t}function Ywe(e,t,r){let{array:n,start:o}=eb(e,r);return rq(t,n,o)}function xE(e){return!!e.buffer&&typeof e.byteLength=="number"&&typeof e.BYTES_PER_ELEMENT=="number"}function CE(e,t){let{constructor:r,buffer:n,length:o,byteOffset:i,BYTES_PER_ELEMENT:s}=e,{start:a,end:l}=d0(o,t);return a===0&&l===o?e:new r(n,i+s*a,Math.min(o,l-a))}function oo(e,t,r){return Math.abs(e-t)<=r}function Qwe(e,t,r){return(e-t)/(r-t)}function ko(e,t,r){return Math.max(t,Math.min(r,e))}function Jwe(e){return ko(e,0,1)}function zn(e,t,r){return e+(t-e)*r}function Xd(e,t,r,n,o,i){let s=(r-e)*i,a=(n-t)*i,l=o*o,c=o*l;return(2*t-2*r+s+a)*c+(-3*t+3*r-2*s-a)*l+s*o+t}function SE(e,t,r,n){let o=1-n;return o*o*e+2*o*n*t+n*n*r}function IE(e,t,r){return r=Jwe(Qwe(r,e,t)),r*r*(3-2*r)}var oO=isFinite;function D(){return D.zero()}(function(e){function t(){let pe=[.1,0,0];return pe[0]=0,pe}e.zero=t;function r(pe){let Ce=t();return Ce[0]=pe[0],Ce[1]=pe[1],Ce[2]=pe[2],Ce}e.clone=r;function n(pe){return oO(pe[0])&&oO(pe[1])&&oO(pe[2])}e.isFinite=n;function o(pe){return isNaN(pe[0])||isNaN(pe[1])||isNaN(pe[2])}e.hasNaN=o;function i(pe){return pe[0]=NaN,pe[1]=NaN,pe[2]=NaN,pe}e.setNaN=i;function s(pe){return u(pe.x,pe.y,pe.z)}e.fromObj=s;function a(pe){return{x:pe[0],y:pe[1],z:pe[2]}}e.toObj=a;function l(pe,Ce,he){return pe[0]=Ce[he+0],pe[1]=Ce[he+1],pe[2]=Ce[he+2],pe}e.fromArray=l;function c(pe,Ce,he){return Ce[he+0]=pe[0],Ce[he+1]=pe[1],Ce[he+2]=pe[2],Ce}e.toArray=c;function u(pe,Ce,he){let We=t();return We[0]=pe,We[1]=Ce,We[2]=he,We}e.create=u;function d(pe){let Ce=t();return Ce[0]=pe[0],Ce[1]=pe[1],Ce[2]=pe[2],Ce}e.ofArray=d;function m(pe,Ce,he,We){return pe[0]=Ce,pe[1]=he,pe[2]=We,pe}e.set=m;function p(pe,Ce){return pe[0]=Ce[0],pe[1]=Ce[1],pe[2]=Ce[2],pe}e.copy=p;function h(pe,Ce,he){return pe[0]=Ce[0]+he[0],pe[1]=Ce[1]+he[1],pe[2]=Ce[2]+he[2],pe}e.add=h;function f(pe,Ce,he){return pe[0]=Ce[0]-he[0],pe[1]=Ce[1]-he[1],pe[2]=Ce[2]-he[2],pe}e.sub=f;function C(pe,Ce,he){return pe[0]=Ce[0]*he[0],pe[1]=Ce[1]*he[1],pe[2]=Ce[2]*he[2],pe}e.mul=C;function g(pe,Ce,he){return pe[0]=Ce[0]/he[0],pe[1]=Ce[1]/he[1],pe[2]=Ce[2]/he[2],pe}e.div=g;function b(pe,Ce,he){return pe[0]=Ce[0]*he,pe[1]=Ce[1]*he,pe[2]=Ce[2]*he,pe}e.scale=b;function y(pe,Ce,he,We){return pe[0]=Ce[0]+he[0]*We,pe[1]=Ce[1]+he[1]*We,pe[2]=Ce[2]+he[2]*We,pe}e.scaleAndAdd=y;function x(pe,Ce,he,We){return pe[0]=Ce[0]-he[0]*We,pe[1]=Ce[1]-he[1]*We,pe[2]=Ce[2]-he[2]*We,pe}e.scaleAndSub=x;function A(pe,Ce,he){return pe[0]=Ce[0]+he,pe[1]=Ce[1]+he,pe[2]=Ce[2]+he,pe}e.addScalar=A;function v(pe,Ce,he){return pe[0]=Ce[0]-he,pe[1]=Ce[1]-he,pe[2]=Ce[2]-he,pe}e.subScalar=v;function _(pe,Ce){return pe[0]=Math.round(Ce[0]),pe[1]=Math.round(Ce[1]),pe[2]=Math.round(Ce[2]),pe}e.round=_;function I(pe,Ce){return pe[0]=Math.ceil(Ce[0]),pe[1]=Math.ceil(Ce[1]),pe[2]=Math.ceil(Ce[2]),pe}e.ceil=I;function T(pe,Ce){return pe[0]=Math.floor(Ce[0]),pe[1]=Math.floor(Ce[1]),pe[2]=Math.floor(Ce[2]),pe}e.floor=T;function E(pe,Ce){return pe[0]=Math.trunc(Ce[0]),pe[1]=Math.trunc(Ce[1]),pe[2]=Math.trunc(Ce[2]),pe}e.trunc=E;function w(pe,Ce){return pe[0]=Math.abs(Ce[0]),pe[1]=Math.abs(Ce[1]),pe[2]=Math.abs(Ce[2]),pe}e.abs=w;function S(pe,Ce,he){return pe[0]=Math.min(Ce[0],he[0]),pe[1]=Math.min(Ce[1],he[1]),pe[2]=Math.min(Ce[2],he[2]),pe}e.min=S;function P(pe,Ce,he){return pe[0]=Math.max(Ce[0],he[0]),pe[1]=Math.max(Ce[1],he[1]),pe[2]=Math.max(Ce[2],he[2]),pe}e.max=P;function k(pe,Ce,he,We){return pe[0]=Math.max(he[0],Math.min(We[0],Ce[0])),pe[1]=Math.max(he[1],Math.min(We[1],Ce[1])),pe[2]=Math.max(he[2],Math.min(We[2],Ce[2])),pe}e.clamp=k;function L(pe,Ce){let he=Ce[0]-pe[0],We=Ce[1]-pe[1],It=Ce[2]-pe[2];return Math.sqrt(he*he+We*We+It*It)}e.distance=L;function R(pe,Ce){let he=Ce[0]-pe[0],We=Ce[1]-pe[1],It=Ce[2]-pe[2];return he*he+We*We+It*It}e.squaredDistance=R;function N(pe){let Ce=pe[0],he=pe[1],We=pe[2];return Math.sqrt(Ce*Ce+he*he+We*We)}e.magnitude=N;function F(pe){let Ce=pe[0],he=pe[1],We=pe[2];return Ce*Ce+he*he+We*We}e.squaredMagnitude=F;function H(pe,Ce,he){return b(pe,Q(pe,Ce),he)}e.setMagnitude=H;function V(pe,Ce){return pe[0]=-Ce[0],pe[1]=-Ce[1],pe[2]=-Ce[2],pe}e.negate=V;function q(pe,Ce){return pe[0]=1/Ce[0],pe[1]=1/Ce[1],pe[2]=1/Ce[2],pe}e.inverse=q;function Q(pe,Ce){let he=Ce[0],We=Ce[1],It=Ce[2],St=he*he+We*We+It*It;return St>0&&(St=1/Math.sqrt(St),pe[0]=Ce[0]*St,pe[1]=Ce[1]*St,pe[2]=Ce[2]*St),pe}e.normalize=Q;function O(pe,Ce){return pe[0]*Ce[0]+pe[1]*Ce[1]+pe[2]*Ce[2]}e.dot=O;function B(pe,Ce,he){let We=Ce[0],It=Ce[1],St=Ce[2],Yt=he[0],sr=he[1],Xr=he[2];return pe[0]=It*Xr-St*sr,pe[1]=St*Yt-We*Xr,pe[2]=We*sr-It*Yt,pe}e.cross=B;function j(pe,Ce,he,We){let It=Ce[0],St=Ce[1],Yt=Ce[2];return pe[0]=It+We*(he[0]-It),pe[1]=St+We*(he[1]-St),pe[2]=Yt+We*(he[2]-Yt),pe}e.lerp=j;let U=t();function z(pe,Ce,he,We){let It=ko(O(Ce,he),-1,1),St=Math.acos(It)*We;return y(U,he,Ce,-It),Q(U,U),h(pe,b(pe,Ce,Math.cos(St)),b(U,U,Math.sin(St)))}e.slerp=z;function $(pe,Ce,he,We,It,St){let Yt=St*St,sr=Yt*(2*St-3)+1,Xr=Yt*(St-2)+St,mn=Yt*(St-1),no=Yt*(3-2*St);return pe[0]=Ce[0]*sr+he[0]*Xr+We[0]*mn+It[0]*no,pe[1]=Ce[1]*sr+he[1]*Xr+We[1]*mn+It[1]*no,pe[2]=Ce[2]*sr+he[2]*Xr+We[2]*mn+It[2]*no,pe}e.hermite=$;function Z(pe,Ce,he,We,It,St){let Yt=1-St,sr=Yt*Yt,Xr=St*St,mn=sr*Yt,no=3*St*sr,qn=3*Xr*Yt,Ze=Xr*St;return pe[0]=Ce[0]*mn+he[0]*no+We[0]*qn+It[0]*Ze,pe[1]=Ce[1]*mn+he[1]*no+We[1]*qn+It[1]*Ze,pe[2]=Ce[2]*mn+he[2]*no+We[2]*qn+It[2]*Ze,pe}e.bezier=Z;function J(pe,Ce,he,We,It){return pe[0]=SE(Ce[0],he[0],We[0],It),pe[1]=SE(Ce[1],he[1],We[1],It),pe[2]=SE(Ce[2],he[2],We[2],It),pe}e.quadraticBezier=J;function ie(pe,Ce,he,We,It,St,Yt){return pe[0]=Xd(Ce[0],he[0],We[0],It[0],St,Yt),pe[1]=Xd(Ce[1],he[1],We[1],It[1],St,Yt),pe[2]=Xd(Ce[2],he[2],We[2],It[2],St,Yt),pe}e.spline=ie;function ne(pe,Ce){let he=Math.random()*2*Math.PI,We=Math.random()*2-1,It=Math.sqrt(1-We*We)*Ce;return pe[0]=Math.cos(he)*It,pe[1]=Math.sin(he)*It,pe[2]=We*Ce,pe}e.random=ne;function le(pe,Ce,he){let We=Ce[0],It=Ce[1],St=Ce[2],Yt=1/(he[3]*We+he[7]*It+he[11]*St+he[15]||1);return pe[0]=(he[0]*We+he[4]*It+he[8]*St+he[12])*Yt,pe[1]=(he[1]*We+he[5]*It+he[9]*St+he[13])*Yt,pe[2]=(he[2]*We+he[6]*It+he[10]*St+he[14])*Yt,pe}e.transformMat4=le;function ee(pe,Ce,he){let We=Ce[0],It=Ce[1],St=Ce[2];return pe[0]=he[0]*We+he[4]*It+he[8]*St,pe[1]=he[1]*We+he[5]*It+he[9]*St,pe[2]=he[2]*We+he[6]*It+he[10]*St,Q(pe,pe)}e.transformDirection=ee;function oe(pe,Ce,he,We,It,St){let Yt=Ce[0+It],sr=Ce[1+It],Xr=Ce[2+It],mn=1/(he[3+St]*Yt+he[7+St]*sr+he[11+St]*Xr+he[15+St]||1);return pe[0+We]=(he[0+St]*Yt+he[4+St]*sr+he[8+St]*Xr+he[12+St])*mn,pe[1+We]=(he[1+St]*Yt+he[5+St]*sr+he[9+St]*Xr+he[13+St])*mn,pe[2+We]=(he[2+St]*Yt+he[6+St]*sr+he[10+St]*Xr+he[14+St])*mn,pe}e.transformMat4Offset=oe;function te(pe,Ce,he,We,It,St){let Yt=Ce[0+It],sr=Ce[1+It],Xr=Ce[2+It];pe[0+We]=he[0+St]*Yt+he[4+St]*sr+he[8+St]*Xr,pe[1+We]=he[1+St]*Yt+he[5+St]*sr+he[9+St]*Xr,pe[2+We]=he[2+St]*Yt+he[6+St]*sr+he[10+St]*Xr;let mn=Math.hypot(pe[0+We],pe[1+We],pe[2+We]);return mn>0&&(pe[0+We]/=mn,pe[1+We]/=mn,pe[2+We]/=mn),pe}e.transformDirectionOffset=te;function X(pe,Ce,he){let We=Ce[0],It=Ce[1],St=Ce[2];return pe[0]=We*he[0]+It*he[3]+St*he[6],pe[1]=We*he[1]+It*he[4]+St*he[7],pe[2]=We*he[2]+It*he[5]+St*he[8],pe}e.transformMat3=X;function W(pe,Ce,he){let We=Ce[0],It=Ce[1],St=Ce[2],Yt=he[0],sr=he[1],Xr=he[2],mn=he[3],no=mn*We+sr*St-Xr*It,qn=mn*It+Xr*We-Yt*St,Ze=mn*St+Yt*It-sr*We,Me=-Yt*We-sr*It-Xr*St;return pe[0]=no*mn+Me*-Yt+qn*-Xr-Ze*-sr,pe[1]=qn*mn+Me*-sr+Ze*-Yt-no*-Xr,pe[2]=Ze*mn+Me*-Xr+no*-sr-qn*-Yt,pe}e.transformQuat=W;function K(pe,Ce){let he=Math.sqrt(F(pe)*F(Ce));if(he===0)return Math.PI/2;let We=O(pe,Ce)/he;return Math.acos(ko(We,-1,1))}e.angle=K;let re=t(),se=t(),me=t(),Y=t(),ae=t(),ve=t(),ge=t();function Se(pe,Ce,he,We){f(re,pe,Ce),f(se,he,Ce),f(me,Ce,he),f(Y,We,he),B(ae,re,se),B(ve,me,Y);let It=K(ae,ve);return B(ge,ae,ve),O(se,ge)>0?It:-It}e.dihedralAngle=Se;function Ee(pe,Ce,he,We){return e.set(pe,We*Math.cos(he)*Math.sin(Ce),We*Math.sin(he)*Math.sin(Ce),We*Math.cos(Ce))}e.directionFromSpherical=Ee;function Fe(pe,Ce){return pe[0]===Ce[0]&&pe[1]===Ce[1]&&pe[2]===Ce[2]}e.exactEquals=Fe;function Ae(pe,Ce){let he=pe[0],We=pe[1],It=pe[2],St=Ce[0],Yt=Ce[1],sr=Ce[2];return Math.abs(he-St)<=1e-6*Math.max(1,Math.abs(he),Math.abs(St))&&Math.abs(We-Yt)<=1e-6*Math.max(1,Math.abs(We),Math.abs(Yt))&&Math.abs(It-sr)<=1e-6*Math.max(1,Math.abs(It),Math.abs(sr))}e.equals=Ae;let we=t();function _e(pe,Ce,he){let We=K(Ce,he);if(Math.abs(We)<1e-4)return de.setIdentity(pe);if(Math.abs(We-Math.PI)<1e-6)return de.fromScaling(pe,e.negUnit);let It=B(we,Ce,he);return de.fromRotation(pe,We,It)}e.makeRotation=_e;function Ke(pe){return pe[0]===0&&pe[1]===0&&pe[2]===0}e.isZero=Ke;function rt(pe,Ce,he,We){f(pe,Ce,We);let It=O(he,pe)/F(he);return h(pe,b(pe,he,It),We)}e.projectPointOnVector=rt;let pt=t();function Ne(pe,Ce,he,We){return Q(pt,he),f(pe,Ce,We),f(pe,Ce,b(pt,pt,O(pe,pt)))}e.projectPointOnPlane=Ne;function je(pe,Ce,he){let We=O(he,Ce)/F(he);return b(pe,he,We)}e.projectOnVector=je;let Ye=t();function mt(pe,Ce,he){return je(Ye,Ce,he),f(pe,Ce,Ye)}e.projectOnPlane=mt;function vt(pe,Ce,he){return Q(pe,B(pe,B(pe,Ce,he),Ce))}e.orthogonalize=vt;function yt(pe,Ce,he){return O(Ce,he)>0?p(pe,Ce):V(pe,p(pe,Ce)),pe}e.matchDirection=yt;let $e=t(),be=t();function Te(pe,Ce,he,We){return f($e,he,Ce),f(be,We,Ce),Q(pe,B(pe,$e,be))}e.triangleNormal=Te;function De(pe,Ce){return`[${pe[0].toPrecision(Ce)} ${pe[1].toPrecision(Ce)} ${pe[2].toPrecision(Ce)}]`}e.toString=De,e.origin=u(0,0,0),e.unit=u(1,1,1),e.negUnit=u(-1,-1,-1),e.unitX=u(1,0,0),e.unitY=u(0,1,0),e.unitZ=u(0,0,1),e.negUnitX=u(-1,0,0),e.negUnitY=u(0,-1,0),e.negUnitZ=u(0,0,-1)})(D||(D={}));var tb=Math.PI/2,nq=Math.PI/180;function Pr(e){return e*nq}function ma(e){return e/nq}function m0(e){return e!==0&&(e&e-1)===0}function oq(...e){let t=0,r=0;for(let n=0,o=e.length;n<o;++n){let i=e[n],s=Math.abs(i);s>r&&(t=i,r=s)}return t}function AE(e,t){return e*t}function iq(e){let t=0,r=0,n=[0,-1],o=e*2+1,i=o/2,s=[];for(let a=Math.pow(o,2);a>0;--a)-i<t&&t<=i&&-i<r&&r<=i&&s.push([t,r]),(t===r||t<0&&t===-r||t>0&&t===1-r)&&([n[0],n[1]]=[-n[1],n[0]]),t+=n[0],r+=n[1];return s}function de(){return de.zero()}(function(e){function t(){let Y=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return Y[0]=0,Y}e.zero=t;function r(){let Y=t();return Y[0]=1,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=1,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[10]=1,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y}e.identity=r;function n(Y){return Y[0]=1,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=1,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[10]=1,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y}e.setIdentity=n;function o(Y){for(let ae=0;ae<16;ae++)Y[ae]=0;return Y}e.setZero=o;function i(Y){let ae=t();for(let ve=0;ve<4;ve++){let ge=Y[ve];for(let Se=0;Se<4;Se++)ae[4*Se+ve]=ge[Se]}return ae}e.ofRows=i;let s=r();function a(Y,ae){return c(Y,s,typeof ae>"u"?1e-6:ae)}e.isIdentity=a;function l(Y){for(let ae=0;ae<16;ae++)if(isNaN(Y[ae]))return!0;return!1}e.hasNaN=l;function c(Y,ae,ve){for(let ge=0;ge<16;ge++)if(Math.abs(Y[ge]-ae[ge])>ve)return!1;return!0}e.areEqual=c;function u(Y,ae,ve,ge){Y[4*ve+ae]=ge}e.setValue=u;function d(Y,ae,ve){return Y[4*ve+ae]}e.getValue=d;function m(Y,ae,ve){return ae[ve+0]=Y[0],ae[ve+1]=Y[1],ae[ve+2]=Y[2],ae[ve+3]=Y[3],ae[ve+4]=Y[4],ae[ve+5]=Y[5],ae[ve+6]=Y[6],ae[ve+7]=Y[7],ae[ve+8]=Y[8],ae[ve+9]=Y[9],ae[ve+10]=Y[10],ae[ve+11]=Y[11],ae[ve+12]=Y[12],ae[ve+13]=Y[13],ae[ve+14]=Y[14],ae[ve+15]=Y[15],ae}e.toArray=m;function p(Y,ae,ve){return Y[0]=ae[ve+0],Y[1]=ae[ve+1],Y[2]=ae[ve+2],Y[3]=ae[ve+3],Y[4]=ae[ve+4],Y[5]=ae[ve+5],Y[6]=ae[ve+6],Y[7]=ae[ve+7],Y[8]=ae[ve+8],Y[9]=ae[ve+9],Y[10]=ae[ve+10],Y[11]=ae[ve+11],Y[12]=ae[ve+12],Y[13]=ae[ve+13],Y[14]=ae[ve+14],Y[15]=ae[ve+15],Y}e.fromArray=p;function h(Y,ae,ve,ge){return o(Y),u(Y,0,0,ae[0]),u(Y,1,0,ae[1]),u(Y,2,0,ae[2]),u(Y,0,1,ve[0]),u(Y,1,1,ve[1]),u(Y,2,1,ve[2]),u(Y,0,2,ge[0]),u(Y,1,2,ge[1]),u(Y,2,2,ge[2]),u(Y,3,3,1),Y}e.fromBasis=h;function f(Y,ae){return Y[0]=ae[0],Y[1]=ae[1],Y[2]=ae[2],Y[3]=ae[3],Y[4]=ae[4],Y[5]=ae[5],Y[6]=ae[6],Y[7]=ae[7],Y[8]=ae[8],Y[9]=ae[9],Y[10]=ae[10],Y[11]=ae[11],Y[12]=ae[12],Y[13]=ae[13],Y[14]=ae[14],Y[15]=ae[15],Y}e.copy=f;function C(Y){return f(t(),Y)}e.clone=C;function g(Y,ae){return Y[0]=ae[12],Y[1]=ae[13],Y[2]=ae[14],Y}e.getTranslation=g;function b(Y,ae){let ve=ae[0],ge=ae[1],Se=ae[2],Ee=ae[4],Fe=ae[5],Ae=ae[6],we=ae[8],_e=ae[9],Ke=ae[10];return Y[0]=Math.sqrt(ve*ve+ge*ge+Se*Se),Y[1]=Math.sqrt(Ee*Ee+Fe*Fe+Ae*Ae),Y[2]=Math.sqrt(we*we+_e*_e+Ke*Ke),Y}e.getScaling=b;function y(Y,ae){let ve=ae[0]+ae[5]+ae[10],ge=0;return ve>0?(ge=Math.sqrt(ve+1)*2,Y[3]=.25*ge,Y[0]=(ae[6]-ae[9])/ge,Y[1]=(ae[8]-ae[2])/ge,Y[2]=(ae[1]-ae[4])/ge):ae[0]>ae[5]&&ae[0]>ae[10]?(ge=Math.sqrt(1+ae[0]-ae[5]-ae[10])*2,Y[3]=(ae[6]-ae[9])/ge,Y[0]=.25*ge,Y[1]=(ae[1]+ae[4])/ge,Y[2]=(ae[8]+ae[2])/ge):ae[5]>ae[10]?(ge=Math.sqrt(1+ae[5]-ae[0]-ae[10])*2,Y[3]=(ae[8]-ae[2])/ge,Y[0]=(ae[1]+ae[4])/ge,Y[1]=.25*ge,Y[2]=(ae[6]+ae[9])/ge):(ge=Math.sqrt(1+ae[10]-ae[0]-ae[5])*2,Y[3]=(ae[1]-ae[4])/ge,Y[0]=(ae[8]+ae[2])/ge,Y[1]=(ae[6]+ae[9])/ge,Y[2]=.25*ge),Y}e.getRotation=y;function x(Y,ae){let ve=1/Math.sqrt(ae[0]*ae[0]+ae[1]*ae[1]+ae[2]*ae[2]),ge=1/Math.sqrt(ae[4]*ae[4]+ae[5]*ae[5]+ae[6]*ae[6]),Se=1/Math.sqrt(ae[8]*ae[8]+ae[9]*ae[9]+ae[10]*ae[10]);return Y[0]=ae[0]*ve,Y[1]=ae[1]*ve,Y[2]=ae[2]*ve,Y[3]=0,Y[4]=ae[4]*ge,Y[5]=ae[5]*ge,Y[6]=ae[6]*ge,Y[7]=0,Y[8]=ae[8]*Se,Y[9]=ae[9]*Se,Y[10]=ae[10]*Se,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y}e.extractRotation=x;function A(Y,ae){if(Y===ae){let ve=ae[1],ge=ae[2],Se=ae[3],Ee=ae[6],Fe=ae[7],Ae=ae[11];Y[1]=ae[4],Y[2]=ae[8],Y[3]=ae[12],Y[4]=ve,Y[6]=ae[9],Y[7]=ae[13],Y[8]=ge,Y[9]=Ee,Y[11]=ae[14],Y[12]=Se,Y[13]=Fe,Y[14]=Ae}else Y[0]=ae[0],Y[1]=ae[4],Y[2]=ae[8],Y[3]=ae[12],Y[4]=ae[1],Y[5]=ae[5],Y[6]=ae[9],Y[7]=ae[13],Y[8]=ae[2],Y[9]=ae[6],Y[10]=ae[10],Y[11]=ae[14],Y[12]=ae[3],Y[13]=ae[7],Y[14]=ae[11],Y[15]=ae[15];return Y}e.transpose=A;function v(Y,ae){let ve=ae[0],ge=ae[1],Se=ae[2],Ee=ae[3],Fe=ae[4],Ae=ae[5],we=ae[6],_e=ae[7],Ke=ae[8],rt=ae[9],pt=ae[10],Ne=ae[11],je=ae[12],Ye=ae[13],mt=ae[14],vt=ae[15],yt=ve*Ae-ge*Fe,$e=ve*we-Se*Fe,be=ve*_e-Ee*Fe,Te=ge*we-Se*Ae,De=ge*_e-Ee*Ae,pe=Se*_e-Ee*we,Ce=Ke*Ye-rt*je,he=Ke*mt-pt*je,We=Ke*vt-Ne*je,It=rt*mt-pt*Ye,St=rt*vt-Ne*Ye,Yt=pt*vt-Ne*mt,sr=yt*Yt-$e*St+be*It+Te*We-De*he+pe*Ce;return sr?(sr=1/sr,Y[0]=(Ae*Yt-we*St+_e*It)*sr,Y[1]=(Se*St-ge*Yt-Ee*It)*sr,Y[2]=(Ye*pe-mt*De+vt*Te)*sr,Y[3]=(pt*De-rt*pe-Ne*Te)*sr,Y[4]=(we*We-Fe*Yt-_e*he)*sr,Y[5]=(ve*Yt-Se*We+Ee*he)*sr,Y[6]=(mt*be-je*pe-vt*$e)*sr,Y[7]=(Ke*pe-pt*be+Ne*$e)*sr,Y[8]=(Fe*St-Ae*We+_e*Ce)*sr,Y[9]=(ge*We-ve*St-Ee*Ce)*sr,Y[10]=(je*De-Ye*be+vt*yt)*sr,Y[11]=(rt*be-Ke*De-Ne*yt)*sr,Y[12]=(Ae*he-Fe*It-we*Ce)*sr,Y[13]=(ve*It-ge*he+Se*Ce)*sr,Y[14]=(Ye*$e-je*Te-mt*yt)*sr,Y[15]=(Ke*Te-rt*$e+pt*yt)*sr,!0):!1}e.tryInvert=v;function _(Y,ae){return v(Y,ae),Y}e.invert=_;function I(Y,ae,ve){let ge=ae[0],Se=ae[1],Ee=ae[2],Fe=ae[3],Ae=ae[4],we=ae[5],_e=ae[6],Ke=ae[7],rt=ae[8],pt=ae[9],Ne=ae[10],je=ae[11],Ye=ae[12],mt=ae[13],vt=ae[14],yt=ae[15],$e=ve[0],be=ve[1],Te=ve[2],De=ve[3];return Y[0]=$e*ge+be*Ae+Te*rt+De*Ye,Y[1]=$e*Se+be*we+Te*pt+De*mt,Y[2]=$e*Ee+be*_e+Te*Ne+De*vt,Y[3]=$e*Fe+be*Ke+Te*je+De*yt,$e=ve[4],be=ve[5],Te=ve[6],De=ve[7],Y[4]=$e*ge+be*Ae+Te*rt+De*Ye,Y[5]=$e*Se+be*we+Te*pt+De*mt,Y[6]=$e*Ee+be*_e+Te*Ne+De*vt,Y[7]=$e*Fe+be*Ke+Te*je+De*yt,$e=ve[8],be=ve[9],Te=ve[10],De=ve[11],Y[8]=$e*ge+be*Ae+Te*rt+De*Ye,Y[9]=$e*Se+be*we+Te*pt+De*mt,Y[10]=$e*Ee+be*_e+Te*Ne+De*vt,Y[11]=$e*Fe+be*Ke+Te*je+De*yt,$e=ve[12],be=ve[13],Te=ve[14],De=ve[15],Y[12]=$e*ge+be*Ae+Te*rt+De*Ye,Y[13]=$e*Se+be*we+Te*pt+De*mt,Y[14]=$e*Ee+be*_e+Te*Ne+De*vt,Y[15]=$e*Fe+be*Ke+Te*je+De*yt,Y}e.mul=I;function T(Y,ae,ve,ge,Se,Ee){let Fe=ae[0+Se],Ae=ae[1+Se],we=ae[2+Se],_e=ae[3+Se],Ke=ae[4+Se],rt=ae[5+Se],pt=ae[6+Se],Ne=ae[7+Se],je=ae[8+Se],Ye=ae[9+Se],mt=ae[10+Se],vt=ae[11+Se],yt=ae[12+Se],$e=ae[13+Se],be=ae[14+Se],Te=ae[15+Se],De=ve[0+Ee],pe=ve[1+Ee],Ce=ve[2+Ee],he=ve[3+Ee];return Y[0+ge]=De*Fe+pe*Ke+Ce*je+he*yt,Y[1+ge]=De*Ae+pe*rt+Ce*Ye+he*$e,Y[2+ge]=De*we+pe*pt+Ce*mt+he*be,Y[3+ge]=De*_e+pe*Ne+Ce*vt+he*Te,De=ve[4+Ee],pe=ve[5+Ee],Ce=ve[6+Ee],he=ve[7+Ee],Y[4+ge]=De*Fe+pe*Ke+Ce*je+he*yt,Y[5+ge]=De*Ae+pe*rt+Ce*Ye+he*$e,Y[6+ge]=De*we+pe*pt+Ce*mt+he*be,Y[7+ge]=De*_e+pe*Ne+Ce*vt+he*Te,De=ve[8+Ee],pe=ve[9+Ee],Ce=ve[10+Ee],he=ve[11+Ee],Y[8+ge]=De*Fe+pe*Ke+Ce*je+he*yt,Y[9+ge]=De*Ae+pe*rt+Ce*Ye+he*$e,Y[10+ge]=De*we+pe*pt+Ce*mt+he*be,Y[11+ge]=De*_e+pe*Ne+Ce*vt+he*Te,De=ve[12+Ee],pe=ve[13+Ee],Ce=ve[14+Ee],he=ve[15+Ee],Y[12+ge]=De*Fe+pe*Ke+Ce*je+he*yt,Y[13+ge]=De*Ae+pe*rt+Ce*Ye+he*$e,Y[14+ge]=De*we+pe*pt+Ce*mt+he*be,Y[15+ge]=De*_e+pe*Ne+Ce*vt+he*Te,Y}e.mulOffset=T;function E(Y,ae,ve,ge){return I(Y,I(Y,ae,ve),ge)}e.mul3=E;function w(Y,ae,ve){let ge=ve[0],Se=ve[1],Ee=ve[2],Fe,Ae,we,_e,Ke,rt,pt,Ne,je,Ye,mt,vt;return ae===Y?(Y[12]=ae[0]*ge+ae[4]*Se+ae[8]*Ee+ae[12],Y[13]=ae[1]*ge+ae[5]*Se+ae[9]*Ee+ae[13],Y[14]=ae[2]*ge+ae[6]*Se+ae[10]*Ee+ae[14],Y[15]=ae[3]*ge+ae[7]*Se+ae[11]*Ee+ae[15]):(Fe=ae[0],Ae=ae[1],we=ae[2],_e=ae[3],Ke=ae[4],rt=ae[5],pt=ae[6],Ne=ae[7],je=ae[8],Ye=ae[9],mt=ae[10],vt=ae[11],Y[0]=Fe,Y[1]=Ae,Y[2]=we,Y[3]=_e,Y[4]=Ke,Y[5]=rt,Y[6]=pt,Y[7]=Ne,Y[8]=je,Y[9]=Ye,Y[10]=mt,Y[11]=vt,Y[12]=Fe*ge+Ke*Se+je*Ee+ae[12],Y[13]=Ae*ge+rt*Se+Ye*Ee+ae[13],Y[14]=we*ge+pt*Se+mt*Ee+ae[14],Y[15]=_e*ge+Ne*Se+vt*Ee+ae[15]),Y}e.translate=w;function S(Y,ae){return Y[0]=1,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=1,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[10]=1,Y[11]=0,Y[12]=ae[0],Y[13]=ae[1],Y[14]=ae[2],Y[15]=1,Y}e.fromTranslation=S;function P(Y,ae){return Y[12]=ae[0],Y[13]=ae[1],Y[14]=ae[2],Y}e.setTranslation=P;function k(Y,ae,ve,ge){return Y[0]=ve[0],Y[4]=ve[1],Y[8]=ve[2],Y[1]=ge[0],Y[5]=ge[1],Y[9]=ge[2],Y[2]=ae[0],Y[6]=ae[1],Y[10]=ae[2],Y}e.setAxes=k;function L(Y,ae,ve,ge){let Se=ge[0],Ee=ge[1],Fe=ge[2],Ae=Math.sqrt(Se*Se+Ee*Ee+Fe*Fe);if(Math.abs(Ae)<1e-6)return r();Ae=1/Ae,Se*=Ae,Ee*=Ae,Fe*=Ae;let we=Math.sin(ve),_e=Math.cos(ve),Ke=1-_e,rt=ae[0],pt=ae[1],Ne=ae[2],je=ae[3],Ye=ae[4],mt=ae[5],vt=ae[6],yt=ae[7],$e=ae[8],be=ae[9],Te=ae[10],De=ae[11],pe=Se*Se*Ke+_e,Ce=Ee*Se*Ke+Fe*we,he=Fe*Se*Ke-Ee*we,We=Se*Ee*Ke-Fe*we,It=Ee*Ee*Ke+_e,St=Fe*Ee*Ke+Se*we,Yt=Se*Fe*Ke+Ee*we,sr=Ee*Fe*Ke-Se*we,Xr=Fe*Fe*Ke+_e;return Y[0]=rt*pe+Ye*Ce+$e*he,Y[1]=pt*pe+mt*Ce+be*he,Y[2]=Ne*pe+vt*Ce+Te*he,Y[3]=je*pe+yt*Ce+De*he,Y[4]=rt*We+Ye*It+$e*St,Y[5]=pt*We+mt*It+be*St,Y[6]=Ne*We+vt*It+Te*St,Y[7]=je*We+yt*It+De*St,Y[8]=rt*Yt+Ye*sr+$e*Xr,Y[9]=pt*Yt+mt*sr+be*Xr,Y[10]=Ne*Yt+vt*sr+Te*Xr,Y[11]=je*Yt+yt*sr+De*Xr,ae!==Y&&(Y[12]=ae[12],Y[13]=ae[13],Y[14]=ae[14],Y[15]=ae[15]),Y}e.rotate=L;function R(Y,ae,ve){let ge=ve[0],Se=ve[1],Ee=ve[2],Fe=Math.sqrt(ge*ge+Se*Se+Ee*Ee);if(Math.abs(Fe)<1e-6)return n(Y);Fe=1/Fe,ge*=Fe,Se*=Fe,Ee*=Fe;let Ae=Math.sin(ae),we=Math.cos(ae),_e=1-we;return Y[0]=ge*ge*_e+we,Y[1]=Se*ge*_e+Ee*Ae,Y[2]=Ee*ge*_e-Se*Ae,Y[3]=0,Y[4]=ge*Se*_e-Ee*Ae,Y[5]=Se*Se*_e+we,Y[6]=Ee*Se*_e+ge*Ae,Y[7]=0,Y[8]=ge*Ee*_e+Se*Ae,Y[9]=Se*Ee*_e-ge*Ae,Y[10]=Ee*Ee*_e+we,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y}e.fromRotation=R;function N(Y,ae,ve){let ge=ve[0],Se=ve[1],Ee=ve[2];return Y[0]=ae[0]*ge,Y[1]=ae[1]*ge,Y[2]=ae[2]*ge,Y[3]=ae[3]*ge,Y[4]=ae[4]*Se,Y[5]=ae[5]*Se,Y[6]=ae[6]*Se,Y[7]=ae[7]*Se,Y[8]=ae[8]*Ee,Y[9]=ae[9]*Ee,Y[10]=ae[10]*Ee,Y[11]=ae[11]*Ee,Y[12]=ae[12],Y[13]=ae[13],Y[14]=ae[14],Y[15]=ae[15],Y}e.scale=N;function F(Y,ae,ve){return Y[0]=ae[0]*ve,Y[1]=ae[1]*ve,Y[2]=ae[2]*ve,Y[3]=ae[3]*ve,Y[4]=ae[4]*ve,Y[5]=ae[5]*ve,Y[6]=ae[6]*ve,Y[7]=ae[7]*ve,Y[8]=ae[8]*ve,Y[9]=ae[9]*ve,Y[10]=ae[10]*ve,Y[11]=ae[11]*ve,Y[12]=ae[12],Y[13]=ae[13],Y[14]=ae[14],Y[15]=ae[15],Y}e.scaleUniformly=F;function H(Y,ae){return Y[0]=ae[0],Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=ae[1],Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[10]=ae[2],Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y}e.fromScaling=H;function V(Y,ae){return Y[0]=ae,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=ae,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[10]=ae,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y}e.fromUniformScaling=V;function q(Y,ae){return Y[0]=ae[0],Y[1]=ae[1],Y[2]=ae[2],Y[4]=ae[3],Y[5]=ae[4],Y[6]=ae[5],Y[8]=ae[6],Y[9]=ae[7],Y[10]=ae[8],Y}e.fromMat3=q;function Q(Y,ae,ve,ge){let[Se,Ee,Fe,Ae]=ve,we=Se+Se,_e=Ee+Ee,Ke=Fe+Fe,rt=Se*we,pt=Se*_e,Ne=Se*Ke,je=Ee*_e,Ye=Ee*Ke,mt=Fe*Ke,vt=Ae*we,yt=Ae*_e,$e=Ae*Ke,[be,Te,De]=ge;return Y[0]=(1-(je+mt))*be,Y[1]=(pt+$e)*be,Y[2]=(Ne-yt)*be,Y[3]=0,Y[4]=(pt-$e)*Te,Y[5]=(1-(rt+mt))*Te,Y[6]=(Ye+vt)*Te,Y[7]=0,Y[8]=(Ne+yt)*De,Y[9]=(Ye-vt)*De,Y[10]=(1-(rt+je))*De,Y[11]=0,Y[12]=ae[0],Y[13]=ae[1],Y[14]=ae[2],Y[15]=1,Y}e.compose=Q;let O=[0,0,0],B=t();function j(Y,ae,ve,ge){let Se=D.magnitude(D.set(O,Y[0],Y[1],Y[2])),Ee=D.magnitude(D.set(O,Y[4],Y[5],Y[6])),Fe=D.magnitude(D.set(O,Y[8],Y[9],Y[10]));z(Y)<0&&(Se=-Se),ae[0]=Y[12],ae[1]=Y[13],ae[2]=Y[14],f(B,Y);let we=1/Se,_e=1/Ee,Ke=1/Fe;return B[0]*=we,B[1]*=we,B[2]*=we,B[4]*=_e,B[5]*=_e,B[6]*=_e,B[8]*=Ke,B[9]*=Ke,B[10]*=Ke,y(ve,B),ge[0]=Se,ge[1]=Ee,ge[2]=Fe,Y}e.decompose=j;function U(Y){let ae="";for(let ve=0;ve<4;ve++){for(let ge=0;ge<4;ge++)ae+=Y[4*ge+ve].toString(),ge<3&&(ae+=" ");ve<3&&(ae+=`
`)}return ae}e.makeTable=U;function z(Y){let ae=Y[0],ve=Y[1],ge=Y[2],Se=Y[3],Ee=Y[4],Fe=Y[5],Ae=Y[6],we=Y[7],_e=Y[8],Ke=Y[9],rt=Y[10],pt=Y[11],Ne=Y[12],je=Y[13],Ye=Y[14],mt=Y[15],vt=ae*Fe-ve*Ee,yt=ae*Ae-ge*Ee,$e=ae*we-Se*Ee,be=ve*Ae-ge*Fe,Te=ve*we-Se*Fe,De=ge*we-Se*Ae,pe=_e*je-Ke*Ne,Ce=_e*Ye-rt*Ne,he=_e*mt-pt*Ne,We=Ke*Ye-rt*je,It=Ke*mt-pt*je,St=rt*mt-pt*Ye;return vt*St-yt*It+$e*We+be*he-Te*Ce+De*pe}e.determinant=z;function $(Y,ae){return Z(Y,typeof ae<"u"?ae:1e-6)}e.isRotationAndTranslation=$;function Z(Y,ae){let ve=Y[0],ge=Y[1],Se=Y[2],Ee=Y[3],Fe=Y[4],Ae=Y[5],we=Y[6],_e=Y[7],Ke=Y[8],rt=Y[9],pt=Y[10],Ne=Y[11],je=Y[15];if(!oo(je,1,ae)||!oo(Ee,0,ae)||!oo(_e,0,ae)||!oo(Ne,0,ae))return!1;let Ye=Math.abs(ve*(Ae*pt-we*rt)-ge*(Fe*pt-we*Ke)+Se*(Fe*rt-Ae*Ke));return!!oo(Ye,1,ae)}function J(Y,ae){return ie(Y,typeof ae<"u"?ae:1e-6)}e.isTranslationAndUniformScaling=J;function ie(Y,ae){let ve=Y[0];return oo(Y[1],0,ae)&&oo(Y[2],0,ae)&&oo(Y[3],0,ae)&&oo(Y[4],0,ae)&&oo(Y[5],ve,ae)&&oo(Y[6],0,ae)&&oo(Y[7],0,ae)&&oo(Y[8],0,ae)&&oo(Y[9],0,ae)&&oo(Y[10],ve,ae)&&oo(Y[11],0,ae)&&oo(Y[15],1,ae)}function ne(Y,ae){let ve=ae[0],ge=ae[1],Se=ae[2],Ee=ae[3],Fe=ve+ve,Ae=ge+ge,we=Se+Se,_e=ve*Fe,Ke=ge*Fe,rt=ge*Ae,pt=Se*Fe,Ne=Se*Ae,je=Se*we,Ye=Ee*Fe,mt=Ee*Ae,vt=Ee*we;return Y[0]=1-rt-je,Y[1]=Ke+vt,Y[2]=pt-mt,Y[3]=0,Y[4]=Ke-vt,Y[5]=1-_e-je,Y[6]=Ne+Ye,Y[7]=0,Y[8]=pt+mt,Y[9]=Ne-Ye,Y[10]=1-_e-rt,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y}e.fromQuat=ne;function le(Y,ae,ve){let ge=ae[0],Se=ae[1],Ee=ae[2],Fe=Math.cos(ge),Ae=Math.sin(ge),we=Math.cos(Se),_e=Math.sin(Se),Ke=Math.cos(Ee),rt=Math.sin(Ee);if(ve==="XYZ"){let pt=Fe*Ke,Ne=Fe*rt,je=Ae*Ke,Ye=Ae*rt;Y[0]=we*Ke,Y[4]=-we*rt,Y[8]=_e,Y[1]=Ne+je*_e,Y[5]=pt-Ye*_e,Y[9]=-Ae*we,Y[2]=Ye-pt*_e,Y[6]=je+Ne*_e,Y[10]=Fe*we}else if(ve==="YXZ"){let pt=we*Ke,Ne=we*rt,je=_e*Ke,Ye=_e*rt;Y[0]=pt+Ye*Ae,Y[4]=je*Ae-Ne,Y[8]=Fe*_e,Y[1]=Fe*rt,Y[5]=Fe*Ke,Y[9]=-Ae,Y[2]=Ne*Ae-je,Y[6]=Ye+pt*Ae,Y[10]=Fe*we}else if(ve==="ZXY"){let pt=we*Ke,Ne=we*rt,je=_e*Ke,Ye=_e*rt;Y[0]=pt-Ye*Ae,Y[4]=-Fe*rt,Y[8]=je+Ne*Ae,Y[1]=Ne+je*Ae,Y[5]=Fe*Ke,Y[9]=Ye-pt*Ae,Y[2]=-Fe*_e,Y[6]=Ae,Y[10]=Fe*we}else if(ve==="ZYX"){let pt=Fe*Ke,Ne=Fe*rt,je=Ae*Ke,Ye=Ae*rt;Y[0]=we*Ke,Y[4]=je*_e-Ne,Y[8]=pt*_e+Ye,Y[1]=we*rt,Y[5]=Ye*_e+pt,Y[9]=Ne*_e-je,Y[2]=-_e,Y[6]=Ae*we,Y[10]=Fe*we}else if(ve==="YZX"){let pt=Fe*we,Ne=Fe*_e,je=Ae*we,Ye=Ae*_e;Y[0]=we*Ke,Y[4]=Ye-pt*rt,Y[8]=je*rt+Ne,Y[1]=rt,Y[5]=Fe*Ke,Y[9]=-Ae*Ke,Y[2]=-_e*Ke,Y[6]=Ne*rt+je,Y[10]=pt-Ye*rt}else if(ve==="XZY"){let pt=Fe*we,Ne=Fe*_e,je=Ae*we,Ye=Ae*_e;Y[0]=we*Ke,Y[4]=-rt,Y[8]=_e*Ke,Y[1]=pt*rt+Ye,Y[5]=Fe*Ke,Y[9]=Ne*rt-je,Y[2]=je*rt-Ne,Y[6]=Ae*Ke,Y[10]=Ye*rt+pt}return Y[3]=0,Y[7]=0,Y[11]=0,Y[12]=0,Y[13]=0,Y[14]=0,Y[15]=1,Y}e.fromEuler=le;function ee(Y,ae,ve,ge,Se,Ee,Fe){let Ae=2*Ee/(ve-ae),we=2*Ee/(ge-Se),_e=(ve+ae)/(ve-ae),Ke=(ge+Se)/(ge-Se),rt=-(Fe+Ee)/(Fe-Ee),pt=-2*Fe*Ee/(Fe-Ee);return Y[0]=Ae,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=we,Y[6]=0,Y[7]=0,Y[8]=_e,Y[9]=Ke,Y[10]=rt,Y[11]=-1,Y[12]=0,Y[13]=0,Y[14]=pt,Y[15]=0,Y}e.perspective=ee;function oe(Y,ae,ve,ge,Se,Ee,Fe){let Ae=1/(ve-ae),we=1/(ge-Se),_e=1/(Fe-Ee),Ke=(ve+ae)*Ae,rt=(ge+Se)*we,pt=(Fe+Ee)*_e;return Y[0]=2*Ae,Y[1]=0,Y[2]=0,Y[3]=0,Y[4]=0,Y[5]=2*we,Y[6]=0,Y[7]=0,Y[8]=0,Y[9]=0,Y[10]=-2*_e,Y[11]=0,Y[12]=-Ke,Y[13]=-rt,Y[14]=-pt,Y[15]=1,Y}e.ortho=oe;function te(Y,ae,ve,ge){let Se,Ee,Fe,Ae,we,_e,Ke,rt,pt,Ne,je=ae[0],Ye=ae[1],mt=ae[2],vt=ge[0],yt=ge[1],$e=ge[2],be=ve[0],Te=ve[1],De=ve[2];return Math.abs(je-be)<1e-6&&Math.abs(Ye-Te)<1e-6&&Math.abs(mt-De)<1e-6?n(Y):(Ke=je-be,rt=Ye-Te,pt=mt-De,Ne=1/Math.sqrt(Ke*Ke+rt*rt+pt*pt),Ke*=Ne,rt*=Ne,pt*=Ne,Se=yt*pt-$e*rt,Ee=$e*Ke-vt*pt,Fe=vt*rt-yt*Ke,Ne=Math.sqrt(Se*Se+Ee*Ee+Fe*Fe),Ne?(Ne=1/Ne,Se*=Ne,Ee*=Ne,Fe*=Ne):(Se=0,Ee=0,Fe=0),Ae=rt*Fe-pt*Ee,we=pt*Se-Ke*Fe,_e=Ke*Ee-rt*Se,Ne=Math.sqrt(Ae*Ae+we*we+_e*_e),Ne?(Ne=1/Ne,Ae*=Ne,we*=Ne,_e*=Ne):(Ae=0,we=0,_e=0),Y[0]=Se,Y[1]=Ae,Y[2]=Ke,Y[3]=0,Y[4]=Ee,Y[5]=we,Y[6]=rt,Y[7]=0,Y[8]=Fe,Y[9]=_e,Y[10]=pt,Y[11]=0,Y[12]=-(Se*je+Ee*Ye+Fe*mt),Y[13]=-(Ae*je+we*Ye+_e*mt),Y[14]=-(Ke*je+rt*Ye+pt*mt),Y[15]=1,Y)}e.lookAt=te;function X(Y,ae,ve,ge){let Se=ae[0],Ee=ae[1],Fe=ae[2],Ae=ge[0],we=ge[1],_e=ge[2],Ke=Se-ve[0],rt=Ee-ve[1],pt=Fe-ve[2],Ne=Ke*Ke+rt*rt+pt*pt;Ne>0&&(Ne=1/Math.sqrt(Ne),Ke*=Ne,rt*=Ne,pt*=Ne);let je=we*pt-_e*rt,Ye=_e*Ke-Ae*pt,mt=Ae*rt-we*Ke;return Ne=je*je+Ye*Ye+mt*mt,Ne>0&&(Ne=1/Math.sqrt(Ne),je*=Ne,Ye*=Ne,mt*=Ne),Y[0]=je,Y[1]=Ye,Y[2]=mt,Y[3]=0,Y[4]=rt*mt-pt*Ye,Y[5]=pt*je-Ke*mt,Y[6]=Ke*Ye-rt*je,Y[7]=0,Y[8]=Ke,Y[9]=rt,Y[10]=pt,Y[11]=0,Y[12]=Se,Y[13]=Ee,Y[14]=Fe,Y[15]=1,Y}e.targetTo=X;function W(Y,ae){o(Y);for(let ve=0;ve<4;ve++){let ge=ae[ve];u(Y,ve,ge,1)}return Y}e.fromPermutation=W;function K(Y){let ae=Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2],ve=Y[4]*Y[4]+Y[5]*Y[5]+Y[6]*Y[6],ge=Y[8]*Y[8]+Y[9]*Y[9]+Y[10]*Y[10];return Math.sqrt(Math.max(ae,ve,ge))}e.getMaxScaleOnAxis=K;let re=[1,0,0],se=[0,1,0],me=[0,0,1];e.rotX90=R(t(),Pr(90),re),e.rotX180=R(t(),Pr(180),re),e.rotY90=R(t(),Pr(90),se),e.rotY180=R(t(),Pr(180),se),e.rotY270=R(t(),Pr(270),se),e.rotZ90=R(t(),Pr(90),me),e.rotZ180=R(t(),Pr(180),me),e.rotXY90=I(t(),e.rotX90,e.rotY90),e.rotZY90=I(t(),e.rotZ90,e.rotY90),e.rotZYZ90=I(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=I(t(),e.rotZ90,e.rotX180),e.rotY90Z180=I(t(),e.rotY90,e.rotZ180),e.id=r()})(de||(de={}));function nr(){return nr.zero()}(function(e){function t(){let z=[.1,0,0,0,0,0,0,0,0];return z[0]=0,z}e.zero=t;function r(){let z=t();return z[0]=1,z[1]=0,z[2]=0,z[3]=0,z[4]=1,z[5]=0,z[6]=0,z[7]=0,z[8]=1,z}e.identity=r;function n(z){return z[0]=1,z[1]=0,z[2]=0,z[3]=0,z[4]=1,z[5]=0,z[6]=0,z[7]=0,z[8]=1,z}e.setIdentity=n;function o(z,$,Z){return $[Z+0]=z[0],$[Z+1]=z[1],$[Z+2]=z[2],$[Z+3]=z[3],$[Z+4]=z[4],$[Z+5]=z[5],$[Z+6]=z[6],$[Z+7]=z[7],$[Z+8]=z[8],$}e.toArray=o;function i(z,$,Z){return z[0]=$[Z+0],z[1]=$[Z+1],z[2]=$[Z+2],z[3]=$[Z+3],z[4]=$[Z+4],z[5]=$[Z+5],z[6]=$[Z+6],z[7]=$[Z+7],z[8]=$[Z+8],z}e.fromArray=i;function s(z,$,Z,J){return z[0]=$[0],z[1]=$[1],z[2]=$[2],z[3]=Z[0],z[4]=Z[1],z[5]=Z[2],z[6]=J[0],z[7]=J[1],z[8]=J[2],z}e.fromColumns=s;function a(z,$){return z[0]=$[0],z[1]=$[1],z[2]=$[2],z[3]=$[4],z[4]=$[5],z[5]=$[6],z[6]=$[8],z[7]=$[9],z[8]=$[10],z}e.fromMat4=a;let l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function c(z,$,Z){return de.fromEuler(l,$,Z),a(z,l)}e.fromEuler=c;function u(z,$,Z,J,ie,ne,le,ee,oe){let te=t();return te[0]=z,te[1]=$,te[2]=Z,te[3]=J,te[4]=ie,te[5]=ne,te[6]=le,te[7]=ee,te[8]=oe,te}e.create=u;let d=r();function m(z,$){return f(z,d,typeof $>"u"?1e-6:$)}e.isIdentity=m;function p(z){for(let $=0;$<9;$++)if(isNaN(z[$]))return!0;return!1}e.hasNaN=p;function h(z){return b(t(),z)}e.clone=h;function f(z,$,Z){for(let J=0;J<9;J++)if(Math.abs(z[J]-$[J])>Z)return!1;return!0}e.areEqual=f;function C(z,$,Z,J){z[3*Z+$]=J}e.setValue=C;function g(z,$,Z){return z[3*Z+$]}e.getValue=g;function b(z,$){return z[0]=$[0],z[1]=$[1],z[2]=$[2],z[3]=$[3],z[4]=$[4],z[5]=$[5],z[6]=$[6],z[7]=$[7],z[8]=$[8],z}e.copy=b;function y(z,$){if(z===$){let Z=$[1],J=$[2],ie=$[5];z[1]=$[3],z[2]=$[6],z[3]=Z,z[5]=$[7],z[6]=J,z[7]=ie}else z[0]=$[0],z[1]=$[3],z[2]=$[6],z[3]=$[1],z[4]=$[4],z[5]=$[7],z[6]=$[2],z[7]=$[5],z[8]=$[8];return z}e.transpose=y;function x(z,$){let Z=$[0],J=$[1],ie=$[2],ne=$[3],le=$[4],ee=$[5],oe=$[6],te=$[7],X=$[8],W=X*le-ee*te,K=-X*ne+ee*oe,re=te*ne-le*oe,se=Z*W+J*K+ie*re;return se&&(se=1/se,z[0]=W*se,z[1]=(-X*J+ie*te)*se,z[2]=(ee*J-ie*le)*se,z[3]=K*se,z[4]=(X*Z-ie*oe)*se,z[5]=(-ee*Z+ie*ne)*se,z[6]=re*se,z[7]=(-te*Z+J*oe)*se,z[8]=(le*Z-J*ne)*se),z}e.invert=x;function A(z,$){return z===$?(z[3]=$[1],z[6]=$[2],z[7]=$[5]):(z[0]=$[0],z[1]=$[1],z[2]=$[2],z[3]=$[1],z[4]=$[4],z[5]=$[5],z[6]=$[2],z[7]=$[5],z[8]=$[8]),z}e.symmtricFromUpper=A;function v(z,$){return z===$?(z[1]=$[3],z[2]=$[6],z[5]=$[7]):(z[0]=$[0],z[1]=$[3],z[2]=$[6],z[3]=$[3],z[4]=$[4],z[5]=$[7],z[6]=$[6],z[7]=$[7],z[8]=$[8]),z}e.symmtricFromLower=v;function _(z){let $=z[0],Z=z[1],J=z[2],ie=z[3],ne=z[4],le=z[5],ee=z[6],oe=z[7],te=z[8],X=te*ne-le*oe,W=-te*ie+le*ee,K=oe*ie-ne*ee;return $*X+Z*W+J*K}e.determinant=_;function I(z){return z[0]+z[4]+z[8]}e.trace=I;function T(z,$,Z){return z[0]=$[0]-Z[0],z[1]=$[1]-Z[1],z[2]=$[2]-Z[2],z[3]=$[3]-Z[3],z[4]=$[4]-Z[4],z[5]=$[5]-Z[5],z[6]=$[6]-Z[6],z[7]=$[7]-Z[7],z[8]=$[8]-Z[8],z}e.sub=T;function E(z,$,Z){return z[0]=$[0]+Z[0],z[1]=$[1]+Z[1],z[2]=$[2]+Z[2],z[3]=$[3]+Z[3],z[4]=$[4]+Z[4],z[5]=$[5]+Z[5],z[6]=$[6]+Z[6],z[7]=$[7]+Z[7],z[8]=$[8]+Z[8],z}e.add=E;function w(z,$,Z){let J=$[0],ie=$[1],ne=$[2],le=$[3],ee=$[4],oe=$[5],te=$[6],X=$[7],W=$[8],K=Z[0],re=Z[1],se=Z[2],me=Z[3],Y=Z[4],ae=Z[5],ve=Z[6],ge=Z[7],Se=Z[8];return z[0]=K*J+re*le+se*te,z[1]=K*ie+re*ee+se*X,z[2]=K*ne+re*oe+se*W,z[3]=me*J+Y*le+ae*te,z[4]=me*ie+Y*ee+ae*X,z[5]=me*ne+Y*oe+ae*W,z[6]=ve*J+ge*le+Se*te,z[7]=ve*ie+ge*ee+Se*X,z[8]=ve*ne+ge*oe+Se*W,z}e.mul=w;function S(z,$,Z){return z[0]=$[0]-Z,z[1]=$[1]-Z,z[2]=$[2]-Z,z[3]=$[3]-Z,z[4]=$[4]-Z,z[5]=$[5]-Z,z[6]=$[6]-Z,z[7]=$[7]-Z,z[8]=$[8]-Z,z}e.subScalar=S;function P(z,$,Z){return z[0]=$[0]+Z,z[1]=$[1]+Z,z[2]=$[2]+Z,z[3]=$[3]+Z,z[4]=$[4]+Z,z[5]=$[5]+Z,z[6]=$[6]+Z,z[7]=$[7]+Z,z[8]=$[8]+Z,z}e.addScalar=P;function k(z,$,Z){return z[0]=$[0]*Z,z[1]=$[1]*Z,z[2]=$[2]*Z,z[3]=$[3]*Z,z[4]=$[4]*Z,z[5]=$[5]*Z,z[6]=$[6]*Z,z[7]=$[7]*Z,z[8]=$[8]*Z,z}e.mulScalar=k;let L=Math.PI/3,R=t();function N(z,$){let Z=$[1]*$[1]+$[2]*$[2]+$[5]*$[5];if(Z===0)z[0]=$[0],z[1]=$[4],z[2]=$[8];else{let J=I($)/3,ie=$[0]-J,ne=$[4]-J,le=$[8]-J,ee=ie*ie+ne*ne+le*le+2*Z,oe=Math.sqrt(ee/6);k(R,e.Identity,J),T(R,$,R),k(R,R,1/oe);let te=_(R)/2,X=te<=-1?L:te>=1?0:Math.acos(te)/3;z[0]=J+2*oe*Math.cos(X),z[2]=J+2*oe*Math.cos(X+2*L),z[1]=3*J-z[0]-z[2]}return z}e.symmetricEigenvalues=N;let F=[.1,0,0],H=[.1,0,0],V=[.1,0,0],q=[.1,0,0],Q=[.1,0,0],O=[.1,0,0];function B(z,$,Z){D.set(F,$[0]-Z,$[1],$[2]),D.set(H,$[1],$[4]-Z,$[5]),D.set(V,$[2],$[5],$[8]-Z),D.cross(q,F,H),D.cross(Q,F,V),D.cross(O,H,V);let J=D.dot(q,q),ie=D.dot(Q,Q),ne=D.dot(O,O),le=J,ee=0;return ie>le&&(le=ie,ee=1),ne>le&&(ee=2),ee===0?D.scale(z,q,1/Math.sqrt(J)):ee===1?D.scale(z,Q,1/Math.sqrt(ie)):D.scale(z,O,1/Math.sqrt(ne)),z}e.eigenvector=B;function j(z,$){return a(z,$),x(z,z),y(z,z),z}e.directionTransform=j,e.Identity=r();function U(z,$){return z[0]*$[0]+z[1]*$[1]+z[2]*$[2]+z[3]*$[3]+z[4]*$[4]+z[5]*$[5]+z[6]*$[6]+z[7]*$[7]+z[8]*$[8]}e.innerProduct=U})(nr||(nr={}));function Ve(){return Ve.zero()}(function(e){function t(){let I=[.1,0];return I[0]=0,I}e.zero=t;function r(I){let T=t();return T[0]=I[0],T[1]=I[1],T}e.clone=r;function n(I,T){let E=t();return E[0]=I,E[1]=T,E}e.create=n;function o(I){return isNaN(I[0])||isNaN(I[1])}e.hasNaN=o;function i(I,T,E){return T[E+0]=I[0],T[E+1]=I[1],T}e.toArray=i;function s(I,T,E){return I[0]=T[E+0],I[1]=T[E+1],I}e.fromArray=s;function a(I,T){return I[0]=T[0],I[1]=T[1],I}e.copy=a;function l(I,T,E){return I[0]=T,I[1]=E,I}e.set=l;function c(I,T,E){return I[0]=T[0]+E[0],I[1]=T[1]+E[1],I}e.add=c;function u(I,T,E){return I[0]=T[0]-E[0],I[1]=T[1]-E[1],I}e.sub=u;function d(I,T,E){return I[0]=T[0]*E[0],I[1]=T[1]*E[1],I}e.mul=d;function m(I,T,E){return I[0]=T[0]/E[0],I[1]=T[1]/E[1],I}e.div=m;function p(I,T,E){return I[0]=T[0]*E,I[1]=T[1]*E,I}e.scale=p;function h(I,T){return I[0]=Math.round(T[0]),I[1]=Math.round(T[1]),I}e.round=h;function f(I,T){return I[0]=Math.ceil(T[0]),I[1]=Math.ceil(T[1]),I}e.ceil=f;function C(I,T){return I[0]=Math.floor(T[0]),I[1]=Math.floor(T[1]),I}e.floor=C;function g(I,T){let E=T[0]-I[0],w=T[1]-I[1];return Math.sqrt(E*E+w*w)}e.distance=g;function b(I,T){let E=T[0]-I[0],w=T[1]-I[1];return E*E+w*w}e.squaredDistance=b;function y(I){let T=I[0],E=I[1];return Math.sqrt(T*T+E*E)}e.magnitude=y;function x(I){let T=I[0],E=I[1];return T*T+E*E}e.squaredMagnitude=x;function A(I,T){return I[0]=1/T[0],I[1]=1/T[1],I}e.inverse=A;function v(I,T){return I[0]===T[0]&&I[1]===T[1]}e.areEqual=v;function _(I,T){return`[${I[0].toPrecision(T)} ${I[1].toPrecision(T)}}]`}e.toString=_})(Ve||(Ve={}));function Ht(){return Ht.zero()}(function(e){function t(){let S=[.1,0,0,0];return S[0]=0,S}e.zero=t;function r(S){let P=t();return P[0]=S[0],P[1]=S[1],P[2]=S[2],P[3]=S[3],P}e.clone=r;function n(S,P,k,L){let R=t();return R[0]=S,R[1]=P,R[2]=k,R[3]=L,R}e.create=n;function o(S,P){return S[0]=P.center[0],S[1]=P.center[1],S[2]=P.center[2],S[3]=P.radius,S}e.fromSphere=o;function i(S){return o(t(),S)}e.ofSphere=i;function s(S){return isNaN(S[0])||isNaN(S[1])||isNaN(S[2])||isNaN(S[3])}e.hasNaN=s;function a(S,P,k){return P[k+0]=S[0],P[k+1]=S[1],P[k+2]=S[2],P[k+3]=S[3],P}e.toArray=a;function l(S,P,k){return S[0]=P[k+0],S[1]=P[k+1],S[2]=P[k+2],S[3]=P[k+3],S}e.fromArray=l;function c(S,P,k){P[k+0]=S[0],P[k+1]=S[1],P[k+2]=S[2]}e.toVec3Array=c;function u(S,P,k){return S[0]=P[k+0],S[1]=P[k+1],S[2]=P[k+2],S[3]=0,S}e.fromVec3Array=u;function d(S,P){return S[0]=P[0],S[1]=P[1],S[2]=P[2],S[3]=P[3],S}e.copy=d;function m(S,P,k,L,R){return S[0]=P,S[1]=k,S[2]=L,S[3]=R,S}e.set=m;function p(S,P,k){return S[0]=P[0]+k[0],S[1]=P[1]+k[1],S[2]=P[2]+k[2],S[3]=P[3]+k[3],S}e.add=p;function h(S,P){let k=P[0]-S[0],L=P[1]-S[1],R=P[2]-S[2],N=P[3]-S[3];return Math.sqrt(k*k+L*L+R*R+N*N)}e.distance=h;function f(S,P,k){return S[0]=P[0]*k,S[1]=P[1]*k,S[2]=P[2]*k,S[4]=P[4]*k,S}e.scale=f;function C(S,P){return S[0]=Math.round(P[0]),S[1]=Math.round(P[1]),S[2]=Math.round(P[2]),S[3]=Math.round(P[3]),S}e.round=C;function g(S,P){return S[0]=Math.ceil(P[0]),S[1]=Math.ceil(P[1]),S[2]=Math.ceil(P[2]),S[3]=Math.ceil(P[3]),S}e.ceil=g;function b(S,P){return S[0]=Math.floor(P[0]),S[1]=Math.floor(P[1]),S[2]=Math.floor(P[2]),S[3]=Math.floor(P[3]),S}e.floor=b;function y(S,P){let k=P[0]-S[0],L=P[1]-S[1],R=P[2]-S[2],N=P[3]-S[3];return k*k+L*L+R*R+N*N}e.squaredDistance=y;function x(S){let P=S[0],k=S[1],L=S[2],R=S[3];return Math.sqrt(P*P+k*k+L*L+R*R)}e.norm=x;function A(S){let P=S[0],k=S[1],L=S[2],R=S[3];return P*P+k*k+L*L+R*R}e.squaredNorm=A;function v(S,P,k){let L=P[0],R=P[1],N=P[2],F=P[3];return S[0]=k[0]*L+k[4]*R+k[8]*N+k[12]*F,S[1]=k[1]*L+k[5]*R+k[9]*N+k[13]*F,S[2]=k[2]*L+k[6]*R+k[10]*N+k[14]*F,S[3]=k[3]*L+k[7]*R+k[11]*N+k[15]*F,S}e.transformMat4=v;function _(S,P){return S[0]*P[0]+S[1]*P[1]+S[2]*P[2]+S[3]*P[3]}e.dot=_;function I(S,P){return S[0]=1/P[0],S[1]=1/P[1],S[2]=1/P[2],S[3]=1/P[3],S}e.inverse=I;function T(S,P){return S[0]===P[0]&&S[1]===P[1]&&S[2]===P[2]&&S[3]===P[3]}e.exactEquals=T;function E(S,P){let k=S[0],L=S[1],R=S[2],N=S[3],F=P[0],H=P[1],V=P[2],q=P[3];return Math.abs(k-F)<=1e-6*Math.max(1,Math.abs(k),Math.abs(F))&&Math.abs(L-H)<=1e-6*Math.max(1,Math.abs(L),Math.abs(H))&&Math.abs(R-V)<=1e-6*Math.max(1,Math.abs(R),Math.abs(V))&&Math.abs(N-q)<=1e-6*Math.max(1,Math.abs(N),Math.abs(q))}e.equals=E;function w(S,P){return`[${S[0].toPrecision(P)} ${S[1].toPrecision(P)} ${S[2].toPrecision(P)}  ${S[3].toPrecision(P)}]`}e.toString=w})(Ht||(Ht={}));function Hh(e){return Object.keys(e)}function Sr(e){throw new Error("unreachable")}function p0(e){return typeof e?.then=="function"}function Tn(){return Tn.zero()}(function(e){function t(){let B=[.1,0,0,0];return B[0]=0,B}e.zero=t;function r(){let B=t();return B[3]=1,B}e.identity=r;function n(B){B[0]=0,B[1]=0,B[2]=0,B[3]=1}e.setIdentity=n;function o(B){return isNaN(B[0])||isNaN(B[1])||isNaN(B[2])||isNaN(B[3])}e.hasNaN=o;function i(B,j,U,z){let $=r();return $[0]=B,$[1]=j,$[2]=U,$[3]=z,$}e.create=i;function s(B,j,U){U=U*.5;let z=Math.sin(U);return B[0]=z*j[0],B[1]=z*j[1],B[2]=z*j[2],B[3]=Math.cos(U),B}e.setAxisAngle=s;function a(B,j){let U=Math.acos(j[3])*2,z=Math.sin(U/2);return z!==0?(B[0]=j[0]/z,B[1]=j[1]/z,B[2]=j[2]/z):(B[0]=1,B[1]=0,B[2]=0),U}e.getAxisAngle=a;function l(B,j,U){let z=j[0],$=j[1],Z=j[2],J=j[3],ie=U[0],ne=U[1],le=U[2],ee=U[3];return B[0]=z*ee+J*ie+$*le-Z*ne,B[1]=$*ee+J*ne+Z*ie-z*le,B[2]=Z*ee+J*le+z*ne-$*ie,B[3]=J*ee-z*ie-$*ne-Z*le,B}e.multiply=l;function c(B,j,U){U*=.5;let z=j[0],$=j[1],Z=j[2],J=j[3],ie=Math.sin(U),ne=Math.cos(U);return B[0]=z*ne+J*ie,B[1]=$*ne+Z*ie,B[2]=Z*ne-$*ie,B[3]=J*ne-z*ie,B}e.rotateX=c;function u(B,j,U){U*=.5;let z=j[0],$=j[1],Z=j[2],J=j[3],ie=Math.sin(U),ne=Math.cos(U);return B[0]=z*ne-Z*ie,B[1]=$*ne+J*ie,B[2]=Z*ne+z*ie,B[3]=J*ne-$*ie,B}e.rotateY=u;function d(B,j,U){U*=.5;let z=j[0],$=j[1],Z=j[2],J=j[3],ie=Math.sin(U),ne=Math.cos(U);return B[0]=z*ne+$*ie,B[1]=$*ne-z*ie,B[2]=Z*ne+J*ie,B[3]=J*ne-Z*ie,B}e.rotateZ=d;function m(B,j){let U=j[0],z=j[1],$=j[2];return B[0]=U,B[1]=z,B[2]=$,B[3]=Math.sqrt(Math.abs(1-U*U-z*z-$*$)),B}e.calculateW=m;function p(B,j,U,z){let $=j[0],Z=j[1],J=j[2],ie=j[3],ne=U[0],le=U[1],ee=U[2],oe=U[3],te,X,W,K,re;return X=$*ne+Z*le+J*ee+ie*oe,X<0&&(X=-X,ne=-ne,le=-le,ee=-ee,oe=-oe),1-X>1e-6?(te=Math.acos(X),W=Math.sin(te),K=Math.sin((1-z)*te)/W,re=Math.sin(z*te)/W):(K=1-z,re=z),B[0]=K*$+re*ne,B[1]=K*Z+re*le,B[2]=K*J+re*ee,B[3]=K*ie+re*oe,B}e.slerp=p;function h(B,j){let U=j[0],z=j[1],$=j[2],Z=j[3],J=U*U+z*z+$*$+Z*Z,ie=J?1/J:0;return B[0]=-U*ie,B[1]=-z*ie,B[2]=-$*ie,B[3]=Z*ie,B}e.invert=h;function f(B,j){return B[0]=-j[0],B[1]=-j[1],B[2]=-j[2],B[3]=j[3],B}e.conjugate=f;function C(B,j){return B[0]*j[0]+B[1]*j[1]+B[2]*j[2]+B[3]*j[3]}e.dot=C;function g(B,j){let U=j[0]+j[4]+j[8],z;if(U>0)z=Math.sqrt(U+1),B[3]=.5*z,z=.5/z,B[0]=(j[5]-j[7])*z,B[1]=(j[6]-j[2])*z,B[2]=(j[1]-j[3])*z;else{let $=0;j[4]>j[0]&&($=1),j[8]>j[$*3+$]&&($=2);let Z=($+1)%3,J=($+2)%3;z=Math.sqrt(j[$*3+$]-j[Z*3+Z]-j[J*3+J]+1),B[$]=.5*z,z=.5/z,B[3]=(j[Z*3+J]-j[J*3+Z])*z,B[Z]=(j[Z*3+$]+j[$*3+Z])*z,B[J]=(j[J*3+$]+j[$*3+J])*z}return B}e.fromMat3=g;function b(B,j,U){let[z,$,Z]=j,J=Math.cos(z/2),ie=Math.cos($/2),ne=Math.cos(Z/2),le=Math.sin(z/2),ee=Math.sin($/2),oe=Math.sin(Z/2);switch(U){case"XYZ":B[0]=le*ie*ne+J*ee*oe,B[1]=J*ee*ne-le*ie*oe,B[2]=J*ie*oe+le*ee*ne,B[3]=J*ie*ne-le*ee*oe;break;case"YXZ":B[0]=le*ie*ne+J*ee*oe,B[1]=J*ee*ne-le*ie*oe,B[2]=J*ie*oe-le*ee*ne,B[3]=J*ie*ne+le*ee*oe;break;case"ZXY":B[0]=le*ie*ne-J*ee*oe,B[1]=J*ee*ne+le*ie*oe,B[2]=J*ie*oe+le*ee*ne,B[3]=J*ie*ne-le*ee*oe;break;case"ZYX":B[0]=le*ie*ne-J*ee*oe,B[1]=J*ee*ne+le*ie*oe,B[2]=J*ie*oe-le*ee*ne,B[3]=J*ie*ne+le*ee*oe;break;case"YZX":B[0]=le*ie*ne+J*ee*oe,B[1]=J*ee*ne+le*ie*oe,B[2]=J*ie*oe-le*ee*ne,B[3]=J*ie*ne-le*ee*oe;break;case"XZY":B[0]=le*ie*ne-J*ee*oe,B[1]=J*ee*ne-le*ie*oe,B[2]=J*ie*oe+le*ee*ne,B[3]=J*ie*ne+le*ee*oe;break;default:Sr(U)}return B}e.fromEuler=b;let y=[0,0,0];function x(B,j,U){let z=D.dot(j,U)+1;return z<1e-6?(z=0,Math.abs(j[0])>Math.abs(j[2])?D.set(y,-j[1],j[0],0):D.set(y,0,-j[2],j[1])):D.cross(y,j,U),B[0]=y[0],B[1]=y[1],B[2]=y[2],B[3]=z,P(B,B),B}e.fromUnitVec3=x;function A(B){let j=t();return j[0]=B[0],j[1]=B[1],j[2]=B[2],j[3]=B[3],j}e.clone=A;function v(B,j,U){return j[U+0]=B[0],j[U+1]=B[1],j[U+2]=B[2],j[U+3]=B[3],j}e.toArray=v;function _(B,j,U){return B[0]=j[U+0],B[1]=j[U+1],B[2]=j[U+2],B[3]=j[U+3],B}e.fromArray=_;function I(B,j){return B[0]=j[0],B[1]=j[1],B[2]=j[2],B[3]=j[3],B}e.copy=I;function T(B,j,U,z,$){return B[0]=j,B[1]=U,B[2]=z,B[3]=$,B}e.set=T;function E(B,j){return B[0]===j[0]&&B[1]===j[1]&&B[2]===j[2]&&B[3]===j[3]}e.exactEquals=E;function w(B,j){let U=B[0],z=B[1],$=B[2],Z=B[3],J=j[0],ie=j[1],ne=j[2],le=j[3];return Math.abs(U-J)<=1e-6*Math.max(1,Math.abs(U),Math.abs(J))&&Math.abs(z-ie)<=1e-6*Math.max(1,Math.abs(z),Math.abs(ie))&&Math.abs($-ne)<=1e-6*Math.max(1,Math.abs($),Math.abs(ne))&&Math.abs(Z-le)<=1e-6*Math.max(1,Math.abs(Z),Math.abs(le))}e.equals=w;function S(B,j,U){return B[0]=j[0]+U[0],B[1]=j[1]+U[1],B[2]=j[2]+U[2],B[3]=j[3]+U[3],B}e.add=S;function P(B,j){let U=j[0],z=j[1],$=j[2],Z=j[3],J=U*U+z*z+$*$+Z*Z;return J>0&&(J=1/Math.sqrt(J),B[0]=U*J,B[1]=z*J,B[2]=$*J,B[3]=Z*J),B}e.normalize=P;let k=[0,0,0],L=[1,0,0],R=[0,1,0];function N(B,j,U){let z=D.dot(j,U);return z<-.999999?(D.cross(k,L,j),D.magnitude(k)<1e-6&&D.cross(k,R,j),D.normalize(k,k),s(B,k,Math.PI),B):z>.999999?(B[0]=0,B[1]=0,B[2]=0,B[3]=1,B):(D.cross(k,j,U),B[0]=k[0],B[1]=k[1],B[2]=k[2],B[3]=1+z,P(B,B))}e.rotationTo=N;let F=t(),H=t();function V(B,j,U,z,$,Z){return p(F,j,$,Z),p(H,U,z,Z),p(B,F,H,2*Z*(1-Z)),B}e.sqlerp=V;let q=[0,0,0,0,0,0,0,0,0];function Q(B,j,U,z){return q[0]=U[0],q[3]=U[1],q[6]=U[2],q[1]=z[0],q[4]=z[1],q[7]=z[2],q[2]=-j[0],q[5]=-j[1],q[8]=-j[2],P(B,g(B,q))}e.setAxes=Q;function O(B,j){return`[${B[0].toPrecision(j)} ${B[1].toPrecision(j)} ${B[2].toPrecision(j)}  ${B[3].toPrecision(j)}]`}e.toString=O,e.Identity=r()})(Tn||(Tn={}));var cr;(function(e){function t(A,v,_){let I=[];for(let E=0;E<v.length;E++)I[E]=v[v.length-E-1];let T=[1];for(let E=1;E<A.length;E++)T[E]=A[I[E-1]];return{dimensions:A,axisOrderFastToSlow:I,axisOrderSlowToFast:v,accessDimensions:T,defaultCtor:_||Float64Array}}function r(A,v){return{space:A,data:v}}e.create=r;function n(A,v,_){let I=t(A,v,_),{get:T,set:E,add:w,dataOffset:S,getCoords:P}=p(I);return{rank:A.length,dimensions:A,axisOrderSlowToFast:v,create:h(I),get:T,set:E,add:w,dataOffset:S,getCoords:P}}e.Space=n;function o(A){return A}e.Data1=o;function i(A,v){return n([A],[0],v)}e.Vector=i;function s(A,v,_){return n([A,v],[1,0],_)}e.ColumnMajorMatrix=s;function a(A,v,_){return n([A,v],[0,1],_)}e.RowMajorMatrix=a;function l(A,v,_){if(v.rank!==2)throw new Error("Invalid tensor rank");let I=Math.min(4,v.dimensions[0]),T=Math.min(4,v.dimensions[1]);for(let E=0;E<I;E++)for(let w=0;w<T;w++)de.setValue(A,E,w,v.get(_,E,w));return A}e.toMat4=l;function c(A,v,_){if(v.rank!==2)throw new Error("Invalid tensor rank");let I=Math.min(3,v.dimensions[0]),T=Math.min(3,v.dimensions[1]);for(let E=0;E<I;E++)for(let w=0;w<T;w++)nr.setValue(A,E,w,v.get(_,E,w));return A}e.toMat3=c;function u(A,v,_){if(v.rank!==1)throw new Error("Invalid tensor rank");let I=Math.min(3,v.dimensions[0]);for(let T=0;T<I;T++)A[T]=_[T];return A}e.toVec3=u;function d(A,v,_){if(v.rank!==1)throw new Error("Invalid tensor rank");let I=Math.min(4,v.dimensions[0]);for(let T=0;T<I;T++)A[T]=_[T];return A}e.toVec4=d;function m(A,v){let _=A.length;if(_!==v.length)return!1;for(let I=0;I<_;I++)if(A[I]!==v[I])return!1;return!0}e.areEqualExact=m;function p(A){let{dimensions:v,axisOrderFastToSlow:_}=A;switch(v.length){case 1:return{get:(I,T)=>I[T],set:(I,T,E)=>I[T]=E,add:(I,T,E)=>I[T]+=E,dataOffset:I=>I,getCoords:(I,T)=>(T[0]=I,T)};case 2:{if(_[0]===0&&_[1]===1){let I=v[0];return{get:(T,E,w)=>T[w*I+E],set:(T,E,w,S)=>T[w*I+E]=S,add:(T,E,w,S)=>T[w*I+E]+=S,dataOffset:(T,E)=>E*I+T,getCoords:(T,E)=>(E[0]=T%I,E[1]=Math.floor(T/I),E)}}if(_[0]===1&&_[1]===0){let I=v[1];return{get:(T,E,w)=>T[E*I+w],set:(T,E,w,S)=>T[E*I+w]=S,add:(T,E,w,S)=>T[E*I+w]+=S,dataOffset:(T,E)=>T*I+E,getCoords:(T,E)=>(E[0]=Math.floor(T/I),E[1]=T%I,E)}}throw new Error("bad axis order")}case 3:{if(_[0]===0&&_[1]===1&&_[2]===2){let I=v[0],T=v[1],E=I*T;return{get:(w,S,P,k)=>w[S+P*I+k*E],set:(w,S,P,k,L)=>w[S+P*I+k*E]=L,add:(w,S,P,k,L)=>w[S+P*I+k*E]+=L,dataOffset:(w,S,P)=>w+S*I+P*E,getCoords:(w,S)=>{let P=Math.floor(w/I);return S[0]=w%I,S[1]=P%T,S[2]=Math.floor(P/T),S}}}if(_[0]===0&&_[1]===2&&_[2]===1){let I=v[0],T=v[2],E=I*T;return{get:(w,S,P,k)=>w[S+k*I+P*E],set:(w,S,P,k,L)=>w[S+k*I+P*E]=L,add:(w,S,P,k,L)=>w[S+k*I+P*E]+=L,dataOffset:(w,S,P)=>w+P*I+S*E,getCoords:(w,S)=>{let P=Math.floor(w/I);return S[0]=w%I,S[1]=Math.floor(P/T),S[2]=P%T,S}}}if(_[0]===1&&_[1]===0&&_[2]===2){let I=v[1],T=v[0],E=I*T;return{get:(w,S,P,k)=>w[P+S*I+k*E],set:(w,S,P,k,L)=>w[P+S*I+k*E]=L,add:(w,S,P,k,L)=>w[P+S*I+k*E]+=L,dataOffset:(w,S,P)=>S+w*I+P*E,getCoords:(w,S)=>{let P=Math.floor(w/I);return S[0]=P%T,S[1]=w%I,S[2]=Math.floor(P/T),S}}}if(_[0]===1&&_[1]===2&&_[2]===0){let I=v[1],T=v[2],E=I*T;return{get:(w,S,P,k)=>w[P+k*I+S*E],set:(w,S,P,k,L)=>w[P+k*I+S*E]=L,add:(w,S,P,k,L)=>w[P+k*I+S*E]+=L,dataOffset:(w,S,P)=>S+P*I+w*E,getCoords:(w,S)=>{let P=Math.floor(w/I);return S[0]=Math.floor(P/T),S[1]=w%I,S[2]=P%T,S}}}if(_[0]===2&&_[1]===0&&_[2]===1){let I=v[2],T=v[0],E=I*T;return{get:(w,S,P,k)=>w[k+S*I+P*E],set:(w,S,P,k,L)=>w[k+S*I+P*E]=L,add:(w,S,P,k,L)=>w[k+S*I+P*E]+=L,dataOffset:(w,S,P)=>P+w*I+S*E,getCoords:(w,S)=>{let P=Math.floor(w/I);return S[0]=P%T,S[1]=Math.floor(P/T),S[2]=w%I,S}}}if(_[0]===2&&_[1]===1&&_[2]===0){let I=v[2],T=v[1],E=I*T;return{get:(w,S,P,k)=>w[k+P*I+S*E],set:(w,S,P,k,L)=>w[k+P*I+S*E]=L,add:(w,S,P,k,L)=>w[k+P*I+S*E]+=L,dataOffset:(w,S,P)=>P+S*I+w*E,getCoords:(w,S)=>{let P=Math.floor(w/I);return S[0]=Math.floor(P/T),S[1]=P%T,S[2]=w%I,S}}}throw new Error("bad axis order")}default:return{get:(I,...T)=>I[f(A,T)],set:(I,...T)=>I[f(A,T)]=T[T.length-1],add:(I,...T)=>I[f(A,T)]+=T[T.length-1],dataOffset:(...I)=>f(A,I),getCoords:(I,T)=>C(A,I,T)}}}function h(A){let{dimensions:v}=A,_=1;for(let I=0,T=v.length;I<T;I++)_*=v[I];return I=>new(I||A.defaultCtor)(_)}function f(A,v){let{accessDimensions:_,axisOrderFastToSlow:I}=A,T=_.length-1,E=_[T]*v[I[T]];for(let w=T-1;w>=0;w--)E=(E+v[I[w]])*_[w];return E}function C(A,v,_){let{dimensions:I,axisOrderFastToSlow:T}=A,E=I.length,w=v;for(let S=0;S<E;S++){let P=I[T[S]];_[T[S]]=w%P,w=Math.floor(w/P)}return _[T[E+1]]=w,_}function g(A){let v=[];for(let _=0;_<A.length;_++)v[_]=A[A.length-_-1];return v}e.invertAxisOrder=g;function b(A,v){let _=[];for(let I=0;I<A.length;I++)_[I]=A[v[I]];return _}function y(A){let v=new Int32Array(A.length);for(let _=0;_<A.length;_++)v[A[_]]=_;return _=>b(_,v)}e.convertToCanonicalAxisIndicesFastToSlow=y;function x(A){let v=new Int32Array(A.length);for(let _=0;_<A.length;_++)v[A[A.length-_-1]]=_;return _=>b(_,v)}e.convertToCanonicalAxisIndicesSlowToFast=x})(cr||(cr={}));function jh(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Yd(e,t,r)}function Yd(e,t,r){let n=t,o=0,i=1;for(e.charCodeAt(n)===45?(i=-1,++n):e.charCodeAt(n)===43&&++n;n<r;n++){let s=e.charCodeAt(n)-48;if(s>9||s<0)return i*o|0;o=10*o+s|0}return i*o}function sq(e,t,r,n){return t.charCodeAt(r)===43&&r++,e*Math.pow(10,Yd(t,r,n))}function aq(e,t,r){for(;t<r&&e.charCodeAt(t)===32;)t++;return Yc(e,t,r)}function Yc(e,t,r){let n=t,o=1,i=0,s=0,a=1;for(e.charCodeAt(n)===45?(o=-1,++n):e.charCodeAt(n)===43&&++n;n<r;){let l=e.charCodeAt(n)-48;if(l>=0&&l<10)i=i*10+l,++n;else if(l===-2){for(++n;n<r;)if(l=e.charCodeAt(n)-48,l>=0&&l<10)s=10*s+l,a=10*a,++n;else return l===53||l===21?sq(o*(i+s/a),e,n+1,r):o*(i+s/a);return o*(i+s/a)}else{if(l===53||l===21)return sq(o*i,e,n+1,r);break}}return o*i}var ue;(function(e){let t;(function(E){E.str={"@type":"str",T:"",valueType:"str"},E.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},E.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},E.int={"@type":"int",T:0,valueType:"int"},E.coord={"@type":"coord",T:0,valueType:"float"},E.float={"@type":"float",T:0,valueType:"float"};function w(H){var V;return{"@type":"str",T:(V=H?.defaultValue)!==null&&V!==void 0?V:"",transform:H?.transform,valueType:"str"}}E.Str=w;function S(H=0){return{"@type":"int",T:H,valueType:"int"}}E.Int=S;function P(H=0){return{"@type":"float",T:H,valueType:"float"}}E.Float=P;function k(H,V=E.float){return{"@type":"tensor",T:H.create(),space:H,valueType:"tensor",baseType:V}}E.Tensor=k;function L(H,V=E.float){return k(cr.Vector(H,V["@type"]==="int"?Int32Array:Float64Array),V)}E.Vector=L;function R(H,V,q=E.float){return k(cr.ColumnMajorMatrix(H,V,q["@type"]==="int"?Int32Array:Float64Array),q)}E.Matrix=R;function N(H){return H}E.Aliased=N;function F(H,V,q=[]){return{"@type":"list",T:q,separator:H,itemParse:V,valueType:"list"}}E.List=F})(t=e.Schema||(e.Schema={}));function r(E){return!!E&&!!E.schema&&!!E.value}e.is=r,e.ValueKind={Present:0,NotPresent:1,Unknown:2};function n(E,w){return lq(w.T,E,w,1)}e.Undefined=n;function o(E,w,S){return lq(E,w,S,0)}e.ofConst=o;function i(E){return wE(E)}e.ofLambda=i;function s(E,w){return i({value:S=>S+E,rowCount:Math.max(w-E+1,0),schema:t.int})}e.range=s;function a(E){return $h(E)}e.ofArray=a;function l(E){return $h({array:E,schema:t.int})}e.ofIntArray=l;function c(E){return $h({array:E,schema:t.float})}e.ofFloatArray=c;function u(E){return $h({array:E,schema:t.str})}e.ofStringArray=u;function d(E){return $h({array:E,schema:t.Aliased(t.str)})}e.ofStringAliasArray=d;function m(E,w=","){return $h({array:E,schema:t.List(w,S=>S)})}e.ofStringListArray=m;function p(E){let{count:w,data:S,indices:P}=E;return wE({value:k=>Yd(S,P[2*k],P[2*k+1])||0,rowCount:w,schema:t.int})}e.ofIntTokens=p;function h(E){let{count:w,data:S,indices:P}=E;return wE({value:k=>Yc(S,P[2*k],P[2*k+1])||0,rowCount:w,schema:t.float})}e.ofFloatTokens=h;function f(E){let{count:w,data:S,indices:P}=E;return wE({value:k=>{let L=S.substring(P[2*k],P[2*k+1]);return L==="."||L==="?"?"":L},rowCount:w,schema:t.str})}e.ofStringTokens=f;function C(E,w,S){return r_e(E,w,S)}e.window=C;function g(E,w,S=!0){return s_e(E,w,S)}e.view=g;function b(E){return e_e(E)}e.createFirstIndexMap=b;function y(E){return t_e(E)}e.createIndexer=y;function x(E,w,S){return c_e(E,w,S||Array)}e.mapToArray=x;function A(E,w){return u_e(E,w)}e.areEqual=A;function v(E,w){return p_e(E,w)}e.indicesOf=v;function _(E,w){return E.__array?E:E.isDefined?$h({array:E.toArray({array:w}),schema:E.schema,valueKind:E.valueKind}):n(E.rowCount,E.schema)}e.asArrayColumn=_;function I(E,w,S=0){if(!E.isDefined)return;let P=E.__array;if(P)for(let k=0,L=P.length;k<L;k++)w[S+k]=P[k];else for(let k=0,L=E.rowCount;k<L;k++)w[S+k]=E.value(k)}e.copyToArray=I;function T(E){for(let w=0,S=E.rowCount;w<S;w++)if(w!==E.value(w))return!1;return!0}e.isIdentity=T})(ue||(ue={}));function e_e(e){let t=new Map;for(let r=0,n=e.rowCount;r<n;r++){let o=e.value(r);t.has(o)||t.set(e.value(r),r)}return t}function t_e(e){let t=new Map;for(let r=0,n=e.rowCount;r<n;r++){let o=e.value(r);t.has(o)||t.set(e.value(r),r)}return r=>t.has(r)?t.get(r):-1}function lq(e,t,r,n){return{schema:r,__array:void 0,isDefined:n===0,rowCount:t,value:i=>e,valueKind:i=>n,toArray:i=>{let{array:s}=eb(t,i);for(let a=0,l=s.length;a<l;a++)s[a]=e;return s},areValuesEqual:(i,s)=>!0}}function wE({value:e,valueKind:t,areValuesEqual:r,rowCount:n,schema:o}){return{schema:o,__array:void 0,isDefined:!0,rowCount:n,value:e,valueKind:t||(i=>0),toArray:i=>{let{array:s,start:a}=eb(n,i);for(let l=0,c=s.length;l<c;l++)s[l]=e(l+a);return s},areValuesEqual:r||((i,s)=>e(i)===e(s))}}function $h({array:e,schema:t,valueKind:r}){let n=e.length,o=t.T,i=t.valueType==="str"?t.transform==="lowercase"?a=>{let l=e[a];return typeof l=="string"?l.toLowerCase():`${l??o}`.toLowerCase()}:t.transform==="uppercase"?a=>{let l=e[a];return typeof l=="string"?l.toUpperCase():`${l??o}`.toUpperCase()}:a=>{let l=e[a];return typeof l=="string"?l:`${l??o}`}:a=>e[a],s=xE(e);return{schema:t,__array:e,isDefined:!0,rowCount:n,value:i,valueKind:r||(a=>0),toArray:t.valueType==="str"?t.transform==="lowercase"?a=>{let{start:l,end:c}=d0(n,a),u=new(a&&typeof a.array<"u"?a.array:e.constructor)(c-l);for(let d=0,m=c-l;d<m;d++){let p=e[l+d];u[d]=typeof p=="string"?p.toLowerCase():`${p??o}`.toLowerCase()}return u}:t.transform==="uppercase"?a=>{let{start:l,end:c}=d0(n,a),u=new(a&&typeof a.array<"u"?a.array:e.constructor)(c-l);for(let d=0,m=c-l;d<m;d++){let p=e[l+d];u[d]=typeof p=="string"?p.toUpperCase():`${p??o}`.toUpperCase()}return u}:a=>{let{start:l,end:c}=d0(n,a),u=new(a&&typeof a.array<"u"?a.array:e.constructor)(c-l);for(let d=0,m=c-l;d<m;d++){let p=e[l+d];u[d]=typeof p=="string"?p:`${p??o}`}return u}:s?a=>CE(e,a):a=>{let{start:l,end:c}=d0(n,a);if(l===0&&c===e.length)return e;let u=new(a&&typeof a.array<"u"?a.array:e.constructor)(c-l);for(let d=0,m=c-l;d<m;d++)u[d]=e[l+d];return u},areValuesEqual:(a,l)=>e[a]===e[l]}}function r_e(e,t,r){return e.isDefined?t===0&&r===e.rowCount?e:e.__array&&xE(e.__array)?n_e(e,t,r):o_e(e,t,r):ue.Undefined(r-t,e.schema)}function n_e(e,t,r){let n=CE(e.__array,{start:t,end:r}),o=e.valueKind;return $h({array:n,schema:e.schema,valueKind:i=>o(t+i)})}function o_e(e,t,r){let n=e.value,o=e.valueKind,i=e.areValuesEqual,s=t===0?n:l=>n(l+t),a=r-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:a,value:s,valueKind:t===0?o:l=>o(l+t),toArray:l=>{let{array:c}=eb(a,l);for(let u=0,d=c.length;u<d;u++)c[u]=n(u+t);return c},areValuesEqual:t===0?i:(l,c)=>i(l+t,c+t)}}function i_e(e,t){if(e.length!==t)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]!==r)return!1;return!0}function s_e(e,t,r){return e.rowCount===0||r&&i_e(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?a_e(e,t):l_e(e,t)}function a_e(e,t){let r=e.__array,n=new r.constructor(t.length);for(let i=0,s=t.length;i<s;i++)n[i]=r[t[i]];let o=e.valueKind;return $h({array:n,schema:e.schema,valueKind:i=>o(t[i])})}function l_e(e,t){let r=e.value,n=e.valueKind,o=e.areValuesEqual,i=a=>r(t[a]),s=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:i,valueKind:a=>n(t[a]),toArray:a=>{let{array:l}=eb(s,a);for(let c=0,u=l.length;c<u;c++)l[c]=r(t[c]);return l},areValuesEqual:(a,l)=>o(t[a],t[l])}}function c_e(e,t,r){let n=new r(e.rowCount);for(let o=0,i=e.rowCount;o<i;o++)n[o]=t(e.value(o));return n}function u_e(e,t){return e===t?!0:e.rowCount!==t.rowCount||e.isDefined!==t.isDefined||e.schema.valueType!==t.schema.valueType?!1:e.__array&&t.__array?d_e(e,t):m_e(e,t)}function d_e(e,t){let r=e.__array,n=t.__array;for(let o=0,i=e.rowCount;o<i;o++)if(r[o]!==n[o])return!1;return!0}function m_e(e,t){let r=e.value,n=t.value;for(let o=0,i=e.rowCount;o<i;o++)if(r(o)!==n(o))return!1;return!0}function p_e(e,t){let r=[],n=e.value;for(let o=0,i=e.rowCount;o<i;o++)t(n(o))&&(r[r.length]=o);return r}function _E(e,t,r){return e[t]-e[r]}function Wh(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function cq(e,t,r,n){let o=r+n>>1;return t(e,r,n)>0?t(e,r,o)>0?t(e,o,n)>0?o:n:r:t(e,n,o)>0?t(e,o,r)>0?o:r:n}function f_e(e,t,r){let{cmp:n,swap:o,data:i,parts:s}=e,a=t+1,l=r;for(o(i,t,cq(i,n,t,r));n(i,l,t)>0;)--l;for(let c=t+1;c<=l;c++){let u=n(i,c,t);if(u>0){for(o(i,c,l),--l;n(i,l,t)>0;)--l;c--}else u===0&&(o(i,c,a),a++)}for(let c=t;c<a;c++)o(i,c,t+l-c);s[0]=l-a+t+1,s[1]=l}function h_e({data:e,cmp:t,swap:r},n,o){for(let i=n+1;i<=o;i++){let s=i-1;for(;s>=n&&t(e,s,s+1)>0;)r(e,s,s+1),s=s-1}}function TE(e,t,r){let{parts:n}=e;for(;t<r;){if(r-t<16){h_e(e,t,r);return}f_e(e,t,r);let o=n[0],i=n[1];o-t<r-i?(TE(e,t,o-1),t=i+1):(TE(e,i+1,r),r=o-1)}}function g_e(e,t,r,n){let o=r+1,i=n;Wh(e,r,cq(e,_E,r,n));let s=e[r];for(;e[i]>s;)--i;for(let a=r+1;a<=i;a++){let l=e[a];if(l>s){for(Wh(e,a,i),--i;e[i]>s;)--i;a--}else l===s&&(Wh(e,a,o),++o)}for(let a=r;a<o;a++)Wh(e,a,r+i-a);t[0]=i-o+r+1,t[1]=i}function y_e(e,t,r){for(let n=t+1;n<=r;n++){let o=e[n],i=n-1;for(;i>=t&&e[i]>o;)e[i+1]=e[i],i=i-1;e[i+1]=o}}function iO(e,t,r,n){for(;r<n;){if(n-r<16){y_e(e,r,n);return}g_e(e,t,r,n);let o=t[0],i=t[1];o-r<n-i?(iO(e,t,r,o-1),r=i+1):(iO(e,t,i+1,n),n=o-1)}}function _a(e,t=_E){return v_e(e,0,e.length,t)}function v_e(e,t,r,n=_E){return n===_E?iO(e,[0,0],t,r-1):TE({data:e,cmp:n,swap:Wh,parts:[0,0]},t,r-1),e}function EE(e,t,r,n,o){return TE({data:e,cmp:n,swap:o,parts:[0,0]},t,r-1),e}var gr;(function(e){function t(x){return x&&typeof x._rowCount=="number"&&!!x._columns&&!!x._schema}e.is=t;function r(x,A,v={}){let _=Object.create(null),I=Object.keys(x);_._rowCount=A._rowCount,_._columns=I,_._schema=x;for(let T of I)if(A[T])_[T]=A[T];else if(v[T])_[T]=v[T];else throw Error(`Cannot find column '${T}'.`);return _}e.pickColumns=r;function n(x,A){let v=Object.keys(A);return{_rowCount:A[v[0]].rowCount,_columns:v,_schema:x,...A}}e.ofColumns=n;function o(x,A,v){let _=Object.create(null),I=Object.keys(x);_._rowCount=v,_._columns=I,_._schema=x;for(let T of I)T in A?_[T]=A[T]:_[T]=ue.Undefined(v,x[T]);return _}e.ofPartialColumns=o;function i(x,A){let v=Object.create(null),_=Object.keys(x);v._rowCount=A,v._columns=_,v._schema=x;for(let I of _)v[I]=ue.Undefined(A,x[I]);return v}e.ofUndefinedColumns=i;function s(x,A){let v=Object.create(null),_=A.length,I=Object.keys(x);v._rowCount=_,v._columns=I,v._schema=x;for(let T of I)v[T]=ue.ofLambda({rowCount:_,schema:x[T],value:E=>A[E][T],valueKind:E=>typeof A[E][T]>"u"?1:0});return v}e.ofRows=s;function a(x,A){var v;let _=Object.create(null),I=Object.keys(x);_._rowCount=0,_._columns=I,_._schema=x;for(let T of I)typeof A[T]<"u"?(_[T]=ue.ofArray({array:A[T],schema:x[T]}),_._rowCount=(v=A[T])===null||v===void 0?void 0:v.length):_[T]=ue.Undefined(_._rowCount,x[T]);return _}e.ofArrays=a;function l(x,A,v){let _=Object.create(null),I=Object.keys(A);_._rowCount=v.length,_._columns=I,_._schema=A;for(let T of I)_[T]=ue.view(x[T],v);return _}e.view=l;function c(x,A,v){let _=[];for(let I=0,T=x._rowCount;I<T;++I)v(I)&&_.push(I);return l(x,A,_)}e.pick=c;function u(x,A,v,_){if(v===0&&_===x._rowCount)return x;let I=Object.create(null),T=Object.keys(A);I._rowCount=_-v,I._columns=T,I._schema=A;for(let E of T)I[E]=ue.window(x[E],v,_);return I}e.window=u;function d(x,A){let v=Object.create(null),_=Object.keys(A);v._rowCount=0;for(let E of x)v._rowCount+=E._rowCount;let I={};for(let E of _)I[E]=new Array(v._rowCount);v._columns=_,v._schema=A;let T=0;for(let E of x){for(let w of _)ue.copyToArray(E[w],I[w],T);T+=E._rowCount}for(let E of _)v[E]=ue.ofArray({array:I[E],schema:A[E]});return v}e.concat=d;function m(x,A,v){x[A]=ue.asArrayColumn(x[A],v)}e.columnToArray=m;function p(x,A){let v=new Int32Array(x._rowCount);for(let T=0,E=v.length;T<E;T++)v[T]=T;_a(v,(T,E,w)=>A(E,w));let _=!0;for(let T=0,E=v.length;T<E;T++)if(v[T]!==T){_=!1;break}if(_)return x;let I=Object.create(null);I._rowCount=x._rowCount,I._columns=x._columns,I._schema=x._schema;for(let T of x._columns)I[T]=ue.view(x[T],v,!1);return I}e.sort=p;function h(x,A){if(x._rowCount!==A._rowCount||x._columns.length!==A._columns.length)return!1;for(let v of x._columns)if(!A[v])return!1;for(let v of x._columns)if(!ue.areEqual(x[v],A[v]))return!1;return!0}e.areEqual=h;function f(x,A){let v=Object.create(null),{_columns:_}=x;for(let I=0;I<_.length;I++){let T=_[I];v[T]=x[T].value(A)}return v}e.getRow=f;function C(x,A){for(let v=0,_=x._rowCount;v<_;++v)if(A(v))return f(x,v)}e.pickRow=C;function g(x){let A=[],{_rowCount:v}=x;for(let _=0;_<v;_++)A[_]=f(x,_);return A}e.getRows=g;function b(x){let A={},{_columns:v}=x;for(let _=0;_<v.length;_++){let I=v[_];A[I]=x[I].toArray()}return A}e.toArrays=b;function y(x){let A=_n.create(),{_columns:v,_rowCount:_}=x,I=1;_n.write(A,"|");for(let T=0;T<v.length;T++)_n.write(A,v[T]),_n.write(A,"|"),I+=v[T].length+1;_n.newline(A),_n.write(A,new Array(I+1).join("-")),_n.newline(A);for(let T=0;T<_;T++){_n.write(A,"|");for(let E=0;E<v.length;E++){let w=x[v[E]];w.valueKind(T)===0?(_n.write(A,w.value(T)),_n.write(A,"|")):_n.write(A,".|")}_n.newline(A)}return _n.getString(A)}e.formatToString=y})(gr||(gr={}));var BA;(function(e){function t(n,o,i){let s=Object.keys(i),a=Object.create(null),l=[];a._name=n,a._tableNames=l,a._schema=o;for(let c of s)gr.is(i[c])&&(a[c]=i[c],l[l.length]=c);return a}e.ofTables=t;function r(n){let o={};for(let i of n._tableNames)o[i]=gr.getRows(n[i]);return o}e.getTablesAsRows=r})(BA||(BA={}));function dr(e){return function(t){return PE(e,t)}}function PE(e,t){let{data:r,indices:n,count:o}=e,{valueType:i}=t,s=i==="str"?a=>r.substring(n[2*a],n[2*a+1]):i==="int"?a=>Yd(r,n[2*a],n[2*a+1])||0:a=>Yc(r,n[2*a],n[2*a+1])||0;return{schema:t,__array:void 0,isDefined:!0,rowCount:o,value:s,valueKind:a=>0,toArray:a=>bi.createAndFillArray(o,s,a),areValuesEqual:sO(e)}}function sO(e){let{data:t,indices:r}=e;return function(n,o){let i=r[2*n],s=r[2*o],a=r[2*n+1]-i;if(a!==r[2*o+1]-s)return!1;for(let l=0;l<a;l++)if(t.charCodeAt(l+i)!==t.charCodeAt(l+s))return!1;return!0}}function uq(e){let{count:t,indices:r}=e;for(let n=0;n<t;++n)if(r[2*n]!==r[2*n+1])return!1;return!0}function DE(e,t){return{name:t,blocks:e}}function LA(e,t,r,n=[]){return{categoryNames:e,header:r,categories:t,saveFrames:n,getField(o){let[i,s]=o.split(".");return t[i].getField(s||"")}}}function dq(e,t,r){return{categoryNames:e,header:r,categories:t}}function Hi(e,t,r,n){return{rowCount:t,name:e,fieldNames:[...r],getField(o){return n[o]}}}(function(e){function t(o){return{rowCount:0,name:o,fieldNames:[],getField(i){}}}e.empty=t;function r(o,i){let s=Object.keys(i);return{rowCount:s.length>0?i[s[0]].rowCount:0,name:o,fieldNames:s,getField(a){return i[a]}}}e.ofFields=r;function n(o,i){let s={};for(let a of i._columns)s[a]=Pt.ofColumn(i[a]);return r(o,s)}e.ofTable=n})(Hi||(Hi={}));var Pt;(function(e){function t(a){return r([a])}e.ofString=t;function r(a){let l=a.length,c=p=>{let h=a[p];return!h||h==="."||h==="?"?"":h},u=p=>{let h=a[p];return Yd(h,0,h.length)||0},d=p=>{let h=a[p];return Yc(h,0,h.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:c,int:u,float:d,valueKind:p=>{let h=a[p],f=h.length;if(f>1)return 0;if(f===0)return 1;let C=h.charCodeAt(0);return C===46?1:C===63?2:0},areValuesEqual:(p,h)=>a[p]===a[h],toStringArray:p=>p?bi.createAndFillArray(l,c,p):a,toIntArray:p=>bi.createAndFillArray(l,u,p),toFloatArray:p=>bi.createAndFillArray(l,d,p)}}e.ofStrings=r;function n(a){let l=a.length,c=p=>""+a[p],u=p=>a[p],d=p=>0,m=p=>!p||p.array&&a instanceof p.array?a:bi.createAndFillArray(l,u,p);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:c,int:u,float:u,valueKind:d,areValuesEqual:(p,h)=>a[p]===a[h],toStringArray:p=>bi.createAndFillArray(l,c,p),toIntArray:m,toFloatArray:m}}e.ofNumbers=n;function o(a){let{data:l,indices:c,count:u}=a,d=f=>{let C=l.substring(c[2*f],c[2*f+1]);return C==="."||C==="?"?"":C},m=f=>Yd(l,c[2*f],c[2*f+1])||0,p=f=>Yc(l,c[2*f],c[2*f+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:d,int:m,float:p,valueKind:f=>{let C=c[2*f],g=c[2*f+1]-C;if(g>1)return 0;if(g===0)return 1;let b=l.charCodeAt(C);return b===46?1:b===63?2:0},areValuesEqual:sO(a),toStringArray:f=>bi.createAndFillArray(u,d,f),toIntArray:f=>bi.createAndFillArray(u,m,f),toFloatArray:f=>bi.createAndFillArray(u,p,f)}}e.ofTokens=o;function i(a){let{rowCount:l,valueKind:c,areValuesEqual:u,isDefined:d}=a,m,p,h;switch(a.schema.valueType){case"float":case"int":m=C=>""+a.value(C),p=a.value,h=a.value;break;case"str":m=a.value,p=C=>{let g=a.value(C);return Yd(g,0,g.length)||0},h=C=>{let g=a.value(C);return Yc(g,0,g.length)||0};break;case"list":let{separator:f}=a.schema;m=C=>a.value(C).join(f),p=C=>NaN,h=C=>NaN;break;default:throw new Error(`unsupported valueType '${a.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:l,str:m,int:p,float:h,valueKind:c,areValuesEqual:u,toStringArray:f=>bi.createAndFillArray(l,m,f),toIntArray:f=>bi.createAndFillArray(l,p,f),toFloatArray:f=>bi.createAndFillArray(l,h,f)}}e.ofColumn=i;function s(a,l){return i(ue.Undefined(a,l))}e.ofUndefined=s})(Pt||(Pt={}));function mq(e,t,r,n){let o=r?0:1;switch(t){case 1:return n==="brackets"?i=>`${e}[${i+o}]`:i=>`${e}_${i+o}`;case 2:return n==="brackets"?(i,s)=>`${e}[${i+o}][${s+o}]`:(i,s)=>`${e}_${i+o}${s+o}`;case 3:return n==="brackets"?(i,s,a)=>`${e}[${i+o}][${s+o}][${a+o}]`:(i,s,a)=>`${e}_${i+o}${s+o}${a+o}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function pq(e,t,r,n){let o=t.create();if(t.rank===1){let i=t.dimensions[0];for(let s=0;s<i;s++){let a=e.getField(n(s));t.set(o,s,a?a.float(r):0)}}else if(t.rank===2){let i=t.dimensions[0],s=t.dimensions[1];for(let a=0;a<i;a++)for(let l=0;l<s;l++){let c=e.getField(n(a,l));t.set(o,a,l,c?c.float(r):0)}}else if(t.rank===3){let i=t.dimensions[0],s=t.dimensions[1],a=t.dimensions[2];for(let l=0;l<i;l++)for(let c=0;c<s;c++)for(let u=0;u<a;u++){let d=e.getField(n(l,c,u));t.set(o,l,c,u,d?d.float(r):0)}}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return o}function Tt(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}(function(e){function t(b){return b.data.substring(b.tokenStart,b.tokenEnd)}e.getTokenString=t;function r(b){b.position=0,b.lineNumber=1,b.tokenStart=0,b.tokenEnd=0}e.reset=r;function n(b){let{data:y}=b;for(;b.position<b.length;)switch(y.charCodeAt(b.position)){case 10:return b.tokenEnd=b.position,++b.position,++b.lineNumber,!0;case 13:return b.tokenEnd=b.position,++b.position,++b.lineNumber,y.charCodeAt(b.position)===10&&++b.position,!0;default:++b.position;break}return b.tokenEnd=b.position,b.tokenStart!==b.tokenEnd}e.eatLine=n;function o(b){b.tokenStart=b.position}e.markStart=o;function i(b){return b.tokenStart=b.position,n(b)}e.markLine=i;function s(b){return i(b),t(b)}e.readLine=s;function a(b){i(b);let y=b.position;return g(b,b.tokenStart,b.tokenEnd),b.position=y,t(b)}e.readLineTrim=a;function l(b,y,x){let A=0;for(let v=0;v<y;v++){if(!i(b))return A;ct.addUnchecked(x,b.tokenStart,b.tokenEnd),A++}return A}function c(b,y){let x=ct.create(b.data,y*2);return l(b,y,x),x}e.markLines=c;function u(b,y){let x=[];for(let A=0;A<y;A++)x.push(e.readLine(b));return x}e.readLines=u;async function d(b,y,x,A=1e5){let v=ct.create(b.data,y*2),_=0;return await yc(x,A,b,(I,T)=>{let E=Math.min(y-_,I);return l(T,E,v),_+=E,E},(I,T)=>I.update({message:"Parsing...",current:T.position,max:T.length})),v}e.readLinesAsync=d;function m(b){let y=e(b),x=ct.create(y.data,Math.max(b.length/80,2));for(;i(y);)ct.add(x,y.tokenStart,y.tokenEnd);return x}e.readAllLines=m;function p(b,y,x){let A=0;for(let v=0;v<y;v++){if(!i(b))return A;ct.add(x,b.tokenStart,b.tokenEnd),A++}return A}async function h(b,y,x=1e5){let A=e(b),v=ct.create(A.data,Math.max(b.length/80,2));return await yc(y,x,A,(_,I)=>(p(I,_,v),I.position<I.length?_:0),(_,I)=>_.update({message:"Parsing...",current:I.position,max:I.length})),v}e.readAllLinesAsync=h;function f(b){for(;b.position<b.length;)switch(b.data.charCodeAt(b.position)){case 9:case 10:case 13:case 32:b.tokenEnd=b.position;return;default:++b.position;break}b.tokenEnd=b.position}e.eatValue=f;function C(b){let y=-1;for(;b.position<b.length;){let x=b.data.charCodeAt(b.position);switch(x){case 9:case 32:y=x,++b.position;break;case 10:y!==13&&++b.lineNumber,y=x,++b.position;break;case 13:y=x,++b.position,++b.lineNumber;break;default:return y}}return y}e.skipWhitespace=C;function g(b,y,x){let{data:A}=b,v=y,_=x-1,I=A.charCodeAt(v);for(;(I===9||I===32)&&v<=_;)I=A.charCodeAt(++v);for(I=A.charCodeAt(_);(I===9||I===32)&&_>=v;)I=A.charCodeAt(--_);return b.tokenStart=v,b.tokenEnd=_+1,b.position=x,b}e.trim=g})(Tt||(Tt={}));function fq(e,t,r){let n=t,o=r-1,i=e.charCodeAt(n);for(;(i===9||i===32)&&n<=o;)i=e.charCodeAt(++n);for(i=e.charCodeAt(o);(i===9||i===32)&&o>=n;)i=e.charCodeAt(--o);return e.substring(n,o+1)}var ct;(function(e){function t(s){let a=new Uint32Array(1.61*s.indices.length|0);a.set(s.indices),s.indices=a,s.indicesLenMinus2=a.length-2|0}function r(s,a,l){let c=s;c.offset>c.indicesLenMinus2&&t(c),c.indices[c.offset++]=a,c.indices[c.offset++]=l,s.count++}e.add=r;function n(s,a){r(s,a.tokenStart,a.tokenEnd)}e.addToken=n;function o(s,a,l){s.indices[s.offset++]=a,s.indices[s.offset++]=l,s.count++}e.addUnchecked=o;function i(s,a){return a=Math.max(10,a),{data:s,indicesLenMinus2:a-2|0,count:0,offset:0,indices:new Uint32Array(a)}}e.create=i})(ct||(ct={}));function hq(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:e.tokenEnd=e.position;return;default:++e.position;break}e.tokenEnd=e.position}function x_e(e,t){let r,n;for(++e.position;e.position<e.length;)if(n=e.data.charCodeAt(e.position),n===t)switch(r=e.data.charCodeAt(e.position+1),r){case 9:case 10:case 13:case 32:e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return;default:if(r===void 0){e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,++e.position;return}++e.position;break}else{if(n===10||n===13){e.tokenEnd=e.position;return}++e.position}e.tokenEnd=e.position}function C_e(e){for(e.position+=3;e.position<e.length;){if(e.data.charCodeAt(e.position)===39&&vq(e)){e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,e.position+=3;return}++e.position}e.tokenEnd=e.position}function S_e(e){let t=59,r=e.position+1,n;for(;r<e.length;)if(n=e.data.charCodeAt(r),n===59&&(t===10||t===13)){for(e.position=r+1,e.tokenStart++,r--,n=e.data.charCodeAt(r);n===10||n===13;)r--,n=e.data.charCodeAt(r);e.tokenEnd=r+1,e.isEscaped=!0;return}else(n===13||n===10&&t!==13)&&e.lineNumber++,t=n,++r;return e.position=r,t}function I_e(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 93:++e.position,e.tokenEnd=e.position,e.isImportGet=!1;return;default:++e.position;break}}function A_e(e){for(;e.position<e.length;){let t=e.data.charCodeAt(e.position);if(t===10||t===13)return;++e.position}}function w_e(e){let t=10;for(;e.position<e.length;){let r=e.data.charCodeAt(e.position);switch(r){case 9:case 32:t=r,++e.position;break;case 10:t!==13&&++e.lineNumber,t=r,++e.position;break;case 13:t=r,++e.position,++e.lineNumber;break;default:return t}}return t}function vq(e){return!(e.length-e.position<2||e.data.charCodeAt(e.position+1)!==39||e.data.charCodeAt(e.position+2)!==39)}function __e(e){let t=e.data.charCodeAt(e.tokenStart);return!(t!==68&&t!==100||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==84&&t!==116)||(t=e.data.charCodeAt(e.tokenStart+3),t!==65&&t!==97))}function T_e(e){let t=e.data.charCodeAt(e.tokenStart);return!(t!==83&&t!==115||(t=e.data.charCodeAt(e.tokenStart+1),t!==65&&t!==97)||(t=e.data.charCodeAt(e.tokenStart+2),t!==86&&t!==118)||(t=e.data.charCodeAt(e.tokenStart+3),t!==69&&t!==101))}function E_e(e){if(e.tokenEnd-e.tokenStart!==5)return!1;let t=e.data.charCodeAt(e.tokenStart);return!(t!==76&&t!==108||(t=e.data.charCodeAt(e.tokenStart+1),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+2),t!==79&&t!==111)||(t=e.data.charCodeAt(e.tokenStart+3),t!==80&&t!==112))}function P_e(e){return!(e.tokenEnd-e.tokenStart!==11||e.data.charCodeAt(e.tokenStart+1)!==105||e.data.charCodeAt(e.tokenStart+2)!==109||e.data.charCodeAt(e.tokenStart+3)!==112||e.data.charCodeAt(e.tokenStart+4)!==111||e.data.charCodeAt(e.tokenStart+5)!==114||e.data.charCodeAt(e.tokenStart+6)!==116||e.data.charCodeAt(e.tokenStart+7)!==46||e.data.charCodeAt(e.tokenStart+8)!==103||e.data.charCodeAt(e.tokenStart+9)!==101||e.data.charCodeAt(e.tokenStart+10)!==116)}function D_e(e,t,r){let n,o=r-t,i=e.tokenStart-t,s=e.tokenEnd-e.tokenStart;if(s<o)return!1;for(n=t;n<r;++n)if(e.data.charCodeAt(n)!==e.data.charCodeAt(n+i))return!1;return o===s||e.data.charCodeAt(n+i)===46}function bq(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return t;return t}function xq(e,t){return e.data.substring(e.tokenStart,t)}function k_e(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(e.data.charCodeAt(t)===46)return!1;return!0}function lO(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function gq(e){let t=w_e(e);if(e.position>=e.length){e.tokenType=6;return}e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;let r=e.data.charCodeAt(e.position);switch(r){case 35:A_e(e),e.tokenType=5;break;case 39:if(vq(e)){C_e(e),e.tokenType=3;break}case 34:x_e(e,r),e.tokenType=3;break;case 59:t===10||t===13?S_e(e):hq(e),e.tokenType=3;break;default:e.isImportGet?I_e(e):hq(e),e.isEscaped?e.tokenType=3:e.data.charCodeAt(e.tokenStart)===95?(e.inSaveFrame&&P_e(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenEnd-e.tokenStart>=5&&e.data.charCodeAt(e.tokenStart+4)===95?__e(e)?e.tokenType=0:T_e(e)?e.tokenType=1:E_e(e)?e.tokenType=2:e.tokenType=3:e.tokenType=3;break}}function f0(e){for(gq(e);e.tokenType===5;)gq(e)}function M_e(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}function kE(){return{categoryNames:[],categoryData:Object.create(null)}}function uO(e,t){let r=Object.create(null);for(let n of e){let o=t[n];r[n]=Hi(o.name,o.rowCount,o.fieldNames,o.fields)}return r}function yq(e,t,r){return LA(e.categoryNames,uO(e.categoryNames,e.categoryData),t,r)}function R_e(e,t){return LA(e.categoryNames,uO(e.categoryNames,e.categoryData),t)}function cO(e,t,r,n,o){if(t in e.categoryData){let i=e.categoryData[t];i.fieldNames.push(...n),Object.assign(i.fields,o)}else e.categoryData[t]={name:t,rowCount:r,fieldNames:n,fields:o},e.categoryNames.push(t)}function B_e(e,t){let r=e.tokenStart,n=bq(e),o=xq(e,n),i=Object.create(null),s=[],a=!0;for(;a;){if(e.tokenType!==4||!D_e(e,r,n)){a=!1;break}let l=lO(e).substring(o.length+1);if(f0(e),e.tokenType!==3)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};i[l]=Pt.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),s[s.length]=l,f0(e)}return cO(t,o.substr(1),1,s,i),{hasError:!1,errorLine:0,errorMessage:""}}function L_e(e,t){let{tokenizer:r,tokens:n,fieldCount:o}=t,i=t.tokenCount,s=0;for(;r.tokenType===3&&s<e;)ct.add(n[i++%o],r.tokenStart,r.tokenEnd),f0(r),s++;return t.tokenCount=i,s}function N_e(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}async function F_e(e,t){let r=e.lineNumber;f0(e);let n=xq(e,bq(e)),o=k_e(e),i=[];for(;e.tokenType===4;)i[i.length]=o?lO(e):lO(e).substring(n.length+1),f0(e);let s=n==="_atom_site"?e.data.length/100|0:32,a=[],l=i.length;for(let d=0;d<l;d++)a[d]=ct.create(e.data,s);let c={fieldCount:l,tokenCount:0,tokenizer:e,tokens:a};if(await yc(e.runtimeCtx,1e6,c,L_e,N_e),c.tokenCount%l!==0)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`The number of values for loop starting at line ${r} is not a multiple of the number of columns.`};let u=c.tokenCount/l|0;if(o)for(let d=0;d<l;d++){let m={"":Pt.ofTokens(a[d])};cO(t,i[d].substr(1),u,[""],m)}else{let d=Object.create(null);for(let m=0;m<l;m++)d[i[m]]=Pt.ofTokens(a[m]);cO(t,n.substr(1),u,i,d)}return{hasError:!1,errorLine:0,errorMessage:""}}function Cx(e,t){return Hr.error(t,e)}function O_e(e){return Hr.success(e)}async function V_e(e,t){let r=[],n=M_e(e,t),o="",i=kE(),s=[],a=kE(),l=dq(a.categoryNames,uO(a.categoryNames,a.categoryData),""),c="";for(t.update({message:"Parsing...",current:0,max:e.length}),f0(n);n.tokenType!==6;){let u=n.tokenType;if(u===0){if(n.inSaveFrame)return Cx(n.lineNumber,"Unexpected data block inside a save frame.");i.categoryNames.length>0&&r.push(yq(i,o,s)),o=e.substring(n.tokenStart+5,n.tokenEnd),i=kE(),s=[],f0(n)}else if(u===1){if(n.tokenEnd-n.tokenStart===5)a.categoryNames.length>0&&(s[s.length]=R_e(a,c)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return Cx(n.lineNumber,"Save frames cannot be nested.");n.inSaveFrame=!0,c=e.substring(n.tokenStart+5,n.tokenEnd),a=kE()}f0(n)}else if(u===2){let d=await F_e(n,n.inSaveFrame?a:i);if(d.hasError)return Cx(d.errorLine,d.errorMessage)}else if(u===4){let d=B_e(n,n.inSaveFrame?a:i);if(d.hasError)return Cx(d.errorLine,d.errorMessage)}else return Cx(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")}return n.inSaveFrame?Cx(n.lineNumber,`Unfinished save frame (${l.header}).`):((i.categoryNames.length>0||s.length>0)&&r.push(yq(i,o,s)),O_e(DE(r)))}function dO(e){return ke.create("Parse CIF",async t=>await V_e(e,t))}var Cq="0.3.0",En;(function(e){let t;(function(i){i[i.Int8=1]="Int8",i[i.Int16=2]="Int16",i[i.Int32=3]="Int32",i[i.Uint8=4]="Uint8",i[i.Uint16=5]="Uint16",i[i.Uint32=6]="Uint32"})(t=e.IntDataType||(e.IntDataType={}));let r;(function(i){i[i.Float32=32]="Float32",i[i.Float64=33]="Float64"})(r=e.FloatDataType||(e.FloatDataType={}));function n(i){let s;return i instanceof Int8Array?s=e.IntDataType.Int8:i instanceof Int16Array?s=e.IntDataType.Int16:i instanceof Int32Array?s=e.IntDataType.Int32:i instanceof Uint8Array?s=e.IntDataType.Uint8:i instanceof Uint16Array?s=e.IntDataType.Uint16:i instanceof Uint32Array?s=e.IntDataType.Uint32:i instanceof Float32Array?s=e.FloatDataType.Float32:i instanceof Float64Array?s=e.FloatDataType.Float64:s=e.IntDataType.Int32,s}e.getDataType=n;function o(i){if(i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array)return!0;for(let s=0,a=i.length;s<a;s++)if(s<0)return!1;return!0}e.isSignedIntegerDataType=o})(En||(En={}));var Sq=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function Iq(e,t){let r=new ArrayBuffer(e.length),n=new Uint8Array(r);for(let o=0,i=e.length;o<i;o+=t)for(let s=0;s<t;s++)n[o+t-s-1]=e[o+s];return r}var mO=28672;function Aq(e){if(e.length>mO){let t=[];for(let r=0;r<e.length;r+=mO)t.push(String.fromCharCode.apply(null,e.subarray(r,r+mO)));return t.join("")}else return String.fromCharCode.apply(null,e)}function Sx(e){let t=e.data;for(let r=e.encoding.length-1;r>=0;r--)t=G_e(t,e.encoding[r]);return t}function G_e(e,t){switch(t.kind){case"ByteArray":switch(t.type){case En.IntDataType.Uint8:return e;case En.IntDataType.Int8:return U_e(e);case En.IntDataType.Int16:return z_e(e);case En.IntDataType.Uint16:return H_e(e);case En.IntDataType.Int32:return j_e(e);case En.IntDataType.Uint32:return $_e(e);case En.FloatDataType.Float32:return W_e(e);case En.FloatDataType.Float64:return q_e(e);default:Sr(t.type)}case"FixedPoint":return Z_e(e,t);case"IntervalQuantization":return K_e(e,t);case"RunLength":return X_e(e,t);case"Delta":return Y_e(e,t);case"IntegerPacking":return eTe(e,t);case"StringArray":return tTe(e,t)}}function wq(e,t){switch(e){case En.IntDataType.Int8:return new Int8Array(t);case En.IntDataType.Int16:return new Int16Array(t);case En.IntDataType.Int32:return new Int32Array(t);case En.IntDataType.Uint8:return new Uint8Array(t);case En.IntDataType.Uint16:return new Uint16Array(t);case En.IntDataType.Uint32:return new Uint32Array(t);default:return new Int32Array(t)}}function _q(e,t){switch(e){case En.FloatDataType.Float32:return new Float32Array(t);case En.FloatDataType.Float64:return new Float64Array(t);default:return new Float64Array(t)}}function U_e(e){return new Int8Array(e.buffer,e.byteOffset)}function Ix(e,t,r){return Sq?new r(e.buffer):new r(Iq(e,t))}function z_e(e){return Ix(e,2,Int16Array)}function H_e(e){return Ix(e,2,Uint16Array)}function j_e(e){return Ix(e,4,Int32Array)}function $_e(e){return Ix(e,4,Uint32Array)}function W_e(e){return Ix(e,4,Float32Array)}function q_e(e){return Ix(e,8,Float64Array)}function Z_e(e,t){let r=e.length,n=_q(t.srcType,r),o=1/t.factor;for(let i=0;i<r;i++)n[i]=o*e[i];return n}function K_e(e,t){let r=e.length,n=_q(t.srcType,r),o=(t.max-t.min)/(t.numSteps-1),i=t.min;for(let s=0;s<r;s++)n[s]=i+o*e[s];return n}function X_e(e,t){let r=wq(t.srcType,t.srcSize),n=0;for(let o=0,i=e.length;o<i;o+=2){let s=e[o],a=e[o+1];for(let l=0;l<a;++l)r[n++]=s}return r}function Y_e(e,t){let r=e.length,n=wq(t.srcType,r);if(!r)return e;n[0]=e[0]+(t.origin|0);for(let o=1;o<r;++o)n[o]=e[o]+n[o-1];return n}function Q_e(e,t){let r=t.byteCount===1?127:32767,n=-r-1,o=e.length,i=new Int32Array(t.srcSize),s=0,a=0;for(;s<o;){let l=0,c=e[s];for(;c===r||c===n;)l+=c,s++,c=e[s];l+=c,i[a]=l,s++,a++}return i}function J_e(e,t){let r=t.byteCount===1?255:65535,n=e.length,o=new Int32Array(t.srcSize),i=0,s=0;for(;i<n;){let a=0,l=e[i];for(;l===r;)a+=l,i++,l=e[i];a+=l,o[s]=a,i++,s++}return o}function eTe(e,t){return e.length===t.srcSize?e:t.isUnsigned?J_e(e,t):Q_e(e,t)}function tTe(e,t){let r=Sx({encoding:t.offsetEncoding,data:t.offsets}),n=Sx({encoding:t.dataEncoding,data:e}),o=t.stringData,i=new Array(r.length);i[0]="";for(let l=1,c=r.length;l<c;l++)i[l]=o.substring(r[l-1],r[l]);let s=0,a=new Array(n.length);for(let l=0,c=n.length;l<c;l++)a[s++]=i[n[l]+1];return a}var it;(function(e){function t(m){return m.creator&&m.chunkSize}e.is=t;function r(m){let p=m.growBy*m.elementSize;m.currentSize=p,m.currentIndex=0,m.currentChunk=new m.ctor(p),m.allocatedSize+=p,m.chunks[m.chunks.length]=m.currentChunk}function n(m,p,h,f,C){m.currentIndex>=m.currentSize&&r(m);let g=m.currentChunk,b=m.currentIndex;return g[b]=p,g[b+1]=h,g[b+2]=f,g[b+3]=C,m.currentIndex+=4,m.elementCount++}e.add4=n;function o(m,p,h,f){m.currentIndex>=m.currentSize&&r(m);let C=m.currentChunk,g=m.currentIndex;return C[g]=p,C[g+1]=h,C[g+2]=f,m.currentIndex+=3,m.elementCount++}e.add3=o;function i(m,p,h){m.currentIndex>=m.currentSize&&r(m);let f=m.currentChunk,C=m.currentIndex;return f[C]=p,f[C+1]=h,m.currentIndex+=2,m.elementCount++}e.add2=i;function s(m,p){return m.currentIndex>=m.currentSize&&r(m),m.currentChunk[m.currentIndex]=p,m.currentIndex+=1,m.elementCount++}e.add=s;function a(m,p,h){for(let f=0;f<p;f++)m.currentIndex>=m.currentSize&&r(m),m.currentChunk[m.currentIndex++]=h,m.elementCount++;return m.elementCount}e.addRepeat=a;function l(m,p){let{elementSize:h}=m;for(let f=0,C=p.length;f<C;f+=h){m.currentIndex>=m.currentSize&&r(m);let{currentChunk:g}=m;for(let b=0;b<h;b++)g[m.currentIndex++]=p[f+b];m.elementCount++}return m.elementCount}e.addMany=l;function c(m,p=!1){return u(m,p)}e.compact=c;function u(m,p){let{ctor:h,chunks:f,currentIndex:C}=m;if(!f.length)return new h(0);if(f.length===1&&(p||C===m.allocatedSize))return f[0];let g=0;for(let A=0,v=f.length-1;A<v;A++)g+=f[A].length;g+=m.currentIndex;let b=new h(g),y=0;if(b.buffer)for(let A=0,v=f.length-1;A<v;A++)b.set(f[A],y),y+=f[A].length;else for(let A=0,v=f.length-1;A<v;A++){let _=f[A];for(let I=0,T=_.length;I<T;I++)b[y+I]=_[I];y+=_.length}let x=f[f.length-1];if(b.buffer&&C>=m.currentSize)b.set(x,y);else for(let A=0,v=x.length;A<v;A++)b[y+A]=x[A];return b}e._compact=u;function d(m,p,h,f){let C={ctor:m,elementSize:p,growBy:Math.max(1,Math.ceil(h)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof f>"u")return C;if(typeof f=="number")return C.currentChunk=new m(f*p),C.allocatedSize=f*p,C.currentSize=C.currentChunk.length,C.chunks[0]=C.currentChunk,C;let g=f;if(g.length%p!==0)throw new Error("initialChunk length must be a multiple of the element size.");return C.currentChunk=g,C.allocatedSize=g.length,C.currentSize=g.length,C.chunks[0]=g,C}e.create=d})(it||(it={}));function rTe(e,t,r){return e[t].key<e[r].key?-1:1}function nTe(e,t,r,n,o){let i=new Map,s=[],a=t(e[0]),l=!0;for(let p=n;p<o;p++){let h=t(e[p]);if(i.has(h))i.get(h).count++,a!==h&&(l=!1);else{let f={key:h,count:1,offset:p};i.set(h,f),s[s.length]=f}a=h}let c=new Int32Array(s.length+1);c[s.length]=o;let u=!0;if(r){for(let p=1,h=s.length;p<h;p++)if(s[p-1].key>s[p].key){u=!1;break}}if(l&&u){for(let p=0;p<s.length;p++)c[p]=s[p].offset;return c}r&&!u&&EE(s,0,s.length,rTe,Wh);let d=0;for(let p=0;p<s.length;p++){let h=s[p];h.offset=d,d+=h.count}let m=new Int32Array(o-n);for(let p=n;p<o;p++){let h=t(e[p]),f=i.get(h);m[f.offset++]=e[p]}for(let p=0,h=m.length;p<h;p++)e[p+n]=m[p];c[0]=n;for(let p=1;p<s.length;p++)c[p]=s[p-1].offset+n;return c}function ME(e,t,r){let n=r&&r.start||0,o=r&&r.end||e.length;if(o-n<=0)throw new Error("Can only bucket non-empty collections.");return nTe(e,t,!!(r&&r.sort),n,o)}var pO=class{createGroup(t,r){let n=this.id++,o=[t];return this.groups[n]=o,{id:n,keys:o,value:r}}add(t,r){let n=this.getHash(r);if(this.byHash.has(n)){let o=this.byHash.get(n);for(let s=0,a=o.length;s<a;s++){let l=o[s];if(this.areEqual(r,l.value))return l.keys[l.keys.length]=t,l.value}let i=this.createGroup(t,r);return o[o.length]=i,i.value}else{let o=this.createGroup(t,r);return this.byHash.set(n,[o]),o.value}}constructor(t,r){this.getHash=t,this.areEqual=r,this.id=0,this.byHash=new Map,this.groups=[]}};function Tq(e,t){return new pO(e,t)}function RE(e){let t=e^e>>4;return t=(t^3735928559)+(t<<5),t=t^t>>11,t}function wu(e,t){let r=23;return r=31*r+e|0,r=31*r+t|0,r=r^r>>4,r=(r^3735928559)+(r<<5),r=r^r>>11,r}function Eq(e,t,r){let n=23;return n=31*n+e|0,n=31*n+t|0,n=31*n+r|0,n=n^n>>4,n=(n^3735928559)+(n<<5),n=n^n>>11,n}function Pq(e,t,r,n){let o=23;return o=31*o+e|0,o=31*o+t|0,o=31*o+r|0,o=31*o+n|0,o=o^o>>4,o=(o^3735928559)+(o<<5),o=o^o>>11,o}function NA(e){let t=0;for(let r=0,n=e.length;r<n;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return t}function Ys(e,t){return(e+t)*(e+t+1)/2+t}function h0(e,t){return e<t?Ys(e,t):Ys(t,e)}function BE(e,t){let r=Math.floor((Math.sqrt(8*t+1)-1)/2),n=(r*r+r)/2,o=t-n;return e[0]=r-o,e[1]=o,e}function di(e){let t=2166136261;for(let r=0,n=e.length;r<n;++r)t^=e[r],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function Ax(e,t){for(let r=0,n=e.length;r<n;r++)if(t(e[r]))return e[r]}function wx(e){if(Array.from)return Array.from(e);let t=[];for(;;){let{done:r,value:n}=e.next();if(r)break;t[t.length]=n}return t}function FA(e,t,r){let n=t-e+1,o=r?new r(n):new Int32Array(n);for(let i=0;i<n;i++)o[i]=i+e;return o}function Dq(e,t){let r=new(oTe(e))(t.length);for(let n=0,o=t.length;n<o;n++)r[n]=e[t[n]];return r}function oTe(e){let t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}function sTe(e,t,r){let n=1,o;for(o=0;o<t;o++){let i=n*e;if(Math.abs(Math.round(i)-i)<=r)return o;n*=10}return-1}function kq(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function Mq(e,t,r){let n=1,o=0;for(let i=0,s=e.length;i<s;i++){if(n>=0){let l=sTe(e[i],t,r);l<0?n=-1:l>n&&(n=l)}let a=Math.abs(e[i]);if(a>r){let l=Math.floor(Math.log10(Math.abs(a)))+1;l>o&&(o=l)}}return{mantissaDigits:n,integerDigits:o}}function Rq(e){e=e.trim();let t=parseInt(e,10);return isNaN(t)?!1:t.toString()===e}function OA(e){if(!isFinite(e))return 0;let t=1,r=0;for(;Math.round(e*t)/t!==e;)t*=10,++r;return r}function VA(e,t){return parseFloat(e.toPrecision(t))}function UA(e){return GA.classify(e)}function Bq(e){return fO.classify(e)}var GA;(function(e){function t(p,h){return p>=0?Math.ceil((p+1)/h):Math.ceil((p+1)/(-h-1))}function r(p){let h=!1;for(let f=0,C=p.length;f<C;f++)if(p[f]<0){h=!0;break}return h?{signed:h,limit8:127,limit16:32767}:{signed:h,limit8:255,limit16:65535}}function n(){return{pack8:0,pack16:0,count:0}}function o({limit8:p,limit16:h},f,C){f.pack8+=t(C,p),f.pack16+=t(C,h),f.count+=1}function i(p,h){p.pack8+=t(h,127),p.pack16+=t(h,32767),p.count+=1}function s(p){return p.count*4<p.pack16*2?{length:p.count*4,elem:4}:p.pack16*2<p.pack8?{length:p.pack16*2,elem:2}:{length:p.pack8,elem:1}}function a(p,h){let f=n();for(let C=0,g=p.length;C<g;C++)o(h,f,p[C]);return{...s(f),kind:"pack"}}function l(p,h){let f=n(),C=p[0];for(let g=1,b=p.length;g<b;g++)i(f,p[g]-C),C=p[g];return{...s(f),kind:"delta"}}function c(p,h){let f=n(),C=1;for(let g=1,b=p.length;g<b;g++)p[g-1]!==p[g]?(o(h,f,p[g-1]),o(h,f,C),C=1):C++;return o(h,f,p[p.length-1]),o(h,f,C),{...s(f),kind:"rle"}}function u(p,h){let f=n(),C=1,g=0,b=0;for(let y=1,x=p.length;y<x;y++){let A=p[y]-g;b!==A?(i(f,b),i(f,C),C=1):C++,b=A,g=p[y]}return i(f,b),i(f,C),{...s(f),kind:"delta-rle"}}function d(p){let h=r(p),f=[a(p,h),c(p,h),l(p,h),u(p,h)];return f.sort((C,g)=>C.length-g.length),f}e.getSize=d;function m(p){if(p.length<2)return Yr.by(Yr.byteArray);let f=d(p)[0];switch(f.kind){case"pack":return Yr.by(Yr.integerPacking);case"rle":return Yr.by(Yr.runLength).and(Yr.integerPacking);case"delta":return Yr.by(Yr.delta).and(Yr.integerPacking);case"delta-rle":return Yr.by(Yr.delta).and(Yr.runLength).and(Yr.integerPacking);default:Sr(f)}}e.classify=m})(GA||(GA={}));var fO;(function(e){function r(o){let{mantissaDigits:s,integerDigits:a}=Mq(o,4,1e-6);if(s<0||s+a>10)return Yr.by(Yr.byteArray);if(s===0)return GA.classify(o);let l=n(s),c=new Int32Array(o.length);for(let p=0,h=o.length;p<h;p++)c[p]=Math.round(l*o[p]);let d=GA.getSize(c)[0],m=Yr.by(Yr.fixedPoint(l));switch(d.kind){case"pack":return m.and(Yr.integerPacking);case"rle":return m.and(Yr.runLength).and(Yr.integerPacking);case"delta":return m.and(Yr.delta).and(Yr.integerPacking);case"delta-rle":return m.and(Yr.delta).and(Yr.runLength).and(Yr.integerPacking);default:Sr(d)}}e.classify=r;function n(o){let i=1;for(let s=0;s<o;s++)i*=10;return i}})(fO||(fO={}));var LE=class e{and(t){return new e(this.providers.concat([t]))}encode(t){let r=[];for(let n of this.providers){let o=n(t);if(!o.encodings.length)throw new Error("Encodings must be non-empty.");t=o.data;for(let i of o.encodings)r.push(i)}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:r,data:t}}constructor(t){this.providers=t}},Cp;(function(e){function t(o){return new LE([o])}e.by=t;function r(o){let i=t(n(o[0]));for(let s=1;s<o.length&&o[s-1].kind!=="IntegerPacking";s++)i=i.and(n(o[s]));return i}e.fromEncoding=r;function n(o){switch(o.kind){case"ByteArray":return Yr.byteArray;case"FixedPoint":return Yr.fixedPoint(o.factor);case"IntervalQuantization":return Yr.intervalQuantizaiton(o.min,o.max,o.numSteps);case"RunLength":return Yr.runLength;case"Delta":return Yr.delta;case"IntegerPacking":return Yr.integerPacking;case"StringArray":return Yr.stringArray}}})(Cp||(Cp={}));var Yr;(function(e){function t(x){return new LE([x])}e.by=t;function r(x){return{encodings:[{kind:"ByteArray",type:En.IntDataType.Uint8}],data:x}}function n(x){return{encodings:[{kind:"ByteArray",type:En.IntDataType.Int8}],data:new Uint8Array(x.buffer,x.byteOffset)}}let o={[En.IntDataType.Int16]:function(x,A,v){x.setInt16(2*A,v,!0)},[En.IntDataType.Uint16]:function(x,A,v){x.setUint16(2*A,v,!0)},[En.IntDataType.Int32]:function(x,A,v){x.setInt32(4*A,v,!0)},[En.IntDataType.Uint32]:function(x,A,v){x.setUint32(4*A,v,!0)},[En.FloatDataType.Float32]:function(x,A,v){x.setFloat32(4*A,v,!0)},[En.FloatDataType.Float64]:function(x,A,v){x.setFloat64(8*A,v,!0)}},i={[En.IntDataType.Int16]:2,[En.IntDataType.Uint16]:2,[En.IntDataType.Int32]:4,[En.IntDataType.Uint32]:4,[En.FloatDataType.Float32]:4,[En.FloatDataType.Float64]:8};function s(x){let A=En.getDataType(x);if(A===En.IntDataType.Int8)return n(x);if(A===En.IntDataType.Uint8)return r(x);let v=new Uint8Array(x.length*i[A]),_=o[A],I=new DataView(v.buffer);for(let T=0,E=x.length;T<E;T++)_(I,T,x[T]);return{encodings:[{kind:"ByteArray",type:A}],data:v}}e.byteArray=s;function a(x,A){let v=En.getDataType(x),_=new Int32Array(x.length);for(let I=0,T=x.length;I<T;I++)_[I]=Math.round(x[I]*A);return{encodings:[{kind:"FixedPoint",factor:A,srcType:v}],data:_}}function l(x){return A=>a(A,x)}e.fixedPoint=l;function c(x,A,v,_,I){let T=En.getDataType(x);if(!x.length)return{encodings:[{kind:"IntervalQuantization",min:A,max:v,numSteps:_,srcType:T}],data:new Int32Array(0)};if(v<A){let S=A;A=v,v=S}let E=(v-A)/(_-1),w=new I(x.length);for(let S=0,P=x.length;S<P;S++){let k=x[S];k<=A?w[S]=0:k>=v?w[S]=_-1:w[S]=Math.round((k-A)/E)|0}return{encodings:[{kind:"IntervalQuantization",min:A,max:v,numSteps:_,srcType:T}],data:w}}function u(x,A,v,_=Int32Array){return I=>c(I,x,A,v,_)}e.intervalQuantizaiton=u;function d(x){let A=En.getDataType(x);if(A===void 0&&(x=new Int32Array(x),A=En.IntDataType.Int32),!x.length)return{encodings:[{kind:"RunLength",srcType:A,srcSize:0}],data:new Int32Array(0)};let v=2;for(let E=1,w=x.length;E<w;E++)x[E-1]!==x[E]&&(v+=2);let _=new Int32Array(v),I=0,T=1;for(let E=1,w=x.length;E<w;E++)x[E-1]!==x[E]?(_[I]=x[E-1],_[I+1]=T,T=1,I+=2):++T;return _[I]=x[x.length-1],_[I+1]=T,{encodings:[{kind:"RunLength",srcType:A,srcSize:x.length}],data:_}}e.runLength=d;function m(x){if(!En.isSignedIntegerDataType(x))throw new Error("Only signed integer types can be encoded using delta encoding.");let A=En.getDataType(x);if(A===void 0&&(x=new Int32Array(x),A=En.IntDataType.Int32),!x.length)return{encodings:[{kind:"Delta",origin:0,srcType:A}],data:new x.constructor(0)};let v=new x.constructor(x.length),_=x[0];v[0]=x[0];for(let I=1,T=x.length;I<T;I++)v[I]=x[I]-x[I-1];return v[0]=0,{encodings:[{kind:"Delta",origin:_,srcType:A}],data:v}}e.delta=m;function p(x){for(let A=0,v=x.length;A<v;A++)if(x[A]<0)return!0;return!1}function h(x,A){let v=0;for(let _=0,I=x.length;_<I;_++)v+=x[_]/A|0;return v+=x.length,v}function f(x,A){let v=-A-1,_=0;for(let I=0,T=x.length;I<T;I++){let E=x[I];E>=0?_+=E/A|0:_+=E/v|0}return _+=x.length,_}function C(x){let A=p(x),v=A?f(x,127):h(x,255),_=A?f(x,32767):h(x,65535);return x.length*4<_*2?{isSigned:A,size:x.length,bytesPerElement:4}:_*2<v?{isSigned:A,size:_,bytesPerElement:2}:{isSigned:A,size:v,bytesPerElement:1}}function g(x,A){let v=A.isSigned?A.bytesPerElement===1?127:32767:A.bytesPerElement===1?255:65535,_=-v-1,I=x.length,T=A.isSigned?A.bytesPerElement===1?new Int8Array(A.size):new Int16Array(A.size):A.bytesPerElement===1?new Uint8Array(A.size):new Uint16Array(A.size),E=0;for(let S=0;S<I;S++){let P=x[S];if(P>=0)for(;P>=v;)T[E]=v,++E,P-=v;else for(;P<=_;)T[E]=_,++E,P-=_;T[E]=P,++E}let w=s(T);return{encodings:[{kind:"IntegerPacking",byteCount:A.bytesPerElement,isUnsigned:!A.isSigned,srcSize:I},w.encodings[0]],data:w.data}}function b(x){let A=C(x);return A.bytesPerElement===4?s(x):g(x,A)}e.integerPacking=b;function y(x){let A=Object.create(null),v=[],_=new Int32Array(x.length),I=it.create(Int32Array,1,Math.min(1024,x.length<32?x.length+1:Math.round(x.length/8)+1));it.add(I,0);let T=0,E=0;for(let R of x){if(R==null){_[E++]=-1;continue}let N=A[R];N===void 0&&(T+=R.length,N=v.length,v[N]=R,A[R]=N,it.add(I,T)),_[E++]=N}let w=it.compact(I),P=UA(w).encode(w),L=UA(_).encode(_);return{encodings:[{kind:"StringArray",dataEncoding:L.encoding,stringData:v.join(""),offsetEncoding:P.encoding,offsets:P.data}],data:L.data}}e.stringArray=y})(Yr||(Yr={}));function Lq(e){let t=e.mask?Sx(e.mask):void 0,r=Sx(e.data),n=bi.isTypedArray(r),o=n?t?c=>t[c]===0?""+r[c]:"":c=>""+r[c]:t?c=>t[c]===0?r[c]:"":c=>r[c],i=n?c=>r[c]:c=>{let u=r[c];return Yd(u,0,u.length)},s=n?c=>r[c]:c=>{let u=r[c];return Yc(u,0,u.length)},a=t?c=>t[c]:c=>0,l=r.length;return{__array:r,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:l,str:o,int:i,float:s,valueKind:a,areValuesEqual:(c,u)=>r[c]===r[u],toStringArray:c=>bi.createAndFillArray(l,o,c),toIntArray:n?c=>bi.typedArrayWindow(r,c):c=>bi.createAndFillArray(l,i,c),toFloatArray:n?c=>bi.typedArrayWindow(r,c):c=>bi.createAndFillArray(l,s,c)}}function g0(e,t,r){for(let n=0,o=r.length;n<o;n++){let i=r.charCodeAt(n);if(i<128){e[t++]=i>>>0&127|0;continue}if(i<2048){e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128;continue}if(i<65536){e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}if(i<1114112){e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128;continue}throw new Error("bad codepoint "+i)}}var aTe=function(){let e=[];for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function Fq(e){throw new Error(e)}function lTe(e,t,r){let n=aTe,o,i=0,s=[],a=512;for(let l=t,c=t+r;l<c;l++){let u=e[l];u&128?(u&224)===192?s[i++]=n[(u&15)<<6|e[++l]&63]:(u&240)===224?s[i++]=String.fromCharCode((u&15)<<12|(e[++l]&63)<<6|(e[++l]&63)<<0):(u&248)===240?s[i++]=String.fromCharCode((u&7)<<18|(e[++l]&63)<<12|(e[++l]&63)<<6|(e[++l]&63)<<0):Fq("Invalid byte "+u.toString(16)):s[i++]=n[u],i===a&&(o=o||[],o[o.length]=s.join(""),i=0)}return o?(i>0&&(o[o.length]=s.slice(0,i).join("")),o.join("")):s.slice(0,i).join("")}var Nq=typeof TextDecoder<"u"?new TextDecoder:void 0;function _x(e,t,r){if(Nq){let n=t||r!==e.length?e.subarray(t,t+r):e;return Nq.decode(n)}else return lTe(e,t,r)}function Tx(e){let t=0;for(let r=0,n=e.length;r<n;r++){let o=e.charCodeAt(r);if(o<128){t+=1;continue}if(o<2048){t+=2;continue}if(o<65536){t+=3;continue}if(o<1114112){t+=4;continue}Fq("bad codepoint "+o)}return t}function rb(e){return FE({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function hO(e,t){let r={};for(let n=0;n<t;n++){let o=FE(e);r[o]=FE(e)}return r}function gO(e,t){let r=new Uint8Array(t),n=e.offset;for(let o=0;o<t;o++)r[o]=e.buffer[o+n];return e.offset+=t,r}function NE(e,t){let r=_x(e.buffer,e.offset,t);return e.offset+=t,r}function yO(e,t){let r=new Array(t);for(let n=0;n<t;n++)r[n]=FE(e);return r}function FE(e){let t=e.buffer[e.offset],r,n;if(!(t&128))return e.offset++,t;if((t&240)===128)return n=t&15,e.offset++,hO(e,n);if((t&240)===144)return n=t&15,e.offset++,yO(e,n);if((t&224)===160)return n=t&31,e.offset++,NE(e,n);if((t&224)===224)return r=e.dataView.getInt8(e.offset),e.offset++,r;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,gO(e,n);case 197:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,gO(e,n);case 198:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,gO(e,n);case 202:return r=e.dataView.getFloat32(e.offset+1),e.offset+=5,r;case 203:return r=e.dataView.getFloat64(e.offset+1),e.offset+=9,r;case 204:return r=e.buffer[e.offset+1],e.offset+=2,r;case 205:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,r;case 206:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,r;case 208:return r=e.dataView.getInt8(e.offset+1),e.offset+=2,r;case 209:return r=e.dataView.getInt16(e.offset+1),e.offset+=3,r;case 210:return r=e.dataView.getInt32(e.offset+1),e.offset+=5,r;case 217:return n=e.dataView.getUint8(e.offset+1),e.offset+=2,NE(e,n);case 218:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,NE(e,n);case 219:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,NE(e,n);case 220:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,yO(e,n);case 221:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,yO(e,n);case 222:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,hO(e,n);case 223:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,hO(e,n)}throw new Error("Unknown type 0x"+t.toString(16))}function cTe(e,t){for(let r=0;r<2;r++)if(e[r]>t[r])return!1;return!0}function uTe(e){let t=Object.create(null),r=Object.create(null);for(let n of e.columns)t[n.name]=n;return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(n=>n.name),getField(n){let o=t[n];if(o)return r[n]||(r[n]=Lq(o)),r[n]}}}function vO(e){return ke.create("Parse BinaryCIF",async t=>{let r=[0,3];try{let n=rb(e);if(!cTe(r,n.version.match(/(\d)\.(\d)\.\d/).slice(1).map(i=>+i)))return Hr.error(`Unsupported format version. Current ${n.version}, required ${r.join(".")}.`);let o=DE(n.dataBlocks.map(i=>{let s=Object.create(null);for(let a of i.categories)s[a.name.substr(1)]=uTe(a);return LA(i.categories.map(a=>a.name.substr(1)),s,i.header)}));return Hr.success(o)}catch(n){return Hr.error(""+n)}})}var Ex;(function(e){function t(o){return o.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t;function r(o,i){return t(o)===t(i)}e.equal=r;function n(o,i,s=!1){let a=`${o}${i?`.${i}`:""}`;return s?t(a):a}e.create=n})(Ex||(Ex={}));function Vq(e,t,r){let n={};for(let o of t.blocks)n[o.header]=bc(e,o,r);return n}function bc(e,t,r){return hTe(e,t,r)}function Gq(e,t){return new OE(t,e,!0)}function dTe(e){switch(e.valueType){case"str":return(t,r,n)=>mTe(e,t,t.str,t.toStringArray);case"int":return(t,r,n)=>Oq(e,t,t.int,t.toIntArray);case"float":return(t,r,n)=>Oq(e,t,t.float,t.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function mTe(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:e.transform==="lowercase"?o=>r(o).toLowerCase():e.transform==="uppercase"?o=>r(o).toUpperCase():r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:e.transform==="lowercase"?o=>Array.from(n(o)).map(i=>i.toLowerCase()):e.transform==="uppercase"?o=>Array.from(n(o)).map(i=>i.toUpperCase()):n}}function Oq(e,t,r,n){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:r,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:n}}function pTe(e,t,r){let n=e.separator,o=e.itemParse,i=t.getField(r),s=i?l=>i.str(l).split(n).map(c=>o(c.trim())).filter(c=>!!c):l=>[],a=l=>bi.createAndFillArray(t.rowCount,s,l);return{schema:e,__array:void 0,isDefined:!!i,rowCount:t.rowCount,value:s,valueKind:i?i.valueKind:()=>1,areValuesEqual:(l,c)=>da(s(l),s(c)),toArray:a}}function fTe(e,t,r){let n=e.space,o=t.fieldNames.includes(`${r}[0]`)||t.fieldNames.includes(`${r}[0][0]`)||t.fieldNames.includes(`${r}[0][0][0]`),i=o?0:1,s=t.fieldNames.includes(`${r}_1`)||t.fieldNames.includes(`${r}_11`)||t.fieldNames.includes(`${r}_111`)?"underscore":"brackets",a=mq(r,n.rank,o,s),l=t.getField(a(i,i,i))||ue.Undefined(t.rowCount,e),c=d=>pq(t,n,d,a),u=d=>bi.createAndFillArray(t.rowCount,c,d);return{schema:e,__array:void 0,isDefined:l.isDefined,rowCount:t.rowCount,value:c,valueKind:l.valueKind,areValuesEqual:(d,m)=>cr.areEqualExact(c(d),c(m)),toArray:u}}var OE=class{constructor(t,r,n){this._isDefined=n;let o=Object.keys(r);this._rowCount=t.rowCount,this._columns=o,this._schema=r;let i=Object.create(null);for(let s of o)Object.defineProperty(this,s,{get:function(){if(i[s])return i[s];let a=r[s];if(a.valueType==="list")i[s]=pTe(a,t,s);else if(a.valueType==="tensor")i[s]=fTe(a,t,s);else{let l=dTe(a),c=t.getField(s);i[s]=c?l(c,t,s):ue.Undefined(t.rowCount,a)}return i[s]},enumerable:!0,configurable:!1})}};function hTe(e,t,r){let n=Object.create(null);for(let o of Object.keys(e))n[o]=vTe(o,e[o],t,r);return BA.ofTables(t.header,e,n)}function gTe(e){let t=Object.create(null);for(let r of Object.keys(e.categories))for(let n of e.categories[r].fieldNames){let o=Ex.create(r,n,!0);t[o]=e.categories[r].getField(n)}return t}function yTe(e,t,r,n){let o=Ex.create(t,e),i=Ex.canonical(o);if(i in r)return r[i];if(n&&o in n)for(let s of n[o]){let a=Ex.canonical(s);if(a in r)return r[a]}}function vTe(e,t,r,n){let o=r.categories[e];if(n){let i=gTe(r),s=Object.create(null),a=[],l=0;for(let c of Object.keys(t)){let u=yTe(c,e,i,n);u&&(s[c]=u,a.push(c),l=u.rowCount)}o={rowCount:l,name:e,fieldNames:[...a],getField(c){return s[c]}}}return new OE(o||Hi.empty(e),t,!!o)}var qh=ue.Schema,xe=qh.str,Xe=qh.int,$r=qh.float,bO=qh.coord,jt=qh.Aliased,y0=qh.Matrix,VE=qh.Vector,uo=qh.lstr,nb=qh.List,Wr={atom_site:{auth_asym_id:xe,auth_atom_id:xe,auth_comp_id:xe,auth_seq_id:Xe,B_iso_or_equiv:$r,Cartn_x:bO,Cartn_y:bO,Cartn_z:bO,group_PDB:jt(xe),id:Xe,label_alt_id:xe,label_asym_id:xe,label_atom_id:xe,label_comp_id:xe,label_entity_id:xe,label_seq_id:Xe,occupancy:$r,type_symbol:xe,pdbx_PDB_ins_code:xe,pdbx_PDB_model_num:Xe,pdbx_formal_charge:Xe,pdbx_label_index:Xe,pdbx_sifts_xref_db_name:xe,pdbx_sifts_xref_db_acc:xe,pdbx_sifts_xref_db_num:xe,pdbx_sifts_xref_db_res:xe,ihm_model_id:Xe},atom_site_anisotrop:{id:Xe,type_symbol:xe,U:y0(3,3),U_esd:y0(3,3),pdbx_auth_seq_id:xe,pdbx_auth_asym_id:xe,pdbx_auth_atom_id:xe,pdbx_auth_comp_id:xe,pdbx_label_seq_id:Xe,pdbx_label_alt_id:xe,pdbx_label_asym_id:xe,pdbx_label_atom_id:xe,pdbx_label_comp_id:xe,pdbx_PDB_ins_code:xe},atom_sites:{entry_id:xe,fract_transf_matrix:y0(3,3),fract_transf_vector:VE(3)},audit_author:{name:xe,pdbx_ordinal:Xe,identifier_ORCID:xe},audit_conform:{dict_location:xe,dict_name:xe,dict_version:xe},cell:{angle_alpha:$r,angle_beta:$r,angle_gamma:$r,entry_id:xe,length_a:$r,length_b:$r,length_c:$r,Z_PDB:Xe,pdbx_unique_axis:xe},chem_comp:{formula:xe,formula_weight:$r,id:xe,mon_nstd_flag:jt(uo),name:xe,type:jt(uo),pdbx_synonyms:nb(";",e=>e)},chem_comp_bond:{atom_id_1:xe,atom_id_2:xe,comp_id:xe,value_order:jt(uo),pdbx_ordinal:Xe,pdbx_stereo_config:jt(uo),pdbx_aromatic_flag:jt(uo)},citation:{book_publisher:xe,country:xe,id:xe,journal_abbrev:xe,journal_id_ASTM:xe,journal_id_CSD:xe,journal_id_ISSN:xe,journal_volume:xe,page_first:xe,page_last:xe,title:xe,year:Xe,pdbx_database_id_DOI:xe,pdbx_database_id_PubMed:Xe},citation_author:{citation_id:xe,name:xe,ordinal:Xe},database_2:{database_id:jt(uo),database_code:xe},entity:{details:xe,formula_weight:$r,id:xe,src_method:jt(uo),type:jt(uo),pdbx_description:nb(",",e=>e),pdbx_number_of_molecules:Xe,pdbx_mutation:xe,pdbx_fragment:xe,pdbx_ec:nb(",",e=>e)},entity_poly:{entity_id:xe,nstd_linkage:jt(uo),nstd_monomer:jt(uo),type:jt(xe),pdbx_strand_id:nb(",",e=>e),pdbx_seq_one_letter_code:xe,pdbx_seq_one_letter_code_can:xe,pdbx_target_identifier:xe},entity_poly_seq:{entity_id:xe,hetero:jt(uo),mon_id:xe,num:Xe},entry:{id:xe},exptl:{entry_id:xe,method:jt(xe)},software:{classification:xe,date:xe,description:xe,name:xe,type:jt(uo),version:xe,pdbx_ordinal:Xe},struct:{entry_id:xe,title:xe,pdbx_descriptor:xe},struct_asym:{details:xe,entity_id:xe,id:xe,pdbx_modified:xe,pdbx_blank_PDB_chainid_flag:jt(xe)},struct_conf:{beg_label_asym_id:xe,beg_label_comp_id:xe,beg_label_seq_id:Xe,beg_auth_asym_id:xe,beg_auth_comp_id:xe,beg_auth_seq_id:Xe,conf_type_id:jt(uo),details:xe,end_label_asym_id:xe,end_label_comp_id:xe,end_label_seq_id:Xe,end_auth_asym_id:xe,end_auth_comp_id:xe,end_auth_seq_id:Xe,id:xe,pdbx_beg_PDB_ins_code:xe,pdbx_end_PDB_ins_code:xe,pdbx_PDB_helix_class:xe,pdbx_PDB_helix_length:Xe,pdbx_PDB_helix_id:xe},struct_conn:{conn_type_id:jt(uo),details:xe,id:xe,ptnr1_label_asym_id:xe,ptnr1_label_atom_id:xe,ptnr1_label_comp_id:xe,ptnr1_label_seq_id:Xe,ptnr1_auth_asym_id:xe,ptnr1_auth_comp_id:xe,ptnr1_auth_seq_id:Xe,ptnr1_symmetry:xe,ptnr2_label_asym_id:xe,ptnr2_label_atom_id:xe,ptnr2_label_comp_id:xe,ptnr2_label_seq_id:Xe,ptnr2_auth_asym_id:xe,ptnr2_auth_comp_id:xe,ptnr2_auth_seq_id:Xe,ptnr2_symmetry:xe,pdbx_ptnr1_PDB_ins_code:xe,pdbx_ptnr1_label_alt_id:xe,pdbx_ptnr1_standard_comp_id:xe,pdbx_ptnr2_PDB_ins_code:xe,pdbx_ptnr2_label_alt_id:xe,pdbx_ptnr3_PDB_ins_code:xe,pdbx_ptnr3_label_alt_id:xe,pdbx_ptnr3_label_asym_id:xe,pdbx_ptnr3_label_atom_id:xe,pdbx_ptnr3_label_comp_id:xe,pdbx_ptnr3_label_seq_id:Xe,pdbx_PDB_id:xe,pdbx_dist_value:$r,pdbx_value_order:jt(uo)},struct_conn_type:{criteria:xe,id:jt(uo),reference:xe},struct_keywords:{entry_id:xe,text:nb(",",e=>e),pdbx_keywords:xe},struct_ncs_oper:{code:jt(xe),details:xe,id:Xe,matrix:y0(3,3),vector:VE(3)},struct_sheet_range:{beg_label_asym_id:xe,beg_label_comp_id:xe,beg_label_seq_id:Xe,end_label_asym_id:xe,end_label_comp_id:xe,end_label_seq_id:Xe,beg_auth_asym_id:xe,beg_auth_comp_id:xe,beg_auth_seq_id:Xe,end_auth_asym_id:xe,end_auth_comp_id:xe,end_auth_seq_id:Xe,id:xe,sheet_id:xe,pdbx_beg_PDB_ins_code:xe,pdbx_end_PDB_ins_code:xe},struct_site:{details:xe,id:xe,pdbx_num_residues:Xe,pdbx_evidence_code:xe,pdbx_auth_asym_id:xe,pdbx_auth_comp_id:xe,pdbx_auth_seq_id:xe,pdbx_auth_ins_code:xe},struct_site_gen:{details:xe,id:xe,label_alt_id:xe,label_asym_id:xe,label_atom_id:xe,label_comp_id:xe,label_seq_id:Xe,auth_asym_id:xe,auth_comp_id:xe,auth_seq_id:xe,site_id:xe,symmetry:xe,pdbx_auth_ins_code:xe,pdbx_num_res:Xe},symmetry:{entry_id:xe,cell_setting:jt(uo),Int_Tables_number:Xe,space_group_name_Hall:xe,"space_group_name_H-M":xe},pdbx_database_status:{status_code:jt(xe),status_code_sf:jt(xe),status_code_mr:jt(xe),entry_id:xe,recvd_initial_deposition_date:xe,SG_entry:jt(uo),deposit_site:jt(xe),process_site:jt(xe),status_code_cs:jt(xe),methods_development_category:jt(xe),pdb_format_compatible:jt(uo)},pdbx_nonpoly_scheme:{asym_id:xe,entity_id:xe,mon_id:xe,pdb_strand_id:xe,ndb_seq_num:xe,pdb_seq_num:xe,auth_seq_num:xe,pdb_mon_id:xe,auth_mon_id:xe,pdb_ins_code:xe},pdbx_database_related:{db_name:xe,details:xe,db_id:xe,content_type:jt(xe)},pdbx_entity_nonpoly:{entity_id:xe,comp_id:xe,name:xe},pdbx_chem_comp_synonyms:{name:xe,comp_id:xe,provenance:jt(xe)},pdbx_chem_comp_identifier:{comp_id:xe,identifier:xe,type:jt(xe),program:xe,program_version:xe},pdbx_unobs_or_zero_occ_residues:{id:Xe,polymer_flag:jt(uo),occupancy_flag:jt(Xe),PDB_model_num:Xe,auth_asym_id:xe,auth_comp_id:xe,auth_seq_id:xe,PDB_ins_code:xe,label_asym_id:xe,label_comp_id:xe,label_seq_id:Xe},pdbx_struct_mod_residue:{id:Xe,auth_asym_id:xe,auth_comp_id:xe,auth_seq_id:Xe,PDB_ins_code:xe,label_asym_id:xe,label_comp_id:xe,label_seq_id:Xe,parent_comp_id:xe,details:xe},pdbx_struct_oper_list:{id:xe,type:jt(xe),name:xe,symmetry_operation:xe,matrix:y0(3,3),vector:VE(3)},pdbx_struct_assembly:{method_details:xe,oligomeric_details:xe,oligomeric_count:Xe,details:xe,id:xe},pdbx_struct_assembly_gen:{asym_id_list:nb(",",e=>e),assembly_id:xe,oper_expression:xe},pdbx_reference_entity_list:{prd_id:xe,ref_entity_id:xe,type:jt(uo),details:xe,component_id:Xe},pdbx_reference_entity_link:{link_id:Xe,prd_id:xe,details:xe,ref_entity_id_1:xe,ref_entity_id_2:xe,entity_seq_num_1:Xe,entity_seq_num_2:Xe,comp_id_1:xe,comp_id_2:xe,atom_id_1:xe,atom_id_2:xe,value_order:jt(uo),component_1:Xe,component_2:Xe,link_class:jt(xe)},pdbx_reference_entity_poly_link:{link_id:Xe,prd_id:xe,ref_entity_id:xe,component_id:Xe,entity_seq_num_1:Xe,entity_seq_num_2:Xe,comp_id_1:xe,comp_id_2:xe,atom_id_1:xe,atom_id_2:xe,value_order:jt(uo)},pdbx_molecule:{prd_id:xe,instance_id:Xe,asym_id:xe},pdbx_molecule_features:{prd_id:xe,class:jt(uo),type:jt(uo),name:xe,details:xe},entity_src_nat:{entity_id:xe,pdbx_organism_scientific:xe,pdbx_plasmid_name:xe,pdbx_src_id:Xe,pdbx_beg_seq_num:Xe,pdbx_end_seq_num:Xe},entity_src_gen:{entity_id:xe,pdbx_gene_src_gene:nb(",",e=>e),pdbx_gene_src_scientific_name:xe,plasmid_name:xe,pdbx_src_id:Xe,pdbx_beg_seq_num:Xe,pdbx_end_seq_num:Xe},pdbx_entity_src_syn:{organism_scientific:xe,entity_id:xe,pdbx_src_id:Xe,pdbx_beg_seq_num:Xe,pdbx_end_seq_num:Xe},pdbx_entity_branch_descriptor:{entity_id:xe,descriptor:xe,type:jt(uo),program:xe,program_version:xe,ordinal:Xe},pdbx_entity_instance_feature:{details:xe,feature_type:jt(xe),auth_asym_id:xe,asym_id:xe,auth_seq_num:xe,seq_num:Xe,comp_id:xe,auth_comp_id:xe,ordinal:Xe},pdbx_entity_branch_list:{entity_id:xe,hetero:jt(uo),comp_id:xe,num:Xe},pdbx_entity_branch_link:{link_id:Xe,details:xe,entity_id:xe,entity_branch_list_num_1:Xe,entity_branch_list_num_2:Xe,comp_id_1:xe,comp_id_2:xe,atom_id_1:xe,leaving_atom_id_1:xe,atom_stereo_config_1:jt(uo),atom_id_2:xe,leaving_atom_id_2:xe,atom_stereo_config_2:jt(uo),value_order:jt(uo)},pdbx_entity_branch:{entity_id:xe,type:jt(xe)},pdbx_branch_scheme:{entity_id:xe,hetero:jt(uo),asym_id:xe,mon_id:xe,num:Xe,pdb_asym_id:xe,pdb_seq_num:xe,pdb_mon_id:xe,auth_asym_id:xe,auth_seq_num:xe,auth_mon_id:xe},pdbx_chem_comp_related:{comp_id:xe,related_comp_id:xe,relationship_type:jt(xe),details:xe},ihm_starting_model_details:{starting_model_id:xe,entity_id:xe,entity_description:xe,asym_id:xe,entity_poly_segment_id:Xe,starting_model_source:jt(xe),starting_model_auth_asym_id:xe,starting_model_sequence_offset:Xe,dataset_list_id:Xe},ihm_starting_comparative_models:{id:Xe,starting_model_id:xe,starting_model_auth_asym_id:xe,starting_model_seq_id_begin:Xe,starting_model_seq_id_end:Xe,template_auth_asym_id:xe,template_seq_id_begin:Xe,template_seq_id_end:Xe,template_sequence_identity:$r,template_sequence_identity_denominator:jt(Xe),template_dataset_list_id:Xe,alignment_file_id:Xe},ihm_starting_model_seq_dif:{id:Xe,entity_id:xe,asym_id:xe,seq_id:Xe,comp_id:xe,starting_model_id:xe,db_asym_id:xe,db_seq_id:Xe,db_comp_id:xe,details:xe},ihm_model_representation:{id:Xe,name:xe,details:xe},ihm_model_representation_details:{id:Xe,representation_id:Xe,entity_poly_segment_id:Xe,entity_id:xe,entity_description:xe,entity_asym_id:xe,model_object_primitive:jt(xe),starting_model_id:xe,model_mode:jt(xe),model_granularity:jt(xe),model_object_count:Xe},ihm_struct_assembly_details:{id:Xe,assembly_id:Xe,parent_assembly_id:Xe,entity_description:xe,entity_id:xe,asym_id:xe,entity_poly_segment_id:Xe},ihm_struct_assembly:{id:Xe,name:xe,description:xe},ihm_modeling_protocol:{id:Xe,num_steps:Xe,protocol_name:xe},ihm_modeling_protocol_details:{id:Xe,protocol_id:Xe,step_id:Xe,struct_assembly_id:Xe,dataset_group_id:Xe,struct_assembly_description:xe,step_name:xe,step_method:xe,num_models_begin:Xe,num_models_end:Xe,multi_scale_flag:jt(uo),multi_state_flag:jt(uo),ordered_flag:jt(uo),script_file_id:Xe,software_id:Xe},ihm_multi_state_modeling:{state_id:Xe,state_group_id:Xe,population_fraction:$r,population_fraction_sd:$r,state_type:xe,state_name:xe,experiment_type:jt(xe),details:xe},ihm_modeling_post_process:{id:Xe,protocol_id:Xe,analysis_id:Xe,step_id:Xe,type:jt(xe),feature:jt(xe),num_models_begin:Xe,num_models_end:Xe},ihm_ensemble_info:{ensemble_id:Xe,ensemble_name:xe,post_process_id:Xe,model_group_id:Xe,ensemble_clustering_method:jt(xe),ensemble_clustering_feature:jt(xe),num_ensemble_models:Xe,num_ensemble_models_deposited:Xe,ensemble_precision_value:$r,ensemble_file_id:Xe},ihm_model_list:{model_id:Xe,model_name:xe,assembly_id:Xe,protocol_id:Xe,representation_id:Xe},ihm_model_group:{id:Xe,name:xe,details:xe},ihm_model_group_link:{model_id:Xe,group_id:Xe},ihm_model_representative:{id:Xe,model_group_id:Xe,model_id:Xe,selection_criteria:jt(xe)},ihm_dataset_list:{id:Xe,data_type:jt(xe),database_hosted:jt(uo)},ihm_dataset_group:{id:Xe,name:xe,application:jt(xe),details:xe},ihm_dataset_group_link:{dataset_list_id:Xe,group_id:Xe},ihm_related_datasets:{dataset_list_id_derived:Xe,dataset_list_id_primary:Xe},ihm_dataset_related_db_reference:{id:Xe,dataset_list_id:Xe,db_name:jt(xe),accession_code:xe,version:xe,details:xe},ihm_external_reference_info:{reference_id:Xe,reference_provider:xe,reference_type:jt(xe),reference:xe,refers_to:jt(xe),associated_url:xe},ihm_external_files:{id:Xe,reference_id:Xe,file_path:xe,content_type:jt(xe),file_size_bytes:$r,details:xe},ihm_dataset_external_reference:{id:Xe,dataset_list_id:Xe,file_id:Xe},ihm_localization_density_files:{id:Xe,file_id:Xe,ensemble_id:Xe,entity_id:xe,entity_poly_segment_id:Xe,asym_id:xe},ihm_predicted_contact_restraint:{id:Xe,group_id:Xe,entity_id_1:xe,entity_id_2:xe,asym_id_1:xe,asym_id_2:xe,comp_id_1:xe,comp_id_2:xe,seq_id_1:Xe,seq_id_2:Xe,rep_atom_1:jt(xe),rep_atom_2:jt(xe),distance_lower_limit:$r,distance_upper_limit:$r,probability:$r,restraint_type:jt(xe),model_granularity:jt(xe),dataset_list_id:Xe,software_id:Xe},ihm_cross_link_list:{id:Xe,group_id:Xe,entity_description_1:xe,entity_description_2:xe,entity_id_1:xe,entity_id_2:xe,comp_id_1:xe,comp_id_2:xe,seq_id_1:Xe,seq_id_2:Xe,linker_type:jt(xe),dataset_list_id:Xe},ihm_cross_link_restraint:{id:Xe,group_id:Xe,entity_id_1:xe,entity_id_2:xe,asym_id_1:xe,asym_id_2:xe,comp_id_1:xe,comp_id_2:xe,seq_id_1:Xe,seq_id_2:Xe,atom_id_1:xe,atom_id_2:xe,restraint_type:jt(xe),conditional_crosslink_flag:jt(xe),model_granularity:jt(xe),distance_threshold:$r,psi:$r,sigma_1:$r,sigma_2:$r},ihm_cross_link_result_parameters:{id:Xe,restraint_id:Xe,model_id:Xe,psi:$r,sigma_1:$r,sigma_2:$r},ihm_2dem_class_average_restraint:{id:Xe,dataset_list_id:Xe,number_raw_micrographs:Xe,pixel_size_width:$r,pixel_size_height:$r,image_resolution:$r,image_segment_flag:jt(uo),number_of_projections:Xe,struct_assembly_id:Xe,details:xe},ihm_2dem_class_average_fitting:{id:Xe,restraint_id:Xe,model_id:Xe,cross_correlation_coefficient:$r,rot_matrix:y0(3,3),tr_vector:VE(3)},ihm_3dem_restraint:{id:Xe,dataset_list_id:Xe,model_id:Xe,struct_assembly_id:Xe,fitting_method:xe,number_of_gaussians:Xe,cross_correlation_coefficient:$r},ihm_sas_restraint:{id:Xe,dataset_list_id:Xe,model_id:Xe,struct_assembly_id:Xe,profile_segment_flag:jt(uo),fitting_atom_type:xe,fitting_method:xe,fitting_state:jt(xe),radius_of_gyration:$r,chi_value:$r,details:xe},ihm_starting_model_coord:{ordinal_id:Xe,starting_model_id:xe,group_PDB:jt(xe),id:Xe,type_symbol:xe,entity_id:xe,atom_id:xe,comp_id:xe,seq_id:Xe,asym_id:xe,Cartn_x:$r,Cartn_y:$r,Cartn_z:$r,B_iso_or_equiv:$r},ihm_sphere_obj_site:{id:Xe,entity_id:xe,seq_id_begin:Xe,seq_id_end:Xe,asym_id:xe,Cartn_x:$r,Cartn_y:$r,Cartn_z:$r,object_radius:$r,rmsf:$r,model_id:Xe},ihm_gaussian_obj_site:{id:Xe,entity_id:xe,seq_id_begin:Xe,seq_id_end:Xe,asym_id:xe,mean_Cartn_x:$r,mean_Cartn_y:$r,mean_Cartn_z:$r,weight:$r,covariance_matrix:y0(3,3),model_id:Xe},ihm_gaussian_obj_ensemble:{id:Xe,entity_id:xe,seq_id_begin:Xe,seq_id_end:Xe,asym_id:xe,mean_Cartn_x:$r,mean_Cartn_y:$r,mean_Cartn_z:$r,weight:$r,covariance_matrix:y0(3,3),ensemble_id:Xe},ihm_feature_list:{feature_id:Xe,feature_type:jt(xe),entity_type:jt(xe)},ihm_poly_residue_feature:{ordinal_id:Xe,feature_id:Xe,entity_id:xe,asym_id:xe,comp_id_begin:xe,comp_id_end:xe,seq_id_begin:Xe,seq_id_end:Xe},ihm_derived_distance_restraint:{id:Xe,group_id:Xe,feature_id_1:Xe,feature_id_2:Xe,group_conditionality:jt(xe),random_exclusion_fraction:$r,distance_upper_limit:$r,restraint_type:jt(xe),dataset_list_id:Xe},ma_model_list:{ordinal_id:Xe,model_id:Xe,model_group_id:Xe,model_name:xe,model_group_name:xe,model_type:jt(xe),data_id:Xe},ma_target_entity:{entity_id:xe,data_id:Xe,origin:jt(xe)},ma_target_entity_instance:{asym_id:xe,entity_id:xe,details:xe},ma_target_ref_db_details:{target_entity_id:xe,db_name:jt(xe),db_code:xe,db_accession:xe,seq_db_isoform:xe,seq_db_align_begin:xe,seq_db_align_end:xe,ncbi_taxonomy_id:xe,organism_scientific:xe},ma_data:{id:Xe,content_type:jt(xe),content_type_other_details:xe,name:xe},ma_software_group:{ordinal_id:Xe,group_id:Xe,software_id:Xe},ma_qa_metric:{id:Xe,name:xe,type:jt(xe),mode:jt(xe),software_group_id:Xe},ma_qa_metric_global:{ordinal_id:Xe,model_id:Xe,metric_id:Xe,metric_value:$r},ma_qa_metric_local:{ordinal_id:Xe,model_id:Xe,label_asym_id:xe,label_seq_id:Xe,label_comp_id:xe,metric_id:Xe,metric_value:$r}};var ob=ue.Schema,zo=ob.str,bTe=ob.float,Uq=ob.List,wf=ob.lstr,gd=ob.Aliased,zA=ob.int,Px=ob.coord,zq={chem_comp:{formula:zo,formula_weight:bTe,id:zo,mon_nstd_parent_comp_id:Uq(",",e=>e),name:zo,one_letter_code:zo,three_letter_code:zo,type:gd(wf),pdbx_synonyms:Uq(";",e=>e),pdbx_type:zo,pdbx_ambiguous_flag:zo,pdbx_replaced_by:zo,pdbx_replaces:zo,pdbx_formal_charge:zA,pdbx_model_coordinates_details:zo,pdbx_model_coordinates_db_code:zo,pdbx_ideal_coordinates_details:zo,pdbx_ideal_coordinates_missing_flag:gd(wf),pdbx_model_coordinates_missing_flag:gd(wf),pdbx_initial_date:zo,pdbx_modified_date:zo,pdbx_release_status:gd(zo),pdbx_processing_site:gd(zo)},chem_comp_atom:{alt_atom_id:zo,atom_id:zo,charge:zA,model_Cartn_x:Px,model_Cartn_y:Px,model_Cartn_z:Px,comp_id:zo,type_symbol:zo,pdbx_align:zA,pdbx_ordinal:zA,pdbx_model_Cartn_x_ideal:Px,pdbx_model_Cartn_y_ideal:Px,pdbx_model_Cartn_z_ideal:Px,pdbx_stereo_config:gd(wf),pdbx_aromatic_flag:gd(wf),pdbx_leaving_atom_flag:gd(wf)},chem_comp_bond:{atom_id_1:zo,atom_id_2:zo,comp_id:zo,value_order:gd(wf),pdbx_ordinal:zA,pdbx_stereo_config:gd(wf),pdbx_aromatic_flag:gd(wf)},pdbx_chem_comp_descriptor:{comp_id:zo,descriptor:zo,type:gd(wf),program:zo,program_version:zo},pdbx_chem_comp_identifier:{comp_id:zo,identifier:zo,type:gd(zo),program:zo,program_version:zo}};var HA=ue.Schema,Vr=HA.str,xTe=HA.float,Zh=HA.lstr,Qc=HA.Aliased,Qd=HA.int,Hq={pdbx_reference_molecule:{prd_id:Vr,formula_weight:xTe,formula:Vr,type:Qc(Zh),type_evidence_code:Vr,class:Qc(Zh),class_evidence_code:Vr,name:Vr,represent_as:Qc(Zh),chem_comp_id:Vr,compound_details:Vr,description:Vr,representative_PDB_id_code:Vr,release_status:Qc(Zh),replaces:Vr,replaced_by:Vr},pdbx_reference_entity_list:{prd_id:Vr,ref_entity_id:Vr,type:Qc(Zh),details:Vr,component_id:Qd},pdbx_reference_entity_nonpoly:{prd_id:Vr,ref_entity_id:Vr,name:Vr,chem_comp_id:Vr},pdbx_reference_entity_link:{link_id:Qd,prd_id:Vr,details:Vr,ref_entity_id_1:Vr,ref_entity_id_2:Vr,entity_seq_num_1:Qd,entity_seq_num_2:Qd,comp_id_1:Vr,comp_id_2:Vr,atom_id_1:Vr,atom_id_2:Vr,value_order:Qc(Zh),component_1:Qd,component_2:Qd,link_class:Qc(Vr)},pdbx_reference_entity_poly_link:{link_id:Qd,prd_id:Vr,ref_entity_id:Vr,component_id:Qd,entity_seq_num_1:Qd,entity_seq_num_2:Qd,comp_id_1:Vr,comp_id_2:Vr,atom_id_1:Vr,atom_id_2:Vr,value_order:Qc(Zh)},pdbx_reference_entity_poly:{prd_id:Vr,ref_entity_id:Vr,type:Qc(Vr),db_code:Vr,db_name:Vr},pdbx_reference_entity_poly_seq:{prd_id:Vr,ref_entity_id:Vr,mon_id:Vr,parent_mon_id:Vr,num:Qd,observed:Qc(Zh),hetero:Qc(Zh)},pdbx_reference_entity_sequence:{prd_id:Vr,ref_entity_id:Vr,type:Qc(Vr),NRP_flag:Qc(Vr),one_letter_codes:Vr},pdbx_reference_entity_src_nat:{prd_id:Vr,ref_entity_id:Vr,ordinal:Qd,organism_scientific:Vr,taxid:Vr,db_code:Vr,db_name:Vr},pdbx_prd_audit:{prd_id:Vr,date:Vr,processing_site:Qc(Vr),action_type:Qc(Vr)}};var jq=ue.Schema,Qs=jq.str,CTe=jq.float,STe={id:Qs,description:Qs},ITe={title:Qs,datablock_id:Qs,version:Qs},ATe={version:Qs,update:Qs,revision:Qs},wTe={id:Qs,description:Qs},_Te={id:Qs,parent_id:Qs,description:Qs},TTe={code:Qs,primitive_code:Qs,construct:Qs,detail:Qs},ETe={code:Qs,detail:Qs},PTe={from_code:Qs,to_code:Qs,operator:Qs,factor:CTe},$q={datablock:STe,dictionary:ITe,dictionary_history:ATe,sub_category:wTe,category_group_list:_Te,item_type_list:TTe,item_units_list:ETe,item_units_conversion:PTe};var jA=ue.Schema,_f=jA.str,GE=jA.int,Kh=jA.float,UE=jA.Aliased,v0=jA.Vector,Hut={density_server_result:{server_version:_f,datetime_utc:_f,guid:_f,is_empty:UE(_f),has_error:UE(_f),error:_f,query_source_id:_f,query_type:UE(_f),query_box_type:UE(_f),query_box_a:v0(3),query_box_b:v0(3)}},zE={volume_data_3d_info:{name:_f,axis_order:v0(3,GE),origin:v0(3),dimensions:v0(3),sample_rate:GE,sample_count:v0(3,GE),spacegroup_number:GE,spacegroup_cell_size:v0(3),spacegroup_cell_angles:v0(3),mean_source:Kh,mean_sampled:Kh,sigma_source:Kh,sigma_sampled:Kh,min_source:Kh,min_sampled:Kh,max_source:Kh,max_sampled:Kh},volume_data_3d:{values:Kh}};var HE=ue.Schema,hs=HE.float,xO=HE.int,ti=HE.str,DTe=HE.Matrix,Wq={cell:{angle_alpha:hs,angle_beta:hs,angle_gamma:hs,formula_units_z:xO,length_a:hs,length_b:hs,length_c:hs,volume:hs},chemical:{melting_point:hs,name_common:ti,name_systematic:ti},chemical_formula:{moiety:ti,sum:ti,weight:hs},space_group:{crystal_system:ti,it_number:xO,"name_h-m_full":ti},space_group_symop:{operation_xyz:ti},geom_bond:{atom_site_label_1:ti,atom_site_label_2:ti,distance:hs,publ_flag:ti,site_symmetry_1:ti,site_symmetry_2:ti,valence:hs},audit:{block_doi:ti},database_code:{cod:ti,csd:ti,depnum_ccdc_archive:ti,depnum_ccdc_fiz:ti,icsd:ti,mdf:ti,nbs:ti},atom_site:{adp_type:ti,calc_flag:ti,disorder_assembly:ti,disorder_group:ti,fract_x:hs,fract_y:hs,fract_z:hs,label:ti,occupancy:hs,refinement_flags:ti,site_symmetry_multiplicity:xO,type_symbol:ti,u_iso_or_equiv:hs},atom_site_aniso:{label:ti,u_11:hs,u:DTe(3,3),u_12:hs,u_13:hs,u_22:hs,u_23:hs,u_33:hs},atom_type:{description:ti,symbol:ti},atom_type_scat:{dispersion_imag:hs,dispersion_real:hs,source:ti}},qq={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]};var kTe=ue.Schema,CO=kTe.int,Zq={volume_data_3d_info:zE.volume_data_3d_info,segmentation_data_table:{set_id:CO,segment_id:CO},segmentation_data_3d:{values:CO}};var Di={parse:e=>typeof e=="string"?dO(e):vO(e),parseText:dO,parseBinary:vO,toDatabaseCollection:Vq,toDatabase:bc,schema:{mmCIF:e=>bc(Wr,e),CCD:e=>bc(zq,e),BIRD:e=>bc(Hq,e),dic:e=>bc($q,e),cifCore:e=>bc(Wq,e,qq),densityServer:e=>bc(zE,e),segmentation:e=>bc(Zq,e)}};var SO=512;function MTe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function RTe(e,t){let r=t?o=>e.readInt16LE(o*2):o=>e.readInt16BE(o*2),n=1/r(17);return{xStart:r(0),yStart:r(1),zStart:r(2),xExtent:r(3),yExtent:r(4),zExtent:r(5),xRate:r(6),yRate:r(7),zRate:r(8),xlen:r(9)*n,ylen:r(10)*n,zlen:r(11)*n,alpha:r(12)*n,beta:r(13)*n,gamma:r(14)*n,divisor:r(15)/100,summand:r(16),sigma:void 0}}function Kq(e){let{xExtent:t,yExtent:r,zExtent:n}=e,o=Math.ceil(t/8),i=Math.ceil(r/8),s=Math.ceil(n/8);return{xBlocks:o,yBlocks:i,zBlocks:s}}async function BTe(e){let{buffer:t}=await e.readBuffer(0,SO),r=String.fromCharCode.apply(null,t),n=r.startsWith(":-)"),o=n||t.readInt16LE(18*2)===100;return{header:n?MTe(r):RTe(t,o),littleEndian:o}}async function LTe(e,t,r,n){n||Xc.flipByteOrderInPlace2(t.buffer);let{divisor:o,summand:i,xExtent:s,yExtent:a,zExtent:l}=e,{xBlocks:c,yBlocks:u,zBlocks:d}=Kq(e),m=0;for(let p=0;p<d;++p)for(let h=0;h<u;++h)for(let f=0;f<c;++f)for(let C=0;C<8;++C){let g=8*p+C;for(let b=0;b<8;++b){let y=8*h+b;for(let x=0;x<8;++x){let A=8*f+x;if(A<s&&y<a&&g<l){let v=(A*a+y)*l+g;r[v]=(t[m]-i)/o,++m}else{m+=8-x;break}}}}}function NTe(e){let{xExtent:t,yExtent:r,zExtent:n}=e,{xBlocks:o,yBlocks:i,zBlocks:s}=Kq(e),a=t*r*n,l=o*8*i*8*s*8,u=l*1;return{count:l,byteCount:u,valueCount:a}}async function FTe(e,t,r){await r.update({message:"Parsing DSN6/BRIX file..."});let{header:n,littleEndian:o}=await BTe(e),{buffer:i}=await e.readBuffer(SO,t-SO),{valueCount:s}=NTe(n),a=new Float32Array(s);return await LTe(n,i,a,o),{header:n,values:a,name:e.name}}function OTe(e,t){return ke.create("Parse DSN6/BRIX",async r=>{try{return Hr.success(await FTe(e,t,r))}catch(n){return Hr.error(n)}})}function Xq(e,t){return OTe(xx.fromBuffer(Xc.fromUint8Array(e),t),e.length)}var GTe={char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8},UTe=new Set(Object.keys(GTe));function jE(e){if(!UTe.has(e))throw new Error(`unknown ply type '${e}'`);return e}function Yq(e,t,r){let n=new Map;for(let o=0,i=t.length;o<i;++o)n.set(t[o],e[o]);return{comments:r,elementNames:t,getElement:o=>n.get(o)}}function zTe(e,t){let r=Tt(e);return{data:e,tokenizer:r,runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}function HTe(e){let t=e.data.indexOf("end_header",e.position);if(t===-1)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,Tt.eatLine(e)}function jTe(e){let{tokenizer:t,comments:r,elementSpecs:n}=e;HTe(t);let o=Tt.getTokenString(t).split(/\r?\n/);if(o[0]!=="ply")throw new Error("data not starting with 'ply'");if(o[1]!=="format ascii 1.0")throw new Error("format not 'ascii 1.0'");let i,s,a;function l(){if(i!==void 0&&s!==void 0&&a!==void 0){let c=!1;for(let u=0,d=a.length;u<d;++u)if(a[u].kind==="list"){c=!0;break}c&&a.length,c?n.push({kind:"list",name:i,count:s,property:a[0]}):n.push({kind:"table",name:i,count:s,properties:a})}}for(let c=2,u=o.length;c<u;++c){let d=o[c],m=d.split(" ");if(d.startsWith("comment"))r.push(d.substr(8));else if(d.startsWith("element"))l(),a=[],i=m[1],s=parseInt(m[2]);else if(d.startsWith("property")){if(a===void 0)throw new Error("properties outside of element");m[1]==="list"?a.push({kind:"list",countType:jE(m[2]),dataType:jE(m[3]),name:m[4]}):a.push({kind:"column",type:jE(m[1]),name:m[2]})}else d.startsWith("end_header")&&l()}}function $Te(e){let{elementSpecs:t}=e;for(let r=0,n=t.length;r<n;++r){let o=t[r];o.kind==="table"?WTe(e,o):o.kind==="list"&&qTe(e,o)}}function Qq(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ue.Schema.int;case"float":case"double":case"float32":case"float64":return ue.Schema.float}}function WTe(e,t){let{elements:r,tokenizer:n}=e,{count:o,properties:i}=t,s=i.length,a=[],l=[],c=[],u=new Map;for(let d=0,m=s;d<m;++d){let p=ct.create(n.data,o*2);c.push(p)}for(let d=0,m=o;d<m;++d)for(let p=0,h=s;p<h;++p)Tt.skipWhitespace(n),Tt.markStart(n),Tt.eatValue(n),ct.addUnchecked(c[p],n.tokenStart,n.tokenEnd);for(let d=0,m=s;d<m;++d){let{type:p,name:h}=i[d],f=PE(c[d],Qq(p));a.push(h),l.push(p),u.set(h,f)}r.push({kind:"table",rowCount:o,propertyNames:a,propertyTypes:l,getProperty:d=>u.get(d)})}function qTe(e,t){let{elements:r,tokenizer:n}=e,{count:o,property:i}=t,s=ct.create(n.data,o*2*3),a=new Uint32Array(o+1),l=0;for(let d=0,m=o;d<m;++d){for(Tt.skipWhitespace(n),Tt.markStart(n);Tt.skipWhitespace(n)!==10;)++l,Tt.markStart(n),Tt.eatValue(n),ct.addToken(s,n);a[d+1]=l}let c={entries:[],count:0},u=PE(s,Qq(i.dataType));r.push({kind:"list",rowCount:o,name:i.name,type:i.dataType,value:d=>{let m=a[d]+1,p=u.value(m-1);for(let h=m,f=m+p;h<f;++h)c.entries[h-m]=u.value(h);return c.count=p,c}})}async function ZTe(e,t){let r=zTe(e,t);t.update({message:"Parsing...",current:0,max:e.length}),jTe(r),$Te(r);let{elements:n,elementSpecs:o,comments:i}=r,s=o.map(l=>l.name),a=Yq(n,s,i);return Hr.success(a)}function Jq(e){return ke.create("Parse PLY",async t=>await ZTe(e,t))}var{readLine:WE,skipWhitespace:eZ,eatValue:tZ,eatLine:XTe,markStart:IO}=Tt,$E=/\s+/,YTe=/(^\*|REMARK)*/;function QTe(e,t){return{tokenizer:e,runtimeCtx:t}}async function JTe(e,t){let{tokenizer:r}=e,n=ct.create(r.data,t*2),o=ct.create(r.data,t*2),i=ct.create(r.data,t*2),s=ct.create(r.data,t*2),a=ct.create(r.data,t*2),l=ct.create(r.data,t*2),c=ct.create(r.data,t*2),u=ct.create(r.data,t*2),{position:d}=r,m=WE(r).trim();r.position=d;let p=m.split($E).length===7,h=p?6:8,{length:f}=r,C=0;return await yc(e.runtimeCtx,1e5,void 0,g=>{let b=Math.min(t-C,g);for(let y=0;y<b;++y){for(let x=0;x<h;++x)if(eZ(r),IO(r),tZ(r),p)switch(x){case 0:ct.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ct.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 2:ct.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 3:ct.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 4:ct.addUnchecked(c,r.tokenStart,r.tokenEnd);break;case 5:ct.addUnchecked(u,r.tokenStart,r.tokenEnd);break}else switch(x){case 0:ct.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ct.addUnchecked(o,r.tokenStart,r.tokenEnd);break;case 2:ct.addUnchecked(i,r.tokenStart,r.tokenEnd);break;case 3:ct.addUnchecked(s,r.tokenStart,r.tokenEnd);break;case 4:ct.addUnchecked(a,r.tokenStart,r.tokenEnd);break;case 5:ct.addUnchecked(l,r.tokenStart,r.tokenEnd);break;case 6:ct.addUnchecked(c,r.tokenStart,r.tokenEnd);break;case 7:ct.addUnchecked(u,r.tokenStart,r.tokenEnd);break}XTe(r),IO(r)}return C+=b,b},g=>g.update({message:"Parsing...",current:r.position,max:f})),{count:t,atomId:dr(n)(ue.Schema.int),segmentName:p?dr(i)(ue.Schema.str):dr(o)(ue.Schema.str),residueId:dr(i)(ue.Schema.int),residueName:p?dr(i)(ue.Schema.str):dr(s)(ue.Schema.str),atomName:dr(a)(ue.Schema.str),atomType:dr(l)(ue.Schema.str),charge:dr(c)(ue.Schema.float),mass:dr(u)(ue.Schema.float)}}async function eEe(e,t){let{tokenizer:r}=e,n=ct.create(r.data,t*2),o=ct.create(r.data,t*2),{length:i}=r,s=0;return await yc(e.runtimeCtx,10,void 0,a=>{let l=Math.min(t-s,a);for(let c=0;c<l;++c)for(let u=0;u<2;++u)switch(eZ(r),IO(r),tZ(r),u){case 0:ct.addUnchecked(n,r.tokenStart,r.tokenEnd);break;case 1:ct.addUnchecked(o,r.tokenStart,r.tokenEnd);break}return s+=l,l},a=>a.update({message:"Parsing...",current:r.position,max:i})),{count:t,atomIdA:dr(n)(ue.Schema.int),atomIdB:dr(o)(ue.Schema.int)}}function tEe(e,t){let r=[];for(let n=0;n<t;++n){let o=WE(e.tokenizer);r.push(o.replace(YTe,"").trim())}return r}async function rEe(e,t){let r=Tt(e),n=QTe(r,t),o,i,s,a=WE(n.tokenizer).trim();for(;r.tokenEnd<r.length;){let c=WE(n.tokenizer).trim();if(c.includes("!NTITLE")){let u=parseInt(c.split($E)[0]);o=tEe(n,u)}else if(c.includes("!NATOM")){let u=parseInt(c.split($E)[0]);i=await JTe(n,u)}else if(c.includes("!NBOND")){let u=parseInt(c.split($E)[0]);s=await eEe(n,u);break}else c.includes("!NTHETA")||c.includes("!NPHI")||c.includes("!NIMPHI")||c.includes("!NDON")||c.includes("!NACC")||c.includes("!NNB")||c.includes("!NGRP NST2")||c.includes("!MOLNT")||c.includes("!NUMLP NUMLPH")||c.includes("!NCRTERM")}if(o===void 0&&(o=[]),i===void 0)return Hr.error("no atoms data");if(s===void 0)return Hr.error("no bonds data");let l={id:a,title:o,atoms:i,bonds:s};return Hr.success(l)}function rZ(e){return ke.create("Parse PSF",async t=>await rEe(e,t))}var Hn;(function(e){function t(){return o=>r(o)}e.factory=t;function r(o){var i;return i=class{static is(a){return!!a&&o===a.type}constructor(a,l){this.data=a,this.id=jr.create22(),this.type=o,this.label=l&&l.label||o.name,this.description=l&&l.description}},i.type=o,i}e.create=r;function n(o,i){if(!o.tags)return!1;for(let s of o.tags)if(s===i)return!0;return!1}e.hasTag=n,e.Null={id:jr.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}})(Hn||(Hn={}));var Dx;(function(e){function t(n){let o=n;return!!o&&!!o.transform&&!!o.parent&&!!o.status}e.is=t;function r(n,o){let i=typeof o=="string"?o:e.is(o)?o.transform.ref:o.ref;return n.cells.get(i)}e.resolve=r})(Dx||(Dx={}));var kx=class{get cell(){var t;return(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref)}get obj(){var t,r;return(r=(t=this.state)===null||t===void 0?void 0:t.cells.get(this.ref))===null||r===void 0?void 0:r.obj}get data(){var t;return(t=this.obj)===null||t===void 0?void 0:t.data}update(t,r){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return r||(r=this.state.build()),(r||this.state.build()).to(this).update(t),r}checkValid(){if(!this.state)throw new Error("Unassigned State.");let t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if(t.status==="ok")return!0;throw t.status==="error"?new Error(t.errorText):t.obj===Hn.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")}get isOk(){let t=this.cell;return t&&t.status==="ok"&&t.obj!==Hn.Null}constructor(t,r){this.ref=t,this.state=r}},Jn;(function(e){function t(o){var i;if(o)return typeof o=="string"?o:Dx.is(o)?o.transform.ref:(i=o.cell)===null||i===void 0?void 0:i.transform.ref}e.resolveRef=t;function r(o,i){if(i)return Dx.is(i)?i:typeof i=="string"?o.cells.get(i):i.cell}e.resolve=r;function n(o,i){let s=r(o,i);if(!(!s||!s.obj||s.status!=="ok"))return s}e.resolveAndCheck=n})(Jn||(Jn={}));var t2="delete",Ji=5,Jd=1<<Ji,Jc=Jd-1,Io={};function DO(){return{value:!1}}function em(e){e&&(e.value=!0)}function VO(){}function Mx(e){return e.size===void 0&&(e.size=e.__iterate(EZ)),e.size}function C0(e,t){if(typeof t!="number"){var r=t>>>0;if(""+r!==t||r===4294967295)return NaN;t=r}return t<0?Mx(e)+t:t}function EZ(){return!0}function eP(e,t,r){return(e===0&&!DZ(e)||r!==void 0&&e<=-r)&&(t===void 0||r!==void 0&&t>=r)}function r2(e,t){return PZ(e,t,0)}function tP(e,t){return PZ(e,t,t)}function PZ(e,t,r){return e===void 0?r:DZ(e)?t===1/0?t:Math.max(0,t+e)|0:t===void 0||t===e?e:Math.min(t,e)|0}function DZ(e){return e<0||e===0&&1/e===-1/0}var kZ="@@__IMMUTABLE_ITERABLE__@@";function Tu(e){return!!(e&&e[kZ])}var MZ="@@__IMMUTABLE_KEYED__@@";function gs(e){return!!(e&&e[MZ])}var RZ="@@__IMMUTABLE_INDEXED__@@";function _u(e){return!!(e&&e[RZ])}function rP(e){return gs(e)||_u(e)}var pa=function(t){return Tu(t)?t:xd(t)},rm=function(e){function t(r){return gs(r)?r:I0(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(pa),ab=function(e){function t(r){return _u(r)?r:wp(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(pa),Vx=function(e){function t(r){return Tu(r)&&!rP(r)?r:Hx(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(pa);pa.Keyed=rm;pa.Indexed=ab;pa.Set=Vx;var BZ="@@__IMMUTABLE_SEQ__@@";function GO(e){return!!(e&&e[BZ])}var LZ="@@__IMMUTABLE_RECORD__@@";function Gx(e){return!!(e&&e[LZ])}function Ef(e){return Tu(e)||Gx(e)}var Ux="@@__IMMUTABLE_ORDERED__@@";function Ip(e){return!!(e&&e[Ux])}var n2=0,Ap=1,tm=2,kO=typeof Symbol=="function"&&Symbol.iterator,NZ="@@iterator",nP=kO||NZ,ri=function(t){this.next=t};ri.prototype.toString=function(){return"[Iterator]"};ri.KEYS=n2;ri.VALUES=Ap;ri.ENTRIES=tm;ri.prototype.inspect=ri.prototype.toSource=function(){return this.toString()};ri.prototype[nP]=function(){return this};function ys(e,t,r,n){var o=e===0?t:e===1?r:[t,r];return n?n.value=o:n={value:o,done:!1},n}function Eu(){return{value:void 0,done:!0}}function FZ(e){return Array.isArray(e)?!0:!!oP(e)}function nZ(e){return e&&typeof e.next=="function"}function MO(e){var t=oP(e);return t&&t.call(e)}function oP(e){var t=e&&(kO&&e[kO]||e[NZ]);if(typeof t=="function")return t}function nEe(e){var t=oP(e);return t&&t===e.entries}function oEe(e){var t=oP(e);return t&&t===e.keys}var zx=Object.prototype.hasOwnProperty;function OZ(e){return Array.isArray(e)||typeof e=="string"?!0:e&&typeof e=="object"&&Number.isInteger(e.length)&&e.length>=0&&(e.length===0?Object.keys(e).length===1:e.hasOwnProperty(e.length-1))}var xd=function(e){function t(r){return r==null?zO():Ef(r)?r.toSeq():sEe(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(n,o){var i=this._cache;if(i){for(var s=i.length,a=0;a!==s;){var l=i[o?s-++a:a++];if(n(l[1],l[0],this)===!1)break}return a}return this.__iterateUncached(n,o)},t.prototype.__iterator=function(n,o){var i=this._cache;if(i){var s=i.length,a=0;return new ri(function(){if(a===s)return Eu();var l=i[o?s-++a:a++];return ys(n,l[0],l[1])})}return this.__iteratorUncached(n,o)},t}(pa),I0=function(e){function t(r){return r==null?zO().toKeyedSeq():Tu(r)?gs(r)?r.toSeq():r.fromEntrySeq():Gx(r)?r.toSeq():HO(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(xd),wp=function(e){function t(r){return r==null?zO():Tu(r)?gs(r)?r.entrySeq():r.toIndexedSeq():Gx(r)?r.toSeq().entrySeq():VZ(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}(xd),Hx=function(e){function t(r){return(Tu(r)&&!rP(r)?r:wp(r)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(xd);xd.isSeq=GO;xd.Keyed=I0;xd.Set=Hx;xd.Indexed=wp;xd.prototype[BZ]=!0;var sb=function(e){function t(r){this._array=r,this.size=r.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return this.has(n)?this._array[C0(this,n)]:o},t.prototype.__iterate=function(n,o){for(var i=this._array,s=i.length,a=0;a!==s;){var l=o?s-++a:a++;if(n(i[l],l,this)===!1)break}return a},t.prototype.__iterator=function(n,o){var i=this._array,s=i.length,a=0;return new ri(function(){if(a===s)return Eu();var l=o?s-++a:a++;return ys(n,l,i[l])})},t}(wp),UO=function(e){function t(r){var n=Object.keys(r).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r):[]);this._object=r,this._keys=n,this.size=n.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return o!==void 0&&!this.has(n)?o:this._object[n]},t.prototype.has=function(n){return zx.call(this._object,n)},t.prototype.__iterate=function(n,o){for(var i=this._object,s=this._keys,a=s.length,l=0;l!==a;){var c=s[o?a-++l:l++];if(n(i[c],c,this)===!1)break}return l},t.prototype.__iterator=function(n,o){var i=this._object,s=this._keys,a=s.length,l=0;return new ri(function(){if(l===a)return Eu();var c=s[o?a-++l:l++];return ys(n,c,i[c])})},t}(I0);UO.prototype[Ux]=!0;var iEe=function(e){function t(r){this._collection=r,this.size=r.length||r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(n,o){if(o)return this.cacheResult().__iterate(n,o);var i=this._collection,s=MO(i),a=0;if(nZ(s))for(var l;!(l=s.next()).done&&n(l.value,a++,this)!==!1;);return a},t.prototype.__iteratorUncached=function(n,o){if(o)return this.cacheResult().__iterator(n,o);var i=this._collection,s=MO(i);if(!nZ(s))return new ri(Eu);var a=0;return new ri(function(){var l=s.next();return l.done?l:ys(n,a++,l.value)})},t}(wp),oZ;function zO(){return oZ||(oZ=new sb([]))}function HO(e){var t=jO(e);if(t)return t.fromEntrySeq();if(typeof e=="object")return new UO(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function VZ(e){var t=jO(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function sEe(e){var t=jO(e);if(t)return nEe(e)?t.fromEntrySeq():oEe(e)?t.toSetSeq():t;if(typeof e=="object")return new UO(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}function jO(e){return OZ(e)?new sb(e):FZ(e)?new iEe(e):void 0}var GZ="@@__IMMUTABLE_MAP__@@";function $O(e){return!!(e&&e[GZ])}function UZ(e){return $O(e)&&Ip(e)}function iZ(e){return!!(e&&typeof e.equals=="function"&&typeof e.hashCode=="function")}function bd(e,t){if(e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1;if(typeof e.valueOf=="function"&&typeof t.valueOf=="function"){if(e=e.valueOf(),t=t.valueOf(),e===t||e!==e&&t!==t)return!0;if(!e||!t)return!1}return!!(iZ(e)&&iZ(t)&&e.equals(t))}var $A=typeof Math.imul=="function"&&Math.imul(4294967295,2)===-2?Math.imul:function(t,r){t|=0,r|=0;var n=t&65535,o=r&65535;return n*o+((t>>>16)*o+n*(r>>>16)<<16>>>0)|0};function iP(e){return e>>>1&1073741824|e&3221225471}var aEe=Object.prototype.valueOf;function yd(e){if(e==null)return sZ(e);if(typeof e.hashCode=="function")return iP(e.hashCode(e));var t=pEe(e);if(t==null)return sZ(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return lEe(t);case"string":return t.length>fEe?cEe(t):RO(t);case"object":case"function":return dEe(t);case"symbol":return uEe(t);default:if(typeof t.toString=="function")return RO(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function sZ(e){return e===null?1108378658:1108378659}function lEe(e){if(e!==e||e===1/0)return 0;var t=e|0;for(t!==e&&(t^=e*4294967295);e>4294967295;)e/=4294967295,t^=e;return iP(t)}function cEe(e){var t=_O[e];return t===void 0&&(t=RO(e),wO===hEe&&(wO=0,_O={}),wO++,_O[e]=t),t}function RO(e){for(var t=0,r=0;r<e.length;r++)t=31*t+e.charCodeAt(r)|0;return iP(t)}function uEe(e){var t=cZ[e];return t!==void 0||(t=zZ(),cZ[e]=t),t}function dEe(e){var t;if(BO&&(t=LO.get(e),t!==void 0)||(t=e[ib],t!==void 0)||!lZ&&(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[ib],t!==void 0||(t=mEe(e),t!==void 0)))return t;if(t=zZ(),BO)LO.set(e,t);else{if(aZ!==void 0&&aZ(e)===!1)throw new Error("Non-extensible objects are not allowed as keys.");if(lZ)Object.defineProperty(e,ib,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(e.propertyIsEnumerable!==void 0&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[ib]=t;else if(e.nodeType!==void 0)e[ib]=t;else throw new Error("Unable to set a non-enumerable property on object.")}return t}var aZ=Object.isExtensible,lZ=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function mEe(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}function pEe(e){return e.valueOf!==aEe&&typeof e.valueOf=="function"?e.valueOf(e):e}function zZ(){var e=++AO;return AO&1073741824&&(AO=0),e}var BO=typeof WeakMap=="function",LO;BO&&(LO=new WeakMap);var cZ=Object.create(null),AO=0,ib="__immutablehash__";typeof Symbol=="function"&&(ib=Symbol(ib));var fEe=16,hEe=255,wO=0,_O={},sP=function(e){function t(r,n){this._iter=r,this._useKeys=n,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n,o){return this._iter.get(n,o)},t.prototype.has=function(n){return this._iter.has(n)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var n=this,o=WO(this,!0);return this._useKeys||(o.valueSeq=function(){return n._iter.toSeq().reverse()}),o},t.prototype.map=function(n,o){var i=this,s=qZ(this,n,o);return this._useKeys||(s.valueSeq=function(){return i._iter.toSeq().map(n,o)}),s},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(s,a){return n(s,a,i)},o)},t.prototype.__iterator=function(n,o){return this._iter.__iterator(n,o)},t}(I0);sP.prototype[Ux]=!0;var HZ=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,o){var i=this,s=0;return o&&Mx(this),this._iter.__iterate(function(a){return n(a,o?i.size-++s:s++,i)},o)},t.prototype.__iterator=function(n,o){var i=this,s=this._iter.__iterator(Ap,o),a=0;return o&&Mx(this),new ri(function(){var l=s.next();return l.done?l:ys(n,o?i.size-++a:a++,l.value,l)})},t}(wp),jZ=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(n){return this._iter.includes(n)},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(s){return n(s,s,i)},o)},t.prototype.__iterator=function(n,o){var i=this._iter.__iterator(Ap,o);return new ri(function(){var s=i.next();return s.done?s:ys(n,s.value,s.value,s)})},t}(Hx),$Z=function(e){function t(r){this._iter=r,this.size=r.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(n,o){var i=this;return this._iter.__iterate(function(s){if(s){dZ(s);var a=Tu(s);return n(a?s.get(1):s[1],a?s.get(0):s[0],i)}},o)},t.prototype.__iterator=function(n,o){var i=this._iter.__iterator(Ap,o);return new ri(function(){for(;;){var s=i.next();if(s.done)return s;var a=s.value;if(a){dZ(a);var l=Tu(a);return ys(n,l?a.get(0):a[0],l?a.get(1):a[1],s)}}})},t}(I0);HZ.prototype.cacheResult=sP.prototype.cacheResult=jZ.prototype.cacheResult=$Z.prototype.cacheResult=KO;function WZ(e){var t=Pf(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var r=e.reverse.apply(this);return r.flip=function(){return e.reverse()},r},t.has=function(r){return e.includes(r)},t.includes=function(r){return e.has(r)},t.cacheResult=KO,t.__iterateUncached=function(r,n){var o=this;return e.__iterate(function(i,s){return r(s,i,o)!==!1},n)},t.__iteratorUncached=function(r,n){if(r===tm){var o=e.__iterator(r,n);return new ri(function(){var i=o.next();if(!i.done){var s=i.value[0];i.value[0]=i.value[1],i.value[1]=s}return i})}return e.__iterator(r===Ap?n2:Ap,n)},t}function qZ(e,t,r){var n=Pf(e);return n.size=e.size,n.has=function(o){return e.has(o)},n.get=function(o,i){var s=e.get(o,Io);return s===Io?i:t.call(r,s,o,e)},n.__iterateUncached=function(o,i){var s=this;return e.__iterate(function(a,l,c){return o(t.call(r,a,l,c),l,s)!==!1},i)},n.__iteratorUncached=function(o,i){var s=e.__iterator(tm,i);return new ri(function(){var a=s.next();if(a.done)return a;var l=a.value,c=l[0];return ys(o,c,t.call(r,l[1],c,e),a)})},n}function WO(e,t){var r=this,n=Pf(e);return n._iter=e,n.size=e.size,n.reverse=function(){return e},e.flip&&(n.flip=function(){var o=WZ(e);return o.reverse=function(){return e.flip()},o}),n.get=function(o,i){return e.get(t?o:-1-o,i)},n.has=function(o){return e.has(t?o:-1-o)},n.includes=function(o){return e.includes(o)},n.cacheResult=KO,n.__iterate=function(o,i){var s=this,a=0;return i&&Mx(e),e.__iterate(function(l,c){return o(l,t?c:i?s.size-++a:a++,s)},!i)},n.__iterator=function(o,i){var s=0;i&&Mx(e);var a=e.__iterator(tm,!i);return new ri(function(){var l=a.next();if(l.done)return l;var c=l.value;return ys(o,t?c[0]:i?r.size-++s:s++,c[1],l)})},n}function ZZ(e,t,r,n){var o=Pf(e);return n&&(o.has=function(i){var s=e.get(i,Io);return s!==Io&&!!t.call(r,s,i,e)},o.get=function(i,s){var a=e.get(i,Io);return a!==Io&&t.call(r,a,i,e)?a:s}),o.__iterateUncached=function(i,s){var a=this,l=0;return e.__iterate(function(c,u,d){if(t.call(r,c,u,d))return l++,i(c,n?u:l-1,a)},s),l},o.__iteratorUncached=function(i,s){var a=e.__iterator(tm,s),l=0;return new ri(function(){for(;;){var c=a.next();if(c.done)return c;var u=c.value,d=u[0],m=u[1];if(t.call(r,m,d,e))return ys(i,n?d:l++,m,c)}})},o}function gEe(e,t,r){var n=Sd().asMutable();return e.__iterate(function(o,i){n.update(t.call(r,o,i,e),0,function(s){return s+1})}),n.asImmutable()}function yEe(e,t,r){var n=gs(e),o=(Ip(e)?Ea():Sd()).asMutable();e.__iterate(function(s,a){o.update(t.call(r,s,a,e),function(l){return l=l||[],l.push(n?[a,s]:s),l})});var i=ZO(e);return o.map(function(s){return Li(e,i(s))}).asImmutable()}function vEe(e,t,r){var n=gs(e),o=[[],[]];e.__iterate(function(s,a){o[t.call(r,s,a,e)?1:0].push(n?[a,s]:s)});var i=ZO(e);return o.map(function(s){return Li(e,i(s))})}function qO(e,t,r,n){var o=e.size;if(eP(t,r,o))return e;var i=r2(t,o),s=tP(r,o);if(i!==i||s!==s)return qO(e.toSeq().cacheResult(),t,r,n);var a=s-i,l;a===a&&(l=a<0?0:a);var c=Pf(e);return c.size=l===0?l:e.size&&l||void 0,!n&&GO(e)&&l>=0&&(c.get=function(u,d){return u=C0(this,u),u>=0&&u<l?e.get(u+i,d):d}),c.__iterateUncached=function(u,d){var m=this;if(l===0)return 0;if(d)return this.cacheResult().__iterate(u,d);var p=0,h=!0,f=0;return e.__iterate(function(C,g){if(!(h&&(h=p++<i)))return f++,u(C,n?g:f-1,m)!==!1&&f!==l}),f},c.__iteratorUncached=function(u,d){if(l!==0&&d)return this.cacheResult().__iterator(u,d);if(l===0)return new ri(Eu);var m=e.__iterator(u,d),p=0,h=0;return new ri(function(){for(;p++<i;)m.next();if(++h>l)return Eu();var f=m.next();return n||u===Ap||f.done?f:u===n2?ys(u,h-1,void 0,f):ys(u,h-1,f.value[1],f)})},c}function bEe(e,t,r){var n=Pf(e);return n.__iterateUncached=function(o,i){var s=this;if(i)return this.cacheResult().__iterate(o,i);var a=0;return e.__iterate(function(l,c,u){return t.call(r,l,c,u)&&++a&&o(l,c,s)}),a},n.__iteratorUncached=function(o,i){var s=this;if(i)return this.cacheResult().__iterator(o,i);var a=e.__iterator(tm,i),l=!0;return new ri(function(){if(!l)return Eu();var c=a.next();if(c.done)return c;var u=c.value,d=u[0],m=u[1];return t.call(r,m,d,s)?o===tm?c:ys(o,d,m,c):(l=!1,Eu())})},n}function KZ(e,t,r,n){var o=Pf(e);return o.__iterateUncached=function(i,s){var a=this;if(s)return this.cacheResult().__iterate(i,s);var l=!0,c=0;return e.__iterate(function(u,d,m){if(!(l&&(l=t.call(r,u,d,m))))return c++,i(u,n?d:c-1,a)}),c},o.__iteratorUncached=function(i,s){var a=this;if(s)return this.cacheResult().__iterator(i,s);var l=e.__iterator(tm,s),c=!0,u=0;return new ri(function(){var d,m,p;do{if(d=l.next(),d.done)return n||i===Ap?d:i===n2?ys(i,u++,void 0,d):ys(i,u++,d.value[1],d);var h=d.value;m=h[0],p=h[1],c&&(c=t.call(r,p,m,a))}while(c);return i===tm?d:ys(i,m,p,d)})},o}function xEe(e,t){var r=gs(e),n=[e].concat(t).map(function(s){return Tu(s)?r&&(s=rm(s)):s=r?HO(s):VZ(Array.isArray(s)?s:[s]),s}).filter(function(s){return s.size!==0});if(n.length===0)return e;if(n.length===1){var o=n[0];if(o===e||r&&gs(o)||_u(e)&&_u(o))return o}var i=new sb(n);return r?i=i.toKeyedSeq():_u(e)||(i=i.toSetSeq()),i=i.flatten(!0),i.size=n.reduce(function(s,a){if(s!==void 0){var l=a.size;if(l!==void 0)return s+l}},0),i}function XZ(e,t,r){var n=Pf(e);return n.__iterateUncached=function(o,i){if(i)return this.cacheResult().__iterate(o,i);var s=0,a=!1;function l(c,u){c.__iterate(function(d,m){return(!t||u<t)&&Tu(d)?l(d,u+1):(s++,o(d,r?m:s-1,n)===!1&&(a=!0)),!a},i)}return l(e,0),s},n.__iteratorUncached=function(o,i){if(i)return this.cacheResult().__iterator(o,i);var s=e.__iterator(o,i),a=[],l=0;return new ri(function(){for(;s;){var c=s.next();if(c.done!==!1){s=a.pop();continue}var u=c.value;if(o===tm&&(u=u[1]),(!t||a.length<t)&&Tu(u))a.push(s),s=u.__iterator(o,i);else return r?c:ys(o,l++,u,c)}return Eu()})},n}function CEe(e,t,r){var n=ZO(e);return e.toSeq().map(function(o,i){return n(t.call(r,o,i,e))}).flatten(!0)}function SEe(e,t){var r=Pf(e);return r.size=e.size&&e.size*2-1,r.__iterateUncached=function(n,o){var i=this,s=0;return e.__iterate(function(a){return(!s||n(t,s++,i)!==!1)&&n(a,s++,i)!==!1},o),s},r.__iteratorUncached=function(n,o){var i=e.__iterator(Ap,o),s=0,a;return new ri(function(){return(!a||s%2)&&(a=i.next(),a.done)?a:s%2?ys(n,s++,t):ys(n,s++,a.value,a)})},r}function Rx(e,t,r){t||(t=YZ);var n=gs(e),o=0,i=e.toSeq().map(function(s,a){return[a,s,o++,r?r(s,a,e):s]}).valueSeq().toArray();return i.sort(function(s,a){return t(s[3],a[3])||s[2]-a[2]}).forEach(n?function(s,a){i[a].length=2}:function(s,a){i[a]=s[1]}),n?I0(i):_u(e)?wp(i):Hx(i)}function qE(e,t,r){if(t||(t=YZ),r){var n=e.toSeq().map(function(o,i){return[o,r(o,i,e)]}).reduce(function(o,i){return uZ(t,o[1],i[1])?i:o});return n&&n[0]}return e.reduce(function(o,i){return uZ(t,o,i)?i:o})}function uZ(e,t,r){var n=e(r,t);return n===0&&r!==t&&(r==null||r!==r)||n>0}function ZE(e,t,r,n){var o=Pf(e),i=new sb(r).map(function(s){return s.size});return o.size=n?i.max():i.min(),o.__iterate=function(s,a){for(var l=this.__iterator(Ap,a),c,u=0;!(c=l.next()).done&&s(c.value,u++,this)!==!1;);return u},o.__iteratorUncached=function(s,a){var l=r.map(function(d){return d=pa(d),MO(a?d.reverse():d)}),c=0,u=!1;return new ri(function(){var d;return u||(d=l.map(function(m){return m.next()}),u=n?d.every(function(m){return m.done}):d.some(function(m){return m.done})),u?Eu():ys(s,c++,t.apply(null,d.map(function(m){return m.value})))})},o}function Li(e,t){return e===t?e:GO(e)?t:e.constructor(t)}function dZ(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function ZO(e){return gs(e)?rm:_u(e)?ab:Vx}function Pf(e){return Object.create((gs(e)?I0:_u(e)?wp:Hx).prototype)}function KO(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):xd.prototype.cacheResult.call(this)}function YZ(e,t){return e===void 0&&t===void 0?0:e===void 0?1:t===void 0?-1:e>t?1:e<t?-1:0}function Tf(e,t){t=t||0;for(var r=Math.max(0,e.length-t),n=new Array(r),o=0;o<r;o++)n[o]=e[o+t];return n}function XO(e,t){if(!e)throw new Error(t)}function vd(e){XO(e!==1/0,"Cannot perform this action with an infinite size.")}function QZ(e){if(OZ(e)&&typeof e!="string")return e;if(Ip(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}var IEe=Object.prototype.toString;function AEe(e){if(!e||typeof e!="object"||IEe.call(e)!=="[object Object]")return!1;var t=Object.getPrototypeOf(e);if(t===null)return!0;for(var r=t,n=Object.getPrototypeOf(t);n!==null;)r=n,n=Object.getPrototypeOf(r);return r===t}function S0(e){return typeof e=="object"&&(Ef(e)||Array.isArray(e)||AEe(e))}function XA(e){try{return typeof e=="string"?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function wEe(e,t){return Ef(e)?e.has(t):S0(e)&&zx.call(e,t)}function JZ(e,t,r){return Ef(e)?e.get(t,r):wEe(e,t)?typeof e.get=="function"?e.get(t):e[t]:r}function QE(e){if(Array.isArray(e))return Tf(e);var t={};for(var r in e)zx.call(e,r)&&(t[r]=e[r]);return t}function _Ee(e,t){if(!S0(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Ef(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!zx.call(e,t))return e;var r=QE(e);return Array.isArray(r)?r.splice(t,1):delete r[t],r}function TEe(e,t,r){if(!S0(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Ef(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,r)}if(zx.call(e,t)&&r===e[t])return e;var n=QE(e);return n[t]=r,n}function jx(e,t,r,n){n||(n=r,r=void 0);var o=eK(Ef(e),e,QZ(t),0,r,n);return o===Io?r:o}function eK(e,t,r,n,o,i){var s=t===Io;if(n===r.length){var a=s?o:t,l=i(a);return l===a?t:l}if(!s&&!S0(t))throw new TypeError("Cannot update within non-data-structure value in path ["+r.slice(0,n).map(XA)+"]: "+t);var c=r[n],u=s?Io:JZ(t,c,Io),d=eK(u===Io?e:Ef(u),u,r,n+1,o,i);return d===u?t:d===Io?_Ee(t,c):TEe(s?e?Sp():{}:t,c,d)}function EEe(e,t,r){return jx(e,t,Io,function(){return r})}function YO(e,t){return EEe(this,e,t)}function PEe(e,t){return jx(e,t,function(){return Io})}function QO(e){return PEe(this,e)}function tK(e,t,r,n){return jx(e,[t],r,n)}function JO(e,t,r){return arguments.length===1?e(this):tK(this,e,t,r)}function e4(e,t,r){return jx(this,e,t,r)}function rK(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return oK(this,e)}function nK(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(typeof e!="function")throw new TypeError("Invalid merger function: "+e);return oK(this,t,e)}function oK(e,t,r){for(var n=[],o=0;o<t.length;o++){var i=rm(t[o]);i.size!==0&&n.push(i)}return n.length===0?e:e.toSeq().size===0&&!e.__ownerID&&n.length===1?e.constructor(n[0]):e.withMutations(function(s){for(var a=r?function(c,u){tK(s,u,Io,function(d){return d===Io?c:r(d,c,u)})}:function(c,u){s.set(u,c)},l=0;l<n.length;l++)n[l].forEach(a)})}function t4(e,t,r){return r4(e,t,DEe(r))}function r4(e,t,r){if(!S0(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(Ef(e))return typeof r=="function"&&e.mergeWith?e.mergeWith.apply(e,[r].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var n=Array.isArray(e),o=e,i=n?ab:rm,s=n?function(l){o===e&&(o=QE(o)),o.push(l)}:function(l,c){var u=zx.call(o,c),d=u&&r?r(o[c],l,c):l;(!u||d!==o[c])&&(o===e&&(o=QE(o)),o[c]=d)},a=0;a<t.length;a++)i(t[a]).forEach(s);return o}function DEe(e){function t(r,n,o){return S0(r)&&S0(n)&&kEe(r,n)?r4(r,[n],t):e?e(r,n,o):n}return t}function kEe(e,t){var r=xd(e),n=xd(t);return _u(r)===_u(n)&&gs(r)===gs(n)}function iK(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return t4(this,e)}function sK(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return t4(this,t,e)}function n4(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return jx(this,e,Sp(),function(n){return r4(n,t)})}function o4(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return jx(this,e,Sp(),function(n){return t4(n,t)})}function o2(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function i2(){return this.__ownerID?this:this.__ensureOwner(new VO)}function s2(){return this.__ensureOwner()}function i4(){return this.__altered}var Sd=function(e){function t(r){return r==null?Sp():$O(r)&&!Ip(r)?r:Sp().withMutations(function(n){var o=e(r);vd(o.size),o.forEach(function(i,s){return n.set(s,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];return Sp().withMutations(function(i){for(var s=0;s<n.length;s+=2){if(s+1>=n.length)throw new Error("Missing value for key: "+n[s]);i.set(n[s],n[s+1])}})},t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(n,o){return this._root?this._root.get(0,void 0,n,o):o},t.prototype.set=function(n,o){return fZ(this,n,o)},t.prototype.remove=function(n){return fZ(this,n,Io)},t.prototype.deleteAll=function(n){var o=pa(n);return o.size===0?this:this.withMutations(function(i){o.forEach(function(s){return i.remove(s)})})},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Sp()},t.prototype.sort=function(n){return Ea(Rx(this,n))},t.prototype.sortBy=function(n,o){return Ea(Rx(this,o,n))},t.prototype.map=function(n,o){var i=this;return this.withMutations(function(s){s.forEach(function(a,l){s.set(l,n.call(o,a,l,i))})})},t.prototype.__iterator=function(n,o){return new MEe(this,n,o)},t.prototype.__iterate=function(n,o){var i=this,s=0;return this._root&&this._root.iterate(function(a){return s++,n(a[1],a[0],i)},o),s},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?s4(this.size,this._root,n,this.__hash):this.size===0?Sp():(this.__ownerID=n,this.__altered=!1,this)},t}(rm);Sd.isMap=$O;var es=Sd.prototype;es[GZ]=!0;es[t2]=es.remove;es.removeAll=es.deleteAll;es.setIn=YO;es.removeIn=es.deleteIn=QO;es.update=JO;es.updateIn=e4;es.merge=es.concat=rK;es.mergeWith=nK;es.mergeDeep=iK;es.mergeDeepWith=sK;es.mergeIn=n4;es.mergeDeepIn=o4;es.withMutations=o2;es.wasAltered=i4;es.asImmutable=s2;es["@@transducer/init"]=es.asMutable=i2;es["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])};es["@@transducer/result"]=function(e){return e.asImmutable()};var YA=function(t,r){this.ownerID=t,this.entries=r};YA.prototype.get=function(t,r,n,o){for(var i=this.entries,s=0,a=i.length;s<a;s++)if(bd(n,i[s][0]))return i[s][1];return o};YA.prototype.update=function(t,r,n,o,i,s,a){for(var l=i===Io,c=this.entries,u=0,d=c.length;u<d&&!bd(o,c[u][0]);u++);var m=u<d;if(m?c[u][1]===i:l)return this;if(em(a),(l||!m)&&em(s),!(l&&c.length===1)){if(!m&&!l&&c.length>=OEe)return REe(t,c,o,i);var p=t&&t===this.ownerID,h=p?c:Tf(c);return m?l?u===d-1?h.pop():h[u]=h.pop():h[u]=[o,i]:h.push([o,i]),p?(this.entries=h,this):new YA(t,h)}};var Bx=function(t,r,n){this.ownerID=t,this.bitmap=r,this.nodes=n};Bx.prototype.get=function(t,r,n,o){r===void 0&&(r=yd(n));var i=1<<((t===0?r:r>>>t)&Jc),s=this.bitmap;return s&i?this.nodes[aK(s&i-1)].get(t+Ji,r,n,o):o};Bx.prototype.update=function(t,r,n,o,i,s,a){n===void 0&&(n=yd(o));var l=(r===0?n:n>>>r)&Jc,c=1<<l,u=this.bitmap,d=(u&c)!==0;if(!d&&i===Io)return this;var m=aK(u&c-1),p=this.nodes,h=d?p[m]:void 0,f=a4(h,t,r+Ji,n,o,i,s,a);if(f===h)return this;if(!d&&f&&p.length>=VEe)return LEe(t,p,u,l,f);if(d&&!f&&p.length===2&&hZ(p[m^1]))return p[m^1];if(d&&f&&p.length===1&&hZ(f))return f;var C=t&&t===this.ownerID,g=d?f?u:u^c:u|c,b=d?f?lK(p,m,f,C):FEe(p,m,C):NEe(p,m,f,C);return C?(this.bitmap=g,this.nodes=b,this):new Bx(t,g,b)};var QA=function(t,r,n){this.ownerID=t,this.count=r,this.nodes=n};QA.prototype.get=function(t,r,n,o){r===void 0&&(r=yd(n));var i=(t===0?r:r>>>t)&Jc,s=this.nodes[i];return s?s.get(t+Ji,r,n,o):o};QA.prototype.update=function(t,r,n,o,i,s,a){n===void 0&&(n=yd(o));var l=(r===0?n:n>>>r)&Jc,c=i===Io,u=this.nodes,d=u[l];if(c&&!d)return this;var m=a4(d,t,r+Ji,n,o,i,s,a);if(m===d)return this;var p=this.count;if(!d)p++;else if(!m&&(p--,p<GEe))return BEe(t,u,p,l);var h=t&&t===this.ownerID,f=lK(u,l,m,h);return h?(this.count=p,this.nodes=f,this):new QA(t,p,f)};var Lx=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entries=n};Lx.prototype.get=function(t,r,n,o){for(var i=this.entries,s=0,a=i.length;s<a;s++)if(bd(n,i[s][0]))return i[s][1];return o};Lx.prototype.update=function(t,r,n,o,i,s,a){n===void 0&&(n=yd(o));var l=i===Io;if(n!==this.keyHash)return l?this:(em(a),em(s),l4(this,t,r,n,[o,i]));for(var c=this.entries,u=0,d=c.length;u<d&&!bd(o,c[u][0]);u++);var m=u<d;if(m?c[u][1]===i:l)return this;if(em(a),(l||!m)&&em(s),l&&d===2)return new Xh(t,this.keyHash,c[u^1]);var p=t&&t===this.ownerID,h=p?c:Tf(c);return m?l?u===d-1?h.pop():h[u]=h.pop():h[u]=[o,i]:h.push([o,i]),p?(this.entries=h,this):new Lx(t,this.keyHash,h)};var Xh=function(t,r,n){this.ownerID=t,this.keyHash=r,this.entry=n};Xh.prototype.get=function(t,r,n,o){return bd(n,this.entry[0])?this.entry[1]:o};Xh.prototype.update=function(t,r,n,o,i,s,a){var l=i===Io,c=bd(o,this.entry[0]);if(c?i===this.entry[1]:l)return this;if(em(a),l){em(s);return}return c?t&&t===this.ownerID?(this.entry[1]=i,this):new Xh(t,this.keyHash,[o,i]):(em(s),l4(this,t,r,yd(o),[o,i]))};YA.prototype.iterate=Lx.prototype.iterate=function(e,t){for(var r=this.entries,n=0,o=r.length-1;n<=o;n++)if(e(r[t?o-n:n])===!1)return!1};Bx.prototype.iterate=QA.prototype.iterate=function(e,t){for(var r=this.nodes,n=0,o=r.length-1;n<=o;n++){var i=r[t?o-n:n];if(i&&i.iterate(e,t)===!1)return!1}};Xh.prototype.iterate=function(e,t){return e(this.entry)};var MEe=function(e){function t(r,n,o){this._type=n,this._reverse=o,this._stack=r._root&&mZ(r._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var n=this._type,o=this._stack;o;){var i=o.node,s=o.index++,a=void 0;if(i.entry){if(s===0)return TO(n,i.entry)}else if(i.entries){if(a=i.entries.length-1,s<=a)return TO(n,i.entries[this._reverse?a-s:s])}else if(a=i.nodes.length-1,s<=a){var l=i.nodes[this._reverse?a-s:s];if(l){if(l.entry)return TO(n,l.entry);o=this._stack=mZ(l,o)}continue}o=this._stack=this._stack.__prev}return Eu()},t}(ri);function TO(e,t){return ys(e,t[0],t[1])}function mZ(e,t){return{node:e,index:0,__prev:t}}function s4(e,t,r,n){var o=Object.create(es);return o.size=e,o._root=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var pZ;function Sp(){return pZ||(pZ=s4(0))}function fZ(e,t,r){var n,o;if(e._root){var i=DO(),s=DO();if(n=a4(e._root,e.__ownerID,0,void 0,t,r,i,s),!s.value)return e;o=e.size+(i.value?r===Io?-1:1:0)}else{if(r===Io)return e;o=1,n=new YA(e.__ownerID,[[t,r]])}return e.__ownerID?(e.size=o,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?s4(o,n):Sp()}function a4(e,t,r,n,o,i,s,a){return e?e.update(t,r,n,o,i,s,a):i===Io?e:(em(a),em(s),new Xh(t,n,[o,i]))}function hZ(e){return e.constructor===Xh||e.constructor===Lx}function l4(e,t,r,n,o){if(e.keyHash===n)return new Lx(t,n,[e.entry,o]);var i=(r===0?e.keyHash:e.keyHash>>>r)&Jc,s=(r===0?n:n>>>r)&Jc,a,l=i===s?[l4(e,t,r+Ji,n,o)]:(a=new Xh(t,n,o),i<s?[e,a]:[a,e]);return new Bx(t,1<<i|1<<s,l)}function REe(e,t,r,n){e||(e=new VO);for(var o=new Xh(e,yd(r),[r,n]),i=0;i<t.length;i++){var s=t[i];o=o.update(e,0,void 0,s[0],s[1])}return o}function BEe(e,t,r,n){for(var o=0,i=0,s=new Array(r),a=0,l=1,c=t.length;a<c;a++,l<<=1){var u=t[a];u!==void 0&&a!==n&&(o|=l,s[i++]=u)}return new Bx(e,o,s)}function LEe(e,t,r,n,o){for(var i=0,s=new Array(Jd),a=0;r!==0;a++,r>>>=1)s[a]=r&1?t[i++]:void 0;return s[n]=o,new QA(e,i+1,s)}function aK(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),e=e+(e>>4)&252645135,e+=e>>8,e+=e>>16,e&127}function lK(e,t,r,n){var o=n?e:Tf(e);return o[t]=r,o}function NEe(e,t,r,n){var o=e.length+1;if(n&&t+1===o)return e[t]=r,e;for(var i=new Array(o),s=0,a=0;a<o;a++)a===t?(i[a]=r,s=-1):i[a]=e[a+s];return i}function FEe(e,t,r){var n=e.length-1;if(r&&t===n)return e.pop(),e;for(var o=new Array(n),i=0,s=0;s<n;s++)s===t&&(i=1),o[s]=e[s+i];return o}var OEe=Jd/4,VEe=Jd/2,GEe=Jd/4,cK="@@__IMMUTABLE_LIST__@@";function uK(e){return!!(e&&e[cK])}var Df=function(e){function t(r){var n=YE();if(r==null)return n;if(uK(r))return r;var o=e(r),i=o.size;return i===0?n:(vd(i),i>0&&i<Jd?JA(0,i,Ji,null,new x0(o.toArray())):n.withMutations(function(s){s.setSize(i),o.forEach(function(a,l){return s.set(l,a)})}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(n,o){if(n=C0(this,n),n>=0&&n<this.size){n+=this._origin;var i=dK(this,n);return i&&i.array[n&Jc]}return o},t.prototype.set=function(n,o){return UEe(this,n,o)},t.prototype.remove=function(n){return this.has(n)?n===0?this.shift():n===this.size-1?this.pop():this.splice(n,1):this},t.prototype.insert=function(n,o){return this.splice(n,0,o)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=Ji,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):YE()},t.prototype.push=function(){var n=arguments,o=this.size;return this.withMutations(function(i){b0(i,0,o+n.length);for(var s=0;s<n.length;s++)i.set(o+s,n[s])})},t.prototype.pop=function(){return b0(this,0,-1)},t.prototype.unshift=function(){var n=arguments;return this.withMutations(function(o){b0(o,-n.length);for(var i=0;i<n.length;i++)o.set(i,n[i])})},t.prototype.shift=function(){return b0(this,1)},t.prototype.concat=function(){for(var n=arguments,o=[],i=0;i<arguments.length;i++){var s=n[i],a=e(typeof s!="string"&&FZ(s)?s:[s]);a.size!==0&&o.push(a)}return o.length===0?this:this.size===0&&!this.__ownerID&&o.length===1?this.constructor(o[0]):this.withMutations(function(l){o.forEach(function(c){return c.forEach(function(u){return l.push(u)})})})},t.prototype.setSize=function(n){return b0(this,0,n)},t.prototype.map=function(n,o){var i=this;return this.withMutations(function(s){for(var a=0;a<i.size;a++)s.set(a,n.call(o,s.get(a),a,i))})},t.prototype.slice=function(n,o){var i=this.size;return eP(n,o,i)?this:b0(this,r2(n,i),tP(o,i))},t.prototype.__iterator=function(n,o){var i=o?this.size:0,s=gZ(this,o);return new ri(function(){var a=s();return a===KA?Eu():ys(n,o?--i:i++,a)})},t.prototype.__iterate=function(n,o){for(var i=o?this.size:0,s=gZ(this,o),a;(a=s())!==KA&&n(a,o?--i:i++,this)!==!1;);return i},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?JA(this._origin,this._capacity,this._level,this._root,this._tail,n,this.__hash):this.size===0?YE():(this.__ownerID=n,this.__altered=!1,this)},t}(ab);Df.isList=uK;var Ta=Df.prototype;Ta[cK]=!0;Ta[t2]=Ta.remove;Ta.merge=Ta.concat;Ta.setIn=YO;Ta.deleteIn=Ta.removeIn=QO;Ta.update=JO;Ta.updateIn=e4;Ta.mergeIn=n4;Ta.mergeDeepIn=o4;Ta.withMutations=o2;Ta.wasAltered=i4;Ta.asImmutable=s2;Ta["@@transducer/init"]=Ta.asMutable=i2;Ta["@@transducer/step"]=function(e,t){return e.push(t)};Ta["@@transducer/result"]=function(e){return e.asImmutable()};var x0=function(t,r){this.array=t,this.ownerID=r};x0.prototype.removeBefore=function(t,r,n){if(n===r?1<<r:this.array.length===0)return this;var o=n>>>r&Jc;if(o>=this.array.length)return new x0([],t);var i=o===0,s;if(r>0){var a=this.array[o];if(s=a&&a.removeBefore(t,r-Ji,n),s===a&&i)return this}if(i&&!s)return this;var l=Nx(this,t);if(!i)for(var c=0;c<o;c++)l.array[c]=void 0;return s&&(l.array[o]=s),l};x0.prototype.removeAfter=function(t,r,n){if(n===(r?1<<r:0)||this.array.length===0)return this;var o=n-1>>>r&Jc;if(o>=this.array.length)return this;var i;if(r>0){var s=this.array[o];if(i=s&&s.removeAfter(t,r-Ji,n),i===s&&o===this.array.length-1)return this}var a=Nx(this,t);return a.array.splice(o+1),i&&(a.array[o]=i),a};var KA={};function gZ(e,t){var r=e._origin,n=e._capacity,o=e2(n),i=e._tail;return s(e._root,e._level,0);function s(c,u,d){return u===0?a(c,d):l(c,u,d)}function a(c,u){var d=u===o?i&&i.array:c&&c.array,m=u>r?0:r-u,p=n-u;return p>Jd&&(p=Jd),function(){if(m===p)return KA;var h=t?--p:m++;return d&&d[h]}}function l(c,u,d){var m,p=c&&c.array,h=d>r?0:r-d>>u,f=(n-d>>u)+1;return f>Jd&&(f=Jd),function(){for(;;){if(m){var C=m();if(C!==KA)return C;m=null}if(h===f)return KA;var g=t?--f:h++;m=s(p&&p[g],u-Ji,d+(g<<u))}}}}function JA(e,t,r,n,o,i,s){var a=Object.create(Ta);return a.size=t-e,a._origin=e,a._capacity=t,a._level=r,a._root=n,a._tail=o,a.__ownerID=i,a.__hash=s,a.__altered=!1,a}var yZ;function YE(){return yZ||(yZ=JA(0,0,Ji))}function UEe(e,t,r){if(t=C0(e,t),t!==t)return e;if(t>=e.size||t<0)return e.withMutations(function(s){t<0?b0(s,t).set(0,r):b0(s,0,t+1).set(t,r)});t+=e._origin;var n=e._tail,o=e._root,i=DO();return t>=e2(e._capacity)?n=NO(n,e.__ownerID,0,t,r,i):o=NO(o,e.__ownerID,e._level,t,r,i),i.value?e.__ownerID?(e._root=o,e._tail=n,e.__hash=void 0,e.__altered=!0,e):JA(e._origin,e._capacity,e._level,o,n):e}function NO(e,t,r,n,o,i){var s=n>>>r&Jc,a=e&&s<e.array.length;if(!a&&o===void 0)return e;var l;if(r>0){var c=e&&e.array[s],u=NO(c,t,r-Ji,n,o,i);return u===c?e:(l=Nx(e,t),l.array[s]=u,l)}return a&&e.array[s]===o?e:(i&&em(i),l=Nx(e,t),o===void 0&&s===l.array.length-1?l.array.pop():l.array[s]=o,l)}function Nx(e,t){return t&&e&&t===e.ownerID?e:new x0(e?e.array.slice():[],t)}function dK(e,t){if(t>=e2(e._capacity))return e._tail;if(t<1<<e._level+Ji){for(var r=e._root,n=e._level;r&&n>0;)r=r.array[t>>>n&Jc],n-=Ji;return r}}function b0(e,t,r){t!==void 0&&(t|=0),r!==void 0&&(r|=0);var n=e.__ownerID||new VO,o=e._origin,i=e._capacity,s=o+t,a=r===void 0?i:r<0?i+r:o+r;if(s===o&&a===i)return e;if(s>=a)return e.clear();for(var l=e._level,c=e._root,u=0;s+u<0;)c=new x0(c&&c.array.length?[void 0,c]:[],n),l+=Ji,u+=1<<l;u&&(s+=u,o+=u,a+=u,i+=u);for(var d=e2(i),m=e2(a);m>=1<<l+Ji;)c=new x0(c&&c.array.length?[c]:[],n),l+=Ji;var p=e._tail,h=m<d?dK(e,a-1):m>d?new x0([],n):p;if(p&&m>d&&s<i&&p.array.length){c=Nx(c,n);for(var f=c,C=l;C>Ji;C-=Ji){var g=d>>>C&Jc;f=f.array[g]=Nx(f.array[g],n)}f.array[d>>>Ji&Jc]=p}if(a<i&&(h=h&&h.removeAfter(n,0,a)),s>=m)s-=m,a-=m,l=Ji,c=null,h=h&&h.removeBefore(n,0,s);else if(s>o||m<d){for(u=0;c;){var b=s>>>l&Jc;if(b!==m>>>l&Jc)break;b&&(u+=(1<<l)*b),l-=Ji,c=c.array[b]}c&&s>o&&(c=c.removeBefore(n,l,s-u)),c&&m<d&&(c=c.removeAfter(n,l,m-u)),u&&(s-=u,a-=u)}return e.__ownerID?(e.size=a-s,e._origin=s,e._capacity=a,e._level=l,e._root=c,e._tail=h,e.__hash=void 0,e.__altered=!0,e):JA(s,a,l,c,h)}function e2(e){return e<Jd?0:e-1>>>Ji<<Ji}var Ea=function(e){function t(r){return r==null?WA():UZ(r)?r:WA().withMutations(function(n){var o=rm(r);vd(o.size),o.forEach(function(i,s){return n.set(s,i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(n,o){var i=this._map.get(n);return i!==void 0?this._list.get(i)[1]:o},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):WA()},t.prototype.set=function(n,o){return bZ(this,n,o)},t.prototype.remove=function(n){return bZ(this,n,Io)},t.prototype.__iterate=function(n,o){var i=this;return this._list.__iterate(function(s){return s&&n(s[1],s[0],i)},o)},t.prototype.__iterator=function(n,o){return this._list.fromEntrySeq().__iterator(n,o)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var o=this._map.__ensureOwner(n),i=this._list.__ensureOwner(n);return n?c4(o,i,n,this.__hash):this.size===0?WA():(this.__ownerID=n,this.__altered=!1,this._map=o,this._list=i,this)},t}(Sd);Ea.isOrderedMap=UZ;Ea.prototype[Ux]=!0;Ea.prototype[t2]=Ea.prototype.remove;function c4(e,t,r,n){var o=Object.create(Ea.prototype);return o.size=e?e.size:0,o._map=e,o._list=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var vZ;function WA(){return vZ||(vZ=c4(Sp(),YE()))}function bZ(e,t,r){var n=e._map,o=e._list,i=n.get(t),s=i!==void 0,a,l;if(r===Io){if(!s)return e;o.size>=Jd&&o.size>=n.size*2?(l=o.filter(function(c,u){return c!==void 0&&i!==u}),a=l.toKeyedSeq().map(function(c){return c[0]}).flip().toMap(),e.__ownerID&&(a.__ownerID=l.__ownerID=e.__ownerID)):(a=n.remove(t),l=i===o.size-1?o.pop():o.set(i,void 0))}else if(s){if(r===o.get(i)[1])return e;a=n,l=o.set(i,[t,r])}else a=n.set(t,o.size),l=o.set(o.size,[t,r]);return e.__ownerID?(e.size=a.size,e._map=a,e._list=l,e.__hash=void 0,e.__altered=!0,e):c4(a,l)}var mK="@@__IMMUTABLE_STACK__@@";function FO(e){return!!(e&&e[mK])}var u4=function(e){function t(r){return r==null?KE():FO(r)?r:KE().pushAll(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(n,o){var i=this._head;for(n=C0(this,n);i&&n--;)i=i.next;return i?i.value:o},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var n=arguments;if(arguments.length===0)return this;for(var o=this.size+arguments.length,i=this._head,s=arguments.length-1;s>=0;s--)i={value:n[s],next:i};return this.__ownerID?(this.size=o,this._head=i,this.__hash=void 0,this.__altered=!0,this):qA(o,i)},t.prototype.pushAll=function(n){if(n=e(n),n.size===0)return this;if(this.size===0&&FO(n))return n;vd(n.size);var o=this.size,i=this._head;return n.__iterate(function(s){o++,i={value:s,next:i}},!0),this.__ownerID?(this.size=o,this._head=i,this.__hash=void 0,this.__altered=!0,this):qA(o,i)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return this.size===0?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):KE()},t.prototype.slice=function(n,o){if(eP(n,o,this.size))return this;var i=r2(n,this.size),s=tP(o,this.size);if(s!==this.size)return e.prototype.slice.call(this,n,o);for(var a=this.size-i,l=this._head;i--;)l=l.next;return this.__ownerID?(this.size=a,this._head=l,this.__hash=void 0,this.__altered=!0,this):qA(a,l)},t.prototype.__ensureOwner=function(n){return n===this.__ownerID?this:n?qA(this.size,this._head,n,this.__hash):this.size===0?KE():(this.__ownerID=n,this.__altered=!1,this)},t.prototype.__iterate=function(n,o){var i=this;if(o)return new sb(this.toArray()).__iterate(function(l,c){return n(l,c,i)},o);for(var s=0,a=this._head;a&&n(a.value,s++,this)!==!1;)a=a.next;return s},t.prototype.__iterator=function(n,o){if(o)return new sb(this.toArray()).__iterator(n,o);var i=0,s=this._head;return new ri(function(){if(s){var a=s.value;return s=s.next,ys(n,i++,a)}return Eu()})},t}(ab);u4.isStack=FO;var eu=u4.prototype;eu[mK]=!0;eu.shift=eu.pop;eu.unshift=eu.push;eu.unshiftAll=eu.pushAll;eu.withMutations=o2;eu.wasAltered=i4;eu.asImmutable=s2;eu["@@transducer/init"]=eu.asMutable=i2;eu["@@transducer/step"]=function(e,t){return e.unshift(t)};eu["@@transducer/result"]=function(e){return e.asImmutable()};function qA(e,t,r,n){var o=Object.create(eu);return o.size=e,o._head=t,o.__ownerID=r,o.__hash=n,o.__altered=!1,o}var xZ;function KE(){return xZ||(xZ=qA(0))}var pK="@@__IMMUTABLE_SET__@@";function d4(e){return!!(e&&e[pK])}function fK(e){return d4(e)&&Ip(e)}function hK(e,t){if(e===t)return!0;if(!Tu(t)||e.size!==void 0&&t.size!==void 0&&e.size!==t.size||e.__hash!==void 0&&t.__hash!==void 0&&e.__hash!==t.__hash||gs(e)!==gs(t)||_u(e)!==_u(t)||Ip(e)!==Ip(t))return!1;if(e.size===0&&t.size===0)return!0;var r=!rP(e);if(Ip(e)){var n=e.entries();return t.every(function(l,c){var u=n.next().value;return u&&bd(u[1],l)&&(r||bd(u[0],c))})&&n.next().done}var o=!1;if(e.size===void 0)if(t.size===void 0)typeof e.cacheResult=="function"&&e.cacheResult();else{o=!0;var i=e;e=t,t=i}var s=!0,a=t.__iterate(function(l,c){if(r?!e.has(l):o?!bd(l,e.get(c,Io)):!bd(e.get(c,Io),l))return s=!1,!1});return s&&e.size===a}function lb(e,t){var r=function(n){e.prototype[n]=t[n]};return Object.keys(t).forEach(r),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(r),e}function JE(e){if(!e||typeof e!="object")return e;if(!Tu(e)){if(!S0(e))return e;e=xd(e)}if(gs(e)){var t={};return e.__iterate(function(n,o){t[o]=JE(n)}),t}var r=[];return e.__iterate(function(n){r.push(JE(n))}),r}var aP=function(e){function t(r){return r==null?ZA():d4(r)&&!Ip(r)?r:ZA().withMutations(function(n){var o=e(r);vd(o.size),o.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(rm(n).keySeq())},t.intersect=function(n){return n=pa(n).toArray(),n.length?Ql.intersect.apply(t(n.pop()),n):ZA()},t.union=function(n){return n=pa(n).toArray(),n.length?Ql.union.apply(t(n.pop()),n):ZA()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(n){return this._map.has(n)},t.prototype.add=function(n){return XE(this,this._map.set(n,n))},t.prototype.remove=function(n){return XE(this,this._map.remove(n))},t.prototype.clear=function(){return XE(this,this._map.clear())},t.prototype.map=function(n,o){var i=this,s=!1,a=XE(this,this._map.mapEntries(function(l){var c=l[1],u=n.call(o,c,c,i);return u!==c&&(s=!0),[u,u]},o));return s?a:this},t.prototype.union=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];return n=n.filter(function(i){return i.size!==0}),n.length===0?this:this.size===0&&!this.__ownerID&&n.length===1?this.constructor(n[0]):this.withMutations(function(i){for(var s=0;s<n.length;s++)typeof n[s]=="string"?i.add(n[s]):e(n[s]).forEach(function(a){return i.add(a)})})},t.prototype.intersect=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];if(n.length===0)return this;n=n.map(function(s){return e(s)});var i=[];return this.forEach(function(s){n.every(function(a){return a.includes(s)})||i.push(s)}),this.withMutations(function(s){i.forEach(function(a){s.remove(a)})})},t.prototype.subtract=function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];if(n.length===0)return this;n=n.map(function(s){return e(s)});var i=[];return this.forEach(function(s){n.some(function(a){return a.includes(s)})&&i.push(s)}),this.withMutations(function(s){i.forEach(function(a){s.remove(a)})})},t.prototype.sort=function(n){return Cd(Rx(this,n))},t.prototype.sortBy=function(n,o){return Cd(Rx(this,o,n))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(n,o){var i=this;return this._map.__iterate(function(s){return n(s,s,i)},o)},t.prototype.__iterator=function(n,o){return this._map.__iterator(n,o)},t.prototype.__ensureOwner=function(n){if(n===this.__ownerID)return this;var o=this._map.__ensureOwner(n);return n?this.__make(o,n):this.size===0?this.__empty():(this.__ownerID=n,this._map=o,this)},t}(Vx);aP.isSet=d4;var Ql=aP.prototype;Ql[pK]=!0;Ql[t2]=Ql.remove;Ql.merge=Ql.concat=Ql.union;Ql.withMutations=o2;Ql.asImmutable=s2;Ql["@@transducer/init"]=Ql.asMutable=i2;Ql["@@transducer/step"]=function(e,t){return e.add(t)};Ql["@@transducer/result"]=function(e){return e.asImmutable()};Ql.__empty=ZA;Ql.__make=gK;function XE(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:t.size===0?e.__empty():e.__make(t)}function gK(e,t){var r=Object.create(Ql);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var CZ;function ZA(){return CZ||(CZ=gK(Sp()))}var zEe=function(e){function t(r,n,o){if(!(this instanceof t))return new t(r,n,o);if(XO(o!==0,"Cannot step a Range by 0"),r=r||0,n===void 0&&(n=1/0),o=o===void 0?1:Math.abs(o),n<r&&(o=-o),this._start=r,this._end=n,this._step=o,this.size=Math.max(0,Math.ceil((n-r)/o-1)+1),this.size===0){if(EO)return EO;EO=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.size===0?"Range []":"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"},t.prototype.get=function(n,o){return this.has(n)?this._start+C0(this,n)*this._step:o},t.prototype.includes=function(n){var o=(n-this._start)/this._step;return o>=0&&o<this.size&&o===Math.floor(o)},t.prototype.slice=function(n,o){return eP(n,o,this.size)?this:(n=r2(n,this.size),o=tP(o,this.size),o<=n?new t(0,0):new t(this.get(n,this._end),this.get(o,this._end),this._step))},t.prototype.indexOf=function(n){var o=n-this._start;if(o%this._step===0){var i=o/this._step;if(i>=0&&i<this.size)return i}return-1},t.prototype.lastIndexOf=function(n){return this.indexOf(n)},t.prototype.__iterate=function(n,o){for(var i=this.size,s=this._step,a=o?this._start+(i-1)*s:this._start,l=0;l!==i&&n(a,o?i-++l:l++,this)!==!1;)a+=o?-s:s;return l},t.prototype.__iterator=function(n,o){var i=this.size,s=this._step,a=o?this._start+(i-1)*s:this._start,l=0;return new ri(function(){if(l===i)return Eu();var c=a;return a+=o?-s:s,ys(n,o?i-++l:l++,c)})},t.prototype.equals=function(n){return n instanceof t?this._start===n._start&&this._end===n._end&&this._step===n._step:hK(this,n)},t}(wp),EO;function yK(e,t,r){for(var n=QZ(t),o=0;o!==n.length;)if(e=JZ(e,n[o++],Io),e===Io)return r;return e}function vK(e,t){return yK(this,e,t)}function HEe(e,t){return yK(e,t,Io)!==Io}function jEe(e){return HEe(this,e)}function bK(){vd(this.size);var e={};return this.__iterate(function(t,r){e[r]=t}),e}pa.isIterable=Tu;pa.isKeyed=gs;pa.isIndexed=_u;pa.isAssociative=rP;pa.isOrdered=Ip;pa.Iterator=ri;lb(pa,{toArray:function(){vd(this.size);var t=new Array(this.size||0),r=gs(this),n=0;return this.__iterate(function(o,i){t[n++]=r?[i,o]:o}),t},toIndexedSeq:function(){return new HZ(this)},toJS:function(){return JE(this)},toKeyedSeq:function(){return new sP(this,!0)},toMap:function(){return Sd(this.toKeyedSeq())},toObject:bK,toOrderedMap:function(){return Ea(this.toKeyedSeq())},toOrderedSet:function(){return Cd(gs(this)?this.valueSeq():this)},toSet:function(){return aP(gs(this)?this.valueSeq():this)},toSetSeq:function(){return new jZ(this)},toSeq:function(){return _u(this)?this.toIndexedSeq():gs(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return u4(gs(this)?this.valueSeq():this)},toList:function(){return Df(gs(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,r){return this.size===0?t+r:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+r},concat:function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return Li(this,xEe(this,t))},includes:function(t){return this.some(function(r){return bd(r,t)})},entries:function(){return this.__iterator(tm)},every:function(t,r){vd(this.size);var n=!0;return this.__iterate(function(o,i,s){if(!t.call(r,o,i,s))return n=!1,!1}),n},filter:function(t,r){return Li(this,ZZ(this,t,r,!0))},partition:function(t,r){return vEe(this,t,r)},find:function(t,r,n){var o=this.findEntry(t,r);return o?o[1]:n},forEach:function(t,r){return vd(this.size),this.__iterate(r?t.bind(r):t)},join:function(t){vd(this.size),t=t!==void 0?""+t:",";var r="",n=!0;return this.__iterate(function(o){n?n=!1:r+=t,r+=o!=null?o.toString():""}),r},keys:function(){return this.__iterator(n2)},map:function(t,r){return Li(this,qZ(this,t,r))},reduce:function(t,r,n){return SZ(this,t,r,n,arguments.length<2,!1)},reduceRight:function(t,r,n){return SZ(this,t,r,n,arguments.length<2,!0)},reverse:function(){return Li(this,WO(this,!0))},slice:function(t,r){return Li(this,qO(this,t,r,!0))},some:function(t,r){vd(this.size);var n=!1;return this.__iterate(function(o,i,s){if(t.call(r,o,i,s))return n=!0,!1}),n},sort:function(t){return Li(this,Rx(this,t))},values:function(){return this.__iterator(Ap)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==void 0?this.size===0:!this.some(function(){return!0})},count:function(t,r){return Mx(t?this.toSeq().filter(t,r):this)},countBy:function(t,r){return gEe(this,t,r)},equals:function(t){return hK(this,t)},entrySeq:function(){var t=this;if(t._cache)return new sb(t._cache);var r=t.toSeq().map(WEe).toIndexedSeq();return r.fromEntrySeq=function(){return t.toSeq()},r},filterNot:function(t,r){return this.filter(PO(t),r)},findEntry:function(t,r,n){var o=n;return this.__iterate(function(i,s,a){if(t.call(r,i,s,a))return o=[s,i],!1}),o},findKey:function(t,r){var n=this.findEntry(t,r);return n&&n[0]},findLast:function(t,r,n){return this.toKeyedSeq().reverse().find(t,r,n)},findLastEntry:function(t,r,n){return this.toKeyedSeq().reverse().findEntry(t,r,n)},findLastKey:function(t,r){return this.toKeyedSeq().reverse().findKey(t,r)},first:function(t){return this.find(EZ,null,t)},flatMap:function(t,r){return Li(this,CEe(this,t,r))},flatten:function(t){return Li(this,XZ(this,t,!0))},fromEntrySeq:function(){return new $Z(this)},get:function(t,r){return this.find(function(n,o){return bd(o,t)},void 0,r)},getIn:vK,groupBy:function(t,r){return yEe(this,t,r)},has:function(t){return this.get(t,Io)!==Io},hasIn:jEe,isSubset:function(t){return t=typeof t.includes=="function"?t:pa(t),this.every(function(r){return t.includes(r)})},isSuperset:function(t){return t=typeof t.isSubset=="function"?t:pa(t),t.isSubset(this)},keyOf:function(t){return this.findKey(function(r){return bd(r,t)})},keySeq:function(){return this.toSeq().map($Ee).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return qE(this,t)},maxBy:function(t,r){return qE(this,r,t)},min:function(t){return qE(this,t?IZ(t):wZ)},minBy:function(t,r){return qE(this,r?IZ(r):wZ,t)},rest:function(){return this.slice(1)},skip:function(t){return t===0?this:this.slice(Math.max(0,t))},skipLast:function(t){return t===0?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,r){return Li(this,KZ(this,t,r,!0))},skipUntil:function(t,r){return this.skipWhile(PO(t),r)},sortBy:function(t,r){return Li(this,Rx(this,r,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,r){return Li(this,bEe(this,t,r))},takeUntil:function(t,r){return this.takeWhile(PO(t),r)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=qEe(this))}});var xc=pa.prototype;xc[kZ]=!0;xc[nP]=xc.values;xc.toJSON=xc.toArray;xc.__toStringMapper=XA;xc.inspect=xc.toSource=function(){return this.toString()};xc.chain=xc.flatMap;xc.contains=xc.includes;lb(rm,{flip:function(){return Li(this,WZ(this))},mapEntries:function(t,r){var n=this,o=0;return Li(this,this.toSeq().map(function(i,s){return t.call(r,[s,i],o++,n)}).fromEntrySeq())},mapKeys:function(t,r){var n=this;return Li(this,this.toSeq().flip().map(function(o,i){return t.call(r,o,i,n)}).flip())}});var a2=rm.prototype;a2[MZ]=!0;a2[nP]=xc.entries;a2.toJSON=bK;a2.__toStringMapper=function(e,t){return XA(t)+": "+XA(e)};lb(ab,{toKeyedSeq:function(){return new sP(this,!1)},filter:function(t,r){return Li(this,ZZ(this,t,r,!1))},findIndex:function(t,r){var n=this.findEntry(t,r);return n?n[0]:-1},indexOf:function(t){var r=this.keyOf(t);return r===void 0?-1:r},lastIndexOf:function(t){var r=this.lastKeyOf(t);return r===void 0?-1:r},reverse:function(){return Li(this,WO(this,!1))},slice:function(t,r){return Li(this,qO(this,t,r,!1))},splice:function(t,r){var n=arguments.length;if(r=Math.max(r||0,0),n===0||n===2&&!r)return this;t=r2(t,t<0?this.count():this.size);var o=this.slice(0,t);return Li(this,n===1?o:o.concat(Tf(arguments,2),this.slice(t+r)))},findLastIndex:function(t,r){var n=this.findLastEntry(t,r);return n?n[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return Li(this,XZ(this,t,!1))},get:function(t,r){return t=C0(this,t),t<0||this.size===1/0||this.size!==void 0&&t>this.size?r:this.find(function(n,o){return o===t},void 0,r)},has:function(t){return t=C0(this,t),t>=0&&(this.size!==void 0?this.size===1/0||t<this.size:this.indexOf(t)!==-1)},interpose:function(t){return Li(this,SEe(this,t))},interleave:function(){var t=[this].concat(Tf(arguments)),r=ZE(this.toSeq(),wp.of,t),n=r.flatten(!0);return r.size&&(n.size=r.size*t.length),Li(this,n)},keySeq:function(){return zEe(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,r){return Li(this,KZ(this,t,r,!1))},zip:function(){var t=[this].concat(Tf(arguments));return Li(this,ZE(this,AZ,t))},zipAll:function(){var t=[this].concat(Tf(arguments));return Li(this,ZE(this,AZ,t,!0))},zipWith:function(t){var r=Tf(arguments);return r[0]=this,Li(this,ZE(this,t,r))}});var $x=ab.prototype;$x[RZ]=!0;$x[Ux]=!0;lb(Vx,{get:function(t,r){return this.has(t)?t:r},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var Fx=Vx.prototype;Fx.has=xc.includes;Fx.contains=Fx.includes;Fx.keys=Fx.values;lb(I0,a2);lb(wp,$x);lb(Hx,Fx);function SZ(e,t,r,n,o,i){return vd(e.size),e.__iterate(function(s,a,l){o?(o=!1,r=s):r=t.call(n,r,s,a,l)},i),r}function $Ee(e,t){return t}function WEe(e,t){return[t,e]}function PO(e){return function(){return!e.apply(this,arguments)}}function IZ(e){return function(){return-e.apply(this,arguments)}}function AZ(){return Tf(arguments)}function wZ(e,t){return e<t?1:e>t?-1:0}function qEe(e){if(e.size===1/0)return 0;var t=Ip(e),r=gs(e),n=t?1:0,o=e.__iterate(r?t?function(i,s){n=31*n+_Z(yd(i),yd(s))|0}:function(i,s){n=n+_Z(yd(i),yd(s))|0}:t?function(i){n=31*n+yd(i)|0}:function(i){n=n+yd(i)|0});return ZEe(o,n)}function ZEe(e,t){return t=$A(t,3432918353),t=$A(t<<15|t>>>-15,461845907),t=$A(t<<13|t>>>-13,5),t=(t+3864292196|0)^e,t=$A(t^t>>>16,2246822507),t=$A(t^t>>>13,3266489909),t=iP(t^t>>>16),t}function _Z(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}var Cd=function(e){function t(r){return r==null?OO():fK(r)?r:OO().withMutations(function(n){var o=Vx(r);vd(o.size),o.forEach(function(i){return n.add(i)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(n){return this(rm(n).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(aP);Cd.isOrderedSet=fK;var cb=Cd.prototype;cb[Ux]=!0;cb.zip=$x.zip;cb.zipWith=$x.zipWith;cb.zipAll=$x.zipAll;cb.__empty=OO;cb.__make=xK;function xK(e,t){var r=Object.create(cb);return r.size=e?e.size:0,r._map=e,r.__ownerID=t,r}var TZ;function OO(){return TZ||(TZ=xK(WA()))}function KEe(e){if(Gx(e))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(Ef(e))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(e===null||typeof e!="object")throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}var dl=function(t,r){var n;KEe(t);var o=function(a){var l=this;if(a instanceof o)return a;if(!(this instanceof o))return new o(a);if(!n){n=!0;var c=Object.keys(t),u=i._indices={};i._name=r,i._keys=c,i._defaultValues=t;for(var d=0;d<c.length;d++){var m=c[d];u[m]=d,i[m]||XEe(i,m)}}return this.__ownerID=void 0,this._values=Df().withMutations(function(p){p.setSize(l._keys.length),rm(a).forEach(function(h,f){p.set(l._indices[f],h===l._defaultValues[f]?void 0:h)})}),this},i=o.prototype=Object.create(ji);return i.constructor=o,r&&(o.displayName=r),o};dl.prototype.toString=function(){for(var t=CK(this)+" { ",r=this._keys,n,o=0,i=r.length;o!==i;o++)n=r[o],t+=(o?", ":"")+n+": "+XA(this.get(n));return t+" }"};dl.prototype.equals=function(t){return this===t||Gx(t)&&Ox(this).equals(Ox(t))};dl.prototype.hashCode=function(){return Ox(this).hashCode()};dl.prototype.has=function(t){return this._indices.hasOwnProperty(t)};dl.prototype.get=function(t,r){if(!this.has(t))return r;var n=this._indices[t],o=this._values.get(n);return o===void 0?this._defaultValues[t]:o};dl.prototype.set=function(t,r){if(this.has(t)){var n=this._values.set(this._indices[t],r===this._defaultValues[t]?void 0:r);if(n!==this._values&&!this.__ownerID)return m4(this,n)}return this};dl.prototype.remove=function(t){return this.set(t)};dl.prototype.clear=function(){var t=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:m4(this,t)};dl.prototype.wasAltered=function(){return this._values.wasAltered()};dl.prototype.toSeq=function(){return Ox(this)};dl.prototype.toJS=function(){return JE(this)};dl.prototype.entries=function(){return this.__iterator(tm)};dl.prototype.__iterator=function(t,r){return Ox(this).__iterator(t,r)};dl.prototype.__iterate=function(t,r){return Ox(this).__iterate(t,r)};dl.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var r=this._values.__ensureOwner(t);return t?m4(this,r,t):(this.__ownerID=t,this._values=r,this)};dl.isRecord=Gx;dl.getDescriptiveName=CK;var ji=dl.prototype;ji[LZ]=!0;ji[t2]=ji.remove;ji.deleteIn=ji.removeIn=QO;ji.getIn=vK;ji.hasIn=xc.hasIn;ji.merge=rK;ji.mergeWith=nK;ji.mergeIn=n4;ji.mergeDeep=iK;ji.mergeDeepWith=sK;ji.mergeDeepIn=o4;ji.setIn=YO;ji.update=JO;ji.updateIn=e4;ji.withMutations=o2;ji.asMutable=i2;ji.asImmutable=s2;ji[nP]=ji.entries;ji.toJSON=ji.toObject=xc.toObject;ji.inspect=ji.toSource=function(){return this.toString()};function m4(e,t,r){var n=Object.create(Object.getPrototypeOf(e));return n._values=t,n.__ownerID=r,n}function CK(e){return e.constructor.displayName||e.constructor.name||"Record"}function Ox(e){return HO(e._keys.map(function(t){return[t,e.get(t)]}))}function XEe(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(r){XO(this.__ownerID,"Cannot set on an immutable record."),this.set(t,r)}})}catch{}}var lP=Object.prototype.hasOwnProperty;function SK(e,t){for(let r of Object.keys(t))lP.call(t,r)&&typeof e[r]>"u"&&(e[r]=t[r]);return e}function YEe(e,t){let r=!1;for(let n of Object.keys(t))if(lP.call(t,n)&&t[n]!==e[n]){r=!0;break}return r?Object.assign({},e,t):e}function A0(e,t){if(!e)return!t;if(!t)return!1;let r=Object.keys(e);if(Object.keys(t).length!==r.length)return!1;for(let n of r)if(!lP.call(e,n)||e[n]!==t[n])return!1;return!0}function IK(e,t){let r=e;for(let n=0;n<t.length;n++)if(t[n]&&(r=YEe(e,t[n]),r!==e)){for(let o=n+1;o<t.length;o++)r=Object.assign(r,t[o]);break}return r}function Xa(e){if(e===null||typeof e!="object")return e;if(e instanceof Array){let t=[];for(let r=0,n=e.length;r<n;r++)t[r]=Xa(e[r]);return t}if(typeof e=="object"&&!("prototype"in e)){let t={};for(let r in e)lP.call(e,r)&&(t[r]=Xa(e[r]));return t}throw new Error(`Can't clone, type "${typeof e}" unsupported`)}function Ao(e,t){if(e)for(let r of Object.keys(e))t(e[r],r)}function AK(e,t=" "){return e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,`$1${t}$2`)}function Pa(e){return nm(AK(e))}var QEe=e=>e.toUpperCase();function wK(e){return e?typeof e=="string"?e.toUpperCase():`${e}`.toUpperCase():""}function nm(e){return e.toLowerCase().replace(/^\w|\s\w/g,QEe)}function JEe(e){return e.replace(/_/g," ")}function ePe(e){return e.replace(/-/g," ")}function Ms(e){return nm(AK(JEe(ePe(e))))}function ts(e,t,r,n){let o=n.length;if(o>r-t)return!1;for(let i=0;i<o;i++)if(e.charCodeAt(t+i)!==n.charCodeAt(i))return!1;return!0}function _K(e,t){let r=Object.keys(t),n=Object.values(t);return new Function(...r,`return \`${e}\`;`)(...n)}function _p(e){return e.replace(/<\/?[^>]+>/g,"")}function Yh(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function vs(){return vs.zero()}(function(e){function t(){let S=[.1,0,0];return S[0]=0,S}e.zero=t;function r(S,P,k){let L=t();return L[0]=S,L[1]=P,L[2]=k,L}e.create=r;function n(S,P,k,L){return S[0]=P,S[1]=k,S[2]=L,S}e.set=n;function o(S,P){let k=P[0]-S[0],L=P[1]-S[1],R=P[2]-S[2];return Math.sqrt(k*k+L*L+R*R)}e.distance=o;function i(S,P){let[k,L,R]=ze.toRgb(P),[N,F,H]=w(k,L,R),V=116*F-16;return S[0]=V<0?0:V,S[1]=500*(N-F),S[2]=200*(F-H),S}e.fromColor=i;function s(S,P){return Pu.toLab(S,P)}e.fromHcl=s;function a(S){let P=(S[0]+16)/116,k=isNaN(S[1])?P:P+S[1]/500,L=isNaN(S[2])?P:P-S[2]/200;P=g*I(P),k=C*I(k),L=b*I(L);let R=_(3.2404542*k-1.5371385*P-.4985314*L),N=_(-.969266*k+1.8760108*P+.041556*L),F=_(.0556434*k-.2040259*P+1.0572252*L);return ze.fromRgb(Math.round(ko(R,0,255)),Math.round(ko(N,0,255)),Math.round(ko(F,0,255)))}e.toColor=a;function l(S,P){let[k,L,R]=P,N=Math.sqrt(L*L+R*R),F=(ma(Math.atan2(R,L))+360)%360;return Math.round(N*1e4)===0&&(F=Number.NaN),S[0]=F,S[1]=N,S[2]=k,S}e.toHcl=l;function c(S,P){return S[0]=P[0],S[1]=P[1],S[2]=P[2],S}e.copy=c;function u(S,P,k){return S[0]=P[0]-f*k,S[1]=P[1],S[2]=P[2],S}e.darken=u;function d(S,P,k){return u(S,P,-k)}e.lighten=d;let m=[0,0,0];function p(S,P,k){return l(m,P),Pu.toLab(S,Pu.saturate(m,m,k))}e.saturate=p;function h(S,P,k){return p(S,P,-k)}e.desaturate=h;let f=18,C=.95047,g=1,b=1.08883,y=.137931034,x=.206896552,A=.12841855,v=.008856452;function _(S){return 255*(S<=.00304?12.92*S:1.055*Math.pow(S,1/2.4)-.055)}function I(S){return S>x?S*S*S:A*(S-y)}function T(S){return(S/=255)<=.04045?S/12.92:Math.pow((S+.055)/1.055,2.4)}function E(S){return S>v?Math.pow(S,1/3):S/A+y}function w(S,P,k){S=T(S),P=T(P),k=T(k);let L=E((.4124564*S+.3575761*P+.1804375*k)/C),R=E((.2126729*S+.7151522*P+.072175*k)/g),N=E((.0193339*S+.119192*P+.9503041*k)/b);return[L,R,N]}})(vs||(vs={}));function Pu(){return Pu.zero()}(function(e){function t(){let b=[.1,0,0];return b[0]=0,b}e.zero=t;function r(b,y,x){let A=t();return A[0]=b,A[1]=y,A[2]=x,A}e.create=r;function n(b,y,x,A){return b[0]=y,b[1]=x,b[2]=A,b}e.set=n;function o(b){return!isNaN(b[0])}e.hasHue=o;let i=[0,0,0];function s(b,y){return vs.toHcl(b,vs.fromColor(i,y))}e.fromColor=s;function a(b,y){return vs.toHcl(b,y)}e.fromLab=a;let l=[0,0,0];function c(b){return vs.toColor(u(l,b))}e.toColor=c;function u(b,y){let[x,A,v]=y;return isNaN(x)&&(x=0),x=Pr(x),b[0]=v,b[1]=Math.cos(x)*A,b[2]=Math.sin(x)*A,b}e.toLab=u;function d(b,y){return b[0]=y[0],b[1]=y[1],b[2]=y[2],b}e.copy=d;function m(b,y,x){return b[0]=y[0],b[1]=Math.max(0,y[1]+g*x),b[2]=y[2],b}e.saturate=m;function p(b,y,x){return m(b,y,-x)}e.desaturate=p;let h=[0,0,0];function f(b,y,x){return u(h,y),vs.toHcl(b,vs.darken(h,h,x))}e.darken=f;function C(b,y,x){return f(b,y,-x)}e.lighten=C;let g=18})(Pu||(Pu={}));function ze(e){return e}(function(e){function t(R){return`rgb(${R>>16&255}, ${R>>8&255}, ${R&255})`}e.toStyle=t;function r(R){return"#"+("000000"+R.toString(16)).slice(-6)}e.toHexStyle=r;function n(R){return"0x"+("000000"+R.toString(16)).slice(-6)}e.toHexString=n;function o(R){return`RGB: ${e.toRgb(R).join(", ")}`}e.toRgbString=o;function i(R){return[R>>16&255,R>>8&255,R&255]}e.toRgb=i;function s(R){return[(R>>16&255)/255,(R>>8&255)/255,(R&255)/255]}e.toRgbNormalized=s;function a(R){return parseInt(R.replace("#","0x"))}e.fromHexStyle=a;function l(R){return parseInt(R)}e.fromHexString=l;function c(R,N,F){return R<<16|N<<8|F}e.fromRgb=c;function u(R,N,F){return R*255<<16|N*255<<8|F*255}e.fromNormalizedRgb=u;function d(R,N){return c(R[N],R[N+1],R[N+2])}e.fromArray=d;function m(R,N){return u(R[N],R[N+1],R[N+2])}e.fromNormalizedArray=m;function p(R,N,F){return N[F]=R>>16&255,N[F+1]=R>>8&255,N[F+2]=R&255,N}e.toArray=p;function h(R,N,F){return N[F]=(R>>16&255)/255,N[F+1]=(R>>8&255)/255,N[F+2]=(R&255)/255,N}e.toArrayNormalized=h;function f(R,N){return R[0]=N>>16&255,R[1]=N>>8&255,R[2]=N&255,R}e.toVec3=f;function C(R,N){return R[0]=(N>>16&255)/255,R[1]=(N>>8&255)/255,R[2]=(N&255)/255,R}e.toVec3Normalized=C;function g(R,N,F){let H=R>>16&255,V=R>>8&255,q=R&255,Q=N>>16&255,O=N>>8&255,B=N&255,j=H+(Q-H)*F,U=V+(O-V)*F,z=q+(B-q)*F;return j<<16|U<<8|z}e.interpolate=g;function b(R){let N=R>>16&255,F=R>>8&255,H=R&255;return N!==F||N!==H}e.hasHue=b;let y=[0,0,0];function x(R,N){return b(R)?(Pu.fromColor(y,R),Pu.toColor(Pu.saturate(y,y,N))):R}e.saturate=x;function A(R,N){return x(R,-N)}e.desaturate=A;let v=[0,0,0];function _(R,N){return vs.fromColor(v,R),vs.toColor(vs.darken(v,v,N))}e.darken=_;function I(R,N){return _(R,-N)}e.lighten=I;function T(R){return R<=.03928?R/12.92:Math.pow((R+.055)/1.055,2.4)}function E(R){let N=T((R>>16&255)/255),F=T((R>>8&255)/255),H=T((R&255)/255);return .2126*N+.7152*F+.0722*H}e.luminance=E;function w(R,N){let F=E(R),H=E(N);return F>H?(F+.05)/(H+.05):(H+.05)/(F+.05)}e.contrast=w;function S(R){return R<.04045?R*.0773993808:Math.pow(R*.9478672986+.0521327014,2.4)}function P(R){return u(S((R>>16&255)/255),S((R>>8&255)/255),S((R&255)/255))}e.sRGBToLinear=P;function k(R){return R<.0031308?R*12.92:1.055*Math.pow(R,.41666)-.055}function L(R){return u(k((R>>16&255)/255),k((R>>8&255)/255),k((R&255)/255))}e.linearToSRGB=L})(ze||(ze={}));function yn(e,t,r,n){return{label:e,description:r,list:n,type:t}}function w0(e,t,r){let n={};for(let o in e){let i=e[o];i=ze.saturate(i,t),i=ze.darken(i,-r),n[o]=i}return n}var Ya={"orange-red":yn("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":yn("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":yn("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:yn("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":yn("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":yn("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":yn("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:yn("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":yn("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:yn("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":yn("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:yn("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":yn("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:yn("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":yn("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":yn("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:yn("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":yn("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:yn("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":yn("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":yn("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":yn("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":yn("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":yn("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":yn("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":yn("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":yn("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":yn("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:yn("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":yn("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":yn("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":yn("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:yn("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":yn("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":yn("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":yn("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:yn("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:yn("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:yn("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:yn("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:yn("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:yn("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:yn("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:yn("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":yn("Red-White-Blue","diverging","",[12526114,16777215,3367393])},tPe=Object.keys(Ya),cP=tPe.map(e=>[e,Ya[e].label,nm(Ya[e].type)]),TK=cP.filter(e=>Ya[e[0]].type==="diverging"||Ya[e[0]].type==="sequential"),EK=cP.filter(e=>Ya[e[0]].type==="qualitative");function fa(e){return e in Ya?Ya[e]:Ya["red-yellow-blue"]}var Qh=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,Wx=rPe(),l2=nPe();function rPe(){return typeof XMLHttpRequest>"u"||Qh?DK():XMLHttpRequest}function nPe(){if(typeof File>"u"||Qh){class e{arrayBuffer(){return this.blob.arrayBuffer()}slice(r,n,o){return this.blob.slice(r,n,o)}stream(){return this.blob.stream()}text(){return this.blob.text()}constructor(r,n,o){var i;this.blob=new Blob(r,o),this.size=this.blob.size,this.type=this.blob.type,this.name=n,this.lastModified=(i=o?.lastModified)!==null&&i!==void 0?i:0,this.webkitRelativePath=""}}return e}else return File}function kK(e){return e>>0}function kf(e,t){return e[t]|e[t+1]<<8}function _0(e,t,r){e[t]=r&255,e[t+1]=r>>8&255}function T0(e,t){return e[t+3]*(256*256*256)+(e[t+2]<<16|e[t+1]<<8|e[t])}function Mf(e,t,r){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255}function oPe(e,t,r){let n="";for(let o=0;o<r;o++)n+=String.fromCharCode(e[t+o]);return n}function iPe(e){return e.length<2?"0"+e:e}function MK(e,t,r){let n="",o;for(let i=0;i<r;i++)n+="%"+iPe(e[t+i].toString(16));try{o=decodeURIComponent(n)}catch{return oPe(e,t,r)}return o}function RK(e,t,r){let n=r.length,o=0;for(let i=0;i<n;i++){let s=r.charCodeAt(i);if(!(s&4294967168))e[t+o]=s,o++;else if(!(s&4294965248))e[t+o]=192|s>>6,e[t+o+1]=128|s>>0&63,o+=2;else if(!(s&4294901760))e[t+o]=224|s>>12,e[t+o+1]=128|s>>6&63,e[t+o+2]=128|s>>0&63,o+=3;else if(!(s&4294967295-(1<<21)+1))e[t+o]=240|s>>18,e[t+o+1]=128|s>>12&63,e[t+o+2]=128|s>>6&63,e[t+o+3]=128|s>>0&63,o+=4;else throw new Error("e")}return o}function p4(e){let t=e.length,r=0;for(let n=0;n<t;n++){let o=e.charCodeAt(n);if(!(o&4294967168))r++;else if(!(o&4294965248))r+=2;else if(!(o&4294901760))r+=3;else if(!(o&4294967295-(1<<21)+1))r+=4;else throw new Error("e")}return r}var sPe=function(){let e=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let n=0;n<8;n++)r&1?r=3988292384^r>>>1:r=r>>>1;e[t]=r}return e}();function aPe(e,t,r,n){for(let o=0;o<n;o++)e=sPe[(e^t[r+o])&255]^e>>>8;return e}function f4(e,t,r){return aPe(4294967295,e,t,r)^4294967295}var Rt=function(){let e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();(function(){for(let r=0;r<32768;r++){let n=r;n=(n&2863311530)>>>1|(n&1431655765)<<1,n=(n&3435973836)>>>2|(n&858993459)<<2,n=(n&4042322160)>>>4|(n&252645135)<<4,n=(n&4278255360)>>>8|(n&16711935)<<8,Rt.rev15[r]=(n>>>16|n<<16)>>>17}function t(r,n,o){for(;n--!==0;)r.push(0,o)}for(let r=0;r<32;r++)Rt.ldef[r]=Rt.of0[r]<<3|Rt.exb[r],Rt.ddef[r]=Rt.df0[r]<<4|Rt.dxb[r];t(Rt.fltree,144,8),t(Rt.fltree,112,9),t(Rt.fltree,24,7),t(Rt.fltree,8,8),Rf(Rt.fltree,9),qx(Rt.fltree,9,Rt.flmap),Zx(Rt.fltree,9),t(Rt.fdtree,32,5),Rf(Rt.fdtree,5),qx(Rt.fdtree,5,Rt.fdmap),Zx(Rt.fdtree,5),t(Rt.itree,19,0),t(Rt.ltree,286,0),t(Rt.dtree,30,0),t(Rt.ttree,320,0)})();function qx(e,t,r){let n=e.length,o=Rt.rev15;for(let i=0;i<n;i+=2)if(e[i+1]!==0){let s=i>>1,a=e[i+1],l=s<<4|a,c=t-a,u=e[i]<<c,d=u+(1<<c);for(;u!==d;){let m=o[u]>>>15-t;r[m]=l,u++}}}function Rf(e,t){let r=e.length,n=Rt.bl_count;for(let s=0;s<=t;s++)n[s]=0;for(let s=1;s<r;s+=2)n[e[s]]++;let o=Rt.next_code,i=0;n[0]=0;for(let s=1;s<=t;s++)i=i+n[s-1]<<1,o[s]=i;for(let s=0;s<r;s+=2){let a=e[s+1];a!==0&&(e[s]=o[a],o[a]++)}}function Zx(e,t){let r=Rt.rev15,n=15-t;for(let o=0;o<e.length;o+=2){let i=e[o]<<t-e[o+1];e[o]=r[i]>>>n}}function lPe(e,t){let r=t===void 0;return t===void 0&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:r,BFINAL:0,off:0,pos:0}}function cPe(e,t){let{data:r,noBuf:n}=e,{buf:o,BFINAL:i,off:s,pos:a}=e,l=0;for(;i===0&&l<t;){let c,u,d=0,m=0;i=g4(r,a,1),l+=1;let p=g4(r,a+1,2);if(a+=3,p===0){a&7&&(a+=8-(a&7));let h=(a>>>3)+4,f=r[h-4]|r[h-3]<<8;n&&(o=h4(o,s+f)),o.set(new Uint8Array(r.buffer,r.byteOffset+h,f),s),a=h+f<<3,s+=f;continue}if(n&&(o=h4(o,s+(1<<17))),p===1)c=Rt.flmap,u=Rt.fdmap,d=511,m=31;else if(p===2){let h=E0(r,a,5)+257,f=E0(r,a+5,5)+1,C=E0(r,a+10,4)+4;a+=14;for(let x=0;x<38;x+=2)Rt.itree[x]=0,Rt.itree[x+1]=0;let g=1;for(let x=0;x<C;x++){let A=E0(r,a+x*3,3);Rt.itree[(Rt.ordr[x]<<1)+1]=A,A>g&&(g=A)}a+=3*C,Rf(Rt.itree,g),qx(Rt.itree,g,Rt.imap),c=Rt.lmap,u=Rt.dmap,a=uPe(Rt.imap,(1<<g)-1,h+f,r,a,Rt.ttree);let b=BK(Rt.ttree,0,h,Rt.ltree);d=(1<<b)-1;let y=BK(Rt.ttree,h,f,Rt.dtree);m=(1<<y)-1,Rf(Rt.ltree,b),qx(Rt.ltree,b,c),Rf(Rt.dtree,y),qx(Rt.dtree,y,u)}else throw new Error(`unknown BTYPE ${p}`);for(;;){let h=c[y4(r,a)&d];a+=h&15;let f=h>>>4;if(!(f>>>8))o[s++]=f;else{if(f===256)break;{let C=s+f-254;if(f>264){let A=Rt.ldef[f-257];C=s+(A>>>3)+E0(r,a,A&7),a+=A&7}let g=u[y4(r,a)&m];a+=g&15;let b=g>>>4,y=Rt.ddef[b],x=(y>>>4)+g4(r,a,y&15);for(a+=y&15,n&&(o=h4(o,s+(1<<17)));s<C;)o[s]=o[s++-x],o[s]=o[s++-x],o[s]=o[s++-x],o[s]=o[s++-x];s=C}}}}e.buf=o,e.BFINAL=i,e.off=s,e.pos=a}async function LK(e,t,r){if(t[0]===3&&t[1]===0)return r||new Uint8Array(0);let n=lPe(t,r);for(;n.BFINAL===0;)e.shouldUpdate&&await e.update({message:"Inflating blocks...",current:n.pos,max:t.length}),cPe(n,100);return n.buf.length===n.off?n.buf:n.buf.slice(0,n.off)}function h4(e,t){let r=e.length;if(t<=r)return e;let n=new Uint8Array(Math.max(r<<1,t));return n.set(e,0),n}function uPe(e,t,r,n,o,i){let s=0;for(;s<r;){let a=e[y4(n,o)&t];o+=a&15;let l=a>>>4;if(l<=15)i[s]=l,s++;else{let c=0,u=0;l===16?(u=3+E0(n,o,2),o+=2,c=i[s-1]):l===17?(u=3+E0(n,o,3),o+=3):l===18&&(u=11+E0(n,o,7),o+=7);let d=s+u;for(;s<d;)i[s]=c,s++}}return o}function BK(e,t,r,n){let o=0,i=0,s=n.length>>>1;for(;i<r;){let a=e[i+t];n[i<<1]=0,n[(i<<1)+1]=a,a>o&&(o=a),i++}for(;i<s;)n[i<<1]=0,n[(i<<1)+1]=0,i++;return o}function E0(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(t&7)&(1<<r)-1}function g4(e,t,r){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)&(1<<r)-1}function y4(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(t&7)}function uP(e,t,r){let n=[],o=e.length,i=t.length;for(let h=0;h<i;h+=2)t[h]=0,t[h+1]=0;for(let h=0;h<o;h++)e[h]!==0&&n.push({lit:h,f:e[h],d:void 0});let s=n.length,a=n.slice(0);if(s===0)return 0;if(s===1){let h=n[0].lit,f=h===0?1:0;return t[(h<<1)+1]=1,t[(f<<1)+1]=1,1}n.sort(function(h,f){return h.f-f.f});let l=n[0],c=n[1],u=0,d=1,m=2;for(n[0]={lit:-1,f:l.f+c.f,l,r:c,d:0};d!==s-1;)u!==d&&(m===s||n[u].f<n[m].f)?l=n[u++]:l=n[m++],u!==d&&(m===s||n[u].f<n[m].f)?c=n[u++]:c=n[m++],n[d++]={lit:-1,f:l.f+c.f,l,r:c,d:void 0};let p=v4(n[d-1],0);p>r&&(dPe(a,r,p),p=r);for(let h=0;h<s;h++)t[(a[h].lit<<1)+1]=a[h].d;return p}function v4(e,t){return e.lit!==-1?(e.d=t,t):Math.max(v4(e.l,t+1),v4(e.r,t+1))}function dPe(e,t,r){let n=0,o=0,i=1<<r-t;for(e.sort(function(s,a){return a.d===s.d?s.f-a.f:a.d-s.d}),n=0;n<e.length&&e[n].d>t;n++){let s=e[n].d;e[n].d=t,o+=i-(1<<r-s)}for(o=o>>>r-t;o>0;){let s=e[n].d;s<t?(e[n].d++,o-=1<<t-s-1):n++}for(;n>=0;n--)e[n].d===t&&o<0&&(e[n].d--,o++)}function mPe(e,t,r,n){let{lits:o,strt:i,prev:s}=Rt;return{data:e,out:t,opt:fPe[n],i:0,pos:r<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:o,strt:i,prev:s}}function pPe(e,t){let{data:r,dlen:n,out:o,opt:i}=e,{i:s,pos:a,cvrd:l,li:c,lc:u,bs:d,ebits:m,c:p,nc:h}=e,{lits:f,strt:C,prev:g}=Rt,b=Math.min(s+t,n);for(;s<b;s++){if(p=h,s+1<n-2){h=b4(r,s+1);let y=s+1&32767;g[y]=C[h],C[h]=y}if(l<=s){(c>14e3||u>26697)&&n-s>100&&(l<s&&(f[c]=s-l,c+=2,l=s),a=GK(s===n-1||l===n?1:0,f,c,m,r,d,s-d,o,a),c=u=m=0,d=s);let y=0;if(s<n-2&&(y=hPe(r,s,g,p,Math.min(i[2],n-s),i[3])),y!==0){let x=y>>>16,A=y&65535,v=OK(x,Rt.of0);Rt.lhst[257+v]++;let _=OK(A,Rt.df0);Rt.dhst[_]++,m+=Rt.exb[v]+Rt.dxb[_],f[c]=x<<23|s-l,f[c+1]=A<<16|v<<8|_,c+=2,l=s+x}else Rt.lhst[r[s]]++;u++}}e.i=s,e.pos=a,e.cvrd=l,e.li=c,e.lc=u,e.bs=d,e.ebits=m,e.c=p,e.nc=h}var fPe=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];async function VK(e,t,r,n,o){let i=mPe(t,r,n,o),{dlen:s}=i;if(o===0){let{i:h,pos:f}=i;for(;h<s;){let C=Math.min(65535,s-h);ub(r,f,h+C===s?1:0),f=UK(t,h,C,r,f+8),h+=C}return f>>>3}for(s>2&&(i.nc=b4(t,0),i.strt[i.nc]=0);i.i<s;)e.shouldUpdate&&await e.update({message:"Deflating...",current:i.i,max:s}),pPe(i,1024*1024);let{li:a,cvrd:l,pos:c}=i,{i:u,lits:d,bs:m,ebits:p}=i;for((m!==u||t.length===0)&&(l<u&&(d[a]=u-l,a+=2,l=u),c=GK(1,d,a,p,t,m,u-m,r,c));c&7;)c++;return c>>>3}function hPe(e,t,r,n,o,i){let s=t&32767,a=r[s],l=s-a+32768&32767;if(a===s||n!==b4(e,t-l))return 0;let c=0,u=0,d=Math.min(32767,t);for(;l<=d&&--i!==0&&a!==s;){if(c===0||e[t+c]===e[t+c-l]){let m=gPe(e,t,l);if(m>c){if(c=m,u=l,c>=o)break;l+2<m&&(m=l+2);let p=0;for(let h=0;h<m-2;h++){let f=t-l+h+32768&32767,C=r[f],g=f-C+32768&32767;g>p&&(p=g,a=f)}}}s=a,a=r[s],l+=s-a+32768&32767}return c<<16|u}function gPe(e,t,r){if(e[t]!==e[t-r]||e[t+1]!==e[t+1-r]||e[t+2]!==e[t+2-r])return 0;let n=t,o=Math.min(e.length,t+258);for(t+=3;t<o&&e[t]===e[t-r];)t++;return t-n}function b4(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function GK(e,t,r,n,o,i,s,a,l){Rt.lhst[256]++;let[c,u,d,m,p,h,f,C]=yPe(),g=(l+3&7?8-(l+3&7):0)+32+(s<<3),b=n+c2(Rt.fltree,Rt.lhst)+c2(Rt.fdtree,Rt.dhst),y=n+c2(Rt.ltree,Rt.lhst)+c2(Rt.dtree,Rt.dhst);y+=14+3*h+c2(Rt.itree,Rt.ihst)+(Rt.ihst[16]*2+Rt.ihst[17]*3+Rt.ihst[18]*7);for(let A=0;A<286;A++)Rt.lhst[A]=0;for(let A=0;A<30;A++)Rt.dhst[A]=0;for(let A=0;A<19;A++)Rt.ihst[A]=0;let x=g<b&&g<y?0:b<y?1:2;if(dP(a,l,e),dP(a,l+1,x),l+=3,x===0){for(;l&7;)l++;l=UK(o,i,s,a,l)}else{let A,v;if(x===1)A=Rt.fltree,v=Rt.fdtree;else if(x===2){Rf(Rt.ltree,c),Zx(Rt.ltree,c),Rf(Rt.dtree,u),Zx(Rt.dtree,u),Rf(Rt.itree,d),Zx(Rt.itree,d),A=Rt.ltree,v=Rt.dtree,ub(a,l,m-257),l+=5,ub(a,l,p-1),l+=5,ub(a,l,h-4),l+=4;for(let I=0;I<h;I++)ub(a,l+I*3,Rt.itree[(Rt.ordr[I]<<1)+1]);l+=3*h,l=NK(f,Rt.itree,a,l),l=NK(C,Rt.itree,a,l)}else Sr(x);let _=i;for(let I=0;I<r;I+=2){let T=t[I],E=T>>>23,w=_+(T&(1<<23)-1);for(;_<w;)l=u2(o[_++],A,a,l);if(E!==0){let S=t[I+1],P=S>>16,k=S>>8&255,L=S&255;l=u2(257+k,A,a,l),ub(a,l,E-Rt.of0[k]),l+=Rt.exb[k],l=u2(L,v,a,l),dP(a,l,P-Rt.df0[L]),l+=Rt.dxb[L],_+=E}}l=u2(256,A,a,l)}return l}function UK(e,t,r,n,o){let i=o>>>3;return n[i]=r,n[i+1]=r>>>8,n[i+2]=255-n[i],n[i+3]=255-n[i+1],i+=4,n.set(new Uint8Array(e.buffer,t,r),i),o+(r+4<<3)}function yPe(){let e=uP(Rt.lhst,Rt.ltree,15),t=uP(Rt.dhst,Rt.dtree,15),r=[],n=FK(Rt.ltree,r),o=[],i=FK(Rt.dtree,o);for(let l=0;l<r.length;l+=2)Rt.ihst[r[l]]++;for(let l=0;l<o.length;l+=2)Rt.ihst[o[l]]++;let s=uP(Rt.ihst,Rt.itree,7),a=19;for(;a>4&&Rt.itree[(Rt.ordr[a-1]<<1)+1]===0;)a--;return[e,t,s,n,i,a,r,o]}function c2(e,t){let r=0;for(let n=0;n<t.length;n++)r+=t[n]*e[(n<<1)+1];return r}function NK(e,t,r,n){for(let o=0;o<e.length;o+=2){let i=e[o],s=e[o+1];n=u2(i,t,r,n);let a=i===16?2:i===17?3:7;i>15&&(ub(r,n,s),n+=a)}return n}function FK(e,t){let r=e.length;for(;r!==2&&e[r-1]===0;)r-=2;for(let n=0;n<r;n+=2){let o=e[n+1],i=n+3<r?e[n+3]:-1,s=n+5<r?e[n+5]:-1,a=n===0?-1:e[n-1];if(o===0&&i===o&&s===o){let l=n+5;for(;l+2<r&&e[l+2]===o;)l+=2;let c=Math.min(l+1-n>>>1,138);c<11?t.push(17,c-3):t.push(18,c-11),n+=c*2-2}else if(o===a&&i===o&&s===o){let l=n+5;for(;l+2<r&&e[l+2]===o;)l+=2;let c=Math.min(l+1-n>>>1,6);t.push(16,c-3),n+=c*2-2}else t.push(o,0)}return r>>>1}function OK(e,t){let r=0;return t[r|16]<=e&&(r|=16),t[r|8]<=e&&(r|=8),t[r|4]<=e&&(r|=4),t[r|2]<=e&&(r|=2),t[r|1]<=e&&(r|=1),r}function u2(e,t,r,n){return dP(r,n,t[e<<1]),n+t[(e<<1)+1]}function ub(e,t,r){r=r<<(t&7);let n=t>>>3;e[n]|=r,e[n+1]|=r>>>8}function dP(e,t,r){r=r<<(t&7);let n=t>>>3;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16}async function P0(e,t,r=!1){let n=Object.create(null),o=new Uint8Array(t);if(kf(o,0)!==19280)throw new Error('Invalid ZIP file. A valid ZIP file must start with two magic bytes \\x50\\x4b ("PK" in ASCII).');let i=o.length-4;for(;T0(o,i)!==101010256;)i--;let s=i;s+=4,s+=4;let a=kf(o,s);s+=2,s+=2,s+=4;let l=T0(o,s);s+=4,s=l;for(let c=0;c<a;c++){s+=4,s+=4,s+=4,s+=4,s+=4;let u=T0(o,s);s+=4;let d=T0(o,s);s+=4;let m=kf(o,s),p=kf(o,s+2),h=kf(o,s+4);s+=6,s+=8;let f=T0(o,s);s+=4,s+=m+p+h,await vPe(e,o,f,n,u,d,r)}return n}async function vPe(e,t,r,n,o,i,s){r+=4,r+=2,r+=2;let a=kf(t,r);r+=2,r+=4,r+=4,r+=8;let l=kf(t,r);r+=2;let c=kf(t,r);r+=2;let u=MK(t,r,l);if(r+=l,r+=c,s){n[u]={size:i,csize:o};return}let d=new Uint8Array(t.buffer,r);if(a===0)n[u]=new Uint8Array(d.buffer.slice(r,r+o));else if(a===8){let m=new Uint8Array(i);await x4(e,d,m),n[u]=m}else throw new Error(`unknown compression method: ${a}`)}async function x4(e,t,r){return LK(e,t,r)}function HK(e,t,r){return x4(e,new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),r)}async function jK(e,t,r){let n=t[3],o=10;if(n&4){let u=kf(t,o);o+=u}if(n&8){let u=o;for(;t[u]!==0;)++u;o=u+1}if(n&16){let u=o;for(;t[u]!==0;)++u;o=u+1}n&1&&(o+=2);let i=kK(T0(t,t.length-8)),s=T0(t,t.length-4);r===void 0&&(r=new Uint8Array(s));let a=new Uint8Array(t.buffer,t.byteOffset+o,t.length-o-8),l=await x4(e,a,r),c=f4(l,0,l.length);return l}async function bPe(e,t,r){r===void 0&&(r={level:6});let n=new Uint8Array(50+Math.floor(t.length*1.1)),o=await VK(e,t,n,0,r.level);return new Uint8Array(n.buffer,0,o)}function $K(e,t=!1){return ke.create("Zip",r=>xPe(r,e,t))}async function xPe(e,t,r=!1){let n=0,o={};for(let d in t){let m=!CPe(d)&&!r,p=t[d],h=f4(p,0,p.length);o[d]={cpr:m,usize:p.length,crc:h,file:m?await bPe(e,p):p}}for(let d in o)n+=o[d].file.length+30+46+2*p4(d);n+=22;let i=new Uint8Array(n),s=0,a=[];for(let d in o){let m=o[d];a.push(s),s=zK(i,s,d,m,0)}let l=0,c=s;for(let d in o){let m=o[d];a.push(s),s=zK(i,s,d,m,1,a[l++])}let u=s-c;return Mf(i,s,101010256),s+=4,s+=4,_0(i,s,l),s+=2,_0(i,s,l),s+=2,Mf(i,s,u),s+=4,Mf(i,s,c),s+=4,s+=2,i.buffer}function CPe(e){let t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!==-1}function zK(e,t,r,n,o,i=0){let s=n.file;Mf(e,t,o===0?67324752:33639248),t+=4,o===1&&(t+=2),_0(e,t,20),t+=2,_0(e,t,0),t+=2,_0(e,t,n.cpr?8:0),t+=2,Mf(e,t,0),t+=4,Mf(e,t,n.crc),t+=4,Mf(e,t,s.length),t+=4,Mf(e,t,n.usize),t+=4,_0(e,t,p4(r)),t+=2,_0(e,t,0),t+=2,o===1&&(t+=2,t+=2,t+=6,Mf(e,t,i),t+=4);let a=RK(e,t,r);return t+=a,o===0&&(e.set(s,t),t+=s.length),t}var Id;(function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"})(Id||(Id={}));function Tp(e,t){return wPe(e,t)}function d2(e){return typeof e=="string"?qK(e,e,"string"):qK(e.title,e.url,e.type||"string",e.body,e.headers)}function SPe(e){if(!Qh&&e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof Wx)return e.readyState===Wx.DONE;throw new Error("unknown data type")}function WK(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function YK(e,t,r){return new Promise((n,o)=>{if(SPe(r)){let{error:s}=r;s!=null?o(s??WK(r instanceof Wx)):n(r);return}let i=!1;r.onerror=s=>{if(i)return;let{error:a}=s.target;o(a??WK(r instanceof Wx))},r.onprogress=s=>{if(!(!e.shouldUpdate||i))try{s.lengthComputable?e.update({message:t,isIndeterminate:!1,current:s.loaded,max:s.total}):e.update({message:`${t} ${(s.loaded/1024/1024).toFixed(2)} MB`,isIndeterminate:!0})}catch(a){i=!0,o(a)}},r.onload=s=>{n(r)}})}function QK(e){return/\.gz$/i.test(e)?Id.Gzip:/\.zip$/i.test(e)?Id.Zip:Id.None}var IPe=/^(__MACOSX|.DS_Store)/;async function APe(e,t,r){switch(r){case Id.None:return t;case Id.Gzip:return jK(e,t);case Id.Zip:let n=await P0(e,t.buffer),o=Object.keys(n).filter(i=>!IPe.test(i));if(o.length!==1)throw new Error("can only decompress zip files with a single entry");return n[o[0]]}}async function JK(e,t,r,n){let o=t instanceof ArrayBuffer?new Uint8Array(t):t;if(o===null)throw new Error("no data given");if(n!==Id.None){if(!(o instanceof Uint8Array))throw new Error("need Uint8Array for decompression");let i=await APe(e,o,n);r==="string"?(await e.update({message:"Decoding text..."}),o=_x(i,0,i.length)):o=i}if(r==="binary"&&o instanceof Uint8Array)return o;if(r==="zip"&&o instanceof Uint8Array)return await P0(e,o.buffer);if(r==="string"&&typeof o=="string")return o;if(r==="xml"&&typeof o=="string")return new DOMParser().parseFromString(o,"application/xml");if(r==="json"&&typeof o=="string")return JSON.parse(o);throw new Error(`could not get requested response data '${r}'`)}function wPe(e,t){if(Qh)return _Pe(e,t);let r;return ke.create("Read File",async n=>{try{r=new FileReader;let o=t==="zip"?Id.None:QK(e.name);t==="binary"||t==="zip"||o!==Id.None?r.readAsArrayBuffer(e):r.readAsText(e),await n.update({message:"Opening file...",canAbort:!0});let i=await YK(n,"Reading...",r);return await n.update({message:"Processing file...",canAbort:!1}),await JK(n,i.result,t,o)}finally{r=void 0}},()=>{r&&r.abort()})}function _Pe(e,t){return ke.create("Read File",async r=>{let n=t==="zip"?Id.None:QK(e.name);await r.update({message:"Opening file...",canAbort:!1});let o;return t==="binary"||t==="zip"||n!==Id.None?o=await e.arrayBuffer():o=await e.text(),await r.update({message:"Processing file...",canAbort:!1}),await JK(r,o,t,n)})}var db=class e{static get(){return this.pool.length?this.pool.pop():new Wx}static emptyFunc(){}static deposit(t){this.pool.length<this.poolSize&&(t.onabort=e.emptyFunc,t.onerror=e.emptyFunc,t.onload=e.emptyFunc,t.onprogress=e.emptyFunc,this.pool.push(t))}};db.pool=[];db.poolSize=15;function TPe(e,t){if(e.status>=200&&e.status<400){let{response:r}=e;if(db.deposit(e),(t==="binary"||t==="zip")&&r instanceof ArrayBuffer)return new Uint8Array(r);if(t==="string"&&typeof r=="string")return r;if(t==="xml"&&r instanceof XMLDocument)return r;if(t==="json"&&typeof r=="object")return r;throw new Error(`could not get requested response data '${t}'`)}else throw db.deposit(e),new Error(`Download failed with status code ${e.status}`)}function EPe(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":return"arraybuffer";case"zip":return"arraybuffer"}}function qK(e,t,r,n,o){if(Qh&&t.startsWith("file://"))return DPe(e,t,r,n,o);let i;return ke.create(e||"Download",async s=>{if(i=db.get(),i.open(n?"post":"get",t,!0),o)for(let[c,u]of o)i.setRequestHeader(c,u);i.responseType=EPe(r),i.send(n),await s.update({message:"Waiting for server...",canAbort:!0});let a=await YK(s,"Downloading...",i);return i=void 0,await s.update({message:"Parsing response...",canAbort:!1}),TPe(a,r)},()=>{i&&(i.abort(),i=void 0)})}var ZK;function PPe(){if(!ZK)throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.");return ZK}function DPe(e,t,r,n,o){if(!Qh)throw new Error("This function should only be used when running in Node.js");if(!t.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://");let i=t.substring(7),s=PPe().readFileSync(i),a=new l2([s],"raw-data");return Tp(a,r)}async function eX(e,t,r,n){let o=r.length,i=new Array(r.length);await e.update({message:"Downloading...",current:0,max:o});let s=[],a=[],l=0;for(let u=Math.min(o,n);l<u;l++){let d=r[l];s.push(XK(l,d.id,t.resolve(Nr.getUrlAsset(t,d.url),d.isBinary?"binary":"string").runAsChild(e))),a.push(l)}let c=0;for(;s.length>0;){let u=await Promise.race(s),d=r[u.index],m=a.indexOf(u.index);if(c++,u.kind==="error"&&!d.canFail)throw new Error(`${d.url}: ${u.error}`);if(e.shouldUpdate&&await e.update({message:"Downloading...",current:c,max:o}),i[u.index]=u,s=s.filter(KK,m),a=a.filter(KK,m),l<o){let p=r[l],h=t.resolve(Nr.getUrlAsset(t,p.url),p.isBinary?"binary":"string").runAsChild(e);s.push(XK(l,p.id,h)),a.push(l),l++}}return i}function KK(e,t){return this!==t}async function XK(e,t,r){try{return{kind:"ok",result:await r,index:e,id:t}}catch(n){return{kind:"error",error:n,index:e,id:t}}}var Nr;(function(e){function t(l,c){return{kind:"url",id:jr.create22(),url:l,...c}}e.Url=t;function r(l){return{kind:"file",id:jr.create22(),name:l.name,file:l}}e.File=r;function n(l){return l?.kind==="url"}e.isUrl=n;function o(l){return l?.kind==="file"}e.isFile=o;function i(l,c,u){return{data:l,dispose:()=>{u.release(c)}}}e.Wrapper=i;function s(l){return typeof l=="string"?l:l.url}e.getUrl=s;function a(l,c,u){return typeof c=="string"?l.tryFindUrl(c,u)||t(c,{body:u}):c}e.getUrlAsset=a})(Nr||(Nr={}));var mP=class{constructor(){this._assets=new Map}get assets(){return wx(this._assets.values())}tryFindUrl(t,r){let n=this.assets.values();for(;;){let o=n.next();if(o.done)return;let i=o.value.asset;if(Nr.isUrl(i)&&i.url===t&&(i.body||"")===(r||""))return i}}set(t,r){this._assets.set(t.id,{asset:t,file:r,refCount:0})}get(t){return this._assets.get(t.id)}delete(t){return this._assets.delete(t.id)}has(t){return this._assets.has(t.id)}resolve(t,r,n=!0){return Nr.isUrl(t)?ke.create(`Download ${t.title||t.url}`,async o=>{if(this._assets.has(t.id)){let a=this._assets.get(t.id);return a.refCount++,Nr.Wrapper(await Tp(a.file,r).runInContext(o),t,this)}if(!n)return Nr.Wrapper(await d2({...t,type:r}).runInContext(o),t,this);let i=await d2({...t,type:"binary"}).runInContext(o),s=new l2([i],"raw-data");return this._assets.set(t.id,{asset:t,file:s,refCount:1}),Nr.Wrapper(await Tp(s,r).runInContext(o),t,this)}):ke.create(`Read ${t.name}`,async o=>{if(this._assets.has(t.id)){let i=this._assets.get(t.id);return i.refCount++,Nr.Wrapper(await Tp(i.file,r).runInContext(o),t,this)}if(!(t.file instanceof l2))throw new Error(`Cannot resolve file asset '${t.name}' (${t.id})`);return n&&this._assets.set(t.id,{asset:t,file:t.file,refCount:1}),Nr.Wrapper(await Tp(t.file,r).runInContext(o),t,this)})}release(t){let r=this._assets.get(t.id);r&&(r.refCount--,r.refCount<=0&&this._assets.delete(t.id))}clear(){this._assets.clear()}dispose(){this.clear()}};var M;(function(e){e.Essential={isEssential:!0};function t(te,X){return X&&(X.label&&(te.label=X.label),X.description&&(te.description=X.description),X.legend&&(te.legend=X.legend),X.fieldLabels&&(te.fieldLabels=X.fieldLabels),X.isHidden&&(te.isHidden=X.isHidden),X.shortLabel&&(te.shortLabel=X.shortLabel),X.twoColumns&&(te.twoColumns=X.twoColumns),X.isEssential&&(te.isEssential=X.isEssential),X.category&&(te.category=X.category),X.hideIf&&(te.hideIf=X.hideIf),X.help&&(te.help=X.help)),te}function r(te){let X={...te};return X.isOptional=!0,X}e.Optional=r;function n(te,X){return t({type:"value",defaultValue:te},X)}e.Value=n;function o(te,X,W){return t({type:"select",defaultValue:oe(te,X),options:X,cycle:W?.cycle},W)}e.Select=o;function i(te,X,W){let K=t({type:"multi-select",defaultValue:te,options:X},W);return W?.emptyValue&&(K.emptyValue=W.emptyValue),K}e.MultiSelect=i;function s(te,X){return t({type:"boolean",defaultValue:te},X)}e.Boolean=s;function a(te="",X){return t({type:"text",defaultValue:te,multiline:X?.multiline,placeholder:X?.placeholder,disableInteractiveUpdates:X?.disableInteractiveUpdates},X)}e.Text=a;function l(te,X){let W=t({type:"color",defaultValue:te},X);return X?.isExpanded&&(W.isExpanded=X.isExpanded),W}e.Color=l;function c(te,X){let W;if(typeof te=="string"){let K=fa(te);W={kind:K.type!=="qualitative"?"interpolate":"set",colors:K.list}}else W=te;return t({type:"color-list",presetKind:X?.presetKind||"all",defaultValue:W,offsets:!!X?.offsets},X)}e.ColorList=c;function u(te,X,W){return t(f({type:"vec3",defaultValue:te},X),W)}e.Vec3=u;function d(te,X){return t({type:"mat4",defaultValue:te},X)}e.Mat4=d;function m(te,X){let W=typeof te=="string"?Nr.Url(te):Nr.Url(te.url,{body:te.body});return t({type:"url",defaultValue:W},X)}e.Url=m;function p(te){let X=t({type:"file",defaultValue:null},te);return te?.accept&&(X.accept=te.accept),X}e.File=p;function h(te){let X=t({type:"file-list",defaultValue:null},te);return te?.accept&&(X.accept=te.accept),X}e.FileList=h;function f(te,X){return X&&(typeof X.min<"u"&&(te.min=X.min),typeof X.max<"u"&&(te.max=X.max),typeof X.step<"u"&&(te.step=X.step)),te}function C(te,X,W){let K=t(f({type:"number",defaultValue:te},X),W);return W?.immediateUpdate&&(K.immediateUpdate=!0),K}e.Numeric=C;function g(te,X,W){return t(f({type:"interval",defaultValue:te},X),W)}e.Interval=g;function b(te,X){let W=t({type:"line-graph",defaultValue:te},X);return X?.getVolume&&(W.getVolume=X.getVolume),W}e.LineGraph=b;function y(te,X){let W=t({type:"group",defaultValue:X?.customDefault||R(te),params:te},X);return X?.presets&&(W.presets=X.presets),X?.isExpanded&&(W.isExpanded=X.isExpanded),X?.isFlat&&(W.isFlat=X.isFlat),X?.pivot&&(W.pivot=X.pivot),W}e.Group=y;function x(te){return y({},te)}e.EmptyGroup=x;function A(te,X,W,K){let re=oe(te,X);return t({type:"mapped",defaultValue:{name:re,params:W(re).defaultValue},select:o(re,X,K),map:W},K)}e.Mapped=A;function v(te,X,W){let K=W?.options?W.options:Object.keys(X).map(se=>[se,X[se].label||Ms(se)]),re=oe(te,K);return t({type:"mapped",defaultValue:{name:re,params:X[re].defaultValue},select:o(re,K,W),map:se=>X[se]},W)}e.MappedStatic=v;function _(te,X,W){return t({type:"object-list",element:te,getLabel:X,ctor:I,defaultValue:W?.defaultValue||[]},W)}e.ObjectList=_;function I(){return R(this.element)}function T(){throw new Error("getValue not set. Fix runtime.")}function E(te,X,W){var K;return t({type:"value-ref",defaultValue:{ref:(K=W?.defaultRef)!==null&&K!==void 0?K:"",getValue:T},getOptions:te,resolveRef:X},W)}e.ValueRef=E;function w(te){var X;return t({type:"data-ref",defaultValue:{ref:(X=te?.defaultRef)!==null&&X!==void 0?X:"",getValue:T}},te)}e.DataRef=w;function S(te,X,W){return t({type:"converted",defaultValue:X(W.defaultValue),converted:W,fromValue:te,toValue:X},W)}e.Converted=S;function P(te,X,W,K,re){let se=Object.keys(X).map(me=>[me,me]);return t({type:"conditioned",select:o(W(te),se,re),defaultValue:te,conditionParams:X,conditionForValue:W,conditionedValue:K},re)}e.Conditioned=P;function k(te,X){return t({type:"script",defaultValue:te},X)}e.Script=k;function L(te){return 0}e.For=L;function R(te){let X={};for(let W of Object.keys(te))te[W].isOptional||(X[W]=te[W].defaultValue);return X}e.getDefaultValues=R;function N(te,X,W){return()=>te(X,W)}function F(te,X,W){if(X){if(te.type==="value-ref"){let K=X;K.ref?K.getValue=N(te.resolveRef,K.ref,W):K.getValue=()=>{throw new Error("Unset ref in ValueRef value.")}}else if(te.type==="data-ref"){let K=X;K.ref?K.getValue=N(W,K.ref,W):K.getValue=()=>{throw new Error("Unset ref in ValueRef value.")}}else if(te.type==="group")q(te.params,X,W);else if(te.type==="mapped"){let K=X,re=te.map(K.name);F(re,K.params,W)}else if(te.type==="object-list"){if(!V(te.element))return;for(let K of X)q(te.element,K,W)}}}function H(te){if(te.type==="value-ref"||te.type==="data-ref")return!0;if(te.type==="group"){if(V(te.params))return!0}else if(te.type==="mapped"){for(let[X]of te.select.options)if(H(te.map(X)))return!0}else if(te.type==="object-list")return V(te.element);return!1}function V(te){for(let X of Object.keys(te))if(H(te[X]))return!0;return!1}function q(te,X,W){for(let K of Object.keys(te))F(te[K],X?.[K],W)}e.resolveRefs=q;function Q(te,X){for(let W of Object.keys(te))te[W].isOptional||(te[W].defaultValue=X[W])}e.setDefaultValues=Q;function O(te){return Xa(te)}e.clone=O;function B(te,X){}e.validate=B;function j(te,X,W){if(X===W)return!0;if(typeof X!="object"||typeof W!="object")return!1;for(let K of Object.keys(te))if(!U(te[K],X[K],W[K]))return!1;return!0}e.areEqual=j;function U(te,X,W){if(X===W)return!0;if(te.type==="group")return j(te.params,X,W);if(te.type==="mapped"){let K=X,re=W;if(K.name!==re.name)return!1;let se=te.map(K.name);return U(se,K.params,re.params)}else if(te.type==="multi-select"){let K=X,re=W;if(K.length!==re.length)return!1;if(K.length<10){for(let se=0,me=K.length;se<me;se++)if(K[se]!==re[se]&&re.indexOf(K[se])<0)return!1}else{let se=new Set(re);for(let me=0,Y=K.length;me<Y;me++)if(K[me]!==re[me]&&!se.has(K[me]))return!1}return!0}else{if(te.type==="interval")return X[0]===W[0]&&X[1]===W[1];if(te.type==="line-graph"){let K=X,re=W;if(K.length!==re.length)return!1;for(let se=0,me=K.length;se<me;se++)if(!Ve.areEqual(K[se],re[se]))return!1;return!0}else{if(te.type==="vec3")return D.equals(X,W);if(te.type==="mat4")return de.areEqual(X,W,1e-6);if(te.type==="script"){let K=X,re=W;return K.language===re.language&&K.expression===re.expression}else if(te.type==="object-list"){let K=X,re=W,se=K.length;if(se!==re.length)return!1;for(let me=0;me<se;me++)if(!j(te.element,K[me],re[me]))return!1;return!0}else if(typeof X=="object"&&typeof W=="object")return Au(X,W)}}return!1}e.isParamEqual=U;function z(te,X,W){if(X===void 0)return{...W};if(W===void 0)return{...X};let K=Object.create(null);for(let re of Object.keys(te))K[re]=$(te[re],X[re],W[re]);return K}e.merge=z;function $(te,X,W){if(X===void 0)return typeof W=="object"&&!Array.isArray(W)?{...W}:W;if(W===void 0)return typeof X=="object"&&!Array.isArray(X)?{...X}:X;if(te.type==="group")return z(te.params,X,W);if(te.type==="mapped"){let K=X,re=W;if(K.name!==re.name)return{...re};let se=te.map(re.name);return{name:re.name,params:$(se,K.params,re.params)}}else return te.type==="value"?W:typeof X=="object"&&typeof W=="object"?Array.isArray(W)?W:{...X,...W}:W}e.mergeParam=$;function Z(te,X){for(let W of te.options)if(W[0]===X)return!0;return!1}function J(te,X,W){if(X==null)return W?te.defaultValue:void 0;if(te.type==="value")return X;if(te.type==="group"){let K=Object.create(null);for(let re of Object.keys(te.params)){let se=te.params[re];X[re]===void 0?W&&(K[re]=se.defaultValue):K[re]=J(se,X[re],W)}return K}else if(te.type==="mapped"){let K=X;if(typeof K.name!="string")return te.defaultValue;if(typeof K.params>"u")return W?te.defaultValue:void 0;if(!Z(te.select,K.name))return te.defaultValue;let re=te.map(K.name);return{name:K.name,params:J(re,K.params,W)}}else{if(te.type==="select")return Z(te,X)?X:te.defaultValue;if(te.type==="multi-select"){if(!Array.isArray(X))return te.defaultValue;let K=X.filter(function(re){return Z(this,re)},te);return X.length>0&&K.length===0?te.defaultValue:K}else if(te.type==="object-list")return Array.isArray(X)?X.map(K=>ie(te.element,K,W?"all":"skip")):te.defaultValue}return X}function ie(te,X,W){if(typeof X!="object"||X===null)return W?R(te):X;let K=Object.create(null);for(let re of Object.keys(te)){let se=te[re];X[re]===void 0?W==="all"&&(K[re]=se.defaultValue):K[re]=J(se,X[re],W!=="skip")}return K}e.normalizeParams=ie;function ne(te,X){let W=[];for(let K of Object.keys(te))if(!X)typeof te[K]=="string"?W.push([K,te[K]]):W.push([K,X===null?K:Ms(K)]);else{let re=X(K,te[K]);W.push(typeof re=="string"?[K,re]:[K,re[0],re[1]])}return W}e.objectToOptions=ne;function le(te,X){let W=[];for(let K of te)X?W.push([K,X(K)]):W.push([K,X===null?K:Ms(K)]);return W}e.arrayToOptions=le;function ee(te,X){for(let W of te.options)if(W[0]===X)return W[1];return""}e.optionLabel=ee;function oe(te,X){for(let W of X)if(W[0]===te)return te;return X.length>0?X[0][0]:void 0}})(M||(M={}));var ki;(function(e){function t(o){let i={create(s){return{action:i,params:s}},id:jr.create22(),definition:o,createDefaultParams(s,a){return o.params?M.getDefaultValues(o.params(s,a)):{}}};return i}e.create=t;function r(o){let i=o.definition;return t({from:i.from,display:i.display,params:i.params,isApplicable:o.definition.isApplicable?(s,a,l)=>o.definition.isApplicable(s,l):void 0,run({cell:s,state:a,params:l}){let c=a.build().to(s.transform.ref).apply(o,l);return a.updateTree(c)}})}e.fromTransformer=r;let n;(function(o){function i(s){return a=>t({from:s.from instanceof Array?s.from:s.from?[s.from]:[],display:typeof s.display=="string"?{name:s.display}:s.display?s.display:{name:"Unnamed State Action"},params:typeof s.params=="object"?()=>s.params:s.params?s.params:void 0,isApplicable:s.isApplicable,...typeof a=="function"?{run:a}:a})}o.build=s=>i(s)})(n=e.Builder||(e.Builder={})),e.build=n.build})(ki||(ki={}));var st;(function(e){function t(f,C,g){return f.definition.params?f.definition.params(C,g):{}}e.getParamDefinition=t;function r(f){return!!f&&typeof f.toAction=="function"&&typeof f.apply=="function"}e.is=r;let n;(function(f){f[f.Unchanged=0]="Unchanged",f[f.Updated=1]="Updated",f[f.Recreate=2]="Recreate",f[f.Null=3]="Null"})(n=e.UpdateResult||(e.UpdateResult={}));let o=new Map,i=new Map;function s(f){for(let C of f.definition.from)i.has(C.type)?i.get(C.type).push(f):i.set(C.type,[f])}function a(){return Array.from(o.values())}e.getAll=a;function l(f){let C=o.get(f);if(!C)throw new Error(`A transformer with signature '${f}' is not registered.`);return C}e.get=l;function c(f){return i.get(f)||[]}e.fromType=c;function u(f,C){let{name:g}=C,b=`${f}.${g}`;if(o.has(b))throw new Error(`A transform with id '${g}' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.`);let y={apply(x,A,v){return xr.create(x,y,A,v)},toAction(){return ki.fromTransformer(y)},namespace:f,id:b,definition:C,createDefaultParams(x,A){return C.params?M.getDefaultValues(C.params(x,A)):{}}};return o.set(b,y),s(y),y}e.create=u;function d(f){return C=>u(f,C)}e.factory=d;function m(f){return p.build(f)}e.builderFactory=m;let p;(function(f){function C(b,y){return x=>u(b,{name:y.name,from:y.from instanceof Array?y.from:[y.from],to:y.to instanceof Array?y.to:[y.to],display:typeof y.display=="string"?{name:y.display}:y.display?y.display:{name:nm(y.name.replace(/[-]/g," "))},params:typeof y.params=="object"?()=>y.params:y.params?y.params:void 0,isDecorator:y.isDecorator,...x})}function g(b){return y=>C(b,y)}f.build=g})(p=e.Builder||(e.Builder={}));function h(f){return p.build(f)}e.build=h,e.ROOT=u("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply(){throw new Error("should never be applied")},update(){return n.Unchanged}})})(st||(st={}));var xr;(function(e){e.RootRef="-=root=-";function t(C,g){return!!C.isHidden!=!!g.isHidden||!!C.isCollapsed!=!!g.isCollapsed||!!C.isGhost!=!!g.isGhost||!!C.isLocked!=!!g.isLocked}e.areStatesEqual=t;function r(C,g){return g?typeof g.isCollapsed<"u"&&C.isCollapsed!==g.isCollapsed||typeof g.isHidden<"u"&&C.isHidden!==g.isHidden||typeof g.isGhost<"u"&&C.isGhost!==g.isGhost||typeof g.isLocked<"u"&&C.isLocked!==g.isLocked:!1}e.isStateChange=r;function n(C,g){if(!g)return!1;let b=!1;for(let y of Object.keys(g)){let x=g[y],A=C[y];!!x!=!!A&&(b=!0,C[y]=x)}return b}e.assignState=n;function o(C,g){if(!g)return!1;let b=!1;for(let y of Object.keys(g)){let x=g[y],A=C[y];!!x!=!!A&&(b=!0,x!==void 0?C[y]=x:delete C[y])}for(let y of Object.keys(C)){let x=g[y],A=C[y];!!x!=!!A&&(b=!0,x!==void 0?C[y]=x:delete C[y])}return b}e.syncState=o;function i(C,g,b,y){let x=y&&y.ref?y.ref:jr.create22(),A;return y&&y.tags&&(A=typeof y.tags=="string"?[y.tags]:y.tags,A.length===0?A=void 0:A.sort()),{parent:C,transformer:g,state:y?.state||{},tags:A,ref:x,dependsOn:y&&y.dependsOn,params:b,version:jr.create22()}}e.create=i;function s(C,g){return{...C,params:g,version:jr.create22()}}e.withParams=s;function a(C,g){return g?{...C,state:{...C.state,...g}}:C}e.withState=a;function l(C,g){let b;return g&&(b=typeof g=="string"?[g]:g,b.length===0?b=void 0:b.sort()),{...C,tags:b,version:jr.create22()}}e.withTags=l;function c(C,g){return{...C,parent:g,version:jr.create22()}}e.withParent=c;function u(C){return i(e.RootRef,st.ROOT,{},{ref:e.RootRef,state:C})}e.createRoot=u;function d(C,g){return C.tags?C.tags.indexOf(g)>=0:!1}e.hasTag=d;function m(C,g){if(!C.tags)return typeof g!="string"&&g.length===0;if(typeof g=="string")return d(C,g);for(let b of g)if(C.tags.indexOf(b)<0)return!1;return!0}e.hasTags=m;function p(C){return C}function h(C){let g=C.transformer.definition.customSerialization?C.transformer.definition.customSerialization.toJSON:p,b;for(let y of Object.keys(C.state))C.state[y]&&(b||(b={}),b[y]=!0);return{parent:C.parent,transformer:C.transformer.id,params:C.params?g(C.params):void 0,state:b,tags:C.tags,ref:C.ref,dependsOn:C.dependsOn,version:C.version}}e.toJSON=h;function f(C){let g=st.get(C.transformer),b=g.definition.customSerialization?g.definition.customSerialization.fromJSON:p;return{parent:C.parent,transformer:g,params:C.params?b(C.params):void 0,state:C.state||{},tags:C.tags,ref:C.ref,dependsOn:C.dependsOn,version:C.version}}e.fromJSON=f})(xr||(xr={}));function Da(e){let t=-1/0;for(let r=0,n=e.length;r<n;++r)e[r]>t&&(t=e[r]);return t}function D0(e){let t=1/0;for(let r=0,n=e.length;r<n;++r)e[r]<t&&(t=e[r]);return t}function ml(e){let t=1/0,r=-1/0;for(let n=0,o=e.length;n<o;++n)e[n]<t&&(t=e[n]),e[n]>r&&(r=e[n]);return[t,r]}function C4(e,t=1,r=0){let n=e.length,o=0;for(let i=r;i<n;i+=t)o+=e[i];return o}function k0(e,t=1,r=0){return C4(e,t,r)/(e.length/t)}function M0(e){let t=e.length,r=0;for(let n=0;n<t;++n){let o=e[n];r+=o*o}return Math.sqrt(r/t)}function Rs(e,t){for(let r=0,n=t?Math.min(t,e.length):e.length;r<n;++r)e[r]=r;return e}function Jh(e,t){let r=0,n=!1;for(let o=e.length;r<o;r++)if(e[r]===t){n=!0;break}return n?(R0(e,r),!0):!1}function R0(e,t){for(let r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function Ho(e,t){return e.indexOf(t)>=0?!1:(e.push(t),!0)}function om(e,t){let r=e.indexOf(t);if(r<0)return!1;for(let n=r,o=e.length-1;n<o;n++)e[n]=e[n+1];return e.pop(),!0}function Kx(e,t){let r=0;for(let n=0,o=e.length;n<o;++n)t.includes(e[n])&&(r+=1);return r}function Xx(e,t){if(!e||e.length===0)return!t||t.length===0;if(!t)return!1;let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function tX(e){for(let t=0,r=e.length;t<r;t++)if(e[t]!==t)return!1;return!0}function m2(e,t,r){for(let n=0,o=e.length;n<o;++n)if(e[n][0]===t){e[n][1]=r;return}e.push([t,r])}var p2=class{get childMutations(){return this._childMutations?this._childMutations:(this._childMutations=new Map,this._childMutations)}get dependencyMutations(){return this._dependencyMutations?this._dependencyMutations:(this._dependencyMutations=new Map,this._dependencyMutations)}changeNodes(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())}changeChildren(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())}changeDependencies(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())}get root(){return this.transforms.get(xr.RootRef)}asTransient(){return this.asImmutable().asTransient()}addChild(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(r);else{let n=this.children.get(t).asMutable();n.add(r),this.children.set(t,n),this.childMutations.set(t,n)}}removeChild(t,r){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(r);else{let n=this.children.get(t).asMutable();n.remove(r),this.children.set(t,n),this.childMutations.set(t,n)}}clearRoot(){let t=xr.RootRef;if(this.children.get(t).size===0)return;this.changeChildren();let r=Cd();this.children.set(t,r),this.childMutations.set(t,r)}mutateDependency(t,r,n){let o=this.dependencyMutations.get(t);if(!o){let i=this.dependencies.get(t);if(!i&&n==="remove")return;this.changeDependencies(),o=i?i.asMutable():Cd().asMutable(),this.dependencyMutations.set(t,o),this.dependencies.set(t,o)}n==="add"?o.add(r):o.remove(r)}changeParent(t,r){pP(this.transforms,t);let n=this.transforms.get(t);this.removeChild(n.parent,t),this.addChild(r,t),this.changeNodes(),this.transforms.set(t,xr.withParent(n,r))}add(t){let r=t.ref;this.transforms.has(t.ref)&&this.transforms.get(t.ref).parent!==t.parent&&RPe(t.ref);let n=this.children.get(t.parent);if(n||BPe(t.parent),n.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,Cd())),this.changeNodes(),this.transforms.set(r,t),t.dependsOn)for(let o of t.dependsOn)this.mutateDependency(o,r,"add");return this}setParams(t,r){pP(this.transforms,t);let n=this.transforms.get(t);return A0(n.params,r)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,xr.withParams(n,r)),!0)}setTags(t,r){pP(this.transforms,t);let n=this.transforms.get(t),o=xr.withParams(n,r);return Xx(n.tags,o.tags)?!1:(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,o),!0)}assignState(t,r){pP(this.transforms,t);let n=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return xr.assignState(n.state,r),n;{this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes();let o=xr.withState(n,r);return this.transforms.set(t,o),o}}remove(t){let r=this.transforms.get(t);if(!r)return[];let n=mi.subtreePostOrder(this,r);if(t===xr.RootRef){if(n.pop(),n.length===0)return n;this.clearRoot()}else{if(n.length===0)return n;this.removeChild(r.parent,r.ref)}this.changeNodes(),this.changeChildren();for(let i of n)this.transforms.delete(i.ref),this.children.delete(i.ref),this._childMutations&&this._childMutations.delete(i.ref);let o=[];for(let i of n){if(i.dependsOn)for(let s of i.dependsOn)this.transforms.has(s)&&this.mutateDependency(s,i.ref,"remove");if(this.dependencies.has(i.ref)){let s=this.dependencies.get(i.ref).toArray();this.changeDependencies(),this.dependencies.delete(i.ref),this._dependencyMutations&&this._dependencyMutations.delete(i.ref);for(let a of s)if(this.transforms.has(a))for(let l of this.remove(a))o[o.length]=l}}for(let i of o)n[n.length]=i;return n}asImmutable(){return!this.changedNodes&&!this.changedChildren&&!this._childMutations?this.tree:(this._childMutations&&this._childMutations.forEach(kPe,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(MPe,this.dependencies),mi.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies))}constructor(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}};function kPe(e,t){this.set(t,e.asImmutable())}function MPe(e,t){e.size===0?this.delete(t):this.set(t,e.asImmutable())}function RPe(e){throw new Error(`Transform '${e}' is already present in the tree.`)}function BPe(e){throw new Error(`Parent '${e}' must be present in the tree.`)}function pP(e,t){if(!e.has(t))throw new Error(`Node '${t}' is not present in the tree.`)}var mi;(function(e){class t{get root(){return this.transforms.get(xr.RootRef)}asTransient(){return new p2(this)}constructor(x,A,v){this.transforms=x,this.children=A,this.dependencies=v}}function r(y){let x=y||xr.createRoot();return n(Sd([[x.ref,x]]),Sd([[x.ref,Cd()]]),Sd())}e.createEmpty=r;function n(y,x,A){return new t(y,x,A)}e.create=n;function o(y){i(this,this.tree.transforms.get(y))}function i(y,x){let A=y.tree.children.get(x.ref);A&&A.size&&A.forEach(o,y),y.f(x,y.tree,y.state)}function s(y,x,A,v){let _={tree:y,state:A,f:v};return i(_,x),_.state}e.doPostOrder=s;function a(y){l(this,this.tree.transforms.get(y))}function l(y,x){let A=y.f(x,y.tree,y.state);if(typeof A=="boolean"&&!A)return;let v=y.tree.children.get(x.ref);v&&v.size&&v.forEach(a,y)}function c(y,x,A,v){let _={tree:y,state:A,f:v};return l(_,x),_.state}e.doPreOrder=c;function u(y,x,A){A.push(y)}function d(y,x){return s(y,x,[],u)}e.subtreePostOrder=d;function m(y,x,A){A.push(xr.toJSON(y))}function p(y){let x=[];return c(y,y.root,x,m),{transforms:x}}e.toJSON=p;function h(y){let x=Sd().asMutable(),A=Sd().asMutable(),v=Sd().asMutable();for(let I of y.transforms){let T=xr.fromJSON(I);x.set(T.ref,T),A.has(T.ref)||A.set(T.ref,Cd().asMutable()),T.ref!==T.parent&&A.get(T.parent).add(T.ref)}let _=new Set;for(let I of y.transforms){let T=I.ref;if(A.set(T,A.get(T).asImmutable()),!!I.dependsOn)for(let E of I.dependsOn)_.add(E),v.has(E)?v.get(E).add(T):v.set(E,Cd([T]).asMutable())}return _.forEach(I=>{v.set(I,v.get(I).asImmutable())}),n(x.asImmutable(),A.asImmutable(),v.asImmutable())}e.fromJSON=h;function f(y){}e.dump=f;function C(y,x,A){if(x===A)return!0;let _=y.children.get(x).values();for(;;){let I=_.next();if(I.done)return!1;if(C(y,I.value,A))return!0}}function g(y,x,A){return!y.transforms.has(x)||!y.transforms.has(A)?!1:C(y,x,A)}e.subtreeHasRef=g;function b(y,x){let A=y.children.get(x);if(A.size!==1)return x;let v=y.transforms.get(A.first());return v.transformer.definition.isDecorator?b(y,v.ref):x}e.getDecoratorRoot=b})(mi||(mi={}));var Kt;(function(e){function t(j,U){return r(j)(U)}e.select=t;function r(j){let U=j||c.root,z;return o(U)?z=U.compile():n(U)?z=c.byValue(U).compile():i(U)?z=U:z=c.byRef(U).compile(),z}e.compile=r;function n(j){return j.transform!==void 0&&j.status!==void 0}function o(j){return j.compile!==void 0}function i(j){return typeof j=="function"}let s={select(j){return t(this,j||this.state)}};function a(j,U){s[j]=function(...z){return U.call(void 0,this,...z)}}function l(j){return Object.create(s,{compile:{writable:!1,configurable:!1,value:j}})}let c;(function(j){j.root=l(()=>te=>[te.cells.get(te.tree.root.ref)]);function U(...te){return l(()=>X=>{let W=[];for(let K of te){let re=X.cells.get(K);re&&W.push(re)}return W})}j.byRef=U;function z(...te){return l(()=>X=>te)}j.byValue=z;function $(te,X=xr.RootRef){return l(()=>W=>{let K={roots:[],cells:W.cells,type:te.type};return mi.doPreOrder(W.tree,W.tree.transforms.get(X),K,ne),K.roots})}j.rootsOfType=$;function Z(te,X=xr.RootRef){return l(()=>W=>{let K={ret:[],cells:W.cells,type:te.type};return mi.doPreOrder(W.tree,W.tree.transforms.get(X),K,le),K.ret})}j.ofType=Z;function J(te,X=xr.RootRef){return l(()=>W=>{let K={ret:[],cells:W.cells,t:te};return mi.doPreOrder(W.tree,W.tree.transforms.get(X),K,ee),K.ret})}j.ofTransformer=J;function ie(te,X=xr.RootRef){return l(()=>W=>{let K={ret:[],cells:W.cells,t:te};return mi.doPreOrder(W.tree,W.tree.transforms.get(X),K,oe),K.ret})}j.ofTransformerWithError=ie;function ne(te,X,W){let K=W.cells.get(te.ref);return K&&K.obj&&K.obj.type===W.type?(W.roots.push(K),!1):!0}function le(te,X,W){let K=W.cells.get(te.ref);return K&&K.obj&&K.obj.type===W.type&&W.ret.push(K),!0}function ee(te,X,W){let K=W.cells.get(te.ref);return K&&K.obj&&K.transform.transformer===W.t&&W.ret.push(K),!0}function oe(te,X,W){let K=W.cells.get(te.ref);return K&&K.status==="error"&&K.transform.transformer===W.t&&W.ret.push(K),!0}})(c=e.Generators||(e.Generators={})),a("flatMap",u);function u(j,U){let z=r(j);return l(()=>$=>{let Z=[];for(let J of z($))for(let ie of U(J,$))Z.push(ie);return Z})}e.flatMap=u,a("mapObject",d);function d(j,U){let z=r(j);return l(()=>$=>{let Z=[];for(let J of z($)){let ie=U(J,$);ie&&Z.push(ie)}return Z})}e.mapObject=d,a("unique",m);function m(j){let U=r(j);return l(()=>z=>{let $=new Set,Z=[];for(let J of U(z))J&&($.has(J.transform.ref)||($.add(J.transform.ref),Z.push(J)));return Z})}e.unique=m,a("first",p);function p(j){let U=r(j);return l(()=>z=>{let $=U(z);return $.length?[$[0]]:[]})}e.first=p,a("filter",h);function h(j,U){return u(j,z=>U(z)?[z]:[])}e.filter=h,a("withStatus",f);function f(j,U){return h(j,z=>z.status===U)}e.withStatus=f,a("withTag",C);function C(j,U){return h(j,z=>!!z.transform.tags&&z.transform.tags.indexOf(U)>=0)}e.withTag=C,a("subtree",g);function g(j){return u(j,(U,z)=>{let $=[];return mi.doPreOrder(z.tree,z.tree.transforms.get(U.transform.ref),$,(Z,J,ie)=>{ie.push(Z.ref)}),$.map(Z=>z.cells.get(Z))})}e.subtree=g,a("children",b);function b(j){return u(j,(U,z)=>{let $=[];return z.tree.children.get(U.transform.ref).forEach(Z=>$.push(z.cells.get(Z))),$})}e.children=b,a("ofType",y);function y(j,U){return h(j,z=>z.obj?z.obj.type===U.type:!1)}e.ofType=y,a("ancestor",x);function x(j,U){return m(d(j,(z,$)=>S($.tree,$.cells,z.transform.ref,U)))}e.ancestor=x,a("ancestorOfType",A);function A(j,U){return m(d(j,(z,$)=>L($.tree,$.cells,z.transform.ref,U)))}e.ancestorOfType=A,a("ancestorWithTransformer",v);function v(j,U){return m(d(j,(z,$)=>k($.tree,$.cells,z.transform.ref,U)))}e.ancestorWithTransformer=v,a("withTransformer",_);function _(j,U){return h(j,z=>z.transform.transformer===U)}e.withTransformer=_,a("root",I);function I(j,U){return m(d(j,(z,$)=>P($.tree,$.cells,z.transform.ref,U)))}e.root=I,a("rootOfType",T);function T(j,U){return m(d(j,(z,$)=>R($.tree,$.cells,z.transform.ref,U)))}e.rootOfType=T,a("parent",E);function E(j){return m(d(j,(U,z)=>z.cells.get(z.tree.transforms.get(U.transform.ref).parent)))}e.parent=E;function w(j,U,z,$,Z){let J=j.transforms.get(z),ie;for(;;){J=j.transforms.get(J.parent);let ne=U.get(J.ref);if(ne.obj&&$(ne)&&(ie=ne,Z)||J.ref===xr.RootRef)return ie}}function S(j,U,z,$){return w(j,U,z,$,!0)}e.findAncestor=S;function P(j,U,z,$){return w(j,U,z,$,!1)}e.findRoot=P;function k(j,U,z,$){return S(j,U,z,Array.isArray($)?Z=>$.indexOf(Z.transform.transformer)>=0:Z=>Z.transform.transformer===$)}e.findAncestorWithTransformer=k;function L(j,U,z,$){return S(j,U,z,N($))}e.findAncestorOfType=L;function R(j,U,z,$){return P(j,U,z,N($))}e.findRootOfType=R;function N(j){return Array.isArray(j)?U=>{for(let z of j)if(z.type===U.obj.type)return!0}:U=>U.obj.type===j.type}function F(j,U,z){return mi.doPreOrder(j,j.transforms.get(U),{refs:{},tags:z},H).refs}e.findUniqueTagsInSubtree=F;function H(j,U,z){if(j.tags){for(let $ of j.tags)if(z.tags.has($)){z.refs[$]=j.ref;break}}return!0}function V(j,U,z){return mi.doPreOrder(j,j.transforms.get(U),{ref:void 0,tag:z},q).ref}e.findTagInSubtree=V;function q(j,U,z){return j.tags&&j.tags.indexOf(z.tag)>=0?(z.ref=j.ref,!1):!0}function Q(j,U,z){return mi.doPreOrder(j,j.transforms.get(U),{refs:[],tags:z},O).refs}e.findWithAllTags=Q;function O(j,U,z){if(j.tags){let $=z.tags.size,Z=0;for(let J of j.tags)if(z.tags.has(J)&&(Z++,Z===$)){z.refs.push(j);break}}else z.tags.size===0&&z.refs.push(j)}function B(j,U,z){if(j.transforms.get(U).transformer===z)return j.cells.get(U);let Z=j.tree.children.get(U);if(Z.size!==1)return;let J=Z.first();if(j.transforms.get(J).transformer.definition.isDecorator)return B(j,J,z)}e.tryFindDecorator=B})(Kt||(Kt={}));var S4=function(e,t){return S4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},S4(e,t)};function Cc(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");S4(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function rX(e,t,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(u){try{c(n.next(u))}catch(d){s(d)}}function l(u){try{c(n.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((n=n.apply(e,t||[])).next())})}function fP(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(r=0)),r;)try{if(n=1,o&&(i=c[0]&2?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,o=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){r.label=c[1];break}if(c[0]===6&&r.label<i[1]){r.label=i[1],i=c;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(c);break}i[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(u){c=[6,u],o=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function eg(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ep(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,i=[],s;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function Pp(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function mb(e){return this instanceof mb?(this.v=e,this):new mb(e)}function nX(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,i=[];return o={},a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(p){return function(h){return Promise.resolve(h).then(p,d)}}function a(p,h){n[p]&&(o[p]=function(f){return new Promise(function(C,g){i.push([p,f,C,g])>1||l(p,f)})},h&&(o[p]=h(o[p])))}function l(p,h){try{c(n[p](h))}catch(f){m(i[0][3],f)}}function c(p){p.value instanceof mb?Promise.resolve(p.value.v).then(u,d):m(i[0][2],p)}function u(p){l("next",p)}function d(p){l("throw",p)}function m(p,h){p(h),i.shift(),i.length&&l(i[0][0],i[0][1])}}function oX(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof eg=="function"?eg(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(s){return new Promise(function(a,l){s=e[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},s)}}function Mo(e){return typeof e=="function"}function hP(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var gP=hP(function(e){return function(r){e(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,o){return o+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function pb(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var B0=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=eg(s),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(f){t={error:f}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else s.remove(this);var u=this.initialTeardown;if(Mo(u))try{u()}catch(f){i=f instanceof gP?f.errors:[f]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var m=eg(d),p=m.next();!p.done;p=m.next()){var h=p.value;try{iX(h)}catch(f){i=i??[],f instanceof gP?i=Pp(Pp([],Ep(i)),Ep(f.errors)):i.push(f)}}}catch(f){n={error:f}}finally{try{p&&!p.done&&(o=m.return)&&o.call(m)}finally{if(n)throw n.error}}}if(i)throw new gP(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)iX(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&pb(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&pb(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}();var I4=B0.EMPTY;function yP(e){return e instanceof B0||e&&"closed"in e&&Mo(e.remove)&&Mo(e.add)&&Mo(e.unsubscribe)}function iX(e){Mo(e)?e():e.unsubscribe()}var Dp={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Yx={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=Yx.delegate;return o?.setTimeout?o.setTimeout.apply(o,Pp([e,t],Ep(r))):setTimeout.apply(void 0,Pp([e,t],Ep(r)))},clearTimeout:function(e){var t=Yx.delegate;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function vP(e){Yx.setTimeout(function(){var t=Dp.onUnhandledError;if(t)t(e);else throw e})}function A4(){}var sX=function(){return w4("C",void 0,void 0)}();function aX(e){return w4("E",void 0,e)}function lX(e){return w4("N",e,void 0)}function w4(e,t,r){return{kind:e,value:t,error:r}}var fb=null;function Qx(e){if(Dp.useDeprecatedSynchronousErrorHandling){var t=!fb;if(t&&(fb={errorThrown:!1,error:null}),e(),t){var r=fb,n=r.errorThrown,o=r.error;if(fb=null,n)throw o}}else e()}function cX(e){Dp.useDeprecatedSynchronousErrorHandling&&fb&&(fb.errorThrown=!0,fb.error=e)}var f2=function(e){Cc(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,yP(r)&&r.add(n)):n.destination=OPe,n}return t.create=function(r,n,o){return new xP(r,n,o)},t.prototype.next=function(r){this.isStopped?T4(lX(r),this):this._next(r)},t.prototype.error=function(r){this.isStopped?T4(aX(r),this):(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped?T4(sX,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(B0);var LPe=Function.prototype.bind;function _4(e,t){return LPe.call(e,t)}var NPe=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){bP(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){bP(n)}else bP(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){bP(r)}},e}(),xP=function(e){Cc(t,e);function t(r,n,o){var i=e.call(this)||this,s;if(Mo(r)||!r)s={next:r??void 0,error:n??void 0,complete:o??void 0};else{var a;i&&Dp.useDeprecatedNextContext?(a=Object.create(r),a.unsubscribe=function(){return i.unsubscribe()},s={next:r.next&&_4(r.next,a),error:r.error&&_4(r.error,a),complete:r.complete&&_4(r.complete,a)}):s=r}return i.destination=new NPe(s),i}return t}(f2);function bP(e){Dp.useDeprecatedSynchronousErrorHandling?cX(e):vP(e)}function FPe(e){throw e}function T4(e,t){var r=Dp.onStoppedNotification;r&&Yx.setTimeout(function(){return r(e,t)})}var OPe={closed:!0,next:A4,error:FPe,complete:A4};var Jx=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function tg(e){return e}function uX(e){return e.length===0?tg:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var Js=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this,i=GPe(t)?t:new xP(t,r,n);return Qx(function(){var s=o,a=s.operator,l=s.source;i.add(a?a.call(i,l):l?o._subscribe(i):o._trySubscribe(i))}),i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=dX(r),new r(function(o,i){var s=new xP({next:function(a){try{t(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});n.subscribe(s)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[Jx]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return uX(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=dX(t),new t(function(n,o){var i;r.subscribe(function(s){return i=s},function(s){return o(s)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function dX(e){var t;return(t=e??Dp.Promise)!==null&&t!==void 0?t:Promise}function VPe(e){return e&&Mo(e.next)&&Mo(e.error)&&Mo(e.complete)}function GPe(e){return e&&e instanceof f2||VPe(e)&&yP(e)}function UPe(e){return Mo(e?.lift)}function pl(e){return function(t){if(UPe(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ka(e,t,r,n,o){return new zPe(e,t,r,n,o)}var zPe=function(e){Cc(t,e);function t(r,n,o,i,s,a){var l=e.call(this,r)||this;return l.onFinalize=s,l.shouldUnsubscribe=a,l._next=n?function(c){try{n(c)}catch(u){r.error(u)}}:e.prototype._next,l._error=i?function(c){try{i(c)}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=o?function(){try{o()}catch(c){r.error(c)}finally{this.unsubscribe()}}:e.prototype._complete,l}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}(f2);var mX=hP(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var Vn=function(e){Cc(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new pX(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new mX},t.prototype.next=function(r){var n=this;Qx(function(){var o,i;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=eg(n.currentObservers),a=s.next();!a.done;a=s.next()){var l=a.value;l.next(r)}}catch(c){o={error:c}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},t.prototype.error=function(r){var n=this;Qx(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var o=n.observers;o.length;)o.shift().error(r)}})},t.prototype.complete=function(){var r=this;Qx(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,o=this,i=o.hasError,s=o.isStopped,a=o.observers;return i||s?I4:(this.currentObservers=null,a.push(r),new B0(function(){n.currentObservers=null,pb(a,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,o=n.hasError,i=n.thrownError,s=n.isStopped;o?r.error(i):s&&r.complete()},t.prototype.asObservable=function(){var r=new Js;return r.source=this,r},t.create=function(r,n){return new pX(r,n)},t}(Js);var pX=function(e){Cc(t,e);function t(r,n){var o=e.call(this)||this;return o.destination=r,o.source=n,o}return t.prototype.next=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.next)===null||o===void 0||o.call(n,r)},t.prototype.error=function(r){var n,o;(o=(n=this.destination)===null||n===void 0?void 0:n.error)===null||o===void 0||o.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,o;return(o=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&o!==void 0?o:I4},t}(Vn);var jo=function(e){Cc(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,o=r.thrownError,i=r._value;if(n)throw o;return this._throwIfClosed(),i},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(Vn);var E4={now:function(){return(E4.delegate||Date).now()},delegate:void 0};var fX=function(e){Cc(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return n===void 0&&(n=0),this},t}(B0);var h2={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=h2.delegate;return o?.setInterval?o.setInterval.apply(o,Pp([e,t],Ep(r))):setInterval.apply(void 0,Pp([e,t],Ep(r)))},clearInterval:function(e){var t=h2.delegate;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};var hX=function(e){Cc(t,e);function t(r,n){var o=e.call(this,r,n)||this;return o.scheduler=r,o.work=n,o.pending=!1,o}return t.prototype.schedule=function(r,n){var o;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,n)),this.pending=!0,this.delay=n,this.id=(o=this.id)!==null&&o!==void 0?o:this.requestAsyncId(s,this.id,n),this},t.prototype.requestAsyncId=function(r,n,o){return o===void 0&&(o=0),h2.setInterval(r.flush.bind(r,this),o)},t.prototype.recycleAsyncId=function(r,n,o){if(o===void 0&&(o=0),o!=null&&this.delay===o&&this.pending===!1)return n;n!=null&&h2.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var o=this._execute(r,n);if(o)return o;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var o=!1,i;try{this.work(r)}catch(s){o=!0,i=s||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),i},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,o=r.scheduler,i=o.actions;this.work=this.state=this.scheduler=null,this.pending=!1,pb(i,this),n!=null&&(this.id=this.recycleAsyncId(o,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(fX);var P4=function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=E4.now,e}();var gX=function(e){Cc(t,e);function t(r,n){n===void 0&&(n=P4.now);var o=e.call(this,r,n)||this;return o.actions=[],o._active=!1,o}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var o;this._active=!0;do if(o=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,o){for(;r=n.shift();)r.unsubscribe();throw o}},t}(P4);var g2=new gX(hX),yX=g2;var CP=new Js(function(e){return e.complete()});function SP(e){return e&&Mo(e.schedule)}function D4(e){return e[e.length-1]}function vX(e){return Mo(D4(e))?e.pop():void 0}function IP(e){return SP(D4(e))?e.pop():void 0}function bX(e,t){return typeof D4(e)=="number"?e.pop():t}var AP=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function wP(e){return Mo(e?.then)}function _P(e){return Mo(e[Jx])}function TP(e){return Symbol.asyncIterator&&Mo(e?.[Symbol.asyncIterator])}function EP(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function HPe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var PP=HPe();function DP(e){return Mo(e?.[PP])}function kP(e){return nX(this,arguments,function(){var r,n,o,i;return fP(this,function(s){switch(s.label){case 0:r=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,mb(r.read())];case 3:return n=s.sent(),o=n.value,i=n.done,i?[4,mb(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,mb(o)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function MP(e){return Mo(e?.getReader)}function Du(e){if(e instanceof Js)return e;if(e!=null){if(_P(e))return jPe(e);if(AP(e))return $Pe(e);if(wP(e))return WPe(e);if(TP(e))return xX(e);if(DP(e))return qPe(e);if(MP(e))return ZPe(e)}throw EP(e)}function jPe(e){return new Js(function(t){var r=e[Jx]();if(Mo(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function $Pe(e){return new Js(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function WPe(e){return new Js(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,vP)})}function qPe(e){return new Js(function(t){var r,n;try{for(var o=eg(e),i=o.next();!i.done;i=o.next()){var s=i.value;if(t.next(s),t.closed)return}}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}t.complete()})}function xX(e){return new Js(function(t){KPe(e,t).catch(function(r){return t.error(r)})})}function ZPe(e){return xX(kP(e))}function KPe(e,t){var r,n,o,i;return rX(this,void 0,void 0,function(){var s,a;return fP(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=oX(e),l.label=1;case 1:return[4,r.next()];case 2:if(n=l.sent(),!!n.done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),o={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(i=r.return)?[4,i.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function ku(e,t,r,n,o){n===void 0&&(n=0),o===void 0&&(o=!1);var i=t.schedule(function(){r(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(i),!o)return i}function RP(e,t){return t===void 0&&(t=0),pl(function(r,n){r.subscribe(ka(n,function(o){return ku(n,e,function(){return n.next(o)},t)},function(){return ku(n,e,function(){return n.complete()},t)},function(o){return ku(n,e,function(){return n.error(o)},t)}))})}function BP(e,t){return t===void 0&&(t=0),pl(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function CX(e,t){return Du(e).pipe(BP(t),RP(t))}function SX(e,t){return Du(e).pipe(BP(t),RP(t))}function IX(e,t){return new Js(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function AX(e,t){return new Js(function(r){var n;return ku(r,t,function(){n=e[PP](),ku(r,t,function(){var o,i,s;try{o=n.next(),i=o.value,s=o.done}catch(a){r.error(a);return}s?r.complete():r.next(i)},0,!0)}),function(){return Mo(n?.return)&&n.return()}})}function LP(e,t){if(!e)throw new Error("Iterable cannot be null");return new Js(function(r){ku(r,t,function(){var n=e[Symbol.asyncIterator]();ku(r,t,function(){n.next().then(function(o){o.done?r.complete():r.next(o.value)})},0,!0)})})}function wX(e,t){return LP(kP(e),t)}function _X(e,t){if(e!=null){if(_P(e))return CX(e,t);if(AP(e))return IX(e,t);if(wP(e))return SX(e,t);if(TP(e))return LP(e,t);if(DP(e))return AX(e,t);if(MP(e))return wX(e,t)}throw EP(e)}function y2(e,t){return t?_X(e,t):Du(e)}function TX(e){return e instanceof Date&&!isNaN(e)}function kp(e,t){return pl(function(r,n){var o=0;r.subscribe(ka(n,function(i){n.next(e.call(t,i,o++))}))})}var XPe=Array.isArray;function YPe(e,t){return XPe(t)?e.apply(void 0,Pp([],Ep(t))):e(t)}function EX(e){return kp(function(t){return YPe(e,t)})}var QPe=Array.isArray,JPe=Object.getPrototypeOf,e3e=Object.prototype,t3e=Object.keys;function PX(e){if(e.length===1){var t=e[0];if(QPe(t))return{args:t,keys:null};if(r3e(t)){var r=t3e(t);return{args:r.map(function(n){return t[n]}),keys:r}}}return{args:e,keys:null}}function r3e(e){return e&&typeof e=="object"&&JPe(e)===e3e}function DX(e,t){return e.reduce(function(r,n,o){return r[n]=t[o],r},{})}function k4(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=IP(e),n=vX(e),o=PX(e),i=o.args,s=o.keys;if(i.length===0)return y2([],r);var a=new Js(n3e(i,r,s?function(l){return DX(s,l)}:tg));return n?a.pipe(EX(n)):a}function n3e(e,t,r){return r===void 0&&(r=tg),function(n){kX(t,function(){for(var o=e.length,i=new Array(o),s=o,a=o,l=function(u){kX(t,function(){var d=y2(e[u],t),m=!1;d.subscribe(ka(n,function(p){i[u]=p,m||(m=!0,a--),a||n.next(r(i.slice()))},function(){--s||n.complete()}))},n)},c=0;c<o;c++)l(c)},n)}}function kX(e,t,r){e?ku(r,e,t):t()}function MX(e,t,r,n,o,i,s,a){var l=[],c=0,u=0,d=!1,m=function(){d&&!l.length&&!c&&t.complete()},p=function(f){return c<n?h(f):l.push(f)},h=function(f){i&&t.next(f),c++;var C=!1;Du(r(f,u++)).subscribe(ka(t,function(g){o?.(g),i?p(g):t.next(g)},function(){C=!0},void 0,function(){if(C)try{c--;for(var g=function(){var b=l.shift();s?ku(t,s,function(){return h(b)}):h(b)};l.length&&c<n;)g();m()}catch(b){t.error(b)}}))};return e.subscribe(ka(t,p,function(){d=!0,m()})),function(){a?.()}}function M4(e,t,r){return r===void 0&&(r=1/0),Mo(t)?M4(function(n,o){return kp(function(i,s){return t(n,i,o,s)})(Du(e(n,o)))},r):(typeof t=="number"&&(r=t),pl(function(n,o){return MX(n,o,e,r)}))}function RX(e){return e===void 0&&(e=1/0),M4(tg,e)}function BX(e,t,r){e===void 0&&(e=0),r===void 0&&(r=yX);var n=-1;return t!=null&&(SP(t)?r=t:n=t),new Js(function(o){var i=TX(e)?+e-r.now():e;i<0&&(i=0);var s=0;return r.schedule(function(){o.closed||(o.next(s++),0<=n?this.schedule(void 0,n):o.complete())},i)})}function im(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=IP(e),n=bX(e,1/0),o=e;return o.length?o.length===1?Du(o[0]):RX(n)(y2(o,r)):CP}function Bf(e,t){return pl(function(r,n){var o=0;r.subscribe(ka(n,function(i){return e.call(t,i,o++)&&n.next(i)}))})}function v2(e,t){return t===void 0&&(t=g2),pl(function(r,n){var o=null,i=null,s=null,a=function(){if(o){o.unsubscribe(),o=null;var c=i;i=null,n.next(c)}};function l(){var c=s+e,u=t.now();if(u<c){o=this.schedule(void 0,c-u),n.add(o);return}a()}r.subscribe(ka(n,function(c){i=c,s=t.now(),o||(o=t.schedule(l,e),n.add(o))},function(){a(),n.complete()},void 0,function(){i=o=null}))})}function R4(e){return e<=0?function(){return CP}:pl(function(t,r){var n=0;t.subscribe(ka(r,function(o){++n<=e&&(r.next(o),e<=n&&r.complete())}))})}function rg(e,t){return t===void 0&&(t=tg),e=e??o3e,pl(function(r,n){var o,i=!0;r.subscribe(ka(n,function(s){var a=t(s);(i||!e(o,a))&&(i=!1,o=a,n.next(s))}))})}function o3e(e,t){return e===t}function b2(e){return Bf(function(t,r){return e<=r})}function LX(e,t){return pl(function(r,n){var o=t??{},i=o.leading,s=i===void 0?!0:i,a=o.trailing,l=a===void 0?!1:a,c=!1,u=null,d=null,m=!1,p=function(){d?.unsubscribe(),d=null,l&&(C(),m&&n.complete())},h=function(){d=null,m&&n.complete()},f=function(g){return d=Du(e(g)).subscribe(ka(n,p,h))},C=function(){if(c){c=!1;var g=u;u=null,n.next(g),!m&&f(g)}};r.subscribe(ka(n,function(g){c=!0,u=g,!(d&&!d.closed)&&(s?C():f(g))},function(){m=!0,!(l&&c&&d&&!d.closed)&&n.complete()}))})}function fl(e,t,r){t===void 0&&(t=g2);var n=BX(e,t);return LX(function(){return n},r)}var Sc;(function(e){function t(){let r=new B4,n=()=>r.create();return n.dispose=()=>r.dispose(),n.behavior=o=>r.behavior(o),n}e.create=t})(Sc||(Sc={}));var B4=class{constructor(){this._eventList=[],this._disposed=!1}create(){let t=new Vn;return this._eventList.push(t),t}behavior(t){let r=new jo(t);return this._eventList.push(r),r}dispose(){if(!this._disposed){for(let t of this._eventList)t.complete();this._disposed=!0}}};var UX=Symbol.for("immer-nothing"),NX=Symbol.for("immer-draftable"),Ad=Symbol.for("immer-state");function Mp(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var eC=Object.getPrototypeOf;function tC(e){return!!e&&!!e[Ad]}function gb(e){return e?zX(e)||Array.isArray(e)||!!e[NX]||!!e.constructor?.[NX]||GP(e)||UP(e):!1}var i3e=Object.prototype.constructor.toString();function zX(e){if(!e||typeof e!="object")return!1;let t=eC(e);if(t===null)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===i3e}function NP(e,t){VP(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function VP(e){let t=e[Ad];return t?t.type_:Array.isArray(e)?1:GP(e)?2:UP(e)?3:0}function F4(e,t){return VP(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function HX(e,t,r){let n=VP(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function s3e(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function GP(e){return e instanceof Map}function UP(e){return e instanceof Set}function hb(e){return e.copy_||e.base_}function O4(e,t){if(GP(e))return new Map(e);if(UP(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let r=zX(e);if(t===!0||t==="class_only"&&!r){let n=Object.getOwnPropertyDescriptors(e);delete n[Ad];let o=Reflect.ownKeys(n);for(let i=0;i<o.length;i++){let s=o[i],a=n[s];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(n[s]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[s]})}return Object.create(eC(e),n)}else{let n=eC(e);if(n!==null&&r)return{...e};let o=Object.create(n);return Object.assign(o,e)}}function H4(e,t=!1){return zP(e)||tC(e)||!gb(e)||(VP(e)>1&&(e.set=e.add=e.clear=e.delete=a3e),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>H4(n,!0))),e}function a3e(){Mp(2)}function zP(e){return Object.isFrozen(e)}var l3e={};function yb(e){let t=l3e[e];return t||Mp(0,e),t}var x2;function jX(){return x2}function c3e(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function FX(e,t){t&&(yb("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function V4(e){G4(e),e.drafts_.forEach(u3e),e.drafts_=null}function G4(e){e===x2&&(x2=e.parent_)}function OX(e){return x2=c3e(x2,e)}function u3e(e){let t=e[Ad];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function VX(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return e!==void 0&&e!==r?(r[Ad].modified_&&(V4(t),Mp(4)),gb(e)&&(e=FP(t,e),t.parent_||OP(t,e)),t.patches_&&yb("Patches").generateReplacementPatches_(r[Ad].base_,e,t.patches_,t.inversePatches_)):e=FP(t,r,[]),V4(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==UX?e:void 0}function FP(e,t,r){if(zP(t))return t;let n=t[Ad];if(!n)return NP(t,(o,i)=>GX(e,n,t,o,i,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return OP(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let o=n.copy_,i=o,s=!1;n.type_===3&&(i=new Set(o),o.clear(),s=!0),NP(i,(a,l)=>GX(e,n,o,a,l,r,s)),OP(e,o,!1),r&&e.patches_&&yb("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function GX(e,t,r,n,o,i,s){if(tC(o)){let a=i&&t&&t.type_!==3&&!F4(t.assigned_,n)?i.concat(n):void 0,l=FP(e,o,a);if(HX(r,n,l),tC(l))e.canAutoFreeze_=!1;else return}else s&&r.add(o);if(gb(o)&&!zP(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;FP(e,o),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&OP(e,o)}}function OP(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&H4(t,r)}function d3e(e,t){let r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:jX(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},o=n,i=j4;r&&(o=[n],i=C2);let{revoke:s,proxy:a}=Proxy.revocable(o,i);return n.draft_=a,n.revoke_=s,a}var j4={get(e,t){if(t===Ad)return e;let r=hb(e);if(!F4(r,t))return m3e(e,r,t);let n=r[t];return e.finalized_||!gb(n)?n:n===L4(e.base_,t)?(N4(e),e.copy_[t]=z4(n,e)):n},has(e,t){return t in hb(e)},ownKeys(e){return Reflect.ownKeys(hb(e))},set(e,t,r){let n=$X(hb(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let o=L4(hb(e),t),i=o?.[Ad];if(i&&i.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(s3e(r,o)&&(r!==void 0||F4(e.base_,t)))return!0;N4(e),U4(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return L4(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,N4(e),U4(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let r=hb(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){Mp(11)},getPrototypeOf(e){return eC(e.base_)},setPrototypeOf(){Mp(12)}},C2={};NP(j4,(e,t)=>{C2[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});C2.deleteProperty=function(e,t){return C2.set.call(this,e,t,void 0)};C2.set=function(e,t,r){return j4.set.call(this,e[0],t,r,e[0])};function L4(e,t){let r=e[Ad];return(r?hb(r):e)[t]}function m3e(e,t,r){let n=$X(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function $X(e,t){if(!(t in e))return;let r=eC(e);for(;r;){let n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=eC(r)}}function U4(e){e.modified_||(e.modified_=!0,e.parent_&&U4(e.parent_))}function N4(e){e.copy_||(e.copy_=O4(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var p3e=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){let i=r;r=t;let s=this;return function(l=i,...c){return s.produce(l,u=>r.call(this,u,...c))}}typeof r!="function"&&Mp(6),n!==void 0&&typeof n!="function"&&Mp(7);let o;if(gb(t)){let i=OX(this),s=z4(t,void 0),a=!0;try{o=r(s),a=!1}finally{a?V4(i):G4(i)}return FX(i,n),VX(o,i)}else if(!t||typeof t!="object"){if(o=r(t),o===void 0&&(o=t),o===UX&&(o=void 0),this.autoFreeze_&&H4(o,!0),n){let i=[],s=[];yb("Patches").generateReplacementPatches_(t,o,i,s),n(i,s)}return o}else Mp(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(s,...a)=>this.produceWithPatches(s,l=>t(l,...a));let n,o;return[this.produce(t,r,(s,a)=>{n=s,o=a}),n,o]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){gb(e)||Mp(8),tC(e)&&(e=f3e(e));let t=OX(this),r=z4(e,void 0);return r[Ad].isManual_=!0,G4(t),r}finishDraft(e,t){let r=e&&e[Ad];(!r||!r.isManual_)&&Mp(9);let{scope_:n}=r;return FX(n,t),VX(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let o=t[r];if(o.path.length===0&&o.op==="replace"){e=o.value;break}}r>-1&&(t=t.slice(r+1));let n=yb("Patches").applyPatches_;return tC(e)?n(e,t):this.produce(e,o=>n(o,t))}};function z4(e,t){let r=GP(e)?yb("MapSet").proxyMap_(e,t):UP(e)?yb("MapSet").proxySet_(e,t):d3e(e,t);return(t?t.scope_:jX()).drafts_.push(r),r}function f3e(e){return tC(e)||Mp(10,e),WX(e)}function WX(e){if(!gb(e)||zP(e))return e;let t=e[Ad],r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=O4(e,t.scope_.immer_.useStrictShallowCopy_)}else r=O4(e,!0);return NP(r,(n,o)=>{HX(r,n,WX(o))}),t&&(t.finalized_=!1),r}var wd=new p3e,Jl=wd.produce,B0t=wd.produceWithPatches.bind(wd),qX=wd.setAutoFreeze.bind(wd),L0t=wd.setUseStrictShallowCopy.bind(wd),N0t=wd.applyPatches.bind(wd),F0t=wd.createDraft.bind(wd),O0t=wd.finishDraft.bind(wd);var L0;(function(e){function t(s){if(!s.state||s.state.tree===s.editInfo.sourceTree)return s.tree.asImmutable();let a=s.state.tree.asTransient();for(let l of s.actions)switch(l.kind){case"add":a.add(l.transform);break;case"update":a.setParams(l.ref,l.params);break;case"delete":a.remove(l.ref);break;case"insert":{let c=a.children.get(l.ref).toArray();a.add(l.transform);for(let u of c)a.changeParent(u,l.transform.ref);break}}return s.editInfo.sourceTree=s.tree,a.asImmutable()}function r(s){return!!s&&typeof s.getTree=="function"}e.is=r;function n(s){return!!s&&typeof s.getTree=="function"&&typeof s.ref=="string"}e.isTo=n;class o{get editInfo(){return this.state.editInfo}get currentTree(){return this.state.tree}to(a){let l=typeof a=="string"?a:Dx.is(a)?a.transform.ref:a.ref;return new i(this.state,l,this)}toRoot(){return new i(this.state,this.state.tree.root.ref,this)}delete(a){let l=Jn.resolveRef(a);return!l||!this.state.tree.transforms.has(l)?this:(this.editInfo.count++,this.state.tree.remove(l),this.state.actions.push({kind:"delete",ref:l}),this)}getTree(){return t(this.state)}commit(a){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,a))}constructor(a,l){this.state={state:l,tree:a.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:a,count:0,lastUpdate:void 0}}}}e.Root=o;class i{get editInfo(){return this.state.editInfo}get selector(){return new kx(this.ref,this.state.state)}getApplyRoot(){return mi.getDecoratorRoot(this.state.tree,this.ref)}apply(a,l,c){if(a.definition.isDecorator)return this.insert(a,l,c);let u=this.getApplyRoot(),d=a.apply(u,l,c);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new i(this.state,d.ref,this.root)}applyOrUpdate(a,l,c,u){if(this.state.tree.transforms.has(a)){let d=this.to(a);return c&&d.update(c),d}else return this.apply(l,c,{...u,ref:a})}applyOrUpdateTagged(a,l,c,u){if(l.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");let d=this.getApplyRoot(),m=this.state.tree.children.get(d).values();for(;;){let h=m.next();if(h.done)break;let f=this.state.tree.transforms.get(h.value);if(f&&xr.hasTags(f,a)){let C=this.to(h.value);return C.updateTagged(c,ZX(f.tags,a,u&&u.tags)),C}}let p=l.apply(d,c,{...u,tags:ZX(a,u&&u.tags)});return this.state.tree.add(p),this.editInfo.count++,this.editInfo.lastUpdate=p.ref,this.state.actions.push({kind:"add",transform:p}),new i(this.state,p.ref,this.root)}group(a,l,c){return this.apply(a,l,c)}insert(a,l,c){let u=this.state.tree.children.get(this.ref).toArray(),d=a.apply(this.ref,l,c);this.state.tree.add(d);for(let m of u)this.state.tree.changeParent(m,d.ref);return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new i(this.state,d.ref,this.root)}updateTagged(a,l){(this.state.tree.setParams(this.ref,a)||this.state.tree.setTags(this.ref,l))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:a}))}update(a,l){let c;if(l){let u=this.state.tree.transforms.get(this.ref);c=Jl(u.params,l)}else c=typeof a=="function"?Jl(this.state.tree.transforms.get(this.ref).params,a):a;return this.state.tree.setParams(this.ref,c)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:c})),this.root}to(a){return this.root.to(a)}toRoot(){return this.root.toRoot()}delete(a){return this.root.delete(a)}getTree(){return t(this.state)}commit(a){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,a))}constructor(a,l,c){if(this.state=a,this.root=c,this.ref=l,!this.state.tree.transforms.has(l))throw new Error(`Could not find node '${l}'.`)}}e.To=i})(L0||(L0={}));function ZX(...e){let t,r=[];for(let n of e)if(n)if(t||(t=new Set),typeof n=="string"){if(t.has(n))continue;t.add(n),r.push(n)}else for(let o of n)t.has(o)||(t.add(o),r.push(o));return r}var HP=class{constructor(){this.ev=Sc.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}add(t){let r=st.is(t)?t.toAction():t;if(this.actions.has(r.id))return this;this.actions.set(r.id,r);for(let n of r.definition.from)this.fromTypeIndex.has(n.type)?this.fromTypeIndex.get(n.type).push(r):this.fromTypeIndex.set(n.type,[r]);return this.events.added.next(void 0),this}remove(t){let r=st.is(t)?t.toAction().id:jr.is(t)?t:t.id,n=this.actions.get(r);if(!n)return this;this.actions.delete(r);for(let o of n.definition.from){let i=this.fromTypeIndex.get(o.type);i&&(om(i,n),i.length===0&&this.fromTypeIndex.delete(o.type))}return this.events.removed.next(void 0),this}fromCell(t,r){let n=t.obj;if(!n)return[];let o=this.fromTypeIndex.get(n.type);if(!o)return[];let i=!1;for(let a of o)if(a.definition.isApplicable){i=!0;break}if(!i)return o;let s=[];for(let a of o)a.definition.isApplicable?a.definition.isApplicable(n,t.transform,r)&&s.push(a):s.push(a);return s}dispose(){this.ev.dispose()}};var sm;(function(e){function t(i){return{type:"message",timestamp:new Date,message:i}}e.message=t;function r(i){return{type:"error",timestamp:new Date,message:i}}e.error=r;function n(i){return{type:"warning",timestamp:new Date,message:i}}e.warning=n;function o(i){return{type:"info",timestamp:new Date,message:i}}e.info=o})(sm||(sm={}));var N0;(function(e){class t{get current(){return this._current}set current(i){this._current=i}getAncestorOfType(i){if(!this._current)return;let s=this._current;for(;;){if(s=this.cells.get(s.transform.parent),!s.obj)return;if(s.obj.type===i.type)return s.obj;if(s.transform.ref===xr.RootRef)return}}getRootOfType(i){if(!this._current)return;let s=this._current,a;for(;;){if(!s.obj)return;if(s.obj.type===i.type&&(a=s),s.transform.ref===xr.RootRef)return a?a.obj:void 0;s=this.cells.get(s.transform.parent)}}constructor(i){this.cells=i,this._current=void 0}}e.Impl=t;function r(o,i){let s=o.cells,a=s.get(i),l=[a];for(;a?.transform.transformer.definition.isDecorator;)a=s.get(a.transform.parent),l.push(a);return l}e.getDecoratorChain=r;function n(o,i,s){let a,l=o.cells.get(s);if(l)for(;;){if(!l.obj)return;if(l.obj.type===i.type&&(a=l),l.transform.ref===xr.RootRef)return a?a.obj:void 0;l=o.cells.get(l.transform.parent)}}e.getRootOfType=n})(N0||(N0={}));var jP=class{constructor(){this.queue=[],this.signal=new Vn}get length(){return this.queue.length}enqueue(t){return this.queue.push(t),this.queue.length===1?!0:this.waitFor(t)}handled(t){Jh(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})}remove(t){let r=Jh(this.queue,t);return r&&this.signal.next({v:t,stillPresent:!1}),r}waitFor(t){return new Promise(r=>{let n=this.signal.subscribe(({v:o,stillPresent:i})=>{o===t&&(n.unsubscribe(),r(i))})})}};var $4=class{add(t){let r=this.getHash(t);if(this.byHash.has(r)){let n=this.byHash.get(r);for(let o=0,i=n.length;o<i;o++)if(this.areEqual(t,n[o]))return!1;return n[n.length]=t,this.size++,!0}else return this.byHash.set(r,[t]),this.size++,!0}has(t){let r=this.getHash(t);if(!this.byHash.has(r))return!1;let n=this.byHash.get(r);for(let o=0,i=n.length;o<i;o++)if(this.areEqual(t,n[o]))return!0;return!1}constructor(t,r){this.getHash=t,this.areEqual=r,this.size=0,this.byHash=new Map}};function rC(e,t){return new $4(e,t)}function S2(){return new W4}function KX(e){return{previous:null,next:null,inList:!0,value:e}}var W4=class{constructor(){this.count=0,this.first=null,this.last=null}addFirst(t){let r=KX(t);return r.inList=!0,this.first&&(this.first.previous=r),r.next=this.first,this.first=r,this.count++,this.last||(this.last=r),r}addLast(t){let r=KX(t);return this.last!==null&&(this.last.next=r),r.previous=this.last,this.last=r,this.first===null&&(this.first=r),r.inList=!0,this.count++,r}removeFirst(){let t=this.first;if(t)return this.remove(t),t.value}removeLast(){let t=this.last;if(t)return this.remove(t),t.value}remove(t){t.inList&&(t.inList=!1,t.previous!==null?t.previous.next=t.next:t.previous===null&&(this.first=t.next),t.next!==null?t.next.previous=t.previous:t.next===null&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)}find(t){let r=this.first;for(;r!==null;){if(r.value===t)return r;r=r.next}}};var vn;(function(e){function t(){return{keys:new Set,array:[]}}e.create=t;function r({keys:o,array:i},s,a){return o.has(s)?!1:(o.add(s),i[i.length]=a,!0)}e.add=r;function n({keys:o},i){return o.has(i)}e.has=n})(vn||(vn={}));var Mu=class{get tree(){return this._tree}get transforms(){return this._tree.transforms}get current(){return this.behaviors.currentObject.value.ref}get root(){return this.cells.get(this._tree.root.ref)}build(){return new L0.Root(this.tree,this)}addHistory(t,r){this.historyCapacity!==0&&(this.history.unshift([t,r||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))}clearHistory(){this.history.length!==0&&(this.history=[],this.events.historyUpdated.next({state:this}))}get latestUndoLabel(){return this.history.length>0?this.history[0][1]:void 0}get canUndo(){return this.history.length>0}undo(){return ke.create("Undo",async t=>{let r=this.history.shift();if(r){this.events.historyUpdated.next({state:this}),this.undoingHistory=!0;try{await this.updateTree(r[0],{canUndo:!1}).runInContext(t)}finally{this.undoingHistory=!1}}})}getSnapshot(){return{tree:mi.toJSON(this._tree)}}setSnapshot(t){let r=mi.fromJSON(t.tree);return this.updateTree(r)}setCurrent(t){this.behaviors.currentObject.next({state:this,ref:t})}updateCellState(t,r){let n=this.cells.get(t);if(!n)return;let o=typeof r=="function"?r(n.state):r;xr.assignState(n.state,o)&&(n.transform=this._tree.assignState(n.transform.ref,o),this.events.cell.stateUpdated.next({state:this,ref:t,cell:n}))}dispose(){this.ev.dispose(),this.actions.dispose()}select(t){return Kt.select(t,this)}selectQ(t){return typeof t=="string"?Kt.select(t,this):Kt.select(t(Kt.Generators),this)}applyAction(t,r,n=xr.RootRef){return ke.create("Apply Action",o=>{let i=this.cells.get(n);if(!i)throw new Error(`'${n}' does not exist.`);if(i.status!=="ok")throw new Error(`Action cannot be applied to a cell with status '${i.status}'`);return K4(t.definition.run({ref:n,cell:i,a:i.obj,params:r,state:this},this.globalContext),o)})}transaction(t,r){return ke.create("State Transaction",async n=>{let o=this.inTransaction,i=this._tree.asImmutable(),s=!1;try{o||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,await t(n),this.inTransactionError&&(s=!0,await this.updateTree(i).runInContext(n))}catch(a){if(s||(s=!0,await this.updateTree(i).runInContext(n),this.events.log.next(sm.error("Error during state transaction, reverting"))),o)throw this.inTransactionError=!0,a;if(r?.rethrowErrors)throw a}finally{o||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),s||(r?.canUndo?this.addHistory(i,typeof r.canUndo=="string"?r.canUndo:void 0):this.clearHistory()))}})}get inUpdate(){return this._inUpdate}updateTree(t,r){let n={tree:t,options:r};return ke.create("Update Tree",async o=>{if(!await this.updateQueue.enqueue(n))return;this._inUpdate=!0;let s=r?.canUndo?this._tree.asImmutable():void 0,a=!1;this.inTransaction||this.behaviors.isUpdating.next(!0);try{if(L0.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}this.reverted=!1;let l=r&&(r.revertIfAborted||r.revertOnError)?await this._revertibleTreeUpdate(o,n,r):await this._updateTree(o,n);return a=this.reverted,l.ctx.hadError&&(this.inTransactionError=!0),l.cell?new kx(l.cell.transform.ref,this):void 0}finally{this._inUpdate=!1,this.updateQueue.handled(n),this.inTransaction||(this.behaviors.isUpdating.next(!1),r?.canUndo?a||this.addHistory(s,typeof r.canUndo=="string"?r.canUndo:void 0):this.undoingHistory||this.clearHistory())}},()=>{this.updateQueue.remove(n)})}async _revertibleTreeUpdate(t,r,n){let o=this.tree,i=await this._updateTree(t,r);return(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted?(this.reverted=!0,await this._updateTree(t,{tree:o,options:r.options})):i}async _updateTree(t,r){let n=!1,o=this.updateTreeAndCreateCtx(r.tree,t,r.options);try{if(n=await y3e(o),L0.isTo(r.tree)){let i=this.select(r.tree.ref)[0];return{ctx:o,cell:i}}return{ctx:o}}finally{this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction})}}updateTreeAndCreateCtx(t,r,n){let o=(L0.is(t)?t.getTree():t).asTransient(),i=this._tree;this._tree=o;let s=this.cells,a={parent:this,editInfo:L0.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:r,oldTree:i,tree:o,cells:this.cells,spine:this.spine,results:[],options:{...g3e,...n},changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:l=>{var c;return(c=s.get(l).obj)===null||c===void 0?void 0:c.data}};return this.errorFree=!0,a}constructor(t,r){this.errorFree=!0,this.ev=Sc.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:xr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new HP,this.cells=new Map,this.spine=new N0.Impl(this.cells),this.tryGetCellData=i=>{var s,a;let l=(a=(s=this.cells.get(i))===null||s===void 0?void 0:s.obj)===null||a===void 0?void 0:a.data;if(l===void 0)throw new Error(`Cell '${i}' data undefined.`);return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new jP,this._tree=mi.createEmpty(xr.createRoot(r&&r.rootState)).asTransient();let o=this._tree.root;this.runTask=r.runTask,r?.historyCapacity!==void 0&&(this.historyCapacity=r.historyCapacity),this.cells.set(o.ref,{parent:this,transform:o,sourceRef:void 0,obj:t,status:"ok",state:{...o.state},errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:o.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=r&&r.globalContext}};(function(e){function t(n,o){return new e(n,o)}e.create=t;let r;(function(n){function o(i,s){return!!s&&i.ref===s.transform.ref&&i.state===s.parent}n.isCell=o})(r=e.ObjectEvent||(e.ObjectEvent={}))})(Mu||(Mu={}));var g3e={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};async function y3e(e){let t=!!(e.editInfo&&e.editInfo.count===1&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree),r,n=[],o;if(t)r=[],o=[e.editInfo.lastUpdate];else{r=C3e(e);let a=e.parent.current,l=!1;for(let c of r)if(c===a){l=!0;break}if(l){let c=XX(e.oldTree,a,r,e.cells);e.parent.setCurrent(c)}for(let c=r.length-1;c>=0;c--){let u=e.cells.get(r[c]);u&&$P(u.transform,u.obj,u?.transform.params,u.cache,e.parent.globalContext)}for(let c of r){let u=e.cells.get(c);u&&(u.parent=void 0,_3e(u));let d=u&&u.obj;e.cells.delete(c),n.push(d)}o=v3e(e.cells,e.tree)}let i=P3e(e,o);for(let a of i.added)e.parent.events.cell.created.next({state:e.parent,ref:a.transform.ref,cell:a});for(let a=0;a<r.length;a++){let l=r[a],c=e.oldTree.transforms.get(l).parent;e.parent.events.object.removed.next({state:e.parent,ref:l,obj:n[a]}),e.parent.events.cell.removed.next({state:e.parent,ref:l,parent:c})}if(n.length&&(n=[]),i.dependent)for(let a of i.dependent)o.push(a.transform.ref);w3e(e,o);for(let a of o)await JX(e,a);e.editInfo||I3e(e);let s=e.newCurrent;for(let a of e.results)a.action==="created"?(e.parent.events.object.created.next({state:e.parent,ref:a.ref,obj:a.obj}),e.newCurrent||!e.tree.transforms.get(a.ref).state.isGhost&&a.obj!==Hn.Null&&(s=a.ref)):a.action==="updated"?e.parent.events.object.updated.next({state:e.parent,ref:a.ref,action:"in-place",obj:a.obj,oldData:a.oldData}):a.action==="replaced"&&e.parent.events.object.updated.next({state:e.parent,ref:a.ref,action:"recreate",obj:a.obj,oldObj:a.oldObj});if(s)e.options.doNotUpdateCurrent||e.parent.setCurrent(s);else{let a=e.parent.current,l=e.cells.get(a);l&&(l.obj===Hn.Null||l.status==="error"&&l.errorText===D3e)&&(s=XX(e.oldTree,a,[],e.cells),e.parent.setCurrent(s))}return r.length>0||o.length>0||e.changed}function v3e(e,t){let r={roots:[],cells:e};return mi.doPreOrder(t,t.root,r,b3e),r.roots}function b3e(e,t,r){let n=r.cells.get(e.ref);return!n||n.transform.version!==e.version?(r.roots.push(e.ref),!1):!(n.status==="error"||n&&n.obj===Hn.Null)}function x3e(e,t,r){!r.newTree.transforms.has(e.ref)&&r.cells.has(e.ref)&&r.deletes.push(e.ref)}function C3e(e){let t={newTree:e.tree,cells:e.cells,deletes:[]};return mi.doPostOrder(e.oldTree,e.oldTree.root,t,x3e),t.deletes}function S3e(e,t,r){let n=r.cells.get(e.ref);!n||!xr.syncState(n.state,e.state)||r.parent.events.cell.stateUpdated.next({state:r.parent,ref:e.ref,cell:n})}function I3e(e){mi.doPreOrder(e.tree,e.tree.root,e,S3e)}function WP(e,t,r,n){let o=e.cells.get(t),i=o.status!==r;o.status=r,o.errorText=n,i&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:o})}function A3e(e,t,r){r.cells.get(e.ref).transform=e,WP(r,e.ref,"pending")}function w3e(e,t){for(let r of t)mi.doPreOrder(e.tree,e.tree.transforms.get(r),e,A3e)}function _3e(e){for(let t of e.dependencies.dependsOn)om(t.dependencies.dependentBy,e)}function T3e(e,t,{ctx:r,added:n,visited:o}){if(o.add(e.ref),r.cells.has(e.ref))return;let i={parent:r.parent,transform:e,sourceRef:void 0,status:"pending",state:{...e.state},errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};r.cells.set(e.ref,i),n.push(i)}function E3e(e,t){if(e.transform.dependsOn)for(let r of e.transform.dependsOn){if(!t.tree.transforms.get(r))throw new Error("Cannot depend on a non-existent transform.");let o=t.cells.get(r);Ho(e.dependencies.dependsOn,o),Ho(o.dependencies.dependentBy,e)}}function P3e(e,t){let r={ctx:e,visited:new Set,added:[]};for(let o of t)mi.doPreOrder(e.tree,e.tree.transforms.get(o),r,T3e);for(let o of r.added)E3e(o,e);let n;return r.visited.forEach(o=>{let i=e.cells.get(o);for(let s of i.dependencies.dependentBy)r.visited.has(s.transform.ref)||(n||(n=vn.create()),vn.add(n,s.transform.ref,s))}),{added:r.added,dependent:n?n.array:void 0}}function XX(e,t,r,n){let o=new Set(r);return QX(e,t,o,n)}function QX(e,t,r,n){if(t===xr.RootRef)return t;let o=e.transforms.get(t),i=e.children.get(o.parent).values(),s,a=!1;for(;;){let l=i.next();if(l.done)break;if(r.has(l.value))continue;let c=n.get(l.value);if(!c||c.status==="error"||c.obj===Hn.Null)continue;let u=e.transforms.get(l.value);if(!u.state.isGhost){if(l.value===t){a=!0,r.has(t)||(s=t);continue}if(a)return u.ref;s=u.ref}}return s||QX(e,o.parent,r,n)}function Z4(e,t,r,n){n||(e.hadError=!0,e.parent.errorFree=!1);let o=e.cells.get(t);if(r){e.wasAborted=e.wasAborted||ke.isAbort(r);let s=""+r;WP(e,t,"error",s),n||e.parent.events.log.next({type:"error",timestamp:new Date,message:s})}else o.params=void 0;if(o.obj){let s=o.obj;o.obj=void 0,o.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:s})}let i=e.tree.children.get(t).values();for(;;){let s=i.next();if(s.done)return;Z4(e,s.value,void 0,n)}}var D3e="Parent is null";async function JX(e,t){WP(e,t,"processing");let r=!1;try{let o=Zn(),i=await M3e(e,t),s=Zn()-o;i.action!=="none"&&(e.changed=!0),WP(e,t,"ok"),e.results.push(i),i.action==="created"?(r=i.obj===Hn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(sm.info(`Created ${i.obj.label} in ${yx(s)}.`))):i.action==="updated"?(r=i.obj===Hn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(sm.info(`Updated ${i.obj.label} in ${yx(s)}.`))):i.action==="replaced"&&(r=i.obj===Hn.Null,!r&&!e.options.doNotLogTiming&&e.parent.events.log.next(sm.info(`Updated ${i.obj.label} in ${yx(s)}.`)))}catch(o){e.changed=!0,e.hadError||(e.newCurrent=t),Z4(e,t,o,!1);return}let n=e.tree.children.get(t).values();for(;;){let o=n.next();if(o.done)return;r?Z4(e,o.value,void 0,!0):await JX(e,o.value)}}function k3e(e,t,r,n){let o=t.transformer.definition.params,i=o?o(r,e.parent.globalContext):{};if(n.paramsNormalizedVersion!==t.version)t.params=M.normalizeParams(i,t.params,"all"),n.paramsNormalizedVersion=t.version;else{let s=M.getDefaultValues(i);t.params=t.params?SK(t.params,s):s}return M.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}async function M3e(e,t){var r;let{oldTree:n,tree:o}=e,i=e.cells.get(t),s=i.transform;if(i.transform.ref===xr.RootRef)return{action:"none"};let a=e.cells.get(i.transform.parent);if(a?.obj===Hn.Null)if(i.sourceRef=a.transform.ref,n.transforms.has(t)&&i.params){let m=i.params.values,p=i.cache;return $P(s,i.obj,m,p,e.parent.globalContext),i.params=void 0,i.obj=Hn.Null,{ref:t,action:"updated",obj:i.obj}}else return i.params=void 0,{ref:t,action:"created",obj:Hn.Null};let c=s.transformer.definition.from.length===0?a:Kt.findAncestorOfType(o,e.cells,t,s.transformer.definition.from);if(!c)throw new Error(`No suitable parent found for '${t}'`);e.spine.current=i;let u=c.obj;i.sourceRef=c.transform.ref;let d=k3e(e,s,u,i);if(!n.transforms.has(t)||!i.params){i.params=d;let m=await YX(e,i,s.transformer,u,d.values);return q4(m,s),i.obj=m,{ref:t,action:"created",obj:m}}else{let m=i.params.values,p=i.cache,h=(r=i.obj)===null||r===void 0?void 0:r.data,f=d.values;switch(i.params=d,i.obj&&i.obj!==Hn.Null?await R3e(e,i,s.transformer,u,i.obj,m,f):st.UpdateResult.Recreate){case st.UpdateResult.Recreate:{let g=i.obj;$P(s,g,m,p,e.parent.globalContext);let b=await YX(e,i,s.transformer,u,f);return q4(b,s),i.obj=b,{ref:t,action:"replaced",oldObj:g,obj:b}}case st.UpdateResult.Updated:return q4(i.obj,s),{ref:t,action:"updated",oldData:h,obj:i.obj};case st.UpdateResult.Null:return $P(s,i.obj,m,p,e.parent.globalContext),i.obj=Hn.Null,{ref:t,action:"updated",obj:i.obj};default:return{action:"none"}}}}function $P(e,t,r,n,o){var i,s;(s=(i=e.transformer.definition).dispose)===null||s===void 0||s.call(i,{b:t!==Hn.Null?t:void 0,params:r,cache:n},o)}function q4(e,t){!e||e===Hn.Null||(e.tags=t.tags)}function K4(e,t){return typeof e.runInContext=="function"?e.runInContext(t):e}function eY(e){if(e.dependencies.dependsOn.length===0)return;let t=Object.create(null);for(let r of e.dependencies.dependsOn){if(!r.obj)throw new Error("Unresolved dependency.");t[r.transform.ref]=r.obj}return t}function YX(e,t,r,n,o){return t.cache||(t.cache=Object.create(null)),K4(r.definition.apply({a:n,params:o,cache:t.cache,spine:e.spine,dependencies:eY(t)},e.parent.globalContext),e.taskCtx)}async function R3e(e,t,r,n,o,i,s){return r.definition.update?(t.cache||(t.cache=Object.create(null)),K4(r.definition.update({a:n,oldParams:i,b:o,newParams:s,cache:t.cache,spine:e.spine,dependencies:eY(t)},e.parent.globalContext),e.taskCtx)):st.UpdateResult.Recreate}var fe;(function(e){e.Create=Hn.factory();function t(m){return!!m&&m.type.typeClass==="Representation3D"}e.isRepresentation3D=t;function r(m){return!!m&&m.type.typeClass==="Behavior"}e.isBehavior=r;function n(m){return e.Create({...m,typeClass:"Representation3D"})}e.CreateRepresentation3D=n;function o(m){return e.Create({...m,typeClass:"Behavior"})}e.CreateBehavior=o;class i extends e.Create({name:"Root",typeClass:"Root"}){}e.Root=i;class s extends e.Create({name:"Group",typeClass:"Group"}){}e.Group=s;let a;(function(m){class p extends e.Create({name:"String Data",typeClass:"Data"}){}m.String=p;class h extends e.Create({name:"Binary Data",typeClass:"Data"}){}m.Binary=h;class f extends e.Create({name:"Data Blob",typeClass:"Data"}){}m.Blob=f})(a=e.Data||(e.Data={}));let l;(function(m){class p extends e.Create({name:"JSON Data",typeClass:"Data"}){}m.Json=p;class h extends e.Create({name:"CIF File",typeClass:"Data"}){}m.Cif=h;class f extends e.Create({name:"Cube File",typeClass:"Data"}){}m.Cube=f;class C extends e.Create({name:"PSF File",typeClass:"Data"}){}m.Psf=C;class g extends e.Create({name:"PRMTOP File",typeClass:"Data"}){}m.Prmtop=g;class b extends e.Create({name:"TOP File",typeClass:"Data"}){}m.Top=b;class y extends e.Create({name:"PLY File",typeClass:"Data"}){}m.Ply=y;class x extends e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"}){}m.Ccp4=x;class A extends e.Create({name:"DSN6/BRIX File",typeClass:"Data"}){}m.Dsn6=A;class v extends e.Create({name:"DX File",typeClass:"Data"}){}m.Dx=v;class _ extends e.Create({name:"Format Blob",typeClass:"Data"}){}m.Blob=_})(l=e.Format||(e.Format={}));let c;(function(m){class p extends e.Create({name:"Coordinates",typeClass:"Object"}){}m.Coordinates=p;class h extends e.Create({name:"Topology",typeClass:"Object"}){}m.Topology=h;class f extends e.Create({name:"Model",typeClass:"Object"}){}m.Model=f;class C extends e.Create({name:"Trajectory",typeClass:"Object"}){}m.Trajectory=C;class g extends e.Create({name:"Structure",typeClass:"Object"}){}m.Structure=g,function(b){class y extends n({name:"Structure 3D"}){}b.Representation3D=y;class x extends e.Create({name:"Structure 3D State",typeClass:"Object"}){}b.Representation3DState=x;class A extends e.Create({name:"Selections",typeClass:"Object"}){}b.Selections=A}(g=m.Structure||(m.Structure={}))})(c=e.Molecule||(e.Molecule={}));let u;(function(m){class p extends e.Create({name:"Volume",typeClass:"Object"}){}m.Data=p;class h extends e.Create({name:"Lazy Volume",typeClass:"Object"}){}m.Lazy=h;class f extends n({name:"Volume 3D"}){}m.Representation3D=f})(u=e.Volume||(e.Volume={}));let d;(function(m){class p extends e.Create({name:"Shape Provider",typeClass:"Object"}){}m.Provider=p;class h extends n({name:"Shape 3D"}){}m.Representation3D=h})(d=e.Shape||(e.Shape={}))})(fe||(fe={}));var Lt;(function(e){e.CreateBuiltIn=st.factory("ms-plugin"),e.BuiltIn=st.builderFactory("ms-plugin")})(Lt||(Lt={}));var tY=.529177210859;function B3e(e){let t=Tt.readLines(e,6),r=(b,y)=>{let x=+t[b].trim().split(/\s+/g)[y];return Number.isNaN(x)?0:x},n=b=>{let y=r(b+2,0),x=tY;return[Math.abs(y),D.create(r(b+2,1)*x,r(b+2,2)*x,r(b+2,3)*x),y]},o=t[0].trim(),i=t[1].trim(),[s,a,l]=n(0),[c,u]=n(1),[d,m]=n(2),[p,h]=n(3),f=L3e(e,s,tY),C=[];if(l>=0){let b=r(2,4);b===0&&(b=1);for(let y=0;y<b;y++)C.push(y)}else{let b=Tt.readLine(e).trim().split(/\s+/g);for(let y=0,x=+b[0];y<x;y++)C.push(+b[y+1])}return{header:{orbitals:l<0,comment1:o,comment2:i,atomCount:s,origin:a,dim:D.create(c,d,p),basisX:u,basisY:m,basisZ:h,dataSetIds:C},atoms:f}}function L3e(e,t,r){let n=new Int32Array(t),o=new Float64Array(t),i=new Float32Array(t),s=new Float32Array(t),a=new Float32Array(t);for(let l=0;l<t;l++){let c=Tt.readLine(e).trim().split(/\s+/g);n[l]=+c[0],o[l]=+c[1],i[l]=+c[2]*r,s[l]=+c[3]*r,a[l]=+c[4]*r}return{count:t,number:ue.ofArray({array:n,schema:ue.Schema.int}),nuclearCharge:ue.ofArray({array:o,schema:ue.Schema.float}),x:ue.ofArray({array:i,schema:ue.Schema.float}),y:ue.ofArray({array:s,schema:ue.Schema.float}),z:ue.ofArray({array:a,schema:ue.Schema.float})}}function N3e(e,t,r){let n=r.dim[0]*r.dim[1]*r.dim[2]*r.dataSetIds.length,o=100*100*100,i=new Float64Array(n),s=0;return yc(e,o,i,(a,l)=>{let c=Math.min(n,s+a);for(let u=s;u<c;u++)Tt.skipWhitespace(t),t.tokenStart=t.position,Tt.eatValue(t),l[u]=Yc(t.data,t.tokenStart,t.tokenEnd);return s=c,c===n?0:o},(a,l,c)=>a.update({current:Math.min(c,n),max:n}))}function rY(e,t){return ke.create("Parse Cube",async r=>{await r.update("Reading header...");let n=Tt(e),{header:o,atoms:i}=B3e(n),s=await N3e(r,n,o);return Hr.success({header:o,atoms:i,values:s,name:t})})}function nY(e){let t={h:D()},r=0,n=0,o=/\s+/g;for(;;){let i=Tt.readLine(e),s;if(i.startsWith("object 1"))s=i.split(o),t.dim=D.create(parseInt(s[5]),parseInt(s[6]),parseInt(s[7]));else if(i.startsWith("origin"))s=i.split(o),t.min=D.create(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));else if(i.startsWith("delta"))s=i.split(o),n===0?t.h[0]=parseFloat(s[1]):n===1?t.h[1]=parseFloat(s[2]):n===2&&(t.h[2]=parseFloat(s[3])),n+=1;else if(i.startsWith("object 3")){r+=i.length+1;break}r+=i.length+1}return{header:t,headerByteCount:r}}function F3e(e,t,r){let n=r.dim[0]*r.dim[1]*r.dim[2],o=100*100*100,i=new Float64Array(n),s=0;return yc(e,o,i,(a,l)=>{let c=Math.min(n,s+a);for(let u=s;u<c;u++)Tt.skipWhitespace(t),t.tokenStart=t.position,Tt.eatValue(t),l[u]=Yc(t.data,t.tokenStart,t.tokenEnd);return s=c,c===n?0:o},(a,l,c)=>a.update({current:Math.min(c,n),max:n}))}async function O3e(e,t,r){await e.update("Reading header...");let n=Tt(t),{header:o}=nY(n);await e.update("Reading values...");let i=await F3e(e,n,o);return Hr.success({header:o,values:i,name:r})}async function V3e(e,t,r){await e.update("Reading header...");let n=_x(t,0,1e3),o=Tt(n),{header:i,headerByteCount:s}=nY(o);await e.update("Reading values...");let a=i.dim[0]*i.dim[1]*i.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(a);for(let u=0;u<a;u++)c[u]=l.getFloat64(u*8,!0);return Hr.success({header:i,values:c,name:r})}function oY(e,t){return ke.create("Parse DX",r=>typeof e=="string"?O3e(r,e,t):V3e(r,e,t))}var Gt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Jyt=function(){let e=new Map;return Object.keys(Gt).forEach(t=>{e.set(Gt[t],t)}),e}();var G3e={NATOM:"",NTYPES:"",NBONH:"",MBONA:"",NTHETH:"",MTHETA:"",NPHIH:"",MPHIA:"",NHPARM:"",NPARM:"",NNB:"",NRES:"",NBONA:"",NTHETA:"",NPHIA:"",NUMBND:"",NUMANG:"",NPTRA:"",NATYP:"",NPHB:"",IFPERT:"",NBPER:"",NGPER:"",NDPER:"",MBPER:"",MGPER:"",MDPER:"",IFBOX:"",NMXRS:"",IFCAP:"",NUMEXTRA:"",NCOPY:""},iY=Object.keys(G3e),{readLine:qP,markLine:sY,trim:U3e}=Tt;function z3e(e,t){return{tokenizer:e,runtimeCtx:t}}function H3e(e){let{tokenizer:t}=e,r=[];for(;t.tokenEnd<t.length&&t.data[t.position]!=="%";){let n=qP(t).trim();n&&r.push(n)}return r}function j3e(e){let{tokenizer:t}=e,r=Object.create(null);iY.forEach(o=>{r[o]=0});let n=0;for(;t.tokenEnd<t.length&&t.data[t.position]!=="%";){let o=qP(t),i=Math.min(n+10,32);for(let s=0;n<i;++s,++n)r[iY[n]]=parseInt(o.substring(s*8,s*8+8).trim())}return r}function F0(e,t,r,n){let{tokenizer:o}=e,i=ct.create(o.data,t*2),s=0;for(;o.tokenEnd<o.length&&o.data[o.position]!=="%";){o.tokenStart=o.position;let a=Math.min(s+r,t);for(let l=0;s<a;++l,++s){let c=o.position;U3e(o,o.position,o.position+n),ct.addUnchecked(i,o.tokenStart,o.tokenEnd),o.position=c+n}sY(o)}return i}async function $3e(e,t){let r=Tt(e),n=z3e(r,t),o=Object.create(null),i=0;for(;r.tokenEnd<r.length;){r.position-i>1e5&&t.shouldUpdate&&(i=r.position,await t.update({current:r.position,max:r.length}));let s=qP(n.tokenizer).trim();if(s.startsWith("%VERSION"))o.version=s.substring(8).trim();else if(s.startsWith("%FLAG")){let a=s.substring(5).trim();if(!qP(n.tokenizer).trim().startsWith("%FORMAT"))throw new Error("expected %FORMAT");if(a==="TITLE")o.title=H3e(n);else if(a==="POINTERS")o.pointers=j3e(n);else if(a==="ATOM_NAME"){let c=F0(n,o.pointers.NATOM,20,4);o.atomName=dr(c)(ue.Schema.str)}else if(a==="CHARGE"){let c=F0(n,o.pointers.NATOM,5,16);o.charge=dr(c)(ue.Schema.float)}else if(a==="MASS"){let c=F0(n,o.pointers.NATOM,5,16);o.mass=dr(c)(ue.Schema.float)}else if(a==="RESIDUE_LABEL"){let c=F0(n,o.pointers.NRES,20,4);o.residueLabel=dr(c)(ue.Schema.str)}else if(a==="RESIDUE_POINTER"){let c=F0(n,o.pointers.NRES,10,8);o.residuePointer=dr(c)(ue.Schema.int)}else if(a==="BONDS_INC_HYDROGEN"){let c=F0(n,o.pointers.NBONH*3,10,8);o.bondsIncHydrogen=dr(c)(ue.Schema.int)}else if(a==="BONDS_WITHOUT_HYDROGEN"){let c=F0(n,o.pointers.NBONA*3,10,8);o.bondsWithoutHydrogen=dr(c)(ue.Schema.int)}else if(a==="RADII"){let c=F0(n,o.pointers.NATOM,5,16);o.radii=dr(c)(ue.Schema.float)}else for(;r.tokenEnd<r.length&&r.data[r.position]!=="%";)sY(r)}}return Hr.success(o)}function aY(e){return ke.create("Parse PRMTOP",async t=>await $3e(e,t))}var W3e={nr:ue.Schema.Int(),type:ue.Schema.Str(),resnr:ue.Schema.Int(),residu:ue.Schema.Str(),atom:ue.Schema.Str(),cgnr:ue.Schema.Int(),charge:ue.Schema.Float(),mass:ue.Schema.Float()},q3e={ai:ue.Schema.Int(),aj:ue.Schema.Int()},Z3e={compound:ue.Schema.Str(),molCount:ue.Schema.Int()},{readLine:X4,markLine:O0,skipWhitespace:V0,markStart:ZP,eatValue:Y4,eatLine:K3e}=Tt;function X3e(e,t){return{tokenizer:e,runtimeCtx:t}}var Y3e=/\[ (.+) \]/,Q3e=/\s+/;function J3e(e){let{tokenizer:t}=e,r;for(;t.tokenEnd<t.length;){V0(t);let n=t.data[t.position];if(n==="[")break;if(n===";"||n==="*"){O0(t);continue}if(r!==void 0)throw new Error("more than one molName");r=X4(t).split(Q3e)[0]}if(r===void 0)throw new Error("missing molName");return r}function eDe(e){let{tokenizer:t}=e,r=ct.create(t.data,64),n=ct.create(t.data,64),o=ct.create(t.data,64),i=ct.create(t.data,64),s=ct.create(t.data,64),a=ct.create(t.data,64),l=ct.create(t.data,64),c=ct.create(t.data,64);for(;t.tokenEnd<t.length;){V0(t);let u=t.data[t.position];if(u==="[")break;if(u===";"||u==="*"){O0(t);continue}for(let d=0;d<8;++d)switch(V0(t),ZP(t),Y4(t),d){case 0:ct.add(r,t.tokenStart,t.tokenEnd);break;case 1:ct.add(n,t.tokenStart,t.tokenEnd);break;case 2:ct.add(o,t.tokenStart,t.tokenEnd);break;case 3:ct.add(i,t.tokenStart,t.tokenEnd);break;case 4:ct.add(s,t.tokenStart,t.tokenEnd);break;case 5:ct.add(a,t.tokenStart,t.tokenEnd);break;case 6:ct.add(l,t.tokenStart,t.tokenEnd);break;case 7:ct.add(c,t.tokenStart,t.tokenEnd);break}O0(t)}return gr.ofColumns(W3e,{nr:dr(r)(ue.Schema.int),type:dr(n)(ue.Schema.str),resnr:dr(o)(ue.Schema.int),residu:dr(i)(ue.Schema.str),atom:dr(s)(ue.Schema.str),cgnr:dr(a)(ue.Schema.int),charge:dr(l)(ue.Schema.float),mass:dr(c)(ue.Schema.float)})}function tDe(e){let{tokenizer:t}=e,r=ct.create(t.data,64),n=ct.create(t.data,64);for(;t.tokenEnd<t.length;){V0(t);let o=t.data[t.position];if(o==="[")break;if(o===";"||o==="*"){O0(t);continue}for(let i=0;i<2;++i)switch(V0(t),ZP(t),Y4(t),i){case 0:ct.add(r,t.tokenStart,t.tokenEnd);break;case 1:ct.add(n,t.tokenStart,t.tokenEnd);break}O0(t)}return gr.ofColumns(q3e,{ai:dr(r)(ue.Schema.int),aj:dr(n)(ue.Schema.int)})}function rDe(e){let{tokenizer:t}=e,r;for(;t.tokenEnd<t.length;){V0(t);let n=t.data[t.position];if(n==="[")break;if(n===";"||n==="*"){O0(t);continue}if(r!==void 0)throw new Error("more than one system");r=X4(t).trim()}if(r===void 0)throw new Error("missing system");return r}function nDe(e){let{tokenizer:t}=e,r=ct.create(t.data,64),n=ct.create(t.data,64);for(;t.tokenEnd<t.length&&(V0(t),!(t.position>=t.length));){let o=t.data[t.position];if(o==="[")break;if(o===";"||o==="*"){O0(t);continue}for(let i=0;i<2;++i)switch(V0(t),ZP(t),Y4(t),i){case 0:ct.add(r,t.tokenStart,t.tokenEnd);break;case 1:ct.add(n,t.tokenStart,t.tokenEnd);break}K3e(t),ZP(t)}return gr.ofColumns(Z3e,{compound:dr(r)(ue.Schema.str),molCount:dr(n)(ue.Schema.int)})}async function oDe(e,t){let r=Tt(e),n=X3e(r,t),o=Object.create(null),i=0;o.compounds={};let s={},a="";function l(){a&&s.atoms&&(o.compounds[a]=s,s={},a="")}for(;r.tokenEnd<r.length;){r.position-i>1e5&&t.shouldUpdate&&(i=r.position,await t.update({current:r.position,max:r.length}));let c=X4(n.tokenizer).trim();if(!(!c||c[0]==="*"||c[0]===";")){if(c.startsWith("#include"))throw new Error("#include statements not allowed");if(c.startsWith("[")){let u=c.match(Y3e);if(u===null)throw new Error("expected field name");let d=u[1];if(d==="moleculetype")l(),a=J3e(n);else if(d==="atoms")s.atoms=eDe(n);else if(d==="bonds")s.bonds=tDe(n);else if(d==="system")o.system=rDe(n);else if(d==="molecules")l(),o.molecules=nDe(n);else for(;r.tokenEnd<r.length&&r.data[r.position]!=="[";)O0(r)}}}return Hr.success(o)}function lY(e){return ke.create("Parse TOP",async t=>await oDe(e,t))}var Ru=Lt.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[fe.Root],to:[fe.Data.String,fe.Data.Binary],params:{url:M.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:M.Optional(M.Text("")),isBinary:M.Optional(M.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply({params:e,cache:t},r){return ke.create("Download",async n=>{let o=Nr.getUrlAsset(r.managers.asset,e.url),i=await r.managers.asset.resolve(o,e.isBinary?"binary":"string").runInContext(n);return t.asset=i,e.isBinary?new fe.Data.Binary(i.data,{label:e.label?e.label:o.url}):new fe.Data.String(i.data,{label:e.label?e.label:o.url})})},dispose({cache:e}){var t;(t=e?.asset)===null||t===void 0||t.dispose()},update({oldParams:e,newParams:t,b:r}){return e.url!==t.url||e.isBinary!==t.isBinary?st.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||(typeof t.url=="string"?t.url:t.url.url),st.UpdateResult.Updated):st.UpdateResult.Unchanged}}),Q4=Lt.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:fe.Root,to:fe.Data.Blob,params:{sources:M.ObjectList({id:M.Text("",{label:"Unique ID"}),url:M.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:M.Optional(M.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:M.Optional(M.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},e=>`${e.id}: ${e.url}`),maxConcurrency:M.Optional(M.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply({params:e,cache:t},r){return ke.create("Download Blob",async n=>{let o=[],i=await eX(n,r.managers.asset,e.sources,e.maxConcurrency||4),s=[];for(let a=0;a<i.length;a++){let l=i[a],c=e.sources[a];l.kind==="error"?r.log.warn(`Download ${l.id} (${c.url}) failed: ${l.error}`):(s.push(l.result),o.push(c.isBinary?{id:l.id,kind:"binary",data:l.result.data}:{id:l.id,kind:"string",data:l.result.data}))}return t.assets=s,new fe.Data.Blob(o,{label:"Data Blob",description:`${o.length} ${o.length===1?"entry":"entries"}`})})},dispose({cache:e},t){let r=e?.assets;if(r)for(let n of r)n.dispose()}}),J4=Lt.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[fe.Root],to:[fe.Data.String,fe.Data.Binary],params:{data:M.Value("",{isHidden:!0}),label:M.Optional(M.Text(""))}})({apply({params:e}){return ke.create("Raw Data",async()=>{if(typeof e.data=="string")return new fe.Data.String(e.data,{label:e.label?e.label:"String"});if(Array.isArray(e.data))return new fe.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:"Binary"});if(e.data instanceof ArrayBuffer)return new fe.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:"Binary"});if(e.data instanceof Uint8Array)return new fe.Data.Binary(e.data,{label:e.label?e.label:"Binary"});Sr(e.data)})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?st.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||r.label,st.UpdateResult.Updated):st.UpdateResult.Unchanged},customSerialization:{toJSON(e){if(typeof e.data=="string"||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){let t=new Uint8Array(e.data),r=new Array(t.length);for(let n=0,o=t.length;n<o;n++)r[n]=t[n];return{data:r,label:e.label}}else if(e.data instanceof Uint8Array){let t=new Array(e.data.length);for(let r=0,n=e.data.length;r<n;r++)t[r]=e.data[r];return{data:t,label:e.label}}},fromJSON(e){return e}}}),e5=Lt.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:fe.Root,to:[fe.Data.String,fe.Data.Binary],params:{file:M.File(),label:M.Optional(M.Text("")),isBinary:M.Optional(M.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply({params:e,cache:t},r){return ke.create("Open File",async n=>{if(e.file===null)return r.log.error("No file(s) selected"),Hn.Null;let o=await r.managers.asset.resolve(e.file,e.isBinary?"binary":"string").runInContext(n);return t.asset=o,e.isBinary?new fe.Data.Binary(o.data,{label:e.label?e.label:e.file.name}):new fe.Data.String(o.data,{label:e.label?e.label:e.file.name})})},dispose({cache:e}){var t;(t=e?.asset)===null||t===void 0||t.dispose()},update({oldParams:e,newParams:t,b:r}){var n;return e.label!==t.label?(r.label=t.label||((n=e.file)===null||n===void 0?void 0:n.name)||"",st.UpdateResult.Updated):st.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user loaded files."})}),iDe=Lt.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:fe.Data.Blob,to:fe.Format.Blob,params:{formats:M.ObjectList({id:M.Text("",{label:"Unique ID"}),format:M.Select("cif",[["cif","cif"]])},e=>`${e.id}: ${e.format}`)}})({apply({a:e,params:t},r){return ke.create("Parse Blob",async n=>{let o=new Map;for(let s of t.formats)o.set(s.id,s.format);let i=[];for(let s of e.data){if(!o.has(s.id))continue;let a=await(s.kind==="string"?Di.parse(s.data):Di.parseBinary(s.data)).runInContext(n);if(a.isError)throw new Error(`${s.id}: ${a.message}`);i.push({id:s.id,kind:"cif",data:a.result})}return new fe.Format.Blob(i,{label:"Format Blob",description:`${i.length} ${i.length===1?"entry":"entries"}`})})}}),bb=Lt.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[fe.Data.String,fe.Data.Binary],to:fe.Format.Cif})({apply({a:e}){return ke.create("Parse CIF",async t=>{let r=await(typeof e.data=="string"?Di.parse(e.data):Di.parseBinary(e.data)).runInContext(t);if(r.isError)throw new Error(r.message);return r.result.blocks.length===0?Hn.Null:new fe.Format.Cif(r.result)})}}),sDe=Lt.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:fe.Data.String,to:fe.Format.Cube})({apply({a:e}){return ke.create("Parse Cube",async t=>{let r=await rY(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new fe.Format.Cube(r.result)})}}),aDe=Lt.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[fe.Data.String],to:fe.Format.Psf})({apply({a:e}){return ke.create("Parse PSF",async t=>{let r=await rZ(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new fe.Format.Psf(r.result)})}}),lDe=Lt.BuiltIn({name:"parse-prmtop",display:{name:"Parse PRMTOP",description:"Parse PRMTOP from String data"},from:[fe.Data.String],to:fe.Format.Prmtop})({apply({a:e}){return ke.create("Parse PRMTOP",async t=>{let r=await aY(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new fe.Format.Prmtop(r.result)})}}),cDe=Lt.BuiltIn({name:"parse-top",display:{name:"Parse TOP",description:"Parse TOP from String data"},from:[fe.Data.String],to:fe.Format.Top})({apply({a:e}){return ke.create("Parse TOP",async t=>{let r=await lY(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new fe.Format.Top(r.result)})}}),uDe=Lt.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[fe.Data.String],to:fe.Format.Ply})({apply({a:e}){return ke.create("Parse PLY",async t=>{let r=await Jq(e.data).runInContext(t);if(r.isError)throw new Error(r.message);return new fe.Format.Ply(r.result,{label:r.result.comments[0]||"PLY Data"})})}}),dDe=Lt.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[fe.Data.Binary],to:fe.Format.Ccp4})({apply({a:e}){return ke.create("Parse CCP4/MRC/MAP",async t=>{let r=await tq(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new fe.Format.Ccp4(r.result)})}}),mDe=Lt.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[fe.Data.Binary],to:fe.Format.Dsn6})({apply({a:e}){return ke.create("Parse DSN6/BRIX",async t=>{let r=await Xq(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new fe.Format.Dsn6(r.result)})}}),pDe=Lt.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[fe.Data.Binary,fe.Data.String],to:fe.Format.Dx})({apply({a:e}){return ke.create("Parse DX",async t=>{let r=await oY(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);return new fe.Format.Dx(r.result)})}}),fDe=Lt.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:fe.Root,to:fe.Data.String,params:{data:M.Value(""),label:M.Optional(M.Text(""))}})({apply({params:{data:e,label:t}}){return new fe.Data.String(e,{label:t||""})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?st.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||"",st.UpdateResult.Updated):st.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported strings."})}),hDe=Lt.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:fe.Root,to:fe.Format.Json,params:{data:M.Value({}),label:M.Optional(M.Text(""))}})({apply({params:{data:e,label:t}}){return new fe.Format.Json(e,{label:t||""})},update({oldParams:e,newParams:t,b:r}){return e.data!==t.data?st.UpdateResult.Recreate:e.label!==t.label?(r.label=t.label||"",st.UpdateResult.Updated):st.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported JSON."})}),gDe=Lt.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[fe.Data.String],to:fe.Format.Json})({apply({a:e}){return ke.create("Parse JSON",async t=>{let r=await new Response(e.data).json();return new fe.Format.Json(r)})}}),yDe=Lt.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:fe.Root,to:fe.Volume.Lazy,params:{url:M.Url(""),isBinary:M.Boolean(!1),format:M.Text("ccp4"),entryId:M.Value("",{isHidden:!0}),isovalues:M.ObjectList({type:M.Text("relative"),value:M.Numeric(0),color:M.Color(Gt.black),alpha:M.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:M.Numeric(0)},e=>`${e.type} ${e.value}`)}})({apply({a:e,params:t}){return ke.create("Lazy Volume",async r=>{let n=Array.isArray(t.entryId)?t.entryId.join(", "):t.entryId;return new fe.Volume.Lazy(t,{label:`${n||t.url}`,description:"Lazy Volume"})})}});var r5={};Ui(r5,{CreateGroup:()=>Qa});var Qa=Lt.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:fe.Group,params:{label:M.Text("Group"),description:M.Optional(M.Text(""))}})({apply({params:e}){return new fe.Group({},e)},update({oldParams:e,newParams:t,b:r}){return Au(e,t)?st.UpdateResult.Unchanged:(r.label=t.label,r.description=t.description,st.UpdateResult.Updated)}});var pU={};Ui(pU,{CoordinatesFromDcd:()=>mVe,CoordinatesFromNctraj:()=>hVe,CoordinatesFromTrr:()=>fVe,CoordinatesFromXtc:()=>pVe,CustomModelProperties:()=>dU,CustomStructureProperties:()=>mU,ModelFromTrajectory:()=>uU,MultiStructureSelectionFromExpression:()=>LVe,ShapeFromPly:()=>UVe,StructureComplexElement:()=>VVe,StructureComplexElementTypes:()=>Lae,StructureComponent:()=>GVe,StructureFromModel:()=>MVe,StructureFromTrajectory:()=>kVe,StructureSelectionFromBundle:()=>FVe,StructureSelectionFromExpression:()=>BVe,StructureSelectionFromScript:()=>NVe,TopologyFromPrmtop:()=>yVe,TopologyFromPsf:()=>gVe,TopologyFromTop:()=>vVe,TrajectoryFromBlob:()=>xVe,TrajectoryFromCifCore:()=>EVe,TrajectoryFromCube:()=>TVe,TrajectoryFromGRO:()=>SVe,TrajectoryFromMOL:()=>AVe,TrajectoryFromMOL2:()=>_Ve,TrajectoryFromMmCif:()=>ow,TrajectoryFromModelAndCoordinates:()=>LD,TrajectoryFromPDB:()=>CVe,TrajectoryFromSDF:()=>wVe,TrajectoryFromXYZ:()=>IVe,TransformStructureConformation:()=>RVe});function vDe(e){let t=new DataView(e.buffer),r=Object.create(null),n=[],o=0,i=new Int32Array(e.buffer,0,23),s=i[0]!==t.getInt32(0);if(i[0]!==84){let f=e.byteLength;for(let C=0;C<f;C+=4)t.setFloat32(C,t.getFloat32(C),!0)}if(i[0]!==84)throw new Error("dcd bad format, header block start");if(String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7))!=="CORD")throw new Error("dcd bad format, format string");let l=!1,c=!1,u=!1;if(i[22]!==0&&(l=!0,i[12]!==0&&(c=!0),i[13]===1&&(u=!0)),r.NSET=i[2],r.ISTART=i[3],r.NSAVC=i[4],r.NAMNF=i[10],l?r.DELTA=t.getFloat32(44,s):r.DELTA=t.getFloat64(44,s),i[22]!==84)throw new Error("dcd bad format, header block end");o=o+21*4+8;let d=t.getInt32(o,s),m=o+1;if((d-4)%80!==0)throw new Error("dcd bad format, title block start");if(r.TITLE=Aq(e.subarray(m,d)),t.getInt32(m+d+4-1,s)!==d)throw new Error("dcd bad format, title block end");if(o=o+d+8,t.getInt32(o,s)!==4)throw new Error("dcd bad format, natom block start");if(r.NATOM=t.getInt32(o+4,s),t.getInt32(o+8,s)!==4)throw new Error("dcd bad format, natom block end");if(o=o+4+8,r.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");let p=r.NATOM,h=p*4;for(let f=0,C=r.NSET;f<C;++f){let g=Object.create(null);g.elementCount=p,c&&(o+=4,g.cell=[t.getFloat64(o,s),t.getFloat64(o+1,s),t.getFloat64(o+2*8,s),t.getFloat64(o+3*8,s),t.getFloat64(o+4*8,s),t.getFloat64(o+5*8,s)],o+=48,o+=4);for(let b=0;b<3;++b){if(t.getInt32(o,s)!==h)throw new Error(`dcd bad format, coord block start: ${f}, ${b}`);o+=4;let y=new Float32Array(e.buffer,o,p);if(b===0?g.x=y:b===1?g.y=y:g.z=y,o+=h,t.getInt32(o,s)!==h)throw new Error(`dcd bad format, coord block end: ${f}, ${b}`);o+=4}if(u){let b=t.getInt32(o,s);o+=4+b+4}n.push(g)}return{header:r,frames:n}}function cY(e){return ke.create("Parse DCD",async t=>{try{let r=vDe(e);return Hr.success(r)}catch(r){return Hr.error(r)}})}function uY(e){return function(t,r,n){return bDe(e,t,r,n)}}function bDe(e,t,r,n){let{data:o,indices:i,count:s}=e,{valueType:a}=n,l=a==="str"?c=>{let u=i[2*c]+t,d=i[2*c+1];if(u>=d)return"";let m=u+r;return m>d&&(m=d),fq(o,u,m)}:a==="int"?c=>{let u=i[2*c]+t;return u>i[2*c+1]?0:jh(o,u,u+r)}:c=>{let u=i[2*c]+t;return u>i[2*c+1]?0:aq(o,u,u+r)};return{schema:n,__array:void 0,isDefined:!0,rowCount:s,value:l,valueKind:c=>0,toArray:c=>bi.createAndFillArray(s,l,c),areValuesEqual:(c,u)=>l(c)===l(u)}}function xDe(){return{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]}}function CDe(e,t){return{tokenizer:e,header:xDe(),numberOfAtoms:0,runtimeCtx:t}}function SDe(e){let{tokenizer:t,header:r}=e,n=Tt.readLine(t);n.trim().length===0&&(n=Tt.readLine(t));let o=n.lastIndexOf("t=");o>=0?(r.timeInPs=parseFloat(n.substring(o+2)),r.title=n.substring(0,o).trim(),r.title&&r.title[r.title.length-1]===","&&(r.title=r.title.substring(0,r.title.length-1))):r.title=n}function IDe(e){let{tokenizer:t}=e;Tt.markLine(t);let r=Tt.getTokenString(t);e.numberOfAtoms=parseInt(r)}async function ADe(e){let{tokenizer:t,numberOfAtoms:r}=e,n=await Tt.readLinesAsync(t,r,e.runtimeCtx,1e5),i=t.data.substring(n.indices[0],n.indices[1]).substring(20).match(/\.\d+/g),s=i.length===6;e.header.hasVelocities=s,e.header.precision.position=i[0].length-1,e.header.precision.velocity=s?i[3].length-1:0;let a=20,l=e.header.precision.position+5,c=a+3*l,u=e.header.precision.velocity+4,d=uY(n),m=ue.Undefined(e.numberOfAtoms,ue.Schema.float);return{count:e.numberOfAtoms,residueNumber:d(0,5,ue.Schema.int),residueName:d(5,5,ue.Schema.str),atomName:d(10,5,ue.Schema.str),atomNumber:d(15,5,ue.Schema.int),x:d(a,l,ue.Schema.float),y:d(a+l,l,ue.Schema.float),z:d(a+2*l,l,ue.Schema.float),vx:s?d(c,u,ue.Schema.float):m,vy:s?d(c+u,u,ue.Schema.float):m,vz:s?d(c+2*u,u,ue.Schema.float):m}}function wDe(e){let{tokenizer:t}=e,r=Tt.readLine(t).trim().split(/\s+/g);e.header.box=[+r[0],+r[1],+r[2]]}async function _De(e,t){let r=Tt(e);await t.update({message:"Parsing...",current:0,max:e.length});let n=[];for(;r.position<e.length;){let i=CDe(r,t);SDe(i),IDe(i);let s=await ADe(i);wDe(i),n.push({header:i.header,atoms:s})}let o={structures:n};return Hr.success(o)}function dY(e){return ke.create("Parse GRO",async t=>await _De(e,t))}function mY(e,t,r=!1){return ke.create("Parse PDB",async n=>Hr.success({lines:await Tt.readAllLinesAsync(e,n),id:t,isPdbqt:r}))}function hl(e){return{kind:"table-legend",table:e}}function pY(e,t,r){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:r}}var rs;(function(e){e.Zero=0;let{_int32:t,_float64:r,_int32_1:n,_float64_1:o}=function(){let f=new ArrayBuffer(8),C=new ArrayBuffer(8);return{_int32:new Int32Array(f),_float64:new Float64Array(f),_int32_1:new Int32Array(C),_float64_1:new Float64Array(C)}}();function i(f){return typeof f=="number"}e.is=i;function s(f,C){return t[0]=f,t[1]=C,r[0]}e.create=s;function a(f){return r[0]=f,t[1]-t[0]}e.diff=a;function l(f){return r[0]=f,t[0]}e.fst=l;function c(f){return r[0]=f,t[1]}e.snd=c;function u(f,C){return r[0]=f,o[0]=C,t[0]===n[0]&&t[1]===n[1]}e.areEqual=u;function d(f,C){r[0]=f,o[0]=C;let g=t[0]-n[0];return g!==0?g:t[1]-n[1]}e.compare=d;function m(f,C,g){r[0]=f[C],o[0]=f[g];let b=t[0]-n[0];return b!==0?b:t[1]-n[1]}e.compareInArray=m;function p(f){return r[0]=f,wu(t[0],t[1])}e.hashCode=p;function h(f){return r[0]=f,`(${t[0]}, ${t[1]})`}e.toString=h})(rs||(rs={}));var n5=rs.Zero;function o5(e,t){return t<e?rs.create(e,e):rs.create(e,t+1)}function XP(e,t){return t<=e?rs.create(e,e):rs.create(e,t)}function fY(e){return e<0?rs.create(0,0):rs.create(0,e)}var hY=rs.is,Lf=rs.fst,ng=rs.snd,I2=rs.fst;function A2(e){return rs.snd(e)-1}var G0=rs.diff,gY=rs.hashCode,yY=rs.toString;function vY(e,t){return rs.fst(e)<=t&&t<rs.snd(e)}function bY(e,t){let r=Lf(e);return t>=r&&t<ng(e)?t-r:-1}function xY(e,t){return rs.fst(e)+t}var CY=rs.areEqual;function i5(e,t){let r=G0(e),n=G0(t);return r===0&&n===0?!0:r>0&&n>0&&A2(e)>=I2(t)&&I2(e)<=A2(t)}function SY(e,t){return G0(e)?G0(t)?Lf(e)<=Lf(t)&&ng(e)>=ng(t):!0:G0(t)===0}function KP(e,t){let r=Lf(e);if(t<=r)return 0;let n=ng(e);return t>=n?n-r:t-r}function IY(e,t,r){let n=Lf(r),o=Lf(e);if(t<=n+o)return n;let i=ng(r);return t>=i+o?i:t-o}function s5(e,t,r){return XP(KP(e,t),KP(e,r+1))}function AY(e,t){return i5(e,t)?XP(Math.max(Lf(e),Lf(t)),Math.min(ng(e),ng(t))):n5}function wY(e,t){return G0(s5(e,I2(t),A2(t)))}var Be;(function(e){e.Empty=n5,e.ofSingleton=t=>o5(t,t),e.ofRange=o5,e.ofBounds=XP,e.ofLength=fY,e.is=hY,e.has=vY,e.indexOf=bY,e.getAt=xY,e.start=Lf,e.end=ng,e.min=I2,e.max=A2,e.size=G0,e.hashCode=gY,e.toString=yY,e.areEqual=CY,e.areIntersecting=i5,e.isSubInterval=SY,e.findPredecessorIndex=KP,e.findPredecessorIndexInInterval=IY,e.findRange=s5,e.intersectionSize=wY,e.intersect=AY})(Be||(Be={}));var nC=[];function _Y(e){return[e]}function TY(e){return e}function EY(e){return _a(e),e}function a5(e,t){if(t<e)return[];let r=new Int32Array(t-e+1);for(let n=e;n<=t;n++)r[n-e]=n;return r}function PY(e){return e&&(Array.isArray(e)||!!e.buffer)}function l5(e){return e[e.length-1]-e[0]+1===e.length}function YP(e){return e[0]}function QP(e){return e[e.length-1]+1}function DY(e){return e[0]}function kY(e){return e[e.length-1]}function c5(e){return e.length}function MY(e){let t=e.length;return t?t>2?Pq(t,e[0],e[t-1],e[t>>1]):Eq(t,e[0],e[t-1]):0}function RY(e){let t=e.length;return t>5?`[${e[0]}, ${e[1]}, ..., ${e[t-1]}], length ${t}`:`[${e.join(", ")}]`}function u5(e,t){let r=e.length;return r===0?-1:e[0]<=t&&t<=e[r-1]?OY(e,t,0,r):-1}function BY(e,t,r){return d5(e,t,Be.start(r),Be.end(r))}function d5(e,t,r,n){return e.length===0||n<=r?-1:e[r]<=t&&t<=e[n-1]?OY(e,t,r,n):-1}function LY(e,t){return u5(e,t)>=0}function m5(e,t){if(e===t)return!0;let r=e.length;if(r!==t.length||e[0]!==t[0]||e[r-1]!==t[r-1])return!1;if(l5(e))return!0;r--;for(let n=1;n<r;n++)if(e[n]!==t[n])return!1;return!0}function U0(e,t){let r=e.length;return t<=e[0]?0:t>e[r-1]?r:VY(e,t,0,r)}function NY(e,t,r){let n=Be.start(r),o=Be.end(r),i=e[n];return t<=i?n:o>n&&t>e[o-1]?o:t-i<=11?EDe(e,t,n+1,o):VY(e,t,n,o)}function FY(e,t,r){return Be.ofBounds(U0(e,t),U0(e,r+1))}function OY(e,t,r,n){let o=r,i=n-1;for(;o<=i;){if(o+11>i){for(let l=o;l<=i;l++)if(t===e[l])return l;return-1}let s=o+i>>1,a=e[s];if(t<a)i=s-1;else if(t>a)o=s+1;else return s}return-1}function VY(e,t,r,n){let o=r,i=n-1;for(;o<i;){if(o+11>i){for(let l=o;l<=i;l++)if(t<=e[l])return l;return i+1}let s=o+i>>1,a=e[s];if(t<a)i=s-1;else if(t>a)o=s+1;else return s}return o>i?i+1:e[o]>=t?o:o+1}function EDe(e,t,r,n){for(let o=r;o<n;o++)if(t<=e[o])return o;return n}function GY(e,t){if(e===t)return!0;let{startI:r,startJ:n,endI:o,endJ:i}=xb(e,t);for(;r<o&&n<i;){let s=e[r],a=t[n];if(s<a)r++;else if(s>a)n++;else return!0}return!1}function UY(e,t){if(e===t)return!0;let r=t.length,{startI:n,startJ:o,endI:i,endJ:s}=xb(e,t);if(s-o<r||i-n<r)return!1;let a=0;for(;n<i&&o<s;){let l=e[n],c=t[o];l<c?n++:l>c?o++:(n++,o++,a++)}return a===r}function p5(e,t){if(e===t)return e;let r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;if(e[0]>t[0])return p5(t,e);let{startI:o,startJ:i,endI:s,endJ:a}=xb(e,t),l=f5(e,t,o,i,s,a);if(l===r&&l===n||l===n)return e;if(l===r)return t;let c=new Int32Array(r+n-l),u=0,d=0,m=0;for(u=0;u<o;u++)c[m++]=e[u];for(;d<a&&e[o]>t[d];)c[m++]=t[d++];for(;u<s&&d<a;){let p=e[u],h=t[d];p<h?(c[m++]=p,u++):p>h?(c[m++]=h,d++):(c[m++]=p,u++,d++)}for(;u<s;u++)c[m++]=e[u];for(;d<a;d++)c[m++]=t[d];for(;u<r;u++)c[m++]=e[u];for(;d<n;d++)c[m++]=t[d];return c}function zY(e,t){if(e===t)return c5(e);let{startI:r,startJ:n,endI:o,endJ:i}=xb(e,t);return f5(e,t,r,n,o,i)}function f5(e,t,r,n,o,i){let s=r,a=n,l=0;for(;s<o&&a<i;){let c=e[s],u=t[a];c<u?s++:c>u?a++:(s++,a++,l++)}return l}function HY(e,t){if(e===t)return e;let{startI:r,startJ:n,endI:o,endJ:i}=xb(e,t),s=f5(e,t,r,n,o,i),a=e.length,l=t.length;if(!s)return nC;if(s===a&&s===l||s===l)return t;if(s===a)return e;let c=new Int32Array(s),u=0,d=r,m=n;for(;d<o&&m<i;){let p=e[d],h=t[m];p<h?d++:(p>h||(c[u++]=p,d++),m++)}return c}function jY(e,t){if(e===t)return nC;let r=e.length,{startI:n,startJ:o,endI:i,endJ:s}=xb(e,t),a=n,l=o,c=0;for(;a<i&&l<s;){let m=e[a],p=t[l];m<p?a++:m>p?l++:(a++,l++,c++)}if(!c)return e;if(c>=r)return nC;let u=new Int32Array(r-c),d=0;for(let m=0;m<n;m++)u[d++]=e[m];for(a=n,l=o;a<i&&l<s;){let m=e[a],p=t[l];m<p?(u[d++]=m,a++):(m>p||a++,l++)}for(;a<r;a++)u[d++]=e[a];return u}function $Y(e){if(e.length<2)return e;let t=1;for(let o=0,i=e.length-1;o<i;o++)e[o]!==e[o+1]&&t++;if(t===e.length)return e;let r=new Int32Array(t),n=0;for(let o=0,i=e.length-1;o<i;o++)e[o]!==e[o+1]&&(r[n++]=e[o]);return r[n]=e[e.length-1],r}function WY(e,t){if(m5(e,t))return FA(0,e.length-1);let{startI:r,startJ:n,endI:o,endJ:i}=xb(e,t),s=r,a=n,l=0;for(;s<o&&a<i;){let m=e[s],p=t[a];m<p?s++:m>p?a++:(s++,a++,l++)}let c=e.length;if(!l)return nC;if(l===c)return FA(0,e.length-1);let u=new Int32Array(l),d=0;for(s=r,a=n;s<o&&a<i;){let m=e[s],p=t[a];m<p?s++:(m>p||(u[d++]=s,s++),a++)}return u}var og={startI:0,startJ:0,endI:0,endJ:0};function xb(e,t){let r=e.length,n=t.length,o=r/n;return r>=128||n>=128||o<=.34||o>=2.99?(og.startI=U0(e,YP(t)),og.startJ=U0(t,YP(e)),og.endI=U0(e,QP(t)),og.endJ=U0(t,QP(e))):(og.startI=0,og.startJ=0,og.endI=r,og.endJ=n),og}var Qe;(function(e){e.Empty=nC,e.ofUnsortedArray=EY,e.ofSingleton=_Y,e.ofSortedArray=TY,e.ofRange=a5,e.ofBounds=(t,r)=>a5(t,r-1),e.is=PY,e.isRange=l5,e.has=LY,e.indexOf=u5,e.indexOfInInterval=BY,e.indexOfInRange=d5,e.start=YP,e.end=QP,e.min=DY,e.max=kY,e.size=c5,e.hashCode=MY,e.toString=RY,e.areEqual=m5,e.areIntersecting=GY,e.isSubset=UY,e.union=p5,e.intersect=HY,e.subtract=jY,e.findPredecessorIndex=U0,e.findPredecessorIndexInInterval=NY,e.findRange=FY,e.intersectionSize=zY,e.deduplicate=$Y,e.indicesOf=WY})(Qe||(Qe={}));var Rp=Be.Empty,QY=Be.ofSingleton,JY=Be.ofRange,eQ=Be.ofBounds;function am(e){return e.length?Qe.isRange(e)?Be.ofRange(e[0],e[e.length-1]):e:Rp}function z0(e){return Be.is(e)?Be.size(e):Qe.size(e)}function tQ(e,t){return Be.is(e)?Be.has(e,t):Qe.has(e,t)}function rQ(e,t){return Be.is(e)?Be.indexOf(e,t):Qe.indexOf(e,t)}function JP(e,t){return Be.is(e)?Be.getAt(e,t):e[t]}function Cb(e){return Be.is(e)?Be.min(e):Qe.min(e)}function Sb(e){return Be.is(e)?Be.max(e):Qe.max(e)}function nQ(e){return Be.is(e)?Be.start(e):Qe.start(e)}function oQ(e){return Be.is(e)?Be.end(e):Qe.end(e)}function iQ(e){return Be.is(e)?Be.hashCode(e):Qe.hashCode(e)}function sQ(e){return Be.is(e)?Be.toString(e):Qe.toString(e)}function aQ(e,t){return Be.is(e)?Be.is(t)?Be.areEqual(e,t):qY(e,t):Be.is(t)?qY(t,e):Qe.areEqual(e,t)}function lQ(e,t){return Be.is(e)?Be.is(t)?Be.areIntersecting(e,t):ZY(t,e):Be.is(t)?ZY(e,t):Qe.areIntersecting(e,t)}function cQ(e,t){return Be.is(e)?Be.is(t)?Be.isSubInterval(e,t):kDe(e,t):Be.is(t)?DDe(e,t):Qe.isSubset(e,t)}function uQ(e,t){return Be.is(e)?Be.findPredecessorIndex(e,t):Qe.findPredecessorIndex(e,t)}function dQ(e,t,r){return Be.is(e)?Be.findPredecessorIndexInInterval(e,t,r):Qe.findPredecessorIndexInInterval(e,t,r)}function mQ(e,t,r){return Be.is(e)?Be.findRange(e,t,r):Qe.findRange(e,t,r)}function pQ(e,t){return Be.is(e)?Be.is(t)?Be.intersectionSize(e,t):XY(t,e):Be.is(t)?XY(e,t):Qe.intersectionSize(e,t)}function fQ(e,t){return Be.is(e)?Be.is(t)?BDe(e,t):KY(t,e):Be.is(t)?KY(e,t):am(Qe.union(e,t))}function hQ(e,t){return Be.is(e)?Be.is(t)?Be.intersect(e,t):YY(t,e):Be.is(t)?YY(e,t):am(Qe.intersect(e,t))}function gQ(e,t){return Be.is(e)?Be.is(t)?LDe(e,t):FDe(e,t):Be.is(t)?NDe(e,t):am(Qe.subtract(e,t))}function qY(e,t){return Be.size(e)===Qe.size(t)&&Be.start(e)===Qe.start(t)&&Be.end(e)===Qe.end(t)}function ZY(e,t){return e.length!==0&&Be.size(Qe.findRange(e,Be.min(t),Be.max(t)))!==0}function DDe(e,t){let r=Be.min(t),n=Be.max(t);if(n-r+1===0)return!0;let o=Qe.min(e),i=Qe.max(e);if(r<o||n>i)return!1;let s=Qe.findRange(e,r,n);return Be.size(s)===Be.size(t)}function kDe(e,t){let r=Be.min(e),n=Be.max(e);if(n-r+1===0)return!1;let o=Qe.min(t),i=Qe.max(t);return o>=r&&i<=n}function MDe(e,t){let r=z0(e),n=z0(t);return r===0&&n===0?!0:r>0&&n>0&&Sb(e)>=Cb(t)&&Cb(e)<=Sb(t)}function RDe(e,t){return z0(e)?z0(t)?Cb(e)<=Cb(t)&&Sb(e)>=Sb(t):!0:z0(t)===0}function BDe(e,t){if(Be.areEqual(e,t))return e;let r=Be.size(e),n=Be.size(t);if(!n)return e;if(!r)return t;let o=Be.min(e),i=Be.min(t);if(MDe(e,t))return Be.ofRange(Math.min(o,i),Math.max(Be.max(e),Be.max(t)));let s,a,l,c;o<i?(s=r,a=o,l=n,c=i):(s=n,a=i,l=r,c=o);let u=new Int32Array(r+n);for(let d=0;d<s;d++)u[d]=d+a;for(let d=0;d<l;d++)u[d+s]=d+c;return am(u)}function KY(e,t){let r=Be.size(t);if(!r)return e;if(RDe(t,e))return t;let n=Be.min(t),o=Be.max(t),i=Qe.findRange(e,n,o),s=Be.start(i),a=Be.end(i),l=new Int32Array(s+(e.length-a)+r),c=0;for(let u=0;u<s;u++)l[c++]=e[u];for(let u=n;u<=o;u++)l[c++]=u;for(let u=a,d=e.length;u<d;u++)l[c++]=e[u];return am(l)}function XY(e,t){if(!Be.size(t))return 0;let r=Qe.findRange(e,Be.min(t),Be.max(t));return Be.end(r)-Be.start(r)}function YY(e,t){if(!Be.size(t))return Rp;let r=Qe.findRange(e,Be.min(t),Be.max(t)),n=Be.start(r),o=Be.end(r),i=o-n;if(!i)return Rp;if(i===e.length)return e;let s=new Int32Array(i),a=0;for(let l=n;l<o;l++)s[a++]=e[l];return am(s)}function LDe(e,t){if(Be.areEqual(e,t))return Rp;if(!Be.areIntersecting(e,t))return e;let r=Be.min(e),n=Be.max(e),o=Be.min(t),i=Be.max(t);if(n<r||i<o)return e;if(Be.isSubInterval(t,e))return Rp;if(Be.isSubInterval(e,t)){let s=o-r,a=n-i;if(s<=0)return Be.ofRange(i+1,i+a);if(a<=0)return Be.ofRange(r,r+s-1);let l=new Int32Array(s+a),c=0;for(let u=0;u<s;u++)l[c++]=r+u;for(let u=1;u<=a;u++)l[c++]=i+u;return am(l)}return r<o?Be.ofRange(r,o-1):Be.ofRange(i+1,n)}function NDe(e,t){let r=Be.min(t),n=Be.max(t);if(n<r)return e;let o=Qe.findRange(e,r,n),i=Be.start(o),s=Be.end(o),a=e.length-(s-i);if(a<=0)return Rp;if(a===e.length)return e;let l=new Int32Array(a),c=0;for(let u=0;u<i;u++)l[c++]=e[u];for(let u=s,d=e.length;u<d;u++)l[c++]=e[u];return am(l)}function FDe(e,t){let r=Be.min(e),n=Be.max(e);if(n<r)return e;let o=n-r+1,i=Qe.findRange(t,r,n),s=Be.start(i),a=Be.end(i),l=a-s;if(l===0)return e;let c=o-l;if(c<=0)return Rp;let u=new Int32Array(c),d=t.length-1,m=t[Math.min(s,d)],p=t[Math.min(a,d)],h=0;for(let f=r;f<m;f++)u[h++]=f;for(let f=m;f<=p;f++)Qe.indexOfInInterval(t,f,i)<0&&(u[h++]=f);for(let f=p+1;f<=n;f++)u[h++]=f;return am(u)}function yQ(e,t,r){if(Be.is(e)){let n=Be.min(e);for(let o=n,i=Be.max(e);o<=i;o++)t(o,o-n,r)}else for(let n=0,o=e.length;n<o;n++)t(e[n],n,r);return r}function vQ(e,t,r,n){if(Be.is(e)){let o=0;for(let i=Be.min(e),s=Be.max(e);i<=s;i++){let a=t(i),l=i+1;for(;l<s&&t(l)===a;)l++;i=l-1,r(a,o,n),o++}}else{let o=0;for(let i=0,s=e.length;i<s;i++){let a=t(e[i]),l=i+1;for(;l<s&&t(e[l])===a;)l++;i=l-1,r(a,o,n),o++}}return n}function bQ(e,t,r){if(t===r)return e;let n=z0(e),o=t.length,i=r.length;if(n===0||o===0||i===0)return Rp;let s=Qe.findPredecessorIndex(r,t[Cb(e)]),a=Qe.findPredecessorIndex(r,t[Sb(e)]+1),l=0,c=0,u=0,d=s;for(;u<n&&d<a;){let p=t[JP(e,u)],h=r[d];p<h?u++:(p>h||(l++,u++),d++)}if(l===0)return Rp;if(l===o&&l===i)return e;let m=new Int32Array(l);for(c=0,u=0,d=s;u<n&&d<a;){let p=t[JP(e,u)],h=r[d];p<h?u++:(p>h||(m[c++]=d,u++),d++)}return am(m)}var Ge;(function(e){e.Empty=Rp,e.ofSingleton=QY,e.ofRange=JY,e.ofBounds=eQ,e.ofSortedArray=am,e.has=tQ,e.indexOf=rQ,e.getAt=JP,e.min=Cb,e.max=Sb,e.start=nQ,e.end=oQ,e.size=z0,e.hashCode=iQ,e.areEqual=aQ,e.areIntersecting=lQ,e.isSubset=cQ,e.union=fQ,e.intersect=hQ,e.indexedIntersect=bQ,e.subtract=gQ,e.findPredecessorIndex=uQ,e.findPredecessorIndexInInterval=dQ,e.findRange=mQ,e.intersectionSize=pQ;function t(a,l,c){return yQ(a,l,c)}e.forEach=t;function r(a,l,c,u){return vQ(a,l,c,u)}e.forEachSegment=r;function n(a){return Be.is(a)}e.isInterval=n;function o(a){return!Be.is(a)}e.isSortedArray=o;function i(a){let l=[];return e.forEach(a,c=>l.push(c)),l}e.toArray=i;function s(a){return sQ(a)}e.toString=s})(Ge||(Ge={}));function g5(e){let t=Qe.ofSortedArray(e),r=Qe.max(t),n=new Int32Array(r);for(let o=0,i=e.length-1;o<i;o++)for(let s=e[o],a=e[o+1];s<a;s++)n[s]=o;return{offsets:t,index:n,count:e.length-1}}function xQ(e,t){let r=Be.start(t),n=new Int32Array(e.length+1);for(let o=0,i=e.length;o<i;o++)n[o]=e[o]-r;return n[e.length]=Be.end(t)-r,g5(n)}function CQ({count:e}){return e}function SQ({index:e},t){return e[t]}function IQ({offsets:e},t,r){let n=Ge.max(e),o=r>=n?-1:Ge.findPredecessorIndex(e,r-1);return Ge.findRange(t,Ge.getAt(e,o),Ge.getAt(e,o+1)-1)}var h5=class{move(){for(;this.hasNext;)if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Be.size(this.setRange)>0;break}else this.updateSegmentRange();return this.value}updateValue(){let t=this.segments[this.segmentMin+1],r=Ge.findPredecessorIndexInInterval(this.set,t,this.setRange);return this.value.start=Be.start(this.setRange),this.value.end=r,this.setRange=Be.ofBounds(r,Be.end(this.setRange)),r>this.value.start}updateSegmentRange(){let t=Be.min(this.setRange),r=Be.max(this.setRange);if(r<t){this.hasNext=!1;return}this.segmentMin=this.segmentMap[Ge.getAt(this.set,t)],this.segmentMax=this.segmentMap[Ge.getAt(this.set,r)],this.hasNext=this.segmentMax>=this.segmentMin}setSegment(t){this.setRange=Be.ofBounds(t.start,t.end),this.updateSegmentRange()}constructor(t,r,n,o){this.segments=t,this.segmentMap=r,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=Be.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=o,this.updateSegmentRange()}};function AQ(e,t,r){let n=typeof r<"u"?Be.ofBounds(r.start,r.end):Be.ofBounds(0,Ge.size(t));return new h5(e.offsets,e.index,t,n)}var Vt;(function(e){e.create=g5,e.ofOffsets=xQ,e.count=CQ,e.getSegment=SQ,e.projectValue=IQ,e.transientSegments=AQ})(Vt||(Vt={}));function v5(e){return new y5(e)}var y5=class{remove(t){let{prev:r,next:n}=this,o=r[t],i=n[t];o>=0&&(n[o]=i,r[t]=-1),i>=0&&(r[i]=o,n[t]=-1),t===this.head&&(o<0?this.head=i:this.head=o)}has(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t}constructor(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(let r=0;r<t;r++)this.next[r]=r+1,this.prev[r]=r-1;this.prev[0]=-1,this.next[t-1]=-1}};var Ja;(function(e){e.Empty=new Map;function t(s){return wx(s.keys())}e.keyArray=t;function r(){return new Map}e.Mutable=r;function n(s){return s}e.asImmutable=n;function o(s){let a=r(),l=s.keys();for(;;){let{done:c,value:u}=l.next();if(c)break;a.set(u,s.get(u))}return a}e.copy=o;function i(s,a){let l=a.keys();for(;;){let{done:c,value:u}=l.next();if(c)break;s.set(u,a.get(u))}return s}e.addFrom=i})(Ja||(Ja={}));var b5=class{move(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue}constructor(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}},e3=class{move(){return++this.value,this.hasNext=this.value<this.max,this.value}constructor(t,r){this.max=r,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=r>=t}},x5=class{move(){return this.hasNext=!1,this.value}constructor(t){this.value=t,this.hasNext=!0}},C5=class{move(){let t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t}constructor(t,r){this.base=t,this.f=r,this.hasNext=!1,this.hasNext=t.hasNext}},S5=class{move(){let t=this.next;return this.hasNext=this.findNext(),t}findNext(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1}constructor(t,r){this.base=t,this.p=r,this.hasNext=this.findNext()}},H0;(function(e){e.Empty=new e3(0,-1);function t(a){return new b5(a)}e.Array=t;function r(a){return new x5(a)}e.Value=r;function n(a,l){return new e3(a,l)}e.Range=n;function o(a,l){return new C5(a,l)}e.map=o;function i(a,l){return new S5(a,l)}e.filter=i;function s(a,l,c){for(;a.hasNext;)if(l(a.move(),c))return c;return c}e.forEach=s})(H0||(H0={}));var UDe={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""},ns;(function(e){function t(r){let{domain:n,reverse:o,listOrName:i}={...UDe,...r},s=typeof i=="string"?fa(i).list:i,a=o?s.slice().reverse():s,l=a.length-1,c=0,u=0,d=0;function m(g,b){u=g,d=b,c=d-u||1}m(n[0],n[1]);let p=Qi(r.minLabel,u.toString()),h=Qi(r.maxLabel,d.toString()),f;if(a.every(g=>Array.isArray(g))){let g=[...a];g.sort((A,v)=>A[1]-v[1]);let b=g.map(A=>A[0]),y=Qe.ofSortedArray(g.map(A=>A[1])),x=b.length-1;f=A=>{let v=ko((A-u)/c,0,1),_=Qe.findPredecessorIndex(y,v);if(_===0)return b[u];if(_>x)return b[x];let I=y[_-1],T=y[_],E=ko((v-I)/(T-I),0,1);return ze.interpolate(b[_-1],b[_],E)}}else f=g=>{let b=Math.min(a.length-1,Math.max(0,(g-u)/c*l)),y=Math.floor(b),x=a[y],A=a[Math.ceil(b)];return ze.interpolate(x,A,b-y)};return{color:f,colorToArray:(g,b,y)=>{ze.toArray(f(g),b,y)},normalizedColorToArray:(g,b,y)=>{ze.toArrayNormalized(f(g),b,y)},setDomain:m,get legend(){return pY(p,h,a)}}}e.create=t})(ns||(ns={}));function lm(e,t,r){let n=new Float32Array(e);for(let o=0;o<n.length;o++)n[o]=t+r*o;return n}var eo;(function(e){e.DefaultName="1_555",e.Default=t(e.DefaultName,de.identity()),e.RotationTranslationEpsilon=.005;function t(b,y,x){let{assembly:A,ncsId:v,hkl:_,spgrOp:I,key:T}=x||{},E=_?D.clone(_):D();I=I??-1,T=T??-1,v=v||-1;let w=de.isIdentity(y),S=n(x,w);return w?{name:b,assembly:A,matrix:y,inverse:de.identity(),isIdentity:!0,hkl:E,spgrOp:I,ncsId:v,suffix:S,key:T}:(de.isRotationAndTranslation(y,e.RotationTranslationEpsilon),{name:b,assembly:A,matrix:y,inverse:de.invert(de(),y),isIdentity:!1,hkl:E,spgrOp:I,key:T,ncsId:v,suffix:S})}e.create=t;function r(b){return!!b&&!!b.matrix&&!!b.inverse&&typeof b.name=="string"}function n(b,y){if(!b)return"";if(b.assembly)return r(b)?b.suffix:y?"":`_${b.assembly.operId}`;if(typeof b.spgrOp<"u"&&typeof b.hkl<"u"&&b.spgrOp!==-1){let[x,A,v]=b.hkl;return`-${b.spgrOp+1}_${5+x}${5+A}${5+v}`}return b.ncsId!==-1?`_${b.ncsId}`:""}let o=de();function i(b,y){de.setIdentity(o);for(let x=0;x<3;x++)for(let A=0;A<3;A++)de.setValue(o,x,A,nr.getValue(b,x,A));return de.setTranslation(o,y),de.isRotationAndTranslation(o,e.RotationTranslationEpsilon)}e.checkIfRotationAndTranslation=i;function s(b,y,x,A){let v=de.identity();for(let _=0;_<3;_++)for(let I=0;I<3;I++)de.setValue(v,_,I,nr.getValue(y,_,I));return de.setTranslation(v,x),t(b,v,{ncsId:A})}e.ofRotationAndOffset=s;let a=Tn.identity(),l=Tn(),c=Tn(),u=D();function d(b,y,x){let A=y.inverse;if(y.isIdentity)return de.copy(b,A);let v=1-x;de.getRotation(l,A),Tn.slerp(l,a,l,v);let _=Tn.getAxisAngle(u,l);return de.fromRotation(b,_,u),de.setValue(b,0,3,v*de.getValue(A,0,3)),de.setValue(b,1,3,v*de.getValue(A,1,3)),de.setValue(b,2,3,v*de.getValue(A,2,3)),b}e.lerpFromIdentity=d;function m(b,y,x,A){if(Math.abs(A)<=1e-5)return de.copy(b,y);if(Math.abs(A-1)<=1e-5)return de.copy(b,x);de.getRotation(l,y),de.getRotation(c,x),Tn.slerp(c,l,c,A);let v=Tn.getAxisAngle(u,c);return de.fromRotation(b,v,u),de.setValue(b,0,3,zn(de.getValue(y,0,3),de.getValue(x,0,3),A)),de.setValue(b,1,3,zn(de.getValue(y,1,3),de.getValue(x,1,3),A)),de.setValue(b,2,3,zn(de.getValue(y,2,3),de.getValue(x,2,3),A)),b}e.slerp=m;function p(b,y){let x=de.mul(de(),y.matrix,b.matrix);return t(y.name,x,y)}e.compose=p;class h{constructor(y,x,A=t3){this.operator=y,this.coordinates=x,this.r=A,this._x=x.x,this._y=x.y,this._z=x.z,this._m=y.matrix}invariantPosition(y,x){return x[0]=this._x[y],x[1]=this._y[y],x[2]=this._z[y],x}position(y,x){return x[0]=this._x[y],x[1]=this._y[y],x[2]=this._z[y],D.transformMat4(x,x,this._m),x}x(y){let x=this._m,A=x[0],v=x[4],_=x[8],I=x[12],T=this._x[y],E=this._y[y],w=this._z[y],S=x[3]*T+x[7]*E+x[11]*w+x[15]||1;return(A*T+v*E+_*w+I)/S}y(y){let x=this._m,A=x[1],v=x[5],_=x[9],I=x[13],T=this._x[y],E=this._y[y],w=this._z[y],S=x[3]*T+x[7]*E+x[11]*w+x[15]||1;return(A*T+v*E+_*w+I)/S}z(y){let x=this._m,A=x[2],v=x[6],_=x[10],I=x[14],T=this._x[y],E=this._y[y],w=this._z[y],S=x[3]*T+x[7]*E+x[11]*w+x[15]||1;return(A*T+v*E+_*w+I)/S}}class f{constructor(y,x,A=t3){this.operator=y,this.coordinates=x,this.r=A,this._x=x.x,this._y=x.y,this._z=x.z,this._m=y.matrix}invariantPosition(y,x){return x[0]=this._x[y],x[1]=this._y[y],x[2]=this._z[y],x}position(y,x){return x[0]=this.x(y),x[1]=this.y(y),x[2]=this.z(y),x}x(y){let x=this._m;return x[0]*this._x[y]+x[4]*this._y[y]+x[8]*this._z[y]+x[12]}y(y){let x=this._m;return x[1]*this._x[y]+x[5]*this._y[y]+x[9]*this._z[y]+x[13]}z(y){let x=this._m;return x[2]*this._x[y]+x[6]*this._y[y]+x[10]*this._z[y]+x[14]}}class C{constructor(y,x,A=t3){this.operator=y,this.coordinates=x,this.r=A,this._x=x.x,this._y=x.y,this._z=x.z}invariantPosition(y,x){return x[0]=this._x[y],x[1]=this._y[y],x[2]=this._z[y],x}position(y,x){return x[0]=this._x[y],x[1]=this._y[y],x[2]=this._z[y],x}x(y){return this._x[y]}y(y){return this._y[y]}z(y){return this._z[y]}}function g(b,y,x=t3){return de.isIdentity(b.matrix)?new C(b,y,x):zDe(b.matrix)?new f(b,y,x):new h(b,y,x)}e.createMapping=g})(eo||(eo={}));function t3(e){return 0}function zDe(e){return e[3]===0&&e[7]===0&&e[11]===0&&e[15]===1}var r3=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,.3333333333333333],[0,0,1,.6666666666666666],[1,0,0,.6666666666666666],[0,1,0,.3333333333333333],[0,-1,0,.6666666666666666],[1,-1,0,.3333333333333333],[-1,1,0,.6666666666666666],[-1,0,0,.3333333333333333],[1,0,0,.3333333333333333],[0,1,0,.6666666666666666],[0,-1,0,.3333333333333333],[1,-1,0,.6666666666666666],[-1,1,0,.3333333333333333],[-1,0,0,.6666666666666666],[0,0,-1,.3333333333333333],[0,0,-1,.6666666666666666],[0,0,1,.8333333333333334],[0,0,1,.16666666666666666],[0,0,-1,.8333333333333334],[0,0,-1,.16666666666666666]],wQ=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],_Q=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],w2={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function HDe(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}let t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}function jDe(e){if(e<146)return e+1;if(e===146)return 1146;if(e<149)return e+1-1;if(e===149)return 1148;if(e<157)return e+1-2;if(e===157)return 1155;if(e<163)return e+1-3;if(e===163)return 1160;if(e<165)return e+1-4;if(e===165)return 1161;if(e<171)return e+1-5;if(e===171)return 1166;if(e<173)return e+1-6;if(e===173)return 1167;if(e<237)return e+1-7;if(e===237)return 1003;if(e===238)return 1004;if(e===239)return 1005;if(e===240)return 2005;if(e===241)return 3005;if(e===242)return 4005;if(e===243)return 5005;if(e===244)return 1006;if(e===245)return 1007;if(e===246)return 1008;if(e===247)return 1009;if(e===248)return 1010;if(e===249)return 1011;if(e===250)return 1012;if(e===251)return 1013;if(e===252)return 1014;if(e===253)return 2014;if(e===254)return 3014;if(e===255)return 1015;if(e===256)return 1017;if(e===257)return 2017;if(e===258)return 1018;if(e===259)return 2018;if(e===260)return 3018;if(e===261)return 1020;if(e===262)return 1021;if(e===263)return 1022;if(e===264)return 1023;if(e===265)return 1059;if(e===266)return 1094;if(e===267)return 1197;throw new Error(`unknown spacegroup index '${e}'`)}var I5=function(){let e=Object.create(null);for(let t of Object.keys(w2))e[w2[t]]=t;return e}(),TQ=function(){let e=Object.create(null);for(let t of Object.keys(w2)){let r=w2[t];e[r]=jDe(r)}return e}();function EQ(e){let t=typeof e=="number"?HDe(e):w2[e];return typeof t>"u"||typeof I5[t]>"u"?-1:t}var Ni;(function(e){e.Zero=r("P 1",D.create(1,1,1),D.create(Math.PI/2,Math.PI/2,Math.PI/2));function t(n){return n?n.index===0&&n.size[0]===1&&n.size[1]===1&&n.size[1]===1:!0}e.isZero=t;function r(n,o,i){let s=EQ(n);if(s<0)return e.Zero;let a=o[0]*o[1]*o[2],l=i[0],c=i[1],u=i[2],d=o[0],m=o[1],p=o[2],h=Math.cos(c),f=(Math.cos(l)-Math.cos(c)*Math.cos(u))/Math.sin(u),C=Math.sqrt(1-h*h-f*f),g=[d,0,0],b=[Math.cos(u)*m,Math.sin(u)*m,0],y=[h*p,f*p,C*p],x=de.ofRows([[g[0],b[0],y[0],0],[0,b[1],y[1],0],[0,0,y[2],0],[0,0,0,1]]),A=de.invert(de.zero(),x);return{index:s,size:o,volume:a,anglesInRadians:i,toFractional:A,fromFractional:x}}e.create=r})(Ni||(Ni={}));var ha;(function(e){e.ZeroP1=t(Ni.Zero);function t(C){let g=_Q[C.index].map(x=>d(wQ[x])),b=I5[C.index],y=TQ[C.index];return{name:b,num:y,cell:C,operators:g}}e.create=t;let r=D(),n=de();function o(C,g,b,y,x,A){return D.set(r,b,y,x),de.fromTranslation(n,r),de.mul(A,de.mul(A,de.mul(A,C.cell.fromFractional,n),C.operators[g]),C.cell.toFractional)}e.setOperatorMatrix=o;function i(C,g,b,y,x){let A=o(C,g,b,y,x,de.zero());return eo.create(`${g+1}_${5+b}${5+y}${5+x}`,A,{hkl:D.create(b,y,x),spgrOp:g})}e.getSymmetryOperator=i;let s=D(),a=D(),l=D(),c=D();function u(C,g,b,y,x,A){let v=de.zero();D.set(r,b,y,x),D.floor(s,A),de.copy(v,C.operators[g]),D.floor(a,D.transformMat4(a,A,v)),de.getTranslation(c,v),D.sub(c,c,a),D.add(c,c,s),D.add(c,c,r),de.setTranslation(v,c),de.mul(v,C.cell.fromFractional,v),de.mul(v,v,C.cell.toFractional),D.sub(l,a,s);let _=b-l[0],I=y-l[1],T=x-l[2];return eo.create(`${g+1}_${5+_}${5+I}${5+T}`,v,{hkl:D.create(_,I,T),spgrOp:g})}e.getSymmetryOperatorRef=u;function d(C){let g=r3[C[0]],b=r3[C[1]],y=r3[C[2]];return de.ofRows([g,b,y,[0,0,0,1]])}function m(C){return[f(p(C[0],C[4],C[8]),h(C[12])),f(p(C[1],C[5],C[9]),h(C[13])),f(p(C[2],C[6],C[10]),h(C[14]))].join(",")}e.getOperatorXyz=m;function p(C,g,b){let y=[];if(C>0?y.push("+X"):C<0&&y.push("-X"),g>0?y.push("+Y"):g<0&&y.push("-Y"),b>0?y.push("+Z"):b<0&&y.push("-Z"),y.length===1)return y[0].charAt(0)==="+"?y[0].substr(1):y[0];if(y.length===2){let x=y[0].charAt(0),A=y[1].charAt(0);if(x==="+")return`${y[0].substr(1)}${y[1]}`;if(A==="+")return`${y[1].substr(1)}${y[0]}`}throw new Error(`unknown rotation '${y}', ${C} ${g} ${b}`)}function h(C){switch(C){case 1/2:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function f(C,g){return g===""?C:C.length>2?`${C}+${g}`:C.charAt(0)==="-"?`${g}${C}`:`${g}+${C}`}})(ha||(ha={}));var Bu;(function(e){function t(i,s,a){i.squaredDistances[i.count]=a,i.indices[i.count++]=s}e.add=t;function r(i){i.count=0}e.reset=r;function n(){return{count:0,indices:[],squaredDistances:[]}}e.create=n;function o(i,s){for(let a=0;a<s.count;++a)i.indices[a]=s.indices[a],i.squaredDistances[a]=s.squaredDistances[a];return i.count=s.count,i}e.copy=o})(Bu||(Bu={}));function os(){return os.empty()}(function(e){function t(m,p,h,f){return{origin:m,dirA:p,dirB:h,dirC:f}}e.create=t;function r(){return{origin:D(),dirA:D(),dirB:D(),dirC:D()}}e.empty=r;function n(m,p){return D.copy(m.origin,p.origin),D.copy(m.dirA,p.dirA),D.copy(m.dirB,p.dirB),D.copy(m.dirC,p.dirC),m}e.copy=n;function o(m){return n(r(),m)}e.clone=o;function i(m,p){return D.set(m,D.magnitude(p.dirA)*2,D.magnitude(p.dirB)*2,D.magnitude(p.dirC)*2)}e.size=i;let s=D();function a(m){return i(s,m),s[0]*s[1]*s[2]}e.volume=a;function l(m,p){return D.copy(m.origin,p.origin),D.normalize(m.dirA,p.dirA),D.normalize(m.dirB,p.dirB),D.normalize(m.dirC,p.dirC),m}e.normalize=l;let c=nr();function u(m,p,h){D.transformMat4(m.origin,p.origin,h);let f=nr.directionTransform(c,h);return D.transformMat3(m.dirA,p.dirA,f),D.transformMat3(m.dirB,p.dirB,f),D.transformMat3(m.dirC,p.dirC,f),m}e.transform=u;function d(m,p,h){return D.scale(m.dirA,p.dirA,h),D.scale(m.dirB,p.dirB,h),D.scale(m.dirC,p.dirC,h),m}e.scale=d})(os||(os={}));var pn;(function(e){function t(m,p,h=Float32Array){let f=m*p;return{data:new h(f),size:f,cols:m,rows:p}}e.create=t;function r(m,p,h){return m.data[m.rows*h+p]}e.get=r;function n(m,p,h,f){return m.data[m.rows*h+p]=f,m}e.set=n;function o(m,p,h,f){return m.data[m.rows*h+p]+=f,m}e.add=o;function i(m){return m.data.fill(0),m}e.makeZero=i;function s(m){return{data:m.data.slice(),size:m.size,cols:m.cols,rows:m.rows}}e.clone=s;function a(m,p,h){return{data:m,size:p*h,cols:p,rows:h}}e.fromArray=a;function l(m,p){if(m.cols!==p.rows||m.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(m.data===p.data)throw new Error("transpose: matrices share memory");let h=p.rows,f=p.cols,C=p.data,g=m.data;for(let b=0,y=0,x=0;b<h;x+=1,y+=f,++b){let A=x;for(let v=0;v<f;A+=h,v++)g[A]=C[y+v]}return m}e.transpose=l;function c(m,p,h){let f=p.cols,C=p.rows,g=h.rows,b=p.data,y=h.data,x=m.data;for(let A=0,v=0,_=0;A<C;v+=f,A++)for(let I=0,T=0;T<g;_++,T++){let E=0,w=v;for(let S=0;S<f;w++,I++,S++)E+=b[w]*y[I];x[_]=E}return m}e.multiplyABt=c;function u(m){let p=m.rows,h=m.cols,f=m.data,C=new Array(h);for(let g=0;g<h;++g)C[g]=0;for(let g=0,b=0;g<p;++g)for(let y=0;y<h;++y,++b)C[y]+=f[b];for(let g=0;g<h;++g)C[g]/=p;return C}e.meanRows=u;function d(m,p){let h=m.rows,f=m.cols,C=m.data;for(let g=0,b=0;g<h;++g)for(let y=0;y<f;++y,++b)C[b]-=p[y];return m}e.subRows=d})(pn||(pn={}));function A5(e,t,r,n){n=e[t],e[t]=e[r],e[r]=n}function $De(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var WDe=1192092896e-16,qDe=1e-37;function ZDe(e,t,r,n,o,i,s,a){let l=WDe*2,c=qDe,u=0,d=0,m=0,p=0,h=Math.max(i,30),f=0,C=0,g=0,b=0,y=0,x=0,A=0,v=0,_=0,I=0,T=0,E=0,w=0,S=0,P=0,k=0,L=0,R=4660,N=0,F=0,H=0,V=new Float64Array(s<<3);for(;u<s;u++){for(m=0,T=0;m<i;m++)v=e[u*t+m],T+=v*v;if(V[u]=T,n){for(m=0;m<s;m++)n[u*o+m]=0;n[u*o+u]=1}}for(;p<h;p++){for(y=0,u=0;u<s-1;u++)for(d=u+1;d<s;d++){for(f=u*t|0,C=d*t|0,P=V[u],k=0,L=V[d],m=2,k+=e[f]*e[C],k+=e[f+1]*e[C+1];m<i;m++)k+=e[f+m]*e[C+m];if(!(Math.abs(k)<=l*Math.sqrt(P*L))){for(k*=2,E=P-L,w=$De(k,E),E<0?(S=(w-E)*.5,A=Math.sqrt(S/w),x=k/(w*A*2)):(x=Math.sqrt((w+E)/(w*2)),A=k/(w*x*2)),P=0,L=0,m=2,_=x*e[f]+A*e[C],I=-A*e[f]+x*e[C],e[f]=_,e[C]=I,P+=_*_,L+=I*I,_=x*e[f+1]+A*e[C+1],I=-A*e[f+1]+x*e[C+1],e[f+1]=_,e[C+1]=I,P+=_*_,L+=I*I;m<i;m++)_=x*e[f+m]+A*e[C+m],I=-A*e[f+m]+x*e[C+m],e[f+m]=_,e[C+m]=I,P+=_*_,L+=I*I;if(V[u]=P,V[d]=L,y=1,n)for(g=u*o|0,b=d*o|0,m=2,_=x*n[g]+A*n[b],I=-A*n[g]+x*n[b],n[g]=_,n[b]=I,_=x*n[g+1]+A*n[b+1],I=-A*n[g+1]+x*n[b+1],n[g+1]=_,n[b+1]=I;m<s;m++)_=x*n[g+m]+A*n[b+m],I=-A*n[g+m]+x*n[b+m],n[g+m]=_,n[b+m]=I}}if(y===0)break}for(u=0;u<s;u++){for(m=0,T=0;m<i;m++)v=e[u*t+m],T+=v*v;V[u]=Math.sqrt(T)}for(u=0;u<s-1;u++){for(d=u,m=u+1;m<s;m++)V[d]<V[m]&&(d=m);if(u!==d&&(A5(V,u,d,T),n)){for(m=0;m<i;m++)A5(e,u*t+m,d*t+m,v);for(m=0;m<s;m++)A5(n,u*o+m,d*o+m,v)}}for(u=0;u<s;u++)r[u]=V[u];if(n)for(u=0;u<a;u++){for(T=u<s?V[u]:0;T<=c;){for(F=1/i,m=0;m<i;m++)R=R*214013+2531011,N=R>>16&32767&256?F:-F,e[u*t+m]=N;for(p=0;p<2;p++)for(d=0;d<u;d++){for(T=0,m=0;m<i;m++)T+=e[u*t+m]*e[d*t+m];for(H=0,m=0;m<i;m++)v=e[u*t+m]-T*e[d*t+m],e[u*t+m]=v,H+=Math.abs(v);for(H=H?1/H:0,m=0;m<i;m++)e[u*t+m]*=H}for(T=0,m=0;m<i;m++)v=e[u*t+m],T+=v*v;T=Math.sqrt(T)}for(A=1/T,m=0;m<i;m++)e[u*t+m]*=A}}function PQ(e,t,r,n){let o=0,i=0,s=e.rows,a=e.cols,l=s,c=a;l<c&&(o=1,i=l,l=c,c=i);let u=pn.create(l,l),d=pn.create(1,c),m=pn.create(c,c);if(o===0)pn.transpose(u,e);else{for(i=0;i<a*s;i++)u.data[i]=e.data[i];for(;i<c*l;i++)u.data[i]=0}if(ZDe(u.data,l,d.data,m.data,c,l,c,l),t){for(i=0;i<c;i++)t.data[i]=d.data[i];for(;i<a;i++)t.data[i]=0}o===0?(r&&pn.transpose(r,u),n&&pn.transpose(n,m)):(r&&pn.transpose(r,m),n&&pn.transpose(n,u))}var gl;(function(e){function t(s){let a=r(s),l=i(s,a);return{momentsAxes:a,boxAxes:l}}e.ofPositions=t;function r(s){if(s.length===3)return os.create(D.fromArray(D(),s,0),D.create(1,0,0),D.create(0,1,0),D.create(0,0,1));let a=pn.fromArray(s,3,s.length/3),l=a.rows,c=l/3,u=pn.create(3,3),d=pn.create(1,3),m=pn.create(3,3),p=pn.create(3,3),h=pn.meanRows(a),f=pn.subRows(pn.clone(a),h),C=pn.transpose(pn.create(l,3),f);pn.multiplyABt(u,C,C),PQ(u,d,m,p);let g=D.create(h[0],h[1],h[2]),b=D.create(m.data[0],m.data[3],m.data[6]),y=D.create(m.data[1],m.data[4],m.data[7]),x=D.create(m.data[2],m.data[5],m.data[8]);return D.scale(b,b,Math.sqrt(d.data[0]/c)),D.scale(y,y,Math.sqrt(d.data[1]/c)),D.scale(x,x,Math.sqrt(d.data[2]/c)),os.create(g,b,y,x)}e.calculateMomentsAxes=r;function n(s){let a=os.clone(s);return D.magnitude(a.dirC)<1e-6&&D.cross(a.dirC,a.dirA,a.dirB),os.normalize(a,a)}e.calculateNormalizedAxes=n;let o=D();function i(s,a){if(s.length===3)return os.clone(a);let l=-1/0,c=-1/0,u=-1/0,d=-1/0,m=-1/0,p=-1/0,h=D(),f=D(),C=a.origin,g=n(a);for(let E=0,w=s.length;E<w;E+=3){D.projectPointOnVector(h,D.fromArray(h,s,E),g.dirA,C);let S=D.dot(g.dirA,D.normalize(f,D.sub(f,h,C))),P=D.distance(h,C);S>0?P>l&&(l=P):P>c&&(c=P),D.projectPointOnVector(h,D.fromArray(h,s,E),g.dirB,C);let k=D.dot(g.dirB,D.normalize(f,D.sub(f,h,C))),L=D.distance(h,C);k>0?L>u&&(u=L):L>d&&(d=L),D.projectPointOnVector(h,D.fromArray(h,s,E),g.dirC,C);let R=D.dot(g.dirC,D.normalize(f,D.sub(f,h,C))),N=D.distance(h,C);R>0?N>m&&(m=N):N>p&&(p=N)}let b=D.setMagnitude(D(),g.dirA,(l+c)/2),y=D.setMagnitude(D(),g.dirB,(u+d)/2),x=D.setMagnitude(D(),g.dirC,(m+p)/2),A=D.isFinite(b),v=D.isFinite(y),_=D.isFinite(x),I=D(),T=function(E,w,S){D.copy(o,C),A&&D.scaleAndAdd(o,o,g.dirA,E),v&&D.scaleAndAdd(o,o,g.dirB,w),_&&D.scaleAndAdd(o,o,g.dirC,S),D.add(I,I,o)};return T(l,u,m),T(l,u,-p),T(l,-d,-p),T(l,-d,m),T(-c,-d,-p),T(-c,-d,m),T(-c,u,m),T(-c,u,-p),D.scale(I,I,1/8),os.create(I,b,y,x)}e.calculateBoxAxes=i})(gl||(gl={}));function Pe(){return Pe.zero()}(function(e){function t(S){return S.extrema!==void 0}e.hasExtrema=t;function r(S,P){return{center:S,radius:P}}e.create=r;function n(){return{center:D(),radius:0}}e.zero=n;function o(S){let P=r(D.clone(S.center),S.radius);return t(S)&&(P.extrema=S.extrema.map(k=>D.clone(k))),P}e.clone=o;function i(S,P,k){return D.copy(S.center,P),S.radius=k,S}e.set=i;function s(S,P){return D.copy(S.center,P.center),S.radius=P.radius,t(P)&&a(S,P.extrema.map(k=>D.clone(k))),S}e.copy=s;function a(S,P){return S.extrema!==void 0?(S.extrema.length=0,S.extrema.push(...P)):S.extrema=P,S}e.setExtrema=a;function l(S){let{x:P,y:k,z:L,indices:R}=S,N=0,F=0,H=0,V=0,q=Ge.size(R);for(let Q=0;Q<q;Q++){let O=Ge.getAt(R,Q);N+=P[O],F+=k[O],H+=L[O]}q>0&&(N/=q,F/=q,H/=q);for(let Q=0;Q<q;Q++){let O=Ge.getAt(R,Q),B=P[O]-N,j=k[O]-F,U=L[O]-H,z=B*B+j*j+U*U;z>V&&(V=z)}return{center:D.create(N,F,H),radius:Math.sqrt(V)}}e.computeBounding=l;function c(S,P,k){return D.transformMat4(S.center,P.center,k),S.radius=P.radius*de.getMaxScaleOnAxis(k),t(P)&&a(S,P.extrema.map(L=>D.transformMat4(D(),L,k))),S}e.transform=c;function u(S,P,k){return D.add(S.center,P.center,k),t(P)&&a(S,P.extrema.map(L=>D.add(D(),L,k))),S}e.translate=u;function d(S,P,k){return D.toArray(S.center,P,k),P[k+3]=S.radius,P}e.toArray=d;function m(S,P,k){return D.fromArray(S.center,P,k),S.radius=P[k+3],S}e.fromArray=m;function p(S,P){return D.scale(S.center,D.add(S.center,P.max,P.min),.5),S.radius=D.distance(S.center,P.max),e.setExtrema(S,[D.create(P.min[0],P.min[1],P.min[2]),D.create(P.max[0],P.max[1],P.max[2]),D.create(P.max[0],P.min[1],P.min[2]),D.create(P.min[0],P.max[1],P.max[2]),D.create(P.min[0],P.min[1],P.max[2]),D.create(P.max[0],P.min[1],P.max[2]),D.create(P.max[0],P.max[1],P.min[2]),D.create(P.min[0],P.max[1],P.min[2])]),S}e.fromBox3D=p;function h(S,P){return D.copy(S.center,P.origin),S.radius=Math.max(D.magnitude(P.dirA),D.magnitude(P.dirB),D.magnitude(P.dirC)),S}e.fromAxes3D=h;let f=D();function C(S,P,k){let[L,R,N]=P,F=D.create(0,0,0);D.transformMat4(F,F,k);let H=D.create(L,R,N);D.transformMat4(H,H,k);let V=D.create(L,0,0);D.transformMat4(V,V,k);let q=D.create(0,R,N);D.transformMat4(q,q,k);let Q=D.create(0,0,N);D.transformMat4(Q,Q,k);let O=D.create(L,0,N);D.transformMat4(O,O,k);let B=D.create(L,R,0);D.transformMat4(B,B,k);let j=D.create(0,R,0);D.transformMat4(j,j,k),D.add(f,F,H),D.scale(f,f,.5);let U=Math.max(D.distance(F,H),D.distance(V,q));return e.set(S,f,U/2),e.setExtrema(S,[F,H,V,q,Q,O,B,j]),S}e.fromDimensionsAndTransform=C;let g=D();function b(S,P,k){return D.distance(P.center,k)<P.radius?e.copy(S,P):(D.sub(g,P.center,k),D.sub(g,P.center,g),D.setMagnitude(g,g,P.radius),D.scale(S.center,D.add(g,g,k),.5),S.radius=D.distance(S.center,k),S)}e.addVec3=b;function y(S,P,k){return D.copy(S.center,P.center),S.radius=Math.max(P.radius,D.distance(P.center,k.center)+k.radius),t(P)&&t(k)&&a(S,[...P.extrema.map(L=>D.clone(L)),...k.extrema.map(L=>D.clone(L))]),S}e.expandBySphere=y;let x=D();function A(S,P,k){var L,R;if(D.copy(S.center,P.center),S.radius=P.radius+k,P.radius<1e-12||((R=(L=P.extrema)===null||L===void 0?void 0:L.length)!==null&&R!==void 0?R:0)<=1)return S.extrema=void 0,S;if(t(P)){let N=new Float32Array(P.extrema.length*3);for(let H=0;H<P.extrema.length;H++)D.toArray(P.extrema[H],N,H*3);let F=gl.calculateMomentsAxes(N);os.scale(F,os.normalize(F,F),k),a(S,P.extrema.map(H=>{D.normalize(x,D.sub(x,H,P.center));let V=D.clone(H),q=D.dot(x,F.dirA)<0?-1:1;D.scaleAndAdd(V,V,F.dirA,q);let Q=D.dot(x,F.dirB)<0?-1:1;D.scaleAndAdd(V,V,F.dirB,Q);let O=D.dot(x,F.dirC)<0?-1:1;return D.scaleAndAdd(V,V,F.dirC,O),D.distance(S.center,V)>S.radius&&(P.extrema.length>=14&&D.normalize(x,D.sub(x,V,P.center)),D.scaleAndAdd(V,S.center,x,S.radius)),V}))}return S}e.expand=A;function v(S,P){return S.radius===P.radius&&D.exactEquals(S.center,P.center)}e.exactEquals=v;function _(S,P){let k=S.radius,L=P.radius;return Math.abs(k-L)<=1e-6*Math.max(1,Math.abs(k),Math.abs(L))&&D.equals(S.center,P.center)}e.equals=_;function I(S,P){if(t(P)){for(let k of P.extrema)if(D.distance(S.center,k)>S.radius)return!1;return!0}else return D.distance(S.center,P.center)+P.radius<=S.radius}e.includes=I;function T(S,P){return D.distance(S.center,P.center)<=S.radius+P.radius}e.overlaps=T;function E(S,P){return D.distance(S.center,P.center)-S.radius+P.radius}e.distance=E;function w(S,P){let{center:k,radius:L}=S;return D.distance(P,k)-L}e.distanceToVec=w})(Pe||(Pe={}));function xt(){return xt.zero()}(function(e){function t(T,E){return{min:T,max:E}}e.create=t;function r(){return{min:D(),max:D()}}e.zero=r;function n(T,E){return D.copy(T.min,E.min),D.copy(T.max,E.max),T}e.copy=n;function o(T){return n(r(),T)}e.clone=o;let i=D();function s(T,E){return Pe.hasExtrema(E)&&E.extrema.length>=14?l(T,E.extrema):(D.set(i,E.radius,E.radius,E.radius),D.sub(T.min,E.center,i),D.add(T.max,E.center,i),T)}e.fromSphere3D=s;function a(T,E){for(let w=0,S=E.length;w<S;w++)C(T,E[w]);return T}e.addVec3Array=a;function l(T,E){return f(T),a(T,E),T}e.fromVec3Array=l;function c(T,E){return Pe.hasExtrema(E)&&E.extrema.length>=14?a(T,E.extrema):(C(T,D.subScalar(i,E.center,E.radius)),C(T,D.addScalar(i,E.center,E.radius)),T)}e.addSphere3D=c;function u(T,E){return D.clamp(i,E.center,T.min,T.max),D.squaredDistance(i,E.center)<=E.radius*E.radius}e.intersectsSphere3D=u;function d(T){let E=D.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w=D.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),{x:S,y:P,z:k,indices:L}=T;for(let R=0,N=Ge.size(L);R<N;R++){let F=Ge.getAt(L,R);E[0]=Math.min(S[F],E[0]),E[1]=Math.min(P[F],E[1]),E[2]=Math.min(k[F],E[2]),w[0]=Math.max(S[F],w[0]),w[1]=Math.max(P[F],w[1]),w[2]=Math.max(k[F],w[2])}return{min:E,max:w}}e.computeBounding=d;function m(T,E){return D.sub(T,E.max,E.min)}e.size=m;let p=D();function h(T){return m(p,T),p[0]*p[1]*p[2]}e.volume=h;function f(T){return D.set(T.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),D.set(T.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),T}e.setEmpty=f;function C(T,E){return D.min(T.min,T.min,E),D.max(T.max,T.max,E),T}e.add=C;function g(T,E,w){return D.sub(T.min,E.min,w),D.add(T.max,E.max,w),T}e.expand=g;function b(T,E,w){return D.scale(T.min,E.min,w),D.scale(T.max,E.max,w),T}e.scale=b;let y=D();function x(T,E,w){let[S,P,k]=E.min,[L,R,N]=E.max;return f(T),C(T,D.transformMat4(y,D.set(y,S,P,k),w)),C(T,D.transformMat4(y,D.set(y,S,P,N),w)),C(T,D.transformMat4(y,D.set(y,S,R,k),w)),C(T,D.transformMat4(y,D.set(y,S,R,N),w)),C(T,D.transformMat4(y,D.set(y,L,P,k),w)),C(T,D.transformMat4(y,D.set(y,L,P,N),w)),C(T,D.transformMat4(y,D.set(y,L,R,k),w)),C(T,D.transformMat4(y,D.set(y,L,R,N),w)),T}e.transform=x;function A(T,E){return!(E[0]<T.min[0]||E[0]>T.max[0]||E[1]<T.min[1]||E[1]>T.max[1]||E[2]<T.min[2]||E[2]>T.max[2])}e.containsVec3=A;function v(T,E){return!(T.max[0]<E.min[0]||T.min[0]>E.max[0]||T.max[1]<E.min[1]||T.min[1]>E.max[1]||T.max[2]<E.min[2]||T.min[2]>E.max[2])}e.overlaps=v;function _(T,E){let w=E.center,S=E.radius;return!(w[0]-S<T.min[0]||w[0]+S>T.max[0]||w[1]-S<T.min[1]||w[1]+S>T.max[1]||w[2]-S<T.min[2]||w[2]+S>T.max[2])}e.containsSphere3D=_;function I(T,E,w,S){let[P,k,L]=E.min,[R,N,F]=E.max,[H,V,q]=w,Q=1/S[0],O=1/S[1],B=1/S[2],j,U,z,$,Z,J;return Q>=0?(j=(P-H)*Q,U=(R-H)*Q):(j=(R-H)*Q,U=(P-H)*Q),O>=0?(z=(k-V)*O,$=(N-V)*O):(z=(N-V)*O,$=(k-V)*O),B>=0?(Z=(L-q)*B,J=(F-q)*B):(Z=(F-q)*B,J=(L-q)*B),z>j&&(j=z),$<U&&(U=$),Z>j&&(j=Z),J<U&&(U=J),D.scale(T,S,j),D.set(T,T[0]+H,T[1]+V,T[2]+q)}e.nearestIntersectionWithRay=I})(xt||(xt={}));var _5=class{constructor(t,r){this.parent=null,this.child=null,this.degree=0,this.isMarked=!1,this.key=t,this.value=r,this.prev=this,this.next=this}},T5=class{constructor(t){if(this._index=-1,this._items=[],this._len=0,t){let r=t,n=0;do this._items[n++]=r,r=r.next;while(t!==r);this._len=n}}hasNext(){return this._index<this._len-1}next(){return this._items[++this._index]}reset(t){this._index=-1,this._len=0;let r=t,n=0;do this._items[n++]=r,r=r.next;while(t!==r);this._len=n}},w5=new T5,oC=class{constructor(t){this._minNode=null,this._nodeCount=0,this._compare=t||this._defaultCompare}clear(){this._minNode=null,this._nodeCount=0}decreaseKey(t,r){if(!t)throw new Error("Cannot decrease key of non-existent node");if(this._compare({key:r},{key:t.key})>0)throw new Error("New key is larger than old key");t.key=r;let n=t.parent;n&&this._compare(t,n)<0&&(this._cut(t,n,this._minNode),this._cascadingCut(n,this._minNode)),this._compare(t,this._minNode)<0&&(this._minNode=t)}delete(t){let r=t.parent;r&&(this._cut(t,r,this._minNode),this._cascadingCut(r,this._minNode)),this._minNode=t,this.extractMinimum()}extractMinimum(){let t=this._minNode;if(t){if(t.child){let n=t.child;do n.parent=null,n=n.next;while(n!==t.child)}let r=null;t.next!==t&&(r=t.next),this._removeNodeFromList(t),this._nodeCount--,this._minNode=this._mergeLists(r,t.child),this._minNode&&(this._minNode=this._consolidate(this._minNode))}return t}findMinimum(){return this._minNode}insert(t,r){let n=new _5(t,r);return this._minNode=this._mergeLists(this._minNode,n),this._nodeCount++,n}isEmpty(){return this._minNode===null}size(){return this._minNode===null?0:this._getNodeListSize(this._minNode)}union(t){this._minNode=this._mergeLists(this._minNode,t._minNode),this._nodeCount+=t._nodeCount}_defaultCompare(t,r){return t.key>r.key?1:t.key<r.key?-1:0}_cut(t,r,n){t.parent=null,r.degree--,t.next===t?r.child=null:r.child=t.next,this._removeNodeFromList(t);let o=this._mergeLists(n,t);return t.isMarked=!1,o}_cascadingCut(t,r){let n=t.parent;return n&&(t.isMarked?(r=this._cut(t,n,r),r=this._cascadingCut(n,r)):t.isMarked=!0),r}_consolidate(t){let r=[];for(w5.reset(t);w5.hasNext();){let o=w5.next(),i=r[o.degree];for(;i;){if(this._compare(o,i)>0){let s=o;o=i,i=s}this._linkHeaps(i,o),r[o.degree]=null,o.degree++,i=r[o.degree]}r[o.degree]=o}let n=null;for(let o=0;o<r.length;o++){let i=r[o];i&&(i.next=i,i.prev=i,n=this._mergeLists(n,i))}return n}_removeNodeFromList(t){let r=t.prev,n=t.next;r.next=n,n.prev=r,t.next=t,t.prev=t}_linkHeaps(t,r){this._removeNodeFromList(t),r.child=this._mergeLists(t,r.child),t.parent=r,t.isMarked=!1}_mergeLists(t,r){if(!t)return r||null;if(!r)return t;let n=t.next;return t.next=r.next,t.next.prev=t,r.next=n,r.next.prev=r,this._compare(t,r)<0?t:r}_getNodeListSize(t){let r=0,n=t;do r++,n.child&&(r+=this._getNodeListSize(n.child)),n=n.next;while(n!==t);return r}};function Ma(e,t,r){return new P5(e,t,r)}var P5=class{find(t,r,n,o,i){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=o,this.ctx.isCheck=!1;let s=i??this.result;return DQ(this.ctx,s),s}nearest(t,r,n,o=1,i,s){this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.k=o,this.ctx.stopIf=i;let a=s??this.result;return tke(this.ctx,a),a}check(t,r,n,o){return this.ctx.x=t,this.ctx.y=r,this.ctx.z=n,this.ctx.radius=o,this.ctx.isCheck=!0,DQ(this.ctx,this.result)}constructor(t,r,n){let o=XDe(t,r,n);this.ctx=YDe(o),this.boundary={box:o.boundingBox,sphere:o.boundingSphere},this.buckets={offset:o.bucketOffset,count:o.bucketCounts,array:o.bucketArray},this.result=Bu.create()}};function KDe(e){let{expandedBox:t,size:[r,n,o],data:{x:i,y:s,z:a,radius:l,indices:c},elementCount:u,delta:d}=e,m=r*n*o,{min:[p,h,f]}=t,C=0,g=0,b=new Uint32Array(m),y=new Int32Array(u);for(let I=0;I<u;I++){let T=Ge.getAt(c,I),E=Math.floor((i[T]-p)/d[0]),w=Math.floor((s[T]-h)/d[1]),S=Math.floor((a[T]-f)/d[2]),P=(E*n+w)*o+S;(b[P]+=1)===1&&(g+=1),y[I]=P}if(l)for(let I=0;I<u;I++){let T=Ge.getAt(c,I);l[T]>C&&(C=l[T])}let x=new Int32Array(g);for(let I=0,T=0;I<m;I++){let E=b[I];E>0&&(b[I]=T+1,x[T]=E,T+=1)}let A=new Uint32Array(g);for(let I=1;I<g;++I)A[I]+=A[I-1]+x[I-1];let v=new Int32Array(g),_=new Int32Array(u);for(let I=0;I<u;I++){let T=b[y[I]];if(T>0){let E=T-1;_[A[E]+v[E]]=I,v[E]+=1}}return{size:e.size,bucketArray:_,bucketCounts:x,bucketOffset:A,grid:b,delta:d,min:e.expandedBox.min,data:e.data,maxRadius:C,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}function XDe(e,t,r){let n=xt.expand(xt(),t.box,D.create(.5,.5,.5)),{indices:o}=e,i=xt.size(D(),n),s,a,l=Ge.size(o),c=typeof r=="number"?r:32,u=Array.isArray(r)&&r;if(u&&!D.isZero(u))a=[Math.ceil(i[0]/u[0]),Math.ceil(i[1]/u[1]),Math.ceil(i[2]/u[2])],s=u;else if(l>0){let p=Math.ceil(l/c),h=Math.pow(p/(i[0]*i[1]*i[2]),1/3);a=[Math.ceil(i[0]*h),Math.ceil(i[1]*h),Math.ceil(i[2]*h)],s=[i[0]/a[0],i[1]/a[1],i[2]/a[2]]}else s=i,a=[1,1,1];let d={x:e.x,y:e.y,z:e.z,indices:o,radius:e.radius},m={size:a,data:d,expandedBox:n,boundingBox:t.box,boundingSphere:t.sphere,elementCount:l,delta:s};return KDe(m)}function YDe(e){return{grid:e,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1}}function DQ(e,t){let{min:r,size:[n,o,i],bucketOffset:s,bucketCounts:a,bucketArray:l,grid:c,data:{x:u,y:d,z:m,indices:p,radius:h},delta:f,maxRadius:C}=e.grid,{radius:g,isCheck:b,x:y,y:x,z:A}=e,v=g+C,_=v*v;Bu.reset(t);let I=Math.max(0,Math.floor((y-v-r[0])/f[0])),T=Math.max(0,Math.floor((x-v-r[1])/f[1])),E=Math.max(0,Math.floor((A-v-r[2])/f[2])),w=Math.min(n-1,Math.floor((y+v-r[0])/f[0])),S=Math.min(o-1,Math.floor((x+v-r[1])/f[1])),P=Math.min(i-1,Math.floor((A+v-r[2])/f[2]));if(I>w||T>S||E>P)return!1;for(let k=I;k<=w;k++)for(let L=T;L<=S;L++)for(let R=E;R<=P;R++){let N=c[(k*o+L)*i+R];if(N===0)continue;let F=N-1,H=s[F],V=a[F],q=H+V;for(let Q=H;Q<q;Q++){let O=Ge.getAt(p,l[Q]),B=u[O]-y,j=d[O]-x,U=m[O]-A,z=B*B+j*j+U*U;if(z<=_){if(C>0&&Math.sqrt(z)-h[O]>g)continue;if(b)return!0;Bu.add(t,l[Q],z)}}}return t.count>0}var kQ=D(),j0=D(),_2=new Set,E5=new Set,QDe=[.1],JDe=[.1],eke=[.1],iC=new oC;function tke(e,t){let{min:r,expandedBox:n,boundingSphere:{center:o},size:[i,s,a],bucketOffset:l,bucketCounts:c,bucketArray:u,grid:d,data:{x:m,y:p,z:h,indices:f,radius:C},delta:g,maxRadius:b}=e.grid,{x:y,y:x,z:A,k:v,stopIf:_}=e,I=Ge.size(f);if(Bu.reset(t),I===0||v<=0)return!1;let T,E,w,S=!1,P=1,k=!0,L=0,R=QDe,N=JDe,F=0,H=!0,V,q=!1,Q=eke,O=b*b;R.length=0,Q.length=0,_2.clear(),iC.clear(),D.set(j0,y,x,A),xt.containsVec3(n,j0)?(T=Math.floor((y-r[0])/g[0]),E=Math.floor((x-r[1])/g[1]),w=Math.floor((A-r[2])/g[2])):(xt.nearestIntersectionWithRay(j0,n,j0,D.normalize(kQ,D.sub(kQ,o,j0))),T=Math.max(0,Math.min(i-1,Math.floor((j0[0]-r[0])/g[0]))),E=Math.max(0,Math.min(s-1,Math.floor((j0[1]-r[1])/g[1]))),w=Math.max(0,Math.min(a-1,Math.floor((j0[2]-r[2])/g[2]))));let B=b!==0?Math.max(1,Math.min(i-1,Math.ceil(b/g[0]))):1,j=b!==0?Math.max(1,Math.min(s-1,Math.ceil(b/g[1]))):1,U=b!==0?Math.max(1,Math.min(a-1,Math.ceil(b/g[2]))):1;for(R.push(T,E,w,(T*s+E)*a+w);t.count<I;){let z=P*4;for(let $=0;$<z;$+=4)if(V=R[$+3],!_2.has(V)){_2.add(V),q=_2.size>=d.length;let Z=d[V];if(Z!==0){let J=F,ie=Z-1,ne=l[ie],le=c[ie],ee=ne+le;for(let oe=ne;oe<ee;oe++){let te=u[oe],X=Ge.getAt(f,te),W=m[X]-y,K=p[X]-x,re=h[X]-A,se=W*W+K*K+re*re;if(b!==0){let me=C[X];se-=me*me}H&&se>F&&(F=se),iC.insert(se,te)}J<F&&(H=!1)}}N.length=0,L=0,E5.clear();for(let $=0;$<z;$+=4){T=R[$],E=R[$+1],w=R[$+2];for(let Z=-B;Z<=B;Z++){let J=T+Z;if(!(J<0||J>=i))for(let ie=-j;ie<=j;ie++){let ne=E+ie;if(!(ne<0||ne>=s))for(let le=-U;le<=U;le++){let ee=w+le;if(!(ee<0||ee>=a)&&(V=(J*s+ne)*a+ee,!E5.has(V)&&(E5.add(V),!_2.has(V)))){if(!k){let oe=r[0]+J*g[0]-y,te=r[1]+ne*g[1]-x,X=r[2]+ee*g[2]-A;if(oe*oe+te*te+X*X-O>F){Q.push(J,ne,ee,V);continue}}N.push(J,ne,ee,V),L++}}}}}if(k=!1,L===0){if(v===1){let $=iC.findMinimum();if($){let{key:Z,value:J}=$;return Bu.add(t,J,Z),!0}}else for(;!iC.isEmpty()&&(q||iC.findMinimum().key<=F)&&t.count<v;){let $=iC.extractMinimum(),Z=$.key,J=$.value;Bu.add(t,J,Z),_&&!S&&(S=_(J,Z))}if(t.count>=v||S||t.count>=I)return t.count>0;if(k=!0,H=!0,Q.length>0){for(let $=0,Z=Q.length;$<Z;$++)R.push(Q[$]);Q.length=0,P=R.length}}else{let $=R;R=N,N=$,P=L}}return t.count>0}function rke(e,t){for(let r=0,n=t*3;r<n;r+=3){let o=e[r],i=e[r+1],s=e[r+2],a=1/Math.sqrt(o*o+i*i+s*s);e[r]=o*a,e[r+1]=i*a,e[r+2]=s*a}return e}var Lu=D();function um(e,t,r,n){for(let o=0,i=n*3;o<i;o+=3)D.fromArray(Lu,t,r+o),D.transformMat4(Lu,Lu,e),D.toArray(Lu,t,r+o)}function LQ(e,t,r,n){for(let o=0,i=n*3;o<i;o+=3)D.fromArray(Lu,t,r+o),D.transformMat3(Lu,Lu,e),D.toArray(Lu,t,r+o)}function NQ(e,t){for(let r=0,n=e.length;r<n;r+=3)D.fromArray(Lu,e,r),D.normalize(Lu,Lu),D.scale(Lu,Lu,t),D.toArray(Lu,e,r)}var MQ=D(),D5=D(),RQ=D(),cm=D(),BQ=D();function n3(e,t,r,n,o){for(let i=0,s=o*3;i<s;i+=3){let a=t[i]*3,l=t[i+1]*3,c=t[i+2]*3;D.fromArray(MQ,e,a),D.fromArray(D5,e,l),D.fromArray(RQ,e,c),D.sub(cm,RQ,D5),D.sub(BQ,MQ,D5),D.cross(cm,cm,BQ),r[a]+=cm[0],r[a+1]+=cm[1],r[a+2]+=cm[2],r[l]+=cm[0],r[l+1]+=cm[1],r[l+2]+=cm[2],r[c]+=cm[0],r[c+1]+=cm[1],r[c+2]+=cm[2]}return rke(r,n)}function dm(e,t,r=1){let n=Da(e),o=new Int32Array(n+2),i=new Int32Array(t),s=new Int32Array(t);for(let c=0,u=t*r;c<u;c+=r)++s[e[c]];let a=0;for(let c=0;c<t;c++)o[c]=a,a+=s[c];o[t]=a;let l=new Int32Array(a);for(let c=0,u=t*r;c<u;c+=r){let d=e[c],m=o[d]+i[d];l[m]=c,++i[d]}return{indices:l,offsets:o}}var nke=D.add,oke=D.squaredDistance,ike=D.distance;var ec=class{reset(){D.set(this.center,0,0,0),this.radiusSq=0,this.count=0}includeStep(t){nke(this.center,this.center,t),this.count++}finishedIncludeStep(){this.count!==0&&D.scale(this.center,this.center,1/this.count)}radiusStep(t){let r=oke(t,this.center);r>this.radiusSq&&(this.radiusSq=r)}radiusSphereStep(t,r){let n=ike(t,this.center)+r,o=n*n;o>this.radiusSq&&(this.radiusSq=o)}getSphere(t){return t||(t=Pe()),D.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t}getCount(){return this.count}constructor(){this.count=0,this.center=D(),this.radiusSq=0}};(function(e){let t=new e,r=D(),n=D();function o({x:a,y:l,z:c},u){t.reset();let d=a.length;for(let m=0;m<d;m++)D.set(r,a[m],l[m],c[m]),t.includeStep(r);t.finishedIncludeStep();for(let m=0;m<d;m++)D.set(r,a[m],l[m],c[m]),t.radiusStep(r);return D.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u}e.fromArrays=o;function i(a,l,c){t.reset();for(let u=0;u<a;u++)l(u,r),t.includeStep(r);t.finishedIncludeStep();for(let u=0;u<a;u++)l(u,r),t.radiusStep(r);return D.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c}e.fromProvider=i;function s(a,l,c){t.reset();for(let u=0;u<a;u++)l(u,r,n),t.includeStep(r),t.includeStep(n);t.finishedIncludeStep();for(let u=0;u<a;u++)l(u,r,n),t.radiusStep(r),t.radiusStep(n);return D.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c}e.fromPairProvider=s})(ec||(ec={}));var FQ=D.dot,OQ=D.copy,ske=D.scaleAndSub,ake=D.scaleAndAdd,is=class{computeExtrema(t,r){let n=FQ(this.dir[t],r);n<this.minDist[t]&&(this.minDist[t]=n,OQ(this.extrema[t*2],r)),n>this.maxDist[t]&&(this.maxDist[t]=n,OQ(this.extrema[t*2+1],r))}computeSphereExtrema(t,r,n){let o=this.dir[t],i=FQ(o,r);i-n<this.minDist[t]&&(this.minDist[t]=i-n,ske(this.extrema[t*2],r,o,n)),i+n>this.maxDist[t]&&(this.maxDist[t]=i+n,ake(this.extrema[t*2+1],r,o,n))}includeSphere(t){if(Pe.hasExtrema(t)&&t.extrema.length>1)for(let r of t.extrema)this.includePosition(r);else this.includePositionRadius(t.center,t.radius)}includePosition(t){for(let r=0;r<this.dirLength;++r)this.computeExtrema(r,t)}includePositionRadius(t,r){for(let n=0;n<this.dirLength;++n)this.computeSphereExtrema(n,t,r)}finishedIncludeStep(){for(let t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()}radiusSphere(t){if(Pe.hasExtrema(t)&&t.extrema.length>1)for(let r of t.extrema)this.radiusPosition(r);else this.radiusPositionRadius(t.center,t.radius)}radiusPosition(t){this.centroidHelper.radiusStep(t)}radiusPositionRadius(t,r){this.centroidHelper.radiusSphereStep(t,r)}getSphere(t){return Pe.setExtrema(this.centroidHelper.getSphere(t),this.extrema.slice())}getBox(t){return xt.fromVec3Array(t||xt(),this.extrema)}reset(){for(let t=0;t<this.dirLength;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[t*2]=D(),this.extrema[t*2+1]=D();this.centroidHelper.reset()}constructor(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new ec,this.dir=lke(t),this.dirLength=this.dir.length,this.reset()}};function lke(e){let t;switch(e){case"6":t=[...o3];break;case"14":t=[...o3,...k5];break;case"26":t=[...o3,...k5,...VQ];break;case"98":t=[...o3,...k5,...VQ,...cke,...uke,...dke];break}return t.map(r=>{let n=D.create(r[0],r[1],r[2]);return D.normalize(n,n)})}var o3=[[1,0,0],[0,1,0],[0,0,1]],k5=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],VQ=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],cke=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],uke=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],dke=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]];var M5=D.fromArray,i3=D.transformMat4Offset;function mke(e,t){e=Math.max(e,2);let r=Math.sqrt(e),n=Math.ceil(r);n=n+(t-n%t)%t;let o=n>0?Math.ceil(e/n):0;return{width:n,height:o,length:n*o*t}}function mo(e,t,r,n){let{length:o,width:i,height:s}=mke(e,t);return n=n&&n.length>=o?n:new r(o),{array:n,width:i,height:s}}var mm=D(),pke=new is("14"),fke=new is("98");function GQ(e){return e>1e5?pke:fke}function Nu(e,t,r){let n=r*3,o=GQ(t);o.reset();for(let s=0,a=t*3;s<a;s+=n)M5(mm,e,s),o.includePosition(mm);o.finishedIncludeStep();for(let s=0,a=t*3;s<a;s+=n)M5(mm,e,s),o.radiusPosition(mm);let i=o.getSphere();if(t<=14){let s=[];for(let a=0,l=t*3;a<l;a+=n)s.push(M5(D(),e,a));Pe.setExtrema(i,s)}return i}var R5=de();function xi(e,t,r,n){if(r===1){de.fromArray(R5,t,n);let l=Pe.clone(e);return de.isIdentity(R5)?l:Pe.transform(l,l,R5)}let o=GQ(r);o.reset();let{center:i,radius:s,extrema:a}=e;if(a&&r<=14){for(let l=0,c=r;l<c;++l)for(let u of a)i3(mm,u,t,0,0,l*16+n),o.includePosition(mm);o.finishedIncludeStep();for(let l=0,c=r;l<c;++l)for(let u of a)i3(mm,u,t,0,0,l*16+n),o.radiusPosition(mm)}else{for(let l=0,c=r;l<c;++l)i3(mm,i,t,0,0,l*16+n),o.includePositionRadius(mm,s);o.finishedIncludeStep();for(let l=0,c=r;l<c;++l)i3(mm,i,t,0,0,l*16+n),o.radiusPositionRadius(mm,s)}return o.getSphere()}var tc=new Uint8Array(772);tc[1]=1;tc[2]=1;tc[3]=1;tc[256]=1;tc[512]=1;tc[768]=1;tc[257]=2;tc[513]=2;tc[769]=2;tc[258]=2;tc[514]=2;tc[770]=2;tc[259]=2;tc[515]=2;tc[771]=2;function B5(e,t){if(t===0)return 0;let r=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),n=t-4>>2,o=4*n,i=0;if(n<0)for(let s=0;s<t;++s)i+=e[s]&&1;else{for(let s=0;s<n;++s){let a=r[s];i+=tc[a&65535]+tc[a>>16]}for(let s=o;s<t;++s)i+=e[s]&&1}return i/t}function to(e,t,r){let n=mo(Math.max(1,e),1,Uint8Array,r&&r.tMarker.ref.value.array),o=B5(n.array,e),i=o===0?0:-1;return r?(G.updateIfChanged(r.uMarker,0),G.update(r.tMarker,n),G.update(r.uMarkerTexDim,Ve.create(n.width,n.height)),G.updateIfChanged(r.markerAverage,o),G.updateIfChanged(r.markerStatus,i),G.updateIfChanged(r.dMarkerType,t),r):{uMarker:G.create(0),tMarker:G.create(n),uMarkerTexDim:G.create(Ve.create(n.width,n.height)),markerAverage:G.create(o),markerStatus:G.create(i),dMarkerType:G.create(t)}}var X1t={array:new Uint8Array(1),width:1,height:1};var bs={kind:"null-location"};function s3(e,t,r){return{kind:"data-location",tag:e,data:t,element:r}}function Mr(e,t,r,n,o=!1,i=()=>!1,s){if(e%r!==0)throw new Error("incompatible groupCount and stride");let a={location:bs,location2:bs,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1},l=a.groupIndex<e,c=!1,u=0,d=0,m=!1,p=!!s;return{get hasNext(){return l},get isNextNewInstance(){return c},groupCount:e,instanceCount:t,count:e*t,stride:r,nonInstanceable:o,hasLocation2:p,move(){return l&&(a.groupIndex=u,a.instanceIndex=d,a.index=d*e+u,a.location=n(u,m?-1:d),p&&(a.location2=s(u,m?-1:d)),a.isSecondary=i(u,m?-1:d),u+=r,u===e?(++d,c=!0,d<t&&(u=0)):c=!1,l=u<e),a},reset(){a.location=bs,a.location2=bs,a.index=0,a.groupIndex=0,a.instanceIndex=0,a.isSecondary=!1,l=a.groupIndex<e,c=!1,u=0,d=0,m=!1},skipInstance(){l&&a.instanceIndex===d&&(++d,u=0,l=d<t)},voidInstances(){m=!0}}}function Ic(e,t){return{kind:"position-location",position:e?D.clone(e):D(),normal:t?D.clone(t):D()}}function UQ(e){return!!e&&e.kind==="position-location"}var HQ=ei();function hke(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(er(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}function Ib(e){let t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){let r=hke(e,t);throw new Error(`Framebuffer status: ${r}`)}}function zQ(e){let t=e.createFramebuffer();if(t===null)throw new Error("Could not create WebGL framebuffer");return t}function jQ(e){let t=zQ(e),r=!1;return{id:HQ(),bind:()=>e.bindFramebuffer(e.FRAMEBUFFER,t),reset:()=>{t=zQ(e)},destroy:()=>{r||(e.deleteFramebuffer(t),r=!0)}}}function $Q(){return{id:HQ(),bind:()=>{},reset:()=>{},destroy:()=>{}}}function L5(e){let t=WQ(e);if(t===null)throw new Error('Could not find support for "instanced_arrays"');let r=ZQ(e);if(r===null)throw new Error('Could not find support for "element_index_uint"');let n=qQ(e);if(n===null)throw new Error('Could not find support for "standard_derivatives"');let o=XQ(e),i=YQ(e),s=QQ(e),a=JQ(e),l=aJ(e),c=eJ(e),u=KQ(e),d=tJ(e),m=rJ(e),p=nJ(e),h=oJ(e),f=iJ(e),C=sJ(e),g=lJ(e),b=cJ(e),y=uJ(e),x=dJ(e),A=mJ(e),v=pJ(e),_=fJ(e),I=hJ(e),T=gJ(e),E=yJ(e),w=vJ(e),S=bJ(e),P=xJ(e);return{instancedArrays:t,standardDerivatives:n,elementIndexUint:r,textureFloat:o,textureFloatLinear:i,textureHalfFloat:s,textureHalfFloatLinear:a,depthTexture:l,blendMinMax:c,vertexArrayObject:u,fragDepth:d,colorBufferFloat:m,colorBufferHalfFloat:p,drawBuffers:h,drawBuffersIndexed:f,shaderTextureLod:C,sRGB:g,disjointTimerQuery:b,multiDraw:y,drawInstancedBaseVertexBaseInstance:x,multiDrawInstancedBaseVertexBaseInstance:A,parallelShaderCompile:v,fboRenderMipmap:_,provokingVertex:I,clipCullDistance:T,conservativeDepth:E,stencilTexturing:w,clipControl:S,noNonInstancedActiveAttribs:P}}function CJ(e,t){let r={},n=e.getParameter(e.FRONT_FACE),o=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),s=e.getParameter(e.DEPTH_CLEAR_VALUE),a=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),u=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),m=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),h=e.getParameter(e.BLEND_COLOR),f=e.getParameter(e.BLEND_EQUATION_RGB),C=e.getParameter(e.BLEND_EQUATION_ALPHA),g=e.getParameter(e.STENCIL_FUNC),b=e.getParameter(e.STENCIL_VALUE_MASK),y=e.getParameter(e.STENCIL_REF),x=e.getParameter(e.STENCIL_BACK_FUNC),A=e.getParameter(e.STENCIL_BACK_VALUE_MASK),v=e.getParameter(e.STENCIL_BACK_REF),_=e.getParameter(e.STENCIL_WRITEMASK),I=e.getParameter(e.STENCIL_BACK_WRITEMASK),T=e.getParameter(e.STENCIL_FAIL),E=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),w=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),S=e.getParameter(e.STENCIL_BACK_FAIL),P=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),k=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),L=e.getParameter(e.MAX_VERTEX_ATTRIBS),R=[],N=e.getParameter(e.VIEWPORT),F=e.getParameter(e.SCISSOR_BOX),H=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,V=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1,q=()=>{for(let Q=0;Q<L;++Q)R[Q]=0};return q(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:Q=>{r[Q]!==!0&&(e.enable(Q),r[Q]=!0)},disable:Q=>{r[Q]!==!1&&(e.disable(Q),r[Q]=!1)},frontFace:Q=>{Q!==n&&(e.frontFace(Q),n=Q)},cullFace:Q=>{Q!==o&&(e.cullFace(Q),o=Q)},depthMask:Q=>{Q!==i&&(e.depthMask(Q),i=Q)},clearDepth:Q=>{Q!==s&&(e.clearDepth(Q),s=Q)},depthFunc:Q=>{Q!==a&&(e.depthFunc(Q),a=Q)},colorMask:(Q,O,B,j)=>{(Q!==l[0]||O!==l[1]||B!==l[2]||j!==l[3])&&(e.colorMask(Q,O,B,j),l[0]=Q,l[1]=O,l[2]=B,l[3]=j)},clearColor:(Q,O,B,j)=>{(Q!==c[0]||O!==c[1]||B!==c[2]||j!==c[3])&&(e.clearColor(Q,O,B,j),c[0]=Q,c[1]=O,c[2]=B,c[3]=j)},blendFunc:(Q,O)=>{(Q!==u||O!==d||Q!==m||O!==p)&&(e.blendFunc(Q,O),u=Q,d=O,m=Q,p=O)},blendFuncSeparate:(Q,O,B,j)=>{(Q!==u||O!==d||B!==m||j!==p)&&(e.blendFuncSeparate(Q,O,B,j),u=Q,d=O,m=B,p=j)},blendEquation:Q=>{(Q!==f||Q!==C)&&(e.blendEquation(Q),f=Q,C=Q)},blendEquationSeparate:(Q,O)=>{(Q!==f||O!==C)&&(e.blendEquationSeparate(Q,O),f=Q,C=O)},blendColor:(Q,O,B,j)=>{(Q!==h[0]||O!==h[1]||B!==h[2]||j!==h[3])&&(e.blendColor(Q,O,B,j),h[0]=Q,h[1]=O,h[2]=B,h[3]=j)},stencilFunc:(Q,O,B)=>{(Q!==g||O!==y||B!==b||Q!==x||O!==v||B!==A)&&(e.stencilFunc(Q,O,B),g=Q,y=O,b=B,x=Q,v=O,A=B)},stencilFuncSeparate:(Q,O,B,j)=>{Q===e.FRONT?(O!==g||B!==y||j!==b)&&(e.stencilFuncSeparate(Q,O,B,j),g=O,y=B,b=j):Q===e.BACK?(O!==x||B!==v||j!==A)&&(e.stencilFuncSeparate(Q,O,B,j),x=O,v=B,A=j):Q===e.FRONT_AND_BACK&&(O!==g||B!==y||j!==b||O!==x||B!==v||j!==A)&&(e.stencilFuncSeparate(Q,O,B,j),g=O,y=B,b=j,x=O,v=B,A=j)},stencilMask:Q=>{(Q!==_||Q!==I)&&(e.stencilMask(Q),_=Q,I=Q)},stencilMaskSeparate:(Q,O)=>{Q===e.FRONT?O!==_&&(e.stencilMaskSeparate(Q,O),_=O):Q===e.BACK?O!==I&&(e.stencilMaskSeparate(Q,O),I=O):Q===e.FRONT_AND_BACK&&(O!==_||O!==I)&&(e.stencilMaskSeparate(Q,O),_=O,I=O)},stencilOp:(Q,O,B)=>{(Q!==T||O!==w||B!==E||Q!==S||O!==k||B!==P)&&(e.stencilOp(Q,O,B),T=Q,w=O,E=B,S=Q,k=O,P=B)},stencilOpSeparate:(Q,O,B,j)=>{Q===e.FRONT?(O!==T||B!==w||j!==E)&&(e.stencilOpSeparate(Q,O,B,j),T=O,w=B,E=j):Q===e.BACK?(O!==S||B!==k||j!==P)&&(e.stencilOpSeparate(Q,O,B,j),S=O,k=B,P=j):Q===e.FRONT_AND_BACK&&(O!==T||B!==w||j!==E||O!==S||B!==k||j!==P)&&(e.stencilOpSeparate(Q,O,B,j),T=O,w=B,E=j,S=O,k=B,P=j)},enableVertexAttrib:Q=>{e.enableVertexAttribArray(Q),R[Q]=1},clearVertexAttribsState:q,disableUnusedVertexAttribs:()=>{for(let Q=0;Q<L;++Q)R[Q]===0&&e.disableVertexAttribArray(Q)},viewport:(Q,O,B,j)=>{(Q!==N[0]||O!==N[1]||B!==N[2]||j!==N[3])&&(e.viewport(Q,O,B,j),N[0]=Q,N[1]=O,N[2]=B,N[3]=j)},scissor:(Q,O,B,j)=>{(Q!==F[0]||O!==F[1]||B!==F[2]||j!==F[3])&&(e.scissor(Q,O,B,j),F[0]=Q,F[1]=O,F[2]=B,F[3]=j)},clipControl:t.clipControl?(Q,O)=>{(Q!==H||O!==V)&&(t.clipControl.clipControl(Q,O),H=Q,V=O)}:void 0,reset:()=>{r={},n=e.getParameter(e.FRONT_FACE),o=e.getParameter(e.CULL_FACE_MODE),i=e.getParameter(e.DEPTH_WRITEMASK),s=e.getParameter(e.DEPTH_CLEAR_VALUE),a=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),u=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),m=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),h=e.getParameter(e.BLEND_COLOR),f=e.getParameter(e.BLEND_EQUATION_RGB),C=e.getParameter(e.BLEND_EQUATION_ALPHA),g=e.getParameter(e.STENCIL_FUNC),b=e.getParameter(e.STENCIL_VALUE_MASK),y=e.getParameter(e.STENCIL_REF),x=e.getParameter(e.STENCIL_BACK_FUNC),A=e.getParameter(e.STENCIL_BACK_VALUE_MASK),v=e.getParameter(e.STENCIL_BACK_REF),_=e.getParameter(e.STENCIL_WRITEMASK),I=e.getParameter(e.STENCIL_BACK_WRITEMASK),T=e.getParameter(e.STENCIL_FAIL),E=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),w=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),S=e.getParameter(e.STENCIL_BACK_FAIL),P=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),k=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),L=e.getParameter(e.MAX_VERTEX_ATTRIBS),R.length=0;for(let Q=0;Q<L;++Q)R[Q]=0;N=e.getParameter(e.VIEWPORT),F=e.getParameter(e.SCISSOR_BOX),H=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,V=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1}}}var ig;(function(e){function t(o,i,s){return{array:o,width:i,height:s}}e.create=t;function r(o){let{array:i,width:s,height:a}=o,l=i.length/(s*a),c=s*l;for(let u=0,d=a/2;u<d;++u)for(let m=0,p=c;m<p;++m){let h=u*c+m,f=(a-u-1)*c+m,C=i[h];i[h]=i[f],i[f]=C}return o}e.flipY=r;function n(o){let{array:i}=o,s=i instanceof Uint8Array?255:1;for(let a=0,l=i.length;a<l;a+=4){let c=i[a+3]/s;i[a]/=c,i[a+1]/=c,i[a+2]/=c}return o}e.divideByAlpha=n})(ig||(ig={}));var SJ=`
float preFogAlpha = gl_FragColor.a;
if (uFog) {
    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;
    if (!uTransparentBackground) {
        if (gl_FragColor.a < 1.0) {
            // transparent objects are blended with background color
            gl_FragColor.a = fogAlpha;
        } else {
            // mix opaque objects with background color
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);
        }
    } else {
        #if defined(dRenderVariant_colorDpoit)
            if (gl_FragColor.a < 1.0) {
                // transparent objects are blended with background color
                gl_FragColor.a = fogAlpha;
            } else {
                // opaque objects need to be pre-multiplied alpha
                gl_FragColor.rgb *= fogAlpha;
                gl_FragColor.a = fogAlpha;
            }
        #else
            // pre-multiplied alpha expected for transparent background
            gl_FragColor.rgb *= fogAlpha;
            gl_FragColor.a = fogAlpha;
        #endif
    }
}
`;var IJ=`
if (interior) {
    if (uInteriorColorFlag) {
        gl_FragColor.rgb = uInteriorColor;
    } else {
        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;
    }

    #ifdef dTransparentBackfaces_opaque
        gl_FragColor.a = 1.0;
    #endif
}
`;var AJ=`
#if defined(dIgnoreLight)
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {
            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;
            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;
        }
    #endif

    #if defined(dRenderVariant_color)
        material.rgb += material.rgb * emissive;
    #endif

    gl_FragColor = material;
#else
    #ifdef bumpEnabled
        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {
            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);
        }
    #endif

    vec4 color = material;

    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));

    PhysicalMaterial physicalMaterial;
    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);
    #ifdef enabledFragDepth
        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);
    #else
        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));
        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);
    #endif
    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);
    physicalMaterial.specularF90 = 1.0;

    GeometricContext geometry;
    geometry.position = -vViewPosition;
    geometry.normal = normal;
    geometry.viewDir = normalize(vViewPosition);

    IncidentLight directLight;
    #pragma unroll_loop_start
    for (int i = 0; i < dLightCount; ++i) {
        directLight.direction = uLightDirection[i];
        directLight.color = uLightColor[i] * PI; // * PI for punctual light
        RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);
    }
    #pragma unroll_loop_end

    vec3 irradiance = uAmbientColor * PI; // * PI for punctual light
    RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);

    // indirect specular only metals
    vec3 radiance = uAmbientColor * metalness;
    vec3 iblIrradiance = uAmbientColor * metalness;
    vec3 clearcoatRadiance = vec3(0.0);
    RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);

    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;
    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background

    #if defined(dRenderVariant_color)
        outgoingLight += color.rgb * emissive;
    #endif

    gl_FragColor = vec4(outgoingLight, color.a);
#endif

#if defined(dXrayShaded_on)
    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
#elif defined(dXrayShaded_inverted)
    gl_FragColor.a *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);
#endif

gl_FragColor.rgb *= uExposure;
`;var wJ=`

#if defined(dColorMarker)
    if (marker > 0.0) {
        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);
            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering
        } else {
            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);
            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering
        }
    } else if (uMarkerAverage > 0.0) {
        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);
        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering
    }
#endif
`;var _J=`
#if dClipObjectCount != 0 && defined(dClipping)
    #if defined(dClippingType_instance)
        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;
    #elif defined(dMarkerType_groupInstance)
        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;
    #endif
#endif
`;var TJ=`
#if defined(dRenderVariant_color)
    #if defined(dColorType_attribute)
        vColor.rgb = aColor;
    #elif defined(dColorType_instance)
        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;
    #elif defined(dColorType_group)
        #if defined(dDualColor)
            vec4 color2;
            if (aColorMode == 2.0) {
                vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
            } else {
                vColor.rgb = readFromTexture(tColor, group * 2.0, uColorTexDim).rgb;
                color2.rgb = readFromTexture(tColor, group * 2.0 + 1.0, uColorTexDim).rgb;
            }
        #else
            vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #endif
    #elif defined(dColorType_groupInstance)
        #if defined(dDualColor)
            vec4 color2;
            if (aColorMode == 2.0) {
                vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
            } else {
                vColor.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0, uColorTexDim).rgb;
                color2.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0 + 1.0, uColorTexDim).rgb;
            }
        #else
            vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #endif
    #elif defined(dColorType_vertex)
        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_vertexInstance)
        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;
    #elif defined(dColorType_volume)
        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #elif defined(dColorType_volumeInstance)
        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;
        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;
    #endif

    #ifdef dUsePalette
        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_instance)
            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);
        #elif defined(dOverpaintType_groupInstance)
            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);
        #elif defined(dOverpaintType_vertexInstance)
            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + VertexID, uOverpaintTexDim);
        #elif defined(dOverpaintType_volumeInstance)
            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;
            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);
        #endif

        // pre-mix to avoid darkening due to empty overpaint
        #ifdef dColorType_uniform
            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #else
            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);
        #endif
        vOverpaint *= uOverpaintStrength;
    #endif

    #ifdef dEmissive
        #if defined(dEmissiveType_instance)
            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_groupInstance)
            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_vertexInstance)
            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + VertexID, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_volumeInstance)
            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;
            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;
        #endif
        vEmissive *= uEmissiveStrength;
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_instance)
            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);
        #elif defined(dSubstanceType_groupInstance)
            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);
        #elif defined(dSubstanceType_vertexInstance)
            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + VertexID, uSubstanceTexDim);
        #elif defined(dSubstanceType_volumeInstance)
            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;
            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);
        #endif

        // pre-mix to avoid artifacts due to empty substance
        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);
        vSubstance *= uSubstanceStrength;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance)
            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_groupInstance)
            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_vertexInstance)
            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + VertexID, uEmissiveTexDim).a;
        #elif defined(dEmissiveType_volumeInstance)
            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;
            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;
        #endif
        vEmissive *= uEmissiveStrength;
    #endif
#elif defined(dRenderVariant_pick)
    #ifdef requiredDrawBuffers
        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);
        vInstance = vec4(packIntToRGB(aInstance), 1.0);
        vGroup = vec4(packIntToRGB(group), 1.0);
    #else
        if (uPickType == 1) {
            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
        } else if (uPickType == 2) {
            vColor = vec4(packIntToRGB(aInstance), 1.0);
        } else {
            vColor = vec4(packIntToRGB(group), 1.0);
        }
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance)
        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_groupInstance)
        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_vertexInstance)
        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + VertexID, uTransparencyTexDim).a;
    #elif defined(dTransparencyType_volumeInstance)
        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;
        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;
    #endif
    vTransparency *= uTransparencyStrength;
#endif
`;var EJ=`
#ifdef dGeometryType_textureMesh
    float group = unpackRGBToInt(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);
#else
    float group = aGroup;
#endif
`;var PJ=`
#if defined(dNeedsMarker)
    #if defined(dMarkerType_instance)
        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;
    #elif defined(dMarkerType_groupInstance)
        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;
    #endif
#endif
`;var DJ=`
#if defined(dNeedsMarker)
    float marker = uMarker;
    if (uMarker == -1.0) {
        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win
    }
#endif

#if defined(dRenderVariant_color)
    #if defined(dUsePalette)
        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);
    #elif defined(dColorType_uniform)
        vec4 material = vec4(uColor, uAlpha);
    #elif defined(dColorType_varying)
        vec4 material = vec4(vColor.rgb, uAlpha);
    #endif

    // mix material with overpaint
    #if defined(dOverpaint)
        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);
    #endif

    float emissive = uEmissive;
    #ifdef dEmissive
        emissive += vEmissive;
    #endif

    float metalness = uMetalness;
    float roughness = uRoughness;
    float bumpiness = uBumpiness;
    #ifdef dSubstance
        float sf = clamp(vSubstance.a, 0.0, 0.99); // clamp to avoid artifacts
        metalness = mix(metalness, vSubstance.r, sf);
        roughness = mix(roughness, vSubstance.g, sf);
        bumpiness = mix(bumpiness, vSubstance.b, sf);
    #endif
#elif defined(dRenderVariant_depth)
    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {
        discard;
    }

    #ifndef dXrayShaded
        #if defined(dTransparency)
            float dta = 1.0 - vTransparency;
            if (vTransparency < 0.2) dta = 1.0; // hard cutoff looks better

            if (uRenderMask == MaskTransparent && uAlpha * dta == 1.0) {
                discard;
            } else if (uRenderMask == MaskOpaque && uAlpha * dta < 1.0) {
                discard;
            }
        #else
            if (uRenderMask == MaskTransparent && uAlpha == 1.0) {
                discard;
            } else if (uRenderMask == MaskOpaque && uAlpha < 1.0) {
                discard;
            }
        #endif
    #else
        if (uRenderMask == MaskOpaque) {
            discard;
        }
    #endif

    vec4 material = packDepthToRGBA(fragmentDepth);
#elif defined(dRenderVariant_marking)
    vec4 material;
    if(uMarkingType == 1) {
        if (marker > 0.0)
            discard;
        #ifdef enabledFragDepth
            material = packDepthToRGBA(gl_FragDepthEXT);
        #else
            material = packDepthToRGBA(gl_FragCoord.z);
        #endif
    } else {
        if (marker == 0.0)
            discard;
        float depthTest = 1.0;
        if (uMarkingDepthTest) {
            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
        }
        bool isHighlight = intMod(marker, 2.0) > 0.1;
        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
        if (fogFactor == 1.0)
            discard;
        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);
    }
#elif defined(dRenderVariant_emissive)
    float emissive = uEmissive;
    #ifdef dEmissive
        emissive += vEmissive;
    #endif
    vec4 material = vec4(emissive);
#endif

// apply per-group transparency
#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive))
    float ta = 1.0 - vTransparency;
    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better

    #if defined(dRenderVariant_pick)
        if (ta * uAlpha < uPickingAlphaThreshold)
            discard; // ignore so the element below can be picked
    #elif defined(dRenderVariant_emissive)
        if (ta < 1.0)
            discard; // emissive not supported with transparency
    #elif defined(dRenderVariant_color)
        material.a *= ta;
    #endif
#endif
`;var kJ=`
mat4 model = uModel * aTransform;
mat4 modelView = uView * model;
#ifdef dGeometryType_textureMesh
    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;
#else
    vec3 position = aPosition;
#endif
vec4 position4 = vec4(position, 1.0);
// for accessing tColorGrid in vert shader and for clipping in frag shader
vModelPosition = (model * position4).xyz;
vec4 mvPosition = modelView * position4;
vViewPosition = mvPosition.xyz;
gl_Position = uProjection * mvPosition;
`;var MJ=`
#if defined(dSizeType_uniform)
    float size = uSize;
#elif defined(dSizeType_attribute)
    float size = aSize;
#elif defined(dSizeType_instance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);
#elif defined(dSizeType_group)
    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);
#elif defined(dSizeType_groupInstance)
    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);
#endif

#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    size /= 100.0; // NOTE factor also set in TypeScript
#endif

size *= uSizeFactor;
`;var RJ=`
float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);
float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));
float alpha = (1.0 - fogFactor) * uAlpha;
// if not opaque enough ignore so the element below can be picked
if (uAlpha < uPickingAlphaThreshold || alpha < 0.1) {
    #ifdef dTransparentBackfaces_opaque
        if (!interior) discard;
    #else
        discard;
    #endif
}
`;var BJ=`
#if defined(dRenderVariant_color)
    #if defined(dTransparentBackfaces_off)
        if (interior && material.a < 1.0) discard;
    #elif defined(dTransparentBackfaces_opaque)
        if (interior) material.a = 1.0;
    #endif

    #if !defined(dXrayShaded_on) && !defined(dXrayShaded_inverted)
        if ((uRenderMask == MaskOpaque && material.a < 1.0) ||
            (uRenderMask == MaskTransparent && material.a == 1.0)
        ) {
            discard;
        }
    #endif
#endif
`;var LJ=`
#if defined(dClipVariant_instance) && dClipObjectCount != 0
    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);
    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w)))
        // move out of [ -w, +w ] to 'discard' in vert shader
        gl_Position.z = 2.0 * gl_Position.w;
#endif
`;var NJ=`
#if defined(dClipVariant_pixel) && dClipObjectCount != 0
    if (clipTest(vec4(vModelPosition, 0.0)))
        discard;
#endif
`;var FJ=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;
#ifdef bumpEnabled
    uniform float uBumpFrequency;
    uniform float uBumpAmplitude;
#endif
uniform float uEmissive;

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_varying)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        uniform sampler2D tPalette;
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        varying vec4 vOverpaint;
    #endif

    #ifdef dEmissive
        varying float vEmissive;
    #endif

    #ifdef dSubstance
        varying vec4 vSubstance;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        varying float vEmissive;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100 || !defined(dVaryingGroup)
        #ifdef requiredDrawBuffers
            varying vec4 vObject;
            varying vec4 vInstance;
            varying vec4 vGroup;
        #else
            varying vec4 vColor;
        #endif
    #else
        #ifdef requiredDrawBuffers
            flat in vec4 vObject;
            flat in vec4 vInstance;
            flat in vec4 vGroup;
        #else
            flat in vec4 vColor;
        #endif
    #endif
#endif

#ifdef dTransparency
    varying float vTransparency;
#endif
`;var OJ=`
uniform float uMetalness;
uniform float uRoughness;
uniform float uBumpiness;

#if defined(dRenderVariant_color)
    #if defined(dColorType_uniform)
        uniform vec3 uColor;
    #elif defined(dColorType_attribute)
        varying vec4 vColor;
        attribute vec3 aColor;
    #elif defined(dColorType_texture)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform sampler2D tColor;
    #elif defined(dColorType_grid)
        varying vec4 vColor;
        uniform vec2 uColorTexDim;
        uniform vec3 uColorGridDim;
        uniform vec4 uColorGridTransform;
        uniform sampler2D tColorGrid;
    #elif defined(dColorType_direct)
        varying vec4 vColor;
    #endif

    #ifdef dUsePalette
        varying float vPaletteV;
    #endif

    #ifdef dOverpaint
        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform sampler2D tOverpaint;
        #elif defined(dOverpaintType_volumeInstance)
            varying vec4 vOverpaint;
            uniform vec2 uOverpaintTexDim;
            uniform vec3 uOverpaintGridDim;
            uniform vec4 uOverpaintGridTransform;
            uniform sampler2D tOverpaintGrid;
        #endif
        uniform float uOverpaintStrength;
    #endif

    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #elif defined(dEmissiveType_volumeInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform vec3 uEmissiveGridDim;
            uniform vec4 uEmissiveGridTransform;
            uniform sampler2D tEmissiveGrid;
        #endif
        uniform float uEmissiveStrength;
    #endif

    #ifdef dSubstance
        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform sampler2D tSubstance;
        #elif defined(dSubstanceType_volumeInstance)
            varying vec4 vSubstance;
            uniform vec2 uSubstanceTexDim;
            uniform vec3 uSubstanceGridDim;
            uniform vec4 uSubstanceGridTransform;
            uniform sampler2D tSubstanceGrid;
        #endif
        uniform float uSubstanceStrength;
    #endif
#elif defined(dRenderVariant_emissive)
    #ifdef dEmissive
        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform sampler2D tEmissive;
        #elif defined(dEmissiveType_volumeInstance)
            varying float vEmissive;
            uniform vec2 uEmissiveTexDim;
            uniform vec3 uEmissiveGridDim;
            uniform vec4 uEmissiveGridTransform;
            uniform sampler2D tEmissiveGrid;
        #endif
        uniform float uEmissiveStrength;
    #endif
#elif defined(dRenderVariant_pick)
    #if __VERSION__ == 100 || !defined(dVaryingGroup)
        #ifdef requiredDrawBuffers
            varying vec4 vObject;
            varying vec4 vInstance;
            varying vec4 vGroup;
        #else
            varying vec4 vColor;
        #endif
    #else
        #ifdef requiredDrawBuffers
            flat out vec4 vObject;
            flat out vec4 vInstance;
            flat out vec4 vGroup;
        #else
            flat out vec4 vColor;
        #endif
    #endif
#endif

#ifdef dTransparency
    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform sampler2D tTransparency;
    #elif defined(dTransparencyType_volumeInstance)
        varying float vTransparency;
        uniform vec2 uTransparencyTexDim;
        uniform vec3 uTransparencyGridDim;
        uniform vec4 uTransparencyGridTransform;
        uniform sampler2D tTransparencyGrid;
    #endif
    uniform float uTransparencyStrength;
#endif
`;var VJ=`
#if dClipObjectCount != 0
    vec3 quaternionTransform(const in vec4 q, const in vec3 v) {
        vec3 t = 2.0 * cross(q.xyz, v);
        return v + q.w * t + cross(q.xyz, t);
    }

    vec4 computePlane(const in vec3 normal, const in vec3 inPoint) {
        return vec4(normalize(normal), -dot(normal, inPoint));
    }

    float planeSD(const in vec4 plane, const in vec3 center) {
        return -dot(plane.xyz, center - plane.xyz * -plane.w);
    }

    float sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
        return (
            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0
        ) * min(min(size.x, size.y), size.z);
    }

    float cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;
        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));
    }

    float cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;
        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));
    }

    float infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {
        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);

        float q = length(t.xy);
        return dot(size.xy, vec2(q, t.z));
    }

    float getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale) {
        if (type == 1) {
            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));
            vec4 plane = computePlane(normal, position);
            return planeSD(plane, center);
        } else if (type == 2) {
            return sphereSD(position, rotation, scale * 0.5, center);
        } else if (type == 3) {
            return cubeSD(position, rotation, scale * 0.5, center);
        } else if (type == 4) {
            return cylinderSD(position, rotation, scale * 0.5, center);
        } else if (type == 5) {
            return infiniteConeSD(position, rotation, scale * 0.5, center);
        } else {
            return 0.1;
        }
    }

    #if __VERSION__ == 100
        // 8-bit
        int bitwiseAnd(in int a, in int b) {
            int d = 128;
            int result = 0;
            for (int i = 0; i < 8; ++i) {
                if (d <= 0) break;
                if (a >= d && b >= d) result += d;
                if (a >= d) a -= d;
                if (b >= d) b -= d;
                d /= 2;
            }
            return result;
        }

        bool hasBit(const in int mask, const in int bit) {
            return bitwiseAnd(mask, bit) == 0;
        }
    #else
        bool hasBit(const in int mask, const in int bit) {
            return (mask & bit) == 0;
        }
    #endif

    bool clipTest(const in vec4 sphere) {
        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)
        #if defined(dClipping)
            int flag = int(floor(vClipping * 255.0 + 0.5));
        #else
            int flag = 0;
        #endif

        #pragma unroll_loop_start
        for (int i = 0; i < dClipObjectCount; ++i) {
            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {
                // TODO take sphere radius into account?
                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;
                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {
                    return true;
                }
            }
        }
        #pragma unroll_loop_end
        return false;
    }
#endif
`;var GJ=`
uniform int uObjectId;
uniform int uInstanceCount;
uniform int uGroupCount;

uniform int uPickType;
uniform int uMarkingType;

uniform vec4 uCameraPlane;
uniform vec4 uLod;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)
            varying float vClipping;
        #else
            flat in float vClipping;
        #endif
    #endif
#endif

#if defined(dColorMarker)
    uniform vec3 uHighlightColor;
    uniform vec3 uSelectColor;
    uniform vec3 uDimColor;
    uniform float uHighlightStrength;
    uniform float uSelectStrength;
    uniform float uDimStrength;
    uniform int uMarkerPriority;
    uniform float uMarkerAverage;
#endif

#if defined(dNeedsMarker)
    uniform float uMarker;
    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)
        varying float vMarker;
    #else
        flat in float vMarker;
    #endif
#endif

#if defined(dRenderVariant_colorDpoit)
    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript
    uniform sampler2D tDpoitDepth;
    uniform sampler2D tDpoitFrontColor;
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

uniform vec2 uViewOffset;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform bool uFog;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform float uPickingAlphaThreshold;
uniform bool uTransparentBackground;

uniform bool uDoubleSided;
uniform float uInteriorDarkening;
uniform bool uInteriorColorFlag;
uniform vec3 uInteriorColor;
bool interior;

uniform float uXrayEdgeFalloff;
uniform float uExposure;

uniform mat4 uProjection;

uniform int uRenderMask;
uniform bool uMarkingDepthTest;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

float getDepthPacked(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepth, coords));
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen
// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf
vec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {
    vec3 sigmaS = dFdx(position);
    vec3 sigmaT = dFdy(position);

    vec3 r1 = cross(sigmaT, normal);
    vec3 r2 = cross(normal, sigmaS);
    float det = dot(sigmaS, r1);
    if (det == 0.0) return normal;

    float bs = dFdx(height);
    float bt = dFdy(height);

    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);
    return normalize(abs(det) * normal - scale * surfGrad);
}

float hash(in float h) {
    return fract(sin(h) * 43758.5453123);
}

float noise(in vec3 x) {
    vec3 p = floor(x);
    vec3 f = fract(x);
    f = f * f * (3.0 - 2.0 * f);

    float n = p.x + p.y * 157.0 + 113.0 * p.z;
    return mix(
        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),
            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),
        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),
            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);
}

float fbm(in vec3 p) {
    float f = 0.0;
    f += 0.5 * noise(p);
    p *= 2.01;
    f += 0.25 * noise(p);
    p *= 2.02;
    f += 0.125 * noise(p);

    return f;
}
`;var UJ=`
uniform mat4 uProjection, uModel, uView;
uniform vec3 uCameraPosition;
uniform vec4 uCameraPlane;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;
uniform vec4 uInvariantBoundingSphere;
uniform vec4 uLod;

uniform bool uDoubleSided;
uniform int uPickType;

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];

    #if defined(dClipping)
        uniform vec2 uClippingTexDim;
        uniform sampler2D tClipping;
        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)
            varying float vClipping;
        #else
            flat out float vClipping;
        #endif
    #endif
#endif

#if defined(dNeedsMarker)
    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)
        varying float vMarker;
    #else
        flat out float vMarker;
    #endif
#endif

varying vec3 vModelPosition;
varying vec3 vViewPosition;

#if defined(noNonInstancedActiveAttribs)
    // int() is needed for some Safari versions
    // see https://bugs.webkit.org/show_bug.cgi?id=244152
    #define VertexID int(gl_VertexID)
#else
    attribute float aVertex;
    #define VertexID int(aVertex)
#endif

#if defined(enabledMultiDraw)
    #define DrawID gl_DrawID
#else
    #define DrawID uDrawId
#endif
`;var zJ=`
// TODO find a better place for these convenience defines

#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)
    #define dRenderVariant_color
#endif

#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)
    #define dColorType_texture
#endif

#if defined(dColorType_volume) || defined(dColorType_volumeInstance)
    #define dColorType_grid
#endif

#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)
    #define dColorType_varying
#endif

#if (defined(dRenderVariant_color) && defined(dColorMarker)) || defined(dRenderVariant_marking)
    #define dNeedsMarker
#endif

#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)
    #define dXrayShaded
#endif

#define MaskAll 0
#define MaskOpaque 1
#define MaskTransparent 2

//

#define PI 3.14159265
#define RECIPROCAL_PI 0.31830988618
#define EPSILON 1e-6

#define saturate(a) clamp(a, 0.0, 1.0)

#if __VERSION__ == 100
    #define round(x) floor((x) + 0.5)
#endif

float intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }
vec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }
float intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }
int imod(const in int a, const in int b) { return a - b * (a / b); }

float pow2(const in float x) { return x * x; }

vec3 packIntToRGB(in float value) {
    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;
    vec3 c = vec3(0.0);
    c.b = mod(value, 256.0);
    value = floor(value / 256.0);
    c.g = mod(value, 256.0);
    value = floor(value / 256.0);
    c.r = mod(value, 256.0);
    return c / 255.0;
}
float unpackRGBToInt(const in vec3 rgb) {
    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;
}

vec2 packUnitIntervalToRG(const in float v) {
    vec2 enc;
    enc.xy = vec2(fract(v * 256.0), v);
    enc.y -= enc.x * (1.0 / 256.0);
    enc.xy *=  256.0 / 255.0;

    return enc;
}

float unpackRGToUnitInterval(const in vec2 enc) {
    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));
}

vec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {
    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);
    p = invProjection * p;
    return p.xyz / p.w;
}

const float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)
const float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)
const vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);
const float ShiftRight8 = 1.0 / 256.0;

vec4 packDepthToRGBA(const in float v) {
    vec4 r = vec4(fract(v * PackFactors), v);
    r.yzw -= r.xyz * ShiftRight8; // tidy overflow
    return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
    return dot(v, UnpackFactors);
}

vec4 sRGBToLinear(const in vec4 c) {
    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);
}
vec4 linearTosRGB(const in vec4 c) {
    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);
}

float linearizeDepth(const in float depth, const in float near, const in float far) {
    return (2.0 * near) / (far + near - depth * (far - near));
}

float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
    return (near * far) / ((far - near) * invClipZ - far);
}

float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
    return linearClipZ * (near - far) - near;
}

float depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {
    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);
}

#if __VERSION__ == 100
    // transpose

    float transpose(const in float m) {
        return m;
    }

    mat2 transpose2(const in mat2 m) {
        return mat2(
            m[0][0], m[1][0],
            m[0][1], m[1][1]
        );
    }

    mat3 transpose3(const in mat3 m) {
        return mat3(
            m[0][0], m[1][0], m[2][0],
            m[0][1], m[1][1], m[2][1],
            m[0][2], m[1][2], m[2][2]
        );
    }

    mat4 transpose4(const in mat4 m) {
        return mat4(
            m[0][0], m[1][0], m[2][0], m[3][0],
            m[0][1], m[1][1], m[2][1], m[3][1],
            m[0][2], m[1][2], m[2][2], m[3][2],
            m[0][3], m[1][3], m[2][3], m[3][3]
        );
    }

    // inverse

    float inverse(const in float m) {
        return 1.0 / m;
    }

    mat2 inverse2(const in mat2 m) {
        return mat2(m[1][1],-m[0][1],
                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);
    }

    mat3 inverse3(const in mat3 m) {
        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];
        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];
        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];

        float b01 = a22 * a11 - a12 * a21;
        float b11 = -a22 * a10 + a12 * a20;
        float b21 = a21 * a10 - a11 * a20;

        float det = a00 * b01 + a01 * b11 + a02 * b21;

        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
    }

    mat4 inverse4(const in mat4 m) {
        float
            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],

            b00 = a00 * a11 - a01 * a10,
            b01 = a00 * a12 - a02 * a10,
            b02 = a00 * a13 - a03 * a10,
            b03 = a01 * a12 - a02 * a11,
            b04 = a01 * a13 - a03 * a11,
            b05 = a02 * a13 - a03 * a12,
            b06 = a20 * a31 - a21 * a30,
            b07 = a20 * a32 - a22 * a30,
            b08 = a20 * a33 - a23 * a30,
            b09 = a21 * a32 - a22 * a31,
            b10 = a21 * a33 - a23 * a31,
            b11 = a22 * a33 - a23 * a32,

            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;

        return mat4(
            a11 * b11 - a12 * b10 + a13 * b09,
            a02 * b10 - a01 * b11 - a03 * b09,
            a31 * b05 - a32 * b04 + a33 * b03,
            a22 * b04 - a21 * b05 - a23 * b03,
            a12 * b08 - a10 * b11 - a13 * b07,
            a00 * b11 - a02 * b08 + a03 * b07,
            a32 * b02 - a30 * b05 - a33 * b01,
            a20 * b05 - a22 * b02 + a23 * b01,
            a10 * b10 - a11 * b08 + a13 * b06,
            a01 * b08 - a00 * b10 - a03 * b06,
            a30 * b04 - a31 * b02 + a33 * b00,
            a21 * b02 - a20 * b04 - a23 * b00,
            a11 * b07 - a10 * b09 - a12 * b06,
            a00 * b09 - a01 * b07 + a02 * b06,
            a31 * b01 - a30 * b03 - a32 * b00,
            a20 * b03 - a21 * b01 + a22 * b00) / det;
    }

    #define isNaN(x) ((x) != (x))
    #define isInf(x) ((x) == (x) + 1.0)
#else
    #define transpose2(m) transpose(m)
    #define transpose3(m) transpose(m)
    #define transpose4(m) transpose(m)

    #define inverse2(m) inverse(m)
    #define inverse3(m) inverse(m)
    #define inverse4(m) inverse(m)

    #define isNaN isnan
    #define isInf isinf
#endif
`;var HJ=`
if (uLod.w == 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
    float d = dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w;
    float ta = min(
        smoothstep(uLod.x, uLod.x + uLod.z, d),
        1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)
    );

    #if defined(dRenderVariant_color)
        float at = 0.0;

        // shift by view-offset during multi-sample rendering to allow for blending
        vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;

        const mat4 thresholdMatrix = mat4(
            1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,
            13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,
            4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,
            16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0
        );
        int ci = int(intMod(coord.x, 4.0));
        int ri = int(intMod(coord.y, 4.0));
        #if __VERSION__ == 100
            vec4 i = vec4(float(ci * 4 + ri));
            vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +
                thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +
                thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +
                thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));
            at = v.x + v.y + v.z + v.w;
        #else
            at = thresholdMatrix[ci][ri];
        #endif

        if (ta < 0.99 && (ta < 0.01 || ta < at)) {
            discard;
        }
    #else
        if (ta < uPickingAlphaThreshold) {
            discard;
        }
    #endif
}
`;var jJ=`
    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba
    // MIT License, Copyright (c) 2020 Equinor

    float shiftRight (float v, float amt) {
    v = floor(v) + 0.5;
    return floor(v / exp2(amt));
    }
    float shiftLeft (float v, float amt) {
        return floor(v * exp2(amt) + 0.5);
    }
    float maskLast (float v, float bits) {
        return mod(v, shiftLeft(1.0, bits));
    }
    float extractBits (float num, float from, float to) {
        from = floor(from + 0.5); to = floor(to + 0.5);
        return maskLast(shiftRight(num, from), to - from);
    }

    vec4 floatToRgba(float texelFloat, bool littleEndian) {
        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);
        float sign = texelFloat > 0.0 ? 0.0 : 1.0;
        texelFloat = abs(texelFloat);
        float exponent = floor(log2(texelFloat));
        float biased_exponent = exponent + 127.0;
        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;
        float t = biased_exponent / 2.0;
        float last_bit_of_biased_exponent = fract(t) * 2.0;
        float remaining_bits_of_biased_exponent = floor(t);
        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;
        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;
        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;
        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;
        return (
            littleEndian
                ? vec4(byte4, byte3, byte2, byte1)
                : vec4(byte1, byte2, byte3, byte4)
        );
    }
`;var $J=`
#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif
uniform vec3 uAmbientColor;

struct PhysicalMaterial {
    vec3 diffuseColor;
    float roughness;
    vec3 specularColor;
    float specularF90;
};

struct IncidentLight {
    vec3 color;
    vec3 direction;
};

struct ReflectedLight {
    vec3 directDiffuse;
    vec3 directSpecular;
    vec3 indirectDiffuse;
    vec3 indirectSpecular;
};

struct GeometricContext {
    vec3 position;
    vec3 normal;
    vec3 viewDir;
};

vec3 BRDF_Lambert(const in vec3 diffuseColor) {
    return RECIPROCAL_PI * diffuseColor;
}

vec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {
    // Original approximation by Christophe Schlick '94
    // float fresnel = pow( 1.0 - dotVH, 5.0 );
    // Optimized variant (presented by Epic at SIGGRAPH '13)
    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);
    return f0 * (1.0 - fresnel) + (f90 * fresnel);
}

// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2
// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf
float V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
    float a2 = pow2(alpha);
    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
    return 0.5 / max(gv + gl, EPSILON);
}

// Microfacet Models for Refraction through Rough Surfaces - equation (33)
// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html
// alpha is "roughness squared" in Disney\u2019s reparameterization
float D_GGX(const in float alpha, const in float dotNH) {
    float a2 = pow2(alpha);
    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1
    return RECIPROCAL_PI * a2 / pow2(denom);
}

// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility
vec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {
    float alpha = pow2(roughness); // UE4's roughness
    vec3 halfDir = normalize( lightDir + viewDir);
    float dotNL = saturate(dot(normal, lightDir));
    float dotNV = saturate(dot(normal, viewDir));
    float dotNH = saturate(dot(normal, halfDir));
    float dotVH = saturate(dot(viewDir, halfDir));
    vec3 F = F_Schlick(f0, f90, dotVH);
    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);
    float D = D_GGX(alpha, dotNH);
    return F * (V * D);
}

// Analytical approximation of the DFG LUT, one half of the
// split-sum approximation used in indirect specular lighting.
// via 'environmentBRDF' from "Physically Based Shading on Mobile"
// https://www.unrealengine.com/blog/physically-based-shading-on-mobile
vec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {
    float dotNV = saturate(dot(normal, viewDir));
    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
    vec4 r = roughness * c0 + c1;
    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;
    return fab;
}

// Fdez-Ag\xFCera's "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"
// Approximates multiscattering in order to preserve energy.
// http://www.jcgt.org/published/0008/01/03/
void computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {
    vec2 fab = DFGApprox(normal, viewDir, roughness);
    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
    float Ess = fab.x + fab.y;
    float Ems = 1.0 - Ess;
    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21
    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);
    singleScatter += FssEss;
    multiScatter += Fms * Ems;
}

void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    float dotNL = saturate(dot(geometry.normal, directLight.direction));
    vec3 irradiance = dotNL * directLight.color;
    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);
    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}

void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
    // Both indirect specular and indirect diffuse light accumulate here
    vec3 singleScattering = vec3(0.0);
    vec3 multiScattering = vec3(0.0);
    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);
    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));
    reflectedLight.indirectSpecular += radiance * singleScattering;
    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
`;var WJ=`
float matrixScale(in mat4 m){
    vec4 r = m[0];
    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);
}
`;var qJ=`
varying vec3 vNormal;
`;var ZJ=`
vec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {
    float x = intMod(i, dim.x);
    float y = floor(intDiv(i, dim.x));
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}

vec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {
    int x = imod(i, int(dim.x));
    int y = i / int(dim.x);
    vec2 uv = (vec2(x, y) + 0.5) / dim;
    return texture2D(tex, uv);
}
`;var KJ=`
    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float
    // BSD 3-Clause License
    //
    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.
    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
    //
    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
    // OF THE POSSIBILITY OF SUCH DAMAGE.

    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {
        ivec4 bytes = ivec4(inputFloats * 255.0);
        return (
            littleEndian
                ? bytes.abgr
                : bytes
        );
    }

    // Break the four bytes down into an array of 32 bits.
    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {
        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {
            float acc = float(bytes[channelIndex]);
            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {
                float powerOfTwo = exp2(float(indexInByte));
                bool bit = acc >= powerOfTwo;
                bits[channelIndex * 8 + (7 - indexInByte)] = bit;
                acc = mod(acc, powerOfTwo);
            }
        }
    }

    // Compute the exponent of the 32-bit float.
    float getExponent(bool bits[32]) {
        const int startIndex = 1;
        const int bitStringLength = 8;
        const int endBeforeIndex = startIndex + bitStringLength;
        float acc = 0.0;
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Compute the mantissa of the 32-bit float.
    float getMantissa(bool bits[32], bool subnormal) {
        const int startIndex = 9;
        const int bitStringLength = 23;
        const int endBeforeIndex = startIndex + bitStringLength;
        // Leading/implicit/hidden bit convention:
        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.
        float acc = float(!subnormal) * exp2(float(bitStringLength));
        int pow2 = bitStringLength - 1;
        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {
            acc += float(bits[bitIndex]) * exp2(float(pow2--));
        }
        return acc;
    }

    // Parse the float from its 32 bits.
    float bitsToFloat(bool bits[32]) {
        float signBit = float(bits[0]) * -2.0 + 1.0;
        float exponent = getExponent(bits);
        bool subnormal = abs(exponent - 0.0) < 0.01;
        float mantissa = getMantissa(bits, subnormal);
        float exponentBias = 127.0;
        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);
    }

    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {
        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);
        bool bits[32];
        bytesToBits(rgbaBytes, bits);
        return bitsToFloat(bits);
    }
`;var XJ=`
#if defined(dSizeType_uniform)
    uniform float uSize;
#elif defined(dSizeType_attribute)
    attribute float aSize;
#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)
    uniform vec2 uSizeTexDim;
    uniform sampler2D tSize;
#endif

uniform float uSizeFactor;
`;var YJ=`
vec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {
    float gdYZ = gridDim.z * gridDim.y;
    float gdZ = gridDim.z;
    vec3 p0 = floor(pos * gridDim);
    vec3 p1 = ceil(pos * gridDim);
    vec3 pd = (pos * gridDim - p0) / (p1 - p0);
    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);
    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);
    vec4 s00 = mix(s000, s100, pd.x);
    vec4 s01 = mix(s001, s101, pd.x);
    vec4 s10 = mix(s010, s110, pd.x);
    vec4 s11 = mix(s011, s111, pd.x);
    vec4 s0 = mix(s00, s10, pd.y);
    vec4 s1 = mix(s01, s11, pd.y);
    return mix(s0, s1, pd.z);
}
`;var QJ=`
vec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice0 = floor(pos.z * gridDim.z);
    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;
    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));
    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color0 = texture2D(tex, coord0);

    float zSlice1 = zSlice0 + 1.0;
    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;
    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));
    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    vec4 color1 = texture2D(tex, coord1);

    float delta0 = abs((pos.z * gridDim.z) - zSlice0);
    return mix(color0, color1, delta0);
}
`;var JJ=`
vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;
    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;
    return texture2D(tex, coord);
}
`;var eee=`
#if defined(dRenderVariant_colorWboit)
    if (uRenderMask == MaskOpaque) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderMask == MaskTransparent) {
        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {
            #ifdef dTransparentBackfaces_off
                if (interior) discard;
            #endif
            float alpha = gl_FragColor.a;
            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);
            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);
            // extra alpha is to handle pre-multiplied alpha
            #ifndef dGeometryType_directVolume
                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);
            #else
                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);
            #endif
        } else {
            discard;
        }
    }
#endif
`;var tee=`
#if defined(dRenderVariant_colorDpoit)
    if (uRenderMask == MaskOpaque) {
        if (preFogAlpha < 1.0) {
            discard;
        }
    } else if (uRenderMask == MaskTransparent) {
        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;
        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {
            #ifdef dTransparentBackfaces_off
                if (interior) discard;
            #endif

            // adapted from https://github.com/tsherif/webgl2examples
            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao

            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;
            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);

            vec4 fragColor = gl_FragColor;

            // depth value always increases
            // so we can use MAX blend equation
            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);

            // front color always increases
            // so we can use MAX blend equation
            gl_FragColor = lastFrontColor;

            // back color is separately blend afterwards each pass
            gl_FragData[1] = vec4(0.0);

            float nearestDepth = -lastDepth.x;
            float furthestDepth = lastDepth.y;
            float alphaMultiplier = 1.0 - lastFrontColor.a;

            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {
                // Skip this depth since it's been peeled.
                return;
            }

            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {
                // This needs to be peeled.
                // The ones remaining after MAX blended for
                // all need-to-peel will be peeled next pass.
                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);
                return;
            }

            // write to back and front color buffer
            if (fragmentDepth == nearestDepth) {
                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;
                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);
            } else {
                gl_FragData[1] += fragColor;
            }

        } else {
            discard;
        }
    }
#endif
`;var ree=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

void main(){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_size

    #ifdef dPointSizeAttenuation
        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;
    #else
        gl_PointSize = size * uPixelRatio;
    #endif
    gl_PointSize = max(1.0, gl_PointSize);

    gl_Position = uProjection * mvPosition;

    #include clip_instance
}
`;var nee=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

const vec2 center = vec2(0.5);
const float radius = 0.5;

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    #if defined(dPointStyle_circle)
        float dist = distance(gl_PointCoord, center);
        if (dist > radius) discard;
    #elif defined(dPointStyle_fuzzy)
        float dist = distance(gl_PointCoord, center);
        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);
        if (fuzzyAlpha < 0.0001) discard;
    #endif

    #if defined(dPointStyle_fuzzy) && defined(dRenderVariant_color)
        material.a *= fuzzyAlpha;
    #endif

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
        #include dpoit_write
    #endif
}
`;var oee=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;
uniform mat4 uInvProjection;
uniform float uIsOrtho;

uniform vec2 uTexDim;
uniform sampler2D tPositionGroup;

attribute mat4 aTransform;
attribute float aInstance;

varying float vRadius;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#include matrix_scale

/**
 * Bounding rectangle of a clipped, perspective-projected 3D Sphere.
 * Michael Mara, Morgan McGuire. 2013
 *
 * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018
 * https://github.com/zeux/niagara
 */
void sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {
    vec3 pr = p * r;
    float pzr2 = p.z * p.z - r * r;

    float vx = sqrt(p.x * p.x + pzr2);
    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];
    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];

    float vy = sqrt(p.y * p.y + pzr2);
    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];
    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];

    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;
    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;
    gl_Position.xy *= gl_Position.w;
}

void main(void){
    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5
    #if __VERSION__ == 100
        int m = imod(VertexID, 6);
    #else
        int m = VertexID % 6;
    #endif
    if (m == 0) {
        mapping = vec2(-1.0, 1.0);
    } else if (m == 1 || m == 3) {
        mapping = vec2(-1.0, -1.0);
    } else if (m == 4) {
        mapping = vec2(1.0, -1.0);
    }

    vec4 positionGroup = readFromTexture(tPositionGroup, VertexID / 6, uTexDim);
    vec3 position = positionGroup.rgb;
    float group = positionGroup.a;

    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vRadius = size * matrixScale(uModelView);

    vec4 position4 = vec4(position, 1.0);
    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    float d;
    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
        d = dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w;
        float f = min(
            smoothstep(uLod.x, uLod.x + uLod.z, d),
            1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)
        ) * uLod.w;
        vRadius *= f;
    }

    vec4 mvPosition = uModelView * aTransform * position4;

    #ifdef dApproximate
        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
        mvCorner.xy += mapping * vRadius;
        gl_Position = uProjection * mvCorner;
    #else
        if (uIsOrtho == 1.0) {
            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);
            mvCorner.xy += mapping * vRadius;
            gl_Position = uProjection * mvCorner;
        } else {
            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);
            sphereProjection(mvPosition.xyz, vRadius, mapping);
        }
    #endif

    vec4 vPoint4 = uInvProjection * gl_Position;
    vPoint = vPoint4.xyz / vPoint4.w;
    vPointViewPosition = -mvPosition.xyz / mvPosition.w;

    if (gl_Position.z < -gl_Position.w) {
        mvPosition.z -= 2.0 * vRadius; // avoid clipping
        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;
    }

    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {
        if (d < uLod.x || d > uLod.y) {
            // move out of [ -w, +w ] to 'discard' in vert shader
            gl_Position.z = 2.0 * gl_Position.w;
        }
    }

    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0
        if (clipTest(vec4(vModelPosition.xyz, 0.0))) {
            // move out of [ -w, +w ] to 'discard' in vert shader
            gl_Position.z = 2.0 * gl_Position.w;
        }
    #else
        #include clip_instance
    #endif
}
`;var iee=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

uniform mat4 uInvView;
uniform float uAlphaThickness;

varying float vRadius;
varying vec3 vPoint;
varying vec3 vPointViewPosition;

#ifdef dSolidInterior
    const bool solidInterior = true;
#else
    const bool solidInterior = false;
#endif

bool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){
    vec3 cameraSpherePos = -vPointViewPosition;

    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);
    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);

    float B = dot(rayDirection, cameraSphereDir);
    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);

    if (det < 0.0) return false;

    float sqrtDet = sqrt(det);
    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);
    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);

    cameraPos = rayDirection * negT + rayOrigin;
    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
    fragmentDepth = calcDepth(cameraPos);

    bool objectClipped = false;

    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0
        if (clipTest(vec4(modelPos, 0.0))) {
            objectClipped = true;
            fragmentDepth = -1.0;
        }
    #endif

    if (fragmentDepth > 0.0) {
        cameraNormal = normalize(cameraPos - cameraSpherePos);
        interior = false;
        return true;
    } else if (uDoubleSided || solidInterior) {
        cameraPos = rayDirection * posT + rayOrigin;
        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;
        fragmentDepth = calcDepth(cameraPos);
        cameraNormal = -normalize(cameraPos - cameraSpherePos);
        interior = true;
        if (fragmentDepth > 0.0) {
            #ifdef dSolidInterior
                if (!objectClipped) {
                    fragmentDepth = 0.0 + (0.0000001 / vRadius);
                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);
                }
            #endif
            return true;
        }
    }

    return false;
}

void main(void){
    vec3 cameraNormal;
    float fragmentDepth;

    #ifdef dApproximate
        vec3 pointDir = -vPointViewPosition - vPoint;
        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;
        vec3 vViewPosition = -vPointViewPosition;
        fragmentDepth = gl_FragCoord.z;
        #if !defined(dIgnoreLight) || defined(dXrayShaded)
            pointDir.z -= cos(length(pointDir) / vRadius);
            cameraNormal = -normalize(pointDir / vRadius);
        #endif
        interior = false;
    #else
        vec3 modelPos;
        vec3 cameraPos;
        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);
        if (!hit) discard;

        if (fragmentDepth < 0.0) discard;
        if (fragmentDepth > 1.0) discard;

        gl_FragDepthEXT = fragmentDepth;

        vec3 vModelPosition = modelPos;
        vec3 vViewPosition = cameraPos;
    #endif

    #include fade_lod
    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0
        #include clip_pixel
    #endif
    #include assign_material_color

    #if defined(dRenderVariant_color)
        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {
            material.a *= min(1.0, vRadius / uAlphaThickness);
        }
    #endif

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        vec3 normal = -cameraNormal;
        #include apply_light_color

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
        #include dpoit_write
    #endif
}
`;var see=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec3 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;
attribute float aScale;
attribute float aCap;
attribute float aColorMode;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform float uIsOrtho;
uniform vec3 uCameraDir;

void main() {
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelTransform = uModel * aTransform;

    vTransform = aTransform;
    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;
    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;
    vSize = size * aScale;
    vCap = aCap;

    vModelPosition = (vStart + vEnd) * 0.5;
    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);
    vec3 dir = vEnd - vStart;
    float f = aMapping.x > 0.0 ? 1.0 : 0.0;
    // ensure cylinder 'dir' is pointing towards the camera
    if(dot(camDir, dir) < 0.0) {
        dir = -dir;
        f = 1.0 - f;
    }

    vec3 left = cross(camDir, dir);
    vec3 up = cross(left, dir);
    left = vSize * normalize(left);
    up = vSize * normalize(up);

    // move vertex in object-space from center to corner
    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;

    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);
    vViewPosition = mvPosition.xyz;
    gl_Position = uProjection * mvPosition;

    if (gl_Position.z < -gl_Position.w) {
        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping
        gl_Position.z = (uProjection * mvPosition).z;
    }

    #if defined(dDualColor) && defined(dRenderVariant_color) && (defined(dColorType_group) || defined(dColorType_groupInstance))
        // dual-color mixing
        // - for aColorMode between 0 and 1 use aColorMode to interpolate
        // - for aColorMode == 2 do nothing, i.e., use vColor
        // - for aColorMode == 3 use position on cylinder axis to interpolate
        if (aColorMode <= 1.0){
            vColor.rgb = mix(vColor.rgb, color2.rgb, aColorMode);
        } else if (aColorMode == 3.0) {
            vColor.rgb = mix(vColor.rgb, color2.rgb, mix(-0.25, 1.25, f / 1.5));
        }
    #endif

    #include clip_instance
}
`;var aee=`
precision highp float;
precision highp int;

#define bumpEnabled

uniform mat4 uView;

varying mat4 vTransform;
varying vec3 vStart;
varying vec3 vEnd;
varying float vSize;
varying float vCap;

uniform vec3 uCameraDir;
uniform vec3 uCameraPosition;
uniform mat4 uInvView;

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include common_clip

#ifdef dSolidInterior
    const bool solidInterior = true;
#else
    const bool solidInterior = false;
#endif

// adapted from https://www.shadertoy.com/view/4lcSRn
// The MIT License, Copyright 2016 Inigo Quilez
bool CylinderImpostor(
    in vec3 rayOrigin, in vec3 rayDir,
    in vec3 start, in vec3 end, in float radius,
    out vec3 cameraNormal, out bool interior,
    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth
){
    vec3 ba = end - start;
    vec3 oc = rayOrigin - start;

    float baba = dot(ba, ba);
    float bard = dot(ba, rayDir);
    float baoc = dot(ba, oc);

    float k2 = baba - bard * bard;
    float k1 = baba * dot(oc, rayDir) - baoc * bard;
    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;

    float h = k1 * k1 - k2 * k0;
    if (h < 0.0) return false;

    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;
    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;

    #ifdef dSolidInterior
        bool topInterior = !topCap;
        bool bottomInterior = !bottomCap;
        topCap = true;
        bottomCap = true;
    #else
        bool topInterior = false;
        bool bottomInterior = false;
    #endif

    bool clipped = false;
    bool objectClipped = false;

    // body outside
    h = sqrt(h);
    float t = (-k1 - h) / k2;
    float y = baoc + t * bard;
    if (y > 0.0 && y < baba) {
        interior = false;
        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;
        modelPosition = rayOrigin + t * rayDir;
        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
        fragmentDepth = calcDepth(viewPosition);
        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            if (clipTest(vec4(modelPosition, 0.0))) {
                objectClipped = true;
                fragmentDepth = -1.0;
                #ifdef dSolidInterior
                    topCap = !topInterior;
                    bottomCap = !bottomInterior;
                #endif
            }
        #endif
        if (fragmentDepth > 0.0) return true;
        clipped = true;
    }

    if (!clipped) {
        if (topCap && y < 0.0) {
            // top cap
            t = -baoc / bard;
            if (abs(k1 + k2 * t) < h) {
                interior = topInterior;
                cameraNormal = -ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    if (clipTest(vec4(modelPosition, 0.0))) {
                        objectClipped = true;
                        fragmentDepth = -1.0;
                        #ifdef dSolidInterior
                            topCap = !topInterior;
                            bottomCap = !bottomInterior;
                        #endif
                    }
                #endif
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (interior) cameraNormal = -rayDir;
                    #endif
                    return true;
                }
            }
        } else if (bottomCap && y >= 0.0) {
            // bottom cap
            t = (baba - baoc) / bard;
            if (abs(k1 + k2 * t) < h) {
                interior = bottomInterior;
                cameraNormal = ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                #if defined(dClipVariant_pixel) && dClipObjectCount != 0
                    if (clipTest(vec4(modelPosition, 0.0))) {
                        objectClipped = true;
                        fragmentDepth = -1.0;
                        #ifdef dSolidInterior
                            topCap = !topInterior;
                            bottomCap = !bottomInterior;
                        #endif
                    }
                #endif
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (interior) cameraNormal = -rayDir;
                    #endif
                    return true;
                }
            }
        }
    }

    if (uDoubleSided || solidInterior) {
        // body inside
        h = -h;
        t = (-k1 - h) / k2;
        y = baoc + t * bard;
        if (y > 0.0 && y < baba) {
            interior = true;
            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;
            modelPosition = rayOrigin + t * rayDir;
            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
            fragmentDepth = calcDepth(viewPosition);
            if (fragmentDepth > 0.0) {
                #ifdef dSolidInterior
                    if (!objectClipped) {
                        fragmentDepth = 0.0 + (0.0000002 / vSize);
                        cameraNormal = -rayDir;
                    }
                #endif
                return true;
            }
        }

        if (topCap && y < 0.0) {
            // top cap
            t = -baoc / bard;
            if (abs(k1 + k2 * t) < -h) {
                interior = true;
                cameraNormal = ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (!objectClipped) {
                            fragmentDepth = 0.0 + (0.0000002 / vSize);
                            cameraNormal = -rayDir;
                        }
                    #endif
                    return true;
                }
            }
        } else if (bottomCap && y >= 0.0) {
            // bottom cap
            t = (baba - baoc) / bard;
            if (abs(k1 + k2 * t) < -h) {
                interior = true;
                cameraNormal = -ba / baba;
                modelPosition = rayOrigin + t * rayDir;
                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;
                fragmentDepth = calcDepth(viewPosition);
                if (fragmentDepth > 0.0) {
                    #ifdef dSolidInterior
                        if (!objectClipped) {
                            fragmentDepth = 0.0 + (0.0000002 / vSize);
                            cameraNormal = -rayDir;
                        }
                    #endif
                    return true;
                }
            }
        }
    }

    return false;
}

void main() {
    vec3 rayOrigin = vModelPosition;
    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);

    vec3 cameraNormal;
    vec3 modelPosition;
    vec3 viewPosition;
    float fragmentDepth;
    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);
    if (!hit) discard;

    if (fragmentDepth < 0.0) discard;
    if (fragmentDepth > 1.0) discard;

    gl_FragDepthEXT = fragmentDepth;

    vec3 vViewPosition = viewPosition;
    vec3 vModelPosition = modelPosition;

    #include fade_lod
    #include clip_pixel
    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        mat3 normalMatrix = transpose3(inverse3(mat3(uView)));
        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));
        #include apply_light_color

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
        #include dpoit_write
    #endif
}
`;var lee=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform mat4 uModelView;

attribute vec3 aPosition;
attribute vec2 aMapping;
attribute float aDepth;
attribute vec2 aTexCoord;
attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

uniform float uOffsetX;
uniform float uOffsetY;
uniform float uOffsetZ;

uniform float uIsOrtho;
uniform float uPixelRatio;
uniform vec4 uViewport;

varying vec2 vTexCoord;

#include matrix_scale

void main(void){
    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    vTexCoord = aTexCoord;

    float scale = matrixScale(uModelView);

    float offsetX = uOffsetX * scale;
    float offsetY = uOffsetY * scale;
    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;

    vec4 position4 = vec4(aPosition, 1.0);
    vec4 mvPosition = uModelView * aTransform * position4;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // TODO
    // #ifdef FIXED_SIZE
    //     if (ortho) {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;
    //     } else {
    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;
    //     }
    // #endif

    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);

    if (vTexCoord.x == 10.0) { // indicates background plane
        // move a bit to the back, taking distance to camera into account to avoid z-fighting
        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);
    }

    mvCorner.xy += aMapping * size * scale;
    mvCorner.x += offsetX;
    mvCorner.y += offsetY;

    if (uIsOrtho == 1.0) {
        mvCorner.z += offsetZ;
    } else {
        mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;
    }

    gl_Position = uProjection * mvCorner;

    vViewPosition = -mvCorner.xyz;

    #include clip_instance
}
`;var cee=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

uniform sampler2D tFont;

uniform vec3 uBorderColor;
uniform float uBorderWidth;
uniform vec3 uBackgroundColor;
uniform float uBackgroundOpacity;

varying vec2 vTexCoord;

const float smoothness = 32.0;
const float gamma = 2.2;

void main2(){
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color

    if (vTexCoord.x > 1.0) {
        #if defined(dRenderVariant_color)
            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);
        #endif
    } else {
        // retrieve signed distance
        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;

        // perform adaptive anti-aliasing of the edges
        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);
        float a = clamp(0.0, 1.0, smoothstep(0.5 - w, 0.5 + w, sdf));

        // gamma correction for linear attenuation
        a = pow(a, 1.0 / gamma);

        if (a < 0.5) discard;

        #if defined(dRenderVariant_color)
            // add border
            float t = 0.5 + uBorderWidth;
            if (uBorderWidth > 0.0 && sdf < t) {
                material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));
            }
        #endif
    }

    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
        #include dpoit_write
    #endif
}
`;var uee=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include size_vert_params
#include common_clip

uniform float uPixelRatio;
uniform vec4 uViewport;

attribute mat4 aTransform;
attribute float aInstance;
attribute float aGroup;

attribute vec2 aMapping;
attribute vec3 aStart;
attribute vec3 aEnd;

void trimSegment(const in vec4 start, inout vec4 end) {
    // trim end segment so it terminates between the camera plane and the near plane
    // conservative estimate of the near plane
    float a = uProjection[2][2];  // 3rd entry in 3rd column
    float b = uProjection[3][2];  // 3rd entry in 4th column
    float nearEstimate = -0.5 * b / a;
    float alpha = (nearEstimate - start.z) / (end.z - start.z);
    end.xyz = mix(start.xyz, end.xyz, alpha);
}

void main(){
    float aspect = uViewport.z / uViewport.w;

    #include assign_group
    #include assign_color_varying
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_size

    mat4 modelView = uView * uModel * aTransform;

    // camera space
    vec4 start = modelView * vec4(aStart, 1.0);
    vec4 end = modelView * vec4(aEnd, 1.0);

    // assign position
    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);
    vec4 mvPosition = modelView * position4;
    vViewPosition = mvPosition.xyz;

    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader

    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane
    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly
    // perhaps there is a more elegant solution -- WestLangley
    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column
    if (perspective) {
        if (start.z < 0.0 && end.z >= 0.0) {
            trimSegment(start, end);
        } else if (end.z < 0.0 && start.z >= 0.0) {
            trimSegment(end, start);
        }
    }

    // clip space
    vec4 clipStart = uProjection * start;
    vec4 clipEnd = uProjection * end;

    // ndc space
    vec2 ndcStart = clipStart.xy / clipStart.w;
    vec2 ndcEnd = clipEnd.xy / clipEnd.w;

    // direction
    vec2 dir = ndcEnd - ndcStart;

    // account for clip-space aspect ratio
    dir.x *= aspect;
    dir = normalize(dir);

    // perpendicular to dir
    vec2 offset = vec2(dir.y, - dir.x);

    // undo aspect ratio adjustment
    dir.x /= aspect;
    offset.x /= aspect;

    // sign flip
    if (aMapping.x < 0.0) offset *= -1.0;

    // calculate linewidth
    float linewidth;
    #ifdef dLineSizeAttenuation
        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;
    #else
        linewidth = size * uPixelRatio;
    #endif
    linewidth = max(1.0, linewidth);

    // adjust for linewidth
    offset *= linewidth;

    // adjust for clip-space to screen-space conversion
    offset /= uViewport.w;

    // select end
    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;

    // back to clip space
    offset *= clip.w;
    clip.xy += offset;
    gl_Position = clip;

    #include clip_instance
}
`;var dee=`
precision highp float;
precision highp int;

#include common
#include common_frag_params
#include color_frag_params
#include common_clip

void main(){
    #include fade_lod
    #include clip_pixel

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        gl_FragColor = material;

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
        #include dpoit_write
    #endif
}
`;var mee=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common
#include read_from_texture
#include common_vert_params
#include color_vert_params
#include common_clip
#include texture3d_from_2d_linear

#ifdef dGeometryType_textureMesh
    uniform vec2 uGeoTexDim;
    uniform sampler2D tPosition;
    uniform sampler2D tGroup;
    uniform sampler2D tNormal;
#else
    attribute vec3 aPosition;
    attribute float aGroup;
    attribute vec3 aNormal;
#endif
attribute mat4 aTransform;
attribute float aInstance;

varying vec3 vNormal;

void main(){
    #include assign_group
    #include assign_marker_varying
    #include assign_clipping_varying
    #include assign_position
    #include assign_color_varying
    #include clip_instance

    #ifdef dGeometryType_textureMesh
        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;
    #else
        vec3 normal = aNormal;
    #endif
    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));
    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));
    #if defined(dFlipSided)
        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR
            transformedNormal = -transformedNormal;
        }
    #endif
    vNormal = transformedNormal;
}
`;var pee=`
precision highp float;
precision highp int;

#define bumpEnabled

#include common
#include common_frag_params
#include color_frag_params
#include light_frag_params
#include normal_frag_params
#include common_clip

void main() {
    #include fade_lod
    #include clip_pixel

    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)
    vec3 fdx = dFdx(vViewPosition);
    vec3 fdy = dFdy(vViewPosition);
    vec3 faceNormal = normalize(cross(fdx,fdy));
    bool frontFacing = dot(vNormal, faceNormal) > 0.0;

    #if defined(dFlipSided)
        interior = frontFacing;
    #else
        interior = !frontFacing;
    #endif

    float fragmentDepth = gl_FragCoord.z;
    #include assign_material_color
    #include check_transparency

    #if defined(dRenderVariant_pick)
        #include check_picking_alpha
        #ifdef requiredDrawBuffers
            gl_FragColor = vObject;
            gl_FragData[1] = vInstance;
            gl_FragData[2] = vGroup;
            gl_FragData[3] = packDepthToRGBA(fragmentDepth);
        #else
            gl_FragColor = vColor;
        #endif
    #elif defined(dRenderVariant_depth)
        gl_FragColor = material;
    #elif defined(dRenderVariant_marking)
        gl_FragColor = material;
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = material;
    #elif defined(dRenderVariant_color)
        #if defined(dFlatShaded)
            vec3 normal = -faceNormal;
        #else
            vec3 normal = -normalize(vNormal);
            if (uDoubleSided) normal *= float(frontFacing) * 2.0 - 1.0;
        #endif
        #include apply_light_color

        #include apply_interior_color
        #include apply_marker_color
        #include apply_fog
        #include wboit_write
        #include dpoit_write
    #endif
}
`;var fee=`
precision highp float;

attribute vec3 aPosition;
attribute mat4 aTransform;
attribute float aInstance;

uniform mat4 uModelView;
uniform mat4 uProjection;
uniform vec4 uInvariantBoundingSphere;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform vec3 uBboxMax;
uniform vec3 uGridDim;
uniform mat4 uTransform;

uniform mat4 uUnitToCartn;

void main() {
    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);
    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;

    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;
    vInstance = aInstance;
    vBoundingSphere = vec4(
        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,
        uInvariantBoundingSphere.w
    );
    vTransform = aTransform;

    gl_Position = uProjection * mvPosition;

    // move z position to near clip plane (but not too close to get precision issues)
    gl_Position.z = gl_Position.w - 0.01;
}
`;var hee=`
precision highp float;
precision highp int;

#include common
#include light_frag_params

#if dClipObjectCount != 0
    uniform int uClipObjectType[dClipObjectCount];
    uniform bool uClipObjectInvert[dClipObjectCount];
    uniform vec3 uClipObjectPosition[dClipObjectCount];
    uniform vec4 uClipObjectRotation[dClipObjectCount];
    uniform vec3 uClipObjectScale[dClipObjectCount];
#endif
#include common_clip

#include read_from_texture
#include texture3d_from_1d_trilinear
#include texture3d_from_2d_nearest
#include texture3d_from_2d_linear

uniform mat4 uProjection, uTransform, uModelView, uModel, uView;
uniform vec3 uCameraDir;

uniform sampler2D tDepth;
uniform vec2 uDrawingBufferSize;

varying vec3 vOrigPos;
varying float vInstance;
varying vec4 vBoundingSphere;
varying mat4 vTransform;

uniform mat4 uInvView;
uniform vec3 uGridDim;
uniform vec3 uBboxSize;
uniform sampler2D tTransferTex;
uniform float uTransferScale;
uniform float uStepScale;
uniform float uJumpLength;

uniform int uObjectId;
uniform int uVertexCount;
uniform int uInstanceCount;
uniform int uGroupCount;

#if defined(dColorMarker)
    uniform vec3 uHighlightColor;
    uniform vec3 uSelectColor;
    uniform vec3 uDimColor;
    uniform float uHighlightStrength;
    uniform float uSelectStrength;
    uniform float uDimStrength;
    uniform int uMarkerPriority;
    uniform float uMarkerAverage;

    uniform float uMarker;
    uniform vec2 uMarkerTexDim;
    uniform sampler2D tMarker;
#endif

uniform float uMetalness;
uniform float uRoughness;
uniform float uEmissive;

uniform bool uFog;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;

uniform float uAlpha;
uniform bool uTransparentBackground;
uniform float uXrayEdgeFalloff;
uniform float uExposure;

uniform int uRenderMask;

uniform float uNear;
uniform float uFar;
uniform float uIsOrtho;

uniform vec3 uCellDim;
uniform vec3 uCameraPosition;
uniform mat4 uCartnToUnit;

#if __VERSION__ != 100
    // for webgl1 this is given as a 'define'
    uniform int uMaxSteps;
#endif

#if defined(dGridTexType_2d)
    precision highp sampler2D;
    uniform sampler2D tGridTex;
    uniform vec3 uGridTexDim;
#elif defined(dGridTexType_3d)
    precision highp sampler3D;
    uniform sampler3D tGridTex;
#endif

#if defined(dColorType_uniform)
    uniform vec3 uColor;
#elif defined(dColorType_texture)
    uniform vec2 uColorTexDim;
    uniform sampler2D tColor;
#endif

#ifdef dOverpaint
    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)
        uniform vec2 uOverpaintTexDim;
        uniform sampler2D tOverpaint;
    #endif
#endif

#ifdef dUsePalette
    uniform sampler2D tPalette;
#endif

#if defined(dGridTexType_2d)
    vec4 textureVal(vec3 pos) {
        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
    vec4 textureGroup(vec3 pos) {
        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);
    }
#elif defined(dGridTexType_3d)
    vec4 textureVal(vec3 pos) {
        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));
    }
    vec4 textureGroup(vec3 pos) {
        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);
    }
#endif

float calcDepth(const in vec3 pos) {
    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;
    return 0.5 + 0.5 * clipZW.x / clipZW.y;
}

float transferFunction(float value) {
    return texture2D(tTransferTex, vec2(value, 0.0)).a;
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

const float gradOffset = 0.5;

vec3 v3m4(vec3 p, mat4 m) {
    return (m * vec4(p, 1.0)).xyz;
}

float preFogAlphaBlended = 0.0;

vec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {
    mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));
    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);
    #if defined(dClipVariant_pixel) && dClipObjectCount != 0
        mat4 modelTransform = uModel * vTransform * uTransform;
    #endif
    mat4 modelViewTransform = uModelView * vTransform * uTransform;

    vec3 scaleVol = vec3(1.0) / uGridDim;
    vec3 pos = startLoc;
    vec4 cell;
    float prevValue = -1.0;
    float value = 0.0;
    vec4 src = vec4(0.0);
    vec4 dst = vec4(0.0);
    float fragmentDepth;

    vec3 posMin = vec3(0.0);
    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;

    vec3 unitPos;

    vec3 nextPos;
    float nextValue;

    vec4 material;
    vec4 overpaint;
    float metalness = uMetalness;
    float roughness = uRoughness;
    float emissive = uEmissive;

    vec3 gradient = vec3(1.0);
    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);
    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);
    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);

    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);
    float maxDistSq = maxDist * maxDist;

    for (int i = 0; i < uMaxSteps; ++i) {
        // break when beyond bounding-sphere or far-plane
        vec3 distVec = startLoc - pos;
        if (dot(distVec, distVec) > maxDistSq) break;

        unitPos = v3m4(pos, cartnToUnit);

        // continue when outside of grid
        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||
            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z
        ) {
            prevValue = value;
            pos += step;
            continue;
        }

        cell = textureVal(unitPos);
        value = cell.a; // current voxel value

        if (uJumpLength > 0.0 && value < 0.01) {
            nextPos = pos + rayDir * uJumpLength;
            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;
            if (nextValue < 0.01) {
                prevValue = nextValue;
                pos = nextPos;
                continue;
            }
        }

        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);
        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))
            break;

        #if defined(dClipVariant_pixel) && dClipObjectCount != 0
            vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);
            if (clipTest(vec4(vModelPosition, 0.0))) {
                prevValue = value;
                pos += step;
                continue;
            }
        #endif

        vec3 vViewPosition = mvPosition.xyz;
        material.a = transferFunction(value);

        #ifdef dPackedGroup
            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);
        #else
            vec3 g = floor(unitPos * uGridDim + 0.5);
            // note that we swap x and z because the texture is flipped around y
            #if defined(dAxisOrder_012)
                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210
            #elif defined(dAxisOrder_021)
                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120
            #elif defined(dAxisOrder_102)
                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201
            #elif defined(dAxisOrder_120)
                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021
            #elif defined(dAxisOrder_201)
                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102
            #elif defined(dAxisOrder_210)
                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012
            #endif
        #endif

        #if defined(dColorType_direct) && defined(dUsePalette)
            material.rgb = texture2D(tPalette, vec2(value, 0.0)).rgb;
        #elif defined(dColorType_uniform)
            material.rgb = uColor;
        #elif defined(dColorType_instance)
            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;
        #elif defined(dColorType_group)
            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;
        #elif defined(dColorType_groupInstance)
            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;
        #elif defined(dColorType_vertex)
            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;
        #elif defined(dColorType_vertexInstance)
            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;
        #endif

        #ifdef dOverpaint
            #if defined(dOverpaintType_groupInstance)
                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);
            #elif defined(dOverpaintType_vertexInstance)
                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));
            #endif

            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);
        #endif

        #if defined(dIgnoreLight)
            gl_FragColor.rgb = material.rgb;
        #else
            if (material.a >= 0.01) {
                #ifdef dPackedGroup
                    // compute gradient by central differences
                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;
                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;
                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;
                #else
                    gradient = cell.xyz * 2.0 - 1.0;
                #endif
                vec3 normal = -normalize(normalMatrix * normalize(gradient));
                #include apply_light_color
            } else {
                gl_FragColor.rgb = material.rgb;
            }
        #endif

        gl_FragColor.a = material.a * uAlpha * uTransferScale;

        #if defined(dColorMarker)
            float marker = uMarker;
            if (uMarker == -1.0) {
                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
            }
        #endif
        #include apply_marker_color

        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;
        fragmentDepth = calcDepth(mvPosition.xyz);
        #include apply_fog

        src = gl_FragColor;

        if (!uTransparentBackground) {
            // done in 'apply_fog' otherwise
            src.rgb *= src.a;
        }
        dst = (1.0 - dst.a) * src + dst; // standard blending

        // break if the color is opaque enough
        if (dst.a > 0.95)
            break;

        pos += step;
    }

    return dst;
}

// TODO: support float texture for higher precision values???
// TODO: support clipping exclusion texture support

void main() {
    #if defined(dRenderVariant_emissive)
        discard;
    #else
        if (gl_FrontFacing)
            discard;

        vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);
        vec3 step = rayDir * uStepScale;

        float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;
        float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);
        vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);
        gl_FragColor = raymarch(start, step, rayDir);

        float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);
        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);
        #include wboit_write
    #endif
}
`;var gee=`
precision highp float;
precision highp int;

#include common
#include common_vert_params

attribute vec3 aPosition;
attribute vec2 aUv;
attribute mat4 aTransform;
attribute float aInstance;

varying vec2 vUv;
varying float vInstance;

void main() {
    #include assign_position

    vUv = aUv;
    vInstance = aInstance;
}
`;var yee=`
precision highp float;
precision highp int;

#include common
#include read_from_texture
#include common_frag_params
#include common_clip

uniform vec2 uImageTexDim;
uniform sampler2D tImageTex;
uniform sampler2D tGroupTex;

uniform vec2 uMarkerTexDim;
uniform sampler2D tMarker;

varying vec2 vUv;
varying float vInstance;

#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)
    #define dInterpolation_cubic
#endif

#if defined(dInterpolation_cubic)
    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)
        #if defined(dInterpolation_catmulrom)
            const float B = 0.0;
            const float C = 0.5;
        #elif defined(dInterpolation_mitchell)
            const float B = 0.333;
            const float C = 0.333;
        #endif

        float cubicFilter(float x){
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f < 1.0) {
                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +
                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +
                    (6.0 - 2.0 * B)) / 6.0;
            }else if (f >= 1.0 && f < 2.0){
                return ((-B - 6.0 * C) * ( f * f * f)
                    + (6.0 * B + 30.0 * C) * (f * f) +
                    (-(12.0 * B) - 48.0 * C) * f +
                    8.0 * B + 24.0 * C) / 6.0;
            }else{
                return 0.0;
            }
        }
    #elif defined(dInterpolation_bspline)
        float cubicFilter(float x) {
            float f = x;
            if (f < 0.0) {
                f = -f;
            }
            if (f >= 0.0 && f <= 1.0){
                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);
            } else if (f > 1.0 && f <= 2.0) {
                return 1.0 / 6.0 * pow((2.0 - f), 3.0);
            }
            return 1.0;
        }
    #endif

    vec4 biCubic(sampler2D tex, vec2 texCoord) {
        vec2 texelSize = 1.0 / uImageTexDim;
        texCoord -= texelSize / 2.0;
        vec4 nSum = vec4(0.0);
        float nDenom = 0.0;
        vec2 cell = fract(texCoord * uImageTexDim);
        for (float m = -1.0; m <= 2.0; ++m) {
            for (float n = -1.0; n <= 2.0; ++n) {
                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));
                float c = abs(cubicFilter(m - cell.x) * cubicFilter(-n + cell.y));
                nSum += vecData * c;
                nDenom += c;
            }
        }
        return nSum / nDenom;
    }
#endif

void main() {
    #include fade_lod
    #include clip_pixel

    #if defined(dInterpolation_cubic)
        vec4 imageData = biCubic(tImageTex, vUv);
    #else
        vec4 imageData = texture2D(tImageTex, vUv);
    #endif
    imageData.a = clamp(imageData.a, 0.0, 1.0);
    if (imageData.a > 0.9) imageData.a = 1.0;

    imageData.a *= uAlpha;
    if (imageData.a < 0.05)
        discard;

    float fragmentDepth = gl_FragCoord.z;

    if ((uRenderMask == MaskOpaque && imageData.a < 1.0) ||
        (uRenderMask == MaskTransparent && imageData.a == 1.0)
    ) {
        discard;
    }

    #if defined(dRenderVariant_pick)
        if (imageData.a < 0.3)
            discard;
        #ifdef requiredDrawBuffers
            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);
            gl_FragData[2] = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
            gl_FragData[3] = packDepthToRGBA(gl_FragCoord.z);
        #else
            gl_FragColor = vColor;
            if (uPickType == 1) {
                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);
            } else if (uPickType == 2) {
                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);
            } else {
                gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);
            }
        #endif
    #elif defined(dRenderVariant_depth)
        if (imageData.a < 0.05)
            discard;
        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
    #elif defined(dRenderVariant_marking)
        float marker = uMarker;
        if (uMarker == -1.0) {
            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }
        if (uMarkingType == 1) {
            if (marker > 0.0 || imageData.a < 0.05)
                discard;
            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
        } else {
            if (marker == 0.0 || imageData.a < 0.05)
                discard;
            float depthTest = 1.0;
            if (uMarkingDepthTest) {
                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;
            }
            bool isHighlight = intMod(marker, 2.0) > 0.1;
            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0);
        }
    #elif defined(dRenderVariant_emissive)
        gl_FragColor = vec4(0.0);
    #elif defined(dRenderVariant_color)
        gl_FragColor = imageData;

        float marker = uMarker;
        if (uMarker == -1.0) {
            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);
            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;
            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win
        }

        #include apply_marker_color
        #include apply_fog
        #include wboit_write
        #include dpoit_write
    #endif
}
`;var Cee=ei(),gke={apply_fog:SJ,apply_interior_color:IJ,apply_light_color:AJ,apply_marker_color:wJ,assign_clipping_varying:_J,assign_color_varying:TJ,assign_group:EJ,assign_marker_varying:PJ,assign_material_color:DJ,assign_position:kJ,assign_size:MJ,check_picking_alpha:RJ,check_transparency:BJ,clip_instance:LJ,clip_pixel:NJ,color_frag_params:FJ,color_vert_params:OJ,common_clip:VJ,common_frag_params:GJ,common_vert_params:UJ,common:zJ,fade_lod:HJ,float_to_rgba:jJ,light_frag_params:$J,matrix_scale:WJ,normal_frag_params:qJ,read_from_texture:ZJ,rgba_to_float:KJ,size_vert_params:XJ,texture3d_from_1d_trilinear:YJ,texture3d_from_2d_linear:QJ,texture3d_from_2d_nearest:JJ,wboit_write:eee,dpoit_write:tee},yke=/^(?!\/\/)\s*#include\s+(\S+)/gm,vke=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,bke=/[ \t]*\/\/.*\n/g,xke=/[ \t]*\/\*[\s\S]*?\*\//g,Cke=/\n{2,}/g;function vee(e){return e.replace(yke,(t,r)=>{let n=gke[r];if(!n)throw new Error(`empty chunk, '${r}'`);return n}).trim().replace(bke,`
`).replace(xke,`
`).replace(Cke,`
`)}function Ske(e){return e.replace(vke,Ike)}function Ike(e,t,r,n){let o="";for(let i=parseInt(t);i<parseInt(r);++i)o+=n.replace(/\[\s*i\s*\]/g,`[${i}]`).replace(/UNROLLED_LOOP_INDEX/g,`${i}`);return o}function Ake(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,`${t.dLightCount.ref.value}`)),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,`${t.dClipObjectCount.ref.value}`)),e}function bee(e,t){return Ske(Ake(e,t))}function Gr(e,t,r,n={},o={},i){return{id:Cee(),name:e,vert:vee(t),frag:vee(r),extensions:n,outTypes:o,ignoreDefine:i}}function T2(e,t,r){var n;if(t.startsWith("color")){if(e==="dLightCount")return!!(!((n=r.dIgnoreLight)===null||n===void 0)&&n.ref.value)}else{let o=["dColorType","dUsePalette","dLightCount","dXrayShaded","dOverpaintType","dOverpaint","dSubstanceType","dSubstance","dColorMarker"];return t!=="emissive"&&o.push("dEmissiveType","dEmissive"),o.includes(e)}return!1}function a3(e,t,r){return e==="dLightCount"?!0:T2(e,t,r)}var See=Gr("points",ree,nee,{drawBuffers:"optional"},{},a3),Iee=Gr("spheres",oee,iee,{fragDepth:"required",drawBuffers:"optional"},{},T2),Aee=Gr("cylinders",see,aee,{fragDepth:"required",drawBuffers:"optional"},{},T2),wee=Gr("text",lee,cee,{drawBuffers:"optional"},{},a3),_ee=Gr("lines",uee,dee,{drawBuffers:"optional"},{},a3),l3=Gr("mesh",mee,pee,{drawBuffers:"optional"},{},T2),Tee=Gr("direct-volume",fee,hee,{fragDepth:"optional",drawBuffers:"optional"},{},T2),Eee=Gr("image",gee,yee,{drawBuffers:"optional"},{},a3);function xee(e,t){var r;if(e===void 0)return"";let n=((r=e.dRenderVariant)===null||r===void 0?void 0:r.ref.value)||"",o=[];for(let i in e){if(t?.(i,n,e))continue;let a=e[i].ref.value;a!==void 0&&(typeof a=="string"?o.push(`#define ${i}_${a}`):typeof a=="number"?o.push(`#define ${i} ${a}`):typeof a=="boolean"?a&&o.push(`#define ${i}`):Sr(a))}return o.join(`
`)+`
`}function wke(e,t){let r=[];if(t.drawBuffers){if(e.drawBuffers)r.push("#define requiredDrawBuffers");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.multiDraw){if(e.multiDraw)r.push("#extension GL_ANGLE_multi_draw : require"),r.push("#define enabledMultiDraw");else if(t.multiDraw==="required")throw new Error("required 'GL_ANGLE_multi_draw' extension not available")}return r.join(`
`)+`
`}function _ke(e,t){let r=["#extension GL_OES_standard_derivatives : enable"];if(t.fragDepth){if(e.fragDepth)r.push("#extension GL_EXT_frag_depth : enable"),r.push("#define enabledFragDepth");else if(t.fragDepth==="required")throw new Error("required 'GL_EXT_frag_depth' extension not available")}if(t.drawBuffers){if(e.drawBuffers)r.push("#extension GL_EXT_draw_buffers : require"),r.push("#define requiredDrawBuffers"),r.push("#define gl_FragColor gl_FragData[0]");else if(t.drawBuffers==="required")throw new Error("required 'GL_EXT_draw_buffers' extension not available")}if(t.shaderTextureLod){if(e.shaderTextureLod)r.push("#extension GL_EXT_shader_texture_lod : enable"),r.push("#define enabledShaderTextureLod");else if(t.shaderTextureLod==="required")throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")}return e.depthTexture&&r.push("#define depthTextureSupport"),r.join(`
`)+`
`}var Tke=`
#define attribute in
#define varying out
#define texture2D texture
`,Eke=`
#define varying in
#define texture2D texture
#define textureCube texture
#define texture2DLodEXT textureLod
#define textureCubeLodEXT textureLod

#define gl_FragColor out_FragData0
#define gl_FragDepthEXT gl_FragDepth

#define depthTextureSupport
`;function Pke(e,t){let r=["#version 300 es"];if(t.drawBuffers&&e.drawBuffers&&r.push("#define requiredDrawBuffers"),t.multiDraw){if(e.multiDraw)r.push("#extension GL_ANGLE_multi_draw : require"),r.push("#define enabledMultiDraw");else if(t.multiDraw==="required")throw new Error("required 'GL_ANGLE_multi_draw' extension not available")}if(t.clipCullDistance){if(e.clipCullDistance)r.push("#extension GL_ANGLE_clip_cull_distance : enable"),r.push("#define enabledClipCullDistance");else if(t.clipCullDistance==="required")throw new Error("required 'GL_ANGLE_clip_cull_distance' extension not available")}if(t.conservativeDepth){if(e.conservativeDepth)r.push("#extension GL_EXT_conservative_depth : enable"),r.push("#define enabledConservativeDepth");else if(t.conservativeDepth==="required")throw new Error("required 'GL_EXT_conservative_depth' extension not available")}return e.noNonInstancedActiveAttribs&&r.push("#define noNonInstancedActiveAttribs"),r.push(Tke),r.join(`
`)+`
`}function Dke(e,t,r,n){let o=["#version 300 es",`layout(location = 0) out highp ${n[0]||"vec4"} out_FragData0;`];if(r.fragDepth&&t.fragDepth&&o.push("#define enabledFragDepth"),r.drawBuffers&&t.drawBuffers){o.push("#define requiredDrawBuffers");let i=e.getParameter(e.MAX_DRAW_BUFFERS);for(let s=1,a=i;s<a;++s)o.push(`layout(location = ${s}) out highp ${n[s]||"vec4"} out_FragData${s};`)}return r.shaderTextureLod&&t.shaderTextureLod&&o.push("#define enabledShaderTextureLod"),o.push(Eke),o.join(`
`)+`
`}function kke(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}function Pee(e,t,r,n){let o=xee(r,n.ignoreDefine),i=xee(r,n.ignoreDefine),s=er(e)?Pke(t,n.extensions):wke(t,n.extensions),a=er(e)?Dke(e,t,n.extensions,n.outTypes):_ke(t,n.extensions),l=er(e)?kke(n.frag):n.frag;return{id:Cee(),name:n.name,vert:`${s}${o}${bee(n.vert,r)}`,frag:`${a}${i}${bee(l,r)}`,extensions:n.extensions,outTypes:n.outTypes}}function kee(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"iv2":case"iv2[]":return e.INT_VEC2;case"iv3":case"iv3[]":return e.INT_VEC3;case"iv4":case"iv4[]":return e.INT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:}}function Mee(e){return e.endsWith("[]")}function Mke(e,t,r){e.uniform1f(t,r)}function Rke(e,t,r){e.uniform1fv(t,r)}function Bke(e,t,r){e.uniform1i(t,r)}function Lke(e,t,r){e.uniform1iv(t,r)}function Nke(e,t,r){e.uniform2fv(t,r)}function Fke(e,t,r){e.uniform3fv(t,r)}function Oke(e,t,r){e.uniform4fv(t,r)}function Vke(e,t,r){e.uniform2iv(t,r)}function Gke(e,t,r){e.uniform3iv(t,r)}function Uke(e,t,r){e.uniform4iv(t,r)}function zke(e,t,r){e.uniformMatrix3fv(t,!1,r)}function Hke(e,t,r){e.uniformMatrix4fv(t,!1,r)}function Dee(e){switch(e){case"f":return Mke;case"f[]":return Rke;case"i":case"t":case"b":return Bke;case"i[]":case"t[]":case"b[]":return Lke;case"v2":case"v2[]":return Nke;case"v3":case"v3[]":return Fke;case"v4":case"v4[]":return Oke;case"iv2":case"iv2[]":return Vke;case"iv3":case"iv3[]":return Gke;case"iv4":case"iv4[]":return Uke;case"m3":case"m3[]":return zke;case"m4":case"m4[]":return Hke}}function Ree(e){let t={};return Object.keys(e).forEach(r=>{let n=e[r];n.type==="uniform"?t[r]=Dee(n.kind):n.type==="texture"&&(t[r]=Dee("t"))}),t}function Bee(e){let t={};return Object.keys(e).forEach(r=>{t[r]=G.create(Xa(e[r].ref.value))}),t}var jke=ei();function $ke(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}function Wke(e,t){if(t instanceof Uint8Array)return e.UNSIGNED_BYTE;if(t instanceof Int8Array)return e.BYTE;if(t instanceof Uint16Array)return e.UNSIGNED_SHORT;if(t instanceof Int16Array)return e.SHORT;if(t instanceof Uint32Array)return e.UNSIGNED_INT;if(t instanceof Int32Array)return e.INT;if(t instanceof Float32Array)return e.FLOAT;Sr(t)}function qke(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":if(er(e))return e.UNIFORM_BUFFER;throw new Error("WebGL2 is required for uniform buffers")}}function c3(e){let t=e.createBuffer();if(t===null)throw new Error("Could not create WebGL buffer");return t}function Lee(e,t,r,n){let o=c3(e),i=$ke(e,r),s=qke(e,n),a=Wke(e,t),l=t.BYTES_PER_ELEMENT,c=t.length;function u(m){e.bindBuffer(s,o),e.bufferData(s,m,i)}u(t);let d=!1;return{id:jke(),_usageHint:i,_bufferType:s,_dataType:a,_bpe:l,length:c,getBuffer:()=>o,updateData:u,updateSubData:(m,p,h)=>{e.bindBuffer(s,o),h-p===m.length?e.bufferSubData(s,0,m):e.bufferSubData(s,p*l,m.subarray(p,p+h))},reset:()=>{o=c3(e),u(t)},destroy:()=>{d||(e.deleteBuffer(o),d=!0)}}}function Nee(e,t,r){switch(t){case"float32":switch(r){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}default:Sr(t)}}function Fee(e,t,r,n,o,i,s="static"){let{instancedArrays:a}=r,l=Lee(e,n,s,"attribute"),{_bufferType:c,_dataType:u,_bpe:d}=l;return{...l,divisor:i,bind:m=>{if(e.bindBuffer(c,l.getBuffer()),o===16)for(let p=0;p<4;++p)t.enableVertexAttrib(m+p),e.vertexAttribPointer(m+p,4,u,!1,4*4*d,p*4*d),a.vertexAttribDivisor(m+p,i);else t.enableVertexAttrib(m),e.vertexAttribPointer(m,o,u,!1,0,0),a.vertexAttribDivisor(m,i)},changeOffset:(m,p)=>{let h=p*d*o;if(e.bindBuffer(c,l.getBuffer()),o===16)for(let f=0;f<4;++f)e.vertexAttribPointer(m+f,4,u,!1,4*4*d,f*4*d+h);else e.vertexAttribPointer(m,o,u,!1,0,h)}}}function Oee(e,t,r){let n=[];return Object.keys(t).forEach(o=>{let i=t[o];i.type==="attribute"&&(n[n.length]=[o,e.resources.attribute(r[o].ref.value,i.itemSize,i.divisor)])}),n}function Vee(e,t,r="static"){let n=Lee(e,t,r,"elements");return{...n,bind:()=>{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.getBuffer())}}}var Zke=ei();function Kke(e,t,r){let n={};return Object.keys(r).forEach(o=>{let i=r[o];if(i.type==="attribute"){let s=e.getAttribLocation(t,o);n[o]=s}else if(i.type==="uniform"){let s=e.getUniformLocation(t,o);s===null&&Mee(i.kind)&&(s=e.getUniformLocation(t,o+"[0]")),n[o]=s}else if(i.type==="texture"){let s=e.getUniformLocation(t,o);n[o]=s}}),n}function Xke(e,t,r){let n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let o=0;o<n;++o){let i=e.getActiveAttrib(t,o);if(i){let{name:s,type:a}=i;if(s.startsWith("__activeAttribute")||s==="gl_InstanceID"||s==="gl_VertexID"||s==="gl_DrawID")continue;let l=r[s];if(l===void 0)throw new Error(`missing 'uniform' or 'texture' with name '${s}' in schema`);if(l.type!=="attribute")throw new Error(`'${s}' must be of type 'attribute' but is '${l.type}'`);let c=Nee(e,l.kind,l.itemSize);if(c!==a)throw new Error(`unexpected attribute type '${c}' for ${s}, expected '${a}'`)}}}function Yke(e,t,r){let n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<n;++o){let i=e.getActiveUniform(t,o);if(i){let{name:s,type:a}=i;if(s.startsWith("__activeUniform")||s==="gl_InstanceID"||s==="gl_VertexID"||s==="gl_DrawID")continue;let l=s.replace(/[[0-9]+\]$/,""),c=r[l];if(c===void 0)throw new Error(`missing 'uniform' or 'texture' with name '${s}' in schema`);if(c.type==="uniform"){if(kee(e,c.kind)!==a)throw new Error(`unexpected uniform type for ${s}`)}else if(c.type==="texture"){if(c.kind==="image-float32"||c.kind==="image-uint8"){if(a!==e.SAMPLER_2D)throw new Error(`unexpected sampler type for '${s}'`)}else if(c.kind==="volume-float32"||c.kind==="volume-uint8")if(er(e)){if(a!==e.SAMPLER_3D)throw new Error(`unexpected sampler type for '${s}'`)}else throw new Error("WebGL2 is required to use SAMPLER_3D")}else throw new Error(`'${s}' must be of type 'uniform' or 'texture' but is '${c.type}'`)}}}function Qke(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. 

${e.getProgramInfoLog(t)}`)}function u3(e){let t=e.createProgram();if(t===null)throw new Error("Could not create WebGL program");return t}function Gee(e,t,r,n,o){let{defineValues:i,shaderCode:s,schema:a}=o,l=u3(e),c=Zke(),u=Pee(e,r,i,s),d=n("vert",u.vert),m=n("frag",u.frag),p,h;function f(){d.attach(l),m.attach(l),e.linkProgram(l),lr&&Qke(e,l),p=Kke(e,l,a),h=Ree(a),lr&&(Xke(e,l,a),Yke(e,l,a))}f();let C=!1;return{id:c,use:()=>{t.currentProgramId=c,e.useProgram(l)},setUniforms:g=>{for(let b=0,y=g.length;b<y;++b){let[x,A]=g[b];if(A){let v=p[x];v!==null&&h[x](e,v,A.ref.value)}}},uniform:(g,b)=>{let y=p[g];y!==null&&h[g](e,y,b)},bindAttributes:g=>{t.clearVertexAttribsState();for(let b=0,y=g.length;b<y;++b){let[x,A]=g[b],v=p[x];v!==-1&&A.bind(v)}t.disableUnusedVertexAttribs()},offsetAttributes:(g,b)=>{for(let y=0,x=g.length;y<x;++y){let[A,v]=g[y],_=p[A];_!==-1&&v.changeOffset(_,b)}},bindTextures:(g,b)=>{for(let y=0,x=g.length;y<x;++y){let[A,v]=g[y],_=p[A];_!=null&&(v.bind(y+b),h[A](e,_,y+b))}},reset:()=>{l=u3(e),f()},destroy:()=>{C||(d.destroy(),m.destroy(),e.deleteProgram(l),C=!0)}}}var Jke=ei();function E2(e,t){let{type:r,source:n}=t,o=e.createShader(r==="vert"?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(o===null)throw new Error(`Error creating ${r} shader`);if(e.shaderSource(o,n),e.compileShader(o),lr&&e.getShaderParameter(o,e.COMPILE_STATUS)===!1)throw new Error(`Error compiling ${r} shader`);return o}function Uee(e,t){let r=E2(e,t);return{id:Jke(),attach:n=>{e.attachShader(n,r)},reset:()=>{r=E2(e,t)},destroy:()=>{e.deleteShader(r)}}}function eMe(e,t=0){return{value:e,usageCount:t}}function tMe(e){return{free:()=>{e.usageCount-=1},value:e.value}}function N5(e,t,r){let n=new Map;return{get:o=>{let i=e(o),s=n.get(i);return s||(s=eMe(t(o)),n.set(i,s)),s.usageCount+=1,tMe(s)},clear:()=>{n.forEach((o,i)=>{o.usageCount<=0&&(o.usageCount<0,r(o.value),n.delete(i))})},get count(){return n.size},dispose:()=>{n.forEach(o=>r(o.value)),n.clear()}}}var rMe=ei();function nMe(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth24":if(er(e))return e.DEPTH_COMPONENT24;throw new Error("WebGL2 needed for `depth24` renderbuffer format");case"depth32f":if(er(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format");case"depth24-stencil8":if(er(e))return e.DEPTH24_STENCIL8;throw new Error("WebGL2 needed for `depth24-stencil8` renderbuffer format");case"depth32f-stencil8":if(er(e))return e.DEPTH32F_STENCIL8;throw new Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}function oMe(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}function zee(e){let t=e.createRenderbuffer();if(t===null)throw new Error("Could not create WebGL renderbuffer");return t}function Hee(e,t,r,n,o){let i=zee(e),s=()=>e.bindRenderbuffer(e.RENDERBUFFER,i),a=nMe(e,t),l=oMe(e,r);function c(){s(),e.renderbufferStorage(e.RENDERBUFFER,a,n,o)}c();let u=!1;return{id:rMe(),bind:s,attachFramebuffer:d=>{d.bind(),s(),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,i),lr&&Ib(e)},detachFramebuffer:d=>{d.bind(),s(),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,null),lr&&Ib(e)},setSize:(d,m)=>{n=d,o=m,c()},reset:()=>{i=zee(e),c()},destroy:()=>{u||(e.deleteRenderbuffer(i),u=!0)}}}var iMe=ei();function jee(e){let{vertexArrayObject:t}=e;if(!t)throw new Error("VertexArrayObject not supported");let r=t.createVertexArray();if(!r)throw new Error("Could not create WebGL vertex array");return r}function $ee(e){let{vertexArrayObject:t}=e;if(t===null)throw new Error("VertexArrayObject not supported");return t}function Wee(e,t,r,n,o){let i=iMe(),s=jee(t),a=$ee(t);function l(){a.bindVertexArray(s),o&&o.bind(),r.bindAttributes(n),a.bindVertexArray(null)}l();let c=!1;return{id:i,bind:()=>{a.bindVertexArray(s)},update:l,reset:()=>{s=jee(t),a=$ee(t),l()},destroy:()=>{c||(o&&(a.bindVertexArray(s),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),a.deleteVertexArray(s),c=!0)}}}function sMe(e){return typeof e=="boolean"?e?1:0:typeof e=="number"?e*1e4:NA(e)}function qee(e){return{...e.value,destroy:()=>{e.free()}}}function Zee(e,t,r,n){let o={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set};function i(c,u){return o[c].add(u),r.resourceCounts[c]+=1,{...u,destroy:()=>{u.destroy(),o[c].delete(u),r.resourceCounts[c]-=1}}}let s=N5(c=>JSON.stringify(c),c=>i("shader",Uee(e,c)),c=>{c.destroy()});function a(c,u){return qee(s.get({type:c,source:u}))}let l=N5(c=>{var u;let d=[c.shaderCode.id],m=((u=c.defineValues.dRenderVariant)===null||u===void 0?void 0:u.ref.value)||"";return Object.keys(c.defineValues).forEach(p=>{var h,f;!((f=(h=c.shaderCode).ignoreDefine)===null||f===void 0)&&f.call(h,p,m,c.defineValues)||d.push(NA(p),sMe(c.defineValues[p].ref.value))}),di(d).toString()},c=>i("program",Gee(e,t,n,a,c)),c=>{c.destroy()});return{attribute:(c,u,d,m)=>i("attribute",Fee(e,t,n,c,u,d,m)),elements:(c,u)=>i("elements",Vee(e,c,u)),framebuffer:()=>i("framebuffer",jQ(e)),program:(c,u,d)=>qee(l.get({defineValues:c,shaderCode:u,schema:d})),renderbuffer:(c,u,d,m)=>i("renderbuffer",Hee(e,c,u,d,m)),shader:a,texture:(c,u,d,m)=>i("texture",Kee(e,n,c,u,d,m)),cubeTexture:(c,u,d)=>i("cubeTexture",Xee(e,c,u,d)),vertexArray:(c,u,d)=>i("vertexArray",Wee(e,n,c,u,d)),getByteCounts:()=>{let c=0;o.texture.forEach(m=>{c+=m.getByteCount()}),o.cubeTexture.forEach(m=>{c+=m.getByteCount()});let u=0;o.attribute.forEach(m=>{u+=m.length*4});let d=0;return o.elements.forEach(m=>{d+=m.length*4}),{texture:c,attribute:u,elements:d}},reset:()=>{o.attribute.forEach(c=>c.reset()),o.elements.forEach(c=>c.reset()),o.framebuffer.forEach(c=>c.reset()),o.renderbuffer.forEach(c=>c.reset()),o.shader.forEach(c=>c.reset()),o.program.forEach(c=>c.reset()),o.vertexArray.forEach(c=>c.reset()),o.texture.forEach(c=>c.reset())},destroy:()=>{o.attribute.forEach(c=>c.destroy()),o.elements.forEach(c=>c.destroy()),o.framebuffer.forEach(c=>c.destroy()),o.renderbuffer.forEach(c=>c.destroy()),o.shader.forEach(c=>c.destroy()),o.program.forEach(c=>c.destroy()),o.vertexArray.forEach(c=>c.destroy()),o.texture.forEach(c=>c.destroy()),s.clear(),l.clear()}}}var Yee=ei();function Qee(e,t,r,n,o=!0,i="uint8",s="nearest",a="rgba"){if(a==="alpha"&&!er(e))throw new Error("cannot render to alpha format in webgl1");let l=t.framebuffer(),c=i==="fp16"?t.texture("image-float16",a,"fp16",s):i==="float32"?t.texture("image-float32",a,"float",s):t.texture("image-uint8",a,"ubyte",s),u=o?er(e)?t.renderbuffer("depth32f","depth",r,n):t.renderbuffer("depth16","depth",r,n):null;function d(){c.define(r,n),c.attachFramebuffer(l,"color0"),u&&u.attachFramebuffer(l)}d();let m=!1;return{id:Yee(),texture:c,framebuffer:l,depthRenderbuffer:u,getWidth:()=>r,getHeight:()=>n,bind:()=>{l.bind()},setSize:(p,h)=>{r===p&&n===h||(r=p,n=h,c.define(r,n),u&&u.setSize(r,n))},reset:()=>{d()},destroy:()=>{m||(c.destroy(),l.destroy(),u&&u.destroy(),m=!0)}}}function Jee(e){return{id:Yee(),texture:Ro(e),framebuffer:$Q(),depthRenderbuffer:null,getWidth:()=>0,getHeight:()=>0,bind:()=>{e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:()=>{},reset:()=>{},destroy:()=>{}}}function aMe(e,t,r){return e-=e/r,e+=t/r,e}var d3=class{add(t,r){let n=this.avgs.get(t)||r;return n=aMe(n,r,this.count),this.avgs.set(t,n),n}get(t){return this.avgs.get(t)}stats(){return Object.fromEntries(this.avgs.entries())}clear(){this.avgs.clear()}constructor(t){this.count=t,this.avgs=new Map}};function lMe(e){e.calls.drawInstanced=0,e.calls.drawInstancedBase=0,e.calls.multiDrawInstancedBase=0,e.calls.counts=0,e.culled.lod=0,e.culled.frustum=0,e.culled.occlusion=0}function cMe(e){return e.disjointTimerQuery?e.disjointTimerQuery.createQuery():null}function ete(e,t,r,n){var o;let i=t.disjointTimerQuery,s=(o=n?.avgCount)!==null&&o!==void 0?o:30,a=new Map,l=new Map,c=[],u=new d3(s),d=new d3(s),m=[],p=null,h=!1,f=()=>{i&&(a.forEach((g,b)=>{i.deleteQuery(b)}),l.clear(),c.length=0,u.clear(),d.clear(),m=[],p=null,h=!1)},C=()=>{if(!i)return;let g=cMe(t);g&&(i.beginQuery(i.TIME_ELAPSED,g),l.forEach((b,y)=>{b.queries.push(g)}),a.set(g,{refCount:l.size}),p=g)};return{resolve:()=>{let g=[];if(!i||!m.length)return g;a.forEach((y,x)=>{if(y.timeElapsed!==void 0)return;let A=i.getQueryParameter(x,i.QUERY_RESULT_AVAILABLE),v=e.getParameter(i.GPU_DISJOINT);if(A&&!v){let _=i.getQueryParameter(x,i.QUERY_RESULT);y.timeElapsed=_}(A||v)&&i.deleteQuery(x)});let b=[];for(let y of m)if(y.queries.every(x=>{var A;return((A=a.get(x))===null||A===void 0?void 0:A.timeElapsed)!==void 0})){let x=0;for(let A of y.queries){let v=a.get(A);x+=v.timeElapsed,v.refCount-=1}if(y.timeElapsed=x,y.root){let A=[],v=(I,T)=>{for(let E of I){let w=E.timeElapsed,S=E.cpu.end-E.cpu.start,P={label:E.label,gpuElapsed:w,gpuAvg:u.add(E.label,w),cpuElapsed:S,cpuAvg:d.add(E.label,S),children:[],calls:E.calls};T.push(P),v(E.children,P.children)}};v(y.children,A);let _=y.cpu.end-y.cpu.start;g.push({label:y.label,gpuElapsed:x,gpuAvg:u.add(y.label,x),cpuElapsed:_,cpuAvg:d.add(y.label,_),children:A,calls:y.calls})}}else b.push(y);return m=b,a.forEach((y,x)=>{y.refCount===0&&a.delete(x)}),g},mark:(g,b=!1)=>{if(!i)return;if(l.has(g))throw new Error(`Timer mark for '${g}' already exists`);p!==null&&i.endQuery(i.TIME_ELAPSED);let y={label:g,queries:[],children:[],root:p===null,cpu:{start:Zn(),end:-1},captureStats:b};if(l.set(g,y),c.length&&c[c.length-1].children.push(y),c.push(y),b){if(h)throw new Error("Already capturing stats");lMe(r),h=!0}C()},markEnd:g=>{var b;if(!i)return;let y=l.get(g);if(!y)throw new Error(`Timer mark for '${g}' does not exist`);if(((b=c.pop())===null||b===void 0?void 0:b.label)!==g)throw new Error(`Timer mark for '${g}' has pending nested mark`);i.endQuery(i.TIME_ELAPSED),l.delete(g),y.cpu.end=Zn(),y.captureStats&&(y.calls={...r.calls},h=!1),m.push(y),l.size>0?C():p=null},stats:()=>({gpu:u.stats(),cpu:d.stats()}),formatedStats:()=>{let g={},b=u.stats(),y=d.stats();for(let x of Object.keys(b)){let A=`${(b[x]/1e3/1e3).toFixed(2)}`,v=`${y[x].toFixed(2)}`;g[x]=`${A} ms | CPU: ${v} ms`}return g},clear:f,destroy:()=>{f()}}}function uMe(e){let t=`${(e.gpuElapsed/1e3/1e3).toFixed(2)}`,r=`${(e.gpuAvg/1e3/1e3).toFixed(2)}`,n=`${e.cpuElapsed.toFixed(2)}`,o=`${e.cpuAvg.toFixed(2)}`;return`${e.label} ${t} ms (avg. ${r} ms) | CPU: ${n} ms (avg. ${o} ms)`}function F5(e){e.map(t=>{let r=uMe(t);(t.children.length||t.calls)&&(t.calls,F5(t.children))})}function rte(e,t){function r(o){try{return e.getContext(o,t)}catch{return null}}return(t?.preferWebGl1?null:r("webgl2"))||r("webgl")||r("experimental-webgl")}function dMe(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function V5(e){let t=e.getError();if(t!==e.NO_ERROR)throw new Error(`WebGL error: '${dMe(e,t)}'`)}function mMe(e){let t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let o=0;o<t;++o)e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),er(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));let r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);let n=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(let o=0;o<n;++o)e.vertexAttribPointer(o,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),m3(e)}function m3(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}var nte=new Uint8Array(1*4);function ote(e,t,r){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),r()):Gh.setImmediate(ote,e,t,r)}function ite(e,t){let r=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);r?Gh.setImmediate(ote,e,r,t):(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,nte),t())}var tte=!1;function pMe(e){return new Promise(t=>{er(e)?ite(e,t):(tte||(tte=!0),ste(e),t())})}function ste(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,nte)}function O5(e,t,r,n,o,i){if(lr&&Ib(e),i instanceof Uint8Array)e.readPixels(t,r,n,o,e.RGBA,e.UNSIGNED_BYTE,i);else if(i instanceof Float32Array)e.readPixels(t,r,n,o,e.RGBA,e.FLOAT,i);else if(i instanceof Int32Array&&er(e))e.readPixels(t,r,n,o,e.RGBA_INTEGER,e.INT,i);else throw new Error("unsupported readPixels buffer type");lr&&V5(e)}function fMe(e,t){let r=e.drawingBufferWidth,n=e.drawingBufferHeight,o=new Uint8Array(r*n*4);return m3(e),t.viewport(0,0,r,n),O5(e,0,0,r,n,o),ig.flipY(ig.create(o,r,n))}function hMe(){return{resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,drawInstancedBase:0,multiDrawInstancedBase:0,counts:0},culled:{lod:0,frustum:0,occlusion:0}}}function ate(e,t={}){let r=L5(e),n=CJ(e,r),o=hMe(),i=Zee(e,n,o,r),s=ete(e,r,o),a={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:er(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:r.drawBuffers?e.getParameter(r.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(a.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');let l=r.provokingVertex;l?.provokingVertex(l.FIRST_VERTEX_CONVENTION);let c=!1,u=new jo(0),d=t.pixelScale||1,m;if(er(e)){let h=e.createBuffer(),f,C,g=!1,b=()=>{e.bindBuffer(e.PIXEL_PACK_BUFFER,h),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,f),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),g=!1,C(),C=void 0,f=void 0};m=(y,x,A,v,_)=>new Promise((I,T)=>{if(g){T("Can not call multiple readPixelsAsync at the same time");return}g=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,h),e.bufferData(e.PIXEL_PACK_BUFFER,A*v*4,e.STREAM_READ),e.readPixels(y,x,A,v,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),C=I,f=_,ite(e,b)})}else m=async(h,f,C,g,b)=>{O5(e,h,f,C,g,b)};let p=new Set;return{gl:e,isWebGL2:er(e),get pixelRatio(){return(typeof window<"u"&&window.devicePixelRatio||1)*(d||1)},extensions:r,state:n,stats:o,resources:i,timer:s,get maxTextureSize(){return a.maxTextureSize},get max3dTextureSize(){return a.max3dTextureSize},get maxRenderbufferSize(){return a.maxRenderbufferSize},get maxDrawBuffers(){return a.maxDrawBuffers},get maxTextureImageUnits(){return a.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return c||e.isContextLost()},contextRestored:u,setContextLost:()=>{c=!0,s.clear()},handleContextRestored:h=>{Object.assign(r,L5(e)),n.reset(),n.currentMaterialId=-1,n.currentProgramId=-1,n.currentRenderItemId=-1,i.reset(),p.forEach(f=>f.reset()),h?.(),c=!1,u.next(Zn())},setPixelScale:h=>{d=h},createRenderTarget:(h,f,C,g,b,y)=>{let x=Qee(e,i,h,f,C,g,b,y);return p.add(x),{...x,destroy:()=>{x.destroy(),p.delete(x)}}},unbindFramebuffer:()=>m3(e),readPixels:(h,f,C,g,b)=>{O5(e,h,f,C,g,b)},readPixelsAsync:m,waitForGpuCommandsComplete:()=>pMe(e),waitForGpuCommandsCompleteSync:()=>ste(e),getDrawingBufferPixelData:()=>fMe(e,n),clear:(h,f,C,g)=>{m3(e),n.enable(e.SCISSOR_TEST),n.depthMask(!0),n.colorMask(!0,!0,!0,!0),n.clearColor(h,f,C,g),n.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),n.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:h=>{var f,C;i.destroy(),mMe(e),h?.doNotForceWebGLContextLoss||((f=e.getExtension("WEBGL_lose_context"))===null||f===void 0||f.loseContext(),(C=e.getExtension("STACKGL_destroy_context"))===null||C===void 0||C.destroy())}}}function er(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}function WQ(e){if(er(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};{let t=e.getExtension("ANGLE_instanced_arrays");return t===null?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}}function qQ(e){if(er(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};{let t=e.getExtension("OES_standard_derivatives");return t===null?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}}function ZQ(e){return er(e)?{}:e.getExtension("OES_element_index_uint")}function KQ(e){if(er(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};{let t=e.getExtension("OES_vertex_array_object");return t===null?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}}function XQ(e){return er(e)?{}:e.getExtension("OES_texture_float")}function YQ(e){return e.getExtension("OES_texture_float_linear")}function QQ(e){if(er(e))return{HALF_FLOAT:e.HALF_FLOAT};{let t=e.getExtension("OES_texture_half_float");return t===null?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}}function JQ(e){return e.getExtension("OES_texture_half_float_linear")}function eJ(e){if(er(e))return{MIN:e.MIN,MAX:e.MAX};{let t=e.getExtension("EXT_blend_minmax");return t===null?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}}function tJ(e){return er(e)?{}:e.getExtension("EXT_frag_depth")}function rJ(e){if(er(e))return e.getExtension("EXT_color_buffer_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});{let t=e.getExtension("WEBGL_color_buffer_float");return t===null?(e.getExtension("OES_texture_float"),lte(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}}function nJ(e){if(er(e))return e.getExtension("EXT_color_buffer_half_float")===null?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});{let t=e.getExtension("EXT_color_buffer_half_float");return t===null?(e.getExtension("OES_texture_half_float"),lte(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}}function oJ(e){if(er(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};{let t=e.getExtension("WEBGL_draw_buffers");return t===null?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}}function iJ(e){let t=e.getExtension("OES_draw_buffers_indexed");return t===null?null:{enablei:t.enableiOES.bind(t),disablei:t.disableiOES.bind(t),blendEquationi:t.blendEquationiOES.bind(t),blendEquationSeparatei:t.blendEquationSeparateiOES.bind(t),blendFunci:t.blendFunciOES.bind(t),blendFuncSeparatei:t.blendFuncSeparateiOES.bind(t),colorMaski:t.colorMaskiOES.bind(t)}}function sJ(e){return er(e)?{}:e.getExtension("EXT_shader_texture_lod")}function aJ(e){if(er(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};{let t=e.getExtension("WEBGL_depth_texture");return t===null?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}}function lJ(e){if(er(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};{let t=e.getExtension("EXT_sRGB");return t===null?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}}function cJ(e){if(er(e)){let t=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query");return t===null?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:e.CURRENT_QUERY,QUERY_RESULT:e.QUERY_RESULT,QUERY_RESULT_AVAILABLE:e.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:e.createQuery.bind(e),deleteQuery:e.deleteQuery.bind(e),isQuery:e.isQuery.bind(e),beginQuery:e.beginQuery.bind(e),endQuery:e.endQuery.bind(e),queryCounter:t.queryCounterEXT.bind(t),getQuery:e.getQuery.bind(e),getQueryParameter:e.getQueryParameter.bind(e)}}else{let t=e.getExtension("EXT_disjoint_timer_query");return t===null?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:t.CURRENT_QUERY_EXT,QUERY_RESULT:t.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:t.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:t.createQueryEXT.bind(t),deleteQuery:t.deleteQueryEXT.bind(t),isQuery:t.isQueryEXT.bind(t),beginQuery:t.beginQueryEXT.bind(t),endQuery:t.endQueryEXT.bind(t),queryCounter:t.queryCounterEXT.bind(t),getQuery:t.getQueryEXT.bind(t),getQueryParameter:t.getQueryObjectEXT.bind(t)}}}function uJ(e){let t=e.getExtension("WEBGL_multi_draw");return t?{multiDrawArrays:t.multiDrawArraysWEBGL.bind(t),multiDrawElements:t.multiDrawElementsWEBGL.bind(t),multiDrawArraysInstanced:t.multiDrawArraysInstancedWEBGL.bind(t),multiDrawElementsInstanced:t.multiDrawElementsInstancedWEBGL.bind(t)}:null}function dJ(e){let t=e.getExtension("WEBGL_draw_instanced_base_vertex_base_instance");return t?{drawArraysInstancedBaseInstance:t.drawArraysInstancedBaseInstanceWEBGL.bind(t),drawElementsInstancedBaseVertexBaseInstance:t.drawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function mJ(e){let t=e.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance");return t?{multiDrawArraysInstancedBaseInstance:t.multiDrawArraysInstancedBaseInstanceWEBGL.bind(t),multiDrawElementsInstancedBaseVertexBaseInstance:t.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function pJ(e){let t=e.getExtension("KHR_parallel_shader_compile");return t===null?null:{COMPLETION_STATUS:t.COMPLETION_STATUS_KHR}}function fJ(e){return er(e)?{}:e.getExtension("OES_fbo_render_mipmap")}function hJ(e){if(er(e)){let t=e.getExtension("WEBGL_provoking_vertex");if(t)return{FIRST_VERTEX_CONVENTION:t.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:t.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:t.PROVOKING_VERTEX_WEBGL,provokingVertex:t.provokingVertexWEBGL.bind(t)}}return null}function gJ(e){if(er(e)){let t=e.getExtension("WEBGL_clip_cull_distance");if(t)return{MAX_CLIP_DISTANCES:t.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:t.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:t.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:t.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:t.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:t.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:t.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:t.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:t.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:t.CLIP_DISTANCE7_WEBGL}}return null}function yJ(e){return er(e)&&e.getExtension("EXT_conservative_depth")?{}:null}function vJ(e){if(er(e)){let t=e.getExtension("WEBGL_stencil_texturing");if(t)return{DEPTH_STENCIL_TEXTURE_MODE:t.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:t.STENCIL_INDEX_WEBGL}}return null}function bJ(e){let t=e.getExtension("EXT_clip_control");return t?{LOWER_LEFT:t.LOWER_LEFT_EXT,UPPER_LEFT:t.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:t.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:t.ZERO_TO_ONE_EXT,CLIP_ORIGIN:t.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:t.CLIP_DEPTH_MODE_EXT,clipControl:t.clipControlEXT.bind(t)}:null}function xJ(e){if(!er(e))return!1;if(typeof navigator<"u"){let t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return t?parseInt(t[1])>=85:!0}return!1}var gMe=`
attribute vec4 aPosition;

void main() {
    gl_Position = aPosition;
}`,yMe=`
precision mediump float;
uniform vec4 uColor;
uniform sampler2D uTexture;

void main() {
    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;
}`,vMe=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function lte(e,t){let r=E2(e,{type:"vert",source:gMe}),n=E2(e,{type:"frag",source:yMe});if(!r||!n)return!1;let o=u3(e);e.attachShader(o,r),e.attachShader(o,n),e.linkProgram(o),e.useProgram(o);let i=e.getAttribLocation(o,"aPosition"),s=e.getUniformLocation(o,"uColor");if(!s)return!1;let a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,vMe,e.STATIC_DRAW),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);let l=e.createTexture(),c=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,c);let u=e.createTexture();e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);let d=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return!1;e.bindTexture(e.TEXTURE_2D,l),e.uniform4fv(s,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,u),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(s,[0,1/10,1/20,1]),e.drawArrays(e.TRIANGLES,0,6);let p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),p[0]!==0||p[1]<248||p[2]<248||p[3]<254)return!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);let h=new Float32Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,h),e.getError())return!1}return!0}var G5=ei();function bMe(e,t){switch(t){case"image-uint8":return e.TEXTURE_2D;case"image-float32":return e.TEXTURE_2D;case"image-float16":return e.TEXTURE_2D;case"image-depth":return e.TEXTURE_2D}if(er(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":return e.TEXTURE_3D;case"volume-float32":return e.TEXTURE_3D;case"volume-float16":return e.TEXTURE_3D}throw new Error(`unknown texture kind '${t}'`)}function pte(e,t,r){switch(t){case"alpha":return er(e)&&r==="float"?e.RED:er(e)&&r==="int"?e.RED_INTEGER:e.ALPHA;case"rgb":return er(e)&&r==="int"?e.RGB_INTEGER:e.RGB;case"rg":if(er(e)&&r==="float")return e.RG;if(er(e)&&r==="int")return e.RG_INTEGER;throw new Error('texture format "rg" requires webgl2 and type "float" or int"');case"rgba":return er(e)&&r==="int"?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function xMe(e,t,r){if(er(e))switch(t){case"alpha":switch(r){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rg":switch(r){case"ubyte":return e.RG;case"float":return e.RG32F;case"fp16":return e.RG16F;case"int":return e.RG32I}case"rgb":switch(r){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(r){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(r){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return pte(e,t,r)}function fte(e,t,r,n,o){return CMe(e)*SMe(t)*r*n*(o||1)}function CMe(e){switch(e){case"alpha":return 1;case"rg":return 2;case"rgb":return 3;case"rgba":return 4;case"depth":return 4}}function SMe(e){switch(e){case"ubyte":return 1;case"ushort":return 2;case"float":return 4;case"fp16":return 2;case"int":return 4}}function IMe(e,t,r){switch(r){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(er(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}function cte(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function p3(e,t,r){switch(r){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(r){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function ute(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function AMe(e,t,r){return t===r.TEXTURE_2D}function dte(e,t,r){return t===r.TEXTURE_3D}function mte(e){let t=e.createTexture();if(t===null)throw new Error("Could not create WebGL texture");return t}function Kee(e,t,r,n,o,i){let s=G5(),a=mte(e);if(r.endsWith("float32")&&o!=="float"||r.endsWith("float16")&&o!=="fp16"||r.endsWith("uint8")&&o!=="ubyte"||r.endsWith("int32")&&o!=="int"||r.endsWith("depth")&&o!=="ushort"&&o!=="float")throw new Error(`texture kind '${r}' and type '${o}' are incompatible`);if(!t.depthTexture&&n==="depth")throw new Error("extension 'WEBGL_depth_texture' needed for 'depth' texture format");let l=bMe(e,r),c=cte(e,i),u=pte(e,n,o),d=xMe(e,n,o),m=IMe(e,t,o);function p(){e.bindTexture(l,a),e.texParameteri(l,e.TEXTURE_MAG_FILTER,c),e.texParameteri(l,e.TEXTURE_MIN_FILTER,c),e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(l,null)}p();let h=0,f=0,C=0,g,b=!1,y=!1;function x(I,T,E){if(I===0||T===0||er(e)&&l===e.TEXTURE_3D&&E===0)throw new Error("empty textures are not allowed");if(!(h===I&&f===T&&C===(E||0)))if(h=I,f=T,C=E||0,e.bindTexture(l,a),l===e.TEXTURE_2D)e.texImage2D(l,0,d,h,f,0,u,m,null);else if(er(e)&&l===e.TEXTURE_3D&&C!==void 0)e.texImage3D(l,0,d,h,f,C,0,u,m,null);else throw new Error("unknown texture target")}x(1,1,er(e)&&l===e.TEXTURE_3D?1:0);function A(I,T=!1){if(I.width===0||I.height===0||!ute(I)&&er(e)&&dte(I,l,e)&&I.depth===0)throw new Error("empty textures are not allowed");if(e.bindTexture(l,a),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),ute(I))h=I.width,f=I.height,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,d,u,m,I);else if(AMe(I,l,e)){let E=I.filter?cte(e,I.filter):c;e.texParameteri(l,e.TEXTURE_MAG_FILTER,E),e.texParameteri(l,e.TEXTURE_MIN_FILTER,E),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!I.flipY),T?e.texSubImage2D(l,0,0,0,I.width,I.height,u,m,I.array):(h=I.width,f=I.height,e.texImage2D(l,0,d,h,f,0,u,m,I.array))}else if(er(e)&&dte(I,l,e))e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),T?e.texSubImage3D(l,0,0,0,0,I.width,I.height,I.depth,u,m,I.array):(h=I.width,f=I.height,C=I.depth,e.texImage3D(l,0,d,h,f,C,0,u,m,I.array));else throw new Error("unknown texture target");e.bindTexture(l,null),g=I}function v(){if(l!==e.TEXTURE_2D)throw new Error("mipmap only supported for 2d textures");if(er(e)||m0(h)&&m0(f))e.bindTexture(l,a),e.texParameteri(l,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(l),e.bindTexture(l,null),b=!0;else throw new Error("mipmap unsupported for non-power-of-two textures and webgl1")}function _(I,T,E){if(I.bind(),l===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,p3(e,t,T),e.TEXTURE_2D,a,0);else if(er(e)&&l===e.TEXTURE_3D){if(E===void 0)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,p3(e,t,T),a,0,E)}else throw new Error("unknown/unsupported texture target")}return{id:s,target:l,format:u,internalFormat:d,type:m,filter:c,getWidth:()=>h,getHeight:()=>f,getDepth:()=>C,getByteCount:()=>fte(n,o,h,f,C),define:x,load:A,mipmap:v,bind:I=>{e.activeTexture(e.TEXTURE0+I),e.bindTexture(l,a)},unbind:I=>{e.activeTexture(e.TEXTURE0+I),e.bindTexture(l,null)},attachFramebuffer:_,detachFramebuffer:(I,T)=>{if(I.bind(),l===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,p3(e,t,T),e.TEXTURE_2D,null,0);else if(er(e)&&l===e.TEXTURE_3D)e.framebufferTextureLayer(e.FRAMEBUFFER,p3(e,t,T),null,0,0);else throw new Error("unknown texture target")},reset:()=>{a=mte(e),p();let[I,T,E]=[h,f,C];h=0,f=0,C=0,x(I,T,E),g&&A(g),b&&v()},destroy:()=>{y||(e.deleteTexture(a),y=!0)}}}function U5(e,t,r){let{resources:n}=e,o=[];return Object.keys(t).forEach(i=>{let s=t[i];if(s.type==="texture"){let a=r[i];if(a)if(s.kind==="texture")o[o.length]=[i,a.ref.value];else{let l=n.texture(s.kind,s.format,s.dataType,s.filter);l.load(a.ref.value),o[o.length]=[i,l]}}}),o}function z5(e,t,r){let n=new Image;n.onload=function(){r.load(n),G.update(t,r)},n.src=e}function wMe(e,t){switch(t){case"nx":return e.TEXTURE_CUBE_MAP_NEGATIVE_X;case"ny":return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"nz":return e.TEXTURE_CUBE_MAP_NEGATIVE_Z;case"px":return e.TEXTURE_CUBE_MAP_POSITIVE_X;case"py":return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case"pz":return e.TEXTURE_CUBE_MAP_POSITIVE_Z}}function Xee(e,t,r,n){let o=e.TEXTURE_CUBE_MAP,i=e.LINEAR,s=e.RGBA,a=e.RGBA,l=e.UNSIGNED_BYTE,c=0,u=e.createTexture();e.bindTexture(o,u);let d=0;Ao(t,(p,h)=>{if(!p)return;let f=0,C=wMe(e,h),g=new Image;p instanceof File?g.src=URL.createObjectURL(p):p0(p)?p.then(b=>{g.src=URL.createObjectURL(b)}):g.src=p,g.addEventListener("load",()=>{c===0&&(c=g.width),e.texImage2D(C,f,s,c,c,0,a,l,null),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(o,u),e.texImage2D(C,f,s,a,l,g),d+=1,d===6&&(m||(r?(e.texParameteri(o,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(o)):e.texParameteri(o,e.TEXTURE_MIN_FILTER,i),e.texParameteri(o,e.TEXTURE_MAG_FILTER,i)),n?.(m))}),g.addEventListener("error",()=>{n?.(!0)})});let m=!1;return{id:G5(),target:o,format:a,internalFormat:s,type:l,filter:i,getWidth:()=>c,getHeight:()=>c,getDepth:()=>0,getByteCount:()=>fte("rgba","ubyte",c,c,0)*6*(r?2:1),define:()=>{},load:()=>{},mipmap:()=>{},bind:p=>{e.activeTexture(e.TEXTURE0+p),e.bindTexture(o,u)},unbind:p=>{e.activeTexture(e.TEXTURE0+p),e.bindTexture(o,null)},attachFramebuffer:()=>{},detachFramebuffer:()=>{},reset:()=>{},destroy:()=>{m||(e.deleteTexture(u),m=!0)}}}var hte=-1;function gte(e){return e.format===hte}function Ro(e){var t;let r=(t=e?.TEXTURE_2D)!==null&&t!==void 0?t:3553;return{id:G5(),target:r,format:hte,internalFormat:0,type:0,filter:0,getWidth:()=>0,getHeight:()=>0,getDepth:()=>0,getByteCount:()=>0,define:()=>{},load:()=>{},mipmap:()=>{},bind:n=>{e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},unbind:n=>{e&&(e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,null))},attachFramebuffer:()=>{throw new Error("cannot attach null-texture to a framebuffer")},detachFramebuffer:()=>{throw new Error("cannot detach null-texture from a framebuffer")},reset:()=>{},destroy:()=>{}}}function $i(e,t,r,n){let o=_Me(e,t,r,n);return r.palette?(G.updateIfChanged(o.dUsePalette,!0),TMe(r.palette,o.tPalette)):G.updateIfChanged(o.dUsePalette,!1),o}function _Me(e,t,r,n){switch(r.granularity){case"uniform":return PMe(e,r.color,n);case"instance":return e.nonInstanceable?yte(e,r.color,n):DMe(e,r.color,n);case"group":return yte(e,r.color,n);case"groupInstance":return kMe(e,r.color,n);case"vertex":return MMe(t,r.color,n);case"vertexInstance":return RMe(t,r.color,n);case"volume":return vte(r.grid,"volume",n);case"volumeInstance":return vte(r.grid,"volumeInstance",n);case"direct":return BMe(n)}}function TMe(e,t){let r=!0,n=t.ref.value;if(e.colors.length!==n.width||n.filter!==e.filter)r=!1;else{let s=n.array,a=0;for(let l of e.colors){let[c,u,d]=ze.toRgb(l);if(s[a++]!==c||s[a++]!==u||s[a++]!==d){r=!1;break}}}if(r)return;let o=new Uint8Array(e.colors.length*3),i=0;for(let s of e.colors){let[a,l,c]=ze.toRgb(s);o[i++]=a,o[i++]=l,o[i++]=c}G.update(t,{array:o,height:1,width:e.colors.length,filter:e.filter})}function EMe(e,t){return t?(G.update(t.uColor,ze.toVec3Normalized(t.uColor.ref.value,e)),G.updateIfChanged(t.dColorType,"uniform"),t):{uColor:G.create(ze.toVec3Normalized(D(),e)),tColor:G.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:G.create(Ro()),tPalette:G.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:G.create(Ve.create(1,1)),uColorGridDim:G.create(D.create(1,1,1)),uColorGridTransform:G.create(Ht.create(0,0,0,1)),dColorType:G.create("uniform"),dUsePalette:G.create(!1)}}function PMe(e,t,r){return EMe(t(bs,!1),r)}function P2(e,t,r){return r?(G.update(r.tColor,e),G.update(r.uColorTexDim,Ve.create(e.width,e.height)),G.updateIfChanged(r.dColorType,t),r):{uColor:G.create(D()),tColor:G.create(e),tColorGrid:G.create(Ro()),tPalette:G.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:G.create(Ve.create(e.width,e.height)),uColorGridDim:G.create(D.create(1,1,1)),uColorGridTransform:G.create(Ht.create(0,0,0,1)),dColorType:G.create(t),dUsePalette:G.create(!1)}}function DMe(e,t,r){let{instanceCount:n}=e,o=mo(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){let{location:i,isSecondary:s,instanceIndex:a}=e.move();ze.toArray(t(i,s),o.array,a*3),e.skipInstance()}return P2(o,"instance",r)}function yte(e,t,r){let{groupCount:n,hasLocation2:o}=e,i=mo(Math.max(1,n*(o?2:1)),3,Uint8Array,r&&r.tColor.ref.value.array);e.reset();let s=o?6:3;for(;e.hasNext&&!e.isNextNewInstance;){let{location:a,location2:l,isSecondary:c,groupIndex:u}=e.move();ze.toArray(t(a,c),i.array,u*s),o&&ze.toArray(t(l,c),i.array,u*s+3)}return P2(i,"group",r)}function kMe(e,t,r){let{groupCount:n,instanceCount:o,hasLocation2:i}=e,s=o*n*(i?2:1),a=mo(Math.max(1,s),3,Uint8Array,r&&r.tColor.ref.value.array);e.reset();let l=i?6:3;for(;e.hasNext;){let{location:c,location2:u,isSecondary:d,index:m}=e.move();ze.toArray(t(c,d),a.array,m*l),i&&ze.toArray(t(u,d),a.array,m*l+3)}return P2(a,"groupInstance",r)}function MMe(e,t,r){let{groupCount:n,stride:o}=e,i=mo(Math.max(1,n),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;){let{location:s,isSecondary:a,groupIndex:l}=e.move(),c=t(s,a);for(let u=0;u<o;++u)ze.toArray(c,i.array,(l+u)*3)}return P2(i,"vertex",r)}function RMe(e,t,r){let{groupCount:n,instanceCount:o,stride:i}=e,s=o*n,a=mo(Math.max(1,s),3,Uint8Array,r&&r.tColor.ref.value.array);for(e.reset();e.hasNext;){let{location:l,isSecondary:c,index:u}=e.move(),d=t(l,c);for(let m=0;m<i;++m)ze.toArray(d,a.array,(u+m)*3)}return P2(a,"vertexInstance",r)}function vte(e,t,r){let{colors:n,dimension:o,transform:i}=e,s=n.getWidth(),a=n.getHeight();return r?(G.update(r.tColorGrid,n),G.update(r.uColorTexDim,Ve.create(s,a)),G.update(r.uColorGridDim,D.clone(o)),G.update(r.uColorGridTransform,Ht.clone(i)),G.updateIfChanged(r.dColorType,t),r):{uColor:G.create(D()),tColor:G.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:G.create(n),tPalette:G.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:G.create(Ve.create(s,a)),uColorGridDim:G.create(D.clone(o)),uColorGridTransform:G.create(Ht.clone(i)),dColorType:G.create(t),dUsePalette:G.create(!1)}}function BMe(e){return e?(G.updateIfChanged(e.dColorType,"direct"),e):{uColor:G.create(D()),tColor:G.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:G.create(Ro()),tPalette:G.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:G.create(Ve.create(1,1)),uColorGridDim:G.create(D.create(1,1,1)),uColorGridTransform:G.create(Ht.create(0,0,0,1)),dColorType:G.create("direct"),dUsePalette:G.create(!1)}}var H5=D.transformMat4Offset,LMe=D.fromArray,f3=xt.add;function bte(){return{cellSize:0,cellCount:0,cellOffsets:new Uint32Array,cellSpheres:new Float32Array,cellTransform:new Float32Array,cellInstance:new Float32Array,batchSize:0,batchCount:0,batchOffsets:new Uint32Array,batchSpheres:new Float32Array,batchCell:new Uint32Array}}function xte(e,t,r){let n=NMe(e,t),o=FMe(n,r),i=new Uint32Array(n.cellOffsets.length),s=new Float32Array(n.cellSpheres.length),a=new Float32Array(n.cellInstance.length),l=0;for(let u=0,d=o.batchCell.length;u<d;++u){let m=o.batchCell[u],p=n.cellOffsets[m],f=n.cellOffsets[m+1]-p;i[u+1]=i[u]+f;for(let C=0;C<4;++C)s[u*4+C]=n.cellSpheres[m*4+C];for(let C=0;C<f;++C){let g=p+C,b=n.cellInstance[g];for(let y=0;y<16;++y)n.cellTransform[l*16+y]=e.transform[b*16+y];a[l]=b,l+=1}}return{cellSize:n.cellSize,cellCount:n.cellCount,cellOffsets:i,cellSpheres:s,cellTransform:n.cellTransform,cellInstance:a,batchSize:o.batchSize,batchCount:o.batchCount,batchOffsets:o.batchOffsets,batchSpheres:o.batchSpheres,batchCell:Rs(o.batchCell)}}function NMe(e,t){let{instanceCount:r,instance:n,transform:o,invariantBoundingSphere:i}=e,s=new Float32Array(r),a=new Float32Array(r),l=new Float32Array(r),c=Ge.ofBounds(0,r),u=xt.setEmpty(xt()),{center:d,radius:m}=i,p=D.create(m,m,m),h=D();for(let P=0;P<r;++P)H5(h,d,o,0,0,P*16),s[P]=h[0],a[P]=h[1],l[P]=h[2],f3(u,h);xt.expand(u,u,p);let f={x:s,y:a,z:l,indices:c},C={box:u,sphere:Pe.fromBox3D(Pe(),u)},g=Ma(f,C,D.create(t,t,t)),{array:b,offset:y,count:x}=g.buckets,A=y.length,v=new Uint32Array(A+1),_=new Float32Array(A*4),I=new Float32Array(r*16),T=new Float32Array(r),E=xt(),w=Pe(),S=0;for(let P=0;P<A;++P){let k=y[P],L=x[P];v[P]=k;let R=S;for(let N=k,F=k+L;N<F;++N){let H=b[N];T[S]=n[H];for(let V=0;V<16;++V)I[S*16+V]=o[H*16+V];S+=1}if(L===1)H5(_,d,I,P*4,0,R*16),_[P*4+3]=m;else{xt.setEmpty(E);let N=R*16;for(let F=0;F<L;++F)H5(h,d,I,0,0,F*16+N),f3(E,h);xt.expand(E,E,p),Pe.fromBox3D(w,E),Pe.toArray(w,_,P*4)}}return v[A]=y[A-1]+x[A-1],{cellSize:t,cellCount:A,cellOffsets:v,cellSpheres:_,cellTransform:I,cellInstance:T}}function FMe(e,t){let{cellCount:r,cellSpheres:n}=e,o=new Float32Array(r),i=new Float32Array(r),s=new Float32Array(r),a=Ge.ofBounds(0,r),l=xt.setEmpty(xt()),c=D(),u=0;for(let T=0;T<r;++T){let E=T*4;LMe(c,n,E),o[T]=c[0],i[T]=c[1],s[T]=c[2],f3(l,c),u=Math.max(u,n[E+3])}let d=D.create(u,u,u);xt.expand(l,l,d);let m={x:o,y:i,z:s,indices:a},p={box:l,sphere:Pe.fromBox3D(Pe(),l)},h=Ma(m,p,D.create(t,t,t)),{array:f,offset:C,count:g}=h.buckets,b=C.length,y=new Uint32Array(b+1),x=new Float32Array(b*4),A=new Uint32Array(r),v=xt(),_=Pe(),I=0;for(let T=0;T<b;++T){let E=C[T],w=g[T];y[T]=E;for(let S=E,P=E+w;S<P;++S)A[I]=f[S],I+=1;if(w===1){let S=f[E];x[T*4]=n[S*4],x[T*4+1]=n[S*4+1],x[T*4+2]=n[S*4+2],x[T*4+3]=n[S*4+3]}else{xt.setEmpty(v),u=0;for(let S=E,P=E+w;S<P;++S){let k=f[S];c[0]=n[k*4],c[1]=n[k*4+1],c[2]=n[k*4+2],f3(v,c),u=Math.max(u,n[k*4+3])}D.set(d,u,u,u),xt.expand(v,v,d),Pe.fromBox3D(_,v),Pe.toArray(_,x,T*4)}}return y[b]=C[b-1]+g[b-1],{batchSize:t,batchCount:b,batchOffsets:y,batchSpheres:x,batchCell:A}}var Cte=nr(),OMe=de();function VMe(e,t){for(let r=0;r<t;r++)if(nr.fromMat4(Cte,de.fromArray(OMe,e,r*16)),nr.determinant(Cte)<0)return!0;return!1}function D2(e,t,r,n,o,i){let s=VMe(e,t);if(i){G.update(i.matrix,i.matrix.ref.value);let a=i.transform.ref.value.length>=t*16?i.transform.ref.value:new Float32Array(t*16);a.set(e),G.update(i.transform,a),G.updateIfChanged(i.uInstanceCount,t),G.updateIfChanged(i.instanceCount,t);let l=i.aTransform.ref.value.length>=t*16?i.aTransform.ref.value:new Float32Array(t*16);G.update(i.aTransform,l);let c=i.extraTransform.ref.value.length>=t*16?i.extraTransform.ref.value:new Float32Array(t*16);G.update(i.extraTransform,sC(c,t));let u=i.aInstance.ref.value.length>=t?i.aInstance.ref.value:new Float32Array(t);G.update(i.aInstance,Rs(u,t)),G.update(i.hasReflection,s)}else i={aTransform:G.create(new Float32Array(t*16)),matrix:G.create(de.identity()),transform:G.create(new Float32Array(e)),extraTransform:G.create(sC(new Float32Array(t*16),t)),uInstanceCount:G.create(t),instanceCount:G.create(t),aInstance:G.create(Rs(new Float32Array(t))),hasReflection:G.create(s),instanceGrid:G.create(bte())};return $5(i,r,n,o),i}var j5=new Float32Array(16);de.toArray(de.identity(),j5,0);function aC(e){return D2(new Float32Array(j5),1,void 0,0,0,e)}function sC(e,t){for(let r=0;r<t;r++)e.set(j5,r*16);return e}function $5(e,t,r,n){let o=e.aTransform.ref.value,i=e.aInstance.ref.value,s=e.instanceCount.ref.value,a=e.matrix.ref.value,l=e.transform.ref.value,c=e.extraTransform.ref.value;for(let u=0;u<s;u++){let d=u*16;de.mulOffset(o,c,l,d,d,d),de.mulOffset(o,a,o,d,0,d),i[u]=u}if(t&&s>0){let u=xte({instanceCount:s,instance:i,transform:o,invariantBoundingSphere:t},r,n);G.update(e.instanceGrid,u),G.update(e.aInstance,u.cellInstance),G.update(e.aTransform,u.cellTransform)}else G.update(e.aInstance,i),G.update(e.aTransform,o)}var Dr={Atom:"Atom Property",Chain:"Chain Property",Residue:"Residue Property",Symmetry:"Symmetry",Validation:"Validation",Misc:"Miscellaneous"};var Ste=ze(13421772),GMe="Gives everything the same, uniform color.",sg={value:M.Color(Ste),saturation:M.Numeric(0,{min:-6,max:6,step:.1}),lightness:M.Numeric(0,{min:-6,max:6,step:.1})};function UMe(e){return sg}function Bp(e,t){let r=Qi(t.value,Ste);return r=ze.saturate(r,t.saturation),r=ze.lighten(r,t.lightness),{factory:Bp,granularity:"uniform",color:()=>r,props:t,description:GMe,legend:hl([["uniform",r]])}}var Ite={name:"uniform",label:"Uniform",category:Dr.Misc,factory:Bp,getParams:UMe,defaultValues:M.getDefaultValues(sg),isApplicable:e=>!0};var zMe="Gives everything the same, uniform size.",Ate={value:M.Numeric(1,{min:0,max:20,step:.1})};function HMe(e){return Ate}function h3(e,t){let r=t.value;return{factory:h3,granularity:"uniform",size:()=>r,props:t,description:zMe}}var wte={name:"uniform",label:"Uniform",category:"",factory:h3,getParams:HMe,defaultValues:M.getDefaultValues(Ate),isApplicable:e=>!0};function Bs(e){return{...Bs.Zero,...e}}(function(e){e.Zero={metalness:0,roughness:0,bumpiness:0};function t(o,i,s){return i[s]=o.metalness*255,i[s+1]=o.roughness*255,i[s+2]=o.bumpiness*255,i}e.toArray=t;function r({metalness:o,roughness:i,bumpiness:s}){return`M ${o.toFixed(2)} | R ${i.toFixed(2)} | B ${s.toFixed(2)}`}e.toString=r;function n(o){return M.Group({metalness:M.Numeric(0,{min:0,max:1,step:.01}),roughness:M.Numeric(1,{min:0,max:1,step:.01}),bumpiness:M.Numeric(0,{min:0,max:1,step:.01})},{...o,presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]})}e.getParam=n})(Bs||(Bs={}));function Lp(){}(function(e){e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},e.Params={variant:M.Select("pixel",M.arrayToOptions(["instance","pixel"])),objects:M.ObjectList({type:M.Select("plane",M.objectToOptions(e.Type,l=>Ms(l))),invert:M.Boolean(!1),position:M.Vec3(D()),rotation:M.Group({axis:M.Vec3(D.create(1,0,0)),angle:M.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:M.Vec3(D.create(1,1,1))},l=>Ms(l.type))};function t(l){return{count:0,type:new Array(l).fill(1),invert:new Array(l).fill(!1),position:new Array(l*3).fill(0),rotation:new Array(l*4).fill(0),scale:new Array(l*3).fill(1)}}let r=Tn(),n=Tn(),o=D(),i=D();function s(l,c){let u=l.objects.length,{type:d,invert:m,position:p,rotation:h,scale:f}=c?.objects||t(u);for(let C=0;C<u;++C){let g=l.objects[C];d[C]=e.Type[g.type],m[C]=g.invert,D.toArray(g.position,p,C*3),Tn.toArray(Tn.setAxisAngle(r,g.rotation.axis,Pr(g.rotation.angle)),h,C*4),D.toArray(g.scale,f,C*3)}return{variant:l.variant,objects:{count:u,type:d,invert:m,position:p,rotation:h,scale:f}}}e.getClip=s;function a(l,c){if(l.variant!==c.variant||l.objects.count!==c.objects.count)return!1;let u=l.objects,d=c.objects;for(let m=0,p=u.count;m<p;++m)if(u.invert[m]!==d.invert[m]||u.type[m]!==d.type[m]||(D.fromArray(o,u.position,m*3),D.fromArray(i,d.position,m*3),!D.equals(o,i))||(D.fromArray(o,u.scale,m*3),D.fromArray(i,d.scale,m*3),!D.equals(o,i))||(Tn.fromArray(r,u.rotation,m*4),Tn.fromArray(n,d.rotation,m*4),!Tn.equals(r,n)))return!1;return!0}e.areEqual=a})(Lp||(Lp={}));var jMe={custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}},$Me=Object.keys(jMe),ag=M.arrayToOptions($Me),g3={smoothColors:M.MappedStatic("auto",{auto:M.Group({}),on:M.Group({resolutionFactor:M.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:M.Numeric(3,{min:1,max:12,step:1})}),off:M.Group({})})};function Fu(e){return!!e.smoothColors}function rc(e,t,r){if((e.name==="on"||e.name==="auto"&&t)&&r&&r<3){let n=3;return e.name==="on"?(r*=e.params.resolutionFactor,n=e.params.sampleStride):(r*=2-IE(0,1.1,r),r=Math.max(.5,r),r>1.2&&(n=2)),{resolution:r,stride:n}}}var at;(function(e){e.MaterialCategory={category:"Material"},e.ShadingCategory={category:"Shading"},e.CullingLodCategory={category:"Culling & LOD"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:s=>typeof s.quality<"u"&&s.quality!=="custom"},e.Params={alpha:M.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:M.Select("auto",ag,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:Bs.getParam(),clip:M.Group(Lp.Params),emissive:M.Numeric(0,{min:0,max:1,step:.01}),instanceGranularity:M.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."}),lod:M.Vec3(D(),void 0,{...e.CullingLodCategory,description:"Level of detail.",fieldLabels:{x:"Min Distance",y:"Max Distance",z:"Overlap (Shader)"}}),cellSize:M.Numeric(200,{min:0,max:5e3,step:100},{...e.CullingLodCategory,description:"Instance grid cell size."}),batchSize:M.Numeric(2e3,{min:0,max:5e4,step:500},{...e.CullingLodCategory,description:"Instance grid batch size."})};function t(s=Gt.grey,a=1,l){l||(l=aC());let c=Mr(1,l.instanceCount.ref.value,1,()=>bs,!1,()=>!1),u={color:Bp({},{value:s,lightness:0,saturation:0}),size:h3({},{value:a})};return{transform:l,locationIterator:c,theme:u}}e.createSimple=t;function r(s,a){let l=Lp.getClip(s.clip);return{alpha:G.create(s.alpha),uAlpha:G.create(s.alpha),uVertexCount:G.create(a.vertexCount),uGroupCount:G.create(a.groupCount),drawCount:G.create(a.drawCount),uMetalness:G.create(s.material.metalness),uRoughness:G.create(s.material.roughness),uBumpiness:G.create(s.material.bumpiness),uEmissive:G.create(s.emissive),dLightCount:G.create(1),dColorMarker:G.create(!0),dClipObjectCount:G.create(l.objects.count),dClipVariant:G.create(l.variant),uClipObjectType:G.create(l.objects.type),uClipObjectInvert:G.create(l.objects.invert),uClipObjectPosition:G.create(l.objects.position),uClipObjectRotation:G.create(l.objects.rotation),uClipObjectScale:G.create(l.objects.scale),instanceGranularity:G.create(s.instanceGranularity),uLod:G.create(Ht.create(s.lod[0],s.lod[1],s.lod[2],0))}}e.createValues=r;function n(s,a){G.updateIfChanged(s.alpha,a.alpha),G.updateIfChanged(s.uMetalness,a.material.metalness),G.updateIfChanged(s.uRoughness,a.material.roughness),G.updateIfChanged(s.uBumpiness,a.material.bumpiness),G.updateIfChanged(s.uEmissive,a.emissive);let l=Lp.getClip(a.clip);G.updateIfChanged(s.dClipObjectCount,l.objects.count),G.updateIfChanged(s.dClipVariant,l.variant),G.update(s.uClipObjectType,l.objects.type),G.update(s.uClipObjectInvert,l.objects.invert),G.update(s.uClipObjectPosition,l.objects.position),G.update(s.uClipObjectRotation,l.objects.rotation),G.update(s.uClipObjectScale,l.objects.scale),G.updateIfChanged(s.instanceGranularity,a.instanceGranularity),G.update(s.uLod,Ht.set(s.uLod.ref.value,a.lod[0],a.lod[1],a.lod[2],0))}e.updateValues=n;function o(s={}){let a=s.alpha===void 0?!0:s.alpha===1;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:a,writeDepth:a}}e.createRenderableState=o;function i(s,a){s.opaque=a.alpha*s.alphaFactor>=1,s.writeDepth=s.opaque}e.updateRenderableState=i})(at||(at={}));function Tte(e,t,r,n){for(let o=t;o<r;++o)ze.toArray(n,e,o*4),e[o*4+3]=255;return!0}function W5(e,t,r){return e.fill(0,t*4,r*4),!0}function Ete(e,t,r){let n=mo(Math.max(1,e),4,Uint8Array,r&&r.tOverpaint.ref.value.array);return r?(G.update(r.tOverpaint,n),G.update(r.uOverpaintTexDim,Ve.create(n.width,n.height)),G.updateIfChanged(r.dOverpaint,e>0),G.updateIfChanged(r.dOverpaintType,t),r):{tOverpaint:G.create(n),uOverpaintTexDim:G.create(Ve.create(n.width,n.height)),dOverpaint:G.create(e>0),tOverpaintGrid:G.create(Ro()),uOverpaintGridDim:G.create(D.create(1,1,1)),uOverpaintGridTransform:G.create(Ht.create(0,0,0,1)),dOverpaintType:G.create(t),uOverpaintStrength:G.create(1)}}var _te={array:new Uint8Array(4),width:1,height:1};function yl(e){return e?(G.update(e.tOverpaint,_te),G.update(e.uOverpaintTexDim,Ve.create(1,1)),e):{tOverpaint:G.create(_te),uOverpaintTexDim:G.create(Ve.create(1,1)),dOverpaint:G.create(!1),tOverpaintGrid:G.create(Ro()),uOverpaintGridDim:G.create(D.create(1,1,1)),uOverpaintGridTransform:G.create(Ht.create(0,0,0,1)),dOverpaintType:G.create("groupInstance"),uOverpaintStrength:G.create(1)}}function Dte(e,t,r,n){for(let o=t;o<r;++o)e[o]=n*255;return!0}function q5(e,t){if(t===0||e.length<t)return 0;let r=0;for(let n=0;n<t;++n)r+=e[n];return r/(255*t)}function kte(e,t,r){e.fill(0,t,r)}function Mte(e,t,r){let n=mo(Math.max(1,e),1,Uint8Array,r&&r.tTransparency.ref.value.array);return r?(G.update(r.tTransparency,n),G.update(r.uTransparencyTexDim,Ve.create(n.width,n.height)),G.updateIfChanged(r.dTransparency,e>0),G.updateIfChanged(r.transparencyAverage,q5(n.array,e)),G.updateIfChanged(r.dTransparencyType,t),r):{tTransparency:G.create(n),uTransparencyTexDim:G.create(Ve.create(n.width,n.height)),dTransparency:G.create(e>0),transparencyAverage:G.create(0),tTransparencyGrid:G.create(Ro()),uTransparencyGridDim:G.create(D.create(1,1,1)),uTransparencyGridTransform:G.create(Ht.create(0,0,0,1)),dTransparencyType:G.create(t),uTransparencyStrength:G.create(1)}}var Pte={array:new Uint8Array(1),width:1,height:1};function vl(e){return e?(G.update(e.tTransparency,Pte),G.update(e.uTransparencyTexDim,Ve.create(1,1)),e):{tTransparency:G.create(Pte),uTransparencyTexDim:G.create(Ve.create(1,1)),dTransparency:G.create(!1),transparencyAverage:G.create(0),tTransparencyGrid:G.create(Ro()),uTransparencyGridDim:G.create(D.create(1,1,1)),uTransparencyGridTransform:G.create(Ht.create(0,0,0,1)),dTransparencyType:G.create("groupInstance"),uTransparencyStrength:G.create(1)}}function Bte(e,t,r,n){return e.fill(n,t,r),!0}function Lte(e,t,r){e.fill(0,t,r)}function Nte(e,t,r){let n=mo(Math.max(1,e),1,Uint8Array,r&&r.tClipping.ref.value.array);return r?(G.update(r.tClipping,n),G.update(r.uClippingTexDim,Ve.create(n.width,n.height)),G.updateIfChanged(r.dClipping,e>0),G.updateIfChanged(r.dClippingType,t),r):{tClipping:G.create(n),uClippingTexDim:G.create(Ve.create(n.width,n.height)),dClipping:G.create(e>0),dClippingType:G.create(t)}}var Rte={array:new Uint8Array(1),width:1,height:1};function bl(e){return e?(G.update(e.tClipping,Rte),G.update(e.uClippingTexDim,Ve.create(1,1)),G.updateIfChanged(e.dClipping,!1),e):{tClipping:G.create(Rte),uClippingTexDim:G.create(Ve.create(1,1)),dClipping:G.create(!1),dClippingType:G.create("groupInstance")}}function Ote(e,t,r,n){for(let o=t;o<r;++o)Bs.toArray(n,e,o*4),e[o*4+3]=255;return!0}function Z5(e,t,r){return e.fill(0,t*4,r*4),!0}function Vte(e,t,r){let n=mo(Math.max(1,e),4,Uint8Array,r&&r.tSubstance.ref.value.array);return r?(G.update(r.tSubstance,n),G.update(r.uSubstanceTexDim,Ve.create(n.width,n.height)),G.updateIfChanged(r.dSubstance,e>0),G.updateIfChanged(r.dSubstanceType,t),r):{tSubstance:G.create(n),uSubstanceTexDim:G.create(Ve.create(n.width,n.height)),dSubstance:G.create(e>0),tSubstanceGrid:G.create(Ro()),uSubstanceGridDim:G.create(D.create(1,1,1)),uSubstanceGridTransform:G.create(Ht.create(0,0,0,1)),dSubstanceType:G.create(t),uSubstanceStrength:G.create(1)}}var Fte={array:new Uint8Array(4),width:1,height:1};function xl(e){return e?(G.update(e.tSubstance,Fte),G.update(e.uSubstanceTexDim,Ve.create(1,1)),e):{tSubstance:G.create(Fte),uSubstanceTexDim:G.create(Ve.create(1,1)),dSubstance:G.create(!1),tSubstanceGrid:G.create(Ro()),uSubstanceGridDim:G.create(D.create(1,1,1)),uSubstanceGridTransform:G.create(Ht.create(0,0,0,1)),dSubstanceType:G.create("groupInstance"),uSubstanceStrength:G.create(1)}}function Ute(e,t,r,n){for(let o=t;o<r;++o)e[o]=n*255;return!0}function K5(e,t){if(t===0||e.length<t)return 0;let r=0;for(let n=0;n<t;++n)r+=e[n];return r/(255*t)}function zte(e,t,r){e.fill(0,t,r)}function Hte(e,t,r){let n=mo(Math.max(1,e),1,Uint8Array,r&&r.tEmissive.ref.value.array);return r?(G.update(r.tEmissive,n),G.update(r.uEmissiveTexDim,Ve.create(n.width,n.height)),G.updateIfChanged(r.dEmissive,e>0),G.updateIfChanged(r.emissiveAverage,K5(n.array,e)),G.updateIfChanged(r.dEmissiveType,t),r):{tEmissive:G.create(n),uEmissiveTexDim:G.create(Ve.create(n.width,n.height)),dEmissive:G.create(e>0),emissiveAverage:G.create(0),tEmissiveGrid:G.create(Ro()),uEmissiveGridDim:G.create(D.create(1,1,1)),uEmissiveGridTransform:G.create(Ht.create(0,0,0,1)),dEmissiveType:G.create(t),uEmissiveStrength:G.create(1)}}var Gte={array:new Uint8Array(1),width:1,height:1};function Cl(e){return e?(G.update(e.tEmissive,Gte),G.update(e.uEmissiveTexDim,Ve.create(1,1)),e):{tEmissive:G.create(Gte),uEmissiveTexDim:G.create(Ve.create(1,1)),dEmissive:G.create(!1),emissiveAverage:G.create(0),tEmissiveGrid:G.create(Ro()),uEmissiveGridDim:G.create(D.create(1,1,1)),uEmissiveGridTransform:G.create(Ht.create(0,0,0,1)),dEmissiveType:G.create("groupInstance"),uEmissiveStrength:G.create(1)}}var Ct;(function(e){function t(w,S,P,k,L,R,N){return N?i(w,S,P,k,L,R,N):o(w,S,P,k,L,R)}e.create=t;function r(w){let S=w?w.vertexBuffer.ref.value:new Float32Array(0),P=w?w.indexBuffer.ref.value:new Uint32Array(0),k=w?w.normalBuffer.ref.value:new Float32Array(0),L=w?w.groupBuffer.ref.value:new Float32Array(0);return t(S,P,k,L,0,0,w)}e.createEmpty=r;function n(w){return di([w.vertexCount,w.triangleCount,w.vertexBuffer.ref.version,w.indexBuffer.ref.version,w.normalBuffer.ref.version,w.groupBuffer.ref.version])}function o(w,S,P,k,L,R){let N=Pe(),F,H=-1,V=-1,q={kind:"mesh",vertexCount:L,triangleCount:R,vertexBuffer:G.create(w),indexBuffer:G.create(S),normalBuffer:G.create(P),groupBuffer:G.create(k),varyingGroup:G.create(!1),get boundingSphere(){let Q=n(q);if(Q!==H){let O=Nu(q.vertexBuffer.ref.value,q.vertexCount,1);Pe.copy(N,O),H=Q}return N},get groupMapping(){return q.groupBuffer.ref.version!==V&&(F=dm(q.groupBuffer.ref.value,q.vertexCount),V=q.groupBuffer.ref.version),F},setBoundingSphere(Q){Pe.copy(N,Q),H=n(q)},meta:{}};return q}function i(w,S,P,k,L,R,N){return N.vertexCount=L,N.triangleCount=R,G.update(N.vertexBuffer,w),G.update(N.indexBuffer,S),G.update(N.normalBuffer,P),G.update(N.groupBuffer,k),N}function s(w){let{vertexCount:S,triangleCount:P}=w,k=w.vertexBuffer.ref.value,L=w.indexBuffer.ref.value,R=w.normalBuffer.ref.value.length>=S*3?w.normalBuffer.ref.value:new Float32Array(S*3);R===w.normalBuffer.ref.value&&R.fill(0,0,S*3),n3(k,L,R,S,P),G.update(w.normalBuffer,R)}e.computeNormals=s;function a(w,S=3){let P=w.vertexBuffer.ref.value,k=new Map,L=(F,H)=>`${F[0].toFixed(H)}|${F[1].toFixed(H)}|${F[2].toFixed(H)}`,R=0,N=D();for(let F=0,H=w.vertexCount;F<H;++F){D.fromArray(N,P,F*3);let V=L(N,S),q=k.get(V);q!==void 0?(R+=1,k.set(V,q+1)):k.set(V,1)}return R}e.checkForDuplicateVertices=a;let l=nr();function c(w,S){let P=w.vertexBuffer.ref.value;if(um(S,P,0,w.vertexCount),!de.isTranslationAndUniformScaling(S)){let k=nr.directionTransform(l,S);LQ(k,w.normalBuffer.ref.value,0,w.vertexCount)}G.update(w.vertexBuffer,P)}e.transform=c;function u(w){let{originalData:S}="kind"in w?w.meta:w.meta.ref.value;return S}e.getOriginalData=u;function d(w,S=!0){let{indexBuffer:P,vertexBuffer:k,groupBuffer:L,normalBuffer:R,triangleCount:N,vertexCount:F}=w,H=P.ref.value,V=k.ref.value,q=L.ref.value,Q=R.ref.value,O=it.create(Uint32Array,3,1024,N),B=it.create(Float32Array,3,1024,V);B.currentIndex=F*3,B.elementCount=F;let j=it.create(Float32Array,3,1024,Q);j.currentIndex=F*3,j.elementCount=F;let U=it.create(Float32Array,1,1024,q);U.currentIndex=F,U.elementCount=F;let z=D(),$=D(),Z=D(),J=D(),ie=D(),ne=D();function le(Y){D.fromArray(z,V,Y*3),D.fromArray(J,Q,Y*3),it.add3(B,z[0],z[1],z[2]),it.add3(j,J[0],J[1],J[2])}function ee(Y,ae){D.fromArray(z,V,Y*3),D.fromArray($,V,ae*3),D.scale(z,D.add(z,z,$),.5),D.fromArray(J,Q,Y*3),D.fromArray(ie,Q,ae*3),D.scale(J,D.add(J,J,ie),.5),it.add3(B,z[0],z[1],z[2]),it.add3(j,J[0],J[1],J[2])}function oe(Y,ae,ve){D.fromArray(z,V,Y*3),D.fromArray($,V,ae*3),D.fromArray(Z,V,ve*3),D.scale(z,D.add(z,D.add(z,z,$),Z),1/3),D.fromArray(J,Q,Y*3),D.fromArray(ie,Q,ae*3),D.fromArray(ne,Q,ve*3),D.scale(J,D.add(J,D.add(J,J,ie),ne),1/3),it.add3(B,z[0],z[1],z[2]),it.add3(j,J[0],J[1],J[2])}function te(Y,ae,ve,ge,Se){++W,le(Y),ee(Y,ae),ee(Y,ve),it.add3(O,X,X+1,X+2);for(let Ee=0;Ee<3;++Ee)it.add(U,ge);X+=3,W+=2,le(ae),le(ve),ee(Y,ae),ee(Y,ve),it.add3(O,X,X+1,X+3),it.add3(O,X,X+3,X+2);for(let Ee=0;Ee<4;++Ee)it.add(U,Se);X+=4}let X=F,W=0;if(S)for(let Y=0,ae=N;Y<ae;++Y){let ve=H[Y*3],ge=H[Y*3+1],Se=H[Y*3+2],Ee=q[ve],Fe=q[ge],Ae=q[Se];if(Ee===Fe&&Ee===Ae)++W,it.add3(O,ve,ge,Se);else if(Ee===Fe)te(Se,ve,ge,Ae,Ee);else if(Ee===Ae)te(ge,Se,ve,Fe,Ae);else if(Fe===Ae)te(ve,ge,Se,Ee,Fe);else{W+=2,le(ve),ee(ve,ge),ee(ve,Se),oe(ve,ge,Se),it.add3(O,X,X+1,X+3),it.add3(O,X,X+3,X+2);for(let we=0;we<4;++we)it.add(U,Ee);X+=4,W+=2,le(ge),ee(ge,Se),ee(ge,ve),oe(ve,ge,Se),it.add3(O,X,X+1,X+3),it.add3(O,X,X+3,X+2);for(let we=0;we<4;++we)it.add(U,Fe);X+=4,W+=2,le(Se),ee(Se,ge),ee(Se,ve),oe(ve,ge,Se),it.add3(O,X+3,X+1,X),it.add3(O,X+2,X+3,X);for(let we=0;we<4;++we)it.add(U,Ae);X+=4}}else for(let Y=0,ae=N;Y<ae;++Y){let ve=H[Y*3],ge=H[Y*3+1],Se=H[Y*3+2],Ee=q[ve],Fe=q[ge],Ae=q[Se];if(Ee!==Fe||Ee!==Ae){++W,le(ve),le(ge),le(Se),it.add3(O,X,X+1,X+2);let we=Fe===Ae?Fe:Ee;for(let _e=0;_e<3;++_e)it.add(U,we);X+=3}else++W,it.add3(O,ve,ge,Se)}let K=it.compact(O),re=it.compact(B),se=it.compact(j),me=it.compact(U);return w.vertexCount=X,w.triangleCount=W,G.update(k,re),G.update(L,me),G.update(P,K),G.update(R,se),w.meta.originalData={indexBuffer:H,vertexCount:F,triangleCount:N},w}e.uniformTriangleGroup=d;function m(w){let{vertexCount:S,triangleCount:P}=w,k=w.indexBuffer.ref.value,L=[];for(let R=0;R<S;++R)L[R]=[];for(let R=0;R<P;++R){let N=k[R*3],F=k[R*3+1],H=k[R*3+2];Ho(L[N],F),Ho(L[N],H),Ho(L[F],N),Ho(L[F],H),Ho(L[H],N),Ho(L[H],F)}return L}function p(w){let{triangleCount:S}=w,P=w.indexBuffer.ref.value,k=new Map,L=(R,N)=>{let F=h0(R,N),H=k.get(F)||0;k.set(F,H+1)};for(let R=0;R<S;++R){let N=P[R*3],F=P[R*3+1],H=P[R*3+2];L(N,F),L(N,H),L(F,H)}return k}function h(w){let S=new Set,P=[0,0];return w.forEach((k,L)=>{k===1&&(BE(P,L),S.add(P[0]),S.add(P[1]))}),S}function f(w,S,P){let k=new Map,L=(R,N)=>{k.has(R)?Ho(k.get(R),N):k.set(R,[N])};return S.forEach(R=>{let N=w[R];for(let F of N)S.has(F)&&P.get(h0(R,F))===1&&L(R,F)}),k}function C(w,S){let{indexBuffer:P,triangleCount:k}=w,L=P.ref.value,R=it.create(Uint32Array,3,1024,k),N=0;for(let H=0;H<k;++H){let V=L[H*3],q=L[H*3+1],Q=L[H*3+2];S[V].length===2||S[q].length===2||S[Q].length===2||(it.add3(R,V,q,Q),N+=1)}let F=it.compact(R);return w.triangleCount=N,G.update(P,F),w}function g(w,S,P,k){var L;let{vertexBuffer:R,indexBuffer:N,normalBuffer:F,triangleCount:H}=w,V=R.ref.value,q=N.ref.value,Q=F.ref.value,O=it.create(Uint32Array,3,1024,H),B=0;for(let K=0;K<H;++K)it.add3(O,q[K*3],q[K*3+1],q[K*3+2]),B+=1;let j=D(),U=D(),z=D(),$=D(),Z=D(),J=D(),ie=D(),ne=D(),le=D(),ee=D(),oe=Pr(120),te=new Set,X=Array.from(P.keys()).filter(K=>P.get(K).length<2).map(K=>{let re=P.get(K);return D.fromArray(j,V,K*3),D.fromArray(U,V,re[0]*3),D.fromArray(z,V,re[1]*3),D.sub(Z,U,j),D.sub(J,z,j),[K,D.angle(Z,J)]});X.sort(([,K],[,re])=>K-re);for(let[K,re]of X){if(te.has(K)||re>oe)continue;let se=P.get(K);if(S[se[0]].includes(se[1])&&!(!((L=P.get(se[0]))===null||L===void 0)&&L.includes(se[1]))||(D.fromArray(j,V,K*3),D.fromArray(U,V,se[0]*3),D.fromArray(z,V,se[1]*3),D.sub(Z,U,j),D.sub(J,z,j),D.add(ne,Z,J),D.squaredDistance(j,U)>=k))continue;let me=!1;for(let Y of S[K])if(!se.includes(Y)&&(D.fromArray($,V,Y*3),D.sub(ie,$,j),D.dot(ne,ie)<0)){me=!0;break}me&&(D.fromArray(le,Q,K*3),D.triangleNormal(ee,j,U,z),D.dot(ee,le)>0?it.add3(O,K,se[0],se[1]):it.add3(O,se[1],se[0],K),te.add(K),te.add(se[0]),te.add(se[1]),B+=1)}let W=it.compact(O);return w.triangleCount=B,G.update(N,W),w}function b(w,S,P){let{iterations:k,lambda:L}=P,R=D(),N=D(),F=D(),H=D(),V=-L,q=new Float32Array(w.vertexBuffer.ref.value.length),Q=O=>{let B=w.vertexBuffer.ref.value;q.set(B),S.forEach((U,z)=>{if(U.length!==2)return;D.fromArray(R,B,z*3),D.fromArray(N,B,U[0]*3),D.fromArray(F,B,U[1]*3);let $=1/D.distance(R,N),Z=1/D.distance(R,F);D.scale(N,N,$),D.scale(F,F,Z),D.add(H,N,F),D.scale(H,H,1/($+Z)),D.sub(H,H,R),D.scale(H,H,O),D.add(H,R,H),D.toArray(H,q,z*3)});let j=w.vertexBuffer.ref.value;G.update(w.vertexBuffer,q),q=j};for(let O=0;O<k;++O)Q(L),Q(V)}function y(w,S){C(w,m(w));for(let N=0;N<10;++N){let F=w.triangleCount,H=p(w),V=m(w),q=h(H),Q=f(V,q,H);if(g(w,V,Q,S.maxNewEdgeLength*S.maxNewEdgeLength),w.triangleCount===F)break}let P=p(w),k=m(w),L=h(P),R=f(k,L,P);return b(w,R,{iterations:S.iterations,lambda:.5}),w}e.smoothEdges=y,e.Params={...at.Params,doubleSided:M.Boolean(!1,at.CustomQualityParamInfo),flipSided:M.Boolean(!1,at.ShadingCategory),flatShaded:M.Boolean(!1,at.ShadingCategory),ignoreLight:M.Boolean(!1,at.ShadingCategory),xrayShaded:M.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],at.ShadingCategory),transparentBackfaces:M.Select("off",M.arrayToOptions(["off","on","opaque"]),at.ShadingCategory),bumpFrequency:M.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),bumpAmplitude:M.Numeric(1,{min:0,max:5,step:.1},at.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:r,createValues:A,createValuesSimple:v,updateValues:_,updateBoundingSphere:I,createRenderableState:T,updateRenderableState:E,createPositionIterator:x};function x(w,S){let P=w.vertexCount,k=S.instanceCount.ref.value,L=Ic(),R=L.position,N=L.normal,F=w.vertexBuffer.ref.value,H=w.normalBuffer.ref.value,V=S.aTransform.ref.value;return Mr(P,k,1,(Q,O)=>(O<0?(D.fromArray(R,F,Q*3),D.fromArray(N,H,Q*3)):(D.transformMat4Offset(R,F,V,0,Q*3,O*16),D.transformDirectionOffset(N,H,V,0,Q*3,O*16)),L))}function A(w,S,P,k,L){let{instanceCount:R,groupCount:N}=P,F=x(w,S),H=$i(P,F,k.color),V=L.instanceGranularity?to(R,"instance"):to(R*N,"groupInstance"),q=yl(),Q=vl(),O=Cl(),B=xl(),j=bl(),U={drawCount:w.triangleCount*3,vertexCount:w.vertexCount,groupCount:N,instanceCount:R},z=Pe.clone(w.boundingSphere),$=xi(z,S.aTransform.ref.value,R,0);return{dGeometryType:G.create("mesh"),aPosition:w.vertexBuffer,aNormal:w.normalBuffer,aGroup:w.groupBuffer,elements:w.indexBuffer,dVaryingGroup:w.varyingGroup,boundingSphere:G.create($),invariantBoundingSphere:G.create(z),uInvariantBoundingSphere:G.create(Ht.ofSphere(z)),...H,...V,...q,...Q,...O,...B,...j,...S,...at.createValues(L,U),uDoubleSided:G.create(L.doubleSided),dFlatShaded:G.create(L.flatShaded),dFlipSided:G.create(L.flipSided),dIgnoreLight:G.create(L.ignoreLight),dXrayShaded:G.create(L.xrayShaded==="inverted"?"inverted":L.xrayShaded===!0?"on":"off"),dTransparentBackfaces:G.create(L.transparentBackfaces),uBumpFrequency:G.create(L.bumpFrequency),uBumpAmplitude:G.create(L.bumpAmplitude),meta:G.create(w.meta)}}function v(w,S,P,k,L){let R=at.createSimple(P,k,L),N={...M.getDefaultValues(e.Params),...S};return A(w,R.transform,R.locationIterator,R.theme,N)}function _(w,S){at.updateValues(w,S),G.updateIfChanged(w.uDoubleSided,S.doubleSided),G.updateIfChanged(w.dFlatShaded,S.flatShaded),G.updateIfChanged(w.dFlipSided,S.flipSided),G.updateIfChanged(w.dIgnoreLight,S.ignoreLight),G.updateIfChanged(w.dXrayShaded,S.xrayShaded==="inverted"?"inverted":S.xrayShaded===!0?"on":"off"),G.updateIfChanged(w.dTransparentBackfaces,S.transparentBackfaces),G.updateIfChanged(w.uBumpFrequency,S.bumpFrequency),G.updateIfChanged(w.uBumpAmplitude,S.bumpAmplitude)}function I(w,S){let P=Pe.clone(S.boundingSphere),k=xi(P,w.aTransform.ref.value,w.instanceCount.ref.value,0);Pe.equals(k,w.boundingSphere.ref.value)||G.update(w.boundingSphere,k),Pe.equals(P,w.invariantBoundingSphere.ref.value)||(G.update(w.invariantBoundingSphere,P),G.update(w.uInvariantBoundingSphere,Ht.fromSphere(w.uInvariantBoundingSphere.ref.value,P)))}function T(w){let S=at.createRenderableState(w);return E(S,w),S}function E(w,S){at.updateRenderableState(w,S),w.opaque=w.opaque&&!S.xrayShaded,w.writeDepth=w.opaque}})(Ct||(Ct={}));var WMe={radius:1,detail:0};function jte(e,t,r){let{radius:n,detail:o}={...WMe,...r},i=qMe(),{vertices:s,indices:a}=i;c(o),NQ(s,n);let l=new Float32Array(s.length);return n3(s,a,l,s.length/3,a.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(a)};function c(d){let m=D(),p=D(),h=D();for(let f=0;f<t.length;f+=3)D.fromArray(m,e,t[f+0]*3),D.fromArray(p,e,t[f+1]*3),D.fromArray(h,e,t[f+2]*3),u(m,p,h,d)}function u(d,m,p,h){let f=Math.pow(2,h),C=[];for(let g=0;g<=f;++g){C[g]=[];let b=D();D.lerp(b,d,p,g/f);let y=D();D.lerp(y,m,p,g/f);let x=f-g;for(let A=0;A<=x;++A)if(A===0&&g===f)C[g][A]=b;else{let v=D();D.lerp(v,b,y,A/x),C[g][A]=v}}for(let g=0;g<f;++g)for(let b=0;b<2*(f-g)-1;++b){let y=Math.floor(b/2);b%2===0?i.add(C[g][y+1],C[g+1][y],C[g][y]):i.add(C[g][y+1],C[g+1][y+1],C[g+1][y])}}}function qMe(){let e=[],t=[],r=new Map;function n(o){let i=`${o[0].toFixed(5)}|${o[1].toFixed(5)}|${o[2].toFixed(5)}`,s=r.get(i);return s===void 0&&(s=e.length/3,r.set(i,s),e.push(...o)),s}return{vertices:e,indices:t,add:(o,i,s)=>{t.push(n(o),n(i),n(s))}}}var $te=D(),Wte=D(),qte=D();function Ab(e,t){let r=t.length,n=Np(r/3);for(let o=0;o<r;o+=3)D.fromArray($te,e,t[o]*3),D.fromArray(Wte,e,t[o+1]*3),D.fromArray(qte,e,t[o+2]*3),n.add($te,Wte,qte);return n.getPrimitive()}var y3=D();function Np(e,t){t===void 0&&(t=e*3);let r=new Float32Array(t*3),n=new Float32Array(t*3),o=new Uint32Array(e*3),i=0,s=0;return{add:(a,l,c)=>{D.toArray(a,r,i),D.toArray(l,r,i+3),D.toArray(c,r,i+6),D.triangleNormal(y3,a,l,c);for(let u=0;u<3;++u)D.toArray(y3,n,i+3*u),o[s+u]=i/3+u;i+=9,s+=3},addQuad:(a,l,c,u)=>{D.toArray(a,r,i),D.toArray(l,r,i+3),D.toArray(c,r,i+6),D.toArray(u,r,i+9),D.triangleNormal(y3,a,l,c);for(let m=0;m<4;++m)D.toArray(y3,n,i+3*m);let d=i/3;o[s]=d,o[s+1]=d+1,o[s+2]=d+2,o[s+3]=d+2,o[s+4]=d+3,o[s+5]=d,i+=12,s+=6},getPrimitive:()=>({vertices:r,normals:n,indices:o})}}var lC=D(),ZMe=nr();function cC(e,t){let{vertices:r,normals:n}=e,o=nr.directionTransform(ZMe,t);for(let i=0,s=r.length;i<s;i+=3)D.transformMat4(lC,D.fromArray(lC,r,i),t),D.toArray(lC,r,i),D.transformMat3(lC,D.fromArray(lC,n,i),o),D.toArray(lC,n,i);return e}function Nf(e,t){return{vertices:e,edges:t}}function Y5(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}var X5=D.zero();function Q5(e,t){let{vertices:r}=e;for(let n=0,o=r.length;n<o;n+=3)D.transformMat4(X5,D.fromArray(X5,r,n),t),D.toArray(X5,r,n);return e}var pm=(1+Math.sqrt(5))/2,Zte=[-1,pm,0,1,pm,0,-1,-pm,0,1,-pm,0,0,-1,pm,0,1,pm,0,-1,-pm,0,1,-pm,pm,0,-1,pm,0,1,-pm,0,-1,-pm,0,1],KMe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],XMe=[0,11,5,11,0,5,1,5,0,1,1,7,0,7,7,10,0,10,10,11,5,9,4,11,2,10,6,7,1,8,3,9,4,9,3,4,2,4,2,3,2,6,3,6,6,8,3,8,8,9,4,5,2,11,6,10,7,8,1,9],J5;function Kte(){return J5||(J5=Ab(Zte,KMe)),J5}var h2t=Nf(Zte,XMe);var{vertices:YMe,indices:QMe}=Kte();function Fp(e){return 10*Math.pow(Math.pow(2,e),2)+2}function Xte(e){return jte(YMe,QMe,{detail:e,radius:1})}var Yte=new Map,JMe=de.identity();function eRe(e,t,r){return de.scaleUniformly(e,de.fromTranslation(e,t),r)}function eV(e){let t=Yte.get(e);return t===void 0&&(t=Xte(e),Yte.set(e,t)),t}function Rr(e,t,r,n){gt.addPrimitive(e,eRe(JMe,t,r),eV(n))}var Op={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:Math.PI*2};function Qte(e){let{radiusTop:t,radiusBottom:r,height:n,radialSegments:o,heightSegments:i,topCap:s,bottomCap:a,thetaStart:l,thetaLength:c}={...Op,...e},u=[],d=[],m=[],p=0,h=[],f=n/2;return C(),s&&t>0&&g(!0),a&&r>0&&g(!1),{vertices:new Float32Array(d),normals:new Float32Array(m),indices:new Uint32Array(u)};function C(){let b=D.zero(),y=(r-t)/n;for(let x=0;x<=i;++x){let A=[],v=x/i,_=v*(r-t)+t;for(let I=0;I<=o;++I){let E=I/o*c+l,w=Math.sin(E),S=Math.cos(E);d.push(_*w,-v*n+f,_*S),D.normalize(b,D.set(b,w,y,S)),m.push(...b),A.push(p++)}h.push(A)}for(let x=0;x<o;++x)for(let A=0;A<i;++A){let v=h[A][x],_=h[A+1][x],I=h[A+1][x+1],T=h[A][x+1];u.push(v,_,T),u.push(_,I,T)}}function g(b){let y=b===!0?t:r,x=b===!0?1:-1,A=p;for(let _=1;_<=o;++_)d.push(0,f*x,0),m.push(0,x,0),++p;let v=p;for(let _=0;_<=o;++_){let T=_/o*c+l,E=Math.cos(T),w=Math.sin(T);d.push(y*w,f*x,y*E),m.push(0,x,0),++p}for(let _=0;_<o;++_){let I=A+_,T=v+_;b===!0?u.push(T,T+1,I):u.push(T+1,T,I)}}}function nc(e,t,r=-1){let n=new Float32Array(e*3),o=r===-1?e<=4?Math.sqrt(2)/2:.6:r,i=t?1:0;for(let s=0,a=e;s<a;++s){let l=(s*2+i)/e*Math.PI;n[s*3]=Math.cos(l)*o,n[s*3+1]=Math.sin(l)*o,n[s*3+2]=0}return n}var Jte=D(),ere=D(),Ou=D(),Vu=D(),Ff=D(),uC=D(),tRe={height:1,topCap:!0,bottomCap:!0};function wb(e,t){let r=e.length/3;if(r<3)throw new Error("need at least 3 points to build a prism");let{height:n,topCap:o,bottomCap:i}={...tRe,...t},s=r*2,a=r*4,l=(o?1:0)+(i?1:0);r===3?(s+=l,a+=l*3):r===4?(s+=l*2,a+=l*4):(s+=l*r,a+=l*r*3);let c=Np(s,a),u=n*.5;D.set(Jte,0,0,-u),D.set(ere,0,0,u);for(let d=0;d<r;++d){let m=(d+1)%r;D.set(Ou,e[d*3],e[d*3+1],-u),D.set(Vu,e[m*3],e[m*3+1],-u),D.set(Ff,e[m*3],e[m*3+1],u),D.set(uC,e[d*3],e[d*3+1],u),c.addQuad(Ou,Vu,Ff,uC)}if(r===3)o&&(D.set(Ou,e[0],e[1],-u),D.set(Vu,e[3],e[4],-u),D.set(Ff,e[6],e[7],-u),c.add(Ff,Vu,Ou)),i&&(D.set(Ou,e[0],e[1],u),D.set(Vu,e[3],e[4],u),D.set(Ff,e[6],e[7],u),c.add(Ou,Vu,Ff));else if(r===4)o&&(D.set(Ou,e[0],e[1],-u),D.set(Vu,e[3],e[4],-u),D.set(Ff,e[6],e[7],-u),D.set(uC,e[9],e[10],-u),c.addQuad(uC,Ff,Vu,Ou)),i&&(D.set(Ou,e[0],e[1],u),D.set(Vu,e[3],e[4],u),D.set(Ff,e[6],e[7],u),D.set(uC,e[9],e[10],u),c.addQuad(Ou,Vu,Ff,uC));else for(let d=0;d<r;++d){let m=(d+1)%r;o&&(D.set(Ou,e[d*3],e[d*3+1],-u),D.set(Vu,e[m*3],e[m*3+1],-u),c.add(Jte,Vu,Ou)),i&&(D.set(Ou,e[d*3],e[d*3+1],u),D.set(Vu,e[m*3],e[m*3+1],u),c.add(Ou,Vu,ere))}return c.getPrimitive()}var tV;function tre(){return tV||(tV=wb(nc(4,!1))),tV}var rV;function rre(){return rV||(rV=wb(nc(5,!1))),rV}var nV;function nre(){return nV||(nV=wb(nc(6,!1))),nV}var oV;function ore(){return oV||(oV=wb(nc(6,!0))),oV}var iV;function ire(){return iV||(iV=wb(nc(7,!1))),iV}var sre=new Map,are=D.create(0,1,0),Gf=D(),v3=D(),lre=D(),$0=de(),cre=de(),ure=D(),Vf=D(),sV=D();function b3(e,t,r,n,o){return D.setMagnitude(v3,r,n/2),D.add(lre,t,v3),o?D.matchDirection(sV,are,v3):D.copy(sV,are),D.set(ure,1,n,1),D.makeRotation(cre,sV,v3),de.scale(e,cre,ure),de.setTranslation(e,lre)}var Of=new Int32Array(9);function rRe(e){var t,r,n,o,i,s,a,l,c;return Of[0]=Math.round(1e3*((t=e.radiusTop)!==null&&t!==void 0?t:Op.radiusTop)),Of[1]=Math.round(1e3*((r=e.radiusBottom)!==null&&r!==void 0?r:Op.radiusBottom)),Of[2]=Math.round(1e3*((n=e.height)!==null&&n!==void 0?n:Op.height)),Of[3]=(o=e.radialSegments)!==null&&o!==void 0?o:Op.radialSegments,Of[4]=(i=e.heightSegments)!==null&&i!==void 0?i:Op.heightSegments,Of[5]=((s=e.topCap)!==null&&s!==void 0?s:Op.topCap)?1:0,Of[6]=((a=e.bottomCap)!==null&&a!==void 0?a:Op.bottomCap)?1:0,Of[7]=Math.round(1e3*((l=e.thetaStart)!==null&&l!==void 0?l:Op.thetaStart)),Of[8]=Math.round(1e3*((c=e.thetaLength)!==null&&c!==void 0?c:Op.thetaLength)),di(Of)}function x3(e){let t=rRe(e),r=sre.get(t);if(r===void 0){if(e.radialSegments&&e.radialSegments<=4){let n=Math.max(3,e.radialSegments),o=wb(nc(n,!0,e.radiusTop),e);r=cC(o,de.rotX90)}else r=Qte(e);sre.set(t,r)}return r}function zr(e,t,r,n,o){let i=D.distance(t,r)*n;D.sub(Gf,r,t),b3($0,t,Gf,i,!0),gt.addPrimitive(e,$0,x3(o))}function dre(e,t,r,n,o,i){let s=D.distance(t,r)*n,a=x3(i);D.sub(Gf,r,t),D.add(Vf,t,o),b3($0,Vf,Gf,s,!0),gt.addPrimitive(e,$0,a),D.sub(Vf,t,o),b3($0,Vf,Gf,s,!0),gt.addPrimitive(e,$0,a)}function _b(e,t,r,n,o,i,s){let a=D.distance(t,r)*n,l=o%2!==0,c=Math.floor((o+1)/2),u=a/(o+.5),d=x3(s);D.setMagnitude(Gf,D.sub(Gf,r,t),u),D.copy(Vf,t);for(let m=0;m<c;++m)D.add(Vf,Vf,Gf),l&&m===c-1&&(!i&&s.topCap&&(s.topCap=!1,d=x3(s)),u/=2),b3($0,Vf,Gf,u,!1),gt.addPrimitive(e,$0,d),D.add(Vf,Vf,Gf)}var xs=D(),mre=nr(),Vp=D(),fm=D(),lg=D(),C3=D(),Ac=D.fromArray,nRe=D.triangleNormal,pre=D.copy,S3=D.transformMat4,fre=D.transformMat3,hre=nr.directionTransform,wc=it.add3,I3=it.add,gt;(function(e){function t(m=2048,p=1024,h){return{currentGroup:-1,vertices:it.create(Float32Array,3,p,h?h.vertexBuffer.ref.value:m),normals:it.create(Float32Array,3,p,h?h.normalBuffer.ref.value:m),indices:it.create(Uint32Array,3,p*3,h?h.indexBuffer.ref.value:m*3),groups:it.create(Float32Array,1,p,h?h.groupBuffer.ref.value:m),mesh:h}}e.createState=t;function r(m,p,h,f){let{vertices:C,normals:g,indices:b,groups:y,currentGroup:x}=m,A=C.elementCount;wc(C,p[0],p[1],p[2]),wc(C,h[0],h[1],h[2]),wc(C,f[0],f[1],f[2]),nRe(xs,p,h,f);for(let v=0;v<3;++v)wc(g,xs[0],xs[1],xs[2]),I3(y,x);wc(b,A,A+1,A+2)}e.addTriangle=r;function n(m,p,h,f,C){let{vertices:g,normals:b,indices:y,groups:x,currentGroup:A}=m,v=g.elementCount;wc(g,p[0],p[1],p[2]),wc(g,h[0],h[1],h[2]),wc(g,f[0],f[1],f[2]);for(let _=0;_<3;++_)wc(b,C[0],C[1],C[2]),I3(x,A);wc(y,v,v+1,v+2)}e.addTriangleWithNormal=n;function o(m,p,h){Ac(lg,p,h[0]*3),Ac(C3,p,h[1]*3);for(let f=2,C=h.length;f<C;f+=2)pre(Vp,lg),pre(fm,C3),Ac(lg,p,h[f]*3),Ac(C3,p,h[f+1]*3),r(m,Vp,fm,lg),r(m,fm,C3,lg)}e.addTriangleStrip=o;function i(m,p,h){Ac(Vp,p,h[0]*3);for(let f=2,C=h.length;f<C;++f)Ac(fm,p,h[f-1]*3),Ac(lg,p,h[f]*3),r(m,Vp,lg,fm)}e.addTriangleFan=i;function s(m,p,h,f){Ac(Vp,p,h[0]*3);for(let C=2,g=h.length;C<g;++C)Ac(fm,p,h[C-1]*3),Ac(lg,p,h[C]*3),n(m,Vp,lg,fm,f)}e.addTriangleFanWithNormal=s;function a(m,p,h){let{vertices:f,normals:C,indices:g}=h,{vertices:b,normals:y,indices:x,groups:A,currentGroup:v}=m,_=b.elementCount,I=hre(mre,p);for(let T=0,E=f.length;T<E;T+=3)S3(xs,Ac(xs,f,T),p),wc(b,xs[0],xs[1],xs[2]),fre(xs,Ac(xs,C,T),I),wc(y,xs[0],xs[1],xs[2]),I3(A,v);for(let T=0,E=g.length;T<E;T+=3)wc(x,g[T]+_,g[T+1]+_,g[T+2]+_)}e.addPrimitive=a;function l(m,p,h){let{vertices:f,normals:C,indices:g}=h,{vertices:b,normals:y,indices:x,groups:A,currentGroup:v}=m,_=b.elementCount,I=hre(mre,p);for(let T=0,E=f.length;T<E;T+=3)S3(xs,Ac(xs,f,T),p),wc(b,xs[0],xs[1],xs[2]),fre(xs,Ac(xs,C,T),I),wc(y,-xs[0],-xs[1],-xs[2]),I3(A,v);for(let T=0,E=g.length;T<E;T+=3)wc(x,g[T+2]+_,g[T+1]+_,g[T]+_)}e.addPrimitiveFlipped=l;function c(m,p,h,f,C,g){let{vertices:b,edges:y}=h,x={radiusTop:f,radiusBottom:f,radialSegments:g};for(let A=0,v=y.length;A<v;A+=2)Ac(Vp,b,y[A]*3),Ac(fm,b,y[A+1]*3),S3(Vp,Vp,p),S3(fm,fm,p),Rr(m,Vp,f,C),Rr(m,fm,f,C),zr(m,Vp,fm,1,x)}e.addCage=c;function u(m,p,h){a(m,p,{vertices:h.vertexBuffer.ref.value.subarray(0,h.vertexCount*3),normals:h.normalBuffer.ref.value.subarray(0,h.vertexCount*3),indices:h.indexBuffer.ref.value.subarray(0,h.triangleCount*3)})}e.addMesh=u;function d(m){let{vertices:p,normals:h,indices:f,groups:C,mesh:g}=m,b=it.compact(p,!0),y=it.compact(f,!0),x=it.compact(h,!0),A=it.compact(C,!0);return Ct.create(b,y,x,A,m.vertices.elementCount,m.indices.elementCount,g)}e.getMesh=d})(gt||(gt={}));function W0(e,t,r){return e=ko(Math.round(e),0,16777215)+1,t[r+2]=e%256,e=Math.floor(e/256),t[r+1]=e%256,e=Math.floor(e/256),t[r]=e%256,t}function Tb(e,t,r){return Math.floor(e)*256*256+Math.floor(t)*256+Math.floor(r)-1}var A3=255/256,aV=D.create(256*256*256,256*256,256),oRe=Ht.create(A3/aV[0],A3/aV[1],A3/aV[2],A3/1),gre=Ht();function yre(e,t,r,n){return Ht.set(gre,e/255,t/255,r/255,n/255),Ht.dot(gre,oRe)}function Sl(e,t,r){switch(Mi.getGranularity(e,t.granularity)){case"uniform":return lRe(e,t.size,r);case"group":return uRe(e,t.size,r);case"groupInstance":return dRe(e,t.size,r);case"instance":return cRe(e,t.size,r)}}var w3=100;function q0(e){switch(e.dSizeType.ref.value){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":let r=0,n=e.tSize.ref.value.array;for(let o=0,i=n.length;o<i;o+=3){let s=Tb(n[o],n[o+1],n[o+2]);r<s&&(r=s)}return r/w3}}var iRe={array:new Uint8Array(3),width:1,height:1};function sRe(){return{tSize:G.create(iRe),uSizeTexDim:G.create(Ve.create(1,1))}}function aRe(e,t){return t?(G.update(t.uSize,e),G.updateIfChanged(t.dSizeType,"uniform"),t):{uSize:G.create(e),...sRe(),dSizeType:G.create("uniform")}}function lRe(e,t,r){return aRe(t(bs),r)}function lV(e,t,r){return r?(G.update(r.tSize,e),G.update(r.uSizeTexDim,Ve.create(e.width,e.height)),G.updateIfChanged(r.dSizeType,t),r):{uSize:G.create(0),tSize:G.create(e),uSizeTexDim:G.create(Ve.create(e.width,e.height)),dSizeType:G.create(t)}}function cRe(e,t,r){let{instanceCount:n}=e,o=mo(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){let i=e.move();W0(t(i.location)*w3,o.array,i.instanceIndex*3),e.skipInstance()}return lV(o,"instance",r)}function uRe(e,t,r){let{groupCount:n}=e,o=mo(Math.max(1,n),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){let i=e.move();W0(t(i.location)*w3,o.array,i.groupIndex*3)}return lV(o,"group",r)}function dRe(e,t,r){let{groupCount:n,instanceCount:o}=e,i=o*n,s=mo(Math.max(1,i),3,Uint8Array,r&&r.tSize.ref.value.array);for(e.reset();e.hasNext;){let a=e.move();W0(t(a.location)*w3,s.array,a.index*3)}return lV(s,"groupInstance",r)}var Gu;(function(e){function t(h,f,C,g){return g?i(h,f,C,g):o(h,f,C)}e.create=t;function r(h){let f=h?h.centerBuffer.ref.value:new Float32Array(0),C=h?h.groupBuffer.ref.value:new Float32Array(0);return t(f,C,0,h)}e.createEmpty=r;function n(h){return di([h.pointCount,h.centerBuffer.ref.version,h.groupBuffer.ref.version])}function o(h,f,C){let g=Pe(),b,y=-1,x=-1,A={kind:"points",pointCount:C,centerBuffer:G.create(h),groupBuffer:G.create(f),get boundingSphere(){let v=n(A);if(v!==y){let _=Nu(A.centerBuffer.ref.value,A.pointCount,1);Pe.copy(g,_),y=v}return g},get groupMapping(){return A.groupBuffer.ref.version!==x&&(b=dm(A.groupBuffer.ref.value,A.pointCount),x=A.groupBuffer.ref.version),b},setBoundingSphere(v){Pe.copy(g,v),y=n(A)}};return A}function i(h,f,C,g){return g.pointCount=C,G.update(g.centerBuffer,h),G.update(g.groupBuffer,f),g}function s(h,f){let C=h.centerBuffer.ref.value;um(f,C,0,h.pointCount),G.update(h.centerBuffer,C)}e.transform=s,e.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},e.StyleTypeNames=Object.keys(e.StyleTypes),e.Params={...at.Params,sizeFactor:M.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:M.Boolean(!1),pointStyle:M.Select("square",M.objectToOptions(e.StyleTypes))},e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:u,updateBoundingSphere:d,createRenderableState:m,updateRenderableState:p,createPositionIterator:a};function a(h,f){let C=h.pointCount,g=f.instanceCount.ref.value,b=Ic(),y=b.position,x=h.centerBuffer.ref.value,A=f.aTransform.ref.value;return Mr(C,g,1,(_,I)=>(I<0?D.fromArray(y,x,_*3):D.transformMat4Offset(y,x,A,0,_*3,I*16),b))}function l(h,f,C,g,b){let{instanceCount:y,groupCount:x}=C,A=a(h,f),v=$i(C,A,g.color),_=Sl(C,g.size),I=b.instanceGranularity?to(y,"instance"):to(y*x,"groupInstance"),T=yl(),E=vl(),w=Cl(),S=xl(),P=bl(),k={drawCount:h.pointCount,vertexCount:h.pointCount,groupCount:x,instanceCount:y},L=Pe.clone(h.boundingSphere),R=xi(L,f.aTransform.ref.value,y,0);return{dGeometryType:G.create("points"),aPosition:h.centerBuffer,aGroup:h.groupBuffer,boundingSphere:G.create(R),invariantBoundingSphere:G.create(L),uInvariantBoundingSphere:G.create(Ht.ofSphere(L)),...v,..._,...I,...T,...E,...w,...S,...P,...f,...at.createValues(b,k),uSizeFactor:G.create(b.sizeFactor),dPointSizeAttenuation:G.create(b.pointSizeAttenuation),dPointStyle:G.create(b.pointStyle)}}function c(h,f,C,g,b){let y=at.createSimple(C,g,b),x={...M.getDefaultValues(e.Params),...f};return l(h,y.transform,y.locationIterator,y.theme,x)}function u(h,f){at.updateValues(h,f),G.updateIfChanged(h.uSizeFactor,f.sizeFactor),G.updateIfChanged(h.dPointSizeAttenuation,f.pointSizeAttenuation),G.updateIfChanged(h.dPointStyle,f.pointStyle)}function d(h,f){let C=Pe.clone(f.boundingSphere),g=xi(C,h.aTransform.ref.value,h.instanceCount.ref.value,0);Pe.equals(g,h.boundingSphere.ref.value)||G.update(h.boundingSphere,g),Pe.equals(C,h.invariantBoundingSphere.ref.value)||(G.update(h.invariantBoundingSphere,C),G.update(h.uInvariantBoundingSphere,Ht.fromSphere(h.uInvariantBoundingSphere.ref.value,C)))}function m(h){let f=at.createRenderableState(h);return p(f,h),f}function p(h,f){at.updateRenderableState(h,f),h.opaque=h.opaque&&f.pointStyle!=="fuzzy",h.writeDepth=h.opaque}})(Gu||(Gu={}));function cV(e,t,r,n,o,i,s){for(let a=0;a<t;a++){for(let l=0;l<r;l++)n[l]=e[l*t+a];vre(n,o,i,s,r);for(let l=0;l<r;l++)e[l*t+a]=o[l]}for(let a=0;a<r;a++){for(let l=0;l<t;l++)n[l]=e[a*t+l];vre(n,o,i,s,t);for(let l=0;l<t;l++)e[a*t+l]=Math.sqrt(o[l])}}function vre(e,t,r,n,o){r[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(let i=1,s=0;i<o;i++){let a=(e[i]+i*i-(e[r[s]]+r[s]*r[s]))/(2*i-2*r[s]);for(;a<=n[s];)s--,a=(e[i]+i*i-(e[r[s]]+r[s]*r[s]))/(2*i-2*r[s]);s++,r[s]=i,n[s]=a,n[s+1]=Number.MAX_SAFE_INTEGER}for(let i=0,s=0;i<o;i++){for(;n[s+1]<i;)s++;t[i]=(i-r[s])*(i-r[s])+e[r[s]]}}var uV={};function xre(e){let t=JSON.stringify(e);return uV[t]===void 0&&(uV[t]=new dV(e)),uV[t]}var mV={fontFamily:M.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:M.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:M.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:M.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:M.Select("normal",[["normal","Normal"],["bold","Bold"]])},dV=class{constructor(t={}){this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;let r={...M.getDefaultValues(mV),...t};this.props=r;let n=32*(r.fontQuality+1);this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(this.lineHeight*.75),this.texture=mo(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchContext=pRe(this.maxWidth,this.lineHeight,{willReadFrequently:!0}),this.scratchContext.font=`${r.fontStyle} ${r.fontVariant} ${r.fontWeight} ${n}px ${r.fontFamily}`,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get("\uFFFD")}get(t){if(this.mapped[t]===void 0){this.draw(t);let{array:r,width:n,height:o}=this.texture,i=this.scratchData;if(this.currentX+this.scratchW>n&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>o)return this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(let s=0;s<this.scratchH;++s)for(let a=0;a<this.scratchW;++a)r[n*(this.currentY+s)+this.currentX+a]=i[s*this.scratchW+a];this.currentX+=this.scratchW}return this.mapped[t]}draw(t){let r=this.lineHeight,n=this.scratchContext,o=this.scratchData,i=n.measureText(t),s=Math.min(this.maxWidth,Math.ceil(i.width+2*this.buffer)),a=s*r;n.clearRect(0,0,s,r),n.fillText(t,this.buffer,this.middle);let l=n.getImageData(0,0,s,r);for(let c=0;c<a;c++){let u=l.data[c*4+3]/255;this.gridOuter[c]=u===1?0:u===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-u),2),this.gridInner[c]=u===1?Number.MAX_SAFE_INTEGER:u===0?0:Math.pow(Math.max(0,u-.5),2)}cV(this.gridOuter,s,r,this.f,this.d,this.v,this.z),cV(this.gridInner,s,r,this.f,this.d,this.v,this.z);for(let c=0;c<a;c++){let u=this.gridOuter[c]-this.gridInner[c];o[c]=Math.max(0,Math.min(255,Math.round(255-255*(u/this.radius+this.cutoff))))}this.scratchW=s,this.scratchH=r}},bre;function mRe(){if(!bre)throw new Error("When running in Node.js and wanting to use Canvas API, call mol-util/data-source's setCanvasModule function first and pass imported `canvas` module to it.");return bre}function pRe(e,t,r){if(Qh)return mRe().createCanvas(e,t).getContext("2d",r);{let n=document.createElement("canvas");return n.width=e,n.height=t,n.getContext("2d",r)}}var Cs;(function(e){function t(p,h,f,C,g,b,y,x,A){return A?i(p,h,f,C,g,b,y,x,A):o(p,h,f,C,g,b,y,x)}e.create=t;function r(p){let h=p?p.fontTexture.ref.value:mo(0,1,Uint8Array),f=p?p.centerBuffer.ref.value:new Float32Array(0),C=p?p.mappingBuffer.ref.value:new Float32Array(0),g=p?p.depthBuffer.ref.value:new Float32Array(0),b=p?p.indexBuffer.ref.value:new Uint32Array(0),y=p?p.groupBuffer.ref.value:new Float32Array(0),x=p?p.tcoordBuffer.ref.value:new Float32Array(0);return t(h,f,C,g,b,y,x,0,p)}e.createEmpty=r;function n(p){return di([p.charCount,p.fontTexture.ref.version,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.depthBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.tcoordBuffer.ref.version])}function o(p,h,f,C,g,b,y,x){let A=Pe(),v,_=-1,I=-1,T={kind:"text",charCount:x,fontTexture:G.create(p),centerBuffer:G.create(h),mappingBuffer:G.create(f),depthBuffer:G.create(C),indexBuffer:G.create(g),groupBuffer:G.create(b),tcoordBuffer:G.create(y),get boundingSphere(){let E=n(T);if(E!==_){let w=Nu(T.centerBuffer.ref.value,T.charCount*4,4);Pe.copy(A,w),_=E}return A},get groupMapping(){return T.groupBuffer.ref.version!==I&&(v=dm(T.groupBuffer.ref.value,T.charCount,4),I=T.groupBuffer.ref.version),v},setBoundingSphere(E){Pe.copy(A,E),_=n(T)}};return T}function i(p,h,f,C,g,b,y,x,A){return A.charCount=x,G.update(A.fontTexture,p),G.update(A.centerBuffer,h),G.update(A.mappingBuffer,f),G.update(A.depthBuffer,C),G.update(A.indexBuffer,g),G.update(A.groupBuffer,b),G.update(A.tcoordBuffer,y),A}e.Params={...at.Params,...mV,sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),borderWidth:M.Numeric(0,{min:0,max:.5,step:.01}),borderColor:M.Color(Gt.grey),offsetX:M.Numeric(0,{min:0,max:10,step:.1}),offsetY:M.Numeric(0,{min:0,max:10,step:.1}),offsetZ:M.Numeric(0,{min:0,max:10,step:.1}),background:M.Boolean(!1),backgroundMargin:M.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:M.Color(Gt.grey),backgroundOpacity:M.Numeric(1,{min:0,max:1,step:.01}),tether:M.Boolean(!1),tetherLength:M.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:M.Numeric(.3,{min:0,max:1,step:.01}),attachment:M.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])},e.Utils={Params:e.Params,createEmpty:r,createValues:a,createValuesSimple:l,updateValues:c,updateBoundingSphere:u,createRenderableState:d,updateRenderableState:m,createPositionIterator:s};function s(p,h){let f=p.charCount*4,C=h.instanceCount.ref.value,g=Ic(),b=g.position,y=p.centerBuffer.ref.value,x=h.aTransform.ref.value;return Mr(f,C,4,(v,_)=>(_<0?D.fromArray(b,y,v*3):D.transformMat4Offset(b,y,x,0,v*3,_*16),g))}function a(p,h,f,C,g){let{instanceCount:b,groupCount:y}=f,x=s(p,h),A=$i(f,x,C.color),v=Sl(f,C.size),_=g.instanceGranularity?to(b,"instance"):to(b*y,"groupInstance"),I=yl(),T=vl(),E=Cl(),w=xl(),S=bl(),P={drawCount:p.charCount*2*3,vertexCount:p.charCount*4,groupCount:y,instanceCount:b},k=Cre(p.mappingBuffer.ref.value,p.depthBuffer.ref.value,p.charCount,q0(v)),L=Pe.expand(Pe(),p.boundingSphere,k),R=xi(L,h.aTransform.ref.value,b,0);return{dGeometryType:G.create("text"),aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aDepth:p.depthBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:G.create(R),invariantBoundingSphere:G.create(L),uInvariantBoundingSphere:G.create(Ht.ofSphere(L)),...A,...v,..._,...I,...T,...E,...w,...S,...h,aTexCoord:p.tcoordBuffer,tFont:p.fontTexture,padding:G.create(k),...at.createValues(g,P),uSizeFactor:G.create(g.sizeFactor),uBorderWidth:G.create(ko(g.borderWidth,0,.5)),uBorderColor:G.create(ze.toArrayNormalized(g.borderColor,D.zero(),0)),uOffsetX:G.create(g.offsetX),uOffsetY:G.create(g.offsetY),uOffsetZ:G.create(g.offsetZ),uBackgroundColor:G.create(ze.toArrayNormalized(g.backgroundColor,D.zero(),0)),uBackgroundOpacity:G.create(g.backgroundOpacity)}}function l(p,h,f,C,g){let b=at.createSimple(f,C,g),y={...M.getDefaultValues(e.Params),...h};return a(p,b.transform,b.locationIterator,b.theme,y)}function c(p,h){at.updateValues(p,h),G.updateIfChanged(p.uSizeFactor,h.sizeFactor),G.updateIfChanged(p.uBorderWidth,h.borderWidth),ze.fromNormalizedArray(p.uBorderColor.ref.value,0)!==h.borderColor&&(ze.toArrayNormalized(h.borderColor,p.uBorderColor.ref.value,0),G.update(p.uBorderColor,p.uBorderColor.ref.value)),G.updateIfChanged(p.uOffsetX,h.offsetX),G.updateIfChanged(p.uOffsetY,h.offsetY),G.updateIfChanged(p.uOffsetZ,h.offsetZ),ze.fromNormalizedArray(p.uBackgroundColor.ref.value,0)!==h.backgroundColor&&(ze.toArrayNormalized(h.backgroundColor,p.uBackgroundColor.ref.value,0),G.update(p.uBackgroundColor,p.uBackgroundColor.ref.value)),G.updateIfChanged(p.uBackgroundOpacity,h.backgroundOpacity)}function u(p,h){let f=Cre(p.aMapping.ref.value,p.aDepth.ref.value,h.charCount,q0(p)),C=Pe.expand(Pe(),h.boundingSphere,f),g=xi(C,p.aTransform.ref.value,p.instanceCount.ref.value,0);Pe.equals(g,p.boundingSphere.ref.value)||G.update(p.boundingSphere,g),Pe.equals(C,p.invariantBoundingSphere.ref.value)||(G.update(p.invariantBoundingSphere,C),G.update(p.uInvariantBoundingSphere,Ht.fromSphere(p.uInvariantBoundingSphere.ref.value,C))),G.update(p.padding,f)}function d(p){let h=at.createRenderableState(p);return m(h,p),h}function m(p,h){at.updateRenderableState(p,h),p.pickable=!1,p.opaque=!1,p.writeDepth=!0}})(Cs||(Cs={}));function Cre(e,t,r,n){let o=0,i=0;for(let s=0,a=r*4;s<a;++s){let l=2*s,c=Math.abs(e[l]);c>o&&(o=c);let u=Math.abs(e[l+1]);u>o&&(o=u);let d=Math.abs(t[s]);d>i&&(i=d)}return Math.max(i,n+n*o)}var tu=D(),Gp=D(),k2=D(),Sre=it.add,_3=it.add3,ga;(function(e){function t(r=2048,n=1024,o){let i=it.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r),s=it.create(Float32Array,3,n,o?o.startBuffer.ref.value:r),a=it.create(Float32Array,3,n,o?o.endBuffer.ref.value:r),l=(d,m,p,h,f,C,g)=>{for(let b=0;b<4;++b)_3(s,d,m,p),_3(a,h,f,C),Sre(i,g)},c=(d,m,p)=>{for(let h=0;h<4;++h)_3(s,d[0],d[1],d[2]),_3(a,m[0],m[1],m[2]),Sre(i,p)},u=(d,m,p,h)=>{let f=D.distance(d,m),C=p%2!==0,g=Math.floor((p+1)/2),b=f/(p+.5);D.setMagnitude(k2,D.sub(k2,m,d),b),D.copy(tu,d);for(let y=0;y<g;++y)D.add(tu,tu,k2),C&&y===g-1?D.copy(Gp,m):D.add(Gp,tu,k2),l(tu[0],tu[1],tu[2],Gp[0],Gp[1],Gp[2],h),D.add(tu,tu,k2)};return{add:l,addVec:c,addFixedCountDashes:u,addFixedLengthDashes:(d,m,p,h)=>{let f=D.distance(d,m);u(d,m,f/p,h)},addCage:(d,m,p)=>{let{vertices:h,edges:f}=m;for(let C=0,g=f.length;C<g;C+=2)D.fromArray(tu,h,f[C]*3),D.fromArray(Gp,h,f[C+1]*3),D.transformMat4(tu,tu,d),D.transformMat4(Gp,Gp,d),l(tu[0],tu[1],tu[2],Gp[0],Gp[1],Gp[2],p)},getLines:()=>{let d=i.elementCount/4,m=it.compact(i,!0),p=it.compact(s,!0),h=it.compact(a,!0),f=o&&d<=o.lineCount?o.mappingBuffer.ref.value:new Float32Array(d*8),C=o&&d<=o.lineCount?o.indexBuffer.ref.value:new Uint32Array(d*6);return(!o||d>o.lineCount)&&fRe(d,f,C),In.create(f,C,m,p,h,d,o)}}}e.create=t})(ga||(ga={}));function fRe(e,t,r){for(let n=0;n<e;++n){let o=n*8;t[o]=-1,t[o+1]=-1,t[o+2]=1,t[o+3]=-1,t[o+4]=-1,t[o+5]=1,t[o+6]=1,t[o+7]=1}for(let n=0;n<e;++n){let o=n*4,i=n*6;r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+1,r[i+4]=o+3,r[i+5]=o+2}}var In;(function(e){function t(p,h,f,C,g,b,y){return y?s(p,h,f,C,g,b,y):i(p,h,f,C,g,b)}e.create=t;function r(p){let h=p?p.mappingBuffer.ref.value:new Float32Array(0),f=p?p.indexBuffer.ref.value:new Uint32Array(0),C=p?p.groupBuffer.ref.value:new Float32Array(0),g=p?p.startBuffer.ref.value:new Float32Array(0),b=p?p.endBuffer.ref.value:new Float32Array(0);return t(h,f,C,g,b,0,p)}e.createEmpty=r;function n(p,h){let f=p.vertexBuffer.ref.value,C=p.indexBuffer.ref.value,g=p.groupBuffer.ref.value,b=ga.create(p.triangleCount*3,p.triangleCount/10,h);for(let y=0,x=p.triangleCount*3;y<x;y+=3){let A=C[y],v=C[y+1],_=C[y+2],I=f[A*3],T=f[A*3+1],E=f[A*3+2],w=f[v*3],S=f[v*3+1],P=f[v*3+2],k=f[_*3],L=f[_*3+1],R=f[_*3+2];b.add(I,T,E,w,S,P,g[A]),b.add(I,T,E,k,L,R,g[A]),b.add(w,S,P,k,L,R,g[v])}return b.getLines()}e.fromMesh=n;function o(p){return di([p.lineCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version])}function i(p,h,f,C,g,b){let y=Pe(),x,A=-1,v=-1,_={kind:"lines",lineCount:b,mappingBuffer:G.create(p),indexBuffer:G.create(h),groupBuffer:G.create(f),startBuffer:G.create(C),endBuffer:G.create(g),get boundingSphere(){let I=o(_);if(I!==A){let T=Nu(_.startBuffer.ref.value,_.lineCount*4,4),E=Nu(_.endBuffer.ref.value,_.lineCount*4,4);Pe.expandBySphere(y,T,E),A=I}return y},get groupMapping(){return _.groupBuffer.ref.version!==v&&(x=dm(_.groupBuffer.ref.value,_.lineCount,4),v=_.groupBuffer.ref.version),x},setBoundingSphere(I){Pe.copy(y,I),A=o(_)}};return _}function s(p,h,f,C,g,b,y){return b>y.lineCount&&(G.update(y.mappingBuffer,p),G.update(y.indexBuffer,h)),y.lineCount=b,G.update(y.groupBuffer,f),G.update(y.startBuffer,C),G.update(y.endBuffer,g),y}function a(p,h){let f=p.startBuffer.ref.value;um(h,f,0,p.lineCount*4),G.update(p.startBuffer,f);let C=p.endBuffer.ref.value;um(h,C,0,p.lineCount*4),G.update(p.endBuffer,C)}e.transform=a,e.Params={...at.Params,sizeFactor:M.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:M.Boolean(!1)},e.Utils={Params:e.Params,createEmpty:r,createValues:c,createValuesSimple:u,updateValues:d,updateBoundingSphere:m,createRenderableState:at.createRenderableState,updateRenderableState:at.updateRenderableState,createPositionIterator:l};function l(p,h){let f=p.lineCount*4,C=h.instanceCount.ref.value,g=Ic(),b=g.position,y=p.startBuffer.ref.value,x=p.endBuffer.ref.value,A=h.aTransform.ref.value;return Mr(f,C,2,(_,I)=>{let T=_%4===0?y:x;return I<0?D.fromArray(b,T,_*3):D.transformMat4Offset(b,T,A,0,_*3,I*16),g})}function c(p,h,f,C,g){let{instanceCount:b,groupCount:y}=f,x=l(p,h),A=$i(f,x,C.color),v=Sl(f,C.size),_=g.instanceGranularity?to(b,"instance"):to(b*y,"groupInstance"),I=yl(),T=vl(),E=Cl(),w=xl(),S=bl(),P={drawCount:p.lineCount*2*3,vertexCount:p.lineCount*4,groupCount:y,instanceCount:b},k=Pe.clone(p.boundingSphere),L=xi(k,h.aTransform.ref.value,b,0);return{dGeometryType:G.create("lines"),aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,elements:p.indexBuffer,boundingSphere:G.create(L),invariantBoundingSphere:G.create(k),uInvariantBoundingSphere:G.create(Ht.ofSphere(k)),...A,...v,..._,...I,...T,...E,...w,...S,...h,...at.createValues(g,P),uSizeFactor:G.create(g.sizeFactor),dLineSizeAttenuation:G.create(g.lineSizeAttenuation),uDoubleSided:G.create(!0),dFlipSided:G.create(!1)}}function u(p,h,f,C,g){let b=at.createSimple(f,C,g),y={...M.getDefaultValues(e.Params),...h};return c(p,b.transform,b.locationIterator,b.theme,y)}function d(p,h){at.updateValues(p,h),G.updateIfChanged(p.uSizeFactor,h.sizeFactor),G.updateIfChanged(p.dLineSizeAttenuation,h.lineSizeAttenuation)}function m(p,h){let f=Pe.clone(h.boundingSphere),C=xi(f,p.aTransform.ref.value,p.instanceCount.ref.value,0);Pe.equals(C,p.boundingSphere.ref.value)||G.update(p.boundingSphere,C),Pe.equals(f,p.invariantBoundingSphere.ref.value)||(G.update(p.invariantBoundingSphere,f),G.update(p.uInvariantBoundingSphere,Ht.fromSphere(p.uInvariantBoundingSphere.ref.value,f)))}})(In||(In={}));var cg=D(),ug=D(),dg=D(),dC=D(),Ss=nc(4,!0);function Ire(e){let n=Np(12,e?36:24);for(let o=0;o<4;++o){let i=(o+1)%4;D.set(cg,Ss[o*3],Ss[o*3+1],-.5),D.set(ug,Ss[i*3],Ss[i*3+1],-.5),D.set(dg,Ss[i*3],Ss[i*3+1],.5),D.set(dC,Ss[o*3],Ss[o*3+1],.5),e?n.add(cg,ug,dg):n.addQuad(cg,ug,dg,dC)}return D.set(cg,Ss[0],Ss[1],-.5),D.set(ug,Ss[3],Ss[4],-.5),D.set(dg,Ss[6],Ss[7],-.5),D.set(dC,Ss[9],Ss[10],-.5),e?n.add(dg,ug,cg):n.addQuad(dC,dg,ug,cg),D.set(cg,Ss[0],Ss[1],.5),D.set(ug,Ss[3],Ss[4],.5),D.set(dg,Ss[6],Ss[7],.5),D.set(dC,Ss[9],Ss[10],.5),e?n.add(cg,ug,dg):n.addQuad(cg,ug,dg,dC),n.getPrimitive()}var pV;function Z0(){return pV||(pV=Ire(!1)),pV}var fV;function Are(){return fV||(fV=Ire(!0)),fV}var hV;function T3(){return hV||(hV=Nf([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),hV}function gV(e){return e.map(t=>({x:t[0],alpha:t[1]}))}function yV(e,t){let r=[{x:0,alpha:0},{x:0,alpha:0},...e,{x:1,alpha:0},{x:1,alpha:0}],n=256,o=t?t.ref.value.array:new Uint8Array(n),i=0,s,a,l,c,u,d,m=e.length+1;for(let h=0;h<m;++h){s=r[h+1].x,a=r[h+2].x,l=r[h].alpha,c=r[h+1].alpha,u=r[h+2].alpha,d=r[h+3].alpha;let f=Math.round((a-s)*n);for(let C=0;C<f;++C){let g=C/f;o[i]=Math.max(0,Xd(l,c,u,d,g,.5)*255),++i}}let p={array:o,width:256,height:1};return t?(G.update(t,p),t):G.create(p)}function _re(e,t,r){if(r)return wre(e,t,r.min,r.max);{let[n,o]=ml(e);return wre(e,t,n,o)}}function wre(e,t,r,n){let o=(n-r)/t;o===0&&(o=1);let i=new Int32Array(t);for(let s=0,a=e.length;s<a;s++){let l=Math.floor((e[s]-r)/o);l>=t?l=t-1:l<0&&(l=0),i[l]++}return{min:r,max:n,binWidth:o,counts:i}}var go;(function(e){e.One={transform:{kind:"matrix",matrix:de.identity()},cells:cr.create(cr.Space([1,1,1],[0,1,2]),cr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};let t=de.zero(),r=de.zero();function n(l){if(l.transform.kind==="matrix")return de.copy(de(),l.transform.matrix);if(l.transform.kind==="spacegroup"){let{cells:{space:c}}=l,u=de.fromScaling(t,D.div(D.zero(),xt.size(D.zero(),l.transform.fractionalBox),D.ofArray(c.dimensions))),d=de.fromTranslation(r,l.transform.fractionalBox.min);return de.mul3(de.zero(),l.transform.cell.fromFractional,d,u)}return de.identity()}e.getGridToCartesianTransform=n;function o(l,c){return l===c}e.areEquivalent=o;function i(l){return l.cells.data.length===0}e.isEmpty=i;function s(l,c){c||(c=Pe());let u=l.cells.space.dimensions,d=e.getGridToCartesianTransform(l);return Pe.fromDimensionsAndTransform(c,u,d)}e.getBoundingSphere=s;function a(l,c){let u=l._historams;return u||(u=l._historams={}),u[c]||(u[c]=_re(l.cells.data,c,{min:l.stats.min,max:l.stats.max})),u[c]}e.getHistogram=a})(go||(go={}));function Ci(e){return e}(function(e){function t(r){return r.__key||(r.__key=jr.create22()),r.__key}e.getUUID=t})(Ci||(Ci={}));var Ls=class{constructor(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}get all(){return this._list}add(t){this._set.has(t)||(this._list.push(t),this._set.add(t))}reference(t,r){let n=this._refs.get(t)||0;n+=r?1:-1,this._refs.set(t,Math.max(n,0))}hasReference(t){return(this._refs.get(t)||0)>0}has(t){return this._set.has(t)}assets(t,r){let n=this._assets.get(t);if(n)for(let o of n)o.dispose();r?this._assets.set(t,r):this._assets.delete(t)}dispose(){this._assets.forEach(t=>{for(let r of t)r.dispose()})}};function Tre(e,t){return ke.create("Create Volume",async()=>{let{header:r,values:n}=e,o=cr.Space(r.dim,[0,1,2],Float64Array),i;if(r.dataSetIds.length===0)i=n;else{let[c,u,d]=r.dim,m=(t?.dataIndex||0)+1,p=0,h=0;i=new Float64Array(c*u*d);for(let f=0;f<c;f++)for(let C=0;C<u;C++)for(let g=0;g<d;g++)i[p++]=n[h],h+=m}let s=cr.create(o,cr.Data1(i)),a=de.fromTranslation(de(),r.origin),l=de.fromBasis(de(),r.basisX,r.basisY,r.basisZ);return de.mul(a,a,l),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:a},cells:s,stats:{min:D0(i),max:Da(i),mean:k0(i),sigma:M0(i)}},sourceData:M2.create(e),customProperties:new Ls,_propertyData:Object.create(null)}})}var M2;(function(e){function t(n){return n?.kind==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.name,data:n}}e.create=r})(M2||(M2={}));function Uf(e,t){return ke.create("Create Volume",async r=>{let{volume_data_3d_info:n,volume_data_3d:o}=e,i=Ni.create(n.spacegroup_number.value(0),D.ofArray(n.spacegroup_cell_size.value(0)),D.scale(D.zero(),D.ofArray(n.spacegroup_cell_angles.value(0)),Math.PI/180)),s=n.axis_order.value(0),a=cr.convertToCanonicalAxisIndicesFastToSlow(s),l=a(n.sample_count.value(0)),c=cr.Space(l,cr.invertAxisOrder(s),Float32Array),u=cr.create(c,cr.Data1(o.values.toArray({array:Float32Array}))),d=D.ofArray(a(n.origin.value(0))),m=D.ofArray(a(n.dimensions.value(0)));return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:i,fractionalBox:xt.create(d,D.add(D.zero(),d,m))},cells:u,stats:{min:n.min_sampled.value(0),max:n.max_sampled.value(0),mean:n.mean_sampled.value(0),sigma:n.sigma_sampled.value(0)}},sourceData:R2.create(e),customProperties:new Ls,_propertyData:Object.create(null)}})}var R2;(function(e){function t(n){return n?.kind==="dscif"}e.is=t;function r(n){return{kind:"dscif",name:n._name,data:n}}e.create=r})(R2||(R2={}));var ot;(function(e){function t(g){var b,y,x,A;return((A=(x=(y=(b=g?.grid)===null||b===void 0?void 0:b.cells)===null||y===void 0?void 0:y.space)===null||x===void 0?void 0:x.dimensions)===null||A===void 0?void 0:A.length)&&g?.sourceData&&g?.customProperties&&g?._propertyData}e.is=t;let r;(function(g){function b(E,w,S){return oo(_(E,S).absoluteValue,_(w,S).absoluteValue,S.sigma/100)}g.areSame=b;function y(E){return{kind:"absolute",absoluteValue:E}}g.absolute=y;function x(E){return{kind:"relative",relativeValue:E}}g.relative=x;function A(E,w){return w*E.sigma+E.mean}g.calcAbsolute=A;function v(E,w){return E.sigma===0?0:(w-E.mean)/E.sigma}g.calcRelative=v;function _(E,w){return E.kind==="absolute"?E:{kind:"absolute",absoluteValue:g.calcAbsolute(w,E.relativeValue)}}g.toAbsolute=_;function I(E,w){return E.kind==="relative"?E:{kind:"relative",relativeValue:g.calcRelative(w,E.absoluteValue)}}g.toRelative=I;function T(E){return E.kind==="relative"?`${E.relativeValue.toFixed(2)} \u03C3`:`${E.absoluteValue.toPrecision(4)}`}g.toString=T})(r=e.IsoValue||(e.IsoValue={}));function n(g,b,y){if(y==="relative")return r.relative(b);let x=r.absolute(b);if(R2.is(g.sourceData)){let A={min:g.sourceData.data.volume_data_3d_info.min_source.value(0),max:g.sourceData.data.volume_data_3d_info.max_source.value(0),mean:g.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:g.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return e.IsoValue.toRelative(x,A)}return x}e.adjustedIsoValue=n;let o={min:-1,max:1,mean:0,sigma:.1};function i(g,b){let y=b||o,{min:x,max:A,mean:v,sigma:_}=y,I=(x-v)/_,T=(A-v)/_,E=g;return g.kind==="absolute"?g.absoluteValue<x?E=e.IsoValue.absolute(x):g.absoluteValue>A&&(E=e.IsoValue.absolute(A)):g.relativeValue<I?E=e.IsoValue.relative(I):g.relativeValue>T&&(E=e.IsoValue.relative(T)),M.Conditioned(E,{absolute:M.Converted(w=>e.IsoValue.toAbsolute(w,go.One.stats).absoluteValue,w=>e.IsoValue.absolute(w),M.Numeric(v,{min:x,max:A,step:VA(_/100,2)},{immediateUpdate:!0})),relative:M.Converted(w=>e.IsoValue.toRelative(w,go.One.stats).relativeValue,w=>e.IsoValue.relative(w),M.Numeric(Math.min(1,T),{min:I,max:T,step:VA(Math.round((A-x)/_)/100,2)},{immediateUpdate:!0}))},w=>w.kind==="absolute"?"absolute":"relative",(w,S)=>S==="absolute"?e.IsoValue.toAbsolute(w,y):e.IsoValue.toRelative(w,y),{isEssential:!0})}e.createIsoValueParam=i,e.IsoValueParam=i(e.IsoValue.relative(2)),e.One={label:"",grid:go.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Ls,_propertyData:Object.create(null)};function s(g,b){return go.areEquivalent(g.grid,b.grid)}e.areEquivalent=s;function a(g){return go.isEmpty(g.grid)}e.isEmpty=a;function l(g){return M2.is(g.sourceData)?g.sourceData.data.header.orbitals:!1}e.isOrbitals=l;function c(g){return{kind:"volume-loci",volume:g}}e.Loci=c;function u(g){return!!g&&g.kind==="volume-loci"}e.isLoci=u;function d(g,b){return g.volume===b.volume}e.areLociEqual=d;function m(g){return go.isEmpty(g.volume.grid)}e.isLociEmpty=m;function p(g,b){return go.getBoundingSphere(g.grid,b)}e.getBoundingSphere=p;let h;(function(g){function b(I,T){return{kind:"isosurface-loci",volume:I,isoValue:T}}g.Loci=b;function y(I){return!!I&&I.kind==="isosurface-loci"}g.isLoci=y;function x(I,T){return I.volume===T.volume&&e.IsoValue.areSame(I.isoValue,T.isoValue,I.volume.grid.stats)}g.areLociEqual=x;function A(I){return I.volume.grid.cells.data.length===0}g.isLociEmpty=A;let v=xt();function _(I,T,E){let w=e.IsoValue.toAbsolute(T,I.grid.stats).absoluteValue,S=w<0,P=[0,0,0],k=I.grid.cells.space.getCoords,L=I.grid.cells.data,[R,N,F]=I.grid.cells.space.dimensions,H=R-1,V=N-1,q=F-1,Q=0,O=0,B=0;for(let U=0,z=L.length;U<z;++U)(S&&L[U]<=w||!S&&L[U]>=w)&&(k(U,P),P[0]<H&&(H=P[0]),P[1]<V&&(V=P[1]),P[2]<q&&(q=P[2]),P[0]>Q&&(Q=P[0]),P[1]>O&&(O=P[1]),P[2]>B&&(B=P[2]));D.set(v.min,H-1,V-1,q-1),D.set(v.max,Q+1,O+1,B+1);let j=go.getGridToCartesianTransform(I.grid);return xt.transform(v,v,j),Pe.fromBox3D(E||Pe(),v)}g.getBoundingSphere=_})(h=e.Isosurface||(e.Isosurface={}));let f;(function(g){function b(T,E){return{kind:"cell-loci",volume:T,indices:E}}g.Loci=b;function y(T){return!!T&&T.kind==="cell-loci"}g.isLoci=y;function x(T,E){return T.volume===E.volume&&Ge.areEqual(T.indices,E.indices)}g.areLociEqual=x;function A(T){return Ge.size(T.indices)===0}g.isLociEmpty=A;let v=new is("98"),_=D();function I(T,E,w){v.reset();let S=go.getGridToCartesianTransform(T.grid),{getCoords:P}=T.grid.cells.space;for(let L=0,R=Ge.size(E);L<R;L++){let N=Ge.getAt(E,L);P(N,_),D.transformMat4(_,_,S),v.includePosition(_)}v.finishedIncludeStep();for(let L=0,R=Ge.size(E);L<R;L++){let N=Ge.getAt(E,L);P(N,_),D.transformMat4(_,_,S),v.radiusPosition(_)}let k=v.getSphere(w);return Pe.expand(k,k,de.getMaxScaleOnAxis(S)*10)}g.getBoundingSphere=I})(f=e.Cell||(e.Cell={}));let C;(function(g){function b(E,w){return{kind:"segment-loci",volume:E,segments:Qe.ofUnsortedArray(w)}}g.Loci=b;function y(E){return!!E&&E.kind==="segment-loci"}g.isLoci=y;function x(E,w){return E.volume===w.volume&&Qe.areEqual(E.segments,w.segments)}g.areLociEqual=x;function A(E){return E.volume.grid.cells.data.length===0||E.segments.length===0}g.isLociEmpty=A;let v=xt();function _(E,w,S){let P=e.Segmentation.get(E);if(P){xt.setEmpty(v);for(let L=0,R=w.length;L<R;++L){let N=P.bounds[w[L]];xt.add(v,N.min),xt.add(v,N.max)}let k=go.getGridToCartesianTransform(E.grid);return xt.transform(v,v,k),Pe.fromBox3D(S||Pe(),v)}else return e.getBoundingSphere(E,S)}g.getBoundingSphere=_;function I(E,w){return{kind:"segment-location",volume:E,segment:w}}g.Location=I;function T(E){return!!E&&E.kind==="segment-location"}g.isLocation=T})(C=e.Segment||(e.Segment={})),e.PickingGranularity={set(g,b){g._propertyData.__picking_granularity__=b},get(g){var b;return(b=g._propertyData.__picking_granularity__)!==null&&b!==void 0?b:"voxel"}},e.Segmentation={set(g,b){g._propertyData.__segmentation__=b},get(g){return g._propertyData.__segmentation__}}})(ot||(ot={}));var vV=Z0(),el;(function(e){function t(C,g,b,y,x,A,v,_,I,T){return T?o(C,g,b,y,x,A,v,_,I,T):n(C,g,b,y,x,A,v,_,I)}e.create=t;function r(C){return di([C.bboxSize.ref.version,C.gridDimension.ref.version,C.gridTexture.ref.version,C.transform.ref.version,C.gridStats.ref.version])}function n(C,g,b,y,x,A,v,_,I){let T=Pe(),E=-1,w=A.getWidth(),S=A.getHeight(),P=A.getDepth(),k={kind:"direct-volume",gridDimension:G.create(g),gridTexture:G.create(A),gridTextureDim:G.create(D.create(w,S,P)),gridStats:G.create(Ht.create(v.min,v.max,v.mean,v.sigma)),bboxMin:G.create(C.min),bboxMax:G.create(C.max),bboxSize:G.create(D.sub(D(),C.max,C.min)),transform:G.create(b),cellDim:G.create(x),unitToCartn:G.create(y),cartnToUnit:G.create(de.invert(de(),y)),get boundingSphere(){let L=r(k);if(L!==E){let R=hRe(k.gridDimension.ref.value,k.transform.ref.value);Pe.copy(T,R),E=L}return T},packedGroup:G.create(_),axisOrder:G.create(I),setBoundingSphere(L){Pe.copy(T,L),E=r(k)}};return k}function o(C,g,b,y,x,A,v,_,I,T){let E=A.getWidth(),w=A.getHeight(),S=A.getDepth();return G.update(T.gridDimension,g),G.update(T.gridTexture,A),G.update(T.gridTextureDim,D.set(T.gridTextureDim.ref.value,E,w,S)),G.update(T.gridStats,Ht.set(T.gridStats.ref.value,v.min,v.max,v.mean,v.sigma)),G.update(T.bboxMin,C.min),G.update(T.bboxMax,C.max),G.update(T.bboxSize,D.sub(T.bboxSize.ref.value,C.max,C.min)),G.update(T.transform,b),G.update(T.cellDim,x),G.update(T.unitToCartn,y),G.update(T.cartnToUnit,de.invert(de(),y)),G.updateIfChanged(T.packedGroup,_),G.updateIfChanged(T.axisOrder,D.fromArray(T.axisOrder.ref.value,I,0)),T}function i(C){let g=xt(),b=D(),y=de.identity(),x=de.identity(),A=D(),v=Ro(),_=go.One.stats,I=!1,T=D.create(0,1,2);return t(g,b,y,x,A,v,_,I,T,C)}e.createEmpty=i,e.Params={...at.Params,ignoreLight:M.Boolean(!1,at.ShadingCategory),xrayShaded:M.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],at.ShadingCategory),controlPoints:M.LineGraph([Ve.create(.19,0),Ve.create(.2,.05),Ve.create(.25,.05),Ve.create(.26,0),Ve.create(.79,0),Ve.create(.8,.05),Ve.create(.85,.05),Ve.create(.86,0)],{isEssential:!0}),stepsPerCell:M.Numeric(3,{min:1,max:10,step:1}),jumpLength:M.Numeric(0,{min:0,max:20,step:.1})},e.Utils={Params:e.Params,createEmpty:i,createValues:u,createValuesSimple:d,updateValues:m,updateBoundingSphere:p,createRenderableState:h,updateRenderableState:f,createPositionIterator:s};function s(C,g){let b=C.transform.ref.value,[y,x,A]=C.gridDimension.ref.value,v=y*x*A,_=g.instanceCount.ref.value,I=Ic(),T=I.position,E=g.aTransform.ref.value;return Mr(v,_,1,(S,P)=>{let k=Math.floor(S/A);return T[0]=Math.floor(k/x),T[1]=k%x,T[2]=S%A,D.transformMat4(T,T,b),P>=0&&D.transformMat4Offset(T,T,E,0,0,P*16),I})}function a(C,g){return Math.ceil(D.magnitude(C)*g)}function l(C,g){return Math.min(...C)*(1/g)}function c(C){return 1/C}function u(C,g,b,y,x){let{gridTexture:A,gridTextureDim:v,gridStats:_}=C,{bboxSize:I,bboxMin:T,bboxMax:E,gridDimension:w,transform:S}=C,{instanceCount:P,groupCount:k}=b,L=e.Utils.createPositionIterator(C,g),R=$i(b,L,y.color),N=x.instanceGranularity?to(P,"instance"):to(P*k,"groupInstance"),F=yl(),H=vl(),V=Cl(),q=xl(),Q=bl(),[O,B,j]=w.ref.value,U={drawCount:vV.indices.length,vertexCount:O*B*j,groupCount:k,instanceCount:P},z=Pe.clone(C.boundingSphere),$=xi(z,g.aTransform.ref.value,P,0),Z=gV(x.controlPoints),J=yV(Z);return{dGeometryType:G.create("directVolume"),...R,...N,...F,...H,...V,...q,...Q,...g,...at.createValues(x,U),aPosition:G.create(vV.vertices),elements:G.create(vV.indices),boundingSphere:G.create($),invariantBoundingSphere:G.create(z),uInvariantBoundingSphere:G.create(Ht.ofSphere(z)),uBboxMin:T,uBboxMax:E,uBboxSize:I,uMaxSteps:G.create(a(w.ref.value,x.stepsPerCell)),uStepScale:G.create(l(C.cellDim.ref.value,x.stepsPerCell)),uJumpLength:G.create(x.jumpLength),uTransform:S,uGridDim:w,tTransferTex:J,uTransferScale:G.create(c(x.stepsPerCell)),dGridTexType:G.create(A.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:v,tGridTex:A,uGridStats:_,uCellDim:C.cellDim,uCartnToUnit:C.cartnToUnit,uUnitToCartn:C.unitToCartn,dPackedGroup:C.packedGroup,dAxisOrder:G.create(C.axisOrder.ref.value.join("")),dIgnoreLight:G.create(x.ignoreLight),dXrayShaded:G.create(x.xrayShaded==="inverted"?"inverted":x.xrayShaded===!0?"on":"off")}}function d(C,g,b,y,x){let A=at.createSimple(b,y,x),v={...M.getDefaultValues(e.Params),...g};return u(C,A.transform,A.locationIterator,A.theme,v)}function m(C,g){at.updateValues(C,g),G.updateIfChanged(C.dIgnoreLight,g.ignoreLight),G.updateIfChanged(C.dXrayShaded,g.xrayShaded==="inverted"?"inverted":g.xrayShaded===!0?"on":"off");let b=gV(g.controlPoints);yV(b,C.tTransferTex),G.updateIfChanged(C.uMaxSteps,a(C.uGridDim.ref.value,g.stepsPerCell)),G.updateIfChanged(C.uStepScale,l(C.uCellDim.ref.value,g.stepsPerCell)),G.updateIfChanged(C.uTransferScale,c(g.stepsPerCell)),G.updateIfChanged(C.uJumpLength,g.jumpLength)}function p(C,g){let b=Pe.clone(g.boundingSphere),y=xi(b,C.aTransform.ref.value,C.instanceCount.ref.value,0);Pe.equals(y,C.boundingSphere.ref.value)||G.update(C.boundingSphere,y),Pe.equals(b,C.invariantBoundingSphere.ref.value)||(G.update(C.invariantBoundingSphere,b),G.update(C.uInvariantBoundingSphere,Ht.fromSphere(C.uInvariantBoundingSphere.ref.value,b)))}function h(C){let g=at.createRenderableState(C);return g.opaque=!1,g.writeDepth=!1,g}function f(C,g){at.updateRenderableState(C,g),C.opaque=!1,C.writeDepth=!1}})(el||(el={}));function hRe(e,t){return Pe.fromDimensionsAndTransform(Pe(),e,t)}var Ra;(function(e){function t(y,x,A,v){return v?i(y,x,A,v):o(y,x,A)}e.create=t;function r(y){let x=y?y.centerBuffer.ref.value:new Float32Array(0),A=y?y.groupBuffer.ref.value:new Float32Array(0);return t(x,A,0,y)}e.createEmpty=r;function n(y){return di([y.sphereCount,y.centerBuffer.ref.version,y.groupBuffer.ref.version])}function o(y,x,A){let v=Pe(),_,I=-1,T=-1,E=G.create(mo(1,4,Float32Array)),w=G.create(Ve.create(0,0)),S=G.create([]),P=G.create(0),k={kind:"spheres",sphereCount:A,centerBuffer:G.create(y),groupBuffer:G.create(x),get boundingSphere(){let L=n(k);if(L!==I){let R=Nu(k.centerBuffer.ref.value,k.sphereCount,1);Pe.copy(v,R),I=L}return v},get groupMapping(){return k.groupBuffer.ref.version!==T&&(_=dm(k.groupBuffer.ref.value,k.sphereCount),T=k.groupBuffer.ref.version),_},setBoundingSphere(L){Pe.copy(v,L),I=n(k)},shaderData:{positionGroup:E,texDim:w,lodLevels:S,sizeFactor:P,update(L){var R,N;let F=(R=L?.lodLevels)!==null&&R!==void 0?R:c(S.ref.value),H=(N=L?.sizeFactor)!==null&&N!==void 0?N:P.ref.value,V=d(F,H),q=mo(k.sphereCount,4,Float32Array,E.ref.value.array),Q=s(q,k.centerBuffer.ref.value,k.groupBuffer.ref.value,k.sphereCount,V),O=Q?l(F,H,Q,k.sphereCount):[];G.update(E,q),G.update(w,Ve.set(w.ref.value,q.width,q.height)),G.update(S,O),G.update(P,H)}}};return k.shaderData.update(),k}function i(y,x,A,v){return v.sphereCount=A,G.update(v.centerBuffer,y),G.update(v.groupBuffer,x),v.shaderData.update(),v}function s(y,x,A,v,_){let{array:I}=y;if(_.length===0){for(let w=0;w<v;++w)I[w*4+0]=x[w*3+0],I[w*4+1]=x[w*3+1],I[w*4+2]=x[w*3+2],I[w*4+3]=A[w];return}let T=[0],E=0;for(let w=0,S=_.length;w<S;++w){let P=_[w];for(let k=0;k<v;++k){let L=!1;for(let R=0;R<w;++R)if(k%_[R]===0){L=!0;break}!L&&k%P===0&&(I[E*4+0]=x[k*3+0],I[E*4+1]=x[k*3+1],I[E*4+2]=x[k*3+2],I[E*4+3]=A[k],E+=1)}T.push(E*6)}return T}function a(y,x){if(y.length!==x.length)return!1;for(let A=0,v=y.length;A<v;++A)if(y[A].maxDistance!==x[A].maxDistance||y[A].minDistance!==x[A].minDistance||y[A].overlap!==x[A].overlap||y[A].stride!==x[A].stride||y[A].scaleBias!==x[A].scaleBias)return!1;return!0}function l(y,x,A,v){return y.map((_,I)=>{let T=u(_,x);return[_.minDistance,_.maxDistance,_.overlap,A[A.length-1-I],Math.pow(Math.min(v,T),1/_.scaleBias),_.stride,_.scaleBias]})}function c(y){return y.map(x=>({minDistance:x[0],maxDistance:x[1],overlap:x[2],stride:x[5],scaleBias:x[6]}))}function u(y,x){return Math.max(1,Math.round(y.stride/Math.pow(x,y.scaleBias)))}function d(y,x){return y.map(A=>u(A,x)).reverse()}e.Params={...at.Params,sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),doubleSided:M.Boolean(!1,at.CustomQualityParamInfo),ignoreLight:M.Boolean(!1,at.ShadingCategory),xrayShaded:M.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],at.ShadingCategory),transparentBackfaces:M.Select("off",M.arrayToOptions(["off","on","opaque"]),at.ShadingCategory),solidInterior:M.Boolean(!0,at.ShadingCategory),clipPrimitive:M.Boolean(!1,{...at.ShadingCategory,description:"Clip whole sphere instead of cutting it."}),approximate:M.Boolean(!1,{...at.ShadingCategory,description:"Faster rendering, but has artifacts."}),alphaThickness:M.Numeric(0,{min:0,max:20,step:1},{...at.ShadingCategory,description:"If not zero, adjusts alpha for radius."}),bumpFrequency:M.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),bumpAmplitude:M.Numeric(1,{min:0,max:5,step:.1},at.ShadingCategory),lodLevels:M.ObjectList({minDistance:M.Numeric(0),maxDistance:M.Numeric(0),overlap:M.Numeric(0),stride:M.Numeric(0),scaleBias:M.Numeric(3,{min:.1,max:10,step:.1})},y=>`${y.stride}`,{...at.CullingLodCategory,defaultValue:[]})},e.Utils={Params:e.Params,createEmpty:r,createValues:p,createValuesSimple:h,updateValues:f,updateBoundingSphere:C,createRenderableState:g,updateRenderableState:b,createPositionIterator:m};function m(y,x){let A=y.sphereCount,v=x.instanceCount.ref.value,_=Ic(),I=_.position,T=y.centerBuffer.ref.value,E=x.aTransform.ref.value;return Mr(A,v,1,(S,P)=>(P<0?D.fromArray(I,T,S*3):D.transformMat4Offset(I,T,E,0,S*3,P*16),_))}function p(y,x,A,v,_){let{instanceCount:I,groupCount:T}=A,E=m(y,x),w=$i(A,E,v.color),S=Sl(A,v.size),P=_.instanceGranularity?to(I,"instance"):to(I*T,"groupInstance"),k=yl(),L=vl(),R=Cl(),N=xl(),F=bl(),H={drawCount:y.sphereCount*2*3,vertexCount:y.sphereCount*6,groupCount:T,instanceCount:I},V=y.boundingSphere.radius?q0(S)*_.sizeFactor:0,q=Pe.expand(Pe(),y.boundingSphere,V),Q=xi(q,x.aTransform.ref.value,I,0);return y.shaderData.update({lodLevels:_.lodLevels,sizeFactor:_.sizeFactor}),{dGeometryType:G.create("spheres"),uTexDim:y.shaderData.texDim,tPositionGroup:y.shaderData.positionGroup,boundingSphere:G.create(Q),invariantBoundingSphere:G.create(q),uInvariantBoundingSphere:G.create(Ht.ofSphere(q)),...w,...S,...P,...k,...L,...R,...N,...F,...x,padding:G.create(V),...at.createValues(_,H),uSizeFactor:y.shaderData.sizeFactor,uDoubleSided:G.create(_.doubleSided),dIgnoreLight:G.create(_.ignoreLight),dXrayShaded:G.create(_.xrayShaded==="inverted"?"inverted":_.xrayShaded===!0?"on":"off"),dTransparentBackfaces:G.create(_.transparentBackfaces),dSolidInterior:G.create(_.solidInterior),dClipPrimitive:G.create(_.clipPrimitive),dApproximate:G.create(_.approximate),uAlphaThickness:G.create(_.alphaThickness),uBumpFrequency:G.create(_.bumpFrequency),uBumpAmplitude:G.create(_.bumpAmplitude),lodLevels:y.shaderData.lodLevels,centerBuffer:y.centerBuffer,groupBuffer:y.groupBuffer}}function h(y,x,A,v,_){let I=at.createSimple(A,v,_),T={...M.getDefaultValues(e.Params),...x};return p(y,I.transform,I.locationIterator,I.theme,T)}function f(y,x){at.updateValues(y,x),G.updateIfChanged(y.uSizeFactor,x.sizeFactor),G.updateIfChanged(y.uDoubleSided,x.doubleSided),G.updateIfChanged(y.dIgnoreLight,x.ignoreLight),G.updateIfChanged(y.dXrayShaded,x.xrayShaded==="inverted"?"inverted":x.xrayShaded===!0?"on":"off"),G.updateIfChanged(y.dTransparentBackfaces,x.transparentBackfaces),G.updateIfChanged(y.dSolidInterior,x.solidInterior),G.updateIfChanged(y.dClipPrimitive,x.clipPrimitive),G.updateIfChanged(y.dApproximate,x.approximate),G.updateIfChanged(y.uAlphaThickness,x.alphaThickness),G.updateIfChanged(y.uBumpFrequency,x.bumpFrequency),G.updateIfChanged(y.uBumpAmplitude,x.bumpAmplitude);let A=c(y.lodLevels.ref.value);if(!a(x.lodLevels,A)){let v=y.uVertexCount.ref.value/6,_=d(x.lodLevels,x.sizeFactor),I=s(y.tPositionGroup.ref.value,y.centerBuffer.ref.value,y.groupBuffer.ref.value,v,_),T=I?l(x.lodLevels,x.sizeFactor,I,v):[];G.update(y.tPositionGroup,y.tPositionGroup.ref.value),G.update(y.lodLevels,T)}}function C(y,x){let A=x.boundingSphere.radius?q0(y)*y.uSizeFactor.ref.value:0,v=Pe.expand(Pe(),x.boundingSphere,A),_=xi(v,y.aTransform.ref.value,y.instanceCount.ref.value,0);Pe.equals(_,y.boundingSphere.ref.value)||G.update(y.boundingSphere,_),Pe.equals(v,y.invariantBoundingSphere.ref.value)||(G.update(y.invariantBoundingSphere,v),G.update(y.uInvariantBoundingSphere,Ht.fromSphere(y.uInvariantBoundingSphere.ref.value,v))),G.update(y.padding,A)}function g(y){let x=at.createRenderableState(y);return b(x,y),x}function b(y,x){at.updateRenderableState(y,x),y.opaque=y.opaque&&!x.xrayShaded,y.writeDepth=y.opaque}})(Ra||(Ra={}));var Ns;(function(e){class t{constructor(){this.index=0,this.textures=[]}get(){return this.textures[this.index]}set(p,h,f){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:p,group:h,normal:f}),this.index=(this.index+1)%2}destroy(){for(let p of this.textures)p.vertex.destroy(),p.group.destroy(),p.normal.destroy()}}e.DoubleBuffer=t;function r(m,p,h,f,C,g,b){let y=h.getWidth(),x=h.getHeight();return b?(b.vertexCount=m,b.groupCount=p,G.update(b.geoTextureDim,Ve.set(b.geoTextureDim.ref.value,y,x)),G.update(b.vertexTexture,h),G.update(b.groupTexture,f),G.update(b.normalTexture,C),b.doubleBuffer.set(h,f,C),Pe.copy(b.boundingSphere,g),b):{kind:"texture-mesh",vertexCount:m,groupCount:p,geoTextureDim:G.create(Ve.create(y,x)),vertexTexture:G.create(h),groupTexture:G.create(f),normalTexture:G.create(C),varyingGroup:G.create(!1),doubleBuffer:new t,boundingSphere:Pe.clone(g),meta:{}}}e.create=r;function n(m){let p=m?m.vertexTexture.ref.value:Ro(),h=m?m.groupTexture.ref.value:Ro(),f=m?m.normalTexture.ref.value:Ro(),C=m?m.boundingSphere:Pe();return r(0,0,p,h,f,C,m)}e.createEmpty=n,e.Params={...at.Params,doubleSided:M.Boolean(!1,at.CustomQualityParamInfo),flipSided:M.Boolean(!1,at.ShadingCategory),flatShaded:M.Boolean(!1,at.ShadingCategory),ignoreLight:M.Boolean(!1,at.ShadingCategory),xrayShaded:M.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],at.ShadingCategory),transparentBackfaces:M.Select("off",M.arrayToOptions(["off","on","opaque"]),at.ShadingCategory),bumpFrequency:M.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),bumpAmplitude:M.Numeric(1,{min:0,max:5,step:.1},at.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:n,createValues:s,createValuesSimple:a,updateValues:l,updateBoundingSphere:c,createRenderableState:u,updateRenderableState:d,createPositionIterator:i};let o="texture-mesh";function i(m,p){let h=m.meta.webgl;if(!h)return Mr(1,1,1,()=>bs);h.namedFramebuffers[o]||(h.namedFramebuffers[o]=h.resources.framebuffer());let f=h.namedFramebuffers[o],[C,g]=m.geoTextureDim.ref.value,b=new Float32Array(C*g*4);f.bind(),m.vertexTexture.ref.value.attachFramebuffer(f,0),h.readPixels(0,0,C,g,b);let y=new Float32Array(C*g*4);f.bind(),m.normalTexture.ref.value.attachFramebuffer(f,0),h.readPixels(0,0,C,g,y);let x=m.vertexCount,A=p.instanceCount.ref.value,v=Ic(),_=v.position,I=v.normal,T=p.aTransform.ref.value;return Mr(x,A,1,(w,S)=>(S<0?(D.fromArray(_,b,w*4),D.fromArray(I,y,w*4)):(D.transformMat4Offset(_,b,T,0,w*4,S*16),D.transformDirectionOffset(I,y,T,0,w*4,S*16)),v))}function s(m,p,h,f,C){let{instanceCount:g,groupCount:b}=h,y=e.Utils.createPositionIterator(m,p),x=$i(h,y,f.color),A=C.instanceGranularity?to(g,"instance"):to(g*b,"groupInstance"),v=yl(),_=vl(),I=Cl(),T=xl(),E=bl(),w={drawCount:m.vertexCount,vertexCount:m.vertexCount,groupCount:b,instanceCount:g},S=Pe.clone(m.boundingSphere),P=xi(S,p.aTransform.ref.value,g,0);return{dGeometryType:G.create("textureMesh"),uGeoTexDim:m.geoTextureDim,tPosition:m.vertexTexture,tGroup:m.groupTexture,tNormal:m.normalTexture,dVaryingGroup:m.varyingGroup,boundingSphere:G.create(P),invariantBoundingSphere:G.create(S),uInvariantBoundingSphere:G.create(Ht.ofSphere(S)),...x,...A,...v,..._,...I,...T,...E,...p,...at.createValues(C,w),uDoubleSided:G.create(C.doubleSided),dFlatShaded:G.create(C.flatShaded),dFlipSided:G.create(C.flipSided),dIgnoreLight:G.create(C.ignoreLight),dXrayShaded:G.create(C.xrayShaded==="inverted"?"inverted":C.xrayShaded===!0?"on":"off"),dTransparentBackfaces:G.create(C.transparentBackfaces),uBumpFrequency:G.create(C.bumpFrequency),uBumpAmplitude:G.create(C.bumpAmplitude),meta:G.create(m.meta)}}function a(m,p,h,f,C){let g=at.createSimple(h,f,C),b={...M.getDefaultValues(e.Params),...p};return s(m,g.transform,g.locationIterator,g.theme,b)}function l(m,p){at.updateValues(m,p),G.updateIfChanged(m.uDoubleSided,p.doubleSided),G.updateIfChanged(m.dFlatShaded,p.flatShaded),G.updateIfChanged(m.dFlipSided,p.flipSided),G.updateIfChanged(m.dIgnoreLight,p.ignoreLight),G.updateIfChanged(m.dXrayShaded,p.xrayShaded==="inverted"?"inverted":p.xrayShaded===!0?"on":"off"),G.updateIfChanged(m.dTransparentBackfaces,p.transparentBackfaces),G.updateIfChanged(m.uBumpFrequency,p.bumpFrequency),G.updateIfChanged(m.uBumpAmplitude,p.bumpAmplitude)}function c(m,p){let h=Pe.clone(p.boundingSphere),f=xi(h,m.aTransform.ref.value,m.instanceCount.ref.value,0);Pe.equals(f,m.boundingSphere.ref.value)||G.update(m.boundingSphere,f),Pe.equals(h,m.invariantBoundingSphere.ref.value)||(G.update(m.invariantBoundingSphere,h),G.update(m.uInvariantBoundingSphere,Ht.fromSphere(m.uInvariantBoundingSphere.ref.value,h)))}function u(m){let p=at.createRenderableState(m);return d(p,m),p}function d(m,p){at.updateRenderableState(m,p),m.opaque=m.opaque&&!p.xrayShaded,m.writeDepth=m.opaque}})(Ns||(Ns={}));function Ere(e,t){let r={},n={},o={},i={},s={},a={},l={};return Object.keys(e).forEach(c=>{let u=e[c];u.type==="attribute"&&(r[c]=t[c]),u.type==="define"&&(n[c]=t[c]),u.type==="texture"&&t[c]!==void 0&&(u.variant==="material"?i[c]=t[c]:o[c]=t[c]),u.type==="uniform"&&t[c]!==void 0&&(u.variant==="material"?a[c]=t[c]:u.variant==="buffered"?l[c]=t[c]:s[c]=t[c])}),{attributeValues:r,defineValues:n,textureValues:o,materialTextureValues:i,uniformValues:s,materialUniformValues:a,bufferedUniformValues:l}}function Pre(e){let t={};return Object.keys(e).forEach(r=>{t[r]=e[r].ref.version}),t}function cn(e,t,r){return{type:"attribute",kind:e,itemSize:t,divisor:r}}function Re(e,t){return{type:"uniform",kind:e,variant:t}}function kt(e,t,r,n,o){return{type:"texture",kind:e,format:t,dataType:r,filter:n,variant:o}}function hm(e){return{type:"elements",kind:e}}function Bt(e,t){return{type:"define",kind:e,options:t}}function jn(e){return{type:"value",kind:e}}var Il={uDrawId:Re("i"),uModel:Re("m4"),uView:Re("m4"),uInvView:Re("m4"),uModelView:Re("m4"),uInvModelView:Re("m4"),uProjection:Re("m4"),uInvProjection:Re("m4"),uModelViewProjection:Re("m4"),uInvModelViewProjection:Re("m4"),uIsOrtho:Re("f"),uPixelRatio:Re("f"),uViewport:Re("v4"),uViewOffset:Re("v2"),uDrawingBufferSize:Re("v2"),uCameraPosition:Re("v3"),uCameraDir:Re("v3"),uCameraPlane:Re("v4"),uNear:Re("f"),uFar:Re("f"),uFog:Re("b"),uFogNear:Re("f"),uFogFar:Re("f"),uFogColor:Re("v3"),uTransparentBackground:Re("b"),uLightDirection:Re("v3[]"),uLightColor:Re("v3[]"),uAmbientColor:Re("v3"),uPickingAlphaThreshold:Re("f"),uInteriorDarkening:Re("f"),uInteriorColorFlag:Re("b"),uInteriorColor:Re("v3"),uHighlightColor:Re("v3"),uSelectColor:Re("v3"),uDimColor:Re("v3"),uHighlightStrength:Re("f"),uSelectStrength:Re("f"),uDimStrength:Re("f"),uMarkerPriority:Re("i"),uMarkerAverage:Re("f"),uXrayEdgeFalloff:Re("f"),uExposure:Re("f"),uRenderMask:Re("i"),uMarkingDepthTest:Re("b"),uMarkingType:Re("i"),uPickType:Re("i")},Al={tDepth:kt("texture","depth","ushort","nearest"),tDpoitDepth:kt("texture","rg","float","nearest"),tDpoitFrontColor:kt("texture","rgba","float","nearest"),tDpoitBackColor:kt("texture","rgba","float","nearest")},wl={uObjectId:Re("i")},gRe={uColor:Re("v3","material"),uColorTexDim:Re("v2"),uColorGridDim:Re("v3"),uColorGridTransform:Re("v4"),tColor:kt("image-uint8","rgb","ubyte","nearest"),tPalette:kt("image-uint8","rgb","ubyte","nearest"),tColorGrid:kt("texture","rgb","ubyte","linear"),dColorType:Bt("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:Bt("boolean")},zf={uSize:Re("f","material"),uSizeTexDim:Re("v2"),tSize:kt("image-uint8","rgb","ubyte","nearest"),dSizeType:Bt("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Re("f","material")},yRe={uMarker:Re("f"),uMarkerTexDim:Re("v2"),tMarker:kt("image-uint8","alpha","ubyte","nearest"),markerAverage:jn("number"),markerStatus:jn("number"),dMarkerType:Bt("string",["instance","groupInstance"])},vRe={uOverpaintTexDim:Re("v2"),tOverpaint:kt("image-uint8","rgba","ubyte","nearest"),dOverpaint:Bt("boolean"),uOverpaintGridDim:Re("v3"),uOverpaintGridTransform:Re("v4"),tOverpaintGrid:kt("texture","rgba","ubyte","linear"),dOverpaintType:Bt("string",["instance","groupInstance","volumeInstance"]),uOverpaintStrength:Re("f","material")},bRe={uTransparencyTexDim:Re("v2"),tTransparency:kt("image-uint8","alpha","ubyte","nearest"),dTransparency:Bt("boolean"),transparencyAverage:jn("number"),uTransparencyGridDim:Re("v3"),uTransparencyGridTransform:Re("v4"),tTransparencyGrid:kt("texture","alpha","ubyte","linear"),dTransparencyType:Bt("string",["instance","groupInstance","volumeInstance"]),uTransparencyStrength:Re("f","material")},xRe={uEmissiveTexDim:Re("v2"),tEmissive:kt("image-uint8","alpha","ubyte","nearest"),dEmissive:Bt("boolean"),emissiveAverage:jn("number"),uEmissiveGridDim:Re("v3"),uEmissiveGridTransform:Re("v4"),tEmissiveGrid:kt("texture","alpha","ubyte","linear"),dEmissiveType:Bt("string",["instance","groupInstance","volumeInstance"]),uEmissiveStrength:Re("f","material")},CRe={uSubstanceTexDim:Re("v2"),tSubstance:kt("image-uint8","rgba","ubyte","nearest"),dSubstance:Bt("boolean"),uSubstanceGridDim:Re("v3"),uSubstanceGridTransform:Re("v4"),tSubstanceGrid:kt("texture","rgba","ubyte","linear"),dSubstanceType:Bt("string",["instance","groupInstance","volumeInstance"]),uSubstanceStrength:Re("f","material")},SRe={uClippingTexDim:Re("v2"),tClipping:kt("image-uint8","alpha","ubyte","nearest"),dClipping:Bt("boolean"),dClippingType:Bt("string",["instance","groupInstance"])},_l={dGeometryType:Bt("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"]),...gRe,...yRe,...vRe,...bRe,...xRe,...CRe,...SRe,dLightCount:Bt("number"),dColorMarker:Bt("boolean"),dClipObjectCount:Bt("number"),dClipVariant:Bt("string",["instance","pixel"]),uClipObjectType:Re("i[]","material"),uClipObjectInvert:Re("b[]","material"),uClipObjectPosition:Re("v3[]","material"),uClipObjectRotation:Re("v4[]","material"),uClipObjectScale:Re("v3[]","material"),aInstance:cn("float32",1,1),aTransform:cn("float32",16,1),uAlpha:Re("f","material"),uMetalness:Re("f","material"),uRoughness:Re("f","material"),uBumpiness:Re("f","material"),uEmissive:Re("f","material"),uVertexCount:Re("i"),uInstanceCount:Re("i"),uGroupCount:Re("i"),uInvariantBoundingSphere:Re("v4"),uLod:Re("v4"),drawCount:jn("number"),instanceCount:jn("number"),alpha:jn("number"),matrix:jn("m4"),transform:jn("float32"),extraTransform:jn("float32"),hasReflection:jn("boolean"),instanceGranularity:jn("boolean"),boundingSphere:jn("sphere"),invariantBoundingSphere:jn("sphere"),instanceGrid:jn("instanceGrid")};var Dre=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords);
}
`;var Kn=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

void main(void) {
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var IRe=ei();function ARe(e,t){let{gl:r}=e;switch(t){case"points":return r.POINTS;case"lines":return r.LINES;case"line-strip":return r.LINE_STRIP;case"line-loop":return r.LINE_LOOP;case"triangles":return r.TRIANGLES;case"triangle-strip":return r.TRIANGLE_STRIP;case"triangle-fan":return r.TRIANGLE_FAN}}var wRe={color:"",pick:"",depth:"",marking:"",emissive:""},_Re=Object.keys(wRe),TRe={compute:""},ERe=Object.keys(TRe);function bV(e,t,r,n,o){return r={...r,dRenderVariant:G.create(t)},o.dRenderVariant===void 0&&Object.defineProperty(o,"dRenderVariant",{value:Bt("string")}),e.resources.program(r,n,o)}function PRe(){return{attributes:!1,defines:!1,elements:!1,textures:!1}}function DRe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}function xV(e,t){if(e==="color")switch(t){case"blended":return"colorBlended";case"wboit":return"colorWboit";case"dpoit":return"colorDpoit"}return e}function Tl(e,t,r,n,o,i,s){return kre(e,t,r,n,o,i,_Re,s)}function on(e,t,r,n,o,i=-1){return kre(e,t,r,n,o,i,ERe,void 0)}function kre(e,t,r,n,o,i,s,a){let l=IRe(),{stats:c,state:u,resources:d}=e,{instancedArrays:m,vertexArrayObject:p,multiDrawInstancedBaseVertexBaseInstance:h,drawInstancedBaseVertexBaseInstance:f}=e.extensions;if(o.uVertexCount&&!e.extensions.noNonInstancedActiveAttribs){let z=o.uVertexCount.ref.value;o.aVertex=G.create(Rs(new Float32Array(z))),n.aVertex=cn("float32",1,0)}let{attributeValues:C,defineValues:g,textureValues:b,materialTextureValues:y,uniformValues:x,materialUniformValues:A,bufferedUniformValues:v}=Ere(n,o),_=Object.entries(x),I=Object.entries(A),T=Object.entries(v),E=Object.entries(Bee(v)),w=Object.entries(g),S=Pre(o),P=ARe(e,t),k={};for(let z of s)k[z]=bV(e,xV(z,a),g,r,n);let L=U5(e,n,b),R=U5(e,n,y),N=Oee(e,n,C),F=[];for(let z=0,$=N.length;z<$;++z){let Z=N[z];Z[1].divisor===1&&F.push(Z)}let H,V=o.elements;V&&V.ref.value&&(H=d.elements(V.ref.value));let q={};for(let z of s)q[z]=p?d.vertexArray(k[z],N,H):null;let Q=o.drawCount.ref.value,O=o.instanceCount.ref.value;c.drawCount+=Q,c.instanceCount+=O,c.instancedDrawCount+=O*Q;let B=PRe(),j=!1,U=-1;return{id:l,materialId:i,getProgram:z=>k[z],setTransparency:z=>{if(z!==a){a=z;for(let $ of s)k[$].destroy(),k[$]=bV(e,xV($,a),g,r,n)}},render:(z,$,Z)=>{if(Q===0||O===0)return;let J=k[z];if(J.id===U&&u.currentRenderItemId===l)J.setUniforms(_),J.bindTextures(L,$);else{let ie=q[z];(J.id!==u.currentProgramId||J.id!==U||i===-1||i!==u.currentMaterialId)&&(J.id!==u.currentProgramId&&J.use(),J.setUniforms(I),J.bindTextures(R,$+L.length),u.currentMaterialId=i,U=J.id),J.setUniforms(_),J.setUniforms(E),J.bindTextures(L,$),ie?(ie.bind(),H&&H.bind()):(H&&H.bind(),J.bindAttributes(N)),u.currentRenderItemId=l}if(lr)try{Ib(e.gl)}catch(ie){throw new Error(`Framebuffer error rendering item id ${l}: '${ie}'`)}if(Z){for(let ie of Z)if(ie.count!==0){if(J.setUniforms(ie.uniforms),h)H?h.multiDrawElementsInstancedBaseVertexBaseInstance(P,ie.counts,0,H._dataType,ie.offsets,0,ie.instanceCounts,0,ie.baseVertices,0,ie.baseInstances,0,ie.count):h.multiDrawArraysInstancedBaseInstance(P,ie.firsts,0,ie.counts,0,ie.instanceCounts,0,ie.baseInstances,0,ie.count);else if(f)if(H)for(let ne=0;ne<ie.count;++ne)ie.counts[ne]>0&&(J.uniform("uDrawId",ne),f.drawElementsInstancedBaseVertexBaseInstance(P,ie.counts[ne],H._dataType,ie.offsets[ne],ie.instanceCounts[ne],ie.baseVertices[ne],ie.baseInstances[ne]));else for(let ne=0;ne<ie.count;++ne)ie.counts[ne]>0&&(J.uniform("uDrawId",ne),f.drawArraysInstancedBaseInstance(P,ie.firsts[ne],ie.counts[ne],ie.instanceCounts[ne],ie.baseInstances[ne]));else if(H)for(let ne=0;ne<ie.count;++ne)ie.counts[ne]>0&&(J.uniform("uDrawId",ne),J.offsetAttributes(F,ie.baseInstances[ne]),m.drawElementsInstanced(P,ie.counts[ne],H._dataType,ie.offsets[ne],ie.instanceCounts[ne]));else for(let ne=0;ne<ie.count;++ne)ie.counts[ne]>0&&(J.uniform("uDrawId",ne),J.offsetAttributes(F,ie.baseInstances[ne]),m.drawArraysInstanced(P,0,ie.counts[ne],ie.instanceCounts[ne]));if(bt){h?c.calls.multiDrawInstancedBase+=1:f?c.calls.drawInstancedBase+=ie.count:c.calls.drawInstanced+=ie.count;for(let ne=0;ne<ie.count;++ne)c.calls.counts+=ie.instanceCounts[ne]}}}else H?m.drawElementsInstanced(P,Q,H._dataType,0,O):m.drawArraysInstanced(P,0,Q,O),bt&&(c.calls.drawInstanced+=1,c.calls.counts+=O);if(lr)try{V5(e.gl)}catch(ie){throw new Error(`Draw error rendering item id ${l}: '${ie}'`)}},update:()=>{if(DRe(B),o.aVertex){let z=o.uVertexCount.ref.value;o.aVertex.ref.value.length<z&&G.update(o.aVertex,Rs(new Float32Array(z)))}for(let z=0,$=w.length;z<$;++z){let[Z,J]=w[z];J.ref.version!==S[Z]&&(B.defines=!0,S[Z]=J.ref.version)}if(B.defines)for(let z of s)k[z].destroy(),k[z]=bV(e,xV(z,a),g,r,n);o.drawCount.ref.version!==S.drawCount&&(c.drawCount+=o.drawCount.ref.value-Q,c.instancedDrawCount+=O*o.drawCount.ref.value-O*Q,Q=o.drawCount.ref.value,S.drawCount=o.drawCount.ref.version),o.instanceCount.ref.version!==S.instanceCount&&(c.instanceCount+=o.instanceCount.ref.value-O,c.instancedDrawCount+=o.instanceCount.ref.value*Q-O*Q,O=o.instanceCount.ref.value,S.instanceCount=o.instanceCount.ref.version);for(let z=0,$=N.length;z<$;++z){let[Z,J]=N[z],ie=C[Z];if(ie.ref.version!==S[Z]){if(J.length>=ie.ref.value.length)J.updateSubData(ie.ref.value,0,J.length);else{J.destroy();let{itemSize:ne,divisor:le}=n[Z];N[z][1]=d.attribute(ie.ref.value,ne,le),B.attributes=!0}S[Z]=ie.ref.version}}if(H&&o.elements.ref.version!==S.elements&&(H.length>=o.elements.ref.value.length?H.updateSubData(o.elements.ref.value,0,H.length):(H.destroy(),H=d.elements(o.elements.ref.value),B.elements=!0),S.elements=o.elements.ref.version),B.attributes||B.defines||B.elements)for(let z of s){let $=q[z];$&&$.destroy(),q[z]=p?d.vertexArray(k[z],N,H):null}for(let z=0,$=L.length;z<$;++z){let[Z,J]=L[z],ie=b[Z];ie.ref.version!==S[Z]&&(n[Z].kind!=="texture"?(J.load(ie.ref.value),B.textures=!0):L[z][1]=ie.ref.value,S[Z]=ie.ref.version)}for(let z=0,$=R.length;z<$;++z){let[Z,J]=R[z],ie=y[Z];ie.ref.version!==S[Z]&&(n[Z].kind!=="texture"?(J.load(ie.ref.value),B.textures=!0):R[z][1]=ie.ref.value,S[Z]=ie.ref.version)}for(let z=0,$=T.length;z<$;++z){let[Z,J]=T[z];J.ref.version!==S[Z]&&(G.update(E[z][1],Xa(J.ref.value)),S[Z]=J.ref.version)}},destroy:()=>{if(!j){for(let z of s){k[z].destroy();let $=q[z];$&&$.destroy()}L.forEach(([z,$])=>{n[z].kind!=="texture"&&$.destroy()}),R.forEach(([z,$])=>{n[z].kind!=="texture"&&$.destroy()}),N.forEach(([z,$])=>$.destroy()),H&&H.destroy(),c.drawCount-=Q,c.instanceCount-=O,c.instancedDrawCount-=O*Q,j=!0}}}}function Si(){return Si.create(D.create(1,0,0),0)}(function(e){function t(f,C){return{normal:f,constant:C}}e.create=t;function r(f,C){return D.copy(f.normal,C.normal),f.constant=C.constant,f}e.copy=r;function n(f){return r(e(),f)}e.clone=n;function o(f,C){let g=1/D.magnitude(C.normal);return D.scale(f.normal,C.normal,g),f.constant=C.constant*g,f}e.normalize=o;function i(f,C){return D.negate(f.normal,C.normal),f.constant=-C.constant,f}e.negate=i;function s(f,C,g){return D.toArray(f.normal,C,g),C[g+3]=f.constant,C}e.toArray=s;function a(f,C,g){return D.fromArray(f.normal,C,g),f.constant=C[g+3],f}e.fromArray=a;function l(f,C,g){return D.copy(f.normal,C),f.constant=-D.dot(f.normal,g),f}e.fromNormalAndCoplanarPoint=l;function c(f,C,g,b){let y=D.triangleNormal(D(),C,g,b);return l(f,y,C),f}e.fromCoplanarPoints=c;let u=D();function d(f,C,g,b,y){D.set(u,C,g,b);let x=1/D.magnitude(u);return D.scale(f.normal,u,x),f.constant=y*x,f}e.setUnnormalized=d;function m(f,C){return D.dot(f.normal,C)+f.constant}e.distanceToPoint=m;function p(f,C){return m(f,C.center)-C.radius}e.distanceToSpher3D=p;function h(f,C,g){return D.scaleAndAdd(f,f,C.normal,-m(C,g))}e.projectPoint=h})(Si||(Si={}));function mg(){return mg.create(Si(),Si(),Si(),Si(),Si(),Si())}(function(e){function t(c,u,d,m,p,h){return[c,u,d,m,p,h]}e.create=t;function r(c,u){for(let d=0;d<6;++d)Si.copy(c[d],u[d]);return c}e.copy=r;function n(c){return r(e(),c)}e.clone=n;function o(c,u){let d=u[0],m=u[1],p=u[2],h=u[3],f=u[4],C=u[5],g=u[6],b=u[7],y=u[8],x=u[9],A=u[10],v=u[11],_=u[12],I=u[13],T=u[14],E=u[15];return Si.setUnnormalized(c[0],h-d,b-f,v-y,E-_),Si.setUnnormalized(c[1],h+d,b+f,v+y,E+_),Si.setUnnormalized(c[2],h+m,b+C,v+x,E+I),Si.setUnnormalized(c[3],h-m,b-C,v-x,E-I),Si.setUnnormalized(c[4],h-p,b-g,v-A,E-T),Si.setUnnormalized(c[5],h+p,b+g,v+A,E+T),c}e.fromProjectionMatrix=o;function i(c,u){let d=u.center,m=-u.radius;for(let p=0;p<6;++p)if(Si.distanceToPoint(c[p],d)<m)return!1;return!0}e.intersectsSphere3D=i;let s=D();function a(c,u){for(let d=0;d<6;++d){let m=c[d];if(s[0]=m.normal[0]>0?u.max[0]:u.min[0],s[1]=m.normal[1]>0?u.max[1]:u.min[1],s[2]=m.normal[2]>0?u.max[2]:u.min[2],Si.distanceToPoint(m,s)<0)return!1}return!0}e.intersectsBox3D=a;function l(c,u){for(let d=0;d<6;++d)if(Si.distanceToPoint(c[d],u)<0)return!1;return!0}e.containsPoint=l})(mg||(mg={}));var E3=Si.distanceToPoint,P3=mg.intersectsSphere3D,D3=Pe.fromArray,Mre=ei();function CV(e,t){return t&&t.instanceCounts.length>=e?t:{firsts:new Int32Array(e),counts:new Int32Array(e),offsets:new Int32Array(e),instanceCounts:new Int32Array(e),baseVertices:new Int32Array(e),baseInstances:new Uint32Array(e),count:0,uniforms:[]}}function El(e,t,r){let n=Mre(),o=CV(0),i=[],s=!1,a=-1,l=Pe(),c=()=>{var u;let d=(u=t.lodLevels)===null||u===void 0?void 0:u.ref.value;if(d&&d.length>0){let{cellCount:m}=t.instanceGrid.ref.value;i.length=d.length;for(let p=0,h=d.length;p<h;++p)i[p]=CV(m,i[p]),i[p].count=0;if(t.lodLevels.ref.version!==a){for(let p=0,h=d.length;p<h;++p)i[p].uniforms.length!==1&&(i[p].uniforms.length=1,i[p].uniforms[0]=["uLod",G.create(Ht())]),G.update(i[p].uniforms[0][1],Ht.set(i[p].uniforms[0][1].ref.value,d[p][0],d[p][1],d[p][2],d[p][4]));a=t.lodLevels.ref.version}}};return c(),{id:n,materialId:e.materialId,values:t,state:r,cull:(u,d,m,p)=>{var h,f;if(s=!1,t.drawCount.ref.value===0||t.instanceCount.ref.value===0||t.instanceGrid.ref.value.cellSize<=1)return;let{cellOffsets:C,cellSpheres:g,cellCount:b,batchOffsets:y,batchSpheres:x,batchCount:A,batchCell:v,batchSize:_}=t.instanceGrid.ref.value,[I,T]=t.uLod.ref.value,E=I!==0||T!==0,w=2*_,S=(h=t.lodLevels)===null||h===void 0?void 0:h.ref.value;if(S&&S.length>0){if(((f=t.lodLevels)===null||f===void 0?void 0:f.ref.version)!==a)c();else for(let P=0,k=S.length;P<k;++P)i[P].count=0;for(let P=0;P<A;++P){let k=y[P],L=y[P+1];if(L-k===0)continue;D3(l,x,P*4);let N=E3(u,l.center);if(E&&(N+l.radius<I||N-l.radius>T)){bt&&(p.culled.lod+=C[v[L-1]+1]-C[v[k]]);continue}if(!P3(d,l)){bt&&(p.culled.frustum+=C[v[L-1]+1]-C[v[k]]);continue}if(m!==null&&m(l)){bt&&(p.culled.occlusion+=C[v[L-1]+1]-C[v[k]]);continue}for(let F=k;F<L;++F){let H=v[F],V=C[H],Q=C[H+1]-V;if(Q===0)continue;D3(l,g,H*4);let O=E3(u,l.center);if(E&&(O+l.radius<I||O-l.radius>T)){bt&&(p.culled.lod+=Q);continue}if(!P3(d,l)){bt&&(p.culled.frustum+=Q);continue}if(m!==null&&O-l.radius<w&&m(l)){bt&&(p.culled.occlusion+=Q);continue}for(let B=0,j=S.length;B<j;++B){if(O+l.radius<S[B][0]||O-l.radius>S[B][1])continue;let U=i[B],z=U.count;z>0&&U.baseInstances[z-1]+U.instanceCounts[z-1]===V&&U.counts[z-1]===S[B][3]?U.instanceCounts[z-1]+=Q:(U.counts[z]=S[B][3],U.instanceCounts[z]=Q,U.baseInstances[z]=V,U.count+=1)}}}}else{o=CV(b,o);let{baseInstances:P,instanceCounts:k,counts:L}=o,R=0;for(let N=0;N<A;++N){let F=y[N],H=y[N+1];if(H-F!==0){if(D3(l,x,N*4),E){let q=E3(u,l.center);if(q+l.radius<I||q-l.radius>T){bt&&(p.culled.lod+=C[v[H-1]+1]-C[v[F]]);continue}}if(!P3(d,l)){bt&&(p.culled.frustum+=C[v[H-1]+1]-C[v[F]]);continue}if(m!==null&&m(l)){bt&&(p.culled.occlusion+=C[v[H-1]+1]-C[v[F]]);continue}for(let q=F;q<H;++q){let Q=v[q],O=C[Q],j=C[Q+1]-O;if(j===0)continue;D3(l,g,Q*4);let U=E3(u,l.center);if(E&&(U+l.radius<I||U-l.radius>T)){bt&&(p.culled.lod+=j);continue}if(!P3(d,l)){bt&&(p.culled.frustum+=j);continue}if(m!==null&&U-l.radius<w&&m(l)){bt&&(p.culled.occlusion+=j);continue}R>0&&P[R-1]+k[R-1]===O?k[R-1]+=j:(L[R]=t.drawCount.ref.value,k[R]=j,P[R]=O,R+=1)}}}o.count=R,i.length=1,i[0]=o,i[0].uniforms.length=0}s=!0},uncull:()=>{s=!1},render:(u,d)=>{t.uAlpha&&t.alpha&&G.updateIfChanged(t.uAlpha,ko(t.alpha.ref.value*r.alphaFactor,0,1)),e.render(u,d,s?i:void 0)},getProgram:u=>e.getProgram(u),setTransparency:u=>e.setTransparency(u),update:()=>{e.update(),c()},dispose:()=>e.destroy()}}function sn(e,t){return{id:Mre(),values:t,render:()=>e.render("compute",0),update:()=>e.update(),dispose:()=>e.destroy()}}var B2=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),Rn={drawCount:jn("number"),instanceCount:jn("number"),aPosition:cn("float32",2,0),uQuadScale:Re("v2")},Bn={drawCount:G.create(6),instanceCount:G.create(1),aPosition:G.create(B2),uQuadScale:G.create(Ve.create(1,1))},kRe={...Rn,tColor:kt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2")},MRe=Gr("copy",Kn,Dre);function pg(e,t){let r={...Bn,tColor:G.create(t),uTexSize:G.create(Ve.create(t.getWidth(),t.getHeight()))},n={...kRe},o=on(e,"triangles",MRe,n,r);return sn(o,r)}var Rre=new Uint32Array([0,1,2,1,3,2]),RRe=new Float32Array([0,1,0,0,1,1,1,0]),Bre={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},Lre=Object.keys(Bre);var Up;(function(e){function t(m,p,h,f){return f?o(m,p,h,f):n(m,p,h)}e.create=t;function r(m){return di([m.cornerBuffer.ref.version])}function n(m,p,h){let f=Pe(),C=-1,g=m.width,b=m.height,y={kind:"image",imageTexture:G.create(m),imageTextureDim:G.create(Ve.create(g,b)),cornerBuffer:G.create(p),groupTexture:G.create(h),get boundingSphere(){let x=r(y);if(x!==C){let A=BRe(y.cornerBuffer.ref.value);Pe.copy(f,A),C=x}return f}};return y}function o(m,p,h,f){let C=m.width,g=m.height;return G.update(f.imageTexture,m),G.update(f.imageTextureDim,Ve.set(f.imageTextureDim.ref.value,C,g)),G.update(f.cornerBuffer,p),G.update(f.groupTexture,h),f}function i(m){let p=mo(0,4,Uint8Array),h=m?m.cornerBuffer.ref.value:new Float32Array(8*3),f=mo(0,4,Uint8Array);return t(p,h,f,m)}e.createEmpty=i,e.Params={...at.Params,interpolation:M.Select("bspline",M.objectToOptions(Bre))},e.Utils={Params:e.Params,createEmpty:i,createValues:s,createValuesSimple:a,updateValues:l,updateBoundingSphere:c,createRenderableState:u,updateRenderableState:d,createPositionIterator:()=>Mr(1,1,1,()=>bs)};function s(m,p,h,f,C){let{instanceCount:g,groupCount:b}=h,y=e.Utils.createPositionIterator(m,p),x=$i(h,y,f.color),A=C.instanceGranularity?to(g,"instance"):to(g*b,"groupInstance"),v=yl(),_=vl(),I=Cl(),T=xl(),E=bl(),w={drawCount:Rre.length,vertexCount:B2.length/3,groupCount:b,instanceCount:g},S=Pe.clone(m.boundingSphere),P=xi(S,p.aTransform.ref.value,g,0);return{dGeometryType:G.create("image"),...x,...A,...v,..._,...I,...T,...E,...p,...at.createValues(C,w),aPosition:m.cornerBuffer,aUv:G.create(RRe),elements:G.create(Rre),aGroup:G.create(Rs(new Float32Array(4))),boundingSphere:G.create(P),invariantBoundingSphere:G.create(S),uInvariantBoundingSphere:G.create(Ht.ofSphere(S)),dInterpolation:G.create(C.interpolation),uImageTexDim:m.imageTextureDim,tImageTex:m.imageTexture,tGroupTex:m.groupTexture}}function a(m,p,h,f,C){let g=at.createSimple(h,f,C),b={...M.getDefaultValues(e.Params),...p};return s(m,g.transform,g.locationIterator,g.theme,b)}function l(m,p){at.updateValues(m,p),G.updateIfChanged(m.dInterpolation,p.interpolation)}function c(m,p){let h=Pe.clone(p.boundingSphere),f=xi(h,m.aTransform.ref.value,m.instanceCount.ref.value,0);Pe.equals(f,m.boundingSphere.ref.value)||G.update(m.boundingSphere,f),Pe.equals(h,m.invariantBoundingSphere.ref.value)||(G.update(m.invariantBoundingSphere,h),G.update(m.uInvariantBoundingSphere,Ht.fromSphere(m.uInvariantBoundingSphere.ref.value,h)))}function u(m){let p=at.createRenderableState(m);return p.opaque=!1,p}function d(m,p){at.updateRenderableState(m,p),m.opaque=!1}})(Up||(Up={}));function BRe(e){let t=D(),r=[];for(let i=0,s=e.length;i<s;i+=3){let a=D.fromArray(D(),e,i);r.push(a),D.add(t,t,a)}D.scale(t,t,1/(e.length/3));let n=0;for(let i of r){let s=D.distance(t,i);s>n&&(n=s)}let o=Pe.create(t,n);return Pe.setExtrema(o,r),o}var ss;(function(e){function t(h,f,C,g,b,y,x,A,v,_){return _?i(h,f,C,g,b,y,x,A,v,_):o(h,f,C,g,b,y,x,A,v)}e.create=t;function r(h){let f=h?h.mappingBuffer.ref.value:new Float32Array(0),C=h?h.indexBuffer.ref.value:new Uint32Array(0),g=h?h.groupBuffer.ref.value:new Float32Array(0),b=h?h.startBuffer.ref.value:new Float32Array(0),y=h?h.endBuffer.ref.value:new Float32Array(0),x=h?h.scaleBuffer.ref.value:new Float32Array(0),A=h?h.capBuffer.ref.value:new Float32Array(0),v=h?h.colorModeBuffer.ref.value:new Float32Array(0);return t(f,C,g,b,y,x,A,v,0,h)}e.createEmpty=r;function n(h){return di([h.cylinderCount,h.mappingBuffer.ref.version,h.indexBuffer.ref.version,h.groupBuffer.ref.version,h.startBuffer.ref.version,h.endBuffer.ref.version,h.scaleBuffer.ref.version,h.capBuffer.ref.version,h.colorModeBuffer.ref.version])}function o(h,f,C,g,b,y,x,A,v){let _=Pe(),I,T=-1,E=-1,w={kind:"cylinders",cylinderCount:v,mappingBuffer:G.create(h),indexBuffer:G.create(f),groupBuffer:G.create(C),startBuffer:G.create(g),endBuffer:G.create(b),scaleBuffer:G.create(y),capBuffer:G.create(x),colorModeBuffer:G.create(A),get boundingSphere(){let S=n(w);if(S!==T){let P=Nu(w.startBuffer.ref.value,w.cylinderCount*6,6),k=Nu(w.endBuffer.ref.value,w.cylinderCount*6,6);Pe.expandBySphere(_,P,k),T=S}return _},get groupMapping(){return w.groupBuffer.ref.version!==E&&(I=dm(w.groupBuffer.ref.value,w.cylinderCount,6),E=w.groupBuffer.ref.version),I},setBoundingSphere(S){Pe.copy(_,S),T=n(w)}};return w}function i(h,f,C,g,b,y,x,A,v,_){return v>_.cylinderCount&&(G.update(_.mappingBuffer,h),G.update(_.indexBuffer,f)),_.cylinderCount=v,G.update(_.groupBuffer,C),G.update(_.startBuffer,g),G.update(_.endBuffer,b),G.update(_.scaleBuffer,y),G.update(_.capBuffer,x),G.update(_.colorModeBuffer,A),_}function s(h,f){let C=h.startBuffer.ref.value;um(f,C,0,h.cylinderCount*6),G.update(h.startBuffer,C);let g=h.endBuffer.ref.value;um(f,g,0,h.cylinderCount*6),G.update(h.endBuffer,g)}e.transform=s,e.Params={...at.Params,sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:M.Numeric(1,{min:0,max:3,step:.01}),doubleSided:M.Boolean(!1,at.CustomQualityParamInfo),ignoreLight:M.Boolean(!1,at.ShadingCategory),xrayShaded:M.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],at.ShadingCategory),transparentBackfaces:M.Select("off",M.arrayToOptions(["off","on","opaque"]),at.ShadingCategory),solidInterior:M.Boolean(!0,at.ShadingCategory),bumpFrequency:M.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),bumpAmplitude:M.Numeric(1,{min:0,max:5,step:.1},at.ShadingCategory),colorMode:M.Select("default",M.arrayToOptions(["default","interpolate"]),at.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:r,createValues:l,createValuesSimple:c,updateValues:u,updateBoundingSphere:d,createRenderableState:m,updateRenderableState:p,createPositionIterator:a};function a(h,f){let C=h.cylinderCount*6,g=f.instanceCount.ref.value,b=Ic(),y=b.position,x=h.startBuffer.ref.value,A=h.endBuffer.ref.value,v=f.aTransform.ref.value;return Mr(C,g,2,(I,T)=>{let E=I%6===0?x:A;return T<0?D.fromArray(y,E,I*3):D.transformMat4Offset(y,E,v,0,I*3,T*16),b})}function l(h,f,C,g,b){let{instanceCount:y,groupCount:x}=C,A=a(h,f),v=$i(C,A,g.color),_=Sl(C,g.size),I=b.instanceGranularity?to(y,"instance"):to(y*x,"groupInstance"),T=yl(),E=vl(),w=Cl(),S=xl(),P=bl(),k={drawCount:h.cylinderCount*4*3,vertexCount:h.cylinderCount*6,groupCount:x,instanceCount:y},L=q0(_)*b.sizeFactor,R=Pe.clone(h.boundingSphere),N=xi(R,f.aTransform.ref.value,y,0);return{dGeometryType:G.create("cylinders"),aMapping:h.mappingBuffer,aGroup:h.groupBuffer,aStart:h.startBuffer,aEnd:h.endBuffer,aScale:h.scaleBuffer,aCap:h.capBuffer,aColorMode:h.colorModeBuffer,elements:h.indexBuffer,boundingSphere:G.create(N),invariantBoundingSphere:G.create(R),uInvariantBoundingSphere:G.create(Ht.ofSphere(R)),...v,..._,...I,...T,...E,...w,...S,...P,...f,padding:G.create(L),...at.createValues(b,k),uSizeFactor:G.create(b.sizeFactor*b.sizeAspectRatio),uDoubleSided:G.create(b.doubleSided),dIgnoreLight:G.create(b.ignoreLight),dXrayShaded:G.create(b.xrayShaded==="inverted"?"inverted":b.xrayShaded===!0?"on":"off"),dTransparentBackfaces:G.create(b.transparentBackfaces),dSolidInterior:G.create(b.solidInterior),uBumpFrequency:G.create(b.bumpFrequency),uBumpAmplitude:G.create(b.bumpAmplitude),dDualColor:G.create(b.colorMode==="interpolate")}}function c(h,f,C,g,b){let y=at.createSimple(C,g,b),x={...M.getDefaultValues(e.Params),...f};return l(h,y.transform,y.locationIterator,y.theme,x)}function u(h,f){at.updateValues(h,f),G.updateIfChanged(h.uSizeFactor,f.sizeFactor*f.sizeAspectRatio),G.updateIfChanged(h.uDoubleSided,f.doubleSided),G.updateIfChanged(h.dIgnoreLight,f.ignoreLight),G.updateIfChanged(h.dXrayShaded,f.xrayShaded==="inverted"?"inverted":f.xrayShaded===!0?"on":"off"),G.updateIfChanged(h.dTransparentBackfaces,f.transparentBackfaces),G.updateIfChanged(h.dSolidInterior,f.solidInterior),G.updateIfChanged(h.uBumpFrequency,f.bumpFrequency),G.updateIfChanged(h.uBumpAmplitude,f.bumpAmplitude),G.updateIfChanged(h.dDualColor,f.colorMode==="interpolate")}function d(h,f){let C=Pe.clone(f.boundingSphere),g=xi(C,h.aTransform.ref.value,h.instanceCount.ref.value,0);Pe.equals(g,h.boundingSphere.ref.value)||G.update(h.boundingSphere,g),Pe.equals(C,h.invariantBoundingSphere.ref.value)||(G.update(h.invariantBoundingSphere,C),G.update(h.uInvariantBoundingSphere,Ht.fromSphere(h.uInvariantBoundingSphere.ref.value,C)))}function m(h){let f=at.createRenderableState(h);return p(f,h),f}function p(h,f){at.updateRenderableState(h,f),h.opaque=h.opaque&&!f.xrayShaded,h.writeDepth=h.opaque}})(ss||(ss={}));var Mi;(function(e){function t(s){switch(s.kind){case"mesh":return s.triangleCount*3;case"points":return s.pointCount;case"spheres":return s.sphereCount*2*3;case"cylinders":return s.cylinderCount*4*3;case"text":return s.charCount*2*3;case"lines":return s.lineCount*2*3;case"direct-volume":return 12*3;case"image":return 2*3;case"texture-mesh":return s.vertexCount}}e.getDrawCount=t;function r(s){switch(s.kind){case"mesh":return s.vertexCount;case"points":return s.pointCount;case"spheres":return s.sphereCount*6;case"cylinders":return s.cylinderCount*6;case"text":return s.charCount*4;case"lines":return s.lineCount*4;case"direct-volume":let[a,l,c]=s.gridDimension.ref.value;return a*l*c;case"image":return 4;case"texture-mesh":return s.vertexCount}}e.getVertexCount=r;function n(s){switch(s.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return t(s)===0?0:Da(s.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return Da(s.groupTexture.ref.value.array)+1;case"texture-mesh":return s.groupCount}}e.getGroupCount=n;function o(s){switch(s.kind){case"mesh":return Ct.Utils;case"points":return Gu.Utils;case"spheres":return Ra.Utils;case"cylinders":return ss.Utils;case"text":return Cs.Utils;case"lines":return In.Utils;case"direct-volume":return el.Utils;case"image":return Up.Utils;case"texture-mesh":return Ns.Utils}}e.getUtils=o;function i(s,a){return a==="instance"&&s.nonInstanceable?"group":a}e.getGranularity=i})(Mi||(Mi={}));var LRe=1,NRe="Assigns sizes as defined by the shape object.",Nre={};function FRe(e){return Nre}function k3(e,t){return{factory:k3,granularity:"groupInstance",size:r=>Fi.isLocation(r)?r.shape.getSize(r.group,r.instance):LRe,props:t,description:NRe}}var Fre={name:"shape-group",label:"Shape Group",category:"",factory:k3,getParams:FRe,defaultValues:M.getDefaultValues(Nre),isApplicable:e=>!!e.shape};var ORe=ze(13421772),VRe="Assigns colors as defined by the shape object.",Ore={};function GRe(e){return Ore}function M3(e,t){return{factory:M3,granularity:"groupInstance",color:r=>Fi.isLocation(r)?r.shape.getColor(r.group,r.instance):ORe,props:t,description:VRe}}var Vre={name:"shape-group",label:"Shape Group",category:Dr.Misc,factory:M3,getParams:GRe,defaultValues:M.getDefaultValues(Ore),isApplicable:e=>!!e.shape};var URe={..._l,aPosition:cn("float32",3,0),elements:hm("uint32"),uBboxMin:Re("v3"),uBboxMax:Re("v3"),uBboxSize:Re("v3"),uMaxSteps:Re("i"),uStepScale:Re("f"),uJumpLength:Re("f"),uTransform:Re("m4"),uGridDim:Re("v3"),tTransferTex:kt("image-uint8","alpha","ubyte","linear"),uTransferScale:Re("f","material"),dGridTexType:Bt("string",["2d","3d"]),uGridTexDim:Re("v3"),tGridTex:kt("texture","rgba","ubyte","linear"),uGridStats:Re("v4"),uCellDim:Re("v3"),uCartnToUnit:Re("m4"),uUnitToCartn:Re("m4"),dPackedGroup:Bt("boolean"),dAxisOrder:Bt("string",["012","021","102","120","201","210"]),dIgnoreLight:Bt("boolean"),dXrayShaded:Bt("string",["off","on","inverted"])};function Gre(e,t,r,n,o,i){let s={...Il,...Al,...wl,...URe};e.isWebGL2||(s.uMaxSteps=Bt("number"));let a={uObjectId:G.create(t)},c=Tl(e,"triangles",Tee,s,{...r,...a},o,i);return El(c,r,n)}var zRe={..._l,aGroup:cn("float32",1,0),aPosition:cn("float32",3,0),aNormal:cn("float32",3,0),elements:hm("uint32"),dVaryingGroup:Bt("boolean"),dFlatShaded:Bt("boolean"),uDoubleSided:Re("b","material"),dFlipSided:Bt("boolean"),dIgnoreLight:Bt("boolean"),dXrayShaded:Bt("string",["off","on","inverted"]),dTransparentBackfaces:Bt("string",["off","on","opaque"]),uBumpFrequency:Re("f","material"),uBumpAmplitude:Re("f","material"),meta:jn("unknown")};function Ure(e,t,r,n,o,i){let s={...Il,...Al,...wl,...zRe},a={uObjectId:G.create(t)},c=Tl(e,"triangles",l3,s,{...r,...a},o,i);return El(c,r,n)}var HRe={..._l,...zf,aGroup:cn("float32",1,0),aPosition:cn("float32",3,0),dPointSizeAttenuation:Bt("boolean"),dPointStyle:Bt("string",["square","circle","fuzzy"])};function zre(e,t,r,n,o,i){let s={...Il,...Al,...wl,...HRe},a={uObjectId:G.create(t)},c=Tl(e,"points",See,s,{...r,...a},o,i);return El(c,r,n)}var jRe={..._l,...zf,aGroup:cn("float32",1,0),aMapping:cn("float32",2,0),aStart:cn("float32",3,0),aEnd:cn("float32",3,0),elements:hm("uint32"),dLineSizeAttenuation:Bt("boolean"),uDoubleSided:Re("b","material"),dFlipSided:Bt("boolean")};function Hre(e,t,r,n,o,i){let s={...Il,...Al,...wl,...jRe},a={uObjectId:G.create(t)},c=Tl(e,"triangles",_ee,s,{...r,...a},o,i);return El(c,r,n)}var $Re={..._l,...zf,uTexDim:Re("v2"),tPositionGroup:kt("image-float32","rgba","float","nearest"),padding:jn("number"),uDoubleSided:Re("b","material"),dIgnoreLight:Bt("boolean"),dXrayShaded:Bt("string",["off","on","inverted"]),dTransparentBackfaces:Bt("string",["off","on","opaque"]),dSolidInterior:Bt("boolean"),dClipPrimitive:Bt("boolean"),dApproximate:Bt("boolean"),uAlphaThickness:Re("f"),uBumpFrequency:Re("f","material"),uBumpAmplitude:Re("f","material"),lodLevels:jn("unknown"),centerBuffer:jn("float32"),groupBuffer:jn("float32")};function jre(e,t,r,n,o,i){let s={...Il,...Al,...wl,...$Re},a={uObjectId:G.create(t)},c=Tl(e,"triangles",Iee,s,{...r,...a},o,i);return El(c,r,n)}var WRe={..._l,...zf,aGroup:cn("float32",1,0),aPosition:cn("float32",3,0),aMapping:cn("float32",2,0),aDepth:cn("float32",1,0),elements:hm("uint32"),aTexCoord:cn("float32",2,0),tFont:kt("image-uint8","alpha","ubyte","linear"),padding:jn("number"),uBorderWidth:Re("f","material"),uBorderColor:Re("v3","material"),uOffsetX:Re("f","material"),uOffsetY:Re("f","material"),uOffsetZ:Re("f","material"),uBackgroundColor:Re("v3","material"),uBackgroundOpacity:Re("f","material")};function $re(e,t,r,n,o,i){let s={...Il,...Al,...wl,...WRe},a={uObjectId:G.create(t)},c=Tl(e,"triangles",wee,s,{...r,...a},o,i);return El(c,r,n)}var qRe={..._l,uGeoTexDim:Re("v2","buffered"),tPosition:kt("texture","rgb","float","nearest"),tGroup:kt("texture","alpha","float","nearest"),tNormal:kt("texture","rgb","float","nearest"),dVaryingGroup:Bt("boolean"),dFlatShaded:Bt("boolean"),uDoubleSided:Re("b","material"),dFlipSided:Bt("boolean"),dIgnoreLight:Bt("boolean"),dXrayShaded:Bt("string",["off","on","inverted"]),dTransparentBackfaces:Bt("string",["off","on","opaque"]),uBumpFrequency:Re("f","material"),uBumpAmplitude:Re("f","material"),meta:jn("unknown")};function Wre(e,t,r,n,o,i){let s={...Il,...Al,...wl,...qRe},a={uObjectId:G.create(t)},c=Tl(e,"triangles",l3,s,{...r,...a},o,i);return El(c,r,n)}var ZRe={..._l,aGroup:cn("float32",1,0),aPosition:cn("float32",3,0),aUv:cn("float32",2,0),elements:hm("uint32"),uImageTexDim:Re("v2"),tImageTex:kt("image-uint8","rgba","ubyte","nearest"),tGroupTex:kt("image-uint8","rgba","ubyte","nearest"),dInterpolation:Bt("string",Lre)};function qre(e,t,r,n,o,i){let s={...Il,...Al,...wl,...ZRe},a={uObjectId:G.create(t)},c=Tl(e,"triangles",Eee,s,{...r,...a},o,i);return El(c,r,n)}var KRe={..._l,...zf,aGroup:cn("float32",1,0),aStart:cn("float32",3,0),aEnd:cn("float32",3,0),aMapping:cn("float32",3,0),aScale:cn("float32",1,0),aCap:cn("float32",1,0),aColorMode:cn("float32",1,0),elements:hm("uint32"),padding:jn("number"),uDoubleSided:Re("b","material"),dIgnoreLight:Bt("boolean"),dXrayShaded:Bt("string",["off","on","inverted"]),dTransparentBackfaces:Bt("string",["off","on","opaque"]),dSolidInterior:Bt("boolean"),uBumpFrequency:Re("f","material"),uBumpAmplitude:Re("f","material"),dDualColor:Bt("boolean")};function Zre(e,t,r,n,o,i){let s={...Il,...Al,...wl,...KRe},a={uObjectId:G.create(t)},c=Tl(e,"triangles",Aee,s,{...r,...a},o,i);return El(c,r,n)}var XRe=ei(0,2147483647),ru=ei(0,2147483647);function gm(e,t,r,n){return{id:XRe(),type:e,values:t,state:r,materialId:n}}function Kre(e,t,r){switch(t.type){case"mesh":return Ure(e,t.id,t.values,t.state,t.materialId,r);case"points":return zre(e,t.id,t.values,t.state,t.materialId,r);case"spheres":return jre(e,t.id,t.values,t.state,t.materialId,r);case"cylinders":return Zre(e,t.id,t.values,t.state,t.materialId,r);case"text":return $re(e,t.id,t.values,t.state,t.materialId,r);case"lines":return Hre(e,t.id,t.values,t.state,t.materialId,r);case"direct-volume":return Gre(e,t.id,t.values,t.state,t.materialId,r);case"image":return qre(e,t.id,t.values,t.state,t.materialId,r);case"texture-mesh":return Wre(e,t.id,t.values,t.state,t.materialId,r)}throw new Error("unsupported type")}var br;(function(e){function t(u,d,m,p,h,f,C){return{id:jr.create22(),name:u,sourceData:d,geometry:m,transforms:C||[de.identity()],get groupCount(){return Mi.getGroupCount(m)},getColor:p,getSize:h,getLabel:f}}e.create=t;function r(u){return{color:M3({shape:u},{}),size:k3({shape:u},{})}}e.getTheme=r;function n(u){let d=u.transforms.length,m=Fi.Location(u),p=(h,f)=>(m.group=h,m.instance=f,m);return Mr(u.groupCount,d,1,p)}e.groupIterator=n;function o(u,d,m,p,h){let f=h&&h.aTransform.ref.value.length>=u.length*16?h.aTransform.ref.value:new Float32Array(u.length*16);for(let C=0,g=u.length;C<g;++C)de.toArray(u[C],f,C*16);return D2(f,u.length,d,m,p,h)}e.createTransform=o;function i(u,d){let m=r(u),p=Mi.getUtils(u.geometry),h=ru(),f=n(u),C=o(u.transforms,u.geometry.boundingSphere,d.cellSize,d.batchSize),g=p.createValues(u.geometry,C,f,m,d),b=p.createRenderableState(d);return gm(u.geometry.kind,g,b,h)}e.createRenderObject=i;function s(u){return{kind:"shape-loci",shape:u}}e.Loci=s;function a(u){return!!u&&u.kind==="shape-loci"}e.isLoci=a;function l(u,d){return u.shape===d.shape}e.areLociEqual=l;function c(u){return u.shape.groupCount===0}e.isLociEmpty=c})(br||(br={}));var Fi;(function(e){function t(p,h=0,f=0){return{kind:"group-location",shape:p,group:h,instance:f}}e.Location=t;function r(p){return!!p&&p.kind==="group-location"}e.isLocation=r;function n(p,h){return{kind:"group-loci",shape:p,groups:h}}e.Loci=n;function o(p){return!!p&&p.kind==="group-loci"}e.isLoci=o;function i(p,h){if(p.shape!==h.shape||p.groups.length!==h.groups.length)return!1;for(let f=0,C=p.groups.length;f<C;++f){let{ids:g,instance:b}=p.groups[f],{ids:y,instance:x}=h.groups[f];if(b!==x||!Ge.areEqual(g,y))return!1}return!0}e.areLociEqual=i;function s(p){return a(p)===0}e.isLociEmpty=s;function a(p){let h=0;for(let f of p.groups)h+=Ge.size(f.ids);return h}e.size=a;let l=new ec,c=D.zero();function u(p,h,f,C){let{indices:g,offsets:b}=h;for(let{ids:y,instance:x}of p)Ge.forEach(y,A=>{for(let v=b[A],_=b[A+1];v<_;++v)D.fromArray(c,f,g[v]*3),D.transformMat4(c,c,C[x]),l.includeStep(c)})}function d(p,h,f,C){let{indices:g,offsets:b}=h;for(let{ids:y,instance:x}of p)Ge.forEach(y,A=>{for(let v=b[A],_=b[A+1];v<_;++v)D.fromArray(c,f,g[v]*3),D.transformMat4(c,c,C[x]),l.radiusStep(c)})}function m(p,h){h||(h=Pe()),l.reset();let f=0,{geometry:C,transforms:g}=p.shape;if(C.kind==="mesh"||C.kind==="points"){let b=C.kind==="mesh"?C.vertexBuffer.ref.value:C.centerBuffer.ref.value;u(p.groups,C.groupMapping,b,g),l.finishedIncludeStep(),d(p.groups,C.groupMapping,b,g)}else if(C.kind==="lines"){let b=C.startBuffer.ref.value,y=C.endBuffer.ref.value;u(p.groups,C.groupMapping,b,g),u(p.groups,C.groupMapping,y,g),l.finishedIncludeStep(),d(p.groups,C.groupMapping,b,g),d(p.groups,C.groupMapping,y,g)}else if(C.kind==="spheres"||C.kind==="text"){let b=C.centerBuffer.ref.value;u(p.groups,C.groupMapping,b,g),l.finishedIncludeStep(),d(p.groups,C.groupMapping,b,g);for(let{ids:y,instance:x}of p.groups)Ge.forEach(y,A=>{let v=p.shape.getSize(A,x);f<v&&(f=v)})}else return Pe.copy(h,C.boundingSphere);return D.copy(h.center,l.center),h.radius=Math.sqrt(l.radiusSq),Pe.expand(h,h,f),h}e.getBoundingSphere=m})(Fi||(Fi={}));function Jre(e){let t=e&&e.getElement("vertex"),r=e&&e.getElement("material"),n={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},o=[["",""]],i=[["",""]];if(t){for(let l=0,c=t.propertyNames.length;l<c;++l){let u=t.propertyNames[l],d=t.propertyTypes[l];(d==="uchar"||d==="uint8"||d==="ushort"||d==="uint16"||d==="uint"||d==="uint32"||d==="int")&&o.push([u,u]),(d==="uchar"||d==="uint8")&&i.push([u,u])}t.propertyNames.includes("atomid")?n.group="atomid":t.propertyNames.includes("material_index")&&(n.group="material_index"),t.propertyNames.includes("red")&&(n.vRed="red"),t.propertyNames.includes("green")&&(n.vGreen="green"),t.propertyNames.includes("blue")&&(n.vBlue="blue")}let s=[["",""]];if(r){for(let l=0,c=r.propertyNames.length;l<c;++l){let u=r.propertyNames[l],d=r.propertyTypes[l];(d==="uchar"||d==="uint8")&&s.push([u,u])}r.propertyNames.includes("red")&&(n.mRed="red"),r.propertyNames.includes("green")&&(n.mGreen="green"),r.propertyNames.includes("blue")&&(n.mBlue="blue")}let a=n.vRed&&n.vGreen&&n.vBlue?"vertex":n.mRed&&n.mGreen&&n.mBlue?"material":"uniform";return{...Ct.Params,coloring:M.MappedStatic(a,{vertex:M.Group({red:M.Select(n.vRed,i,{label:"Red Property"}),green:M.Select(n.vGreen,i,{label:"Green Property"}),blue:M.Select(n.vBlue,i,{label:"Blue Property"})},{isFlat:!0}),material:M.Group({red:M.Select(n.mRed,s,{label:"Red Property"}),green:M.Select(n.mGreen,s,{label:"Green Property"}),blue:M.Select(n.mBlue,s,{label:"Blue Property"})},{isFlat:!0}),uniform:M.Group({color:M.Color(Gt.grey),saturation:M.Numeric(0,{min:-6,max:6,step:.1}),lightness:M.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:M.MappedStatic(n.group?"vertex":"none",{vertex:M.Group({group:M.Select(n.group,o,{label:"Group Property"})},{isFlat:!0}),none:M.Group({})})}}var Xre=Jre();function YRe(e,t,r,n,o){let{vertices:i,normals:s,groups:a}=r,l=n.getProperty("x"),c=n.getProperty("y"),u=n.getProperty("z");if(!l||!c||!u)throw new Error("missing coordinate properties");let d=n.getProperty("nx"),m=n.getProperty("ny"),p=n.getProperty("nz"),h=!!d&&!!m&&!!p;for(let f=e;f<t;++f)it.add3(i,l.value(f),c.value(f),u.value(f)),h&&it.add3(s,d.value(f),m.value(f),p.value(f)),it.add(a,o[f])}function QRe(e,t,r,n){let{indices:o}=r;for(let i=e;i<t;++i){let{entries:s,count:a}=n.value(i);a===3?it.add3(o,s[0],s[1],s[2]):a===4&&(it.add3(o,s[2],s[1],s[0]),it.add3(o,s[2],s[0],s[3]))}}async function JRe(e,t,r,n,o){let i=gt.createState(t.rowCount,t.rowCount/4,o),s=t.getProperty("x"),a=t.getProperty("y"),l=t.getProperty("z");if(!s||!a||!l)throw new Error("missing coordinate properties");let c=t.getProperty("nx"),u=t.getProperty("ny"),d=t.getProperty("nz"),m=!!c&&!!u&&!!d,p=1e5;for(let f=0,C=t.rowCount;f<C;f+=p)YRe(f,Math.min(f+p,C),i,t,n),e.shouldUpdate&&await e.update({message:"adding ply mesh vertices",current:f,max:C});for(let f=0,C=r.rowCount;f<C;f+=p)QRe(f,Math.min(f+p,C),i,r),e.shouldUpdate&&await e.update({message:"adding ply mesh faces",current:f,max:C});let h=gt.getMesh(i);return m||Ct.computeNormals(h),G.updateIfChanged(h.varyingGroup,!0),h}var fg=ue.Schema.int;function eBe(e,t){let{grouping:r}=t,{rowCount:n}=e,o=r.name==="vertex"?e.getProperty(r.params.group):void 0,i=r.name==="vertex"?Ms(r.params.group):"Vertex",s=o?o.toArray({array:Uint32Array}):Rs(new Uint32Array(n)),a=o?Da(s):n-1,l=new Uint32Array(a+1);for(let c=0,u=s.length;c<u;++c)l[s[c]]=c;return{ids:s,map:l,label:i}}function Yre(e,t,r){let{coloring:n}=r,{rowCount:o}=e,i,s,a;if(n.name==="vertex")i=e.getProperty(n.params.red)||ue.ofConst(127,o,fg),s=e.getProperty(n.params.green)||ue.ofConst(127,o,fg),a=e.getProperty(n.params.blue)||ue.ofConst(127,o,fg);else if(n.name==="material")i=t&&t.getProperty(n.params.red)||ue.ofConst(127,o,fg),s=t&&t.getProperty(n.params.green)||ue.ofConst(127,o,fg),a=t&&t.getProperty(n.params.blue)||ue.ofConst(127,o,fg);else{let l=n.params.color;l=ze.saturate(l,n.params.saturation),l=ze.lighten(l,n.params.lightness);let[c,u,d]=ze.toRgb(l);i=ue.ofConst(c,o,fg),s=ue.ofConst(u,o,fg),a=ue.ofConst(d,o,fg)}return{kind:n.name,red:i,green:s,blue:a}}function Qre(e,t,r,n){let{kind:o,red:i,green:s,blue:a}=r,{ids:l,map:c,label:u}=n,{source:d,transforms:m}=e;return br.create("ply-mesh",d,t,p=>{let h=o==="material"?p:c[p];return ze.fromRgb(i.value(h),s.value(h),a.value(h))},()=>1,p=>`${u} ${l[p]}`,m)}function tBe(){let e,t,r,n,o,i;return async(a,l,c,u)=>{let d=l.source.getElement("vertex");if(!d)throw new Error("missing vertex element");let m=l.source.getElement("face");if(!m)throw new Error("missing face element");let p=l.source.getElement("material"),h=!1,f=!1;return(!e||e!==e)&&(h=!0),(!t||!M.isParamEqual(Xre.grouping,t.grouping,c.grouping))&&(h=!0),(!t||!M.isParamEqual(Xre.coloring,t.coloring,c.coloring))&&(f=!0),h?(o=Yre(d,p,c),i=eBe(d,c),n=await JRe(a,d,m,i.ids,u&&u.geometry),r=Qre(l,n,o,i)):f&&(o=Yre(d,p,c),r=Qre(l,n,o,i)),e=l,t=Xa(c),r}}function ene(e,t){return ke.create("Shape Provider",async r=>({label:"Mesh",data:{source:e,transforms:t?.transforms},params:Jre(e),getShape:tBe(),geometryUtils:Ct.Utils}))}function Pl(e,t){return{value:e,unit:t}}var ym;(function(e){function t(l,c,u){let d=!!l[0].cell,m=!!l[0].velocities,p=!!l[0].forces;return{id:jr.create22(),frames:l,hasCell:d,hasVelocities:m,hasForces:p,deltaTime:c,timeOffset:u}}e.create=t;function r(l,c,u){var d,m;let{x:p,y:h,z:f}=l;return l.xyzOrdering.frozen?u?l.xyzOrdering.isIdentity?(p=s(p,u),h=s(h,u),f=s(f,u)):da(l.xyzOrdering.index,u)||(p=i(p,l.xyzOrdering.index,u),h=i(h,l.xyzOrdering.index,u),f=i(f,l.xyzOrdering.index,u)):l.xyzOrdering.isIdentity||(p=a(p,l.xyzOrdering.index),h=a(h,l.xyzOrdering.index),f=a(f,l.xyzOrdering.index)):u&&(l.xyzOrdering.isIdentity?(l.xyzOrdering.isIdentity=!1,l.xyzOrdering.index=u,o(p,u),o(h,u),o(f,u)):da(l.xyzOrdering.index,u)||(p=i(p,l.xyzOrdering.index,u),h=i(h,l.xyzOrdering.index,u),f=i(f,l.xyzOrdering.index,u))),l.xyzOrdering.frozen=!0,{id:jr.create22(),atomId:c.atomId,occupancy:(d=c.occupancy)!==null&&d!==void 0?d:ue.ofConst(1,l.elementCount,ue.Schema.int),B_iso_or_equiv:(m=c.B_iso_or_equiv)!==null&&m!==void 0?m:ue.ofConst(0,l.elementCount,ue.Schema.float),xyzDefined:!0,x:p,y:h,z:f}}e.getAtomicConformation=r;let n=[.123];function o(l,c){let u=n;for(let d=0,m=l.length;d<m;d++)u[d]=l[c[d]];for(let d=0,m=l.length;d<m;d++)l[d]=u[d]}function i(l,c,u){let d=new Float32Array(l.length);for(let m=0,p=l.length;m<p;m++)d[m]=l[c[u[m]]];return d}function s(l,c){let u=new Float32Array(l.length);for(let d=0,m=l.length;d<m;d++)u[d]=l[c[d]];return u}function a(l,c){let u=new Float32Array(l.length);for(let d=0,m=l.length;d<m;d++)u[c[d]]=l[d];return u}})(ym||(ym={}));function _d(){return _d.empty()}(function(e){function t(o,i){return{size:o,anglesInRadians:i}}e.create=t;function r(){return t(D(),D())}e.empty=r;function n(o,i,s){let a=D.magnitude(o),l=D.magnitude(i),c=D.magnitude(s),u=Math.acos(D.dot(i,s)/(l*c)),d=Math.acos(D.dot(o,s)/(a*c)),m=Math.acos(D.dot(o,i)/(a*l));return a<=0||l<=0||c<=0||u>=Math.PI||d>=Math.PI||m>=Math.PI?r():t(D.create(a,l,c),D.create(u,d,m))}e.fromBasis=n})(_d||(_d={}));var rBe=20.45482949774598;function tne(e){return ke.create("Parse DCD",async t=>{await t.update("Converting to coordinates");let{header:r}=e,n=r.DELTA?Pl(r.DELTA*rBe,"ps"):Pl(1,"step"),o=r.ISTART>=1?Pl((r.ISTART-1)*n.value,n.unit):Pl(0,n.unit),i=[];for(let s=0,a=e.frames.length;s<a;++s){let l=e.frames[s],c={elementCount:l.elementCount,time:Pl(o.value+n.value*s,n.unit),x:l.x,y:l.y,z:l.z,xyzOrdering:{isIdentity:!0}};if(l.cell){let u=l.cell;u[1]>=-1&&u[1]<=1&&u[3]>=-1&&u[3]<=1&&u[4]>=-1&&u[4]<=1?c.cell=_d.create(D.create(u[0],u[2],u[5]),D.create(Pr(90-Math.asin(u[1])*90/tb),Pr(90-Math.asin(u[3])*90/tb),Pr(90-Math.asin(u[4])*90/tb))):u[0]<0||u[1]<0||u[2]<0||u[3]<0||u[4]<0||u[5]<0||u[3]>180||u[4]>180||u[5]>180?c.cell=_d.fromBasis(D.create(u[0],u[1],u[3]),D.create(u[1],u[2],u[4]),D.create(u[3],u[4],u[5])):c.cell=_d.create(D.create(u[0],u[2],u[5]),D.create(Pr(oo(u[1],0,1e-6)?90:u[1]),Pr(oo(u[3],0,1e-6)?90:u[3]),Pr(oo(u[4],0,1e-6)?90:u[4])))}i.push(c)}return ym.create(i,n,o)})}function mC(e,t,r,n){let o=r,i=n-1,s=t.charCodeAt(o);for(;(s===32||s>=48&&s<=57)&&o<=i;)s=t.charCodeAt(++o);for(s=t.charCodeAt(i);(s===32||s>=48&&s<=57)&&i>=o;)s=t.charCodeAt(--i);if(++i,o===i)return ct.add(e,o,i);if(o+1===i)return ct.add(e,o,i);if(s=t.charCodeAt(o),o+2===i){let a=t.charCodeAt(o+1);if((s===78||s===110)&&(a===65||a===97)||(s===67||s===99)&&(a===76||a===108)||(s===70||s===102)&&(a===69||a===101)||(s===83||s===115)&&(a===73||a===105)||(s===66||s===98)&&(a===82||a===114)||(s===65||s===97)&&(a===83||a===115))return ct.add(e,o,o+2)}if(s===67||s===99||s===72||s===104||s===78||s===110||s===79||s===111||s===80||s===112||s===83||s===115)return ct.add(e,o,o+1);ct.add(e,o,o)}var nBe=new Set(["NA","CL","FE","SI","BR","AS","LI"]),oBe=new Set(["C","H","N","O","P","S","F","B"]),iBe=/^[\s\d]+|[\s\d]+$/g;function vm(e,t){e=e.replace(iBe,"").toUpperCase();let r=e.length;if(r===0||r===1||nBe.has(e))return e;if(r===3&&t===e){if(e==="SOD")return"NA";if(e==="POT")return"K";if(e==="CES")return"CS";if(e==="CAL")return"CA";if(e==="CLA")return"CL"}return oBe.has(e[0])?e[0]:""}var SV=new Set(["145","147","149","289","291","293","445","475","491","510","604","045","05L","07E","07Y","08U","09X","0AT","0BD","0H0","0HX","0LP","0MK","0NZ","0TS","0UB","0V4","0WK","0XY","0YT","10M","12E","14T","15L","16F","16G","16O","17T","18D","18O","18T","1AR","1BW","1CF","1FT","1GL","1GN","1JB","1LL","1NA","1S3","1S4","1SD","1X4","20S","20X","22O","22S","23V","24S","25E","26M","26O","26Q","26R","26V","26W","26Y","27C","2DG","2DR","2F8","2FG","2FL","2FP","2GL","2GS","2H5","2HA","2M4","2M5","2M8","2OS","2SI","2WP","2WS","32O","34V","38J","3BU","3CM","3DO","3DY","3FM","3GR","3HD","3J3","3J4","3LJ","3LR","3MF","3MG","3MK","3R3","3S6","3SA","3YW","40J","42D","44S","46D","46M","46Z","48Z","49A","49S","49T","49V","4AM","4CQ","4GC","4GL","4GP","4JA","4N2","4NN","4QY","4R1","4RS","4SG","4U0","4U1","4U2","4UZ","4V5","50A","51N","56N","57S","5DI","5GF","5GO","5II","5KQ","5KS","5KT","5KV","5L2","5L3","5LS","5LT","5MM","5N6","5QP","5RP","5SA","5SP","5TH","5TJ","5TK","5TM","61J","62I","64K","66O","6BG","6C2","6DM","6GB","6GP","6GR","6K3","6KH","6KL","6KS","6KU","6KW","6LA","6LS","6LW","6MJ","6MN","6PG","6PY","6PZ","6S2","6SA","6UD","6Y6","6YR","6ZC","73E","79J","7CV","7D1","7GP","7JZ","7K2","7K3","7NU","7SA","83Y","89Y","8B7","8B9","8EX","8GA","8GG","8GP","8I4","8LM","8LR","8OQ","8PK","8S0","8YV","95Z","96O","98U","9AM","9C1","9CD","9GP","9KJ","9MR","9OK","9PG","9QG","9QZ","9RN","9S7","9SG","9SJ","9SM","9SP","9T1","9T7","9VP","9WJ","9WN","9WZ","9YW","A0K","A1AIO","A1Q","A2G","A5C","A6P","AAL","AAO","ABC","ABD","ABE","ABF","ABL","AC1","ACG","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AGR","AH2","AH8","AHG","AHM","AHR","AIG","ALL","ALX","AMG","AMN","AMU","AMV","ANA","AOG","AOS","AQA","ARA","ARB","ARE","ARI","ARW","ASC","ASG","ASO","AXP","AXR","AY9","AZC","B0D","B16","B1H","B1N","B2G","B4G","B6D","B7G","B8D","B9D","BBK","BBV","BCD","BCW","BDF","BDG","BDP","BDR","BDZ","BEM","BFN","BFP","BG6","BG8","BGC","BGL","BGN","BGP","BGS","BHG","BM3","BM7","BMA","BMX","BND","BNG","BNX","BO1","BOG","BQY","BRI","BS7","BTG","BTU","BW3","BWG","BXF","BXP","BXX","BXY","BZD","C3B","C3G","C3X","C4B","C4W","C4X","C5X","CAP","CBF","CBI","CBK","CDR","CE5","CE6","CE8","CEG","CEX","CEY","CEZ","CGF","CJB","CKB","CKP","CNP","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D0N","D1M","D5E","D6G","DAF","DAG","DAN","DDA","DDB","DDL","DEG","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGO","DGS","DGU","DIG","DJB","DJE","DK4","DKX","DKZ","DL6","DLD","DLF","DLG","DMU","DNO","DO8","DOM","DP5","DPC","DQQ","DQR","DR2","DR3","DR4","DR5","DRI","DSR","DT6","DVC","DYM","E3M","E4P","E5G","EAG","EBG","EBQ","EEN","EEQ","EGA","EJT","EMP","EMZ","EPG","EQP","EQV","ERE","ERI","ETT","EUS","F1P","F1X","F55","F58","F6P","F8X","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FFX","FIF","FIX","FK9","FKD","FMF","FMO","FNG","FNY","FRU","FSA","FSI","FSM","FSR","FSW","FU4","FUB","FUC","FUD","FUF","FUL","FUY","FVQ","FX1","FYJ","G0S","G16","G1P","G20","G28","G2F","G3F","G3I","G4D","G4S","G6D","G6P","G6S","G7P","G8Z","GAA","GAC","GAD","GAF","GAL","GAT","GBH","GC1","GC4","GC9","GCB","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GDA","GDL","GE1","GE3","GFP","GIV","GL0","GL1","GL2","GL4","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GM0","GMB","GMH","GMT","GMZ","GN1","GN4","GNS","GNX","GP0","GP1","GP4","GPH","GPK","GPM","GPO","GPQ","GPU","GPV","GPW","GQ1","GRF","GRX","GS1","GS4","GS9","GSA","GSD","GTE","GTH","GTK","GTM","GTR","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUL","GUP","GUZ","GXL","GXV","GYE","GYG","GYP","GYU","GYV","GZL","H1M","H1S","H2P","H3S","H53","H6Q","H6Z","HBZ","HD4","HDL","HMS","HNV","HNW","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","HTG","HTM","HVC","I57","IAB","IDC","IDF","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IEM","IN1","IPT","ISD","ISL","ISX","IVG","IXD","J5B","JFZ","JHM","JLT","JRV","JS2","JSV","JV4","JVA","JVS","JZR","K5B","K99","KBA","KBG","KD5","KDA","KDB","KDD","KDE","KDF","KDM","KDN","KDO","KDR","KFN","KG1","KGM","KHP","KME","KO1","KO2","KOT","KQC","KTU","L1L","L6N","L6S","L6T","LAG","LAH","LAI","LAK","LAO","LAT","LB2","LBS","LBT","LCN","LDY","LEC","LER","LFC","LFR","LGC","LGU","LKA","LKS","LM2","LMO","LMT","LMU","LNV","LOG","LOX","LPK","LRH","LSM","LTG","LTM","LVO","LVZ","LXB","LXC","LXZ","LZ0","M1F","M1P","M2F","M3M","M3N","M55","M6D","M6P","M7B","M7P","M8C","MA1","MA2","MA3","MA8","MAB","MAF","MAG","MAL","MAN","MAT","MAV","MAW","MBE","MBF","MBG","MCU","MDA","MDP","MFA","MFB","MFU","MG5","MGA","MGC","MGL","MGS","MJJ","MLB","MLR","MMA","MMN","MN0","MNA","MQG","MQT","MRH","MRP","MSX","MTT","MUB","MUG","MUR","MVP","MXY","MXZ","MYG","N1L","N3U","N9S","NA1","NAA","NAG","NBG","NBX","NBY","NDG","NED","NFG","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGK","NGL","NGR","NGS","NGY","NGZ","NHF","NLC","NM6","NM9","NNG","NPF","NSQ","NT1","NTF","NTO","NTP","NXD","NYT","O1G","OAK","OEL","OI7","OPM","ORP","OSU","OTG","OTN","OTU","OX2","P53","P6P","P8E","PA1","PA5","PAV","PDX","PH5","PKM","PNA","PNG","PNJ","PNW","PPC","PRP","PSG","PSJ","PSV","PTQ","PUF","PZU","QDK","QIF","QKH","QPS","QV4","R1P","R1X","R2B","R2G","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RHC","RI2","RIB","RIP","RM4","RNS","RNT","ROB","ROR","RP3","RP5","RP6","RPA","RR7","RRJ","RRY","RST","RTG","RTV","RUB","RUG","RUU","RV7","RVG","RVM","RWI","RY7","RZM","S6P","S7P","S81","SA0","SCG","SCR","SDD","SDY","SEJ","SF6","SF9","SFJ","SFU","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHD","SHG","SI3","SIA","SID","SIO","SIZ","SLB","SLM","SLT","SMD","SN5","SNG","SOE","SOG","SOL","SOR","SR1","SSG","SSH","STW","STZ","SUC","SUP","SUS","SWE","SZZ","T68","T6D","T6P","T6T","TA6","TAG","TCB","TCG","TDG","TEU","TF0","TFU","TGA","TGK","TGR","TGY","TH1","TM5","TM6","TM9","TMR","TMX","TNX","TOA","TOC","TQY","TRE","TRV","TS8","TT7","TTV","TTZ","TU4","TUG","TUJ","TUP","TUR","TVD","TVG","TVM","TVS","TVV","TVY","TW7","TWA","TWD","TWG","TWJ","TWY","TXB","TY6","TYV","U1Y","U2A","U2D","U63","U8V","U97","U9A","U9D","U9G","U9J","U9M","UAP","UBH","UBO","UCD","UDC","UEA","V3M","V3P","V71","VDF","VG1","VJ1","VJ4","VKN","VTB","W9T","WIA","WOO","WUN","WZ1","WZ2","WZ4","X0X","X1P","X1X","X2F","X2Y","X34","X4S","X5S","X6X","X6Y","XBP","XDP","XDX","XGP","XIL","XKJ","XLF","XLS","XMM","XS2","XUL","XXM","XXR","XXX","XY6","XY9","XYB","XYF","XYL","XYP","XYS","XYT","XYZ","YDR","YIO","YJM","YKR","YO5","YX0","YX1","YYB","YYD","YYH","YYJ","YYK","YYM","YYQ","YYR","YZ0","YZT","Z0F","Z15","Z16","Z2D","Z2T","Z3K","Z3L","Z3Q","Z3U","Z4K","Z4R","Z4S","Z4U","Z4V","Z4W","Z4Y","Z57","Z5J","Z5L","Z61","Z6G","Z6H","Z6J","Z6W","Z8H","Z8T","Z9D","Z9E","Z9H","Z9K","Z9L","Z9M","Z9N","Z9W","ZB0","ZB1","ZB2","ZB3","ZCD","ZCZ","ZD0","ZDC","ZDM","ZDO","ZEE","ZEL","ZGE","ZMR","UMQ","SQD"]);var yo;(function(e){e[e.FilledSphere=0]="FilledSphere",e[e.FilledCube=1]="FilledCube",e[e.CrossedCube=2]="CrossedCube",e[e.DividedDiamond=3]="DividedDiamond",e[e.FilledCone=4]="FilledCone",e[e.DevidedCone=5]="DevidedCone",e[e.FlatBox=6]="FlatBox",e[e.FilledStar=7]="FilledStar",e[e.FilledDiamond=8]="FilledDiamond",e[e.FlatDiamond=9]="FlatDiamond",e[e.FlatHexagon=10]="FlatHexagon",e[e.Pentagon=11]="Pentagon",e[e.DiamondPrism=12]="DiamondPrism",e[e.PentagonalPrism=13]="PentagonalPrism",e[e.HexagonalPrism=14]="HexagonalPrism",e[e.HeptagonalPrism=15]="HeptagonalPrism"})(yo||(yo={}));var Qt={Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817},Nt;(function(e){e[e.Hexose=0]="Hexose",e[e.HexNAc=1]="HexNAc",e[e.Hexosamine=2]="Hexosamine",e[e.Hexuronate=3]="Hexuronate",e[e.Deoxyhexose=4]="Deoxyhexose",e[e.DeoxyhexNAc=5]="DeoxyhexNAc",e[e.DiDeoxyhexose=6]="DiDeoxyhexose",e[e.Pentose=7]="Pentose",e[e.Deoxynonulosonate=8]="Deoxynonulosonate",e[e.DiDeoxynonulosonate=9]="DiDeoxynonulosonate",e[e.Unknown=10]="Unknown",e[e.Assigned=11]="Assigned"})(Nt||(Nt={}));var XDt={[Nt.Hexose]:"Hexose",[Nt.HexNAc]:"HexNAc",[Nt.Hexosamine]:"Hexosamine",[Nt.Hexuronate]:"Hexuronate",[Nt.Deoxyhexose]:"Deoxyhexose",[Nt.DeoxyhexNAc]:"DeoxyhexNAc",[Nt.DiDeoxyhexose]:"Di-deoxyhexose",[Nt.Pentose]:"Pentose",[Nt.Deoxynonulosonate]:"Deoxynonulosonate",[Nt.DiDeoxynonulosonate]:"Di-deoxynonulosonate",[Nt.Unknown]:"Unknown",[Nt.Assigned]:"Assigned"};var sBe={[Nt.Hexose]:yo.FilledSphere,[Nt.HexNAc]:yo.FilledCube,[Nt.Hexosamine]:yo.CrossedCube,[Nt.Hexuronate]:yo.DividedDiamond,[Nt.Deoxyhexose]:yo.FilledCone,[Nt.DeoxyhexNAc]:yo.DevidedCone,[Nt.DiDeoxyhexose]:yo.FlatBox,[Nt.Pentose]:yo.FilledStar,[Nt.Deoxynonulosonate]:yo.FilledDiamond,[Nt.DiDeoxynonulosonate]:yo.FlatDiamond,[Nt.Unknown]:yo.FlatHexagon,[Nt.Assigned]:yo.Pentagon};function rne(e,t){return e===Nt.Unknown?t===4?yo.DiamondPrism:t===5?yo.PentagonalPrism:t===6?yo.HexagonalPrism:t===7?yo.HeptagonalPrism:yo.FlatHexagon:sBe[e]}var R3={abbr:"Unk",name:"Unknown",color:Qt.Secondary,type:Nt.Unknown},pC=[{abbr:"Glc",name:"Glucose",color:Qt.Blue,type:Nt.Hexose},{abbr:"Man",name:"Mannose",color:Qt.Green,type:Nt.Hexose},{abbr:"Gal",name:"Galactose",color:Qt.Yellow,type:Nt.Hexose},{abbr:"Gul",name:"Gulose",color:Qt.Orange,type:Nt.Hexose},{abbr:"Alt",name:"Altrose",color:Qt.Pink,type:Nt.Hexose},{abbr:"All",name:"Allose",color:Qt.Purple,type:Nt.Hexose},{abbr:"Tal",name:"Talose",color:Qt.LightBlue,type:Nt.Hexose},{abbr:"Ido",name:"Idose",color:Qt.Brown,type:Nt.Hexose},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:Qt.Blue,type:Nt.HexNAc},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:Qt.Green,type:Nt.HexNAc},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:Qt.Yellow,type:Nt.HexNAc},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:Qt.Orange,type:Nt.HexNAc},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:Qt.Pink,type:Nt.HexNAc},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:Qt.Purple,type:Nt.HexNAc},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:Qt.LightBlue,type:Nt.HexNAc},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:Qt.Brown,type:Nt.HexNAc},{abbr:"GlcN",name:"Glucosamine",color:Qt.Blue,type:Nt.Hexosamine},{abbr:"ManN",name:"Mannosamine",color:Qt.Green,type:Nt.Hexosamine},{abbr:"GalN",name:"Galactosamine",color:Qt.Yellow,type:Nt.Hexosamine},{abbr:"GulN",name:"Gulosamine",color:Qt.Orange,type:Nt.Hexosamine},{abbr:"AltN",name:"Altrosamine",color:Qt.Pink,type:Nt.Hexosamine},{abbr:"AllN",name:"Allosamine",color:Qt.Purple,type:Nt.Hexosamine},{abbr:"TalN",name:"Talosamine",color:Qt.LightBlue,type:Nt.Hexosamine},{abbr:"IdoN",name:"Idosamine",color:Qt.Brown,type:Nt.Hexosamine},{abbr:"GlcA",name:"Glucuronic Acid",color:Qt.Blue,type:Nt.Hexuronate},{abbr:"ManA",name:"Mannuronic Acid",color:Qt.Green,type:Nt.Hexuronate},{abbr:"GalA",name:"Galacturonic Acid",color:Qt.Yellow,type:Nt.Hexuronate},{abbr:"GulA",name:"Guluronic Acid",color:Qt.Orange,type:Nt.Hexuronate},{abbr:"AltA",name:"Altruronic Acid",color:Qt.Pink,type:Nt.Hexuronate},{abbr:"AllA",name:"Alluronic Acid",color:Qt.Purple,type:Nt.Hexuronate},{abbr:"TalA",name:"Taluronic Acid",color:Qt.LightBlue,type:Nt.Hexuronate},{abbr:"IdoA",name:"Iduronic Acid",color:Qt.Brown,type:Nt.Hexuronate},{abbr:"Qui",name:"Quinovose",color:Qt.Blue,type:Nt.Deoxyhexose},{abbr:"Rha",name:"Rhamnose",color:Qt.Green,type:Nt.Deoxyhexose},{abbr:"6dGul",name:"6-Deoxy Gulose",color:Qt.Orange,type:Nt.Deoxyhexose},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:Qt.Pink,type:Nt.Deoxyhexose},{abbr:"6dTal",name:"6-Deoxy Talose",color:Qt.LightBlue,type:Nt.Deoxyhexose},{abbr:"Fuc",name:"Fucose",color:Qt.Red,type:Nt.Deoxyhexose},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:Qt.Blue,type:Nt.DeoxyhexNAc},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:Qt.Green,type:Nt.DeoxyhexNAc},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:Qt.Pink,type:Nt.DeoxyhexNAc},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:Qt.LightBlue,type:Nt.DeoxyhexNAc},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:Qt.Red,type:Nt.DeoxyhexNAc},{abbr:"Oli",name:"Olivose",color:Qt.Blue,type:Nt.DiDeoxyhexose},{abbr:"Tyv",name:"Tyvelose",color:Qt.Green,type:Nt.DiDeoxyhexose},{abbr:"Abe",name:"Abequose",color:Qt.Orange,type:Nt.DiDeoxyhexose},{abbr:"Par",name:"Paratose",color:Qt.Pink,type:Nt.DiDeoxyhexose},{abbr:"Dig",name:"Digitoxose",color:Qt.Purple,type:Nt.DiDeoxyhexose},{abbr:"Col",name:"Colitose",color:Qt.LightBlue,type:Nt.DiDeoxyhexose},{abbr:"Ara",name:"Arabinose",color:Qt.Green,type:Nt.Pentose},{abbr:"Lyx",name:"Lyxose",color:Qt.Yellow,type:Nt.Pentose},{abbr:"Xyl",name:"Xylose",color:Qt.Orange,type:Nt.Pentose},{abbr:"Rib",name:"Ribose",color:Qt.Pink,type:Nt.Pentose},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:Qt.Green,type:Nt.Deoxynonulosonate},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:Qt.Purple,type:Nt.Deoxynonulosonate},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:Qt.LightBlue,type:Nt.Deoxynonulosonate},{abbr:"Neu",name:"Neuraminic Acid",color:Qt.Brown,type:Nt.Deoxynonulosonate},{abbr:"Sia",name:"Sialic acid",color:Qt.Red,type:Nt.Deoxynonulosonate},{abbr:"Pse",name:"Pseudaminic Acid",color:Qt.Green,type:Nt.DiDeoxynonulosonate},{abbr:"Leg",name:"Legionaminic Acid",color:Qt.Yellow,type:Nt.DiDeoxynonulosonate},{abbr:"Aci",name:"Acinetaminic Acid",color:Qt.Pink,type:Nt.DiDeoxynonulosonate},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:Qt.LightBlue,type:Nt.DiDeoxynonulosonate},{abbr:"Bac",name:"Bacillosamine",color:Qt.Blue,type:Nt.Unknown},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:Qt.Green,type:Nt.Unknown},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:Qt.Yellow,type:Nt.Unknown},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:Qt.Orange,type:Nt.Unknown},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:Qt.Pink,type:Nt.Unknown},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:Qt.Purple,type:Nt.Unknown},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:Qt.LightBlue,type:Nt.Unknown},{abbr:"Mur",name:"Muramic Acid",color:Qt.Brown,type:Nt.Unknown},{abbr:"Api",name:"Apicose",color:Qt.Green,type:Nt.Assigned},{abbr:"Fru",name:"Fructose",color:Qt.Green,type:Nt.Assigned},{abbr:"Tag",name:"Tagatose",color:Qt.Yellow,type:Nt.Assigned},{abbr:"Sor",name:"Sorbose",color:Qt.Orange,type:Nt.Assigned},{abbr:"Psi",name:"Psicose",color:Qt.Pink,type:Nt.Assigned}],nne=function(){let e=new Map;for(let t=0,r=pC.length;t<r;++t){let n=pC[t];e.set(n.abbr,n)}return e}(),one=[["Glc-family",Qt.Blue],["Man-family",Qt.Green],["Gal-family",Qt.Yellow],["Gul-family",Qt.Orange],["Alt-family",Qt.Pink],["All-family",Qt.Purple],["Tal-family",Qt.LightBlue],["Ido-family",Qt.Brown],["Fuc-family",Qt.Red],["Generic/Unknown/Secondary",Qt.Secondary]],ine={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},sne={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},aBe={Glc:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"],GlcNAc:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"],GlcA:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","0ZBP"],GlcN:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp"],Man:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"],ManNAc:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"],Ara:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"],Gal:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"],GalNAc:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"],GalA:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"],Gul:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"],Alt:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"],All:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"],Tal:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"],Ido:["0IA","0IB","1IA","1IB","2IA","2IB","3IA","3IB","4IA","4IB","6IA","6IB","ZIA","ZIB","YIA","YIB","XIA","XIB","WIA","WIB","VIA","VIB","UIA","UIB","TIA","TIB","SIA","SIB","RIA","RIB","QIA","QIB","PIA","PIB","0iA","0iB","1iA","1iB","2iA","2iB","3iA","3iB","4iA","4iB","6iA","6iB","ZiA","ZiB","YiA","YiB","XiA","XiB","WiA","WiB","ViA","ViB","UiA","UiB","TiA","TiB","SiA","SiB","RiA","RiB","QiA","QiB","PiA","PiB"],IdoA:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"],Fuc:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"],Rha:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"],Qui:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"],Lyx:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"],Xyl:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"],Rib:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"],Fru:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"],Tag:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"],Sor:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"],Psi:["0PA","0PB","1PA","1PB","2PA","2PB","3PA","3PB","4PA","4PB","5PA","5PB","WPA","WPB","0PD","0PU","1PD","1PU","2PD","2PU","3PD","3PU","4PD","4PU","6PD","6PU","WPD","WPU","VPD","VPU","UPD","UPU","QPD","QPU","0pA","0pB","1pA","1pB","2pA","2pB","3pA","3pB","4pA","4pB","5pA","5pB","WpA","WpB","0pD","0pU","1pD","1pU","2pD","2pU","3pD","3pU","4pD","4pU","6pD","6pU","WpD","WpU","VpD","VpU","UpD","UpU","QpD","QpU"],Neu5Ac:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"],Neu5Gc:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"],Tyv:["0TV","0Tv","1TV","1Tv","2TV","2Tv","4TV","4Tv","YTV","YTv","0tV","0tv","1tV","1tv","2tV","2tv","4tV","4tv","YtV","Ytv"],Abe:["0AE","2AE","4AE","YGa","0AF","2AF","4AF","YAF"],Bac:["0BC","3BC","0bC","3bC"],Kdn:["0KN","4KN","5KN","7KN","8KN","9KN","AKN","BKN","CKN","DKN","EKN","FKN","GKN","HKN","IKN","JKN","KKN","LKN","MKN","NKN","OKN","PKN","QKN","RKN","SKN","TKN","UKN","VKN","WKN","XKN","YKN","0Kn","4Kn","5Kn","7Kn","8Kn","9Kn","AKn","BKn","CKn","DKn","EKn","FKn","GKn","HKn","IKn","JKn","KKn","LKn","MKn","NKn","OKn","PKn","QKn","RKn","SKn","TKn","UKn","VKn","WKn","XKn","YKn"],Kdo:["0KO","4KO","5KO","7KO","8KO","AKO","BKO","CKO","DKO","EKO","FKO","GKO","HKO","IKO","JKO","KKO","0Ko","4Ko","5Ko","7Ko","8Ko","AKo","BKo","CKo","DKo","EKo","FKo","GKo","HKo","IKo","JKo","KKo"]},ane=function(){let e=new Map;for(let t=0,r=pC.length;t<r;++t){let n=pC[t],o=ine[n.abbr];if(o)for(let s=0,a=o.length;s<a;++s)e.set(o[s],n);let i=sne[n.abbr];if(i)for(let s=0,a=i.length;s<a;++s)e.set(i[s],n)}return SV.forEach(t=>{e.has(t)||e.set(t,R3)}),e}(),lBe=function(){let e=new Map;for(let t=0,r=pC.length;t<r;++t){let n=pC[t],o=ine[n.abbr];if(o)for(let a=0,l=o.length;a<l;++a)e.set(o[a],n);let i=sne[n.abbr];if(i)for(let a=0,l=i.length;a<l;++a)e.set(i[a],n);let s=aBe[n.abbr];if(s)for(let a=0,l=s.length;a<l;++a)e.has(s[a])||e.set(s[a],n)}return SV.forEach(t=>{e.has(t)||e.set(t,R3)}),e}();function lne(e){bm=e==="default"?ane:lBe}var bm=ane;var $n;(function(e){function t(p){return Array.from(p.values())}e.toArray=t;function r(p,h){if(p===h)return!0;if(p.size<h.size)return!1;for(let f of h)if(!p.has(f))return!1;return!0}e.isSuperset=r;function n(p,...h){for(let f=0;f<h.length;f++)for(let C of h[f])p.add(C);return p}e.add=n;function o(p,h){let f=new Set(p);if(p===h)return f;for(let C of h)f.add(C);return f}e.union=o;function i(...p){if(p.length===0)return new Set;let h=new Set(p[0]);for(let f=1,C=p.length;f<C;f++)for(let g of p[f])h.add(g);return h}e.unionMany=i;function s(p){if(p.length===0)return new Set;let h=new Set(p[0]);for(let f=1;f<p.length;f++)for(let C of p[f])h.add(C);return h}e.unionManyArrays=s;function a(p,h){if(p===h)return new Set(p);let f=new Set;for(let C of h)p.has(C)&&f.add(C);return f}e.intersection=a;function l(p,h){if(p===h)return p.size>0;p.size<h.size&&([p,h]=[h,p]);for(let f of h)if(p.has(f))return!0;return!1}e.areIntersecting=l;function c(p,h){if(p===h)return p.size;p.size<h.size&&([p,h]=[h,p]);let f=0;for(let C of h)p.has(C)&&(f+=1);return f}e.intersectionSize=c;function u(p,h){if(p===h)return new Set;let f=new Set(p);for(let C of h)f.delete(C);return f}e.difference=u;function d(p,h){if(p===h)return 0;let f=p.size;for(let C of p)h.has(C)&&(f-=1);return f}e.differenceSize=d;function m(p,h){if(p===h)return!0;if(p.size!==h.size)return!1;for(let f of h)if(!p.has(f))return!1;return!0}e.areEqual=m})($n||($n={}));var IV=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]);var AV=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","NT3","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RHF","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]);var cBe=function(){let e=Object.create(null),t=[];for(let r=65;r<=90;r++)t[t.length]=String.fromCharCode(r);for(let r=97;r<=122;r++)t[t.length]=String.fromCharCode(r);for(let r=48;r<=57;r++)t[t.length]=String.fromCharCode(r);for(let r of t){e[r]=r.toUpperCase();for(let n of t){e[r+n]=(r+n).toUpperCase();for(let o of t)e[r+n+o]=(r+n+o).toUpperCase()}}return e}();function zp(e){return cBe[e]||e.toUpperCase()}var cne=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(e=>[e[0],zp(e[1])]));function dne(e){return cne.has(e)?cne.get(e):zp("H")}var une;(function(e){e[e.unknown=0]="unknown",e[e.polymer=1]="polymer",e[e["non-polymer"]=2]="non-polymer",e[e.macrolide=3]="macrolide",e[e.water=4]="water",e[e.branched=5]="branched"})(une||(une={}));var mne={0:{trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},1:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},2:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},3:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},4:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},5:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},6:{trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])}},Td=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),fC=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),pne=new Set(["d-peptide linking","d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","d-gamma-peptide, c-delta linking","d-beta-peptide, c-gamma linking"]),fne=new Set(["l-peptide linking","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus","l-gamma-peptide, c-delta linking","l-beta-peptide, c-gamma linking"]),uBe=new Set(["d-gamma-peptide, c-delta linking","l-gamma-peptide, c-delta linking"]),dBe=new Set(["d-beta-peptide, c-gamma linking","l-beta-peptide, c-gamma linking"]),mBe=new Set(["d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus"]),hne=new Set(["peptide linking","peptide-like"]),pBe=$n.unionMany(pne,fne,hne),gne=new Set(["dna linking","l-dna linking","dna oh 5 prime terminus","dna oh 3 prime terminus"]),yne=new Set(["rna linking","l-rna linking","rna oh 5 prime terminus","rna oh 3 prime terminus"]),vne=$n.unionMany(new Set(["d-saccharide, beta linking","l-saccharide, beta linking","d-saccharide, alpha linking","l-saccharide, alpha linking","l-saccharide","d-saccharide","saccharide"]),new Set(["d-saccharide 1,4 and 1,4 linking","l-saccharide 1,4 and 1,4 linking","d-saccharide 1,4 and 1,6 linking","l-saccharide 1,4 and 1,6 linking"])),fBe=new Set(["non-polymer","other"]),hBe=new Set(["ion"]),gBe=new Set(["lipid"]),hC=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),B3=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HYP","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),bne=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),Eb=$n.unionMany(B3,bne),xne=new Set(["NME","ACE","NH2","FOR","FMT"]),gC=new Set(["A","C","T","G","I","U","N"]),yC=new Set(["DA","DC","DT","DG","DI","DU","DN"]),wV=new Set(["APN","CPN","TPN","GPN"]),yBe=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),vBe=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),Pb=$n.unionMany(gC,yC,wV),Cne=e=>yBe.has(e.toUpperCase()),Sne=e=>vBe.has(e.toUpperCase()),hg=$n.unionMany(Eb,Pb);function _c(e,t){return t=t.toUpperCase(),wV.has(t)?8:pBe.has(e)?5:yne.has(e)?6:gne.has(e)?7:vne.has(e)?9:hC.has(t)?2:AV.has(t)?3:IV.has(t)?4:fBe.has(e)?bm.has(t)?9:Eb.has(t)?5:gC.has(t)?6:yC.has(t)?7:1:0}function Ine(e,t){return t===5?uBe.has(e)?2:dBe.has(e)?3:mBe.has(e)?0:1:t===6?4:t===7?5:t===8?6:0}function _V(e){return e=e.toUpperCase(),Eb.has(e)?"peptide linking":gC.has(e)?"rna linking":yC.has(e)?"dna linking":bm.has(e)?"saccharide":"other"}function Ane(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:hg.has(e)?"y":"n",pdbx_synonyms:[],type:_V(e)}}function wne(e){return e=e.toUpperCase(),hC.has(e)?"water":hg.has(e)?"polymer":bm.has(e)?"branched":"non-polymer"}function _ne(e,t){return e=e.toUpperCase(),fne.has(t)?"polypeptide(L)":pne.has(t)?"polypeptide(D)":yne.has(t)?"polyribonucleotide":gne.has(t)?"polydeoxyribonucleotide":vne.has(t)||bm.has(e)?"oligosaccharide":wV.has(e)?"peptide nucleic acid":B3.has(e)?"polypeptide(L)":bne.has(e)?"polypeptide(D)":gC.has(e)?"polyribonucleotide":yC.has(e)?"polydeoxyribonucleotide":hBe.has(t)||AV.has(e)?"ion":gBe.has(t)||IV.has(e)?"lipid":hne.has(t)?"peptide-like":"other"}function K0(e){return Wi(e)||TV(e)}function Wi(e){return e===7||e===6||e===8}function TV(e){return e===5}var bn;(function(e){e.is=zi.has,e.create=zi.create,e.SecondaryStructureMmcif={helx_lh_27_p:1058,helx_lh_3t_p:2082,helx_lh_al_p:4130,helx_lh_a_n:524321,helx_lh_b_n:1048609,helx_lh_ga_p:8226,helx_lh_n:33,helx_lh_om_p:16418,helx_lh_ot_n:131105,helx_lh_ot_p:546,helx_lh_p:34,helx_lh_pi_p:32802,helx_lh_pp_p:65570,helx_lh_z_n:262177,helx_n:1,helx_ot_n:1,helx_ot_p:2,helx_p:2,helx_rh_27_p:1090,helx_rh_3t_p:2114,helx_rh_al_p:4162,helx_rh_a_n:524353,helx_rh_b_n:1048641,helx_rh_ga_p:8258,helx_rh_n:65,helx_rh_om_p:16450,helx_rh_ot_n:131137,helx_rh_ot_p:578,helx_rh_p:66,helx_rh_pi_p:32834,helx_rh_pp_p:65602,helx_rh_z_n:262209,strn:4194308,turn_ot_p:33554448,turn_p:16,turn_ty1p_p:67109136,turn_ty1_p:67109008,turn_ty2p_p:134218e3,turn_ty2_p:134217872,turn_ty3p_p:268435728,turn_ty3_p:268435600,bend:8,other:0},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}})(bn||(bn={}));var Br;(function(e){e.is=zi.has;function t(a){return zi.create(a)}e.create=t;function r(a){return(a&1)!==0}e.isCovalent=r;function n(a){return a===Math.pow(2,6)-1}e.isAll=n,e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32};function o(a){return a in e.Names}e.isName=o;function i(a){switch(a){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.fromName=i;function s(a){let l=0;for(let c=0,u=a.length;c<u;++c)l|=i(a[c]);return l}e.fromNames=s})(Br||(Br={}));var L3={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]};var lkt={label_comp_id:Wr.atom_site.label_comp_id,label_seq_id:Wr.atom_site.label_seq_id,pdbx_PDB_ins_code:Wr.atom_site.pdbx_PDB_ins_code,label_asym_id:Wr.atom_site.label_asym_id,label_entity_id:Wr.atom_site.label_entity_id,auth_comp_id:Wr.atom_site.auth_atom_id,auth_seq_id:Wr.atom_site.auth_seq_id,auth_asym_id:Wr.atom_site.auth_asym_id},ckt={...Wr.chem_comp_bond,molstar_protonation_variant:ue.Schema.Str()},Tne={...Wr.chem_comp,type:ue.Schema.Aliased(ue.Schema.str)};function Pne(e,t){let{ihm_model_group:r,ihm_model_group_link:n}=t,o=gr.pickRow(n,i=>n.model_id.value(i)===e);if(o){let i=gr.pickRow(r,s=>r.id.value(s)===o.group_id);if(i)return i.name}return""}function Ene(e){for(let t=0,r=e.rowCount;t<r;t++)if(e.valueKind(t)===0)return!0;return!1}function N3(e,t,r){(!e[t].isDefined||!Ene(e[t]))&&(e[t]=e[r]),(!e[r].isDefined||!Ene(e[r]))&&(e[r]=e[t])}function Dne(e){let t=gr.ofColumns(e._schema,e);return N3(t,"label_atom_id","auth_atom_id"),N3(t,"label_comp_id","auth_comp_id"),N3(t,"label_seq_id","auth_seq_id"),N3(t,"label_asym_id","auth_asym_id"),t}var wo={entry:Wr.entry,struct:Wr.struct,struct_asym:Wr.struct_asym,ihm_model_list:Wr.ihm_model_list,ihm_model_group:Wr.ihm_model_group,ihm_model_group_link:Wr.ihm_model_group_link,entity:Wr.entity,entity_poly:Wr.entity_poly,entity_poly_seq:Wr.entity_poly_seq,pdbx_entity_branch:Wr.pdbx_entity_branch,chem_comp:Tne,pdbx_chem_comp_identifier:Wr.pdbx_chem_comp_identifier,atom_site:Wr.atom_site,ihm_sphere_obj_site:Wr.ihm_sphere_obj_site,ihm_gaussian_obj_site:Wr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:Wr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:Wr.pdbx_molecule};function as(e,t=!1){let r=Object.create(null);for(let n of Object.keys(wo))n in e?r[n]=e[n]:r[n]=gr.ofUndefinedColumns(wo[n],0);return t&&(r.atom_site=Dne(r.atom_site)),r}var xBe=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],CBe=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],SBe=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],IBe=new Set(["FMN","NCN","FNS","FMA","ATP","ADP","AMP","GTP","GDP","GMP","LIG"]),kne=function(){let e=new Map;return[{id:"HIS",name:"HISTIDINE",type:"l-peptide linking"},{id:"ARG",name:"ARGININE",type:"l-peptide linking"},{id:"LYS",name:"LYSINE",type:"l-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"l-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"l-peptide linking"},{id:"LEU",name:"LEUCINE",type:"l-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"l-peptide linking"},{id:"ALA",name:"ALANINE",type:"l-peptide linking"},{id:"MET",name:"METHIONINE",type:"l-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"l-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"l-peptide linking"},{id:"VAL",name:"VALINE",type:"l-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"l-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"l-peptide linking"},{id:"TYR",name:"TYROSINE",type:"l-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"l-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"l-peptide linking"},{id:"THR",name:"THREONINE",type:"l-peptide linking"},{id:"PRO",name:"PROLINE",type:"l-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"l-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"l-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"l-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"l-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"l-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"l-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"l-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"I",name:"INOSINIC ACID",type:"rna linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"dna linking"}].forEach(r=>e.set(r.id,r)),e}(),Mne=function(){let e=new Map;return[{id:"ZN2",name:"ZINC ION",type:"ion"},{id:"SOD",name:"SODIUM ION",type:"ion"},{id:"CES",name:"CESIUM ION",type:"ion"},{id:"CLA",name:"CHLORIDE ION",type:"ion"},{id:"CAL",name:"CALCIUM ION",type:"ion"},{id:"POT",name:"POTASSIUM ION",type:"ion"}].forEach(r=>e.set(r.id,r)),e}(),Is=class{set(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(hg.has(t.id)?"y":"n")}getAtomIds(t){let r=new Set,n=this.seqId.value(t);for(;t<this.seqId.rowCount;){let o=this.seqId.value(t);if(o!==n)break;r.add(this.atomId.value(t)),n-o,t+=1}return r}hasAtomIds(t,r){for(let n=0,o=r.length;n<o;++n)if(!$n.areIntersecting(t,r[n]))return!1;return!0}getType(t){return this.hasAtomIds(t,xBe)?"peptide linking":this.hasAtomIds(t,CBe)?"rna linking":this.hasAtomIds(t,SBe)?"dna linking":"other"}has(t){return this.comps.has(t)}get(t){return this.comps.get(t)}add(t,r){if(!this.has(t))if(kne.has(t))this.set(kne.get(t));else if(hC.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(IBe.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else if(bm.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"saccharide"});else{let n=this.getAtomIds(r);if(n.size===1&&Mne.has(t))this.set(Mne.get(t));else{let o=this.getType(n);this.set({id:t,name:this.namesMap.get(t)||t,type:o})}}return this.get(t)}getChemCompTable(){return gr.ofPartialColumns(wo.chem_comp,{id:ue.ofStringArray(this.ids),name:ue.ofStringArray(this.names),type:ue.ofStringAliasArray(this.types),mon_nstd_flag:ue.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)}setNames(t){t.forEach(r=>this.namesMap.set(r[0],r[1]))}constructor(t,r){this.seqId=t,this.atomId=r,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}};function nu(e){let t,r;return(...n)=>{if(!t||t.length!==n.length)return t=n,r=e.apply(void 0,n),r;for(let o=0,i=n.length;o<i;o++)if(n[o]!==t[o])return t=n,r=e.apply(void 0,n),r;return r}}function gg(e){let t=new Map;return r=>{if(t.has(r))return t.get(r);let n=e(r);return t.set(r,n),n}}var EV="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function ABe(e){let t=EV.length,r=e,n=0,o=EV[r%t];for(;r>=t;)r=Math.floor(r/t),o+=EV[r%t],n+=1;return n>=5,o}var yg=gg(ABe);var qi=class{constructor(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}set(t,r){this.count+=1,this.ids.push(`${this.count}`),this.types.push(t),this.descriptions.push([r])}getEntityId(t,r,n,o){return r===2?(this.waterId===void 0&&(this.set("water",o?.customName||"Water"),this.waterId=`${this.count}`),this.waterId):K0(r)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",o?.customName||`Polymer ${this.chainMap.size+1}`),this.chainMap.set(n,`${this.count}`)),this.chainMap.get(n)):(this.heteroMap.has(t)||(this.set("non-polymer",o?.customName||this.namesMap.get(t)||t),this.heteroMap.set(t,`${this.count}`)),this.heteroMap.get(t))}getEntityTable(){return gr.ofPartialColumns(wo.entity,{id:ue.ofStringArray(this.ids),type:ue.ofStringAliasArray(this.types),pdbx_description:ue.ofStringListArray(this.descriptions)},this.count)}setCompounds(t){for(let r=0,n=t.length;r<n;++r){let{chains:o,description:i}=t[r];this.set("polymer",i);for(let s=0,a=o.length;s<a;++s)this.compoundsMap.set(o[s],`${this.count}`)}}setNames(t){t.forEach(r=>this.namesMap.set(r[0],r[1]))}};function Rne(e,t){let r=[],n=[],o=[];e.x.length&&(r.push(...ml(e.x)),n.push(...ml(e.y)),o.push(...ml(e.z))),t&&(t.spheres.x.length&&(r.push(...ml(t.spheres.x)),n.push(...ml(t.spheres.y)),o.push(...ml(t.spheres.z))),t.gaussians.x.length&&(r.push(...ml(t.gaussians.x)),n.push(...ml(t.gaussians.y)),o.push(...ml(t.gaussians.z))));let[i,s]=ml(r),[a,l]=ml(n),[c,u]=ml(o),d=i+(s-i)/2,m=a+(l-a)/2,p=c+(u-c)/2;return D.create(d,m,p)}function Bne(e){let t=new Set,r=new Set;return e.properties.structAsymMap.forEach(({auth_id:n},o)=>{t.add(n),r.add(o)}),{auth:t.size,label:r.size}}var Fs;(function(e){function t(d,m){if(d===m)return!0;if(d.vertexCount!==m.vertexCount||d.edgeCount!==m.edgeCount)return!1;let{a:p,b:h,offset:f}=d,{a:C,b:g,offset:b}=m;for(let y=0,x=d.a.length;y<x;y++)if(p[y]!==C[y])return!1;for(let y=0,x=d.b.length;y<x;y++)if(h[y]!==g[y])return!1;for(let y=0,x=d.offset.length;y<x;y++)if(f[y]!==b[y])return!1;for(let y of Object.keys(d.edgeProps)){let x=d.edgeProps[y],A=m.edgeProps[y];if(!A)return!1;for(let v=0,_=x.length;v<_;v++)if(x[v]!==A[v])return!1}return!0}e.areEqual=t;class r{getEdgeIndex(m,p){let h,f;m<p?(h=m,f=p):(h=p,f=m);for(let C=this.offset[h],g=this.offset[h+1];C<g;C++)if(this.b[C]===f)return C;return-1}getDirectedEdgeIndex(m,p){for(let h=this.offset[m],f=this.offset[m+1];h<f;h++)if(this.b[h]===p)return h;return-1}getVertexEdgeCount(m){return this.offset[m+1]-this.offset[m]}constructor(m,p,h,f,C,g){this.offset=m,this.a=p,this.b=h,this.edgeCount=f,this.props=g,this.vertexCount=m.length-1,this.edgeProps=C||{}}}function n(d,m,p,h,f,C){return new r(d,m,p,h,f,C)}e.create=n;class o{createGraph(m,p){return n(this.offsets,this.a,this.b,this.edgeCount,m,p)}addNextEdge(){let m=this.xs[this.current],p=this.ys[this.current],h=this.offsets[m]+this.bucketFill[m];this.a[h]=m,this.b[h]=p,this.bucketFill[m]++;let f=this.offsets[p]+this.bucketFill[p];this.a[f]=p,this.b[f]=m,this.bucketFill[p]++,this.current++,this.curA=h,this.curB=f}addAllEdges(){for(let m=0;m<this.edgeCount;m++)this.addNextEdge()}assignProperty(m,p){m[this.curA]=p,m[this.curB]=p}assignDirectedProperty(m,p,h,f){m[this.curA]=p,m[this.curB]=f,h[this.curB]=p,h[this.curA]=f}constructor(m,p,h){this.vertexCount=m,this.xs=p,this.ys=h,this.current=0,this.curA=0,this.curB=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);let f=new Int32Array(this.vertexCount);for(let g=0,b=this.xs.length;g<b;g++)f[this.xs[g]]++;for(let g=0,b=this.ys.length;g<b;g++)f[this.ys[g]]++;let C=0;for(let g=0;g<this.vertexCount;g++)this.offsets[g]=C,C+=f[g];this.offsets[this.vertexCount]=C,this.slotCount=C,this.a=new Int32Array(C),this.b=new Int32Array(C)}}e.EdgeBuilder=o;class i{createGraph(m,p){return n(this.offsets,this.a,this.b,this.edgeCount,m,p)}addNextEdge(){let m=this.xs[this.current],p=this.ys[this.current],h=this.offsets[m]+this.bucketFill[m];this.a[h]=m,this.b[h]=p,this.bucketFill[m]++,this.current++,this.curA=h}addAllEdges(){for(let m=0;m<this.edgeCount;m++)this.addNextEdge()}assignProperty(m,p){m[this.curA]=p}constructor(m,p,h){this.vertexCount=m,this.xs=p,this.ys=h,this.current=0,this.curA=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);let f=new Int32Array(this.vertexCount);for(let g=0,b=this.xs.length;g<b;g++)f[this.xs[g]]++;let C=0;for(let g=0;g<this.vertexCount;g++)this.offsets[g]=C,C+=f[g];this.offsets[this.vertexCount]=C,this.slotCount=C,this.a=new Int32Array(C),this.b=new Int32Array(C)}}e.DirectedEdgeBuilder=i;class s{addEdge(m,p){let h=m,f=p;m>p&&(h=p,f=m);let C=Ys(h,f);return this.included.has(C)?!1:(this.included.add(C),this.xs[this.xs.length]=h,this.ys[this.ys.length]=f,!0)}getGraph(){return a(this.vertexCount,this.xs,this.ys)}getEdgeBuiler(){return new o(this.vertexCount,this.xs,this.ys)}constructor(m){this.vertexCount=m,this.xs=[],this.ys=[],this.included=new Set}}e.UniqueEdgeBuilder=s;function a(d,m,p){let h=new e.EdgeBuilder(d,m,p);return h.addAllEdges(),h.createGraph({})}e.fromVertexPairs=a;function l(d,m,p){let{b:h,offset:f,vertexCount:C,edgeProps:g}=d,b=new Int32Array(C);for(let w=0,S=m.length;w<S;w++)b[m[w]]=w+1;let y=0;for(let w=0;w<C;w++)if(b[w]!==0)for(let S=f[w],P=f[w+1];S<P;S++)h[S]>w&&b[h[S]]!==0&&y++;let x=new Int32Array(m.length+1),A=new Int32Array(2*y),v=new Int32Array(2*y),_=new Int32Array(2*y),I=0,T=0;for(let w=0;w<C;w++){if(b[w]===0)continue;let S=b[w]-1;for(let P=f[w],k=f[w+1];P<k;P++){let L=b[h[P]];L!==0&&(v[I]=S,_[I]=L-1,A[I]=P,I++)}x[++T]=I}let E={};for(let w of Object.keys(g))E[w]=Dq(g[w],A);return n(x,v,_,y,E,p)}e.induceByVertices=l;function c(d){let m=d.vertexCount;if(m===0)return{componentCount:0,componentIndex:new Int32Array(0)};if(d.edgeCount===0){let y=new Int32Array(m);for(let x=0,A=m;x<A;x++)y[x]=x;return{componentCount:m,componentIndex:y}}let p=new Int32Array(m);for(let y=0,x=m;y<x;y++)p[y]=-1;let h=0;p[0]=h;let{offset:f,b:C}=d,g=[0],b=v5(m);for(b.remove(0);g.length>0;){let y=g.pop(),x=p[y];for(let A=f[y],v=f[y+1];A<v;A++){let _=C[A];b.has(_)&&(b.remove(_),g.push(_),p[_]=x)}g.length===0&&b.head>=0&&(g.push(b.head),p[b.head]=++h,b.remove(b.head))}return{componentCount:m,componentIndex:p}}e.connectedComponents=c;function u(d,m,p,h){if(Qe.areIntersecting(m,p))return!0;if(h<1)return!1;let f=new Set;for(let C=0,g=m.length;C<g;++C)f.add(m[C]);return Lne(d,m,p,h,f)}e.areVertexSetsConnected=u})(Fs||(Fs={}));function Lne(e,t,r,n,o){let{b:i,offset:s}=e,a=[];for(let l=0,c=t.length;l<c;++l){let u=t[l];for(let d=s[u],m=s[u+1];d<m;++d){let p=i[d];if(!o.has(p)){if(Qe.has(r,p))return!0;o.add(p),a[a.length]=p}}}return n>1?Lne(e,a,r,n-1,o):!1}var PV=class{constructor(){this.map=new Map,this.applicable=new Map}add(t,r,n){this.map.set(t,r),n&&this.applicable.set(t,n)}remove(t){this.map.delete(t),this.applicable.delete(t)}get(t){return this.map.get(t)}isApplicable(t){if(!this.map.has(t.sourceData.kind))return!1;let r=this.applicable.get(t.sourceData.kind);return r?r(t):!0}};var ea;(function(e){function t(r,n){let{name:o}=r,i=new PV;return{descriptor:r,formatRegistry:i,isApplicable(s){return i.isApplicable(s)},get(s){let a=n?.asDynamic?s._dynamicPropertyData:s._staticPropertyData;if(a[o])return a[o];if(s.customProperties.has(r))return;let l=i.get(s.sourceData.kind);if(l)return a[o]=l(s),s.customProperties.add(r),a[o]},set(s,a){n?.asDynamic?s._dynamicPropertyData[o]=a:s._staticPropertyData[o]=a},delete(s){n?.asDynamic?delete s._dynamicPropertyData[o]:delete s._staticPropertyData[o]}}}e.create=t})(ea||(ea={}));function wBe(e,t,r,n){let o=new Fs.EdgeBuilder(n,e,t),i=new Int32Array(o.slotCount),s=new Array(o.slotCount),a=new Array(o.slotCount),l=new Int8Array(o.slotCount),c=new Array(o.slotCount),u=new Array(o.slotCount);for(let d=0,m=o.edgeCount;d<m;d++)o.addNextEdge(),o.assignProperty(i,r.key?r.key[d]:-1),o.assignDirectedProperty(s,r.operatorA?r.operatorA[d]:-1,a,r.operatorB?r.operatorB[d]:-1),o.assignProperty(l,r.order?r.order[d]:1),o.assignProperty(c,r.distance?r.distance[d]:-1),o.assignProperty(u,r.flag?r.flag[d]:1);return o.createGraph({key:i,operatorA:s,operatorB:a,order:l,distance:c,flag:u})}var Zi;(function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=ea.create(e.Descriptor,{asDynamic:!0}),e.DefaultProps={maxDistance:-1,cacheable:!0};function t(n,o={}){let i={...e.DefaultProps,...o},{pairs:s,count:a}=n,l=s.indexA.toArray(),c=s.indexB.toArray(),u=s.key&&s.key.toArray(),d=s.operatorA&&s.operatorA.toArray(),m=s.operatorB&&s.operatorB.toArray(),p=s.order&&s.order.toArray(),h=s.distance&&s.distance.toArray(),f=s.flag&&s.flag.toArray();return{bonds:wBe(l,c,{key:u,operatorA:d,operatorB:m,order:p,distance:h,flag:f},a),maxDistance:i.maxDistance,cacheable:i.cacheable}}e.fromData=t;function r(n,o,i,s,a){let l,c,u,d;o<i?(l=o,c=i,u=s,d=a):(l=i,c=o,u=a,d=s);for(let m=n.offset[l],p=n.offset[l+1];m<p;m++)if(n.b[m]===c&&n.edgeProps.operatorA[m]===u&&n.edgeProps.operatorB[m]===d)return m;return-1}e.getEdgeIndexForOperators=r})(Zi||(Zi={}));var vC=class{get operatorGroups(){return this._operators?this._operators:(this._operators=this.operatorsProvider(),this._operators)}constructor(t,r,n){this.operatorsProvider=n,this.id=t,this.details=r}};(function(e){function t(r,n,o){return new e(r,n,o)}e.create=t})(vC||(vC={}));var vg;(function(e){e.Default={assemblies:[],spacegroup:ha.ZeroP1,isNonStandardCrystalFrame:!1};function t(n,o){let i=o.toLocaleLowerCase(),s=_o.Provider.get(n);return s?Ax(s.assemblies,a=>a.id.toLowerCase()===i):void 0}e.findAssembly=t;function r(n){let{cell:o,name:i,num:s}=n.spacegroup,{size:a,anglesInRadians:l}=o,c=a[0].toFixed(2),u=a[1].toFixed(2),d=a[2].toFixed(2),m=ma(l[0]).toFixed(2),p=ma(l[1]).toFixed(2),h=ma(l[2]).toFixed(2),f=[];return f.push(`Unit Cell <b>${i}</b> #${s}`),f.push(`${c}\xD7${u}\xD7${d} \u212B`),f.push(`\u03B1=${m}\xB0 \u03B2=${p}\xB0 \u03B3=${h}\xB0`),f.join(" | ")}e.getUnitcellLabel=r})(vg||(vg={}));var X0;(function(e){function t(r,n,o,i){return{id:jr.create22(),label:r,basic:n,sourceData:i,bonds:o}}e.create=t})(X0||(X0={}));var _Be={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},TBe={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},EBe={A:"A",C:"C",G:"G",T:"T",U:"U"};function DV(e){return _Be[e]||"X"}function kV(e){return EBe[e]||"X"}function MV(e){return TBe[e]||"X"}var Db;(function(e){let t;(function(c){c.Protein="protein",c.RNA="RNA",c.DNA="DNA",c.Generic="generic"})(t=e.Kind||(e.Kind={}));function r(c){let u=c.code.toArray();return(u instanceof Array?u:Array.from(u)).join("")}e.getSequenceString=r;function n(c){for(let u=0,d=Math.min(c.rowCount,10);u<d;u++){let m=c.value(u)||"";if(DV(m)!=="X")return t.Protein;if(kV(m)!=="X")return t.RNA;if(MV(m)!=="X")return t.DNA}return t.Generic}function o(c,u){let d;switch(c){case t.Protein:d=DV;break;case t.DNA:d=MV;break;case t.RNA:d=kV;break;case t.Generic:d=()=>"X";break;default:Sr(c)}return u&&u.size>0?m=>{let p=d(m);return p!=="X"||!u.has(m)?p:d(u.get(m))}:d}function i(c,u){if(u.rowCount===0)throw new Error("cannot be empty");let d=n(c);return new s(d,c,u)}e.ofResidueNames=i;class s{index(u){return this.indexMap.get(u)}constructor(u,d,m){this.kind=u,this.microHet=new Map;let p=o(u),h=[],f=[],C=[],g=new Map,b=0,y=new Map;for(let A=0,v=m.rowCount;A<v;++A){let _=m.value(A);if(y.has(_))g.has(_)?g.get(_).push(d.value(A)):g.set(_,[f[y.get(_)],d.value(A)]);else{y.set(_,b);let I=d.value(A);f[b]=I,C[b]=_,h[b]=p(I),b+=1}}let x=[];for(let A=0,v=b;A<v;++A){let _=g.get(C[A]);if(_){let I=_.map(T=>{let E=p(T);return E==="X"?T:E});x[A]=`(${I.join("|")})`}else x[A]=h[A]==="X"?f[A]:h[A]}this.length=b,this.code=ue.ofStringArray(h),this.compId=ue.ofStringArray(f),this.seqId=ue.ofIntArray(C),this.label=ue.ofStringArray(x),this.microHet=g,this.indexMap=y}}function a(c,u){let d=t.Generic;return new l(d,c,u)}e.ofSequenceRanges=a;class l{index(u){return u-this.minSeqId}constructor(u,d,m){this.kind=u,this.seqIdStart=d,this.seqIdEnd=m,this.microHet=new Map;let p=0,h=Number.MAX_SAFE_INTEGER;for(let C=0,g=this.seqIdStart.rowCount;C<g;C++){let b=this.seqIdStart.value(C),y=this.seqIdEnd.value(C);b<h&&(h=b),p<y&&(p=y)}let f=p-h+1;this.code=ue.ofConst("X",f,ue.Schema.str),this.label=ue.ofConst("",f,ue.Schema.str),this.seqId=ue.ofLambda({value:C=>C+h+1,rowCount:f,schema:ue.Schema.int}),this.compId=ue.ofConst("",f,ue.Schema.str),this.length=f,this.minSeqId=h}}})(Db||(Db={}));var L2;(function(e){let t={byEntityKey:{},sequences:[]};function r(...a){let l=[],c={};for(let u=0,d=a.length;u<d;++u)l.push(...a[u].sequences),Object.assign(c,a[u].byEntityKey);return{sequences:l,byEntityKey:c}}function n(a,l,c){let u=o(a,l),d=c.isDefined?i(a,c):t;return r(u,d)}e.fromHierarchy=n;function o(a,l){let{label_comp_id:c}=l.atoms,{label_seq_id:u}=l.residues,{chainAtomSegments:d,residueAtomSegments:m}=l,{count:p,offsets:h}=d,f={},C=[];if(p===1&&h[0]===0&&h[1]===0)return{byEntityKey:f,sequences:C};for(let g=0,b=l.chains._rowCount;g<b;g++){let y=l.index.getEntityFromChain(g);if(f[y]!==void 0||a.data.type.value(y)!=="polymer")continue;let x=g;for(g++;g<b&&y===l.index.getEntityFromChain(g)&&a.data.type.value(y)!=="polymer";)g++;g--;let A=m.index[h[x]],v=m.index[h[g+1]-1]+1,_=ue.window(u,A,v),I=[];for(let E=A;E<v;++E)I.push(c.value(m.offsets[E]));let T=ue.ofStringArray(I);f[y]={entityId:a.data.id.value(y),sequence:Db.ofResidueNames(T,_)},C.push(f[y])}return{byEntityKey:f,sequences:C}}e.fromAtomicHierarchy=o;function i(a,l){let c=s(a,l.spheres),u=s(a,l.gaussians);return r(c,u)}e.fromCoarseHierarchy=i;function s(a,l){let{chainElementSegments:c,seq_id_begin:u,seq_id_end:d}=l,{count:m,offsets:p}=c,h={},f=[];if(m===1&&p[0]===0&&p[1]===0)return{byEntityKey:h,sequences:f};for(let C=0,g=m;C<g;C++){let b=l.getEntityFromChain(C);if(h[b]!==void 0)continue;let y=C;for(C++;C<g&&b===l.getEntityFromChain(C);)C++;C--;let x=p[y],A=p[C+1]-1,v=ue.window(u,x,A),_=ue.window(d,x,A);h[b]={entityId:a.data.id.value(b),sequence:Db.ofSequenceRanges(v,_)},f.push(h[b])}return{byEntityKey:h,sequences:f}}e.fromCoarseElements=s})(L2||(L2={}));var ce={};Ui(ce,{Bundle:()=>V2,Location:()=>po,Loci:()=>ey,Stats:()=>JV,atomicProperty:()=>JFe,chainIndex:()=>rOe,coarseProperty:()=>eOe,entityIndex:()=>nOe,property:()=>QFe,residueIndex:()=>tOe});var po;(function(e){function t(p,h,f){return{kind:"element-location",structure:p,unit:h,element:f||0}}e.create=t;function r(p){return t(p.structure,p.unit,p.element)}e.clone=r;function n(p,h,f,C){return h&&(p.structure=h),f&&(p.unit=f),C!==void 0&&(p.element=C),p}e.set=n;function o(p,h){return p.unit=h.unit,p.element=h.element,p}e.copy=o;function i(p){return!!p&&p.kind==="element-location"}e.is=i;function s(p,h){return p.unit===h.unit&&p.element===h.element}e.areEqual=s;let a=D(),l=D();function c(p,h){return p.unit.conformation.position(p.element,a),h.unit.conformation.position(h.element,l),D.distance(a,l)}e.distance=c;function u(p,h){return h.unit.conformation.position(h.element,p)}e.position=u;function d(p){return p.unit.model.atomicHierarchy.residueAtomSegments.index[p.element]}e.residueIndex=d;function m(p){return p.unit.model.atomicHierarchy.chainAtomSegments.index[p.element]}e.chainIndex=m})(po||(po={}));var He;(function(e){function t(a,l,c){return{kind:"variable",name:a,type:l,isConstraint:c}}e.Variable=t;function r(a,l,c){return{kind:"value",namespace:a,name:l,parent:c}}e.Value=r;function n(a,l,c,u){return{kind:"container",namespace:a,name:l,child:c,alias:u}}e.Container=n;function o(a){return{kind:"union",types:a}}e.Union=o;function i(a,l,c,u){let d=Object.create(null);for(let m of u)d[m]=!0;return{kind:"oneof",namespace:a,name:l,type:c,values:d}}e.OneOf=i,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=r("","Number"),e.Str=r("","String"),e.Bool=i("","Bool",e.Str,["true","false"]);function s({values:a}){return Object.keys(a).sort()}e.oneOfValues=s})(He||(He={}));var As;(function(e){function t(l){return{name:l}}e.Symbol=t;function r(l,c){return c?{head:l,args:c}:{head:l}}e.Apply=r;function n(l){return!!l&&Array.isArray(l)}e.isArgumentsArray=n;function o(l){return!!l&&!Array.isArray(l)}e.isArgumentsMap=o;function i(l){return!s(l)&&!a(l)}e.isLiteral=i;function s(l){return!!l&&!!l.head&&typeof l=="object"}e.isApply=s;function a(l){return!!l&&typeof l.name=="string"}e.isSymbol=a})(As||(As={}));function Et(e,t){let{description:r=void 0,isOptional:n=!1,isRest:o=!1,defaultValue:i=void 0}=t||{};return{type:e,isOptional:n,isRest:o,defaultValue:i,description:r}}var ir;(function(e){e.None=t({});function t(n){return{kind:"dictionary",map:n,"@type":0}}e.Dictionary=t;function r(n,o){let{nonEmpty:i=!1}=o||{};return{kind:"list",type:n,nonEmpty:i,"@type":0}}e.List=r})(ir||(ir={}));function kb(e,t,r,n){let o=function(i){return As.Apply(As.Symbol(o.id),i)};return o.info={namespace:"",name:e,description:n},o.id="",o.args=t,o.type=r,o}function Hf(e,t,r,n){let o=function(i){return As.Apply(As.Symbol(o.id),i)};return o.info={namespace:e,name:t,description:n},o.id=`${e}.${t}`,o.args=ir.None,o.type=r,o}function N2(e){let t=e;return typeof t=="function"&&!!t.info&&!!t.args&&typeof t.info.namespace=="string"&&!!t.type}function mr(e,t,r){return kb("",e,t,r)}function F3(e){Fne("","",e)}function O3(e){let t=[];return One(e,t),t}function Nne(e){let t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,(r,n,o,i)=>`${n}-${o.toLocaleLowerCase()}${i}`).replace(t,(r,n,o,i)=>`${n}-${o.toLocaleLowerCase()}${i}`)}function Fne(e,t,r){if(N2(r)){r.info.namespace=e,r.info.name=r.info.name||Nne(t),r.id=`${r.info.namespace}.${r.info.name}`;return}let n=`${r["@namespace"]||Nne(t)}`,o=e?`${e}.${n}`:n;for(let i of Object.keys(r))typeof r[i]!="object"&&!N2(r[i])||Fne(o,i,r[i])}function One(e,t){if(N2(e)){t.push(e);return}for(let r of Object.keys(e))typeof e[r]!="object"&&!N2(e[r])||One(e[r],t)}var xn;(function(e){e.AnyVar=He.Variable("a",He.Any),e.AnyValueVar=He.Variable("a",He.Any),e.ConstrainedVar=He.Variable("a",He.Any,!0),e.Regex=He.Value("Core","Regex"),e.Set=t=>He.Container("Core","Set",t||e.AnyValueVar),e.List=t=>He.Container("Core","List",t||e.AnyVar),e.Fn=(t,r)=>He.Container("Core","Fn",t||e.AnyVar,r),e.Flags=(t,r)=>He.Container("Core","Flags",t,r),e.BitFlags=e.Flags(He.Num,"BitFlags")})(xn||(xn={}));function ya(e,t){return mr(ir.Dictionary({0:Et(e)}),e,t)}function Y0(e,t){return mr(ir.List(e,{nonEmpty:!0}),e,t)}function xm(e,t,r){return mr(ir.Dictionary({0:Et(e),1:Et(e)}),t,r)}var bMt=ir.Dictionary({0:Et(He.Num),1:Et(He.Num)}),PBe={"@header":"Types",bool:mr(ir.Dictionary({0:Et(He.AnyValue)}),He.Bool,"Convert a value to boolean."),num:mr(ir.Dictionary({0:Et(He.AnyValue)}),He.Num,"Convert a value to number."),str:mr(ir.Dictionary({0:Et(He.AnyValue)}),He.Str,"Convert a value to string."),regex:mr(ir.Dictionary({0:Et(He.Str,{description:"Expression"}),1:Et(He.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),xn.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:mr(ir.List(xn.AnyVar),xn.List()),set:mr(ir.List(xn.AnyValueVar),xn.Set()),bitflags:mr(ir.Dictionary({0:Et(He.Num)}),xn.BitFlags,"Interpret a number as bitflags."),compositeKey:mr(ir.List(He.AnyValue),He.AnyValue)},DBe={"@header":"Logic",not:ya(He.Bool),and:Y0(He.Bool),or:Y0(He.Bool)},kBe={"@header":"Control",eval:mr(ir.Dictionary({0:Et(xn.Fn(xn.AnyVar))}),xn.AnyVar,"Evaluate a function."),fn:mr(ir.Dictionary({0:Et(xn.AnyVar)}),xn.Fn(xn.AnyVar),'Wrap an expression to a "lazy" function.'),if:mr(ir.Dictionary({0:Et(He.Bool,{description:"Condition"}),1:Et(He.Variable("a",He.Any),{description:"If true"}),2:Et(He.Variable("b",He.Any),{description:"If false"})}),He.Union([He.Variable("a",He.Any),He.Variable("b",He.Any)])),assoc:mr(ir.Dictionary({0:Et(He.Str,{description:"Name"}),1:Et(He.Variable("a",He.Any),{description:"Value to assign"})}),He.Variable("a",He.Any))},MBe={"@header":"Relational",eq:xm(He.Variable("a",He.AnyValue,!0),He.Bool),neq:xm(He.Variable("a",He.AnyValue,!0),He.Bool),lt:xm(He.Num,He.Bool),lte:xm(He.Num,He.Bool),gr:xm(He.Num,He.Bool),gre:xm(He.Num,He.Bool),inRange:mr(ir.Dictionary({0:Et(He.Num,{description:"Value to test"}),1:Et(He.Num,{description:"Minimum value"}),2:Et(He.Num,{description:"Maximum value"})}),He.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},RBe={"@header":"Math",add:Y0(He.Num),sub:Y0(He.Num),mult:Y0(He.Num),div:xm(He.Num,He.Num),pow:xm(He.Num,He.Num),mod:xm(He.Num,He.Num),min:Y0(He.Num),max:Y0(He.Num),cantorPairing:xm(He.Num,He.Num),sortedCantorPairing:xm(He.Num,He.Num),invertCantorPairing:mr(ir.Dictionary({0:Et(He.Num)}),xn.List(He.Num)),floor:ya(He.Num),ceil:ya(He.Num),roundInt:ya(He.Num),trunc:ya(He.Num),abs:ya(He.Num),sign:ya(He.Num),sqrt:ya(He.Num),cbrt:ya(He.Num),sin:ya(He.Num),cos:ya(He.Num),tan:ya(He.Num),asin:ya(He.Num),acos:ya(He.Num),atan:ya(He.Num),sinh:ya(He.Num),cosh:ya(He.Num),tanh:ya(He.Num),exp:ya(He.Num),log:ya(He.Num),log10:ya(He.Num),atan2:xm(He.Num,He.Num)},BBe={"@header":"Strings",concat:Y0(He.Str),match:mr(ir.Dictionary({0:Et(xn.Regex),1:Et(He.Str)}),He.Bool)},LBe={"@header":"Lists",getAt:mr(ir.Dictionary({0:Et(xn.List()),1:Et(He.Num)}),xn.AnyVar),equal:mr(ir.Dictionary({0:Et(xn.List()),1:Et(xn.List())}),He.Bool)},NBe={"@header":"Sets",has:mr(ir.Dictionary({0:Et(xn.Set(xn.ConstrainedVar)),1:Et(xn.ConstrainedVar)}),He.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:mr(ir.Dictionary({0:Et(xn.Set(xn.ConstrainedVar)),1:Et(xn.Set(xn.ConstrainedVar))}),He.Bool,"Check if the the 1st argument is a subset of the 2nd.")},FBe={"@header":"Flags",hasAny:mr(ir.Dictionary({0:Et(xn.Flags(xn.ConstrainedVar)),1:Et(xn.Flags(xn.ConstrainedVar))}),He.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:mr(ir.Dictionary({0:Et(xn.Flags(xn.ConstrainedVar)),1:Et(xn.Flags(xn.ConstrainedVar))}),He.Bool,"Check if the the 1st argument has all 2nd one's flags.")},V3={"@header":"Language Primitives",type:PBe,logic:DBe,ctrl:kBe,rel:MBe,math:RBe,str:BBe,list:LBe,set:NBe,flags:FBe};F3(V3);var OBe=O3(V3),xMt=function(){let e=Object.create(null);for(let t of OBe)e[t.id]=t;return e}();var Ft;(function(e){e.ElementSymbol=He.Value("Structure","ElementSymbol"),e.AtomName=He.Value("Structure","AtomName"),e.BondFlag=He.OneOf("Structure","BondFlag",He.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=xn.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=He.OneOf("Structure","SecondaryStructureFlag",He.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=xn.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=He.Value("Structure","RingFingerprint"),e.EntityType=He.OneOf("Structure","EntityType",He.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=He.OneOf("Structure","EntitySubtype",He.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=He.OneOf("Structure","ObjectPrimitive",He.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=He.Value("Structure","ResidueId"),e.ElementSet=He.Value("Structure","ElementSet"),e.ElementSelection=He.Value("Structure","ElementSelection"),e.ElementReference=He.Value("Structure","ElementReference"),e.ElementSelectionQuery=xn.Fn(e.ElementSelection,"ElementSelectionQuery")})(Ft||(Ft={}));var GBe={"@header":"Types",elementSymbol:mr(ir.Dictionary({0:Et(He.Str)}),Ft.ElementSymbol,"Create element symbol representation from a string value."),atomName:mr(ir.Dictionary({0:Et(He.AnyValue)}),Ft.AtomName,"Convert a value to an atom name."),entityType:mr(ir.Dictionary({0:Et(Ft.EntityType)}),Ft.EntityType,`Create normalized representation of entity type: ${He.oneOfValues(Ft.EntityType).join(", ")}.`),bondFlags:mr(ir.List(Ft.BondFlag),Ft.BondFlags,`Create bond flags representation from a list of strings. Allowed flags: ${He.oneOfValues(Ft.BondFlag).join(", ")}.`),ringFingerprint:mr(ir.List(Ft.ElementSymbol,{nonEmpty:!0}),Ft.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:mr(ir.List(Ft.SecondaryStructureFlag),Ft.SecondaryStructureFlags,`Create secondary structure flags representation from a list of strings. Allowed flags: ${He.oneOfValues(Ft.SecondaryStructureFlag).join(", ")}.`),authResidueId:mr(ir.Dictionary({0:Et(He.Str,{description:"auth_asym_id"}),1:Et(He.Num,{description:"auth_seq_id"}),2:Et(He.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Ft.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:mr(ir.Dictionary({0:Et(He.Str,{description:"label_entity_id"}),1:Et(He.Str,{description:"label_asym_id"}),2:Et(He.Num,{description:"label_seq_id"}),3:Et(He.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),Ft.ResidueId,`Residue identifier based on mmCIF's "label_" annotation.`)},UBe={"@header":"Iteration Slots",element:mr(ir.None,Ft.ElementReference,"A reference to the current element."),elementSetReduce:mr(ir.None,He.Variable("a",He.AnyValue,!0),"Current value of the element set reducer.")},zBe={"@header":"Generators",all:mr(ir.None,Ft.ElementSelectionQuery,"The entire structure."),atomGroups:mr(ir.Dictionary({"entity-test":Et(He.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":Et(He.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":Et(He.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":Et(He.Bool,{isOptional:!0,defaultValue:!0}),"group-by":Et(He.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Ft.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:mr(ir.Dictionary({0:Et(He.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),Ft.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:mr(ir.Dictionary({fingerprint:Et(Ft.RingFingerprint,{isOptional:!0}),"only-aromatic":Et(He.Bool,{isOptional:!0,defaultValue:!1})}),Ft.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),query:Et(Ft.ElementSelectionQuery),"in-complement":Et(He.Bool,{isOptional:!0,defaultValue:!1})}),Ft.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:mr(ir.None,Ft.ElementSelectionQuery,"Nada.")},HBe={"@header":"Selection Modifications",queryEach:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),query:Et(Ft.ElementSelectionQuery)}),Ft.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),by:Et(Ft.ElementSelectionQuery)}),Ft.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),by:Et(Ft.ElementSelectionQuery)}),Ft.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),by:Et(Ft.ElementSelectionQuery)}),Ft.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery)}),Ft.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),"min-distance":Et(He.Num,{isOptional:!0,defaultValue:0}),"max-distance":Et(He.Num),"min-size":Et(He.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":Et(He.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),Ft.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),radius:Et(He.Num),"atom-radius":Et(He.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":Et(He.Bool,{isOptional:!0})}),Ft.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),radius:Et(He.Num),"include-water":Et(He.Bool,{isOptional:!0,defaultValue:!0})}),Ft.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),"bond-test":Et(He.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":Et(He.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":Et(He.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":Et(He.Bool,{isOptional:!0})}),Ft.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery)}),Ft.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),property:Et(He.AnyValue)}),Ft.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},jBe={"@header":"Selection Filters",pick:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),test:Et(He.Bool)}),Ft.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery)}),Ft.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),source:Et(Ft.ElementSelectionQuery),property:Et(He.Any)}),Ft.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),by:Et(Ft.ElementSelectionQuery)}),Ft.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),target:Et(Ft.ElementSelectionQuery),"min-radius":Et(He.Num,{isOptional:!0,defaultValue:0}),"max-radius":Et(He.Num),"atom-radius":Et(He.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:Et(He.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),Ft.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery),target:Et(Ft.ElementSelectionQuery),"bond-test":Et(He.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:Et(He.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:Et(He.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),Ft.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},$Be={"@header":"Selection Combinators",intersect:mr(ir.List(Ft.ElementSelectionQuery),Ft.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:mr(ir.List(Ft.ElementSelectionQuery),Ft.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:mr(ir.Dictionary({matrix:Et(xn.List(xn.List(He.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:Et(xn.List(Ft.ElementSelectionQuery),{description:"A list of held selections."})}),Ft.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},WBe={"@header":"Atom Sets",atomCount:mr(ir.None,He.Num),countQuery:mr(ir.Dictionary({0:Et(Ft.ElementSelectionQuery)}),He.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:mr(ir.Dictionary({initial:Et(He.Variable("a",He.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:Et(He.Variable("a",He.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),He.Variable("a",He.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:mr(ir.Dictionary({0:Et(xn.ConstrainedVar)}),xn.Set(xn.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},qBe={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:Cn(Ft.ElementSymbol),vdw:Cn(He.Num,"Van der Waals radius"),mass:Cn(He.Num,"Atomic weight"),atomicNumber:Cn(He.Num,"Atomic number"),x:Cn(He.Num,"Cartesian X coordinate"),y:Cn(He.Num,"Cartesian Y coordinate"),z:Cn(He.Num,"Cartesian Z coordinate"),atomKey:Cn(He.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:mr(ir.Dictionary({0:Et(Ft.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:Et(Ft.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),He.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:Cn(He.Num,"Index of the atom/element in the input file."),operatorName:Cn(He.Str,"Name of the symmetry operator applied to this element."),operatorKey:Cn(He.Num,"Key of the symmetry operator applied to this element."),modelIndex:Cn(He.Num,"Index of the model in the input file."),modelLabel:Cn(He.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:Cn(He.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:Cn(Ft.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:Cn(Ft.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:Cn(He.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:Cn(He.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:Cn(He.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:Cn(He.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:Cn(He.Num,"_atom_site.id"),label_atom_id:Cn(Ft.AtomName),label_alt_id:Cn(He.Str),label_comp_id:Cn(He.Str),label_asym_id:Cn(He.Str),label_entity_id:Cn(He.Str),label_seq_id:Cn(He.Num),auth_atom_id:Cn(Ft.AtomName),auth_comp_id:Cn(He.Str),auth_asym_id:Cn(He.Str),auth_seq_id:Cn(He.Num),pdbx_PDB_ins_code:Cn(He.Str),pdbx_formal_charge:Cn(He.Num),occupancy:Cn(He.Num),B_iso_or_equiv:Cn(He.Num),entityType:Cn(Ft.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:Cn(Ft.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:Cn(He.Str,"The PRD ID of the entity."),entityDescription:Cn(xn.List(He.Str)),objectPrimitive:Cn(Ft.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:Cn(He.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:Cn(Ft.SecondaryStructureFlags),isModified:Cn(He.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:Cn(He.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:Cn(He.Bool,"True if this is a non-standard residue."),chemCompType:Cn(He.Str,"Type of the chemical component as defined in mmCIF.")}},ZBe={"@header":"Bond Properties",flags:bC(Ft.BondFlags),order:bC(He.Num),key:bC(He.Num),length:bC(He.Num),atomA:bC(Ft.ElementReference),atomB:bC(Ft.ElementReference)};function Cn(e,t){return mr(ir.Dictionary({0:Et(Ft.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function bC(e,t){return mr(ir.None,e,t)}var Vne={"@header":"Structure Queries",type:GBe,slot:UBe,generator:zBe,modifier:HBe,filter:jBe,combinator:$Be,atomSet:WBe,atomProperty:qBe,bondProperty:ZBe};var XBe={"@header":"Generators",bundleElement:mr(ir.Dictionary({groupedUnits:Et(He.Any),set:Et(He.Any),ranges:Et(He.Any)}),He.Any),bundle:mr(ir.Dictionary({elements:Et(He.Any)}),Ft.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:mr(ir.None,Ft.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")},Gne={"@header":"Internal Queries",generator:XBe};var Oe={core:V3,structureQuery:Vne,internal:Gne};F3(Oe);var YBe=O3(Oe),MMt=function(){let e=Object.create(null);for(let t of YBe)e[t.id]=t;return e}();var ye;(function(e){e.core=Oe.core,e.struct=Oe.structureQuery,e.internal=Oe.internal;function t(b){return e.struct.type.atomName([b])}e.atomName=t;function r(b){return e.struct.type.elementSymbol([b])}e.es=r;function n(...b){return e.core.type.list(b)}e.list=n;function o(...b){return e.core.type.set(b)}e.set=o;function i(b,y){return e.core.type.regex([b,y])}e.re=i;function s(b){return e.core.ctrl.fn([b])}e.fn=s;function a(b){return e.core.ctrl.eval([b])}e.evaluate=a;let l=e.struct.atomProperty.core,c=e.struct.atomProperty.macromolecular,u=e.struct.atomProperty.topology;function d(b){return l[b]()}e.acp=d;function m(b){return u[b]()}e.atp=m;function p(b){return c[b]()}e.ammp=p;let h=e.struct.atomSet.propertySet;function f(b){return h([d(b)])}e.acpSet=f;function C(b){return h([m(b)])}e.atpSet=C;function g(b){return h([p(b)])}e.ammpSet=g})(ye||(ye={}));var Ed=class e{getConnectedUnits(t){return this.map.has(t)?this.map.get(t):Une}getEdgeIndex(t,r,n,o){let i=e.getEdgeKey(t,r,n,o),s=this.edgeKeyIndex.get(i);return s!==void 0?s:-1}hasEdge(t,r,n,o){return this.getEdgeIndex(t,r,n,o)!==-1}getEdge(t,r,n,o){let i=this.getEdgeIndex(t,r,n,o);return i!==-1?this.edges[i]:void 0}getEdgeIndices(t,r){return this.vertexKeyIndex.get(e.getVertexKey(t,r))||[]}constructor(t){this.map=t;let r=0,n=[],o=new Map,i=new Map;this.map.forEach(s=>{s.forEach(a=>{r+=a.edgeCount,a.connectedIndices.forEach(l=>{a.getEdges(l).forEach(c=>{let{unitA:u,unitB:d}=a,m=e.getEdgeKey(l,u,c.indexB,d);o.set(m,n.length);let p=e.getVertexKey(l,u),h=i.get(p);h===void 0?i.set(p,[n.length]):h.push(n.length),n.push({...c,indexA:l,unitA:u,unitB:d})})})})}),this.edgeCount=r,this.edges=n,this.edgeKeyIndex=o,this.vertexKeyIndex=i}};(function(e){class t{hasEdges(a){return this.edgeMap.has(a)}getEdges(a){return this.edgeMap.has(a)?this.edgeMap.get(a):Une}get areUnitsOrdered(){return this.unitA<this.unitB}constructor(a,l,c,u,d){this.unitA=a,this.unitB=l,this.edgeCount=c,this.connectedIndices=u,this.edgeMap=d}}e.UnitPairEdges=t;function r(s,a,l,c){return`${s}|${a}|${l}|${c}`}e.getEdgeKey=r;function n(s,a){return`${s}|${a}`}e.getVertexKey=n;function o(s,a,l){s.has(a)?s.get(a).push(l):s.set(a,[l])}class i{constructor(){this.map=new Map}startUnitPair(a,l){this.uA=a,this.uB=l,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=vn.create(),this.linkedB=vn.create(),this.linkCount=0}finishUnitPair(){this.linkCount!==0&&(o(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),o(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))}add(a,l,c){o(this.mapAB,a,{indexB:l,props:c}),o(this.mapBA,l,{indexB:a,props:c}),vn.add(this.linkedA,a,a),vn.add(this.linkedB,l,l),this.linkCount+=1}getMap(){return this.map}}e.Builder=i})(Ed||(Ed={}));var Une=[];var G3;(function(e){e.Empty=Fs.create([],[],[],0,{flags:[],order:[],key:[]})})(G3||(G3={}));var bg=class extends Ed{getBondFromLocation(t){return Le.isAtomic(t.aUnit)&&Le.isAtomic(t.bUnit)?this.getEdge(t.aIndex,t.aUnit.id,t.bIndex,t.bUnit.id):void 0}getBondIndexFromLocation(t){return Le.isAtomic(t.aUnit)&&Le.isAtomic(t.bUnit)?this.getEdgeIndex(t.aIndex,t.aUnit.id,t.bIndex,t.bUnit.id):-1}};(function(e){class t extends Ed.UnitPairEdges{}e.UnitPairBonds=t})(bg||(bg={}));var U3={forceCompute:!1,noCompute:!1,maxRadius:4},RV={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},QBe={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},JBe={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},zne=2.001,Q0=function(){let e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set;for(let r of e)t.add(RV[r]);return t}();function eLe(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}function Uu(e){let t=RV[e];return t===void 0?-1:t}function tLe(e,t){if(e<0||t<0)return-1;let r=JBe[eLe(e,t)];return r===void 0?-1:r}function jf(e){if(e<0)return zne;let t=QBe[e];return t===void 0?zne:t}function xC(e,t,r,n){let o=tLe(e,t);return o>0?o:t<0?r:(r+n)/1.95}var rLe=RV.H;function Cm(e){return e===rLe}var nLe=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function Hne(e,t,r){return[t,r]=t<r?[t,r]:[r,t],Eb.has(e)&&t==="C"&&r==="O"||Pb.has(e)&&t==="OP1"&&r==="P"?2:nLe.get(`${e}|${t}|${r}`)||1}var oLe=new Map([["LYS|NZ|RET|C15",2]]);function z3(e,t,r,n){return e>r&&([e,r]=[r,e],[t,n]=[n,t]),oLe.get(`${e}|${t}|${r}|${n}`)||1}var H3;(function(e){function t(a,l,c){return{name:a,type:0,value:l,valueKind:c&&c.valueKind,defaultFormat:c&&c.encoder?{encoder:c.encoder}:void 0,shouldInclude:c&&c.shouldInclude}}e.str=t;function r(a,l,c){return{name:a,type:1,value:l,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray}:void 0,shouldInclude:c&&c.shouldInclude}}e.int=r;function n(a,l,c){return{name:a,type:2,value:l,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray,digitCount:typeof c.digitCount<"u"?c.digitCount:void 0}:void 0,shouldInclude:c&&c.shouldInclude}}e.float=n;function o(a){return r(a,(l,c,u)=>u+1,{typedArray:Int32Array,encoder:Yr.by(Yr.delta).and(Yr.runLength).and(Yr.integerPacking)})}e.index=o;class i{constructor(){this.fields=[]}index(l){return this.fields.push(e.index(l)),this}str(l,c,u){return this.fields.push(e.str(l,c,u)),this}int(l,c,u){return this.fields.push(e.int(l,c,u)),this}vec(l,c,u){for(let d=0;d<c.length;d++)this.fields.push(e.int(`${l}[${d+1}]`,c[d],u));return this}float(l,c,u){return this.fields.push(e.float(l,c,u)),this}many(l){for(let c=0;c<l.length;c++)this.fields.push(l[c]);return this}add(l){return this.fields.push(l),this}getFields(){return this.fields}}e.Builder=i;function s(){return new i}e.build=s})(H3||(H3={}));var Tc;(function(e){e.Empty={fields:[],source:[]};function t(n){let o=[],i=[],s=[],a=[];for(let c of n.split(/[\r\n]+/)){if(c=c.trim(),c.length===0)continue;let u=/^!/.test(c);u&&(c=c.substr(1));let d=c.split(/\./),m=d[1],p=u?m?a:i:m?s:o;p[p.length]=c,m&&!o.includes(d[0])&&(o[o.length]=d[0])}let l=s.map(c=>c.split(".")[0]);return{includeCategory(c){return i.includes(c)?!1:o.length<=0||o.indexOf(c)!==-1},includeField(c,u){let d=c+"."+u;return a.includes(d)?!1:!l.includes(c)||s.includes(d)}}}e.filterOf=t,e.DefaultFilter={includeCategory(n){return!0},includeField(n,o){return!0}},e.DefaultFormatter={getFormat(n,o){}};function r(n,o){return o?{fields:jne(n._schema),source:[{data:n,rowCount:o.length,keys:()=>H0.Array(o)}]}:{fields:jne(n._schema),source:[{data:n,rowCount:n._rowCount}]}}e.ofTable=r})(Tc||(Tc={}));var j3;(function(e){function t(n,o,i){n.startDataBlock(o);for(let s of i._tableNames)n.writeCategory({name:s,instance:()=>Tc.ofTable(i[s])})}e.writeDatabase=t;function r(n,o){for(let i of Object.keys(o))t(n,i,o[i])}e.writeDatabaseCollection=r})(j3||(j3={}));function BV(e){return(t,r)=>r[e].value(t)}function iLe(e){return(t,r)=>r[e].value(t).join(r[e].schema.separator)}function LV(e,...t){return(r,n)=>n[e].schema.space.get(n[e].value(r),...t)}function F2(e){return(t,r)=>r[e].valueKind(t)}function sLe(e,t){let r=[],o=F2(e);if(t.rank===1){let i=t.dimensions[0];for(let s=0;s<i;s++){let a=`${e}[${s+1}]`;r.push({name:a,type:2,value:LV(e,s),valueKind:o})}}else if(t.rank===2){let i=t.dimensions[0],s=t.dimensions[1];for(let a=0;a<i;a++)for(let l=0;l<s;l++){let c=`${e}[${a+1}][${l+1}]`;r.push({name:c,type:2,value:LV(e,a,l),valueKind:o})}}else if(t.rank===3){let i=t.dimensions[0],s=t.dimensions[1],a=t.dimensions[2];for(let l=0;l<i;l++)for(let c=0;c<s;c++)for(let u=0;u<a;u++){let d=`${e}[${l+1}][${c+1}][${u+1}]`;r.push({name:d,type:2,value:LV(e,l,c,u),valueKind:o})}}else throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");return r}function jne(e){let t=[];for(let r of Object.keys(e)){let n=e[r];n.valueType==="int"?t.push({name:r,type:1,value:BV(r),valueKind:F2(r)}):n.valueType==="float"?t.push({name:r,type:2,value:BV(r),valueKind:F2(r)}):n.valueType==="str"?t.push({name:r,type:0,value:BV(r),valueKind:F2(r)}):n.valueType==="list"?t.push({name:r,type:0,value:iLe(r),valueKind:F2(r)}):n.valueType==="tensor"?t.push(...sLe(r,n.space)):Sr(n.valueType)}return t}function $ne(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function O2(e){return e.fields.some(t=>!!t.shouldInclude)?e.fields.filter(t=>!t.shouldInclude||e.source.some(r=>t.shouldInclude(r.data))):e.fields}function $3(e,t){let r=e.instance(t),n=r.source.filter(s=>s.rowCount>0);if(!n.length)return{instance:r,rowCount:0,source:[]};let o=n.reduce((s,a)=>s+a.rowCount,0),i=n.map(s=>({data:s.data,keys:()=>s.keys?s.keys():H0.Range(0,s.rowCount-1),rowCount:s.rowCount}));return{instance:r,rowCount:o,source:i}}var q3=class{constructor(){this.builder=_n.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=Tc.DefaultFilter,this.formatter=Tc.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}setFilter(t){this.filter=t||Tc.DefaultFilter}isCategoryIncluded(t){return this.filter.includeCategory(t)}setFormatter(t){this.formatter=t||Tc.DefaultFormatter}startDataBlock(t){this.dataBlockCreated=!0,_n.write(this.builder,`data_${(t||"").replace(/[ \n\t]/g,"").toUpperCase()}
#
`)}writeCategory(t,r,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!n?.ignoreFilter&&!this.filter.includeCategory(t.name))return;let{instance:o,rowCount:i,source:s}=$3(t,r);i&&(i===1?lLe(t,o,s,this.builder,this.filter,this.formatter):cLe(t,o,s,this.builder,this.filter,this.formatter))}encode(){this.encoded=!0}writeTo(t){let r=_n.getChunks(this.builder);for(let n=0,o=r.length;n<o;n++)t.writeString(r[n])}getSize(){return _n.getSize(this.builder)}getData(){return _n.getString(this.builder)}};function qne(e,t,r,n,o,i){let s=n.valueKind,a=s?s(r,t):0;if(a!==0)a===1?pLe(e):fLe(e);else{let l=n.value(r,t,i),c=n.type;if(c===0)return uLe(l)?(W3(e,l),!0):hLe(e,l);c===1?dLe(e,l):mLe(e,l,o)}return!1}function Zne(e,t,r){let n=[];for(let o of t){let i=r.getFormat(e,o.name);i&&typeof i.digitCount<"u"?n[n.length]=o.type===2?Math.pow(10,Math.max(0,Math.min(i.digitCount,15))):0:n[n.length]=o.type===2?Math.pow(10,$ne(o)):0}return n}function lLe(e,t,r,n,o,i){let s=O2(t),a=r[0],l=a.data,c=s.reduce((p,h)=>o.includeField(e.name,h.name)?Math.max(p,h.name.length):0,0);if(c===0)return;c+=e.name.length+6;let d=a.keys().move(),m=Zne(e.name,t.fields,i);for(let p=0;p<s.length;p++){let h=s[p];if(!o.includeField(e.name,h.name))continue;_n.writePadRight(n,`_${e.name}.${h.name}`,c),qne(n,l,d,h,m[p],0)||_n.newline(n)}_n.write(n,`#
`)}function cLe(e,t,r,n,o,i){let s=O2(t),a=o===Tc.DefaultFilter?s:s.filter(d=>o.includeField(e.name,d.name)),l=a.length;if(l===0)return;let c=Zne(e.name,a,i);Wne(n,"loop_");for(let d=0;d<l;d++)Wne(n,`_${e.name}.${a[d].name}`);let u=0;for(let d=0;d<r.length;d++){let m=r[d],p=m.data;if(m.rowCount===0)continue;let h=m.keys();for(;h.hasNext;){let f=h.move(),C=!1;for(let g=0;g<l;g++)C=qne(n,p,f,a[g],c[g],u);C||_n.newline(n),u++}}_n.write(n,`#
`)}function uLe(e){return typeof e=="string"&&e.indexOf(`
`)>=0}function Wne(e,t){_n.write(e,t),_n.newline(e)}function dLe(e,t){_n.writeInteger(e,t),_n.whitespace1(e)}function mLe(e,t,r){_n.writeFloat(e,t,r),_n.whitespace1(e)}function pLe(e){_n.writeSafe(e,". ")}function fLe(e){_n.writeSafe(e,"? ")}function hLe(e,t){if(!t)return _n.writeSafe(e,". "),!1;let r=t.charCodeAt(0),n=!1,o=0,i=!1,s=!1;for(let a=0,l=t.length-1;a<=l;a++)switch(t.charCodeAt(a)){case 9:n=!0;break;case 10:return W3(e,t),!0;case 32:n=!0;break;case 34:if(a&&a===l)break;if(i)return W3(e,t),!0;s=!0,n=!0,o=0;break;case 39:if(a&&a===l)break;if(s)return W3(e,t),!0;i=!0,n=!0,o=1;break}return!n&&(r===35||r===36||r===59||r===91||r===93||r===95)&&(n=!0),n?(_n.writeSafe(e,o?'"':"'"),_n.writeSafe(e,t),_n.writeSafe(e,o?'" ':"' ")):(_n.writeSafe(e,t),_n.writeSafe(e," ")),!1}function W3(e,t){_n.writeSafe(e,`
;`+t),_n.writeSafe(e,`
;
`)}function Kne(e){let t=new ArrayBuffer(Z3(e)),r=new DataView(t),n=new Uint8Array(t);return K3(e,r,n,0),n}function Z3(e){let t=typeof e;if(t==="string"){let r=Tx(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(e instanceof Uint8Array){let r=e.byteLength;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(t==="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(t==="boolean"||e===null||e===void 0)return 1;if(t==="object"){let r,n=0;if(Array.isArray(e)){r=e.length;for(let o=0;o<r;o++)n+=Z3(e[o])}else{let o=Object.keys(e);r=o.length;for(let i=0;i<r;i++){let s=o[i];n+=Z3(s)+Z3(e[s])}}if(r<16)return 1+n;if(r<65536)return 3+n;if(r<4294967296)return 5+n;throw new Error("Array or object too long 0x"+r.toString(16))}throw new Error("Unknown type "+t)}function K3(e,t,r,n){let o=typeof e;if(o==="string"){let i=Tx(e);if(i<32)return t.setUint8(n,i|160),g0(r,n+1,e),1+i;if(i<256)return t.setUint8(n,217),t.setUint8(n+1,i),g0(r,n+2,e),2+i;if(i<65536)return t.setUint8(n,218),t.setUint16(n+1,i),g0(r,n+3,e),3+i;if(i<4294967296)return t.setUint8(n,219),t.setUint32(n+1,i),g0(r,n+5,e),5+i}if(e instanceof Uint8Array){let i=e.byteLength,s=new Uint8Array(t.buffer);if(i<256)return t.setUint8(n,196),t.setUint8(n+1,i),s.set(e,n+2),2+i;if(i<65536)return t.setUint8(n,197),t.setUint16(n+1,i),s.set(e,n+3),3+i;if(i<4294967296)return t.setUint8(n,198),t.setUint32(n+1,i),s.set(e,n+5),5+i}if(o==="number"){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(e==null)return t.setUint8(n,192),1;if(o==="boolean")return t.setUint8(n,e?195:194),1;if(o==="object"){let i,s=0,a=Array.isArray(e),l;if(a?i=e.length:(l=Object.keys(e),i=l.length),i<16?(t.setUint8(n,i|(a?144:128)),s=1):i<65536?(t.setUint8(n,a?220:222),t.setUint16(n+1,i),s=3):i<4294967296&&(t.setUint8(n,a?221:223),t.setUint32(n+1,i),s=5),a)for(let c=0;c<i;c++)s+=K3(e[c],t,r,n+s);else for(let c=0,u=l.length;c<u;c++){let d=l[c];s+=K3(d,t,r,n+s),s+=K3(e[d],t,r,n+s)}return s}throw new Error("Unknown type "+o)}var X3=class{setFilter(t){this.filter=t||Tc.DefaultFilter}isCategoryIncluded(t){return this.filter.includeCategory(t)}setFormatter(t){this.formatter=t||Tc.DefaultFormatter}startDataBlock(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})}writeCategory(t,r,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!n?.ignoreFilter&&!this.filter.includeCategory(t.name))return;let{instance:o,rowCount:i,source:s}=$3(t,r);if(!i)return;let a={name:"_"+t.name,columns:[],rowCount:i},l=O2(o);for(let c of l){if(!this.filter.includeField(t.name,c.name))continue;let u=this.formatter.getFormat(t.name,c.name);a.columns.push(xLe(t.name,c,s,i,u,this.binaryEncodingProvider,this.autoClassify))}a.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(a)}encode(){this.encodedData||(this.encodedData=Kne(this.data),this.data=null,this.dataBlocks=null)}writeTo(t){t.writeBinary(this.encodedData)}getData(){return this.encode(),this.encodedData}getSize(){return this.encodedData.length}constructor(t,r,n){this.autoClassify=n,this.dataBlocks=[],this.filter=Tc.DefaultFilter,this.formatter=Tc.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=r,this.data={encoder:t,version:Cq,dataBlocks:this.dataBlocks}}};function gLe(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===0?Array:e.type===1?Int32Array:Float64Array}function yLe(e){return e===0?Cp.by(Yr.stringArray):Cp.by(Yr.byteArray)}function vLe(e,t,r,n){return r&&r.encoder?r.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:n?n.get(e,t.name):void 0}function bLe(e,t){return e===0?Cp.by(Yr.stringArray):e===1?UA(t):Bq(t)}function xLe(e,t,r,n,o,i,s){let{array:a,allPresent:l,mask:c}=CLe(t,gLe(t,o),n,r),u;t.type===0?u=Cp.by(Yr.stringArray):u=vLe(e,t,o,i),u||(s?u=bLe(t.type,a):u=yLe(t.type));let d=u.encode(a),m;if(!l){let p=Cp.by(Yr.runLength).and(Yr.byteArray).encode(c);p.data.length<c.length?m=p:m=Cp.by(Yr.byteArray).encode(c)}return{name:t.name,data:d,mask:m}}function CLe(e,t,r,n){let o=e.type===0,i=new t(r),s=new Uint8Array(r),a=e.valueKind,l=e.value,c=!0,u=0;for(let d=0;d<n.length;d++){let m=n[d].data,p=n[d].keys();for(;p.hasNext;){let h=p.move(),f=a?a(h,m):0;if(f!==0)s[u]=f,o&&(i[u]=""),c=!1;else{let C=l(h,m,u);typeof C=="string"&&!C?(s[u]=1,c=!1):s[u]=0,i[u]=C}u++}}return{array:i,allPresent:c,mask:s}}var fo;(function(e){e.Encoder=j3,e.Category=Tc,e.Field=H3,e.Encoding=Yr;function t(l){let{binary:c=!1,encoderName:u="mol*"}=l||{};return c?new X3(u,l?l.binaryEncodingPovider:void 0,l?!!l.binaryAutoClassifyEncoding:!1):new q3}e.createEncoder=t;function r(){return e.Field.build()}e.fields=r;var n=e.Encoding;e.Encodings={deltaRLE:n.by(n.delta).and(n.runLength).and(n.integerPacking),fixedPoint2:n.by(n.fixedPoint(100)).and(n.delta).and(n.integerPacking),fixedPoint3:n.by(n.fixedPoint(1e3)).and(n.delta).and(n.integerPacking)};function o(l,c){return{fields:l,source:[c]}}e.categoryInstance=o;function i(l){return{get(c,u){let d=l.categories[c];if(!d)return;let m=d.getField(u);return m&&m.binaryEncoding?Cp.fromEncoding(m.binaryEncoding):void 0}}}e.createEncodingProviderFromCifFrame=i;function s(l){return{get(c,u){for(let d=0;d<l.length;d++){let m=l[d];if(m.categoryName===c&&m.columnName===u)return a(m)}}}}e.createEncodingProviderFromJsonConfig=s;function a(l){let c=l.precision;if(c!==void 0){let u=Math.pow(10,c),d=n.by(n.fixedPoint(u));switch(l.encoding){case"pack":return d.and(n.integerPacking);case"rle":return d.and(n.runLength).and(n.integerPacking);case"delta":return d.and(n.delta).and(n.integerPacking);case"delta-rle":return d.and(n.delta).and(n.runLength).and(n.integerPacking)}}else switch(l.encoding){case"pack":return n.by(n.integerPacking);case"rle":return n.by(n.runLength).and(n.integerPacking);case"delta":return n.by(n.delta).and(n.integerPacking);case"delta-rle":return n.by(n.delta).and(n.runLength).and(n.integerPacking)}throw new Error("cannot be reached")}})(fo||(fo={}));var xg;(function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance(o){let i=e.Provider.get(o.firstModel);if(!i)return fo.Category.Empty;let s=i.data;if(!s)return fo.Category.Empty;let a=o.structures[0].uniqueResidueNames,{comp_id:l,_rowCount:c}=s,u=[];for(let d=0;d<c;d++)a.has(l.value(d))&&(u[u.length]=d);return fo.Category.ofTable(s,u)}}]}},e.Provider=ea.create(e.Descriptor);function t(o,i){return gr.pick(i,Wr.chem_comp_bond,s=>o.properties.chemicalComponentMap.has(i.comp_id.value(s)))}e.chemCompBondFromTable=t;function r(o){let i=new Map;function s(f){if(i.has(f))return i.get(f);let C=new n(f);return i.set(f,C),C}let{comp_id:a,atom_id_1:l,atom_id_2:c,value_order:u,pdbx_aromatic_flag:d,_rowCount:m,pdbx_ordinal:p}=o,h=s(a.value(0));for(let f=0;f<m;f++){let C=a.value(f),g=l.value(f),b=c.value(f),y=u.value(f),x=d.value(f)==="y",A=p.value(f);h.id!==C&&(h=s(C));let v=1,_=1;switch(x&&(v|=16),y.toLowerCase()){case"delo":v|=16;break;case"doub":_=2;break;case"trip":_=3;break;case"quad":_=4;break}h.add(g,b,_,v,A)}return i}e.getEntriesFromChemCompBond=r;class n{add(i,s,a,l,c,u=!0){let d=this.map.get(i);if(d!==void 0)d.get(s)===void 0&&d.set(s,{order:a,flags:l,key:c});else{let m=new Map;m.set(s,{order:a,flags:l,key:c}),this.map.set(i,m)}u&&this.add(s,i,a,l,c,!1)}constructor(i){this.id=i,this.map=new Map}}e.Entry=n})(xg||(xg={}));var oc;(function(e){e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance(i){let s=e.Provider.get(i.firstModel);if(!s||s.entries.length===0)return fo.Category.Empty;let a=i.structures[0],l=[];for(let c of s.entries)r(a,c.partnerA.atomIndex)&&r(a,c.partnerB.atomIndex)&&(l[l.length]=c.rowIndex);return fo.Category.ofTable(s.data,l)}}]}},e.Provider=ea.create(e.Descriptor);function t(i){let s=e.Provider.get(i);return!!s&&s.data.id.rowCount/i.atomicConformation.atomId.rowCount>.95}e.isExhaustive=t;function r({units:i},s){for(let a=0,l=i.length;a<l;a++)if(Qe.indexOf(i[a].elements,s)>=0)return!0;return!1}function n(i){let s=new Map;for(let a of i){let{partnerA:{atomIndex:l},partnerB:{atomIndex:c}}=a;s.has(l)?s.get(l).push(a):s.set(l,[a]),s.has(c)?s.get(c).push(a):s.set(c,[a])}return s}e.getAtomIndexFromEntries=n;function o(i,s){let{conn_type_id:a,pdbx_dist_value:l,pdbx_value_order:c}=i,u={label_asym_id:i.ptnr1_label_asym_id,label_seq_id:i.ptnr1_label_seq_id,auth_seq_id:i.ptnr1_auth_seq_id,label_atom_id:i.ptnr1_label_atom_id,label_alt_id:i.pdbx_ptnr1_label_alt_id,ins_code:i.pdbx_ptnr1_PDB_ins_code,symmetry:i.ptnr1_symmetry},d={label_asym_id:i.ptnr2_label_asym_id,label_seq_id:i.ptnr2_label_seq_id,auth_seq_id:i.ptnr2_auth_seq_id,label_atom_id:i.ptnr2_label_atom_id,label_alt_id:i.pdbx_ptnr2_label_alt_id,ins_code:i.pdbx_ptnr2_PDB_ins_code,symmetry:i.ptnr2_symmetry},m=Array.from(s.entities.data.id.toArray()),p=(f,C)=>{if(C.label_asym_id.valueKind(f)!==0)return;let g=C.label_asym_id.value(f),b=C.label_atom_id.value(f);if(!b)return;let y=C.auth_seq_id.valueKind(f)===ue.ValueKind.Present?C.auth_seq_id.value(f):C.label_seq_id.value(f),x=C.ins_code.value(f),A=C.label_alt_id.value(f);for(let v of m){let _=s.atomicHierarchy.index.findResidue(v,g,y,x);if(_<0)continue;let I=s.atomicHierarchy.index.findAtomOnResidue(_,b,A);if(!(I<0))return{residueIndex:_,atomIndex:I,symmetry:C.symmetry.value(f)}}},h=[];for(let f=0;f<i._rowCount;f++){let C=p(f,u),g=p(f,d);if(C===void 0||g===void 0)continue;let b=a.value(f),y=c.value(f)||"",x=0,A=1;switch(y){case"sing":A=1;break;case"doub":A=2;break;case"trip":A=3;break;case"quad":A=4;break;default:A=z3(i.ptnr1_label_comp_id.value(f),i.ptnr1_label_atom_id.value(f),i.ptnr2_label_comp_id.value(f),i.ptnr2_label_atom_id.value(f))}switch(b){case"covale":x=1;break;case"disulf":x=9;break;case"hydrog":x=4;break;case"metalc":x=2;break}h.push({rowIndex:f,flags:x,order:A,distance:l.value(f),partnerA:C,partnerB:g})}return h}e.getEntriesFromStructConn=o})(oc||(oc={}));var SLe=D.distance;function Qne(e,t,r,n,o,i,s){let a=new Fs.EdgeBuilder(i,e,t),l=new Uint16Array(a.slotCount),c=new Int8Array(a.slotCount),u=new Uint32Array(a.slotCount);for(let d=0,m=a.edgeCount;d<m;d++)a.addNextEdge(),a.assignProperty(l,n[d]),a.assignProperty(c,r[d]),a.assignProperty(u,o[d]);return a.createGraph({flags:l,order:c,key:u},s)}var Xne=D(),Yne=D();function ILe(e,t,r){return e.conformation.position(t,Xne),e.conformation.position(r,Yne),SLe(Xne,Yne)}var ALe=new Set;function wLe(e){let t=Zi.Provider.get(e.model),{elements:r}=e,{type_symbol:n}=e.model.atomicHierarchy.atoms,o=e.elements.length,{maxDistance:i}=t,{offset:s,b:a,edgeProps:{order:l,distance:c,flag:u,key:d,operatorA:m,operatorB:p}}=t.bonds,{atomSourceIndex:h}=e.model.atomicHierarchy,{invertedIndex:f}=Ut.getInvertedAtomSourceIndex(e.model),C=[],g=[],b=[],y=[],x=[],A=e.conformation.operator.key;for(let v=0;v<o;v++){let _=r[v],I=Uu(n.value(_)),T=Cm(I),E=h.value(_);for(let w=s[E],S=s[E+1];w<S;++w){let P=f[a[w]];if(_>=P)continue;let k=Qe.indexOf(e.elements,P);if(k<0)continue;let L=m[w],R=p[w];if(L>=0&&L!==A||R>=0&&R!==A)continue;let N=Uu(n.value(P)),F=c[w],H=ILe(e,_,P),V=!1;if(F>=0)V=oo(H,F,.3);else if(i>=0)V=H<i;else{let q=xC(I,N,jf(I),jf(N));V=H<q,T&&Cm(N)&&(V=!1)}V&&(C[C.length]=v,g[g.length]=k,y[y.length]=l[w],b[b.length]=u[w],x[x.length]=d[w])}}return Qne(C,g,y,b,x,o,{canRemap:!1,cacheable:t.cacheable})}function _Le(e,t){let{maxRadius:r}=t,{x:n,y:o,z:i}=e.model.atomicConformation,s=e.elements.length,{elements:a,residueIndex:l,chainIndex:c}=e,{type_symbol:u,label_atom_id:d,label_alt_id:m,label_comp_id:p}=e.model.atomicHierarchy.atoms,{label_seq_id:h}=e.model.atomicHierarchy.residues,{index:f}=e.model.atomicHierarchy,{byEntityKey:C}=e.model.sequence,g=e.lookup3d,b=oc.Provider.get(e.model),y=xg.Provider.get(e.model),x=oc.isExhaustive(e.model),A=[],v=[],_=[],I=[],T=[],E=-1,w,S=!0,P=!0,k=!0,L=ALe;for(let R=0;R<s;R++){let N=a[R],F=u.value(N);S&&F!=="H"&&F!=="O"&&(S=!1);let H=t.forceCompute?void 0:b&&b.byAtomIndex.get(N),V=!1;if(H)for(let ee of H){let{partnerA:oe,partnerB:te}=ee;if(oe.symmetry!==te.symmetry)continue;let X=oe.atomIndex===N?te:oe,W=Qe.indexOf(e.elements,X.atomIndex);W<0||a[W]<N||(A[A.length]=R,v[v.length]=W,_[_.length]=ee.flags,I[I.length]=ee.order,T[T.length]=ee.rowIndex,V||L.clear(),V=!0,L.add(W))}if(x)continue;let q=l[N],Q=h.value(q),O=p.value(N);if(!t.forceCompute&&q!==E)if(y&&y.entries.has(O)){let ee=C[f.getEntityFromChain(c[N])];ee&&ee.sequence.microHet.has(Q)?w=void 0:w=y.entries.get(O).map}else w=void 0;E=q;let B=Uu(F),j=d.value(N),U=w?w.get(j):void 0,{indices:z,count:$,squaredDistances:Z}=g.find(n[N],o[N],i[N],r),J=Cm(B),ie=jf(B),ne=m.value(N),le=Q0.has(B);for(let ee=0;ee<$;ee++){let oe=z[ee];if(V&&L.has(oe))continue;let te=a[oe];if(te<=N)continue;let X=m.value(te);if(ne&&X&&ne!==X)continue;let W=Uu(u.value(te)),K=Cm(W);if(J&&K)continue;let re=(le||Q0.has(W))&&!(J||K),se=l[te];if(q===se&&U){let ae=U.get(d.value(te));if(ae){A[A.length]=R,v[v.length]=oe,I[I.length]=ae.order;let ve=ae.flags;re&&(ve|1&&(ve^=1),ve|=2),_[_.length]=ve,T[T.length]=ae.key}continue}let me=Math.sqrt(Z[ee]);if(me===0)continue;let Y=xC(B,W,ie,jf(W));if(me<=Y){A[A.length]=R,v[v.length]=oe,I[I.length]=Hne(O,j,d.value(te)),_[_.length]=(re?2:1)|32,T[T.length]=-1;let ae=h.value(se);Q===ae&&(P=!1),Math.abs(Q-ae)>1&&(k=!1)}}}return Qne(A,v,I,_,T,s,{canRemap:S||P&&k})}function Jne(e,t){let r={...U3,...t};return r.noCompute||Ut.isCoarseGrained(e.model)&&!Zi.Provider.get(e.model)&&!oc.isExhaustive(e.model)?G3.Empty:!r.forceCompute&&Zi.Provider.get(e.model)?wLe(e):_Le(e,r)}var TLe=D.distance,ELe=D.set,PLe=D.squaredDistance,DLe=D.transformMat4,eoe=D(),toe=D();function roe(e,t,r,n){return e.conformation.position(t,eoe),r.conformation.position(n,toe),TLe(eoe,toe)}var kLe=de(),Mb=D();function MLe(e,t,r,n){let{maxRadius:o}=r,{elements:i,residueIndex:s}=e,{x:a,y:l,z:c}=e.model.atomicConformation,{elements:u,residueIndex:d}=t,m=e.elements.length,{type_symbol:p,label_alt_id:h,label_atom_id:f,label_comp_id:C}=e.model.atomicHierarchy.atoms,{type_symbol:g,label_alt_id:b,label_atom_id:y,label_comp_id:x}=t.model.atomicHierarchy.atoms,{auth_seq_id:A}=e.model.atomicHierarchy.residues,{auth_seq_id:v}=t.model.atomicHierarchy.residues,{occupancy:_}=e.model.atomicConformation,{occupancy:I}=t.model.atomicConformation,T=_.isDefined&&I.isDefined,E=e.model===t.model&&oc.Provider.get(e.model),w=!r.forceCompute&&e.model===t.model&&Zi.Provider.get(e.model),{atomSourceIndex:S}=e.model.atomicHierarchy,{invertedIndex:P}=w?Ut.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0},k=e.model===t.model&&oc.isExhaustive(e.model),L=de.mul(kLe,t.conformation.operator.inverse,e.conformation.operator.matrix),R=!de.isIdentity(L),{center:N,radius:F}=t.boundary.sphere,H=(F+o)*(F+o);n.startUnitPair(e.id,t.id);let V=e.conformation.operator.key,q=t.conformation.operator.key;for(let Q=0;Q<m;Q++){let O=i[Q];if(ELe(Mb,a[O],l[O],c[O]),R&&DLe(Mb,Mb,L),PLe(Mb,N)>H)continue;if(!r.forceCompute&&w){let{maxDistance:X}=w,{offset:W,b:K,edgeProps:{order:re,distance:se,flag:me,key:Y,operatorA:ae,operatorB:ve}}=w.bonds,ge=S.value(O),Se=Uu(p.value(O));for(let Ee=W[ge],Fe=W[ge+1];Ee<Fe;++Ee){let Ae=P[K[Ee]],we=Qe.indexOf(t.elements,Ae);if(we<0)continue;let _e=ae[Ee],Ke=ve[Ee];if(_e>=0&&Ke>=0&&(_e===Ke||_e!==V||Ke!==q))continue;let rt=Uu(p.value(Ae)),pt=se[Ee],Ne=roe(e,O,t,Ae),je=!1;if(pt>=0)je=oo(Ne,pt,.3);else if(X>=0)je=Ne<X;else{let Ye=xC(Se,rt,jf(Se),jf(rt));je=Ne<Ye,Cm(Se)&&Cm(rt)&&(je=!1)}je&&n.add(Q,we,{order:re[Ee],flag:me[Ee],key:Y[Ee]})}continue}let B=r.forceCompute?void 0:E&&E.byAtomIndex.get(O);if(B&&B.length){let X=!1;for(let W of B){let{partnerA:K,partnerB:re}=W,se=K.atomIndex===O?re:K,me=Qe.indexOf(t.elements,se.atomIndex);me<0||roe(e,O,t,se.atomIndex)>o||(n.add(Q,me,{order:W.order,flag:W.flags,key:W.rowIndex}),X=!0)}if(X)continue}if(k)continue;let j=_.value(O),{lookup3d:U}=t,{indices:z,count:$,squaredDistances:Z}=U.find(Mb[0],Mb[1],Mb[2],o);if($===0)continue;let J=Uu(p.value(O)),ie=Cm(J),ne=jf(J),le=h.value(O),ee=Q0.has(J),oe=f.value(O),te=C.value(s[O]);for(let X=0;X<$;X++){let W=z[X],K=u[W],re=b.value(K);if(le&&re&&le!==re||T&&I.value(K)<1&&j<1&&A.value(O)===v.value(K))continue;let se=Uu(g.value(K)),me=Cm(se);if(ie&&me)continue;let Y=(ee||Q0.has(se))&&!(ie||me),ae=Math.sqrt(Z[X]);if(ae===0)continue;let ve=xC(J,se,ne,jf(se));if(ae<=ve){let ge=y.value(K),Se=x.value(d[K]);n.add(Q,W,{order:z3(te,Se,oe,ge),flag:(Y?2:1)|32,key:-1})}}}n.finishUnitPair()}var RLe={...U3,ignoreWater:!0,ignoreIon:!0};function BLe(e,t){let r=new Ed.Builder,n=e.models.some(i=>Zi.Provider.get(i)),o=e.models.some(i=>oc.isExhaustive(i));return t.noCompute||e.isCoarseGrained&&!n&&!o?new bg(r.getMap()):(qe.eachUnitPair(e,(i,s)=>{MLe(i,s,t,r)},{maxRadius:t.maxRadius,validUnit:i=>t.validUnit(i),validUnitPair:(i,s)=>t.validUnitPair(e,i,s)}),new bg(r.getMap()))}function noe(e,t){let r={...RLe,...t};return BLe(e,{...r,validUnit:t&&t.validUnit||(n=>Le.isAtomic(n)),validUnitPair:t&&t.validUnitPair||((n,o,i)=>{if(!qe.validUnitPair(n,o,i))return!1;let a=o.model.atomicHierarchy.derived.residue.moleculeType,l=i.model.atomicHierarchy.derived.residue.moleculeType,c=(!Le.isAtomic(o)||a[o.residueIndex[o.elements[0]]]!==2)&&(!Le.isAtomic(i)||l[i.residueIndex[i.elements[0]]]!==2),u=!Le.isAtomic(o)||a[o.residueIndex[o.elements[0]]]!==3,d=!Le.isAtomic(i)||l[i.residueIndex[i.elements[0]]]!==3,m=u&&d;return(c||!r.ignoreWater)&&(m||!r.ignoreIon)?!0:LLe(o,i)})})}function LLe(e,t){if(e.model!==t.model||!Le.isAtomic(e)||!Le.isAtomic(t))return!1;let r=oc.Provider.get(e.model);if(!r)return!1;let n=e.elements.length<t.elements.length?e:t,o=e.elements.length>=t.elements.length?e:t,{elements:i}=n,{elements:s}=o,{indexOf:a}=Qe;for(let l=0,c=i.length;l<c;l++){let u=i[l],d=r.byAtomIndex.get(u);if(d?.length)for(let m of d){let p=m.partnerA.atomIndex===u?m.partnerB.atomIndex:m.partnerA.atomIndex;if(a(s,p)>=0)return!0}}return!1}var _t;(function(e){function t(C,g,b,y,x,A){return{kind:"bond-location",aStructure:C,aUnit:g,aIndex:b,bStructure:y,bUnit:x,bIndex:A}}e.Location=t;function r(C){return!!C&&C.kind==="bond-location"}e.isLocation=r;function n(C,g){return C.aStructure.label===g.aStructure.label&&C.bStructure.label===g.bStructure.label&&C.aIndex===g.aIndex&&C.bIndex===g.bIndex&&C.aUnit.id===g.aUnit.id&&C.bUnit.id===g.bUnit.id}e.areLocationsEqual=n;function o(C,g){return{kind:"bond-loci",structure:C,bonds:g}}e.Loci=o;function i(C){return!!C&&C.kind==="bond-loci"}e.isLoci=i;function s(C,g){if(C.structure!==g.structure||C.bonds.length!==g.bonds.length)return!1;for(let b=0,y=C.bonds.length;b<y;++b)if(!n(C.bonds[b],g.bonds[b]))return!1;return!0}e.areLociEqual=s;function a(C){return C.bonds.length===0}e.isLociEmpty=a;function l(C,g){if(g===C.structure)return C;let b=[];return C.bonds.forEach(y=>{let x=g.unitMap.get(y.aUnit.id);if(!x)return;let A=g.unitMap.get(y.bUnit.id);if(!A)return;let v=y.aUnit.elements[y.aIndex],_=Qe.indexOf(x.elements,v);if(_===-1)return;let I=y.bUnit.elements[y.bIndex],T=Qe.indexOf(A.elements,I);T!==-1&&b.push(t(C.structure,x,_,C.structure,A,T))}),o(g,b)}e.remapLoci=l;function c(C){let g=[],b=new Map;for(let y of C.bonds){let{aIndex:x,aUnit:A,bIndex:v,bUnit:_}=y;A===_?b.has(A.id)?b.get(A.id).push(x,v):b.set(A.id,[x,v]):(b.has(A.id)?b.get(A.id).push(x):b.set(A.id,[x]),b.has(_.id)?b.get(_.id).push(v):b.set(_.id,[v]))}return b.forEach((y,x)=>{g.push({unit:C.structure.unitMap.get(x),indices:Qe.deduplicate(Qe.ofUnsortedArray(y))})}),ce.Loci(C.structure,g)}e.toStructureElementLoci=c;function u(C){let{aUnit:g,aIndex:b}=C.bonds[0];return ce.Loci(C.structure,[{unit:g,indices:Ge.ofSingleton(b)}])}e.toFirstStructureElementLoci=u;function d(C,g){if(g.aUnit===g.bUnit){let b=g.aUnit.bonds,y=b.getEdgeIndex(g.aIndex,g.bIndex);return y<0?Br.create(0):Br.create(b.edgeProps.flags[y])}else{let b=C.interUnitBonds.getBondFromLocation(g);return b?Br.create(b.props.flag):Br.create(0)}}e.getType=d;function m(C,g){if(g.aUnit===g.bUnit){let b=g.aUnit.bonds,y=b.getEdgeIndex(g.aIndex,g.bIndex);return y<0?0:b.edgeProps.order[y]}else{let b=C.interUnitBonds.getBondFromLocation(g);return b?b.props.order:0}}e.getOrder=m;function p(C){let g=0;for(let b=0,y=C.units.length;b<y;++b){let x=C.units[b];Le.isAtomic(x)&&(g+=x.bonds.edgeCount)}return g}e.getIntraUnitBondCount=p;class h{move(){return this.advance(),this.current}setElement(g,b,y){this.structure=g,this.unit=b,this.index=y,this.interBondIndices=g.interUnitBonds.getEdgeIndices(y,b.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=b.bonds.offset[y+1],this.intraBondIndex=b.bonds.offset[y],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}advance(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else if(this.interBondIndex<this.interBondCount){let g=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(g.unitA!==this.unit.id?g.unitA:g.unitB),this.current.otherIndex=g.indexA!==this.index?g.indexA:g.indexB,this.current.type=g.props.flag,this.current.order=g.props.order,this.interBondIndex+=1}else{this.hasNext=!1;return}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}constructor(){this.current={},this.hasNext=!1}}e.ElementBondIterator=h;function f(C,g){return ec.fromPairProvider(C.bonds.length,(b,y,x)=>{let{aUnit:A,aIndex:v,bUnit:_,bIndex:I}=C.bonds[b];A.conformation.position(A.elements[v],y),_.conformation.position(_.elements[I],x)},g)}e.getBoundingSphere=f})(_t||(_t={}));function uoe(e){let t=FLe(e),r=NLe(e,t),n=Vt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);for(;n.hasNext;){let o=n.move();OLe(r,o.start,o.end)}return r.rings}function NLe(e,t){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(t),marked:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),depth:new Int32Array(t),left:new Int32Array(5),right:new Int32Array(5),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}function ooe(e){e.count=e.endVertex-e.startVertex;let{isRingAtom:t,pred:r,color:n,depth:o,marked:i}=e;for(let s=0;s<e.count;s++)t[s]=0,r[s]=-1,i[s]=-1,n[s]=0,o[s]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function ioe(e){let{depth:t}=e;for(let r=0;r<e.count;r++)t[r]=e.count+1}function FLe(e){let t=Vt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),r=0;for(;t.hasNext;){let n=t.move();r=Math.max(r,n.end-n.start)}return r}function soe(e,t){let r=e.bonds.offset,n=e.startVertex+t,o=r[n],s=r[n+1]-o;return!(s<=1||e.isRingAtom[t]&&s===2)}function OLe(e,t,r){if(e.startVertex=t,e.endVertex=r,e.endVertex-e.startVertex<3)return;e.currentRings=[];let{elements:n}=e.unit,o=[];for(let s=e.startVertex;s<e.endVertex;s++){let a=e.altLoc.value(n[s]);Ho(o,a)}om(o,"");let i=1;if(o.length===0){ooe(e);for(let s=0;s<e.count;s++)soe(e,s)&&(ioe(e),i=aoe(e,s,i))}else for(let s=0;s<o.length;s++){ooe(e),e.hasAltLoc=!0,e.currentAltLoc=o[s];for(let a=0;a<e.count;a++){if(!soe(e,a))continue;let l=e.altLoc.value(n[e.startVertex+a]);l&&l!==e.currentAltLoc||(ioe(e),i=aoe(e,a,i))}}for(let s=0,a=e.currentRings.length;s<a;s++)e.rings.push(e.currentRings[s])}function VLe(e,t,r,n){if(r<t)return!1;let{pred:o,color:i,left:s,right:a}=e,l=++e.currentColor,c=t;for(let g=0;g<5&&(i[c]=l,c=o[c],!(c<0));g++);let u=0,d=0,m=!1,p=0;c=r;for(let g=0;g<5;g++){if(i[c]===l){p=c,m=!0;break}if(a[d++]=c,c=o[c],c<0)break}if(!m)return!1;c=t;for(let g=0;g<5&&(s[u++]=c,!(p===c||(c=o[c],c<0)));g++);let h=u+d;if(h<3)return!1;let f=new Int32Array(h),C=0;for(let g=0;g<u;g++)f[C++]=e.startVertex+s[g],n[s[g]]=1;for(let g=d-1;g>=0;g--)f[C++]=e.startVertex+a[g],n[a[g]]=1;_a(f);for(let g=0,b=e.currentRings.length;g<b;g++){let y=e.currentRings[g];if(f.length===y.length){if(Qe.areEqual(f,y))return!1}else if(f.length>y.length&&Qe.isSubset(f,y))return!1}return e.currentRings.push(Qe.ofSortedArray(f)),!0}function aoe(e,t,r){let{bonds:n,startVertex:o,endVertex:i,isRingAtom:s,marked:a,queue:l,pred:c,depth:u}=e,{elements:d}=e.unit,{b:m,edgeProps:{flags:p},offset:h}=n;a[t]=r,u[t]=0,l[0]=t;let f=0,C=1;for(;f<C;){let g=l[f++],b=u[g],y=o+g,x=h[y],A=h[y+1];for(let v=x;v<A;v++){let _=m[v];if(_<o||_>=i||!Br.isCovalent(p[v]))continue;if(e.hasAltLoc){let E=e.altLoc.value(d[_]);if(E&&e.currentAltLoc!==E)continue}let I=_-o;if(a[I]===r){if(c[I]!==g&&c[g]!==I&&VLe(e,g,I,s))return r+1;continue}let T=Math.min(u[I],b+1);T>5||(u[I]=T,a[I]=r,l[C++]=I,c[I]=g)}}return r+1}function doe(e){let t=e.length,r=new Array(t);for(let s=0;s<t;s++)r[s]=e[t-s-1];let n=loe(e),o=loe(r),i=!1;for(let s=0;s<t;s++){let a=e[(s+n)%t],l=r[(s+o)%t];if(a!==l){i=a<l;break}}return i?coe(e,n):coe(r,o)}function loe(e){let t=e.length,r=new Int32Array(t*2);for(let s=0;s<r.length;s++)r[s]=-1;let n="",o="",i=0;for(let s=1;s<r.length;s++){let a=r[s-i-1];for(;a!==-1&&(n=e[s%t],o=e[(i+a+1)%t],n!==o);)n<o&&(i=s-a-1),a=r[a];a===-1?(n=e[s%t],o=e[(i+a+1)%t],n!==o?(n<o&&(i=s),r[s-i]=-1):r[s-i]=a+1):r[s-i]=a+1}return i}function coe(e,t){let r=e.length,n=[],o;for(o=0;o<r-1;o++)n.push(e[(o+t)%r]),n.push("-");return n.push(e[(o+t)%r]),n.join("")}function moe(e,t){let r=new Map,n=new Map;for(let l=0,c=e.length;l<c;l++){let u=e[l];for(let d=0,m=u.length;d<m;d++){let p=u[d];r.has(p)?r.get(p).push(l):r.set(p,[l])}}for(let l=0,c=t.length;l<c;l++){let u=t[l],d=e[u];for(let m=0,p=d.length;m<p;m++){let h=d[m];n.has(h)?n.get(h).push(u):n.set(h,[u])}}let o=new Fs.UniqueEdgeBuilder(e.length);for(let l=0,c=e.length;l<c;l++){let u=e[l];for(let d=0,m=u.length;d<m;d++){let p=u[d],h=r.get(p);if(h.length!==1)for(let f=0,C=h.length;f<C;f++){let g=h[f];l>=g||o.addEdge(l,g)}}}let i=Fs.connectedComponents(o.getGraph()),s=i.componentIndex,a=[];for(let l=0;l<i.componentCount;l++)a[l]=[];for(let l=0,c=e.length;l<c;l++)a[s[l]].push(l);return{elementRingIndices:r,elementAromaticRingIndices:n,ringComponentIndex:s,ringComponents:a}}function GLe(e,t){let r=e.coarseElements.entityKey[t],n=e.model.sequence.byEntityKey[r].sequence,o=e.coarseElements.seq_id_begin.value(t);return n.compId.value(o-1)}function CC(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:let r=GLe(e,t),n=e.model.properties.chemicalComponentMap.get(r);if(n)return _c(n.type,r)}return 0}var ULe=new Set;function $f(e,t){let r=mne[e];if(r!==void 0){let n=r[t];if(n!==void 0)return n}return ULe}var poe=D.zero();function Y3(e,t){let r=e.conformation,n=new Float32Array(t.length*3),{elements:o}=e;for(let i=0,s=t.length;i<s;++i)r.position(o[t[i]],poe),D.toArray(poe,n,i*3);return n}var J0=class{get index(){return this._index?this._index:(this._index=moe(this.all,this.aromaticRings),this._index)}get byFingerprint(){return this._byFingerprint?this._byFingerprint:(this._byFingerprint=zLe(this.unit,this.all),this._byFingerprint)}get elementRingIndices(){return this.index.elementRingIndices}get elementAromaticRingIndices(){return this.index.elementAromaticRingIndices}get ringComponentIndex(){return this.index.ringComponentIndex}get ringComponents(){return this.index.ringComponents}get aromaticRings(){return this._aromaticRings?this._aromaticRings:(this._aromaticRings=$Le(this.unit,this.all),this._aromaticRings)}constructor(t,r){this.unit=r,this.all=t}},zu;(function(e){function t(a,l){let{elements:c}=a,{type_symbol:u}=a.model.atomicHierarchy.atoms,d=[];for(let m=0,p=l.length;m<p;m++)d[d.length]=u.value(c[l[m]]);return r(d)}e.fingerprint=t;function r(a){return doe(a)}e.elementFingerprint=r;let n=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]),o=.05;function i(a,l){let{elements:c,bonds:{b:u,offset:d,edgeProps:{flags:m}}}=a,{type_symbol:p,label_comp_id:h}=a.model.atomicHierarchy.atoms;if(h.value(a.elements[l[0]])==="PRO")return!1;let f=0,C=!1;for(let b=0,y=l.length;b<y;++b){let x=l[b];!C&&n.has(p.value(c[x]))&&(C=!0);for(let A=d[x],v=d[x+1];A<v;++A)Br.is(16,m[A])&&Qe.has(l,u[A])&&(f+=1)}if(f===2*l.length)return!0;if(!C||l.length<5||f>0)return!1;let g=gl.calculateMomentsAxes(Y3(a,l));return D.magnitude(g.dirC)<o}e.isAromatic=i;function s(a,l){let{label_alt_id:c}=a.model.atomicHierarchy.atoms,{elements:u}=a;for(let d=0,m=l.length;d<m;++d){let p=u[l[d]],h=c.value(p);if(h)return h}return""}e.getAltId=s})(zu||(zu={}));(function(e){function t(n){let o=uoe(n);return new e(o,n)}e.create=t;function r(n,o){let i=new Map;for(let s=0,a=o.length;s<a;s++){let l=o[s];jLe(n,l,i)}return i}e.byFingerprintAndResidue=r})(J0||(J0={}));function zLe(e,t){let r=new Map,n=0;for(let o=0,i=t.length;o<i;o++){let s=t[o],a=zu.fingerprint(e,s);r.has(a)?r.get(a).push(n):r.set(a,[n]),n++}return r}function HLe(e,t){let{elements:r}=e,n=e.model.atomicHierarchy.residueAtomSegments.index,o=n[r[t[0]]];for(let i=1,s=t.length;i<s;i++)if(o!==n[r[t[i]]])return-1;return o}function jLe(e,t,r){let n=e.byFingerprint.get(t);if(n)for(let o=0,i=n.length;o<i;o++){let s=n[o],a=HLe(e.unit,e.all[s]);a>=0&&(r.has(a)?r.get(a).push(s):r.set(a,[s]))}}function $Le(e,t){let r=[];for(let n=0,o=t.length;n<o;++n)zu.isAromatic(e,t[n])&&r.push(n);return r}var Sn;(function(e){function t(x){return Qe.ofSortedArray(x)}e.ofSortedRanges=t;function r(x){return x[0]}e.start=r;function n(x){return x[x.length-1]+1}e.end=n;function o(x){return x[0]}e.min=o;function i(x){return x[x.length-1]}e.max=i;function s(x){let A=0;for(let v=0,_=x.length;v<_;v+=2)A+=x[v+1]-x[v]+1;return A}e.size=s;function a(x){return x.length/2}e.count=a;function l(x,A){return x[A*2]}e.startAt=l;function c(x,A){return x[A*2+1]+1}e.endAt=c;function u(x,A){return x[A*2]}e.minAt=u;function d(x,A){return x[A*2+1]}e.maxAt=d;function m(x,A){if(x.length!==A.length)return!1;for(let v=0,_=x.length;v<_;++v)if(x[v]!==A[v])return!1;return!0}e.areEqual=m;function p(x,A){let v=0;for(let _=0,I=x.length;_<I;_+=2)for(let T=x[_],E=x[_+1];T<=E;++T)A(T,v),++v}e.forEach=p;function h(x,A){return C(x,A)!==-1}e.has=h;function f(x,A,v){return g(x,A,v)!==-1}e.hasFrom=f;function C(x,A){return g(x,A,0)}e.firstIntersectionIndex=C;function g(x,A,v){if(u(x,v)>Ge.max(A)||i(x)<Ge.min(A))return-1;for(let _=v,I=a(x);_<I;++_){let T=Be.ofRange(u(x,_),d(x,_));if(Ge.areIntersecting(T,A))return _}return-1}e.firstIntersectionIndexFrom=g;function b(x,A){return new y(x,A)}e.transientSegments=b;class y{updateValue(){this.value.index=this.curIndex,this.value.start=Ge.findPredecessorIndex(this.set,l(this.ranges,this.curIndex)),this.value.end=Ge.findPredecessorIndex(this.set,c(this.ranges,this.curIndex))}move(){return this.hasNext&&(this.updateValue(),this.curIndex=g(this.ranges,this.set,this.curIndex+1),this.hasNext=this.curIndex!==-1),this.value}constructor(A,v){this.ranges=A,this.set=v,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=C(A,v),this.hasNext=this.curIndex!==-1}}e.Iterator=y})(Sn||(Sn={}));function foe(e){let t=[],{elements:r,model:n}=e,{residueAtomSegments:o}=e.model.atomicHierarchy,{traceElementIndex:i}=n.atomicHierarchy.derived.residue,s=Sn.transientSegments(e.model.atomicRanges.polymerRanges,r),a=Vt.transientSegments(o,r);for(;s.hasNext;){let l=s.move();for(a.setSegment(l);a.hasNext;){let c=a.move(),{start:u,end:d,index:m}=c;if(Ge.areIntersecting(Be.ofRange(r[u],r[d-1]),r)){let p=i[m];t.push(p===-1?o.offsets[m]:p)}}}return Qe.ofSortedArray(t)}function hoe(e){let t=[],{elements:r,model:n}=e,{spheres:o,gaussians:i}=n.coarseHierarchy,s=Le.isSpheres(e)?o.polymerRanges:i.polymerRanges,a=Sn.transientSegments(s,r);for(;a.hasNext;){let{start:l,end:c}=a.move();for(let u=l;u<c;++u)t.push(r[u])}return Qe.ofSortedArray(t)}function goe(e){let t=[],{elements:r,model:n,residueIndex:o}=e,{residueAtomSegments:i}=e.model.atomicHierarchy,{traceElementIndex:s}=n.atomicHierarchy.derived.residue,a=Sn.transientSegments(e.model.atomicRanges.gapRanges,e.elements);for(;a.hasNext;){let l=a.move(),c=o[r[l.start]],u=o[r[l.end-1]],d=s[c],m=s[u];t.push(d===-1?i.offsets[c]:d),t.push(m===-1?i.offsets[u]:m)}return Qe.ofSortedArray(t)}function yoe(e){let t=[],{elements:r,model:n}=e,{spheres:o,gaussians:i}=n.coarseHierarchy,s=Le.isSpheres(e)?o.gapRanges:i.gapRanges,a=Sn.transientSegments(s,r);for(;a.hasNext;){let{start:l,end:c}=a.move();t.push(r[l],r[c-1])}return Qe.ofSortedArray(t)}function voe(e){let t=[],{elements:r,model:n}=e,{chainAtomSegments:o,residueAtomSegments:i}=n.atomicHierarchy,{moleculeType:s,traceElementIndex:a}=n.atomicHierarchy.derived.residue,l=Vt.transientSegments(o,r),c=Vt.transientSegments(i,r);for(;l.hasNext;)for(c.setSegment(l.move());c.hasNext;){let{index:u}=c.move();if(Wi(s[u])){let d=a[u];t.push(d===-1?i.offsets[u]:d)}}return Qe.ofSortedArray(t)}function boe(e){let t=[],{elements:r,model:n}=e,{chainAtomSegments:o,residueAtomSegments:i}=n.atomicHierarchy,{moleculeType:s,traceElementIndex:a}=n.atomicHierarchy.derived.residue,l=Vt.transientSegments(o,r),c=Vt.transientSegments(i,r);for(;l.hasNext;)for(c.setSegment(l.move());c.hasNext;){let{index:u}=c.move();if(TV(s[u])){let d=a[u];t.push(d===-1?i.offsets[u]:d)}}return Qe.ofSortedArray(t)}var xoe=D();function WLe(e){let{elements:t,conformation:r}=e,n=new Float32Array(t.length*3);for(let o=0,i=t.length;o<i;o++)r.invariantPosition(t[o],xoe),D.toArray(xoe,n,o*3);return n}function NV(e){let t=WLe(e);return gl.ofPositions(t)}var Coe=D.set,qLe=new is("14"),ZLe=new is("98");function KLe(e){return e>1e4?qLe:ZLe}function J3(e){let t=xt.computeBounding(e);return{box:t,sphere:Pe.fromBox3D(Pe(),t)}}var Q3=D();function Ec(e){let{x:t,y:r,z:n,radius:o,indices:i}=e,s=Ge.size(i);if(s>25e4)return J3(e);let a=KLe(s);a.reset();for(let c=0;c<s;c++){let u=Ge.getAt(i,c);Coe(Q3,t[u],r[u],n[u]),a.includePositionRadius(Q3,o&&o[u]||0)}a.finishedIncludeStep();for(let c=0;c<s;c++){let u=Ge.getAt(i,c);Coe(Q3,t[u],r[u],n[u]),a.radiusPositionRadius(Q3,o&&o[u]||0)}let l=a.getSphere();if(!o&&Pe.hasExtrema(l)&&s<=l.extrema.length){let c=[];for(let u=0;u<s;u++){let d=Ge.getAt(i,u);c.push(D.create(t[d],r[d],n[d]))}Pe.setExtrema(l,c)}return{box:a.getBox(),sphere:l}}var eD=class e{constructor(){this.data=new Map}get(t){let r=Qe.hashCode(t);if(this.data.has(r)){for(let[n,o]of this.data.get(r))if(Qe.areEqual(t,n))return o}}set(t,r){let n=Qe.hashCode(t);if(this.data.has(n)){let o=this.data.get(n);for(let i of o)if(Qe.areEqual(t,i[0])){i[1]=r;return}o.push([t,r])}else this.data.set(n,[[t,r]])}static get(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new e),t._dynamicPropertyData.ElementSetIntraBondCache}};function Soe(e){return{delocalizedTriplets:XLe(e)}}function XLe(e){let t=e.bonds,{b:r,edgeProps:n,offset:o}=t,{order:i,flags:s}=n,{elementAromaticRingIndices:a}=e.rings,l=[],c=new Map,u=new Map,d=(m,p,h)=>{let f=l.length;l.push(Qe.ofUnsortedArray([m,p,h])),c.set(h0(m,p),h),u.has(m)?u.get(m).push(f):u.set(m,[f])};for(let m=0;m<e.elements.length;m++){if(a.has(m)||o[m+1]-o[m]+1<2)continue;let h=[];for(let f=o[m],C=o[m+1];f<C;f++){let g=s[f];Br.is(g,16)&&h.push(r[f])}if(h.length>=2){d(m,h[0],h[1]);for(let f=1,C=h.length;f<C;f++)d(m,h[f],h[0])}}return{getThirdElement:(m,p)=>c.get(h0(m,p)),getTripletIndices:m=>u.get(m),triplets:l}}var Le;(function(e){let t;(function(F){F[F.Atomic=0]="Atomic",F[F.Spheres=1]="Spheres",F[F.Gaussians=2]="Gaussians"})(t=e.Kinds||(e.Kinds={}));function r(F){return F.kind===0}e.isAtomic=r;function n(F){return F.kind===1||F.kind===2}e.isCoarse=n;function o(F){return F.kind===1}e.isSpheres=o;function i(F){return F.kind===2}e.isGaussians=i;function s(F,H,V,q,Q,O,B,j,U){switch(Q){case 0:return new g(F,H,V,q,O,j,eo.createMapping(B,O.atomicConformation),U??b());case 1:return I(F,H,V,q,O,1,j,eo.createMapping(B,O.coarseConformation.spheres,f(O)),U??A());case 2:return I(F,H,V,q,O,2,j,eo.createMapping(B,O.coarseConformation.gaussians,C(O)),U??A())}}e.create=s;function a(F){let H=Ja.Mutable();for(let V=0,q=F.length;V<q;V++)H.set(F[V].id,V);return H}function l(F){let H=[];for(let V=0,q=F.length;V<q;V++)H.push(F[V].id);return di(H)}function c(F){let H={};return{elements:F[0].elements,units:F,get unitIndexMap(){return H.unitIndexMap||(H.unitIndexMap=a(F)),H.unitIndexMap},hashCode:d(F[0]),transformHash:l(F)}}e.SymmetryGroup=c,function(F){function H(q,Q){return q.hashCode!==Q.hashCode?!1:Qe.areEqual(q.elements,Q.elements)}F.areInvariantElementsEqual=H;function V(q){let Q=Ja.Mutable();for(let O=0,B=q.length;O<B;++O){let j=q[O];for(let U=0,z=j.units.length;U<z;++U)Q.set(j.units[U].id,O)}return Q}F.getUnitSymmetryGroupsIndexMap=V}(c=e.SymmetryGroup||(e.SymmetryGroup={}));function u(F){return e.isAtomic(F)?F.model.atomicConformation.id:F.model.coarseConformation.id}e.conformationId=u;function d(F){return wu(F.invariantId,Qe.hashCode(F.elements))}e.hashUnit=d;let m;(function(F){F[F.None=0]="None",F[F.MultiChain=1]="MultiChain",F[F.Partitioned=2]="Partitioned",F[F.FastBoundary=4]="FastBoundary"})(m=e.Trait||(e.Trait={}));let p;(function(F){F.is=zi.has,F.create=zi.create})(p=e.Traits||(e.Traits={}));function h(){return{}}function f(F){let H=F.coarseConformation.spheres.radius;return V=>H[V]}function C(F){return H=>0}class g{getChild(H){return H.length===this.elements.length?this:new g(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,H,this.conformation,b())}applyOperator(H,V,q=!1){let Q=q?V:eo.compose(this.conformation.operator,V);return new g(H,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,eo.createMapping(Q,this.model.atomicConformation,this.conformation.r),this.props)}remapModel(H,V,q){var Q,O;q||(q={...this.props,bonds:V&&!(!((O=(Q=this.props.bonds)===null||Q===void 0?void 0:Q.props)===null||O===void 0)&&O.canRemap)?void 0:S(this,this.props.bonds,H,V)},e.isSameConformation(this,H)||(q.boundary=void 0,q.lookup3d=void 0,q.principalAxes=void 0));let B=this.conformation.operator,j=_o.Provider.get(H);if(B.spgrOp!==-1&&j&&j!==_o.Provider.get(this.model)){let[z,$,Z]=B.hkl,{toFractional:J}=j.spacegroup.cell,ie=D.transformMat4(D(),Ut.getCenter(H),J);B=ha.getSymmetryOperatorRef(j.spacegroup,B.spgrOp,z,$,Z,ie)}let U=this.model.atomicConformation!==H.atomicConformation||B!==this.conformation.operator?eo.createMapping(B,H.atomicConformation):this.conformation;return new g(this.id,this.invariantId,this.chainGroupId,this.traits,H,this.elements,U,q)}get boundary(){if(this.props.boundary)return this.props.boundary;let{x:H,y:V,z:q}=this.model.atomicConformation;return this.props.boundary=p.is(this.traits,m.FastBoundary)?J3({x:H,y:V,z:q,indices:this.elements}):Ec({x:H,y:V,z:q,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;let{x:H,y:V,z:q}=this.model.atomicConformation;return this.props.lookup3d=Ma({x:H,y:V,z:q,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=NV(this),this.props.principalAxes)}get bonds(){var H;if(this.props.bonds)return this.props.bonds;let V=eD.get(this.model),q=V.get(this.elements);return q||(q=Jne(this),!((H=q.props)===null||H===void 0)&&H.cacheable&&V.set(this.elements,q)),this.props.bonds=q,this.props.bonds}get rings(){return this.props.rings?this.props.rings:(this.props.rings=J0.create(this),this.props.rings)}get resonance(){return this.props.resonance?this.props.resonance:(this.props.resonance=Soe(this),this.props.resonance)}get polymerElements(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=foe(this),this.props.polymerElements)}get gapElements(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=goe(this),this.props.gapElements)}get nucleotideElements(){return this.props.nucleotideElements?this.props.nucleotideElements:(this.props.nucleotideElements=voe(this),this.props.nucleotideElements)}get proteinElements(){return this.props.proteinElements?this.props.proteinElements:(this.props.proteinElements=boe(this),this.props.proteinElements)}get residueCount(){if(this.props.residueCount!==void 0)return this.props.residueCount;let H=0,V=Vt.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);for(;V.hasNext;)V.move(),H+=1;return this.props.residueCount=H,this.props.residueCount}getResidueIndex(H){return this.residueIndex[this.elements[H]]}constructor(H,V,q,Q,O,B,j,U){this.kind=0,this.objectPrimitive="atomistic",this.id=H,this.invariantId=V,this.chainGroupId=q,this.traits=Q,this.model=O,this.elements=B,this.conformation=j,this.residueIndex=O.atomicHierarchy.residueAtomSegments.index,this.chainIndex=O.atomicHierarchy.chainAtomSegments.index,this.props=U}}e.Atomic=g;function b(){return h()}class y{getChild(H){return H.length===this.elements.length?this:I(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,H,this.conformation,A())}applyOperator(H,V,q=!1){let Q=q?V:eo.compose(this.conformation.operator,V);return I(H,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,eo.createMapping(Q,this.getCoarseConformation(),this.conformation.r),this.props)}remapModel(H,V,q){let Q=this.getCoarseConformation(),O=x(this.kind,H);q||(q={...this.props},e.isSameConformation(this,H)||(q.boundary=void 0,q.lookup3d=void 0,q.principalAxes=void 0));let B=Q!==O?eo.createMapping(this.conformation.operator,O,this.kind===1?f(H):C(H)):this.conformation;return new y(this.id,this.invariantId,this.chainGroupId,this.traits,H,this.kind,this.elements,B,q)}get boundary(){if(this.props.boundary)return this.props.boundary;let{x:H,y:V,z:q}=this.getCoarseConformation();return this.props.boundary=p.is(this.traits,m.FastBoundary)?J3({x:H,y:V,z:q,indices:this.elements}):Ec({x:H,y:V,z:q,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;let{x:H,y:V,z:q}=this.getCoarseConformation();return this.props.lookup3d=Ma({x:H,y:V,z:q,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes?this.props.principalAxes:(this.props.principalAxes=NV(this),this.props.principalAxes)}get polymerElements(){return this.props.polymerElements?this.props.polymerElements:(this.props.polymerElements=hoe(this),this.props.polymerElements)}get gapElements(){return this.props.gapElements?this.props.gapElements:(this.props.gapElements=yoe(this),this.props.gapElements)}getCoarseConformation(){return x(this.kind,this.model)}constructor(H,V,q,Q,O,B,j,U,z){this.kind=B,this.objectPrimitive=B===1?"sphere":"gaussian",this.id=H,this.invariantId=V,this.chainGroupId=q,this.traits=Q,this.model=O,this.elements=j,this.conformation=U,this.coarseElements=B===1?O.coarseHierarchy.spheres:O.coarseHierarchy.gaussians,this.coarseConformation=B===1?O.coarseConformation.spheres:O.coarseConformation.gaussians,this.props=z}}function x(F,H){return F===1?H.coarseConformation.spheres:H.coarseConformation.gaussians}function A(){return h()}class v extends y{}e.Spheres=v;class _ extends y{}e.Gaussians=_;function I(F,H,V,q,Q,O,B,j,U){return new y(F,H,V,q,Q,O,B,j,U)}function T(F,H){return F.chainGroupId===H.chainGroupId&&F.conformation.operator.name===H.conformation.operator.name}e.areSameChainOperatorGroup=T;function E(F,H){return de.areEqual(F.conformation.operator.matrix,H.conformation.operator.matrix,1e-6)}e.areOperatorsEqual=E;function w(F,H){return F===H?!0:Qe.areEqual(F.elements,H.elements)?P(F,H.model):!1}e.areConformationsEqual=w;function S(F,H,V,q){var Q;if(!H)return;if(F.model.atomicConformation.id===V.atomicConformation.id)return H;let O=Zi.Provider.get(F.model);if(O){let B=Zi.Provider.get(V);return!B||O===B?H:void 0}return!((Q=H.props)===null||Q===void 0)&&Q.canRemap||!q||P(F,V)?H:void 0}function P(F,H){let V=Ut.CoordinatesHistory.get(Ut.getRoot(H));if(V)return V.areEqual(F.elements,F.kind,H);let q=F.elements,{x:Q,y:O,z:B}=F.conformation.coordinates,{x:j,y:U,z}=k(F.kind,H);for(let $=0,Z=q.length;$<Z;$++){let J=q[$];if(Q[J]!==j[J]||O[J]!==U[J]||B[J]!==z[J])return!1}return!0}e.isSameConformation=P;function k(F,H){return F===0?H.atomicConformation:F===1?H.coarseConformation.spheres:H.coarseConformation.gaussians}e.getModelConformationOfKind=k;function L(F){return k(F.kind,F.model)}e.getConformation=L;function R(F,H){return F===0?H.atomicHierarchy:F===1?H.coarseHierarchy.spheres:H.coarseHierarchy.gaussians}e.getModelHierarchyOfKind=R;function N(F){return R(F.kind,F.model)}e.getHierarchy=N})(Le||(Le={}));var SC;(function(e){function t(o,i,s,a){o.indices[o.count]=s,o.units[o.count]=i,o.squaredDistances[o.count]=a,o.count++}e.add=t;function r(){return{count:0,indices:[],units:[],squaredDistances:[]}}e.create=r;function n(o,i){for(let s=0;s<i.count;++s)o.indices[s]=i.indices[s],o.units[s]=i.units[s],o.squaredDistances[s]=i.squaredDistances[s];return o.count=i.count,o}e.copy=n})(SC||(SC={}));function FV(){return{result:SC.create(),closeUnitsResult:Bu.create(),unitGroupResult:Bu.create()}}var tD=class{findUnitIndices(t,r,n,o){return this.unitLookup.find(t,r,n,o)}find(t,r,n,o,i){return this._find(t,r,n,o,i??this.findContext)}_find(t,r,n,o,i){Bu.reset(i.result);let{units:s}=this.structure,a=this.unitLookup.find(t,r,n,o,i.closeUnitsResult);if(a.count===0)return i.result;for(let l=0,c=a.count;l<c;l++){let u=s[a.indices[l]];D.set(this.pivot,t,r,n),u.conformation.operator.isIdentity||D.transformMat4(this.pivot,this.pivot,u.conformation.operator.inverse);let m=u.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o,i.unitGroupResult);for(let p=0,h=m.count;p<h;p++)SC.add(i.result,u,m.indices[p],m.squaredDistances[p])}return i.result}nearest(t,r,n,o=1,i){return this._nearest(t,r,n,o,i??this.findContext)}_nearest(t,r,n,o,i){let s=i.result,a=this.heap;Bu.reset(s),a.clear();let{units:l}=this.structure,c=0,u=this.unitLookup.nearest(t,r,n,l.length,p=>(c+=l[p].elements.length)>=o,i.closeUnitsResult);if(u.count===0)return s;let d=0,m=-Number.MAX_VALUE;for(let p=0,h=u.count;p<h;p++){let f=u.squaredDistances[p];if(d>=o&&m<f)break;D.set(this.pivot,t,r,n);let C=l[u.indices[p]];C.conformation.operator.isIdentity||D.transformMat4(this.pivot,this.pivot,C.conformation.operator.inverse);let b=C.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],o,void 0,i.unitGroupResult);if(b.count!==0){d+=b.count,m=Math.max(m,b.squaredDistances[b.count-1]);for(let y=0,x=b.count;y<x;y++)a.insert(b.squaredDistances[y],{index:b.indices[y],unit:C})}}if(o===1){let p=a.findMinimum();if(p){let{key:h}=p,{unit:f,index:C}=p.value;SC.add(s,f,C,h)}}else for(;!a.isEmpty()&&s.count<o;){let p=a.extractMinimum(),{key:h}=p,{unit:f,index:C}=p.value;SC.add(s,f,C,h)}return s}findIntoBuilder(t,r,n,o,i){let{units:s}=this.structure,a=this.unitLookup.find(t,r,n,o);if(a.count!==0)for(let l=0,c=a.count;l<c;l++){let u=s[a.indices[l]];D.set(this.pivot,t,r,n),u.conformation.operator.isIdentity||D.transformMat4(this.pivot,this.pivot,u.conformation.operator.inverse);let m=u.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o);if(m.count===0)continue;let p=u.elements;i.beginUnit(u.id);for(let h=0,f=m.count;h<f;h++)i.addElement(p[m.indices[h]]);i.commitUnit()}}findIntoBuilderIf(t,r,n,o,i,s){let{units:a}=this.structure,l=this.unitLookup.find(t,r,n,o);if(l.count===0)return;let c=ce.Location.create(this.structure);for(let u=0,d=l.count;u<d;u++){let m=a[l.indices[u]];D.set(this.pivot,t,r,n),m.conformation.operator.isIdentity||D.transformMat4(this.pivot,this.pivot,m.conformation.operator.inverse);let h=m.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],o);if(h.count===0)continue;let f=m.elements;c.unit=m,i.beginUnit(m.id);for(let C=0,g=h.count;C<g;C++)c.element=f[h.indices[C]],s(c)&&i.addElement(c.element);i.commitUnit()}}findIntoBuilderWithRadius(t,r,n,o,i,s,a,l){let{units:c}=this.structure,u=this.unitLookup.find(t,r,n,s);if(u.count===0)return;let d=ce.Location.create(this.structure),m=o+i+s;for(let p=0,h=u.count;p<h;p++){let f=c[u.indices[p]];D.set(this.pivot,t,r,n),f.conformation.operator.isIdentity||D.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);let g=f.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],m);if(g.count===0)continue;let b=f.elements;d.unit=f,l.beginUnit(f.id);for(let y=0,x=g.count;y<x;y++){d.element=b[g.indices[y]];let A=a(d);Math.sqrt(g.squaredDistances[y])-o-A>s||l.addElement(b[g.indices[y]])}l.commitUnit()}}check(t,r,n,o){let{units:i}=this.structure,s=this.unitLookup.find(t,r,n,o);if(s.count===0)return!1;for(let a=0,l=s.count;a<l;a++){let c=i[s.indices[a]];if(D.set(this.pivot,t,r,n),c.conformation.operator.isIdentity||D.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse),c.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],o))return!0}return!1}get boundary(){return this.structure.boundary}constructor(t){this.structure=t,this.pivot=D(),this.heap=new oC,this.findContext=FV();let{units:r,boundary:n}=t,o=r.length,i=new Float32Array(o),s=new Float32Array(o),a=new Float32Array(o),l=new Float32Array(o),c=D();for(let d=0;d<o;d++){let m=r[d],p=m.boundary.sphere;D.transformMat4(c,p.center,m.conformation.operator.matrix),i[d]=c[0],s[d]=c[1],a[d]=c[2],l[d]=p.radius}let u={x:i,y:s,z:a,radius:l,indices:Ge.ofBounds(0,o)};this.unitLookup=Ma(u,n)}};function Cg(e,t){if(t.length===0)return qe.Empty;if(t.length===1)return t[0];let r=new Map,n=new Set;for(let{units:i}of t)for(let s=0,a=i.length;s<a;s++){let l=i[s];if(r.has(l.id)){if(n.has(l.id))continue;let c=Qe.union(r.get(l.id),l.elements);r.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}else r.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&n.add(l.id)}let o=e.subsetBuilder(!0);return r.forEach(YLe,o),o.getStructure()}function YLe(e,t){this.setUnit(t,e)}function Ioe(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;let r=e.units,n=t.unitMap;for(let o=0,i=r.length;o<i;o++){let s=r[o];if(!n.has(s.id))return!1;let a=n.get(s.id);if(!Qe.areEqual(s.elements,a.elements))return!1}return!0}function IC(e,t){if(e===t)return!0;let r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);let o=r.units,i=n.unitMap;for(let s=0,a=o.length;s<a;s++){let l=o[s];if(!i.has(l.id))continue;let c=i.get(l.id);if(Qe.areIntersecting(l.elements,c.elements))return!0}return!1}function rD(e,t){if(e===t)return e;if(!IC(e,t))return qe.Empty;let r,n;e.units.length<t.units.length?(r=e,n=t):(r=t,n=e);let o=r.units,i=n.unitMap,s=[];for(let a=0,l=o.length;a<l;a++){let c=o[a];if(!i.has(c.id))continue;let u=i.get(c.id);if(Qe.areIntersecting(c.elements,u.elements)){let d=Qe.intersect(c.elements,u.elements);s[s.length]=c.getChild(d)}}return qe.create(s,{parent:e.parent||t.parent})}function AC(e,t){if(e===t)return qe.Empty;if(!IC(e,t))return e;let r=e.units,n=t.unitMap,o=[];for(let i=0,s=r.length;i<s;i++){let a=r[i];if(!n.has(a.id)){o[o.length]=a;continue}let l=n.get(a.id),c=Qe.subtract(a.elements,l.elements);c.length>0&&(o[o.length]=a.getChild(c))}return qe.create(o,{parent:e.parent||t.parent})}var wt;(function(e){function t(g,b){return{kind:"singletons",source:g,structure:b}}e.Singletons=t;function r(g,b){return{kind:"sequence",source:g,structures:b}}e.Sequence=r;function n(g){return t(g,qe.Empty)}e.Empty=n;function o(g){return g.kind==="singletons"}e.isSingleton=o;function i(g){return o(g)?g.structure.units.length===0:g.structures.length===0}e.isEmpty=i;function s(g){return o(g)?g.structure.elementCount:g.structures.length}e.structureCount=s;function a(g){return i(g)?qe.Empty:o(g)?g.structure:Cg(g.source,g.structures)}e.unionStructure=a;function l(g){let b=[],{unitMap:y}=g.source;for(let x of a(g).units)x===y.get(x.id)?b[b.length]={unit:x,indices:Ge.ofBounds(0,x.elements.length)}:b[b.length]={unit:x,indices:Ge.ofSortedArray(Qe.indicesOf(y.get(x.id).elements,x.elements))};return ce.Loci(g.source,b)}e.toLociWithCurrentUnits=l;function c(g){let b=[],{unitMap:y}=g.source;for(let x of a(g).units){let A=y.get(x.id);A===x?b[b.length]={unit:A,indices:Ge.ofBounds(0,A.elements.length)}:b[b.length]={unit:A,indices:Ge.ofSortedArray(Qe.indicesOf(A.elements,x.elements))}}return ce.Loci(g.source,b)}e.toLociWithSourceUnits=c;function u(g,b,y){return b.length===0?n(g):y?t(g,Cg(g,b)):r(g,b)}class d{add(b){let y=b.elementCount;y!==0&&(this.structures[this.structures.length]=b,y!==1&&(this.allSingletons=!1))}getSelection(){return u(this.source,this.structures,this.allSingletons)}constructor(b){this.source=b,this.structures=[],this.allSingletons=!0}}class m{add(b){let y=b.elementCount;y===0||!this.uniqueSets.add(b)||(this.structures[this.structures.length]=b,y!==1&&(this.allSingletons=!1))}getSelection(){return u(this.structure,this.structures,this.allSingletons)}constructor(b){this.structure=b,this.structures=[],this.allSingletons=!0,this.uniqueSets=rC(qe.hashCode,qe.areUnitIdsAndIndicesEqual)}}function p(g){return new d(g)}e.LinearBuilder=p;function h(g){return new m(g)}e.UniqueBuilder=h;function f(g,b){let y=0;if(e.isSingleton(g))for(let x of g.structure.units){let{elements:A}=x;for(let v=0,_=A.length;v<_;v++){let I=qe.create([x.getChild(Qe.ofSingleton(A[v]))],{parent:g.source});b(I,y++)}}else for(let x of g.structures)b(x,y++)}e.forEach=f;function C(g,b){return o(g)?t(b,g.structure):r(b,g.structures)}e.withInputStructure=C})(wt||(wt={}));var GV={};Ui(GV,{atomicHet:()=>eNe,atomicSequence:()=>QLe,bundleElementImpl:()=>OV,bundleGenerator:()=>VV,defaultBondTest:()=>nD,spheres:()=>tNe,water:()=>JLe});var V2;(function(e){e.Empty={hash:-1,elements:[]};function t(u,d){return n(wt.toLociWithSourceUnits(wt.Singletons(u,d)))}e.fromSubStructure=t;function r(u){return n(wt.toLociWithSourceUnits(u))}e.fromSelection=r;function n(u){let d=[];for(let h of u.elements){let{unit:f,indices:C}=h;if(Ge.size(C)===0)continue;let g=[],b=[];if(Ge.isInterval(C))Ge.size(C)===1?b.push(Be.min(C)):g.push(Be.min(C),Be.max(C));else{let y=0,x=C.length;for(;y<x;){let A=y;for(y++;y<x&&C[y-1]+1===C[y];)y++;let v=y;if(v-A>2)g.push(C[A],C[v-1]);else for(let _=A;_<v;_++)b[b.length]=C[_]}}d.push({unit:f,set:Qe.ofSortedArray(b),ranges:Sn.ofSortedRanges(g)})}let m=new Map;for(let h=0,f=d.length;h<f;++h){let C=d[h],g=wu(di(C.ranges),di(C.set));if(m.has(g)){let{groupedUnits:b}=m.get(g);b.has(C.unit.invariantId)?b.get(C.unit.invariantId).push(C.unit.id):b.set(C.unit.invariantId,[C.unit.id])}else{let b=new Map;b.set(C.unit.invariantId,[C.unit.id]),m.set(g,{groupedUnits:b,set:C.set,ranges:C.ranges})}}let p=[];return m.forEach(h=>{let f=[];h.groupedUnits.forEach(C=>f.push(Qe.ofUnsortedArray(C))),f.sort((C,g)=>C[0]-g[0]),p.push({groupedUnits:f,set:h.set,ranges:h.ranges})}),{hash:u.structure.hashCode,elements:p}}e.fromLoci=n;function o(u,d){let m=[];for(let p=0,h=u.length;p<h;++p){let f=u[p];d.unitMap.has(f)&&m.push(d.unitMap.get(f))}return m}function i(u,d){u.hash!==-1&&u.hash!==d.hashCode&&new Error("Bundle not compatible with given structure");let m=[];for(let p of u.elements)for(let h of p.groupedUnits){let f=o(h,d);if(f.length===0)continue;let C;if(p.ranges.length===0)C=p.set;else if(p.set.length===0)if(p.ranges.length===2)C=Be.ofRange(p.ranges[0],p.ranges[1]);else{let g=new Int32Array(Sn.size(p.ranges));Sn.forEach(p.ranges,(b,y)=>g[y]=b),C=Qe.ofSortedArray(g)}else{let g=Sn.size(p.ranges),b=new Int32Array(p.set.length+g);Sn.forEach(p.ranges,(y,x)=>b[x]=y),b.set(p.set,g),C=Qe.ofUnsortedArray(b)}for(let g of f)m.push({unit:g,indices:C})}return ey(d,m)}e.toLoci=i;function s(u,d){u.hash!==-1&&u.hash!==d.hashCode&&new Error("Bundle not compatible with given structure");let m=[];for(let p of u.elements)for(let h of p.groupedUnits){let f=o(h,d);if(f.length===0)continue;let C=f[0].elements,g=Sn.size(p.ranges),b=p.set.length,y=new Int32Array(b+g),x;if(g===0){for(let A=0,v=b;A<v;++A)y[A]=C[p.set[A]];x=Qe.ofSortedArray(y)}else if(b===0)Sn.forEach(p.ranges,(A,v)=>y[v]=C[A]),x=Qe.ofSortedArray(y);else if(Qe.min(p.set)>Sn.max(p.ranges)){Sn.forEach(p.ranges,(A,v)=>y[v]=C[A]);for(let A=0,v=b;A<v;++A)y[A+g]=C[p.set[A]];x=Qe.ofSortedArray(y)}else if(Sn.min(p.ranges)>Qe.max(p.set)){for(let A=0,v=b;A<v;++A)y[A]=C[p.set[A]];Sn.forEach(p.ranges,(A,v)=>y[v+b]=C[A]),x=Qe.ofSortedArray(y)}else{Sn.forEach(p.ranges,(A,v)=>y[v]=C[A]);for(let A=0,v=b;A<v;++A)y[A+g]=C[p.set[A]];x=Qe.ofUnsortedArray(y)}for(let A of f)m.push(A.getChild(x))}return qe.create(m,{parent:d})}e.toStructure=s;function a(u){return ye.internal.generator.bundleElement({groupedUnits:ye.core.type.list(u.groupedUnits.map(d=>ye.core.type.list(d))),ranges:ye.core.type.list(u.ranges),set:ye.core.type.list(u.set)})}function l(u){return ye.internal.generator.bundle({elements:ye.core.type.list(u.elements.map(a))})}e.toExpression=l;function c(u,d){if(u.elements.length!==d.elements.length)return!1;for(let m=0,p=u.elements.length;m<p;++m){let h=u.elements[m],f=d.elements[m];if(h.groupedUnits.length!==f.groupedUnits.length)return!1;for(let C=0,g=f.groupedUnits.length;C<g;++C)if(!Qe.areEqual(h.groupedUnits[C],f.groupedUnits[C]))return!1;if(!Qe.areEqual(h.set,f.set)||!Sn.areEqual(h.ranges,f.ranges))return!1}return!0}e.areEqual=c})(V2||(V2={}));function nD(e){return Br.isCovalent(e.atomicBond.type)}function QLe(){return function(t){let{inputStructure:r}=t,n=ce.Location.create(r),o=[];for(let i of r.units){if(i.kind!==0)continue;n.unit=i;let s=i.elements;if(n.element=s[0],nt.entity.type(n)!=="polymer")continue;let a=Vt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,s),l=0;for(;a.hasNext;)l++,a.move();l<8||o.push(i)}return wt.Singletons(r,qe.create(o,{parent:r}))}}function JLe(){return function(t){let{inputStructure:r}=t,n=ce.Location.create(r),o=[];for(let i of r.units){if(i.kind!==0)continue;n.unit=i;let s=i.elements;n.element=s[0],nt.entity.type(n)==="water"&&o.push(i)}return wt.Singletons(r,qe.create(o,{parent:r}))}}function eNe(){return function(t){let{inputStructure:r}=t,n=ce.Location.create(r),o=[];for(let i of r.units){if(i.kind!==0)continue;n.unit=i;let s=i.elements;if(n.element=s[0],nt.entity.type(n)!=="water"){if(nt.entity.type(n)==="polymer"){let a=Vt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,s),l=0;for(;a.hasNext;)l++,a.move();if(l>=8)continue}o.push(i)}}return wt.Singletons(r,qe.create(o,{parent:r}))}}function tNe(){return function(t){let{inputStructure:r}=t,n=[];for(let o of r.units)o.kind===1&&n.push(o);return wt.Singletons(r,qe.create(n,{parent:r}))}}function OV(e,t,r){return{groupedUnits:e,ranges:t,set:r}}function VV(e){return function(r){let n={hash:r.inputStructure.hashCode,elements:e};return wt.Sequence(r.inputStructure,[V2.toStructure(n,r.inputStructure)])}}var ls=class{pushCurrentElement(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=ce.Location.create(void 0),this.element}popCurrentElement(){this.element=this.currentElementStack.pop()}pushCurrentBond(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new oD,this.atomicBond}popCurrentBond(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0}pushCurrentStructure(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)}popCurrentStructure(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0}pushInputStructure(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t}popInputStructure(){if(this.inputStructureStack.length===0)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()}throwIfTimedOut(){if(this.timeoutMs!==0&&Zn()-this.timeCreated>this.timeoutMs)throw new Error(`The query took too long to execute (> ${this.timeoutMs/1e3}s).`)}tryGetCurrentSelection(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection}constructor(t,r){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=Zn(),this.element=ce.Location.create(void 0),this.currentStructure=void 0,this.atomicBond=new oD,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=r&&r.timeoutMs||0,this.currentSelection=r&&r.currentSelection}},oD=class{constructor(){this.a=ce.Location.create(void 0),this.aIndex=0,this.b=ce.Location.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.key=-1,this.testFn=nD}setStructure(t){this.a.structure=t,this.b.structure=t}setTestFn(t){this.testFn=t||nD}test(t,r){return this.testFn(t)?!0:r?(this.swap(),this.testFn(t)):!1}swap(){let t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;let r=this.a.unit;this.a.unit=this.b.unit,this.b.unit=r;let n=this.a.element;this.a.element=this.b.element,this.b.element=n}get length(){return ce.Location.distance(this.a,this.b)}};var G2;(function(e){function t(r,n,o){return r(new ls(n,o))}e.run=t})(G2||(G2={}));var HV={};Ui(HV,{all:()=>Aoe,atoms:()=>zV,bondedAtomicPairs:()=>uNe,chains:()=>nNe,none:()=>sD,querySelection:()=>cNe,residues:()=>rNe,rings:()=>lNe});var wC=class{add(t){t.elementCount&&(t.elementCount!==1&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))}getSelection(){return this.allSingletons?wt.Singletons(this.source,Cg(this.source,this.structures)):wt.Sequence(this.source,this.structures)}constructor(t){this.source=t,this.set=rC(qe.hashCode,qe.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}},iD=class{add(t,r,n){let o=this.builderMap.get(t);o||(o=this.source.subsetBuilder(!0),this.builders[this.builders.length]=o,this.builderMap.set(t,o)),o.addToUnit(r,n)}allSingletons(){for(let t=0,r=this.builders.length;t<r;t++)if(this.builders[t].elementCount>1)return!1;return!0}singletonSelection(){let t=this.source.subsetBuilder(!0),r=ce.Location.create(this.source);for(let n=0,o=this.builders.length;n<o;n++)this.builders[n].setSingletonLocation(r),t.addToUnit(r.unit.id,r.element);return wt.Singletons(this.source,t.getStructure())}fullSelection(){let t=new Array(this.builders.length);for(let r=0,n=this.builders.length;r<n;r++)t[r]=this.builders[r].getStructure();return wt.Sequence(this.source,t)}getSelection(){return this.builders.length===0?wt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()}constructor(t){this.source=t,this.builders=[],this.builderMap=new Map}};var sD=e=>wt.Sequence(e.inputStructure,[]),Aoe=e=>wt.Singletons(e.inputStructure,e.inputStructure);function rNe(e){return zV({...e,groupBy:t=>nt.residue.key(t.element)})}function nNe(e){return zV({...e,groupBy:t=>nt.chain.key(t.element)})}function ty(e){return!0}function oNe(e){return 0}function zV(e){if(!e||!e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return Aoe;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return iNe(e.atomTest);let t={unitTest:e.unitTest||ty,entityTest:e.entityTest||ty,chainTest:e.chainTest||ty,residueTest:e.residueTest||ty,atomTest:e.atomTest||ty,groupBy:e.groupBy||oNe};return e.groupBy?aNe(t):sNe(t)}function iNe(e){return function(r){let{inputStructure:n}=r,{units:o}=n,i=r.pushCurrentElement(),s=n.subsetBuilder(!0);i.structure=n;for(let a of o){i.unit=a;let l=a.elements;s.beginUnit(a.id);for(let c=0,u=l.length;c<u;c++)i.element=l[c],e(r)&&s.addElement(i.element);s.commitUnit(),r.throwIfTimedOut()}return r.popCurrentElement(),wt.Singletons(n,s.getStructure())}}function sNe({unitTest:e,entityTest:t,chainTest:r,residueTest:n,atomTest:o}){return function(s){let{inputStructure:a}=s,{units:l}=a,c=s.pushCurrentElement(),u=a.subsetBuilder(!0),d=n===ty&&o===ty,m=o===ty;c.structure=a;for(let p of l){if(c.unit=p,!e(s))continue;let{elements:h,model:f}=p;if(u.beginUnit(p.id),p.kind===0){let C=Vt.transientSegments(p.model.atomicHierarchy.chainAtomSegments,h),g=Vt.transientSegments(p.model.atomicHierarchy.residueAtomSegments,h);for(;C.hasNext;){let b=C.move();if(c.element=h[b.start],!(!t(s)||!r(s))){if(d){u.addElementRange(h,b.start,b.end);continue}for(g.setSegment(b);g.hasNext;){let y=g.move();if(c.element=h[y.start],!!n(s)){if(m){u.addElementRange(h,y.start,y.end);continue}for(let x=y.start,A=y.end;x<A;x++)c.element=h[x],o(s)&&u.addElement(c.element)}}}}}else{let{chainElementSegments:C}=f.coarseHierarchy.spheres,g=Vt.transientSegments(C,h);for(;g.hasNext;){let b=g.move();if(c.element=h[b.start],!(!t(s)||!r(s))){if(d){u.addElementRange(h,b.start,b.end);continue}for(let y=b.start,x=b.end;y<x;y++)c.element=h[y],n(s)&&u.addElement(c.element)}}}u.commitUnit(),s.throwIfTimedOut()}return s.popCurrentElement(),wt.Singletons(a,u.getStructure())}}function aNe({unitTest:e,entityTest:t,chainTest:r,residueTest:n,atomTest:o,groupBy:i}){return function(a){let{inputStructure:l}=a,{units:c}=l,u=a.pushCurrentElement(),d=new iD(l);u.structure=l;for(let m of c){if(u.unit=m,!e(a))continue;let{elements:p,model:h}=m;if(m.kind===0){let f=Vt.transientSegments(h.atomicHierarchy.chainAtomSegments,p),C=Vt.transientSegments(h.atomicHierarchy.residueAtomSegments,p);for(;f.hasNext;){let g=f.move();if(u.element=p[g.start],!(!t(a)||!r(a)))for(C.setSegment(g);C.hasNext;){let b=C.move();if(u.element=p[b.start],!!n(a))for(let y=b.start,x=b.end;y<x;y++)u.element=p[y],o(a)&&d.add(i(a),m.id,u.element)}}}else{let{chainElementSegments:f}=h.coarseHierarchy.spheres,C=Vt.transientSegments(f,p);for(;C.hasNext;){let g=C.move();if(u.element=p[g.start],!(!t(a)||!r(a)))for(let b=g.start,y=g.end;b<y;b++)u.element=p[b],n(a)&&d.add(i(a),m.id,u.element)}}a.throwIfTimedOut()}return a.popCurrentElement(),d.getSelection()}}function UV(e,t,r){let n=new Int32Array(t.length);for(let o=0,i=t.length;o<i;o++)n[o]=e.elements[t[o]];return qe.create([e.getChild(Qe.ofSortedArray(n))],{parent:r})}function lNe(e,t){return function(n){let{units:o}=n.inputStructure,i=wt.LinearBuilder(n.inputStructure);if(!e||e.length===0){for(let s of o)if(Le.isAtomic(s))if(t)for(let a of s.rings.aromaticRings)i.add(UV(s,s.rings.all[a],n.inputStructure));else for(let a of s.rings.all)i.add(UV(s,a,n.inputStructure))}else{let s=vn.create();for(let a=0;a<e.length;a++)vn.add(s,e[a],e[a]);for(let a of o){if(!Le.isAtomic(a))continue;let l=a.rings;for(let c of s.array)if(l.byFingerprint.has(c))for(let u of l.byFingerprint.get(c))t&&!l.aromaticRings.includes(u)||i.add(UV(a,l.all[u],n.inputStructure))}}return i.getSelection()}}function cNe(e,t,r=!1){return function(o){let i=e(o);if(wt.structureCount(i)===0)return i;let s=r?AC(o.inputStructure,wt.unionStructure(i)):wt.unionStructure(i);if(s.elementCount===0)return wt.Empty(o.inputStructure);o.throwIfTimedOut(),o.pushInputStructure(s);let a=t(o);return o.popInputStructure(),wt.withInputStructure(a,o.inputStructure)}}function uNe(e){return function(r){let n=r.inputStructure,o=n.interUnitBonds,i=wt.UniqueBuilder(r.inputStructure);r.pushCurrentBond();let s=r.atomicBond;s.setTestFn(e),s.setStructure(n);for(let a of n.units){if(a.kind!==0)continue;let{offset:l,b:c,edgeProps:{flags:u,order:d,key:m}}=a.bonds;s.a.unit=a,s.b.unit=a;for(let p=0,h=a.elements.length;p<h;p++){s.aIndex=p,s.a.element=a.elements[p];for(let f=l[p],C=l[p+1];f<C;f++)if(s.bIndex=c[f],s.b.element=a.elements[c[f]],s.type=u[f],s.order=d[f],s.key=m[f],s.test(r,!1)){let g=n.subsetBuilder(!1);g.beginUnit(a.id),g.addElement(s.a.element),g.addElement(s.b.element),g.commitUnit(),i.add(g.getStructure())}}}for(let a of o.edges)if(s.a.unit=n.unitMap.get(a.unitA),s.a.element=s.a.unit.elements[a.indexA],s.aIndex=a.indexA,s.b.unit=n.unitMap.get(a.unitB),s.b.element=s.b.unit.elements[a.indexB],s.bIndex=a.indexB,s.order=a.props.order,s.type=a.props.flag,s.key=a.props.key,s.test(r,!1)){let l=n.subsetBuilder(!1);l.addToUnit(s.a.unit.id,s.a.element),l.addToUnit(s.b.unit.id,s.b.element),i.add(l.getStructure())}return r.popCurrentBond(),i.getSelection()}}var qV={};Ui(qV,{exceptBy:()=>XNe,expandProperty:()=>QNe,includeConnected:()=>JNe,includeSurroundings:()=>qNe,intersectBy:()=>KNe,querySelection:()=>ZNe,surroundingLigands:()=>tFe,union:()=>YNe,wholeResidues:()=>jNe});var Rb=class{addToUnit(t,r){let n=this.unitMap.get(t);if(n)vn.add(n,r,r)&&this.elementCount++;else{let o=vn.create();vn.add(o,r,r),this.unitMap.set(t,o),this.ids[this.ids.length]=t,this.elementCount++}}has(t,r){let n=this.unitMap.get(t);return n?vn.has(n,r):!1}beginUnit(t){this.parentId=t,this.unitMap.has(t)?this.currentUnit=this.unitMap.get(t):this.currentUnit=this.currentUnit.array.length>0?vn.create():this.currentUnit}addElement(t){vn.add(this.currentUnit,t,t)&&this.elementCount++}commitUnit(){this.currentUnit.array.length===0||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}getStructure(){if(this.isEmpty)return qe.Empty;let t=[];_a(this.ids);let r=ou.UnitEquivalenceBuilder();for(let n=0,o=this.ids.length;n<o;n++){let i=this.ids[n],s=this.parent.unitMap.get(i),a=this.unitMap.get(i).array,l=a.length;if(a.length===s.elements.length){t[t.length]=s,r.add(s.id,s);continue}l>1&&_a(a);let c=s.getChild(Qe.ofSortedArray(a)),u=r.add(c.id,c);c!==u&&(c=u.applyOperator(c.id,c.conformation.operator,!0)),t[t.length]=c}return qe.create(t,{parent:this.parent})}get isEmpty(){return this.elementCount===0}constructor(t){this.parent=t,this.ids=[],this.unitMap=Ja.Mutable(),this.parentId=-1,this.currentUnit=vn.create(),this.elementCount=0}};var woe={type_symbol:ue.Schema.Aliased(Wr.atom_site.type_symbol),label_atom_id:Wr.atom_site.label_atom_id,auth_atom_id:Wr.atom_site.auth_atom_id,label_alt_id:Wr.atom_site.label_alt_id,label_comp_id:Wr.atom_site.label_comp_id,auth_comp_id:Wr.atom_site.auth_comp_id,pdbx_formal_charge:Wr.atom_site.pdbx_formal_charge},_oe={group_PDB:Wr.atom_site.group_PDB,label_seq_id:Wr.atom_site.label_seq_id,auth_seq_id:Wr.atom_site.auth_seq_id,pdbx_PDB_ins_code:Wr.atom_site.pdbx_PDB_ins_code},Toe={label_asym_id:Wr.atom_site.label_asym_id,auth_asym_id:Wr.atom_site.auth_asym_id,label_entity_id:Wr.atom_site.label_entity_id},aD;(function(e){function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}e.EmptyResidueKey=t})(aD||(aD={}));var Wf;(function(e){function t(o,i){return o.residueAtomSegments.index[o.chainAtomSegments.offsets[i]]}e.chainStartResidueIndex=t;function r(o,i){return o.residueAtomSegments.index[o.chainAtomSegments.offsets[i+1]-1]+1}e.chainEndResidueIndexExcl=r;function n(o,i){return r(o,i)-t(o,i)}e.chainResidueCount=n})(Wf||(Wf={}));var U2={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},dNe={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},mNe={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},pNe=1.7,fNe=10.81,hNe=0;function qf(e){let t=U2[e];return t===void 0?pNe:dNe[t]}function Eoe(e){let t=U2[e];return t===void 0?fNe:mNe[t]}function ry(e){let t=U2[e];return t===void 0?hNe:t}function lD(e,t,r,n){return{type:e,key:t,elements:r,getIndex:n}}function Poe(e){let{unit:t,flags:r,proteinInfo:n}=e,o=t.conformation,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue,{residueIndices:s,nIndices:a}=n,l=s.length,c=(g,b)=>g===-1?D.setNaN(b):o.position(g,b),u=D(),d=D(),m=D(),p=D(),h=D(),f=D(),C=D();e:for(let g=2;g<l-2;g++){for(let T=0;T<4;T++){let E=g+T-2;if(c(i[E],p),c(a[E+1],h),D.squaredDistance(p,h)>6.25)continue e}let b=s[g-2],y=s[g],x=s[g+2],A=i[b],v=i[y],_=i[x];c(A,u),c(v,d),c(_,m),D.sub(f,u,d),D.sub(C,d,m);let I=ma(D.angle(f,C));I&&I>70&&(r[g]|=32)}}var gNe=9,cD=-27.888,yNe=-.5,Doe=-9.9;function vNe(e,t,r,n){let o=D.distance(e,n),i=D.distance(t,n),s=D.distance(t,r),a=D.distance(e,r),l=cD/o-cD/i,c=cD/s-cD/a,u=l+c;return u<Doe?Doe:u}function koe(e,t,r){let{residueIndices:n,cIndices:o,hIndices:i,nIndices:s,oIndices:a}=t,{index:l}=e.model.atomicHierarchy,c=e.conformation,{traceElementIndex:u}=e.model.atomicHierarchy.derived.residue,d=n.length,m=[],p=[],h=[],f=D(),C=D(),g=D(),b=D(),y=D(),x=D(),A=D();for(let v=0,_=n.length;v<_;++v){let I=v,T=n[v],E=a[I],w=o[I],S=u[T];if(E===-1||w===-1||l.findAtomOnResidue(T,"OXT")!==-1)continue;c.invariantPosition(E,f),c.invariantPosition(w,C),c.invariantPosition(S,g);let{indices:P,count:k}=r.find(g[0],g[1],g[2],gNe);for(let L=0;L<k;++L){let R=P[L];if(R===I||R-1===I||R+1===I)continue;let N=s[R];if(N===-1)continue;c.invariantPosition(N,b);let F=i[R];if(F===-1){if(R===0)continue;let V=R-1,q=a[V],Q=o[V];if(q===-1||Q===-1)continue;c.invariantPosition(q,A),c.invariantPosition(Q,x),D.sub(y,x,A);let O=D.distance(A,x);D.scaleAndAdd(y,b,y,1/O)}else c.invariantPosition(F,y);let H=vNe(f,C,b,y);H>yNe||(m[m.length]=I,p[p.length]=R,h[h.length]=H)}}return bNe(d,m,p,h)}function bNe(e,t,r,n){let o=new Fs.DirectedEdgeBuilder(e,t,r),i=new Float32Array(o.slotCount);for(let s=0,a=o.edgeCount;s<a;s++)o.addNextEdge(),o.assignProperty(i,n[s]);return o.createGraph({energies:n})}var Fr;(function(e){e.is=zi.has,e.create=zi.create})(Fr||(Fr={}));var Bb=class{constructor(t,r,n){this.partner1=Math.min(t,r),this.partner2=Math.max(t,r),this.type=n}};function Moe(e){let{proteinInfo:t,hbonds:r,flags:n}=e,o=[1024,2048,4096,128,256,512];for(let i=0;i<3;i++)for(let s=0,a=t.residueIndices.length-1;s<a;++s)if(r.getDirectedEdgeIndex(s,s+i+3)!==-1)if(n[s]|=o[i+3]|o[i],e.params.oldDefinition)for(let l=1;l<i+3;++l)n[s+l]|=o[i+3]|64;else for(let l=0;l<=i+3;++l)n[s+l]|=o[i+3]|64}function Roe(e){let{proteinInfo:t,flags:r}=e,n=t.residueIndices.length,o=[1024,2048,4096,128,256,512],i=[0,0,0,8,1,16],s=e.params.oldOrdering?[4,3,5]:[3,4,5];for(let a=0;a<s.length;a++){let l=s[a];for(let c=1,u=n-l;c<u;c++){let d=Fr.create(r[c]),m=Fr.create(r[c-1]),p=Fr.create(r[c+1]);if(e.params.oldOrdering){if(l===3&&(Fr.is(d,1)||Fr.is(p,1))||l===5&&(Fr.is(d,1)||Fr.is(d,8)||Fr.is(p,1)||Fr.is(p,8)))continue}else if(l===4&&(Fr.is(d,8)||Fr.is(p,8))||l===5&&(Fr.is(d,1)||Fr.is(d,8)||Fr.is(p,1)||Fr.is(p,8)))continue;if(Fr.is(d,o[l])&&Fr.is(d,o[l-3])&&Fr.is(m,o[l])&&Fr.is(m,o[l-3]))if(e.params.oldDefinition)for(let h=0;h<l;h++)r[c+h]|=i[l];else for(let h=-1;h<=l;h++)r[c+h]|=i[l]}}}function xNe(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(t.type===0){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function CNe(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&t.nextLadder===0?e.type===0?Boe(e,t):Boe(t,e):!1}function Boe(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function Loe(e){let{bridges:t,ladders:r}=e;for(let n=0;n<t.length;n++){let o=t[n],i=!1;for(let s=0;s<r.length;s++){let a=r[s];xNe(a,o)&&(i=!0,a.firstEnd++,o.type===0?a.secondEnd++:a.secondStart--)}i||(r[r.length]={previousLadder:0,nextLadder:0,firstStart:o.partner1,firstEnd:o.partner1,secondStart:o.partner2,secondEnd:o.partner2,type:o.type})}for(let n=0;n<r.length;n++){let o=r[n];for(let i=n;i<r.length;i++){let s=r[i];CNe(o,s)&&(o.nextLadder=i,s.previousLadder=n)}}}function Noe(e){let{proteinInfo:t,hbonds:r,flags:n,bridges:o}=e,{offset:i,b:s}=r,a,l;for(let c=0,u=t.residueIndices.length;c<u;++c)for(let d=i[c],m=i[c+1];d<m;d++){let p=s[d];c>p||(a=c+1,l=p,a!==l&&r.getDirectedEdgeIndex(l,a+1)!==-1&&(n[a]|=2,n[l]|=2,o[o.length]=new Bb(a,l,0)),a=c,l=p-1,a!==l&&r.getDirectedEdgeIndex(l-1,a)!==-1&&(n[a]|=2,n[l]|=2,o[o.length]=new Bb(l,a,0)),a=c,l=p,a!==l&&r.getDirectedEdgeIndex(l,a)!==-1&&(n[a]|=2,n[l]|=2,o[o.length]=new Bb(l,a,1)),a=c+1,l=p-1,a!==l&&r.getDirectedEdgeIndex(l-1,a+1)!==-1&&(n[a]|=2,n[l]|=2,o[o.length]=new Bb(l,a,1)))}o.sort((c,u)=>c.partner1>u.partner1?1:c.partner1<u.partner1?-1:0)}function Foe(e){return Fr.is(e,8)||Fr.is(e,1)||Fr.is(e,16)}function Ooe(e){let{ladders:t,flags:r}=e;for(let n=0;n<t.length;n++){let o=t[n];for(let s=o.firstStart;s<=o.firstEnd;s++){let a=o.firstStart-s,l=o.secondStart-a;o.firstStart!==o.firstEnd?(r[s]|=4,r[l]|=4):(!Foe(r[s])&&Fr.is(r[s],4)&&(r[s]|=2),!Foe(r[l])&&Fr.is(r[l],4)&&(r[l]|=2))}if(o.nextLadder===0)continue;let i=t[o.nextLadder];for(let s=o.firstStart;s<=i.firstEnd;s++)r[s]|=4;if(o.type===0)for(let s=o.secondStart;s<=i.secondEnd;s++)r[s]|=4;else for(let s=i.secondEnd;s<=o.secondStart;s++)r[s]|=4}}function Voe(e,t){let{cIndices:r,nIndices:n,residueIndices:o}=t,i=e.conformation,{index:s}=e.model.atomicHierarchy,{traceElementIndex:a}=e.model.atomicHierarchy.derived.residue,l=o.length,c=(A,v)=>A===-1?D.setNaN(v):i.position(A,v),u=D(),d=D(),m=D(),p=D(),h=D(),f=D(),C=D(),g=D(),b=D();if(l===0)return{phi:new Float32Array(0),psi:new Float32Array(0)};let y=new Float32Array(l-1),x=new Float32Array(l-1);c(-1,u),c(-1,d),c(-1,m),c(r[0],p),c(a[o[0]],h),c(n[0],f),c(r[1],C),c(a[o[1]],g),c(n[1],b);for(let A=0;A<l-1;++A)s.findAtomOnResidue(o[A],"OXT")===-1&&(y[A]=ma(D.dihedralAngle(u,f,h,p)),x[A]=ma(D.dihedralAngle(f,h,p,b)),u=p,d=h,m=f,p=C,h=g,f=b,c(r[A+1],C),c(a[o[A+1]],g),c(n[A+1],b));return{phi:y,psi:x}}function Goe(e,t){let{x:r,y:n,z:o}=e.model.atomicConformation,{traceElementIndex:i}=e.model.atomicHierarchy.derived.residue,s=new Uint32Array(t.length);for(let l=0,c=t.length;l<c;++l)s[l]=i[t[l]];let a={x:r,y:n,z:o,indices:Qe.ofSortedArray(s)};return Ma(a,Ec(a))}function Uoe(e){let{index:t}=e.model.atomicHierarchy,{proteinElements:r,residueIndex:n}=e,o=r.length,i=new Uint32Array(o),s=new Int32Array(o),a=new Int32Array(o),l=new Int32Array(o),c=new Int32Array(o);for(let u=0;u<o;++u){let d=n[r[u]];i[u]=d,s[u]=t.findAtomOnResidue(d,"C"),a[u]=t.findAtomOnResidue(d,"H"),l[u]=t.findAtomOnResidue(d,"O"),c[u]=t.findAtomOnResidue(d,"N")}return{residueIndices:Qe.ofSortedArray(i),cIndices:s,hIndices:a,oIndices:l,nIndices:c}}var zoe={oldDefinition:M.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:M.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};async function Hoe(e,t){let r=Uoe(e),{residueIndices:n}=r,o=Goe(e,n),i=koe(e,r,o),s=n.length,a=new Uint32Array(s),l=Voe(e,r),c=[],u=[],d=t.oldDefinition?ANe:_Ne,m=t.oldOrdering?wNe:TNe,p={params:t,getResidueFlag:d,getFlagName:m,unit:e,proteinInfo:r,flags:a,hbonds:i,torsionAngles:l,ladders:c,bridges:u};Moe(p),Roe(p),Poe(p),Noe(p),Loe(p),Ooe(p);let h=ENe(a,d),f=new Uint32Array(s),C=[],g=[],b=y=>Qe.indexOf(n,y);for(let y=0,x=n.length;y<x;++y){let A=h[y];f[y]=A;let v=d(a[y]);(g.length===0||v!==g[g.length-1].flags)&&(g[g.length]=SNe(INe(A),a[y],d)),C[y]=g.length-1}return lD(f,C,g,b)}function SNe(e,t,r){return e==="helix"?{kind:"helix",flags:r(t)}:e==="sheet"?{kind:"sheet",flags:r(t)}:e==="turn"||e==="bend"?{kind:"turn",flags:r(t)}:{kind:"none"}}function INe(e){return e===bn.SecondaryStructureDssp.H||e===bn.SecondaryStructureDssp.G||e===bn.SecondaryStructureDssp.I?"helix":e===bn.SecondaryStructureDssp.B||e===bn.SecondaryStructureDssp.E?"sheet":e===bn.SecondaryStructureDssp.T?"turn":e===bn.SecondaryStructureDssp.S?"bend":"none"}function ANe(e){return Fr.is(e,1)?bn.SecondaryStructureDssp.H:Fr.is(e,4)?bn.SecondaryStructureDssp.E:Fr.is(e,2)?bn.SecondaryStructureDssp.B:Fr.is(e,8)?bn.SecondaryStructureDssp.G:Fr.is(e,16)?bn.SecondaryStructureDssp.I:Fr.is(e,64)?bn.SecondaryStructureDssp.T:Fr.is(e,32)?bn.SecondaryStructureDssp.S:0}function wNe(e){return Fr.is(e,1)?"H":Fr.is(e,4)?"E":Fr.is(e,2)?"B":Fr.is(e,8)?"G":Fr.is(e,16)?"I":Fr.is(e,64)?"T":Fr.is(e,32)?"S":"-"}function _Ne(e){return Fr.is(e,16)?bn.SecondaryStructureDssp.I:Fr.is(e,1)?bn.SecondaryStructureDssp.H:Fr.is(e,4)?bn.SecondaryStructureDssp.E:Fr.is(e,2)?bn.SecondaryStructureDssp.B:Fr.is(e,8)?bn.SecondaryStructureDssp.G:Fr.is(e,64)?bn.SecondaryStructureDssp.T:Fr.is(e,32)?bn.SecondaryStructureDssp.S:0}function TNe(e){return Fr.is(e,16)?"I":Fr.is(e,1)?"H":Fr.is(e,4)?"E":Fr.is(e,2)?"B":Fr.is(e,8)?"G":Fr.is(e,64)?"T":Fr.is(e,32)?"S":"-"}function ENe(e,t){let r=new Uint32Array(e.length);for(let n=0,o=e.length;n<o;++n){let i=Fr.create(e[n]);r[n]=t(i)}return r}var iu;(function(e){function t(n){let o=n.descriptor.name,i=n.type==="root"?"inheritedPropertyData":"currentPropertyData",s=l=>(o in l[i]||(l[i][o]={props:{...M.getDefaultValues(n.getParams(l))},data:Af.create(void 0)}),l[i][o]),a=(l,c,u)=>{let d=s(l);l[i][o]={props:c,data:Af.withValue(d.data,u)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:l=>{let c=M.clone(n.getParams(l));return M.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:async(l,c,u={},d)=>{d&&c.customPropertyDescriptors.reference(n.descriptor,!0),n.type==="root"&&(c=c.root);let m=s(c.root).props,p=s(c),h=M.merge(n.defaultParams,m,u);if(p.data.value&&M.areEqual(n.defaultParams,p.props,h))return;let{value:f,assets:C}=await n.obtain(l,c,h);c.customPropertyDescriptors.add(n.descriptor),c.customPropertyDescriptors.assets(n.descriptor,C),a(c,h,f)},ref:(l,c)=>l.customPropertyDescriptors.reference(n.descriptor,c),get:l=>s(l).data,set:(l,c={},u)=>{n.type==="root"&&(l=l.root);let d=s(l),m=M.merge(n.defaultParams,d.props,c);M.areEqual(n.defaultParams,d.props,m)||(a(l,m,u),l.customPropertyDescriptors.assets(n.descriptor))},props:l=>s(l).props}}e.createProvider=t;function r(n,o,i){let s={value:M.Value(i,{isHidden:!0})};return t({label:Ms(n),descriptor:Ci({name:n}),isHidden:!0,type:o,defaultParams:s,getParams:()=>({value:M.Value(i,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(a,l,c)=>({...M.getDefaultValues(s),...c})})}e.createSimple=r})(iu||(iu={}));var Hp;(function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=ea.create(e.Descriptor);function t(r,n,o){let i=new Map,s=[{kind:"none"}],a=PNe(r,n);DNe(r,a,i,s),kNe(n,a,i,r._rowCount,s);let l=o.residues._rowCount,c=d=>d,u={type:new Int32Array(l),key:new Int32Array(l),elements:s};return i.size>0&&RNe(o,a,i,u),lD(u.type,u.key,u.elements,c)}e.fromStruct=t})(Hp||(Hp={}));function PNe(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==0||e.end_label_seq_id.valueKind(0)!==0)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==0||t.end_label_seq_id.valueKind(0)!==0))return"auth";return"label"}function DNe(e,t,r,n){if(!e._rowCount)return;let{beg_label_asym_id:o,beg_label_seq_id:i,beg_auth_seq_id:s,pdbx_beg_PDB_ins_code:a}=e,{end_label_seq_id:l,end_auth_seq_id:c,pdbx_end_PDB_ins_code:u}=e,{pdbx_PDB_helix_class:d,conf_type_id:m,details:p}=e,h=t==="label"?i:s,f=t==="label"?l:c;for(let C=0,g=e._rowCount;C<g;C++){let b=bn.create(d.valueKind(C)===0?bn.SecondaryStructurePdb[d.value(C)]:m.valueKind(C)===0?bn.SecondaryStructureMmcif[m.value(C)]:536870912),y={kind:"helix",flags:b,type_id:m.valueKind(C)===0?m.value(C):"helx_p",helix_class:d.value(C),details:p.valueKind(C)===0?p.value(C):void 0},x={startSeqId:h.value(C),startInsCode:a.value(C),endSeqId:f.value(C),endInsCode:u.value(C),type:b,key:n.length};n[n.length]=y;let A=o.value(C);if(r.has(A)){let v=r.get(A);v.has(x.startSeqId)?v.get(x.startSeqId).push(x):v.set(x.startSeqId,[x])}else r.set(A,new Map([[x.startSeqId,[x]]]))}}function kNe(e,t,r,n,o){if(!e._rowCount)return;let{beg_label_asym_id:i,beg_label_seq_id:s,beg_auth_seq_id:a,pdbx_beg_PDB_ins_code:l}=e,{end_label_seq_id:c,end_auth_seq_id:u,pdbx_end_PDB_ins_code:d}=e,{sheet_id:m}=e,p=t==="label"?s:a,h=t==="label"?c:u,f=new Map,C=n+1;for(let g=0,b=e._rowCount;g<b;g++){let y=m.value(g),x;f.has(y)?x=f.get(y):(x=C++,f.set(y,x));let A=bn.create(8388612),v={kind:"sheet",flags:A,sheet_id:y,symmetry:void 0},_={startSeqId:p.value(g),startInsCode:l.value(g),endSeqId:h.value(g),endInsCode:d.value(g),type:A,key:o.length};o[o.length]=v;let I=i.value(g);if(r.has(I)){let T=r.get(I);T.has(_.startSeqId)?T.get(_.startSeqId).push(_):T.set(_.startSeqId,[_])}else r.set(I,new Map([[_.startSeqId,[_]]]))}}function MNe(e,t,r,n,o,i){let{auth_seq_id:s,label_seq_id:a,pdbx_PDB_ins_code:l}=e.residues,{endSeqId:c,endInsCode:u,key:d,type:m}=r,p=t==="label"?a:s,h=n;for(;h<o;){let f=p.value(h);if(i.type[h]=m,i.key[h]=d,f>c||f===c&&l.value(h)===u)break;h++}}function RNe(e,t,r,n){let{count:o}=e.chainAtomSegments,{label_asym_id:i}=e.chains,{auth_seq_id:s,label_seq_id:a,pdbx_PDB_ins_code:l}=e.residues,c=t==="label"?a:s;for(let u=0;u<o;u++){let d=Wf.chainStartResidueIndex(e,u),m=Wf.chainEndResidueIndexExcl(e,u),p=i.value(u);if(r.has(p)){let h=r.get(p);for(let f=d;f<m;f++){let C=c.value(f);if(h.has(C)){let g=h.get(C);for(let b of g){let y=l.value(f);b.startInsCode===y&&MNe(e,t,b,f,m,n)}}}}}}function $oe(e){let t="model";if(e){t="dssp";for(let r=0,n=e.models.length;r<n;++r){let o=e.models[r];if(Ut.isFromPdbArchive(o)||Ut.hasSecondaryStructure(o)){t="model";break}}}return{type:M.MappedStatic(t,{model:M.EmptyGroup({label:"Model"}),dssp:M.Group(zoe,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}var joe=$oe(),tl=iu.createProvider({label:"Secondary Structure",descriptor:Ci({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:joe,getParams:$oe,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...M.getDefaultValues(joe),...r};switch(n.type.name){case"dssp":return{value:await BNe(t,n.type.params)};case"model":return{value:await LNe(t)}}}});async function BNe(e,t){let r=new Map;for(let n=0,o=e.unitSymmetryGroups.length;n<o;++n){let i=e.unitSymmetryGroups[n].units[0];if(Le.isAtomic(i)&&!Ut.isCoarseGrained(i.model)){let s=await Hoe(i,t);r.set(i.invariantId,s)}}return r}async function LNe(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0];if(Le.isAtomic(o)){let i=Hp.Provider.get(o.model);i&&t.set(o.invariantId,i)}}return t}var NNe={true:e=>!0,false:e=>!1,zero:e=>0};function Ki(){throw new Error("Property only available for atomic models.")}function Sg(e){throw e?new Error(`Property only available for coarse models (${e}).`):new Error("Property only available for coarse models.")}var z2={key:e=>e.element,x:e=>e.unit.conformation.x(e.element),y:e=>e.unit.conformation.y(e.element),z:e=>e.unit.conformation.z(e.element),id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):Ki(),occupancy:e=>Le.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):Ki(),B_iso_or_equiv:e=>Le.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):Ki(),sourceIndex:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element,type_symbol:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):Ki(),label_atom_id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):Ki(),auth_atom_id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):Ki(),label_alt_id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):Ki(),label_comp_id:uD,auth_comp_id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):Ki(),pdbx_formal_charge:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):Ki(),vdw_radius:e=>Le.isAtomic(e.unit)?qf(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):Ki()};function uD(e){return Le.isAtomic(e.unit)||Ki(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function jV(e){return Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):Ki()}function FNe(e){Le.isAtomic(e.unit)||Ki();let t=e.unit.model.sequence.byEntityKey[su(e)];return t&&t.sequence.microHet.has(jV(e))}function Woe(e){Le.isAtomic(e.unit)||Ki();let t=e.unit.model.sequence.byEntityKey[su(e)];return t?t.sequence.microHet.get(jV(e))||[uD(e)]:[uD(e)]}var ONe={key:e=>Le.isAtomic(e.unit)?e.unit.residueIndex[e.element]:Ki(),group_PDB:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):Ki(),label_seq_id:jV,auth_seq_id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):Ki(),pdbx_PDB_ins_code:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):Ki(),isNonStandard:e=>Le.isAtomic(e.unit)?Woe(e).some(t=>e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]==="n"):Ki(),hasMicroheterogeneity:FNe,microheterogeneityCompIds:Woe,secondary_structure_type:e=>{var t;Le.isAtomic(e.unit)||Ki();let r=(t=tl.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return r?r.type[r.getIndex(e.unit.residueIndex[e.element])]:536870912},secondary_structure_key:e=>{var t;Le.isAtomic(e.unit)||Ki();let r=(t=tl.get(e.structure).value)===null||t===void 0?void 0:t.get(e.unit.invariantId);return r?r.key[r.getIndex(e.unit.residueIndex[e.element])]:-1},chem_comp_type:e=>Le.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(uD(e)).type:Ki()},VNe={key:e=>Le.isAtomic(e.unit)?e.unit.chainIndex[e.element]:Ki(),label_asym_id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):Ki(),auth_asym_id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):Ki(),label_entity_id:e=>Le.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):Ki()},GNe={key:z2.key,entityKey:e=>Le.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:Sg(),x:z2.x,y:z2.y,z:z2.z,asym_id:e=>Le.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):Sg(),entity_id:e=>Le.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):Sg(),seq_id_begin:e=>Le.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):Sg(),seq_id_end:e=>Le.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):Sg(),sphere_radius:e=>Le.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:Sg("spheres"),sphere_rmsf:e=>Le.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:Sg("spheres"),gaussian_weight:e=>Le.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:Sg("gaussians"),gaussian_covariance_matrix:e=>Le.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:Sg("gaussians")};function su(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}var UNe={key:su,id:e=>e.unit.model.entities.data.id.value(su(e)),type:e=>e.unit.model.entities.data.type.value(su(e)),src_method:e=>e.unit.model.entities.data.src_method.value(su(e)),pdbx_description:e=>e.unit.model.entities.data.pdbx_description.value(su(e)),formula_weight:e=>e.unit.model.entities.data.formula_weight.value(su(e)),pdbx_number_of_molecules:e=>e.unit.model.entities.data.pdbx_number_of_molecules.value(su(e)),details:e=>e.unit.model.entities.data.details.value(su(e)),pdbx_mutation:e=>e.unit.model.entities.data.pdbx_mutation.value(su(e)),pdbx_fragment:e=>e.unit.model.entities.data.pdbx_fragment.value(su(e)),pdbx_ec:e=>e.unit.model.entities.data.pdbx_ec.value(su(e)),subtype:e=>e.unit.model.entities.subtype.value(su(e)),prd_id:e=>{var t,r;return(r=(t=e.unit.model.entities.prd_id)===null||t===void 0?void 0:t.value(su(e)))!==null&&r!==void 0?r:""}},zNe=[],HNe={id:e=>e.unit.id,chainGroupId:e=>e.unit.chainGroupId,multiChain:e=>Le.Traits.is(e.unit.traits,Le.Trait.MultiChain),object_primitive:e=>e.unit.objectPrimitive,operator_name:e=>e.unit.conformation.operator.name,operator_key:e=>e.unit.conformation.operator.key,model_index:e=>e.unit.model.modelNum,model_label:e=>e.unit.model.label,model_entry_id:e=>e.unit.model.entryId,hkl:e=>e.unit.conformation.operator.hkl,spgrOp:e=>e.unit.conformation.operator.spgrOp,model_num:e=>e.unit.model.modelNum,pdbx_struct_assembly_id:e=>{var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.id)||eo.DefaultName},pdbx_struct_oper_list_ids:e=>{var t;return((t=e.unit.conformation.operator.assembly)===null||t===void 0?void 0:t.operList)||zNe},struct_ncs_oper_id:e=>e.unit.conformation.operator.ncsId},nt={constant:NNe,atom:z2,residue:ONe,chain:VNe,entity:UNe,unit:HNe,coarse:GNe};var ny=class{add(t){let r=this.index.get(t.label_asym_id);r||(r=new Map,this.index.set(t.label_asym_id,r));let n=r.get(t.label_seq_id);return n||(n=[],r.set(t.label_seq_id,n)),this._find(t,n)?!1:(n.push(t),!0)}hasLabelAsymId(t){return this.index.has(t)}has(t){var r,n;let o=qoe(t);if(!this.index.has(o))return;let i=this.index.get(o),s=Zoe(t);if(!i.has(s))return;let a=i.get(s),l=Koe(t),c=Xoe(t),u=Yoe(t),d=(r=Qoe(t))!==null&&r!==void 0?r:"1_555";for(let m of a)if(!(m.label_comp_id!==l||m.label_alt_id!==c||m.ins_code!==u)&&!(this.checkOperator&&((n=m.operator_name)!==null&&n!==void 0?n:"1_555")!==d))return m}static getLabel(t,r=!1){var n;return`${t.label_asym_id} ${t.label_comp_id} ${t.label_seq_id}:${t.ins_code}:${t.label_alt_id}${r?" "+((n=t.operator_name)!==null&&n!==void 0?n:"1_555"):""}`}static getEntryFromLocation(t){var r;return{label_asym_id:qoe(t),label_comp_id:Koe(t),label_seq_id:Zoe(t),label_alt_id:Xoe(t),ins_code:Yoe(t),operator_name:(r=Qoe(t))!==null&&r!==void 0?r:"1_555"}}_find(t,r){var n,o;for(let i of r)if(!(i.label_comp_id!==t.label_comp_id||i.label_alt_id!==t.label_alt_id||i.ins_code!==t.ins_code)&&!(this.checkOperator&&((n=i.operator_name)!==null&&n!==void 0?n:"1_555")!==((o=t.operator_name)!==null&&o!==void 0?o:"1_555")))return!0;return!1}constructor(t){var r;this.index=new Map,this.checkOperator=!1,this.checkOperator=(r=t?.checkOperator)!==null&&r!==void 0?r:!1}},qoe=nt.chain.label_asym_id,Zoe=nt.residue.label_seq_id,Koe=nt.atom.label_comp_id,Xoe=nt.atom.label_alt_id,Yoe=nt.residue.pdbx_PDB_ins_code,Qoe=nt.unit.operator_name;function _C(e,t,r){let n=t.subsetBuilder(!0);for(let o of r.units){if(o.kind!==0){n.setUnit(o.id,o.elements);continue}let{residueAtomSegments:i}=o.model.atomicHierarchy,s=t.unitMap.get(o.id).elements,a=o.elements;n.beginUnit(o.id);let l=Vt.transientSegments(i,a);for(;l.hasNext;){let c=l.move().index;for(let u=i.offsets[c],d=i.offsets[c+1];u<d;u++)Qe.has(s,u)&&n.addElement(u)}n.commitUnit(),e.throwIfTimedOut()}return n.getStructure()}function jNe(e){return function(r){let n=e(r);if(wt.isSingleton(n))return wt.Singletons(r.inputStructure,_C(r,r.inputStructure,n.structure));{let o=new wC(r.inputStructure);for(let i of n.structures)o.add(_C(r,r.inputStructure,i));return o.getSelection()}}}function $V(e,t,r,n){let o=new Rb(t),i=t.lookup3d,s=n.radius;for(let a of r.units){let l=a.conformation,c=a.elements;for(let u=0,d=c.length;u<d;u++){let m=c[u];i.findIntoBuilder(l.x(m),l.y(m),l.z(m),s,o)}e.throwIfTimedOut()}return n.wholeResidues?_C(e,t,o.getStructure()):o.getStructure()}function Joe(e,t,r,n){let o=new Rb(t),i=t.lookup3d,{elementRadius:s,elementRadiusClosure:a,sourceMaxRadius:l,radius:c}=n;e.pushCurrentElement(),e.element.structure=r;for(let u of r.units){e.element.unit=u;let d=u.conformation,m=u.elements;for(let p=0,h=m.length;p<h;p++){let f=m[p];e.element.element=f;let C=s(e);i.findIntoBuilderWithRadius(d.x(f),d.y(f),d.z(f),C,l,c,a,o)}e.throwIfTimedOut()}return e.popCurrentElement(),n.wholeResidues?_C(e,t,o.getStructure()):o.getStructure()}function $Ne(e,t){return r=>(e.element.structure=r.structure,e.element.unit=r.unit,e.element.element=r.element,t(e))}function WNe(e,t){let r=0;e.element.structure=e.inputStructure;for(let n of e.inputStructure.units){e.element.unit=n;let o=n.elements;for(let i=0,s=o.length;i<s;i++){let a=o[i];e.element.element=a;let l=t(e);l>r&&(r=l)}}return e.throwIfTimedOut(),r}function qNe(e,t){return function(n){let o=e(n);if(t.elementRadius){let i={...t,elementRadius:t.elementRadius,elementRadiusClosure:$Ne(n,t.elementRadius),sourceMaxRadius:WNe(n,t.elementRadius)};if(wt.isSingleton(o)){let s=Joe(n,n.inputStructure,o.structure,i);return wt.Singletons(n.inputStructure,s)}else{let s=new wC(n.inputStructure);for(let a of o.structures)s.add(Joe(n,n.inputStructure,a,i));return s.getSelection()}}if(wt.isSingleton(o)){let i=$V(n,n.inputStructure,o.structure,t);return wt.Singletons(n.inputStructure,i)}else{let i=new wC(n.inputStructure);for(let s of o.structures)i.add($V(n,n.inputStructure,s,t));return i.getSelection()}}}function ZNe(e,t){return function(n){let o=e(n);if(wt.structureCount(o)===0)return o;let i=wt.UniqueBuilder(n.inputStructure),s=a=>i.add(a);return wt.forEach(o,(a,l)=>{n.pushInputStructure(a),wt.forEach(t(n),s),n.popInputStructure(),l%10===0&&n.throwIfTimedOut()}),i.getSelection()}}function KNe(e,t){return function(n){let o=e(n);if(wt.structureCount(o)===0)return o;let i=t(n);if(wt.structureCount(i)===0)return wt.Empty(n.inputStructure);let s=wt.unionStructure(i),a=wt.UniqueBuilder(n.inputStructure);return wt.forEach(o,(l,c)=>{let u=rD(s,l);u.elementCount!==0&&a.add(u),c%50===0&&n.throwIfTimedOut()}),a.getSelection()}}function XNe(e,t){return function(n){let o=e(n);if(wt.structureCount(o)===0)return o;let i=t(n);if(wt.structureCount(i)===0)return o;let s=wt.unionStructure(i),a=wt.UniqueBuilder(n.inputStructure);return wt.forEach(o,(l,c)=>{let u=AC(l,s);u.elementCount!==0&&a.add(u),c%50===0&&n.throwIfTimedOut()}),a.getSelection()}}function YNe(e){return function(r){let n=wt.LinearBuilder(r.inputStructure);return n.add(wt.unionStructure(e(r))),n.getSelection()}}function QNe(e,t){return function(n){let o=e(n),i=new Map,s=[];n.pushCurrentElement(),wt.forEach(o,(l,c)=>{n.element.structure=l;for(let u of l.units){n.element.unit=u;let d=u.elements;for(let m=0,p=d.length;m<p;m++){n.element.element=d[m];let h=t(n),f;i.has(h)?f=i.get(h):(f=vn.create(),i.set(h,f)),vn.add(f,c,c)}}s[c]=n.inputStructure.subsetBuilder(!0),c%10===0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure;for(let l of n.inputStructure.units){n.element.unit=l;let c=l.elements;for(let u=0,d=c.length;u<d;u++){n.element.element=c[u];let m=t(n);if(!i.has(m))continue;let p=i.get(m).array;for(let h=0,f=p.length;h<f;h++)s[p[h]].addToUnit(l.id,c[u])}}n.popCurrentElement();let a=wt.UniqueBuilder(n.inputStructure);for(let l of s)a.add(l.getStructure());return a.getSelection()}}function JNe({query:e,layerCount:t,wholeResidues:r,bondTest:n,fixedPoint:o}){let i=Math.max(t,0);return function(a){let l=wt.UniqueBuilder(a.inputStructure),c=e(a);return a.pushCurrentBond(),a.atomicBond.setTestFn(n),wt.forEach(c,(u,d)=>{let m=u;if(o)for(;;){let p=m.elementCount;if(m=eie(a,r,m),m.elementCount===p)break}else for(let p=0;p<i;p++)m=eie(a,r,m);l.add(m),d%10===0&&a.throwIfTimedOut()}),a.popCurrentBond(),l.getSelection()}}function eie(e,t,r){let n=eFe(e,r);return t?_C(e,e.inputStructure,n):n}function eFe(e,t){let r=e.inputStructure,n=r.interUnitBonds,o=new Rb(r),i=e.atomicBond;for(let s of t.units){if(s.kind!==0){o.beginUnit(s.id);for(let p=0,h=s.elements.length;p<h;p++)o.addElement(s.elements[p]);o.commitUnit();continue}let a=r.unitMap.get(s.id),{offset:l,b:c,edgeProps:{flags:u,order:d,key:m}}=a.bonds;i.setStructure(r),i.a.unit=a,i.b.unit=a;for(let p=0,h=s.elements.length;p<h;p++){o.addToUnit(s.id,s.elements[p]);let f=Qe.indexOf(a.elements,s.elements[p]);for(let C=l[f],g=l[f+1];C<g;C++){let b=c[C],y=a.elements[b];Qe.has(s.elements,y)||o.has(s.id,y)||(i.aIndex=f,i.a.element=s.elements[p],i.bIndex=b,i.b.element=y,i.type=u[C],i.order=d[C],i.key=m[C],i.test(e,!0)&&o.addToUnit(s.id,y))}}for(let p of n.getConnectedUnits(a.id)){let h=t.unitMap.get(p.unitB),f=r.unitMap.get(p.unitB);for(let C of p.connectedIndices)if(Qe.has(s.elements,a.elements[C]))for(let g of p.getEdges(C)){let b=f.elements[g.indexB];h&&Qe.has(h.elements,b)||o.has(p.unitB,b)||(i.a.unit=a,i.aIndex=C,i.a.element=a.elements[C],i.b.unit=f,i.bIndex=g.indexB,i.b.element=b,i.type=g.props.flag,i.order=g.props.order,i.key=g.props.key,i.test(e,!0)&&o.addToUnit(p.unitB,b))}}}return o.getStructure()}function tFe({query:e,radius:t,includeWater:r}){return function(o){let i=wt.unionStructure(e(o)),s=_C(o,o.inputStructure,$V(o,o.inputStructure,i,{radius:t})),a=oFe(o.inputStructure),l=iFe(o.inputStructure),c=ce.Location.create(s),u=new Map,d=new ny({checkOperator:!0});for(let h of s.units){if(h.kind!==0)continue;c.unit=h;let{elements:f}=h,C=Vt.transientSegments(h.model.atomicHierarchy.chainAtomSegments,f),g=Vt.transientSegments(h.model.atomicHierarchy.residueAtomSegments,f);for(;C.hasNext;){let b=C.move();c.element=f[b.start];let y=nt.chain.label_asym_id(c),x=nt.unit.operator_name(c);if(a.has(y)){u.has(y)?Ho(u.get(y),x):u.set(y,[x]);continue}let A=nt.entity.type(c);if(!(A==="water"||A==="polymer"))for(g.setSegment(b);g.hasNext;){let v=g.move();c.element=f[v.start],l.addComponent(ny.getEntryFromLocation(c),d)}}o.throwIfTimedOut()}let m=o.inputStructure.subsetBuilder(!0);for(let h of o.inputStructure.units){if(h.kind!==0)continue;c.unit=h;let{elements:f}=h,C=Vt.transientSegments(h.model.atomicHierarchy.chainAtomSegments,f),g=Vt.transientSegments(h.model.atomicHierarchy.residueAtomSegments,f);for(m.beginUnit(h.id);C.hasNext;){let b=C.move();c.element=f[b.start];let y=nt.chain.label_asym_id(c),x=nt.unit.operator_name(c);if(u.has(y)&&u.get(y).indexOf(x)>=0){m.addElementRange(f,b.start,b.end);continue}if(d.hasLabelAsymId(y))for(g.setSegment(b);g.hasNext;){let A=g.move();c.element=f[A.start],d.has(c)&&m.addElementRange(f,A.start,A.end)}}m.commitUnit(),o.throwIfTimedOut()}let p=Cg(o.inputStructure,[m.getStructure(),i]);if(r){let h=new Rb(o.inputStructure),f=o.inputStructure.lookup3d;for(let C of p.units){let g=C.conformation,b=C.elements;for(let y=0,x=b.length;y<x;y++){let A=b[y];f.findIntoBuilderIf(g.x(A),g.y(A),g.z(A),t,h,nFe),h.addToUnit(C.id,A)}o.throwIfTimedOut()}return wt.Sequence(o.inputStructure,[h.getStructure()])}else return wt.Sequence(o.inputStructure,[p])}}var rFe=nt.entity.type;function nFe(e){return rFe(e)==="water"}function oFe(e){let t=e.models[0],r=new Set;if(!qr.is(t.sourceData))return r;let{_rowCount:n,asym_id:o}=t.sourceData.data.db.pdbx_molecule;for(let i=0;i<n;i++)r.add(o.value(i));return r}function iFe(e){var t,r;let n=e.models[0],o=new WV;if(!qr.is(n.sourceData))return o;let i=n.sourceData.data.db.struct_conn,{conn_type_id:s}=i,{ptnr1_label_asym_id:a,ptnr1_label_comp_id:l,ptnr1_label_seq_id:c,ptnr1_symmetry:u,pdbx_ptnr1_label_alt_id:d,pdbx_ptnr1_PDB_ins_code:m}=i,{ptnr2_label_asym_id:p,ptnr2_label_comp_id:h,ptnr2_label_seq_id:f,ptnr2_symmetry:C,pdbx_ptnr2_label_alt_id:g,pdbx_ptnr2_PDB_ins_code:b}=i;for(let y=0;y<i._rowCount;y++){let x=s.value(y);if(x!=="covale"&&x!=="metalc")continue;let A={label_asym_id:a.value(y),label_comp_id:l.value(y),label_seq_id:c.value(y),label_alt_id:d.value(y),ins_code:m.value(y),operator_name:(t=u.value(y))!==null&&t!==void 0?t:"1_555"},v={label_asym_id:p.value(y),label_comp_id:h.value(y),label_seq_id:f.value(y),label_alt_id:g.value(y),ins_code:b.value(y),operator_name:(r=C.value(y))!==null&&r!==void 0?r:"1_555"};o.addEdge(A,v)}return o}var WV=class{constructor(){this.vertices=new Map,this.edges=new Map}addVertex(t,r){this.vertices.has(r)||(this.vertices.set(r,t),this.edges.set(r,[]))}addEdge(t,r){let n=ny.getLabel(t),o=ny.getLabel(r);this.addVertex(t,n),this.addVertex(r,o),Ho(this.edges.get(n),o),Ho(this.edges.get(o),n)}addComponent(t,r){let n=ny.getLabel(t);if(!this.vertices.has(n)){r.add(t);return}let o=new Set,i=new Set,s=[n];for(i.add(n),r.add(t);s.length>0;){let a=s.pop();o.add(a);let l=this.vertices.get(a);for(let c of this.edges.get(a)){if(o.has(c)||(s.push(c),i.has(c)))continue;i.add(c);let u=this.vertices.get(c);l.operator_name===u.operator_name?r.add({...u,operator_name:t.operator_name}):r.add(u)}}}};var ZV={};Ui(ZV,{areIntersectedBy:()=>uFe,first:()=>aFe,getCurrentStructureProperties:()=>H2,isConnectedTo:()=>gFe,pick:()=>sFe,withSameAtomProperties:()=>cFe,within:()=>dFe});function tie(e,t,r,n,o,i){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?dD.check(e,t,r,n,o,i):dD.check(e,r,t,n,o,i)}function rie(e,t,r,n,o){return t.elementCount===0||r.elementCount===0?!0:t.elementCount<=r.elementCount?mD.check(e,t,r,n,o):mD.check(e,r,t,n,o)}var dD;(function(e){let t=D();function r(s,a,l,c,u,d,m){let{elements:p,conformation:h}=a,f=t;s.element.unit=a;let C=!1;for(let g=0,b=p.length;g<b;g++){let y=p[g];s.element.element=y;let x=Math.max(0,D.distance(l,h.position(y,f))-c-m(s));if(x<u)return 0;x<d&&(C=!0)}return C?1:2}function n(s,a,l,c,u,d,m){let{units:p}=a,h=!1;for(let f=0,C=p.length;f<C;f++){let g=r(s,p[f],l,c,u,d,m);if(g===0)return 0;g===1&&(h=!0)}return h?1:2}let o=D();function i(s,a,l,c,u,d){if(a.elementCount===0||l.elementCount===0)return 0;let{units:m}=a,p=!1;s.element.structure=a;for(let h=0,f=m.length;h<f;h++){let C=m[h],{elements:g,conformation:b}=C;s.element.unit=C;for(let y=0,x=g.length;y<x;y++){let A=g[y];s.element.element=A;let v=n(s,l,b.position(A,o),d(s),c,u,d);if(v===0)return!1;v===1&&(p=!0)}}return p}e.check=i})(dD||(dD={}));var mD;(function(e){let t=D();function r(s,a,l,c,u,d){let{elements:m,conformation:p}=a,h=t;s.element.unit=a;for(let f=0,C=m.length;f<C;f++){let g=m[f];if(s.element.element=g,Math.max(0,D.distance(l,p.position(g,h))-c-d(s))<=u)return!0}return!1}function n(s,a,l,c,u,d){let{units:m}=a;for(let p=0,h=m.length;p<h;p++)if(r(s,m[p],l,c,u,d))return!0;return!1}let o=D();function i(s,a,l,c,u){if(a.elementCount===0||l.elementCount===0)return 0;let{units:d}=a;s.element.structure=a;for(let m=0,p=d.length;m<p;m++){let h=d[m];s.element.unit=h;let{elements:f,conformation:C}=h;for(let g=0,b=f.length;g<b;g++){let y=f[g];if(s.element.element=y,n(s,l,C.position(y,o),u(s),c,u))return!0}}return!1}e.check=i})(mD||(mD={}));function sFe(e,t){return r=>{let n=e(r),o=wt.LinearBuilder(r.inputStructure);return r.pushCurrentElement(),wt.forEach(n,(i,s)=>{r.currentStructure=i,t(r)&&o.add(i),s%100&&r.throwIfTimedOut()}),r.popCurrentStructure(),o.getSelection()}}function aFe(e){return t=>{let r=e(t),n=wt.LinearBuilder(t.inputStructure);if(r.kind==="singletons"){if(r.structure.elementCount>0){let o=r.structure.units[0],i=qe.create([o.getChild(Qe.ofSingleton(o.elements[0]))],{parent:t.inputStructure});n.add(i)}}else r.structures.length>0&&n.add(r.structures[0]);return n.getSelection()}}function H2(e,t,r){let{units:n}=e.currentStructure,o=e.pushCurrentElement();o.structure=e.currentStructure;for(let i of n){o.unit=i;let s=i.elements,a=t;if(a){for(let l=0,c=s.length;l<c;l++)o.element=s[l],r.add(a(e));e.throwIfTimedOut()}}return e.popCurrentElement(),r}function lFe(e,t,r){let n=new Set,o=t(e);return e.pushCurrentElement(),wt.forEach(o,(i,s)=>{e.currentStructure=i,H2(e,r,n),s%10&&e.throwIfTimedOut()}),e.popCurrentElement(),n}function cFe(e,t,r){return n=>{let o=e(n),i=lFe(n,t,r),s=wt.LinearBuilder(n.inputStructure);return n.pushCurrentStructure(),wt.forEach(o,(a,l)=>{n.currentStructure=a;let c=H2(n,r,new Set);$n.isSuperset(i,c)&&s.add(a),l%10&&n.throwIfTimedOut()}),n.popCurrentStructure(),s.getSelection()}}function uFe(e,t){return r=>{let n=wt.unionStructure(t(r)),o=wt.LinearBuilder(r.inputStructure);return wt.forEach(e(r),(i,s)=>{IC(n,i)&&o.add(i),s%10&&r.throwIfTimedOut()}),o.getSelection()}}function dFe(e){return t=>{let r={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return r.minRadius===0&&typeof e.minRadius>"u"?mFe(r):r.minRadius===0?pFe(r):fFe(r)}}function mFe({queryCtx:e,selection:t,target:r,maxRadius:n,invert:o}){let i=wt.unionStructure(r).lookup3d,s=wt.LinearBuilder(e.inputStructure),a=D.zero();return wt.forEach(t,(l,c)=>{let{units:u}=l,d=!1;for(let m=0,p=u.length;m<p;m++){let h=u[m],{elements:f,conformation:C}=h;for(let g=0,b=f.length;g<b;g++){let y=f[g];if(C.position(y,a),i.check(a[0],a[1],a[2],n+C.r(y))){d=!0;break}}if(d)break}o&&(d=!d),d&&s.add(l),c%10===0&&e.throwIfTimedOut()}),s.getSelection()}function pFe({queryCtx:e,selection:t,target:r,maxRadius:n,invert:o,elementRadius:i}){let s=wt.unionStructure(r),a=wt.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),wt.forEach(t,(l,c)=>{let u=rie(e,s,l,n,i);o&&(u=!u),u&&a.add(l),c%10===0&&e.throwIfTimedOut()}),e.popCurrentElement(),a.getSelection()}function fFe({queryCtx:e,selection:t,target:r,minRadius:n,maxRadius:o,invert:i,elementRadius:s}){let a=wt.unionStructure(r),l=wt.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),wt.forEach(t,(c,u)=>{let d=tie(e,a,c,n,o,s);i&&(d=!d),d&&l.add(c),u%10===0&&e.throwIfTimedOut()}),e.popCurrentElement(),l.getSelection()}function hFe(e,t){let{queryCtx:r,input:n,target:o,disjunct:i}=e,s=r.atomicBond,a=n.interUnitBonds;s.setStructure(n);for(let l of t.units){if(!Le.isAtomic(l))continue;let c=n.unitMap.get(l.id),{offset:u,b:d,edgeProps:{flags:m,order:p,key:h}}=c.bonds,f=a.getConnectedUnits(l.id),C=f.length,g=l.elements,b=c.elements;for(let y=0,x=g.length;y<x;y++){let A=Qe.indexOf(b,g[y]);s.a.unit=c,s.b.unit=c;for(let v=u[A],_=u[A+1];v<_;v++)if(s.b.element=c.elements[d[v]],!(i&&Qe.has(l.elements,s.b.element))&&o.hasElement(s.b)&&(s.aIndex=A,s.a.element=g[y],s.bIndex=d[v],s.type=m[v],s.order=p[v],s.key=h[v],s.test(r,!0)))return!0;for(let v=0;v<C;v++){let _=f[v],I=n.unitMap.get(_.unitB),T=I.elements,E=_.getEdges(A);for(let w=0,S=E.length;w<S;w++){let P=E[w];if(s.b.unit=I,s.b.element=T[P.indexB],!!o.hasElement(s.b)&&!(i&&t.hasElement(s.b))&&(s.a.unit=c,s.aIndex=A,s.a.element=g[y],s.bIndex=P.indexB,s.type=P.props.flag,s.order=P.props.order,s.key=P.props.key,s.test(r,!0)))return!0}}}}return!1}function gFe({query:e,target:t,disjunct:r,invert:n,bondTest:o}){return i=>{let s=t(i);if(wt.isEmpty(s))return s;let a=e(i);if(wt.isEmpty(a))return a;let l={queryCtx:i,input:i.inputStructure,disjunct:r,target:wt.unionStructure(s)},c=wt.LinearBuilder(i.inputStructure);return i.pushCurrentBond(),i.atomicBond.setTestFn(o),wt.forEach(a,(u,d)=>{(hFe(l,u)||n)&&c.add(u),d%5===0&&i.throwIfTimedOut()}),i.popCurrentBond(),c.getSelection()}}var KV={};Ui(KV,{intersect:()=>vFe,merge:()=>yFe});function yFe(e){return e.length===0?sD:e.length===1?e[0]:t=>{let r=wt.UniqueBuilder(t.inputStructure);for(let n=0;n<e.length;n++)wt.forEach(e[n](t),(o,i)=>{r.add(o),n%100&&t.throwIfTimedOut()});return r.getSelection()}}function vFe(e){return e.length===0?sD:e.length===1?e[0]:t=>{let r=[];for(let a=0;a<e.length;a++)r.push(e[a](t));let n=0,o=wt.structureCount(r[0]);for(let a=1;a<r.length;a++){let l=wt.structureCount(r[a]);l<o&&(n=a,o=l)}t.throwIfTimedOut();let i=rC(a=>a.hashCode,qe.areUnitIdsAndIndicesEqual);wt.forEach(r[n],a=>i.add(a));let s=wt.UniqueBuilder(t.inputStructure);for(let a=0;a<r.length;a++)a!==n&&(wt.forEach(r[a],l=>{i.has(l)&&s.add(l)}),t.throwIfTimedOut());return s.getSelection()}}var XV={};Ui(XV,{atomCount:()=>bFe,countQuery:()=>xFe,propertySet:()=>CFe});function bFe(e){return e.currentStructure.elementCount}function xFe(e){return t=>{let r=e(t);return wt.structureCount(r)}}function CFe(e){return t=>H2(t,e,new Set)}var pD;(function(e){function t(m){return!!m&&!!m.has}function r(m,p){return h=>m(h)===p}e.eq=r;function n(m,p){return h=>m(h)<p}e.lt=n;function o(m,p){return h=>m(h)<=p}e.lte=o;function i(m,p){return h=>m(h)>p}e.gt=i;function s(m,p){return h=>m(h)>=p}e.gte=s;function a(m){return!0}function l(m){return!1}function c(m,p){if(t(p))return h=>p.has(m(h));{if(p.length===0)return l;let h=new Set;for(let f=0;f<p.length;f++)h.add(p[f]);return f=>h.has(m(f))}}e.inSet=c;function u(...m){switch(m.length){case 0:return a;case 1:return m[0];case 2:{let p=m[0],h=m[1];return f=>p(f)&&h(f)}case 3:{let p=m[0],h=m[1],f=m[2];return C=>p(C)&&h(C)&&f(C)}case 4:{let p=m[0],h=m[1],f=m[2],C=m[3];return g=>p(g)&&h(g)&&f(g)&&C(g)}case 5:{let p=m[0],h=m[1],f=m[2],C=m[3],g=m[4];return b=>p(b)&&h(b)&&f(b)&&C(b)&&g(b)}case 6:{let p=m[0],h=m[1],f=m[2],C=m[3],g=m[4],b=m[5];return y=>p(y)&&h(y)&&f(y)&&C(y)&&g(y)&&b(y)}default:{let p=m.length;return h=>{for(let f=0;f<p;f++)if(!m[f])return!1;return!0}}}}e.and=u;function d(...m){switch(m.length){case 0:return l;case 1:return m[0];case 2:{let p=m[0],h=m[1];return f=>p(f)||h(f)}case 3:{let p=m[0],h=m[1],f=m[2];return C=>p(C)||h(C)||f(C)}case 4:{let p=m[0],h=m[1],f=m[2],C=m[3];return g=>p(g)||h(g)||f(g)||C(g)}case 5:{let p=m[0],h=m[1],f=m[2],C=m[3],g=m[4];return b=>p(b)||h(b)||f(b)||C(b)||g(b)}case 6:{let p=m[0],h=m[1],f=m[2],C=m[3],g=m[4],b=m[5];return y=>p(y)||h(y)||f(y)||C(y)||g(y)||b(y)}default:{let p=m.length;return h=>{for(let f=0;f<p;f++)if(m[f])return!0;return!1}}}}e.or=d})(pD||(pD={}));var Pn={generators:HV,filters:ZV,modifiers:qV,combinators:KV,pred:pD,internal:GV,atomset:XV};var ou;(function(e){function t(u,d){return ke.create("Build Assembly",async m=>{let p=u.models;if(p.length!==1)throw new Error("Can only build assemblies from structures based on 1 model.");let h=vg.findAssembly(p[0],d);if(!h)throw new Error(`Assembly '${d}' is not defined.`);let f=eo.create(h.id,de.identity(),{assembly:{id:h.id,operId:0,operList:[]}}),C=qe.Builder({coordinateSystem:f,label:u.label,dynamicBonds:u.dynamicBonds}),g=new ls(u);for(let b of h.operatorGroups){let y=b.selector(g);if(wt.structureCount(y)===0)continue;let{units:x}=wt.unionStructure(y);for(let A of b.operators)for(let v of x)C.addWithOperator(v,A)}return C.getStructure()})}e.buildAssembly=t;function r(u,d,m){return ke.create("Build Symmetry Assembly",async p=>{let h=u.models;if(h.length!==1)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");let f=D(),C=qe.Builder({label:u.label,representativeModel:h[0],dynamicBonds:u.dynamicBonds}),g=new ls(u);for(let b of d){let x=SFe(b.asymIds)(g);if(wt.structureCount(x)===0)continue;let{units:A}=wt.unionStructure(x);for(let{index:v,shift:[_,I,T]}of b.operators){let E=nie(m,v,_,I,T,f);for(let w of A)for(let S of E)C.addWithOperator(w,S)}}return C.getStructure()})}e.buildSymmetryAssembly=r;function n(u,d){return ke.create("Find Symmetry Mates",m=>_Fe(m,u,d))}e.builderSymmetryMates=n;function o(u,d,m){return ke.create("Build Symmetry",p=>wFe(p,u,d,m))}e.buildSymmetryRange=o;function i(u){return ke.create("Build NCS",d=>AFe(d,u))}e.buildNcs=i;function s(u,d){return u.invariantId===d.invariantId&&u.model.id===d.model.id&&Qe.areEqual(u.elements,d.elements)}e.areUnitsEquivalent=s;function a(){return Tq(Le.hashUnit,s)}e.UnitEquivalenceBuilder=a;function l(u){let d=a();for(let p of u.units)d.add(p.id,p);let m=[];for(let p of d.groups)m.push(Le.SymmetryGroup(p.map(h=>u.unitMap.get(h))));return m}e.computeTransformGroups=l;function c(u,d){if(u.length!==d.length)return!1;for(let m=0,p=u.length;m<p;++m){let h=u[m].units,f=d[m].units;if(h.length!==f.length||u[m].hashCode!==d[m].hashCode)return!1;for(let C=0,g=h.length;C<g;C++)if(h[C].conformation!==f[C].conformation)return!1}return!0}e.areTransformGroupsEquivalent=c})(ou||(ou={}));function SFe(e){return Pn.generators.atoms({chainTest:Pn.pred.and(Pn.pred.eq(t=>nt.unit.operator_name(t.element),eo.DefaultName),Pn.pred.inSet(t=>nt.chain.label_asym_id(t.element),e))})}function nie(e,t,r,n,o,i){let{spacegroup:s,ncsOperators:a}=e,l=[],{toFractional:c}=s.cell,u=D.transformMat4(D(),i,c),d=ha.getSymmetryOperatorRef(s,t,r,n,o,u);if(a&&a.length)for(let m=0,p=a.length;m<p;++m){let h=a[m],f=de.mul(de(),d.matrix,h.matrix),C=eo.create(`${d.name} ${h.name}`,f,{assembly:d.assembly,ncsId:h.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});l.push(C)}else l.push(d);return l}function oie(e,t,r,n){let{spacegroup:o,ncsOperators:i}=e,s=i&&i.length||0,a=[];!s&&t[0]<=0&&r[0]>=0&&t[1]<=0&&r[1]>=0&&t[2]<=0&&r[2]>=0&&(a[0]=ha.getSymmetryOperator(o,0,0,0,0));for(let l=0;l<o.operators.length;l++)for(let c=t[0];c<=r[0];c++)for(let u=t[1];u<=r[1];u++)for(let d=t[2];d<=r[2];d++)!s&&l===0&&c===0&&u===0&&d===0||a.push(...nie(e,l,c,u,d,n));return a}function IFe(e,t){return e._operators_333&&D.equals(t,e._operators_333.ref)||(e._operators_333={ref:D.clone(t),operators:oie(e,D.create(-3,-3,-3),D.create(3,3,3),t)}),e._operators_333.operators}function iie(e,t){let r=qe.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),{units:n}=e;for(let o of t)for(let i of n)r.addWithOperator(i,o);return r.getStructure()}async function AFe(e,t){let r=t.models;if(r.length!==1)throw new Error("Can only build NCS from structures based on 1 model.");let n=_o.Provider.get(r[0]);if(!n)return t;let o=n.ncsOperators;return!o||!o.length?t:iie(t,o)}async function wFe(e,t,r,n){let o=t.models;if(o.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");let i=_o.Provider.get(o[0]);if(!i)return t;let{spacegroup:s}=i;if(Ni.isZero(s.cell))return t;let a=Ut.getCenter(o[0]),l=oie(i,r,n,a);return iie(t,l)}async function _Fe(e,t,r){let n=t.models;if(n.length!==1)throw new Error("Can only build symmetries from structures based on 1 model.");let o=_o.Provider.get(n[0]);if(!o)return t;let{spacegroup:i}=o;if(Ni.isZero(i.cell))return t;e.shouldUpdate&&await e.update("Initialing...");let s=Ut.getCenter(n[0]),a=IFe(o,s),l=t.lookup3d,c=new Set;function u(h,f){return`${h.invariantId}|${f.name}`}let d=qe.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),{units:m}=t,p=D.zero();for(let h of a){for(let f of m){let C=f.lookup3d.boundary.sphere;D.transformMat4(p,C.center,h.matrix);let g=l.findUnitIndices(p[0],p[1],p[2],C.radius+r);for(let b=0,y=g.count;b<y;b++){if(!m[g.indices[b]].lookup3d.check(p[0],p[1],p[2],C.radius+r))continue;let A=u(f,h);c.has(A)||(d.addWithOperator(f,h),c.add(A))}}e.shouldUpdate&&await e.update("Building symmetry...")}return d.getStructure()}var fD=class{addToUnit(t,r){let n=this.unitMap.get(t);n?n[n.length]=r:(this.unitMap.set(t,[r]),this.ids[this.ids.length]=t),this.elementCount++}beginUnit(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit}addElement(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++}addElementRange(t,r,n){for(let o=r;o<n;o++)this.currentUnit[this.currentUnit.length]=t[o],this.elementCount++}commitUnit(){this.currentUnit.length!==0&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}setUnit(t,r){this.ids[this.ids.length]=t,this.unitMap.set(t,r),this.elementCount+=r.length}_getStructure(t){if(this.isEmpty)return qe.Empty;let r=[];_a(this.ids);let n=ou.UnitEquivalenceBuilder();for(let o=0,i=this.ids.length;o<i;o++){let s=this.ids[o],a=this.parent.unitMap.get(s),l=this.unitMap.get(s),c=!1;t&&(this.isSorted||_a(l),l=Qe.deduplicate(Qe.ofSortedArray(this.currentUnit)),c=!0);let u=l.length;if(l.length===a.elements.length){r[r.length]=a,n.add(a.id,a);continue}!this.isSorted&&!c&&u>1&&_a(l);let d=a.getChild(Qe.ofSortedArray(l)),m=n.add(d.id,d);d!==m&&(d=m.applyOperator(d.id,d.conformation.operator,!0)),r[r.length]=d}return qe.create(r,{parent:this.parent})}getStructure(){return this._getStructure(!1)}getStructureDeduplicate(){return this._getStructure(!0)}setSingletonLocation(t){let r=this.ids[0];t.unit=this.parent.unitMap.get(r),t.element=this.unitMap.get(r)[0]}get isEmpty(){return this.elementCount===0}constructor(t,r){this.parent=t,this.isSorted=r,this.ids=[],this.unitMap=Ja.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}};function sie(e,t){let r=1;for(;t--;)r*=e--;return r}function TFe(e,t){return t>e?0:sie(e,t)/sie(t,t)}function EFe(e){let t=e&-e,r=e+t,o=((r&-r)/t>>1)-1;return r|o}var YV=class{move(){if(this.hasNext){let t=0,r=0,n=this.index;for(;n;n>>>=1,t++)n&1&&(this.value[r++]=this.array[t]);this.index=EFe(this.index),this.hasNext=this.index<this.maxIndex}return this.value}constructor(t,r){this.array=t,this.hasNext=!1,this.index=(1<<r)-1,this.size=TFe(t.length,r),this.maxIndex=1<<t.length,this.value=new Array(r),this.hasNext=r>0&&r<=t.length}};function QV(e,t){let r=[],n=new YV(e,t);for(;n.hasNext;)r.push(n.move().slice());return r}var Lb=[],aie={links:Lb,terminalLinks:Lb,elements:Lb,partialElements:Lb,getElementIndices:()=>Lb,getLinkIndices:()=>Lb,getTerminalLinkIndices:()=>Lb};var Ba=zp("C"),j2=zp("O"),PFe=[zu.elementFingerprint([Ba,Ba,Ba,j2]),zu.elementFingerprint([Ba,Ba,Ba,Ba,j2]),zu.elementFingerprint([Ba,Ba,Ba,Ba,Ba,j2]),zu.elementFingerprint([Ba,Ba,Ba,Ba,Ba,Ba,j2])];function DFe(e,t){let r=-1,n=-1,o=-1,i=-1,{elements:s}=e,{type_symbol:a,label_atom_id:l}=e.model.atomicHierarchy.atoms,{b:c,offset:u}=e.bonds;for(let d=0,m=t.length;d<m;++d){let p=s[t[d]];if(a.value(p)!==Ba)continue;let h=0,f=0;for(let C=u[t[d]],g=u[t[d]+1];C<g;++C){let b=s[c[C]],y=a.value(b);y===j2?++h:y===Ba&&++f}if(h===2){r=p;break}else h===1&&f===1?n=p:l.value(p).startsWith("C1")?o=p:i=p}return r!==-1?r:n!==-1?n:o!==-1?o:i!==-1?i:s[t[0]]}function kFe(e,t){let{elements:r}=e,{label_alt_id:n}=e.model.atomicHierarchy.atoms;return n.value(r[t])}function MFe(e,t,r,n){let o=t.conformation;return D.normalize(e,D.sub(e,n,o.position(r,e))),e}function lie(e,t){let{elements:r}=e,{label_atom_id:n}=e.model.atomicHierarchy.atoms;return n.value(r[t])}function RFe(e,t){if(!t||!t.length)return;let{unit:r,all:n}=e,o=new Set,i=QV(Rs(new Array(t.length)),2);for(let s=0,a=i.length;s<a;++s){let l=i[s],c=n[t[l[0]]],u=n[t[l[1]]];Qe.areIntersecting(c,u)&&zu.getAltId(r,c)===zu.getAltId(r,u)&&(o.add(t[l[0]]),o.add(t[l[1]]))}if(o.size){let s=[];for(let a=0,l=t.length;a<l;++a)o.has(t[a])||s.push(t[a]);return s}else return t}function BFe(e,t){return t.properties.saccharideComponentMap.get(e)}function cie(e){if(e.models.reduce((m,p)=>m+p.properties.saccharideComponentMap.size,0)===0)return aie;let t=[],r=[],n=[],o=[],i=new Map;function s(m,p,h){return`${m}|${p}|${h}`}function a(m,p){i.has(m)?i.get(m).push(p):i.set(m,[p])}function l(m,p){D.sub(n[m].geometry.direction,n[p].geometry.center,n[m].geometry.center),D.normalize(n[m].geometry.direction,n[m].geometry.direction)}let c=D();function u(m,p,h){let f=h.conformation,C=n[m].geometry;D.sub(C.direction,f.position(h.elements[p],c),C.center),D.normalize(C.direction,C.direction)}for(let m=0,p=e.units.length;m<p;++m){let h=e.units[m];if(!Le.isAtomic(h))continue;let{model:f,rings:C}=h,{chainAtomSegments:g,residueAtomSegments:b,atoms:y}=f.atomicHierarchy,{label_comp_id:x}=y,A=Vt.transientSegments(g,h.elements),v=Vt.transientSegments(b,h.elements),_;for(;A.hasNext;)for(v.setSegment(A.move());v.hasNext;){let{index:I}=v.move(),T=BFe(x.value(b.offsets[I]),f);if(!T)continue;_||(_=J0.byFingerprintAndResidue(C,PFe));let E=RFe(C,_.get(I));if(!E||!E.length){o.push({unit:h,residueIndex:I,component:T});continue}let w=[];for(let P=0,k=E.length;P<k;++P){let L=C.all[E[P]],R=DFe(h,L),N=gl.calculateMomentsAxes(Y3(h,L)),F=gl.calculateNormalizedAxes(N),H=D.copy(D(),F.origin),V=D.copy(D(),F.dirC),q=MFe(D(),h,R,H);D.orthogonalize(q,V,q);let Q=zu.getAltId(h,L),O=n.length;w.push(O),a(s(I,h.id,Q),O),Q&&a(s(I,h.id,""),O),n.push({geometry:{center:H,normal:V,direction:q},component:T,ringIndex:E[P],altId:Q,unit:h,residueIndex:I})}let S=QV(Rs(new Array(E.length)),2);for(let P=0,k=S.length;P<k;++P){let L=S[P],R=C.all[E[L[0]]],N=C.all[E[L[1]]];if(Fs.areVertexSetsConnected(h.bonds,R,N,3)){let F=w[L[0]],H=w[L[1]];n[F].altId===n[H].altId&&(l(F,H),l(H,F),t.push({carbohydrateIndexA:F,carbohydrateIndexB:H}),t.push({carbohydrateIndexA:H,carbohydrateIndexB:F}))}}}}function d(m,p){return i.get(s(m.getResidueIndex(p),m.id,kFe(m,p)))||[]}for(let m=0,p=n.length;m<p;++m){let h=n[m],{unit:f}=h;for(let C=m+1;C<p;++C){let g=n[C];if(f!==g.unit||h.residueIndex===g.residueIndex)continue;let b=f.rings.all[h.ringIndex],y=f.rings.all[g.ringIndex];Fs.areVertexSetsConnected(f.bonds,b,y,3)&&(l(m,C),l(C,m),t.push({carbohydrateIndexA:m,carbohydrateIndexB:C}),t.push({carbohydrateIndexA:C,carbohydrateIndexB:m}))}}for(let m=0,p=e.units.length;m<p;++m){let h=e.units[m];Le.isAtomic(h)&&e.interUnitBonds.getConnectedUnits(h.id).forEach(f=>{f.connectedIndices.forEach(C=>{f.getEdges(C).forEach(({props:g,indexB:b})=>{if(!Br.isCovalent(g.flag))return;let y=e.unitMap.get(f.unitA),x=e.unitMap.get(f.unitB),A=d(y,C),v=d(x,b);if(A.length>0&&v.length>0){let _=A.length,I=v.length;for(let T=0,E=Math.max(_,I);T<E;++T){let w=A[Math.min(T,_-1)],S=v[Math.min(T,I-1)],P=lie(y,C);(P.startsWith("O1")||P.startsWith("C1"))&&l(w,S),t.push({carbohydrateIndexA:w,carbohydrateIndexB:S})}}else if(v.length===0)for(let _ of A){let I=lie(y,C);(I.startsWith("O1")||I.startsWith("C1"))&&u(_,b,x),r.push({carbohydrateIndex:_,elementIndex:b,elementUnit:x,fromCarbohydrate:!0})}else if(A.length===0)for(let _ of v)r.push({carbohydrateIndex:_,elementIndex:C,elementUnit:y,fromCarbohydrate:!1})})})})}return{links:t,terminalLinks:r,elements:n,partialElements:o,...LFe(n,t,r)}}function LFe(e,t,r){function n(d,m){return Ys(d.id,m)}function o(d,m,p){let h=[],f=d.get(n(m,p));if(f!==void 0)for(let C of f)Ho(h,C);return h}let i=new Map;for(let d=0,m=e.length;d<m;++d){let{unit:p,ringIndex:h}=e[d],f=p.rings.all[h];for(let C=0,g=f.length;C<g;++C){let b=n(p,p.elements[f[C]]),y=i.get(b);y===void 0?i.set(b,[d]):y.push(d)}}function s(d,m){return o(i,d,m)}let a=new Map;for(let d=0,m=t.length;d<m;++d){let p=t[d],{unit:h,ringIndex:f}=e[p.carbohydrateIndexA],C=h.rings.all[f];for(let g=0,b=C.length;g<b;++g){let y=n(h,h.elements[C[g]]),x=a.get(y);x===void 0?a.set(y,[d]):x.push(d)}}function l(d,m){return o(a,d,m)}let c=new Map;for(let d=0,m=r.length;d<m;++d){let{fromCarbohydrate:p,carbohydrateIndex:h,elementUnit:f,elementIndex:C}=r[d];if(p){let{unit:g,ringIndex:b}=e[h],y=g.rings.all[b];for(let x=0,A=y.length;x<A;++x){let v=n(g,g.elements[y[x]]),_=c.get(v);_===void 0?c.set(v,[d]):_.push(d)}}else{let g=n(f,f.elements[C]),b=c.get(g);b===void 0?c.set(g,[d]):b.push(d)}}function u(d,m){return o(c,d,m)}return{getElementIndices:s,getLinkIndices:l,getTerminalLinkIndices:u}}var hD=Pe(),NFe=new is("14"),FFe=new is("98");function OFe(e){return e>500?NFe:FFe}function uie(e){let{units:t}=e,r=OFe(t.length);r.reset();for(let n=0,o=t.length;n<o;n++){let i=t[n],s=i.boundary,a=i.conformation.operator;a.isIdentity?r.includeSphere(s.sphere):(Pe.transform(hD,s.sphere,a.matrix),r.includeSphere(hD))}r.finishedIncludeStep();for(let n=0,o=t.length;n<o;n++){let i=t[n],s=i.boundary,a=i.conformation.operator;a.isIdentity?r.radiusSphere(s.sphere):(Pe.transform(hD,s.sphere,a.matrix),r.radiusSphere(hD))}return{box:r.getBox(),sphere:r.getSphere()}}var qe=class e{subsetBuilder(t){return new fD(this,t)}get elementCount(){return this.state.elementCount}get bondCount(){return this.state.bondCount===-1&&(this.state.bondCount=this.interUnitBonds.edgeCount+_t.getIntraUnitBondCount(this)),this.state.bondCount}get hasCustomProperties(){return!!this.state.customProps&&this.state.customProps.all.length>0}get customPropertyDescriptors(){return this.state.customProps||(this.state.customProps=new Ls),this.state.customProps}get currentPropertyData(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData}get inheritedPropertyData(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData}get polymerResidueCount(){return this.state.polymerResidueCount===-1&&(this.state.polymerResidueCount=WFe(this)),this.state.polymerResidueCount}get polymerGapCount(){return this.state.polymerGapCount===-1&&(this.state.polymerGapCount=qFe(this)),this.state.polymerGapCount}get polymerUnitCount(){return this.state.polymerUnitCount===-1&&(this.state.polymerUnitCount=ZFe(this)),this.state.polymerUnitCount}get uniqueElementCount(){return this.state.uniqueElementCount===-1&&(this.state.uniqueElementCount=$Fe(this)),this.state.uniqueElementCount}get atomicResidueCount(){return this.state.atomicResidueCount===-1&&(this.state.atomicResidueCount=KFe(this)),this.state.atomicResidueCount}get isCoarseGrained(){return this.models.some(t=>Ut.isCoarseGrained(t))}get isEmpty(){return this.units.length===0}get hashCode(){return this.state.hashCode!==-1?this.state.hashCode:this.computeHash()}get transformHash(){return this.state.transformHash!==-1?this.state.transformHash:(this.state.transformHash=di(this.units.map(t=>t.id)),this.state.transformHash)}computeHash(){let t=23;for(let r=0,n=this.units.length;r<n;r++){let o=this.units[r];t=31*t+o.id|0,t=31*t+Qe.hashCode(o.elements)|0}return t=31*t+this.elementCount|0,t=RE(t),t===-1&&(t=0),this.state.hashCode=t,t}elementLocations(){return new e.ElementLocationIterator(this)}get root(){var t;return(t=this.state.parent)!==null&&t!==void 0?t:this}get parent(){return this.state.parent}get coordinateSystem(){return this.state.coordinateSystem}get label(){return this.state.label}get boundary(){return this.state.boundary?this.state.boundary:(this.state.boundary=uie(this),this.state.boundary)}get lookup3d(){return this.state.lookup3d?this.state.lookup3d:(this.state.lookup3d=new tD(this),this.state.lookup3d)}get interUnitBonds(){return this.state.interUnitBonds?this.state.interUnitBonds:(this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&this.parent.state.interUnitBonds.edgeCount===0?this.state.interUnitBonds=new bg(new Map):this.state.interUnitBonds=noe(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair}),this.state.interUnitBonds)}get dynamicBonds(){return this.state.dynamicBonds}get interBondsValidUnit(){return this.state.interBondsValidUnit}get interBondsValidUnitPair(){return this.state.interBondsValidUnitPair}get unitSymmetryGroups(){return this.state.unitSymmetryGroups?this.state.unitSymmetryGroups:(this.state.unitSymmetryGroups=ou.computeTransformGroups(this),this.state.unitSymmetryGroups)}get unitSymmetryGroupsIndexMap(){return this.state.unitSymmetryGroupsIndexMap?this.state.unitSymmetryGroupsIndexMap:(this.state.unitSymmetryGroupsIndexMap=Le.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups),this.state.unitSymmetryGroupsIndexMap)}get carbohydrates(){return this.state.carbohydrates?this.state.carbohydrates:(this.state.carbohydrates=cie(this),this.state.carbohydrates)}get models(){return this.state.models?this.state.models:(this.state.models=GFe(this),this.state.models)}get uniqueResidueNames(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=UFe(this))}get uniqueElementSymbols(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=zFe(this))}get entityIndices(){return this.state.entityIndices||(this.state.entityIndices=HFe(this))}get uniqueAtomicResidueIndices(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=jFe(this))}get isAtomic(){for(let t of this.units)if(!Le.isAtomic(t))return!1;return!0}get hasAtomic(){for(let t of this.units)if(Le.isAtomic(t))return!0;return!1}get isCoarse(){for(let t of this.units)if(!Le.isCoarse(t))return!1;return!0}get hasCoarse(){for(let t of this.units)if(Le.isCoarse(t))return!0;return!1}get serialMapping(){return this.state.serialMapping||(this.state.serialMapping=XFe(this))}get model(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;let t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model}get masterModel(){return this.state.masterModel}get representativeModel(){return this.state.representativeModel}hasElement(t){return this.unitMap.has(t.unit.id)?Qe.has(this.unitMap.get(t.unit.id).elements,t.element):!1}getModelIndex(t){return this.models.indexOf(t)}remapModel(t){let{dynamicBonds:r,interUnitBonds:n,parent:o}=this.state,i=[];for(let s of this.unitSymmetryGroups){let a=s.units[0].remapModel(t,r);i.push(a);for(let l=1,c=s.units.length;l<c;++l){let u=s.units[l];i.push(u.remapModel(t,r,a.props))}}return e.create(i,{parent:o?.remapModel(t),label:this.label,interUnitBonds:r?void 0:n,dynamicBonds:r,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})}asParent(){if(this._proxy)return this._proxy;if(this.parent){let t=this.parent.coordinateSystem.isIdentity?this.parent:e.transform(this.parent,this.parent.coordinateSystem.inverse),r=this.coordinateSystem.isIdentity?t:e.transform(t,this.coordinateSystem.matrix);this._proxy=new e(r.units,r.unitMap,r.unitIndexMap,{...r.state,dynamicBonds:this.dynamicBonds},{child:this,target:this.parent})}else this._proxy=this;return this._proxy}get child(){return this._child}get target(){var t;return(t=this._target)!==null&&t!==void 0?t:this}constructor(t,r,n,o,i){this.units=t,this.unitMap=r,this.unitIndexMap=n,this.state=o,this._child=i?.child,this._target=i?.target,this._proxy=void 0}};function VFe(e,t,r){return e[t].id-e[r].id}function GFe(e){let{units:t}=e,r=vn.create();for(let n of t)vn.add(r,n.model.id,n.model);return r.array}function UFe(e){let{microheterogeneityCompIds:t}=nt.residue,r=new Set,n=ce.Location.create(e);for(let o of e.unitSymmetryGroups){let i=o.units[0];if(!Le.isAtomic(i))continue;let s=Vt.transientSegments(i.model.atomicHierarchy.residueAtomSegments,i.elements);for(n.unit=i;s.hasNext;){let a=s.move();n.element=i.elements[a.start];let l=t(n);for(let c of l)r.add(c)}}return r}function zFe(e){let t=nt.atom.type_symbol,r=new Set,n=ce.Location.create(e);for(let o of e.unitSymmetryGroups){let i=o.units[0];if(Le.isAtomic(i)){n.unit=i;for(let s=0,a=i.elements.length;s<a;++s)n.element=i.elements[s],r.add(t(n))}}return r}function HFe(e){let{units:t}=e,r=ce.Location.create(e),n=vn.create();for(let o of t){let i=o.kind===0?nt.entity.key:nt.coarse.entityKey;r.unit=o;let s=o.elements,a=Vt.transientSegments(o.model.atomicHierarchy.chainAtomSegments,s);for(;a.hasNext;){let l=a.move();r.element=s[l.start];let c=i(r);vn.add(n,c,c)}}return _a(n.array),n.array}function jFe(e){let t=new Map,r=[],n=e.unitSymmetryGroups;for(let i of n){let s=i.units[0];if(!Le.isAtomic(s))continue;let a;t.has(s.model.id)?a=t.get(s.model.id):(a=vn.create(),r.push(s.model.id),t.set(s.model.id,a));let l=Vt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(;l.hasNext;){let c=l.move();vn.add(a,c.index,c.index)}}let o=new Map;for(let i of r){let s=t.get(i).array;_a(s),o.set(i,s)}return o}function $Fe(e){let{unitSymmetryGroups:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].elements.length;return r}function WFe(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].polymerElements.length;return r}function qFe(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)r+=t[n].gapElements.length/2;return r}function ZFe(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++)t[n].polymerElements.length>0&&(r+=1);return r}function KFe(e){let{units:t}=e,r=0;for(let n=0,o=t.length;n<o;n++){let i=t[n];if(!Le.isAtomic(i))continue;let{elements:s,residueIndex:a}=i,l=-1,c=-1;for(let u=0,d=s.length;u<d;++u)l=a[s[u]],l!==c&&(r+=1,c=l)}return r}function XFe(e){let{units:t,elementCount:r,unitIndexMap:n}=e,o=new Uint32Array(t.length),i=new Uint32Array(r),s=new Uint32Array(r);for(let a=0,l=0,c=t.length;a<c;++a){o[a]=l;let{elements:u}=t[a];for(let d=0,m=u.length;d<m;++d){let p=l+d;i[p]=a,s[p]=u[d]}l+=u.length}return{cumulativeUnitElementCount:o,unitIndices:i,elementIndices:s,getSerialIndex:(a,l)=>o[n.get(a.id)]+Ge.indexOf(a.elements,l)}}(function(e){e.Empty=l([]);function t(Z){return{kind:"structure-loci",structure:Z}}e.Loci=t;function r(Z){let J=[];for(let ie of Z.units)J.push({unit:ie,indices:Be.ofBounds(0,ie.elements.length)});return ce.Loci(Z,J)}e.toStructureElementLoci=r;function n(Z,J){return wt.toLociWithSourceUnits(wt.Singletons(Z,J))}e.toSubStructureElementLoci=n;function o(Z){return!!Z&&Z.kind==="structure-loci"}e.isLoci=o;function i(Z,J){return Z.structure===J.structure}e.areLociEqual=i;function s(Z){return Z.structure.isEmpty}e.isLociEmpty=s;function a(Z,J){return J===Z.structure?Z:t(J)}e.remapLoci=a;function l(Z,J={}){let ie=Ja.Mutable(),ne=Ja.Mutable(),le=0,ee=!0,oe=Z.length>0?Z[0].id:0;for(let X=0,W=Z.length;X<W;X++){let K=Z[X];ie.set(K.id,K),le+=K.elements.length,K.id<oe&&(ee=!1),oe=K.id}ee||EE(Z,0,Z.length,VFe,Wh);for(let X=0,W=Z.length;X<W;X++)ne.set(Z[X].id,X);let te={hashCode:-1,transformHash:-1,elementCount:le,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:eo.Default,label:""};return J.parent&&(te.parent=J.parent.parent||J.parent),J.interUnitBonds&&(te.interUnitBonds=J.interUnitBonds),J.interBondsValidUnit?te.interBondsValidUnit=J.interBondsValidUnit:J.parent&&(te.interBondsValidUnit=J.parent.interBondsValidUnit),J.interBondsValidUnitPair?te.interBondsValidUnitPair=J.interBondsValidUnitPair:J.parent&&(te.interBondsValidUnitPair=J.parent.interBondsValidUnitPair),J.dynamicBonds?te.dynamicBonds=J.dynamicBonds:J.parent&&(te.dynamicBonds=J.parent.dynamicBonds),J.coordinateSystem?te.coordinateSystem=J.coordinateSystem:J.parent&&(te.coordinateSystem=J.parent.coordinateSystem),J.label?te.label=J.label:J.parent&&(te.label=J.parent.label),J.masterModel?te.masterModel=J.masterModel:J.parent&&(te.masterModel=J.parent.masterModel),J.representativeModel?te.representativeModel=J.representativeModel:J.parent&&(te.representativeModel=J.parent.representativeModel),new e(Z,ie,ne,te)}e.create=l;async function c(Z,J){if(Z.frameCount===0)return e.Empty;let ie=[],ne,le=0;for(let ee=0,oe=Z.frameCount;ee<oe;++ee){let te=await ke.resolveInContext(Z.getFrameAtIndex(ee),J);ne||(ne=te);let X=d(te);for(let W=0,K=X.units.length;W<K;++W){let re=X.units[W],se=re.invariantId+le,me=re.chainGroupId+le,Y=Le.create(ie.length,se,me,re.traits,re.kind,re.model,re.conformation.operator,re.elements);ie.push(Y)}le=ie.length}return l(ie,{representativeModel:ne,label:ne.label})}e.ofTrajectory=c;let u=!1;function d(Z,J={}){let ie=Z.atomicHierarchy.chainAtomSegments,{index:ne}=Z.atomicHierarchy,{auth_asym_id:le}=Z.atomicHierarchy.chains,{atomicChainOperatorMappinng:ee}=Z,oe=new b({label:Z.label,...J});for(let X=0;X<ie.count;X++){let W=ee.get(X)||eo.Default,K=ie.offsets[X],re=Wf.chainResidueCount(Z.atomicHierarchy,X)===ie.offsets[X+1]-ie.offsets[X],se=!1;if(m(Z,X))for(;X+1<ie.count&&m(Z,X+1);){let Y=ee.get(X),ae=ee.get(X+1);if(Y!==ae)break;se=!0,X++}else for(;X+1<ie.count&&ie.offsets[X+1]-ie.offsets[X]===1&&ie.offsets[X+2]-ie.offsets[X+1]===1;){re=!0;let Y=ne.getEntityFromChain(X),ae=ne.getEntityFromChain(X+1);if(Y!==ae)break;let ve=le.value(X),ge=le.value(X+1);if(ve!==ge)break;let Se=ee.get(X),Ee=ee.get(X+1);if(Se!==Ee)break;se=!0,X++}let me=Qe.ofBounds(K,ie.offsets[X+1]);u?re&&!p(Z,X)?h(Z,me,oe,se,W):me.length>2e5||m(Z,X)?f(Z,me,oe,se,W):oe.addUnit(0,Z,W,me,se?Le.Trait.MultiChain:Le.Trait.None):oe.addUnit(0,Z,W,me,se?Le.Trait.MultiChain:Le.Trait.None)}let te=Z.coarseHierarchy;return te.isDefined&&(te.spheres.count>0&&C(oe,Z,Z.coarseHierarchy.spheres,1),te.gaussians.count>0&&C(oe,Z,Z.coarseHierarchy.gaussians,2)),oe.getStructure()}e.ofModel=d;function m(Z,J){let ie=Z.atomicHierarchy.index.getEntityFromChain(J);return Z.entities.data.type.value(ie)==="water"}function p(Z,J){let ie=Z.atomicHierarchy.index.getEntityFromChain(J);return Z.entities.data.type.value(ie)==="polymer"}function h(Z,J,ie,ne,le){let{x:ee,y:oe,z:te}=Z.atomicConformation,X={x:ee,y:oe,z:te,indices:J},W=Ma(X,Ec(X),8192),{offset:K,count:re,array:se}=W.buckets,me=(ne?Le.Trait.MultiChain:Le.Trait.None)|(K.length>1?Le.Trait.Partitioned:Le.Trait.None);ie.beginChainGroup();for(let Y=0,ae=K.length;Y<ae;Y++){let ve=K[Y],ge=new Int32Array(re[Y]);for(let Se=0,Ee=re[Y];Se<Ee;Se++)ge[Se]=J[se[ve+Se]];ie.addUnit(0,Z,le,Qe.ofSortedArray(ge),me)}ie.endChainGroup()}function f(Z,J,ie,ne,le){let{residueAtomSegments:ee}=Z.atomicHierarchy,oe=[],te=[],X=Vt.transientSegments(ee,J);for(;X.hasNext;){let Fe=X.move();oe[oe.length]=J[Fe.start],te[te.length]=J[Fe.end]}let K=512*(te[0]-oe[0]),{x:re,y:se,z:me}=Z.atomicConformation,Y={x:re,y:se,z:me,indices:Qe.ofSortedArray(oe)},ae=Ma(Y,Ec(Y),K),{offset:ve,count:ge,array:Se}=ae.buckets,Ee=(ne?Le.Trait.MultiChain:Le.Trait.None)|(ve.length>1?Le.Trait.Partitioned:Le.Trait.None);ie.beginChainGroup();for(let Fe=0,Ae=ve.length;Fe<Ae;Fe++){let we=ve[Fe],_e=[];for(let Ke=0,rt=ge[Fe];Ke<rt;Ke++){let pt=Se[we+Ke];for(let Ne=oe[pt],je=te[pt];Ne<je;Ne++)_e[_e.length]=Ne}ie.addUnit(0,Z,le,Qe.ofSortedArray(new Int32Array(_e)),Ee)}ie.endChainGroup()}function C(Z,J,ie,ne){let{chainElementSegments:le}=ie;for(let ee=0;ee<le.count;ee++){let oe=Qe.ofBounds(le.offsets[ee],le.offsets[ee+1]);Z.addUnit(ne,J,eo.Default,oe,Le.Trait.None)}}function g(Z,J){if(de.isIdentity(J))return Z;if(!de.isRotationAndTranslation(J,eo.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");let ie=[];for(let ee of Z.units){let oe=ee.conformation.operator,te=eo.create(oe.name,J,oe);ie.push(ee.applyOperator(ee.id,te))}let ne=Z.coordinateSystem,le=eo.compose(eo.create(ne.name,J,ne),ne);return l(ie,{parent:Z,coordinateSystem:le})}e.transform=g;class b{beginChainGroup(){this.chainGroupId++,this.inChainGroup=!0}endChainGroup(){this.inChainGroup=!1}addUnit(J,ie,ne,le,ee,oe){oe===void 0&&(oe=this.invariantId());let te=this.inChainGroup?this.chainGroupId:++this.chainGroupId,X=Le.create(this.units.length,oe,te,ee,J,ie,ne,le);return this.add(X)}add(J){if(J.elements.length===1){J.conformation.position(J.elements[0],this.p);let ie=[J.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(ie))return this.singleElementUnits.get(ie);this.singleElementUnits.set(ie,J)}return this.units.push(J),J}addWithOperator(J,ie,ne=!1){return this.add(J.applyOperator(this.units.length,ie,ne))}getStructure(){return l(this.units,this.props)}get isEmpty(){return this.units.length===0}constructor(J={}){this.props=J,this.units=[],this.invariantId=ei(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=D(),this.singleElementUnits=new Map}}e.StructureBuilder=b;function y(Z={}){return new b(Z)}e.Builder=y;function x(Z){return Z.hashCode}e.hashCode=x;function A(Z){return NA(Z.units.map(J=>Le.conformationId(J)).join("|"))}e.conformationHash=A;function v(Z,J){if(Z===J)return!0;if(Z.elementCount!==J.elementCount)return!1;let ie=Z.units.length;if(ie!==J.units.length)return!1;for(let ne=0;ne<ie;ne++)if(Z.units[ne].id!==J.units[ne].id)return!1;return!0}e.areUnitIdsEqual=v;function _(Z,J){if(Z===J)return!0;if(!v(Z,J))return!1;for(let ie=0,ne=Z.units.length;ie<ne;ie++)if(!Qe.areEqual(Z.units[ie].elements,J.units[ie].elements))return!1;return!0}e.areUnitIdsAndIndicesEqual=_;function I(Z,J){if(Z.hashCode!==J.hashCode)return!1;let ie=Z.models.length;if(ie!==J.models.length)return!1;for(let ne=0;ne<ie;ne++)if(!Ut.areHierarchiesEqual(Z.models[ne],J.models[ne]))return!1;return!0}e.areHierarchiesEqual=I;function T(Z,J){return Z===J||Z.hashCode===J.hashCode&&ou.areTransformGroupsEquivalent(Z.unitSymmetryGroups,J.unitSymmetryGroups)}e.areEquivalent=T;function E(Z,J){return T(Z.root,J.root)}e.areRootsEquivalent=E;function w(Z,J){return Z.root===J.root}e.areRootsEqual=w;class S{move(){return this.advance(),this.current.element=this.elements[this.idx],this.current}advance(){if(this.idx<this.maxIdx){this.idx++,this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length);return}if(this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length){this.hasNext=!1;return}this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,this.maxIdx===0&&(this.hasNext=this.unitIndex+1<this.structure.units.length)}constructor(J){this.structure=J,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=ce.Location.create(J),this.hasNext=J.elementCount>0,this.hasNext&&(this.elements=J.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=J.units[0])}}e.ElementLocationIterator=S;let P=D();function k(Z,J,ie){let{elements:ne,conformation:le}=Z,ee=P,oe=Number.MAX_VALUE;for(let te=0,X=ne.length;te<X;te++){let W=ne[te],K=D.distance(J,le.position(W,ee))-ie-le.r(W);K<oe&&(oe=K)}return oe}function L(Z,J,ie){let{units:ne}=Z,le=Number.MAX_VALUE;for(let ee=0,oe=ne.length;ee<oe;ee++){let te=ne[ee],X=k(te,J,ie);X<le&&(le=X)}return le}e.minDistanceToPoint=L;let R=D();function N(Z,J){if(Z.elementCount===0||J.elementCount===0)return 0;let{units:ie}=Z,ne=Number.MAX_VALUE;for(let le=0,ee=ie.length;le<ee;le++){let oe=ie[le],{elements:te,conformation:X}=oe;for(let W=0,K=te.length;W<K;W++){let re=te[W],se=L(J,X.position(re,R),X.r(re));se<ne&&(ne=se)}}return ne}e.distance=N;function F(Z){return Z.elementCount===1?"1 element":`${Z.elementCount} elements`}e.elementDescription=F;function H(Z,J,ie){return Z.masterModel?J.model===ie.model||J.model===Z.masterModel||ie.model===Z.masterModel:J.model===ie.model}e.validUnitPair=H;function V(Z,J,ie){let{maxRadius:ne,validUnit:le,validUnitPair:ee}=ie;if(!Z.units.some(X=>le(X)))return;let oe=Z.lookup3d,te=D();for(let X of Z.units){if(!le(X))continue;let W=X.boundary.sphere;D.transformMat4(te,W.center,X.conformation.operator.matrix);let K=oe.findUnitIndices(te[0],te[1],te[2],W.radius+ne);for(let re=0;re<K.count;re++){let se=Z.units[K.indices[re]];X.id>=se.id||!le(se)||!ee(X,se)||(se.elements.length>=X.elements.length?J(X,se):J(se,X))}}}e.eachUnitPair=V;function q(Z,{chain:J,residue:ie,atom:ne}){let le=ce.Location.create(Z);for(let ee of Z.units){if(ee.kind!==0)continue;le.unit=ee;let{elements:oe}=ee,te=Vt.transientSegments(ee.model.atomicHierarchy.chainAtomSegments,oe),X=Vt.transientSegments(ee.model.atomicHierarchy.residueAtomSegments,oe);for(;te.hasNext;){let W=te.move();if(J&&(le.element=oe[W.start],J(le)),!(!ie&&!ne))for(X.setSegment(W);X.hasNext;){let K=X.move();if(ie&&(le.element=oe[K.start],ie(le)),!!ne)for(let re=K.start,se=K.end;re<se;re++)le.element=oe[re],ne(le)}}}}e.eachAtomicHierarchyElement=q,e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15};function Q(Z){return Z.unitSymmetryGroups.filter(J=>J.units[0].polymerElements.length>0)}function O(Z,J){let ie=Q(Z);return ie.length===1&&ie[0].units.length>2&&ie[0].units[0].polymerElements.length<J.fiberResidueCount}function B(Z,J){let ie=Q(Z);return ie.length>=1&&ie[0].units.length>J.highSymmetryUnitCount}let j;(function(Z){Z[Z.Small=0]="Small",Z[Z.Medium=1]="Medium",Z[Z.Large=2]="Large",Z[Z.Huge=3]="Huge",Z[Z.Gigantic=4]="Gigantic"})(j=e.Size||(e.Size={}));function U(Z,J={},ie=1){let ne={...e.DefaultSizeThresholds,...J};return Z.polymerResidueCount>=ne.largeResidueCount*ie?B(Z,ne)?j.Huge:j.Gigantic:O(Z,ne)||Z.polymerResidueCount<ne.smallResidueCount*ie?j.Small:Z.polymerResidueCount<ne.mediumResidueCount*ie?j.Medium:j.Large}e.getSize=U,e.Index=iu.createSimple("index","root"),e.MaxIndex=iu.createSimple("max_index","root");let z="__PrincipalAxes__";function $(Z){if(Z.currentPropertyData[z])return Z.currentPropertyData[z];let J=ce.Loci.getPrincipalAxes(e.toStructureElementLoci(Z));return Z.currentPropertyData[z]=J,J}e.getPrincipalAxes=$})(qe||(qe={}));var YFe=rs.diff;function ey(e,t){return{kind:"element-loci",structure:e,elements:t}}(function(e){function t($){return!!$&&$.kind==="element-loci"}e.is=t;function r($,Z){if($.structure!==Z.structure||$.elements.length!==Z.elements.length)return!1;for(let J=0,ie=$.elements.length;J<ie;++J){let ne=$.elements[J],le=Z.elements[J];if(ne.unit.id!==le.unit.id||!Ge.areEqual(ne.indices,le.indices))return!1}return!0}e.areEqual=r;function n($){for(let Z of $.elements)if(Ge.size(Z.indices)>0)return!1;return!0}e.isEmpty=n;function o($){return i($)===$.structure.elementCount}e.isWholeStructure=o;function i($){let Z=0;for(let{indices:J}of $.elements)typeof J=="number"?Z+=YFe(J):Z+=J.length;return Z}e.size=i;function s($){return e($,$.units.map(Z=>({unit:Z,indices:Ge.ofBounds(0,Z.elements.length)})))}e.all=s;function a($){return e($,[])}e.none=a;function l($,Z){if(n($))return;let J=$.elements[0].unit,ie=J.elements[Ge.getAt($.elements[0].indices,0)];return Z?(Z.structure=$.structure,Z.unit=$.elements[0].unit,Z.element=ie,Z):po.create($.structure,J,ie)}e.getFirstLocation=l;function c($){return n($)?$:e($.structure,[{unit:$.elements[0].unit,indices:Ge.ofSingleton(Ge.start($.elements[0].indices))}])}e.firstElement=c;function u($){return n($)?$:A(c($))}e.firstResidue=u;function d($){return n($)?$:E(c($))}e.firstChain=d;function m($){let Z=[];for(let J of $.elements){let{unit:ie,indices:ne}=J,le=new Int32Array(Ge.size(ne));Ge.forEach(ne,(ee,oe)=>le[oe]=ie.elements[ee]),Z.push(ie.getChild(Qe.ofSortedArray(le)))}return qe.create(Z,{parent:$.structure.parent})}e.toStructure=m;function p($,Z){if(e.isEmpty($))return;let J=po.create($.structure);for(let ie of $.elements){let{unit:ne,indices:le}=ie;J.unit=ne;let{elements:ee}=ie.unit;for(let oe=0,te=Ge.size(le);oe<te;oe++)J.element=ee[Ge.getAt(le,oe)],Z(J)}}e.forEachLocation=p;function h($,Z){if(Z===$.structure)return $;let J=[];return $.elements.forEach(ie=>{if(!Z.unitMap.has(ie.unit.id))return;let ne=Z.unitMap.get(ie.unit.id),le=Ge.indexedIntersect(ie.indices,ie.unit.elements,ne.elements);Ge.size(le)>0&&J.push({unit:ne,indices:le})}),e(Z,J)}e.remap=h;function f($,Z){if($.elements.length>Z.elements.length)return f(Z,$);if(e.isEmpty($))return Z;let J=new Map;for(let ne of $.elements)J.set(ne.unit.id,ne.indices);let ie=[];for(let ne of Z.elements)J.has(ne.unit.id)?(ie[ie.length]={unit:ne.unit,indices:Ge.union(J.get(ne.unit.id),ne.indices)},J.delete(ne.unit.id)):ie[ie.length]=ne;return J.forEach((ne,le)=>{ie[ie.length]={unit:$.structure.unitMap.get(le),indices:ne}}),e($.structure,ie)}e.union=f;function C($,Z){let J=new Map;for(let ne of Z.elements)J.set(ne.unit.id,ne.indices);let ie=[];for(let ne of $.elements)if(J.has(ne.unit.id)){let le=Ge.subtract(ne.indices,J.get(ne.unit.id));if(Ge.size(le)===0)continue;ie[ie.length]={unit:ne.unit,indices:le}}else ie[ie.length]=ne;return e($.structure,ie)}e.subtract=C;function g($,Z){let J=new Map;for(let ne of $.elements)J.set(ne.unit.id,ne.indices);let ie=[];for(let ne of Z.elements){if(!J.has(ne.unit.id))continue;let le=Ge.intersect(J.get(ne.unit.id),ne.indices);Ge.size(le)!==0&&(ie[ie.length]={unit:ne.unit,indices:le})}return e($.structure,ie)}e.intersect=g;function b($,Z){if($.elements.length>Z.elements.length)return b(Z,$);if(e.isEmpty($))return e.isEmpty(Z);let J=new Map;for(let ie of $.elements)J.set(ie.unit.id,ie.indices);for(let ie of Z.elements)if(J.has(ie.unit.id)&&Ge.areIntersecting(J.get(ie.unit.id),ie.indices))return!0;return!1}e.areIntersecting=b;function y($,Z){if(e.isEmpty($))return e.isEmpty(Z);let J=new Map;for(let ne of $.elements)J.set(ne.unit.id,ne.indices);let ie=!1;for(let ne of Z.elements)if(J.has(ne.unit.id))if(Ge.isSubset(J.get(ne.unit.id),ne.indices))ie=!0;else return!1;return ie}e.isSubset=y;function x($){return $.length>3&&Qe.isRange($)?Be.ofRange($[0],$[$.length-1]):Qe.ofSortedArray($)}function A($,Z){let J=[],ie=new Set;for(let ne of $.elements){if(_(ne)){J[J.length]=ne;continue}if(ne.unit.kind===0){let le=ne.unit.elements,ee=ne.unit.model.atomicHierarchy,{label_alt_id:oe}=ne.unit.model.atomicHierarchy.atoms,{index:te,offsets:X}=ee.residueAtomSegments,W=[],K=ne.indices,re=Ge.size(K),se=0;for(;se<re;){ie.clear();let me=le[Ge.getAt(K,se)],Y=te[me];for(ie.add(oe.value(me)),se++;se<re;){let ve=le[Ge.getAt(K,se)];if(te[ve]!==Y)break;ie.add(oe.value(ve)),se++}let ae=ie.has("");for(let ve=X[Y],ge=X[Y+1];ve<ge;ve++){let Se=Ge.indexOf(le,ve);if(Se>=0){let Ee=oe.value(ve);(!Z||ae||!Ee||ie.has(Ee))&&(W[W.length]=Se)}}}J[J.length]={unit:ne.unit,indices:x(W)}}else J[J.length]=ne}return e($.structure,J)}e.extendToWholeResidues=A;function v($){switch($.kind){case 0:return $.model.atomicHierarchy.chainAtomSegments;case 1:return $.model.coarseHierarchy.spheres.chainElementSegments;case 2:return $.model.coarseHierarchy.gaussians.chainElementSegments}}function _($){return $.unit.elements.length===Ge.size($.indices)}function I($,Z,J){let{index:ie}=v($),ne=$.elements,le=0;for(let oe=0,te=ne.length;oe<te;oe++){let X=ne[oe],W=ie[X];Z.has(W)&&le++}if(le===$.elements.length){J[J.length]={unit:$,indices:Be.ofBounds(0,le)};return}let ee=new Int32Array(le);le=0;for(let oe=0,te=ne.length;oe<te;oe++){let X=ne[oe],W=ie[X];Z.has(W)&&(ee[le++]=oe)}ee.length>0&&(J[J.length]={unit:$,indices:x(ee)})}function T($,Z,J,ie,ne){let{index:le}=v($.elements[0].unit),ee=new Set;for(let oe=Z;oe<J;oe++){let te=$.elements[oe],X=te.indices,W=te.unit.elements;for(let K=0,re=Ge.size(X);K<re;K++)ee.add(le[W[Ge.getAt(X,K)]])}if(ie){let oe=$.elements[0].unit;for(let te of $.structure.units)Le.areSameChainOperatorGroup(te,oe)&&I(te,ee,ne)}else for(let oe=Z;oe<J;oe++)I($.elements[oe].unit,ee,ne)}function E($){let Z=[];for(let J=0,ie=$.elements.length;J<ie;J++){let ne=$.elements[J];if(Le.Traits.is(ne.unit.traits,Le.Trait.Partitioned)){let le=J;for(;J<ie&&Le.areSameChainOperatorGroup($.elements[J].unit,ne.unit);)J++;let ee=J;J--,T($,le,ee,!0,Z)}else _(ne)?Z[Z.length]=ne:T($,J,J+1,!1,Z)}return e($.structure,Z)}e.extendToWholeChains=E;function w($){return`${$.unit.model.id}|${nt.entity.id($)}`}function S($){let Z=[],J=po.create($.structure),ie=new Set,{units:ne}=$.structure;for(let le=0,ee=$.elements.length;le<ee;le++){let oe=$.elements[le];J.unit=oe.unit,J.element=oe.unit.elements[0],ie.add(w(J))}for(let le=0,ee=ne.length;le<ee;++le){let oe=ne[le];if(J.unit=oe,J.element=oe.elements[0],ie.has(w(J))){let te=Ge.ofBounds(0,oe.elements.length);Z[Z.length]={unit:oe,indices:te}}}return e($.structure,Z)}e.extendToWholeEntities=S;function P($){let Z=[],J=new Set,{units:ie}=$.structure;for(let ne=0,le=$.elements.length;ne<le;ne++){let ee=$.elements[ne];J.add(ee.unit.model.id)}for(let ne=0,le=ie.length;ne<le;++ne){let ee=ie[ne];if(J.has(ee.model.id)){let oe=Ge.ofBounds(0,ee.elements.length);Z[Z.length]={unit:ee,indices:oe}}}return e($.structure,Z)}e.extendToWholeModels=P;function k($,Z){let J=[];for(let ie=0,ne=Ge.size(Z);ie<ne;++ie)J.push($[Ge.getAt(Z,ie)]);return Qe.ofSortedArray(J)}function L($,Z){return Qe.isRange($)&&Qe.areEqual($,Z)?Be.ofLength($.length):x(Qe.indicesOf($,Z))}function R($){let Z=[],J=new Map;for(let ie=0,ne=$.elements.length;ie<ne;ie++){let le=$.elements[ie],{model:ee}=le.unit,oe=k(le.unit.elements,le.indices);J.has(ee)?J.set(ee,Qe.union(oe,J.get(ee))):J.set(ee,oe)}for(let ie=0,ne=$.structure.units.length;ie<ne;++ie){let le=$.structure.units[ie],ee=J.get(le.model);if(!ee)continue;let oe=L(le.elements,ee);Ge.size(oe)&&(Z[Z.length]={unit:le,indices:oe})}return e($.structure,Z)}e.extendToAllInstances=R;function N($){let Z=[],J=new Set,{units:ie}=$.structure;for(let ne=0,le=$.elements.length;ne<le;ne++){let ee=$.elements[ne];J.add(ee.unit.conformation.operator.name)}for(let ne=0,le=ie.length;ne<le;++ne){let ee=ie[ne];if(J.has(ee.conformation.operator.name)){let oe=Ge.ofBounds(0,ee.elements.length);Z[Z.length]={unit:ee,indices:oe}}}return e($.structure,Z)}e.extendToWholeOperators=N;let F=new is("98"),H=D();function V($,Z){F.reset();for(let J of $.elements){let{indices:ie}=J,{elements:ne,conformation:le}=J.unit;for(let ee=0,oe=Ge.size(ie);ee<oe;ee++){let te=ne[Ge.getAt(ie,ee)];le.position(te,H),Z&&D.transformMat4(H,H,Z),F.includePositionRadius(H,le.r(te))}}F.finishedIncludeStep();for(let J of $.elements){let{indices:ie}=J,{elements:ne,conformation:le}=J.unit;for(let ee=0,oe=Ge.size(ie);ee<oe;ee++){let te=ne[Ge.getAt(ie,ee)];le.position(te,H),Z&&D.transformMat4(H,H,Z),F.radiusPositionRadius(H,le.r(te))}}return{box:F.getBox(),sphere:F.getSphere()}}e.getBoundary=V;let q=D();function Q($,Z,J=0){let ie=J;for(let ne of $.elements){let{indices:le}=ne,{elements:ee,conformation:oe}=ne.unit,te=Ge.size(le);for(let X=0;X<te;X++){let W=ee[Ge.getAt(le,X)];oe.position(W,q),D.toArray(q,Z,ie+X*3)}ie+=te*3}return Z}e.toPositionsArray=Q;function O($){let Z=i($),J=Q($,new Float32Array(3*Z));return gl.ofPositions(J)}e.getPrincipalAxes=O;function B($){let Z=0;$.forEach(ne=>{Z+=i(ne)});let J=new Float32Array(3*Z),ie=0;return $.forEach(ne=>{Q(ne,J,ie),ie+=i(ne)*3}),gl.ofPositions(J)}e.getPrincipalAxesMany=B;function j($,Z){return Le.isAtomic($)?$.model.atomicHierarchy.atomSourceIndex.value(Z):Z}function U($){if(e.isEmpty($))return ye.struct.generator.empty();let Z=$.structure.models,J=new Map;for(let oe of $.elements){let{indices:te}=oe,{elements:X}=oe.unit,W=oe.unit.conformation.operator.name,K;J.has(W)?K=J.get(W).xs:(K=vn.create(),J.set(W,{modelLabel:oe.unit.model.label,modelIndex:oe.unit.model.modelNum,xs:K}));for(let re=0,se=Ge.size(te);re<se;re++){let me=j(oe.unit,X[Ge.getAt(te,re)]);vn.add(K,me,me)}}let ie=[],ne=J.keys();for(;;){let oe=ne.next();if(oe.done)break;let te=J.get(oe.value);ie.push(z(oe.value,te.xs.array,Z.length>1,te.modelLabel,te.modelIndex))}let le=new Map;for(let oe=0,te=ie.length;oe<te;++oe){let X=ie[oe],K=`${wu(di(X.atom.ranges),di(X.atom.set))}|${X.entity?X.entity.modelLabel+X.entity.modelIndex:""}`;le.has(K)?le.get(K).chain.opName.push(...X.chain.opName):le.set(K,X)}let ee=[];return le.forEach(oe=>{let{ranges:te,set:X}=oe.atom,{opName:W}=oe.chain,K=ye.struct.atomProperty.core.operatorName(),re=ye.struct.atomProperty.core.sourceIndex(),se=[];X.length>0&&(se[se.length]=ye.core.set.has([ye.core.type.set(X),re]));for(let me=0,Y=te.length/2;me<Y;me++)se[se.length]=ye.core.rel.inRange([re,te[2*me],te[2*me+1]]);if(oe.entity){let{modelLabel:me,modelIndex:Y}=oe.entity;ee.push(ye.struct.generator.atomGroups({"atom-test":se.length>1?ye.core.logic.or(se):se[0],"chain-test":W.length>1?ye.core.set.has([ye.core.type.set(W),K]):ye.core.rel.eq([K,W[0]]),"entity-test":ye.core.logic.and([ye.core.rel.eq([ye.struct.atomProperty.core.modelLabel(),me]),ye.core.rel.eq([ye.struct.atomProperty.core.modelIndex(),Y])])}))}else ee.push(ye.struct.generator.atomGroups({"atom-test":se.length>1?ye.core.logic.or(se):se[0],"chain-test":W.length>1?ye.core.set.has([ye.core.type.set(W),K]):ye.core.rel.eq([K,W[0]])}))}),ye.struct.modifier.union([ee.length===1?ee[0]:ye.struct.combinator.merge(ee.map(oe=>ye.struct.modifier.union([oe])))])}e.toExpression=U;function z($,Z,J,ie,ne){_a(Z);let le=[],ee=[],oe=0,te=Z.length;for(;oe<te;){let X=oe;for(oe++;oe<te&&Z[oe-1]+1===Z[oe];)oe++;let W=oe;if(W-X>12)le[le.length]=Z[X],le[le.length]=Z[W-1];else for(let K=X;K<W;K++)ee[ee.length]=Z[K]}return J?{atom:{set:ee,ranges:le},chain:{opName:[$]},entity:{modelLabel:ie,modelIndex:ne}}:{atom:{set:ee,ranges:le},chain:{opName:[$]}}}})(ey||(ey={}));var JV;(function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:po.create(void 0),firstConformationLoc:po.create(void 0),firstResidueLoc:po.create(void 0),firstChainLoc:po.create(void 0),firstUnitLoc:po.create(void 0),firstStructureLoc:po.create(void 0)}}e.create=t;function r(l,c,u){let d=l.get(c)||0;l.set(c,d+u)}function n(l,c,u){let{indices:d,unit:m}=u,{elements:p}=m,h=Ge.size(d),f=new Map,C=new Map;if(h>0&&po.set(l.firstElementLoc,c,m,p[Ge.start(d)]),h===p.length)l.unitCount+=1,l.unitCount===1&&po.set(l.firstUnitLoc,c,m,p[Ge.start(d)]);else if(h===1){if(Le.Traits.is(m.traits,Le.Trait.MultiChain))return;l.elementCount+=1,l.elementCount===1&&po.set(l.firstElementLoc,c,m,p[Ge.start(d)])}else if(Le.isAtomic(m)){let{index:g,offsets:b}=m.model.atomicHierarchy.residueAtomSegments,{label_alt_id:y}=m.model.atomicHierarchy.atoms,x=0;for(;x<h;){f.clear();let A=0,v=p[Ge.getAt(d,x)],_=g[v];for(r(f,y.value(v),1),++x,++A;x<h;){let I=p[Ge.getAt(d,x)];if(g[I]!==_)break;r(f,y.value(I),1),++x,++A}if(b[_+1]-b[_]===A)l.residueCount+=1,l.residueCount===1&&po.set(l.firstResidueLoc,c,m,b[_]);else{C.clear();for(let I=b[_],T=b[_+1];I<T;++I)r(C,y.value(I),1);C.get("")===f.get("")&&f.forEach((I,T)=>{if(C.get(T)===I){if(T!==""&&(l.conformationCount+=1,l.conformationCount===1)){for(let E=b[_],w=b[_+1];E<w;++E)if(T===y.value(E)){po.set(l.firstConformationLoc,c,m,E);break}}A-=I}}),l.elementCount+=A}}}else l.elementCount+=h,l.elementCount===1&&po.set(l.firstElementLoc,c,m,p[Ge.start(d)])}function o(l,c,u){let{indices:d,unit:m}=u,p=Ge.size(d);if(p===0)return;let{elements:h}=m;if(!Le.Traits.is(m.traits,Le.Trait.MultiChain)){p===h.length&&(l.chainCount+=1,l.chainCount===1&&po.set(l.firstChainLoc,c,m,h[Ge.start(d)]));return}let f=Le.isAtomic(m)?m.model.atomicHierarchy.chainAtomSegments:Le.isSpheres(m)?m.model.coarseHierarchy.spheres.chainElementSegments:Le.isGaussians(m)?m.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!f)return;let{index:C,offsets:g}=f,b=0;for(;b<p;){let y=0,x=h[Ge.getAt(d,b)],A=C[x];for(++b,++y;b<p;){let v=h[Ge.getAt(d,b)];if(C[v]!==A)break;++b,++y}g[A+1]-g[A]===y?(l.chainCount+=1,l.chainCount===1&&po.set(l.firstChainLoc,c,m,g[A])):p===1&&(l.elementCount+=1,l.elementCount===1&&po.set(l.firstElementLoc,c,m,x))}}function i(l,c,u,d,m){let p=u[d],h=Le.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:Le.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:Le.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!h)return;let{index:f,offsets:C}=h,g=new Map;for(let y=d;y<m;y++){p=u[y];let{indices:x,unit:A}=p,v=Ge.size(x);if(v===0)continue;let{elements:_}=A;if(!Le.Traits.is(A.traits,Le.Trait.MultiChain)){let T=_[Ge.start(x)];r(g,f[T],_.length);continue}let I=0;for(;I<v;){let T=0,E=_[Ge.getAt(x,I)],w=f[E];for(++I,++T;I<v;){let S=_[Ge.getAt(x,I)];if(f[S]!==w)break;++I,++T}r(g,w,T)}}let b=-1;if(g.forEach((y,x)=>{C[x+1]-C[x]===y&&(l.chainCount+=1,l.chainCount===1&&(b=x))}),!(b<0))for(let y=d;y<m;y++){p=u[y];let{indices:x,unit:A}=p,v=Ge.size(x);if(v===0)continue;let{elements:_}=A,I=0;for(;I<v;){let T=_[Ge.getAt(x,I)];if(f[T]===b){po.set(l.firstChainLoc,c,A,T);return}}}}function s(l){let c=t();if(ey.isEmpty(l))return c;let u=!1;if(ey.isWholeStructure(l)){if(c.structureCount+=1,c.structureCount===1){let{unit:d,indices:m}=l.elements[0];po.set(c.firstStructureLoc,l.structure,d,d.elements[Ge.min(m)])}}else for(let d of l.elements)n(c,l.structure,d),Le.Traits.is(d.unit.traits,Le.Trait.Partitioned)?u=!0:o(c,l.structure,d);if(u)for(let d=0,m=l.elements.length;d<m;d++){let p=l.elements[d];if(!Le.Traits.is(p.unit.traits,Le.Trait.Partitioned))continue;let h=d;for(;d<m&&Le.areSameChainOperatorGroup(l.elements[d].unit,p.unit);)d++;let f=d;d--,f-h===1?o(c,l.structure,p):i(c,l.structure,l.elements,h,f)}return c}e.ofLoci=s;function a(l,c,u){return c.elementCount===1&&u.elementCount===0?po.copy(l.firstElementLoc,c.firstElementLoc):c.elementCount===0&&u.elementCount===1&&po.copy(l.firstElementLoc,u.firstElementLoc),c.conformationCount===1&&u.conformationCount===0?po.copy(l.firstConformationLoc,c.firstConformationLoc):c.conformationCount===0&&u.conformationCount===1&&po.copy(l.firstConformationLoc,u.firstConformationLoc),c.residueCount===1&&u.residueCount===0?po.copy(l.firstResidueLoc,c.firstResidueLoc):c.residueCount===0&&u.residueCount===1&&po.copy(l.firstResidueLoc,u.firstResidueLoc),c.chainCount===1&&u.chainCount===0?po.copy(l.firstChainLoc,c.firstChainLoc):c.chainCount===0&&u.chainCount===1&&po.copy(l.firstChainLoc,u.firstChainLoc),c.unitCount===1&&u.unitCount===0?po.copy(l.firstUnitLoc,c.firstUnitLoc):c.unitCount===0&&u.unitCount===1&&po.copy(l.firstUnitLoc,u.firstUnitLoc),c.structureCount===1&&u.structureCount===0?po.copy(l.firstStructureLoc,c.firstStructureLoc):c.structureCount===0&&u.structureCount===1&&po.copy(l.firstStructureLoc,u.firstStructureLoc),l.elementCount=c.elementCount+u.elementCount,l.conformationCount=c.conformationCount+u.conformationCount,l.residueCount=c.residueCount+u.residueCount,l.chainCount=c.chainCount+u.chainCount,l.unitCount=c.unitCount+u.unitCount,l.structureCount=c.structureCount+u.structureCount,l}e.add=a})(JV||(JV={}));function QFe(e){return e}function die(e){throw new Error(`Property only available for ${e} models.`)}function JFe(e){return t=>Le.isAtomic(t.unit)?e(t):die("atomic")}function eOe(e){return t=>Le.isCoarse(t.unit)?e(t):die("coarse")}function tOe(e){return Le.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function rOe(e){return Le.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function nOe(e){return nt.entity.key(e)}var Hu;(function(e){function t(n){let o=n.descriptor.name,i=n.type==="static"?"_staticPropertyData":"_dynamicPropertyData",s=l=>(o in l[i]||(l[i][o]={props:{...M.getDefaultValues(n.getParams(l))},data:Af.create(void 0)}),l[i][o]),a=(l,c,u)=>{let d=s(l);l[i][o]={props:c,data:Af.withValue(d.data,u)}};return{label:n.label,descriptor:n.descriptor,isHidden:n.isHidden,getParams:l=>{let c=M.clone(n.getParams(l));return M.setDefaultValues(c,s(l).props),c},defaultParams:n.defaultParams,isApplicable:n.isApplicable,attach:async(l,c,u={},d)=>{d&&c.customProperties.reference(n.descriptor,!0);let m=s(c),p=M.merge(n.defaultParams,m.props,u);if(m.data.value&&M.areEqual(n.defaultParams,m.props,p))return;let{value:h,assets:f}=await n.obtain(l,c,p);c.customProperties.add(n.descriptor),c.customProperties.assets(n.descriptor,f),a(c,p,h)},ref:(l,c)=>l.customProperties.reference(n.descriptor,c),get:l=>{var c;return(c=s(l))===null||c===void 0?void 0:c.data},set:(l,c={},u)=>{let d=s(l),m=M.merge(n.defaultParams,d.props,c);M.areEqual(n.defaultParams,d.props,m)||(a(l,m,u),l.customProperties.assets(n.descriptor))},props:l=>s(l).props}}e.createProvider=t;function r(n,o,i){let s={value:M.Value(i,{isHidden:!0})};return t({label:Ms(n),descriptor:Ci({name:n}),isHidden:!0,type:o,defaultParams:s,getParams:()=>({value:M.Value(i,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(a,l,c)=>({...M.getDefaultValues(s),...c})})}e.createSimple=r})(Hu||(Hu={}));var ic;(function(e){e.Provider=Hu.createProvider({label:"SIFTS Mapping",descriptor:Ci({name:"sifts_sequence_mapping"}),type:"static",defaultParams:{},getParams:()=>({}),isApplicable:i=>t(i),obtain:async(i,s)=>({value:o(s)})});function t(i){if(!qr.is(i.sourceData))return!1;let{pdbx_sifts_xref_db_name:s,pdbx_sifts_xref_db_acc:a,pdbx_sifts_xref_db_num:l,pdbx_sifts_xref_db_res:c}=i.sourceData.data.db.atom_site;return s.isDefined&&a.isDefined&&l.isDefined&&c.isDefined}e.isAvailable=t;function r(i){let s=i.unit.model,a=e.Provider.get(s).value;if(!a)return"";let l=s.atomicHierarchy.residueAtomSegments.index[i.element];return a.accession[l]}e.getKey=r;function n(i){let s=i.unit.model,a=e.Provider.get(s).value;if(!a)return;let l=s.atomicHierarchy.residueAtomSegments.index[i.element],c=a.dbName[l];if(c)return`${c} ${a.accession[l]} ${a.num[l]} ${a.residue[l]}`}e.getLabel=n;function o(i){if(!qr.is(i.sourceData))return;let{pdbx_sifts_xref_db_name:s,pdbx_sifts_xref_db_acc:a,pdbx_sifts_xref_db_num:l,pdbx_sifts_xref_db_res:c}=i.sourceData.data.db.atom_site;if(!s.isDefined||!a.isDefined||!l.isDefined||!c.isDefined)return;let{atomSourceIndex:u}=i.atomicHierarchy,{count:d,offsets:m}=i.atomicHierarchy.residueAtomSegments,p=new Array(d),h=new Array(d),f=new Array(d),C=new Array(d);for(let g=0;g<d;g++){let b=u.value(m[g]);if(s.valueKind(b)!==0){p[g]="",h[g]="",f[g]="",C[g]="";continue}p[g]=s.value(b),h[g]=a.value(b),f[g]=l.value(b),C[g]=c.value(b)}return{dbName:p,accession:h,num:f,residue:C}}})(ic||(ic={}));var Z4t=fo.Field,jp=fo.Encodings;function oOe(e){let t=nt.chain.label_asym_id(e),r=e.unit.conformation.operator.suffix;return r?t+r:t}function iOe(e){let t=nt.chain.auth_asym_id(e),r=e.unit.conformation.operator.suffix;return r?t+r:t}var mie={shouldInclude(e){var t;return!!(!((t=e.atom_site)===null||t===void 0)&&t.pdbx_label_index.isDefined)},value(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_label_index.value(r)}},Sm={shouldInclude(e){return ic.isAvailable(e.structure.models[0])},pdbx_sifts_xref_db_name:{value(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_sifts_xref_db_name.value(r)},valueKind(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_sifts_xref_db_name.valueKind(r)}},pdbx_sifts_xref_db_acc:{value(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_sifts_xref_db_acc.value(r)},valueKind(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_sifts_xref_db_acc.valueKind(r)}},pdbx_sifts_xref_db_num:{value(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_sifts_xref_db_num.value(r)},valueKind(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_sifts_xref_db_num.valueKind(r)}},pdbx_sifts_xref_db_res:{value(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_sifts_xref_db_res.value(r)},valueKind(e,t){let r=t.sourceIndex.value(e.element);return t.atom_site.pdbx_sifts_xref_db_res.valueKind(r)}}},sOe=()=>fo.fields().str("group_PDB",nt.residue.group_PDB).index("id").str("type_symbol",nt.atom.type_symbol).str("label_atom_id",nt.atom.label_atom_id).str("label_comp_id",nt.atom.label_comp_id).int("label_seq_id",nt.residue.label_seq_id,{encoder:jp.deltaRLE,valueKind:(e,t)=>{let r=e.unit.model;return r.atomicHierarchy.residues.label_seq_id.valueKind(r.atomicHierarchy.residueAtomSegments.index[e.element])}}).str("label_alt_id",nt.atom.label_alt_id).str("pdbx_PDB_ins_code",nt.residue.pdbx_PDB_ins_code).str("label_asym_id",oOe).str("label_entity_id",nt.chain.label_entity_id).float("Cartn_x",nt.atom.x,{digitCount:3,encoder:jp.fixedPoint3}).float("Cartn_y",nt.atom.y,{digitCount:3,encoder:jp.fixedPoint3}).float("Cartn_z",nt.atom.z,{digitCount:3,encoder:jp.fixedPoint3}).float("occupancy",nt.atom.occupancy,{digitCount:2,encoder:jp.fixedPoint2}).float("B_iso_or_equiv",nt.atom.B_iso_or_equiv,{digitCount:2,encoder:jp.fixedPoint2}).int("pdbx_formal_charge",nt.atom.pdbx_formal_charge,{encoder:jp.deltaRLE,valueKind:(e,t)=>e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.valueKind(e.element)}).str("auth_atom_id",nt.atom.auth_atom_id).str("auth_comp_id",nt.atom.auth_comp_id).int("auth_seq_id",nt.residue.auth_seq_id,{encoder:jp.deltaRLE}).str("auth_asym_id",iOe).int("pdbx_PDB_model_num",nt.unit.model_num,{encoder:jp.deltaRLE}).int("pdbx_label_index",mie.value,{shouldInclude:mie.shouldInclude}).str("pdbx_sifts_xref_db_name",Sm.pdbx_sifts_xref_db_name.value,{shouldInclude:Sm.shouldInclude,valueKind:Sm.pdbx_sifts_xref_db_name.valueKind}).str("pdbx_sifts_xref_db_acc",Sm.pdbx_sifts_xref_db_acc.value,{shouldInclude:Sm.shouldInclude,valueKind:Sm.pdbx_sifts_xref_db_acc.valueKind}).str("pdbx_sifts_xref_db_num",Sm.pdbx_sifts_xref_db_num.value,{shouldInclude:Sm.shouldInclude,valueKind:Sm.pdbx_sifts_xref_db_num.valueKind}).str("pdbx_sifts_xref_db_res",Sm.pdbx_sifts_xref_db_res.value,{shouldInclude:Sm.shouldInclude,valueKind:Sm.pdbx_sifts_xref_db_res.valueKind}).getFields(),pie={name:"atom_site",instance({structures:e}){return{fields:sOe(),source:e.map(t=>({data:{structure:t,sourceIndex:t.model.atomicHierarchy.atomSourceIndex,atom_site:qr.is(t.model.sourceData)?t.model.sourceData.data.db.atom_site:void 0},rowCount:t.elementCount,keys:()=>t.elementLocations()}))}}};function Nb(e,t){return e?`${e}_${t}`:t}function aOe(e){return e?`pdbx_${e}_PDB_ins_code`:"pdbx_PDB_ins_code"}function Ig(e,t){return(r,n)=>t(e(r,n))}function lOe(e,t,r){r&&r.includeModelNum&&e.int("pdbx_PDB_model_num",Ig(t,nt.unit.model_num))}function $2(e,t){let r=t&&t.prefix,n=fo.fields().str(Nb(r,"label_comp_id"),Ig(e,nt.atom.label_comp_id)).int(Nb(r,"label_seq_id"),Ig(e,nt.residue.label_seq_id),{encoder:jp.deltaRLE,valueKind:(o,i)=>{let s=e(o,i),a=s.unit.model;return a.atomicHierarchy.residues.label_seq_id.valueKind(a.atomicHierarchy.residueAtomSegments.index[s.element])}}).str(aOe(r),Ig(e,nt.residue.pdbx_PDB_ins_code)).str(Nb(r,"label_asym_id"),Ig(e,nt.chain.label_asym_id)).str(Nb(r,"label_entity_id"),Ig(e,nt.chain.label_entity_id)).str(Nb(r,"auth_comp_id"),Ig(e,nt.atom.auth_comp_id)).int(Nb(r,"auth_seq_id"),Ig(e,nt.residue.auth_seq_id),{encoder:jp.deltaRLE}).str(Nb(r,"auth_asym_id"),Ig(e,nt.chain.auth_asym_id));return lOe(n,e,t),n.getFields()}var oy=fo.Field,fie={name:"struct_conf",instance(e){let t=gie(e,"helix");return{fields:uOe(),source:[{data:t,rowCount:t.length}]}}},hie={name:"struct_sheet_range",instance(e){let t=gie(e,"sheet").sort(cOe);return{fields:dOe(),source:[{data:t,rowCount:t.length}]}}};function cOe(e,t){let r=e.element,n=t.element;return r.sheet_id<n.sheet_id?-1:r.sheet_id===n.sheet_id?e.start.element-t.start.element:1}var uOe=()=>[oy.str("conf_type_id",(e,t)=>t[e].element.type_id),oy.str("id",(e,t,r)=>`${t[e].element.type_id}${r+1}`),...$2((e,t)=>t[e].start,{prefix:"beg"}),...$2((e,t)=>t[e].end,{prefix:"end"}),oy.str("pdbx_PDB_helix_class",(e,t)=>t[e].element.helix_class),oy.str("details",(e,t)=>t[e].element.details||"",{valueKind:(e,t)=>t[e].element.details?0:2}),oy.int("pdbx_PDB_helix_length",(e,t)=>t[e].length)],dOe=()=>[oy.str("sheet_id",(e,t)=>t[e].element.sheet_id),oy.index("id"),...$2((e,t)=>t[e].start,{prefix:"beg"}),...$2((e,t)=>t[e].end,{prefix:"end"}),oy.str("symmetry",(e,t)=>"",{valueKind:(e,t)=>2})];function gie(e,t){let r=Hp.Provider.get(e.firstModel);if(!r)return[];let{key:n,elements:o}=r,i=[],s=e.structures[0];for(let{units:a}of s.unitSymmetryGroups){let l=a[0];if(!Le.isAtomic(l))continue;let c=l.model.atomicHierarchy.residueAtomSegments,u=Vt.transientSegments(c,l.elements),d,m=!0;for(;u.hasNext;){m&&(d=u.move());let p=d.index,h=n[p],f=o[h];if(f.kind!==t){m=!0;continue}let C=p;for(;u.hasNext;)if(C=d.index,d=u.move(),h!==n[d.index]){m=!1,i[i.length]={start:ce.Location.create(s,l,c.offsets[p]),end:ce.Location.create(s,l,c.offsets[C]),length:C-p+1,element:f};break}}}return i}function Fb(e,t){if(qr.is(e.sourceData))return e.sourceData.data.db[t]}function gD(e){return $n.unionMany(...e.map(t=>t.uniqueResidueNames))}function yie(e){if(e.length===0)return new Set;let t=e[0].model.entities.data.id;return new Set(eG(e).map(r=>t.value(r)))}function eG(e){if(e.length===0)return[];if(e.length===1)return e[0].entityIndices;let t=vn.create();for(let r of e)for(let n of r.entityIndices)vn.add(t,n,n);return _a(t.array),t.array}function Pd(e,t){return{name:e,instance({structures:r}){if(t&&!t(r[0]))return fo.Category.Empty;let n=r[0].model;if(!qr.is(n.sourceData))return fo.Category.Empty;let o=n.sourceData.data.db[e];return!o||!o._rowCount?fo.Category.Empty:fo.Category.ofTable(o)}}}var iy=fo.Category,vie={name:"chem_comp",instance({firstModel:e,structures:t,cache:r}){let n=Fb(t[0].model,"chem_comp");if(!n)return iy.Empty;let{id:o}=n,i=r.uniqueResidueNames||(r.uniqueResidueNames=gD(t)),s=ue.indicesOf(o,a=>i.has(a));return iy.ofTable(n,s)}},bie={name:"chem_comp_bond",instance({firstModel:e,structures:t,cache:r}){let n=Fb(t[0].model,"chem_comp_bond");if(!n)return iy.Empty;let{comp_id:o}=n,i=r.uniqueResidueNames||(r.uniqueResidueNames=gD(t)),s=ue.indicesOf(o,a=>i.has(a));return iy.ofTable(n,s)}},xie={name:"pdbx_chem_comp_identifier",instance({firstModel:e,structures:t,cache:r}){let n=Fb(e,"pdbx_chem_comp_identifier");if(!n)return iy.Empty;let{comp_id:o}=n,i=r.uniqueResidueNames||(r.uniqueResidueNames=gD(t)),s=ue.indicesOf(o,a=>i.has(a));return iy.ofTable(n,s)}},Cie={name:"pdbx_nonpoly_scheme",instance({firstModel:e,structures:t,cache:r}){let n=Fb(e,"pdbx_nonpoly_scheme");return n?iy.ofTable(n):iy.Empty}};var Sie=fo.Category,Iie=tG("struct_asym"),Aie=tG("entity_poly"),wie=tG("entity_poly_seq");function tG(e){return{name:e,instance({structures:t,cache:r}){return mOe(t,e,r)}}}function mOe(e,t,r){let n=Fb(e[0].model,t);if(!n)return Sie.Empty;let{entity_id:o}=n,i=r.uniqueEntityIds||(r.uniqueEntityIds=yie(e)),s=ue.indicesOf(o,a=>i.has(a));return Sie.ofTable(n,s)}var Tie={molstar_atom_site_operator_mapping:{label_asym_id:ue.Schema.Str(),auth_asym_id:ue.Schema.Str(),operator_name:ue.Schema.Str(),suffix:ue.Schema.Str(),assembly_id:ue.Schema.Str(),assembly_operator_id:ue.Schema.Int(),symmetry_operator_index:ue.Schema.Int(),symmetry_hkl:ue.Schema.Vector(3),ncs_id:ue.Schema.Int()}},_ie=(e,t)=>typeof t[e].operator.assembly>"u"?1:0,rG=(e,t)=>t[e].operator.spgrOp===-1?1:0,S5t=fo.fields().str("label_asym_id",(e,t)=>t[e].label_asym_id).str("auth_asym_id",(e,t)=>t[e].auth_asym_id).str("operator_name",(e,t)=>t[e].operator.name).str("suffix",(e,t)=>t[e].operator.suffix).str("assembly_id",(e,t)=>{var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.id)||""},{valueKind:_ie}).int("assembly_operator_id",(e,t)=>{var r;return((r=t[e].operator.assembly)===null||r===void 0?void 0:r.operId)||0},{valueKind:_ie}).int("symmetry_operator_index",(e,t)=>t[e].operator.spgrOp,{valueKind:rG}).vec("symmetry_hkl",[(e,t)=>t[e].operator.hkl[0],(e,t)=>t[e].operator.hkl[1],(e,t)=>t[e].operator.hkl[2]],{valueKind:rG}).int("ncs_id",(e,t)=>t[e].operator.ncsId,{valueKind:rG}).getFields();var pOe=fo.Category,Eie;(function(e){function t(r){let n=Array.isArray(r)?r:[r];return{structures:n,firstModel:n[0].model,cache:Object.create(null)}}e.create=t})(Eie||(Eie={}));var fOe={name:"entity",instance({structures:e}){let t=eG(e);return pOe.ofTable(e[0].model.entities.data,t)}};function oG(e){return e.units.every(t=>t.conformation.operator.isIdentity)}function nG(e){return oG(e)&&e.units.every(t=>!t.conformation.operator.assembly&&!t.conformation.operator.suffix)}var L5t=[Pd("entry"),Pd("exptl"),fOe,Pd("cell",oG),Pd("symmetry",oG),Pd("pdbx_struct_assembly",nG),Pd("pdbx_struct_assembly_gen",nG),Pd("pdbx_struct_oper_list",nG),fie,hie,Iie,Aie,wie,Pd("pdbx_entity_branch"),Pd("pdbx_entity_branch_link"),Pd("pdbx_branch_scheme"),Pd("struct_conn"),vie,bie,xie,Pd("atom_sites"),Cie,pie],Pie;(function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])})(Pie||(Pie={}));var Die;(function(e){function t(d,m,p){if(!m)return{rowCount:0};if(p&&p[m.id])return p[m.id];let h=m.getElements(d),f={data:h,rowCount:h.elements.length};return p&&(p[m.id]=f),f}e.getCifDataSource=t;function r(d){return new yD(d)}e.fromAtomMap=r;function n(d){return new yD(iG(d))}e.fromAtomArray=n;let o=d=>d.atomicHierarchy.residueAtomSegments;function i(d){return new TC("residue",d,o,0)}e.fromResidueMap=i;function s(d){return new TC("residue",iG(d),o,0)}e.fromResidueArray=s;let a=d=>d.atomicHierarchy.chainAtomSegments;function l(d){return new TC("chain",d,a,0)}e.fromChainMap=l;function c(d){return new TC("chain",iG(d),a,0)}e.fromChainArray=c;function u(d){return new sG(d)}e.fromEntityMap=u})(Die||(Die={}));function iG(e){let t=new Map;for(let r=0,n=e.length;r<n;r++)t.set(r,e[r]);return t}var TC=class{has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){let r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");let n=new Set,o=t.unitSymmetryGroups,i=[],s=this.segmentGetter(r[0]);for(let a of o){let l=a.units[0];if(l.kind!==this.kind)continue;let c=Vt.transientSegments(s,l.elements);for(;c.hasNext;){let u=c.move();!this.has(u.index)||n.has(u.index)||(n.add(u.index),i[i.length]=ce.Location.create(t,l,l.elements[u.start]))}}return i.sort((a,l)=>a.element-l.element),i}getElements(t){let r=this.segmentGetter(t.model).index,n=this.getStructureElements(t);return{elements:n,property:o=>this.get(r[n[o].element])}}constructor(t,r,n,o){this.level=t,this.map=r,this.segmentGetter=n,this.id=jr.create22(),this.kind=o}},yD=class{has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){if(t.models.length!==1)throw new Error("Only works on structures with a single model.");let n=new Set,o=t.unitSymmetryGroups,i=[];for(let s of o){let a=s.units[0];if(a.kind!==this.kind)continue;let l=a.elements;for(let c=0,u=l.length;c<u;c++){let d=l[c];!this.has(d)||n.has(d)||(n.add(l[c]),i[i.length]=ce.Location.create(t,a,d))}}return i.sort((s,a)=>s.element-a.element),i}getElements(t){let r=this.getStructureElements(t);return{elements:r,property:n=>this.get(r[n].element)}}constructor(t){this.map=t,this.id=jr.create22(),this.level="atom",this.kind=0}},sG=class{has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){let r=t.models;if(r.length!==1)throw new Error("Only works on structures with a single model.");let n=r[0].atomicHierarchy.index,o=new Set,i=t.unitSymmetryGroups,s=[],a=r[0].atomicHierarchy.chainAtomSegments;for(let l of i){let c=l.units[0];if(c.kind!==this.kind)continue;let u=Vt.transientSegments(a,c.elements);for(;u.hasNext;){let d=u.move(),m=n.getEntityFromChain(d.index);!this.has(m)||o.has(m)||(o.add(m),s[s.length]=ce.Location.create(t,c,c.elements[d.start]))}}return s.sort((l,c)=>l.element-c.element),s}getElements(t){let r=this.getStructureElements(t),n=t.model.atomicHierarchy.chainAtomSegments.index,o=t.model.atomicHierarchy.index;return{elements:r,property:i=>this.get(o.getEntityFromChain(n[r[i].element]))}}constructor(t){this.map=t,this.id=jr.create22(),this.level="entity",this.kind=0}};var sc=class{getFrameAtIndex(t){return this.frames[t]}constructor(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}};function kie(e,t,r){if(!e._rowCount)return[];let n=yOe(r),o=[];for(let i=0;i<e._rowCount;i++)o[o.length]=hOe(e,t,i,n);return o}function hOe(e,t,r,n){let o=e.id.value(r),i=e.details.value(r),s=[],{assembly_id:a,oper_expression:l,asym_id_list:c}=t;for(let u=0,d=t._rowCount;u<d;u++)a.value(u)===o&&(s[s.length]={assemblyId:o,expression:l.value(u),asymIds:c.value(u)});return vC.create(o,i,gOe(s,n))}function gOe(e,t){return()=>{let r=[],n=0;for(let o=0;o<e.length;o++){let i=e[o],s=xOe(i.expression),a=vOe(s),l=bOe(t,a,n,i.assemblyId),c=Pn.generators.atoms({chainTest:Pn.pred.and(Pn.pred.eq(u=>nt.unit.operator_name(u.element),eo.DefaultName),Pn.pred.inSet(u=>nt.chain.label_asym_id(u.element),i.asymIds))});r[r.length]={selector:c,operators:l,asymIds:i.asymIds},n+=l.length}return r}}function yOe(e){let{id:t,matrix:r,vector:n,_schema:o}=e,i=new Map,s=D();for(let a=0,l=e._rowCount;a<l;a++){let c=cr.toMat4(de(),o.matrix.space,r.value(a));cr.toVec3(s,o.vector.space,n.value(a)),de.setTranslation(c,s),de.setValue(c,3,3,1),i.set(t.value(a),c)}return i}function vOe(e){let t=[],r=[];for(let n=0;n<e.length;n++)r[n]="";return Mie(e,t,e.length-1,r),t}function Mie(e,t,r,n){if(r<0){t[t.length]=n.slice(0);return}let o=e[r],i=o.length;for(let s=0;s<i;s++)n[r]=o[s],Mie(e,t,r-1,n)}function bOe(e,t,r,n){let o=[],i=r;for(let s of t){let a=de.identity();for(let l=0;l<s.length;l++)de.mul(a,a,e.get(s[l]));i++,o[o.length]=eo.create(`ASM_${i}`,a,{assembly:{id:n,operId:i,operList:s}})}return o}function xOe(e){let t=/\(?([^\(\)]+)\)?]*/g,r=[],n=[],o;for(;o=t.exec(e);)r[r.length]=o[1];return r.forEach(i=>{let s=[];i.split(",").forEach(a=>{let l=a.indexOf("-");if(l>0){let c=parseInt(a.substring(0,l)),u=parseInt(a.substr(l+1));for(let d=c;d<=u;d++)s[s.length]=d.toString()}else s[s.length]=a.trim()}),n[n.length]=s}),n}var _o;(function(e){e.Descriptor={name:"model_symmetry"},e.Provider=ea.create(e.Descriptor);function t(n){let o=kie(n.pdbx_struct_assembly,n.pdbx_struct_assembly_gen,n.pdbx_struct_oper_list),i=IOe(n.symmetry,n.cell),s=COe(n.atom_sites,i);return{assemblies:o,spacegroup:i,isNonStandardCrystalFrame:s,ncsOperators:AOe(n.struct_ncs_oper)}}e.fromData=t;function r(n,o){let i=Ni.create("P 1",n,o),s=ha.create(i);return{assemblies:[],spacegroup:s,isNonStandardCrystalFrame:!1}}e.fromCell=r})(_o||(_o={}));function COe(e,t){return e._rowCount===0,!1}function SOe(e){let t=e.Int_Tables_number.value(0),r=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?r:t:r}function IOe(e,t){if(e._rowCount===0||t._rowCount===0)return ha.ZeroP1;let r=t.length_a.value(0),n=t.length_b.value(0),o=t.length_c.value(0);if(r===0||n===0||o===0)return ha.ZeroP1;let i=t.angle_alpha.value(0),s=t.angle_beta.value(0),a=t.angle_gamma.value(0);if(i===0||s===0||a===0)return ha.ZeroP1;let l=SOe(e),c=Ni.create(l,D.create(r,n,o),D.scale(D(),D.create(i,s,a),Math.PI/180));return ha.create(c)}function AOe(e){if(e._rowCount===0)return;let{id:t,matrix:r,vector:n}=e,o=Wr.struct_ncs_oper.matrix.space,i=Wr.struct_ncs_oper.vector.space,s=[];for(let a=0;a<e._rowCount;a++){let l=cr.toMat3(nr(),o,r.value(a)),c=cr.toVec3(D(),i,n.value(a));if(!eo.checkIfRotationAndTranslation(l,c)||e.code.value(a)==="given"&&!nr.isIdentity(l)&&!D.isZero(c))continue;let u=t.value(a);s[s.length]=eo.ofRotationAndOffset(`ncs_${u}`,l,c,u)}return s}var wOe={U:Wr.atom_site_anisotrop.U,U_esd:Wr.atom_site_anisotrop.U_esd},ju;(function(e){e.Schema=wOe,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance(n){return e.Provider.get(n.firstModel)?qr.is(n.firstModel.sourceData)?fo.Category.ofTable(n.firstModel.sourceData.data.db.atom_site_anisotrop):fo.Category.Empty:fo.Category.Empty}}]}},e.Provider=ea.create(e.Descriptor);function t(n,o){let i=new Int32Array(n.rowCount);i.fill(-1);for(let a=0,l=n.rowCount;a<l;a++)i[n.value(a)]=a;let s=new Int32Array(n.rowCount);s.fill(-1);for(let a=0,l=o.rowCount;a<l;++a){let c=i[o.value(a)];c!==-1&&(s[c]=a)}return s}e.getElementToAnsiotrop=t;function r(n,o){let i={};for(let a=0,l=n.rowCount;a<l;a++)i[n.value(a)]=a;let s=new Int32Array(n.rowCount);s.fill(-1);for(let a=0,l=o.rowCount;a<l;++a){let c=i[o.value(a)];c!==void 0&&(s[c]=a)}return s}e.getElementToAnsiotropFromLabel=r})(ju||(ju={}));var Zf;(function(e){let t="molstar_global_model_transform_info";e.Schema={[t]:{matrix:ue.Schema.Matrix(4,4,ue.Schema.float)}},e.Descriptor=Ci({name:t,cifExport:{categories:[{name:t,instance(a){let l=n(a.firstModel);if(!l)return fo.Category.Empty;let c=gr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return fo.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=ea.create(e.Descriptor);function r(a,l){a.customProperties.has(e.Descriptor)||a.customProperties.add(e.Descriptor),e.Provider.set(a,l)}e.attach=r;function n(a){return e.Provider.get(a)}e.get=n;function o(a){if(!qr.is(a.sourceData))return;let l=a.sourceData.data.frame.categories[t];if(!l)return;let c=Gq(e.Schema[t],l);if(c._rowCount!==0)return c.matrix.value(0)}e.fromMmCif=o;function i(a){if(!qr.is(a.sourceData))return!1;let l=a.sourceData.data.frame.categories[t];return!!l&&l.rowCount>0}e.hasData=i;function s(a,l){a.writeCategory({name:t,instance(){let c=gr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return fo.Category.ofTable(c)}})}e.writeMmCif=s})(Zf||(Zf={}));function _Oe(e){if(qr.is(e.sourceData))return _o.fromData(e.sourceData.data.db)}_o.Provider.formatRegistry.add("mmCIF",_Oe);function TOe(e){if(!qr.is(e.sourceData))return;let{struct_conf:t,struct_sheet_range:r}=e.sourceData.data.db;return Hp.fromStruct(t,r,e.atomicHierarchy)}Hp.Provider.formatRegistry.add("mmCIF",TOe);function EOe(e){if(!qr.is(e.sourceData))return;let{atom_site_anisotrop:t}=e.sourceData.data.db,r=gr.ofColumns(ju.Schema,t),n=ju.getElementToAnsiotrop(e.atomicConformation.atomId,t.id);return{data:r,elementToAnsiotrop:n}}function POe(e){return qr.is(e.sourceData)?e.sourceData.data.db.atom_site_anisotrop.U.isDefined:!1}ju.Provider.formatRegistry.add("mmCIF",EOe,POe);function DOe(e){if(!qr.is(e.sourceData))return;let{chem_comp_bond:t}=e.sourceData.data.db;if(t._rowCount!==0)return{data:t,entries:xg.getEntriesFromChemCompBond(t)}}xg.Provider.formatRegistry.add("mmCIF",DOe);function kOe(e){if(!qr.is(e.sourceData))return;let{struct_conn:t}=e.sourceData.data.db;if(t._rowCount===0)return;let r=oc.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:oc.getAtomIndexFromEntries(r),entries:r}}oc.Provider.formatRegistry.add("mmCIF",kOe);Zf.Provider.formatRegistry.add("mmCIF",Zf.fromMmCif,Zf.hasData);var qr;(function(e){function t(n){return n?.kind==="mmCIF"}e.is=t;function r(n,o,i,s){return o||(o=Di.schema.mmCIF(n)),{kind:"mmCIF",name:o._name,data:{db:o,file:s,frame:n,source:i}}}e.fromFrame=r})(qr||(qr={}));function vD(e,t){let r=qr.fromFrame(e,void 0,void 0,t),n=as(r.data.db,!0);return ke.create("Create mmCIF Model",o=>va(n,r,o))}var W2;(function(e){let t="__CcdCoordinateType__";e.CoordinateType={get(o){return o._staticPropertyData[t]},set(o,i){return o._staticPropertyData[t]=i}};function r(o){return o?.kind==="CCD"}e.is=r;function n(o,i){return i||(i=Di.schema.CCD(o)),{kind:"CCD",name:i._name,data:{db:i,frame:o}}}e.fromFrame=n})(W2||(W2={}));function Bie(e){let t=W2.fromFrame(e);return ke.create("Create CCD Models",r=>MOe(t.data.db,W2.fromFrame(e),r))}async function MOe(e,t,r){let n=await Rie(e,t,{coordinateType:"ideal",cartn_x:"pdbx_model_Cartn_x_ideal",cartn_y:"pdbx_model_Cartn_y_ideal",cartn_z:"pdbx_model_Cartn_z_ideal"},r),o=await Rie(e,t,{coordinateType:"model",cartn_x:"model_Cartn_x",cartn_y:"model_Cartn_y",cartn_z:"model_Cartn_z"},r),i=[];n&&i.push(n),o&&i.push(o);for(let s=0,a=i.length;s<a;++s)Ut.TrajectoryInfo.set(i[s],{index:s,size:i.length});return new sc(i)}async function Rie(e,t,r,n){let{chem_comp:o,chem_comp_atom:i,chem_comp_bond:s}=e,{coordinateType:a,cartn_x:l,cartn_y:c,cartn_z:u}=r,d=o.name.value(0),m=o.id.value(0),{atom_id:p,charge:h,comp_id:f,pdbx_ordinal:C,type_symbol:g}=i,b=i._rowCount,y=[];for(let j=0;j<b;j++)i[l].valueKind(j)>0||(y[y.length]=j);let x=y.length,A=ue.ofConst("A",x,ue.Schema.str),v=ue.ofConst(1,x,ue.Schema.int),_=ue.ofConst("1",x,ue.Schema.str),I=ue.ofConst(1,x,ue.Schema.float),T=ue.ofConst(1,x,ue.Schema.int),E=ue.view(p,y),w=ue.view(f,y),S=ue.view(i[l],y),P=ue.view(i[c],y),k=ue.view(i[u],y),L=ue.view(C,y),R=ue.view(g,y),N=ue.view(h,y),F=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:A,auth_atom_id:E,auth_comp_id:w,auth_seq_id:v,Cartn_x:S,Cartn_y:P,Cartn_z:k,id:L,label_asym_id:A,label_atom_id:E,label_comp_id:w,label_seq_id:v,label_entity_id:_,occupancy:I,type_symbol:R,pdbx_PDB_model_num:T,pdbx_formal_charge:N},x),H=new qi;H.setNames([[m,`${d} (${a})`]]),H.getEntityId(m,0,"A");let V=new Is(v,g);V.setNames([[m,`${d} (${a})`]]),V.add(m,0);let q=as({entity:H.getEntityTable(),chem_comp:V.getChemCompTable(),atom_site:F}),Q=await va(q,t,n);if(!Q.representative)return;let O=Q.representative,B=xg.getEntriesFromChemCompBond(s);return xg.Provider.set(O,{data:s,entries:B}),W2.CoordinateType.set(O,a),Q.representative}var Ut;(function(e){function t(R,N){let F=[],{frames:H}=N,V=R.atomicHierarchy.atomSourceIndex,Q=ue.isIdentity(V)?void 0:V.toArray({array:Int32Array}),O=f(R),B=R.atomicHierarchy.atoms._rowCount;for(let j=0,U=H.length;j<U;++j){let z=H[j];if(z.elementCount!==B)throw new Error(`Frame element count mismatch, got ${z.elementCount} but expected ${B}.`);let $={...R,id:jr.create22(),modelNum:j,atomicConformation:ym.getAtomicConformation(z,{atomId:R.atomicConformation.atomId,occupancy:R.atomicConformation.occupancy,B_iso_or_equiv:R.atomicConformation.B_iso_or_equiv},Q),customProperties:new Ls,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)};if(z.cell){let Z=_o.fromCell(z.cell.size,z.cell.anglesInRadians);_o.Provider.set($,Z)}e.TrajectoryInfo.set($,{index:j,size:H.length}),e.CoarseGrained.set($,O),F.push($)}return{trajectory:F,srcIndexArray:Q}}function r(R,N){return new sc(t(R,N).trajectory)}e.trajectoryFromModelAndCoordinates=r;function n(R,N){return ke.create("Create Trajectory",async F=>{let H=await va(R.basic,R.sourceData,F);if(H.frameCount===0)throw new Error("found no model");let V=H.representative,{trajectory:q}=t(V,N),Q={pairs:R.bonds,count:V.atomicHierarchy.atoms._rowCount},O=Zi.fromData(Q),B=f(V),j=0;for(let U of q)Zi.Provider.set(U,O),e.TrajectoryInfo.set(U,{index:j++,size:q.length}),e.CoarseGrained.set(U,B);return new sc(q)})}e.trajectoryFromTopologyAndCoordinates=n;let o="__Center__";function i(R){if(R._dynamicPropertyData[o])return R._dynamicPropertyData[o];let N=Rne(R.atomicConformation,R.coarseConformation);return R._dynamicPropertyData[o]=N,N}e.getCenter=i;function s(R){let N=new Int32Array(R.rowCount),F=!1;for(let H=0,V=R.rowCount;H<V;H++){let q=R.value(H);q!==H&&(F=!1),N[q]=H}return{isIdentity:F,invertedIndex:N}}let a="__InvertedAtomSrcIndex__";function l(R){if(R._staticPropertyData[a])return R._staticPropertyData[a];let N=s(R.atomicHierarchy.atomSourceIndex);return R._staticPropertyData[a]=N,N}e.getInvertedAtomSourceIndex=l;let c="__TrajectoryInfo__";e.TrajectoryInfo={get(R){return R._dynamicPropertyData[c]||{index:0,size:1}},set(R,N){return R._dynamicPropertyData[c]=N}};let u="__AsymIdCount__";e.AsymIdCount={get(R){if(R._dynamicPropertyData[u])return R._dynamicPropertyData[u];let N=Bne(R);return R._dynamicPropertyData[u]=N,N}},e.AsymIdOffset=Hu.createSimple("asym_id_offset","static"),e.Index=Hu.createSimple("index","static"),e.MaxIndex=Hu.createSimple("max_index","static");function d(R){return R.parent||R}e.getRoot=d;function m(R,N){return R.atomicHierarchy===N.atomicHierarchy&&R.coarseHierarchy===N.coarseHierarchy}e.areHierarchiesEqual=m;let p="__CoordinatesHistory__";e.CoordinatesHistory={get(R){return R._staticPropertyData[p]},set(R,N){return R._staticPropertyData[p]=N}};let h="__CoarseGrained__";e.CoarseGrained={get(R){return R._staticPropertyData[h]},set(R,N){return R._staticPropertyData[h]=N}};function f(R){let N=e.CoarseGrained.get(R);if(N===void 0){let F=0,{polymerType:H}=R.atomicHierarchy.derived.residue;for(let B=0;B<H.length;++B)H[B]!==0&&(F+=1);let V=!1,q=!1,{label_atom_id:Q,_rowCount:O}=R.atomicHierarchy.atoms;for(let B=0;B<O;++B){let j=Q.value(B);if(!V&&j==="BB"&&(V=!0),!q&&j==="SC1"&&(q=!0),V&&q)break}N=V&&q||(F&&O?O/F<3:!1),e.CoarseGrained.set(R,N)}return N}e.isCoarseGrained=f;function C(R){return R.properties.saccharideComponentMap.size>0}e.hasCarbohydrate=C;function g(R){let{subtype:N}=R.entities;for(let F=0,H=N.rowCount;F<H;++F)if(N.value(F).startsWith("polypeptide"))return!0;return!1}e.hasProtein=g;function b(R){let{subtype:N}=R.entities;for(let F=0,H=N.rowCount;F<H;++F){let V=N.value(F);if(V.endsWith("ribonucleotide hybrid")||V.endsWith("ribonucleotide"))return!0}return!1}e.hasNucleic=b;function y(R){if(!qr.is(R.sourceData))return!1;let{db:N}=R.sourceData.data;for(let F=0,H=N.database_2.database_id.rowCount;F<H;++F)if(N.database_2.database_id.value(F)==="pdb")return!0;return!1}e.isFromPdbArchive=y;function x(R){return qr.is(R.sourceData)?R.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)!==null||R.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i)!==null:!1}e.hasPdbId=x;function A(R){if(qr.is(R.sourceData)){let{db:N}=R.sourceData.data;return N.struct_conf.id.isDefined||N.struct_sheet_range.id.isDefined}else return Hp.Provider.isApplicable(R)}e.hasSecondaryStructure=A;let v=D.create(1.5707963,1.5707963,1.5707963),_=D.create(1,1,1);function I(R){var N;let F=(N=_o.Provider.get(R))===null||N===void 0?void 0:N.spacegroup;return!!F&&!(F.num===1&&D.equals(F.cell.anglesInRadians,v)&&D.equals(F.cell.size,_))}e.hasCrystalSymmetry=I;function T(R){if(!qr.is(R.sourceData))return!1;let{db:N}=R.sourceData.data;for(let F=0;F<N.exptl.method.rowCount;F++)if(N.exptl.method.value(F).toUpperCase().indexOf("DIFFRACTION")>=0)return!0;return!1}e.isFromXray=T;function E(R){if(!qr.is(R.sourceData))return!1;let{db:N}=R.sourceData.data;for(let F=0;F<N.exptl.method.rowCount;F++)if(N.exptl.method.value(F).toUpperCase().indexOf("MICROSCOPY")>=0)return!0;return!1}e.isFromEm=E;function w(R){if(!qr.is(R.sourceData))return!1;let{db:N}=R.sourceData.data;for(let F=0;F<N.exptl.method.rowCount;F++)if(N.exptl.method.value(F).toUpperCase().indexOf("NMR")>=0)return!0;return!1}e.isFromNmr=w;function S(R){if(!qr.is(R.sourceData)||!T(R))return!1;let{db:N}=R.sourceData.data,{status_code_sf:F}=N.pdbx_database_status;return F.isDefined&&F.value(0)==="REL"}e.hasXrayMap=S;function P(R){if(!qr.is(R.sourceData))return!1;let{db:N}=R.sourceData.data,{db_name:F,content_type:H}=N.pdbx_database_related;for(let V=0,q=N.pdbx_database_related._rowCount;V<q;++V)if(F.value(V).toUpperCase()==="EMDB"&&H.value(V)==="associated EM volume")return!0;return!1}e.hasEmMap=P;function k(R){return qr.is(R.sourceData)?S(R)||P(R):!1}e.hasDensityMap=k;function L(R){if(!qr.is(R.sourceData))return!1;let{db:N}=R.sourceData.data;return k(R)||x(R)&&(!N.exptl.method.isDefined||T(R)&&(!N.pdbx_database_status.status_code_sf.isDefined||N.pdbx_database_status.status_code_sf.valueKind(0)===2)||E(R)&&!N.pdbx_database_related.db_name.isDefined)}e.probablyHasDensityMap=L})(Ut||(Ut={}));function Lie(e,t,r,n){let{label_comp_id:o,type_symbol:i,_rowCount:s}=e.atoms,{_rowCount:a}=e.residues,{offsets:l}=t.residueAtomSegments,c=new Uint8Array(s);for(let g=0;g<s;++g)c[g]=ry(i.value(g));let u=new Int32Array(a),d=new Int32Array(a),m=new Int32Array(a),p=new Uint8Array(a),h=new Uint8Array(a),f=new Map,C=new Map;for(let g=0;g<a;++g){let b=o.value(l[g]),y=n,x,A;if(f.has(b))x=f.get(b),A=C.get(b);else{let E;y.has(b)?E=y.get(b).type:E=_V(b),x=_c(E,b),A=Ine(E,x),f.set(b,x),C.set(b,A)}p[g]=x,h[g]=A;let v=$f(A,"trace"),_=r.findAtomsOnResidue(g,v);if(_===-1){let E=$f(A,"coarseBackbone");_=r.findAtomsOnResidue(g,E),_===-1&&K0(x)&&(_=r.findElementOnResidue(g,zp("C")))}u[g]=_;let I=$f(A,"directionFrom");d[g]=r.findAtomsOnResidue(g,I);let T=$f(A,"directionTo");m[g]=r.findAtomsOnResidue(g,T)}return{atom:{atomicNumber:c},residue:{traceElementIndex:u,directionFromElementIndex:d,directionToElementIndex:m,moleculeType:p,polymerType:h}}}function EC(e,t){return t?t.length===1?Ys(t.charCodeAt(0),e):t.length===2?Ys(t.charCodeAt(0),Ys(t.charCodeAt(1),e)):`${e} ${t}`:e}function ROe(e,t,r,n){if(e.has(t)){let o=e.get(t);o.has(r)||o.set(r,n)}else{let o=new Map;e.set(t,o),o.set(r,n)}}function BOe(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}function LOe(e,t,r){return{entities:e,segments:r,label_seq_id:Qe.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}var q2=aD.EmptyResidueKey(),cG=class{getEntityFromChain(t){return this.map.chain_index_entity_index[t]}findEntity(t){let r=this.map.label_asym_id.get(t);return r!==void 0?r:-1}findChainLabel(t){let r=this.entityIndex(t.label_entity_id);if(r<0||!this.map.entity_index_label_asym_id.has(r))return-1;let n=this.map.entity_index_label_asym_id.get(r);return n&&n.has(t.label_asym_id)?n.get(t.label_asym_id):-1}findChainAuth(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;let r=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return r.has(t.auth_seq_id)?r.get(t.auth_seq_id):-1}findResidue(t,r,n,o){let i;arguments.length===1?i=t:(q2.label_entity_id=t,q2.label_asym_id=r,q2.auth_seq_id=n,q2.pdbx_PDB_ins_code=o,i=q2);let s=this.findChainLabel(i);if(s<0)return-1;let a=this.map.chain_index_auth_seq_id.get(s),l=EC(i.auth_seq_id,i.pdbx_PDB_ins_code||"");return a.has(l)?a.get(l):-1}findResidueLabel(t){let r=this.findChainLabel(t);if(r<0)return-1;let n=this.map.chain_index_label_seq_id.get(r),o=EC(t.label_seq_id,t.pdbx_PDB_ins_code||"");return n.has(o)?n.get(o):-1}findResidueAuth(t){let r=this.findChainAuth(t);if(r<0)return-1;let n=this.map.chain_index_auth_seq_id.get(r),o=EC(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return n.has(o)?n.get(o):-1}findResidueInsertion(t){let r=this.findChainLabel(t);if(r<0)return-1;let n=this.map.chain_index_label_seq_id.get(r),o=EC(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(n.has(o))return n.get(o);let i=Qe.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),s=Wf.chainStartResidueIndex(this.map.segments,r);if(i<s)return s;let a=Wf.chainEndResidueIndexExcl(this.map.segments,r)-1;return i>=a?a:i}findAtom(t){let r=this.findResidue(t);return r<0?-1:typeof t.label_alt_id>"u"?aG(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,t.label_atom_id):lG(this.residueOffsets[r],this.residueOffsets[r+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)}findAtomAuth(t){let r=this.findResidueAuth(t);return r<0?-1:typeof t.label_alt_id>"u"?aG(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,t.auth_atom_id):lG(this.residueOffsets[r],this.residueOffsets[r+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)}findAtomOnResidue(t,r,n){return typeof n>"u"?aG(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r):lG(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,r,n)}findAtomsOnResidue(t,r){return NOe(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,r)}findElementOnResidue(t,r){return FOe(this.residueOffsets[t],this.residueOffsets[t+1],this.map.type_symbol,r)}constructor(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}};function aG(e,t,r,n){for(let o=e;o<t;o++)if(r.value(o)===n)return o;return-1}function NOe(e,t,r,n){for(let o=e;o<t;o++)if(n.has(r.value(o)))return o;return-1}function lG(e,t,r,n,o,i){for(let s=e;s<t;s++)if(r.value(s)===o&&n.value(s)===i)return s;return-1}function FOe(e,t,r,n){for(let o=e;o<t;o++)if(r.value(o)===n)return o;return-1}function Nie(e,t,r){let n=LOe(t,e,r),{label_seq_id:o,auth_seq_id:i,pdbx_PDB_ins_code:s}=e.residues,{label_entity_id:a,label_asym_id:l,auth_asym_id:c}=e.chains,u=Be.ofBounds(0,e.atoms._rowCount),d=Vt.transientSegments(r.chainAtomSegments,u);for(;d.hasNext;){let m=d.move(),p=m.index,h=t.getEntityIndex(a.value(p));h<0&&BOe(a.value(p)),n.chain_index_entity_index[p]=h;let f=c.value(p),C=n.auth_asym_id_auth_seq_id.get(f);C||(C=new Map,n.auth_asym_id_auth_seq_id.set(f,C));let g=l.value(p);n.label_asym_id.has(g)||n.label_asym_id.set(g,h),ROe(n.entity_index_label_asym_id,h,g,p);let b=new Map,y=new Map;n.chain_index_label_seq_id.set(p,b),n.chain_index_auth_seq_id.set(p,y);let x=Vt.transientSegments(r.residueAtomSegments,u,m);for(;x.hasNext;){let v=x.move().index,_=i.value(v),I=s.value(v);b.set(EC(o.value(v),I),v),y.set(EC(_,I),v),C.set(_,p)}}return new cG(n)}function OOe(e){if(e._rowCount===0)return{residues:[],chains:[]};let t=0,r=e._rowCount,n=[t],o=[t],{label_entity_id:i,label_asym_id:s,label_seq_id:a,auth_seq_id:l,pdbx_PDB_ins_code:c}=e;for(let u=t+1;u<r;u++){let d=!i.areValuesEqual(u-1,u)||!s.areValuesEqual(u-1,u);(d||!a.areValuesEqual(u-1,u)||!l.areValuesEqual(u-1,u)||!c.areValuesEqual(u-1,u))&&(n[n.length]=u),d&&(o[o.length]=u)}return{residues:n,chains:o}}function VOe(e,t,r){let n=gr.ofColumns(woe,{type_symbol:ue.ofArray({array:ue.mapToArray(e.type_symbol,zp),schema:ue.Schema.Aliased(ue.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),o=gr.view(e,_oe,r.residues),i=gr.view(e,Toe,r.chains);if(!o.label_seq_id.isDefined){let s=new Int32Array(o.label_seq_id.rowCount),{residues:a,chains:l}=r,c=0,u=0;for(let d=0,m=s.length;d<m;++d)a[d]>=l[c+1]&&(c+=1,u=0),s[d]=++u;o.label_seq_id=ue.ofIntArray(s)}return gr.columnToArray(o,"label_seq_id",Int32Array),gr.columnToArray(o,"auth_seq_id",Int32Array),{atoms:n,residues:o,chains:i,atomSourceIndex:t}}function GOe(e){return{id:jr.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:ue.ofConst(1,e._rowCount,ue.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}function UOe(e,t){return gr.areEqual(e.chains,t.chains)&&gr.areEqual(e.residues,t.residues)&&gr.areEqual(e.atoms,t.atoms)}function zOe(e,t){let r=new Map;if(!qr.is(t))return r;let{molstar_atom_site_operator_mapping:n}=bc(Tie,t.data.frame);if(n._rowCount===0)return r;let o=new Map,i=new Map;for(let u=0;u<n._rowCount;u++){let d=n.assembly_operator_id.valueKind(u)===0?{id:n.assembly_id.value(u),operList:[],operId:n.assembly_operator_id.value(u)}:void 0,m=eo.create(n.operator_name.value(u),de.identity(),{assembly:d,spgrOp:n.symmetry_operator_index.valueKind(u)===0?n.symmetry_operator_index.value(u):void 0,hkl:D.ofArray(n.symmetry_hkl.value(u)),ncsId:n.ncs_id.value(u)}),p=n.suffix.value(u),h=n.label_asym_id.value(u);o.set(`${h}${p}`,{name:h,operator:m});let f=n.auth_asym_id.value(u);i.set(`${f}${p}`,f)}let{label_asym_id:s,auth_asym_id:a}=e.chains,l=new Array(s.rowCount),c=new Array(s.rowCount);for(let u=0;u<s.rowCount;u++){let d=s.value(u),m=a.value(u);if(!o.has(d)){l[u]=d,c[u]=m;continue}let{name:p,operator:h}=o.get(d);r.set(u,h),l[u]=p,c[u]=i.get(m)||m}return e.chains.label_asym_id=ue.ofArray({array:l,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ue.ofArray({array:c,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),r}function HOe(e,t,r,n,o,i){let s=OOe(e),a=VOe(e,t,s),l=zOe(a,o);if(i&&UOe(i.atomicHierarchy,a))return{sameAsPrevious:!0,hierarchy:i.atomicHierarchy,chainOperatorMapping:l};let c={residueAtomSegments:Vt.ofOffsets(s.residues,Be.ofBounds(0,e._rowCount)),chainAtomSegments:Vt.ofOffsets(s.chains,Be.ofBounds(0,e._rowCount))},u=Nie(a,r,c),d=Lie(a,c,u,n);return{sameAsPrevious:!1,hierarchy:{...a,...c,index:u,derived:d},chainOperatorMapping:l}}function uG(e,t,r,n,o,i){let{sameAsPrevious:s,hierarchy:a,chainOperatorMapping:l}=HOe(e,t,r,n,o,i),c=GOe(e);return{sameAsPrevious:s,hierarchy:a,conformation:c,chainOperatorMapping:l}}var Fie={chainKey:[],entityKey:[],findSequenceKey:()=>-1,findChainKey:()=>-1,getEntityFromChain:()=>-1,count:0,entity_id:ue.Undefined(0,ue.Schema.str),asym_id:ue.Undefined(0,ue.Schema.str),seq_id_begin:ue.Undefined(0,ue.Schema.int),seq_id_end:ue.Undefined(0,ue.Schema.int),chainElementSegments:Vt.create([]),polymerRanges:Sn.ofSortedRanges([]),gapRanges:Sn.ofSortedRanges([])},bD;(function(e){e.Empty={isDefined:!1,spheres:Fie,gaussians:Fie}})(bD||(bD={}));function jOe(e,t,r){if(e.has(t))return e.get(t);let n=r.index++;return e.set(t,n),n}function $Oe(e,t){if(e.has(t))return e.get(t);let r=new Map;return e.set(t,r),r}function WOe(e,t,r){let n=e.getEntityIndex;return{findChainKey:(s,a)=>{let l=n(s);if(l<0)return-1;let c=t.get(l);return c.has(a)?c.get(a):-1},findSequenceKey:(s,a,l)=>{let c=n(s);if(c<0)return-1;let u=t.get(c);if(u===void 0)return-1;let d=u.get(a);if(d===void 0)return-1;let m=r.get(d),{elementIndices:p,seqRanges:h}=m,f=Sn.firstIntersectionIndex(h,Ge.ofSingleton(l));return f!==-1?p[f]:-1}}}function qOe(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}function dG(e,t){let{entity_id:r,asym_id:n,seq_id_begin:o,seq_id_end:i,count:s,chainElementSegments:a}=e,l=new Map,c=new Map,u={index:0},d=new Int32Array(s),m=new Int32Array(s),p=new Int32Array(a.count);for(let g=0;g<s;g++)m[g]=t.getEntityIndex(r.value(g)),m[g]<0&&qOe(r.value(g));for(let g=0;g<a.count;g++){let b=a.offsets[g],y=a.offsets[g+1],x=m[b];p[g]=x;let A=$Oe(c,x),v=jOe(A,n.value(b),u);for(let E=b;E<y;E++)d[E]=v;let _=[],I=[];for(let E=b;E<y;E++){let w=o.value(E),S=i.value(E);_.push(E),I.push(w,S)}let T={elementIndices:_,seqRanges:Sn.ofSortedRanges(I)};l.set(v,T)}let{findChainKey:h,findSequenceKey:f}=WOe(t,c,l);return{chainKey:d,entityKey:m,findSequenceKey:f,findChainKey:h,getEntityFromChain:g=>p[g]}}function mG(e,t){let r=[],n=[],o=Vt.transientSegments(e.chainElementSegments,Be.ofBounds(0,e.count)),{seq_id_begin:i,seq_id_end:s}=e;for(;o.hasNext;){let{start:a,end:l}=o.move(),c=-1,u=-1;for(let d=a;d<l;++d){let m=s.value(d);d===a?(c=d,u=s.value(d)):i.value(d)-u>1&&(r.push(c,d-1),n.push(d-1,d),c=d),d===l-1&&r.push(c,d),u=m}}return{polymerRanges:Sn.ofSortedRanges(r),gapRanges:Sn.ofSortedRanges(n)}}var pG={hierarchy:bD.Empty,conformation:void 0};function Vie(e,t){let{ihm_sphere_obj_site:r,ihm_gaussian_obj_site:n}=e;if(r._rowCount===0&&n._rowCount===0)return pG;let o=Oie(r),i=ZOe(r),s=dG(o,e.entities),a=mG(o,t),l=Oie(n),c=KOe(n),u=dG(l,e.entities),d=mG(l,t);return{hierarchy:{isDefined:!0,spheres:{...o,...s,...a},gaussians:{...l,...u,...d}},conformation:{id:jr.create22(),spheres:i,gaussians:c}}}function ZOe(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}function KOe(e){let t=wo.ihm_gaussian_obj_site.covariance_matrix.space,r=[],{covariance_matrix:n}=e;for(let o=0,i=n.rowCount;o<i;o++)r[o]=cr.toMat3(nr(),t,n.value(o));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:r}}function XOe(e,t,r){let n=[0];for(let o=1,i=e.rowCount;o<i;o++)!e.areValuesEqual(o-1,o)&&(n[n.length]=o);return{chainElementSegments:Vt.ofOffsets(n,Be.ofBounds(0,e.rowCount))}}function Oie(e){let{entity_id:t,seq_id_begin:r,seq_id_end:n,asym_id:o}=e;return{count:t.rowCount,entity_id:t,asym_id:o,seq_id_begin:r,seq_id_end:n,...XOe(o,r,n)}}function fG(e,t,r,n){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return L2.fromHierarchy(t,r,n);let{entity_id:o,num:i,mon_id:s}=e.entity_poly_seq,a={},l=[],c=o.rowCount,u=0;for(;u<c;){let d=u;for(;u<c-1&&o.areValuesEqual(u,u+1);)u++;u++;let m=o.value(d),p=ue.window(s,d,u),h=ue.window(i,d,u),f=t.getEntityIndex(m);a[f]={entityId:m,sequence:Db.ofResidueNames(p,h)},l.push(a[f])}return{byEntityKey:a,sequences:l}}async function hG(e,t,r,n){let o=FA(r,n-1),{label_entity_id:i,label_asym_id:s,label_seq_id:a}=t,l=ME(o,i.value);e.shouldUpdate&&await e.update();for(let c=0,u=l.length-1;c<u;c++){let d=ME(o,s.value,{start:l[c],end:l[c+1]});for(let m=0,p=d.length-1;m<p;m++){let h=d[m];a.valueKind(h)===0&&(ME(o,a.value,{sort:!0,start:h,end:d[m+1]}),e.shouldUpdate&&await e.update())}e.shouldUpdate&&await e.update()}return tX(o)&&o.length===t._rowCount?{atom_site:t,sourceIndex:ue.ofIntArray(o)}:{atom_site:gr.view(t,t._schema,o),sourceIndex:ue.ofIntArray(o)}}function Gie(e,t,r,n,o){let{polymerType:i,traceElementIndex:s,directionFromElementIndex:a,directionToElementIndex:l}=o.residue,c=i[e],u=i[t];if(c===0||u===0||s[e]===-1||s[t]===-1)return!1;let d=n.findAtomsOnResidue(e,$f(c,"backboneStart")),m=n.findAtomsOnResidue(t,$f(u,"backboneEnd"));(d===-1||m===-1)&&(d=n.findAtomsOnResidue(e,$f(c,"coarseBackbone")),m=n.findAtomsOnResidue(t,$f(u,"coarseBackbone")));let{x:p,y:h,z:f}=r,C=D.create(p[d],h[d],f[d]),g=D.create(p[m],h[m],f[m]),b=a[e]===-1||l[e]===-1||a[t]===-1||l[t]===-1;return D.distance(C,g)<(b?10:3)}function gG(e,t,r,n){let o=[],i=[],s=new Map,a=Vt.transientSegments(e.chainAtomSegments,Be.ofBounds(0,e.atoms._rowCount)),l=Vt.transientSegments(e.residueAtomSegments,Be.ofBounds(0,e.atoms._rowCount)),{index:c,derived:u}=e,{label_seq_id:d}=e.residues,{label_entity_id:m}=e.chains,{moleculeType:p,traceElementIndex:h}=u.residue,f,C,g,b;for(;a.hasNext;){let y=a.move();l.setSegment(y),f=-1,C=-1,g=-1,b=-1;let x=t.getEntityIndex(m.value(y.index)),A=n.byEntityKey[x],v=A?A.sequence.seqId.value(A.sequence.seqId.rowCount-1):-1,_=e.residueAtomSegments.index[y.start],I=e.residueAtomSegments.index[y.end-1],T=d.value(_),E=d.value(I);for(T===1&&E===v&&r.xyzDefined&&Gie(_,I,r,c,u)&&(s.set(_,I),s.set(I,_));l.hasNext;){let w=l.move(),S=w.index,P=d.value(S);if(K0(p[S])&&h[S]!==-1)if(b!==-1)if(P!==f+1)o.push(b,g-1),i.push(C,w.end-1),b=w.start;else if(!l.hasNext)o.push(b,w.end-1);else{let k=e.residueAtomSegments.index[w.start],L=e.residueAtomSegments.index[g-1];r.xyzDefined&&!Gie(k,L,r,e.index,u)&&(o.push(b,g-1),i.push(C,w.end-1),b=w.start)}else b=w.start;else b!==-1&&(o.push(b,g-1),b=-1);C=w.start,g=w.end,f=P}}return{polymerRanges:Sn.ofSortedRanges(o),gapRanges:Sn.ofSortedRanges(i),cyclicPolymerMap:s}}function Uie(e){let t=new Map,r=(o,i,s)=>`${o}|${i}|${s}`,n=e.pdbx_unobs_or_zero_occ_residues;for(let o=0,i=n._rowCount;o<i;++o){let s=r(n.PDB_model_num.value(o),n.label_asym_id.value(o),n.label_seq_id.value(o));t.set(s,{polymer_flag:n.polymer_flag.value(o),occupancy_flag:n.occupancy_flag.value(o)})}return{has:(o,i,s)=>t.has(r(o,i,s)),get:(o,i,s)=>t.get(r(o,i,s)),size:t.size}}function zie(e){let t=new Map;if(e.chem_comp._rowCount>0){let{id:r}=e.chem_comp;for(let n=0,o=r.rowCount;n<o;++n)t.set(r.value(n),gr.getRow(e.chem_comp,n))}else jie(e).forEach(n=>{t.set(n,Ane(n))});return t}function Hie(e){let t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){let{comp_id:r,type:n,identifier:o}=e.pdbx_chem_comp_identifier;for(let i=0,s=r.rowCount;i<s;++i)if(n.value(i)==="SNFG CARBOHYDRATE SYMBOL"||n.value(i)==="SNFG CARB SYMBOL"){let a=o.value(i),l=nne.get(a);l&&t.set(r.value(i),l)}}if(e.chem_comp._rowCount>0){let{id:r,type:n}=e.chem_comp;for(let o=0,i=r.rowCount;o<i;++o){let s=r.value(o);if(t.has(s))continue;let a=n.value(o);bm.has(s)?t.set(s,bm.get(s)):_c(a,s)===9&&t.set(s,R3)}}else{let r=jie(e);bm.forEach((n,o)=>{!t.has(o)&&r.has(o)&&t.set(o,n)})}return t}var jie=gg(e=>{let t=new Set,{label_comp_id:r,auth_comp_id:n}=e.atom_site,o=r.isDefined?r:n;for(let i=0,s=o.rowCount;i<s;++i)t.add(o.value(i));return t});function yG(e,t){let r=new Map,{auth_asym_id:n,label_asym_id:o,label_entity_id:i}=e.chains;for(let s=0,a=e.chains._rowCount;s<a;s++){let l=o.value(s);r.set(l,{id:l,auth_id:n.value(s),entity_id:i.value(s)})}if(t?.struct_asym._rowCount){let{id:s,entity_id:a}=t.struct_asym;for(let l=0,c=s.rowCount;l<c;++l){let u=s.value(l);r.has(u)||r.set(u,{id:u,auth_id:"",entity_id:a.value(l)})}}return r}var $ie=ue.Schema.Aliased(ue.Schema.Str());function vG(e){let t;if(e.entity.id.isDefined)t=e.entity;else{let a=new Set,l=[],c=[],{label_entity_id:u,label_comp_id:d}=e.atom_site;for(let h=0,f=e.atom_site._rowCount;h<f;h++){let C=u.value(h);a.has(C)||(l.push(C),c.push(wne(d.value(h))),a.add(C))}let{entity_id:m}=e.ihm_sphere_obj_site;for(let h=0,f=e.ihm_sphere_obj_site._rowCount;h<f;h++){let C=m.value(h);a.has(C)||(l.push(C),c.push("polymer"),a.add(C))}let{entity_id:p}=e.ihm_gaussian_obj_site;for(let h=0,f=e.ihm_gaussian_obj_site._rowCount;h<f;h++){let C=p.value(h);a.has(C)||(l.push(C),c.push("polymer"),a.add(C))}t=gr.ofPartialColumns(wo.entity,{id:ue.ofArray({array:l,schema:wo.entity.id}),type:ue.ofArray({array:c,schema:wo.entity.type})},l.length)}let r=ue.createIndexer(t.id),n=new Array(t._rowCount);n.fill("other");let o=new Set,i=!1;if(e.entity_poly&&e.entity_poly.type.isDefined){let{entity_id:a,type:l,_rowCount:c}=e.entity_poly;for(let u=0;u<c;++u){let d=a.value(u);n[r(d)]=l.value(u),o.add(d)}}else i=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined){let{entity_id:a,type:l,_rowCount:c}=e.pdbx_entity_branch;for(let u=0;u<c;++u){let d=a.value(u);n[r(d)]=l.value(u),o.add(d)}}else i=!0;if(o.size<n.length&&(i=!0),i){let a=new Map;if(e.chem_comp){let{id:l,type:c}=e.chem_comp;for(let u=0,d=e.chem_comp._rowCount;u<d;u++)a.set(l.value(u),c.value(u))}if(e.atom_site){let{label_entity_id:l,label_comp_id:c}=e.atom_site;for(let u=0,d=e.atom_site._rowCount;u<d;u++){let m=l.value(u);if(!o.has(m)){let p=c.value(u),h=a.get(p)||"other";n[r(m)]=_ne(p,h),o.add(m)}}}}let s=ue.ofArray({array:n,schema:$ie});return{data:t,subtype:s,getEntityIndex:r}}function bG(e,t,r){var n;if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;let o=new Array(t.data._rowCount);o.fill("");let{asym_id:i,prd_id:s,_rowCount:a}=e.pdbx_molecule;for(let c=0;c<a;++c){let u=i.value(c),d=(n=r.get(u))===null||n===void 0?void 0:n.entity_id;d!==void 0&&(o[t.getEntityIndex(d)]=s.value(c))}let l=ue.ofArray({array:o,schema:ue.Schema.str});return{...t,prd_id:l}}async function va(e,t,r){let n=YOe(e,t),o=e.ihm_model_list._rowCount>0?await t4e(r,e,n,t):await e4e(r,e,n,t);for(let i=0;i<o.length;i++)Ut.TrajectoryInfo.set(o[i],{index:i,size:o.length});return new sc(o)}function YOe(e,t){return{missingResidues:Uie(e),chemicalComponentMap:zie(e),saccharideComponentMap:Hie(e)}}function QOe(e,t,r,n,o,i,s){let a=uG(t,r,n,o.chemicalComponentMap,i,s),l=t.pdbx_PDB_model_num.value(0);if(s&&a.sameAsPrevious)return{...s,id:jr.create22(),modelNum:l,atomicConformation:a.conformation,_dynamicPropertyData:Object.create(null)};let c=pG,u=fG(e,n,a.hierarchy,c.hierarchy),d=gG(a.hierarchy,n,a.conformation,u),m=yG(a.hierarchy),p=e.entry.id.valueKind(0)===0?e.entry.id.value(0):i.name,h=[];return p&&h.push(p),e.struct.title.valueKind(0)===0&&h.push(e.struct.title.value(0)),{id:jr.create22(),entryId:p,label:h.join(" | "),entry:p,sourceData:i,modelNum:l,parent:void 0,entities:bG(e,n,m),sequence:u,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:d,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:c.hierarchy,coarseConformation:c.conformation,properties:{...o,structAsymMap:m},customProperties:new Ls,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function JOe(e,t,r,n){let o=uG(t.atom_site,t.atom_site_sourceIndex,t.entities,r.chemicalComponentMap,n),i=Vie(t,r.chemicalComponentMap),s=fG(e,t.entities,o.hierarchy,i.hierarchy),a=gG(o.hierarchy,t.entities,o.conformation,s),l=e.entry.id.valueKind(0)===0?e.entry.id.value(0):n.name,c=[];l&&c.push(l),e.struct.title.valueKind(0)===0&&c.push(e.struct.title.value(0)),t.model_name&&c.push(t.model_name),t.model_group_name&&c.push(t.model_group_name);let u=yG(o.hierarchy,e);return{id:jr.create22(),entryId:l,label:c.join(" | "),entry:l,sourceData:n,modelNum:t.model_id,parent:void 0,entities:bG(e,t.entities,u),sequence:s,atomicHierarchy:o.hierarchy,atomicConformation:o.conformation,atomicRanges:a,atomicChainOperatorMappinng:o.chainOperatorMapping,coarseHierarchy:i.hierarchy,coarseConformation:i.conformation,properties:{...r,structAsymMap:u},customProperties:new Ls,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function Wie(e,t){let r=e.rowCount;if(!e.isDefined)return r;let n=t+1;for(;n<r&&e.areValuesEqual(t,n);)n++;return n}async function e4e(e,t,r,n){let o=[];if(t.atom_site){let i=t.atom_site.id.rowCount,s=vG(t),a=0;for(;a<i;){let l=Wie(t.atom_site.pdbx_PDB_model_num,a),{atom_site:c,sourceIndex:u}=await hG(e,t.atom_site,a,l),d=QOe(t,c,u,s,r,n,o.length>0?o[o.length-1]:void 0);o.push(d),a=l}}return o}function xG(e,t){let r=new Map,n=e._rowCount,o=0;for(;o<n;){let i=Wie(t,o),s=t.value(o);r.set(s,{table:gr.window(e,e._schema,o,i),start:o,end:i}),o=i}return r}async function t4e(e,t,r,n){let o=vG(t),i=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,s=xG(t.atom_site,i),a=xG(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),l=xG(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),c=[];if(t.ihm_model_list){let{model_id:u,model_name:d}=t.ihm_model_list;for(let m=0;m<t.ihm_model_list._rowCount;m++){let p=u.value(m),h,f;if(s.has(p)){let b=s.get(p),{atom_site:y,sourceIndex:x}=await hG(e,t.atom_site,b.start,b.end);h=y,f=x}else h=gr.window(t.atom_site,t.atom_site._schema,0,0),f=ue.ofIntArray([]);let C={model_id:p,model_name:d.value(m),model_group_name:Pne(p,t),entities:o,atom_site:h,atom_site_sourceIndex:f,ihm_sphere_obj_site:a.has(p)?a.get(p).table:gr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:l.has(p)?l.get(p).table:gr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},g=JOe(t,C,r,n);c.push(g)}}return c}function r4e(e,t){let r=e.atomName,n=e.residueName,o=new Array(e.count),i=new Array(e.count),s=new Uint32Array(e.count),a=new Uint32Array(e.count),l=new Array(e.count),c=new qi,u=new Is(e.residueNumber,e.atomName),d="",m=0,p="",h=0,f=0,C=-1;for(let y=0,x=e.count;y<x;++y){let A=e.residueNumber.value(y);if(A!==C){let v=e.residueName.value(y),_=_c(u.add(v,y).type,v);(_!==f||A!==C+1&&!(C===99999&&A===0))&&(p=yg(m),m+=1,h=0),d=c.getEntityId(v,_,p),h+=1,C=A,f=_}o[y]=d,i[y]=p,s[y]=h,a[y]=y,l[y]=vm(e.atomName.value(y),e.residueName.value(y))}let g=ue.ofStringArray(i),b=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:g,auth_atom_id:r,auth_comp_id:n,auth_seq_id:e.residueNumber,Cartn_x:ue.ofFloatArray(ue.mapToArray(e.x,y=>y*10,Float32Array)),Cartn_y:ue.ofFloatArray(ue.mapToArray(e.y,y=>y*10,Float32Array)),Cartn_z:ue.ofFloatArray(ue.mapToArray(e.z,y=>y*10,Float32Array)),id:ue.ofIntArray(a),label_asym_id:g,label_atom_id:r,label_comp_id:n,label_seq_id:ue.ofIntArray(s),label_entity_id:ue.ofStringArray(o),occupancy:ue.ofConst(1,e.count,ue.Schema.float),type_symbol:ue.ofStringArray(l),pdbx_PDB_model_num:ue.ofConst(t,e.count,ue.Schema.int)},e.count);return as({entity:c.getEntityTable(),chem_comp:u.getChemCompTable(),atom_site:b})}var CG;(function(e){function t(n){return n?.kind==="gro"}e.is=t;function r(n){return{kind:"gro",name:n.structures[0].header.title,data:n}}e.fromGro=r})(CG||(CG={}));function qie(e){return ke.create("Parse GRO",async t=>{let r=CG.fromGro(e),n=[];for(let o=0,i=e.structures.length;o<i;++o){let s=r4e(e.structures[o].atoms,o+1),a=await va(s,r,t);a.frameCount===1&&n.push(a.representative)}return new sc(n)})}function Kie(e,t){let r=(i,s)=>(t.substr(i,s)||"").trim(),n={entry_id:Pt.ofString(e),length_a:Pt.ofString(r(6,9)),length_b:Pt.ofString(r(15,9)),length_c:Pt.ofString(r(24,9)),angle_alpha:Pt.ofString(r(33,7)),angle_beta:Pt.ofString(r(40,7)),angle_gamma:Pt.ofString(r(47,7)),Z_PDB:Pt.ofString(r(66,4)),pdbx_unique_axis:Pt.ofString("?")},o={entry_id:Pt.ofString(e),"space_group_name_H-M":Pt.ofString(r(55,11)),Int_Tables_number:Pt.ofString("?"),cell_setting:Pt.ofString("?"),space_group_name_Hall:Pt.ofString("?")};return[Hi.ofFields("cell",n),Hi.ofFields("symmetry",o)]}function Zie(e,t){return{id:e,details:t,groups:[]}}function Xie(e,t,r){let n=[],o,i,s,a=1,l=1,c=f=>e.data.substring(e.indices[2*f],e.indices[2*f+1]);for(let f=t;f<r;f++){let C=c(f);if(C.substr(11,12)==="BIOMOLECULE:"){let g=C.substr(23).trim(),b=`Biomolecule ${g}`;C=c(f+1),C.substr(11,30)!=="APPLY THE FOLLOWING TO CHAINS:"&&(f++,b=C.substr(11).trim()),o=Zie(g,b),n.push(o)}else if(C.substr(13,5)==="BIOMT"){let g=C.split(/\s+/),b=parseInt(C[18])-1;b===0&&(s=de.identity(),i.operators.push({id:a++,matrix:s})),de.setValue(s,b,0,parseFloat(g[4])),de.setValue(s,b,1,parseFloat(g[5])),de.setValue(s,b,2,parseFloat(g[6])),de.setValue(s,b,3,parseFloat(g[7]))}else if(C.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||C.substr(11,30)==="                   AND CHAINS:"){C.substr(11,5)==="APPLY"&&(i={chains:[],operators:[]},o.groups.push(i));let g=C.substr(41,30).split(",");for(let b=0,y=g.length;b<y;++b){let x=g[b].trim();x&&i.chains.push(x)}}else if(C.substr(11,33)==="APPLYING THE FOLLOWING TO CHAINS:"){o=Zie(`${l}`,`Biomolecule ${l}`),n.push(o),l+=1,i={chains:[],operators:[]},o.groups.push(i),f++,C=c(f);let g=C.substr(11,69).split(",");for(let b=0,y=g.length;b<y;++b){let x=g[b].trim();x&&i.chains.push(x)}}}if(n.length===0)return[];let u={id:Pt.ofStrings(n.map(f=>f.id)),details:Pt.ofStrings(n.map(f=>f.details))},d=[];for(let f of n)for(let C of f.groups)d.push({assembly_id:f.id,oper_expression:C.operators.map(g=>g.id).join(","),asym_id_list:C.chains.join(",")});let m={assembly_id:Pt.ofStrings(d.map(f=>f.assembly_id)),oper_expression:Pt.ofStrings(d.map(f=>f.oper_expression)),asym_id_list:Pt.ofStrings(d.map(f=>f.asym_id_list))},p=[];for(let f of n)for(let C of f.groups)for(let g of C.operators){let b={id:""+g.id,type:"?",name:"?",symmetry_operation:"?"};for(let y=0;y<3;y++){for(let x=0;x<3;x++)b[`matrix[${y+1}][${x+1}]`]=""+de.getValue(g.matrix,y,x);b[`vector[${y+1}]`]=""+de.getValue(g.matrix,y,3)}p.push(b)}let h={id:Pt.ofStrings(p.map(f=>f.id)),type:Pt.ofStrings(p.map(f=>f.type)),name:Pt.ofStrings(p.map(f=>f.name)),symmetry_operation:Pt.ofStrings(p.map(f=>f.symmetry_operation))};for(let f=0;f<3;f++){for(let g=0;g<3;g++){let b=`matrix[${f+1}][${g+1}]`;h[b]=Pt.ofStrings(p.map(y=>y[b]))}let C=`vector[${f+1}]`;h[C]=Pt.ofStrings(p.map(g=>g[C]))}return[Hi.ofFields("pdbx_struct_assembly",u),Hi.ofFields("pdbx_struct_assembly_gen",m),Hi.ofFields("pdbx_struct_oper_list",h)]}function Yie(e,t,r){let n=[],o,i=c=>e.data.substring(e.indices[2*c],e.indices[2*c+1]);for(let c=t;c<r;c++){let u=i(c),d=u.split(/\s+/),m=parseInt(u[5])-1;m===0&&(o=de.identity(),n.push(o)),de.setValue(o,m,0,parseFloat(d[2])),de.setValue(o,m,1,parseFloat(d[3])),de.setValue(o,m,2,parseFloat(d[4])),de.setValue(o,m,3,parseFloat(d[5]))}if(n.length===0)return[];let s=[],a=1;for(let c of n){let u={id:"ncsop"+a++,code:".",details:"."};for(let d=0;d<3;d++){for(let m=0;m<3;m++)u[`matrix[${d+1}][${m+1}]`]=""+de.getValue(c,d,m);u[`vector[${d+1}]`]=""+de.getValue(c,d,3)}s.push(u)}let l={id:Pt.ofStrings(s.map(c=>c.id)),code:Pt.ofStrings(s.map(c=>c.code)),details:Pt.ofStrings(s.map(c=>c.details))};for(let c=0;c<3;c++){for(let d=0;d<3;d++){let m=`matrix[${c+1}][${d+1}]`;l[m]=Pt.ofStrings(s.map(p=>p[m]))}let u=`vector[${c+1}]`;l[u]=Pt.ofStrings(s.map(d=>d[u]))}return[Hi.ofFields("struct_ncs_oper",l)]}var n4e={1:"helx_rh_al_p",2:"helx_rh_om_p",3:"helx_rh_pi_p",4:"helx_rh_ga_p",5:"helx_rh_3t_p",6:"helx_lh_al_p",7:"helx_lh_om_p",8:"helx_lh_ga_p",9:"helx_rh_27_p",10:"helx_rh_pp_p"};function o4e(e){return n4e[e]||"helx_p"}function Qie(e,t,r){let n=[],o=u=>e.data.substring(e.indices[2*u],e.indices[2*u+1]);for(let u=t;u<r;u++){let d=o(u);n.push({serNum:d.substr(7,3).trim(),helixID:d.substr(11,3).trim(),initResName:d.substr(15,3).trim(),initChainID:d.substr(19,1).trim(),initSeqNum:d.substr(21,4).trim(),initICode:d.substr(25,1).trim(),endResName:d.substr(27,3).trim(),endChainID:d.substr(31,3).trim(),endSeqNum:d.substr(33,4).trim(),endICode:d.substr(37,1).trim(),helixClass:d.substr(38,2).trim(),comment:d.substr(40,30).trim(),length:d.substr(71,5).trim()})}let i=Pt.ofStrings(n.map(u=>u.initChainID)),s=Pt.ofStrings(n.map(u=>u.initResName)),a=Pt.ofStrings(n.map(u=>u.endChainID)),l=Pt.ofStrings(n.map(u=>u.endResName)),c={beg_label_asym_id:i,beg_label_comp_id:s,beg_label_seq_id:Pt.ofUndefined(n.length,ue.Schema.int),beg_auth_asym_id:i,beg_auth_comp_id:s,beg_auth_seq_id:Pt.ofStrings(n.map(u=>u.initSeqNum)),conf_type_id:Pt.ofStrings(n.map(u=>o4e(u.helixClass))),details:Pt.ofStrings(n.map(u=>u.comment)),end_label_asym_id:a,end_label_comp_id:l,end_label_seq_id:Pt.ofUndefined(n.length,ue.Schema.int),end_auth_asym_id:a,end_auth_comp_id:l,end_auth_seq_id:Pt.ofStrings(n.map(u=>u.endSeqNum)),id:Pt.ofStrings(n.map(u=>u.serNum)),pdbx_beg_PDB_ins_code:Pt.ofStrings(n.map(u=>u.initICode)),pdbx_end_PDB_ins_code:Pt.ofStrings(n.map(u=>u.endICode)),pdbx_PDB_helix_class:Pt.ofStrings(n.map(u=>u.helixClass)),pdbx_PDB_helix_length:Pt.ofStrings(n.map(u=>u.length)),pdbx_PDB_helix_id:Pt.ofStrings(n.map(u=>u.helixID))};return Hi.ofFields("struct_conf",c)}function Jie(e,t,r){let n=[],o=m=>e.data.substring(e.indices[2*m],e.indices[2*m+1]);for(let m=t;m<r;m++){let p=o(m);n.push({strand:p.substr(7,3).trim(),sheetID:p.substr(11,3).trim(),numStrands:p.substr(14,2).trim(),initResName:p.substr(17,3).trim(),initChainID:p.substr(21,1).trim(),initSeqNum:p.substr(22,4).trim(),initICode:p.substr(26,1).trim(),endResName:p.substr(28,3).trim(),endChainID:p.substr(32,1).trim(),endSeqNum:p.substr(33,4).trim(),endICode:p.substr(37,1).trim(),sense:p.substr(38,2).trim(),curAtom:p.substr(41,4).trim(),curResName:p.substr(45,3).trim(),curChainId:p.substr(49,1).trim(),curResSeq:p.substr(50,4).trim(),curICode:p.substr(54,1).trim(),prevAtom:p.substr(56,4).trim(),prevResName:p.substr(60,3).trim(),prevChainId:p.substr(64,1).trim(),prevResSeq:p.substr(65,4).trim(),prevICode:p.substr(69,1).trim()})}let i=Pt.ofStrings(n.map(m=>m.initChainID)),s=Pt.ofStrings(n.map(m=>m.initResName)),a=Pt.ofStrings(n.map(m=>m.initSeqNum)),l=Pt.ofStrings(n.map(m=>m.endChainID)),c=Pt.ofStrings(n.map(m=>m.endResName)),u=Pt.ofStrings(n.map(m=>m.endSeqNum)),d={beg_label_asym_id:i,beg_label_comp_id:s,beg_label_seq_id:a,beg_auth_asym_id:i,beg_auth_comp_id:s,beg_auth_seq_id:a,end_label_asym_id:l,end_label_comp_id:l,end_label_seq_id:u,end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:u,id:Pt.ofStrings(n.map(m=>m.strand)),sheet_id:Pt.ofStrings(n.map(m=>m.sheetID)),pdbx_beg_PDB_ins_code:Pt.ofStrings(n.map(m=>m.initICode)),pdbx_end_PDB_ins_code:Pt.ofStrings(n.map(m=>m.endICode))};return Hi.ofFields("struct_sheet_range",d)}var i4e={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function ese(e,t,r){let n=l=>e.data.substring(e.indices[2*l],e.indices[2*l+1]),o,i={chains:[],description:""},s=[];for(let l=t;l<r;l++){let u=n(l).substr(10,70).trim(),d=u.indexOf(":"),m=u.substring(0,d),p;m in i4e?(o=m,p=u.substring(d+2)):p=u,p=p.replace(/;$/,""),o==="MOL_ID"?(i={chains:[],description:""},s.push(i)):o==="MOLECULE"?(i.description&&(i.description+=" "),i.description+=p):o==="CHAIN"&&Array.prototype.push.apply(i.chains,p.split(/\s*,\s*/))}let a=[];for(let l of s)for(let c of l.chains)a.push({description:l.description,chains:[c]});return a}function tse(e,t,r){let n=i=>e.data.substring(e.indices[2*i],e.indices[2*i+1]),o=new Map;for(let i=t;i<r;i++){let s=n(i),a=s.substr(11,3).trim(),l=s.substr(15).trim();o.has(a)?o.set(a,`${o.get(a)} ${l}`):o.set(a,l)}return o}function rse(e,t){let r=()=>[],n=()=>ct.create(e,2*t);return{index:0,group_PDB:n(),id:r(),auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:r(),label_entity_id:r(),partial_charge:n()}}function nse(e,t,r){let n=Pt.ofStrings(e.pdbx_PDB_model_num),o=Pt.ofTokens(e.auth_asym_id),i=Pt.ofTokens(e.auth_seq_id),s=Pt.ofTokens(e.pdbx_PDB_ins_code),a=Pt.ofTokens(e.auth_atom_id),l=Pt.ofTokens(e.auth_comp_id),c=Pt.ofStrings(e.id),u=n.str(0),d=o.str(0),m=i.int(0),p=s.str(0),h=d,f=m,C=new Map,g=new Map,b=[],y=[],x=[],A=!1;for(let T=0,E=c.rowCount;T<E;++T)if(s.str(T)!==""){A=!0;break}for(let T=0,E=c.rowCount;T<E;++T){let w=n.str(T),S=o.str(T),P=i.int(T),k=s.str(T),L=a.str(T);if(w!==u?(C.clear(),g.clear(),u=w,d=S,m=P,p=k,h=S,f=P):d!==S?(g.clear(),d=S,m=P,p=k,h=S,f=P):m!==P?(g.clear(),m===f?f=P:f+=1,m=P,p=k):p!==k&&(g.clear(),p=k,f+=1),C.has(S)){if(t.has(T)&&!r.hasAssemblies){let R=C.get(S)+1;C.set(S,R),h=`${S}_${R}`}}else C.set(S,0);if(b[T]=h,g.has(L)){let R=g.get(L)+1;g.set(L,R),L=`${L}_${R}`}else g.set(L,0);y[T]=L,A&&(x[T]=f)}let v=ue.ofStringArray(b),_=ue.ofStringArray(y),I=A?Pt.ofColumn(ue.ofIntArray(x)):Pt.ofUndefined(e.index,ue.Schema.int);return{auth_asym_id:o,auth_atom_id:a,auth_comp_id:l,auth_seq_id:i,B_iso_or_equiv:Pt.ofTokens(e.B_iso_or_equiv),Cartn_x:Pt.ofTokens(e.Cartn_x),Cartn_y:Pt.ofTokens(e.Cartn_y),Cartn_z:Pt.ofTokens(e.Cartn_z),group_PDB:Pt.ofTokens(e.group_PDB),id:c,label_alt_id:Pt.ofTokens(e.label_alt_id),label_asym_id:Pt.ofColumn(v),label_atom_id:Pt.ofColumn(_),label_comp_id:l,label_seq_id:I,label_entity_id:Pt.ofStrings(e.label_entity_id),occupancy:uq(e.occupancy)?Pt.ofUndefined(e.index,ue.Schema.float):Pt.ofTokens(e.occupancy),type_symbol:Pt.ofTokens(e.type_symbol),pdbx_PDB_ins_code:Pt.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:n,partial_charge:Pt.ofTokens(e.partial_charge)}}function SG(e,t,r,n,o,i){let{data:s}=r,a=o-n;ct.addToken(e.group_PDB,Tt.trim(r,n,n+6)),Tt.trim(r,n+6,n+11),e.id[e.index]=r.data.substring(r.tokenStart,r.tokenEnd),ct.addToken(e.auth_atom_id,Tt.trim(r,n+12,n+16)),s.charCodeAt(n+16)===32?ct.add(e.label_alt_id,0,0):ct.add(e.label_alt_id,n+16,n+17),ct.addToken(e.auth_comp_id,Tt.trim(r,n+17,n+20)),ct.add(e.auth_asym_id,n+21,n+22),ct.addToken(e.auth_seq_id,Tt.trim(r,n+22,n+26)),s.charCodeAt(n+26)===32?ct.add(e.pdbx_PDB_ins_code,0,0):ct.add(e.pdbx_PDB_ins_code,n+26,n+27),ct.addToken(e.Cartn_x,Tt.trim(r,n+30,n+38)),ct.addToken(e.Cartn_y,Tt.trim(r,n+38,n+46)),ct.addToken(e.Cartn_z,Tt.trim(r,n+46,n+54)),ct.addToken(e.occupancy,Tt.trim(r,n+54,n+60)),a>=66?ct.addToken(e.B_iso_or_equiv,Tt.trim(r,n+60,n+66)):ct.add(e.B_iso_or_equiv,0,0),i&&ct.addToken(e.partial_charge,Tt.trim(r,n+70,n+76)),a>=78&&!i?(Tt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?ct.addToken(e.type_symbol,r):mC(e.type_symbol,s,n+12,n+16)):mC(e.type_symbol,s,n+12,n+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function ose(e,t){let r=()=>[],n=()=>new Float32Array(t),o=()=>ct.create(e,2*t);return{index:0,count:t,id:r(),type_symbol:o(),pdbx_label_atom_id:o(),pdbx_label_alt_id:o(),pdbx_label_comp_id:o(),pdbx_label_asym_id:o(),pdbx_label_seq_id:o(),pdbx_PDB_ins_code:o(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:o(),pdbx_auth_comp_id:o(),pdbx_auth_asym_id:o(),pdbx_auth_atom_id:o()}}function ise(e){let t=Pt.ofTokens(e.pdbx_auth_seq_id),r=Pt.ofTokens(e.pdbx_auth_comp_id),n=Pt.ofTokens(e.pdbx_auth_asym_id),o=Pt.ofTokens(e.pdbx_auth_atom_id),i={id:Pt.ofStrings(e.id),type_symbol:Pt.ofTokens(e.type_symbol),pdbx_label_atom_id:o,pdbx_label_alt_id:Pt.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:r,pdbx_label_asym_id:n,pdbx_label_seq_id:t,pdbx_PDB_ins_code:Pt.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:r,pdbx_auth_asym_id:n,pdbx_auth_atom_id:o};return i["U[1][1]"]=Pt.ofNumbers(e["U[1][1]"]),i["U[2][2]"]=Pt.ofNumbers(e["U[2][2]"]),i["U[3][3]"]=Pt.ofNumbers(e["U[3][3]"]),i["U[1][2]"]=Pt.ofNumbers(e["U[1][2]"]),i["U[1][3]"]=Pt.ofNumbers(e["U[1][3]"]),i["U[2][3]"]=Pt.ofNumbers(e["U[2][3]"]),i}function sse(e,t,r,n,o){let{data:i}=r,s=o-n;Tt.trim(r,n+6,n+11),e.id[e.index]=i.substring(r.tokenStart,r.tokenEnd),ct.addToken(e.pdbx_auth_atom_id,Tt.trim(r,n+12,n+16)),i.charCodeAt(n+16)===32?ct.add(e.pdbx_label_alt_id,0,0):ct.add(e.pdbx_label_alt_id,n+16,n+17),ct.addToken(e.pdbx_auth_comp_id,Tt.trim(r,n+17,n+20)),ct.add(e.pdbx_auth_asym_id,n+21,n+22),ct.addToken(e.pdbx_auth_seq_id,Tt.trim(r,n+22,n+26)),i.charCodeAt(n+26)===32?ct.add(e.pdbx_PDB_ins_code,0,0):ct.add(e.pdbx_PDB_ins_code,n+26,n+27),e["U[1][1]"][e.index]=jh(i,n+28,n+35)/1e4,e["U[2][2]"][e.index]=jh(i,n+35,n+42)/1e4,e["U[3][3]"][e.index]=jh(i,n+42,n+49)/1e4,e["U[1][2]"][e.index]=jh(i,n+49,n+56)/1e4,e["U[1][3]"][e.index]=jh(i,n+56,n+63)/1e4,e["U[2][3]"][e.index]=jh(i,n+63,n+70)/1e4,s>=78?(Tt.trim(r,n+76,n+78),r.tokenStart<r.tokenEnd?ct.addToken(e.type_symbol,r):mC(e.type_symbol,i,n+12,n+16)):mC(e.type_symbol,i,n+12,n+16),e.index++}function ase(e,t,r,n){let o={};for(let _=0,I=n.id.rowCount;_<I;++_)o[n.id.str(_)]=_;let i=_=>e.data.substring(e.indices[2*_],e.indices[2*_+1]),s=[],a=[],l=[],c=[],u=[],d=[],m=[],p=[],h=[],f=[],C=[],g=[],b=[],y=[],x=[11,16,21,26],A=1;for(let _=t;_<r;_++){let I=i(_),T=o[parseInt(I.substr(6,5))],E={};if(T!==void 0)for(let w=0;w<4;++w){let S=parseInt(I.substr(x[w],5));if(Number.isNaN(S))continue;let P=o[S];P!==void 0&&(T>P||E[P]===void 0&&(s.push(`covale${A}`),a.push("covale"),l.push(n.label_asym_id.str(T)),c.push(n.label_seq_id.int(T)),u.push(n.auth_seq_id.int(T)),d.push(n.label_atom_id.str(T)),m.push(n.label_alt_id.str(T)),p.push(n.pdbx_PDB_ins_code.str(T)),h.push(n.label_asym_id.str(P)),f.push(n.label_seq_id.int(P)),C.push(n.auth_seq_id.int(P)),g.push(n.label_atom_id.str(P)),b.push(n.label_alt_id.str(P)),y.push(n.pdbx_PDB_ins_code.str(P)),A+=1))}}let v={id:Pt.ofStrings(s),conn_type_id:Pt.ofStrings(a),ptnr1_label_asym_id:Pt.ofStrings(l),ptnr1_label_seq_id:Pt.ofNumbers(c),ptnr1_auth_seq_id:Pt.ofNumbers(u),ptnr1_label_atom_id:Pt.ofStrings(d),pdbx_ptnr1_label_alt_id:Pt.ofStrings(m),pdbx_ptnr1_PDB_ins_code:Pt.ofStrings(p),ptnr2_label_asym_id:Pt.ofStrings(h),ptnr2_label_seq_id:Pt.ofNumbers(f),ptnr2_auth_seq_id:Pt.ofNumbers(C),ptnr2_label_atom_id:Pt.ofStrings(g),pdbx_ptnr2_label_alt_id:Pt.ofStrings(b),pdbx_ptnr2_PDB_ins_code:Pt.ofStrings(y)};return Hi.ofFields("struct_conn",v)}function lse(e,t,r,n){let o=e.substring(t,r);n.id_code=o.substring(62,66).trim()||void 0,n.dep_date=o.substring(50,59).trim()||void 0,n.classification=o.substring(10,50).trim()||void 0}async function cse(e){let{lines:t}=e,{data:r,indices:n}=t,o=Tt(r),i=!!e.isPdbqt,s=0,a=0;for(let E=0,w=t.count;E<w;E++){let S=n[2*E],P=n[2*E+1];switch(r[S]){case"A":ts(r,S,P,"ATOM  ")?s++:ts(r,S,P,"ANISOU")&&a++;break;case"H":ts(r,S,P,"HETATM")&&s++;break}}let l={},c=rse(r,s),u=ose(r,a),d=new qi,m=[],p=[],h=0,f="",C,g=!1,b=new Set;for(let E=0,w=t.count;E<w;E++){let S=n[2*E],P=n[2*E+1];switch(r[S]){case"A":ts(r,S,P,"ATOM  ")?(h||(h++,f=""+h),SG(c,f,o,S,P,i)):ts(r,S,P,"ANISOU")&&sse(u,f,o,S,P);break;case"C":if(ts(r,S,P,"CRYST1"))m.push(...Kie(e.id||"?",r.substring(S,P)));else if(ts(r,S,P,"CONECT")){let k=E+1;for(;S=n[2*k],P=n[2*k+1],!!ts(r,S,P,"CONECT");)k++;C||(C=[E,k]),E=k-1}else if(ts(r,S,P,"COMPND")){let k=E+1;for(;S=n[2*k],P=n[2*k+1],!!ts(r,S,P,"COMPND");)k++;d.setCompounds(ese(t,E,k)),E=k-1}break;case"H":if(ts(r,S,P,"HEADER"))lse(r,S,P,l);else if(ts(r,S,P,"HETATM"))h||(h++,f=""+h),SG(c,f,o,S,P,i);else if(ts(r,S,P,"HELIX")){let k=E+1;for(;S=n[2*k],P=n[2*k+1],!!ts(r,S,P,"HELIX");)k++;m.push(Qie(t,E,k)),E=k-1}else if(ts(r,S,P,"HETNAM")){let k=E+1;for(;S=n[2*k],P=n[2*k+1],!!ts(r,S,P,"HETNAM");)k++;p.push(...Array.from(tse(t,E,k).entries())),E=k-1}break;case"M":if(ts(r,S,P,"MODEL ")&&(h++,f=""+h),ts(r,S,P,"MTRIX")){let k=E+1;for(;S=n[2*k],P=n[2*k+1],!!ts(r,S,P,"MTRIX");)k++;m.push(...Yie(t,E,k)),E=k-1}break;case"O":break;case"R":if(ts(r,S,P,"REMARK 350")){let k=E+1;for(;S=n[2*k],P=n[2*k+1],!!ts(r,S,P,"REMARK 350");)k++;m.push(...Xie(t,E,k)),E=k-1,g=!0}break;case"S":if(ts(r,S,P,"SHEET")){let k=E+1;for(;S=n[2*k],P=n[2*k+1],!!ts(r,S,P,"SHEET");)k++;m.push(Jie(t,E,k)),E=k-1}break;case"T":ts(r,S,P,"TER")&&b.add(c.index)}}if(l.id_code){let E={id:Pt.ofString(l.id_code)};m.push(Hi.ofFields("entry",E))}if(l.classification){let E={pdbx_keywords:Pt.ofString(l.classification)};m.push(Hi.ofFields("struct_keywords",E))}if(l.dep_date){let E={recvd_initial_deposition_date:Pt.ofString(l.dep_date)};m.push(Hi.ofFields("pdbx_database_status",E))}let y=ue.ofIntTokens(c.auth_seq_id),x=ue.ofStringTokens(c.auth_atom_id),A=ue.ofStringTokens(c.auth_comp_id),v=ue.ofStringTokens(c.auth_asym_id),_=new Is(y,x);_.setNames(p),d.setNames(p);for(let E=0,w=A.rowCount;E<w;++E){let S=A.value(E),P=_c(_.add(S,E).type,S);c.label_entity_id[E]=d.getEntityId(S,P,v.value(E))}let I=nse(c,b,{hasAssemblies:g});i||delete I.partial_charge,C&&m.push(ase(t,C[0],C[1],I));let T={entity:Hi.ofTable("entity",d.getEntityTable()),chem_comp:Hi.ofTable("chem_comp",_.getChemCompTable()),atom_site:Hi.ofFields("atom_site",I),atom_site_anisotrop:Hi.ofFields("atom_site_anisotrop",ise(u))};for(let E of m)T[E.name]=E;return{header:e.id||"PDB",categoryNames:Object.keys(T),categories:T}}var Ag;(function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=ea.create(e.Descriptor)})(Ag||(Ag={}));var IG;(function(e){function t(n){return n?.kind==="pdb"}e.is=t;function r(n){return{kind:"pdb",name:n.id||"",data:n}}e.create=r})(IG||(IG={}));function use(e){return ke.create("Parse PDB",async t=>{var r;await t.update("Converting to mmCIF");let n=await cse(e),o=qr.fromFrame(n,void 0,IG.create(e)),i=as(o.data.db,!0),s=await va(i,o,t),a=(r=n.categories.atom_site)===null||r===void 0?void 0:r.getField("partial_charge");if(a&&s.frameCount===1){let l=s.representative,c=l.atomicHierarchy.atomSourceIndex,d=ue.isIdentity(c)?void 0:c.toArray({array:Int32Array}),m=a.toFloatArray(),p=d?ue.ofFloatArray(ue.mapToArray(c,h=>m[h],Float32Array)):ue.ofFloatArray(m);Ag.Provider.set(l,{data:p,type:"GASTEIGER"})}return s})}function s4e(e){let t=new Array(e.count),r=new Array(e.count),n=new Uint32Array(e.count),o=new Uint32Array(e.count),i=new Array(e.count),s=new qi,a=new Is(e.residueId,e.atomName),l="",c=0,u="",d=0,m=e.segmentName.value(0),p=!1,h=0,f=-1;for(let g=0,b=e.count;g<b;++g){let y=e.residueId.value(g),x=e.segmentName.value(g);if(m!==x?(u=yg(c),c+=1,d=0,p=!0,m=x):p=!1,p||y!==f){let A=e.residueName.value(g),v=_c(a.add(A,g).type,A);!p&&(v!==h||y!==f+1)&&(u=yg(c),c+=1,d=0),l=s.getEntityId(A,v,u),d+=1,f=y,h=v}t[g]=l,r[g]=u,n[g]=d,o[g]=g,i[g]=vm(e.atomName.value(g),e.residueName.value(g))}let C=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ue.ofIntArray(o),label_asym_id:ue.ofStringArray(r),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ue.ofIntArray(n),label_entity_id:ue.ofStringArray(t),occupancy:ue.ofConst(1,e.count,ue.Schema.float),type_symbol:ue.ofStringArray(i),pdbx_PDB_model_num:ue.ofConst(1,e.count,ue.Schema.int)},e.count);return as({entity:s.getEntityTable(),chem_comp:a.getChemCompTable(),atom_site:C})}var AG;(function(e){function t(n){return n?.kind==="psf"}e.is=t;function r(n){return{kind:"psf",name:n.id,data:n}}e.fromPsf=r})(AG||(AG={}));function dse(e){return ke.create("Parse PSF",async t=>{let r=AG.fromPsf(e),n=s4e(e.atoms),{atomIdA:o,atomIdB:i}=e.bonds,s={indexA:ue.ofLambda({value:a=>o.value(a)-1,rowCount:o.rowCount,schema:o.schema}),indexB:ue.ofLambda({value:a=>i.value(a)-1,rowCount:i.rowCount,schema:i.schema}),order:ue.ofConst(1,e.bonds.count,ue.Schema.int)};return X0.create(e.id,n,s,r)})}function mse(e){return Object.keys(e).filter(t=>!isNaN(t)).map(t=>+t).sort((t,r)=>t-r).map(t=>e[t])}function xD(e,t,r){return e&&e[t]!==void 0?e[t]:r}function At(e,...t){return{kind:"alias",aliases:t,symbol:e}}function CD(e,t,...r){return e.info.namespace="molscript-macro",e.id=`molscript-macro.${e.info.name}`,{kind:"macro",symbol:e,translate:t,aliases:[e.info.name,...r]}}function a4e(e){return e.kind==="alias"||e.kind==="macro"}var l4e=[["Core symbols",At(Oe.core.type.bool,"bool"),At(Oe.core.type.num,"num"),At(Oe.core.type.str,"str"),At(Oe.core.type.regex,"regex"),At(Oe.core.type.list,"list"),At(Oe.core.type.set,"set"),At(Oe.core.type.compositeKey,"composite-key"),At(Oe.core.logic.not,"not"),At(Oe.core.logic.and,"and"),At(Oe.core.logic.or,"or"),At(Oe.core.ctrl.if,"if"),At(Oe.core.ctrl.fn,"fn"),At(Oe.core.ctrl.eval,"eval"),At(Oe.core.math.add,"add","+"),At(Oe.core.math.sub,"sub","-"),At(Oe.core.math.mult,"mult","*"),At(Oe.core.math.div,"div","/"),At(Oe.core.math.pow,"pow","**"),At(Oe.core.math.mod,"mod"),At(Oe.core.math.min,"min"),At(Oe.core.math.max,"max"),At(Oe.core.math.cantorPairing,"cantor-pairing"),At(Oe.core.math.sortedCantorPairing,"sorted-cantor-pairing"),At(Oe.core.math.invertCantorPairing,"invert-cantor-pairing"),At(Oe.core.math.floor,"floor"),At(Oe.core.math.ceil,"ceil"),At(Oe.core.math.roundInt,"round"),At(Oe.core.math.trunc,"trunc"),At(Oe.core.math.abs,"abs"),At(Oe.core.math.sign,"sign"),At(Oe.core.math.sqrt,"sqrt"),At(Oe.core.math.cbrt,"cbrt"),At(Oe.core.math.sin,"sin"),At(Oe.core.math.cos,"cos"),At(Oe.core.math.tan,"tan"),At(Oe.core.math.asin,"asin"),At(Oe.core.math.acos,"acos"),At(Oe.core.math.atan,"atan"),At(Oe.core.math.sinh,"sinh"),At(Oe.core.math.cosh,"cosh"),At(Oe.core.math.tanh,"tanh"),At(Oe.core.math.exp,"exp"),At(Oe.core.math.log,"log"),At(Oe.core.math.log10,"log10"),At(Oe.core.math.atan2,"atan2"),At(Oe.core.rel.eq,"eq","="),At(Oe.core.rel.neq,"neq","!="),At(Oe.core.rel.lt,"lt","<"),At(Oe.core.rel.lte,"lte","<="),At(Oe.core.rel.gr,"gr",">"),At(Oe.core.rel.gre,"gre",">="),At(Oe.core.rel.inRange,"in-range"),At(Oe.core.str.concat,"concat"),At(Oe.core.str.match,"regex.match"),At(Oe.core.list.getAt,"list.get"),At(Oe.core.set.has,"set.has"),At(Oe.core.set.isSubset,"set.subset")],["Structure",["Types",At(Oe.structureQuery.type.entityType,"ent-type"),At(Oe.structureQuery.type.authResidueId,"auth-resid"),At(Oe.structureQuery.type.labelResidueId,"label-resid"),At(Oe.structureQuery.type.ringFingerprint,"ringfp"),At(Oe.structureQuery.type.bondFlags,"bond-flags")],["Slots",At(Oe.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",At(Oe.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),At(Oe.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),At(Oe.structureQuery.generator.rings,"sel.atom.rings"),At(Oe.structureQuery.generator.empty,"sel.atom.empty"),At(Oe.structureQuery.generator.all,"sel.atom.all"),At(Oe.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),CD(kb("sel.atom.atoms",ir.Dictionary({0:Et(He.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),Ft.ElementSelection,"A selection of singleton atom sets."),e=>ye.struct.generator.atomGroups({"atom-test":xD(e,0,!0)})),CD(kb("sel.atom.res",ir.Dictionary({0:Et(He.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),Ft.ElementSelection,"A selection of atom sets grouped by residue."),e=>ye.struct.generator.atomGroups({"residue-test":xD(e,0,!0),"group-by":ye.ammp("residueKey")})),CD(kb("sel.atom.chains",ir.Dictionary({0:Et(He.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),Ft.ElementSelection,"A selection of atom sets grouped by chain."),e=>ye.struct.generator.atomGroups({"chain-test":xD(e,0,!0),"group-by":ye.ammp("chainKey")}))],["Modifiers",At(Oe.structureQuery.modifier.queryEach,"sel.atom.query-each"),At(Oe.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),At(Oe.structureQuery.modifier.exceptBy,"sel.atom.except-by"),At(Oe.structureQuery.modifier.unionBy,"sel.atom.union-by"),At(Oe.structureQuery.modifier.union,"sel.atom.union"),At(Oe.structureQuery.modifier.cluster,"sel.atom.cluster"),At(Oe.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),At(Oe.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),At(Oe.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),At(Oe.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",At(Oe.structureQuery.filter.pick,"sel.atom.pick"),At(Oe.structureQuery.filter.first,"sel.atom.first"),At(Oe.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),At(Oe.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),At(Oe.structureQuery.filter.within,"sel.atom.within"),At(Oe.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",At(Oe.structureQuery.combinator.intersect,"sel.atom.intersect"),At(Oe.structureQuery.combinator.merge,"sel.atom.merge"),At(Oe.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",At(Oe.structureQuery.atomSet.atomCount,"atom.set.atom-count"),At(Oe.structureQuery.atomSet.countQuery,"atom.set.count-query"),At(Oe.structureQuery.atomSet.reduce,"atom.set.reduce"),At(Oe.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",At(Oe.structureQuery.atomProperty.core.elementSymbol,"atom.el"),At(Oe.structureQuery.atomProperty.core.vdw,"atom.vdw"),At(Oe.structureQuery.atomProperty.core.mass,"atom.mass"),At(Oe.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),At(Oe.structureQuery.atomProperty.core.x,"atom.x"),At(Oe.structureQuery.atomProperty.core.y,"atom.y"),At(Oe.structureQuery.atomProperty.core.z,"atom.z"),At(Oe.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),At(Oe.structureQuery.atomProperty.core.operatorName,"atom.op-name"),At(Oe.structureQuery.atomProperty.core.operatorKey,"atom.op-key"),At(Oe.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),At(Oe.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),At(Oe.structureQuery.atomProperty.core.atomKey,"atom.key"),At(Oe.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),At(Oe.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),At(Oe.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),At(Oe.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),At(Oe.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),At(Oe.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),At(Oe.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),At(Oe.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),At(Oe.structureQuery.atomProperty.macromolecular.id,"atom.id"),At(Oe.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),At(Oe.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),At(Oe.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),At(Oe.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),At(Oe.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),At(Oe.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),At(Oe.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),At(Oe.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),At(Oe.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),At(Oe.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),At(Oe.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),At(Oe.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),At(Oe.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),At(Oe.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),At(Oe.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),At(Oe.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),At(Oe.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),At(Oe.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),At(Oe.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),At(Oe.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),At(Oe.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),At(Oe.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),At(Oe.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",At(Oe.structureQuery.bondProperty.order,"bond.order"),At(Oe.structureQuery.bondProperty.length,"bond.length"),At(Oe.structureQuery.bondProperty.key,"bond.key"),At(Oe.structureQuery.bondProperty.atomA,"bond.atom-a"),At(Oe.structureQuery.bondProperty.atomB,"bond.atom-b"),CD(kb("bond.is",ir.List(Ft.BondFlag),He.Bool,`Test if the current bond has at least one (or all if partial = false) of the specified flags: ${He.oneOfValues(Ft.BondFlag).join(", ")}`),e=>ye.core.flags.hasAny([ye.struct.bondProperty.flags(),ye.struct.type.bondFlags(mse(e))]))]]],pse=[];function fse(e){for(let t of e)a4e(t)?pse.push(t):t instanceof Array&&fse(t)}fse(l4e);var SD=function(){let e=[],t=Object.create(null),r=vn.create(),n=vn.create();for(let o of pse){for(let s of o.aliases){if(e.push([s,o]),t[s])throw new Error(`Alias '${s}' already in use.`);t[s]=o}let i=o.symbol.args;if(i.kind!=="dictionary"){i.type.kind==="oneof"&&He.oneOfValues(i.type).forEach(s=>vn.add(n,s,s));continue}for(let s of Object.keys(i.map)){isNaN(s)&&vn.add(r,s,s);let a=i.map[s];a.type.kind==="oneof"&&He.oneOfValues(a.type).forEach(l=>vn.add(n,l,l))}}return{symbolList:e,symbolMap:t,namedArgs:r.array,constants:n.array}}();var uzt=SD.constants,dzt=SD.namedArgs,PC=SD.symbolMap,mzt=SD.symbolList;function Z2(e){if(As.isLiteral(e))return e;if(As.isSymbol(e)){if(!PC[e.name])return e;let s=PC[e.name];if(s.kind==="alias")return As.Symbol(PC[e.name].symbol.id);throw s.translate([])}let t=As.isSymbol(e.head)&&!!PC[e.head.name]&&PC[e.head.name].kind==="macro",r=t?e.head:Z2(e.head),n=r!==e.head;if(!e.args)return t?Z2(e.head):n?As.Apply(r):e;let o=!1,i;if(As.isArgumentsArray(e.args)){i=[];for(let s=0,a=e.args.length;s<a;s++){let l=e.args[s],c=Z2(l);l!==c&&(o=!0),i[i.length]=c}if(o||(i=e.args),!t&&!n&&!o)return e}else{i={};for(let s of Object.keys(e.args)){let a=e.args[s],l=Z2(a);a!==l&&(o=!0),i[s]=l}if(!t&&!n&&!o)return e;o||(i=e.args)}if(t){let s=PC[e.head.name];return s.kind!=="macro"?As.Apply(r,i):s.translate(i)}return As.Apply(r,i)}function hse(e){return Z2(e)}var lt=class e{constructor(t){this._=t}parse(t){let r=this.skip(e.eof)._(t,0);return r.status?{success:!0,value:r.value}:{success:!1,index:gse(t,r.furthest),expected:r.expected}}tryParse(t){let r=this.parse(t);if(r.success)return r.value;{let n=d4e(t,r);throw new Error(n)}}or(t){return e.alt(this,t)}trim(t){return this.wrap(t,t)}wrap(t,r){return wG(1,typeof t=="string"?e.string(t):t,this,typeof r=="string"?e.string(r):r)}thru(t){return t(this)}then(t){return wG(1,this,t)}many(){return new e((t,r)=>{let n=[],o;for(;;)if(o=Im(this._(t,r),o),o.status){if(r===o.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");r=o.index,n.push(o.value)}else return Im(Pc(r,n),o)})}times(t,r){let n=typeof r>"u"?t:r;return new e((o,i)=>{let s=[],a,l,c;for(c=0;c<t;c++)if(a=this._(o,i),l=Im(a,l),a.status)i=a.index,s.push(a.value);else return l;for(;c<n&&(a=this._(o,i),l=Im(a,l),a.status);c+=1)i=a.index,s.push(a.value);return Im(Pc(i,s),l)})}result(t){return this.map(()=>t)}atMost(t){return this.times(0,t)}atLeast(t){return e.seq(this.times(t),this.many()).map(r=>[...r[0],...r[1]])}map(t){return new e((r,n)=>{let o=this._(r,n);return o.status?Im(Pc(o.index,t(o.value)),o):o})}skip(t){return wG(0,this,t)}mark(){return e.seq(e.index,this,e.index).map(t=>({start:t[0],value:t[1],end:t[2]}))}node(t){return e.seq(e.index,this,e.index).map(r=>({name:t,start:r[0],value:r[1],end:r[2]}))}sepBy(t){return e.sepBy(this,t)}sepBy1(t){return e.sepBy1(this,t)}lookahead(t){return this.skip(e.lookahead(t))}notFollowedBy(t){return this.skip(e.notFollowedBy(t))}desc(t){return new e((r,n)=>{let o=this._(r,n);return o.status||(o.expected=[t]),o})}fallback(t){return this.or(e.succeed(t))}ap(t){return e.seq(t,this).map(([r,n])=>r(n))}chain(t){return new e((r,n)=>{let o=this._(r,n);if(!o.status)return o;let i=t(o.value);return Im(i._(r,o.index),o)})}};(function(e){function t(I,T,E){let w=[].slice.call(arguments);if(w.length===0)throw new Error("seqMap needs at least one argument");let S=w.pop();return f4e(S),n.apply(null,w).map(function(P){return S.apply(null,P)})}e.seqMap=t;function r(I){let T={};for(let E of Object.keys(I))(function(w){T[w]=x(()=>I[w](T))})(E);return T}e.createLanguage=r;function n(...I){let T=I.length;return new e((E,w)=>{let S,P=new Array(T),k=w;for(let L=0;L<T;L++){if(S=Im(I[L]._(E,k),S),!S.status)return S;P[L]=S.value,k=S.index}return Im(Pc(k,P),S)})}e.seq=n;function o(...I){return I.length===0?m("zero alternates"):new e((E,w)=>{let S;for(let P=0;P<I.length;P++)if(S=Im(I[P]._(E,w),S),S.status)return S;return S})}e.alt=o;function i(I,T){return s(I,T).or(d([]))}e.sepBy=i;function s(I,T){let E=T.then(I).many();return n(I,E).map(w=>[w[0],...w[1]])}e.sepBy1=s;function a(I){let T=`'${I}'`;if(I.length===1){let E=I.charCodeAt(0);return new e((w,S)=>w.charCodeAt(S)===E?Pc(S+1,I):wg(S,T))}return new e((E,w)=>{let S=w+I.length;return E.slice(w,S)===I?Pc(S,I):wg(w,T)})}e.string=a;function l(I){let T=""+I;return T.slice(T.lastIndexOf("/")+1)}function c(I){return RegExp("^(?:"+I.source+")",l(I))}function u(I,T=0){let E=c(I),w=""+I;return new e((S,P)=>{let k=E.exec(S.slice(P));if(k){if(0<=T&&T<=k.length){let R=k[0],N=k[T];return Pc(P+R.length,N)}let L=`invalid match group (0 to ${k.length}) in ${w}`;return wg(P,L)}return wg(P,w)})}e.regexp=u;function d(I){return new e((T,E)=>Pc(E,I))}e.succeed=d;function m(I){return new e((T,E)=>wg(E,I))}e.fail=m;function p(I){if(p4e(I))return new e((T,E)=>{let w=I._(T,E);return w.status&&(w.index=E,w.value=null),w});if(typeof I=="string")return p(a(I));if(I instanceof RegExp)return p(u(I));throw new Error("not a string, regexp, or parser: "+I)}e.lookahead=p;function h(I){return new e((T,E)=>{let w=I._(T,E);return w.status?wg(E,'not "'+T.slice(E,w.index)+'"'):Pc(E,null)})}e.notFollowedBy=h;function f(I){return new e((T,E)=>{let w=T.charAt(E);return E<T.length&&I(w)?Pc(E+1,w):wg(E,"a character "+I)})}e.test=f;function C(I){return f(T=>I.indexOf(T)>=0)}e.oneOf=C;function g(I){return f(T=>I.indexOf(T)<0)}e.noneOf=g;function b(I,T){return f(E=>I<=E&&E<=T).desc(I+"-"+T)}e.range=b;function y(I){return new e((T,E)=>{let w=E;for(;w<T.length&&I(T.charAt(w));)w++;return Pc(w,T.slice(E,w))})}e.takeWhile=y;function x(I){let T=new e((E,w)=>{let S=I()._;return T._=S,S(E,w)});return T}e.lazy=x;function A(){return m("empty")}e.empty=A,e.index=new e(function(I,T){return Pc(T,gse(I,T))}),e.anyChar=new e((I,T)=>T>=I.length?wg(T,"any character"):Pc(T+1,I.charAt(T))),e.all=new e(function(I,T){return Pc(I.length,I.slice(T))}),e.eof=new e(function(I,T){return T<I.length?wg(T,"EOF"):Pc(T,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=a("\r"),e.lf=a(`
`),e.crlf=a(`\r
`),e.newline=o(e.crlf,e.lf,e.cr).desc("newline"),e.end=o(e.newline,e.eof);function v(I){return d(I)}e.of=v;function _(I){return u(I)}e.regex=_})(lt||(lt={}));function wG(e,...t){let r=t.length;return new lt((n,o)=>{let i,s,a=o;for(let l=0;l<r;l++){if(i=Im(t[l]._(n,a),i),!i.status)return i;e===l&&(s=i.value),a=i.index}return Im(Pc(a,s),i)})}function Pc(e,t){return{status:!0,index:e,value:t}}function wg(e,t){return{status:!1,furthest:e,expected:[t]}}function Im(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;let r=e.furthest===t.furthest?m4e(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:r}}function gse(e,t){let r=e.slice(0,t).split(`
`),n=r.length,o=r[r.length-1].length+1;return{offset:t,line:n,column:o}}function c4e(e){return e.length===1?e[0]:"one of "+e.join(", ")}function u4e(e,t){let r=t.index,n=r.offset;if(n===e.length)return", got the end of the input";let o=n>0?"'...":"'",i=e.length-n>12?"...'":"'";return` at line ${r.line} column ${r.column}, got ${o}${e.slice(n,n+12)}${i}`}function d4e(e,t){return`expected ${c4e(t.expected)}${u4e(e,t)}`}function m4e(e,t){let r=e.length,n=t.length;if(r===0)return t;if(n===0)return e;let o=new Set,i=[];for(let s=0;s<r;s++)o.has(e[s])||(i[i.length]=e[s],o.add(e[s]));for(let s=0;s<n;s++)o.has(t[s])||(i[i.length]=t[s],o.add(t[s]));return i.sort(),i}function p4e(e){return e instanceof lt}function f4e(e){if(typeof e!="function")throw new Error("not a function: "+e)}function yse(e){return _G.parse(e)}var _G;(function(e){let t;(function(x){function A(T){return{kind:"string",value:T}}x.str=A;function v(T){return{kind:"symbol",value:T}}x.symb=v;function _(T,E){return{kind:"list",bracket:T,nodes:E}}x.list=_;function I(T){return{kind:"comment",value:T}}x.comment=I})(t||(t={}));let r=lt.regexp(/[\n\r\s]*/),n=lt.lazy(()=>lt.alt(o,d,i,s).trim(r)),o=lt.takeWhile(x=>x!=="`").trim("`").map(t.str),i=lt.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),s=lt.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),a=n.many(),l=a.wrap("(",")").map(x=>t.list("(",x)),c=a.wrap("[","]").map(x=>t.list("[",x)),u=a.wrap("{","}").map(x=>t.list("{",x)),d=lt.alt(l,c,u),m=n.many();function p(x){return m.tryParse(x)}function h(x){switch(x.kind){case"string":return x.value;case"symbol":{let A=x.value;if(A.length>1)switch(A.charAt(0)){case".":return ye.atomName(A.substr(1));case"_":return ye.struct.type.elementSymbol([A.substr(1)])}return A==="true"?!0:A==="false"?!1:b(A)?+A:As.Symbol(A)}case"list":switch(x.bracket){case"[":return ye.core.type.list(g(x.nodes).map(h));case"{":return ye.core.type.set(g(x.nodes).map(h));case"(":{if(x.nodes[0].kind==="comment")throw new Error("Invalid expression");let A=h(x.nodes[0]);return As.Apply(A,f(x.nodes))}default:Sr(x.bracket)}default:Sr(x)}}function f(x){if(x.length<=1)return;if(!C(x)){let I=[];for(let T=1,E=x.length;T<E;T++){let w=x[T];w.kind!=="comment"&&(I[I.length]=h(w))}return I}let A={},v=!0,_=0;for(let I=1,T=x.length;I<T;I++){let E=x[I];if(E.kind!=="comment")if(E.kind==="symbol"&&E.value.length>1&&E.value.charAt(0)===":"){let w=E.value.substr(1);for(++I;I<T&&x[I].kind==="comment";)I++;if(I>=T)throw new Error(`There must be a value foolowed a named arg ':${w}'.`);if(x[I].kind==="comment")throw new Error("Invalid expression");A[w]=h(x[I]),isNaN(+w)&&(v=!1)}else A[_++]=h(E)}if(v){let I=Object.keys(A).map(E=>+E).sort((E,w)=>E-w),T=!0;for(let E=0,w=I.length;E<w;E++)if(I[E]!==E){T=!1;break}if(T){let E=[];for(let w=0,S=I.length;w<S;w++)E[w]=A[w];return E}}return A}function C(x){for(let A=1,v=x.length;A<v;A++){let _=x[A];if(_.kind==="symbol"&&_.value.length>1&&_.value.charAt(0)===":")return!0}return!1}function g(x){let A=!1;for(let v=0,_=x.length;v<_;v++)if(x[v].kind==="comment"){A=!0;break}return A?x.filter(v=>v.kind!=="comment"):x}function b(x){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(x)&&!isNaN(+x)}function y(x){let A=p(x),v=[];for(let _ of A)_.kind!=="comment"&&(v[v.length]=h(_));return v}e.parse=y})(_G||(_G={}));var $o=ye;function rl(e,t,r){let n=lt.lazy(()=>lt.seq(e,n).map(o=>r(...o)).or(t));return n}function K2(e,t,r){return lt.seqMap(t,e.many(),(n,o)=>o.reduce((i,s)=>r(s,i),n))}function La(e,t,r){return lt.seqMap(t,lt.seq(e,t).many(),(n,o)=>o.reduce((i,s)=>{let[a,l]=s;return r(a,i,l)},n))}function sy(e,t){return e.reduce((n,o)=>{let i=o.isUnsupported?_g(`operator '${o.name}' not supported`):o.map;return o.type(o.rule,n,i)},t)}function Am(e,t=0){return lt.optWhitespace.then(lt.regexp(e,t).skip(lt.optWhitespace))}function au(e,t=0){return lt.regexp(e,t).skip(lt.optWhitespace)}function X2(e,t=0){return lt.optWhitespace.then(lt.regexp(e,t))}function ID(e,t){let r=t?`${e}|${Yh(t)}`:e,n=RegExp(`(${r})\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF`,"i");return Am(n,2).map(parseFloat)}function _g(e){return function(){throw new Error(e)}}function Y2(e){return e.length===1?e[0]:e.length>1?$o.core.logic.and(e):void 0}function bse(e){return e.length===1?e[0]:e.length>1?$o.core.logic.or(e):void 0}function TG(e,t){if(t&&t.op!==void 0&&t.val!==void 0){let r=[e,t.val];switch(t.op){case"=":return $o.core.rel.eq(r);case"!=":return $o.core.rel.neq(r);case">":return $o.core.rel.gr(r);case"<":return $o.core.rel.lt(r);case">=":return $o.core.rel.gre(r);case"<=":return $o.core.rel.lte(r);default:throw new Error(`operator '${t.op}' not supported`)}}else return t&&t.flags!==void 0?$o.core.flags.hasAny([e,t.flags]):t&&t.min!==void 0&&t.max!==void 0?$o.core.rel.inRange([e,t.min,t.max]):Array.isArray(t)?t.length>1?$o.core.set.has([$o.core.type.set(t),e]):$o.core.rel.eq([e,t[0]]):$o.core.rel.eq([e,t])}function Dl(e){return $o.struct.generator.queryInSelection({0:e,query:$o.struct.generator.all(),"in-complement":!0})}function $u(e,t){return e.length<t.length?1:-1}function EG(e,t){let r=(t?[e].concat(t):[e]).sort($u).map(Yh).join("|");return RegExp(`${r}`,"i")}function xse(e){let t={};return Object.keys(e).sort($u).forEach(r=>{let n=e[r],o=_g(`property '${r}' not supported`),i=lt.regexp(n.regex).map(s=>(n.isUnsupported&&o(),TG(n.property,n.map(s))));n.isNumeric||(t[r]=i)}),t}function AD(e){let t=[];return Object.keys(e).sort($u).forEach(r=>{let n=e[r],o=_g(`property '${r}' not supported`),i=lt.regexp(n.regex).map(l=>(n.isUnsupported&&o(),TG(n.property,n.map(l)))),s=lt.regexp(EG(r,n.abbr)).trim(lt.optWhitespace),a=l=>$o.struct.generator.atomGroups({[n.level]:l});n.isNumeric?t.push(s.then(lt.seq(lt.regexp(/>=|<=|=|!=|>|</).trim(lt.optWhitespace),lt.regexp(n.regex).map(n.map))).map(l=>(n.isUnsupported&&o(),TG(n.property,{op:l[0],val:l[1]}))).map(a)):t.push(s.then(i).map(a))}),t}function DC(e){let t=[];return Object.keys(e).sort($u).forEach(r=>{let n=e[r],o=n.map?n.map:_g(`keyword '${r}' not supported`),i=lt.regexp(EG(r,n.abbr)).map(o);t.push(i)}),t}function Cse(e,t){let r=[],n=lt.regexp(/\(\s*/),o=lt.regexp(/\s*\)/);return Object.keys(e).sort($u).forEach(i=>{let s=e[i],a=s.map?s.map:_g(`function '${i}' not supported`),l=lt.regexp(new RegExp(i,"i")).skip(n).then(t).skip(o).map(a);r.push(l)}),r}function Q2(e,t){let r=[];return Object.keys(e).sort($u).forEach(n=>{let o=e[n],i=_g(`property '${n}' not supported`),s=lt.regexp(EG(n,o.abbr)).lookahead(t).map(()=>(o.isUnsupported&&i(),o.property));r.push(s)}),r}function kC(e,t,r,n){let o=[];for(let i in e)o.push(i),e[i].abbr&&o.push(...e[i].abbr);for(let i in t)o.push(i),t[i].abbr&&o.push(...t[i].abbr);return r.forEach(i=>{o.push(i.name),i.abbr&&o.push(...i.abbr)}),o}function Dd(e){return $o.core.type.set(e.map($o.atomName))}function kd(e){return $o.struct.generator.queryInSelection({0:e,query:$o.struct.generator.all()})}function Vb(e,t,r){switch(e.head.name){case"structure-query.atom-property.macromolecular.label_atom_id":return $o.atomName(t);case"structure-query.atom-property.core.element-symbol":return $o.es(t);case"structure-query.atom-property.macromolecular.secondary-structure-flags":return r&&(t=[r[t.toUpperCase()]||"none"]),$o.struct.type.secondaryStructureFlags([t]);default:return t}}var vse="structure-query.atom-property.macromolecular.",h4e=["entityKey","label_entity_id","entityType"],g4e=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"],y4e=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"];function Sse(e){if(e.head.name.startsWith(vse)){let t=e.head.name.substr(vse.length);if(h4e.includes(t))return"entity-test";if(g4e.includes(t))return"chain-test";if(y4e.includes(t))return"residue-test"}return"atom-test"}var v4e=["structure-query.atom-property.macromolecular.secondary-structure-flags"];function Ise(e,t){if(v4e.includes(e.head.name)){let r=t[0].head,n=[];return t.forEach(o=>n.push(...o.args[0])),$o.core.flags.hasAny([e,{head:r,args:n}])}else{if(t.length===1)return $o.core.rel.eq([e,t[0]]);if(t.length>1)return $o.core.set.has([$o.core.type.set(t),e])}}function Dn(e){return $o.struct.generator.atomGroups({"residue-test":$o.core.set.has([$o.core.type.set(e),$o.ammp("label_comp_id")])})}var Os=ye,wm=/[-+]?[0-9]*\.?[0-9]+/,J2=/[0-9]+/;function Cr(e){return e}var b4e={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"};function PG(e){if(e.head){if(e.head.name&&e.head.name==="core.type.regex"&&(e=e.args[0].replace(/^\^|\$$/g,"")),e=b4e[e.toString().toLowerCase()]||"none",["dna","rna","carbohydrate"].indexOf(e)!==-1)throw new Error("values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property");return Os.struct.type.secondaryStructureFlags([e])}}var DG={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:wm,map:e=>parseFloat(e),level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:wm,map:e=>parseFloat(e),level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:Cr,level:"atom-test",property:Os.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:Cr,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:!0,regex:J2,map:e=>parseInt(e),level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:!0,regex:J2,map:e=>parseInt(e),level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:e=>Os.atomName(e),level:"atom-test",property:Os.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:!0,regex:J2,map:e=>parseInt(e),level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:e=>Os.atomName(e),level:"atom-test",property:Os.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:!0,regex:wm,map:e=>parseFloat(e),level:"atom-test",property:Os.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:!0,regex:wm,map:e=>parseFloat(e),level:"atom-test",property:Os.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:!0,regex:wm,map:e=>parseFloat(e),level:"atom-test",property:Os.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:!0,regex:J2,map:e=>parseInt(e),level:"atom-test",property:Os.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:!0,regex:wm,map:e=>parseFloat(e),level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:J2,map:e=>parseInt(e),level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:Cr,level:"chain-test",property:Os.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:e=>Os.es(e),level:"atom-test",property:Os.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:e=>parseInt(e),level:"atom-test",property:Os.acp("atomicNumber")},eta:{"@desc":`Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' "RNA worm" graph.`,"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},theta:{"@desc":`Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' "RNA worm" graph.`,"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:wm,map:e=>parseFloat(e),level:"atom-test",property:Os.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:Cr,level:"residue-test",property:Os.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:Cr,level:"residue-test",property:Os.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:Cr,level:"atom-test",property:Os.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:wm,map:e=>parseFloat(e),level:"atom-test",property:Os.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:wm,map:e=>parseFloat(e),level:"atom-test",property:Os.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:!0,regex:wm,map:e=>parseFloat(e),level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:e=>parseInt(e),level:"residue-test",property:Os.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"',"structure=3"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:Cr,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"',"substructure =9"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:Cr,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:wm,map:e=>parseFloat(e),level:"atom-test",property:Os.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:wm,map:e=>parseFloat(e),level:"atom-test",property:Os.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Cr,level:"atom-test"}};var Ase=ye,kG=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:rl,rule:lt.alt(lt.regex(/NOT/i).skip(lt.whitespace),lt.string("!").skip(lt.optWhitespace)),map:(e,t)=>Dl(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:La,rule:Am(/AND|&/i),map:(e,t,r)=>Ase.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:La,rule:Am(/OR|\||,/i),map:(e,t,r)=>Ase.struct.combinator.merge([t,r])}];var tt=ye,Ri={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"],nucleic:["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]},wse={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],protein:["C","N","CA"]};function ew(){return tt.struct.combinator.merge([tt.struct.generator.atomGroups({"residue-test":tt.core.set.has([tt.set(...Ri.nucleic),tt.ammp("label_comp_id")])}),tt.struct.filter.pick({0:tt.struct.generator.atomGroups({"group-by":tt.ammp("residueKey")}),test:tt.core.logic.and([tt.core.rel.eq([tt.struct.atomSet.atomCount(),1]),tt.core.rel.eq([tt.ammp("label_atom_id"),tt.atomName("P")])])}),tt.struct.filter.pick({0:tt.struct.generator.atomGroups({"group-by":tt.ammp("residueKey")}),test:tt.core.logic.or([tt.core.set.isSubset([Dd(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),tt.ammpSet("label_atom_id")]),tt.core.set.isSubset([Dd(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),tt.ammpSet("label_atom_id")])])})])}function x4e(){return tt.struct.generator.atomGroups({"residue-test":tt.core.set.has([tt.set(...Ri.amino),tt.ammp("label_comp_id")])})}function C4e(){return tt.struct.combinator.merge([tt.struct.modifier.intersectBy({0:tt.struct.generator.atomGroups({"residue-test":tt.core.set.has([tt.core.type.set(Ri.amino),tt.ammp("label_comp_id")])}),by:tt.struct.generator.atomGroups({"atom-test":tt.core.set.has([tt.core.type.set(wse.protein),tt.ammp("label_atom_id")])})}),tt.struct.modifier.intersectBy({0:tt.struct.generator.atomGroups({"residue-test":tt.core.set.has([tt.core.type.set(Ri.nucleic),tt.ammp("label_comp_id")])}),by:tt.struct.generator.atomGroups({"atom-test":tt.core.set.has([tt.core.type.set(wse.nucleic),tt.ammp("label_atom_id")])})})])}var MG={all:{"@desc":"all atoms; same as *",abbr:["*"],map:()=>tt.struct.generator.all()},bonded:{"@desc":"covalently bonded",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.rel.gr([tt.struct.atomProperty.core.bondCount({flags:tt.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.rel.gr([tt.struct.atomProperty.core.bondCount({flags:tt.struct.type.bondFlags()}),0])})},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:()=>tt.struct.generator.empty()},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.set.has([tt.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(tt.es)),tt.acp("elementSymbol")])})},metal:{"@desc":"!nonmetal",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.logic.not([tt.core.set.has([tt.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(tt.es)),tt.acp("elementSymbol")])])})},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.set.has([tt.set(...["Li","Na","K","Rb","Cs","Fr"].map(tt.es)),tt.acp("elementSymbol")])})},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.set.has([tt.set(...["Be","Mg","Ca","Sr","Ba","Ra"].map(tt.es)),tt.acp("elementSymbol")])})},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.set.has([tt.set(...["He","Ne","Ar","Kr","Xe","Rn"].map(tt.es)),tt.acp("elementSymbol")])})},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.set.has([tt.set(...["B","Si","Ge","As","Sb","Te"].map(tt.es)),tt.acp("elementSymbol")])})},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.logic.or([tt.core.rel.inRange([tt.acp("atomicNumber"),21,30]),tt.core.rel.inRange([tt.acp("atomicNumber"),39,48]),tt.core.rel.inRange([tt.acp("atomicNumber"),72,80]),tt.core.rel.inRange([tt.acp("atomicNumber"),104,112]),tt.core.set.has([tt.set(57,89),tt.acp("atomicNumber")])])})},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.rel.inRange([tt.acp("atomicNumber"),57,71])})},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.rel.inRange([tt.acp("atomicNumber"),89,103])})},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.rel.gr([tt.struct.atomProperty.core.bondCount({flags:tt.struct.type.bondFlags(["aromatic"])}),0])})},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":`any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, ', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.`,map:()=>ew()},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:()=>tt.struct.modifier.intersectBy({0:ew(),by:tt.struct.combinator.merge([tt.struct.generator.atomGroups({"residue-test":tt.core.set.has([tt.set("A","G","I","DA","DG","DI","+A","+G","+I"),tt.ammp("label_comp_id")])}),tt.struct.filter.pick({0:tt.struct.generator.atomGroups({"group-by":tt.ammp("residueKey")}),test:tt.core.set.isSubset([Dd(["N7","C8","N9"]),tt.ammpSet("label_atom_id")])})])})},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:()=>tt.struct.modifier.intersectBy({0:ew(),by:tt.struct.combinator.merge([tt.struct.generator.atomGroups({"residue-test":tt.core.set.has([tt.set("C","T","U","DC","DT","DU","+C","+T","+U"),tt.ammp("label_comp_id")])}),tt.struct.filter.pick({0:tt.struct.generator.atomGroups({"group-by":tt.ammp("residueKey")}),test:tt.core.logic.or([tt.core.set.has([tt.ammpSet("label_atom_id"),tt.atomName("O2*")]),tt.core.set.has([tt.ammpSet("label_atom_id"),tt.atomName("O2'")])])})])})},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:()=>tt.struct.modifier.intersectBy({0:ew(),by:tt.struct.combinator.merge([tt.struct.generator.atomGroups({"residue-test":tt.core.set.has([tt.set("DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"),tt.ammp("label_comp_id")])}),tt.struct.filter.pick({0:tt.struct.generator.atomGroups({"group-by":tt.ammp("residueKey")}),test:tt.core.logic.not([tt.core.logic.or([tt.core.set.has([tt.ammpSet("label_atom_id"),tt.atomName("O2*")]),tt.core.set.has([tt.ammpSet("label_atom_id"),tt.atomName("O2'")])])])})])})},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:()=>tt.struct.modifier.intersectBy({0:ew(),by:tt.struct.combinator.merge([tt.struct.generator.atomGroups({"residue-test":tt.core.set.has([tt.set("G","C","A","U","I","+U","+I"),tt.ammp("label_comp_id")])}),tt.struct.filter.pick({0:tt.struct.generator.atomGroups({"group-by":tt.ammp("residueKey")}),test:tt.core.logic.or([tt.core.set.has([tt.ammpSet("label_atom_id"),tt.atomName("O2*")]),tt.core.set.has([tt.ammpSet("label_atom_id"),tt.atomName("O2'")])])})])})},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).',map:()=>x4e()},acidic:{"@desc":"ASP GLU",map:()=>Dn(Ri.acidic)},acyclic:{"@desc":"amino and not cyclic",map:()=>tt.struct.modifier.intersectBy({0:Dn(Ri.amino),by:Dl(Dn(Ri.cyclic))})},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:()=>Dn(Ri.aliphatic)},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:()=>Dn(Ri.amino)},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:()=>Dn(Ri.aromatic)},basic:{"@desc":"ARG HIS LYS",map:()=>Dn(Ri.basic)},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:()=>Dn(Ri.buried)},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:()=>Dn(Ri.acidic.concat(Ri.basic))},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:()=>Dn(Ri.cyclic)},helix:{"@desc":"secondary structure-related.",map:()=>tt.struct.generator.atomGroups({"residue-test":tt.core.flags.hasAny([tt.struct.type.secondaryStructureFlags(["helix"]),tt.ammp("secondaryStructureFlags")])})},helixalpha:{"@desc":"secondary structure-related.",map:()=>tt.struct.generator.atomGroups({"residue-test":tt.core.flags.hasAny([tt.struct.type.secondaryStructureFlags(["alpha"]),tt.ammp("secondaryStructureFlags")])})},helix310:{"@desc":"secondary structure-related.",map:()=>tt.struct.generator.atomGroups({"residue-test":tt.core.flags.hasAny([tt.struct.type.secondaryStructureFlags(["3-10"]),tt.ammp("secondaryStructureFlags")])})},helixpi:{"@desc":"secondary structure-related.",map:()=>tt.struct.generator.atomGroups({"residue-test":tt.core.flags.hasAny([tt.struct.type.secondaryStructureFlags(["pi"]),tt.ammp("secondaryStructureFlags")])})},hetero:{"@desc":"PDB atoms designated as HETATM",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.ammp("isHet")})},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:()=>Dn(Ri.hydrophobic)},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:()=>Dn(Ri.large)},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:()=>Dn(Ri.medium)},negative:{"@desc":"same as acidic -- ASP GLU",map:()=>Dn(Ri.acidic)},neutral:{"@desc":"amino and not (acidic or basic)",map:()=>tt.struct.modifier.intersectBy({0:Dn(Ri.amino),by:Dl(Dn(Ri.acidic.concat(Ri.basic)))})},polar:{"@desc":"amino and not hydrophobic",map:()=>tt.struct.modifier.intersectBy({0:Dn(Ri.amino),by:Dl(Dn(Ri.hydrophobic))})},positive:{"@desc":"same as basic -- ARG HIS LYS",map:()=>Dn(Ri.basic)},sheet:{"@desc":"secondary structure-related",map:()=>tt.struct.generator.atomGroups({"residue-test":tt.core.flags.hasAny([tt.struct.type.secondaryStructureFlags(["sheet"]),tt.ammp("secondaryStructureFlags")])})},small:{"@desc":"ALA GLY SER",map:()=>Dn(Ri.small)},surface:{"@desc":"amino and not buried",map:()=>tt.struct.modifier.intersectBy({0:Dn(Ri.amino),by:Dl(Dn(Ri.buried))})},turn:{"@desc":"secondary structure-related",map:()=>tt.struct.generator.atomGroups({"residue-test":tt.core.flags.hasAny([tt.struct.type.secondaryStructureFlags(["turn"]),tt.ammp("secondaryStructureFlags")])})},alpha:{"@desc":"(*.CA)",map:()=>tt.struct.generator.atomGroups({"atom-test":tt.core.rel.eq([tt.atomName("CA"),tt.ammp("label_atom_id")])})},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"],map:()=>C4e()},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}};var Kr=ye,S4e=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:La,rule:lt.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:(e,t,r)=>{let n;if(t==="structure"?n=Kr.core.flags.hasAny([Kr.ammp("secondaryStructureFlags"),PG(r)]):r==="structure"?n=Kr.core.flags.hasAny([Kr.ammp("secondaryStructureFlags"),PG(t)]):t.head!==void 0?t.head.name==="core.type.regex"&&(n=Kr.core.str.match([t,Kr.core.type.str([r])])):r.head!==void 0?r.head.name==="core.type.regex"&&(n=Kr.core.str.match([r,Kr.core.type.str([t])])):e.toUpperCase()==="LIKE"&&(t.head?n=Kr.core.str.match([Kr.core.type.regex([`^${r}$`,"i"]),Kr.core.type.str([t])]):n=Kr.core.str.match([Kr.core.type.regex([`^${t}$`,"i"]),Kr.core.type.str([r])])),!n)switch(t.head&&(r=Vb(t,r)),r.head&&(t=Vb(r,t)),e){case"=":n=Kr.core.rel.eq([t,r]);break;case"!=":n=Kr.core.rel.neq([t,r]);break;case">":n=Kr.core.rel.gr([t,r]);break;case"<":n=Kr.core.rel.lt([t,r]);break;case">=":n=Kr.core.rel.gre([t,r]);break;case"<=":n=Kr.core.rel.lte([t,r]);break;default:throw new Error(`value operator '${e}' not supported`)}return Kr.struct.generator.atomGroups({"atom-test":n})}}];function I4e(e){let[t,r,n,o,i,s,a]=e[1],l={};i&&(l["chain-test"]=Kr.core.rel.eq([Kr.ammp("auth_asym_id"),i]));let c=[];t&&c.push(Kr.core.rel.eq([Kr.ammp("label_comp_id"),t])),r&&c.push(Kr.core.logic.and([Kr.core.rel.gre([Kr.ammp("auth_seq_id"),r[0]]),Kr.core.rel.lte([Kr.ammp("auth_seq_id"),r[1]])])),n&&c.push(Kr.core.rel.eq([Kr.ammp("auth_seq_id"),n])),o&&c.push(Kr.core.rel.eq([Kr.ammp("pdbx_PDB_ins_code"),o])),c.length&&(l["residue-test"]=Y2(c));let u=[];return s&&u.push(Kr.core.rel.eq([Kr.ammp("auth_atom_id"),s])),a&&u.push(Kr.core.rel.eq([Kr.ammp("label_alt_id"),a])),u.length&&(l["atom-test"]=Y2(u)),Kr.struct.generator.atomGroups(l)}var A4e=lt.createLanguage({Integer:()=>lt.regexp(/-?[0-9]+/).map(Number).desc("integer"),Parens:function(e){return lt.alt(e.Parens,e.Operator,e.Expression).wrap(lt.regexp(/\(\s*/),lt.regexp(/\s*\)/))},Expression:function(e){return lt.alt(e.Keywords,e.AtomExpression.map(I4e),e.Within.map(t=>Kr.struct.modifier.includeSurroundings({0:t[1],radius:t[0]})),e.ValueQuery,e.Element.map(t=>Kr.struct.generator.atomGroups({"atom-test":Kr.core.rel.eq([Kr.acp("elementSymbol"),Kr.struct.type.elementSymbol(t)])})),e.Resname.map(t=>Kr.struct.generator.atomGroups({"residue-test":Kr.core.rel.eq([Kr.ammp("label_comp_id"),t])})))},Operator:function(e){return sy(kG,lt.alt(e.Parens,e.Expression))},AtomExpression:function(e){return lt.seq(lt.lookahead(e.AtomPrefix),lt.seq(e.BracketedResname.or(lt.of(null)),e.ResnoRange.or(lt.of(null)),e.Resno.or(lt.of(null)),e.Inscode.or(lt.of(null)),e.Chainname.or(lt.of(null)),e.Atomname.or(lt.of(null)),e.Altloc.or(lt.of(null)),e.Model.or(lt.of(null)))).desc("expression")},AtomPrefix:()=>lt.regexp(/[\[0-9:^%/.-]/).desc("atom-prefix"),Chainname:()=>lt.regexp(/:([A-Za-z]{1,3})/,1).desc("chainname"),Model:()=>lt.regexp(/\/([0-9]+)/,1).map(Number).desc("model"),Element:()=>lt.regexp(/_([A-Za-z]{1,3})/,1).desc("element"),Atomname:()=>lt.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(Kr.atomName).desc("atomname"),Resname:()=>lt.regexp(/[a-zA-Z0-9]{1,4}/).desc("resname"),Resno:e=>e.Integer.desc("resno"),Altloc:()=>lt.regexp(/%([a-zA-Z0-9])/,1).desc("altloc"),Inscode:()=>lt.regexp(/\^([a-zA-Z0-9])/,1).desc("inscode"),BracketedResname:()=>lt.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc("bracketed-resname"),ResnoRange:e=>lt.seq(e.Integer.skip(lt.seq(lt.optWhitespace,lt.string("-"),lt.optWhitespace)),e.Integer).desc("resno-range"),Within:e=>lt.regexp(/within/i).skip(lt.regexp(/\s*\(\s*/)).then(lt.seq(e.Integer.skip(lt.regexp(/\s*,\s*/)),e.Query)).skip(lt.regexp(/\)/)),Keywords:()=>lt.alt(...DC(MG)).desc("keyword"),Query:function(e){return lt.alt(e.Operator,e.Parens,e.Expression).trim(lt.optWhitespace)},Number:function(){return lt.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){let e=kC(DG,MG,kG).sort($u).map(Yh).join("|");return lt.alt(lt.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),lt.regexp(/'((?:[^"\\]|\\.)*)'/,1),lt.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(t=>Kr.core.type.regex([`^${t}$`,"i"]))).desc("string")},Value:function(e){return lt.alt(e.Number,e.String)},ValueParens:function(e){return lt.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(lt.string("("),lt.string(")"))},ValuePropertyNames:function(){return lt.alt(...Q2(DG,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(e){return sy(S4e,lt.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return lt.alt(e.Value,e.ValuePropertyNames)},ValueQuery:function(e){return lt.alt(e.ValueOperator.map(t=>{if(t.head){if(t.head.name.startsWith("structure-query.generator"))return t}else if(typeof t=="string"&&t.length<=4)return Kr.struct.generator.atomGroups({"residue-test":Kr.core.rel.eq([Kr.ammp("label_comp_id"),t])});throw new Error(`values must be part of an comparison, value '${t}'`)}))}}),_se=e=>A4e.Query.tryParse(e);var kl=ye,wD=/[-+]?[0-9]*\.?[0-9]+/;function w4e(e){return e.split("+").map(kl.atomName)}function MC(e){return e.split("+").map(t=>t.replace(/^["']|["']$/g,""))}function RG(e){if(e.includes("-")&&e.includes("+")){let t=e.split("+").map(n=>n.replace(/^["']|["']$/g,"")),r=[];return t.forEach(n=>{if(n.includes("-")&&!n.startsWith("-")){let[o,i]=n.split("-").map(s=>parseInt(s));for(let s=o;s<=i;s++)r.push(s)}else if(n.includes("-")&&n.startsWith("-")&&n.match(/[0-9]+-[-0-9]+/)){let o=-parseInt(n.split("-")[1]),i;n.includes("--")?i=-parseInt(n.split("-")[3]):i=parseInt(n.split("-")[2]);for(let s=o;s<=i;s++)r.push(s)}else n.includes("-")&&n.startsWith("-")&&n.match(/[0-9]+-[-0-9]+/),r.push(parseInt(n))}),r}else if(e.includes("-")&&!e.includes("+")){let t=[];if(e.startsWith("-"))if(e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/)){let r=-parseInt(e.split("-")[1]),n;e.includes("--")?n=-parseInt(e.split("-")[3]):n=parseInt(e.split("-")[2]);for(let o=r;o<=n;o++)t.push(o)}else e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/),t.push(parseInt(e));else{let[r,n]=e.split("-").map(o=>parseInt(o));for(let o=r;o<=n;o++)t.push(o)}return t}else return!e.includes("-")&&e.includes("+")?MC(e).map(t=>parseInt(t)):[parseInt(e)]}function _4e(e){return e.split("+").map(kl.struct.type.elementSymbol)}var T4e={H:"helix",S:"beta",L:"none"};function E4e(e){return{flags:kl.struct.type.secondaryStructureFlags(e.toUpperCase().split("+").map(t=>T4e[t]||"none"))}}var tw={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:_4e,level:"atom-test",property:kl.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:w4e,level:"atom-test",property:kl.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:MC,level:"residue-test",property:kl.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:RG,level:"residue-test",property:kl.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:MC,level:"atom-test",property:kl.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:MC,level:"chain-test",property:kl.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:MC,level:"chain-test",property:kl.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:!0,abbr:["f."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:!0,abbr:["nt."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:!0,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:MC,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],regex:/[0-9+-]+/,map:RG,level:"atom-test",property:kl.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],regex:/[0-9+-]+/,map:RG,level:"atom-test",property:kl.ammp("id")},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:E4e,level:"residue-test",property:kl.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:!0,abbr:[],regex:wD,map:e=>parseFloat(e),level:"atom-test",property:kl.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:!0,abbr:[],regex:wD,map:e=>parseFloat(e),level:"atom-test",property:kl.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:!0,abbr:["fc."],regex:wD,map:e=>parseFloat(e),level:"atom-test",property:kl.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:!0,isNumeric:!0,abbr:["pc."],regex:wD,map:e=>parseFloat(e),level:"atom-test"},elem:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["elem N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>kl.es(e),level:"atom-test",property:kl.acp("elementSymbol")}};var Ur=ye,BG=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:rl,rule:lt.alt(lt.regexp(/NOT/i).skip(lt.whitespace),lt.string("!").skip(lt.optWhitespace)),map:(e,t)=>Dl(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:La,rule:Am(/AND|&/i),map:(e,t,r)=>Ur.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:La,rule:Am(/OR|\|/i),map:(e,t,r)=>Ur.struct.combinator.merge([t,r])},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:La,rule:Am(/IN/i),map:(e,t,r)=>Ur.struct.filter.withSameAtomProperties({0:t,source:r,property:Ur.core.type.compositeKey([Ur.ammp("label_atom_id"),Ur.ammp("label_seq_id"),Ur.ammp("label_comp_id"),Ur.ammp("auth_asym_id"),Ur.ammp("label_asym_id")])})},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:La,rule:Am(/LIKE|l\./i),map:(e,t,r)=>Ur.struct.filter.withSameAtomProperties({0:t,source:r,property:Ur.core.type.compositeKey([Ur.ammp("label_atom_id"),Ur.ammp("label_seq_id")])})},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:K2,rule:X2(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(e=>parseFloat(e)),map:(e,t)=>Ur.struct.filter.within({0:Ur.struct.generator.all(),target:t,"atom-radius":Ur.acp("vdw"),"max-radius":e,invert:!0})},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:K2,rule:X2(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>Ur.struct.modifier.exceptBy({0:Ur.struct.filter.within({0:Ur.struct.generator.all(),target:t,"max-radius":e}),by:t})},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:K2,rule:X2(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>Ur.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:La,rule:ID("WITHIN","w."),map:(e,t,r)=>Ur.struct.filter.within({0:t,target:r,"max-radius":e})},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:La,rule:ID("NEAR_TO","nto."),map:(e,t,r)=>Ur.struct.modifier.exceptBy({0:Ur.struct.filter.within({0:t,target:r,"max-radius":e}),by:r})},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:La,rule:ID("BEYOND","be."),map:(e,t,r)=>Ur.struct.modifier.exceptBy({0:Ur.struct.filter.within({0:t,target:r,"max-radius":e,invert:!0}),by:r})},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:rl,rule:au(/BYRESIDUE|byresi|byres|br\./i),map:(e,t)=>kd(Ur.struct.modifier.expandProperty({0:Ur.struct.modifier.union({0:t}),property:Ur.ammp("residueKey")}))},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:rl,rule:au(/BYCALPHA|bca\./i),map:(e,t)=>Ur.struct.generator.queryInSelection({0:Ur.struct.modifier.expandProperty({0:Ur.struct.modifier.union({0:t}),property:Ur.ammp("residueKey")}),query:Ur.struct.generator.atomGroups({"atom-test":Ur.core.rel.eq([Ur.atomName("CA"),Ur.ammp("label_atom_id")])})})},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",isUnsupported:!0,abbr:["bymol","bm."],type:rl,rule:au(/BYMOLECULE|bymol|bm\./i),map:(e,t)=>kd(Ur.struct.modifier.expandProperty({0:Ur.struct.modifier.union({0:t}),property:Ur.atp("connectedComponentKey")}))},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:!0,type:rl,rule:au(/BYFRAGMENT|byfrag|bf\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:rl,rule:au(/BYSEGMENT|bysegi|byseg|bs\./i),map:(e,t)=>kd(Ur.struct.modifier.expandProperty({0:Ur.struct.modifier.union({0:t}),property:Ur.ammp("chainKey")}))},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:!0,type:rl,rule:au(/BYOBJECT|byobj|bo\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:!0,type:rl,rule:au(/BYCELL/i),map:(e,t)=>[e,t]},{"@desc":"All rings of size \u2264 7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:rl,rule:au(/BYRING/i),map:(e,t)=>kd(Ur.struct.modifier.intersectBy({0:Ur.struct.filter.pick({0:Ur.struct.generator.rings(),test:Ur.core.logic.and([Ur.core.rel.lte([Ur.struct.atomSet.atomCount(),7]),Ur.core.rel.gr([Ur.struct.atomSet.countQuery([t]),1])])}),by:t}))},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOR resn CYS"],name:"neighbor",type:rl,abbr:["nbr."],rule:au(/NEIGHBOR|nbr\./i),map:(e,t)=>Ur.struct.modifier.exceptBy({0:kd(Ur.struct.modifier.includeConnected({0:Ur.struct.modifier.union({0:t}),"bond-test":!0})),by:t})},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO name CA"],name:"bound_to",abbr:["bto."],type:rl,rule:au(/BOUND_TO|bto\./i),map:(e,t)=>kd(Ur.struct.modifier.includeConnected({0:Ur.struct.modifier.union({0:t})}))},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:K2,rule:X2(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(e=>parseInt(e)),map:(e,t)=>kd(Ur.struct.modifier.includeConnected({0:Ur.struct.modifier.union({0:t}),"bond-test":!0,"layer-count":e}))}];var $t=ye,Dc={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]},Tse={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],protein:["C","N","CA","O"]};function Ese(){return $t.struct.combinator.merge([$t.struct.modifier.intersectBy({0:$t.struct.generator.atomGroups({"residue-test":$t.core.set.has([$t.core.type.set(Dc.protein),$t.ammp("label_comp_id")])}),by:$t.struct.generator.atomGroups({"atom-test":$t.core.set.has([$t.core.type.set(Tse.protein),$t.ammp("label_atom_id")])})}),$t.struct.modifier.intersectBy({0:$t.struct.generator.atomGroups({"residue-test":$t.core.set.has([$t.core.type.set(Dc.nucleic),$t.ammp("label_comp_id")])}),by:$t.struct.generator.atomGroups({"atom-test":$t.core.set.has([$t.core.type.set(Tse.nucleic),$t.ammp("label_atom_id")])})})])}var LG={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:()=>$t.struct.generator.all()},none:{"@desc":"No atoms (empty selection)",map:()=>$t.struct.generator.empty()},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:()=>$t.struct.generator.atomGroups({"atom-test":$t.core.rel.eq([$t.acp("elementSymbol"),$t.es("H")])})},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:()=>$t.struct.generator.atomGroups({"atom-test":$t.core.rel.eq([$t.ammp("isHet"),!0])})},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:()=>$t.struct.generator.atomGroups({"residue-test":$t.core.set.has([$t.core.type.set(Dc.nucleic.concat(Dc.protein)),$t.ammp("label_comp_id")])})},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."],map:()=>$t.struct.modifier.exceptBy({0:$t.struct.generator.atomGroups({"residue-test":$t.core.set.has([$t.core.type.set(Dc.nucleic.concat(Dc.protein)),$t.ammp("label_comp_id")])}),by:Ese()})},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:()=>$t.struct.generator.atomGroups({"atom-test":$t.core.rel.gr([$t.struct.atomProperty.core.bondCount({flags:$t.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:()=>kd($t.struct.modifier.expandProperty({0:$t.struct.modifier.union([$t.struct.generator.queryInSelection({0:$t.struct.generator.atomGroups({"residue-test":$t.core.logic.not([$t.core.set.has([$t.core.type.set(Dc.nucleic.concat(Dc.protein)),$t.ammp("label_comp_id")])])}),query:$t.struct.generator.atomGroups({"atom-test":$t.core.rel.eq([$t.es("C"),$t.acp("elementSymbol")])})})]),property:$t.ammp("residueKey")}))},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:()=>kd($t.struct.modifier.expandProperty({0:$t.struct.modifier.union([$t.struct.filter.pick({0:$t.struct.generator.atomGroups({"residue-test":$t.core.logic.not([$t.core.set.has([$t.core.type.set(Dc.nucleic.concat(Dc.protein).concat(Dc.solvent)),$t.ammp("label_comp_id")])]),"group-by":$t.ammp("residueKey")}),test:$t.core.logic.not([$t.core.set.has([$t.struct.atomSet.propertySet([$t.acp("elementSymbol")]),$t.es("C")])])})]),property:$t.ammp("residueKey")}))},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:()=>$t.struct.generator.atomGroups({"residue-test":$t.core.set.has([$t.core.type.set(Dc.solvent),$t.ammp("label_comp_id")])})},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:()=>$t.struct.combinator.merge([$t.struct.generator.atomGroups({"atom-test":$t.core.rel.eq([$t.atomName("CA"),$t.ammp("label_atom_id")]),"residue-test":$t.core.set.has([$t.core.type.set(Dc.protein),$t.ammp("label_comp_id")])}),$t.struct.generator.atomGroups({"atom-test":$t.core.set.has([Dd(["C4*","C4'"]),$t.ammp("label_atom_id")]),"residue-test":$t.core.set.has([$t.core.type.set(Dc.nucleic),$t.ammp("label_comp_id")])})])},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."],map:()=>Ese()},"polymer.protein":{"@desc":"Protein (New in PyMOL 2.1)",abbr:["polymer.protein"],map:()=>$t.struct.generator.atomGroups({"residue-test":$t.core.set.has([$t.core.type.set(Dc.protein),$t.ammp("label_comp_id")])})},"polymer.nucleic":{"@desc":"Nucleic Acid (New in PyMOL 2.1)",abbr:["polymer.nucleic"],map:()=>$t.struct.generator.atomGroups({"residue-test":$t.core.set.has([$t.core.type.set(Dc.nucleic),$t.ammp("label_comp_id")])})}};var P4e=ye,Vs=xse(tw),ta=lt.string("/");function Ii(e){return e.or(lt.of(null))}function D4e(e){let t={},r={};for(let n in e){let o=tw[n];if(!o)throw new Error(`property '${n}' not supported, value '${e[n]}'`);e[n]!==null&&(r[o.level]||(r[o.level]=[]),r[o.level].push(e[n]))}for(let n in r)t[n]=Y2(r[n]);return P4e.struct.generator.atomGroups(t)}var k4e=lt.createLanguage({Parens:function(e){return lt.alt(e.Parens,e.Operator,e.Expression).wrap(lt.string("("),lt.string(")"))},Expression:function(e){return lt.alt(e.Keywords,e.AtomSelectionMacro.map(D4e),e.NamedAtomProperties,e.Pepseq,e.Rep,e.Object)},AtomSelectionMacro:function(e){return lt.alt(ta.then(lt.alt(lt.seq(Ii(e.ObjectProperty).skip(ta),Ii(Vs.segi).skip(ta),Ii(Vs.chain).skip(ta),Ii(Vs.resi).skip(ta),Ii(Vs.name)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]})),lt.seq(Ii(e.ObjectProperty).skip(ta),Ii(Vs.segi).skip(ta),Ii(Vs.chain).skip(ta),Ii(Vs.resi)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3]})),lt.seq(Ii(e.ObjectProperty).skip(ta),Ii(Vs.segi).skip(ta),Ii(Vs.chain)).map(t=>({object:t[0],segi:t[1],chain:t[2]})),lt.seq(Ii(e.ObjectProperty).skip(ta),Ii(Vs.segi)).map(t=>({object:t[0],segi:t[1]})),lt.seq(Ii(e.ObjectProperty)).map(t=>({object:t[0]})))),lt.alt(lt.seq(Ii(e.ObjectProperty).skip(ta),Ii(Vs.segi).skip(ta),Ii(Vs.chain).skip(ta),Ii(Vs.resi).skip(ta),Ii(Vs.name)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]})),lt.seq(Ii(Vs.segi).skip(ta),Ii(Vs.chain).skip(ta),Ii(Vs.resi).skip(ta),Ii(Vs.name)).map(t=>({segi:t[0],chain:t[1],resi:t[2],name:t[3]})),lt.seq(Ii(Vs.chain).skip(ta),Ii(Vs.resi).skip(ta),Ii(Vs.name)).map(t=>({chain:t[0],resi:t[1],name:t[2]})),lt.seq(Ii(Vs.resi).skip(ta),Ii(Vs.name)).map(t=>({resi:t[0],name:t[1]}))))},NamedAtomProperties:function(){return lt.alt(...AD(tw))},Keywords:()=>lt.alt(...DC(LG)),ObjectProperty:()=>{let e=kC(tw,LG,BG).sort($u).map(Yh).join("|");return lt.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i"))},Object:e=>e.ObjectProperty.notFollowedBy(ta).map(t=>{throw new Error(`property 'object' not supported, value '${t}'`)}),Pepseq:()=>lt.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(_g("operator 'pepseq' not supported")),Rep:()=>lt.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(_g("operator 'rep' not supported")),Operator:function(e){return sy(BG,lt.alt(e.Parens,e.Expression,e.Operator))},Query:function(e){return lt.alt(e.Operator,e.Parens,e.Expression).trim(lt.optWhitespace)}}),Pse=e=>k4e.Query.tryParse(e);var ws=ye,Wu=/[-+]?[0-9]*\.?[0-9]+/,_D=/[+]?[0-9]+/,rw=/[-+]?[0-9]+/;function Gb(e){return e}var NG={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"};function TD(e){return ws.struct.type.secondaryStructureFlags([NG[e.toUpperCase()]||"none"])}var Eg={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:ws.atomName,level:"atom-test",property:ws.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:Gb,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:!0,regex:_D,map:e=>parseInt(e)-1,level:"atom-test",property:ws.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:!0,regex:_D,map:e=>parseInt(e),level:"atom-test",property:ws.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:!0,regex:_D,map:e=>parseInt(e),level:"atom-test",property:ws.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>ws.es(e),level:"atom-test",property:ws.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:Gb,level:"atom-test",property:ws.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:Gb,level:"residue-test",property:ws.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:!0,regex:rw,map:e=>parseInt(e),level:"residue-test",property:ws.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:!0,isNumeric:!0,regex:rw,map:e=>parseInt(e),level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:!0,isNumeric:!0,regex:rw,map:e=>parseInt(e),level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:!0,isNumeric:!0,regex:rw,map:e=>parseInt(e),level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:Gb,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:!0,regex:_D,map:e=>parseInt(e),level:"atom-test",property:ws.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:Gb,level:"residue-test",property:ws.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:!0,regex:rw,map:e=>parseInt(e),level:"residue-test",property:ws.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:Gb,level:"residue-test",property:ws.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test",property:ws.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test",property:ws.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test",property:ws.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test",property:ws.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test",property:ws.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test",property:ws.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test",property:ws.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test",property:ws.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:!0,isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:!0,regex:/[^']*/,map:Gb,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:TD,level:"atom-test",property:ws.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:!0,isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:!0,isNumeric:!0,regex:Wu,map:e=>parseFloat(e),level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:!0,isNumeric:!0,regex:Wu,map:e=>parseInt(e),level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:!0,isNumeric:!0,regex:Wu,map:e=>parseInt(e),level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:!0,isNumeric:!0,regex:Wu,map:e=>parseInt(e),level:"atom-test"}};var Ub=ye,M4e=Object.keys(Eg).sort($u).filter(e=>!Eg[e].isUnsupported).join("|"),FG=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:rl,rule:lt.regexp(/NOT/i).skip(lt.whitespace),map:(e,t)=>Dl(t)},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:rl,rule:au(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>Ub.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:rl,rule:au(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>Ub.struct.modifier.exceptBy({0:Ub.struct.modifier.includeSurroundings({0:t,radius:e}),by:t})},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:rl,rule:au(new RegExp(`SAME\\s+(${M4e})\\s+AS`,"i"),1).map(e=>Eg[e].property),map:(e,t)=>Ub.struct.filter.withSameAtomProperties({0:Ub.struct.generator.all(),source:t,property:e})},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:La,rule:lt.alt(Am(/AND/i),lt.whitespace),map:(e,t,r)=>Ub.struct.modifier.intersectBy({0:t,by:r})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:La,rule:Am(/OR/i),map:(e,t,r)=>Ub.struct.combinator.merge([t,r])}];var en=ye;function Pg(){return en.struct.filter.pick({0:en.struct.generator.atomGroups({"group-by":en.ammp("residueKey")}),test:en.core.set.isSubset([Dd(["C","N","CA","O"]),en.ammpSet("label_atom_id")])})}function OG(){return en.struct.filter.pick({0:en.struct.generator.atomGroups({"group-by":en.ammp("residueKey")}),test:en.core.logic.and([en.core.set.isSubset([Dd(["P"]),en.ammpSet("label_atom_id")]),en.core.logic.or([en.core.set.isSubset([Dd(["O3'","C3'","C4'","C5'","O5'"]),en.ammpSet("label_atom_id")]),en.core.set.isSubset([Dd(["O3*","C3*","C4*","C5*","O5*"]),en.ammpSet("label_atom_id")])])])})}function Dse(){return en.struct.combinator.merge([en.struct.generator.queryInSelection({0:Pg(),query:en.struct.generator.atomGroups({"atom-test":en.core.set.has([Dd(kse.protein),en.ammp("label_atom_id")])})}),en.struct.generator.queryInSelection({0:OG(),query:en.struct.generator.atomGroups({"atom-test":en.core.set.has([Dd(kse.nucleic),en.ammp("label_atom_id")])})})])}function Kf(e){return en.struct.generator.atomGroups({"residue-test":en.core.flags.hasAll([en.ammp("secondaryStructureFlags"),en.struct.type.secondaryStructureFlags(e)])})}var kse={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]},ra={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]},VG={all:{"@desc":"everything",map:()=>en.struct.generator.all()},none:{"@desc":"nothing",map:()=>en.struct.generator.empty()},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>Pg()},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:()=>OG()},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:()=>Dse()},sidechain:{"@desc":"non-backbone atoms and bonds",map:()=>Dl(Dse())},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:()=>Dn(ra.water)},at:{"@desc":"residues named ADA A THY T",map:()=>Dn(ra.at)},acidic:{"@desc":"residues named ASP GLU",map:()=>Dn(ra.acidic)},acyclic:{"@desc":'"protein and not cyclic"',map:()=>en.struct.modifier.intersectBy({0:Pg(),by:Dl(Dn(ra.cyclic))})},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:()=>Dn(ra.aliphatic)},alpha:{"@desc":"atom's residue is an alpha helix",map:()=>Kf(["alpha"])},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>Pg()},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:()=>Dn(ra.aromatic)},basic:{"@desc":"residues named ARG HIS LYS",map:()=>Dn(ra.basic)},bonded:{"@desc":"atoms for which numbonds > 0",map:()=>kd(en.struct.filter.pick({0:en.struct.modifier.includeConnected({0:en.struct.generator.all(),"bond-test":en.core.flags.hasAny([en.struct.bondProperty.flags(),en.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:en.core.rel.gr([en.struct.atomSet.atomCount(),1])}))},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:()=>Dn(ra.buried)},cg:{"@desc":"residues named CYT C GUA G",map:()=>Dn(ra.cg)},charged:{"@desc":'"basic or acidic"',map:()=>Dn(ra.basic.concat(ra.acidic))},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:()=>Dn(ra.cyclic)},hetero:{"@desc":'"not (protein or nucleic)"',map:()=>Dl(en.struct.combinator.merge([Pg(),OG()]))},hydrogen:{"@desc":'name "[0-9]?H.*"',map:()=>en.struct.generator.atomGroups({"atom-test":en.core.str.match([en.core.type.regex(["^[0-9]?[H].*$","i"]),en.core.type.str([en.ammp("label_atom_id")])])})},large:{"@desc":'"protein and not (small or medium)"',map:()=>en.struct.modifier.intersectBy({0:Pg(),by:Dl(Dn(ra.small.concat(ra.medium)))})},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:()=>Dn(ra.medium)},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:()=>Dn(ra.neutral)},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:()=>Dn(ra.hydrophobic)},polar:{"@desc":'"protein and not hydrophobic"',map:()=>en.struct.modifier.intersectBy({0:Pg(),by:Dl(Dn(ra.hydrophobic))})},purine:{"@desc":"residues named ADE A GUA G",map:()=>Dn(ra.purine)},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:()=>Dn(ra.pyrimidine)},small:{"@desc":"residues named ALA GLY SER",map:()=>Dn(ra.small)},surface:{"@desc":'"protein and not buried"',map:()=>en.struct.modifier.intersectBy({0:Pg(),by:Dl(Dn(ra.buried))})},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:()=>Kf(["alpha"])},pi_helix:{"@desc":"atom's residue is in a pi helix",map:()=>Kf(["pi"])},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:()=>Kf(["3-10"])},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:()=>Kf(["helix"])},extended_beta:{"@desc":"atom's residue is a beta sheet",map:()=>Kf(["sheet"])},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:()=>Kf(["strand"])},sheet:{"@desc":"atom's residue is a beta sheet",map:()=>Kf(["beta"])},turn:{"@desc":"atom's residue is in a turn conformation",map:()=>Kf(["turn"])},coil:{"@desc":"atom's residue is in a coil conformation",map:()=>en.struct.modifier.intersectBy({0:Pg(),by:Kf(["none"])})}};var ac=ye,Mse={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:e=>ac.core.math.pow([e,2])},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:e=>ac.core.math.sqrt([e])},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:e=>ac.core.math.abs([e])},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:e=>ac.core.math.floor([e])},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:e=>ac.core.math.ceil([e])},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:e=>ac.core.math.sin([e])},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:e=>ac.core.math.cos([e])},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:e=>ac.core.math.tan([e])},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:e=>ac.core.math.atan([e])},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:e=>ac.core.math.asin([e])},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:e=>ac.core.math.acos([e])},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:e=>ac.core.math.sinh([e])},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:e=>ac.core.math.cosh([e])},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:e=>ac.core.math.tanh([e])},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:e=>ac.core.math.exp([e])},log:{"@desc":"natural log of x","@examples":["log(2)"],map:e=>ac.core.math.log([e])},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:e=>ac.core.math.log10([e])}};var Oi=ye,R4e=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:La,rule:lt.regexp(/\s*(\*|\/)\s*/,1),map:(e,t,r)=>{switch(e){case"*":return Oi.core.math.mult([t,r]);case"/":return Oi.core.math.div([t,r]);default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:La,rule:lt.regexp(/\s*(-|\+)\s*/,1),map:(e,t,r)=>{switch(e){case"-":return Oi.core.math.sub([t,r]);case"+":return Oi.core.math.add([t,r]);default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:La,rule:lt.alt(lt.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),lt.whitespace.result("=")),map:(e,t,r)=>{let n;if(t.head!==void 0?(t.head.name==="structure-query.atom-property.macromolecular.secondary-structure-flags"&&(n=Oi.core.flags.hasAny([t,TD(r)])),t.head.name==="core.type.regex"&&(n=Oi.core.str.match([t,Oi.core.type.str([r])]))):r.head!==void 0?(r.head.name==="structure-query.atom-property.macromolecular.secondary-structure-flags"&&(n=Oi.core.flags.hasAny([r,TD(t)])),r.head.name==="core.type.regex"&&(n=Oi.core.str.match([r,Oi.core.type.str([t])]))):e==="=~"&&(t.head?n=Oi.core.str.match([Oi.core.type.regex([`^${r}$`,"i"]),Oi.core.type.str([t])]):n=Oi.core.str.match([Oi.core.type.regex([`^${t}$`,"i"]),Oi.core.type.str([r])])),!n)switch(t.head&&(r=Vb(t,r)),r.head&&(t=Vb(r,t)),e){case"=":case"==":n=Oi.core.rel.eq([t,r]);break;case"!=":n=Oi.core.rel.neq([t,r]);break;case">":n=Oi.core.rel.gr([t,r]);break;case"<":n=Oi.core.rel.lt([t,r]);break;case">=":n=Oi.core.rel.gre([t,r]);break;case"<=":n=Oi.core.rel.lte([t,r]);break;default:throw new Error(`value operator '${e}' not supported`)}return Oi.struct.generator.atomGroups({"atom-test":n})}}],B4e=lt.createLanguage({Parens:function(e){return lt.alt(e.Parens,e.Operator,e.Expression).wrap(lt.string("("),lt.string(")"))},Expression:function(e){return lt.alt(e.RangeListProperty,e.ValueQuery,e.Keywords)},NamedAtomProperties:function(){return lt.alt(...AD(Eg))},Keywords:()=>lt.alt(...DC(VG)),ValueRange:function(e){return lt.seq(e.Value.skip(lt.regexp(/\s+TO\s+/i)),e.Value).map(t=>({range:t}))},RangeListProperty:function(e){return lt.seq(lt.alt(...Q2(Eg,/\s/)).skip(lt.whitespace),lt.alt(e.ValueRange,e.Value).sepBy1(lt.whitespace)).map(t=>{let[r,n]=t,o=[],i=[];n.forEach(c=>{c.range?i.push(Oi.core.rel.inRange([r,c.range[0],c.range[1]])):o.push(Vb(r,c,NG))});let s=bse(i),a=Ise(r,o),l;return s&&a?l=Oi.core.logic.or([s,a]):l=s||a,Oi.struct.generator.atomGroups({[Sse(r)]:l})})},Operator:function(e){return sy(FG,lt.alt(e.Parens,e.Expression,e.ValueQuery))},Query:function(e){return lt.alt(e.Operator,e.Parens,e.Expression).trim(lt.optWhitespace)},Number:function(){return lt.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){let e=kC(Eg,VG,FG).sort($u).map(Yh).join("|");return lt.alt(lt.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),lt.regexp(/'((?:[^"\\]|\\.)*)'/,1),lt.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(t=>Oi.core.type.regex([`^${t}$`,"i"]))).desc("string")},Value:function(e){return lt.alt(e.Number,e.String)},ValueParens:function(e){return lt.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(lt.string("("),lt.string(")"))},ValuePropertyNames:function(){return lt.alt(...Q2(Eg,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(e){return sy(R4e,lt.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return lt.alt(e.ValueFunctions,e.Value,e.ValuePropertyNames)},ValueFunctions:function(e){return lt.alt(...Cse(Mse,e.ValueOperator))},ValueQuery:function(e){return lt.alt(e.ValueOperator.map(t=>{if(!t.head.name||!t.head.name.startsWith("structure-query.generator"))throw new Error(`values must be part of an comparison, value '${t}'`);return t}))}}),Rse=e=>B4e.Query.tryParse(e);var Bse={pymol:Pse,vmd:Rse,jmol:_se};var L4e=Bse;function Lse(e,t){try{return L4e[e](t)}catch(r){throw r}}var GG=class{constructor(){this.map=new Map}removeSymbol(t){this.map.delete(t.symbol.id)}addSymbol(t){this.map.has(t.symbol.id),this.map.set(t.symbol.id,t)}addCustomProp(t){if(t.symbols)for(let r of Object.keys(t.symbols))this.addSymbol(t.symbols[r])}removeCustomProp(t){if(t.symbols)for(let r of Object.keys(t.symbols))this.removeSymbol(t.symbols[r])}getRuntime(t){return this.map.get(t)}},_m=new GG,UG=class{constructor(t){this.table=t,this.constQueryContext=new ls(qe.Empty)}},Nse;(function(e){function t(n){return{kind:"const",value:n}}e.Const=t;function r(n){return{kind:"dynamic",runtime:n}}e.Dynamic=r})(Nse||(Nse={}));var zb;(function(e){function t(n){return{isConst:!0,fn:function(i){return n}}}e.Const=t;function r(n){return{isConst:!1,fn:n}}e.Dynamic=r})(zb||(zb={}));var RC;(function(e){function t(r,n,o,i){if(typeof r.length=="number")for(let s=0,a=r.length;s<a;s++)o(r[s](n),s,i);else{let s=0;for(let a of Object.keys(r))o(r[a](n),s++,i)}return i}e.forEachEval=t})(RC||(RC={}));var lu;(function(e){function t(n,o){return new ED(n,o,!0)}e.Const=t;function r(n,o){return new ED(n,o,!1)}e.Dynamic=r})(lu||(lu={}));var ED=class{compile(t,r){let n,o=!1;if(!r)n=void 0,o=!0;else if(As.isArgumentsArray(r)){n=[],o=!0;for(let i of r){let s=zG(t,i);o=o&&s.isConst,n.push(s.fn)}}else{n=Object.create(null),o=!0;for(let i of Object.keys(r)){let s=zG(t,r[i]);o=o&&s.isConst,n[i]=s.fn}}return this.isConst?this.isConst&&o?zb.Const(this.fn(t.constQueryContext,n)):zb.Dynamic(Fse(this.fn,n)):zb.Dynamic(Fse(this.fn,n))}constructor(t,r,n){this.symbol=t,this.fn=r,this.isConst=n}};function Fse(e,t){return function(n){return e(n,t)}}function zG(e,t){if(As.isLiteral(t))return zb.Const(t);if(As.isSymbol(t)){let n=e.table.getRuntime(t.name);return n?n.compile(e):zb.Const(t.name)}if(!As.isSymbol(t.head))throw new Error("Can only apply symbols.");let r=e.table.getRuntime(t.head.name);if(!r)throw new Error(`Symbol '${t.head.name}' is not implemented.`);return r.compile(e,t.args)}function $p(e){let t=new UG(_m);return zG(t,e).fn}var Tr=lu.Const,ur=lu.Dynamic,N4e=[Tr(Oe.core.type.bool,function(t,r){return!!r[0](t)}),Tr(Oe.core.type.num,function(t,r){return+r[0](t)}),Tr(Oe.core.type.str,function(t,r){return""+r[0](t)}),Tr(Oe.core.type.list,function(t,r){return RC.forEachEval(r,t,(n,o,i)=>i[o]=n,[])}),Tr(Oe.core.type.set,function(t,r){return RC.forEachEval(r,t,function(o,i,s){return s.add(o)},new Set)}),Tr(Oe.core.type.regex,function(t,r){return new RegExp(r[0](t),r[1]&&r[1](t)||"")}),Tr(Oe.core.type.bitflags,function(t,r){return+r[0](t)}),Tr(Oe.core.type.compositeKey,function(t,r){return RC.forEachEval(r,t,(n,o,i)=>i[o]=""+n,[]).join("-")}),Tr(Oe.core.logic.not,(e,t)=>!t[0](e)),Tr(Oe.core.logic.and,(e,t)=>{if(typeof t.length=="number"){for(let r=0,n=t.length;r<n;r++)if(!t[r](e))return!1}else for(let r of Object.keys(t))if(!t[r](e))return!1;return!0}),Tr(Oe.core.logic.or,(e,t)=>{if(typeof t.length=="number"){for(let r=0,n=t.length;r<n;r++)if(t[r](e))return!0}else for(let r of Object.keys(t))if(t[r](e))return!0;return!1}),Tr(Oe.core.rel.eq,(e,t)=>t[0](e)===t[1](e)),Tr(Oe.core.rel.neq,(e,t)=>t[0](e)!==t[1](e)),Tr(Oe.core.rel.lt,(e,t)=>t[0](e)<t[1](e)),Tr(Oe.core.rel.lte,(e,t)=>t[0](e)<=t[1](e)),Tr(Oe.core.rel.gr,(e,t)=>t[0](e)>t[1](e)),Tr(Oe.core.rel.gre,(e,t)=>t[0](e)>=t[1](e)),Tr(Oe.core.rel.inRange,(e,t)=>{let r=t[0](e);return r>=t[1](e)&&r<=t[2](e)}),Tr(Oe.core.math.add,(e,t)=>{let r=0;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r+=t[n](e);else for(let n of Object.keys(t))r+=t[n](e);return r}),Tr(Oe.core.math.sub,(e,t)=>{let r=0;if(typeof t.length=="number"){if(t.length===1)return-t[0](e);r=t[0](e)||0;for(let n=1,o=t.length;n<o;n++)r-=t[n](e)}else{let n=Object.keys(t);if(n.length===1)return-t[n[0]](e);r=t[n[0]](e)||0;for(let o=1,i=n.length;o<i;o++)r-=t[n[o]](e)}return r}),Tr(Oe.core.math.mult,(e,t)=>{let r=1;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r*=t[n](e);else for(let n of Object.keys(t))r*=t[n](e);return r}),Tr(Oe.core.math.div,(e,t)=>t[0](e)/t[1](e)),Tr(Oe.core.math.pow,(e,t)=>Math.pow(t[0](e),t[1](e))),Tr(Oe.core.math.mod,(e,t)=>t[0](e)%t[1](e)),Tr(Oe.core.math.min,(e,t)=>{let r=Number.POSITIVE_INFINITY;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Math.min(t[n](e),r);else for(let n of Object.keys(t))r=Math.min(t[n](e),r);return r}),Tr(Oe.core.math.max,(e,t)=>{let r=Number.NEGATIVE_INFINITY;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Math.max(t[n](e),r);else for(let n of Object.keys(t))r=Math.max(t[n](e),r);return r}),Tr(Oe.core.math.cantorPairing,(e,t)=>Ys(t[0](e),t[1](e))),Tr(Oe.core.math.sortedCantorPairing,(e,t)=>h0(t[0](e),t[1](e))),Tr(Oe.core.math.invertCantorPairing,(e,t)=>BE([0,0],t[0](e))),Tr(Oe.core.math.floor,(e,t)=>Math.floor(t[0](e))),Tr(Oe.core.math.ceil,(e,t)=>Math.ceil(t[0](e))),Tr(Oe.core.math.roundInt,(e,t)=>Math.round(t[0](e))),Tr(Oe.core.math.trunc,(e,t)=>Math.trunc(t[0](e))),Tr(Oe.core.math.abs,(e,t)=>Math.abs(t[0](e))),Tr(Oe.core.math.sign,(e,t)=>Math.sign(t[0](e))),Tr(Oe.core.math.sqrt,(e,t)=>Math.sqrt(t[0](e))),Tr(Oe.core.math.cbrt,(e,t)=>Math.cbrt(t[0](e))),Tr(Oe.core.math.sin,(e,t)=>Math.sin(t[0](e))),Tr(Oe.core.math.cos,(e,t)=>Math.cos(t[0](e))),Tr(Oe.core.math.tan,(e,t)=>Math.tan(t[0](e))),Tr(Oe.core.math.asin,(e,t)=>Math.asin(t[0](e))),Tr(Oe.core.math.acos,(e,t)=>Math.acos(t[0](e))),Tr(Oe.core.math.atan,(e,t)=>Math.atan(t[0](e))),Tr(Oe.core.math.sinh,(e,t)=>Math.sinh(t[0](e))),Tr(Oe.core.math.cosh,(e,t)=>Math.cosh(t[0](e))),Tr(Oe.core.math.tanh,(e,t)=>Math.tanh(t[0](e))),Tr(Oe.core.math.exp,(e,t)=>Math.exp(t[0](e))),Tr(Oe.core.math.log,(e,t)=>Math.log(t[0](e))),Tr(Oe.core.math.log10,(e,t)=>Math.log10(t[0](e))),Tr(Oe.core.math.atan2,(e,t)=>Math.atan2(t[0](e),t[1](e))),Tr(Oe.core.str.match,(e,t)=>t[0](e).test(t[1](e))),Tr(Oe.core.str.concat,(e,t)=>{let r=[];if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r.push(t[n](e).toString());else for(let n of Object.keys(t))r.push(t[n](e).toString());return r.join("")}),Tr(Oe.core.list.getAt,(e,t)=>t[0](e)[t[1](e)]),Tr(Oe.core.list.equal,(e,t)=>Xx(t[0](e),t[1](e))),Tr(Oe.core.set.has,function(t,r){return r[0](t).has(r[1](t))}),Tr(Oe.core.set.isSubset,function(t,r){return $n.isSuperset(r[1](t),r[0](t))}),Tr(Oe.core.flags.hasAny,(e,t)=>{let r=t[1](e),n=t[0](e);return r?(n&r)!==0:!!n}),Tr(Oe.core.flags.hasAll,(e,t)=>{let r=t[1](e),n=t[0](e);return r?(n&r)===r:!n}),Tr(Oe.structureQuery.type.elementSymbol,(e,t)=>zp(t[0](e))),Tr(Oe.structureQuery.type.atomName,(e,t)=>wK(t[0](e))),Tr(Oe.structureQuery.type.bondFlags,(e,t)=>{let r=0;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Ose(r,t[n](e));else for(let n of Object.keys(t))r=Ose(r,t[n](e));return r}),Tr(Oe.structureQuery.type.ringFingerprint,(e,t)=>zu.elementFingerprint(F4e(e,t))),Tr(Oe.structureQuery.type.secondaryStructureFlags,(e,t)=>{let r=0;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r=Vse(r,t[n](e));else for(let n of Object.keys(t))r=Vse(r,t[n](e));return r}),ur(Oe.structureQuery.filter.pick,(e,t)=>Pn.filters.pick(t[0],t.test)(e)),ur(Oe.structureQuery.filter.first,(e,t)=>Pn.filters.first(t[0])(e)),ur(Oe.structureQuery.filter.withSameAtomProperties,(e,t)=>Pn.filters.withSameAtomProperties(t[0],t.source,t.property)(e)),ur(Oe.structureQuery.filter.intersectedBy,(e,t)=>Pn.filters.areIntersectedBy(t[0],t.by)(e)),ur(Oe.structureQuery.filter.within,(e,t)=>{var r,n,o;return Pn.filters.within({query:t[0],target:t.target,minRadius:(r=t["min-radius"])===null||r===void 0?void 0:r.call(t,e),maxRadius:(n=t["max-radius"])===null||n===void 0?void 0:n.call(t,e),elementRadius:t["atom-radius"],invert:(o=t.invert)===null||o===void 0?void 0:o.call(t,e)})(e)}),ur(Oe.structureQuery.filter.isConnectedTo,(e,t)=>{var r,n;return Pn.filters.isConnectedTo({query:t[0],target:t.target,disjunct:(r=t.disjunct)===null||r===void 0?void 0:r.call(t,e),invert:(n=t.invert)===null||n===void 0?void 0:n.call(t,e),bondTest:t["bond-test"]})(e)}),ur(Oe.structureQuery.generator.atomGroups,function(t,r){return Pn.generators.atoms({entityTest:r["entity-test"],chainTest:r["chain-test"],residueTest:r["residue-test"],atomTest:r["atom-test"],groupBy:r["group-by"]})(t)}),ur(Oe.structureQuery.generator.all,function(t){return Pn.generators.all(t)}),ur(Oe.structureQuery.generator.empty,function(t){return Pn.generators.none(t)}),ur(Oe.structureQuery.generator.bondedAtomicPairs,function(t,r){return Pn.generators.bondedAtomicPairs(r&&r[0])(t)}),ur(Oe.structureQuery.generator.rings,function(t,r){var n,o;return Pn.generators.rings((n=r?.fingerprint)===null||n===void 0?void 0:n.call(r,t),(o=r?.["only-aromatic"])===null||o===void 0?void 0:o.call(r,t))(t)}),ur(Oe.structureQuery.generator.queryInSelection,function(t,r){var n;return Pn.generators.querySelection(r[0],r.query,(n=r["in-complement"])===null||n===void 0?void 0:n.call(r,t))(t)}),ur(Oe.structureQuery.modifier.includeSurroundings,function(t,r){return Pn.modifiers.includeSurroundings(r[0],{radius:r.radius(t),wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),elementRadius:r["atom-radius"]})(t)}),ur(Oe.structureQuery.modifier.surroundingLigands,function(t,r){return Pn.modifiers.surroundingLigands({query:r[0],radius:r.radius(t),includeWater:!!(r["include-water"]&&r["include-water"](t))})(t)}),ur(Oe.structureQuery.modifier.wholeResidues,function(t,r){return Pn.modifiers.wholeResidues(r[0])(t)}),ur(Oe.structureQuery.modifier.union,function(t,r){return Pn.modifiers.union(r[0])(t)}),ur(Oe.structureQuery.modifier.expandProperty,function(t,r){return Pn.modifiers.expandProperty(r[0],r.property)(t)}),ur(Oe.structureQuery.modifier.exceptBy,function(t,r){return Pn.modifiers.exceptBy(r[0],r.by)(t)}),ur(Oe.structureQuery.modifier.includeConnected,function(t,r){var n,o;return Pn.modifiers.includeConnected({query:r[0],bondTest:r["bond-test"],wholeResidues:!!(r["as-whole-residues"]&&r["as-whole-residues"](t)),layerCount:r["layer-count"]&&r["layer-count"](t)||1,fixedPoint:(o=(n=r["fixed-point"])===null||n===void 0?void 0:n.call(r,t))!==null&&o!==void 0?o:!1})(t)}),ur(Oe.structureQuery.modifier.intersectBy,function(t,r){return Pn.modifiers.intersectBy(r[0],r.by)(t)}),ur(Oe.structureQuery.combinator.merge,(e,t)=>Pn.combinators.merge(t)(e)),ur(Oe.structureQuery.atomProperty.core.elementSymbol,Oo(nt.atom.type_symbol)),ur(Oe.structureQuery.atomProperty.core.vdw,(e,t)=>qf(nt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),ur(Oe.structureQuery.atomProperty.core.mass,(e,t)=>Eoe(nt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),ur(Oe.structureQuery.atomProperty.core.atomicNumber,(e,t)=>ry(nt.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),ur(Oe.structureQuery.atomProperty.core.x,Oo(nt.atom.x)),ur(Oe.structureQuery.atomProperty.core.y,Oo(nt.atom.y)),ur(Oe.structureQuery.atomProperty.core.z,Oo(nt.atom.z)),ur(Oe.structureQuery.atomProperty.core.sourceIndex,Oo(nt.atom.sourceIndex)),ur(Oe.structureQuery.atomProperty.core.operatorName,Oo(nt.unit.operator_name)),ur(Oe.structureQuery.atomProperty.core.operatorKey,Oo(nt.unit.operator_key)),ur(Oe.structureQuery.atomProperty.core.modelIndex,Oo(nt.unit.model_index)),ur(Oe.structureQuery.atomProperty.core.modelLabel,Oo(nt.unit.model_label)),ur(Oe.structureQuery.atomProperty.core.atomKey,(e,t)=>{let r=t&&t[0]&&t[0](e)||e.element;return Ys(r.unit.id,r.element)}),ur(Oe.structureQuery.atomProperty.macromolecular.residueKey,(e,t)=>ce.residueIndex(t&&t[0]&&t[0](e)||e.element)),ur(Oe.structureQuery.atomProperty.macromolecular.chainKey,(e,t)=>ce.chainIndex(t&&t[0]&&t[0](e)||e.element)),ur(Oe.structureQuery.atomProperty.macromolecular.entityKey,(e,t)=>ce.entityIndex(t&&t[0]&&t[0](e)||e.element)),ur(Oe.structureQuery.atomProperty.macromolecular.id,Oo(nt.atom.id)),ur(Oe.structureQuery.atomProperty.macromolecular.isHet,(e,t)=>nt.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)!=="ATOM"),ur(Oe.structureQuery.atomProperty.macromolecular.label_atom_id,Oo(nt.atom.label_atom_id)),ur(Oe.structureQuery.atomProperty.macromolecular.label_alt_id,Oo(nt.atom.label_alt_id)),ur(Oe.structureQuery.atomProperty.macromolecular.label_comp_id,Oo(nt.atom.label_comp_id)),ur(Oe.structureQuery.atomProperty.macromolecular.label_seq_id,Oo(nt.residue.label_seq_id)),ur(Oe.structureQuery.atomProperty.macromolecular.label_asym_id,Oo(nt.chain.label_asym_id)),ur(Oe.structureQuery.atomProperty.macromolecular.label_entity_id,Oo(nt.entity.id)),ur(Oe.structureQuery.atomProperty.macromolecular.auth_atom_id,Oo(nt.atom.auth_atom_id)),ur(Oe.structureQuery.atomProperty.macromolecular.auth_comp_id,Oo(nt.atom.auth_comp_id)),ur(Oe.structureQuery.atomProperty.macromolecular.auth_seq_id,Oo(nt.residue.auth_seq_id)),ur(Oe.structureQuery.atomProperty.macromolecular.auth_asym_id,Oo(nt.chain.auth_asym_id)),ur(Oe.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,Oo(nt.residue.pdbx_PDB_ins_code)),ur(Oe.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,Oo(nt.atom.pdbx_formal_charge)),ur(Oe.structureQuery.atomProperty.macromolecular.occupancy,Oo(nt.atom.occupancy)),ur(Oe.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,Oo(nt.atom.B_iso_or_equiv)),ur(Oe.structureQuery.atomProperty.macromolecular.entityType,Oo(nt.entity.type)),ur(Oe.structureQuery.atomProperty.macromolecular.entitySubtype,Oo(nt.entity.subtype)),ur(Oe.structureQuery.atomProperty.macromolecular.entityPrdId,Oo(nt.entity.prd_id)),ur(Oe.structureQuery.atomProperty.macromolecular.entityDescription,Oo(nt.entity.pdbx_description)),ur(Oe.structureQuery.atomProperty.macromolecular.objectPrimitive,Oo(nt.unit.object_primitive)),ur(Oe.structureQuery.atomProperty.macromolecular.isNonStandard,Oo(nt.residue.isNonStandard)),ur(Oe.structureQuery.atomProperty.macromolecular.secondaryStructureKey,Oo(nt.residue.secondary_structure_key)),ur(Oe.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,Oo(nt.residue.secondary_structure_type)),ur(Oe.structureQuery.atomProperty.macromolecular.chemCompType,Oo(nt.residue.chem_comp_type)),ur(Oe.structureQuery.atomSet.atomCount,function(t,r){return Pn.atomset.atomCount(t)}),ur(Oe.structureQuery.atomSet.countQuery,function(t,r){return Pn.atomset.countQuery(r[0])(t)}),ur(Oe.structureQuery.atomSet.propertySet,function(t,r){return Pn.atomset.propertySet(r[0])(t)}),ur(Oe.structureQuery.bondProperty.order,(e,t)=>e.atomicBond.order),ur(Oe.structureQuery.bondProperty.flags,(e,t)=>e.atomicBond.type),ur(Oe.structureQuery.bondProperty.key,(e,t)=>e.atomicBond.key),ur(Oe.structureQuery.bondProperty.atomA,(e,t)=>e.atomicBond.a),ur(Oe.structureQuery.bondProperty.atomB,(e,t)=>e.atomicBond.b),ur(Oe.structureQuery.bondProperty.length,(e,t)=>e.atomicBond.length),ur(Oe.internal.generator.bundleElement,function(t,r){return OV(r.groupedUnits(t),r.ranges(t),r.set(t))}),ur(Oe.internal.generator.bundle,function(t,r){return VV(r.elements(t))(t)}),ur(Oe.internal.generator.current,function(t,r){return t.tryGetCurrentSelection()})];function Oo(e){return(t,r)=>e(r&&r[0]&&r[0](t)||t.element)}function Ose(e,t){return e|(Br.isName(t)?Br.fromName(t):0)}function Vse(e,t){switch(t.toLowerCase()){case"helix":return e|2;case"alpha":return e|2|4096;case"pi":return e|2|32768;case"310":return e|2|2048;case"beta":return e|4;case"strand":return e|4|4194304;case"sheet":return e|4|8388608;case"turn":return e|16;case"bend":return e|8;case"coil":return e|536870912;default:return e}}function F4e(e,t){let r=[];if(!t)return r;if(typeof t.length=="number")for(let n=0,o=t.length;n<o;n++)r.push(t[n](e));else{let n=Object.keys(t);for(let o=1,i=n.length;o<i;o++)r.push(t[n[o]](e))}return r}(function(){for(let e of N4e)_m.addSymbol(e)})();function To(e,t){return{expression:e,language:t}}(function(e){e.Info={"mol-script":"Mol-Script",pymol:"PyMOL",vmd:"VMD",jmol:"Jmol"};function t(a){return!!a&&typeof a.expression=="string"&&!!a.language}e.is=t;function r(a,l){return a.language===l.language&&a.expression===l.expression}e.areEqual=r;function n(a){switch(a.language){case"mol-script":let l=yse(a.expression);if(l.length===0)throw new Error("No query");return hse(l[0]);case"pymol":case"jmol":case"vmd":return Lse(a.language,a.expression);default:Sr(a.language)}}e.toExpression=n;function o(a){let l=n(a);return $p(l)}e.toQuery=o;function i(a,l){let u=o(a)(new ls(l));return wt.toLociWithSourceUnits(u)}e.toLoci=i;function s(a,l,c){let u=typeof a=="function"?a(ye):a;return $p(u)(new ls(l,c))}e.getStructureSelection=s})(To||(To={}));var BC={dynamicBonds:M.Optional(M.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions."}))},Xf;(function(e){function t(l,c){let u=l&&_o.Provider.get(l),d=u?u.assemblies.map(g=>[g.id,`${g.id}: ${Ms(g.details)}`]):[],m=u?!Ni.isZero(u.spacegroup.cell):!0,p=[];if(u){let{operators:g}=u.spacegroup;for(let b=0,y=g.length;b<y;b++)p.push([b,`${b+1}: ${ha.getOperatorXyz(g[b])}`])}let h=[];l&&l.properties.structAsymMap.forEach(g=>{let b=g.id===g.auth_id?g.id:`${g.id} [auth ${g.auth_id}]`;h.push([g.id,b])});let f={auto:M.Group(BC),model:M.Group(BC),assembly:M.Group({id:M.Optional(l?M.Select(d.length?d[0][0]:"",d,{label:"Asm Id",description:"Assembly Id"}):M.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"})),...BC},{isFlat:!0}),"symmetry-mates":M.Group({radius:M.Numeric(5,{min:0,max:50,step:1}),...BC},{isFlat:!0}),symmetry:M.Group({ijkMin:M.Vec3(D.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:M.Vec3(D.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),...BC},{isFlat:!0}),"symmetry-assembly":M.Group({generators:M.ObjectList({operators:M.ObjectList({index:M.Select(0,p),shift:M.Vec3(D(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},g=>`${g.index+1}_${g.shift.map(b=>b+5).join("")}`,{defaultValue:[]}),asymIds:M.MultiSelect([],h)},g=>`${g.asymIds.length} asym ids, ${g.operators.length} operators`,{defaultValue:[]}),...BC},{isFlat:!0})},C=[];return c==="auto"&&C.push(["auto","Auto"]),C.push(["model","Model"]),d.length>0&&C.push(["assembly","Assembly"]),m&&(C.push(["symmetry-mates","Symmetry Mates"]),C.push(["symmetry","Symmetry (indices)"]),C.push(["symmetry-assembly","Symmetry (assembly)"])),{type:M.MappedStatic(c||"model",f,{options:C})}}e.getParams=t;function r(l,c){return!(c.name==="symmetry-assembly"||c.name==="symmetry"&&l.name==="symmetry")}e.canAutoUpdate=r;async function n(l,c,u,d,m){let p,h=_o.Provider.get(u);!d&&h&&h.assemblies.length!==0&&(d=h.assemblies[0].id),!h||h.assemblies.length===0?l.log.warn(`Model '${u.entryId}' has no assembly, returning model structure.`):(p=vg.findAssembly(u,d||""),p||l.log.warn(`Model '${u.entryId}' has no assembly called '${d}', returning model structure.`));let f=qe.ofModel(u,m);if(!p){let b={label:"Model",description:qe.elementDescription(f)};return new fe.Molecule.Structure(f,b)}d=p.id;let C=await ou.buildAssembly(f,d).runInContext(c),g={label:`Assembly ${d}`,description:qe.elementDescription(C)};return new fe.Molecule.Structure(C,g)}async function o(l,c,u,d,m){let p=qe.ofModel(c,m),h=await ou.buildSymmetryRange(p,u,d).runInContext(l),f={label:`Symmetry [${u}] to [${d}]`,description:qe.elementDescription(h)};return new fe.Molecule.Structure(h,f)}async function i(l,c,u,d){let m=qe.ofModel(c,d),p=await ou.builderSymmetryMates(m,u).runInContext(l),h={label:"Symmetry Mates",description:qe.elementDescription(p)};return new fe.Molecule.Structure(p,h)}async function s(l,c,u,d,m){let p=qe.ofModel(c,m),h=await ou.buildSymmetryAssembly(p,u,d).runInContext(l),f={label:"Symmetry Assembly",description:qe.elementDescription(h)};return new fe.Molecule.Structure(h,f)}async function a(l,c,u,d){let m=d?.params,p=_o.Provider.get(u);if(!p||!d||d.name==="model"){let h=qe.ofModel(u,m);return new fe.Molecule.Structure(h,{label:"Model",description:qe.elementDescription(h)})}if(d.name==="auto")if(p.assemblies.length===0){let h=qe.ofModel(u,m);return new fe.Molecule.Structure(h,{label:"Model",description:qe.elementDescription(h)})}else return n(l,c,u,void 0,m);if(d.name==="assembly")return n(l,c,u,d.params.id,m);if(d.name==="symmetry")return o(c,u,d.params.ijkMin,d.params.ijkMax,m);if(d.name==="symmetry-mates")return i(c,u,d.params.radius,m);if(d.name==="symmetry-assembly")return s(c,u,d.params.generators,p,m);Sr(d)}e.create=a})(Xf||(Xf={}));var Ml;(function(e){function t(a,l,c){return a.currentStructure!==c?!1:To.is(l)?!!a.script&&To.areEqual(a.script,l):a.expression===l}e.isUnchanged=t;function r(a,l){let c=To.is(l)?l:void 0,u=To.is(l)?To.toExpression(l):l,d=$p(u);return{script:c,expression:u,compiled:d,originalStructure:a,currentStructure:a}}e.create=r;function n(a,l){return a.compiled(new ls(l))}e.run=n;function o(a,l){let c=r(a,l);return{entry:c,selection:n(c,a)}}e.createAndRun=o;function i(a,l){return a.currentStructure=l,a.compiled(new ls(l))}e.updateStructure=i;function s(a,l,c){let u=wt.unionStructure(l);a.label=`${c||"Selection"}`,a.description=qe.elementDescription(u),a.data=u}e.updateStructureObject=s})(Ml||(Ml={}));var Gse={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},O4e=new Set(["LI","NA","K","RB","CS","FR"]);function V4e(e){return O4e.has(e)}var G4e=new Set(["BE","MG","CA","SR","BA","RA"]);function U4e(e){return G4e.has(e)}var z4e=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]);function H4e(e){return z4e.has(e)}var j4e=new Set(["F","CL","BR","I","AT"]);function HG(e){return j4e.has(e)}function jG(e){let t=ry(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function $4e(e){let t=ry(e);return t>=57&&t<=71}function W4e(e){let t=ry(e);return t>=89&&t<=103}function Use(e){return V4e(e)||U4e(e)||$4e(e)||W4e(e)||jG(e)||H4e(e)}var Ln;(function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"})(Ln||(Ln={}));function Nn(e,t,r={}){var n;let o;return{label:e,expression:t,description:r.description||"",category:(n=r.category)!==null&&n!==void 0?n:Ln.Misc,isHidden:!!r.isHidden,priority:r.priority||0,referencesCurrent:!!r.referencesCurrent,get query(){return o||(o=$p(t)),o},ensureCustomProperties:r.ensureCustomProperties,async getSelection(i,s,a){let l=i.managers.structure.selection.getStructure(a),c=l?wt.Sequence(a,[l]):wt.Empty(a);return r.ensureCustomProperties&&await r.ensureCustomProperties({runtime:s,assetManager:i.managers.asset},a),o||(o=$p(t)),o(new ls(a,{currentSelection:c}))}}}var q4e=Nn("All",ye.struct.generator.all(),{category:"",priority:1e3}),Z4e=Nn("Current Selection",ye.internal.generator.current(),{category:"",referencesCurrent:!0}),K4e=Nn("Polymer",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.logic.and([ye.core.rel.eq([ye.ammp("entityType"),"polymer"]),ye.core.str.match([ye.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),ye.ammp("entitySubtype")])])})]),{category:Ln.Type}),X4e=Nn("Trace",ye.struct.modifier.union([ye.struct.combinator.merge([ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.rel.eq([ye.ammp("entityType"),"polymer"]),"chain-test":ye.core.set.has([ye.set("sphere","gaussian"),ye.ammp("objectPrimitive")])})]),ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.rel.eq([ye.ammp("entityType"),"polymer"]),"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"atom-test":ye.core.set.has([ye.set("CA","P"),ye.ammp("label_atom_id")])})])])]),{category:Ln.Structure}),LC=ye.core.logic.and([ye.core.rel.eq([ye.ammp("entityType"),"polymer"]),ye.core.str.match([ye.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),ye.ammp("entitySubtype")])]),DD=ye.core.logic.and([ye.core.rel.eq([ye.ammp("entityType"),"polymer"]),ye.core.str.match([ye.re("(nucleotide|peptide nucleic acid)","i"),ye.ammp("entitySubtype")])]),Hb=ye.core.str.match([ye.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),ye.ammp("chemCompType")]),Y4e=Nn("Backbone",ye.struct.modifier.union([ye.struct.combinator.merge([ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":LC,"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.logic.not([Hb]),"atom-test":ye.core.set.has([ye.set(...$n.toArray(Td)),ye.ammp("label_atom_id")])})]),ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":DD,"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.logic.not([Hb]),"atom-test":ye.core.set.has([ye.set(...$n.toArray(fC)),ye.ammp("label_atom_id")])})])])]),{category:Ln.Structure}),Q4e=Nn("Sidechain",ye.struct.modifier.union([ye.struct.combinator.merge([ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":LC,"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.logic.not([Hb]),"atom-test":ye.core.logic.or([ye.core.logic.not([ye.core.set.has([ye.set(...$n.toArray(Td)),ye.ammp("label_atom_id")])])])})]),ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":DD,"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.logic.not([Hb]),"atom-test":ye.core.logic.or([ye.core.logic.not([ye.core.set.has([ye.set(...$n.toArray(fC)),ye.ammp("label_atom_id")])])])})])])]),{category:Ln.Structure}),J4e=Nn("Sidechain with Trace",ye.struct.modifier.union([ye.struct.combinator.merge([ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":LC,"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.logic.not([Hb]),"atom-test":ye.core.logic.or([ye.core.logic.not([ye.core.set.has([ye.set(...$n.toArray(Td)),ye.ammp("label_atom_id")])]),ye.core.rel.eq([ye.ammp("label_atom_id"),"CA"]),ye.core.logic.and([ye.core.rel.eq([ye.ammp("auth_comp_id"),"PRO"]),ye.core.rel.eq([ye.ammp("label_atom_id"),"N"])])])})]),ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":DD,"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.logic.not([Hb]),"atom-test":ye.core.logic.or([ye.core.logic.not([ye.core.set.has([ye.set(...$n.toArray(fC)),ye.ammp("label_atom_id")])]),ye.core.rel.eq([ye.ammp("label_atom_id"),"P"])])})])])]),{category:Ln.Structure}),e5e=Nn("Protein",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":LC})]),{category:Ln.Type}),t5e=Nn("Nucleic",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":DD})]),{category:Ln.Type}),r5e=Nn("Helix",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":LC,"residue-test":ye.core.flags.hasAny([ye.ammp("secondaryStructureFlags"),ye.core.type.bitflags([2])])})]),{category:Ln.Structure,ensureCustomProperties:(e,t)=>tl.attach(e,t)}),n5e=Nn("Beta Strand/Sheet",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":LC,"residue-test":ye.core.flags.hasAny([ye.ammp("secondaryStructureFlags"),ye.core.type.bitflags([4])])})]),{category:Ln.Structure,ensureCustomProperties:(e,t)=>tl.attach(e,t)}),o5e=Nn("Water",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.rel.eq([ye.ammp("entityType"),"water"])})]),{category:Ln.Type}),i5e=Nn("Ion",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.rel.eq([ye.ammp("entitySubtype"),"ion"])})]),{category:Ln.Type}),s5e=Nn("Lipid",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.rel.eq([ye.ammp("entitySubtype"),"lipid"])})]),{category:Ln.Type}),kD=Nn("Carbohydrate",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.logic.or([ye.core.rel.eq([ye.ammp("entityType"),"branched"]),ye.core.logic.and([ye.core.rel.eq([ye.ammp("entityType"),"non-polymer"]),ye.core.str.match([ye.re("oligosaccharide","i"),ye.ammp("entitySubtype")])])])})]),{category:Ln.Type}),zse=Nn("Carbohydrate with Connected",ye.struct.modifier.union([ye.struct.modifier.includeConnected({0:kD.expression,"layer-count":1,"as-whole-residues":!0})]),{category:Ln.Internal,isHidden:!0}),Hse=Nn("Connected to Carbohydrate",ye.struct.modifier.union([ye.struct.modifier.exceptBy({0:zse.expression,by:kD.expression})]),{category:Ln.Internal,isHidden:!0}),WG=Nn("Ligand",ye.struct.modifier.union([ye.struct.modifier.exceptBy({0:ye.struct.modifier.union([ye.struct.combinator.merge([ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.logic.and([ye.core.logic.or([ye.core.rel.eq([ye.ammp("entityType"),"non-polymer"]),ye.core.rel.neq([ye.ammp("entityPrdId"),""])]),ye.core.logic.not([ye.core.str.match([ye.re("(oligosaccharide|lipid|ion)","i"),ye.ammp("entitySubtype")])])]),"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.logic.not([ye.core.str.match([ye.re("saccharide","i"),ye.ammp("chemCompType")])])})]),ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.rel.eq([ye.ammp("entityType"),"polymer"]),"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":Hb})])])]),by:ye.struct.combinator.merge([ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.rel.eq([ye.ammp("entityType"),"polymer"]),"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.set.has([ye.set(...$n.toArray(hg)),ye.ammp("label_comp_id")])})]),ye.struct.generator.atomGroups({"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.set.has([ye.set(...$n.toArray(xne)),ye.ammp("label_comp_id")])})])})]),{category:Ln.Type}),jse=Nn("Ligand with Connected",ye.struct.modifier.union([ye.struct.modifier.exceptBy({0:ye.struct.modifier.union([ye.struct.modifier.includeConnected({0:WG.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":ye.core.flags.hasAny([ye.struct.bondProperty.flags(),ye.core.type.bitflags([3])])})]),by:kD.expression})]),{category:Ln.Internal,isHidden:!0}),$se=Nn("Connected to Ligand",ye.struct.modifier.union([ye.struct.modifier.exceptBy({0:jse.expression,by:WG.expression})]),{category:Ln.Internal,isHidden:!0}),a5e=Nn("Connected to Ligand or Carbohydrate",ye.struct.modifier.union([ye.struct.combinator.merge([Hse.expression,$se.expression])]),{category:Ln.Internal,isHidden:!0}),l5e=Nn("Disulfide Bridges",ye.struct.modifier.union([ye.struct.combinator.merge([ye.struct.modifier.union([ye.struct.modifier.wholeResidues([ye.struct.filter.isConnectedTo({0:ye.struct.generator.atomGroups({"residue-test":ye.core.set.has([ye.set("CYS"),ye.ammp("auth_comp_id")]),"atom-test":ye.core.set.has([ye.set("SG"),ye.ammp("label_atom_id")])}),target:ye.struct.generator.atomGroups({"residue-test":ye.core.set.has([ye.set("CYS"),ye.ammp("auth_comp_id")]),"atom-test":ye.core.set.has([ye.set("SG"),ye.ammp("label_atom_id")])}),"bond-test":!0})])]),ye.struct.modifier.union([ye.struct.modifier.wholeResidues([ye.struct.modifier.union([ye.struct.generator.bondedAtomicPairs({0:ye.core.flags.hasAny([ye.struct.bondProperty.flags(),ye.core.type.bitflags([8])])})])])])])]),{category:Ln.Bond}),c5e=Nn("NOS Bridges",ye.struct.modifier.union([ye.struct.modifier.wholeResidues([ye.struct.filter.isConnectedTo({0:ye.struct.generator.atomGroups({"residue-test":ye.core.set.has([ye.set("CSO","LYS"),ye.ammp("auth_comp_id")]),"atom-test":ye.core.set.has([ye.set("OD","NZ"),ye.ammp("label_atom_id")])}),target:ye.struct.generator.atomGroups({"residue-test":ye.core.set.has([ye.set("CSO","LYS"),ye.ammp("auth_comp_id")]),"atom-test":ye.core.set.has([ye.set("OD","NZ"),ye.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:Ln.Bond}),u5e=Nn("Non-standard Residues in Polymers",ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.rel.eq([ye.ammp("entityType"),"polymer"]),"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.ammp("isNonStandard")})]),{category:Ln.Residue}),d5e=Nn("Coarse Elements",ye.struct.modifier.union([ye.struct.generator.atomGroups({"chain-test":ye.core.set.has([ye.set("sphere","gaussian"),ye.ammp("objectPrimitive")])})]),{category:Ln.Type}),m5e=Nn("Rings in Residues",ye.struct.modifier.union([ye.struct.generator.rings()]),{category:Ln.Residue}),p5e=Nn("Aromatic Rings in Residues",ye.struct.modifier.union([ye.struct.generator.rings({"only-aromatic":!0})]),{category:Ln.Residue}),f5e=Nn("Surrounding Residues (5 \u212B) of Selection",ye.struct.modifier.union([ye.struct.modifier.exceptBy({0:ye.struct.modifier.includeSurroundings({0:ye.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:ye.internal.generator.current()})]),{description:"Select residues within 5 \u212B of the current selection.",category:Ln.Manipulate,referencesCurrent:!0}),h5e=Nn("Surrounding Ligands (5 \u212B) of Selection",ye.struct.modifier.union([ye.struct.modifier.surroundingLigands({0:ye.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212B of the current selection.",category:Ln.Manipulate,referencesCurrent:!0}),g5e=Nn("Surrounding Atoms (5 \u212B) of Selection",ye.struct.modifier.union([ye.struct.modifier.exceptBy({0:ye.struct.modifier.includeSurroundings({0:ye.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:ye.internal.generator.current()})]),{description:"Select atoms within 5 \u212B of the current selection.",category:Ln.Manipulate,referencesCurrent:!0}),y5e=Nn("Inverse / Complement of Selection",ye.struct.modifier.union([ye.struct.modifier.exceptBy({0:ye.struct.generator.all(),by:ye.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:Ln.Manipulate,referencesCurrent:!0}),v5e=Nn("Residues Covalently Bonded to Selection",ye.struct.modifier.union([ye.struct.modifier.includeConnected({0:ye.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:Ln.Manipulate,referencesCurrent:!0}),b5e=Nn("Covalently Bonded Component",ye.struct.modifier.union([ye.struct.modifier.includeConnected({0:ye.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:Ln.Manipulate,referencesCurrent:!0}),x5e=Nn("Residues with Cov. or Metallic Bond to Selection",ye.struct.modifier.union([ye.struct.modifier.includeConnected({0:ye.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":ye.core.flags.hasAny([ye.struct.bondProperty.flags(),ye.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:Ln.Manipulate,referencesCurrent:!0}),C5e=Nn("Whole Residues of Selection",ye.struct.modifier.union([ye.struct.modifier.wholeResidues({0:ye.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:Ln.Manipulate,referencesCurrent:!0}),S5e=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0),I5e=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0);function $G([e,t],r,n=0){let o=e.length===1&&!Wse.has(e[0])?`[${e[0]}] ${t}`:`${t} (${e.join(", ")})`;return Nn(o,ye.struct.modifier.union([ye.struct.generator.atomGroups({"residue-test":ye.core.set.has([ye.set(...e),ye.ammp("auth_comp_id")])})]),{category:r,priority:n,description:o})}function A5e([e,t],r,n){let o=`${t} (${e.join(", ")})`;return Nn(o,ye.struct.modifier.union([ye.struct.generator.atomGroups({"atom-test":ye.core.set.has([ye.set(...e),ye.acp("elementSymbol")])})]),{category:r,priority:n,description:o})}function w5e([e,t],r,n){let o=`${t}`;return Nn(`${t}`,ye.struct.modifier.union([ye.struct.generator.atomGroups({"entity-test":ye.core.list.equal([ye.list(...e),ye.ammp("entityDescription")])})]),{category:r,priority:n,description:o})}var Wse=$n.unionMany(B3,gC,yC,hC);function qse(e){let t=new Set;for(let n of e)n.uniqueElementSymbols.forEach(o=>t.add(o));let r=[];return t.forEach(n=>{let o=Gse[n]||n;r.push(A5e([[n],o],"Element Symbol",0))}),r}function Zse(e){let t=new Map,r=new Set;for(let o of e){o.uniqueResidueNames.forEach(i=>r.add(i));for(let i of o.models)o.uniqueResidueNames.forEach(s=>{let a=i.properties.chemicalComponentMap.get(s);a&&t.set(s,a.name)})}let n=[];return $n.difference(r,Wse).forEach(o=>{let i=t.get(o)||o;n.push($G([[o],i],"Ligand/Non-standard Residue",200))}),n}function Kse(e){let t=new Map,r=ce.Location.create();for(let o of e){r.structure=o;for(let i of o.unitSymmetryGroups){r.unit=i.units[0],r.element=i.elements[0];let s=nt.entity.type(r);if(s==="polymer"||s==="branched"){let a=nt.entity.pdbx_description(r);t.set(a.join(", "),a)}}}let n=[];return t.forEach((o,i)=>{n.push(w5e([o,i],"Polymer/Carbohydrate Entities",300))}),n}var Ai={all:q4e,current:Z4e,polymer:K4e,trace:X4e,backbone:Y4e,sidechain:Q4e,sidechainWithTrace:J4e,protein:e5e,nucleic:t5e,helix:r5e,beta:n5e,water:o5e,ion:i5e,lipid:s5e,branched:kD,branchedPlusConnected:zse,branchedConnectedOnly:Hse,ligand:WG,ligandPlusConnected:jse,ligandConnectedOnly:$se,connectedOnly:a5e,disulfideBridges:l5e,nosBridges:c5e,nonStandardPolymer:u5e,coarse:d5e,ring:m5e,aromaticRing:p5e,surroundings:f5e,surroundingLigands:h5e,surroundingAtoms:g5e,complement:y5e,covalentlyBonded:v5e,covalentlyOrMetallicBonded:x5e,covalentlyBondedComponent:b5e,wholeResidues:C5e},PD=class{add(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1}remove(t){let r=this.list.indexOf(t);r!==-1&&(this.list.splice(r,1),this.options.splice(r,1),this.version+=1)}constructor(){this.list=[],this.options=[],this.version=1,this.list.push(...Object.values(Ai),...S5e.map(t=>$G(t,Ln.AminoAcid)),...I5e.map(t=>$G(t,Ln.NucleicBase))),this.options.push(...this.list.map(t=>[t,t.label,t.category]))}};var Xse=()=>({type:M.MappedStatic("static",{static:M.Text("polymer"),expression:M.Value(ye.struct.generator.all),bundle:M.Value(ce.Bundle.Empty),script:M.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:M.Optional(M.Boolean(!0,{isHidden:!0})),label:M.Text("",{isHidden:!0})});function Yse(e,t,r){r.source=e;let n=qe.Empty,o;switch(t.type.name){case"static":{let s;switch(t.type.params){case"all":s=Ai.all.query,o="All";break;case"polymer":s=Ai.polymer.query,o="Polymer";break;case"protein":s=Ai.protein.query,o="Protein";break;case"nucleic":s=Ai.nucleic.query,o="Nucleic";break;case"water":s=Pn.internal.water(),o="Water";break;case"ion":s=Ai.ion.query,o="Ion";break;case"lipid":s=Ai.lipid.query,o="Lipid";break;case"branched":s=Ai.branchedPlusConnected.query,o="Branched";break;case"ligand":s=Ai.ligandPlusConnected.query,o="Ligand";break;case"non-standard":s=Ai.nonStandardPolymer.query,o="Non-standard";break;case"coarse":s=Ai.coarse.query,o="Coarse";break;default:Sr(t.type)}let a=s(new ls(e));n=wt.unionStructure(a);break}case"script":case"expression":{let{selection:s,entry:a}=Ml.createAndRun(e,t.type.params);r.entry=a,n=wt.unionStructure(s);break}case"bundle":{if(t.type.params.hash!==e.hashCode)break;n=ce.Bundle.toStructure(t.type.params,e);break}}if(t.nullIfEmpty&&n.elementCount===0)return Hn.Null;let i={label:`${t.label||o||"Component"}`,description:qe.elementDescription(n)};return new fe.Molecule.Structure(n,i)}function Qse(e,t,r,n,o){if(r.type.name!==n.type.name)return st.UpdateResult.Recreate;let i=!1;switch(n.type.name){case"static":return r.type.params!==n.type.params?st.UpdateResult.Recreate:qe.areEquivalent(e,o.source)?t.data.model===e.model?st.UpdateResult.Unchanged:Ut.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),st.UpdateResult.Updated):st.UpdateResult.Recreate:st.UpdateResult.Recreate;case"script":if(!To.areEqual(r.type.params,n.type.params))return st.UpdateResult.Recreate;case"expression":{if(r.type.params!==n.type.params)return st.UpdateResult.Recreate;if(e===o.source)break;let s=o.entry,a=Ml.updateStructure(s,e);o.source=e,t.data=wt.unionStructure(a),Ml.updateStructureObject(t,a,n.label),i=!0;break}case"bundle":{if(e===o.source&&ce.Bundle.areEqual(r.type.params,n.type.params))break;o.source=e,n.type.params.hash!==e.hashCode?(i=t.data.elementCount!==0,t.data=t.data.elementCount===0?t.data:qe.Empty):(i=!0,t.data=ce.Bundle.toStructure(n.type.params,e));break}}if(i){if(n.nullIfEmpty&&t.data.elementCount===0)return st.UpdateResult.Null;t.description=qe.elementDescription(t.data)}return r.label!==n.label&&(i=!0,t.label=`${n.label||t.label}`),i?st.UpdateResult.Updated:st.UpdateResult.Unchanged}function Jse(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:return 0;case 3:return 1;case 2:return 2;case 1:return 3;case 4:return 0;default:return 0}}function qG(e,t){let r=ct.create(e.data,t*2),n=ct.create(e.data,t*2),o=ct.create(e.data,t*2),i=ct.create(e.data,t*2),s=ct.create(e.data,t*2);for(let a=0;a<t;++a){Tt.markLine(e);let{tokenStart:l,position:c}=e;Tt.trim(e,l,l+10),ct.addUnchecked(r,e.tokenStart,e.tokenEnd),Tt.trim(e,l+10,l+20),ct.addUnchecked(n,e.tokenStart,e.tokenEnd),Tt.trim(e,l+20,l+30),ct.addUnchecked(o,e.tokenStart,e.tokenEnd),Tt.trim(e,l+31,l+34),ct.addUnchecked(i,e.tokenStart,e.tokenEnd),Tt.trim(e,l+36,l+39),ct.addUnchecked(s,e.tokenStart,e.tokenEnd),e.position=c}return{count:t,x:dr(r)(ue.Schema.float),y:dr(n)(ue.Schema.float),z:dr(o)(ue.Schema.float),type_symbol:dr(i)(ue.Schema.str),formal_charge:dr(s)(ue.Schema.int)}}function ZG(e,t){let r=ct.create(e.data,t*2),n=ct.create(e.data,t*2),o=ct.create(e.data,t*2);for(let i=0;i<t;++i){Tt.markLine(e);let{tokenStart:s,position:a}=e;Tt.trim(e,s,s+3),ct.addUnchecked(r,e.tokenStart,e.tokenEnd),Tt.trim(e,s+3,s+6),ct.addUnchecked(n,e.tokenStart,e.tokenEnd),Tt.trim(e,s+6,s+9),ct.addUnchecked(o,e.tokenStart,e.tokenEnd),e.position=a}return{count:t,atomIdxA:dr(r)(ue.Schema.int),atomIdxB:dr(n)(ue.Schema.int),order:dr(o)(ue.Schema.int)}}function _5e(e,t,r){Tt.trim(e,t+6,t+9);let n=parseInt(Tt.getTokenString(e));for(let o=0;o<n;++o){let i=9+o*8;Tt.trim(e,t+i,t+i+4);let s=Tt.getTokenString(e);r.atomIdx.push(+s),Tt.trim(e,t+i+4,t+i+8);let a=Tt.getTokenString(e);r.charge.push(+a)}Tt.eatLine(e)}function KG(e){let n={atomIdx:[],charge:[]};for(;e.position<e.length;){let{position:i}=e;Tt.trim(e,i+3,i+6);let s=Tt.getTokenString(e);if(s==="END")break;switch(Tt.eatLine(e),s){case"CHG":_5e(e,i,n);break;default:break}}return{atomIdx:ue.ofIntArray(n.atomIdx),charge:ue.ofIntArray(n.charge)}}function T5e(e){let t=Tt(e),r=Tt.readLine(t).trim(),n=Tt.readLine(t).trim(),o=Tt.readLine(t).trim(),i=Tt.readLine(t),s=+i.substr(0,3),a=+i.substr(3,3),l=qG(t,s),c=ZG(t,a),u=KG(t),d={title:r,program:n,comment:o,atoms:l,bonds:c,formalCharges:u};return Hr.success(d)}function eae(e){return ke.create("Parse Mol",async()=>T5e(e))}async function YG(e,t,r){let{atoms:n,bonds:o,formalCharges:i}=e,s=ue.ofConst("MOL",e.atoms.count,ue.Schema.str),a=ue.ofConst("A",e.atoms.count,ue.Schema.str),l=ue.asArrayColumn(n.type_symbol),c=ue.ofConst(1,n.count,ue.Schema.int),u=new Int32Array(e.atoms.count);if(i.atomIdx.rowCount>0)for(let C=0;C<i.atomIdx.rowCount;C++)u[i.atomIdx.value(C)-1]=i.charge.value(C);else for(let C=0;C<e.atoms.count;C++)u[C]=Jse(n.formal_charge.value(C));let d=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:a,auth_atom_id:l,auth_comp_id:s,auth_seq_id:c,Cartn_x:ue.asArrayColumn(n.x,Float32Array),Cartn_y:ue.asArrayColumn(n.y,Float32Array),Cartn_z:ue.asArrayColumn(n.z,Float32Array),id:ue.range(0,n.count-1),label_asym_id:a,label_atom_id:l,label_comp_id:s,label_seq_id:c,label_entity_id:ue.ofConst("1",n.count,ue.Schema.str),occupancy:ue.ofConst(1,n.count,ue.Schema.float),type_symbol:l,pdbx_PDB_model_num:ue.ofConst(1,n.count,ue.Schema.int),pdbx_formal_charge:ue.ofIntArray(u)},n.count),m=new qi;m.setNames([["MOL","Unknown Entity"]]),m.getEntityId("MOL",0,"A");let p=new Is(c,l);p.setNames([["MOL","Unknown Molecule"]]),p.add("MOL",0);let h=as({entity:m.getEntityTable(),chem_comp:p.getChemCompTable(),atom_site:d}),f=await va(h,t??XG.create(e),r);if(f.frameCount>0){let C=ue.ofIntArray(ue.mapToArray(o.atomIdxA,x=>x-1,Int32Array)),g=ue.ofIntArray(ue.mapToArray(o.atomIdxB,x=>x-1,Int32Array)),b=ue.asArrayColumn(o.order,Int32Array),y=Zi.fromData({pairs:{indexA:C,indexB:g,order:b},count:n.count},{maxDistance:1/0});Zi.Provider.set(f.representative,y)}return f}var XG;(function(e){function t(n){return n?.kind==="mol"}e.is=t;function r(n){return{kind:"mol",name:n.title,data:n}}e.create=r})(XG||(XG={}));function tae(e){return ke.create("Parse MOL",t=>YG(e,void 0,t))}function E5e(e){let t=e.it_number.value(0),r=e["name_h-m_full"].value(0).replace("-"," ");return e.it_number.isDefined?(e["name_h-m_full"].isDefined,t):r}function P5e(e){let{cell:t,space_group:r}=e,n=E5e(r),o=Ni.create(n,D.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),D.scale(D(),D.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:ha.create(o),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}async function D5e(e,t,r){var n;let o=e.atom_site._rowCount,i=ue.ofConst("MOL",o,ue.Schema.str),s=ue.ofConst("A",o,ue.Schema.str),a=ue.ofConst(1,o,ue.Schema.int),l=P5e(e),c=l.spacegroup.cell.fromFractional,{fract_x:u,fract_y:d,fract_z:m}=e.atom_site,p=new Float32Array(o),h=new Float32Array(o),f=new Float32Array(o),C=D();for(let w=0;w<o;++w)D.set(C,u.value(w),d.value(w),m.value(w)),D.transformMat4(C,C,c),p[w]=C[0],h[w]=C[1],f[w]=C[2];let{type_symbol:g,label:b}=e.atom_site,y,x;if(g.isDefined){let w=new Array(o),S=new Int8Array(o);for(let P=0;P<o;++P){let k=g.value(P),L=k.length;k[L-1]==="+"?(w[P]=k.substring(0,L-2),S[P]=parseInt(k[L-2])):k[L-2]==="+"?(w[P]=k.substring(0,L-2),S[P]=parseInt(k[L-1])):k[L-1]==="-"?(w[P]=k.substring(0,L-2),S[P]=-parseInt(k[L-2])):k[L-2]==="-"?(w[P]=k.substring(0,L-2),S[P]=-parseInt(k[L-1])):(w[P]=k,S[P]=0)}y=ue.ofStringArray(w),x=ue.ofIntArray(S)}else{let w=new Array(o);for(let S=0;S<o;++S)w[S]=vm(b.value(S),"");y=ue.ofStringArray(w),x=ue.Undefined(o,ue.Schema.int)}let A=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:s,auth_atom_id:b,auth_comp_id:i,auth_seq_id:a,Cartn_x:ue.ofFloatArray(p),Cartn_y:ue.ofFloatArray(h),Cartn_z:ue.ofFloatArray(f),id:ue.range(0,o-1),label_asym_id:s,label_atom_id:b,label_comp_id:i,label_seq_id:a,label_entity_id:ue.ofConst("1",o,ue.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ue.ofConst(1,o,ue.Schema.float),type_symbol:y,pdbx_formal_charge:x,pdbx_PDB_model_num:ue.ofConst(1,o,ue.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},o),v=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),_=new qi;_.setNames([["MOL",v||"Unknown Entity"]]),_.getEntityId("MOL",0,"A");let I=new Is(a,e.atom_site.type_symbol);I.setNames([["MOL",v||"Unknown Molecule"]]),I.add("MOL",0);let T=as({entity:_.getEntityTable(),chem_comp:I.getChemCompTable(),atom_site:A}),E=await va(T,t,r);if(E.frameCount>0){let w=E.representative;_o.Provider.set(w,l);let S=e.geom_bond._rowCount;if(S>0){let P={},{label:k}=e.atom_site;for(let z=0,$=k.rowCount;z<$;++z)P[k.value(z)]=z;let L=(n=t.data.frame.categories.ccdc_geom_bond_type)===null||n===void 0?void 0:n.getField(""),R=[],N=[],F=[],H=[],V=[],q=new Set,Q=0,{atom_site_label_1:O,atom_site_label_2:B,valence:j,distance:U}=e.geom_bond;for(let z=0;z<S;++z){let $=P[O.value(z)],Z=P[B.value(z)],J=$<Z?Ys($,Z):Ys(Z,$);if(!q.has(J)){if(q.add(J),R[Q]=$,N[Q]=Z,H[Q]=U.value(z)||-1,L){let ie=L.str(z);ie==="D"?(F[Q]=2,V[Q]=1):ie==="A"?(F[Q]=1,V[Q]=17):(F[Q]=1,V[Q]=1)}else V[Q]=1,F[Q]=j.isDefined?j.value(z):1;Q+=1}}Zi.Provider.set(w,Zi.fromData({pairs:{indexA:ue.ofIntArray(R),indexB:ue.ofIntArray(N),order:ue.ofIntArray(F),distance:ue.ofFloatArray(H),flag:ue.ofIntArray(V)},count:o}))}}return E}function k5e(e){if(!nw.is(e.sourceData))return;let{atom_site:t,atom_site_aniso:r}=e.sourceData.data.db,n=gr.ofPartialColumns(ju.Schema,{U:r.u},r._rowCount),o=ju.getElementToAnsiotropFromLabel(t.label,r.label);return{data:n,elementToAnsiotrop:o}}function M5e(e){return nw.is(e.sourceData)?e.sourceData.data.db.atom_site_aniso.u.isDefined:!1}ju.Provider.formatRegistry.add("cifCore",k5e,M5e);var nw;(function(e){function t(n){return n?.kind==="cifCore"}e.is=t;function r(n,o){return o||(o=Di.schema.cifCore(n)),{kind:"cifCore",name:o.database_code.depnum_ccdc_archive.value(0)||o.database_code.depnum_ccdc_fiz.value(0)||o.database_code.icsd.value(0)||o.database_code.mdf.value(0)||o.database_code.nbs.value(0)||o.database_code.csd.value(0)||o.database_code.cod.value(0)||o._name,data:{db:o,frame:n}}}e.fromFrame=r})(nw||(nw={}));function rae(e){let t=nw.fromFrame(e);return ke.create("Parse CIF Core",r=>D5e(t.data.db,t,r))}async function R5e(e,t){let{atoms:r}=e,n=ue.ofConst("MOL",e.atoms.count,ue.Schema.str),o=ue.ofConst("A",e.atoms.count,ue.Schema.str),i=ue.ofArray({array:ue.mapToArray(r.number,d=>dne(d)),schema:ue.Schema.Aliased(ue.Schema.str)}),s=ue.ofConst(1,r.count,ue.Schema.int),a=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:o,auth_atom_id:i,auth_comp_id:n,auth_seq_id:s,Cartn_x:ue.asArrayColumn(r.x,Float32Array),Cartn_y:ue.asArrayColumn(r.y,Float32Array),Cartn_z:ue.asArrayColumn(r.z,Float32Array),id:ue.range(0,r.count-1),label_asym_id:o,label_atom_id:i,label_comp_id:n,label_seq_id:s,label_entity_id:ue.ofConst("1",r.count,ue.Schema.str),occupancy:ue.ofConst(1,r.count,ue.Schema.float),type_symbol:i,pdbx_PDB_model_num:ue.ofConst(1,r.count,ue.Schema.int)},r.count),l=new qi;l.setNames([["MOL","Unknown Entity"]]),l.getEntityId("MOL",0,"A");let c=new Is(s,i);c.setNames([["MOL","Unknown Molecule"]]),c.add("MOL",0);let u=as({entity:l.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:a});return await va(u,QG.create(e),t)}var QG;(function(e){function t(n){return n?.kind==="cube"}e.is=t;function r(n){return{kind:"cube",name:n.header.comment1,data:n}}e.create=r})(QG||(QG={}));function nae(e){return ke.create("Parse Cube",t=>R5e(e,t))}var{skipWhitespace:JG,eatValue:oae,markLine:Tm,getTokenString:Em,readLine:iae}=Tt;function B5e(){return{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""}}function L5e(e,t){return{tokenizer:e,molecule:B5e(),runtimeCtx:t}}var sae=/\s+/g;function N5e(e){let{tokenizer:t,molecule:r}=e;for(;Em(t)!=="@<TRIPOS>MOLECULE"&&t.position<t.data.length;)Tm(t);Tm(t),r.mol_name=Em(t),Tm(t);let n=Em(t).trim().split(sae);r.num_atoms=parseInt(n[0]),r.num_bonds=parseInt(n[1]),r.num_subst=parseInt(n[2]),r.num_feat=parseInt(n[3]),r.num_sets=parseInt(n[4]),Tm(t);let o=Em(t);if(o.startsWith("@<TRIPOS>"))return;r.mol_type=o,Tm(t);let i=Em(t);if(i.startsWith("@<TRIPOS>"))return;r.charge_type=i,Tm(t);let s=Em(t);if(s.startsWith("@<TRIPOS>"))return;r.status_bits=s,Tm(t);let a=Em(t);a.startsWith("@<TRIPOS>")||(r.mol_comment=a)}async function F5e(e){let{tokenizer:t,molecule:r}=e;for(;Em(t)!=="@<TRIPOS>ATOM"&&t.position<t.data.length;)Tm(t);let n=t.position,o=t.lineNumber,a=iae(t).trim().split(/\s+/g).length,l=ct.create(t.data,r.num_atoms*2),c=ct.create(t.data,r.num_atoms*2),u=ct.create(t.data,r.num_atoms*2),d=ct.create(t.data,r.num_atoms*2),m=ct.create(t.data,r.num_atoms*2),p=ct.create(t.data,r.num_atoms*2),h=ct.create(t.data,r.num_atoms*2),f=ct.create(t.data,r.num_atoms*2),C=ct.create(t.data,r.num_atoms*2),g=ct.create(t.data,r.num_atoms*2),b=ue.Undefined(r.num_atoms,ue.Schema.float),y=ue.Undefined(r.num_atoms,ue.Schema.int),x=ue.Undefined(r.num_atoms,ue.Schema.str);t.position=n,t.lineNumber=o;let{length:A}=t,v=0;return await yc(e.runtimeCtx,1e5,void 0,I=>{let T=Math.min(r.num_atoms-v,I);for(let E=0;E<T;E++)for(let w=0;w<a;w++)switch(JG(t),t.tokenStart=t.position,oae(t),w){case 0:ct.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 1:ct.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:ct.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 3:ct.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:ct.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 5:ct.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 6:ct.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 7:ct.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 8:ct.addUnchecked(C,t.tokenStart,t.tokenEnd);break;case 9:ct.addUnchecked(g,t.tokenStart,t.tokenEnd);break}return v+=T,T},I=>I.update({message:"Parsing...",current:t.position,max:A})),{count:r.num_atoms,atom_id:dr(l)(ue.Schema.int),atom_name:dr(c)(ue.Schema.str),x:dr(u)(ue.Schema.float),y:dr(d)(ue.Schema.float),z:dr(m)(ue.Schema.float),atom_type:a>5?dr(p)(ue.Schema.str):x,subst_id:a>6?dr(h)(ue.Schema.int):y,subst_name:a>7?dr(f)(ue.Schema.str):x,charge:a>8?dr(C)(ue.Schema.float):b,status_bit:a>9?dr(g)(ue.Schema.str):x}}async function O5e(e){let{tokenizer:t,molecule:r}=e;for(;Em(t)!=="@<TRIPOS>BOND"&&t.position<t.data.length;)Tm(t);let n=t.position,o=t.lineNumber,a=iae(t).trim().split(/\s+/g).length,l=ct.create(t.data,r.num_bonds*2),c=ct.create(t.data,r.num_bonds*2),u=ct.create(t.data,r.num_bonds*2),d=ct.create(t.data,r.num_bonds*2),m=ct.create(t.data,r.num_bonds*2);t.position=n,t.lineNumber=o;let{length:p}=t,h=0;return await yc(e.runtimeCtx,1e5,void 0,C=>{let g=Math.min(r.num_bonds-h,C);for(let b=0;b<g;b++)for(let y=0;y<a;y++)switch(JG(t),t.tokenStart=t.position,oae(t),y){case 0:ct.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 1:ct.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:ct.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 3:ct.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:ct.addUnchecked(m,t.tokenStart,t.tokenEnd);break}return h+=g,g},C=>C.update({message:"Parsing...",current:t.position,max:p})),{count:r.num_bonds,bond_id:dr(l)(ue.Schema.int),origin_atom_id:dr(c)(ue.Schema.int),target_atom_id:dr(u)(ue.Schema.int),bond_type:dr(d)(ue.Schema.str),status_bits:a>4?dr(m)(ue.Schema.str):ue.Undefined(r.num_bonds,ue.Schema.str)}}function V5e(e){let{tokenizer:t}=e;for(;t.position<t.data.length;){let n=Em(t);if(n==="@<TRIPOS>MOLECULE")return;if(n==="@<TRIPOS>CRYSIN")break;Tm(t)}if(t.position>=t.data.length)return;Tm(t);let r=Em(t).trim().split(sae);return{a:parseFloat(r[0]),b:parseFloat(r[1]),c:parseFloat(r[2]),alpha:parseFloat(r[3]),beta:parseFloat(r[4]),gamma:parseFloat(r[5]),spaceGroup:parseInt(r[6],10),setting:parseInt(r[7],10)}}async function G5e(e,t,r){let n=Tt(t);e.update({message:"Parsing...",current:0,max:t.length});let o=[];for(;n.position<t.length;){let s=L5e(n,e);N5e(s);let a=await F5e(s),l=await O5e(s),c=V5e(s);for(o.push({molecule:s.molecule,atoms:a,bonds:l,crysin:c}),JG(n);Em(n)!=="@<TRIPOS>MOLECULE"&&n.position<n.data.length;)Tm(n)}let i={name:r,structures:o};return Hr.success(i)}function aae(e,t){return ke.create("Parse MOL2",async r=>await G5e(r,e,t))}async function U5e(e,t){let r=[];for(let n=0,o=e.structures.length;n<o;++n){let{molecule:i,atoms:s,bonds:a,crysin:l}=e.structures[n],c=ue.ofConst("A",s.count,ue.Schema.str),u=new Array(s.count),d=!1;for(let g=0;g<s.count;++g)if(s.atom_type.value(g).includes(".")){d=!0;break}for(let g=0;g<s.count;++g)u[g]=d?s.atom_type.value(g).split(".")[0].toUpperCase():vm(s.atom_name.value(g),s.subst_name.value(g));let m=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:c,auth_atom_id:ue.asArrayColumn(s.atom_name),auth_comp_id:s.subst_name,auth_seq_id:s.subst_id,Cartn_x:ue.asArrayColumn(s.x,Float32Array),Cartn_y:ue.asArrayColumn(s.y,Float32Array),Cartn_z:ue.asArrayColumn(s.z,Float32Array),id:ue.asArrayColumn(s.atom_id),label_asym_id:c,label_atom_id:ue.asArrayColumn(s.atom_name),label_comp_id:s.subst_name,label_seq_id:s.subst_id,label_entity_id:ue.ofConst("1",s.count,ue.Schema.str),occupancy:ue.ofConst(1,s.count,ue.Schema.float),type_symbol:ue.ofStringArray(u),pdbx_PDB_model_num:ue.ofConst(n,s.count,ue.Schema.int)},s.count),p=new qi;p.setNames([["MOL",i.mol_name||"Unknown Entity"]]),p.getEntityId("MOL",0,"A");let h=new Is(s.subst_id,s.atom_name);for(let g=0,b=s.subst_name.rowCount;g<b;++g)h.add(s.subst_name.value(g),g);let f=as({entity:p.getEntityTable(),chem_comp:h.getChemCompTable(),atom_site:m}),C=await va(f,eU.create(e),t);if(C.frameCount>0){let g=ue.ofIntArray(ue.mapToArray(a.origin_atom_id,I=>I-1,Int32Array)),b=ue.ofIntArray(ue.mapToArray(a.target_atom_id,I=>I-1,Int32Array)),y=a.bond_id,x=ue.ofIntArray(ue.mapToArray(a.bond_type,I=>{switch(I){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(I)}},Int8Array)),A=ue.ofIntArray(ue.mapToArray(a.bond_type,I=>{switch(I){case"ar":case"am":return 17;case"du":case"nc":return 0;case"un":default:return 1}},Int8Array)),v=Zi.fromData({pairs:{key:y,indexA:g,indexB:b,order:x,flag:A},count:s.count},{maxDistance:l?-1:1/0}),_=C.representative;if(Zi.Provider.set(_,v),Ag.Provider.set(_,{data:s.charge,type:i.charge_type}),l){let I=z5e(l);I&&_o.Provider.set(_,I)}r.push(_)}}return new sc(r)}function z5e(e){if(e.setting!==1)return;let t=Ni.create(e.spaceGroup,D.create(e.a,e.b,e.c),D.scale(D(),D.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:ha.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}var eU;(function(e){function t(n){return n?.kind==="mol2"}e.is=t;function r(n){return{kind:"mol2",name:n.name,data:n}}e.create=r})(eU||(eU={}));function lae(e){return ke.create("Parse MOL2",t=>U5e(e,t))}var NC=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),tU=9,qu;(function(e){function t(u){let d=1,m=0;for(;u>=d&&m<32;)m++,d<<=1;return m}e.sizeOfInt=t;let r=new Uint8Array(32);function n(u,d){let m=1,p=0;r[0]=1;for(let f=0;f<u;f++){let C,g=0;for(C=0;C<m;C++)g+=r[C]*d[f],r[C]=g&255,g>>=8;for(;g!==0;)r[C++]=g&255,g>>=8;m=C}let h=1;for(m--;r[m]>=h;)p++,h*=2;return p+m*8}e.sizeOfInts=n;let o=new ArrayBuffer(8*3);e.buf=new Int32Array(o);let i=new Uint32Array(o);function s(u,d,m){let p=m,h=(1<<p)-1,f=i[1],C=i[2],g=e.buf[0],b=0;for(;p>=8;)C=C<<8|u[d+g++],b|=C>>f<<p-8,p-=8;return p>0&&(f<p&&(f+=8,C=C<<8|u[d+g++]),f-=p,b|=C>>f&(1<<p)-1),b&=h,e.buf[0]=g,e.buf[1]=f,e.buf[2]=C,b}e.decodeBits=s;function a(u,d){let m=i[2],p=e.buf[0];return m=m<<8|u[d+p],e.buf[0]=p+1,e.buf[2]=m,m>>i[1]&255}let l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function c(u,d,m,p,h){let f=m,C=0;for(l[0]=0,l[1]=0,l[2]=0,l[3]=0;f>8;)l[C++]=a(u,d),f-=8;f>0&&(l[C++]=s(u,d,f));for(let g=2;g>0;g--){let b=0,y=p[g];for(let x=C-1;x>=0;x--){b=b<<8|l[x];let A=b/y|0;l[x]=A,b=b-A*y}h[g]=b}h[0]=l[0]|l[1]<<8|l[2]<<16|l[3]<<24}e.decodeInts=c})(qu||(qu={}));function H5e(){throw new Error("(xdrfile error) Undefined error.")}async function j5e(e,t){let r=new DataView(t.buffer,t.byteOffset),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},o=n.frames,i=n.boxes,s=n.times,a=[0,0,0,0,0,0],l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[.1,.1,.1],m=[.1,.1,.1],p=0,h=qu.buf;for(;;){let f,C=r.getInt32(p+4);p+=12,s.push(r.getFloat32(p)),p+=4;let g=new Float32Array(9);for(let b=0;b<9;++b)g[b]=r.getFloat32(p)*10,p+=4;if(i.push(g),C<=9){f={count:C/3,x:new Float32Array(C/3),y:new Float32Array(C/3),z:new Float32Array(C/3)};for(let b=0;b<C/3;++b)f.x[b]=r.getFloat32(p),f.y[b]=r.getFloat32(p),f.z[b]=r.getFloat32(p),p+=4}else{h[0]=h[1]=h[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,d[0]=d[1]=d[2]=0,m[0]=m[1]=m[2]=0,f={count:C,x:new Float32Array(C),y:new Float32Array(C),z:new Float32Array(C)};let b=0,y=r.getInt32(p);p+=4;let x=r.getFloat32(p);p+=4,a[0]=r.getInt32(p),a[1]=r.getInt32(p+4),a[2]=r.getInt32(p+8),a[3]=r.getInt32(p+12),a[4]=r.getInt32(p+16),a[5]=r.getInt32(p+20),l[0]=a[3]-a[0]+1,l[1]=a[4]-a[1]+1,l[2]=a[5]-a[2]+1,p+=24;let A;(l[0]|l[1]|l[2])>16777215?(c[0]=qu.sizeOfInt(l[0]),c[1]=qu.sizeOfInt(l[1]),c[2]=qu.sizeOfInt(l[2]),A=0):A=qu.sizeOfInts(3,l);let v=r.getInt32(p);p+=4;let _=v-1;_=tU>_?tU:_;let I=NC[_]/2|0,T=NC[v]/2|0;u[0]=u[1]=u[2]=NC[v];let E=Math.ceil(r.getInt32(p)/4)*4;p+=4;let w=1/x,S=0,P=0;for(d[0]=d[1]=d[2]=0;P<y;){A===0?(d[0]=qu.decodeBits(t,p,c[0]),d[1]=qu.decodeBits(t,p,c[1]),d[2]=qu.decodeBits(t,p,c[2])):qu.decodeInts(t,p,A,l,d),P++,d[0]+=a[0],d[1]+=a[1],d[2]+=a[2],m[0]=d[0],m[1]=d[1],m[2]=d[2];let k=qu.decodeBits(t,p,1),L=0;if(k===1&&(S=qu.decodeBits(t,p,5),L=S%3,S-=L,L--),S>0){d[0]=d[1]=d[2]=0;for(let R=0;R<S;R+=3){if(qu.decodeInts(t,p,v,u,d),P++,d[0]+=m[0]-T,d[1]+=m[1]-T,d[2]+=m[2]-T,R===0){let N=d[0];d[0]=m[0],m[0]=N,N=d[1],d[1]=m[1],m[1]=N,N=d[2],d[2]=m[2],m[2]=N,f.x[b]=m[0]*w,f.y[b]=m[1]*w,f.z[b]=m[2]*w,b++}else m[0]=d[0],m[1]=d[1],m[2]=d[2];f.x[b]=d[0]*w,f.y[b]=d[1]*w,f.z[b]=d[2]*w,b++}}else f.x[b]=d[0]*w,f.y[b]=d[1]*w,f.z[b]=d[2]*w,b++;v+=L,L<0?(T=I,v>tU?I=NC[v-1]/2|0:I=0):L>0&&(I=T,T=NC[v]/2|0),u[0]=u[1]=u[2]=NC[v],(u[0]===0||u[1]===0||u[2]===0)&&H5e()}p+=E}for(let b=0;b<C;b++)f.x[b]*=10,f.y[b]*=10,f.z[b]*=10;if(o.push(f),e.shouldUpdate&&await e.update({current:p,max:t.length}),p>=t.length)break}return s.length>=1&&(n.timeOffset=s[0]),s.length>=2&&(n.deltaTime=s[1]-s[0]),n}function cae(e){return ke.create("Parse XTC",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await j5e(t,e);return Hr.success(r)}catch(r){return Hr.error(""+r)}})}function uae(e){return ke.create("Parse XTC",async t=>{await t.update("Converting to coordinates");let r=Pl(e.deltaTime,"step"),n=Pl(e.timeOffset,r.unit),o=[];for(let i=0,s=e.frames.length;i<s;++i){let a=e.boxes[i],l=D.fromArray(D(),a,0),c=D.fromArray(D(),a,3),u=D.fromArray(D(),a,6);o.push({elementCount:e.frames[i].count,cell:_d.fromBasis(l,c,u),x:e.frames[i].x,y:e.frames[i].y,z:e.frames[i].z,xyzOrdering:{isIdentity:!0},time:Pl(n.value+r.value*i,r.unit)})}return ym.create(o,r,n)})}function $5e(e){let t=e.position>=e.data.length-1?0:+Tt.readLine(e);isNaN(t)&&(t=0);let r=Tt.readLine(e),n=new Float64Array(t),o=new Float64Array(t),i=new Float64Array(t),s=new Array(t);for(let a=0;a<t;++a){let c=Tt.readLineTrim(e).split(/\s+/g);s[a]=c[0],n[a]=+c[1],o[a]=+c[2],i[a]=+c[3]}return{count:t,comment:r,x:ue.ofFloatArray(n),y:ue.ofFloatArray(o),z:ue.ofFloatArray(i),type_symbol:ue.ofStringArray(s)}}function W5e(e){let t=Tt(e),r=[];for(;;){let o=$5e(t);if(o.count===0)break;r.push(o)}let n={molecules:r};return Hr.success(n)}function dae(e){return ke.create("Parse Mol",async()=>W5e(e))}function q5e(e,t){let{molecules:r}=e,n=0;for(let y of r)n+=y.count;let o=new Array(n),i=new Int32Array(n),s=new Float32Array(n),a=new Float32Array(n),l=new Float32Array(n),c=new Int32Array(n),u=0;for(let y=0;y<r.length;y++){let x=r[y];for(let A=0;A<x.count;A++)o[u]=x.type_symbol.value(A),s[u]=x.x.value(A),a[u]=x.y.value(A),l[u]=x.z.value(A),i[u]=A,c[u]=y,u++}let d=ue.ofConst("MOL",n,ue.Schema.str),m=ue.ofConst("A",n,ue.Schema.str),p=ue.ofConst(1,n,ue.Schema.int),h=ue.ofStringArray(o),f=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:m,auth_atom_id:h,auth_comp_id:d,auth_seq_id:p,Cartn_x:ue.ofFloatArray(s),Cartn_y:ue.ofFloatArray(a),Cartn_z:ue.ofFloatArray(l),id:ue.ofIntArray(i),label_asym_id:m,label_atom_id:h,label_comp_id:d,label_seq_id:p,label_entity_id:ue.ofConst("1",n,ue.Schema.str),occupancy:ue.ofConst(1,n,ue.Schema.float),type_symbol:h,pdbx_PDB_model_num:ue.ofIntArray(c)},n),C=new qi;C.setNames([["MOL","Unknown Entity"]]),C.getEntityId("MOL",0,"A");let g=new Is(p,h);g.setNames([["MOL","Unknown Molecule"]]),g.add("MOL",0);let b=as({entity:C.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:f});return va(b,rU.create(e),t)}var rU;(function(e){function t(n){return n?.kind==="xyz"}e.is=t;function r(n){return{kind:"xyz",name:"xyz",data:n}}e.create=r})(rU||(rU={}));function mae(e){return ke.create("Parse XYZ",t=>q5e(e,t))}function pae(e){return e.trim().endsWith("V3000")}function fae(e){let t=ct.create(e.data,1),r=ct.create(e.data,1);return Tt.eatLine(e),kg(e),kg(e),kg(e),Dg(e,t),Dg(e,r),Tt.eatLine(e),{atomCount:dr(t)(ue.Schema.int).value(0),bondCount:dr(r)(ue.Schema.int).value(0)}}function hae(e,t){let r=ct.create(e.data,t*2),n=ct.create(e.data,t*2),o=ct.create(e.data,t*2),i=ct.create(e.data,t*2);for(let s=0;s<t;++s){Tt.markLine(e),kg(e),kg(e),kg(e);let{position:a}=e;Dg(e,i),Dg(e,r),Dg(e,n),Dg(e,o),e.position=a}return Tt.eatLine(e),Tt.eatLine(e),{count:t,x:dr(r)(ue.Schema.float),y:dr(n)(ue.Schema.float),z:dr(o)(ue.Schema.float),type_symbol:dr(i)(ue.Schema.str),formal_charge:ue.ofConst(0,t,ue.Schema.int)}}function gae(e,t){let r=ct.create(e.data,t*2),n=ct.create(e.data,t*2),o=ct.create(e.data,t*2);for(let i=0;i<t;++i){Tt.markLine(e),kg(e),kg(e),kg(e);let{position:s}=e;Dg(e,o),Dg(e,r),Dg(e,n),e.position=s}return Tt.eatLine(e),Tt.eatLine(e),{count:t,atomIdxA:dr(r)(ue.Schema.float),atomIdxB:dr(n)(ue.Schema.float),order:dr(o)(ue.Schema.float)}}function kg(e){Tt.skipWhitespace(e),Tt.eatValue(e)}function Dg(e,t){let{position:r}=e;Tt.skipWhitespace(e),Tt.eatValue(e),Tt.trim(e,r,e.position),ct.addUnchecked(t,e.tokenStart,e.tokenEnd)}var nU="$$$$";function Z5e(e){let t=ct.create(e.data,32),r=ct.create(e.data,32);for(;e.position<e.length;){let n=Tt.readLine(e);if(n.startsWith(nU))break;if(n&&n.startsWith("> ")){ct.add(t,e.tokenStart+2,e.tokenEnd),Tt.markLine(e);let o=e.tokenStart,i=e.tokenEnd,s=!1;for(;e.position<e.length;){let a=Tt.readLine(e);if(!a||a.startsWith(nU)||a.startsWith("> ")){ct.add(r,o,i),s=!0;break}i=e.tokenEnd}s||ct.add(r,o,i)}}return{dataHeader:dr(t)(ue.Schema.str),data:dr(r)(ue.Schema.str)}}function K5e(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}function X5e(e){let t=Tt.readLine(e).trim(),r=Tt.readLine(e).trim(),n=Tt.readLine(e).trim(),o=Tt.readLine(e),i=pae(o),{atomCount:s,bondCount:a}=i?fae(e):K5e(o);if(Number.isNaN(s)||Number.isNaN(a)){for(;e.position<e.length&&!Tt.readLine(e).startsWith(nU););return}let l={atomIdx:ue.ofConst(0,s,ue.Schema.int),charge:ue.ofConst(0,s,ue.Schema.int)},c=i?hae(e,s):qG(e,s),u=i?gae(e,a):ZG(e,a),d=i?l:KG(e),m=Z5e(e);return{molFile:{title:t,program:r,comment:n,atoms:c,bonds:u,formalCharges:d},dataItems:m}}function Y5e(e){let t=Tt(e),r=[];for(;t.position<t.length;){let n=X5e(t);n&&r.push(n)}return Hr.success({compounds:r})}function yae(e){return ke.create("Parse Sdf",async()=>Y5e(e))}var oU;(function(e){function t(n){return n?.kind==="sdf"}e.is=t;function r(n){return{kind:"sdf",name:n.molFile.title,data:n}}e.create=r})(oU||(oU={}));function vae(e){return ke.create("Parse SDF",t=>YG(e.molFile,oU.create(e),t))}async function Q5e(e){let t=new DataView(e.buffer),r={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},n=r.frames,o=r.boxes,i=r.times,s=0;for(;;){s+=8;let a=t.getInt32(s);s+=4,s+=a;let l=t.getInt32(s+8),c=t.getInt32(s+12),u=t.getInt32(s+16),d=t.getInt32(s+28),m=t.getInt32(s+32),p=t.getInt32(s+36),h=t.getInt32(s+40);s+=52;let f=l/9,C=h*3;if(f===8?i.push(t.getFloat64(s)):i.push(t.getFloat32(s)),s+=2*f,l){let g=new Float32Array(9);if(f===8)for(let b=0;b<9;++b)g[b]=t.getFloat64(s)*10,s+=8;else for(let b=0;b<9;++b)g[b]=t.getFloat32(s)*10,s+=4;o.push(g)}if(s+=c,s+=u,d){let g=new Float32Array(h),b=new Float32Array(h),y=new Float32Array(h);if(f===8)for(let x=0;x<h;++x)g[x]=t.getFloat64(s)*10,b[x]=t.getFloat64(s+8)*10,y[x]=t.getFloat64(s+16)*10,s+=24;else{let x=new Uint32Array(e.buffer,s,C);for(let v=0;v<C;++v){let _=x[v];x[v]=(_&255)<<24|(_&65280)<<8|_>>8&65280|_>>24&255}let A=new Float32Array(e.buffer,s,C);for(let v=0;v<h;++v)g[v]=A[v*3]*10,b[v]=A[v*3+1]*10,y[v]=A[v*3+2]*10,s+=12}n.push({count:h,x:g,y:b,z:y})}if(s+=m,s+=p,s>=e.byteLength)break}return i.length>=1&&(r.timeOffset=i[0]),i.length>=2&&(r.deltaTime=i[1]-i[0]),r}function bae(e){return ke.create("Parse TRR",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await Q5e(e);return Hr.success(r)}catch(r){return Hr.error(""+r)}})}function xae(e){return ke.create("Parse TRR",async t=>{await t.update("Converting to coordinates");let r=Pl(e.deltaTime,"step"),n=Pl(e.timeOffset,r.unit),o=[];for(let i=0,s=e.frames.length;i<s;++i){let a=e.boxes[i],l=D.fromArray(D(),a,0),c=D.fromArray(D(),a,3),u=D.fromArray(D(),a,6);o.push({elementCount:e.frames[i].count,cell:_d.fromBasis(l,c,u),x:e.frames[i].x,y:e.frames[i].y,z:e.frames[i].z,xyzOrdering:{isIdentity:!0},time:Pl(n.value+r.value*i,r.unit)})}return ym.create(o,r,n)})}var iU=[],MD=class{constructor(t,r={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;t===void 0&&(t=8192),typeof t=="number"?t=new ArrayBuffer(t):n=!0;let o=r.offset?r.offset>>>0:0,i=t.byteLength-o,s=o;t instanceof ArrayBuffer||(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+o),t=t.buffer),n?this._lastWrittenByte=i:this._lastWrittenByte=0,this.buffer=t,this.length=i,this.byteLength=i,this.byteOffset=s,this._data=new DataView(this.buffer,s,i)}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t){return t===void 0&&(t=1),this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t){if(t===void 0&&(t=1),!this.available(t)){let n=(this.offset+t)*2,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){t===void 0&&(t=1);let r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=this.readByte();return r}readInt16(){let t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){let t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){let t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){let t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){let t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){let t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){iU.length=t;for(let r=0;r<t;r++)iU[r]=this.readChar();return iU.join("")}writeBoolean(t=!1){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let r=0;r<t.length;r++)this._data.setUint8(this.offset++,t[r]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}};function Pm(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function Cae(e){e.offset%4!==0&&e.skip(4-e.offset%4)}function sU(e){let t=e.readUint32(),r=e.readChars(t);return Cae(e),r}var _s={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function Sae(e){switch(Number(e)){case _s.BYTE:return"byte";case _s.CHAR:return"char";case _s.SHORT:return"short";case _s.INT:return"int";case _s.FLOAT:return"float";case _s.DOUBLE:return"double";default:return"undefined"}}function Iae(e){switch(Number(e)){case _s.BYTE:return 1;case _s.CHAR:return 1;case _s.SHORT:return 2;case _s.INT:return 4;case _s.FLOAT:return 4;case _s.DOUBLE:return 8;default:return-1}}function Aae(e){switch(String(e)){case"byte":return _s.BYTE;case"char":return _s.CHAR;case"short":return _s.SHORT;case"int":return _s.INT;case"float":return _s.FLOAT;case"double":return _s.DOUBLE;default:return-1}}function RD(e,t){if(e!==1){let r=new Array(e);for(let n=0;n<e;n++)r[n]=t();return r}else return t()}function aU(e,t,r){switch(t){case _s.BYTE:return e.readBytes(r);case _s.CHAR:return J5e(e.readChars(r));case _s.SHORT:return RD(r,e.readInt16.bind(e));case _s.INT:return RD(r,e.readInt32.bind(e));case _s.FLOAT:return RD(r,e.readFloat32.bind(e));case _s.DOUBLE:return RD(r,e.readFloat64.bind(e));default:Pm(!0,"non valid type "+t);return}}function J5e(e){return e.charCodeAt(e.length-1)===0?e.substring(0,e.length-1):e}function eVe(e,t){let r=Aae(t.type),n=t.size/Iae(r),o=new Array(n);for(let i=0;i<n;i++)o[i]=aU(e,r,1);return o}function tVe(e,t,r){let n=Aae(t.type),o=t.size?t.size/Iae(n):1,i=r.length,s=new Array(i),a=r.recordStep;for(let l=0;l<i;l++){let c=e.offset;s[l]=aU(e,n,o),e.seek(c+a)}return s}var FC=0,rVe=10,nVe=11,oVe=12;function iVe(e,t){let r={recordDimension:{length:e.readUint32()}};r.version=t;let n=sVe(e);r.recordDimension.id=n.recordId,r.recordDimension.name=n.recordName,r.dimensions=n.dimensions,r.globalAttributes=wae(e);let o=aVe(e,n.recordId,t);return r.variables=o.variables,r.recordDimension.recordStep=o.recordStep,r}function sVe(e){let t,r,n,o=e.readUint32();if(o===FC)return Pm(e.readUint32()!==FC,"wrong empty tag for list of dimensions"),[];{Pm(o!==rVe,"wrong tag for list of dimensions");let i=e.readUint32();t=new Array(i);for(let s=0;s<i;s++){let a=sU(e),l=e.readUint32();l===0&&(r=s,n=a),t[s]={name:a,size:l}}return{dimensions:t,recordId:r,recordName:n}}}function wae(e){let t,r=e.readUint32();if(r===FC)return Pm(e.readUint32()!==FC,"wrong empty tag for list of attributes"),[];{Pm(r!==oVe,"wrong tag for list of attributes");let n=e.readUint32();t=new Array(n);for(let o=0;o<n;o++){let i=sU(e),s=e.readUint32();Pm(s<1||s>6,"non valid type "+s);let a=e.readUint32(),l=aU(e,s,a);Cae(e),t[o]={name:i,type:Sae(s),value:l}}}return t}function aVe(e,t,r){let n=e.readUint32(),o=0,i;if(n===FC)return Pm(e.readUint32()!==FC,"wrong empty tag for list of variables"),[];{Pm(n!==nVe,"wrong tag for list of variables");let s=e.readUint32();i=new Array(s);for(let a=0;a<s;a++){let l=sU(e),c=e.readUint32(),u=new Array(c);for(let f=0;f<c;f++)u[f]=e.readUint32();let d=wae(e),m=e.readUint32();Pm(m<1&&m>6,"non valid type "+m);let p=e.readUint32(),h=e.readUint32();r===2&&(Pm(h>0,"offsets larger than 4GB not supported"),h=e.readUint32()),u[0]===t&&(o+=p),i[a]={name:l,dimensions:u,attributes:d,type:Sae(m),size:p,offset:h,record:u[0]===t}}}return{variables:i,recordStep:o}}var BD=class{constructor(t){let r=new MD(t);r.setBigEndian(),Pm(r.readChars(3)!=="CDF","should start with CDF");let n=r.readByte();Pm(n>2,"unknown version"),this.header=iVe(r,n),this.buffer=r}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(t){return this.header.variables&&this.header.variables.findIndex(r=>r.name===t)!==-1}getDataVariable(t){var r;let n;if(typeof t=="string"?n=(r=this.header.variables)===null||r===void 0?void 0:r.find(o=>o.name===t):n=t,n===void 0)throw new Error("variable not found");return this.buffer.seek(n.offset),n.record?tVe(this.buffer,n,this.header.recordDimension):eVe(this.buffer,n)}};async function lVe(e){let t=new BD(e),r={coordinates:[],time:[],timeOffset:0,deltaTime:1};for(let n of t.getDataVariable("coordinates"))r.coordinates.push(n);if(t.hasDataVariable("velocities")){let n=[];for(let o of t.getDataVariable("velocities"))n.push(o);r.velocities=n}if(t.hasDataVariable("forces")){let n=[];for(let o of t.getDataVariable("forces"))n.push(o);r.forces=n}if(t.hasDataVariable("cell_lengths")){let n=[];for(let o of t.getDataVariable("cell_lengths"))n.push(o);r.cell_lengths=n}if(t.hasDataVariable("cell_angles")){let n=[];for(let o of t.getDataVariable("cell_angles"))n.push(o);r.cell_angles=n}if(t.hasDataVariable("time")){let n=[];for(let o of t.getDataVariable("time"))n.push(o);r.time=n}return r.time&&(r.time.length>=1&&(r.timeOffset=r.time[0]),r.time.length>=2&&(r.deltaTime=r.time[1]-r.time[0])),r}function _ae(e){return ke.create("Parse NCTRAJ",async t=>{try{t.update({canAbort:!0,message:"Parsing trajectory..."});let r=await lVe(e);return Hr.success(r)}catch(r){return Hr.error(""+r)}})}function Tae(e){return ke.create("Parse NCTRAJ",async t=>{await t.update("Converting to coordinates");let r=Pl(e.deltaTime,"step"),n=Pl(e.timeOffset,r.unit),o=[];for(let i=0,s=e.coordinates.length;i<s;++i){let a=e.coordinates[i],l=a.length/3,c=new Float32Array(l),u=new Float32Array(l),d=new Float32Array(l);for(let p=0,h=a.length;p<h;p+=3)c[p/3]=a[p],u[p/3]=a[p+1],d[p/3]=a[p+2];let m={elementCount:l,x:c,y:u,z:d,xyzOrdering:{isIdentity:!0},time:Pl(n.value+r.value*i,r.unit)};if(e.cell_lengths){let p=e.cell_lengths[i],h=D.scale(D(),D.unitX,p[0]),f=D.scale(D(),D.unitY,p[1]),C=D.scale(D(),D.unitZ,p[2]);m.cell=_d.fromBasis(h,f,C)}o.push(m)}return ym.create(o,r,n)})}function cVe(e){let{pointers:t,residuePointer:r,residueLabel:n,atomName:o}=e,i=t.NATOM,s=t.NRES,a=new Uint32Array(i),l=[],c=(P,k,L)=>{let R=n.value(P);for(let N=k,F=L;N<F;++N)a[N]=P+1,l[N]=R};for(let P=0,k=s-1;P<k;++P)c(P,r.value(P)-1,r.value(P+1)-1);c(s-1,r.value(s-1)-1,i);let u=ue.ofIntArray(a),d=ue.ofStringArray(l),m=new Array(i),p=new Array(i),h=new Uint32Array(i),f=new Uint32Array(i),C=new qi,g=new Is(u,o),b="",y=0,x="",A=0,v=0,_=-1;for(let P=0,k=i;P<k;++P){let L=u.value(P);if(L!==_){let R=d.value(P),N=_c(g.add(R,P).type,R);N!==v&&(x=yg(y),y+=1,A=0),b=C.getEntityId(R,N,x),A+=1,_=L,v=N}m[P]=b,p[P]=x,h[P]=A,f[P]=P}let I=ue.ofIntArray(f),T=ue.ofStringArray(p),E=new Array(i);for(let P=0;P<i;++P)E[P]=vm(o.value(P),d.value(P));let w=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:T,auth_atom_id:ue.asArrayColumn(o),auth_comp_id:d,auth_seq_id:u,id:ue.asArrayColumn(I),label_asym_id:T,label_atom_id:ue.asArrayColumn(o),label_comp_id:d,label_seq_id:ue.ofIntArray(h),label_entity_id:ue.ofStringArray(m),occupancy:ue.ofConst(1,i,ue.Schema.float),type_symbol:ue.ofStringArray(E),pdbx_PDB_model_num:ue.ofConst(1,i,ue.Schema.int)},i);return as({entity:C.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:w})}var lU;(function(e){function t(n){return n?.kind==="prmtop"}e.is=t;function r(n){return{kind:"prmtop",name:n.title.join(" ")||"PRMTOP",data:n}}e.fromPrmtop=r})(lU||(lU={}));function Eae(e){return ke.create("Parse PRMTOP",async t=>{let r=lU.fromPrmtop(e),n=cVe(e),{pointers:{NBONH:o,NBONA:i},bondsIncHydrogen:s,bondsWithoutHydrogen:a}=e,l=o+i,c={indexA:ue.ofLambda({value:u=>u<o?s.value(u*3)/3:a.value((u-o)*3)/3,rowCount:l,schema:ue.Schema.int}),indexB:ue.ofLambda({value:u=>u<o?s.value(u*3+1)/3:a.value((u-o)*3+1)/3,rowCount:l,schema:ue.Schema.int}),order:ue.ofConst(1,l,ue.Schema.int)};return X0.create(e.title.join(" ")||"PRMTOP",n,c,r)})}function uVe(e){let{molecules:t,compounds:r}=e,n={},o=0;for(let P=0,k=t._rowCount;P<k;++P){let L=t.compound.value(P),R=t.molCount.value(P),{atoms:N}=r[L];ue.asArrayColumn(N.atom),ue.asArrayColumn(N.resnr),ue.asArrayColumn(N.residu),o+=R*N._rowCount;let F=N.resnr.value(0);n[L]=!0;for(let H=1,V=N._rowCount;H<V;++H){let q=N.resnr.value(H);if(q!==F){n[L]=!1;break}F=q}}let i=new Array(o),s=new Uint32Array(o),a=new Array(o),l=0;for(let P=0,k=t._rowCount;P<k;++P){let L=t.compound.value(P),R=t.molCount.value(P),{atoms:N}=r[L],F=n[L];for(let H=0;H<R;++H)for(let V=0,q=N._rowCount;V<q;++V)i[l]=N.atom.value(V),s[l]=N.resnr.value(V),a[l]=N.residu.value(V),F&&(s[l]+=H),l+=1}let c=ue.ofStringArray(i),u=ue.ofIntArray(s),d=ue.ofStringArray(a),m=new Array(o),p=new Array(o),h=new Uint32Array(o),f=new Uint32Array(o),C=new qi,g=new Is(u,c),b="",y=0,x="",A=0,v=0,_=-1;for(let P=0,k=o;P<k;++P){let L=u.value(P);if(L!==_){let R=d.value(P),N=_c(g.add(R,P).type,R);N!==v&&(x=yg(y),y+=1,A=0),b=C.getEntityId(R,N,x),A+=1,_=L,v=N}m[P]=b,p[P]=x,h[P]=A,f[P]=P}let I=ue.ofIntArray(f),T=ue.ofStringArray(p),E=new Array(o);for(let P=0;P<o;++P)E[P]=vm(c.value(P),d.value(P));let w=gr.ofPartialColumns(wo.atom_site,{auth_asym_id:T,auth_atom_id:ue.asArrayColumn(c),auth_comp_id:d,auth_seq_id:u,id:ue.asArrayColumn(I),label_asym_id:T,label_atom_id:ue.asArrayColumn(c),label_comp_id:d,label_seq_id:ue.ofIntArray(h),label_entity_id:ue.ofStringArray(m),occupancy:ue.ofConst(1,o,ue.Schema.float),type_symbol:ue.ofStringArray(E),pdbx_PDB_model_num:ue.ofConst(1,o,ue.Schema.int)},o);return as({entity:C.getEntityTable(),chem_comp:g.getChemCompTable(),atom_site:w})}function dVe(e){let{molecules:t,compounds:r}=e,n=[],o=[],i=0;for(let s=0,a=t._rowCount;s<a;++s){let l=t.compound.value(s),c=t.molCount.value(s),{atoms:u,bonds:d}=r[l];if(d)for(let m=0;m<c;++m){for(let p=0,h=d._rowCount;p<h;++p)n.push(d.ai.value(p)-1+i),o.push(d.aj.value(p)-1+i);i+=u._rowCount}else if(l==="TIP3")for(let m=0;m<c;++m)n.push(0+i),o.push(1+i),n.push(0+i),o.push(2+i),i+=u._rowCount;else i+=c*u._rowCount}return{indexA:ue.ofIntArray(n),indexB:ue.ofIntArray(o),order:ue.ofConst(1,n.length,ue.Schema.int)}}var cU;(function(e){function t(n){return n?.kind==="top"}e.is=t;function r(n){return{kind:"top",name:n.system||"TOP",data:n}}e.fromTop=r})(cU||(cU={}));function Pae(e){return ke.create("Parse TOP",async t=>{let r=cU.fromTop(e),n=uVe(e),o=dVe(e);return X0.create(e.system||"TOP",n,o,r)})}var mVe=Lt.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[fe.Data.Binary],to:fe.Molecule.Coordinates})({apply({a:e}){return ke.create("Parse DCD",async t=>{let r=await cY(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await tne(r.result).runInContext(t);return new fe.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),pVe=Lt.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[fe.Data.Binary],to:fe.Molecule.Coordinates})({apply({a:e}){return ke.create("Parse XTC",async t=>{let r=await cae(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await uae(r.result).runInContext(t);return new fe.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),fVe=Lt.BuiltIn({name:"coordinates-from-trr",display:{name:"Parse TRR",description:"Parse TRR binary data."},from:[fe.Data.Binary],to:fe.Molecule.Coordinates})({apply({a:e}){return ke.create("Parse TRR",async t=>{let r=await bae(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await xae(r.result).runInContext(t);return new fe.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),hVe=Lt.BuiltIn({name:"coordinates-from-nctraj",display:{name:"Parse NCTRAJ",description:"Parse NCTRAJ binary data."},from:[fe.Data.Binary],to:fe.Molecule.Coordinates})({apply({a:e}){return ke.create("Parse NCTRAJ",async t=>{let r=await _ae(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await Tae(r.result).runInContext(t);return new fe.Molecule.Coordinates(n,{label:e.label,description:"Coordinates"})})}}),gVe=Lt.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Create topology from PSF."},from:[fe.Format.Psf],to:fe.Molecule.Topology})({apply({a:e}){return ke.create("Create Topology",async t=>{let r=await dse(e.data).runInContext(t);return new fe.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}}),yVe=Lt.BuiltIn({name:"topology-from-prmtop",display:{name:"PRMTOP Topology",description:"Create topology from PRMTOP."},from:[fe.Format.Prmtop],to:fe.Molecule.Topology})({apply({a:e}){return ke.create("Create Topology",async t=>{let r=await Eae(e.data).runInContext(t);return new fe.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}}),vVe=Lt.BuiltIn({name:"topology-from-top",display:{name:"TOP Topology",description:"Create topology from TOP."},from:[fe.Format.Top],to:fe.Molecule.Topology})({apply({a:e}){return ke.create("Create Topology",async t=>{let r=await Pae(e.data).runInContext(t);return new fe.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})})}});async function bVe(e,t,r){if(t.type===fe.Molecule.Topology.type){let n=t.data;return await Ut.trajectoryFromTopologyAndCoordinates(n,r).runInContext(e)}else if(t.type===fe.Molecule.Model.type){let n=t.data;return Ut.trajectoryFromModelAndCoordinates(n,r)}throw new Error("no model/topology found")}var LD=Lt.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:fe.Root,to:fe.Molecule.Trajectory,params:{modelRef:M.Text("",{isHidden:!0}),coordinatesRef:M.Text("",{isHidden:!0})}})({apply({params:e,dependencies:t}){return ke.create("Create trajectory from model/topology and coordinates",async r=>{let n=t[e.coordinatesRef].data,o=await bVe(r,t[e.modelRef],n),i={label:"Trajectory",description:`${o.frameCount} model${o.frameCount===1?"":"s"}`};return new fe.Molecule.Trajectory(o,i)})}}),xVe=Lt.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:fe.Format.Blob,to:fe.Molecule.Trajectory})({apply({a:e}){return ke.create("Parse Format Blob",async t=>{let r=[];for(let o of e.data){if(o.kind!=="cif")continue;let i=o.data.blocks[0],s=await vD(i).runInContext(t);if(s.frameCount===0)throw new Error("No models found.");for(let a=0;a<s.frameCount;a++){let l=await ke.resolveInContext(s.getFrameAtIndex(a),t);r.push(l)}}for(let o=0;o<r.length;o++)Ut.TrajectoryInfo.set(r[o],{index:o,size:r.length});let n={label:"Trajectory",description:`${r.length} model${r.length===1?"":"s"}`};return new fe.Molecule.Trajectory(new sc(r),n)})}});function Mg(e){return{label:`${e.representative.entry}`,description:`${e.frameCount} model${e.frameCount===1?"":"s"}`}}var ow=Lt.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Molecule.Trajectory,params(e){if(!e)return{loadAllBlocks:M.Optional(M.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory."})),blockHeader:M.Optional(M.Text(void 0,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:n=>n.loadAllBlocks===!0})),blockIndex:M.Optional(M.Numeric(0,{min:0,step:1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:n=>n.loadAllBlocks===!0||n.blockHeader}))};let{blocks:t}=e.data,r=t.map(n=>[n.header,n.header]);return r.push(["","[Use Block Index]"]),{loadAllBlocks:M.Optional(M.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory."})),blockHeader:M.Optional(M.Select(t[0]&&t[0].header,r,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:n=>n.loadAllBlocks===!0})),blockIndex:M.Optional(M.Numeric(0,{min:0,step:1,max:t.length-1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:n=>n.loadAllBlocks===!0||n.blockHeader}))}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return ke.create("Parse mmCIF",async r=>{var n;let o;if(t.loadAllBlocks){let s=[];for(let a of e.data.blocks){r.shouldUpdate&&await r.update(`Parsing ${a.header}...`);let l=await vD(a).runInContext(r);for(let c=0;c<l.frameCount;c++)s.push(await ke.resolveInContext(l.getFrameAtIndex(c),r))}o=new sc(s)}else{let s=t.blockHeader||e.data.blocks[(n=t.blockIndex)!==null&&n!==void 0?n:0].header,a=e.data.blocks.find(c=>c.header===s);if(!a)throw new Error(`Data block '${[s]}' not found.`);o=a.categoryNames.includes("chem_comp_atom")&&!a.categoryNames.includes("atom_site")&&!a.categoryNames.includes("ihm_sphere_obj_site")&&!a.categoryNames.includes("ihm_gaussian_obj_site")?await Bie(a).runInContext(r):await vD(a,e.data).runInContext(r)}if(o.frameCount===0)throw new Error("No models found.");let i=Mg(o);return new fe.Molecule.Trajectory(o,i)})}}),CVe=Lt.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory,params:{isPdbqt:M.Boolean(!1)}})({apply({a:e,params:t}){return ke.create("Parse PDB",async r=>{let n=await mY(e.data,e.label,t.isPdbqt).runInContext(r);if(n.isError)throw new Error(n.message);let o=await use(n.result).runInContext(r),i=Mg(o);return new fe.Molecule.Trajectory(o,i)})}}),SVe=Lt.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply({a:e}){return ke.create("Parse GRO",async t=>{let r=await dY(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await qie(r.result).runInContext(t),o=Mg(n);return new fe.Molecule.Trajectory(n,o)})}}),IVe=Lt.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply({a:e}){return ke.create("Parse XYZ",async t=>{let r=await dae(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await mae(r.result).runInContext(t),o=Mg(n);return new fe.Molecule.Trajectory(n,o)})}}),AVe=Lt.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply({a:e}){return ke.create("Parse MOL",async t=>{let r=await eae(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=await tae(r.result).runInContext(t),o=Mg(n);return new fe.Molecule.Trajectory(n,o)})}}),wVe=Lt.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply({a:e}){return ke.create("Parse SDF",async t=>{let r=await yae(e.data).runInContext(t);if(r.isError)throw new Error(r.message);let n=[];for(let s of r.result.compounds){let a=await vae(s).runInContext(t);for(let l=0;l<a.frameCount;l++)n.push(await ke.resolveInContext(a.getFrameAtIndex(l),t))}let o=new sc(n),i=Mg(o);return new fe.Molecule.Trajectory(o,i)})}}),_Ve=Lt.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[fe.Data.String],to:fe.Molecule.Trajectory})({apply({a:e}){return ke.create("Parse MOL2",async t=>{let r=await aae(e.data,e.label).runInContext(t);if(r.isError)throw new Error(r.message);let n=await lae(r.result).runInContext(t),o=Mg(n);return new fe.Molecule.Trajectory(n,o)})}}),TVe=Lt.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:fe.Format.Cube,to:fe.Molecule.Trajectory})({apply({a:e}){return ke.create("Parse MOL",async t=>{let r=await nae(e.data).runInContext(t),n=Mg(r);return new fe.Molecule.Trajectory(r,n)})}}),EVe=Lt.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Molecule.Trajectory,params(e){if(!e)return{blockHeader:M.Optional(M.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};let{blocks:t}=e.data;return{blockHeader:M.Optional(M.Select(t[0]&&t[0].header,t.map(r=>[r.header,r.header]),{description:"Header of the block to parse"}))}}})({apply({a:e,params:t}){return ke.create("Parse CIF Core",async r=>{let n=t.blockHeader||e.data.blocks[0].header,o=e.data.blocks.find(a=>a.header===n);if(!o)throw new Error(`Data block '${[n]}' not found.`);let i=await rae(o).runInContext(r);if(i.frameCount===0)throw new Error("No models found.");let s=Mg(i);return new fe.Molecule.Trajectory(i,s)})}}),PVe=e=>e+1,DVe=e=>e-1,uU=Lt.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:fe.Molecule.Trajectory,to:fe.Molecule.Model,params:e=>e?{modelIndex:M.Converted(PVe,DVe,M.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:M.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}})({isApplicable:e=>e.data.frameCount>0,apply({a:e,params:t}){return ke.create("Model from Trajectory",async r=>{let n=t.modelIndex%e.data.frameCount;n<0&&(n+=e.data.frameCount);let o=await ke.resolveInContext(e.data.getFrameAtIndex(n),r),i=`Model ${n+1}`,s=e.data.frameCount===1?void 0:`of ${e.data.frameCount}`;return new fe.Molecule.Model(o,{label:i,description:s})})},interpolate(e,t,r){return{modelIndex:r>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*r)}},dispose({b:e}){e?.data.customProperties.dispose()}}),kVe=Lt.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:fe.Molecule.Trajectory,to:fe.Molecule.Structure})({apply({a:e}){return ke.create("Build Structure",async t=>{let r=await qe.ofTrajectory(e.data,t),n={label:"Ensemble",description:qe.elementDescription(r)};return new fe.Molecule.Structure(r,n)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),MVe=Lt.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:fe.Molecule.Model,to:fe.Molecule.Structure,params(e){return Xf.getParams(e&&e.data)}})({canAutoUpdate({oldParams:e,newParams:t}){return Xf.canAutoUpdate(e.type,t.type)},apply({a:e,params:t},r){return ke.create("Build Structure",async n=>Xf.create(r,n,e.data,t&&t.type))},update:({a:e,b:t,oldParams:r,newParams:n})=>ul(r,n)?t.data.model===e.data?st.UpdateResult.Unchanged:Ut.areHierarchiesEqual(e.data,t.data.model)?(t.data=t.data.remapModel(e.data),st.UpdateResult.Updated):st.UpdateResult.Recreate:st.UpdateResult.Recreate,dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),Dae=D(),kae=de(),Mae=de(),RVe=Lt.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:{transform:M.MappedStatic("components",{components:M.Group({axis:M.Vec3(D.create(1,0,0)),angle:M.Numeric(0,{min:-180,max:180,step:.1}),translation:M.Vec3(D.create(0,0,0))},{isFlat:!0}),matrix:M.Group({data:M.Mat4(de.identity()),transpose:M.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate({newParams:e}){return e.transform.name!=="matrix"},apply({a:e,params:t}){let r=de();if(t.transform.name==="components"){let{axis:o,angle:i,translation:s}=t.transform.params,a=e.data.boundary.sphere.center;de.fromTranslation(kae,D.negate(Dae,a)),de.fromTranslation(Mae,D.add(Dae,a,s));let l=de.fromRotation(de(),Math.PI/180*i,D.normalize(D(),o));de.mul3(r,Mae,l,kae)}else t.transform.name==="matrix"&&(de.copy(r,t.transform.params.data),t.transform.params.transpose&&de.transpose(r,r));let n=qe.transform(e.data,r);return new fe.Molecule.Structure(n,{label:e.label,description:`${e.description} [Transformed]`})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),BVe=Lt.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:()=>({expression:M.Value(ye.struct.generator.all,{isHidden:!0}),label:M.Optional(M.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:r}){let{selection:n,entry:o}=Ml.createAndRun(e.data,t.expression);if(r.entry=o,wt.isEmpty(n))return Hn.Null;let i=wt.unionStructure(n),s={label:`${t.label||"Selection"}`,description:qe.elementDescription(i)};return new fe.Molecule.Structure(i,s)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(r.expression!==n.expression)return st.UpdateResult.Recreate;let i=o.entry;if(i.currentStructure===e.data)return st.UpdateResult.Unchanged;let s=Ml.updateStructure(i,e.data);return wt.isEmpty(s)?st.UpdateResult.Null:(Ml.updateStructureObject(t,s,n.label),st.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),LVe=Lt.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:fe.Root,to:fe.Molecule.Structure.Selections,params:()=>({selections:M.ObjectList({key:M.Text(void 0,{description:"A unique key."}),ref:M.Text(),groupId:M.Optional(M.Text()),expression:M.Value(ye.struct.generator.empty)},e=>e.ref,{isHidden:!0}),isTransitive:M.Optional(M.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:M.Optional(M.Text("",{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:r}){let n=new Map,o=[],i=0;for(let a of e.selections){let{selection:l,entry:c}=Ml.createAndRun(r[a.ref].data,a.expression);n.set(a.key,c);let u=wt.toLociWithSourceUnits(l);o.push({key:a.key,loci:u,groupId:a.groupId}),i+=ce.Loci.size(u)}t.entries=n;let s={label:`${e.label||"Multi-selection"}`,description:`${e.selections.length} source(s), ${i} element(s) total`};return new fe.Molecule.Structure.Selections(o,s)},update:({b:e,oldParams:t,newParams:r,cache:n,dependencies:o})=>{if(!!t.isTransitive!=!!r.isTransitive)return st.UpdateResult.Recreate;let i=n.entries,s=new Map,a=new Map;for(let d of e.data)a.set(d.key,d);let l=!1,c=0,u=[];for(let d of r.selections){let m=o[d.ref].data,p=!1;if(i.has(d.key)){let h=i.get(d.key);if(Ml.isUnchanged(h,d.expression,m)&&a.has(d.key)){let f=a.get(d.key);f.groupId!==d.groupId&&(f.groupId=d.groupId,l=!0),s.set(d.key,h),u.push(f),c+=ce.Loci.size(f.loci);continue}if(h.expression!==d.expression)p=!0;else{let f=!1;if(r.isTransitive)if(qe.areUnitIdsAndIndicesEqual(h.originalStructure,m)){let C=Ml.run(h,h.originalStructure);h.currentStructure=m,s.set(d.key,h);let g=ce.Loci.remap(wt.toLociWithSourceUnits(C),m);u.push({key:d.key,loci:g,groupId:d.groupId}),c+=ce.Loci.size(g),l=!0}else f=!0;else f=!0;if(f){l=!0;let C=Ml.updateStructure(h,m);s.set(d.key,h);let g=wt.toLociWithSourceUnits(C);u.push({key:d.key,loci:g,groupId:d.groupId}),c+=ce.Loci.size(g)}}}else p=!0;if(p){l=!0;let{selection:h,entry:f}=Ml.createAndRun(m,d.expression);s.set(d.key,f);let C=wt.toLociWithSourceUnits(h);u.push({key:d.key,loci:C}),c+=ce.Loci.size(C)}}return l?(n.entries=s,e.data=u,e.label=`${r.label||"Multi-selection"}`,e.description=`${u.length} source(s), ${c} element(s) total`,st.UpdateResult.Updated):st.UpdateResult.Unchanged}}),NVe=Lt.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:()=>({script:M.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:M.Optional(M.Text(""))})})({apply({a:e,params:t,cache:r}){let{selection:n,entry:o}=Ml.createAndRun(e.data,t.script);r.entry=o;let i=wt.unionStructure(n),s={label:`${t.label||"Selection"}`,description:qe.elementDescription(i)};return new fe.Molecule.Structure(i,s)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(!To.areEqual(r.script,n.script))return st.UpdateResult.Recreate;let i=o.entry;if(i.currentStructure===e.data)return st.UpdateResult.Unchanged;let s=Ml.updateStructure(i,e.data);return Ml.updateStructureObject(t,s,n.label),st.UpdateResult.Updated},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),FVe=Lt.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:()=>({bundle:M.Value(ce.Bundle.Empty,{isHidden:!0}),label:M.Optional(M.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:r}){if(t.bundle.hash!==e.data.hashCode)return Hn.Null;r.source=e.data;let n=ce.Bundle.toStructure(t.bundle,e.data);if(n.elementCount===0)return Hn.Null;let o={label:`${t.label||"Selection"}`,description:qe.elementDescription(n)};return new fe.Molecule.Structure(n,o)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>{if(!ce.Bundle.areEqual(r.bundle,n.bundle))return st.UpdateResult.Recreate;if(n.bundle.hash!==e.data.hashCode)return st.UpdateResult.Null;if(o.source===e.data)return st.UpdateResult.Unchanged;o.source=e.data;let i=ce.Bundle.toStructure(n.bundle,e.data);return i.elementCount===0?st.UpdateResult.Null:(t.label=`${n.label||"Selection"}`,t.description=qe.elementDescription(i),t.data=i,st.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),Lae={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},OVe=M.objectToOptions(Lae),VVe=Lt.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:{type:M.Select("atomic-sequence",OVe,{isHidden:!0})}})({apply({a:e,params:t}){let r,n;switch(t.type){case"polymer":r=Ai.polymer.query,n="Polymer";break;case"protein":r=Ai.protein.query,n="Protein";break;case"nucleic":r=Ai.nucleic.query,n="Nucleic";break;case"water":r=Pn.internal.water(),n="Water";break;case"branched":r=Ai.branchedPlusConnected.query,n="Branched";break;case"ligand":r=Ai.ligandPlusConnected.query,n="Ligand";break;case"non-standard":r=Ai.nonStandardPolymer.query,n="Non-standard";break;case"coarse":r=Ai.coarse.query,n="Coarse";break;case"atomic-sequence":r=Pn.internal.atomicSequence(),n="Sequence";break;case"atomic-het":r=Pn.internal.atomicHet(),n="HET Groups/Ligands";break;case"spheres":r=Pn.internal.spheres(),n="Coarse Spheres";break;default:Sr(t.type)}let o=r(new ls(e.data)),i=wt.unionStructure(o);return i.elementCount===0?Hn.Null:new fe.Molecule.Structure(i,{label:n,description:qe.elementDescription(i)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),GVe=Lt.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:Xse})({apply({a:e,params:t,cache:r}){return Yse(e.data,t,r)},update:({a:e,b:t,oldParams:r,newParams:n,cache:o})=>Qse(e.data,t,r,n,o),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),dU=Lt.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:fe.Molecule.Model,to:fe.Molecule.Model,params:(e,t)=>t.customModelProperties.getParams(e?.data)})({apply({a:e,params:t},r){return ke.create("Custom Props",async n=>(await Rae(e.data,r,n,t),new fe.Molecule.Model(e.data,{label:e.label,description:e.description})))},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Custom Props",async i=>{t.data=e.data,t.label=e.label,t.description=e.description;for(let s of r.autoAttach){let a=o.customModelProperties.get(s);a&&e.data.customProperties.reference(a.descriptor,!1)}return await Rae(e.data,o,i,n),st.UpdateResult.Updated})},dispose({b:e}){e?.data.customProperties.dispose()}});async function Rae(e,t,r,n){let o={runtime:r,assetManager:t.managers.asset},{autoAttach:i,properties:s}=n;for(let a of Object.keys(s)){let l=t.customModelProperties.get(a),c=s[a];if(i.includes(a)||l.isHidden)try{await l.attach(o,e,c,!0)}catch(u){t.log.warn(`Error attaching model prop '${a}': ${u}`)}else l.set(e,c)}}var mU=Lt.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:fe.Molecule.Structure,to:fe.Molecule.Structure,params:(e,t)=>t.customStructureProperties.getParams(e?.data.root)})({apply({a:e,params:t},r){return ke.create("Custom Props",async n=>(await Bae(e.data.root,r,n,t),new fe.Molecule.Structure(e.data,{label:e.label,description:e.description})))},update({a:e,b:t,oldParams:r,newParams:n},o){return e.data!==t.data?st.UpdateResult.Recreate:ke.create("Custom Props",async i=>{t.data=e.data,t.label=e.label,t.description=e.description;for(let s of r.autoAttach){let a=o.customStructureProperties.get(s);a&&e.data.customPropertyDescriptors.reference(a.descriptor,!1)}return await Bae(e.data.root,o,i,n),st.UpdateResult.Updated})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});async function Bae(e,t,r,n){let o={runtime:r,assetManager:t.managers.asset},{autoAttach:i,properties:s}=n;for(let a of Object.keys(s)){let l=t.customStructureProperties.get(a),c=s[a];if(i.includes(a)||l.isHidden)try{await l.attach(o,e,c,!0)}catch(u){t.log.warn(`Error attaching structure prop '${a}': ${u}`)}else l.set(e,c)}}var UVe=Lt.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:fe.Format.Ply,to:fe.Shape.Provider,params(e){return{transforms:M.Optional(M.Value([],{isHidden:!0})),label:M.Optional(M.Text("",{isHidden:!0}))}}})({apply({a:e,params:t}){return ke.create("Create shape from PLY",async r=>{let n=await ene(e.data,t).runInContext(r),o={label:t.label||"Shape"};return new fe.Shape.Provider(n,o)})}});var bU={};Ui(bU,{AssignColorVolume:()=>KVe,VolumeFromCcp4:()=>jVe,VolumeFromCube:()=>WVe,VolumeFromDensityServerCif:()=>ZVe,VolumeFromDsn6:()=>$Ve,VolumeFromDx:()=>qVe,VolumeFromSegmentationCif:()=>vU,VolumeTransform:()=>XVe});function zVe(e){return e.originX===0&&e.originY===0&&e.originZ===0?D.create(e.NCSTART,e.NRSTART,e.NSSTART):D.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}function HVe(e){let t=nO(e);switch(t){case Ka.Float32:return Float32Array;case Ka.Int8:return Int8Array;case Ka.Int16:return Int16Array;case Ka.Uint16:return Uint16Array}throw Error(`${t} is not a supported value format.`)}function Nae(e,t){return ke.create("Create Volume",async r=>{let{header:n,values:o}=e,i=D.create(n.xLength,n.yLength,n.zLength);t&&t.voxelSize&&D.mul(i,i,t.voxelSize);let s=D.create(Pr(n.alpha),Pr(n.beta),Pr(n.gamma)),a=n.ISPG>65536?0:n.ISPG,l=Ni.create(a||"P 1",i,s),c=D.create(n.MAPC-1,n.MAPR-1,n.MAPS-1),u=cr.convertToCanonicalAxisIndicesFastToSlow(c),d=[n.NX,n.NY,n.NZ],m=u([n.NC,n.NR,n.NS]),p=zVe(n);t?.offset&&D.add(p,p,t.offset);let h=u(p),f=D.create(h[0]/d[0],h[1]/d[1],h[2]/d[2]),C=D.create(m[0]/d[0],m[1]/d[1],m[2]/d[2]),g=cr.Space(m,cr.invertAxisOrder(c),HVe(n)),b=cr.create(g,cr.Data1(o)),y=n.AMIN===0&&n.AMAX===0&&n.AMEAN===0&&n.ARMS===0;return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:xt.create(f,D.add(D.zero(),f,C))},cells:b,stats:{min:isNaN(n.AMIN)||y?D0(o):n.AMIN,max:isNaN(n.AMAX)||y?Da(o):n.AMAX,mean:isNaN(n.AMEAN)||y?k0(o):n.AMEAN,sigma:isNaN(n.ARMS)||n.ARMS===0?M0(o):n.ARMS}},sourceData:fU.create(e),customProperties:new Ls,_propertyData:Object.create(null)}})}var fU;(function(e){function t(n){return n?.kind==="ccp4"}e.is=t;function r(n){return{kind:"ccp4",name:n.name,data:n}}e.create=r})(fU||(fU={}));function Fae(e,t){return ke.create("Create Volume",async r=>{let{header:n,values:o}=e,i=D.create(n.xlen,n.ylen,n.zlen);t&&t.voxelSize&&D.mul(i,i,t.voxelSize);let s=D.create(Pr(n.alpha),Pr(n.beta),Pr(n.gamma)),a=Ni.create("P 1",i,s),l=[n.xRate,n.yRate,n.zRate],c=[n.xExtent,n.yExtent,n.zExtent],u=[n.xStart,n.yStart,n.zStart],d=D.create(u[0]/l[0],u[1]/l[1],u[2]/l[2]),m=D.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),p=cr.Space(c,[0,1,2],Float32Array),h=cr.create(p,cr.Data1(o));return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:a,fractionalBox:xt.create(d,D.add(D.zero(),d,m))},cells:h,stats:{min:D0(o),max:Da(o),mean:k0(o),sigma:n.sigma!==void 0?n.sigma:M0(o)}},sourceData:hU.create(e),customProperties:new Ls,_propertyData:Object.create(null)}})}var hU;(function(e){function t(n){return n?.kind==="dsn6"}e.is=t;function r(n){return{kind:"dsn6",name:n.name,data:n}}e.create=r})(hU||(hU={}));function Oae(e,t){return ke.create("Create Volume",async()=>{let{header:r,values:n}=e,o=cr.Space(r.dim,[0,1,2],Float64Array),i=cr.create(o,cr.Data1(n)),s=de.fromTranslation(de(),r.min),a=de.fromScaling(de(),r.h);return de.mul(s,s,a),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:i,stats:{min:D0(n),max:Da(n),mean:k0(n),sigma:M0(n)}},sourceData:gU.create(e),customProperties:new Ls,_propertyData:Object.create(null)}})}var gU;(function(e){function t(n){return n?.kind==="dx"}e.is=t;function r(n){return{kind:"dx",name:n.name,data:n}}e.create=r})(gU||(gU={}));function ND(e,t){return ke.create("Create Segmentation Volume",async r=>{var n;let{volume_data_3d_info:o,segmentation_data_3d:i}=e,s=Ni.create(o.spacegroup_number.value(0),D.ofArray(o.spacegroup_cell_size.value(0)),D.scale(D(),D.ofArray(o.spacegroup_cell_angles.value(0)),Math.PI/180)),a=o.axis_order.value(0),l=cr.convertToCanonicalAxisIndicesFastToSlow(a),c=l(o.sample_count.value(0)),u=cr.Space(c,cr.invertAxisOrder(a),Float32Array),d=cr.create(u,cr.Data1(i.values.toArray({array:Float32Array}))),m=D.ofArray(l(o.origin.value(0))),p=D.ofArray(l(o.dimensions.value(0))),h={label:t?.label,entryId:void 0,grid:{transform:{kind:"spacegroup",cell:s,fractionalBox:xt.create(m,D.add(D(),m,p))},cells:d,stats:{min:0,max:1,mean:0,sigma:1}},sourceData:yU.create(e),customProperties:new Ls,_propertyData:{ownerId:t?.ownerId}};ot.PickingGranularity.set(h,"object");let f=new Map,C=new Map,{segment_id:g,set_id:b}=e.segmentation_data_table;for(let k=0,L=g.rowCount;k<L;++k){let R=g.value(k),N=b.value(k);N===0||R===0||(C.has(N)||C.set(N,new Set),C.get(N).add(R))}C.forEach((k,L)=>{k.forEach(R=>{f.has(R)||f.set(R,new Set),f.get(R).add(L)})});let y=[0,0,0],x=d.space.getCoords,A=d.data,[v,_,I]=h.grid.cells.space.dimensions,T=v-1,E=_-1,w=I-1,S={};C.forEach((k,L)=>{S[L]=[T,E,w,-1,-1,-1]});for(let k=0,L=A.length;k<L;++k){let R=A[k];if(R===0)continue;x(k,y);let N=S[R];y[0]<N[0]&&(N[0]=y[0]),y[1]<N[1]&&(N[1]=y[1]),y[2]<N[2]&&(N[2]=y[2]),y[0]>N[3]&&(N[3]=y[0]),y[1]>N[4]&&(N[4]=y[1]),y[2]>N[5]&&(N[5]=y[2])}let P={};return f.forEach((k,L)=>{P[L]=xt.create(D.create(T,E,w),D.create(-1,-1,-1))}),Ao(S,(k,L)=>{C.get(parseInt(L)).forEach(R=>{let N=P[R];k[0]<N.min[0]&&(N.min[0]=k[0]),k[1]<N.min[1]&&(N.min[1]=k[1]),k[2]<N.min[2]&&(N.min[2]=k[2]),k[3]>N.max[0]&&(N.max[0]=k[3]),k[4]>N.max[1]&&(N.max[1]=k[4]),k[5]>N.max[2]&&(N.max[2]=k[5])})}),ot.Segmentation.set(h,{segments:f,sets:C,bounds:P,labels:(n=t?.segmentLabels)!==null&&n!==void 0?n:{}}),h})}var yU;(function(e){function t(n){return n?.kind==="segcif"}e.is=t;function r(n){return{kind:"segcif",name:n._name,data:n}}e.create=r})(yU||(yU={}));var jVe=Lt.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:fe.Format.Ccp4,to:fe.Volume.Data,params(e){return{voxelSize:M.Vec3(D.create(1,1,1)),offset:M.Vec3(D.create(0,0,0)),entryId:M.Text("")}}})({apply({a:e,params:t}){return ke.create("Create volume from CCP4/MRC/MAP",async r=>{let n=await Nae(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.NX}\xD7${e.data.header.NX}\xD7${e.data.header.NX}`};return new fe.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),$Ve=Lt.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:fe.Format.Dsn6,to:fe.Volume.Data,params(e){return{voxelSize:M.Vec3(D.create(1,1,1)),entryId:M.Text("")}}})({apply({a:e,params:t}){return ke.create("Create volume from DSN6/BRIX",async r=>{let n=await Fae(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.xExtent}\xD7${e.data.header.yExtent}\xD7${e.data.header.zExtent}`};return new fe.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),WVe=Lt.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:fe.Format.Cube,to:fe.Volume.Data,params(e){return{dataIndex:e?M.Select(0,e.data.header.dataSetIds.map((r,n)=>[n,`${r}`])):M.Numeric(0),entryId:M.Text("")}}})({apply({a:e,params:t}){return ke.create("Create volume from Cube",async r=>{let n=await Tre(e.data,{...t,label:e.data.name||e.label}).runInContext(r),o={label:n.label||"Volume",description:`Volume ${e.data.header.dim[0]}\xD7${e.data.header.dim[1]}\xD7${e.data.header.dim[2]}`};return new fe.Volume.Data(n,o)})},dispose({b:e}){e?.data.customProperties.dispose()}}),qVe=Lt.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:fe.Format.Dx,to:fe.Volume.Data})({apply({a:e}){return ke.create("Parse DX",async t=>{let r=await Oae(e.data,{label:e.data.name||e.label}).runInContext(t),n={label:r.label||"Volume",description:`Volume ${e.data.header.dim[0]}\xD7${e.data.header.dim[1]}\xD7${e.data.header.dim[2]}`};return new fe.Volume.Data(r,n)})},dispose({b:e}){e?.data.customProperties.dispose()}}),ZVe=Lt.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:fe.Format.Cif,to:fe.Volume.Data,params(e){if(!e)return{blockHeader:M.Optional(M.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:M.Text("")};let t=e.data.blocks.slice(1);return{blockHeader:M.Optional(M.Select(t[0]&&t[0].header,t.map(r=>[r.header,r.header]),{description:"Header of the block to parse"})),entryId:M.Text("")}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return ke.create("Parse density-server CIF",async r=>{var n;let o=t.blockHeader||e.data.blocks[1].header,i=e.data.blocks.find(m=>m.header===o);if(!i)throw new Error(`Data block '${[o]}' not found.`);let s=Di.schema.densityServer(i),a=await Uf(s,{entryId:t.entryId}).runInContext(r),[l,c,u]=a.grid.cells.space.dimensions,d={label:(n=t.entryId)!==null&&n!==void 0?n:s.volume_data_3d_info.name.value(0),description:`Volume ${l}\xD7${c}\xD7${u}`};return new fe.Volume.Data(a,d)})},dispose({b:e}){e?.data.customProperties.dispose()}}),vU=Lt.BuiltIn({name:"volume-from-segmentation-cif",display:{name:"Volume from Segmentation CIF"},from:fe.Format.Cif,to:fe.Volume.Data,params(e){let t=e?.data.blocks.slice(1);return{blockHeader:t?M.Optional(M.Select(t[0]&&t[0].header,t.map(n=>[n.header,n.header]),{description:"Header of the block to parse"})):M.Optional(M.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),segmentLabels:M.ObjectList({id:M.Numeric(-1),label:M.Text("")},n=>`${n.id} = ${n.label}`,{description:"Mapping of segment IDs to segment labels"}),ownerId:M.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})}}})({isApplicable:e=>e.data.blocks.length>0,apply({a:e,params:t}){return ke.create("Parse segmentation CIF",async r=>{let n=t.blockHeader||e.data.blocks[1].header,o=e.data.blocks.find(m=>m.header===n);if(!o)throw new Error(`Data block '${[n]}' not found.`);let i=Di.schema.segmentation(o),s={};for(let m of t.segmentLabels)s[m.id]=m.label;let a=await ND(i,{segmentLabels:s,ownerId:t.ownerId}).runInContext(r),[l,c,u]=a.grid.cells.space.dimensions,d={label:i.volume_data_3d_info.name.value(0),description:`Segmentation ${l}\xD7${c}\xD7${u}`};return new fe.Volume.Data(a,d)})},dispose({b:e}){e?.data.customProperties.dispose()}}),KVe=Lt.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:fe.Volume.Data,to:fe.Volume.Data,isDecorator:!0,params(e,t){if(!e)return{ref:M.Text()};let r=t.state.data.select(Kt.Generators.root.subtree().ofType(fe.Volume.Data).filter(n=>{var o;return!!n.obj&&!(!((o=n.obj)===null||o===void 0)&&o.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:M.Text("",{isHidden:!0})}:{ref:M.Select(r[0].transform.ref,r.map(n=>[n.transform.ref,n.obj.label]))}}})({apply({a:e,params:t,dependencies:r}){return ke.create("Assign Color Volume",async n=>{if(!r||!r[t.ref])throw new Error("Dependency not available.");let o=r[t.ref].data,i={...e.data,colorVolume:o},s={label:e.label,description:"Volume + Colors"};return new fe.Volume.Data(i,s)})}}),XVe=Lt.BuiltIn({name:"volume-transform",display:{name:"Transform Volume"},isDecorator:!0,from:fe.Volume.Data,to:fe.Volume.Data,params:{transform:M.MappedStatic("matrix",{matrix:M.Group({data:M.Mat4(de.identity()),transpose:M.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate({newParams:e}){return e.transform.name!=="matrix"},apply({a:e,params:t}){let r=de(),n={...e.data.grid.transform};de.copy(r,t.transform.params.data),t.transform.params.transpose&&de.transpose(r,r);let o=e.data.grid.transform.kind==="matrix"?e.data.grid.transform.matrix:go.getGridToCartesianTransform(e.data.grid);n={kind:"matrix",matrix:de.mul(de(),r,o)};let i={...e.data,grid:{...e.data.grid,transform:n}};return new fe.Volume.Data(i,{label:e.label,description:`${e.description} [Transformed]`})}});var a9={};Ui(a9,{ClippingStructureRepresentation3DFromBundle:()=>zze,ClippingStructureRepresentation3DFromScript:()=>Uze,EmissiveStructureRepresentation3DFromBundle:()=>Oze,EmissiveStructureRepresentation3DFromScript:()=>Fze,ExplodeStructureRepresentation3D:()=>kze,ModelUnitcell3D:()=>$ze,OverpaintStructureRepresentation3DFromBundle:()=>Bze,OverpaintStructureRepresentation3DFromScript:()=>Rze,ShapeRepresentation3D:()=>qp,SpinStructureRepresentation3D:()=>Mze,StructureBoundingBox3D:()=>Wze,StructureRepresentation3D:()=>eS,StructureSelectionsAngle3D:()=>Zze,StructureSelectionsDihedral3D:()=>Kze,StructureSelectionsDistance3D:()=>qze,StructureSelectionsLabel3D:()=>Xze,StructureSelectionsOrientation3D:()=>Yze,StructureSelectionsPlane3D:()=>Qze,SubstanceStructureRepresentation3DFromBundle:()=>Gze,SubstanceStructureRepresentation3DFromScript:()=>Vze,ThemeStrengthRepresentation3D:()=>Hze,TransparencyStructureRepresentation3DFromBundle:()=>Nze,TransparencyStructureRepresentation3DFromScript:()=>Lze,UnwindStructureAssemblyRepresentation3D:()=>Dze,VolumeRepresentation3D:()=>jze,VolumeRepresentation3DHelpers:()=>Rm});var FD=ze(13421772),YVe="Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",Vae={};function QVe(e){return Vae}function Gae(e,t){let r;if(e.structure){let{elements:n,getElementIndices:o}=e.structure.carbohydrates,i=(s,a)=>{if(!Le.isAtomic(s))return FD;let l=o(s,a);return l.length>0?n[l[0]].component.color:FD};r=(s,a)=>a?Qt.Secondary:ce.Location.is(s)?i(s.unit,s.element):_t.isLocation(s)?i(s.aUnit,s.aUnit.elements[s.aIndex]):FD}else r=()=>FD;return{factory:Gae,granularity:"group",color:r,props:t,description:YVe,legend:hl(one)}}var Uae={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:Dr.Residue,factory:Gae,getParams:QVe,defaultValues:M.getDefaultValues(Vae),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>Ut.hasCarbohydrate(t))};var xU={hue:M.Interval([1,360],{min:0,max:360,step:1}),chroma:M.Interval([40,70],{min:0,max:100,step:1}),luminance:M.Interval([15,85],{min:0,max:100,step:1}),sort:M.Select("contrast",M.arrayToOptions(["none","contrast"]),{description:"no sorting leaves colors approximately ordered by hue"}),clusteringStepCount:M.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:M.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:M.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})},OC=2,jb=[0,0,0],$b=[0,0,0];function JVe(e,t){return vs.toHcl(jb,e),vs.fromColor($b,vs.toColor(e)),jb[0]>=t.hue[0]&&jb[0]<=t.hue[1]&&jb[1]>=t.chroma[0]&&jb[1]<=t.chroma[1]&&jb[2]>=t.luminance[0]&&jb[2]<=t.luminance[1]&&$b[0]>=e[0]-OC&&$b[0]<=e[0]+OC&&$b[1]>=e[1]-OC&&$b[1]<=e[1]+OC&&$b[2]>=e[2]-OC&&$b[2]<=e[2]+OC}function eGe(e){let t=e.slice(0),r=[t.shift()];for(;t.length>0;){let n=r[r.length-1],o=0,i=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;++s){let a=vs.distance(n,t[s]);a>i&&(i=a,o=s)}r.push(t.splice(o,1)[0])}return r}function tGe(e,t){let r=new Map,n=Math.ceil(Math.cbrt(e)),o=Pu(),i=Math.max((t.hue[1]-t.hue[0])/n,1),s=Math.max((t.chroma[1]-t.chroma[0])/n,1),a=Math.max((t.luminance[1]-t.luminance[0])/n,1);for(let l=t.hue[0]+i/2;l<=t.hue[1];l+=i)for(let c=t.chroma[0]+s/2;c<=t.chroma[1];c+=s)for(let u=t.luminance[0]+a/2;u<=t.luminance[1];u+=a){let d=vs.fromHcl(vs(),Pu.set(o,l,c,u));JVe(d,t)&&r.set(vs.toColor(d),d)}return Array.from(r.values())}function zae(e,t){let r=1/0,n=0;for(let o=0;o<e.length;o++){let i=vs.distance(t,e[o]);i<r&&(r=i,n=o)}return n}function Hae(e,t={}){let r={...M.getDefaultValues(xU),...t};if(e<=0)return[];let n=tGe(Math.max(r.minSampleCount,e*r.sampleCountFactor),r);if(n.length<e)return new Array(e).fill(Gt.lightgrey);let o=[],i=[],s=Math.floor(n.length/e);for(let l=0;l<n.length&&(o.push(n[l]),i.push([]),!(o.length>=e));l+=s);for(let l=1;l<=r.clusteringStepCount;++l){let c=Xa(i),u=Xa(n);for(let m=0;m<o.length;++m){let p=zae(u,o[m]);c[m].push(n[p]),u.splice(p,1)}for(let m=0;m<u.length;++m){let p=zae(o,n[m]);c[p].push(n[m])}let d=Xa(o);for(let m=0;m<c.length;++m){let p=c[m],h=p.length;if(h===0)continue;let f=0,C=0,g=0;for(let A of p)f+=A[0],C+=A[1],g+=A[2];let b=f/h,y=C/h,x=g/h;o[m]=[b,y,x]}if(ul(d,o))break}return(r.sort==="contrast"?eGe(o):o).map(l=>vs.toColor(l))}var $ae={type:"generate",colorList:"red-yellow-blue"};function ni(e={}){let t={...$ae,...e};return{palette:M.MappedStatic(t.type,{colors:M.Group({list:M.ColorList(t.colorList)},{isFlat:!0}),generate:M.Group({...xU,maxCount:M.Numeric(75,{min:1,max:250,step:1})},{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}var R$t=M.getDefaultValues(ni()),jae={valueLabel:e=>`${e+1}`,minLabel:"Start",maxLabel:"End"};function pi(e,t,r={}){var n;let o,i;if(t.palette.name==="colors"&&t.palette.params.list.kind==="interpolate"){let{list:s}=t.palette.params,a=[0,e-1],{minLabel:l,maxLabel:c}={...jae,...r},u=s.colors;u.length===0&&(u=fa($ae.colorList).list);let d=ns.create({listOrName:u,domain:a,minLabel:l,maxLabel:c});i=d.legend,o=d.color}else{let s;t.palette.name==="colors"?(s=t.palette.params.list.colors.map(u=>Array.isArray(u)?u[0]:u),s.length===0&&(s=fa("dark-2").list.map(u=>Array.isArray(u)?u[0]:u))):(e=Math.min(e,t.palette.params.maxCount),s=Hae(e,t.palette.params));let a=(n=r.valueLabel)!==null&&n!==void 0?n:jae.valueLabel,l=s.length,c=[];for(let u=0;u<e;++u){let d=u%l;c[d]===void 0?c[d]=[a(u),s[d]]:c[d][0]+=`, ${a(u)}`}i=hl(c),o=u=>s[u%l]}return{color:o,legend:i}}var rGe="many-distinct",Wae=ze(16448250),nGe="Gives every chain a color based on its `asym_id` value.",ay={asymId:M.Select("auth",M.arrayToOptions(["auth","label"])),...ni({type:"colors",colorList:rGe})};function oGe(e){var t;let r=M.clone(ay);return!((t=e.structure)===null||t===void 0)&&t.models.some(n=>n.coarseHierarchy.isDefined)&&(r.asymId.defaultValue="label"),r}function iGe(e,t){switch(e.kind){case 0:return t==="auth"?nt.chain.auth_asym_id:nt.chain.label_asym_id;case 1:case 2:return nt.coarse.asym_id}}function qae(e,t){let r=iGe(e.unit,t)(e);return e.structure.root.models.length>1?Zae(e.unit.model,r):r}function Zae(e,t){return`${t}|${(Ut.Index.get(e).value||0)+1}`}function sGe(e,t){let r=new Map;for(let n of e.models){let o=Ut.AsymIdOffset.get(n).value,i=(t==="auth"?o?.auth:o?.label)||0,s=0;n.properties.structAsymMap.forEach(({auth_id:a},l)=>{let c=t==="auth"?a:l,u=e.models.length>1?Zae(n,c):c;r.has(u)||(r.set(u,s+i),++s)})}return r}function ly(e,t){let r,n;if(e.structure){let o=ce.Location.create(e.structure.root),i=sGe(e.structure.root,t.asymId),s=Array.from(i.keys()),a=c=>s[c],l=pi(i.size,t,{valueLabel:a});n=l.legend,r=c=>{let u;if(ce.Location.is(c)){let d=qae(c,t.asymId);u=i.get(d)}else if(_t.isLocation(c)){o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex];let d=qae(o,t.asymId);u=i.get(d)}return u===void 0?Wae:l.color(u)}}else r=()=>Wae;return{factory:ly,granularity:"group",color:r,props:t,description:nGe,legend:n}}var OD={name:"chain-id",label:"Chain Id",category:Dr.Chain,factory:ly,getParams:oGe,defaultValues:M.getDefaultValues(ay),isApplicable:e=>!!e.structure};var Kae=ze(13421772),aGe="Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",Xae={...ni({type:"colors",colorList:"red-yellow-blue"})};function lGe(e){return Xae}function Yae(e,t){let r,n;if(e.structure){let{units:o}=e.structure.root,i=o.length,s=new Map,a=new Map,l=0;for(let u=0;u<i;++u)s.set(u,l),l+=o[u].elements.length,a.set(o[u].id,u);let c=pi(l,t);n=c.legend,r=u=>{if(ce.Location.is(u)){let d=a.get(u.unit.id),m=Ge.findPredecessorIndex(o[d].elements,u.element);return c.color(s.get(d)+m)}else if(_t.isLocation(u)){let d=a.get(u.aUnit.id),m=Ge.findPredecessorIndex(o[d].elements,u.aUnit.elements[u.aIndex]);return c.color(s.get(d)+m)}return Kae}}else r=()=>Kae;return{factory:Yae,granularity:"groupInstance",preferSmoothing:!0,color:r,props:t,description:aGe,legend:n}}var Qae={name:"element-index",label:"Element Index",category:Dr.Atom,factory:Yae,getParams:lGe,defaultValues:M.getDefaultValues(Xae),isApplicable:e=>!!e.structure};function cy(e){let t={};return Ao(e,(r,n)=>{t[n]=M.Color(e[n])}),t}var cGe="many-distinct",Jae=ze(13421772),uGe="Assigns a color based on the operator name of a transformed chain.",VD={...ni({type:"colors",colorList:cGe})};function dGe(e){return M.clone(VD)}function mGe(e){let t=new Map;for(let r=0,n=e.units.length;r<n;++r){let o=e.units[r].conformation.operator.name;t.has(o)||t.set(o,t.size)}return t}function GD(e,t){let r,n;if(e.structure){let o=mGe(e.structure.root),i=Array.from(o.keys()),s=l=>i[l],a=pi(o.size,t,{valueLabel:s});n=a.legend,r=l=>{let c;if(ce.Location.is(l)){let u=l.unit.conformation.operator.name;c=o.get(u)}else if(_t.isLocation(l)){let u=l.aUnit.conformation.operator.name;c=o.get(u)}return c===void 0?Jae:a.color(c)}}else r=()=>Jae;return{factory:GD,granularity:"instance",color:r,props:t,description:uGe,legend:n}}var VC={name:"operator-name",label:"Operator Name",category:Dr.Symmetry,factory:GD,getParams:dGe,defaultValues:M.getDefaultValues(VD),isApplicable:e=>!!e.structure};var pGe="many-distinct",ele=ze(16448250),fGe="Gives every chain a color based on its `label_entity_id` value.",uy={...ni({type:"colors",colorList:pGe})};function hGe(e){return M.clone(uy)}function iw(e,t){return`${e}|${t}`}function gGe(e){let t=new Map;for(let r=0,n=e.models.length;r<n;++r){let{label_entity_id:o}=e.models[r].atomicHierarchy.chains;for(let s=0,a=o.rowCount;s<a;++s){let l=iw(o.value(s),r);t.has(l)||t.set(l,t.size)}let{coarseHierarchy:i}=e.models[r];if(i.isDefined){let{entity_id:s}=i.spheres;for(let l=0,c=s.rowCount;l<c;++l){let u=iw(s.value(l),r);t.has(u)||t.set(u,t.size)}let{entity_id:a}=i.gaussians;for(let l=0,c=a.rowCount;l<c;++l){let u=iw(a.value(l),r);t.has(u)||t.set(u,t.size)}}}return t}function tle(e){switch(e.unit.kind){case 0:return nt.chain.label_entity_id(e);case 1:case 2:return nt.coarse.entity_id(e)}}function dy(e,t){let r,n;if(e.structure){let o=ce.Location.create(e.structure.root),i=gGe(e.structure.root),s=Array.from(i.keys()),a=c=>s[c],l=pi(i.size,t,{valueLabel:a});n=l.legend,r=c=>{let u;if(ce.Location.is(c)){let d=tle(c),m=c.structure.models.indexOf(c.unit.model),p=iw(d,m);u=i.get(p)}else if(_t.isLocation(c)){o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex];let d=tle(o),m=o.structure.models.indexOf(o.unit.model),p=iw(d,m);u=i.get(p)}return u===void 0?ele:l.color(u)}}else r=()=>ele;return{factory:dy,granularity:"group",color:r,props:t,description:fGe,legend:n}}var rle={name:"entity-id",label:"Entity Id",category:Dr.Chain,factory:dy,getParams:hGe,defaultValues:M.getDefaultValues(uy),isApplicable:e=>!!e.structure};var SU="dark-2",UD=ze(16448250),yGe="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",my={...ni({type:"colors",colorList:SU})};function vGe(e){let t=M.clone(my);return e.structure&&ole(e.structure.root.models).srcKeySerialMap.size>Ya[SU].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:fa(SU).list}}),t}function nle(e,t){return`${e}|${t}`}function bGe(e,t,r,n,o,i){return`${e}|${t}|${r}|${i||o||n}`}function CU(e,t,r,n,o,i,s,a){let{entity_id:l,pdbx_src_id:c,pdbx_beg_seq_num:u,pdbx_end_seq_num:d}=o;for(let m=0,p=o._rowCount;m<p;++m){let h=l.value(m),f=nle(r,h),C;if(e.has(f))C=e.get(f);else{let _=n.entities.getEntityIndex(h),I=n.sequence.sequences[_].sequence;C=new Int16Array(I.length),e.set(f,C)}let g=s?s.value(m):"",b=a?a.value(m)[0]:"",y=bGe(r,h,i.value(m),c.value(m),g,b),x=u.valueKind(m)===0?u.value(m):1,A=d.valueKind(m)===0?d.value(m):C.length,v;t.has(y)?v=t.get(y):(v=t.size+1,t.set(y,v));for(let _=x,I=A;_<=I;++_)C[_-1]=v}}function ole(e){let t=new Map,r=new Map;for(let n=0,o=e.length;n<o;++n){let i=e[n];if(!qr.is(i.sourceData))continue;let{entity_src_gen:s,entity_src_nat:a,pdbx_entity_src_syn:l}=i.sourceData.data.db;CU(t,r,n,i,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),CU(t,r,n,i,a,a.pdbx_organism_scientific,a.pdbx_plasmid_name),CU(t,r,n,i,l,l.organism_scientific)}return{seqToSrcByModelEntity:t,srcKeySerialMap:r}}function xGe(e){let t=0;return Array.from(e.keys()).map(r=>{let n=r.split("|"),o=n[2];return`${Rq(n[3])?`Unnamed ${++t}`:n[3]}${o?` (${o})`:""}`})}function py(e,t){let r,n;if(e.structure){let o=ce.Location.create(e.structure),{models:i}=e.structure.root,{seqToSrcByModelEntity:s,srcKeySerialMap:a}=ole(i),l=xGe(a),c=m=>l[m],u=pi(a.size,t,{valueLabel:c});n=u.legend;let d=m=>{let p=i.indexOf(m.unit.model),h=nt.entity.id(m),f=nle(p,h),C=s.get(f);if(C){let g=C[nt.residue.label_seq_id(m)-1]-1;return g===-1?UD:u.color(g)}else return UD};r=m=>ce.Location.is(m)?d(m):_t.isLocation(m)?(o.unit=m.aUnit,o.element=m.aUnit.elements[m.aIndex],d(o)):UD}else r=()=>UD;return{factory:py,granularity:"group",color:r,props:t,description:yGe,legend:n}}var ile={name:"entity-source",label:"Entity Source",category:Dr.Chain,factory:py,getParams:vGe,defaultValues:M.getDefaultValues(my),isApplicable:e=>!!e.structure};var sle=ze(13421772),CGe="Gives every model a unique color based on its index.",fy={...ni({type:"colors",colorList:"many-distinct"})};function SGe(e){return M.clone(fy)}function hy(e,t){var r;let n,o;if(e.structure){let i=((r=Ut.MaxIndex.get(e.structure.models[0]).value)!==null&&r!==void 0?r:-1)+1,s=pi(i,t);o=s.legend,n=a=>ce.Location.is(a)?s.color(Ut.Index.get(a.unit.model).value||0):_t.isLocation(a)?s.color(Ut.Index.get(a.aUnit.model).value||0):sle}else n=()=>sle;return{factory:hy,granularity:"instance",color:n,props:t,description:CGe,legend:o}}var ale={name:"model-index",label:"Model Index",category:Dr.Chain,factory:hy,getParams:SGe,defaultValues:M.getDefaultValues(fy),isApplicable:e=>!!e.structure&&e.structure.elementCount>0};var lle=ze(13421772),IGe="Gives every structure a unique color based on its index.",gy={...ni({type:"colors",colorList:"many-distinct"})};function AGe(e){return M.clone(gy)}function yy(e,t){var r;let n,o;if(e.structure){let i=((r=qe.MaxIndex.get(e.structure).value)!==null&&r!==void 0?r:-1)+1,s=pi(i,t);o=s.legend,n=a=>ce.Location.is(a)?s.color(qe.Index.get(a.structure).value||0):_t.isLocation(a)?s.color(qe.Index.get(a.aStructure).value||0):lle}else n=()=>lle;return{factory:yy,granularity:"instance",color:n,props:t,description:IGe,legend:o}}var cle={name:"structure-index",label:"Structure Index",category:Dr.Chain,factory:yy,getParams:AGe,defaultValues:M.getDefaultValues(gy),isApplicable:e=>!!e.structure&&e.structure.elementCount>0};var IU="dark-2",ule=ze(13421772),wGe="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",zD={...ni({type:"colors",colorList:IU})};function _Ge(e){let t=M.clone(zD);return e.structure&&e.structure.root.units.length>Ya[IU].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:fa(IU).list}}),t}function HD(e,t){let r,n;if(e.structure){let{units:o}=e.structure.root,i=pi(o.length,t);n=i.legend;let s=new Map;for(let a=0,l=o.length;a<l;++a)s.set(o[a].id,i.color(a));r=a=>ce.Location.is(a)?s.get(a.unit.id):_t.isLocation(a)?s.get(a.aUnit.id):ule}else r=()=>ule;return{factory:HD,granularity:"instance",color:r,props:t,description:wGe,legend:n}}var dle={name:"unit-index",label:"Chain Instance",category:Dr.Chain,factory:HD,getParams:_Ge,defaultValues:M.getDefaultValues(zD),isApplicable:e=>!!e.structure};var mle={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},ple=ze(16777215),TGe="Assigns a color to every atom according to its chemical element.",jD={carbonColor:M.MappedStatic("chain-id",{"chain-id":M.Group(ay),"unit-index":M.Group(zD,{label:"Chain Instance"}),"entity-id":M.Group(uy),"entity-source":M.Group(my),"operator-name":M.Group(VD),"model-index":M.Group(fy),"structure-index":M.Group(gy),uniform:M.Group(sg),"element-symbol":M.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:M.Numeric(0,{min:-6,max:6,step:.1}),lightness:M.Numeric(.2,{min:-6,max:6,step:.1}),colors:M.MappedStatic("default",{default:M.EmptyGroup(),custom:M.Group(cy(mle))})};function EGe(e){return M.clone(jD)}function PGe(e,t){let r=e[t];return r===void 0?ple:r}function DGe(e,t){switch(t.name){case"chain-id":return ly(e,t.params);case"unit-index":return HD(e,t.params);case"entity-id":return dy(e,t.params);case"entity-source":return py(e,t.params);case"operator-name":return GD(e,t.params);case"model-index":return hy(e,t.params);case"structure-index":return yy(e,t.params);case"uniform":return Bp(e,t.params);case"element-symbol":return;default:Sr(t)}}function $D(e,t){var r;let n=w0(t.colors.name==="default"?mle:t.colors.params,t.saturation,t.lightness),o=(r=DGe(e,t.carbonColor))===null||r===void 0?void 0:r.color;function i(l,c){return o&&l==="C"?o(c,!1):PGe(n,l)}function s(l){if(ce.Location.is(l)){if(Le.isAtomic(l.unit)){let{type_symbol:c}=l.unit.model.atomicHierarchy.atoms;return i(c.value(l.element),l)}}else if(_t.isLocation(l)&&Le.isAtomic(l.aUnit)){let{type_symbol:c}=l.aUnit.model.atomicHierarchy.atoms,u=c.value(l.aUnit.elements[l.aIndex]);return i(u,l)}return ple}let a=t.carbonColor.name==="operator-name"||t.carbonColor.name==="unit-index"?"groupInstance":"group";return{factory:$D,granularity:a,preferSmoothing:!0,color:s,props:t,description:TGe,legend:hl(Object.keys(n).map(l=>[l,n[l]]))}}var fle={name:"element-symbol",label:"Element Symbol",category:Dr.Atom,factory:$D,getParams:EGe,defaultValues:M.getDefaultValues(jD),isApplicable:e=>!!e.structure};var gle={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},AU=ze(16777113),kGe="Assigns a color based on the molecule type of a residue.",GC={saturation:M.Numeric(0,{min:-6,max:6,step:.1}),lightness:M.Numeric(0,{min:-6,max:6,step:.1}),colors:M.MappedStatic("default",{default:M.EmptyGroup(),custom:M.Group(cy(gle))})};function MGe(e){return GC}function hle(e,t,r){switch(CC(t,r)){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return AU}function UC(e,t){let r=w0(t.colors.name==="default"?gle:t.colors.params,t.saturation,t.lightness);function n(o){return ce.Location.is(o)?hle(r,o.unit,o.element):_t.isLocation(o)?hle(r,o.aUnit,o.aUnit.elements[o.aIndex]):AU}return{factory:UC,granularity:"group",color:n,props:t,description:kGe,legend:hl(Object.keys(r).map(o=>[o,r[o]]).concat([["Other/unknown",AU]]))}}var yle={name:"molecule-type",label:"Molecule Type",category:Dr.Residue,factory:UC,getParams:MGe,defaultValues:M.getDefaultValues(GC),isApplicable:e=>!!e.structure};var wU="dark-2",vle=ze(16448250),RGe="Gives every polymer chain a color based on its `asym_id` value.",xle={...ni({type:"colors",colorList:wU})};function BGe(e){let t=M.clone(xle);return e.structure&&Cle(e.structure.root).size>Ya[wU].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:fa(wU).list}}),t}function ble(e){switch(e.kind){case 0:return nt.chain.label_asym_id;case 1:case 2:return nt.coarse.asym_id}}function Cle(e){let t=new Map;for(let r=0,n=e.unitSymmetryGroups.length;r<n;++r){let o=e.unitSymmetryGroups[r].units[0],{model:i}=o;if(Le.isAtomic(o)){let{chainAtomSegments:s,chains:a}=i.atomicHierarchy,l=Vt.transientSegments(s,o.elements);for(;l.hasNext;){let{index:c}=l.move(),u=a.label_entity_id.value(c),d=i.entities.getEntityIndex(u);if(i.entities.data.type.value(d)==="polymer"){let m=a.label_asym_id.value(c);t.has(m)||t.set(m,t.size)}}}else if(Le.isCoarse(o)){let{chainElementSegments:s,asym_id:a,entity_id:l}=Le.isSpheres(o)?i.coarseHierarchy.spheres:i.coarseHierarchy.gaussians,c=Vt.transientSegments(s,o.elements);for(;c.hasNext;){let{index:u}=c.move(),d=s.offsets[u],m=l.value(d),p=i.entities.getEntityIndex(m);if(i.entities.data.type.value(p)==="polymer"){let h=a.value(d);t.has(h)||t.set(h,t.size)}}}}return t}function Sle(e,t){let r,n;if(e.structure){let o=ce.Location.create(e.structure),i=Cle(e.structure.root),s=Array.from(i.keys()),a=c=>s[c],l=pi(i.size,t,{valueLabel:a});n=l.legend,r=c=>{let u;if(ce.Location.is(c)){let d=ble(c.unit);u=i.get(d(c))}else if(_t.isLocation(c)){let d=ble(c.aUnit);o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex],u=i.get(d(o))}return u===void 0?vle:l.color(u)}}else r=()=>vle;return{factory:Sle,granularity:"group",color:r,props:t,description:RGe,legend:n}}var Ile={name:"polymer-id",label:"Polymer Chain Id",category:Dr.Chain,factory:Sle,getParams:BGe,defaultValues:M.getDefaultValues(xle),isApplicable:e=>!!e.structure};var _U="dark-2",Ale=ze(13421772),LGe="Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",wle={...ni({type:"colors",colorList:_U})};function NGe(e){let t=M.clone(wle);return e.structure&&_le(e.structure.root)>Ya[_U].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:fa(_U).list}}),t}function _le(e){let t=0,{units:r}=e;for(let n=0,o=r.length;n<o;++n)r[n].polymerElements.length>0&&++t;return t}function Tle(e,t){let r,n;if(e.structure){let o=pi(_le(e.structure.root),t);n=o.legend;let{units:i}=e.structure.root,s=new Map;for(let a=0,l=0,c=i.length;a<c;++a)i[a].polymerElements.length>0&&(s.set(i[a].id,o.color(l)),++l);r=a=>{let l;return ce.Location.is(a)?l=s.get(a.unit.id):_t.isLocation(a)&&(l=s.get(a.aUnit.id)),l!==void 0?l:Ale}}else r=()=>Ale;return{factory:Tle,granularity:"instance",color:r,props:t,description:LGe,legend:n}}var Ele={name:"polymer-index",label:"Polymer Chain Instance",category:Dr.Chain,factory:Tle,getParams:NGe,defaultValues:M.getDefaultValues(wle),isApplicable:e=>!!e.structure};var kle={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},TU=ze(16711935),FGe="Assigns a color to every residue according to its name.",qD={saturation:M.Numeric(0,{min:-6,max:6,step:.1}),lightness:M.Numeric(1,{min:-6,max:6,step:.1}),colors:M.MappedStatic("default",{default:M.EmptyGroup(),custom:M.Group(cy(kle))})};function OGe(e){return qD}function Ple(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Dle(e,t){let r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){let o=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[o].sequence.compId.value(r-1)}}function WD(e,t){let r=e[t];return r===void 0?TU:r}function ZD(e,t){let r=w0(t.colors.name==="default"?kle:t.colors.params,t.saturation,t.lightness);function n(o){if(ce.Location.is(o))if(Le.isAtomic(o.unit)){let i=Ple(o.unit,o.element);return WD(r,i)}else{let i=Dle(o.unit,o.element);if(i)return WD(r,i)}else if(_t.isLocation(o))if(Le.isAtomic(o.aUnit)){let i=Ple(o.aUnit,o.aUnit.elements[o.aIndex]);return WD(r,i)}else{let i=Dle(o.aUnit,o.aUnit.elements[o.aIndex]);if(i)return WD(r,i)}return TU}return{factory:ZD,granularity:"group",preferSmoothing:!0,color:n,props:t,description:FGe,legend:hl(Object.keys(r).map(o=>[o,r[o]]).concat([["Unknown",TU]]))}}var Mle={name:"residue-name",label:"Residue Name",category:Dr.Residue,factory:ZD,getParams:OGe,defaultValues:M.getDefaultValues(qD),isApplicable:e=>!!e.structure};var Ble={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},EU=ze(8421504),VGe="Assigns a color based on the type of secondary structure and basic molecule type.",KD={saturation:M.Numeric(-1,{min:-6,max:6,step:.1}),lightness:M.Numeric(0,{min:-6,max:6,step:.1}),colors:M.MappedStatic("default",{default:M.EmptyGroup(),custom:M.Group(cy(Ble))})};function GGe(e){return KD}function Rle(e,t,r,n){let o=bn.create(0);if(n&&Le.isAtomic(t)){let i=n.get(t.invariantId);i&&(o=i.type[i.getIndex(t.residueIndex[r])])}if(bn.is(o,2))return bn.is(o,2048)?e.threeTenHelix:bn.is(o,32768)?e.piHelix:e.alphaHelix;if(bn.is(o,4))return e.betaStrand;if(bn.is(o,8))return e.bend;if(bn.is(o,16))return e.turn;{let i=CC(t,r);if(i===7)return e.dna;if(i===6)return e.rna;if(i===9)return e.carbohydrate;if(i===5)return e.coil}return EU}function XD(e,t){let r=e.structure&&tl.get(e.structure),n=r?wu(r.id,r.version):-1,o=w0(t.colors.name==="default"?Ble:t.colors.params,t.saturation,t.lightness);function i(s){return ce.Location.is(s)?Rle(o,s.unit,s.element,r?.value):_t.isLocation(s)?Rle(o,s.aUnit,s.aUnit.elements[s.aIndex],r?.value):EU}return{factory:XD,granularity:"group",preferSmoothing:!0,color:i,props:t,contextHash:n,description:VGe,legend:hl(Object.keys(o).map(s=>[s,o[s]]).concat([["Other",EU]]))}}var Lle={name:"secondary-structure",label:"Secondary Structure",category:Dr.Residue,factory:XD,getParams:GGe,defaultValues:M.getDefaultValues(KD),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?tl.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&tl.ref(e.structure,!1)}};var UGe=ze(13421772),zGe="Gives every polymer residue a color based on its `seq_id` value.",Ole={list:M.ColorList("turbo",{presetKind:"scale"})};function HGe(e){return Ole}function Nle(e,t){let{model:r}=e;switch(e.kind){case 0:let n=r.atomicHierarchy.residueAtomSegments.index[t];return r.atomicHierarchy.residues.label_seq_id.value(n);case 1:return Math.round((r.coarseHierarchy.spheres.seq_id_begin.value(t)+r.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((r.coarseHierarchy.gaussians.seq_id_begin.value(t)+r.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function Fle(e,t){let{model:r}=e,n="";switch(e.kind){case 0:let s=r.atomicHierarchy.chainAtomSegments.index[t];n=r.atomicHierarchy.chains.label_entity_id.value(s);break;case 1:n=r.coarseHierarchy.spheres.entity_id.value(t);break;case 2:n=r.coarseHierarchy.gaussians.entity_id.value(t);break}if(n==="")return 0;let o=r.entities.getEntityIndex(n);if(o===-1)return 0;let i=r.sequence.byEntityKey[o];return i===void 0?0:i.sequence.length}function Vle(e,t){let r=ns.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"});return{factory:Vle,granularity:"group",preferSmoothing:!0,color:o=>{if(ce.Location.is(o)){let{unit:i,element:s}=o,a=Nle(i,s);if(a>0){let l=Fle(i,s);if(l)return r.setDomain(0,l-1),r.color(a)}}else if(_t.isLocation(o)){let{aUnit:i,aIndex:s}=o,a=Nle(i,i.elements[s]);if(a>0){let l=Fle(i,i.elements[s]);if(l)return r.setDomain(0,l-1),r.color(a)}}return UGe},props:t,description:zGe,legend:r?r.legend:void 0}}var Gle={name:"sequence-id",label:"Sequence Id",category:Dr.Residue,factory:Vle,getParams:HGe,defaultValues:M.getDefaultValues(Ole),isApplicable:e=>!!e.structure};var jGe=ze(16777113),$Ge="Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",zle={domain:M.Interval([0,100]),list:M.ColorList("red-white-blue",{presetKind:"scale"})};function WGe(e){return zle}function Ule(e,t){return Le.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):Le.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function Hle(e,t){let r=ns.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});function n(o){return ce.Location.is(o)?r.color(Ule(o.unit,o.element)):_t.isLocation(o)?r.color(Ule(o.aUnit,o.aUnit.elements[o.aIndex])):jGe}return{factory:Hle,granularity:"group",preferSmoothing:!0,color:n,props:t,description:$Ge,legend:r?r.legend:void 0}}var jle={name:"uncertainty",label:"Uncertainty/Disorder",category:Dr.Atom,factory:Hle,getParams:WGe,defaultValues:M.getDefaultValues(zle),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined)};var qGe=ze(15658734),ZGe="Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",$le={style:M.MappedStatic("entity-id",{uniform:M.Group(sg),"chain-id":M.Group(ay),"entity-id":M.Group(uy),"entity-source":M.Group(my),"molecule-type":M.Group(GC),"model-index":M.Group(fy),"structure-index":M.Group(gy)}),carbonLightness:M.Numeric(.8,{min:-6,max:6,step:.1})};function KGe(e){return M.clone($le)}function XGe(e,t){switch(t.name){case"uniform":return Bp(e,t.params);case"chain-id":return ly(e,t.params);case"entity-id":return dy(e,t.params);case"entity-source":return py(e,t.params);case"molecule-type":return UC(e,t.params);case"model-index":return hy(e,t.params);case"structure-index":return yy(e,t.params);default:Sr(t)}}function Wle(e,t){let{color:r,legend:n}=XGe(e,t.style);function o(s,a){let l=r(s,!1);return a==="C"?ze.lighten(l,t.carbonLightness):l}function i(s){if(ce.Location.is(s)&&Le.isAtomic(s.unit)){let a=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return o(s,a)}else if(_t.isLocation(s)&&Le.isAtomic(s.aUnit)){let a=s.aUnit.elements[s.aIndex],l=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(a);return o(s,l)}return qGe}return{factory:Wle,granularity:"group",preferSmoothing:!0,color:i,props:t,description:ZGe,legend:n}}var qle={name:"illustrative",label:"Illustrative",category:Dr.Misc,factory:Wle,getParams:KGe,defaultValues:M.getDefaultValues($le),isApplicable:e=>!!e.structure};var YGe='Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',Xle={list:M.ColorList("red-yellow-green",{presetKind:"scale"}),scale:M.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])};function QGe(e){return Xle}var JGe={DGwif:0,DGwoct:1,"Oct-IF":2};function eUe(e,t){let r=L3[e];return r===void 0?0:r[t]}function Zle(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Kle(e,t){let r=e.coarseElements.seq_id_begin.value(t),n=e.coarseElements.seq_id_end.value(t);if(r===n){let o=e.coarseElements.entityKey[t];return e.model.sequence.byEntityKey[o].sequence.compId.value(r-1)}}function Yle(e,t){let r=JGe[t.scale],n=1/0,o=-1/0;for(let a in L3){let l=L3[a][r];n=Math.min(n,l),o=Math.max(o,l)}let i=ns.create({listOrName:t.list.colors,domain:[o,n],minLabel:"Hydrophilic",maxLabel:"Hydrophobic"});function s(a){let l;return ce.Location.is(a)?Le.isAtomic(a.unit)?l=Zle(a.unit,a.element):l=Kle(a.unit,a.element):_t.isLocation(a)&&(Le.isAtomic(a.aUnit)?l=Zle(a.aUnit,a.aUnit.elements[a.aIndex]):l=Kle(a.aUnit,a.aUnit.elements[a.aIndex])),i.color(l?eUe(l,r):0)}return{factory:Yle,granularity:"group",preferSmoothing:!0,color:s,props:t,description:YGe,legend:i?i.legend:void 0}}var Qle={name:"hydrophobicity",label:"Hydrophobicity",category:Dr.Residue,factory:Yle,getParams:QGe,defaultValues:M.getDefaultValues(Xle),isApplicable:e=>!!e.structure};var Jle=ze(13421772),tUe="Gives every model (frame) a unique color based on the index in its trajectory.",ece={...ni({type:"colors",colorList:"purples"})};function rUe(e){return M.clone(ece)}function tce(e,t){var r,n;let o,i;if(e.structure){let{models:s}=e.structure.root,a=0;for(let u of s)a=Math.max(a,((r=Ut.TrajectoryInfo.get(u))===null||r===void 0?void 0:r.size)||0);let l=pi(a,t);i=l.legend;let c=new Map;for(let u=0,d=s.length;u<d;++u){let m=((n=Ut.TrajectoryInfo.get(s[u]))===null||n===void 0?void 0:n.index)||0;c.set(m,l.color(m))}o=u=>ce.Location.is(u)?c.get(Ut.TrajectoryInfo.get(u.unit.model).index):_t.isLocation(u)?c.get(Ut.TrajectoryInfo.get(u.aUnit.model).index):Jle}else o=()=>Jle;return{factory:tce,granularity:"instance",color:o,props:t,description:tUe,legend:i}}var rce={name:"trajectory-index",label:"Trajectory Index",category:Dr.Chain,factory:tce,getParams:rUe,defaultValues:M.getDefaultValues(ece),isApplicable:e=>!!e.structure&&e.structure.elementCount>0&&Ut.TrajectoryInfo.get(e.structure.models[0]).size>1};var nUe=ze(13421772),oUe="Assigns a color based on the occupancy of an atom.",oce={domain:M.Interval([0,1]),list:M.ColorList("purples",{presetKind:"scale"})};function iUe(e){return oce}function nce(e,t){return Le.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function ice(e,t){let r=ns.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});function n(o){return ce.Location.is(o)?r.color(nce(o.unit,o.element)):_t.isLocation(o)?r.color(nce(o.aUnit,o.aUnit.elements[o.aIndex])):nUe}return{factory:ice,granularity:"group",preferSmoothing:!0,color:n,props:t,description:oUe,legend:r?r.legend:void 0}}var sce={name:"occupancy",label:"Occupancy",category:Dr.Atom,factory:ice,getParams:iUe,defaultValues:M.getDefaultValues(oce),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.occupancy.isDefined)};var DU="dark-2",lce=ze(13421772),sUe="Assigns a color based on the operator HKL value of a transformed chain.",cce={...ni({type:"colors",colorList:DU})};function aUe(e){let t=M.clone(cce);return e.structure&&uce(e.structure.root).map.size>Ya[DU].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:fa(DU).list}}),t}var sw=1e4;function kU(e){return e.map(t=>`${t+sw}`.padStart(5,"0")).join("")}function MU(e){let t=kq(sw,0),r=parseInt(e.substr(0,t)),n=parseInt(e.substr(t,t)),o=parseInt(e.substr(t+t,t));return D.create(r-sw,n-sw,o-sw)}function PU(e){return e.map(t=>t+5).join("")}function uce(e){let t=new Map,r=new Set;for(let s=0,a=e.units.length;s<a;++s){let l=kU(e.units[s].conformation.operator.hkl);r.add(l)}let n=Array.from(r.values()).sort();n.forEach(s=>t.set(s,t.size));let o=MU(n[0]),i=MU(n[n.length-1]);return{min:o,max:i,map:t}}function dce(e,t){let r,n;if(e.structure){let{min:o,max:i,map:s}=uce(e.structure.root),a=[];s.forEach((u,d)=>{let m=u%s.size,p=PU(MU(d));a[m]===void 0?a[m]=p:a[m]+=`, ${p}`});let l={minLabel:PU(o),maxLabel:PU(i),valueLabel:u=>a[u]},c=pi(s.size,t,l);n=c.legend,r=u=>{let d;if(ce.Location.is(u)){let m=kU(u.unit.conformation.operator.hkl);d=s.get(m)}else if(_t.isLocation(u)){let m=kU(u.aUnit.conformation.operator.hkl);d=s.get(m)}return d===void 0?lce:c.color(d)}}else r=()=>lce;return{factory:dce,granularity:"instance",color:r,props:t,description:sUe,legend:n}}var mce={name:"operator-hkl",label:"Operator HKL",category:Dr.Symmetry,factory:dce,getParams:aUe,defaultValues:M.getDefaultValues(cce),isApplicable:e=>!!e.structure};var RU=ze(16777113),lUe="Assigns a color based on the partial charge of an atom.",fce={domain:M.Interval([-1,1]),list:M.ColorList("red-white-blue",{presetKind:"scale"})};function cUe(e){return fce}function pce(e,t){var r;return(r=Ag.Provider.get(e.model))===null||r===void 0?void 0:r.data.value(t)}function hce(e,t){let r=ns.create({domain:t.domain,listOrName:t.list.colors});function n(o){if(ce.Location.is(o)){let i=pce(o.unit,o.element);return i!==void 0?r.color(i):RU}else if(_t.isLocation(o)){let i=pce(o.aUnit,o.aUnit.elements[o.aIndex]);return i!==void 0?r.color(i):RU}return RU}return{factory:hce,granularity:"group",preferSmoothing:!0,color:n,props:t,description:lUe,legend:r?r.legend:void 0}}var gce={name:"partial-charge",label:"Partial Charge",category:Dr.Atom,factory:hce,getParams:cUe,defaultValues:M.getDefaultValues(fce),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>Ag.Provider.get(t)!==void 0)};var uUe="many-distinct",yce=ze(16448250),dUe="Gives every atom a color based on its `label_atom_id` value.",vce={...ni({type:"colors",colorList:uUe})};function mUe(e){return M.clone(vce)}function pUe(e){let t=new Map;for(let r of e.models){let{label_atom_id:n}=r.atomicHierarchy.atoms;for(let o=0,i=n.rowCount;o<i;++o){let s=n.value(o);t.has(s)||t.set(s,t.size)}}return t}function bce(e,t){let r,n;if(e.structure){let o=ce.Location.create(e.structure.root),i=pUe(e.structure.root),s=Array.from(i.keys()),a=c=>s[c],l=pi(i.size,t,{valueLabel:a});n=l.legend,r=c=>{let u;if(ce.Location.is(c)){let d=nt.atom.label_atom_id(c);u=i.get(d)}else if(_t.isLocation(c)){o.unit=c.aUnit,o.element=c.aUnit.elements[c.aIndex];let d=nt.atom.label_atom_id(o);u=i.get(d)}return u===void 0?yce:l.color(u)}}else r=()=>yce;return{factory:bce,granularity:"group",preferSmoothing:!0,color:r,props:t,description:dUe,legend:n}}var xce={name:"atom-id",label:"Atom Id",category:Dr.Atom,factory:bce,getParams:mUe,defaultValues:M.getDefaultValues(vce),isApplicable:e=>!!e.structure};var fUe="Assign color based on the given value of a volume cell.",Cce={colorList:M.ColorList({kind:"interpolate",colors:[[Gt.white,0],[Gt.red,.25],[Gt.white,.5],[Gt.blue,.75],[Gt.white,1]]},{offsets:!0,isEssential:!0})};function hUe(e){return Cce}function Sce(e,t){let r=ns.create({domain:[0,1],listOrName:t.colorList.colors}),n=[];for(let i=0;i<256;++i)n[i]=r.color(i/255);let o={colors:n,filter:"linear"};return{factory:Sce,granularity:"direct",props:t,description:fUe,legend:r.legend,palette:o}}var Ice={name:"volume-value",label:"Volume Value",category:Dr.Misc,factory:Sce,getParams:hUe,defaultValues:M.getDefaultValues(Cce),isApplicable:e=>!!e.volume&&!ot.Segmentation.get(e.volume)};var Ace=ze(13421772),gUe="Gives every volume segment a unique color.",wce={...ni({type:"colors",colorList:"many-distinct"})};function yUe(e){return M.clone(wce)}function _ce(e,t){let r,n,o=e.volume&&ot.Segmentation.get(e.volume);if(o){let i=o.segments.size,s=Array.from(o.segments.keys()),a=pi(i,t);n=a.legend,r=l=>ot.Segment.isLocation(l)?a.color(s.indexOf(l.segment)):Ace}else r=()=>Ace;return{factory:_ce,granularity:"instance",color:r,props:t,description:gUe,legend:n}}var Tce={name:"volume-segment",label:"Volume Segment",category:Dr.Misc,factory:_ce,getParams:yUe,defaultValues:M.getDefaultValues(wce),isApplicable:e=>!!e.volume&&!!ot.Segmentation.get(e.volume)};var vUe="Assigns a color based on volume value at a given vertex.",Ece={volume:M.ValueRef(e=>e.state.data.selectQ(r=>r.root.subtree().filter(n=>{var o;return ot.is((o=n.obj)===null||o===void 0?void 0:o.data)})).map(r=>{var n,o;return[r.transform.ref,(o=(n=r.obj)===null||n===void 0?void 0:n.label)!==null&&o!==void 0?o:"<unknown>"]}),(e,t)=>t(e)),coloring:M.MappedStatic("absolute-value",{"absolute-value":M.Group({domain:M.MappedStatic("auto",{custom:M.Interval([-1,1]),auto:M.Group({symmetric:M.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:M.ColorList("red-white-blue",{presetKind:"scale"})}),"relative-value":M.Group({domain:M.MappedStatic("auto",{custom:M.Interval([-1,1]),auto:M.Group({symmetric:M.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:M.ColorList("red-white-blue",{presetKind:"scale"})})}),defaultColor:M.Color(ze(13421772)),normalOffset:M.Numeric(0,{min:0,max:20,step:.1},{description:"Offset vertex position along its normal by given amount."})};function Pce(e,t){let r;try{r=t.volume.getValue()}catch{}let n;if(r){let o=t.coloring.params,{stats:i}=r.grid,s=o.domain.name==="custom"?o.domain.params:[i.min,i.max],a=t.coloring.name==="relative-value";if(o.domain.name==="auto"&&a&&(s[0]=(s[0]-i.mean)/i.sigma,s[1]=(s[1]-i.mean)/i.sigma),t.coloring.params.domain.name==="auto"&&t.coloring.params.domain.params.symmetric){let g=Math.max(Math.abs(s[0]),Math.abs(s[1]));s[0]=-g,s[1]=g}let l=ns.create({domain:s,listOrName:o.list.colors}),c=go.getGridToCartesianTransform(r.grid);de.invert(c,c);let u=D(),{dimensions:d,get:m}=r.grid.cells.space,p=r.grid.cells.data,[h,f,C]=d;n=g=>{if(!UQ(g))return t.defaultColor;D.copy(u,g.position),t.normalOffset>0&&D.scaleAndAdd(u,u,g.normal,t.normalOffset),D.transformMat4(u,u,c);let b=Math.floor(u[0]),y=Math.floor(u[1]),x=Math.floor(u[2]);if(b<0||b>=h||y<0||y>=f||x<0||x>=C)return t.defaultColor;let A=u[0]-b,v=u[1]-y,_=u[2]-x,I=Math.min(b+1,h-1),T=Math.min(y+1,f-1),E=Math.min(x+1,C-1),w=m(p,b,y,x),S=m(p,I,y,x),P=m(p,b,T,x),k=m(p,I,T,x),L=zn(zn(w,S,A),zn(P,k,A),v);w=m(p,b,y,E),S=m(p,I,y,E),P=m(p,b,T,E),k=m(p,I,T,E);let R=zn(zn(w,S,A),zn(P,k,A),v),N=zn(L,R,_);return a&&(N=(N-i.mean)/i.sigma),l.color(N)}}else n=()=>t.defaultColor;return{factory:Pce,granularity:"vertex",preferSmoothing:!0,color:n,props:t,description:vUe}}var Dce={name:"external-volume",label:"External Volume",category:Dr.Misc,factory:Pce,getParams:()=>Ece,defaultValues:M.getDefaultValues(Ece),isApplicable:e=>!0};var bUe="Uses separate themes for coloring mainchain and sidechain visuals.",kce={mainchain:M.MappedStatic("molecule-type",{uniform:M.Group(sg),"chain-id":M.Group(ay),"entity-id":M.Group(uy),"entity-source":M.Group(my),"molecule-type":M.Group(GC),"model-index":M.Group(fy),"structure-index":M.Group(gy),"secondary-structure":M.Group(KD)}),sidechain:M.MappedStatic("residue-name",{uniform:M.Group(sg),"residue-name":M.Group(qD),"element-symbol":M.Group(jD)})};function xUe(e){return M.clone(kce)}function CUe(e,t){switch(t.name){case"uniform":return Bp(e,t.params);case"chain-id":return ly(e,t.params);case"entity-id":return dy(e,t.params);case"entity-source":return py(e,t.params);case"molecule-type":return UC(e,t.params);case"model-index":return hy(e,t.params);case"structure-index":return yy(e,t.params);case"secondary-structure":return XD(e,t.params);default:Sr(t)}}function SUe(e,t){switch(t.name){case"uniform":return Bp(e,t.params);case"residue-name":return ZD(e,t.params);case"element-symbol":return $D(e,t.params);default:Sr(t)}}function Mce(e,t){var r,n;let o=CUe(e,t.mainchain),i=SUe(e,t.sidechain);function s(l,c){return c?o.color(l,!1):i.color(l,!1)}let a=o.legend;return((r=o.legend)===null||r===void 0?void 0:r.kind)==="table-legend"&&((n=i.legend)===null||n===void 0?void 0:n.kind)==="table-legend"&&(a={kind:"table-legend",table:[...o.legend.table,...i.legend.table]}),{factory:Mce,granularity:"group",preferSmoothing:!1,color:s,props:t,description:bUe,legend:a}}var Rce={name:"cartoon",label:"Cartoon",category:Dr.Misc,factory:Mce,getParams:xUe,defaultValues:M.getDefaultValues(kce),isApplicable:e=>!!e.structure};var oi;(function(e){e.Category=Dr,e.PaletteScale=(1<<24)-1,e.EmptyFactory=()=>e.Empty;let t=ze(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:()=>t,props:{}};function r(o,i){return o.contextHash===i.contextHash&&o.factory===i.factory&&ul(o.props,i.props)}e.areEqual=r,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0};function n(){return new zC(e.BuiltIn,e.EmptyProvider)}e.createRegistry=n,e.BuiltIn={"atom-id":xce,"carbohydrate-symbol":Uae,cartoon:Rce,"chain-id":OD,"element-index":Qae,"element-symbol":fle,"entity-id":rle,"entity-source":ile,hydrophobicity:Qle,illustrative:qle,"model-index":ale,"molecule-type":yle,occupancy:sce,"operator-hkl":mce,"operator-name":VC,"partial-charge":gce,"polymer-id":Ile,"polymer-index":Ele,"residue-name":Mle,"secondary-structure":Lle,"sequence-id":Gle,"shape-group":Vre,"structure-index":cle,"trajectory-index":rce,uncertainty:jle,"unit-index":dle,uniform:Ite,"volume-segment":Tce,"volume-value":Ice,"external-volume":Dce}})(oi||(oi={}));var IUe=1,AUe="Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres.",Bce={scale:M.Numeric(1,{min:.1,max:5,step:.1})};function wUe(e){return Bce}function BU(e,t){return Le.isAtomic(e)?qf(e.model.atomicHierarchy.atoms.type_symbol.value(t)):Le.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}function Lce(e,t){let r=t.scale===void 0?1:t.scale;function n(o){let i;return ce.Location.is(o)?i=r*BU(o.unit,o.element):_t.isLocation(o)?i=r*Math.min(BU(o.aUnit,o.aUnit.elements[o.aIndex]),BU(o.bUnit,o.bUnit.elements[o.bIndex])):i=r*IUe,i}return{factory:Lce,granularity:"group",size:n,props:t,description:AUe}}var Nce={name:"physical",label:"Physical",category:"",factory:Lce,getParams:wUe,defaultValues:M.getDefaultValues(Bce),isApplicable:e=>!!e.structure};var _Ue="Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",Oce={bfactorFactor:M.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:M.Numeric(.05,{min:0,max:1,step:.01}),baseSize:M.Numeric(.2,{min:0,max:2,step:.1})};function TUe(e){return Oce}function Fce(e,t,r){return Le.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*r.bfactorFactor:Le.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*r.rmsfFactor:0}function Vce(e,t){function r(n){let o=t.baseSize;return ce.Location.is(n)?o+=Fce(n.unit,n.element,t):_t.isLocation(n)&&(o+=Fce(n.aUnit,n.aUnit.elements[n.aIndex],t)),o}return{factory:Vce,granularity:"group",size:r,props:t,description:_Ue}}var Gce={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:Vce,getParams:TUe,defaultValues:M.getDefaultValues(Oce),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined)};var Vi;(function(e){e.EmptyFactory=()=>e.Empty,e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:()=>1,props:{}};function t(n,o){return n.contextHash===o.contextHash&&n.factory===o.factory&&ul(n.props,o.props)}e.areEqual=t,e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0};function r(){return new zC(e.BuiltIn,e.EmptyProvider)}e.createRegistry=r,e.BuiltIn={physical:Nce,"shape-group":Fre,uncertainty:Gce,uniform:wte}})(Vi||(Vi={}));var ii;(function(e){function t(i,s,a,l){l=l||r();let c=a.colorTheme,u=a.sizeTheme;return l.color=i.colorThemeRegistry.create(c.name,s,c.params),l.size=i.sizeThemeRegistry.create(u.name,s,u.params),l}e.create=t;function r(){return{color:oi.Empty,size:Vi.Empty}}e.createEmpty=r;async function n(i,s,a,l){var c,u;await((c=s.colorThemeRegistry.get(l.colorTheme.name).ensureCustomProperties)===null||c===void 0?void 0:c.attach(i,a)),await((u=s.sizeThemeRegistry.get(l.sizeTheme.name).ensureCustomProperties)===null||u===void 0?void 0:u.attach(i,a))}e.ensureDependencies=n;function o(i,s,a){var l,c;(l=i.colorThemeRegistry.get(a.colorTheme.name).ensureCustomProperties)===null||l===void 0||l.detach(s),(c=i.sizeThemeRegistry.get(a.sizeTheme.name).ensureCustomProperties)===null||c===void 0||c.detach(s)}e.releaseDependencies=o})(ii||(ii={}));function Uce(e){return e.map(t=>[t.name,t.provider.label,t.provider.category])}var zC=class{get default(){return this._list[0]}get list(){return this._list}get types(){return Uce(this._list)}constructor(t,r){this.emptyProvider=r,this._list=[],this._map=new Map,this._name=new Map,Ao(t,(n,o)=>{if(n.name!==o)throw new Error(`Fix build in themes to have matching names. ${n.name} ${o}`);this.add(n)})}sort(){this._list.sort((t,r)=>t.provider.category===r.provider.category?t.provider.label<r.provider.label?-1:t.provider.label>r.provider.label?1:0:t.provider.category<r.provider.category?-1:1)}add(t){if(this._map.has(t.name))throw new Error(`${t.name} already registered.`);let r=t.name;this._list.push({name:r,provider:t}),this._map.set(r,t),this._name.set(t,r),this.sort()}remove(t){this._list.splice(this._list.findIndex(n=>n.name===t.name),1);let r=this._map.get(t.name);r&&(this._map.delete(t.name),this._name.delete(r))}has(t){return this._map.has(t.name)}get(t){return this._map.get(t)||this.emptyProvider}getName(t){if(!this._name.has(t))throw new Error(`'${t.label}' is not a registered theme provider.`);return this._name.get(t)}create(t,r,n={}){let o=this.get(t);return o.factory(r,{...M.getDefaultValues(o.getParams(r)),...n})}getApplicableList(t){return this._list.filter(r=>r.provider.isApplicable(t))}getApplicableTypes(t){return Uce(this.getApplicableList(t))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}};var zt;(function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"})(zt||(zt={}));var si;(function(e){e.is=zi.has,e.All=zt.Highlight|zt.RemoveHighlight|zt.Select|zt.Deselect|zt.Toggle|zt.Clear,e.Highlighting=zt.Highlight|zt.RemoveHighlight|zt.Clear,e.Selecting=zt.Select|zt.Deselect|zt.Toggle|zt.Clear;function t(r,n){return r===zt.Highlight&&n===zt.RemoveHighlight||r===zt.RemoveHighlight&&n===zt.Highlight||r===zt.Select&&n===zt.Deselect||r===zt.Deselect&&n===zt.Select||r===zt.Toggle&&n===zt.Toggle}e.isReverse=t})(si||(si={}));function zce(e,t,r){e.fill(t,0,r)}function HC(e,t,r){switch(r){case zt.Highlight:e[t]|=1;break;case zt.RemoveHighlight:e[t]&=-2;break;case zt.Select:e[t]|=2;break;case zt.Deselect:e[t]&=-3;break;case zt.Toggle:e[t]^=2;break;case zt.Clear:e[t]=0;break}}function Rl(e,t,r){if(r===zt.None)return!1;if(Be.is(t)){let n=Be.start(t),o=Be.end(t),i=n+3>>2,s=i+(o-4*i>>2);if(s<=i){for(let m=n;m<o;++m)HC(e,m,r);return!0}let a=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),l=n,c=Math.min(4*i,o),u=Math.max(n,4*s),d=o;switch(r){case zt.Highlight:for(let m=i;m<s;++m)a[m]|=16843009;break;case zt.RemoveHighlight:for(let m=i;m<s;++m)a[m]&=-16843010;break;case zt.Select:for(let m=i;m<s;++m)a[m]|=33686018;break;case zt.Deselect:for(let m=i;m<s;++m)a[m]&=-33686019;break;case zt.Toggle:for(let m=i;m<s;++m)a[m]^=33686018;break;case zt.Clear:for(let m=i;m<s;++m)a[m]=0;break;default:Sr(r)}for(let m=l;m<c;++m)HC(e,m,r);for(let m=u;m<d;++m)HC(e,m,r)}else switch(r){case zt.Highlight:for(let n=0,o=t.length;n<o;++n)e[t[n]]|=1;break;case zt.RemoveHighlight:for(let n=0,o=t.length;n<o;++n)e[t[n]]&=-2;break;case zt.Select:for(let n=0,o=t.length;n<o;++n)e[t[n]]|=2;break;case zt.Deselect:for(let n=0,o=t.length;n<o;++n)e[t[n]]&=-3;break;case zt.Toggle:for(let n=0,o=t.length;n<o;++n)e[t[n]]^=2;break;case zt.Clear:for(let n=0,o=t.length;n<o;++n)e[t[n]]=0;break;default:Sr(r)}return!0}function Hce(e,t){let r=-1,n=-1;switch(e){case zt.Highlight:t===0||t===1?(r=1,n=1):t===2||t===3?(r=1,n=3):r=1;break;case zt.RemoveHighlight:t===0||t===1?(r=0,n=0):(t===2||t===3)&&(r=1,n=2);break;case zt.Select:t===1||t===3?(r=1,n=3):t===0||t===2?(r=1,n=2):r=1;break;case zt.Deselect:t===1||t===3?(r=1,n=1):(t===0||t===2)&&(r=0,n=0);break;case zt.Toggle:t===1?(r=1,n=3):t===2?(r=0,n=0):t===3?(r=1,n=1):t===0&&(r=1,n=2);break;case zt.Clear:r=0,n=0;break}return{average:r,status:n}}function jce(e,t){switch(e){case zt.Highlight:return .5;case zt.RemoveHighlight:return t===0?0:t===2||t===3?.5:-1;case zt.Select:return .5;case zt.Deselect:return t===1||t===3?.5:t===0?0:-1;case zt.Toggle:return t===-1?-1:.5;case zt.Clear:return t===-1?-1:t===0?0:.5;case zt.None:return-1;default:Sr(e)}}var vy={kind:"every-loci"};function cs(e){return!!e&&e.kind==="every-loci"}var pr={kind:"empty-loci"};function wi(e){return!!e&&e.kind==="empty-loci"}function Wb(e){return!!e&&e.kind==="data-loci"}function EUe(e,t){if(!zh(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(let r=0,n=e.elements.length;r<n;++r)if(!zh(e.elements[r],t.elements[r]))return!1;return!0}function PUe(e){return e.elements.length===0}function by(e,t,r,n,o){return{kind:"data-loci",tag:e,data:t,elements:r,getBoundingSphere:n,getLabel:o}}var Xt;(function(e){let t=new is("98");function r(f){let C=f.loci.map(g=>a(g)).filter(g=>!!g);t.reset();for(let g of C)t.includePositionRadius(g.center,g.radius);t.finishedIncludeStep();for(let g of C)t.radiusPositionRadius(g.center,g.radius);return t.getSphere()}e.getBundleBoundingSphere=r;function n(f,C){return cs(f)&&cs(C)||wi(f)&&wi(C)?!0:Wb(f)&&Wb(C)?EUe(f,C):qe.isLoci(f)&&qe.isLoci(C)?qe.areLociEqual(f,C):ce.Loci.is(f)&&ce.Loci.is(C)?ce.Loci.areEqual(f,C):_t.isLoci(f)&&_t.isLoci(C)?_t.areLociEqual(f,C):br.isLoci(f)&&br.isLoci(C)?br.areLociEqual(f,C):Fi.isLoci(f)&&Fi.isLoci(C)?Fi.areLociEqual(f,C):ot.isLoci(f)&&ot.isLoci(C)?ot.areLociEqual(f,C):ot.Isosurface.isLoci(f)&&ot.Isosurface.isLoci(C)?ot.Isosurface.areLociEqual(f,C):ot.Cell.isLoci(f)&&ot.Cell.isLoci(C)?ot.Cell.areLociEqual(f,C):ot.Segment.isLoci(f)&&ot.Segment.isLoci(C)?ot.Segment.areLociEqual(f,C):!1}e.areEqual=n;function o(f){return!!f&&f.kind==="every-loci"}e.isEvery=o;function i(f){return cs(f)?!1:wi(f)?!0:Wb(f)?PUe(f):qe.isLoci(f)?qe.isLociEmpty(f):ce.Loci.is(f)?ce.Loci.isEmpty(f):_t.isLoci(f)?_t.isLociEmpty(f):br.isLoci(f)?br.isLociEmpty(f):Fi.isLoci(f)?Fi.isLociEmpty(f):ot.isLoci(f)?ot.isLociEmpty(f):ot.Isosurface.isLoci(f)?ot.Isosurface.isLociEmpty(f):ot.Cell.isLoci(f)?ot.Cell.isLociEmpty(f):ot.Segment.isLoci(f)?ot.Segment.isLociEmpty(f):!1}e.isEmpty=i;function s(f,C){return C instanceof qe&&(ce.Loci.is(f)?f=ce.Loci.remap(f,C):qe.isLoci(f)?f=qe.remapLoci(f,C):_t.isLoci(f)&&(f=_t.remapLoci(f,C))),f}e.remap=s;function a(f,C){var g;if(!(f.kind==="every-loci"||f.kind==="empty-loci")){if(C||(C=Pe()),f.kind==="structure-loci")return Pe.copy(C,f.structure.boundary.sphere);if(f.kind==="element-loci")return Pe.copy(C,ce.Loci.getBoundary(f).sphere);if(f.kind==="bond-loci")return _t.getBoundingSphere(f,C);if(f.kind==="shape-loci")return Pe.copy(C,f.shape.geometry.boundingSphere);if(f.kind==="group-loci")return Fi.getBoundingSphere(f,C);if(f.kind==="data-loci")return(g=f.getBoundingSphere)===null||g===void 0?void 0:g.call(f,C);if(f.kind==="volume-loci")return ot.getBoundingSphere(f.volume,C);if(f.kind==="isosurface-loci")return ot.Isosurface.getBoundingSphere(f.volume,f.isoValue,C);if(f.kind==="cell-loci")return ot.Cell.getBoundingSphere(f.volume,f.indices,C);if(f.kind==="segment-loci")return ot.Segment.getBoundingSphere(f.volume,f.segments,C)}}e.getBoundingSphere=a;let l=Pe.zero();function c(f,C){let g=a(f,l);return g?D.copy(C||D(),g.center):void 0}e.getCenter=c;function u(f){if(!(f.kind==="every-loci"||f.kind==="empty-loci")){if(f.kind==="structure-loci")return ce.Loci.getPrincipalAxes(qe.toStructureElementLoci(f.structure));if(f.kind==="element-loci")return ce.Loci.getPrincipalAxes(f);if(f.kind==="bond-loci")return;if(f.kind==="shape-loci")return;if(f.kind==="group-loci")return;if(f.kind==="data-loci")return;if(f.kind==="volume-loci")return;if(f.kind==="isosurface-loci")return;if(f.kind==="cell-loci")return;if(f.kind==="segment-loci")return}}e.getPrincipalAxes=u;let d={element:f=>f,residue:f=>ce.Loci.is(f)?ce.Loci.extendToWholeResidues(f,!0):f,chain:f=>ce.Loci.is(f)?ce.Loci.extendToWholeChains(f):f,entity:f=>ce.Loci.is(f)?ce.Loci.extendToWholeEntities(f):f,model:f=>ce.Loci.is(f)?ce.Loci.extendToWholeModels(f):f,operator:f=>ce.Loci.is(f)?ce.Loci.extendToWholeOperators(f):f,structure:f=>ce.Loci.is(f)?qe.toStructureElementLoci(f.structure):Fi.isLoci(f)?br.Loci(f.shape):ot.Cell.isLoci(f)?ot.Loci(f.volume):f,elementInstances:f=>ce.Loci.is(f)?ce.Loci.extendToAllInstances(f):f,residueInstances:f=>ce.Loci.is(f)?ce.Loci.extendToAllInstances(ce.Loci.extendToWholeResidues(f,!0)):f,chainInstances:f=>ce.Loci.is(f)?ce.Loci.extendToAllInstances(ce.Loci.extendToWholeChains(f)):f};e.GranularityOptions=M.objectToOptions(d,f=>{switch(f){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return f.indexOf("Instances")?[Ms(f),"With Symmetry"]:Ms(f)}});function m(f){return f.replace("Instances","")}e.simpleGranularity=m;function p(f,C){return d[C](f)}e.applyGranularity=p;function h(f,C,g=!1){return(C!=="element"||g)&&_t.isLoci(f)&&(f=_t.toStructureElementLoci(f)),qe.isLoci(f)&&(f=qe.toStructureElementLoci(f.structure)),ce.Loci.is(f)&&(f=ce.Loci.remap(f,f.structure.root)),C&&(f=p(f,C)),f}e.normalize=h})(Xt||(Xt={}));function Gs(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(c,u){if(c.layers.length===0&&u.layers.length===0)return!0;if(c.layers.length!==u.layers.length)return!1;for(let d=0,m=c.layers.length;d<m;++d)if(c.layers[d].clear!==u.layers[d].clear||c.layers[d].color!==u.layers[d].color||!Xt.areEqual(c.layers[d].loci,u.layers[d].loci))return!1;return!0}e.areEqual=t;function r(c){return c.layers.length===0}e.isEmpty=r;function n(c,u){if(c.kind==="element-loci"){let d=[];for(let m of c.layers){let{loci:p,color:h,clear:f}=m;p=ce.Loci.remap(p,u),ce.Loci.isEmpty(p)||d.push({loci:p,color:h,clear:f})}return{kind:"element-loci",layers:d}}else return c}e.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:u}=c.layers[0].loci,d=new Map,m=ce.Loci.none(u);for(let h=0,f=c.layers.length;h<f;++h){let{loci:C,color:g,clear:b}=c.layers[f-h-1];if(C=ce.Loci.subtract(C,m),m=ce.Loci.union(C,m),!ce.Loci.isEmpty(C)){let y=b?-1:g;d.has(y)&&(C=ce.Loci.union(C,d.get(y))),d.set(y,C)}}let p=[];return d.forEach((h,f)=>{let C=f===-1,g=C?ze(0):f;p.push({loci:h,color:g,clear:C})}),{kind:"element-loci",layers:p}}else return c}e.merge=o;function i(c,u){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,m=[];for(let p of c.layers){let{loci:h,color:f,clear:C}=p,g=ce.Loci.remap(h,u);h=ce.Loci.remap(g,d),ce.Loci.isEmpty(h)||m.push({loci:h,color:f,clear:C})}return{kind:"element-loci",layers:m}}else return c}e.filter=i;function s(c,u){let d=[];for(let m=0,p=c.length;m<p;++m){let{script:h,color:f,clear:C}=c[m],g=To.toLoci(h,u);ce.Loci.isEmpty(g)||d.push({loci:g,color:f,clear:C})}return{kind:"element-loci",layers:d}}e.ofScript=s;function a(c,u){let d=[];for(let m=0,p=c.length;m<p;++m){let{bundle:h,color:f,clear:C}=c[m],g=ce.Bundle.toLoci(h,u.root);d.push({loci:g,color:f,clear:C})}return{kind:"element-loci",layers:d}}e.ofBundle=a;function l(c){let u=[];for(let d=0,m=c.layers.length;d<m;++d){let{loci:p,color:h,clear:f}=c.layers[d],C=ce.Bundle.fromLoci(p);u.push({bundle:C,color:h,clear:f})}return{kind:"element-loci",layers:u}}e.toBundle=l})(Gs||(Gs={}));function Us(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(c,u){if(c.layers.length===0&&u.layers.length===0)return!0;if(c.layers.length!==u.layers.length)return!1;for(let d=0,m=c.layers.length;d<m;++d)if(c.layers[d].value!==u.layers[d].value||!Xt.areEqual(c.layers[d].loci,u.layers[d].loci))return!1;return!0}e.areEqual=t;function r(c){return c.layers.length===0}e.isEmpty=r;function n(c,u){if(c.kind==="element-loci"){let d=[];for(let m of c.layers){let p=ce.Loci.remap(m.loci,u);ce.Loci.isEmpty(p)||d.push({loci:p,value:m.value})}return{kind:"element-loci",layers:d}}else return c}e.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:u}=c.layers[0].loci,d=new Map,m=ce.Loci.none(u);for(let h=0,f=c.layers.length;h<f;++h){let{loci:C,value:g}=c.layers[f-h-1];C=ce.Loci.subtract(C,m),m=ce.Loci.union(C,m),ce.Loci.isEmpty(C)||(d.has(g)&&(C=ce.Loci.union(C,d.get(g))),d.set(g,C))}let p=[];return d.forEach((h,f)=>{p.push({loci:h,value:f})}),{kind:"element-loci",layers:p}}else return c}e.merge=o;function i(c,u){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,m=[];for(let p of c.layers){let{loci:h,value:f}=p,C=ce.Loci.remap(h,u);h=ce.Loci.remap(C,d),ce.Loci.isEmpty(h)||m.push({loci:h,value:f})}return{kind:"element-loci",layers:m}}else return c}e.filter=i;function s(c,u){let d=[];for(let m=0,p=c.length;m<p;++m){let{script:h,value:f}=c[m],C=To.toLoci(h,u);ce.Loci.isEmpty(C)||d.push({loci:C,value:f})}return{kind:"element-loci",layers:d}}e.ofScript=s;function a(c,u){let d=[];for(let m=0,p=c.length;m<p;++m){let{bundle:h,value:f}=c[m],C=ce.Bundle.toLoci(h,u.root);d.push({loci:C,value:f})}return{kind:"element-loci",layers:d}}e.ofBundle=a;function l(c){let u=[];for(let d=0,m=c.layers.length;d<m;++d){let{loci:p,value:h}=c.layers[d],f=ce.Bundle.fromLoci(p);u.push({bundle:f,value:h})}return{kind:"element-loci",layers:u}}e.toBundle=l})(Us||(Us={}));var Zu;(function(e){function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}}e.create=t;function r(n){n.updateTransform=!1,n.updateMatrix=!1,n.updateColor=!1,n.updateSize=!1,n.createGeometry=!1,n.createNew=!1}e.reset=r})(Zu||(Zu={}));var DUe={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function LU(e,t={}){let r={...DUe,...t},n=e.elementCount*r.elementCountFactor;return(e.isCoarseGrained||e.isCoarse)&&(n*=r.coarseGrainedFactor),n>r.lowestElementCount?"lowest":n>r.lowerElementCount?"lower":n>r.lowElementCount?"low":n>r.mediumElementCount?"medium":n>r.highElementCount?"high":"higher"}function kUe(e){if(e.root.models.length===1){let t=_o.Provider.get(e.root.model);if(t&&t.spacegroup.name==="P 1"&&!Ni.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return xt.volume(e.root.boundary.box)}function aw(e,t){let r=Qi(e.quality,"auto"),n=Qi(e.detail,1),o=Qi(e.radialSegments,12),i=Qi(e.linearSegments,8),s=Qi(e.resolution,2),a=Qi(e.probePositions,12),l=Qi(e.doubleSided,!0),c=0;if(r==="auto"){if(t instanceof qe)r=LU(t.root),c=kUe(t);else if(ot.is(t)){let[u,d,m]=t.grid.cells.space.dimensions;c=u*d*m,r=c<1e7?"medium":"low"}}switch(r){case"highest":n=3,o=36,i=18,s=.1,a=72,l=!0;break;case"higher":n=3,o=28,i=14,s=.3,a=48,l=!0;break;case"high":n=2,o=20,i=10,s=.5,a=36,l=!0;break;case"medium":n=1,o=12,i=8,s=.8,a=24,l=!0;break;case"low":n=0,o=8,i=3,s=1.3,a=24,l=!1;break;case"lower":n=0,o=4,i=2,s=3,a=12,l=!1;break;case"lowest":n=0,o=2,i=1,s=8,a=12,l=!1;break;case"custom":break}return s=Math.max(s,c/5e8),s=Math.min(s,20),e.transparentBackfaces==="off"&&(e.alpha!==void 0&&e.alpha<1||e.xrayShaded)&&(l=!1),{detail:n,radialSegments:o,linearSegments:i,resolution:s,probePositions:a,doubleSided:l}}var YD=D.set,$ce=D.normalize,Wce=D.sub,qce=D.addScalar,QD=D.scale,Zce=D.toArray;function xy(e,t,r,n){let o=!1;if(ot.isLoci(e)){if(!ot.areEquivalent(e.volume,t))return!1;n(Be.ofLength(t.grid.cells.data.length))&&(o=!0)}else if(ot.Isosurface.isLoci(e)){if(!ot.areEquivalent(e.volume,t))return!1;if(r?.isoValue){if(!ot.IsoValue.areSame(e.isoValue,r.isoValue,t.grid.stats))return!1;n(Be.ofLength(t.grid.cells.data.length))&&(o=!0)}else{let{stats:i,cells:{data:s}}=t.grid,a=i.sigma,l=ot.IsoValue.toAbsolute(e.isoValue,i).absoluteValue;for(let c=0,u=s.length;c<u;++c)oo(l,s[c],a)&&n(Be.ofSingleton(c))&&(o=!0)}}else if(ot.Cell.isLoci(e)){if(!ot.areEquivalent(e.volume,t))return!1;Be.is(e.indices)?n(e.indices)&&(o=!0):Ge.forEach(e.indices,i=>{n(Be.ofSingleton(i))&&(o=!0)})}else if(ot.Segment.isLoci(e)){if(!ot.areEquivalent(e.volume,t))return!1;if(r?.segments){if(!Qe.areIntersecting(e.segments,r.segments))return!1;n(Be.ofLength(t.grid.cells.data.length))&&(o=!0)}else{let i=ot.Segmentation.get(t);if(i){let s=new Set;for(let c=0,u=e.segments.length;c<u;++c)$n.add(s,i.segments.get(e.segments[c]));let a=Array.from(s.values()),l=t.grid.cells.data;for(let c=0,u=l.length;c<u;++c)a.includes(l[c])&&n(Be.ofSingleton(c))&&(o=!0)}}}return o}function Dm(e,t=0){let r=e[0]*e[1]*e[2],n=Math.sqrt(r),o=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))),i=e[0]+t,s=e[1]+t,a=1,l=i;return o<i*e[2]?(l=Math.floor(o/i),a=Math.ceil(e[2]/l),i*=l,s*=a):i*=e[2],{width:i,height:s,columns:l,rows:a,powerOfTwoSize:s<o?o:o*2}}function JD(e,t,r=0){let{cells:{space:n,data:o},stats:{max:i,min:s}}=e.grid,a=n.dimensions,{dataOffset:l}=n,{width:c,height:u}=Dm(a,r),d=t==="data"?1:4,m=new Uint8Array(c*u*d),p={array:m,width:c,height:u},h=i-s,[f,C,g]=a,b=f+r,y=C+r,x=D(),A=D(),v=f-1,_=C-1,I=g-1;for(let T=0;T<g;++T)for(let E=0;E<C;++E)for(let w=0;w<f;++w){let S=Math.floor(T*b%c/b),P=Math.floor(T*b/c),k=S*b+w,L=d*(P*y*c+E*c+k),R=l(w,E,T);t==="data"?m[L]=Math.round((o[R]-s)/h*255):(t==="groups"?W0(R,m,L):(YD(x,o[l(Math.max(0,w-1),E,T)],o[l(w,Math.max(0,E-1),T)],o[l(w,E,Math.max(0,T-1))]),YD(A,o[l(Math.min(v,w+1),E,T)],o[l(w,Math.min(_,E+1),T)],o[l(w,E,Math.min(I,T+1))]),$ce(x,Wce(x,x,A)),qce(x,QD(x,x,.5),.5),Zce(QD(x,x,255),m,L)),m[L+3]=Math.round((o[R]-s)/h*255))}return p}function Kce(e){let{cells:{space:t,data:r},stats:{max:n,min:o}}=e.grid,[i,s,a]=t.dimensions,{dataOffset:l}=t,c=new Uint8Array(i*s*a*4),u={array:c,width:i,height:s,depth:a},d=n-o,m=D(),p=D(),h=i-1,f=s-1,C=a-1,g=0;for(let b=0;b<a;++b)for(let y=0;y<s;++y)for(let x=0;x<i;++x){let A=l(x,y,b);YD(m,r[l(Math.max(0,x-1),y,b)],r[l(x,Math.max(0,y-1),b)],r[l(x,y,Math.max(0,b-1))]),YD(p,r[l(Math.min(h,x+1),y,b)],r[l(x,Math.min(f,y+1),b)],r[l(x,y,Math.min(C,b+1))]),$ce(m,Wce(m,m,p)),qce(m,QD(m,m,.5),.5),Zce(QD(m,m,255),c,g),c[g+3]=Math.round((r[A]-o)/d*255),g+=4}return u}function Xce(e,t,r,n=0){let o=e.grid.cells.data,i=xt.size(D(),r),s=e.grid.cells.space.dataOffset,{width:a,height:l}=Dm(i,n),c=1,u=new Uint8Array(a*l*c),d={array:u,width:a,height:l},[m,p,h]=i,f=m-1,C=p-1,g=h-1,b=m+n,y=p+n,[x,A,v]=r.min,[_,I,T]=r.max;for(let E=0;E<h;++E)for(let w=0;w<p;++w)for(let S=0;S<m;++S){let P=Math.floor(E*b%a/b),k=Math.floor(E*b/a),L=P*b+S,R=c*(k*y*a+w*a+L),N=t.includes(o[s(S+x,w+A,E+v)])?255:0,F=t.includes(o[s(Math.min(f+_,S+1+x),w+A,E+v)])?255:0,H=t.includes(o[s(Math.max(0,S-1+x),w+A,E+v)])?255:0,V=t.includes(o[s(S+x,Math.min(C+I,w+1+A),E+v)])?255:0,q=t.includes(o[s(S+x,Math.max(0,w-1+A),E+v)])?255:0,Q=t.includes(o[s(S+x,w+A,Math.min(g+T,E+1+v))])?255:0,O=t.includes(o[s(S+x,w+A,Math.max(0,E-1+v))])?255:0;u[R]=Math.round((N+N+F+H+V+q+Q+O)/8)}return d}function lw(e,t,r,n,o){let{colorType:i,vertexCount:s,groupCount:a,positionBuffer:l,transformBuffer:c,groupBuffer:u,itemSize:d}=e,m=i.endsWith("Instance"),p=xt.fromSphere3D(xt(),m?e.boundingSphere:e.invariantBoundingSphere),h=1+t,f=xt.expand(xt(),p,D.create(h,h,h)),C=1/t,g=xt.scale(xt(),f,C),b=xt.size(D(),g);D.ceil(b,b),D.add(b,b,D.create(2,2,2));let{min:y}=f,[x,A]=b,{width:v,height:_}=Dm(b),I=new Float32Array(v*_*d),T=new Float32Array(v*_),E=new Uint8Array(v*_*d),w={array:E,width:v,height:_,filter:"linear"},S=m?e.instanceCount:1,P=e.colorData.array;function k(O,B,j){let U=Math.floor(j*x%v/x),z=Math.floor(j*x/v),$=U*x+O;return d*(z*A*v+B*v+$)}let L=2,[R,N,F]=b,H=D();for(let O=0;O<S;++O)for(let B=0;B<s;B+=r){D.fromArray(H,l,B*3),m&&D.transformMat4Offset(H,H,c,0,0,O*16),D.sub(H,H,y),D.scale(H,H,C);let[j,U,z]=H,$=Math.floor(j),Z=Math.floor(U),J=Math.floor(z),ie=(O*a+u[B])*d,ne=Math.max(0,$-L),le=Math.max(0,Z-L),ee=Math.max(0,J-L),oe=Math.min(R,$+L+2),te=Math.min(N,Z+L+2),X=Math.min(F,J+L+2);for(let W=ne;W<oe;++W){let K=W-j;for(let re=le;re<te;++re){let se=re-U;for(let me=ee;me<X;++me){let Y=me-z,ae=Math.sqrt(K*K+se*se+Y*Y);if(ae>L)continue;let ve=L-ae,ge=k(W,re,me);for(let Se=0;Se<d;++Se)I[ge+Se]+=P[ie+Se]*ve;T[ge/d]+=ve}}}}for(let O=0,B=T.length;O<B;++O){let j=O*d,U=T[O];for(let z=0;z<d;++z)E[j+z]=Math.round(I[j+z]/U)}let V=Ve.create(v,_),q=Ht.create(y[0],y[1],y[2],C),Q=m?"volumeInstance":"volume";if(n){if(!o){let O=d===4?"rgba":d===3?"rgb":"alpha";o=n.resources.texture("image-uint8",O,"ubyte","linear")}return o.load(w),{kind:"volume",texture:o,gridTexDim:V,gridDim:b,gridTransform:q,type:Q}}else{let O=MUe({vertexCount:s,instanceCount:S,transformBuffer:c,positionBuffer:l,colorType:Q,grid:E,gridDim:b,gridTexDim:V,gridTransform:q,vertexStride:3,colorStride:d,outputStride:d});return{kind:"vertex",texture:O,texDim:Ve.create(O.width,O.height),type:m?"vertexInstance":"vertex"}}}function MUe(e){let{vertexCount:t,positionBuffer:r,transformBuffer:n,grid:o,gridDim:i,gridTexDim:s,gridTransform:a,vertexStride:l,colorStride:c}=e,u=e.itemOffset||0,d=e.outputStride;if(d+u>c)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");let m=e.colorType.endsWith("Instance"),p=m?e.instanceCount:1,h=mo(Math.max(1,p*t),d,Uint8Array),{array:f}=h,[C,g]=i,b=s[0],y=D.fromArray(D(),a,0),x=a[3];function A(E,w,S){let P=Math.floor(S*C%b/C),k=Math.floor(S*C/b),L=P*C+E;return c*(k*g*b+w*b+L)}let v=D(),_=D(),I=D(),T=D();for(let E=0;E<p;++E)for(let w=0;w<t;++w){D.fromArray(v,r,w*l),m&&D.transformMat4Offset(v,v,n,0,0,E*16),D.sub(v,v,y),D.scale(v,v,x),D.floor(_,v),D.ceil(I,v),D.sub(T,v,_),D.sub(v,I,_),D.div(T,T,v);let[S,P,k]=_,[L,R,N]=I,[F,H,V]=T,q=A(S,P,k)+u,Q=A(L,P,k)+u,O=A(S,P,N)+u,B=A(L,P,N)+u,j=A(S,R,k)+u,U=A(L,R,k)+u,z=A(S,R,N)+u,$=A(L,R,N)+u,Z=(E*t+w)*d;for(let J=0;J<d;++J){let ie=o[q+J],ne=o[Q+J],le=o[O+J],ee=o[B+J],oe=o[j+J],te=o[U+J],X=o[z+J],W=o[$+J],K=zn(ie,ne,F),re=zn(le,ee,F),se=zn(oe,te,F),me=zn(X,W,F),Y=zn(K,se,H),ae=zn(re,me,H);f[Z+J]=zn(Y,ae,V)}}return h}function RUe(e){return e==="group"||e==="groupInstance"}function jC(e,t,r,n,o){if(!RUe(e.dColorType.ref.value))return;let i=lw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,r,n,o);i.kind==="volume"?(G.updateIfChanged(e.dColorType,i.type),G.update(e.tColorGrid,i.texture),G.update(e.uColorTexDim,i.gridTexDim),G.update(e.uColorGridDim,i.gridDim),G.update(e.uColorGridTransform,i.gridTransform)):i.kind==="vertex"&&(G.updateIfChanged(e.dColorType,i.type),G.update(e.tColor,i.texture),G.update(e.uColorTexDim,i.texDim))}function BUe(e){return e==="groupInstance"}function Yce(e,t,r,n,o){if(!BUe(e.dOverpaintType.ref.value))return;let i=lw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,o);i.kind==="volume"?(G.updateIfChanged(e.dOverpaintType,i.type),G.update(e.tOverpaintGrid,i.texture),G.update(e.uOverpaintTexDim,i.gridTexDim),G.update(e.uOverpaintGridDim,i.gridDim),G.update(e.uOverpaintGridTransform,i.gridTransform)):i.kind==="vertex"&&(G.updateIfChanged(e.dOverpaintType,i.type),G.update(e.tOverpaint,i.texture),G.update(e.uOverpaintTexDim,i.texDim))}function LUe(e){return e==="groupInstance"}function Qce(e,t,r,n,o){if(!LUe(e.dTransparencyType.ref.value))return;let i=lw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,o);i.kind==="volume"?(G.updateIfChanged(e.dTransparencyType,i.type),G.update(e.tTransparencyGrid,i.texture),G.update(e.uTransparencyTexDim,i.gridTexDim),G.update(e.uTransparencyGridDim,i.gridDim),G.update(e.uTransparencyGridTransform,i.gridTransform)):i.kind==="vertex"&&(G.updateIfChanged(e.dTransparencyType,i.type),G.update(e.tTransparency,i.texture),G.update(e.uTransparencyTexDim,i.texDim))}function NUe(e){return e==="groupInstance"}function Jce(e,t,r,n,o){if(!NUe(e.dEmissiveType.ref.value))return;let i=lw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tEmissive.ref.value,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,r,n,o);i.kind==="volume"?(G.updateIfChanged(e.dEmissiveType,i.type),G.update(e.tEmissiveGrid,i.texture),G.update(e.uEmissiveTexDim,i.gridTexDim),G.update(e.uEmissiveGridDim,i.gridDim),G.update(e.uEmissiveGridTransform,i.gridTransform)):i.kind==="vertex"&&(G.updateIfChanged(e.dEmissiveType,i.type),G.update(e.tEmissive,i.texture),G.update(e.uEmissiveTexDim,i.texDim))}function FUe(e){return e==="groupInstance"}function eue(e,t,r,n,o){if(!FUe(e.dSubstanceType.ref.value))return;let i=lw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,r,n,o);i.kind==="volume"?(G.updateIfChanged(e.dSubstanceType,i.type),G.update(e.tSubstanceGrid,i.texture),G.update(e.uSubstanceTexDim,i.gridTexDim),G.update(e.uSubstanceGridDim,i.gridDim),G.update(e.uSubstanceGridTransform,i.gridTransform)):i.kind==="vertex"&&(G.updateIfChanged(e.dSubstanceType,i.type),G.update(e.tSubstance,i.texture),G.update(e.uSubstanceTexDim,i.texDim))}var tue=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tCount;
uniform vec2 uTexSize;

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);
    float count = texture2D(tCount, coords).r;

    gl_FragColor = color / count;
}
`;var rue=`
precision highp float;

varying vec3 vPosition;
varying vec4 vColor;

uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uResolution;

const float p = 2.0;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition);
    if (dist > p) discard;

    float f = p - dist;
    gl_FragColor = vColor * f;
    gl_FragData[1] = vec4(f);
}
`;var nue=`
precision highp float;

#include common
#include read_from_texture

uniform int uGroupCount;

attribute float aSample;
#define SampleID int(aSample)

attribute mat4 aTransform;
attribute float aInstance;

uniform vec2 uGeoTexDim;
uniform sampler2D tPosition;
uniform sampler2D tGroup;

uniform vec2 uColorTexDim;
uniform sampler2D tColor;

varying vec3 vPosition;
varying vec4 vColor;

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;
    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);

    position = (aTransform * vec4(position, 1.0)).xyz;
    gl_PointSize = 7.0;
    vPosition = (position - uBboxMin) / uResolution;
    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);

    #if defined(dColorType_group)
        vColor = readFromTexture(tColor, group, uColorTexDim);
    #elif defined(dColorType_groupInstance)
        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);
    #endif
}
`;var OUe={drawCount:jn("number"),instanceCount:jn("number"),stride:jn("number"),uGroupCount:Re("i","material"),aTransform:cn("float32",16,1),aInstance:cn("float32",1,1),aSample:cn("float32",1,0),uGeoTexDim:Re("v2","material"),tPosition:kt("texture","rgba","float","nearest","material"),tGroup:kt("texture","rgba","float","nearest","material"),uColorTexDim:Re("v2","material"),tColor:kt("texture","rgba","ubyte","nearest","material"),dColorType:Bt("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Re("f"),uCurrentX:Re("f"),uCurrentY:Re("f"),uBboxMin:Re("v3","material"),uBboxSize:Re("v3","material"),uResolution:Re("f","material")},Md="color-accumulate",cw="color-count";function oue(e,t){let r=new Float32Array(e);for(let n=0;n<e;++n)r[n]=n*t;return r}function VUe(e,t,r,n,o){if(e.namedComputeRenderables[Md]){let i=D.sub(D(),r.max,r.min),s=e.namedComputeRenderables[Md].values,a=Math.round(t.vertexCount/o);(a>s.drawCount.ref.value||o!==s.stride.ref.value)&&G.update(s.aSample,oue(a,o)),G.updateIfChanged(s.drawCount,a),G.updateIfChanged(s.instanceCount,t.instanceCount),G.updateIfChanged(s.stride,o),G.updateIfChanged(s.uGroupCount,t.groupCount),G.update(s.aTransform,t.transformBuffer),G.update(s.aInstance,t.instanceBuffer),G.update(s.uGeoTexDim,Ve.set(s.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),G.update(s.tPosition,t.positionTexture),G.update(s.tGroup,t.groupTexture),G.update(s.uColorTexDim,Ve.set(s.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),G.update(s.tColor,t.colorData),G.updateIfChanged(s.dColorType,t.colorType),G.updateIfChanged(s.uCurrentSlice,0),G.updateIfChanged(s.uCurrentX,0),G.updateIfChanged(s.uCurrentY,0),G.update(s.uBboxMin,r.min),G.update(s.uBboxSize,i),G.updateIfChanged(s.uResolution,n),e.namedComputeRenderables[Md].update()}else e.namedComputeRenderables[Md]=GUe(e,t,r,n,o);return e.namedComputeRenderables[Md]}function GUe(e,t,r,n,o){let i=D.sub(D(),r.max,r.min),s=Math.round(t.vertexCount/o),a={drawCount:G.create(s),instanceCount:G.create(t.instanceCount),stride:G.create(o),uGroupCount:G.create(t.groupCount),aTransform:G.create(t.transformBuffer),aInstance:G.create(t.instanceBuffer),aSample:G.create(oue(s,o)),uGeoTexDim:G.create(Ve.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:G.create(t.positionTexture),tGroup:G.create(t.groupTexture),uColorTexDim:G.create(Ve.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:G.create(t.colorData),dColorType:G.create(t.colorType),uCurrentSlice:G.create(0),uCurrentX:G.create(0),uCurrentY:G.create(0),uBboxMin:G.create(r.min),uBboxSize:G.create(i),uResolution:G.create(n)},l={...OUe},c=Gr("accumulate",nue,rue,{drawBuffers:"required"}),u=on(e,"points",c,l,a);return sn(u,a)}function UUe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}var zUe={...Rn,tColor:kt("texture","rgba","float","nearest"),tCount:kt("texture","alpha","float","nearest"),uTexSize:Re("v2")},uw="color-normalize";function HUe(e,t,r){if(e.namedComputeRenderables[uw]){let n=e.namedComputeRenderables[uw].values;G.update(n.tColor,t),G.update(n.tCount,r),G.update(n.uTexSize,Ve.set(n.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[uw].update()}else e.namedComputeRenderables[uw]=jUe(e,t,r);return e.namedComputeRenderables[uw]}function jUe(e,t,r){let n={...Bn,tColor:G.create(t),tCount:G.create(r),uTexSize:G.create(Ve.create(t.getWidth(),t.getHeight()))},o={...zUe},i=Gr("normalize",Kn,tue),s=on(e,"triangles",i,o,n);return sn(s,n)}function $Ue(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0),r.blendFunc(t.ONE,t.ONE),r.blendEquation(t.FUNC_ADD)}function WUe(e){let t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),o=0,i=e[1],s=1,a=e[2];return n<e[0]*e[2]?(a=Math.floor(n/e[0]),s=Math.ceil(e[2]/a),o=a*e[0],i*=s):o=e[0]*e[2],{texDimX:o,texDimY:i,texRows:s,texCols:a,powerOfTwoSize:i<n?n:n*2}}function dw(e,t,r,n,o){let{drawBuffers:i}=n.extensions;if(!i)throw new Error("need WebGL draw buffers");bt&&n.timer.mark("calcTextureMeshColorSmoothing");let{gl:s,resources:a,state:l,extensions:{colorBufferHalfFloat:c,textureHalfFloat:u}}=n,d=e.colorType.endsWith("Instance"),m=xt.fromSphere3D(xt(),d?e.boundingSphere:e.invariantBoundingSphere),p=1+t,h=xt.expand(xt(),m,D.create(p,p,p)),f=1/t,C=xt.scale(xt(),h,f),g=xt.size(D(),C);D.ceil(g,g),D.add(g,g,D.create(2,2,2));let{min:b}=h,[y,x,A]=g,{texDimX:v,texDimY:_,texCols:I}=WUe(g);n.namedFramebuffers[Md]||(n.namedFramebuffers[Md]=n.resources.framebuffer());let T=n.namedFramebuffers[Md];er(s)?(n.namedTextures[Md]||(n.namedTextures[Md]=c&&u?a.texture("image-float16","rgba","fp16","nearest"):a.texture("image-float32","rgba","float","nearest")),n.namedTextures[cw]||(n.namedTextures[cw]=a.texture("image-float32","alpha","float","nearest"))):(n.namedTextures[Md]||(n.namedTextures[Md]=a.texture("image-float32","rgba","float","nearest")),n.namedTextures[cw]||(n.namedTextures[cw]=a.texture("image-float32","rgba","float","nearest")));let E=n.namedTextures[Md],w=n.namedTextures[cw];E.define(v,_),w.define(v,_),E.attachFramebuffer(T,0),w.attachFramebuffer(T,1);let S=VUe(n,e,h,t,r);l.currentRenderItemId=-1,T.bind(),i.drawBuffers([i.COLOR_ATTACHMENT0,i.COLOR_ATTACHMENT1]);let{uCurrentSlice:P,uCurrentX:k,uCurrentY:L}=S.values;bt&&n.timer.mark("ColorAccumulate.render"),UUe(n),l.viewport(0,0,v,_),l.scissor(0,0,v,_),s.clear(s.COLOR_BUFFER_BIT),G.update(L,0);let R=0,N=0,F=0;for(let Q=0;Q<A;++Q)R>=I&&(R-=I,N+=x,F=0,G.update(L,N)),G.update(k,F),G.update(P,Q),l.viewport(F,N,y,x),l.scissor(F,N,y,x),S.render(),++R,F+=y;E.detachFramebuffer(T,0),w.detachFramebuffer(T,1),i.drawBuffers([s.COLOR_ATTACHMENT0,s.NONE]),bt&&n.timer.markEnd("ColorAccumulate.render"),bt&&n.timer.mark("ColorNormalize.render"),(!o||gte(o))&&(o=a.texture("image-uint8","rgba","ubyte","linear")),o.define(v,_);let H=HUe(n,E,w);l.currentRenderItemId=-1,$Ue(n),o.attachFramebuffer(T,0),l.viewport(0,0,v,_),l.scissor(0,0,v,_),s.clear(s.COLOR_BUFFER_BIT),H.render(),bt&&n.timer.markEnd("ColorNormalize.render");let V=Ht.create(b[0],b[1],b[2],f),q=d?"volumeInstance":"volume";return bt&&n.timer.markEnd("calcTextureMeshColorSmoothing"),{texture:o,gridDim:g,gridTexDim:Ve.create(v,_),gridTransform:V,type:q}}var NU="color-smoothing-rgb",$C="color-smoothing-rgba",WC="color-smoothing-alpha";function qUe(e){return e==="group"||e==="groupInstance"}function FU(e,t,r,n,o){if(!qUe(e.dColorType.ref.value))return;r*=3,n.namedTextures[NU]||(n.namedTextures[NU]=n.resources.texture("image-uint8","rgb","ubyte","nearest"));let i=n.namedTextures[NU];i.load(e.tColor.ref.value);let s=dw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);G.updateIfChanged(e.dColorType,s.type),G.update(e.tColorGrid,s.texture),G.update(e.uColorTexDim,s.gridTexDim),G.update(e.uColorGridDim,s.gridDim),G.update(e.uColorGridTransform,s.gridTransform)}function ZUe(e){return e==="groupInstance"}function iue(e,t,r,n,o){if(!ZUe(e.dOverpaintType.ref.value))return;r*=3,n.namedTextures[$C]||(n.namedTextures[$C]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));let i=n.namedTextures[$C];i.load(e.tOverpaint.ref.value);let s=dw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);G.updateIfChanged(e.dOverpaintType,s.type),G.update(e.tOverpaintGrid,s.texture),G.update(e.uOverpaintTexDim,s.gridTexDim),G.update(e.uOverpaintGridDim,s.gridDim),G.update(e.uOverpaintGridTransform,s.gridTransform)}function KUe(e){return e==="groupInstance"}function sue(e,t,r,n,o){if(!KUe(e.dTransparencyType.ref.value))return;r*=3,n.namedTextures[WC]||(n.namedTextures[WC]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));let i=n.namedTextures[WC];i.load(e.tTransparency.ref.value);let s=dw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);G.updateIfChanged(e.dTransparencyType,s.type),G.update(e.tTransparencyGrid,s.texture),G.update(e.uTransparencyTexDim,s.gridTexDim),G.update(e.uTransparencyGridDim,s.gridDim),G.update(e.uTransparencyGridTransform,s.gridTransform)}function XUe(e){return e==="groupInstance"}function aue(e,t,r,n,o){if(!XUe(e.dEmissiveType.ref.value))return;r*=3,n.namedTextures[WC]||(n.namedTextures[WC]=n.resources.texture("image-uint8","alpha","ubyte","nearest"));let i=n.namedTextures[WC];i.load(e.tEmissive.ref.value);let s=dw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);G.updateIfChanged(e.dEmissiveType,s.type),G.update(e.tEmissiveGrid,s.texture),G.update(e.uEmissiveTexDim,s.gridTexDim),G.update(e.uEmissiveGridDim,s.gridDim),G.update(e.uEmissiveGridTransform,s.gridTransform)}function YUe(e){return e==="groupInstance"}function lue(e,t,r,n,o){if(!YUe(e.dSubstanceType.ref.value))return;r*=3,n.namedTextures[$C]||(n.namedTextures[$C]=n.resources.texture("image-uint8","rgba","ubyte","nearest"));let i=n.namedTextures[$C];i.load(e.tSubstance.ref.value);let s=dw({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:i,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,r,n,o);G.updateIfChanged(e.dSubstanceType,s.type),G.update(e.tSubstanceGrid,s.texture),G.update(e.uSubstanceTexDim,s.gridTexDim),G.update(e.uSubstanceGridDim,s.gridDim),G.update(e.uSubstanceGridTransform,s.gridTransform)}var Er;(function(e){function t(p,h){p&&(p.state.visible=h)}e.setVisibility=t;function r(p,h){p&&(p.state.alphaFactor=h)}e.setAlphaFactor=r;function n(p,h){p&&(p.state.pickable=h)}e.setPickable=n;function o(p,h){p&&(p.state.colorOnly=h)}e.setColorOnly=o;function i(p,h,f,C,g){if(!p||wi(h))return!1;let{tMarker:b,uMarker:y,markerAverage:x,markerStatus:A,uGroupCount:v,instanceCount:_,instanceGranularity:I}=p.values,T=I.ref.value?_.ref.value:v.ref.value*_.ref.value,{array:E}=b.ref.value,w=A.ref.value;if(!cs(h)){let L=0;if(C(h,R=>(L+=Be.size(R),!0),!0),L===0)return!1;L===T&&(h=vy)}let S=!1,P=-1,k=-1;if(cs(h)){let L=Hce(f,w);L.status!==-1?(S=w!==L.status,S&&zce(E,L.status,T)):S=Rl(E,Be.ofLength(T),f),P=L.average,k=L.status}else S=C(h,L=>Rl(E,L,f),!0),S&&(P=jce(f,w),g&&g.status!==-1&&P===-1&&si.isReverse(g.action,f)&&Xt.areEqual(h,g.loci)&&(k=g.status,P=k===0?0:.5));return S&&(P===-1&&(P=B5(E,T),P===0&&(k=0)),g&&(g.action=f,g.loci=h,g.status=w),G.updateIfChanged(y,k),k===-1&&G.update(b,b.ref.value),G.updateIfChanged(x,P),G.updateIfChanged(A,k)),S}e.mark=i;function s(p,h,f,C,g){if(!p)return;let{tOverpaint:b,dOverpaintType:y,dOverpaint:x,uGroupCount:A,instanceCount:v,instanceGranularity:_}=p.values,I=_.ref.value?v.ref.value:A.ref.value*v.ref.value,T=_.ref.value?"instance":"groupInstance";Ete(h.layers.length?I:0,T,p.values);let{array:E}=b.ref.value;C&&W5(E,0,I);for(let w=0,S=h.layers.length;w<S;++w){let{loci:P,color:k,clear:L}=h.layers[w];f(P,N=>{let F=Be.start(N),H=Be.end(N);return L?W5(E,F,H):Tte(E,F,H,k)},!1)}if(G.update(b,b.ref.value),G.updateIfChanged(y,T),G.updateIfChanged(x,h.layers.length>0),h.layers.length!==0&&T!=="instance"&&g&&Fu(g.props)){let{geometry:w,props:S,webgl:P}=g;if(w.kind==="mesh"){let{resolution:k,overpaintTexture:L}=w.meta,R=rc(S.smoothColors,!0,k);R&&(Yce(p.values,R.resolution,R.stride,P,L),w.meta.overpaintTexture=p.values.tOverpaintGrid.ref.value)}else if(P&&w.kind==="texture-mesh"){let{resolution:k,overpaintTexture:L}=w.meta,R=rc(S.smoothColors,!0,k);R&&(iue(p.values,R.resolution,R.stride,P,L),w.meta.overpaintTexture=p.values.tOverpaintGrid.ref.value)}}}e.setOverpaint=s;function a(p,h,f,C,g){if(!p)return;let{tTransparency:b,dTransparencyType:y,transparencyAverage:x,dTransparency:A,uGroupCount:v,instanceCount:_,instanceGranularity:I}=p.values,T=I.ref.value?_.ref.value:v.ref.value*_.ref.value,E=I.ref.value?"instance":"groupInstance";Mte(h.layers.length?T:0,E,p.values);let{array:w}=b.ref.value;C&&kte(w,0,T);for(let S=0,P=h.layers.length;S<P;++S){let{loci:k,value:L}=h.layers[S];f(k,N=>{let F=Be.start(N),H=Be.end(N);return Dte(w,F,H,L)},!1)}if(G.update(b,b.ref.value),G.updateIfChanged(x,q5(w,T)),G.updateIfChanged(y,E),G.updateIfChanged(A,h.layers.length>0),h.layers.length!==0&&E!=="instance"&&g&&Fu(g.props)){let{geometry:S,props:P,webgl:k}=g;if(S.kind==="mesh"){let{resolution:L,transparencyTexture:R}=S.meta,N=rc(P.smoothColors,!0,L);N&&(Qce(p.values,N.resolution,N.stride,k,R),S.meta.transparencyTexture=p.values.tTransparencyGrid.ref.value)}else if(k&&S.kind==="texture-mesh"){let{resolution:L,transparencyTexture:R}=S.meta,N=rc(P.smoothColors,!0,L);N&&(sue(p.values,N.resolution,N.stride,k,R),S.meta.transparencyTexture=p.values.tTransparencyGrid.ref.value)}}}e.setTransparency=a;function l(p,h,f,C,g){if(!p)return;let{tEmissive:b,dEmissiveType:y,emissiveAverage:x,dEmissive:A,uGroupCount:v,instanceCount:_,instanceGranularity:I}=p.values,T=I.ref.value?_.ref.value:v.ref.value*_.ref.value,E=I.ref.value?"instance":"groupInstance";Hte(h.layers.length?T:0,E,p.values);let{array:w}=b.ref.value;C&&zte(w,0,T);for(let S=0,P=h.layers.length;S<P;++S){let{loci:k,value:L}=h.layers[S];f(k,N=>{let F=Be.start(N),H=Be.end(N);return Ute(w,F,H,L)},!1)}if(G.update(b,b.ref.value),G.updateIfChanged(x,K5(w,T)),G.updateIfChanged(y,E),G.updateIfChanged(A,h.layers.length>0),h.layers.length!==0&&E!=="instance"&&g&&Fu(g.props)){let{geometry:S,props:P,webgl:k}=g;if(S.kind==="mesh"){let{resolution:L,emissiveTexture:R}=S.meta,N=rc(P.smoothColors,!0,L);N&&(Jce(p.values,N.resolution,N.stride,k,R),S.meta.emissiveTexture=p.values.tEmissiveGrid.ref.value)}else if(k&&S.kind==="texture-mesh"){let{resolution:L,emissiveTexture:R}=S.meta,N=rc(P.smoothColors,!0,L);N&&(aue(p.values,N.resolution,N.stride,k,R),S.meta.emissiveTexture=p.values.tEmissiveGrid.ref.value)}}}e.setEmissive=l;function c(p,h,f,C,g){if(!p)return;let{tSubstance:b,dSubstanceType:y,dSubstance:x,uGroupCount:A,instanceCount:v,instanceGranularity:_}=p.values,I=_.ref.value?v.ref.value:A.ref.value*v.ref.value,T=_.ref.value?"instance":"groupInstance";Vte(h.layers.length?I:0,T,p.values);let{array:E}=b.ref.value;C&&Z5(E,0,I);for(let w=0,S=h.layers.length;w<S;++w){let{loci:P,material:k,clear:L}=h.layers[w];f(P,N=>{let F=Be.start(N),H=Be.end(N);return L?Z5(E,F,H):Ote(E,F,H,k)},!1)}if(G.update(b,b.ref.value),G.updateIfChanged(y,T),G.updateIfChanged(x,h.layers.length>0),h.layers.length!==0&&T!=="instance"&&g&&Fu(g.props)){let{geometry:w,props:S,webgl:P}=g;if(w.kind==="mesh"){let{resolution:k,substanceTexture:L}=w.meta,R=rc(S.smoothColors,!0,k);R&&(eue(p.values,R.resolution,R.stride,P,L),w.meta.substanceTexture=p.values.tSubstanceGrid.ref.value)}else if(P&&w.kind==="texture-mesh"){let{resolution:k,substanceTexture:L}=w.meta,R=rc(S.smoothColors,!0,k);R&&(lue(p.values,R.resolution,R.stride,P,L),w.meta.substanceTexture=p.values.tSubstanceGrid.ref.value)}}}e.setSubstance=c;function u(p,h,f,C){if(!p)return;let{tClipping:g,dClippingType:b,dClipping:y,uGroupCount:x,instanceCount:A,instanceGranularity:v}=p.values,_=v.ref.value?A.ref.value:x.ref.value*A.ref.value,{layers:I}=h,T=v.ref.value?"instance":"groupInstance";Nte(I.length?_:0,T,p.values);let{array:E}=g.ref.value;C&&Lte(E,0,_);for(let w=0,S=h.layers.length;w<S;++w){let{loci:P,groups:k}=h.layers[w];f(P,R=>{let N=Be.start(R),F=Be.end(R);return Bte(E,N,F,k)},!1)}G.update(g,g.ref.value),G.updateIfChanged(b,T),G.updateIfChanged(y,h.layers.length>0)}e.setClipping=u;function d(p,h){p&&(G.updateIfChanged(p.values.uOverpaintStrength,h.overpaint),G.updateIfChanged(p.values.uTransparencyStrength,h.transparency),G.updateIfChanged(p.values.uEmissiveStrength,h.emissive),G.updateIfChanged(p.values.uSubstanceStrength,h.substance))}e.setThemeStrength=d;function m(p,h,f){if(!p||!h&&!f)return;let{values:C}=p;h&&(de.copy(C.matrix.ref.value,h),G.update(C.matrix,C.matrix.ref.value)),f?(C.extraTransform.ref.value.set(f),G.update(C.extraTransform,C.extraTransform.ref.value)):f===null&&(sC(C.extraTransform.ref.value,C.instanceCount.ref.value),G.update(C.extraTransform,C.extraTransform.ref.value)),$5(C,C.invariantBoundingSphere.ref.value,C.instanceGrid.ref.value.cellSize,C.instanceGrid.ref.value.batchSize);let g=xi(C.invariantBoundingSphere.ref.value,C.transform.ref.value,C.instanceCount.ref.value,0);G.update(C.boundingSphere,g)}e.setTransform=m})(Er||(Er={}));function io(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};let t;(function(u){u.is=zi.has;let d;(function(g){g[g.None=0]="None",g[g.One=1]="One",g[g.Two=2]="Two",g[g.Three=4]="Three",g[g.Four=8]="Four",g[g.Five=16]="Five",g[g.Six=32]="Six"})(d=u.Flag||(u.Flag={}));function m(g){return zi.create(g)}u.create=m,u.Names={one:d.One,two:d.Two,three:d.Three,four:d.Four,five:d.Five,six:d.Six};function p(g){return g in u.Names}u.isName=p;function h(g){switch(g){case"one":return d.One;case"two":return d.Two;case"three":return d.Three;case"four":return d.Four;case"five":return d.Five;case"six":return d.Six}}u.fromName=h;function f(g){let b=d.None;for(let y=0,x=g.length;y<x;++y)b|=h(g[y]);return b}u.fromNames=f;function C(g){let b=[];return u.is(g,d.One)&&b.push("one"),u.is(g,d.Two)&&b.push("two"),u.is(g,d.Three)&&b.push("three"),u.is(g,d.Four)&&b.push("four"),u.is(g,d.Five)&&b.push("five"),u.is(g,d.Six)&&b.push("six"),b}u.toNames=C})(t=e.Groups||(e.Groups={}));function r(u,d){if(u.layers.length!==d.layers.length)return!1;for(let m=0,p=u.layers.length;m<p;++m)if(u.layers[m].groups!==d.layers[m].groups||!Xt.areEqual(u.layers[m].loci,d.layers[m].loci))return!1;return!0}e.areEqual=r;function n(u){return u.layers.length===0}e.isEmpty=n;function o(u,d){if(u.kind==="element-loci"){let m=[];for(let p of u.layers){let{loci:h,groups:f}=p;h=ce.Loci.remap(h,d),ce.Loci.isEmpty(h)||m.push({loci:h,groups:f})}return{kind:"element-loci",layers:m}}else return u}e.remap=o;function i(u){if(n(u))return u;if(u.kind==="element-loci"){let{structure:d}=u.layers[0].loci,m=new Map,p=ce.Loci.none(d);for(let f=0,C=u.layers.length;f<C;++f){let{loci:g,groups:b}=u.layers[C-f-1];g=ce.Loci.subtract(g,p),p=ce.Loci.union(g,p),ce.Loci.isEmpty(g)||(m.has(b)&&(g=ce.Loci.union(g,m.get(b))),m.set(b,g))}let h=[];return m.forEach((f,C)=>{h.push({loci:f,groups:C})}),{kind:"element-loci",layers:h}}else return u}e.merge=i;function s(u,d){if(n(u))return u;if(u.kind==="element-loci"){let{structure:m}=u.layers[0].loci,p=[];for(let h of u.layers){let{loci:f,groups:C}=h,g=ce.Loci.remap(f,d);f=ce.Loci.remap(g,m),ce.Loci.isEmpty(f)||p.push({loci:f,groups:C})}return{kind:"element-loci",layers:p}}else return u}e.filter=s;function a(u,d){let m=[];for(let p=0,h=u.length;p<h;++p){let{script:f,groups:C}=u[p],g=To.toLoci(f,d);ce.Loci.isEmpty(g)||m.push({loci:g,groups:C})}return{kind:"element-loci",layers:m}}e.ofScript=a;function l(u,d){let m=[];for(let p=0,h=u.length;p<h;++p){let{bundle:f,groups:C}=u[p],g=ce.Bundle.toLoci(f,d.root);m.push({loci:g,groups:C})}return{kind:"element-loci",layers:m}}e.ofBundle=l;function c(u){let d=[];for(let m=0,p=u.layers.length;m<p;++m){let{loci:h,groups:f}=u.layers[m],C=ce.Bundle.fromLoci(h);d.push({bundle:C,groups:f})}return{kind:"element-loci",layers:d}}e.toBundle=c})(io||(io={}));function zs(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(c,u){if(c.layers.length===0&&u.layers.length===0)return!0;if(c.layers.length!==u.layers.length)return!1;for(let d=0,m=c.layers.length;d<m;++d)if(c.layers[d].clear!==u.layers[d].clear||!A0(c.layers[d].material,u.layers[d].material)||!Xt.areEqual(c.layers[d].loci,u.layers[d].loci))return!1;return!0}e.areEqual=t;function r(c){return c.layers.length===0}e.isEmpty=r;function n(c,u){if(c.kind==="element-loci"){let d=[];for(let m of c.layers){let{loci:p,material:h,clear:f}=m;p=ce.Loci.remap(p,u),ce.Loci.isEmpty(p)||d.push({loci:p,material:h,clear:f})}return{kind:"element-loci",layers:d}}else return c}e.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:u}=c.layers[0].loci,d,m=new Map,p=ce.Loci.none(u);for(let f=0,C=c.layers.length;f<C;++f){let{loci:g,material:b,clear:y}=c.layers[C-f-1];g=ce.Loci.subtract(g,p),p=ce.Loci.union(g,p),ce.Loci.isEmpty(g)||(y?d=d?ce.Loci.union(g,d):g:(m.has(b)&&(g=ce.Loci.union(g,m.get(b))),m.set(b,g)))}let h=[];return d&&h.push({loci:d,material:Bs(),clear:!0}),m.forEach((f,C)=>{h.push({loci:f,material:C,clear:!1})}),{kind:"element-loci",layers:h}}else return c}e.merge=o;function i(c,u){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,m=[];for(let p of c.layers){let{loci:h,material:f,clear:C}=p,g=ce.Loci.remap(h,u);h=ce.Loci.remap(g,d),ce.Loci.isEmpty(h)||m.push({loci:h,material:f,clear:C})}return{kind:"element-loci",layers:m}}else return c}e.filter=i;function s(c,u){let d=[];for(let m=0,p=c.length;m<p;++m){let{script:h,material:f,clear:C}=c[m],g=To.toLoci(h,u);ce.Loci.isEmpty(g)||d.push({loci:g,material:f,clear:C})}return{kind:"element-loci",layers:d}}e.ofScript=s;function a(c,u){let d=[];for(let m=0,p=c.length;m<p;++m){let{bundle:h,material:f,clear:C}=c[m],g=ce.Bundle.toLoci(h,u.root);d.push({loci:g,material:f,clear:C})}return{kind:"element-loci",layers:d}}e.ofBundle=a;function l(c){let u=[];for(let d=0,m=c.layers.length;d<m;++d){let{loci:p,material:h,clear:f}=c.layers[d],C=ce.Bundle.fromLoci(p);u.push({bundle:C,material:h,clear:f})}return{kind:"element-loci",layers:u}}e.toBundle=l})(zs||(zs={}));function Hs(e,t){return{kind:e,layers:t}}(function(e){e.Empty={kind:"empty-loci",layers:[]};function t(c,u){if(c.layers.length===0&&u.layers.length===0)return!0;if(c.layers.length!==u.layers.length)return!1;for(let d=0,m=c.layers.length;d<m;++d)if(c.layers[d].value!==u.layers[d].value||!Xt.areEqual(c.layers[d].loci,u.layers[d].loci))return!1;return!0}e.areEqual=t;function r(c){return c.layers.length===0}e.isEmpty=r;function n(c,u){if(c.kind==="element-loci"){let d=[];for(let m of c.layers){let{loci:p,value:h}=m;p=ce.Loci.remap(p,u),ce.Loci.isEmpty(p)||d.push({loci:p,value:h})}return{kind:"element-loci",layers:d}}else return c}e.remap=n;function o(c){if(r(c))return c;if(c.kind==="element-loci"){let{structure:u}=c.layers[0].loci,d=new Map,m=ce.Loci.none(u);for(let h=0,f=c.layers.length;h<f;++h){let{loci:C,value:g}=c.layers[f-h-1];C=ce.Loci.subtract(C,m),m=ce.Loci.union(C,m),ce.Loci.isEmpty(C)||(d.has(g)&&(C=ce.Loci.union(C,d.get(g))),d.set(g,C))}let p=[];return d.forEach((h,f)=>{p.push({loci:h,value:f})}),{kind:"element-loci",layers:p}}else return c}e.merge=o;function i(c,u){if(r(c))return c;if(c.kind==="element-loci"){let{structure:d}=c.layers[0].loci,m=[];for(let p of c.layers){let{loci:h,value:f}=p,C=ce.Loci.remap(h,u);h=ce.Loci.remap(C,d),ce.Loci.isEmpty(h)||m.push({loci:h,value:f})}return{kind:"element-loci",layers:m}}else return c}e.filter=i;function s(c,u){let d=[];for(let m=0,p=c.length;m<p;++m){let{script:h,value:f}=c[m],C=To.toLoci(h,u);ce.Loci.isEmpty(C)||d.push({loci:C,value:f})}return{kind:"element-loci",layers:d}}e.ofScript=s;function a(c,u){let d=[];for(let m=0,p=c.length;m<p;++m){let{bundle:h,value:f}=c[m],C=ce.Bundle.toLoci(h,u.root);d.push({loci:C,value:f})}return{kind:"element-loci",layers:d}}e.ofBundle=a;function l(c){let u=[];for(let d=0,m=c.layers.length;d<m;++d){let{loci:p,value:h}=c.layers[d],f=ce.Bundle.fromLoci(p);u.push({bundle:f,value:h})}return{kind:"element-loci",layers:u}}e.toBundle=l})(Hs||(Hs={}));var cue;(function(e){function t(r,n,o){return M.getDefaultValues(r.getParams(n,o))}e.getDetaultParams=t})(cue||(cue={}));var QUe={name:"",label:"",description:"",factory:()=>Wt.Empty,getParams:()=>({}),defaultValues:{},defaultColorTheme:oi.EmptyProvider,defaultSizeTheme:Vi.EmptyProvider,isApplicable:()=>!0};function uue(e){return e.map(t=>[t.name,t.provider.label])}var qC=class{get default(){return this._list[0]}get types(){return uue(this._list)}constructor(){this._list=[],this._map=new Map,this._name=new Map}add(t){if(this._map.has(t.name))throw new Error(`${t.name} already registered.`);this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)}getName(t){if(!this._name.has(t))throw new Error(`'${t.label}' is not a registered represenatation provider.`);return this._name.get(t)}remove(t){let r=t.name;this._list.splice(this._list.findIndex(o=>o.name===r),1);let n=this._map.get(r);n&&(this._map.delete(r),this._name.delete(n))}get(t){return this._map.get(t)||QUe}get list(){return this._list}getApplicableList(t){return this._list.filter(r=>r.provider.isApplicable(t))}getApplicableTypes(t){return uue(this.getApplicableList(t))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}};var Wt;(function(e){let t;(function(a){function l(u,d){return u.repr===d.repr&&Xt.areEqual(u.loci,d.loci)}a.areEqual=l;function c(u){return Xt.isEmpty(u.loci)}a.isEmpty=c,a.Empty={loci:pr}})(t=e.Loci||(e.Loci={}));function r(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:de.identity(),overpaint:Gs.Empty,transparency:Us.Empty,emissive:Hs.Empty,substance:zs.Empty,clipping:io.Empty,themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1},markerActions:si.All}}e.createState=r;function n(a,l){l.visible!==void 0&&(a.visible=l.visible),l.alphaFactor!==void 0&&(a.alphaFactor=l.alphaFactor),l.pickable!==void 0&&(a.pickable=l.pickable),l.colorOnly!==void 0&&(a.colorOnly=l.colorOnly),l.overpaint!==void 0&&(a.overpaint=l.overpaint),l.transparency!==void 0&&(a.transparency=l.transparency),l.emissive!==void 0&&(a.emissive=l.emissive),l.substance!==void 0&&(a.substance=l.substance),l.clipping!==void 0&&(a.clipping=l.clipping),l.themeStrength!==void 0&&(a.themeStrength=l.themeStrength),l.syncManually!==void 0&&(a.syncManually=l.syncManually),l.transform!==void 0&&de.copy(a.transform,l.transform),l.markerActions!==void 0&&(a.markerActions=l.markerActions)}e.updateState=n,e.StateBuilder={create:r,update:n},e.Empty={label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new Vn,state:r(),theme:ii.createEmpty(),createOrUpdate:()=>ke.constant("",void 0),setState:()=>{},setTheme:()=>{},getLoci:()=>pr,getAllLoci:()=>[],eachLocation:()=>{},mark:()=>!1,destroy:()=>{}};class o{constructor(){this.curr=new Set,this.next=new Set,this._version=-1}get version(){return this._version}add(l,c){this.next.add(Ys(l,c))}snapshot(){$n.areEqual(this.curr,this.next)||(this._version+=1),[this.curr,this.next]=[this.next,this.curr],this.next.clear()}}e.GeometryState=o;function i(a,l,c,u,d){let m=0,p=new Vn,h=new o,f=u.create(),C=ii.createEmpty(),g,b,y,x={},A=Object.keys(d).map((v,_)=>{x[_]=v;let I=d[v](l,c);return I.setState(f),I});return{label:a,updated:p,get groupCount(){let v=0;if(b){let{visuals:_}=b;for(let I=0,T=A.length;I<T;++I)(!_||_.includes(x[I]))&&(v+=A[I].groupCount)}return v},get renderObjects(){let v=[];if(b){let{visuals:_}=b;for(let I=0,T=A.length;I<T;++I)(!_||_.includes(x[I]))&&v.push(...A[I].renderObjects)}return v},get geometryVersion(){return h.version},get props(){return b},get params(){return g},createOrUpdate:(v={},_)=>{_&&_!==y&&(g=c(l,_),y=_,b||(b=M.getDefaultValues(g)));let I=aw(Object.assign({},b,v),y);Object.assign(b,v,I);let{visuals:T}=b;return ke.create(`Creating or updating '${a}' representation`,async E=>{for(let w=0,S=A.length;w<S;++w)(!T||T.includes(x[w]))&&await A[w].createOrUpdate(b,y).runInContext(E),h.add(w,A[w].geometryVersion);h.snapshot(),p.next(m++)})},get state(){return f},get theme(){return C},getLoci:v=>{let{visuals:_}=b;for(let I=0,T=A.length;I<T;++I)if(!_||_.includes(x[I])){let E=A[I].getLoci(v);if(!wi(E))return E}return pr},getAllLoci:()=>{let v=[],{visuals:_}=b;for(let I=0,T=A.length;I<T;++I)(!_||_.includes(x[I]))&&v.push(...A[I].getAllLoci());return v},eachLocation:v=>{let{visuals:_}=b;for(let I=0,T=A.length;I<T;++I)(!_||_.includes(x[I]))&&A[I].eachLocation(v)},mark:(v,_)=>{let I=!1;for(let T=0,E=A.length;T<E;++T)I=A[T].mark(v,_)||I;return I},setState:v=>{u.update(f,v);for(let _=0,I=A.length;_<I;++_)A[_].setState(v)},setTheme:v=>{C=v;for(let _=0,I=A.length;_<I;++_)A[_].setTheme(v)},destroy(){for(let v=0,_=A.length;v<_;++v)A[v].destroy()}}}e.createMulti=i;function s(a,l){let c=0,u=new Vn,d=new o,m=e.createState(),p=ii.createEmpty(),h=M.clone(at.Params),f=M.getDefaultValues(at.Params);return{label:a,updated:u,get groupCount(){return l.values.uGroupCount.ref.value},get renderObjects(){return[l]},get geometryVersion(){return d.version},get props(){return f},get params(){return h},createOrUpdate:(C={})=>{let g=aw(Object.assign({},f,C));return Object.assign(f,C,g),ke.create(`Updating '${a}' representation`,async b=>{d.add(0,l.id),d.snapshot(),u.next(c++)})},get state(){return m},get theme(){return p},getLoci:()=>pr,getAllLoci:()=>[],eachLocation:()=>{},mark:(C,g)=>!1,setState:C=>{C.visible!==void 0&&Er.setVisibility(l,C.visible),C.alphaFactor!==void 0&&Er.setAlphaFactor(l,C.alphaFactor),C.pickable!==void 0&&Er.setPickable(l,C.pickable),C.colorOnly!==void 0&&Er.setColorOnly(l,C.colorOnly),C.overpaint,C.transparency,C.emissive,C.substance,C.clipping,C.themeStrength!==void 0&&Er.setThemeStrength(l,C.themeStrength),C.transform!==void 0&&Er.setTransform(l,C.transform),e.updateState(m,C)},setTheme:()=>{},destroy(){}}}e.fromRenderObject=s})(Wt||(Wt={}));function _i(e,t,r={}){let n=0,o=new Vn,i=Wt.createState(),s=ru(),a=[],l,c,u=-1,d=ii.createEmpty(),m=M.getDefaultValues(t.Params),p,h,f;r.modifyState&&Wt.updateState(i,r.modifyState(i));let C=Zu.create();function g(A={},v){Zu.reset(C),!(!v&&!c)&&(v&&!c?C.createNew=!0:v&&c&&v.id===c.id||v&&c&&v.id!==c.id&&(C.updateTransform=!0,C.createGeometry=!0),A.instanceGranularity!==m.instanceGranularity&&(C.updateTransform=!0),C.updateTransform&&(C.updateColor=!0,C.updateSize=!0,C.updateMatrix=!0),C.createGeometry&&(C.updateColor=!0,C.updateSize=!0))}function b(A={},v){return r.modifyProps&&(A=r.modifyProps(A)),ke.create("ShapeRepresentation.create",async _=>{let I=Object.assign(m,A),T=v?await e(_,v,I,c):void 0;if(g(A,T),T&&(c=T,Object.assign(d,br.getTheme(c))),C.createNew){a.length=0,h=br.groupIterator(c);let E=br.createTransform(c.transforms,c.geometry.boundingSphere,I.cellSize,I.batchSize),w=t.createValues(c.geometry,E,h,d,I),S=t.createRenderableState(I);r.modifyState&&Object.assign(S,r.modifyState(S)),Wt.updateState(i,S),l=gm(c.geometry.kind,w,S,s),l&&a.push(l),f=t.createPositionIterator(c.geometry,l.values)}else{if(!l)throw new Error("expected renderObject to be available");if(C.updateTransform){h=br.groupIterator(c);let{instanceCount:E,groupCount:w}=h;A.instanceGranularity?to(E,"instance",l.values):to(E*w,"groupInstance",l.values)}C.updateMatrix&&(br.createTransform(c.transforms,c.geometry.boundingSphere,I.cellSize,I.batchSize,l.values),"lodLevels"in l.values&&G.update(l.values.lodLevels,l.values.lodLevels.ref.value)),C.createGeometry&&(G.updateIfChanged(l.values.drawCount,Mi.getDrawCount(c.geometry)),G.updateIfChanged(l.values.uVertexCount,Mi.getVertexCount(c.geometry)),G.updateIfChanged(l.values.uGroupCount,Mi.getGroupCount(c.geometry))),(C.updateTransform||C.createGeometry)&&(t.updateBoundingSphere(l.values,c.geometry),f=t.createPositionIterator(c.geometry,l.values)),C.updateColor&&$i(h,f,d.color,l.values),C.updateSize&&"uSize"in l.values&&Sl(h,d.size,l.values),t.updateValues(l.values,I),t.updateRenderableState(l.state,I)}m=I,(C.createGeometry||C.createNew)&&(u+=1),o.next(n++)})}function y(A,v,_){let I=!1;if(!Fi.isLoci(A)||Fi.isLociEmpty(A)||A.shape!==v)return!1;for(let T of A.groups)_(Be.ofSingleton(T.instance))&&(I=!0);return I}function x(A,v){return cs(A)||br.isLoci(A)&&A.shape===c?m.instanceGranularity?v(Be.ofBounds(0,c.transforms.length)):v(Be.ofBounds(0,c.groupCount*c.transforms.length)):m.instanceGranularity?y(A,c,v):JUe(A,c,v)}return{label:"Shape geometry",get groupCount(){return h?h.count:0},get props(){return m},get params(){return p},get state(){return i},get theme(){return d},renderObjects:a,get geometryVersion(){return u},updated:o,createOrUpdate:b,getLoci(A){let{objectId:v,groupId:_,instanceId:I}=A;return l&&l.id===v?Fi.Loci(c,[{ids:Ge.ofSingleton(_),instance:I}]):pr},getAllLoci(){return[br.Loci(c)]},eachLocation:A=>{for(h.reset();h.hasNext;){let{location:v,isSecondary:_}=h.move();A(v,_)}},mark(A,v){if(!si.is(i.markerActions,v))return!1;if(Fi.isLoci(A)||br.isLoci(A)){if(A.shape!==c)return!1}else if(!cs(A))return!1;return Er.mark(l,A,v,x)},setState(A){r.modifyState&&(A=r.modifyState(A)),l&&(A.visible!==void 0&&Er.setVisibility(l,A.visible),A.alphaFactor!==void 0&&Er.setAlphaFactor(l,A.alphaFactor),A.pickable!==void 0&&Er.setPickable(l,A.pickable),A.colorOnly!==void 0&&Er.setColorOnly(l,A.colorOnly),A.overpaint!==void 0&&Er.setOverpaint(l,A.overpaint,x,!0),A.transparency!==void 0&&Er.setTransparency(l,A.transparency,x,!0),A.substance!==void 0&&Er.setSubstance(l,A.substance,x,!0),A.transform!==void 0&&Er.setTransform(l,A.transform)),Wt.updateState(i,A)},setTheme(A){},destroy(){a.length=0,l&&(l.state.disposed=!0,l=void 0)}}}function JUe(e,t,r){if(!Fi.isLoci(e)||e.shape!==t)return!1;let n=!1,{groupCount:o}=t,{groups:i}=e;for(let{ids:s,instance:a}of i)if(Be.is(s)){let l=a*o+Be.start(s),c=a*o+Be.end(s);r(Be.ofBounds(l,c))&&(n=!0)}else for(let l=0,c=s.length;l<c;l++){let u=a*o+s[l];r(Be.ofSingleton(u))&&(n=!0)}return n}var due=de(),Rg=class{constructor(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=Ja.Mutable(),this.groupIndexMap=Ja.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(t.units.length*16),this.size=t.units.length,this.reset();let r=0;for(let n=0,o=t.unitSymmetryGroups.length;n<o;++n){let i=t.unitSymmetryGroups[n];this.groupIndexMap.set(i.hashCode,n);let s=this.unitTransforms.subarray(r,r+i.units.length*16);this.groupUnitTransforms.push(s);for(let a=0,l=i.units.length;a<l;++a)this.unitOffsetMap.set(i.units[a].id,r+a*16);r+=i.units.length*16}}reset(){this.version=0,sC(this.unitTransforms,this.size),this._isIdentity=!0}get isIdentity(){if(this._isIdentity===void 0){this._isIdentity=!0;for(let t=0,r=this.size*16;t<r;t+=16)if(de.fromArray(due,this.unitTransforms,t),!de.isIdentity(due)){this._isIdentity=!1;break}}return this._isIdentity}setTransform(t,r){this.version=(this.version+1)%2147483647,de.toArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id)),this._isIdentity=void 0}getTransform(t,r){return de.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(r.id))}getSymmetryGroupTransforms(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]}};var mue=de();function OU(e,t,r){for(let n=0,o=e.units.length;n<o;n++){let i=e.units[n];eo.lerpFromIdentity(mue,i.conformation.operator,r),t.setTransform(mue,i)}}var pue=D(),ZC=D(),tk=de();function VU(e,t,r,n){let o=n.radius*r;for(let i=0,s=e.units.length;i<s;i++){let a=e.units[i];D.transformMat4(pue,a.lookup3d.boundary.sphere.center,a.conformation.operator.matrix),D.sub(ZC,pue,n.center),D.setMagnitude(ZC,ZC,o),de.fromTranslation(tk,ZC),t.setTransform(tk,a)}}var gue={axis:M.MappedStatic("custom",{structure:M.Group({principalAxis:M.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:M.Group({vector:M.Vec3(D.create(0,0,1))})}),origin:M.MappedStatic("structure",{structure:M.Group({}),custom:M.Group({vector:M.Vec3(D.create(0,0,0))})})};function GU(e,t){let r,n;return t.axis.name==="custom"?r=t.axis.params.vector:r=qe.getPrincipalAxes(e).momentsAxes[t.axis.params.principalAxis],t.origin.name==="custom"?n=t.origin.params.vector:n=qe.getPrincipalAxes(e).momentsAxes.origin,{axis:r,origin:n}}var fue=de(),hue=de(),ek=de();function UU(e,t,r,n,o){for(let i=0,s=e.units.length;i<s;i++){let a=e.units[i];D.negate(ZC,o),de.fromTranslation(tk,ZC),de.fromRotation(fue,Math.PI*r*2,n),de.fromTranslation(hue,o),de.mul(ek,fue,tk),de.mul(ek,hue,ek),t.setTransform(ek,a)}}var e9e=de.fromTranslation(de(),D.create(.5,.5,.5)),t9e=Q5(Y5(T3()),e9e),Wp=D(),yue=de(),r9e={origin:"Origin",model:"Model"},n9e={corner:"Corner",center:"Center"},o9e={...Ct.Params,cellColor:M.Color(Gt.orange),cellScale:M.Numeric(2,{min:.1,max:5,step:.1}),ref:M.Select("model",M.objectToOptions(r9e),{isEssential:!0}),attachment:M.Select("corner",M.objectToOptions(n9e),{isEssential:!0})},i9e={mesh:(e,t)=>_i(a9e,Ct.Utils)},zU={...o9e};function s9e(e,t,r){let n=gt.createState(256,128,r),{fromFractional:o}=e.symmetry.spacegroup.cell;D.copy(Wp,e.ref),t.attachment==="center"?(D.trunc(Wp,Wp),D.subScalar(Wp,Wp,.5)):D.floor(Wp,Wp),de.fromTranslation(yue,Wp);let i=Q5(Y5(t9e),yue),s=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;n.currentGroup=1,gt.addCage(n,o,i,s,2,20);let a=Pe.fromDimensionsAndTransform(Pe(),D.unit,o);D.transformMat4(Wp,Wp,o),Pe.translate(a,a,Wp),Pe.expand(a,a,s);let l=gt.getMesh(n);return l.setBoundingSphere(a),l}function a9e(e,t,r,n){let o=s9e(t,r,n&&n.geometry),i=vg.getUnitcellLabel(t.symmetry);return br.create(i,t,o,()=>r.cellColor,()=>1,()=>i)}function HU(e,t,r){let n=D();return r.ref==="model"&&D.transformMat4(n,Ut.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:n}}function vue(e,t){return Wt.createMulti("Unit Cell",e,t,Wt.StateBuilder,i9e)}var km=new Uint16Array([0,1,2,1,3,2]),qb=it.add3,Bl=it.add2,bue=it.add,kc;(function(e){function t(r={},n=2048,o=1024,i){n*=2,o*=2;let s=it.create(Float32Array,3,o,i?i.centerBuffer.ref.value:n),a=it.create(Float32Array,2,o,i?i.mappingBuffer.ref.value:n),l=it.create(Float32Array,1,o,i?i.depthBuffer.ref.value:n),c=it.create(Uint32Array,3,o,i?i.indexBuffer.ref.value:n),u=it.create(Float32Array,1,o,i?i.groupBuffer.ref.value:n),d=it.create(Float32Array,2,o,i?i.tcoordBuffer.ref.value:n),m={...M.getDefaultValues(Cs.Params),...r},{attachment:p,background:h,backgroundMargin:f,tether:C,tetherLength:g,tetherBaseWidth:b}=m,y=xre(m),x=1/2.5*f,A=y.buffer/y.lineHeight,v=(_,I,T,E,w)=>{qb(s,_,I,T),bue(l,E),bue(u,w)};return{add:(_,I,T,E,w,S,P)=>{let k=0,L=_.length;for(let B=0;B<L;++B){let j=y.get(_[B]);k+=j.nw-2*A}let R=1/1.25,N,F;if(p.startsWith("top")?N=R:p.startsWith("middle")?N=R/2:N=0,p.endsWith("right")?F=k:p.endsWith("center")?F=k/2:F=0,C)switch(p){case"bottom-left":F-=g/2+x+.1,N-=g/2+x;break;case"bottom-center":N-=g+x;break;case"bottom-right":F+=g/2+x+.1,N-=g/2+x;break;case"middle-left":F-=g+x+.1;break;case"middle-center":break;case"middle-right":F+=g+x+.1;break;case"top-left":F-=g/2+x+.1,N+=g/2+x;break;case"top-center":N+=g+x;break;case"top-right":F+=g/2+x+.1,N+=g/2+x;break}let H=(-F-x-.1)*S,V=(k-F+x+.1)*S,q=(R-N+x)*S,Q=(-N-x)*S;if(h){Bl(a,H,q),Bl(a,H,Q),Bl(a,V,q),Bl(a,V,Q);let B=s.elementCount;for(let j=0;j<4;++j)Bl(d,10,10),v(I,T,E,w,P);qb(c,B+km[0],B+km[1],B+km[2]),qb(c,B+km[3],B+km[4],B+km[5])}if(C){let B,j,U,z,$,Z,J,ie,ne=g*S,le=b*S;switch(p){case"bottom-left":B=H-ne/2,U=H+le/2,$=H,J=H,j=Q-ne/2,z=Q,Z=Q+le/2,ie=Q;break;case"bottom-center":B=0,U=le/2,$=-le/2,J=0,j=Q-ne,z=Q,Z=Q,ie=Q;break;case"bottom-right":B=V+ne/2,U=V,$=V-le/2,J=V,j=Q-ne/2,z=Q+le/2,Z=Q,ie=Q;break;case"middle-left":B=H-ne,U=H,$=H,J=H,j=0,z=-le/2,Z=le/2,ie=0;break;case"middle-center":B=0,U=0,$=0,J=0,j=0,z=0,Z=0,ie=0;break;case"middle-right":B=V+ne,U=V,$=V,J=V,j=0,z=le/2,Z=-le/2,ie=0;break;case"top-left":B=H-ne/2,U=H+le/2,$=H,J=H,j=q+ne/2,z=q,Z=q-le/2,ie=q;break;case"top-center":B=0,U=le/2,$=-le/2,J=0,j=q+ne,z=q,Z=q,ie=q;break;case"top-right":B=V+ne/2,U=V,$=V-le/2,J=V,j=q+ne/2,z=q-le/2,Z=q,ie=q;break;default:Sr(p)}Bl(a,B,j),Bl(a,U,z),Bl(a,$,Z),Bl(a,J,ie);let ee=s.elementCount;for(let oe=0;oe<4;++oe)Bl(d,10,10),v(I,T,E,w,P);qb(c,ee,ee+1,ee+3),qb(c,ee,ee+3,ee+2)}F+=A,N+=A;let O=0;for(let B=0;B<L;++B){let j=y.get(_[B]),U=(O-F)*S,z=(O+j.nw-F)*S,$=(j.nh-N)*S,Z=-N*S;Bl(a,U,$),Bl(a,U,Z),Bl(a,z,$),Bl(a,z,Z);let J=y.texture.width,ie=y.texture.height;Bl(d,j.x/J,j.y/ie),Bl(d,j.x/J,(j.y+j.h)/ie),Bl(d,(j.x+j.w)/J,j.y/ie),Bl(d,(j.x+j.w)/J,(j.y+j.h)/ie),O+=j.nw-2*A;let ne=s.elementCount;for(let le=0;le<4;++le)v(I,T,E,w,P);qb(c,ne+km[0],ne+km[1],ne+km[2]),qb(c,ne+km[3],ne+km[4],ne+km[5])}},getText:()=>{let _=y.texture,I=it.compact(s,!0),T=it.compact(a,!0),E=it.compact(l,!0),w=it.compact(c,!0),S=it.compact(u,!0),P=it.compact(d,!0);return Cs.create(_,I,T,E,w,S,P,c.elementCount/2,i)}}}e.create=t})(kc||(kc={}));var XC={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function Mm(e,t={}){var r;switch(e.kind){case"structure-loci":return e.structure.models.map(d=>d.entry).filter(d=>!!d).join(", ");case"element-loci":return Zb(ce.Stats.ofLoci(e),t);case"bond-loci":let n=e.bonds[0];return n?pw(n,t):"";case"shape-loci":return e.shape.name;case"group-loci":let o=e.groups[0];return o?e.shape.getLabel(Ge.start(o.ids),o.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[`${e.volume.label||"Volume"}`,`Isosurface at ${ot.IsoValue.toString(e.isoValue)}`].join(" | ");case"cell-loci":let i=Ge.size(e.indices),s=Ge.start(e.indices),a=ot.IsoValue.absolute(e.volume.grid.cells.data[s]),l=ot.IsoValue.toRelative(a,e.volume.grid.stats),c=[`${e.volume.label||"Volume"}`,`${i===1?`Cell #${s}`:`${i} Cells`}`];return i===1&&c.push(`${ot.IsoValue.toString(a)} (${ot.IsoValue.toString(l)})`),c.join(" | ");case"segment-loci":let u=(r=ot.Segmentation.get(e.volume))===null||r===void 0?void 0:r.labels;if(u&&e.segments.length===1){let d=u[e.segments[0]];if(d)return d}return[`${e.volume.label||"Volume"}`,`${e.segments.length===1?`Segment ${e.segments[0]}`:`${e.segments.length} Segments`}`].join(" | ")}}function KC(e,t){return e===1?`1 ${t}`:`${e} ${t}s`}function mw(e,t,r,n,o,i){return`${Rd(t,{granularity:r,hidePrefix:n,reverse:o,condensed:i})} <small>[+ ${KC(e-1,`other ${nm(r)}`)}]</small>`}function l9e(e){let{elements:t,model:r}=e,{chainAtomSegments:n,residueAtomSegments:o}=r.atomicHierarchy,i=n.offsets[n.index[t[0]]],s=n.offsets[n.index[t[t.length-1]]+1]-1;return o.index[s]-o.index[i]+1}function Zb(e,t={}){let r={...XC,...t},n=c9e(e,r.countsOnly,r.hidePrefix,r.condensed,r.reverse);return r.htmlStyling?n:_p(n)}function Cy(e,t={}){let r=ce.Stats.create();for(let n of e)ce.Stats.add(r,r,ce.Stats.ofLoci(n));return Zb(r,t)}function c9e(e,t=!1,r=!1,n=!1,o=!1){let{structureCount:i,chainCount:s,residueCount:a,conformationCount:l,elementCount:c}=e;if(!t&&c===1&&a===0&&s===0)return Rd(e.firstElementLoc,{hidePrefix:r,condensed:n,granularity:"element",reverse:o});if(!t&&c===0&&a===1&&s===0)return Rd(e.firstResidueLoc,{hidePrefix:r,condensed:n,granularity:"residue",reverse:o});if(!t&&c===0&&a===0&&s===1){let{unit:u}=e.firstChainLoc,d=Le.isAtomic(u)&&l9e(u)===1||Le.Traits.is(u.traits,Le.Trait.MultiChain)?"residue":"chain";return Rd(e.firstChainLoc,{hidePrefix:r,condensed:n,granularity:d,reverse:o})}else if(t){let u=[];return i>0&&u.push(KC(i,"Structure")),s>0&&u.push(KC(s,"Chain")),a>0&&u.push(KC(a,"Residue")),l>0&&u.push(KC(l,"Conformation")),c>0&&u.push(KC(c,"Element")),u.join("<small> + </small>")}else{let u=[];return i>0&&u.push(i===1?Rd(e.firstStructureLoc,{hidePrefix:r,condensed:n,granularity:"structure",reverse:o}):mw(i,e.firstStructureLoc,"structure",r,o,n)),s>0&&(u.push(s===1?Rd(e.firstChainLoc,{condensed:n,granularity:"chain",hidePrefix:r,reverse:o}):mw(s,e.firstChainLoc,"chain",r,o,n)),r=!0),a>0&&(u.push(a===1?Rd(e.firstResidueLoc,{condensed:n,granularity:"residue",hidePrefix:r,reverse:o}):mw(a,e.firstResidueLoc,"residue",r,o,n)),r=!0),l>0&&(u.push(l===1?Rd(e.firstConformationLoc,{condensed:n,granularity:"conformation",hidePrefix:r,reverse:o}):mw(l,e.firstConformationLoc,"conformation",r,o,n)),r=!0),c>0&&u.push(c===1?Rd(e.firstElementLoc,{condensed:n,granularity:"element",hidePrefix:r,reverse:o}):mw(c,e.firstElementLoc,"element",r,o,n)),u.join("<small> + </small>")}}function pw(e,t={}){return rk({loci:[ce.Loci(e.aStructure,[{unit:e.aUnit,indices:Ge.ofSingleton(e.aIndex)}]),ce.Loci(e.bStructure,[{unit:e.bUnit,indices:Ge.ofSingleton(e.bIndex)}])]},t)}function rk(e,t={}){let r={...XC,...t},n=u9e(e,r);return r.htmlStyling?n:_p(n)}function u9e(e,t){let{granularity:r,hidePrefix:n,reverse:o,condensed:i}=t,s=!0;for(let a of e.loci)if(!ce.Loci.is(a)||ce.Loci.size(a)!==1){s=!1;break}if(s){let l=e.loci.map(u=>{let{unit:d,indices:m}=u.elements[0];return ce.Location.create(u.structure,d,d.elements[Ge.start(m)])}).map(u=>xue(u,r,n,o||i));if(i)return l.map(u=>u[0].replace(/\[.*\]/g,"").trim()).filter(u=>!!u).join(" \u2014 ");let c=0;for(let u=0,d=Math.min(...l.map(m=>m.length))-1;u<d;++u){let m=!0;for(let p=1,h=l.length;p<h;++p)if(l[0][u]!==l[p][u]){m=!1;break}if(m)c+=1;else break}if(c>0){let u=[l[0].join(" | ")];for(let d=1,m=l.length;d<m;++d)u.push(l[d].slice(c).filter(p=>!!p).join(" | "));return u.join(" \u2014 ")}else return l.map(u=>u.filter(d=>!!d).join(" | ")).filter(u=>!!u).join("</br>")}else return e.loci.map(l=>Mm(l,t)).filter(l=>!!l).join(i?" \u2014 ":"</br>")}function Rd(e,t={}){var r,n;let o={...XC,...t},i=xue(e,o.granularity,o.hidePrefix,o.reverse||o.condensed),s=o.condensed?(n=(r=i[0])===null||r===void 0?void 0:r.replace(/\[.*\]/g,"").trim())!==null&&n!==void 0?n:"":i.filter(a=>!!a).join(" | ");return o.htmlStyling?s:_p(s)}function xue(e,t="element",r=!1,n=!1){let o=[];if(!r){let i=e.unit.model.entry;i.length>30&&(i=i.substr(0,27)+"\u2026"),o.push(`<small>${i}</small>`),t!=="structure"&&(o.push(`<small>Model ${e.unit.model.modelNum}</small>`),o.push(`<small>Instance ${e.unit.conformation.operator.name}</small>`))}return Le.isAtomic(e.unit)?o.push(...d9e(e,t,n)):Le.isCoarse(e.unit)?o.push(...m9e(e,t)):o.push("Unknown"),n?o.reverse():o}function d9e(e,t,r=!1){let n=ce.Location.residueIndex(e),o=nt.chain.label_asym_id(e),i=nt.chain.auth_asym_id(e),s=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(n)===0,a=nt.residue.label_seq_id(e),l=nt.residue.auth_seq_id(e),c=nt.residue.pdbx_PDB_ins_code(e),u=nt.atom.label_comp_id(e),d=nt.atom.label_atom_id(e),m=nt.atom.label_alt_id(e),p=nt.atom.occupancy(e),h=nt.residue.microheterogeneityCompIds(e),f=t==="residue"&&h.length>1?`(${h.join("|")})`:u,C=[];switch(t){case"element":C.push(`<b>${d}</b>${m?`%${m}`:""}`);case"conformation":t==="conformation"&&m&&C.push(`<small>Conformation</small> <b>${m}</b>`);case"residue":let g=a===l||!s?l:a;C.push(`<b>${f} ${g}</b>${g!==l?` <small>[auth</small> <b>${l}</b><small>]</small>`:""}<b>${c||""}</b>`);case"chain":o===i?C.push(`<b>${o}</b>`):t==="chain"&&Le.Traits.is(e.unit.traits,Le.Trait.MultiChain)?C.push(`<small>[auth</small> <b>${i}</b><small>]</small>`):C.push(`<b>${o}</b> <small>[auth</small> <b>${i}</b><small>]</small>`)}return C.length>0&&p!==1&&!r&&(C[0]=`${C[0]} <small>[occupancy</small> <b>${Math.round(100*p)/100}</b><small>]</small>`),C.reverse()}function m9e(e,t){let r=nt.coarse.asym_id(e),n=nt.coarse.seq_id_begin(e),o=nt.coarse.seq_id_end(e),i=[];switch(t){case"element":case"conformation":case"residue":if(n===o){let s=nt.coarse.entityKey(e),l=e.unit.model.sequence.byEntityKey[s].sequence.compId.value(n-1);i.push(`<b>${l} ${n}</b>`)}else i.push(`<b>${n}-${o}</b>`);case"chain":i.push(`<b>${r}</b>`)}return i.reverse()}function YC(e,t={}){let r={...XC,measureOnly:!1,unitLabel:"\u212B",...t},[n,o]=e.loci.map(a=>Xt.getCenter(a)),i=`${D.distance(n,o).toFixed(2)} ${r.unitLabel}`;if(r.measureOnly)return i;let s=rk(e,r);return r.condensed?`${i} | ${s}`:`Distance ${i}</br>${s}`}function QC(e,t={}){let r={...XC,measureOnly:!1,...t},[n,o,i]=e.loci.map(u=>Xt.getCenter(u)),s=D.sub(D(),n,o),a=D.sub(D(),i,o),l=`${ma(D.angle(s,a)).toFixed(2)}\xB0`;if(r.measureOnly)return l;let c=rk(e,r);return r.condensed?`${l} | ${c}`:`Angle ${l}</br>${c}`}function JC(e,t={}){let r={...XC,measureOnly:!1,...t},[n,o,i,s]=e.loci.map(c=>Xt.getCenter(c)),a=`${ma(D.dihedralAngle(n,o,i,s)).toFixed(2)}\xB0`;if(r.measureOnly)return a;let l=rk(e,r);return r.condensed?`${a} | ${l}`:`Dihedral ${a}</br>${l}`}var jU={customText:M.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:M.Color(Gt.black,{isEssential:!0}),textSize:M.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},Sy={...Cs.Params,...jU,borderWidth:M.Numeric(.2,{min:0,max:.5,step:.01})};var Cue={unitLabel:M.Text("\u212B",{isEssential:!0})},p9e={...In.Params,...Cue,lineSizeAttenuation:M.Boolean(!0),linesColor:M.Color(Gt.lightgreen,{isEssential:!0}),linesSize:M.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:M.Numeric(.2,{min:.01,max:.2,step:.01})},f9e={...Sy,...Cue},Sue={lines:(e,t)=>_i(y9e,In.Utils,{modifyState:r=>({...r,markerActions:si.Highlighting})}),text:(e,t)=>_i(b9e,Cs.Utils,{modifyState:r=>({...r,markerActions:zt.None})})},$U={...p9e,...f9e,visuals:M.MultiSelect(["lines","text"],M.objectToOptions(Sue))};function h9e(){return{sphereA:Pe(),sphereB:Pe(),center:D(),distance:0}}function Iue(e,t){let{sphereA:r,sphereB:n,center:o}=t,[i,s]=e.loci;return Xt.getBoundingSphere(i,r),Xt.getBoundingSphere(s,n),D.add(o,r.center,n.center),D.scale(o,o,.5),t.distance=D.distance(r.center,n.center),t}var fw=h9e();function Aue(e,t){return e.pairs.length===1?`Distance ${YC(e.pairs[0],{unitLabel:t,measureOnly:!0})}`:`${e.pairs.length} Distances`}function g9e(e,t,r){let n=ga.create(128,64,r);for(let o=0,i=e.pairs.length;o<i;++o)Iue(e.pairs[o],fw),n.addFixedLengthDashes(fw.sphereA.center,fw.sphereB.center,t.dashLength,o);return n.getLines()}function y9e(e,t,r,n){let o=g9e(t,r,n&&n.geometry),i=Aue(t,r.unitLabel),s=a=>YC(t.pairs[a],r);return br.create(i,t,o,()=>r.linesColor,()=>r.linesSize,s)}function v9e(e,t,r){let n=kc.create(t,128,64,r);for(let o=0,i=e.pairs.length;o<i;++o){Iue(e.pairs[o],fw);let{center:s,distance:a,sphereA:l,sphereB:c}=fw,u=t.customText||`${a.toFixed(2)} ${t.unitLabel}`,m=Math.max(2,l.radius,c.radius)/2;n.add(u,s[0],s[1],s[2],1,m,o)}return n.getText()}function b9e(e,t,r,n){let o=v9e(t,r,n&&n.geometry),i=Aue(t,r.unitLabel),s=a=>YC(t.pairs[a],r);return br.create(i,t,o,()=>r.textColor,()=>r.textSize,s)}function wue(e,t){return Wt.createMulti("Distance",e,t,Wt.StateBuilder,Sue)}function WU(e){let t=e[0].loci,r=e[1].loci;return{pairs:[{loci:[t,r]}]}}function qU(e){let t=e[0].loci,r=e[1].loci,n=e[2].loci;return{triples:[{loci:[t,r,n]}]}}function ZU(e){let t=e[0].loci,r=e[1].loci,n=e[2].loci,o=e[3].loci;return{quads:[{loci:[t,r,n,o]}]}}function KU(e){return{infos:[{loci:e[0].loci}]}}function XU(e){return{locis:e.map(t=>t.loci)}}function YU(e){return{locis:e.map(t=>t.loci)}}var x9e={...Sy},_ue={text:(e,t)=>_i(A9e,Cs.Utils)},QU={...x9e,scaleByRadius:M.Boolean(!0),visuals:M.MultiSelect(["text"],M.objectToOptions(_ue)),snapshotKey:M.Text("",{isEssential:!0,disableInteractiveUpdates:!0,description:"Activate the snapshot with the provided key when clicking on the label"}),tooltip:M.Text("",{isEssential:!0,multiline:!0,disableInteractiveUpdates:!0,placeholder:"Tooltip",description:"Tooltip text to be displayed when hovering over the label"})},C9e=Pe();function JU(e,t=!1){return e.label||Mm(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function S9e(e){return e.infos.length===1?JU(e.infos[0]):`${e.infos.length} Labels`}function I9e(e,t,r){let n=kc.create(t,128,64,r),o=t.customText.trim();for(let i=0,s=e.infos.length;i<s;++i){let a=e.infos[i],l=Xt.getBoundingSphere(a.loci,C9e);if(!l)continue;let{center:c,radius:u}=l,d=o||JU(a,!0);n.add(d,c[0],c[1],c[2],t.scaleByRadius?u/.9:0,t.scaleByRadius?Math.max(1,u):1,i)}return n.getText()}function A9e(e,t,r,n){var o,i;let s=I9e(t,r,n&&n.geometry),a=S9e(t),l=(i=(o=r.tooltip)===null||o===void 0?void 0:o.trim())!==null&&i!==void 0?i:"",c=r.customText.trim(),u;return l?u=d=>l:c?u=d=>c:u=d=>JU(t.infos[d]),br.create(a,t,s,()=>r.textColor,()=>r.textSize,u)}function Tue(e,t){return Wt.createMulti("Label",e,t,Wt.StateBuilder,_ue)}var Kb=D(),w9e=de.identity(),Xb=new Float32Array(6*3),_9e=new Uint8Array([0,1,2,3,4,5]);function Eue(e,t,r,n,o){let{origin:i,dirA:s,dirB:a,dirC:l}=t;D.add(Kb,i,s),D.toArray(D.add(Kb,i,s),Xb,0),D.toArray(D.sub(Kb,i,s),Xb,3),D.toArray(D.add(Kb,i,a),Xb,6),D.toArray(D.sub(Kb,i,a),Xb,9),D.toArray(D.add(Kb,i,l),Xb,12),D.toArray(D.sub(Kb,i,l),Xb,15);let c=Nf(Xb,_9e),u=os.volume(t),d=Math.cbrt(u)/300*r;gt.addCage(e,w9e,c,d,n,o)}var Der=D.zero(),ker=D.zero();var Iy=D(),T9e=D(),E9e=D(),P9e=D(),D9e=de.identity(),Pue=new Float32Array(8*3),k9e=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]);function Due(e,t,r,n,o){let{origin:i,dirA:s,dirB:a,dirC:l}=t,c=D.negate(T9e,s),u=D.negate(E9e,a),d=D.negate(P9e,l),m=0,p=function(g,b,y){D.copy(Iy,i),D.add(Iy,Iy,g),D.add(Iy,Iy,b),D.add(Iy,Iy,y),D.toArray(Iy,Pue,m),m+=3};p(s,a,l),p(s,a,d),p(s,u,d),p(s,u,l),p(c,u,d),p(c,u,l),p(c,a,l),p(c,a,d);let h=Nf(Pue,k9e),f=os.volume(t),C=Math.cbrt(f)/300*r;gt.addCage(e,D9e,h,C,n,o)}var M9e=de.identity(),kue=D();function R9e(e,t,r,n,o){return D.add(kue,t,r),de.targetTo(e,t,kue,n),de.setTranslation(e,t),de.scale(e,e,o)}function Ay(e,t,r,n,o,i){gt.addPrimitive(e,R9e(M9e,t,r,n,o),eV(i))}var e9={color:M.Color(Gt.orange),scaleFactor:M.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:M.Numeric(2,{min:.1,max:10,step:.1})},B9e={...Ct.Params,...e9},L9e={...Ct.Params,...e9},N9e={...Ct.Params,...e9},Mue={axes:(e,t)=>_i(V9e,Ct.Utils),box:(e,t)=>_i(z9e,Ct.Utils),ellipsoid:(e,t)=>_i($9e,Ct.Utils)},t9={...B9e,...L9e,...N9e,visuals:M.MultiSelect(["box"],M.objectToOptions(Mue))};function F9e(e){return`Principal Axes of ${Cy(e,{countsOnly:!0})}`}function O9e(e,t,r){let n=gt.createState(256,128,r),o=ce.Loci.getPrincipalAxesMany(e.locis);return os.scale(o.momentsAxes,o.momentsAxes,t.scaleFactor),n.currentGroup=0,Eue(n,o.momentsAxes,t.radiusScale,2,20),gt.getMesh(n)}function V9e(e,t,r,n){let o=O9e(t,r,n&&n.geometry),i=F9e(t.locis);return br.create(i,t,o,()=>r.color,()=>1,()=>i)}function G9e(e){return`Oriented Box of ${Cy(e,{countsOnly:!0})}`}function U9e(e,t,r){let n=gt.createState(256,128,r),o=ce.Loci.getPrincipalAxesMany(e.locis);return os.scale(o.boxAxes,o.boxAxes,t.scaleFactor),n.currentGroup=0,Due(n,o.boxAxes,t.radiusScale,2,20),gt.getMesh(n)}function z9e(e,t,r,n){let o=U9e(t,r,n&&n.geometry),i=G9e(t.locis);return br.create(i,t,o,()=>r.color,()=>1,()=>i)}function H9e(e){return`Oriented Ellipsoid of ${Cy(e,{countsOnly:!0})}`}function j9e(e,t,r){let n=gt.createState(256,128,r),i=ce.Loci.getPrincipalAxesMany(e.locis).boxAxes,{origin:s,dirA:a,dirB:l}=i,c=os.size(D(),i);D.scale(c,c,.5*t.scaleFactor);let u=D.create(c[2],c[1],c[0]);return n.currentGroup=0,Ay(n,s,a,l,u,2),gt.getMesh(n)}function $9e(e,t,r,n){let o=j9e(t,r,n&&n.geometry),i=H9e(t.locis);return br.create(i,t,o,()=>r.color,()=>1,()=>i)}function Rue(e,t){let r=Wt.createMulti("Orientation",e,t,Wt.StateBuilder,Mue);return r.setState({markerActions:si.Highlighting}),r}var W9e={radius:1,segments:36,thetaStart:0,thetaLength:Math.PI*2};function nk(e){let{radius:t,segments:r,thetaStart:n,thetaLength:o}={...W9e,...e},i=o===Math.PI*2,s=i?r+1:r+2,a=new Float32Array(s*3),l=new Float32Array(s*3),c=new Uint32Array(r*3);a[0]=0,a[1]=0,a[2]=0,l[0]=0,l[1]=1,l[2]=0;for(let u=0,d=3;u<r;++u,d+=3){let m=n+u/r*o;a[d]=t*Math.sin(m),a[d+1]=0,a[d+2]=t*Math.cos(m),l[d]=0,l[d+1]=1,l[d+2]=0}for(let u=1,d=0;u<r;++u,d+=3)c[d]=u,c[d+1]=u+1,c[d+2]=0;if(i){let u=(r-1)*3;c[u]=r,c[u+1]=1,c[u+2]=0}else{let u=n+o,d=(r+1)*3;a[d]=t*Math.sin(u),a[d+1]=0,a[d+2]=t*Math.cos(u),l[d]=0,l[d+1]=1,l[d+2]=0;let m=(r-1)*3;c[m]=r,c[m+1]=r+1,c[m+2]=0}return{vertices:a,normals:l,indices:c}}var Bue={color:M.Color(Gt.lightgreen),arcScale:M.Numeric(.7,{min:.01,max:1,step:.01})},Lue={...In.Params,...Bue,lineSizeAttenuation:M.Boolean(!0),linesSize:M.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:M.Numeric(.04,{min:.01,max:.2,step:.01})},q9e={...Lue},Z9e={...Lue},K9e={...Ct.Params,...Bue,ignoreLight:M.Boolean(!0),sectorOpacity:M.Numeric(.75,{min:0,max:1,step:.01})},Nue={vectors:(e,t)=>_i(Q9e,In.Utils,{modifyState:r=>({...r,pickable:!1})}),arc:(e,t)=>_i(eze,In.Utils,{modifyState:r=>({...r,pickable:!1})}),sector:(e,t)=>_i(rze,Ct.Utils,{modifyProps:r=>({...r,alpha:r.sectorOpacity}),modifyState:r=>({...r,markerActions:si.Highlighting})}),text:(e,t)=>_i(oze,Cs.Utils,{modifyState:r=>({...r,markerActions:zt.None})})},r9={...q9e,...Z9e,...K9e,...Sy,visuals:M.MultiSelect(["vectors","sector","text"],M.objectToOptions(Nue))};function X9e(){return{sphereA:Pe(),sphereB:Pe(),sphereC:Pe(),arcDirA:D(),arcDirC:D(),arcNormal:D(),radius:0,angle:0}}var wy=D(),hw=de();function ok(e,t,r){let{sphereA:n,sphereB:o,sphereC:i}=t,{arcDirA:s,arcDirC:a,arcNormal:l}=t,[c,u,d]=e.loci;Xt.getBoundingSphere(c,n),Xt.getBoundingSphere(u,o),Xt.getBoundingSphere(d,i),D.sub(s,n.center,o.center),D.sub(a,i.center,o.center),D.cross(l,s,a);let p=Math.min(D.magnitude(s),D.magnitude(a))*r;return t.radius=p,t.angle=D.angle(s,a),t}function Fue(e,t){let{radius:r,angle:n}=e,o=t?AE(n,r)/t:32;de.targetTo(hw,e.sphereB.center,e.sphereA.center,e.arcNormal),de.setTranslation(hw,e.sphereB.center),de.mul(hw,hw,de.rotY180);let i=nk({radius:r,thetaLength:n,segments:o});return cC(i,hw)}var Ll=X9e();function ik(e){return e.triples.length===1?`Angle ${QC(e.triples[0],{measureOnly:!0})}`:`${e.triples.length} Angles`}function Y9e(e,t,r){let n=ga.create(128,64,r);for(let o=0,i=e.triples.length;o<i;++o)ok(e.triples[o],Ll,t.arcScale),n.addFixedLengthDashes(Ll.sphereB.center,Ll.sphereA.center,t.dashLength,o),n.addFixedLengthDashes(Ll.sphereB.center,Ll.sphereC.center,t.dashLength,o);return n.getLines()}function Q9e(e,t,r,n){let o=Y9e(t,r,n&&n.geometry),i=ik(t);return br.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function J9e(e,t,r){let n=ga.create(128,64,r);for(let o=0,i=e.triples.length;o<i;++o){ok(e.triples[o],Ll,t.arcScale);let s=Fue(Ll,t.dashLength),{indices:a,vertices:l}=s;for(let c=0,u=a.length;c<u;c+=3){if(c%2===1)continue;let d=a[c]*3,m=a[c+1]*3,p=l[d],h=l[d+1],f=l[d+2],C=l[m],g=l[m+1],b=l[m+2];n.add(p,h,f,C,g,b,o)}}return n.getLines()}function eze(e,t,r,n){let o=J9e(t,r,n&&n.geometry),i=ik(t);return br.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function tze(e,t,r){let n=gt.createState(128,64,r);for(let o=0,i=e.triples.length;o<i;++o){ok(e.triples[o],Ll,t.arcScale);let s=Fue(Ll);n.currentGroup=o,gt.addPrimitive(n,de.id,s),gt.addPrimitiveFlipped(n,de.id,s)}return gt.getMesh(n)}function rze(e,t,r,n){let o=tze(t,r,n&&n.geometry),i=ik(t),s=a=>QC(t.triples[a]);return br.create(i,t,o,()=>r.color,()=>1,s)}function nze(e,t,r){let n=kc.create(t,128,64,r);for(let o=0,i=e.triples.length;o<i;++o){ok(e.triples[o],Ll,t.arcScale),D.add(wy,Ll.arcDirA,Ll.arcDirC),D.setMagnitude(wy,wy,Ll.radius),D.add(wy,Ll.sphereB.center,wy);let s=ma(Ll.angle).toFixed(2),a=t.customText||`${s}\xB0`,c=Math.max(2,Ll.sphereA.radius,Ll.sphereB.radius,Ll.sphereC.radius)/2;n.add(a,wy[0],wy[1],wy[2],.1,c,o)}return n.getText()}function oze(e,t,r,n){let o=nze(t,r,n&&n.geometry),i=ik(t),s=a=>QC(t.triples[a]);return br.create(i,t,o,()=>r.textColor,()=>r.textSize,s)}function Oue(e,t){return Wt.createMulti("Angle",e,t,Wt.StateBuilder,Nue)}var Vue={color:M.Color(Gt.lightgreen),arcScale:M.Numeric(.7,{min:.01,max:1,step:.01})},sk={...In.Params,...Vue,lineSizeAttenuation:M.Boolean(!0),linesSize:M.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:M.Numeric(.04,{min:.01,max:.2,step:.01})},ize={...sk},sze={...sk},aze={...sk},lze={...sk},cze={...Ct.Params,...Vue,ignoreLight:M.Boolean(!0),sectorOpacity:M.Numeric(.75,{min:0,max:1,step:.01})},Gue={vectors:(e,t)=>_i(mze,In.Utils,{modifyState:r=>({...r,pickable:!1})}),extenders:(e,t)=>_i(vze,In.Utils,{modifyState:r=>({...r,pickable:!1})}),connector:(e,t)=>_i(fze,In.Utils,{modifyState:r=>({...r,pickable:!1})}),arms:(e,t)=>_i(gze,In.Utils,{modifyState:r=>({...r,pickable:!1})}),arc:(e,t)=>_i(xze,In.Utils,{modifyState:r=>({...r,pickable:!1})}),sector:(e,t)=>_i(Sze,Ct.Utils,{modifyProps:r=>({...r,alpha:r.sectorOpacity}),modifyState:r=>({...r,markerActions:si.Highlighting})}),text:(e,t)=>_i(Aze,Cs.Utils,{modifyState:r=>({...r,markerActions:zt.None})})},n9={...ize,...sze,...aze,...lze,...cze,...Sy,visuals:M.MultiSelect(["extenders","arms","sector","text"],M.objectToOptions(Gue))};function uze(){return{sphereA:Pe(),sphereB:Pe(),sphereC:Pe(),sphereD:Pe(),dirBA:D(),dirCD:D(),projA:D(),projD:D(),arcPointA:D(),arcPointD:D(),arcDirA:D(),arcDirD:D(),arcCenter:D(),arcNormal:D(),radius:0,angle:0}}var Mc=D(),gw=de();function Yb(e,t,r){let{sphereA:n,sphereB:o,sphereC:i,sphereD:s,dirBA:a,dirCD:l,projA:c,projD:u}=t,{arcPointA:d,arcPointD:m,arcDirA:p,arcDirD:h,arcCenter:f,arcNormal:C}=t,[g,b,y,x]=e.loci;Xt.getBoundingSphere(g,n),Xt.getBoundingSphere(b,o),Xt.getBoundingSphere(y,i),Xt.getBoundingSphere(x,s),D.add(f,o.center,i.center),D.scale(f,f,.5),D.sub(a,n.center,o.center),D.sub(l,s.center,i.center),D.add(d,f,a),D.add(m,f,l),D.sub(C,i.center,o.center),D.orthogonalize(p,C,a),D.orthogonalize(h,C,l),D.projectPointOnVector(c,d,p,f),D.projectPointOnVector(u,m,h,f);let v=Math.min(D.distance(c,f),D.distance(u,f))*r;D.setMagnitude(p,p,v),D.setMagnitude(h,h,v),D.add(d,f,p),D.add(m,f,h),t.radius=v,t.angle=D.dihedralAngle(n.center,o.center,i.center,s.center),D.matchDirection(Mc,C,D.sub(Mc,d,n.center));let _=D.angle(a,Mc),I=v/Math.cos(_-tb);D.add(c,o.center,D.setMagnitude(Mc,a,I)),D.matchDirection(Mc,C,D.sub(Mc,m,s.center));let T=D.angle(l,Mc),E=v/Math.cos(T-tb);return D.add(u,i.center,D.setMagnitude(Mc,l,E)),t}function Uue(e,t){let{radius:r,angle:n}=e,o=t?AE(n,r)/t:32;de.targetTo(gw,e.arcCenter,n<0?e.arcPointD:e.arcPointA,e.arcNormal),de.setTranslation(gw,e.arcCenter),de.mul(gw,gw,de.rotY180);let i=nk({radius:r,thetaLength:Math.abs(n),segments:o});return cC(i,gw)}var Wo=uze();function Qb(e){return e.quads.length===1?`Dihedral ${JC(e.quads[0],{measureOnly:!0})}`:`${e.quads.length} Dihedrals`}function dze(e,t,r){let n=ga.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)Yb(e.quads[o],Wo,t.arcScale),n.addFixedLengthDashes(Wo.arcCenter,Wo.arcPointA,t.dashLength,o),n.addFixedLengthDashes(Wo.arcCenter,Wo.arcPointD,t.dashLength,o);return n.getLines()}function mze(e,t,r,n){let o=dze(t,r,n&&n.geometry),i=Qb(t);return br.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function pze(e,t,r){let n=ga.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)Yb(e.quads[o],Wo,t.arcScale),n.addFixedLengthDashes(Wo.sphereB.center,Wo.sphereC.center,t.dashLength,o);return n.getLines()}function fze(e,t,r,n){let o=pze(t,r,n&&n.geometry),i=Qb(t);return br.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function hze(e,t,r){let n=ga.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)Yb(e.quads[o],Wo,t.arcScale),n.addFixedLengthDashes(Wo.sphereB.center,Wo.sphereA.center,t.dashLength,o),n.addFixedLengthDashes(Wo.sphereC.center,Wo.sphereD.center,t.dashLength,o);return n.getLines()}function gze(e,t,r,n){let o=hze(t,r,n&&n.geometry),i=Qb(t);return br.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function yze(e,t,r){let n=ga.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o)Yb(e.quads[o],Wo,t.arcScale),n.addFixedLengthDashes(Wo.arcPointA,Wo.projA,t.dashLength,o),n.addFixedLengthDashes(Wo.arcPointD,Wo.projD,t.dashLength,o);return n.getLines()}function vze(e,t,r,n){let o=yze(t,r,n&&n.geometry),i=Qb(t);return br.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function bze(e,t,r){let n=ga.create(128,64,r);for(let o=0,i=e.quads.length;o<i;++o){Yb(e.quads[o],Wo,t.arcScale);let s=Uue(Wo,t.dashLength),{indices:a,vertices:l}=s;for(let c=0,u=a.length;c<u;c+=3){if(c%2===1)continue;let d=a[c]*3,m=a[c+1]*3,p=l[d],h=l[d+1],f=l[d+2],C=l[m],g=l[m+1],b=l[m+2];n.add(p,h,f,C,g,b,o)}}return n.getLines()}function xze(e,t,r,n){let o=bze(t,r,n&&n.geometry),i=Qb(t);return br.create(i,t,o,()=>r.color,()=>r.linesSize,()=>"")}function Cze(e,t,r){let n=gt.createState(128,64,r);for(let o=0,i=e.quads.length;o<i;++o){Yb(e.quads[o],Wo,t.arcScale);let s=Uue(Wo);n.currentGroup=o,gt.addPrimitive(n,de.id,s),gt.addPrimitiveFlipped(n,de.id,s)}return gt.getMesh(n)}function Sze(e,t,r,n){let o=Cze(t,r,n&&n.geometry),i=Qb(t),s=a=>JC(t.quads[a]);return br.create(i,t,o,()=>r.color,()=>1,s)}function Ize(e,t,r){let n=kc.create(t,128,64,r);for(let o=0,i=e.quads.length;o<i;++o){Yb(e.quads[o],Wo,t.arcScale),D.add(Mc,Wo.arcDirA,Wo.arcDirD),D.setMagnitude(Mc,Mc,Wo.radius),D.add(Mc,Wo.arcCenter,Mc);let s=ma(Wo.angle).toFixed(2);s==="-0.00"&&(s="0.00");let a=t.customText||`${s}\xB0`,c=Math.max(2,Wo.sphereA.radius,Wo.sphereB.radius,Wo.sphereC.radius,Wo.sphereD.radius)/2;n.add(a,Mc[0],Mc[1],Mc[2],.1,c,o)}return n.getText()}function Aze(e,t,r,n){let o=Ize(t,r,n&&n.geometry),i=Qb(t),s=a=>JC(t.quads[a]);return br.create(i,t,o,()=>r.textColor,()=>r.textSize,s)}function zue(e,t){return Wt.createMulti("Dihedral",e,t,Wt.StateBuilder,Gue)}var o9={};Ui(o9,{BoxShape3D:()=>wze,getBoxMesh:()=>ak});var wze=Lt.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:fe.Root,to:fe.Shape.Provider,params:{bottomLeft:M.Vec3(D()),topRight:M.Vec3(D.create(1,1,1)),radius:M.Numeric(.15,{min:.01,max:4,step:.01}),color:M.Color(Gt.red)}})({canAutoUpdate(){return!0},apply({params:e}){return ke.create("Shape Representation",async t=>new fe.Shape.Provider({label:"Box",data:e,params:Ct.Params,getShape:(r,n)=>{let o=ak(xt.create(e.bottomLeft,e.topRight),e.radius);return br.create("Box",n,o,()=>n.color,()=>1,()=>"Box")},geometryUtils:Ct.Utils},{label:"Box"}))}});function ak(e,t,r){let n=D.sub(D(),e.max,e.min),o=de.fromTranslation(de(),D.create(.5,.5,.5)),i=de.fromScaling(de(),n),s=de.fromTranslation(de(),e.min),a=de.mul3(de(),s,i,o),l=gt.createState(256,128,r);l.currentGroup=1,gt.addCage(l,a,T3(),t,2,20);let c=gt.getMesh(l),u=D.scaleAndAdd(D(),e.min,n,.5),d=D.distance(e.min,u);return c.setBoundingSphere(Pe.create(u,d)),c}var Hue={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])},Qtr={vertices:Hue.vertices,edges:new Uint32Array([0,1,2,3,3,1,2,0])};function jue(){return Hue}var _ze={...Ct.Params,color:M.Color(Gt.orange),scaleFactor:M.Numeric(1,{min:.1,max:10,step:.1})},$ue={plane:(e,t)=>_i(Pze,Ct.Utils)},s9={..._ze,visuals:M.MultiSelect(["plane"],M.objectToOptions($ue))};function Tze(e){return`Best Fit Plane of ${Cy(e,{countsOnly:!0})}`}var _y=de(),i9=D();function Eze(e,t,r){let n=gt.createState(256,128,r),i=ce.Loci.getPrincipalAxesMany(e.locis).boxAxes,s=jue();return D.add(i9,i.origin,i.dirC),de.targetTo(_y,i9,i.origin,i.dirB),de.scale(_y,_y,os.size(i9,i)),de.scaleUniformly(_y,_y,t.scaleFactor),de.setTranslation(_y,i.origin),n.currentGroup=0,gt.addPrimitive(n,_y,s),gt.addPrimitiveFlipped(n,_y,s),gt.getMesh(n)}function Pze(e,t,r,n){let o=Eze(t,r,n&&n.geometry),i=Tze(t.locis);return br.create(i,t,o,()=>r.color,()=>1,()=>i)}function Wue(e,t){let r=Wt.createMulti("Plane",e,t,Wt.StateBuilder,$ue);return r.setState({markerActions:si.Highlighting}),r}var eS=Lt.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:fe.Molecule.Structure,to:fe.Molecule.Structure.Representation3D,params:(e,t)=>{let{registry:r,themes:n}=t.representation.structure,o=r.get(r.default.name);if(!e){let a={help:l=>{let{name:c,params:u}=l,m=n.colorThemeRegistry.get(c).factory({},u);return{description:m.description,legend:m.legend}}};return{type:M.Mapped(r.default.name,r.types,l=>M.Group(r.get(l).getParams(n,qe.Empty))),colorTheme:M.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.types,l=>M.Group(n.colorThemeRegistry.get(l).getParams({structure:qe.Empty})),a),sizeTheme:M.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.types,l=>M.Group(n.sizeThemeRegistry.get(l).getParams({structure:qe.Empty})))}}let i={structure:e.data},s={help:a=>{let{name:l,params:c}=a,d=n.colorThemeRegistry.get(l).factory(i,c);return{description:d.description,legend:d.legend}}};return{type:M.Mapped(r.default.name,r.getApplicableTypes(e.data),a=>M.Group(r.get(a).getParams(n,e.data))),colorTheme:M.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.getApplicableTypes(i),a=>M.Group(n.colorThemeRegistry.get(a).getParams(i)),s),sizeTheme:M.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.getApplicableTypes(i),a=>M.Group(n.sizeThemeRegistry.get(a).getParams(i)))}}})({canAutoUpdate({a:e,oldParams:t,newParams:r}){return e.data.elementCount<1e4||t.type.name===r.type.name&&r.type.params.quality!=="custom"},apply({a:e,params:t,cache:r},n){return ke.create("Structure Representation",async o=>{var i,s;let a={runtime:o,assetManager:n.managers.asset},l=n.representation.structure.registry.get(t.type.name),c=((i=l.getData)===null||i===void 0?void 0:i.call(l,e.data,t.type.params))||e.data;l.ensureCustomProperties&&await l.ensureCustomProperties.attach(a,c);let u=l.factory({webgl:(s=n.canvas3d)===null||s===void 0?void 0:s.webgl,...n.representation.structure.themes},l.getParams);await ii.ensureDependencies(a,n.representation.structure.themes,{structure:c},t),u.setTheme(ii.create(n.representation.structure.themes,{structure:c},t));let d=t.type.params||{};return await u.createOrUpdate(d,c).runInContext(o),new fe.Molecule.Structure.Representation3D({repr:u,sourceData:e.data},{label:l.label})})},update({a:e,b:t,oldParams:r,newParams:n,cache:o},i){return ke.create("Structure Representation",async s=>{var a,l;if(n.type.name!==r.type.name)return st.UpdateResult.Recreate;let c=i.representation.structure.registry.get(n.type.name);if(!((a=c.mustRecreate)===null||a===void 0)&&a.call(c,r.type.params,n.type.params))return st.UpdateResult.Recreate;let u=((l=c.getData)===null||l===void 0?void 0:l.call(c,e.data,n.type.params))||e.data,d={runtime:s,assetManager:i.managers.asset};c.ensureCustomProperties&&await c.ensureCustomProperties.attach(d,u),ii.releaseDependencies(i.representation.structure.themes,{structure:t.data.sourceData},r),await ii.ensureDependencies(d,i.representation.structure.themes,{structure:u},n),t.data.repr.setTheme(ii.create(i.representation.structure.themes,{structure:u},n));let m={...t.data.repr.props,...n.type.params};return await t.data.repr.createOrUpdate(m,u).runInContext(s),t.data.sourceData=e.data,st.UpdateResult.Updated})},dispose({b:e,params:t},r){if(!e||!t)return;let n=e.data.sourceData,o=r.representation.structure.registry.get(t.type.name);o.ensureCustomProperties&&o.ensureCustomProperties.detach(n),ii.releaseDependencies(r.representation.structure.themes,{structure:n},t)},interpolate(e,t,r){if(e.colorTheme.name!=="uniform"||t.colorTheme.name!=="uniform")return r<=.5?e:t;let n=e.colorTheme.params.value,o=t.colorTheme.params.value,i=ze.interpolate(n,o,r);return{type:r<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:i}},sizeTheme:r<=.5?e.sizeTheme:t.sizeTheme}}}),Dze=Lt.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:{t:M.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new Rg(r);return OU(r,n,t.t),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new Rg(r)},info:r,repr:e.data.repr},{label:`Unwind T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;if(n.t===r.t)return st.UpdateResult.Unchanged;let i=t.data.state.unitTransforms;return OU(o,i,r.t),t.label=`Unwind T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,st.UpdateResult.Updated}}),kze=Lt.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:{t:M.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new Rg(r);return VU(r,n,t.t,r.root.boundary.sphere),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new Rg(r)},info:r,repr:e.data.repr},{label:`Explode T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=e.data.sourceData;if(t.data.info!==o)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;if(n.t===r.t)return st.UpdateResult.Unchanged;let i=t.data.state.unitTransforms;return VU(o,i,r.t,o.root.boundary.sphere),t.label=`Explode T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,st.UpdateResult.Updated}}),Mze=Lt.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:{t:M.Numeric(0,{min:0,max:1,step:.01}),...gue}})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=new Rg(r),{axis:o,origin:i}=GU(r.root,t);return UU(r,n,t.t,o,i),new fe.Molecule.Structure.Representation3DState({state:{unitTransforms:n},initialState:{unitTransforms:new Rg(r)},info:r,repr:e.data.repr},{label:`Spin T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=e.data.sourceData;if(t.data.info!==o)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;if(n.t===r.t&&n.axis===r.axis&&n.origin===r.origin)return st.UpdateResult.Unchanged;let i=t.data.state.unitTransforms,{axis:s,origin:a}=GU(o.root,r);return UU(o,i,r.t,s,a),t.label=`Spin T = ${r.t.toFixed(2)}`,t.data.repr=e.data.repr,st.UpdateResult.Updated}}),Rze=Lt.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({script:M.Script(To("(sel.atom.all)","mol-script")),color:M.Color(Gt.blueviolet),clear:M.Boolean(!1)},e=>`${e.clear?"Clear":ze.toRgbString(e.color)}`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),color:Gt.blueviolet,clear:!1}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Gs.ofScript(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{overpaint:o},initialState:{overpaint:Gs.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Overpaint (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let s=e.data.repr.geometryVersion;if(s!==o.geometryVersion&&Fu(e.data.repr.props))return st.UpdateResult.Recreate;let a=t.data.state.overpaint,l=Gs.ofScript(r.layers,i);return Gs.areEqual(a,l)?st.UpdateResult.Unchanged:(o.geometryVersion=s,t.data.state.overpaint=l,t.data.repr=e.data.repr,t.label=`Overpaint (${l.layers.length} Layers)`,st.UpdateResult.Updated)}}),Bze=Lt.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({bundle:M.Value(ce.Bundle.Empty),color:M.Color(Gt.blueviolet),clear:M.Boolean(!1)},e=>`${e.clear?"Clear":ze.toRgbString(e.color)}`,{defaultValue:[{bundle:ce.Bundle.Empty,color:Gt.blueviolet,clear:!1}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Gs.ofBundle(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{overpaint:o},initialState:{overpaint:Gs.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Overpaint (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let s=e.data.repr.geometryVersion;if(s!==o.geometryVersion&&Fu(e.data.repr.props))return st.UpdateResult.Recreate;let a=t.data.state.overpaint,l=Gs.ofBundle(r.layers,i);return Gs.areEqual(a,l)?st.UpdateResult.Unchanged:(o.geometryVersion=s,t.data.state.overpaint=l,t.data.repr=e.data.repr,t.label=`Overpaint (${l.layers.length} Layers)`,st.UpdateResult.Updated)}}),Lze=Lt.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({script:M.Script(To("(sel.atom.all)","mol-script")),value:M.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Us.ofScript(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{transparency:o},initialState:{transparency:Us.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Transparency (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let s=e.data.repr.geometryVersion;if(s!==o.geometryVersion&&Fu(e.data.repr.props))return st.UpdateResult.Recreate;let a=t.data.state.transparency,l=Us.ofScript(r.layers,i);return Us.areEqual(a,l)?st.UpdateResult.Unchanged:(o.geometryVersion=s,t.data.state.transparency=l,t.data.repr=e.data.repr,t.label=`Transparency (${l.layers.length} Layers)`,st.UpdateResult.Updated)}}),Nze=Lt.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({bundle:M.Value(ce.Bundle.Empty),value:M.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{bundle:ce.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Us.ofBundle(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{transparency:o},initialState:{transparency:Us.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Transparency (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let s=e.data.repr.geometryVersion;if(s!==o.geometryVersion&&Fu(e.data.repr.props))return st.UpdateResult.Recreate;let a=t.data.state.transparency,l=Us.ofBundle(r.layers,i);return Us.areEqual(a,l)?st.UpdateResult.Unchanged:(o.geometryVersion=s,t.data.state.transparency=l,t.data.repr=e.data.repr,t.label=`Transparency (${l.layers.length} Layers)`,st.UpdateResult.Updated)}}),Fze=Lt.BuiltIn({name:"emissive-structure-representation-3d-from-script",display:"Emissive 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({script:M.Script(To("(sel.atom.all)","mol-script")),value:M.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},e=>`Emissive (${e.value})`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Hs.ofScript(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{emissive:o},initialState:{emissive:Hs.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Emissive (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let s=e.data.repr.geometryVersion;if(s!==o.geometryVersion&&Fu(e.data.repr.props))return st.UpdateResult.Recreate;let a=t.data.state.emissive,l=Hs.ofScript(r.layers,i);return Hs.areEqual(a,l)?st.UpdateResult.Unchanged:(o.geometryVersion=s,t.data.state.emissive=l,t.data.repr=e.data.repr,t.label=`Emissive (${l.layers.length} Layers)`,st.UpdateResult.Updated)}}),Oze=Lt.BuiltIn({name:"emissive-structure-representation-3d-from-bundle",display:"Emissive 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({bundle:M.Value(ce.Bundle.Empty),value:M.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},e=>`Emissive (${e.value})`,{defaultValue:[{bundle:ce.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=Hs.ofBundle(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{emissive:o},initialState:{emissive:Hs.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Emissive (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let s=e.data.repr.geometryVersion;if(s!==o.geometryVersion&&Fu(e.data.repr.props))return st.UpdateResult.Recreate;let a=t.data.state.emissive,l=Hs.ofBundle(r.layers,i);return Hs.areEqual(a,l)?st.UpdateResult.Unchanged:(o.geometryVersion=s,t.data.state.emissive=l,t.data.repr=e.data.repr,t.label=`Emissive (${l.layers.length} Layers)`,st.UpdateResult.Updated)}}),Vze=Lt.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({script:M.Script(To("(sel.atom.all)","mol-script")),material:Bs.getParam(),clear:M.Boolean(!1)},e=>`${e.clear?"Clear":Bs.toString(e.material)}`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),material:Bs({roughness:1}),clear:!1}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=zs.ofScript(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{substance:o},initialState:{substance:zs.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Substance (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let s=e.data.repr.geometryVersion;if(s!==o.geometryVersion&&Fu(e.data.repr.props))return st.UpdateResult.Recreate;let a=t.data.state.substance,l=zs.ofScript(r.layers,i);return zs.areEqual(a,l)?st.UpdateResult.Unchanged:(o.geometryVersion=s,t.data.state.substance=l,t.data.repr=e.data.repr,t.label=`Substance (${l.layers.length} Layers)`,st.UpdateResult.Updated)}}),Gze=Lt.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({bundle:M.Value(ce.Bundle.Empty),material:Bs.getParam(),clear:M.Boolean(!1)},e=>`${e.clear?"Clear":Bs.toString(e.material)}`,{defaultValue:[{bundle:ce.Bundle.Empty,material:Bs({roughness:1}),clear:!1}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=e.data.repr.geometryVersion,o=zs.ofBundle(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{substance:o},initialState:{substance:zs.Empty},info:{structure:r,geometryVersion:n},repr:e.data.repr},{label:`Substance (${o.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info,i=e.data.sourceData;if(i!==o.structure)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let s=e.data.repr.geometryVersion;if(s!==o.geometryVersion&&Fu(e.data.repr.props))return st.UpdateResult.Recreate;let a=t.data.state.substance,l=zs.ofBundle(r.layers,i);return zs.areEqual(a,l)?st.UpdateResult.Unchanged:(o.geometryVersion=s,t.data.state.substance=l,t.data.repr=e.data.repr,t.label=`Substance (${l.layers.length} Layers)`,st.UpdateResult.Updated)}}),Uze=Lt.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({script:M.Script(To("(sel.atom.all)","mol-script")),groups:M.Converted(e=>io.Groups.toNames(e),e=>io.Groups.fromNames(e),M.MultiSelect(Hh(io.Groups.Names),M.objectToOptions(io.Groups.Names)))},e=>`${io.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{script:To("(sel.atom.all)","mol-script"),groups:io.Groups.Flag.None}]})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=io.ofScript(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{clipping:n},initialState:{clipping:io.Empty},info:r,repr:e.data.repr},{label:`Clipping (${n.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let i=t.data.state.clipping,s=io.ofScript(r.layers,o);return io.areEqual(i,s)?st.UpdateResult.Unchanged:(t.data.state.clipping=s,t.data.repr=e.data.repr,t.label=`Clipping (${s.layers.length} Layers)`,st.UpdateResult.Updated)}}),zze=Lt.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({layers:M.ObjectList({bundle:M.Value(ce.Bundle.Empty),groups:M.Converted(e=>io.Groups.toNames(e),e=>io.Groups.fromNames(e),M.MultiSelect(Hh(io.Groups.Names),M.objectToOptions(io.Groups.Names)))},e=>`${io.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{bundle:ce.Bundle.Empty,groups:io.Groups.Flag.None}],isHidden:!0})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){let r=e.data.sourceData,n=io.ofBundle(t.layers,r);return new fe.Molecule.Structure.Representation3DState({state:{clipping:n},initialState:{clipping:io.Empty},info:r,repr:e.data.repr},{label:`Clipping (${n.layers.length} Layers)`})},update({a:e,b:t,newParams:r,oldParams:n}){let o=t.data.info;if(e.data.sourceData!==o)return st.UpdateResult.Recreate;if(e.data.repr!==t.data.repr)return st.UpdateResult.Recreate;let i=t.data.state.clipping,s=io.ofBundle(r.layers,o);return io.areEqual(i,s)?st.UpdateResult.Unchanged:(t.data.state.clipping=s,t.data.repr=e.data.repr,t.label=`Clipping (${s.layers.length} Layers)`,st.UpdateResult.Updated)}}),Hze=Lt.BuiltIn({name:"theme-strength-representation-3d",display:"Theme Strength 3D Representation",from:fe.Molecule.Structure.Representation3D,to:fe.Molecule.Structure.Representation3DState,params:()=>({overpaintStrength:M.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:M.Numeric(1,{min:0,max:1,step:.01}),emissiveStrength:M.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:M.Numeric(1,{min:0,max:1,step:.01})})})({canAutoUpdate(){return!0},apply({a:e,params:t}){return new fe.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:t.overpaintStrength,transparency:t.transparencyStrength,emissive:t.emissiveStrength,substance:t.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1}},info:{},repr:e.data.repr},{label:"Theme Strength",description:`${t.overpaintStrength.toFixed(2)}, ${t.transparencyStrength.toFixed(2)}, ${t.emissiveStrength.toFixed(2)}, ${t.substanceStrength.toFixed(2)}`})},update({a:e,b:t,newParams:r,oldParams:n}){var o,i,s,a;return r.overpaintStrength===((o=t.data.state.themeStrength)===null||o===void 0?void 0:o.overpaint)&&r.transparencyStrength===((i=t.data.state.themeStrength)===null||i===void 0?void 0:i.transparency)&&r.emissiveStrength===((s=t.data.state.themeStrength)===null||s===void 0?void 0:s.emissive)&&r.substanceStrength===((a=t.data.state.themeStrength)===null||a===void 0?void 0:a.substance)?st.UpdateResult.Unchanged:(t.data.state.themeStrength={overpaint:r.overpaintStrength,transparency:r.transparencyStrength,emissive:r.emissiveStrength,substance:r.substanceStrength},t.data.repr=e.data.repr,t.label="Theme Strength",t.description=`${r.overpaintStrength.toFixed(2)}, ${r.transparencyStrength.toFixed(2)}, ${r.emissiveStrength.toFixed(2)}, ${r.substanceStrength.toFixed(2)}`,st.UpdateResult.Updated)},interpolate(e,t,r){return{overpaintStrength:zn(e.overpaintStrength,t.overpaintStrength,r),transparencyStrength:zn(e.transparencyStrength,t.transparencyStrength,r),emissiveStrength:zn(e.emissiveStrength,t.emissiveStrength,r),substanceStrength:zn(e.substanceStrength,t.substanceStrength,r)}}}),Rm;(function(e){function t(o,i,s,a,l,c,u,d){let m=o.representation.volume.registry.get(i),p=o.representation.volume.themes.colorThemeRegistry.get(l||m.defaultColorTheme.name),h=o.representation.volume.themes.sizeThemeRegistry.get(u||m.defaultSizeTheme.name),f=M.getDefaultValues(m.getParams(o.representation.volume.themes,s));return{type:{name:i,params:a?{...f,...a}:f},colorTheme:{name:p.name,params:c?{...p.defaultValues,...c}:p.defaultValues},sizeTheme:{name:h.name,params:d?{...h.defaultValues,...d}:h.defaultValues}}}e.getDefaultParams=t;function r(o,i,s,a,l,c,u){let d=o.representation.volume.registry.get(i),m=o.representation.volume.themes.colorThemeRegistry.get(a||d.defaultColorTheme.name),p=o.representation.volume.themes.sizeThemeRegistry.get(c||d.defaultSizeTheme.name);return{type:{name:i,params:s?{...d.defaultValues,...s}:d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:l?{...m.defaultValues,...l}:m.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:u?{...p.defaultValues,...u}:p.defaultValues}}}e.getDefaultParamsStatic=r;function n(o){var i,s,a,l;if(o.isoValue)return ot.IsoValue.toString(o.isoValue);if(!((s=(i=o.renderMode)===null||i===void 0?void 0:i.params)===null||s===void 0)&&s.isoValue)return ot.IsoValue.toString((l=(a=o.renderMode)===null||a===void 0?void 0:a.params)===null||l===void 0?void 0:l.isoValue)}e.getDescription=n})(Rm||(Rm={}));var jze=Lt.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:fe.Volume.Data,to:fe.Volume.Representation3D,params:(e,t)=>{let{registry:r,themes:n}=t.representation.volume,o=r.get(r.default.name);if(!e)return{type:M.Mapped(r.default.name,r.types,s=>M.Group(r.get(s).getParams(n,ot.One))),colorTheme:M.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.types,s=>M.Group(n.colorThemeRegistry.get(s).getParams({volume:ot.One}))),sizeTheme:M.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.types,s=>M.Group(n.sizeThemeRegistry.get(s).getParams({volume:ot.One})))};let i={volume:e.data};return{type:M.Mapped(r.default.name,r.types,s=>M.Group(r.get(s).getParams(n,e.data))),colorTheme:M.Mapped(o.defaultColorTheme.name,n.colorThemeRegistry.getApplicableTypes(i),s=>M.Group(n.colorThemeRegistry.get(s).getParams(i))),sizeTheme:M.Mapped(o.defaultSizeTheme.name,n.sizeThemeRegistry.getApplicableTypes(i),s=>M.Group(n.sizeThemeRegistry.get(s).getParams(i)))}}})({canAutoUpdate({oldParams:e,newParams:t}){return e.type.name===t.type.name},apply({a:e,params:t},r){return ke.create("Volume Representation",async n=>{var o;let i={runtime:n,assetManager:r.managers.asset},s=r.representation.volume.registry.get(t.type.name);s.ensureCustomProperties&&await s.ensureCustomProperties.attach(i,e.data);let a=s.factory({webgl:(o=r.canvas3d)===null||o===void 0?void 0:o.webgl,...r.representation.volume.themes},s.getParams);a.setTheme(ii.create(r.representation.volume.themes,{volume:e.data},t));let l=t.type.params||{};return await a.createOrUpdate(l,e.data).runInContext(n),new fe.Volume.Representation3D({repr:a,sourceData:e.data},{label:s.label,description:Rm.getDescription(l)})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Volume Representation",async i=>{var s;if(n.type.name!==r.type.name)return(s=o.representation.volume.registry.get(r.type.name).ensureCustomProperties)===null||s===void 0||s.detach(e.data),st.UpdateResult.Recreate;let a={...t.data.repr.props,...n.type.params};return t.data.repr.setTheme(ii.create(o.representation.volume.themes,{volume:e.data},n)),await t.data.repr.createOrUpdate(a,e.data).runInContext(i),t.data.sourceData=e.data,t.description=Rm.getDescription(a),st.UpdateResult.Updated})}});var qp=Lt.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:fe.Shape.Provider,to:fe.Shape.Representation3D,params:(e,t)=>e?e.data.params:at.Params})({canAutoUpdate(){return!0},apply({a:e,params:t},r){return ke.create("Shape Representation",async n=>{let o={...M.getDefaultValues(e.data.params),...t},i=_i(e.data.getShape,e.data.geometryUtils);return await i.createOrUpdate(o,e.data.data).runInContext(n),new fe.Shape.Representation3D({repr:i,sourceData:e.data},{label:e.data.label})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Shape Representation",async i=>{let s={...t.data.repr.props,...n};return await t.data.repr.createOrUpdate(s,e.data.data).runInContext(i),t.data.sourceData=e.data,st.UpdateResult.Updated})}});var $ze=Lt.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:fe.Molecule.Model,to:fe.Shape.Representation3D,params:()=>({...zU})})({isApplicable:e=>!!_o.Provider.get(e.data),canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return ke.create("Model Unit Cell",async n=>{var o;let i=_o.Provider.get(e.data);if(!i)return Hn.Null;let s=HU(e.data,i,t),a=vue({webgl:(o=r.canvas3d)===null||o===void 0?void 0:o.webgl,...r.representation.structure.themes},()=>zU);return await a.createOrUpdate(t,s).runInContext(n),new fe.Shape.Representation3D({repr:a,sourceData:s},{label:"Unit Cell",description:i.spacegroup.name})})},update({a:e,b:t,newParams:r}){return ke.create("Model Unit Cell",async n=>{let o=_o.Provider.get(e.data);if(!o)return st.UpdateResult.Null;let i={...t.data.repr.props,...r},s=HU(e.data,o,i);return await t.data.repr.createOrUpdate(i,s).runInContext(n),t.data.sourceData=s,st.UpdateResult.Updated})}});var Wze=Lt.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:fe.Molecule.Structure,to:fe.Shape.Representation3D,params:{radius:M.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:M.Color(Gt.red,{isEssential:!0}),...Ct.Params}})({canAutoUpdate(){return!0},apply({a:e,params:t},r){return ke.create("Bounding Box",async n=>{let o=_i((i,s,a,l)=>{let c=ak(s.box,s.radius,l?.geometry);return br.create("Bouding Box",s,c,()=>s.color,()=>1,()=>"Bounding Box")},Ct.Utils);return await o.createOrUpdate(t,{box:e.data.boundary.box,radius:t.radius,color:t.color}).runInContext(n),new fe.Shape.Representation3D({repr:o,sourceData:e.data},{label:"Bounding Box"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Bounding Box",async i=>(await t.data.repr.createOrUpdate(n,{box:e.data.boundary.box,radius:n.radius,color:n.color}).runInContext(i),t.data.sourceData=e.data,st.UpdateResult.Updated))}});var qze=Lt.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:()=>({...$U})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return ke.create("Structure Distance",async n=>{var o;let i=WU(e.data),s=wue({webgl:(o=r.canvas3d)===null||o===void 0?void 0:o.webgl,...r.representation.structure.themes},()=>$U);return await s.createOrUpdate(t,i).runInContext(n),new fe.Shape.Representation3D({repr:s,sourceData:i},{label:"Distance"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Structure Distance",async i=>{let s={...t.data.repr.props,...n},a=WU(e.data);return await t.data.repr.createOrUpdate(s,a).runInContext(i),t.data.sourceData=a,st.UpdateResult.Updated})}});var Zze=Lt.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:()=>({...r9})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return ke.create("Structure Angle",async n=>{var o;let i=qU(e.data),s=Oue({webgl:(o=r.canvas3d)===null||o===void 0?void 0:o.webgl,...r.representation.structure.themes},()=>r9);return await s.createOrUpdate(t,i).runInContext(n),new fe.Shape.Representation3D({repr:s,sourceData:i},{label:"Angle"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Structure Angle",async i=>{let s={...t.data.repr.props,...n},a=qU(e.data);return await t.data.repr.createOrUpdate(s,a).runInContext(i),t.data.sourceData=a,st.UpdateResult.Updated})}});var Kze=Lt.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:()=>({...n9})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return ke.create("Structure Dihedral",async n=>{var o;let i=ZU(e.data),s=zue({webgl:(o=r.canvas3d)===null||o===void 0?void 0:o.webgl,...r.representation.structure.themes},()=>n9);return await s.createOrUpdate(t,i).runInContext(n),new fe.Shape.Representation3D({repr:s,sourceData:i},{label:"Dihedral"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Structure Dihedral",async i=>{let s={...t.data.repr.props,...n},a=ZU(e.data);return await t.data.repr.createOrUpdate(s,a).runInContext(i),t.data.sourceData=a,st.UpdateResult.Updated})}});var Xze=Lt.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:()=>({...QU})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return ke.create("Structure Label",async n=>{var o,i,s;let a=KU(e.data),l=Tue({webgl:(o=r.canvas3d)===null||o===void 0?void 0:o.webgl,...r.representation.structure.themes},()=>QU);await l.createOrUpdate(t,a).runInContext(n);let c=!!(!((i=t.snapshotKey)===null||i===void 0)&&i.trim()||!((s=t.tooltip)===null||s===void 0)&&s.trim());return l.setState({pickable:c,markerActions:c?si.Highlighting:zt.None}),new fe.Shape.Representation3D({repr:l,sourceData:a},{label:"Label"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Structure Label",async i=>{var s,a;let l={...t.data.repr.props,...n},c=KU(e.data);await t.data.repr.createOrUpdate(l,c).runInContext(i),t.data.sourceData=c;let u=!!(!((s=n.snapshotKey)===null||s===void 0)&&s.trim()||!((a=n.tooltip)===null||a===void 0)&&a.trim());return t.data.repr.setState({pickable:u,markerActions:u?si.Highlighting:zt.None}),st.UpdateResult.Updated})}});var Yze=Lt.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:()=>({...t9})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return ke.create("Structure Orientation",async n=>{var o;let i=XU(e.data),s=Rue({webgl:(o=r.canvas3d)===null||o===void 0?void 0:o.webgl,...r.representation.structure.themes},()=>t9);return await s.createOrUpdate(t,i).runInContext(n),new fe.Shape.Representation3D({repr:s,sourceData:i},{label:"Orientation"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Structure Orientation",async i=>{let s={...t.data.repr.props,...n},a=XU(e.data);return await t.data.repr.createOrUpdate(s,a).runInContext(i),t.data.sourceData=a,st.UpdateResult.Updated})}});var Qze=Lt.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:fe.Molecule.Structure.Selections,to:fe.Shape.Representation3D,params:()=>({...s9})})({canAutoUpdate({oldParams:e,newParams:t}){return!0},apply({a:e,params:t},r){return ke.create("Structure Plane",async n=>{var o;let i=YU(e.data),s=Wue({webgl:(o=r.canvas3d)===null||o===void 0?void 0:o.webgl,...r.representation.structure.themes},()=>s9);return await s.createOrUpdate(t,i).runInContext(n),new fe.Shape.Representation3D({repr:s,sourceData:i},{label:"Plane"})})},update({a:e,b:t,oldParams:r,newParams:n},o){return ke.create("Structure Plane",async i=>{let s={...t.data.repr.props,...n},a=YU(e.data);return await t.data.repr.createOrUpdate(s,a).runInContext(i),t.data.sourceData=a,st.UpdateResult.Updated})}});var Je={Data:t5,Misc:r5,Model:pU,Volume:bU,Representation:a9,Shape:o9};function tS(e,t){if(e.ext==="bcif")try{let{encoder:r}=rb(t);if(r.startsWith("VolumeServer"))return"dscif";if(r.startsWith("volseg-volume-server"))return"segcif"}catch{}else if(e.ext==="cif"){let r=t;if(r.startsWith(`data_SERVER
#
_density_server_result`))return"dscif";if(r.startsWith(`data_SERVER
#
data_SEGMENTATION_DATA`))return"segcif";if(r.includes("atom_site_fract_x")||r.includes("atom_site.fract_x"))return"coreCif"}return-1}var Ku="Trajectory";function Bg(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}var Jze={label:"mmCIF",description:"mmCIF",category:Ku,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>e.ext==="mmcif"||e.ext==="mcif"?!0:e.ext==="cif"||e.ext==="bcif"?tS(e,t)===-1:!1,parse:async(e,t,r)=>{var n,o;let s=e.state.data.build().to(t).apply(Je.Data.ParseCif,void 0,{state:{isGhost:!0}}),a=await s.apply(Je.Model.TrajectoryFromMmCif,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0});return(((o=(n=s.selector.cell)===null||n===void 0?void 0:n.obj)===null||o===void 0?void 0:o.data.blocks.length)||0)>1&&e.state.data.updateCellState(s.ref,{isGhost:!1}),{trajectory:a}},visuals:Bg},eHe={label:"cifCore",description:"CIF Core",category:Ku,stringExtensions:["cif"],isApplicable:(e,t)=>e.ext==="cif"?tS(e,t)==="coreCif":!1,parse:async(e,t,r)=>{var n,o;let s=e.state.data.build().to(t).apply(Je.Data.ParseCif,void 0,{state:{isGhost:!0}}),a=await s.apply(Je.Model.TrajectoryFromCifCore,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0});return(((o=(n=s.selector.cell)===null||n===void 0?void 0:n.obj)===null||o===void 0?void 0:o.data.blocks.length)||0)>1&&e.state.data.updateCellState(s.ref,{isGhost:!1}),{trajectory:a}},visuals:Bg};function Jb(e,t){return async(r,n,o)=>({trajectory:await r.state.data.build().to(n).apply(e,t,{tags:o?.trajectoryTags}).commit({revertOnError:!0})})}var tHe={label:"PDB",description:"PDB",category:Ku,stringExtensions:["pdb","ent"],parse:Jb(Je.Model.TrajectoryFromPDB),visuals:Bg},rHe={label:"PDBQT",description:"PDBQT",category:Ku,stringExtensions:["pdbqt"],parse:Jb(Je.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:Bg},nHe={label:"XYZ",description:"XYZ",category:Ku,stringExtensions:["xyz"],parse:Jb(Je.Model.TrajectoryFromXYZ),visuals:Bg},oHe={label:"GRO",description:"GRO",category:Ku,stringExtensions:["gro"],binaryExtensions:[],parse:Jb(Je.Model.TrajectoryFromGRO),visuals:Bg},iHe={label:"MOL",description:"MOL",category:Ku,stringExtensions:["mol"],parse:Jb(Je.Model.TrajectoryFromMOL),visuals:Bg},sHe={label:"SDF",description:"SDF",category:Ku,stringExtensions:["sdf","sd"],parse:Jb(Je.Model.TrajectoryFromSDF),visuals:Bg},aHe={label:"MOL2",description:"MOL2",category:Ku,stringExtensions:["mol2"],parse:Jb(Je.Model.TrajectoryFromMOL2),visuals:Bg},lk=[["mmcif",Jze],["cifCore",eHe],["pdb",tHe],["pdbqt",rHe],["gro",oHe],["xyz",nHe],["mol",iHe],["sdf",sHe],["mol2",aHe]];var tr;(function(e){class t extends fe.Create({name:"Root",typeClass:"Root"}){}e.Root=t;class r extends fe.Create({name:"Category",typeClass:"Object"}){}e.Category=r;class n extends fe.CreateBehavior({name:"Behavior"}){}e.Behavior=n,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=Lt.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:r,params:{label:M.Text("",{isHidden:!0})}})({apply({params:u}){return new r({},{label:u.label})}});let o=new Map;function i(u){return o.get(u.id)}e.getCategoryId=i;function s(u){let d=Lt.CreateBuiltIn({name:u.name,display:u.display,from:[t],to:[n],params:u.params,apply({params:m},p){let h=u.label?u.label(m):{label:u.display.name,description:u.display.description};return new n(new u.ctor(p,m),h)},update({b:m,newParams:p}){return ke.create("Update Behavior",async()=>m.data.update?await m.data.update(p)?st.UpdateResult.Updated:st.UpdateResult.Unchanged:st.UpdateResult.Unchanged)},canAutoUpdate:u.canAutoUpdate});return o.set(d.id,u.category),d}e.create=s;function a(u,d){return class{register(){this.sub=u.subscribe(this.ctx,m=>d(m,this.ctx))}dispose(){this.sub&&this.sub.unsubscribe(),this.sub=void 0}constructor(m){this.ctx=m,this.sub=void 0}}}e.simpleCommandHandler=a;class l{subscribeCommand(d,m){this.subs.push(d.subscribe(this.ctx,m))}subscribeObservable(d,m){this.subs.push(d.subscribe(m))}track(d){this.subs.push(d)}dispose(){for(let d of this.subs)d.unsubscribe();this.subs=[]}update(d){return Au(d,this.params)?!1:(this.params=d,!0)}constructor(d,m){this.ctx=d,this.params=m,this.subs=[]}}e.Handler=l;class c{subscribeCommand(d,m){this.subs.push(d.subscribe(this.plugin,m))}subscribeObservable(d,m){let p=d.subscribe(m);return this.subs.push(p),{unsubscribe:()=>{let h=this.subs.indexOf(p);h>=0&&(this.subs.splice(h,1),p.unsubscribe())}}}dispose(){for(let d of this.subs)d.unsubscribe();this.subs=[]}constructor(d,m){this.plugin=d,this.params=m,this.subs=[]}}e.WithSubscribers=c})(tr||(tr={}));var l9={};Ui(l9,{ApplyAction:()=>tde,ClearHighlights:()=>sde,Highlight:()=>ide,RemoveObject:()=>rde,SetCurrentObject:()=>Jue,Snapshots:()=>ade,SyncBehaviors:()=>Que,ToggleExpanded:()=>nde,ToggleVisibility:()=>ode,Update:()=>ede,registerDefault:()=>dHe,setSubtreeVisibility:()=>vo});var Xu=class{constructor(){this.subs=void 0}subscribe(t,r){typeof this.subs>"u"&&(this.subs=[]);let n=t.subscribe(r);return this.subs.push(n),{unsubscribe:()=>{n&&this.subs&&om(this.subs,n)&&(n.unsubscribe(),n=void 0)}}}get ev(){return this._ev||(this._ev=Sc.create())}dispose(){if(this._ev&&this._ev.dispose(),this.subs){for(let t of this.subs)t.unsubscribe();this.subs=void 0}}},Na=class extends Xu{updateState(...t){let r=this.state,n=IK(r,t);return n!==r?(this._state=n,!0):!1}get state(){return this._state}constructor(t){super(),this._state=t}};var rS="4.3.0",que=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1716707835175);function lHe(e,t,r,n=1){e.width=Math.round(window.devicePixelRatio*n*t),e.height=Math.round(window.devicePixelRatio*n*r),Object.assign(e.style,{width:`${t}px`,height:`${r}px`})}function Zue(e,t,r=1){let n=window.innerWidth,o=window.innerHeight;t!==document.body&&(n=t.offsetWidth,o=t.offsetHeight),lHe(e,n,o,r)}function cHe(e,t,r,n){let o=atob(e.toDataURL(r,n).split(",")[1]),i=o.length,s=i>>2,a=new Uint8Array(i),l=new Uint32Array(a.buffer,0,s),c=0;for(let d=0;d<s;++d)l[d]=o.charCodeAt(c++)|o.charCodeAt(c++)<<8|o.charCodeAt(c++)<<16|o.charCodeAt(c++)<<24;let u=i&3;for(;u--;)a[c]=o.charCodeAt(c++);t(new Blob([a],{type:r||"image/png"}))}async function yw(e,t,r){return new Promise((n,o)=>{let i=s=>{s?n(s):o("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(i,t,r):cHe(e,i,t,r)})}var Zp=class e extends Na{getIndex(t){return this.state.entries.indexOf(t)}getEntry(t){if(t)return this.entryMap.get(t)}remove(t){let r=this.entryMap.get(t);r&&(r?.image&&this.plugin.managers.asset.delete(r.image),this.entryMap.delete(t),this.updateState({current:this.state.current===t?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(r))}),this.events.changed.next(void 0))}add(t){this.entryMap.set(t.snapshot.id,t),this.updateState({current:t.snapshot.id,entries:this.state.entries.push(t)}),this.events.changed.next(void 0)}replace(t,r,n){var o,i,s;let a=this.getEntry(t);if(!a)return;this.defaultSnapshotId=void 0,a?.image&&this.plugin.managers.asset.delete(a.image);let l=this.getIndex(a),c=e.Entry(r,{key:(o=n?.key)!==null&&o!==void 0?o:a.key,name:(i=n?.name)!==null&&i!==void 0?i:a.name,description:(s=n?.description)!==null&&s!==void 0?s:a.description,image:n?.image});this.entryMap.set(r.id,c),this.updateState({current:c.snapshot.id,entries:this.state.entries.set(l,c)}),this.events.changed.next(void 0)}move(t,r){let n=this.state.entries.size;if(n<2)return;let o=this.getEntry(t);if(!o)return;let i=this.getIndex(o),s=(i+r)%n;s<0&&(s+=n);let a=this.state.entries.get(s),l=this.state.entries.asMutable();l.set(s,o),l.set(i,a),this.updateState({current:o.snapshot.id,entries:l.asImmutable()}),this.events.changed.next(void 0)}update(t,r){var n,o,i;let s=this.getIndex(t);if(s<0)return;let a=this.state.entries.set(s,{...t,key:((n=r.key)===null||n===void 0?void 0:n.trim())||void 0,name:((o=r.name)===null||o===void 0?void 0:o.trim())||void 0,description:((i=r.description)===null||i===void 0?void 0:i.trim())||void 0});this.updateState({entries:a}),this.entryMap.set(t.snapshot.id,this.state.entries.get(s)),this.events.changed.next(void 0)}clear(){this.state.entries.size!==0&&(this.entryMap.forEach(t=>{t?.image&&this.plugin.managers.asset.delete(t.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:Df()}),this.events.changed.next(void 0))}applyKey(t){let r=this.state.entries.find(n=>n.key===t);r&&(this.updateState({current:r.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(r.snapshot))}setCurrent(t){let r=this.getEntry(t);return r&&(this.updateState({current:t}),this.events.changed.next(void 0)),r&&r.snapshot}getNextId(t,r){let n=this.state.entries.size;if(!t){if(n===0)return;let s=r===-1?n-1:0;return this.state.entries.get(s).snapshot.id}let o=this.getEntry(t);if(!o)return;let i=this.getIndex(o);if(!(i<0))return i=(i+r)%n,i<0&&(i+=n),this.state.entries.get(i).snapshot.id}async setStateSnapshot(t){t.version,rS,this.clear();let r=Df().asMutable();for(let s of t.entries)this.entryMap.set(s.snapshot.id,s),r.push(s);let n=t.current?t.current:t.entries.length>0?t.entries[0].snapshot.id:void 0;if(this.updateState({current:n,entries:r.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:t.playback?t.playback.nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),!n)return;let o=this.getEntry(n),i=o&&o.snapshot;if(i)return await this.plugin.state.setSnapshot(i),t.playback&&t.playback.isPlaying&&this.play(!0),i}async syncCurrent(t){var r,n;let o=this.state.entries.size===0,i=this.state.entries.size===1&&this.state.current&&this.state.current===this.defaultSnapshotId;if(!o&&!i)return;let s=this.plugin.state.getSnapshot(t?.params),a=((n=(r=t?.params)===null||r===void 0?void 0:r.image)!==null&&n!==void 0?n:this.plugin.state.snapshotParams.value.image)?await e.getCanvasImageAsset(this.plugin,`${s.id}-image.png`):void 0;if(o)this.add(e.Entry(s,{name:t?.name,description:t?.description,image:a}));else if(i){let l=this.getEntry(this.state.current);l?.image&&this.plugin.managers.asset.delete(l.image),this.replace(this.state.current,s,{image:a})}this.defaultSnapshotId=s.id}async getStateSnapshot(t){return await this.syncCurrent(t),{timestamp:+new Date,version:rS,name:t&&t.name,description:t&&t.description,current:this.state.current,playback:{isPlaying:!!(t&&t.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:this.state.entries.valueSeq().toArray()}}async serialize(t){let r=JSON.stringify(await this.getStateSnapshot({params:t?.params}),null,2);if(!t?.type||t.type==="json"||t.type==="molj")return new Blob([r],{type:"application/json;charset=utf-8"});{let n=new Uint8Array(Tx(r));g0(n,0,r);let o={"state.json":n},i=[];for(let{asset:a,file:l}of this.plugin.managers.asset.assets)i.push([a.id,a]),o[`assets/${a.id}`]=new Uint8Array(await l.arrayBuffer());if(i.length>0){let a=JSON.stringify(i,null,2),l=new Uint8Array(Tx(a));g0(l,0,a),o["assets.json"]=l}let s=await this.plugin.runTask($K(o));return new Blob([s],{type:"application/zip"})}}async open(t){try{let r=t.name.toLowerCase();if(r.endsWith("json")||r.endsWith("molj")){let n=await this.plugin.runTask(Tp(t,"string")),o=JSON.parse(n);e.isStateSnapshot(o)?await this.setStateSnapshot(o):e.isStateSnapshot(o.data)?await this.setStateSnapshot(o.data):await this.plugin.state.setSnapshot(o)}else{let n=await this.plugin.runTask(Tp(t,"zip")),o=Object.create(null);Ao(n,(l,c)=>{if(c==="state.json"||c==="assets.json")return;let u=c.substring(c.indexOf("/")+1);o[u]=l});let i=new File([n["state.json"]],"state.json"),s=await this.plugin.runTask(Tp(i,"string"));if(n["assets.json"]){let l=new File([n["assets.json"]],"assets.json"),c=JSON.parse(await this.plugin.runTask(Tp(l,"string")));for(let[u,d]of c)this.plugin.managers.asset.set(d,new File([o[u]],d.name))}let a=JSON.parse(s);await this.setStateSnapshot(a)}this.events.opened.next(void 0)}catch{this.plugin.log.error("Error reading state")}}play(t=!1){if(this.updateState({isPlaying:!0}),t){let r=this.getEntry(this.state.current);if(!r){this.next();return}this.events.changed.next(void 0);let n=r.snapshot,o=typeof n.durationInMs<"u"?n.durationInMs:this.state.nextSnapshotDelayInMs;this.timeoutHandle=setTimeout(this.next,o)}else this.next()}stop(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)}togglePlay(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()}dispose(){super.dispose(),this.entryMap.clear()}constructor(t){super({current:void 0,entries:Df(),isPlaying:!1,nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs}),this.plugin=t,this.entryMap=new Map,this.defaultSnapshotId=void 0,this.events={changed:this.ev(),opened:this.ev()},this.timeoutHandle=void 0,this.next=async()=>{this.timeoutHandle=void 0;let r=this.getNextId(this.state.current,1);if(!r||r===this.state.current){this.stop();return}let n=this.setCurrent(r);await this.plugin.state.setSnapshot(n);let o=typeof n.durationInMs<"u"?n.durationInMs:this.state.nextSnapshotDelayInMs;this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,o))}}};Zp.DefaultNextSnapshotDelayInMs=1500;(function(e){function t(o,i){return{timestamp:+new Date,snapshot:o,...i}}e.Entry=t;function r(o){let i=o;return!!i&&!!i.timestamp&&!!i.entries}e.isStateSnapshot=r;async function n(o,i){if(!o.helpers.viewportScreenshot)return;let s=o.helpers.viewportScreenshot.getPreview(512);if(!s)return;let a=await yw(s.canvas,"png"),l=new File([a],i),c={kind:"file",id:jr.create22(),name:i};return o.managers.asset.set(c,l),c}e.getCanvasImageAsset=n})(Zp||(Zp={}));function Kue(){let e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),o=e.getHours(),i=e.getMinutes(),s=e.getSeconds();return t+"-"+r+"-"+n+"-"+o+"-"+i+"-"+s}function uHe(e){window.open(e,"_blank")||(window.location.href=e)}function Xue(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{let r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(r)}}function ck(e,t="download"){if(e)if("download"in HTMLAnchorElement.prototype){let r=document.createElement("a");r.download=t,r.rel="noopener",typeof e=="string"?(r.href=e,Xue(r)):(r.href=URL.createObjectURL(e),setTimeout(()=>URL.revokeObjectURL(r.href),4e4),setTimeout(()=>Xue(r)))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{let r=window.navigator.userAgent,n=/Safari/i.test(r),o=/CriOS\/[\d]+/.test(r),i=s=>{uHe(o?s:s.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((n||o)&&FileReader)if(e instanceof Blob){let s=new FileReader;s.onloadend=()=>i(s.result),s.readAsDataURL(e)}else i(e);else{let s=URL.createObjectURL(typeof e=="string"?new Blob([e]):e);location.href=s,setTimeout(()=>URL.revokeObjectURL(s),4e4)}}}function Ty(e,t){return`${e}${e[e.length-1]==="/"||t[0]==="/"?"":"/"}${t}`}function qo(){let e=(t,r)=>t.commands.dispatch(e,r||{});return e.subscribe=(t,r)=>t.commands.subscribe(e,r),e.id=jr.create22(),e}var uk=class{constructor(){this.subs=new Map,this.disposing=!1}subscribe(t,r){let n=this.subs.get(t.id);return n||(n=[],this.subs.set(t.id,n)),n.push(r),{unsubscribe:()=>{let o=this.subs.get(t.id);if(!o)return;let i=o.indexOf(r);if(!(i<0)){for(let s=i+1;s<o.length;s++)o[s-1]=o[s];o.pop()}}}}dispatch(t,r){return new Promise((n,o)=>{if(this.disposing){o("disposed");return}if(!this.subs.get(t.id)){n();return}this.resolve({cmd:t,params:r,resolve:n,reject:o})})}dispose(){this.subs.clear()}async resolve(t){let r=this.subs.get(t.cmd.id);if(!r){t.resolve();return}try{for(let n of r)await n(t.params);t.resolve()}catch(n){t.reject(n)}}};var ht={State:{SetCurrentObject:qo(),ApplyAction:qo(),Update:qo(),RemoveObject:qo(),ToggleExpanded:qo(),ToggleVisibility:qo(),Snapshots:{Add:qo(),Replace:qo(),Move:qo(),Remove:qo(),Apply:qo(),Clear:qo(),Upload:qo(),Fetch:qo(),DownloadToFile:qo(),OpenFile:qo(),OpenUrl:qo()}},Interactivity:{Object:{Highlight:qo()},Structure:{Highlight:qo(),Select:qo()},ClearHighlights:qo()},Layout:{Update:qo()},Toast:{Show:qo(),Hide:qo()},Camera:{Reset:qo(),SetSnapshot:qo(),Focus:qo(),OrientAxes:qo(),ResetAxes:qo()},Canvas3D:{SetSettings:qo(),ResetSettings:qo()}};var Yue={get preferWebGl1(){if(typeof navigator>"u"||typeof window>"u")return!1;if(["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"].some(o=>navigator.userAgent.indexOf(o)>0))return!0;let t=/iPad|iPhone|iPod/.test(navigator.userAgent),r=navigator.userAgent.includes("Macintosh"),n=navigator.maxTouchPoints>=4;return!window.MSStream&&(t||r&&n)}};var Yf=class{toString(){return this.key}valueOf(){return this.key}constructor(t,r){this.key=t,this.defaultValue=r}};function fi(e,t){return new Yf(e,t)}var Ot={item:fi,General:{IsBusyTimeoutMs:fi("plugin-config.is-busy-timeout",750),DisableAntialiasing:fi("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:fi("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:fi("plugin-config.pixel-scale",1),PickScale:fi("plugin-config.pick-scale",.25),Transparency:fi("plugin-config.transparency","wboit"),PreferWebGl1:fi("plugin-config.prefer-webgl1",Yue.preferWebGl1),AllowMajorPerformanceCaveat:fi("plugin-config.allow-major-performance-caveat",!1),PowerPreference:fi("plugin-config.power-preference","high-performance")},State:{DefaultServer:fi("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:fi("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:fi("history-capacity.server",5)},VolumeStreaming:{Enabled:fi("volume-streaming.enabled",!0),DefaultServer:fi("volume-streaming.server","https://ds.litemol.org"),CanStream:fi("volume-streaming.can-stream",(e,t)=>e.models.length===1&&Ut.probablyHasDensityMap(e.models[0])),EmdbHeaderServer:fi("volume-streaming.emdb-header-server","https://files.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:fi("viewer.show-expand-button",!0),ShowControls:fi("viewer.show-controls-button",!0),ShowSettings:fi("viewer.show-settings-button",!0),ShowSelectionMode:fi("viewer.show-selection-model-button",!0),ShowAnimation:fi("viewer.show-animation-button",!0),ShowTrajectoryControls:fi("viewer.show-trajectory-controls",!0)},Download:{DefaultPdbProvider:fi("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:fi("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:fi("structure.size-thresholds",qe.DefaultSizeThresholds),DefaultRepresentationPreset:fi("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:fi("structure.default-representation-preset-params",{}),SaccharideCompIdMapType:fi("structure.saccharide-comp-id-map-type","default")},Background:{Styles:fi("background.styles",[])}},dk=class{get(t){return this._config.has(t)?this._config.get(t):t.defaultValue}set(t,r){this._config.set(t,r)}delete(t){this._config.delete(t)}constructor(t){this._config=new Map,t&&t.forEach(([r,n])=>this._config.set(r,n))}};function dHe(e){Que(e),Jue(e),ede(e),tde(e),rde(e),nde(e),ode(e),ide(e),sde(e),ade(e)}function Que(e){e.state.events.object.created.subscribe(t=>{fe.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(t=>{var r,n,o,i;fe.isBehavior(t.obj)&&((n=(r=t.obj.data).unregister)===null||n===void 0||n.call(r),(i=(o=t.obj.data).dispose)===null||i===void 0||i.call(o))}),e.state.events.object.updated.subscribe(t=>{var r,n,o,i;t.action==="recreate"&&(t.oldObj&&fe.isBehavior(t.oldObj)&&((n=(r=t.oldObj.data).unregister)===null||n===void 0||n.call(r),(i=(o=t.oldObj.data).dispose)===null||i===void 0||i.call(o)),t.obj&&fe.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function Jue(e){ht.State.SetCurrentObject.subscribe(e,({state:t,ref:r})=>t.setCurrent(r))}function ede(e){ht.State.Update.subscribe(e,({state:t,tree:r,options:n})=>e.runTask(t.updateTree(r,n)))}function tde(e){ht.State.ApplyAction.subscribe(e,({state:t,action:r,ref:n})=>e.runTask(t.applyAction(r.action,r.params,n)))}function rde(e){function t(r,n){let o=r.build().delete(n);return e.runTask(r.updateTree(o))}ht.State.RemoveObject.subscribe(e,({state:r,ref:n,removeParentGhosts:o})=>{if(o){let i=r.tree,s=i.transforms.get(n);if(s.parent===n)return t(r,n);for(;;){let a=i.children.get(s.parent);if(s.parent===s.ref||a.size>1)return t(r,s.ref);let l=i.transforms.get(s.parent);if(!l.state.isGhost)return t(r,s.ref);s=l}}else return t(r,n)})}function nde(e){ht.State.ToggleExpanded.subscribe(e,({state:t,ref:r})=>t.updateCellState(r,({isCollapsed:n})=>({isCollapsed:!n})))}function ode(e){ht.State.ToggleVisibility.subscribe(e,({state:t,ref:r})=>vo(t,r,!t.cells.get(r).state.isHidden))}function vo(e,t,r){mi.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:r},mHe)}function mHe(e,t,r){r.state.updateCellState(e.ref,{isHidden:r.value})}function ide(e){ht.Interactivity.Object.Highlight.subscribe(e,({state:t,ref:r})=>{if(!e.canvas3d||e.isBusy)return;e.managers.interactivity.lociHighlights.clearHighlights();let n=typeof r=="string"?[r]:r;for(let o of n){let i=t.cells.get(o);if(i){if(fe.Molecule.Structure.is(i.obj))e.managers.interactivity.lociHighlights.highlight({loci:qe.Loci(i.obj.data)},!1);else if(i&&fe.isRepresentation3D(i.obj)){let{repr:s}=i.obj.data;for(let a of s.getAllLoci())e.managers.interactivity.lociHighlights.highlight({loci:a,repr:s},!1)}else if(fe.Molecule.Structure.Selections.is(i.obj))for(let s of i.obj.data)e.managers.interactivity.lociHighlights.highlight({loci:s.loci},!1)}}})}function sde(e){ht.Interactivity.ClearHighlights.subscribe(e,()=>{e.managers.interactivity.lociHighlights.clearHighlights()})}function ade(e){e.config.set(Ot.State.CurrentServer,e.config.get(Ot.State.DefaultServer)),ht.State.Snapshots.Clear.subscribe(e,()=>{e.managers.snapshot.clear()}),ht.State.Snapshots.Remove.subscribe(e,({id:t})=>{e.managers.snapshot.remove(t)}),ht.State.Snapshots.Add.subscribe(e,async({key:t,name:r,description:n,params:o})=>{var i;let s=e.state.getSnapshot(o),a=((i=o?.image)!==null&&i!==void 0?i:e.state.snapshotParams.value.image)?await Zp.getCanvasImageAsset(e,`${s.id}-image.png`):void 0,l=Zp.Entry(s,{key:t,name:r,description:n,image:a});e.managers.snapshot.add(l)}),ht.State.Snapshots.Replace.subscribe(e,async({id:t,params:r})=>{var n;let o=e.state.getSnapshot(r),i=((n=r?.image)!==null&&n!==void 0?n:e.state.snapshotParams.value.image)?await Zp.getCanvasImageAsset(e,`${o.id}-image.png`):void 0;e.managers.snapshot.replace(t,e.state.getSnapshot(r),{image:i})}),ht.State.Snapshots.Move.subscribe(e,({id:t,dir:r})=>{e.managers.snapshot.move(t,r)}),ht.State.Snapshots.Apply.subscribe(e,({id:t})=>{let r=e.managers.snapshot.setCurrent(t);if(r)return e.state.setSnapshot(r)}),ht.State.Snapshots.Upload.subscribe(e,async({name:t,description:r,playOnLoad:n,serverUrl:o,params:i})=>fetch(Ty(o,`set?name=${encodeURIComponent(t||"")}&description=${encodeURIComponent(r||"")}`),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(await e.managers.snapshot.getStateSnapshot({name:t,description:r,playOnLoad:n}))})),ht.State.Snapshots.Fetch.subscribe(e,async({url:t})=>{let r=await e.runTask(e.fetch({url:t,type:"json"}));await e.managers.snapshot.setStateSnapshot(r.data)}),ht.State.Snapshots.DownloadToFile.subscribe(e,async({name:t,type:r,params:n})=>{let o=`mol-star_state_${t||Kue()}.${r==="json"?"molj":"molx"}`,i=await e.managers.snapshot.serialize({type:r,params:n});ck(i,`${o}`)}),ht.State.Snapshots.OpenFile.subscribe(e,({file:t})=>e.managers.snapshot.open(t)),ht.State.Snapshots.OpenUrl.subscribe(e,async({url:t,type:r})=>{let n=await e.runTask(e.fetch({url:t,type:"binary"}));return e.managers.snapshot.open(new File([n],`state.${r}`))})}var u9={};Ui(u9,{SyncRepresentationToCanvas:()=>lde,SyncStructureRepresentation3DState:()=>cde,UpdateRepresentationVisibility:()=>ude,registerDefault:()=>pHe});function pHe(e){lde(e),cde(e),ude(e)}function lde(e){let t=e.state.data.events;t.object.created.subscribe(r=>{var n;fe.isRepresentation3D(r.obj)&&(c9(r.state.cells.get(r.ref),r.obj.data.repr),r.obj.data.repr.setState({syncManually:!0}),(n=e.canvas3d)===null||n===void 0||n.add(r.obj.data.repr))}),t.object.updated.subscribe(r=>{var n,o;r.oldObj&&fe.isRepresentation3D(r.oldObj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.oldObj.data.repr),r.oldObj.data.repr.destroy()),fe.isRepresentation3D(r.obj)&&(c9(r.state.cells.get(r.ref),r.obj.data.repr),r.action==="recreate"&&r.obj.data.repr.setState({syncManually:!0}),(o=e.canvas3d)===null||o===void 0||o.add(r.obj.data.repr))}),t.object.removed.subscribe(r=>{var n;fe.isRepresentation3D(r.obj)&&((n=e.canvas3d)===null||n===void 0||n.remove(r.obj.data.repr),r.obj.data.repr.destroy())})}function cde(e){let t=e.state.data.events;t.object.created.subscribe(r=>{var n;if(!fe.Molecule.Structure.Representation3DState.is(r.obj))return;let o=r.obj.data;o.repr.setState(o.state),(n=e.canvas3d)===null||n===void 0||n.update(o.repr)}),t.object.updated.subscribe(r=>{var n;if(!fe.Molecule.Structure.Representation3DState.is(r.obj))return;let o=r.obj.data;o.repr.setState(o.state),(n=e.canvas3d)===null||n===void 0||n.update(o.repr)}),t.object.removed.subscribe(r=>{var n;if(!fe.Molecule.Structure.Representation3DState.is(r.obj))return;let o=r.obj.data;o.repr.setState(o.initialState),(n=e.canvas3d)===null||n===void 0||n.update(o.repr)})}function ude(e){e.state.data.events.cell.stateUpdated.subscribe(t=>{var r;let n=t.state.cells.get(t.ref);fe.isRepresentation3D(n.obj)&&c9(n,n.obj.data.repr)&&((r=e.canvas3d)===null||r===void 0||r.syncVisibility())})}function c9(e,t){return t.state.visible===!!e.state.isHidden?(t.setState({visible:!e.state.isHidden}),!0):!1}var d9={};Ui(d9,{Focus:()=>pde,OrientAxes:()=>fde,Reset:()=>dde,ResetAxes:()=>hde,SetSnapshot:()=>mde,registerDefault:()=>fHe});function fHe(e){dde(e),pde(e),mde(e),fde(e),hde(e)}function dde(e){ht.Camera.Reset.subscribe(e,t=>{e.managers.camera.reset(t?.snapshot,t?.durationMs)})}function mde(e){ht.Camera.SetSnapshot.subscribe(e,({snapshot:t,durationMs:r})=>{e.managers.camera.setSnapshot(t,r)})}function pde(e){ht.Camera.Focus.subscribe(e,({center:t,radius:r,durationMs:n})=>{e.managers.camera.focusSphere({center:t,radius:r},{durationMs:n}),e.events.canvas3d.settingsUpdated.next(void 0)})}function fde(e){ht.Camera.OrientAxes.subscribe(e,({structures:t,durationMs:r})=>{e.managers.camera.orientAxes(t,r)})}function hde(e){ht.Camera.ResetAxes.subscribe(e,({durationMs:t})=>{e.managers.camera.resetAxes(t)})}var A9={};Ui(A9,{Canvas3DSetSettings:()=>Tme,registerDefault:()=>kje});function Zo(){return Zo.zero()}(function(e){function t(){return{x:0,y:0,width:0,height:0}}e.zero=t;function r(l,c,u,d){return{x:l,y:c,width:u,height:d}}e.create=r;function n(l){return{...l}}e.clone=n;function o(l,c){return Object.assign(l,c)}e.copy=o;function i(l,c,u,d,m){return l.x=c,l.y=u,l.width=d,l.height=m,l}e.set=i;function s(l,c){return l[0]=c.x,l[1]=c.y,l[2]=c.width,l[3]=c.height,l}e.toVec4=s;function a(l,c){return l.x===c.x&&l.y===c.y&&l.width===c.width&&l.height===c.height}e.equals=a})(Zo||(Zo={}));var Qf=Ht();function gde(e,t,r,n){let{x:o,y:i,width:s,height:a}=r;Ht.set(Qf,t[0],t[1],t[2],1),Ht.transformMat4(Qf,Qf,n);let l=Qf[3];return l!==0&&(Qf[0]/=l,Qf[1]/=l,Qf[2]/=l),e[0]=(Qf[0]+1)*s*.5+o,e[1]=(Qf[1]+1)*a*.5+i,e[2]=(Qf[2]+1)*.5,e[3]=l===0?0:1/l,e}function nS(e,t,r,n){let{x:o,y:i,width:s,height:a}=r,l=t[0]-o,c=t[1]-i,u=t[2];return e[0]=2*l/s-1,e[1]=2*c/a-1,e[2]=2*u-1,D.transformMat4(e,e,n)}function Py(e){if(typeof e=="object"){if("buttons"in e)return e.buttons;if("which"in e){let t=e.which;if(t===2)return 4;if(t===3)return 2;if(t>0)return 1<<t-1}}return 0}function e1(e){if(typeof e=="object"&&"button"in e){let t=e.button;if(t===1)return 4;if(t===2)return 2;if(t>=0)return 1<<t}return 0}function vw(e){return{alt:"altKey"in e?e.altKey:!1,shift:"shiftKey"in e?e.shiftKey:!1,control:"ctrlKey"in e?e.ctrlKey:!1,meta:"metaKey"in e?e.metaKey:!1}}var yde={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:(e,t)=>!0,pixelScale:1},nl;(function(e){e.None=o();function t(i,s){return i.shift===s.shift&&i.alt===s.alt&&i.control===s.control&&i.meta===s.meta}e.areEqual=t;function r(i){return t(i,e.None)}e.areNone=r;function n(i){if(!i)return 0;let s=0;return i.shift&&s++,i.alt&&s++,i.control&&s++,i.meta&&s++,s}e.size=n;function o(i={}){return{shift:!!i.shift,alt:!!i.alt,control:!!i.control,meta:!!i.meta}}e.create=o})(nl||(nl={}));var Vo;(function(e){e.has=zi.has,e.create=zi.create;let t;(function(r){r[r.None=0]="None",r[r.Primary=1]="Primary",r[r.Secondary=2]="Secondary",r[r.Auxilary=4]="Auxilary",r[r.Forth=8]="Forth",r[r.Five=16]="Five"})(t=e.Flag||(e.Flag={}))})(Vo||(Vo={}));var m9={key:"",code:"",modifiers:nl.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:vc},Ey;(function(e){e[e.Stopped=0]="Stopped",e[e.Started=1]="Started",e[e.Moving=2]="Moving"})(Ey||(Ey={}));function vde(){return{drag:new Vn,interactionEnd:new Vn,click:new Vn,move:new Vn,wheel:new Vn,pinch:new Vn,gesture:new Vn,resize:new Vn,leave:new Vn,enter:new Vn,modifiers:new Vn,key:new Vn,keyUp:new Vn,keyDown:new Vn,lock:new Vn}}var hHe=["Backspace","Delete"],mk;(function(e){function t(n={}){let{noScroll:o,noContextMenu:i}={...yde,...n};return{noScroll:o,noContextMenu:i,pointerLock:!1,width:0,height:0,pixelRatio:1,...vde(),setPixelScale:vc,requestPointerLock:vc,exitPointerLock:vc,dispose:vc}}e.create=t;function r(n,o={}){let{noScroll:i,noMiddleClickScroll:s,noContextMenu:a,noPinchZoom:l,noTextSelect:c,mask:u,pixelScale:d,preventGestures:m}={...yde,...o},p=n.clientWidth*E(),h=n.clientHeight*E(),f=!1,C=Zo(),g=0,b=0,y=Ve(),x=Ve(),A=Ve(),v=Ve(),_=Ve(),I={shift:!1,alt:!1,control:!1,meta:!1},T={x:-1,y:-1,pageX:-1,pageY:-1};function E(){return window.devicePixelRatio*d}function w(){return{...I}}function S(Ie){return Ie.target===document.body||Ie.target===n}let P=Ey.Stopped,k=!1,L=Vo.create(Vo.Flag.None),R=Vo.Flag.None,N=!1,F=!1,H;typeof window.ResizeObserver<"u"&&(H=new window.ResizeObserver(St));let V=vde(),{drag:q,interactionEnd:Q,wheel:O,pinch:B,gesture:j,click:U,move:z,leave:$,enter:Z,resize:J,modifiers:ie,key:ne,keyUp:le,keyDown:ee,lock:oe}=V;te();function te(){n.addEventListener("contextmenu",re,!1),n.addEventListener("wheel",be,!1),n.addEventListener("mousedown",Ne,!1),window.addEventListener("mousemove",je,!1),window.addEventListener("mouseup",Ye,!1),n.addEventListener("touchstart",Ke,!1),n.addEventListener("touchmove",pt,!1),n.addEventListener("touchend",rt,!1),n.addEventListener("gesturechange",We,!1),n.addEventListener("gesturestart",Ce,!1),n.addEventListener("gestureend",It,!1),window.addEventListener("blur",me),window.addEventListener("keyup",ae,!1),window.addEventListener("keydown",Y,!1),window.addEventListener("keypress",ve,!1),document.addEventListener("pointerlockchange",W,!1),document.addEventListener("pointerlockerror",K,!1),H!=null?H.observe(n.parentElement):window.addEventListener("resize",St,!1)}function X(){k||(k=!0,n.removeEventListener("contextmenu",re,!1),n.removeEventListener("wheel",be,!1),n.removeEventListener("mousedown",Ne,!1),window.removeEventListener("mousemove",je,!1),window.removeEventListener("mouseup",Ye,!1),n.removeEventListener("touchstart",Ke,!1),n.removeEventListener("touchmove",pt,!1),n.removeEventListener("touchend",rt,!1),n.removeEventListener("gesturechange",We,!1),n.removeEventListener("gesturestart",Ce,!1),n.removeEventListener("gestureend",It,!1),window.removeEventListener("blur",me),window.removeEventListener("keyup",ae,!1),window.removeEventListener("keydown",Y,!1),window.removeEventListener("keypress",ve,!1),document.removeEventListener("pointerlockchange",W,!1),document.removeEventListener("pointerlockerror",K,!1),qn.remove(),H!=null?(H.unobserve(n.parentElement),H.disconnect()):window.removeEventListener("resize",St,!1))}function W(){n.ownerDocument.pointerLockElement===n?f=!0:f=!1,Me(f),oe.next(f)}function K(){f=!1,Me(f),oe.next(f)}function re(Ie){u(Ie.clientX,Ie.clientY)&&a&&Ie.preventDefault()}function se(Ie){I.alt=Ie.altKey,I.shift=Ie.shiftKey,I.control=Ie.ctrlKey,I.meta=Ie.metaKey}function me(){(L||I.shift||I.alt||I.meta||I.control)&&(L=0,I.shift=I.alt=I.control=I.meta=!1)}function Y(Ie){let et=!1;!I.alt&&Ie.altKey&&(et=!0,I.alt=!0),!I.shift&&Ie.shiftKey&&(et=!0,I.shift=!0),!I.control&&Ie.ctrlKey&&(et=!0,I.control=!0),!I.meta&&Ie.metaKey&&(et=!0,I.meta=!0),et&&N&&ie.next(w()),S(Ie)&&N&&ee.next({key:Ie.key,code:Ie.code,modifiers:w(),...T,preventDefault:()=>Ie.preventDefault()})}function ae(Ie){let et=!1;I.alt&&!Ie.altKey&&(et=!0,I.alt=!1),I.shift&&!Ie.shiftKey&&(et=!0,I.shift=!1),I.control&&!Ie.ctrlKey&&(et=!0,I.control=!1),I.meta&&!Ie.metaKey&&(et=!0,I.meta=!1),et&&N&&ie.next(w()),hHe.includes(Ie.key)&&ve(Ie),S(Ie)&&N&&le.next({key:Ie.key,code:Ie.code,modifiers:w(),...T,preventDefault:()=>Ie.preventDefault()})}function ve(Ie){!S(Ie)||!N||ne.next({key:Ie.key,code:Ie.code,modifiers:w(),...T,preventDefault:()=>Ie.preventDefault()})}function ge(Ie){let et=Ie.touches[0],Ue=Ie.touches[1];return{clientX:(et.clientX+Ue.clientX)/2,clientY:(et.clientY+Ue.clientY)/2,pageX:(et.pageX+Ue.pageX)/2,pageY:(et.pageY+Ue.pageY)/2,target:Ie.target}}function Se(Ie){let et=Ie.touches[0].pageX-Ie.touches[1].pageX,Ue=Ie.touches[0].pageY-Ie.touches[1].pageY;return Math.sqrt(et*et+Ue*Ue)}let Ee=-1,Fe,Ae=Ve(),we=Ve();function _e(Ie){Ee<0||(Ve.set(we,Ie.touches[0].pageX,Ie.touches[0].pageY),Ee+=Ve.distance(Ae,we),Ve.copy(Ae,we))}function Ke(Ie){if(Ie.preventDefault(),Fe=void 0,Ee=-1,Ie.touches.length===1)Ee=0,Ve.set(Ae,Ie.touches[0].pageX,Ie.touches[0].pageY),Fe=Ie.touches[0],L=R=Vo.Flag.Primary,vt(Ie.touches[0]);else if(Ie.touches.length===2){L=Vo.Flag.Secondary&Vo.Flag.Auxilary,R=Vo.Flag.Secondary,vt(ge(Ie));let et=Se(Ie);g=et,B.next({distance:et,fraction:1,fractionDelta:0,delta:0,isStart:!0,buttons:L,button:R,modifiers:w()})}else Ie.touches.length===3&&(L=R=Vo.Flag.Forth,vt(ge(Ie)))}function rt(Ie){if(mt(),Fe&&Ee<=4){let et=Fe;if(!u(et.clientX,et.clientY))return;Xr(we,et);let{pageX:Ue,pageY:ft}=mn(et),[Dt,vr]=we;U.next({x:Dt,y:vr,pageX:Ue,pageY:ft,buttons:L,button:R,modifiers:w()})}Fe=void 0}function pt(Ie){if(R=Vo.Flag.None,l&&(Ie.preventDefault(),Ie.stopPropagation(),Ie.originalEvent&&(Ie.originalEvent.preventDefault(),Ie.originalEvent.stopPropagation())),Fe=void 0,Ie.touches.length===1)L=Vo.Flag.Primary,Fe=Ie.touches[0],_e(Ie),$e(Ie.touches[0]);else if(Ie.touches.length===2){let et=Se(Ie),Ue=g-et;if(Math.abs(Ue)<4)L=Vo.Flag.Secondary,$e(ge(Ie));else{L=Vo.Flag.Auxilary,se(Ie);let ft=g/et;B.next({delta:Ue,fraction:ft,fractionDelta:b-ft,distance:et,isStart:!1,buttons:L,button:R,modifiers:w()}),b=ft}g=et}else Ie.touches.length===3&&(L=Vo.Flag.Forth,$e(ge(Ie)))}function Ne(Ie){se(Ie),L=Py(Ie),R=e1(Ie),s&&L===Vo.Flag.Auxilary&&Ie.preventDefault,vt(Ie)}function je(Ie){se(Ie),L=Py(Ie),R=Vo.Flag.None,$e(Ie)}function Ye(Ie){se(Ie),L=Py(Ie),R=e1(Ie),yt(Ie),mt()}function mt(){Q.next(void 0)}function vt(Ie){u(Ie.clientX,Ie.clientY)&&(Xr(x,Ie),Ve.copy(y,x),Yt(x)&&(P=Ey.Started))}function yt(Ie){if(P=Ey.Stopped,!!u(Ie.clientX,Ie.clientY)){if(Xr(A,Ie),!F&&Ve.distance(A,y)<4){let{pageX:et,pageY:Ue}=mn(Ie),[ft,Dt]=A;U.next({x:ft,y:Dt,pageX:et,pageY:Ue,buttons:L,button:R,modifiers:w()})}F=!1}}function $e(Ie){var et;Xr(A,Ie);let{pageX:Ue,pageY:ft}=mn(Ie),[Dt,vr]=A,{movementX:nn,movementY:co}=Ie,Jr=Yt(A)&&u(Ie.clientX,Ie.clientY);if(N&&!Jr?$.next(void 0):!N&&Jr&&Z.next(void 0),N=Jr,T.x=Dt,T.y=vr,T.pageX=Ue,T.pageY=ft,z.next({x:Dt,y:vr,pageX:Ue,pageY:ft,movementX:nn,movementY:co,buttons:L,button:R,modifiers:w(),inside:Jr,onElement:Ie.target===n}),P===Ey.Stopped||(c&&((et=Ie.preventDefault)===null||et===void 0||et.call(Ie)),Ve.div(v,Ve.sub(v,A,x),sr(_)),Ve.magnitude(v)<1e-6))return;let Yn=P===Ey.Started;if(Yn&&!u(Ie.clientX,Ie.clientY))return;Ve.distance(A,y)>=4&&(F=!0);let[vi,Fo]=v;q.next({x:Dt,y:vr,dx:vi,dy:Fo,pageX:Ue,pageY:ft,buttons:L,button:R,modifiers:w(),isStart:Yn}),Ve.copy(x,A),P=Ey.Moving}function be(Ie){if(!u(Ie.clientX,Ie.clientY))return;Xr(A,Ie);let{pageX:et,pageY:Ue}=mn(Ie),[ft,Dt]=A;i&&Ie.preventDefault();let vr=gHe(Ie);L=R=Vo.Flag.Auxilary,(vr.dx||vr.dy||vr.dz)&&O.next({x:ft,y:Dt,pageX:et,pageY:Ue,...vr,buttons:L,button:R,modifiers:w()})}function Te(Ie){var et,Ue;m&&(Ie.preventDefault(),(et=Ie.stopImmediatePropagation)===null||et===void 0||et.call(Ie),(Ue=Ie.stopPropagation)===null||Ue===void 0||Ue.call(Ie))}let De=0,pe=0;function Ce(Ie){Te(Ie),De=Ie.scale,pe=Ie.rotation,j.next({scale:Ie.scale,rotation:Ie.rotation,deltaRotation:0,deltaScale:0,isStart:!0})}function he(Ie,et){j.next({scale:Ie.scale,rotation:Ie.rotation,deltaRotation:pe-Ie.rotation,deltaScale:De-Ie.scale,isEnd:et}),pe=Ie.rotation,De=Ie.scale}function We(Ie){Te(Ie),he(Ie)}function It(Ie){Te(Ie),he(Ie,!0)}function St(){p=n.clientWidth*E(),h=n.clientHeight*E(),J.next({})}function Yt(Ie){if(n instanceof Window||n instanceof Document||n===document.body)return!0;{let et=n.getBoundingClientRect();return Ie[0]>=0&&Ie[1]>=0&&Ie[0]<et.width&&Ie[1]<et.height}}function sr(Ie){return Ie[0]=n.clientWidth,Ie[1]=n.clientHeight,Ie}function Xr(Ie,et){if(p=n.clientWidth*E(),h=n.clientHeight*E(),f){let Ue=E();Ie[0]=(C.x+C.width/2)/Ue,Ie[1]=(h-(C.y+C.height/2))/Ue}else{let Ue=n.getBoundingClientRect();Ie[0]=(et.clientX||0)-Ue.left,Ie[1]=(et.clientY||0)-Ue.top}return Ie}function mn(Ie){return f?{pageX:Math.round(window.innerWidth/2)+C.x,pageY:Math.round(window.innerHeight/2)+C.y}:{pageX:Ie.pageX,pageY:Ie.pageY}}let no=30,qn=Ze();function Ze(){var Ie;let et=document.createElement("div"),Ue="30%",ft="10%",Dt=`#000 ${Ue}, #0000 0 calc(100% - ${Ue}), #000 0`,vr=`linear-gradient(0deg, ${Dt}) 50%/${ft} 100% no-repeat`,nn=`linear-gradient(90deg, ${Dt}) 50%/100% ${ft} no-repeat`;return Object.assign(et.style,{width:`${no}px`,aspectRatio:1,background:`${vr}, ${nn}, radial-gradient(circle at 50%, #000 5%, #0000 5%)`,display:"none",zIndex:1e3,position:"absolute",mixBlendMode:"difference",filter:"invert(1)"}),(Ie=n.parentElement)===null||Ie===void 0||Ie.appendChild(et),et}function Me(Ie){if(qn.style.display=Ie?"block":"none",Ie){let et=E(),Ue=(C.x+C.width/2)/et,ft=(C.y+C.height/2)/et;qn.style.width=`${no}px`,qn.style.left=`calc(${Ue}px - ${no/2}px)`,qn.style.bottom=`calc(${ft}px - ${no/2}px)`}}return{get noScroll(){return i},set noScroll(Ie){i=Ie},get noContextMenu(){return a},set noContextMenu(Ie){a=Ie},get width(){return p},get height(){return h},get pixelRatio(){return E()},get pointerLock(){return f},...V,setPixelScale:Ie=>{d=Ie,p=n.clientWidth*E(),h=n.clientHeight*E()},requestPointerLock:Ie=>{C=Ie,f||n.requestPointerLock()},exitPointerLock:()=>{f&&n.ownerDocument.exitPointerLock()},dispose:X}}e.fromElement=r})(mk||(mk={}));function gHe(e){let o=0,i=0,s=0,a=0,l=0;return"detail"in e&&(i=e.detail),"wheelDelta"in e&&(i=-e.wheelDelta/120),"wheelDeltaY"in e&&(i=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(o=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(o=i,i=0),s=o*10,a=i*10,"deltaY"in e&&(a=e.deltaY),"deltaX"in e&&(s=e.deltaX),"deltaZ"in e&&(l=e.deltaZ),(s||a||l)&&e.deltaMode&&(e.deltaMode===1?(s*=40,a*=40,l*=40):(s*=800,a*=800,l*=800)),s&&!o&&(o=s<1?-1:1),a&&!i&&(i=a<1?-1:1),{spinX:o,spinY:i,dx:s,dy:a,dz:l}}var Lg;(function(e){e[e.None=0]="None",e[e.Object=1]="Object",e[e.Instance=2]="Instance",e[e.Group=3]="Group"})(Lg||(Lg={}));var bw;(function(e){e[e.None=0]="None",e[e.Depth=1]="Depth",e[e.Mask=2]="Mask"})(bw||(bw={}));var pk={backgroundColor:M.Color(ze(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:M.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:M.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:M.Boolean(!0,{label:"Use Interior Color"}),interiorColor:M.Color(ze.fromNormalizedRgb(.3,.3,.3)),colorMarker:M.Boolean(!0,{description:"Enable color marker"}),highlightColor:M.Color(ze.fromNormalizedRgb(1,.4,.6)),selectColor:M.Color(ze.fromNormalizedRgb(.2,1,.1)),dimColor:M.Color(ze.fromNormalizedRgb(1,1,1)),highlightStrength:M.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:M.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:M.Numeric(0,{min:0,max:1,step:.1}),markerPriority:M.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:M.Numeric(1,{min:0,max:3,step:.1}),exposure:M.Numeric(1,{min:0,max:3,step:.01}),light:M.ObjectList({inclination:M.Numeric(150,{min:0,max:180,step:1}),azimuth:M.Numeric(320,{min:0,max:360,step:1}),color:M.Color(ze.fromNormalizedRgb(1,1,1)),intensity:M.Numeric(.6,{min:0,max:5,step:.01})},e=>ze.toHexString(e.color),{defaultValue:[{inclination:150,azimuth:320,color:ze.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:M.Color(ze.fromNormalizedRgb(1,1,1)),ambientIntensity:M.Numeric(.4,{min:0,max:2,step:.01})},bde=D(),p9=D();function xde(e,t){let r=e.length,{direction:n,color:o}=t||{direction:new Array(r*3).fill(0),color:new Array(r*3).fill(0)};for(let i=0;i<r;++i){let s=e[i];D.directionFromSpherical(bde,Pr(s.inclination),Pr(s.azimuth),1),D.toArray(bde,n,i*3),D.scale(p9,ze.toVec3Normalized(p9,s.color),s.intensity),D.toArray(p9,o,i*3)}return{count:r,direction:n,color:o}}var fk;(function(e){function t(r,n={}){let{gl:o,state:i,stats:s}=r,a=M.merge(pk,M.getDefaultValues(pk),n),l=xde(a.light),c=Zo(),u=Ve.create(o.drawingBufferWidth,o.drawingBufferHeight),d=ze.toVec3Normalized(D(),a.backgroundColor),m=!1,p=null,h=r.resources.texture("image-uint8","rgba","ubyte","nearest");h.define(1,1),h.load({array:new Uint8Array([255,255,255,255]),width:1,height:1});let f=[["tDepth",h]],C=de(),g=de(),b=de(),y=de(),x=de(),A=de(),v=de(),_=D(),I=D(),T=Si(),E=Ve(),w=mg(),S=D();D.scale(S,ze.toArrayNormalized(a.ambientColor,S,0),a.ambientIntensity);let P={uDrawId:G.create(0),uModel:G.create(de.identity()),uView:G.create(C),uInvView:G.create(g),uModelView:G.create(b),uInvModelView:G.create(y),uInvProjection:G.create(x),uProjection:G.create(de()),uModelViewProjection:G.create(A),uInvModelViewProjection:G.create(v),uIsOrtho:G.create(1),uViewOffset:G.create(E),uPixelRatio:G.create(r.pixelRatio),uViewport:G.create(Zo.toVec4(Ht(),c)),uDrawingBufferSize:G.create(u),uCameraPosition:G.create(I),uCameraDir:G.create(_),uCameraPlane:G.create(Si.toArray(T,Ht(),0)),uNear:G.create(1),uFar:G.create(1e4),uFog:G.create(!0),uFogNear:G.create(1),uFogFar:G.create(1e4),uFogColor:G.create(d),uRenderMask:G.create(0),uMarkingDepthTest:G.create(!1),uPickType:G.create(Lg.None),uMarkingType:G.create(bw.None),uTransparentBackground:G.create(!1),uLightDirection:G.create(l.direction),uLightColor:G.create(l.color),uAmbientColor:G.create(S),uPickingAlphaThreshold:G.create(a.pickingAlphaThreshold),uInteriorDarkening:G.create(a.interiorDarkening),uInteriorColorFlag:G.create(a.interiorColorFlag),uInteriorColor:G.create(ze.toVec3Normalized(D(),a.interiorColor)),uHighlightColor:G.create(ze.toVec3Normalized(D(),a.highlightColor)),uSelectColor:G.create(ze.toVec3Normalized(D(),a.selectColor)),uDimColor:G.create(ze.toVec3Normalized(D(),a.dimColor)),uHighlightStrength:G.create(a.highlightStrength),uSelectStrength:G.create(a.selectStrength),uDimStrength:G.create(a.dimStrength),uMarkerPriority:G.create(a.markerPriority),uMarkerAverage:G.create(0),uXrayEdgeFalloff:G.create(a.xrayEdgeFalloff),uExposure:G.create(a.exposure)},k=Object.entries(P),L=!0,R=(X,W,K)=>{var re,se,me;if(X.state.disposed||!X.state.visible||!X.state.pickable&&W==="pick"||!mg.intersectsSphere3D(w,X.values.boundingSphere.ref.value))return;let[Y,ae]=X.values.uLod.ref.value;if(Y!==0||ae!==0){let{center:Ee,radius:Fe}=X.values.boundingSphere.ref.value,Ae=Si.distanceToPoint(T,Ee);if(Ae+Fe<Y||Ae-Fe>ae)return}let ve=X.values.instanceGrid.ref.value.cellSize>1;ve||ve&&X.values.lodLevels?X.cull(T,w,p,r.stats):X.uncull();let ge=!1;X.values.dLightCount.ref.value!==l.count&&(G.update(X.values.dLightCount,l.count),ge=!0),X.values.dColorMarker.ref.value!==a.colorMarker&&(G.update(X.values.dColorMarker,a.colorMarker),ge=!0),ge&&X.update();let Se=X.getProgram(W);if(i.currentProgramId!==Se.id&&(L=!0,Se.use()),L&&(Se.setUniforms(k),Se.bindTextures(f,0),L=!1),X.values.dGeometryType.ref.value==="directVolume"){if(W!=="color")return;i.disable(o.CULL_FACE),i.frontFace(o.CCW),K===3&&(i.disable(o.DEPTH_TEST),i.depthMask(!1))}else K===1?(i.enable(o.CULL_FACE),!((re=X.values.dFlipSided)===null||re===void 0)&&re.ref.value?(i.frontFace(o.CW),i.cullFace(o.FRONT)):(i.frontFace(o.CCW),i.cullFace(o.BACK))):K===2?(i.enable(o.CULL_FACE),!((se=X.values.dFlipSided)===null||se===void 0)&&se.ref.value?(i.frontFace(o.CW),i.cullFace(o.BACK)):(i.frontFace(o.CCW),i.cullFace(o.FRONT))):(X.values.uDoubleSided?X.values.uDoubleSided.ref.value||X.values.hasReflection.ref.value?i.disable(o.CULL_FACE):i.enable(o.CULL_FACE):i.disable(o.CULL_FACE),!((me=X.values.dFlipSided)===null||me===void 0)&&me.ref.value?(i.frontFace(o.CW),i.cullFace(o.FRONT)):(i.frontFace(o.CCW),i.cullFace(o.BACK)));X.render(W,f.length)},N=(X,W)=>{G.update(P.uView,X.view),G.update(P.uInvView,de.invert(g,X.view)),G.update(P.uProjection,X.projection),G.update(P.uInvProjection,de.invert(x,X.projection)),G.updateIfChanged(P.uIsOrtho,X.state.mode==="orthographic"?1:0),G.update(P.uViewOffset,X.viewOffset.enabled?Ve.set(E,X.viewOffset.offsetX*16,X.viewOffset.offsetY*16):Ve.set(E,0,0)),G.update(P.uCameraPosition,D.copy(I,X.state.position)),G.update(P.uCameraDir,D.normalize(_,D.sub(_,X.state.target,X.state.position))),G.updateIfChanged(P.uFar,X.far),G.updateIfChanged(P.uNear,X.near),G.updateIfChanged(P.uFog,X.state.fog>0),G.updateIfChanged(P.uFogFar,X.fogFar),G.updateIfChanged(P.uFogNear,X.fogNear),G.updateIfChanged(P.uTransparentBackground,m),mg.fromProjectionMatrix(w,X.projectionView),Si.copy(T,w[5]),T.constant-=Si.distanceToPoint(T,I),G.update(P.uCameraPlane,Si.toArray(T,P.uCameraPlane.ref.value,0)),G.updateIfChanged(P.uMarkerAverage,W.markerAverage)},F=(X,W,K,re,se)=>{m2(f,"tDepth",K||h),G.update(P.uModel,X.view),G.update(P.uModelView,de.mul(b,W.view,X.view)),G.update(P.uInvModelView,de.invert(y,b)),G.update(P.uModelViewProjection,de.mul(A,b,W.projection)),G.update(P.uInvModelViewProjection,de.invert(v,A)),G.updateIfChanged(P.uRenderMask,re),G.updateIfChanged(P.uMarkingDepthTest,se),i.enable(o.SCISSOR_TEST),i.colorMask(!0,!0,!0,!0);let{x:me,y:Y,width:ae,height:ve}=c;i.viewport(me,Y,ae,ve),i.scissor(me,Y,ae,ve),L=!0,i.currentRenderItemId=-1},H=function(X){var W,K,re,se;let me=ko(X.values.alpha.ref.value*X.state.alphaFactor,0,1),Y=((W=X.values.dXrayShaded)===null||W===void 0?void 0:W.ref.value)==="on"||((K=X.values.dXrayShaded)===null||K===void 0?void 0:K.ref.value)==="inverted";return me===1&&X.values.transparencyAverage.ref.value!==1&&X.values.dGeometryType.ref.value!=="directVolume"&&((re=X.values.dPointStyle)===null||re===void 0?void 0:re.ref.value)!=="fuzzy"&&!Y||((se=X.values.dTransparentBackfaces)===null||se===void 0?void 0:se.ref.value)==="opaque"},V=function(X){var W,K,re;let se=ko(X.values.alpha.ref.value*X.state.alphaFactor,0,1),me=((W=X.values.dXrayShaded)===null||W===void 0?void 0:W.ref.value)==="on"||((K=X.values.dXrayShaded)===null||K===void 0?void 0:K.ref.value)==="inverted";return se<1&&se!==0||X.values.transparencyAverage.ref.value>0||X.values.dGeometryType.ref.value==="directVolume"||((re=X.values.dPointStyle)===null||re===void 0?void 0:re.ref.value)==="fuzzy"||X.values.dGeometryType.ref.value==="text"||X.values.dGeometryType.ref.value==="image"||me},q=(X,W,K,re,se)=>{bt&&r.timer.mark("Renderer.renderPick"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,re,0,!1),G.updateIfChanged(P.uPickType,se);let{renderables:me}=X;for(let Y=0,ae=me.length;Y<ae;++Y)me[Y].state.colorOnly||R(me[Y],K,0);bt&&r.timer.markEnd("Renderer.renderPick")},Q=(X,W,K)=>{bt&&r.timer.mark("Renderer.renderDepth"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,0,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se)R(re[se],"depth",0);bt&&r.timer.markEnd("Renderer.renderDepth")},O=(X,W,K)=>{bt&&r.timer.mark("Renderer.renderDepthOpaque"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,1,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];H(Y)&&R(Y,"depth",0)}bt&&r.timer.markEnd("Renderer.renderDepthOpaque")},B=(X,W,K)=>{bt&&r.timer.mark("Renderer.renderDepthTransparent"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,2,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];V(Y)&&R(Y,"depth",0)}bt&&r.timer.markEnd("Renderer.renderDepthTransparent")},j=(X,W,K)=>{bt&&r.timer.mark("Renderer.renderMarkingDepth"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,0,!1),G.updateIfChanged(P.uMarkingType,bw.Depth);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];ko(Y.values.alpha.ref.value*Y.state.alphaFactor,0,1)!==0&&Y.values.transparencyAverage.ref.value!==1&&Y.values.markerAverage.ref.value!==1&&R(re[se],"marking",0)}bt&&r.timer.markEnd("Renderer.renderMarkingDepth")},U=(X,W,K)=>{bt&&r.timer.mark("Renderer.renderMarkingMask"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,0,!!K),G.updateIfChanged(P.uMarkingType,bw.Mask);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se)re[se].values.markerAverage.ref.value>0&&R(re[se],"marking",0);bt&&r.timer.markEnd("Renderer.renderMarkingMask")},z=(X,W,K)=>{bt&&r.timer.mark("Renderer.renderEmissive"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,1,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];H(Y)&&R(Y,"emissive",0)}bt&&r.timer.markEnd("Renderer.renderEmissive")},$=(X,W)=>{X.hasOpaque&&Z(X,W,null),X.opacityAverage<1&&J(X,W,null)},Z=(X,W,K)=>{bt&&r.timer.mark("Renderer.renderBlendedOpaque"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,1,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];H(Y)&&R(Y,"color",0)}bt&&r.timer.markEnd("Renderer.renderBlendedOpaque")},J=(X,W,K)=>{var re,se;bt&&r.timer.mark("Renderer.renderBlendedTransparent"),m?i.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA):i.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),i.enable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!1),F(X,W,K,2,!1);let{renderables:me}=X;for(let Y=0,ae=me.length;Y<ae;++Y){let ve=me[Y];V(ve)&&(!((re=ve.values.uDoubleSided)===null||re===void 0)&&re.ref.value?(((se=ve.values.dTransparentBackfaces)===null||se===void 0?void 0:se.ref.value)!=="opaque"&&R(ve,"color",2),R(ve,"color",1)):R(ve,"color",0))}bt&&r.timer.markEnd("Renderer.renderBlendedTransparent")};return{clear:(X,W)=>{i.enable(o.SCISSOR_TEST),i.enable(o.DEPTH_TEST),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),m&&!W?i.clearColor(0,0,0,0):X?i.clearColor(d[0],d[1],d[2],1):i.clearColor(1,1,1,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)},clearDepth:(X=!1)=>{i.enable(o.SCISSOR_TEST),X?(i.colorMask(!0,!0,!0,!0),i.clearColor(1,1,1,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)):(i.enable(o.DEPTH_TEST),i.depthMask(!0),o.clear(o.DEPTH_BUFFER_BIT))},update:N,renderPick:q,renderDepth:Q,renderDepthOpaque:O,renderDepthTransparent:B,renderMarkingDepth:j,renderMarkingMask:U,renderEmissive:z,renderBlended:$,renderBlendedOpaque:Z,renderBlendedTransparent:J,renderBlendedVolume:(X,W,K)=>{bt&&r.timer.mark("Renderer.renderBlendedVolume"),i.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),i.enable(o.BLEND),i.depthMask(!1),F(X,W,K,2,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];Y.values.dGeometryType.ref.value==="directVolume"&&R(Y,"color",3)}bt&&r.timer.markEnd("Renderer.renderBlendedVolume")},renderWboitOpaque:(X,W,K)=>{bt&&r.timer.mark("Renderer.renderWboitOpaque"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,1,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];H(Y)&&R(Y,"color",0)}bt&&r.timer.markEnd("Renderer.renderWboitOpaque")},renderWboitTransparent:(X,W,K)=>{bt&&r.timer.mark("Renderer.renderWboitTransparent"),F(X,W,K,2,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];V(Y)&&R(Y,"color",0)}bt&&r.timer.markEnd("Renderer.renderWboitTransparent")},renderDpoitOpaque:(X,W,K)=>{bt&&r.timer.mark("Renderer.renderDpoitOpaque"),i.disable(o.BLEND),i.enable(o.DEPTH_TEST),i.depthMask(!0),F(X,W,K,1,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];H(Y)&&R(Y,"color",0)}bt&&r.timer.markEnd("Renderer.renderDpoitOpaque")},renderDpoitTransparent:(X,W,K,re)=>{bt&&r.timer.mark("Renderer.renderDpoitTransparent"),i.enable(o.BLEND),m2(f,"tDpoitDepth",re.depth),m2(f,"tDpoitFrontColor",re.frontColor),m2(f,"tDpoitBackColor",re.backColor),F(X,W,K,2,!1);let{renderables:se}=X;for(let me=0,Y=se.length;me<Y;++me){let ae=se[me];V(ae)&&R(ae,"color",0)}bt&&r.timer.markEnd("Renderer.renderDpoitTransparent")},renderDpoitVolume:(X,W,K)=>{bt&&r.timer.mark("Renderer.renderDpoitVolume"),i.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),i.enable(o.BLEND),F(X,W,K,2,!1);let{renderables:re}=X;for(let se=0,me=re.length;se<me;++se){let Y=re[se];Y.values.dGeometryType.ref.value==="directVolume"&&R(Y,"color",0)}bt&&r.timer.markEnd("Renderer.renderDpoitVolume")},setProps:X=>{X.backgroundColor!==void 0&&X.backgroundColor!==a.backgroundColor&&(a.backgroundColor=X.backgroundColor,ze.toVec3Normalized(d,a.backgroundColor),G.update(P.uFogColor,D.copy(P.uFogColor.ref.value,d))),X.pickingAlphaThreshold!==void 0&&X.pickingAlphaThreshold!==a.pickingAlphaThreshold&&(a.pickingAlphaThreshold=X.pickingAlphaThreshold,G.update(P.uPickingAlphaThreshold,a.pickingAlphaThreshold)),X.interiorDarkening!==void 0&&X.interiorDarkening!==a.interiorDarkening&&(a.interiorDarkening=X.interiorDarkening,G.update(P.uInteriorDarkening,a.interiorDarkening)),X.interiorColorFlag!==void 0&&X.interiorColorFlag!==a.interiorColorFlag&&(a.interiorColorFlag=X.interiorColorFlag,G.update(P.uInteriorColorFlag,a.interiorColorFlag)),X.interiorColor!==void 0&&X.interiorColor!==a.interiorColor&&(a.interiorColor=X.interiorColor,G.update(P.uInteriorColor,ze.toVec3Normalized(P.uInteriorColor.ref.value,a.interiorColor))),X.colorMarker!==void 0&&X.colorMarker!==a.colorMarker&&(a.colorMarker=X.colorMarker),X.highlightColor!==void 0&&X.highlightColor!==a.highlightColor&&(a.highlightColor=X.highlightColor,G.update(P.uHighlightColor,ze.toVec3Normalized(P.uHighlightColor.ref.value,a.highlightColor))),X.selectColor!==void 0&&X.selectColor!==a.selectColor&&(a.selectColor=X.selectColor,G.update(P.uSelectColor,ze.toVec3Normalized(P.uSelectColor.ref.value,a.selectColor))),X.dimColor!==void 0&&X.dimColor!==a.dimColor&&(a.dimColor=X.dimColor,G.update(P.uDimColor,ze.toVec3Normalized(P.uDimColor.ref.value,a.dimColor))),X.highlightStrength!==void 0&&X.highlightStrength!==a.highlightStrength&&(a.highlightStrength=X.highlightStrength,G.update(P.uHighlightStrength,a.highlightStrength)),X.selectStrength!==void 0&&X.selectStrength!==a.selectStrength&&(a.selectStrength=X.selectStrength,G.update(P.uSelectStrength,a.selectStrength)),X.dimStrength!==void 0&&X.dimStrength!==a.dimStrength&&(a.dimStrength=X.dimStrength,G.update(P.uDimStrength,a.dimStrength)),X.markerPriority!==void 0&&X.markerPriority!==a.markerPriority&&(a.markerPriority=X.markerPriority,G.update(P.uMarkerPriority,a.markerPriority)),X.xrayEdgeFalloff!==void 0&&X.xrayEdgeFalloff!==a.xrayEdgeFalloff&&(a.xrayEdgeFalloff=X.xrayEdgeFalloff,G.update(P.uXrayEdgeFalloff,a.xrayEdgeFalloff)),X.exposure!==void 0&&X.exposure!==a.exposure&&(a.exposure=X.exposure,G.update(P.uExposure,a.exposure)),X.light!==void 0&&!ul(X.light,a.light)&&(a.light=X.light,Object.assign(l,xde(X.light,l)),G.update(P.uLightDirection,l.direction),G.update(P.uLightColor,l.color)),X.ambientColor!==void 0&&X.ambientColor!==a.ambientColor&&(a.ambientColor=X.ambientColor,D.scale(S,ze.toArrayNormalized(a.ambientColor,S,0),a.ambientIntensity),G.update(P.uAmbientColor,S)),X.ambientIntensity!==void 0&&X.ambientIntensity!==a.ambientIntensity&&(a.ambientIntensity=X.ambientIntensity,D.scale(S,ze.toArrayNormalized(a.ambientColor,S,0),a.ambientIntensity),G.update(P.uAmbientColor,S))},setViewport:(X,W,K,re)=>{i.viewport(X,W,K,re),i.scissor(X,W,K,re),(X!==c.x||W!==c.y||K!==c.width||re!==c.height)&&(Zo.set(c,X,W,K,re),G.update(P.uViewport,Ht.set(P.uViewport.ref.value,X,W,K,re)))},setTransparentBackground:X=>{m=X},setDrawingBufferSize:(X,W)=>{(X!==u[0]||W!==u[1])&&G.update(P.uDrawingBufferSize,Ve.set(u,X,W))},setPixelRatio:X=>{G.update(P.uPixelRatio,X)},setOcclusionTest:X=>{p=X},props:a,get stats(){return{programCount:r.stats.resourceCounts.program,shaderCount:r.stats.resourceCounts.shader,attributeCount:r.stats.resourceCounts.attribute,elementsCount:r.stats.resourceCounts.elements,framebufferCount:r.stats.resourceCounts.framebuffer,renderbufferCount:r.stats.resourceCounts.renderbuffer,textureCount:r.stats.resourceCounts.texture,vertexArrayCount:r.stats.resourceCounts.vertexArray,drawCount:s.drawCount,instanceCount:s.instanceCount,instancedDrawCount:s.instancedDrawCount}},get light(){return l},dispose:()=>{}}}e.create=t})(fk||(fk={}));function Mt(e,t="",r=""){return Mt.create(e,t,r)}(function(e){function t(u,d="",m=""){return{triggers:u,action:d,description:m}}e.create=t;function r(u){return!!u&&Array.isArray(u.triggers)&&typeof u.action=="string"}e.isBinding=r,e.Empty={triggers:[],action:"",description:""};function n(u){return u.triggers.length===0||u.triggers.every(d=>d.buttons===void 0&&d.modifiers===void 0&&!d.code)}e.isEmpty=n;function o(u,d,m){return u.triggers.some(p=>l.match(p,d,m))}e.match=o;function i(u,d,m,p){return u.triggers.some(h=>l.matchKey(h,d,m,p))}e.matchKey=i;function s(u){return u.triggers.map(l.format).join(" or ")}e.formatTriggers=s;function a(u,d=""){let m=u.description||Ms(d);return _K(m,{triggers:"<i>"+s(u)+"</i>"})}e.format=a;function l(u,d){return l.create(u,d)}e.Trigger=l;function c(u,d){return l.create(void 0,d,u)}e.TriggerKey=c,function(u){function d(f,C,g){return{buttons:f,modifiers:C,code:g}}u.create=d,u.Empty={};function m(f,C,g){let{buttons:b,modifiers:y}=f;return b!==void 0&&(b===C||Vo.has(b,C))&&(!y||nl.areEqual(y,g))}u.match=m;function p(f,C,g,b){let{modifiers:y,code:x}=f;return x!==void 0&&(x===C||x.length===1&&C.length===4&&C.startsWith("Key")&&!!b&&b.length===1&&b.toUpperCase()===x.toUpperCase())&&(!y||nl.areEqual(y,g))}u.matchKey=p;function h(f){let C=[],g=yHe(f.buttons,f.code);g&&C.push(g);let b=bHe(f.code);b&&C.push(b);let y=vHe(f.modifiers);return y&&C.push(y),C.join(" + ")}u.format=h}(l=e.Trigger||(e.Trigger={}))})(Mt||(Mt={}));var Dy=Vo;function yHe(e,t){let r=[];return e===void 0&&!t?r.push("any mouse button"):e===0?r.push("mouse hover"):e!==void 0&&(Dy.has(e,Dy.Flag.Primary)&&r.push("left mouse button"),Dy.has(e,Dy.Flag.Secondary)&&r.push("right mouse button"),Dy.has(e,Dy.Flag.Auxilary)&&r.push("wheel/middle mouse button"),Dy.has(e,Dy.Flag.Forth)&&r.push("three fingers")),r.join(" + ")}function vHe(e,t){let r=[];return e?(e.alt&&r.push("alt key"),e.control&&r.push("control key"),e.meta&&r.push("meta/command key"),e.shift&&r.push("shift key"),t&&r.length===0&&r.push("no key")):t&&r.push("any key"),r.join(" + ")}function bHe(e){return e?.startsWith("Key")&&(e=e.substring(3)),e&&Pa(e).toLowerCase()}var ky=Vo,Bd=nl,My=Mt.Trigger,Yu=Mt.TriggerKey,Cde={dragRotate:Mt([My(ky.Flag.Primary,Bd.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:Mt([My(ky.Flag.Primary,Bd.create({shift:!0,control:!0}))],"Rotate around z-axis (roll)","Drag using ${triggers}"),dragPan:Mt([My(ky.Flag.Secondary,Bd.create()),My(ky.Flag.Primary,Bd.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:Mt.Empty,dragFocus:Mt([My(ky.Flag.Forth,Bd.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:Mt([My(ky.Flag.Auxilary,Bd.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:Mt([My(ky.Flag.Auxilary,Bd.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:Mt([My(ky.Flag.Auxilary,Bd.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:Mt.Empty,keyMoveForward:Mt([Yu("KeyW")],"Move forward","Press ${triggers}"),keyMoveBack:Mt([Yu("KeyS")],"Move back","Press ${triggers}"),keyMoveLeft:Mt([Yu("KeyA")],"Move left","Press ${triggers}"),keyMoveRight:Mt([Yu("KeyD")],"Move right","Press ${triggers}"),keyMoveUp:Mt([Yu("KeyR")],"Move up","Press ${triggers}"),keyMoveDown:Mt([Yu("KeyF")],"Move down","Press ${triggers}"),keyRollLeft:Mt([Yu("KeyQ")],"Roll left","Press ${triggers}"),keyRollRight:Mt([Yu("KeyE")],"Roll right","Press ${triggers}"),keyPitchUp:Mt([Yu("ArrowUp",Bd.create({shift:!0}))],"Pitch up","Press ${triggers}"),keyPitchDown:Mt([Yu("ArrowDown",Bd.create({shift:!0}))],"Pitch down","Press ${triggers}"),keyYawLeft:Mt([Yu("ArrowLeft",Bd.create({shift:!0}))],"Yaw left","Press ${triggers}"),keyYawRight:Mt([Yu("ArrowRight",Bd.create({shift:!0}))],"Yaw right","Press ${triggers}"),boostMove:Mt([Yu("ShiftLeft")],"Boost move","Press ${triggers}"),enablePointerLock:Mt([Yu("Space",Bd.create({control:!0}))],"Enable pointer lock","Press ${triggers}")},f9={noScroll:M.Boolean(!0,{isHidden:!0}),rotateSpeed:M.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:M.Numeric(7,{min:1,max:15,step:1}),panSpeed:M.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:M.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:M.Numeric(5,{min:.1,max:10,step:.1}),flyMode:M.Boolean(!1),animate:M.MappedStatic("off",{off:M.EmptyGroup(),spin:M.Group({speed:M.Numeric(1,{min:-20,max:20,step:1})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:M.Group({speed:M.Numeric(.3,{min:-5,max:5,step:.1}),angle:M.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:M.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:M.Numeric(.2,{},{isHidden:!0}),minDistance:M.Numeric(.01,{},{isHidden:!0}),maxDistance:M.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:M.Numeric(1,{},{isHidden:!0}),maxWheelDelta:M.Numeric(.02,{},{isHidden:!0}),bindings:M.Value(Cde,{isHidden:!0}),autoAdjustMinMaxDistance:M.MappedStatic("on",{off:M.EmptyGroup(),on:M.Group({minDistanceFactor:M.Numeric(0),minDistancePadding:M.Numeric(5),maxDistanceFactor:M.Numeric(10),maxDistanceMin:M.Numeric(20)})},{isHidden:!0})};var hk;(function(e){function t(r,n,o,i={}){let s={...M.getDefaultValues(f9),...i,bindings:{...Cde,...i.bindings}},a=s.bindings,l=Zo.clone(n.viewport),c=!1,u=r.drag.subscribe(yt),d=r.interactionEnd.subscribe($e),m=r.wheel.subscribe(be),p=r.pinch.subscribe(Te),h=r.gesture.subscribe(De),f=r.keyDown.subscribe(Ce),C=r.keyUp.subscribe(he),g=r.move.subscribe(pe),b=r.lock.subscribe(St),y=r.leave.subscribe(sr),x=!1,A=D(),v=D(),_=Ve(),I=Ve(),T=D(),E=0,w=Ve(),S=Ve(),P=0,k=0,L=0,R=Ve(),N=Ve(),F=Ve(),H=Ve(),V=Ve(),q=Ve(),Q=D.clone(n.target),O=D.clone(n.position),B=D.clone(n.up),j=Ve();function U(Ue,ft){return Ve.set(j,(Ue-l.x)/l.width,(ft-l.y)/l.height)}let z=Ve();function $(Ue,ft){return Ve.set(z,(Ue-l.width*.5-l.x)/(l.width*.5),(l.height+2*(l.y-ft))/l.width)}function Z(){let Ue=r.width/r.height||1;return s.rotateSpeed*r.pixelRatio*Ue}let J=D(),ie=Tn(),ne=D(),le=D(),ee=D(),oe=D();function te(){let Ue=I[0]-_[0],ft=I[1]-_[1];D.set(oe,Ue,ft,0);let Dt=D.magnitude(oe)*Z();Dt?(D.sub(v,n.position,n.target),D.normalize(ne,v),D.normalize(le,n.up),D.normalize(ee,D.cross(ee,le,ne)),D.setMagnitude(le,le,ft),D.setMagnitude(ee,ee,Ue),D.add(oe,le,ee),D.normalize(J,D.cross(J,oe,v)),Tn.setAxisAngle(ie,J,Dt),D.transformQuat(v,v,ie),D.transformQuat(n.up,n.up,ie),D.copy(T,J),E=Dt):!s.staticMoving&&E&&(E*=Math.sqrt(1-s.dynamicDampingFactor),D.sub(v,n.position,n.target),Tn.setAxisAngle(ie,T,E),D.transformQuat(v,v,ie),D.transformQuat(n.up,n.up,ie)),Ve.copy(_,I)}let X=Tn(),W=D();function K(){let Ue=(_e.rollRight-_e.rollLeft)/45,ft=(S[0]-w[0])*-Math.sign(S[1]),Dt=(S[1]-w[1])*-Math.sign(S[0]),vr=-s.rotateSpeed*(-ft+Dt)+Ue;vr?(D.normalize(W,v),Tn.setAxisAngle(X,W,vr),D.transformQuat(n.up,n.up,X),P=vr):!s.staticMoving&&P&&(P*=Math.sqrt(1-s.dynamicDampingFactor),D.normalize(W,v),Tn.setAxisAngle(X,W,P),D.transformQuat(n.up,n.up,X)),Ve.copy(w,S)}let re=Tn(),se=D();function me(){let Ue=(_e.pitchUp-_e.pitchDown)/(s.flyMode?360:90),ft=-s.rotateSpeed*Ue;ft?(D.cross(se,v,n.up),D.normalize(se,se),Tn.setAxisAngle(re,se,ft),D.transformQuat(v,v,re),D.transformQuat(n.up,n.up,re),k=ft):!s.staticMoving&&k&&(k*=Math.sqrt(1-s.dynamicDampingFactor),D.cross(se,v,n.up),D.normalize(se,se),Tn.setAxisAngle(re,se,k),D.transformQuat(v,v,re),D.transformQuat(n.up,n.up,re))}let Y=Tn(),ae=D();function ve(){let Ue=(_e.yawRight-_e.yawLeft)/(s.flyMode?360:90),ft=-s.rotateSpeed*Ue;ft?(D.normalize(ae,n.up),Tn.setAxisAngle(Y,ae,ft),D.transformQuat(v,v,Y),D.transformQuat(n.up,n.up,Y),L=ft):!s.staticMoving&&L&&(L*=Math.sqrt(1-s.dynamicDampingFactor),D.normalize(ae,n.up),Tn.setAxisAngle(Y,ae,L),D.transformQuat(v,v,Y),D.transformQuat(n.up,n.up,Y))}function ge(){let Ue=1+(N[1]-R[1])*s.zoomSpeed;Ue!==1&&Ue>0&&D.scale(v,v,Ue),s.staticMoving?Ve.copy(R,N):R[1]+=(N[1]-R[1])*s.dynamicDampingFactor}function Se(){let Ue=(H[1]-F[1])*s.zoomSpeed;if(Ue!==0){let ft=Math.max(1,n.state.radius+n.state.radius*Ue);n.setState({radius:ft})}s.staticMoving?Ve.copy(F,H):F[1]+=(H[1]-F[1])*s.dynamicDampingFactor}let Ee=Ve(),Fe=D(),Ae=D();function we(){if(Ve.sub(Ee,Ve.copy(Ee,q),V),Ve.squaredMagnitude(Ee)){let Ue=r.pixelRatio*s.panSpeed;Ee[0]*=1/n.zoom*n.viewport.width*Ue,Ee[1]*=1/n.zoom*n.viewport.height*Ue,D.cross(Ae,D.copy(Ae,v),n.up),D.setMagnitude(Ae,Ae,Ee[0]),D.setMagnitude(Fe,n.up,Ee[1]),D.add(Ae,Ae,Fe),D.add(n.position,n.position,Ae),D.add(n.target,n.target,Ae),s.staticMoving?Ve.copy(V,q):(Ve.sub(Ee,q,V),Ve.scale(Ee,Ee,s.dynamicDampingFactor),Ve.add(V,V,Ee))}}let _e={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},Ke=D(),rt=D();function pt(Ue){D.sub(rt,n.position,n.target);let ft=Math.max(n.state.minNear,s.minDistance);D.setMagnitude(rt,rt,ft);let Dt=Ue*(60/1e3)*s.moveSpeed*(_e.boostMove===1?s.boostMoveFactor:1);if(_e.moveForward===1&&(D.normalize(Ke,rt),D.scaleAndSub(n.position,n.position,Ke,Dt),(s.flyMode||r.pointerLock)&&D.sub(n.target,n.position,rt)),_e.moveBack===1&&(D.normalize(Ke,rt),D.scaleAndAdd(n.position,n.position,Ke,Dt),(s.flyMode||r.pointerLock)&&D.sub(n.target,n.position,rt)),_e.moveLeft===1&&(D.cross(Ke,rt,n.up),D.normalize(Ke,Ke),s.flyMode||r.pointerLock?(D.scaleAndAdd(n.position,n.position,Ke,Dt),D.sub(n.target,n.position,rt)):(D.scaleAndSub(n.position,n.position,Ke,Dt),D.sub(n.target,n.position,v))),_e.moveRight===1&&(D.cross(Ke,rt,n.up),D.normalize(Ke,Ke),s.flyMode||r.pointerLock?(D.scaleAndSub(n.position,n.position,Ke,Dt),D.sub(n.target,n.position,rt)):(D.scaleAndAdd(n.position,n.position,Ke,Dt),D.sub(n.target,n.position,v))),_e.moveUp===1&&(D.normalize(Ke,n.up),s.flyMode||r.pointerLock?(D.scaleAndAdd(n.position,n.position,Ke,Dt),D.sub(n.target,n.position,rt)):(D.scaleAndSub(n.position,n.position,Ke,Dt),D.sub(n.target,n.position,v))),_e.moveDown===1&&(D.normalize(Ke,n.up),s.flyMode||r.pointerLock?(D.scaleAndSub(n.position,n.position,Ke,Dt),D.sub(n.target,n.position,rt)):(D.scaleAndAdd(n.position,n.position,Ke,Dt),D.sub(n.target,n.position,v))),s.flyMode||r.pointerLock){let vr=D.distance(n.position,o.boundingSphereVisible.center);n.setState({minFar:vr+o.boundingSphereVisible.radius})}}function Ne(){let Ue=Math.min(Math.max(n.state.radiusMax*1e3,.01),s.maxDistance);D.squaredMagnitude(v)>Ue*Ue&&(D.setMagnitude(v,v,Ue),D.add(n.position,n.target,v),Ve.copy(R,N),Ve.copy(F,H)),D.squaredMagnitude(v)<s.minDistance*s.minDistance&&(D.setMagnitude(v,v,s.minDistance),D.add(n.position,n.target,v),Ve.copy(R,N),Ve.copy(F,H))}function je(Ue,ft){return Ue*=r.pixelRatio,ft*=r.pixelRatio,Ue>l.x+l.width||r.height-ft>l.y+l.height||Ue<l.x||r.height-ft<l.y}let Ye=-1;function mt(Ue){if(Ye===Ue)return;let ft=Ue-Ye;Ye>0&&(s.animate.name==="spin"?no(ft):s.animate.name==="rock"&&Me(ft)),D.sub(v,n.position,n.target),te(),K(),me(),ve(),ge(),Se(),we(),D.add(n.position,n.target,v),Ne(),Ye>0&&pt(Math.min(ft,15*1e3/60)),D.sub(v,n.position,n.target),Ne(),D.squaredDistance(A,n.position)>1e-6&&D.copy(A,n.position),Ye=Ue}function vt(){D.copy(n.target,Q),D.copy(n.position,O),D.copy(n.up,B),D.sub(v,n.position,n.target),D.copy(A,n.position)}function yt({x:Ue,y:ft,pageX:Dt,pageY:vr,buttons:nn,modifiers:co,isStart:Jr}){let Yn=je(Ue,ft);if(Jr&&Yn||!Jr&&!x)return;x=!0,Ie();let vi=Mt.match(a.dragRotate,nn,co),Fo=Mt.match(a.dragRotateZ,nn,co),Qn=Mt.match(a.dragPan,nn,co),ui=Mt.match(a.dragZoom,nn,co),So=Mt.match(a.dragFocus,nn,co),Kc=Mt.match(a.dragFocusZoom,nn,co);$(Dt,vr),U(Dt,vr);let wa=r.pixelRatio,Za=(Ue*wa-l.width/2-l.x)/l.width,Do=-(r.height-ft*wa-l.height/2-l.y)/l.height;if(Jr&&(vi&&(Ve.copy(I,z),Ve.copy(_,I)),Fo&&(Ve.set(S,Za,Do),Ve.copy(w,S)),(ui||Kc)&&(Ve.copy(R,j),Ve.copy(N,R)),So&&(Ve.copy(F,j),Ve.copy(H,F)),Qn&&(Ve.copy(V,j),Ve.copy(q,V))),vi&&Ve.copy(I,z),Fo&&Ve.set(S,Za,Do),(ui||Kc)&&Ve.copy(N,j),So&&Ve.copy(H,j),Kc){let ua=D.distance(n.state.position,n.state.target);n.setState({radius:ua/5})}Qn&&Ve.copy(q,j)}function $e(){x=!1}function be({x:Ue,y:ft,spinX:Dt,spinY:vr,dz:nn,buttons:co,modifiers:Jr}){if(je(Ue,ft))return;let Yn=oq(Dt*.075,vr*.075,nn*1e-4);Yn<-s.maxWheelDelta?Yn=-s.maxWheelDelta:Yn>s.maxWheelDelta&&(Yn=s.maxWheelDelta),Mt.match(a.scrollZoom,co,Jr)&&(N[1]+=Yn),Mt.match(a.scrollFocus,co,Jr)&&(H[1]+=Yn)}function Te({fractionDelta:Ue,buttons:ft,modifiers:Dt}){Mt.match(a.scrollZoom,ft,Dt)&&(x=!0,N[1]+=s.gestureScaleFactor*Ue)}function De({deltaScale:Ue}){x=!0,N[1]+=s.gestureScaleFactor*Ue}function pe({movementX:Ue,movementY:ft}){if(!r.pointerLock||Ue===void 0||ft===void 0)return;let Dt=l.width*.5-l.x,vr=l.height*.5-l.y;Ve.copy(_,$(Dt,vr)),Ve.copy(I,$(Ue+Dt,ft+vr))}function Ce({modifiers:Ue,code:ft,key:Dt,x:vr,y:nn}){je(vr,nn)||(Mt.matchKey(a.keyMoveForward,ft,Ue,Dt)?_e.moveForward=1:Mt.matchKey(a.keyMoveBack,ft,Ue,Dt)?_e.moveBack=1:Mt.matchKey(a.keyMoveLeft,ft,Ue,Dt)?_e.moveLeft=1:Mt.matchKey(a.keyMoveRight,ft,Ue,Dt)?_e.moveRight=1:Mt.matchKey(a.keyMoveUp,ft,Ue,Dt)?_e.moveUp=1:Mt.matchKey(a.keyMoveDown,ft,Ue,Dt)?_e.moveDown=1:Mt.matchKey(a.keyRollLeft,ft,Ue,Dt)?_e.rollLeft=1:Mt.matchKey(a.keyRollRight,ft,Ue,Dt)?_e.rollRight=1:Mt.matchKey(a.keyPitchUp,ft,Ue,Dt)?_e.pitchUp=1:Mt.matchKey(a.keyPitchDown,ft,Ue,Dt)?_e.pitchDown=1:Mt.matchKey(a.keyYawLeft,ft,Ue,Dt)?_e.yawLeft=1:Mt.matchKey(a.keyYawRight,ft,Ue,Dt)&&(_e.yawRight=1),Mt.matchKey(a.boostMove,ft,Ue,Dt)&&(_e.boostMove=1),Mt.matchKey(a.enablePointerLock,ft,Ue,Dt)&&r.requestPointerLock(l))}function he({modifiers:Ue,code:ft,key:Dt,x:vr,y:nn}){var co,Jr,Yn,vi,Fo,Qn,ui,So,Kc,wa,Za,Do;if(je(vr,nn))return;let ua=!1;ft.startsWith("Alt")?(ua=!0,Ue.alt=!0):ft.startsWith("Shift")?(ua=!0,Ue.shift=!0):ft.startsWith("Control")?(ua=!0,Ue.control=!0):ft.startsWith("Meta")&&(ua=!0,Ue.meta=!0);let Bi=[];ua?(_e.moveForward&&Bi.push(((co=a.keyMoveForward.triggers[0])===null||co===void 0?void 0:co.code)||""),_e.moveBack&&Bi.push(((Jr=a.keyMoveBack.triggers[0])===null||Jr===void 0?void 0:Jr.code)||""),_e.moveLeft&&Bi.push(((Yn=a.keyMoveLeft.triggers[0])===null||Yn===void 0?void 0:Yn.code)||""),_e.moveRight&&Bi.push(((vi=a.keyMoveRight.triggers[0])===null||vi===void 0?void 0:vi.code)||""),_e.moveUp&&Bi.push(((Fo=a.keyMoveUp.triggers[0])===null||Fo===void 0?void 0:Fo.code)||""),_e.moveDown&&Bi.push(((Qn=a.keyMoveDown.triggers[0])===null||Qn===void 0?void 0:Qn.code)||""),_e.rollLeft&&Bi.push(((ui=a.keyRollLeft.triggers[0])===null||ui===void 0?void 0:ui.code)||""),_e.rollRight&&Bi.push(((So=a.keyRollRight.triggers[0])===null||So===void 0?void 0:So.code)||""),_e.pitchUp&&Bi.push(((Kc=a.keyPitchUp.triggers[0])===null||Kc===void 0?void 0:Kc.code)||""),_e.pitchDown&&Bi.push(((wa=a.keyPitchDown.triggers[0])===null||wa===void 0?void 0:wa.code)||""),_e.yawLeft&&Bi.push(((Za=a.keyYawLeft.triggers[0])===null||Za===void 0?void 0:Za.code)||""),_e.yawRight&&Bi.push(((Do=a.keyYawRight.triggers[0])===null||Do===void 0?void 0:Do.code)||"")):Bi.push(ft);for(let ks of Bi)Mt.matchKey(a.keyMoveForward,ks,Ue,Dt)?_e.moveForward=0:Mt.matchKey(a.keyMoveBack,ks,Ue,Dt)?_e.moveBack=0:Mt.matchKey(a.keyMoveLeft,ks,Ue,Dt)?_e.moveLeft=0:Mt.matchKey(a.keyMoveRight,ks,Ue,Dt)?_e.moveRight=0:Mt.matchKey(a.keyMoveUp,ks,Ue,Dt)?_e.moveUp=0:Mt.matchKey(a.keyMoveDown,ks,Ue,Dt)?_e.moveDown=0:Mt.matchKey(a.keyRollLeft,ks,Ue,Dt)?_e.rollLeft=0:Mt.matchKey(a.keyRollRight,ks,Ue,Dt)?_e.rollRight=0:Mt.matchKey(a.keyPitchUp,ks,Ue,Dt)?_e.pitchUp=0:Mt.matchKey(a.keyPitchDown,ks,Ue,Dt)?_e.pitchDown=0:Mt.matchKey(a.keyYawLeft,ks,Ue,Dt)?_e.yawLeft=0:Mt.matchKey(a.keyYawRight,ks,Ue,Dt)&&(_e.yawRight=0);Mt.matchKey(a.boostMove,ft,Ue,Dt)&&(_e.boostMove=0)}function We(){D.sub(rt,n.position,n.target);let Ue=Math.max(n.state.minNear,s.minDistance);D.setMagnitude(rt,rt,Ue),D.sub(n.target,n.position,rt);let ft=D.distance(n.position,o.boundingSphereVisible.center);n.setState({minFar:ft+o.boundingSphereVisible.radius})}function It(){let{center:Ue,radius:ft}=o.boundingSphereVisible;if(D.distance(n.position,Ue)>ft){let vr=n.getFocus(Ue,ft);n.setState({...vr,minFar:0})}else n.setState({minFar:0,radius:o.boundingSphereVisible.radius})}function St(Ue){Ue?We():It()}function Yt(){_e.moveForward=0,_e.moveBack=0,_e.moveLeft=0,_e.moveRight=0,_e.moveUp=0,_e.moveDown=0,_e.rollLeft=0,_e.rollRight=0,_e.pitchUp=0,_e.pitchDown=0,_e.yawLeft=0,_e.yawRight=0,_e.boostMove=0}function sr(){Yt()}function Xr(){c||(c=!0,u.unsubscribe(),m.unsubscribe(),p.unsubscribe(),h.unsubscribe(),d.unsubscribe(),f.unsubscribe(),C.unsubscribe(),g.unsubscribe(),b.unsubscribe(),y.unsubscribe())}let mn=Ve.create(.005,0);function no(Ue){if(s.animate.name!=="spin"||s.animate.params.speed===0||x)return;let ft=s.animate.params.speed/1e3;mn[0]=60*Math.min(Math.abs(Ue),1e3/8)/1e3*ft,Ve.add(I,_,mn)}let qn=0,Ze=Ve.create(.005,0);function Me(Ue){if(s.animate.name!=="rock"||s.animate.params.speed===0||x)return;let ft=Ue/1e3*s.animate.params.speed,Dt=Pr(s.animate.params.angle)/Z(),vr=Math.sin(qn*Math.PI*2)*Dt,nn=Math.sin((qn+ft)*Math.PI*2)*Dt;Ze[0]=nn-vr,Ve.add(I,_,Ze),qn+=ft,qn>=1&&(qn=0)}function Ie(){qn=0}function et(Ue){Ye=-1,mt(Ue)}return{viewport:l,get isAnimating(){return s.animate.name!=="off"},get isMoving(){return _e.moveForward===1||_e.moveBack===1||_e.moveLeft===1||_e.moveRight===1||_e.moveUp===1||_e.moveDown===1||_e.rollLeft===1||_e.rollRight===1||_e.pitchUp===1||_e.pitchDown===1||_e.yawLeft===1||_e.yawRight===1},get props(){return s},setProps:Ue=>{var ft;((ft=Ue.animate)===null||ft===void 0?void 0:ft.name)==="rock"&&s.animate.name!=="rock"&&Ie(),Ue.flyMode!==void 0&&Ue.flyMode!==s.flyMode&&(Ue.flyMode?We():It()),Object.assign(s,Ue),Object.assign(a,Ue.bindings)},start:et,update:mt,reset:vt,dispose:Xr}}e.create=t})(hk||(hk={}));var xw;(function(e){function t(){return{view:de.identity(),position:D.create(0,0,0),direction:D.create(0,0,-1),up:D.create(0,1,0)}}e.create=t;let r=D.zero();function n(o){D.add(r,o.position,o.direction),de.lookAt(o.view,o.position,r,o.up)}e.update=n})(xw||(xw={}));var gk=class{constructor(){this.removeList=S2(),this.removeMap=new Map,this.addList=S2(),this.addMap=new Map}get isEmpty(){return this.removeList.count===0&&this.addList.count===0}get size(){return this.removeMap.size+this.addMap.size}add(t){if(this.removeMap.has(t)){let n=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(n)}if(this.addMap.has(t))return;let r=this.addList.addLast(t);this.addMap.set(t,r)}remove(t){if(this.addMap.has(t)){let n=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(n)}if(this.removeMap.has(t))return;let r=this.removeList.addLast(t);this.removeMap.set(t,r)}tryGetRemove(){let t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t}tryGetAdd(){let t=this.addList.removeFirst();return t&&this.addMap.delete(t),t}};var Cw=new is("98");function Sde(e,t,r){Cw.reset();for(let n=0,o=e.length;n<o;++n){if(r&&!e[n].state.visible)continue;let i=e[n].values.boundingSphere.ref.value;i.radius&&Cw.includeSphere(i)}Cw.finishedIncludeStep();for(let n=0,o=e.length;n<o;++n){if(r&&!e[n].state.visible)continue;let i=e[n].values.boundingSphere.ref.value;i.radius&&Cw.radiusSphere(i)}return Cw.getSphere(t)}function xHe(e,t){let r=e.getProgram("color").id,n=t.getProgram("color").id,o=e.materialId,i=t.materialId;return r!==n?r-n:o!==i?o-i:e.id-t.id}var Jf;(function(e){function t(r,n="blended"){let o=new Map,i=[],s=Pe(),a=Pe(),l=[],c=[],u=!0,d=!0,m=!0,p=!0,h=!0,f=!0,C=0,g=0,b=0,y=!1,x=xw.create(),{view:A,position:v,direction:_,up:I}=x;function T(q){if(!o.has(q)){let Q=Kre(r,q,n);i.push(Q),q.type==="direct-volume"?c.push(Q):l.push(Q),o.set(q,Q),u=!0,d=!0}}function E(q){let Q=o.get(q);Q&&(Q.dispose(),om(i,Q),om(l,Q),om(c,Q),o.delete(q),u=!0,d=!0)}let w=100;function S(q){let Q=Zn(),O=0;for(;;){let B=P.tryGetRemove();if(!B)break;if(E(B),++O%w===0&&Zn()-Q>q)return!1}for(;;){let B=P.tryGetAdd();if(!B)break;if(T(B),++O%w===0&&Zn()-Q>q)return!1}return i.sort(xHe),m=!0,p=!0,h=!0,f=!0,!0}let P=new gk,k=-1;function L(){let q=23;for(let Q=0,O=i.length;Q<O;++Q)i[Q].state.visible&&(q=31*q+i[Q].id|0);return q=RE(q),q===-1&&(q=0),q}function R(){let q=L();return q!==k?(d=!0,m=!0,p=!0,h=!0,f=!0,k=q,!0):!1}function N(){if(l.length===0)return 0;let q=0,Q=0;for(let O=0,B=l.length;O<B;++O)l[O].state.visible&&(Q+=l[O].values.markerAverage.ref.value,q+=1);return q>0?Q/q:0}function F(){if(l.length===0)return 0;let q=0,Q=0;for(let O=0,B=l.length;O<B;++O)l[O].state.visible&&(Q+=l[O].values.emissiveAverage.ref.value+l[O].values.uEmissive.ref.value,q+=1);return q>0?Q/q:0}function H(){var q,Q;if(l.length===0)return 0;let O=0,B=0;for(let j=0,U=l.length;j<U;++j){let z=l[j];if(!z.state.visible)continue;let $=ko(z.values.alpha.ref.value*z.state.alphaFactor,0,1),Z=!((q=z.values.dXrayShaded)===null||q===void 0)&&q.ref.value?.5:1,J=((Q=z.values.dPointStyle)===null||Q===void 0?void 0:Q.ref.value)==="fuzzy"?.5:1,ie=z.values.dGeometryType.ref.value==="text"?.5:1;B+=(1-z.values.transparencyAverage.ref.value)*$*Z*J*ie,O+=1}return O>0?B/O:0}function V(){var q;if(l.length===0)return!1;for(let Q=0,O=l.length;Q<O;++Q){let B=l[Q];if(B.state.visible&&(B.state.opaque||B.state.alphaFactor===1&&B.values.alpha.ref.value===1&&B.values.transparencyAverage.ref.value!==1||((q=B.values.dTransparentBackfaces)===null||q===void 0?void 0:q.ref.value)==="opaque"))return!0}return!1}return{view:A,position:v,direction:_,up:I,renderables:i,primitives:{view:A,position:v,direction:_,up:I,renderables:l},volumes:{view:A,position:v,direction:_,up:I,renderables:c},syncVisibility:R,setTransparency:q=>{n=q;for(let Q=0,O=i.length;Q<O;++Q)i[Q].setTransparency(q)},update(q,Q){var O;if(xw.update(x),q)for(let B=0,j=q.length;B<j;++B)(O=o.get(q[B]))===null||O===void 0||O.update();else for(let B=0,j=i.length;B<j;++B)i[B].update();Q?R():(u=!0,d=!0),m=!0,p=!0,h=!0,f=!0},add:q=>P.add(q),remove:q=>P.remove(q),commit:(q=Number.MAX_VALUE)=>S(q),get commitQueueSize(){return P.size},get needsCommit(){return!P.isEmpty},has:q=>o.has(q),clear:()=>{for(let q=0,Q=i.length;q<Q;++q)i[q].dispose();i.length=0,l.length=0,c.length=0,o.clear(),u=!0,d=!0},forEach:q=>{o.forEach(q)},get count(){return i.length},get boundingSphere(){return u&&(Sde(i,s,!1),u=!1),s},get boundingSphereVisible(){return d&&(Sde(i,a,!0),d=!1),a},get markerAverage(){return m&&(C=N(),m=!1),C},get emissiveAverage(){return p&&(g=F(),p=!1),g},get opacityAverage(){return h&&(b=H(),h=!1),b},get hasOpaque(){return f&&(y=V(),f=!1),y}}}e.create=t})(Jf||(Jf={}));var oS=class e{get source(){return this._source}get target(){return this._target}apply(t,r=0,n){if((!this.inTransition||r>0)&&Eo.copySnapshot(this._source,this.camera.state),this.inTransition||Eo.copySnapshot(this._target,this.camera.state),Eo.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&r<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode){this.finish(this._target);return}this.inTransition=!0,this.func=n||e.defaultTransition,(!this.inTransition||r>0)&&(this.start=this.t,this.durationMs=r)}tick(t){this.t=t,this.update()}finish(t){Eo.copySnapshot(this.camera.state,t),this.inTransition=!1}update(){if(!this.inTransition)return;let t=Math.min((this.t-this.start)/this.durationMs,1);if(t===1){this.finish(this._target);return}this.func(this._current,t,this._source,this._target),Eo.copySnapshot(this.camera.state,this._current)}constructor(t){this.camera=t,this.t=0,this.func=e.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=Eo.createDefaultSnapshot(),this._target=Eo.createDefaultSnapshot(),this._current=Eo.createDefaultSnapshot()}};(function(e){let t=Tn.identity();function r(n,o,i,s){Eo.copySnapshot(n,s),Tn.slerp(t,Tn.Identity,Tn.rotationTo(t,i.up,s.up),o),D.transformQuat(n.up,i.up,t),D.lerp(n.target,i.target,s.target,o),D.lerp(n.position,i.position,s.position,o),n.radius=zn(i.radius,s.radius,o),n.radiusMax=zn(i.radiusMax,s.radiusMax,o),n.fov=zn(i.fov,s.fov,o),n.fog=zn(i.fog,s.fog,o)}e.defaultTransition=r})(oS||(oS={}));var Ide=D(),Ade=D(),yk=Ht(),Eo=class e{get position(){return this.state.position}set position(t){D.copy(this.state.position,t)}get up(){return this.state.up}set up(t){D.copy(this.state.up,t)}get target(){return this.state.target}set target(t){D.copy(this.state.target,t)}update(){let t=this.state;if(t.radiusMax===0)return!1;let r=2*Math.tan(t.fov/2)*D.distance(t.position,t.target);switch(this.zoom=this.viewport.height/r,IHe(this),this.state.mode){case"orthographic":CHe(this);break;case"perspective":SHe(this);break;default:Sr(this.state.mode)}let n=!de.areEqual(this.projection,this.prevProjection,1e-6)||!de.areEqual(this.view,this.prevView,1e-6);if(n){if(de.mul(this.projectionView,this.projection,this.view),!de.tryInvert(this.inverseProjectionView,this.projectionView))return de.copy(this.view,this.prevView),de.copy(this.projection,this.prevProjection),de.mul(this.projectionView,this.projection,this.view),!1;de.copy(this.prevView,this.view),de.copy(this.prevProjection,this.projection)}return n}setState(t,r){this.transition.apply(t,r),this.stateChanged.next(t)}getSnapshot(){return e.copySnapshot(e.createDefaultSnapshot(),this.state)}getTargetDistance(t){return e.targetDistance(t,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height)}getFocus(t,r,n,o,i){var s,a;let l=Math.max(r,.01),c=this.getTargetDistance(l);D.sub(this.deltaDirection,(s=i?.target)!==null&&s!==void 0?s:this.target,(a=i?.position)!==null&&a!==void 0?a:this.position),o&&D.matchDirection(this.deltaDirection,o,this.deltaDirection),D.setMagnitude(this.deltaDirection,this.deltaDirection,c),D.sub(this.newPosition,t,this.deltaDirection);let u=e.copySnapshot(e.createDefaultSnapshot(),this.state);return u.target=D.clone(t),u.radius=l,u.position=D.clone(this.newPosition),n&&D.matchDirection(u.up,n,u.up),u}getCenter(t,r){D.sub(this.deltaDirection,this.target,this.position),D.sub(this.newPosition,t,this.deltaDirection);let n=e.copySnapshot(e.createDefaultSnapshot(),this.state);return n.target=D.clone(t),n.position=D.clone(this.newPosition),r&&(n.radius=Math.max(r,.01)),n}getInvariantFocus(t,r,n,o){let i=Math.max(r,.01),s=this.getTargetDistance(i);D.copy(this.deltaDirection,o),D.setMagnitude(this.deltaDirection,this.deltaDirection,s),D.sub(this.newPosition,t,this.deltaDirection);let a=e.copySnapshot(e.createDefaultSnapshot(),this.state);return a.target=D.clone(t),a.radius=i,a.position=D.clone(this.newPosition),D.copy(a.up,n),a}focus(t,r,n,o,i){r>0&&this.setState(this.getFocus(t,r,o,i),n)}center(t,r){this.setState(this.getCenter(t),r)}project(t,r){return gde(t,r,this.viewport,this.projectionView)}unproject(t,r){return nS(t,r,this.viewport,this.inverseProjectionView)}getPixelSize(t){return this.project(yk,t),this.unproject(Ide,yk),yk[0]+=1,this.unproject(Ade,yk),D.distance(Ide,Ade)}constructor(t,r=Zo.create(0,0,128,128)){this.view=de.identity(),this.projection=de.identity(),this.projectionView=de.identity(),this.inverseProjectionView=de.identity(),this.state=e.createDefaultSnapshot(),this.viewOffset=e.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new oS(this),this.stateChanged=new jo(this.state),this.prevProjection=de.identity(),this.prevView=de.identity(),this.deltaDirection=D(),this.newPosition=D(),this.viewport=r,e.copySnapshot(this.state,t)}};(function(e){function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}e.ViewOffset=t;function r(l,c,u,d,m,p,h){l.fullWidth=c,l.fullHeight=u,l.offsetX=d,l.offsetY=m,l.width=p,l.height=h}e.setViewOffset=r;function n(l,c){l.enabled=c.enabled,l.fullWidth=c.fullWidth,l.fullHeight=c.fullHeight,l.offsetX=c.offsetX,l.offsetY=c.offsetY,l.width=c.width,l.height=c.height}e.copyViewOffset=n;function o(l,c,u,d,m){let p=Math.max(l,.01),h=d/m,f=m<d?1:h;return Math.abs(c==="orthographic"?p/f/Math.tan(u/2):p/f/Math.sin(u/2))}e.targetDistance=o;function i(){return{mode:"perspective",fov:Math.PI/4,position:D.create(0,0,100),up:D.create(0,1,0),target:D.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}}e.createDefaultSnapshot=i;function s(l,c){return c&&(typeof c.mode<"u"&&(l.mode=c.mode),typeof c.fov<"u"&&(l.fov=c.fov),typeof c.position<"u"&&D.copy(l.position,c.position),typeof c.up<"u"&&D.copy(l.up,c.up),typeof c.target<"u"&&D.copy(l.target,c.target),typeof c.radius<"u"&&(l.radius=c.radius),typeof c.radiusMax<"u"&&(l.radiusMax=c.radiusMax),typeof c.fog<"u"&&(l.fog=c.fog),typeof c.clipFar<"u"&&(l.clipFar=c.clipFar),typeof c.minNear<"u"&&(l.minNear=c.minNear),typeof c.minFar<"u"&&(l.minFar=c.minFar)),l}e.copySnapshot=s;function a(l,c){return l.mode===c.mode&&l.fov===c.fov&&l.radius===c.radius&&l.radiusMax===c.radiusMax&&l.fog===c.fog&&l.clipFar===c.clipFar&&l.minNear===c.minNear&&l.minFar===c.minFar&&D.exactEquals(l.position,c.position)&&D.exactEquals(l.up,c.up)&&D.exactEquals(l.target,c.target)}e.areSnapshotsEqual=a})(Eo||(Eo={}));function CHe(e){let{viewport:t,zoom:r,near:n,far:o,viewOffset:i}=e,s=-t.width/2,a=t.width/2,l=t.height/2,c=-t.height/2,u=(a-s)/(2*r),d=(l-c)/(2*r),m=(a+s)/2,p=(l+c)/2,h=m-u,f=m+u,C=p+d,g=p-d;if(i.enabled){let b=r/(i.width/i.fullWidth),y=r/(i.height/i.fullHeight),x=(a-s)/i.width,A=(l-c)/i.height;h+=x*(i.offsetX/b),f=h+x*(i.width/b),C-=A*(i.offsetY/y),g=C-A*(i.height/y)}de.ortho(e.projection,h,f,C,g,n,o),de.lookAt(e.view,e.position,e.target,e.up)}function SHe(e){let t=e.viewport.width/e.viewport.height,{near:r,far:n,viewOffset:o}=e,i=r*Math.tan(.5*e.state.fov),s=2*i,a=t*s,l=-.5*a;o.enabled&&(l+=o.offsetX*a/o.fullWidth,i-=o.offsetY*s/o.fullHeight,a*=o.width/o.fullWidth,s*=o.height/o.fullHeight),de.perspective(e.projection,l,l+a,i,i-s,r,n),de.lookAt(e.view,e.position,e.target,e.up)}function IHe(e){let{radius:t,radiusMax:r,mode:n,fog:o,clipFar:i,minNear:s,minFar:a}=e.state;t<.01&&(t=.01);let l=Math.max(i?t:r,a),c=D.distance(e.position,e.target),u=c-t,d=c+l;u=Math.max(Math.min(r,s),u),d=Math.max(s,d),u===d&&(d=u+.01);let m=-(50-o)/50,p=c-l*m,h=d;e.near=u,e.far=d,e.fogNear=p,e.fogFar=h}var Sw={sceneBoundingSpheres:M.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:M.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:M.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:M.Boolean(!1,{description:"Show bounding spheres of visible instances."})},bk=class{constructor(t,r,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=Jf.create(t,"blended"),this.parent=r,this._props={...M.getDefaultValues(Sw),...n}}update(){let t=vk(this.scene,this.parent.boundingSphere,this.sceneData,Gt.lightgrey,wHe);t&&(this.sceneData=t);let r=vk(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,Gt.black,_He);r&&(this.visibleSceneData=r),this.parent.forEach((n,o)=>{let i=this.objectsData.get(o),s=vk(this.scene,n.values.boundingSphere.ref.value,i,Gt.tomato,THe);s&&this.objectsData.set(o,s);let a=this.instancesData.get(o),l=vk(this.scene,n.values.invariantBoundingSphere.ref.value,a,Gt.skyblue,EHe,{aTransform:o.values.aTransform,matrix:o.values.matrix,transform:o.values.transform,extraTransform:o.values.extraTransform,uInstanceCount:o.values.uInstanceCount,instanceCount:o.values.instanceCount,aInstance:o.values.aInstance,hasReflection:o.values.hasReflection,instanceGrid:o.values.instanceGrid});l&&this.instancesData.set(o,l)}),this.objectsData.forEach((n,o)=>{this.parent.has(o)||(this.scene.remove(n.renderObject),this.objectsData.delete(o))}),this.instancesData.forEach((n,o)=>{this.parent.has(o)||(this.scene.remove(n.renderObject),this.instancesData.delete(o))}),this.scene.update(void 0,!1),this.scene.commit()}syncVisibility(){this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach((t,r)=>{let n=this.objectsData.get(r);n&&(n.renderObject.state.visible=r.state.visible&&this._props.objectBoundingSpheres);let o=this.instancesData.get(r);o&&(o.renderObject.state.visible=r.state.visible&&this._props.instanceBoundingSpheres)})}clear(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()}get isEnabled(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres}get props(){return this._props}setProps(t){Object.assign(this._props,t),this.isEnabled&&this.update()}};function vk(e,t,r,n,o,i){if(!r||!Pe.equals(r.boundingSphere,t)){let s=AHe(t,r&&r.mesh),a=r?r.renderObject:PHe(s,n,o,i);return r?G.updateIfChanged(a.values.drawCount,Mi.getDrawCount(s)):e.add(a),{boundingSphere:Pe.clone(t),renderObject:a,mesh:s}}}function AHe(e,t){let n=Fp(2),o=gt.createState(n,n/2,t);if(e.radius&&(Rr(o,e.center,e.radius,2),Pe.hasExtrema(e)))for(let i of e.extrema)Rr(o,i,1,0);return gt.getMesh(o)}var wHe=ru(),_He=ru(),THe=ru(),EHe=ru();function PHe(e,t,r,n){let o=Ct.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1,cellSize:0,batchSize:0},t,1,n);return gm("mesh",o,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},r)}var Ry;(function(e){e[e.Move=0]="Move",e[e.Click=1]="Click",e[e.Drag=2]="Drag"})(Ry||(Ry={}));var h9=D(),g9=D(),wde=D(),y9={maxFps:M.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:M.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."})},xk=class{setProps(t){Object.assign(this.props,t)}identify(t,r){let n=this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving;if(t===Ry.Drag){n&&!this.outsideViewport(this.startX,this.startY)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Ve.create(this.startX,this.startY),pageEnd:Ve.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY);return}if(n){let i=this.canvasIdentify(this.endX,this.endY);this.id=i?.id,this.position=i?.position,this.startX=this.endX,this.startY=this.endY}if(t===Ry.Click){let i=this.getLoci(this.id,this.position);this.events.click.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ve.create(this.endX,this.endY),position:this.position}),this.prevLoci=i;return}if(!this.inside||this.currentIdentifyT!==r||!n||this.outsideViewport(this.endX,this.endY))return;let o=this.getLoci(this.id,this.position);this.events.hover.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ve.create(this.endX,this.endY),position:this.position}),this.prevLoci=o}tick(t){this.inside&&t-this.prevT>1e3/this.props.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?Ry.Drag:Ry.Move,t))}leave(){this.inside=!1,Wt.Loci.isEmpty(this.prevLoci)||(this.prevLoci=Wt.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))}move(t,r,n,o,i){this.inside=!0,this.buttons=n,this.button=o,this.modifiers=i,this.endX=t,this.endY=r}click(t,r,n,o,i){this.endX=t,this.endY=r,this.buttons=n,this.button=o,this.modifiers=i,this.identify(Ry.Click,0)}drag(t,r,n,o,i){this.endX=t,this.endY=r,this.buttons=n,this.button=o,this.modifiers=i,this.identify(Ry.Drag,0)}modify(t){nl.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ve.create(this.endX,this.endY),position:this.position}))}outsideViewport(t,r){let{input:n,camera:{viewport:o}}=this;return t*=n.pixelRatio,r*=n.pixelRatio,t>o.x+o.width||n.height-r>o.y+o.height||t<o.x||n.height-r<o.y}getLoci(t,r){var n;let{repr:o,loci:i}=this.lociGetter(t);if(r&&o&&_t.isLoci(i)&&i.bonds.length===2){let{aUnit:s,aIndex:a}=i.bonds[0];s.conformation.position(s.elements[a],h9),D.sub(wde,this.camera.state.position,this.camera.state.target),D.projectPointOnPlane(g9,r,wde,h9);let l=this.camera.getPixelSize(g9),c=o.theme.size.size(i.bonds[0])*((n=o.props.sizeFactor)!==null&&n!==void 0?n:1);if(o.props.lineSizeAttenuation===!1&&(c*=l/2),c+=this.props.preferAtomPixelPadding*l,D.distance(g9,h9)<c)return{repr:o,loci:_t.toFirstStructureElementLoci(i)}}return{repr:o,loci:i}}dispose(){this.ev.dispose()}constructor(t,r,n,o,i,s={}){this.canvasIdentify=t,this.lociGetter=r,this.input=n,this.camera=o,this.controls=i,this.ev=Sc.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=Wt.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=Vo.create(0),this.button=Vo.create(0),this.modifiers=nl.None,this.props={...M.getDefaultValues(y9),...s},n.drag.subscribe(({x:a,y:l,buttons:c,button:u,modifiers:d})=>{this.isInteracting=!0,this.drag(a,l,c,u,d)}),n.move.subscribe(({x:a,y:l,inside:c,buttons:u,button:d,modifiers:m,onElement:p})=>{if(!(!c||this.isInteracting)){if(!p){this.leave();return}this.move(a,l,u,d,m)}}),n.leave.subscribe(()=>{this.leave()}),n.click.subscribe(({x:a,y:l,buttons:c,button:u,modifiers:d})=>{this.outsideViewport(a,l)||this.click(a,l,c,u,d)}),n.interactionEnd.subscribe(()=>{this.isInteracting=!1}),n.modifiers.subscribe(a=>{this.modify(a)})}};var _de=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform mat4 uInvProjection;

uniform float uOutlineThreshold;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    #ifdef dTransparentOutline
        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));
    #else
        return 1.0;
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

void main(void) {
    float backgroundViewZ = 2.0 * uFar;

    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec2 invTexSize = 1.0 / uTexSize;

    float selfDepthOpaque = getDepthOpaque(coords);
    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);
    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;

    float selfDepthTransparent = getDepthTransparent(coords);
    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);
    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;

    float outline = 1.0;
    float bestDepth = 1.0;
    float transparentFlag = 0.0;

    for (int y = -1; y <= 1; y++) {
        for (int x = -1; x <= 1; x++) {
            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            float sampleDepthOpaque = getDepthOpaque(sampleCoords);
            float sampleDepthTransparent = getDepthTransparent(sampleCoords);

            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);
            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestDepth) {
                outline = 0.0;
                bestDepth = sampleDepthOpaque;
            }

            if (sampleDepthTransparent < sampleDepthOpaque) {
                float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);
                if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestDepth) {
                    outline = 0.0;
                    bestDepth = sampleDepthTransparent;
                    transparentFlag = 1.0;
                }
            }
        }
    }

    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), transparentFlag);
}
`;var Tde=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform sampler2D tDepthHalf;
uniform sampler2D tDepthQuarter;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform vec3 uSamples[dNSamples];

uniform mat4 uProjection;
uniform mat4 uInvProjection;

#ifdef dMultiScale
    uniform float uLevelRadius[dLevels];
    uniform float uLevelBias[dLevels];
    uniform float uNearThreshold;
    uniform float uFarThreshold;
#else
    uniform float uRadius;
#endif
uniform float uBias;

float smootherstep(float edge0, float edge1, float x) {
    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);
}

float noise(const in vec2 coords) {
    float a = 12.9898;
    float b = 78.233;
    float c = 43758.5453;
    float dt = dot(coords, vec2(a,b));
    float sn = mod(dt, PI);
    return abs(fract(sin(sn) * c)); // is abs necessary?
}

vec2 getNoiseVec2(const in vec2 coords) {
    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getDepth(const in vec2 coords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    #ifdef depthTextureSupport
        return texture2D(tDepth, c).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, c));
    #endif
}

#define dQuarterThreshold 0.1
#define dHalfThreshold 0.05

float getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {
    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));
    float d = distance(coords, selfCoords);
    #ifdef depthTextureSupport
        if (d > dQuarterThreshold) {
            return texture2D(tDepthQuarter, c).r;
        } else if (d > dHalfThreshold) {
            return texture2D(tDepthHalf, c).r;
        } else {
            return texture2D(tDepth, c).r;
        }
    #else
        if (d > dQuarterThreshold) {
            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));
        } else if (d > dHalfThreshold) {
            return unpackRGBAToDepth(texture2D(tDepthHalf, c));
        } else {
            return unpackRGBAToDepth(texture2D(tDepth, c));
        }
    #endif
}

// adapted from https://gist.github.com/bgolus/a07ed65602c009d5e2f753826e8078a0
vec3 viewNormalAtPixelPositionAccurate(vec2 vpos) {
    // current pixel's depth
    float c = getDepth(vpos);

    // get current pixel's view space position
    vec3 viewSpacePos_c = screenSpaceToViewSpace(vec3(vpos, c), uInvProjection);

    // get view space position at 1 pixel offsets in each major direction
    vec3 viewSpacePos_l = screenSpaceToViewSpace(vec3(vpos + vec2(-1.0, 0.0) / uTexSize, getDepth(vpos + vec2(-1.0, 0.0) / uTexSize)), uInvProjection);
    vec3 viewSpacePos_r = screenSpaceToViewSpace(vec3(vpos + vec2( 1.0, 0.0) / uTexSize, getDepth(vpos + vec2( 1.0, 0.0) / uTexSize)), uInvProjection);
    vec3 viewSpacePos_d = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0,-1.0) / uTexSize, getDepth(vpos + vec2( 0.0,-1.0) / uTexSize)), uInvProjection);
    vec3 viewSpacePos_u = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0, 1.0) / uTexSize, getDepth(vpos + vec2( 0.0, 1.0) / uTexSize)), uInvProjection);

    // get the difference between the current and each offset position
    vec3 l = viewSpacePos_c - viewSpacePos_l;
    vec3 r = viewSpacePos_r - viewSpacePos_c;
    vec3 d = viewSpacePos_c - viewSpacePos_d;
    vec3 u = viewSpacePos_u - viewSpacePos_c;

    // get depth values at 1 & 2 pixels offsets from current along the horizontal axis
    vec4 H = vec4(
        getDepth(vpos + vec2(-1.0, 0.0) / uTexSize),
        getDepth(vpos + vec2( 1.0, 0.0) / uTexSize),
        getDepth(vpos + vec2(-2.0, 0.0) / uTexSize),
        getDepth(vpos + vec2( 2.0, 0.0) / uTexSize)
    );

    // get depth values at 1 & 2 pixels offsets from current along the vertical axis
    vec4 V = vec4(
        getDepth(vpos + vec2(0.0,-1.0) / uTexSize),
        getDepth(vpos + vec2(0.0, 1.0) / uTexSize),
        getDepth(vpos + vec2(0.0,-2.0) / uTexSize),
        getDepth(vpos + vec2(0.0, 2.0) / uTexSize)
    );

    // current pixel's depth difference from slope of offset depth samples
    // differs from original article because we're using non-linear depth values
    // see article's comments
    vec2 he = abs((2.0 * H.xy - H.zw) - c);
    vec2 ve = abs((2.0 * V.xy - V.zw) - c);

    // pick horizontal and vertical diff with the smallest depth difference from slopes
    vec3 hDeriv = he.x < he.y ? l : r;
    vec3 vDeriv = ve.x < ve.y ? d : u;

    // get view space normal from the cross product of the best derivatives
    vec3 viewNormal = normalize(cross(hDeriv, vDeriv));

    return viewNormal;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]
void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);
    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);
        return;
    }

    vec3 selfViewNormal = viewNormalAtPixelPositionAccurate(selfCoords);
    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);

    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));
    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));
    vec3 bitangent = cross(selfViewNormal, tangent);
    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);

    float occlusion = 0.0;
    #ifdef dMultiScale
        float pixelSize = getPixelSize(selfCoords, selfDepth);

        for(int l = 0; l < dLevels; l++) {
            // TODO: smooth transition
            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;
            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;

            float levelOcclusion = 0.0;
            for(int i = 0; i < dNSamples; i++) {
                // get sample position:
                vec3 sampleViewPos = TBN * uSamples[i];
                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];

                // project sample position:
                vec4 offset = vec4(sampleViewPos, 1.0);
                offset = uProjection * offset;
                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

                // get sample depth:
                float sampleDepth = getMappedDepth(offset.xy, selfCoords);
                float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;
                levelOcclusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];
            }
            occlusion = max(occlusion, levelOcclusion);
        }
    #else
        for(int i = 0; i < dNSamples; i++) {
            vec3 sampleViewPos = TBN * uSamples[i];
            sampleViewPos = selfViewPos + sampleViewPos * uRadius;

            vec4 offset = vec4(sampleViewPos, 1.0);
            offset = uProjection * offset;
            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;

            float sampleDepth = getMappedDepth(offset.xy, selfCoords);
            float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;

            occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));
        }
    #endif
    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));

    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));

    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);
}
`;var Ede=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uKernel[dOcclusionKernelSize];

uniform float uBlurDirectionX;
uniform float uBlurDirectionY;

uniform mat4 uInvProjection;
uniform float uNear;
uniform float uFar;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getPixelSize(const in vec2 coords, const in float depth) {
    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);
    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);
    return distance(viewPos0, viewPos1);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;

    if (outsideBounds(coords)) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfDepth = unpackRGToUnitInterval(packedDepth);
    // if background and if second pass
    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {
        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);
        return;
    }

    float selfViewZ = getViewZ(selfDepth);
    float pixelSize = getPixelSize(coords, selfDepth);
    // max diff depth between two pixels
    float maxDiffViewZ = 1.0;

    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;

    float sum = 0.0;
    float kernelSum = 0.0;
    // only if kernelSize is odd
    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {
        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;

        vec2 sampleCoords = coords + float(i) * offset;
        if (outsideBounds(sampleCoords)) {
            continue;
        }

        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);

        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);
        if (isBackground(sampleDepth)) {
            continue;
        }

        float sampleViewZ = getViewZ(sampleDepth);
        if (abs(selfViewZ - sampleViewZ) > maxDiffViewZ) {
            continue;
        }

        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1
        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);

        sum += kernel * sampleValue;
        kernelSum += kernel;
    }
    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);
}
`;var Pde=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tSsaoDepth;
uniform sampler2D tColor;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;
uniform sampler2D tShadows;
uniform sampler2D tOutlines;
uniform vec2 uTexSize;

uniform float uNear;
uniform float uFar;
uniform float uFogNear;
uniform float uFogFar;
uniform vec3 uFogColor;
uniform vec3 uOutlineColor;
uniform vec3 uOcclusionColor;
uniform bool uTransparentBackground;
uniform vec2 uOcclusionOffset;

#include common

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

float getDepthTransparent(const in vec2 coords) {
    #ifdef dTransparentOutline
        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));
    #else
        return 1.0;
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getOutline(const in vec2 coords, const in float opaqueDepth, out float closestTexel) {
    float backgroundViewZ = 2.0 * uFar;
    vec2 invTexSize = 1.0 / uTexSize;

    float transparentDepth = getDepthTransparent(coords);
    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);
    float transparentSelfViewZ = isBackground(transparentDepth) ? backgroundViewZ : getViewZ(transparentDepth);
    float selfDepth = min(opaqueDepth, transparentDepth);

    float outline = 1.0;
    closestTexel = 1.0;
    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {
        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {
            if (x * x + y * y > dOutlineScale * dOutlineScale) {
                continue;
            }

            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;

            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);
            float sampleOutline = sampleOutlineCombined.r;
            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);
            float sampleOutlineViewZ = isBackground(sampleOutlineDepth) ? backgroundViewZ : getViewZ(sampleOutlineDepth);

            float selfViewZ = sampleOutlineCombined.a == 0.0 ? opaqueSelfViewZ : transparentSelfViewZ;
            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel) {
                outline = 0.0;
                closestTexel = sampleOutlineDepth;
            }
        }
    }
    return closestTexel < opaqueDepth ? outline : 1.0;
}

float getSsao(vec2 coords) {
    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);
    if (rawSsao > 0.999) {
        return 1.0;
    } else if (rawSsao > 0.001) {
        return rawSsao;
    }
    // treat values close to 0.0 as errors and return no occlusion
    return 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, coords);

    float viewDist;
    float fogFactor;
    float opaqueDepth = getDepthOpaque(coords);

    #ifdef dOcclusionEnable
        if (!isBackground(opaqueDepth)) {
            viewDist = abs(getViewZ(opaqueDepth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            float occlusionFactor = getSsao(coords + uOcclusionOffset);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);
            } else {
                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);
            }
        }
    #endif

    #ifdef dShadowEnable
        if (!isBackground(opaqueDepth)) {
            viewDist = abs(getViewZ(opaqueDepth));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            vec4 shadow = texture2D(tShadows, coords);
            if (!uTransparentBackground) {
                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);
            } else {
                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);
            }
        }
    #endif

    // outline needs to be handled after occlusion and shadow to keep them clean
    #ifdef dOutlineEnable
        float closestTexel;
        float outline = getOutline(coords, opaqueDepth, closestTexel);
        if (outline == 0.0) {
            viewDist = abs(getViewZ(closestTexel));
            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);
            if (!uTransparentBackground) {
                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);
            } else {
                color.a = 1.0 - fogFactor;
                color.rgb = mix(uOutlineColor, color.rgb, fogFactor);
            }
        }
    #endif

    gl_FragColor = color;
}
`;var Dde=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += uTexSizeInv * vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec2 inverseScreenSize = uTexSizeInv;

    vec4 colorCenter = texture2D(tColor, coords);

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -1.0);
    float lumaUp = sampleLuma(coords, 0.0, 1.0);
    float lumaLeft = sampleLuma(coords, -1.0, 0.0);
    float lumaRight = sampleLuma(coords, 1.0, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);
    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);
    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);
    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}
`;var kde={edgeThresholdMin:M.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:M.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:M.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:M.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})},Ck=class{constructor(t,r){this.webgl=t,this.renderable=MHe(t,r)}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:s,height:a}=t;n.viewport(o,i,s,a),n.scissor(o,i,s,a),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){G.update(this.renderable.values.uTexSizeInv,Ve.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))}update(t,r){let{values:n}=this.renderable,{edgeThresholdMin:o,edgeThresholdMax:i,iterations:s,subpixelQuality:a}=r,l=!1;n.tColor.ref.value!==t&&(G.update(this.renderable.values.tColor,t),l=!0),n.dEdgeThresholdMin.ref.value!==o&&(l=!0),G.updateIfChanged(n.dEdgeThresholdMin,o),n.dEdgeThresholdMax.ref.value!==i&&(l=!0),G.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==s&&(l=!0),G.updateIfChanged(n.dIterations,s),n.dSubpixelQuality.ref.value!==a&&(l=!0),G.updateIfChanged(n.dSubpixelQuality,a),l&&this.renderable.update()}render(t,r){bt&&this.webgl.timer.mark("FxaaPass.render"),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),bt&&this.webgl.timer.markEnd("FxaaPass.render")}},DHe={...Rn,tColor:kt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),dEdgeThresholdMin:Bt("number"),dEdgeThresholdMax:Bt("number"),dIterations:Bt("number"),dSubpixelQuality:Bt("number")},kHe=Gr("fxaa",Kn,Dde);function MHe(e,t){let r=t.getWidth(),n=t.getHeight(),o={...Bn,tColor:G.create(t),uTexSizeInv:G.create(Ve.create(1/r,1/n)),dEdgeThresholdMin:G.create(.0312),dEdgeThresholdMax:G.create(.125),dIterations:G.create(12),dSubpixelQuality:G.create(.3)},i={...DHe},s=on(e,"triangles",kHe,i,o);return sn(s,o)}var Mde=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[2];

void SMAANeighborhoodBlendingVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAANeighborhoodBlendingVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var Rde=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tWeights;
uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[2];

vec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {
    // Fetch the blending weights for current pixel:
    vec4 a;
    a.xz = texture2D(blendTex, texCoord).xz;
    a.y = texture2D(blendTex, offset[1].zw).g;
    a.w = texture2D(blendTex, offset[1].xy).a;

    // Is there any blending weight with a value greater than 0.0?
    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {
        return texture2D(colorTex, texCoord, 0.0);
    } else {
        // Up to 4 lines can be crossing a pixel (one through each edge). We
        // favor blending by choosing the line with the maximum weight for each
        // direction:
        vec2 offset;
        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

        // Then we go in the direction that has the maximum weight:
        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical
            offset.y = 0.0;
        } else {
            offset.x = 0.0;
        }

        // Fetch the opposite color and lerp by hand:
        vec4 C = texture2D(colorTex, texCoord, 0.0);
        texCoord += sign(offset) * uTexSizeInv;
        vec4 Cop = texture2D(colorTex, texCoord, 0.0);
        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);

        // WebGL port note: Added gamma correction
        C.xyz = pow(C.xyz, vec3(2.2));
        Cop.xyz = pow(Cop.xyz, vec3(2.2));
        vec4 mixed = mix(C, Cop, s);
        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

        return mixed;
    }
}

void main() {
    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);
}
`;var Bde=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

void SMAABlendingWeightCalculationVS(vec2 texCoord) {
    vPixCoord = texCoord / uTexSizeInv;

    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components

    // And these for the searches, they indicate the ends of the loops:
    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAABlendingWeightCalculationVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var Lde=`
precision highp float;
precision highp int;
precision highp sampler2D;

#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)

#define SMAA_AREATEX_MAX_DISTANCE 16
#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))
#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)

uniform sampler2D tEdges;
uniform sampler2D tArea;
uniform sampler2D tSearch;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];
varying vec2 vPixCoord;

#if __VERSION__ == 100
    vec2 round(vec2 x) {
        return sign(x) * floor(abs(x) + 0.5);
    }
#endif

float SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
    // Not required if searchTex accesses are set to point:
    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
    e.r = bias + e.r * scale;
    return 255.0 * texture2D(searchTex, e, 0.0).r;
}

float SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    /**
     * @PSEUDO_GATHER4
     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to
     * sample between edge, thus fetching four edges in a row.
     * Sampling with different offsets in each direction allows to disambiguate
     * which edges are active from the four fetched ones.
     */
    vec2 e = vec2(0.0, 1.0);

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D( edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    // We correct the previous (-0.25, -0.125) offset we applied:
    texCoord.x += 0.25 * uTexSizeInv.x;

    // The searches are bias by 1, so adjust the coords accordingly:
    texCoord.x += uTexSizeInv.x;

    // Disambiguate the length added by the last step:
    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step
    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

    return texCoord.x;
}

float SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 0.0, 1.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(2.0, 0.0) * uTexSizeInv;
        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;
    }

    texCoord.x -= 0.25 * uTexSizeInv.x;
    texCoord.x -= uTexSizeInv.x;
    texCoord.x -= 2.0 * uTexSizeInv.x;
    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

    return texCoord.x;
}

float SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

float SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {
    vec2 e = vec2( 1.0, 0.0 );

    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for
        e = texture2D(edgesTex, texCoord, 0.0).rg;
        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign
        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;
    }

    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign
    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign

    return texCoord.y;
}

vec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {
    // Rounding prevents precision errors of bilinear filtering:
    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;

    // We do a scale and bias for mapping to texel space:
    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);

    // Move to proper place, according to the subpixel offset:
    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

    return texture2D(areaTex, texCoord, 0.0).rg;
}

vec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {
    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);

    vec2 e = texture2D(edgesTex, texCoord).rg;

    if (e.g > 0.0) { // Edge at north
        vec2 d;

        // Find the distance to the left:
        vec2 coords;
        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );
        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)
        d.x = coords.x;

        // Now fetch the left crossing edges, two at a time using bilinear
        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
        // discern what value each edge has:
        float e1 = texture2D(edgesTex, coords, 0.0).r;

        // Find the distance to the right:
        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);
        d.y = coords.x;

        // We want the distances to be in pixel units (doing this here allow to
        // better interleave arithmetic and memory accesses):
        d = d / uTexSizeInv.x - pixCoord.x;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the right crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;

        // Ok, we know how this pattern looks like, now it is time for getting
        // the actual area:
        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));
    }

    if (e.r > 0.0) { // Edge at west
        vec2 d;

        // Find the distance to the top:
        vec2 coords;

        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );
        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;
        d.x = coords.y;

        // Fetch the top crossing edges:
        float e1 = texture2D(edgesTex, coords, 0.0).g;

        // Find the distance to the bottom:
        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);
        d.y = coords.y;

        // We want the distances to be in pixel units:
        d = d / uTexSizeInv.y - pixCoord.y;

        // SMAAArea below needs a sqrt, as the areas texture is compressed
        // quadratically:
        vec2 sqrt_d = sqrt(abs(d));

        // Fetch the bottom crossing edges:
        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added
        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;

        // Get the area for this direction:
        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));
    }

    return weights;
}

void main() {
    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));
}
`;var Nde=`
precision highp float;

attribute vec2 aPosition;
uniform vec2 uQuadScale;

uniform vec2 uTexSizeInv;
uniform vec4 uViewport;

varying vec2 vUv;
varying vec4 vOffset[3];

void SMAAEdgeDetectionVS(vec2 texCoord) {
    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component
    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component
    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component
}

void main() {
    vec2 scale = uViewport.zw * uTexSizeInv;
    vec2 shift = uViewport.xy * uTexSizeInv;
    vUv = (aPosition + 1.0) * 0.5 * scale + shift;
    SMAAEdgeDetectionVS(vUv);
    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;
    gl_Position = vec4(position, 0.0, 1.0);
}
`;var Fde=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

varying vec2 vUv;
varying vec4 vOffset[3];

vec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {
    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);

    // Calculate color deltas:
    vec4 delta;
    vec3 C = texture2D(colorTex, texcoord).rgb;

    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;
    vec3 t = abs(C - Cleft);
    delta.x = max(max(t.r, t.g), t.b);

    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;
    t = abs(C - Ctop);
    delta.y = max(max(t.r, t.g), t.b);

    // We do the usual threshold:
    vec2 edges = step(threshold, delta.xy);

    // Then discard if there is no edge:
    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)
        discard;

    // Calculate right and bottom deltas:
    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;
    t = abs( C - Cright );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;
    t = abs(C - Cbottom);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the maximum delta in the direct neighborhood:
    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );

    // Calculate left-left and top-top deltas:
    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;
    t = abs( C - Cleftleft );
    delta.z = max(max(t.r, t.g), t.b);

    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;
    t = abs(C - Ctoptop);
    delta.w = max(max(t.r, t.g), t.b);

    // Calculate the final maximum delta:
    maxDelta = max(max(maxDelta, delta.z), delta.w);

    // Local contrast adaptation in action:
    edges.xy *= step(0.5 * maxDelta, delta.xy);

    return vec4(edges, 0.0, 0.0);
}

void main() {
    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);
}
`;var Ode={edgeThreshold:M.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:M.Numeric(16,{min:0,max:32,step:1})},Sk=class{get supported(){return this._supported}constructor(t,r){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u")return;let n=r.getWidth(),o=r.getHeight();this.edgesTarget=t.createRenderTarget(n,o,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(n,o,!1,"uint8","linear"),this.edgesRenderable=LHe(t,r),this.weightsRenderable=OHe(t,this.edgesTarget.texture),this.blendRenderable=UHe(t,r,this.weightsTarget.texture),this._supported=!0}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:s,height:a}=t;n.viewport(o,i,s,a),n.scissor(o,i,s,a),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),G.update(this.edgesRenderable.values.uViewport,Zo.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),G.update(this.weightsRenderable.values.uViewport,Zo.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),G.update(this.blendRenderable.values.uViewport,Zo.toVec4(this.blendRenderable.values.uViewport.ref.value,t))}setSize(t,r){let n=this.edgesTarget.getWidth(),o=this.edgesTarget.getHeight();(t!==n||r!==o)&&(this.edgesTarget.setSize(t,r),this.weightsTarget.setSize(t,r),G.update(this.edgesRenderable.values.uTexSizeInv,Ve.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),G.update(this.weightsRenderable.values.uTexSizeInv,Ve.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),G.update(this.blendRenderable.values.uTexSizeInv,Ve.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/r)))}update(t,r){let n=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(G.update(this.edgesRenderable.values.tColor,t),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==r.edgeThreshold&&(G.update(this.edgesRenderable.values.dEdgeThreshold,r.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==r.maxSearchSteps&&(G.update(this.weightsRenderable.values.dMaxSearchSteps,r.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(G.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())}render(t,r){bt&&this.webgl.timer.mark("SmaaPass.render"),this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render(),bt&&this.webgl.timer.markEnd("SmaaPass.render")}},RHe={...Rn,tColor:kt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uViewport:Re("v4"),dEdgeThreshold:Bt("number")},BHe=Gr("smaa-edges",Nde,Fde);function LHe(e,t){let r=t.getWidth(),n=t.getHeight(),o={...Bn,tColor:G.create(t),uTexSizeInv:G.create(Ve.create(1/r,1/n)),uViewport:G.create(Ht()),dEdgeThreshold:G.create(.1)},i={...RHe},s=on(e,"triangles",BHe,i,o);return sn(s,o)}var NHe={...Rn,tEdges:kt("texture","rgba","ubyte","linear"),tArea:kt("texture","rgb","ubyte","linear"),tSearch:kt("texture","rgba","ubyte","nearest"),uTexSizeInv:Re("v2"),uViewport:Re("v4"),dMaxSearchSteps:Bt("number")},FHe=Gr("smaa-weights",Bde,Lde);function OHe(e,t){let r=t.getWidth(),n=t.getHeight(),o=e.resources.texture("image-uint8","rgb","ubyte","linear"),i=e.resources.texture("image-uint8","rgba","ubyte","nearest"),s={...Bn,tEdges:G.create(t),tArea:G.create(o),tSearch:G.create(i),uTexSizeInv:G.create(Ve.create(1/r,1/n)),uViewport:G.create(Ht()),dMaxSearchSteps:G.create(16)};z5(zHe(),s.tArea,o),z5(HHe(),s.tSearch,i);let a={...NHe},l=on(e,"triangles",FHe,a,s);return sn(l,s)}var VHe={...Rn,tColor:kt("texture","rgba","ubyte","linear"),tWeights:kt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uViewport:Re("v4")},GHe=Gr("smaa-blend",Mde,Rde);function UHe(e,t,r){let n=t.getWidth(),o=t.getHeight(),i={...Bn,tColor:G.create(t),tWeights:G.create(r),uTexSizeInv:G.create(Ve.create(1/n,1/o)),uViewport:G.create(Ht())},s={...VHe},a=on(e,"triangles",GHe,s,i);return sn(a,i)}function zHe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}function HHe(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}var Vde=`
precision mediump float;
precision mediump samplerCube;
precision mediump sampler2D;

#if defined(dVariant_skybox)
    uniform samplerCube tSkybox;
    uniform mat4 uViewDirectionProjectionInverse;
    uniform float uBlur;
    uniform float uOpacity;
    uniform float uSaturation;
    uniform float uLightness;
    uniform mat3 uRotation;
#elif defined(dVariant_image)
    uniform sampler2D tImage;
    uniform vec2 uImageScale;
    uniform vec2 uImageOffset;
    uniform float uBlur;
    uniform float uOpacity;
    uniform float uSaturation;
    uniform float uLightness;
#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)
    uniform vec3 uGradientColorA;
    uniform vec3 uGradientColorB;
    uniform float uGradientRatio;
#endif

uniform vec2 uTexSize;
uniform vec4 uViewport;
uniform bool uViewportAdjusted;
varying vec4 vPosition;

// TODO: add as general pp option to remove banding?
// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf
vec3 ScreenSpaceDither(vec2 vScreenPos) {
    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));
    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));
    return vDither.rgb / 255.0;
}

vec3 saturateColor(vec3 c, float amount) {
    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance
    const vec3 W = vec3(0.2125, 0.7154, 0.0721);
    vec3 intensity = vec3(dot(c, W));
    return mix(intensity, c, 1.0 + amount);
}

vec3 lightenColor(vec3 c, float amount) {
    return c + amount;
}

void main() {
    #if defined(dVariant_skybox)
        vec4 t = uViewDirectionProjectionInverse * vPosition;
        #ifdef enabledShaderTextureLod
            gl_FragColor = textureCubeLodEXT(tSkybox, uRotation * normalize(t.xyz / t.w), uBlur * 8.0);
        #else
            gl_FragColor = textureCube(tSkybox, uRotation * normalize(t.xyz / t.w));
        #endif
        gl_FragColor.a = uOpacity;
        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);
    #elif defined(dVariant_image)
        vec2 coords;
        if (uViewportAdjusted) {
            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;
        } else {
            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;
        }
        #ifdef enabledShaderTextureLod
            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);
        #else
            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));
        #endif
        gl_FragColor.a = uOpacity;
        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);
    #elif defined(dVariant_horizontalGradient)
        float d;
        if (uViewportAdjusted) {
            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);
        } else {
            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);
        }
        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);
        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);
    #elif defined(dVariant_radialGradient)
        float d;
        if (uViewportAdjusted) {
            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;
        } else {
            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;
        }
        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);
        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);
    #endif
}
`;var Gde=`
precision mediump float;

attribute vec2 aPosition;

varying vec4 vPosition;

void main() {
    vPosition = vec4(aPosition, 1.0, 1.0);
    gl_Position = vec4(aPosition, 1.0, 1.0);
}
`;function Iw(){return Iw.zero()}(function(e){function t(){let p=[.1,0,0];return p[0]=0,p}e.zero=t;function r(p,h,f){let C=t();return C[0]=p,C[1]=h,C[2]=f,C}e.create=r;function n(p,h,f,C){return p[0]=h,p[0]=f,p[0]=C,p}e.set=n;function o(p){let h=t();return h[0]=p[0],h[1]=p[1],h[2]=p[2],h}e.clone=o;function i(p,h){return p[0]=h[0],p[1]=h[1],p[2]=h[2],p}e.copy=i;function s(p,h,f){let C=h[0],g=h[4],b=h[8],y=h[1],x=h[5],A=h[9],v=h[2],_=h[6],I=h[10];switch(f){case"XYZ":p[1]=Math.asin(ko(b,-1,1)),Math.abs(b)<.9999999?(p[0]=Math.atan2(-A,I),p[2]=Math.atan2(-g,C)):(p[0]=Math.atan2(_,x),p[2]=0);break;case"YXZ":p[0]=Math.asin(-ko(A,-1,1)),Math.abs(A)<.9999999?(p[1]=Math.atan2(b,I),p[2]=Math.atan2(y,x)):(p[1]=Math.atan2(-v,C),p[2]=0);break;case"ZXY":p[0]=Math.asin(ko(_,-1,1)),Math.abs(_)<.9999999?(p[1]=Math.atan2(-v,I),p[2]=Math.atan2(-g,x)):(p[1]=0,p[2]=Math.atan2(y,C));break;case"ZYX":p[1]=Math.asin(-ko(v,-1,1)),Math.abs(v)<.9999999?(p[0]=Math.atan2(_,I),p[2]=Math.atan2(y,C)):(p[0]=0,p[2]=Math.atan2(-g,x));break;case"YZX":p[2]=Math.asin(ko(y,-1,1)),Math.abs(y)<.9999999?(p[0]=Math.atan2(-A,x),p[1]=Math.atan2(-v,C)):(p[0]=0,p[1]=Math.atan2(b,I));break;case"XZY":p[2]=Math.asin(-ko(g,-1,1)),Math.abs(g)<.9999999?(p[0]=Math.atan2(_,x),p[1]=Math.atan2(b,C)):(p[0]=Math.atan2(-A,I),p[1]=0);break;default:Sr(f)}return p}e.fromMat4=s;let a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function l(p,h,f){return de.fromQuat(a,h),s(p,a,f)}e.fromQuat=l;function c(p,h){return n(p,h[0],h[1],h[2])}e.fromVec3=c;function u(p,h){return p[0]===h[0]&&p[1]===h[1]&&p[2]===h[2]}e.exactEquals=u;function d(p,h,f){return p[0]=h[f+0],p[1]=h[f+1],p[2]=h[f+2],p}e.fromArray=d;function m(p,h,f){return h[f+0]=p[0],h[f+1]=p[1],h[f+2]=p[2],h}e.toArray=m})(Iw||(Iw={}));var $de={opacity:M.Numeric(1,{min:0,max:1,step:.01}),saturation:M.Numeric(0,{min:-1,max:1,step:.01}),lightness:M.Numeric(0,{min:-1,max:1,step:.01})},jHe={faces:M.MappedStatic("urls",{urls:M.Group({nx:M.Text("",{label:"Negative X / Left"}),ny:M.Text("",{label:"Negative Y / Bottom"}),nz:M.Text("",{label:"Negative Z / Back"}),px:M.Text("",{label:"Positive X / Right"}),py:M.Text("",{label:"Positive Y / Top"}),pz:M.Text("",{label:"Positive Z / Front"})},{isExpanded:!0,label:"URLs"}),files:M.Group({nx:M.File({label:"Negative X / Left",accept:"image/*"}),ny:M.File({label:"Negative Y / Bottom",accept:"image/*"}),nz:M.File({label:"Negative Z / Back",accept:"image/*"}),px:M.File({label:"Positive X / Right",accept:"image/*"}),py:M.File({label:"Positive Y / Top",accept:"image/*"}),pz:M.File({label:"Positive Z / Front",accept:"image/*"})},{isExpanded:!0,label:"Files"})}),blur:M.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.'}),rotation:M.Group({x:M.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),y:M.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),z:M.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0})}),...$de},$He={source:M.MappedStatic("url",{url:M.Text(""),file:M.File({accept:"image/*"})}),blur:M.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.'}),...$de,coverage:M.Select("viewport",M.arrayToOptions(["viewport","canvas"]))},WHe={topColor:M.Color(ze(14540253)),bottomColor:M.Color(ze(15658734)),ratio:M.Numeric(.5,{min:0,max:1,step:.01}),coverage:M.Select("viewport",M.arrayToOptions(["viewport","canvas"]))},qHe={centerColor:M.Color(ze(14540253)),edgeColor:M.Color(ze(15658734)),ratio:M.Numeric(.5,{min:0,max:1,step:.01}),coverage:M.Select("viewport",M.arrayToOptions(["viewport","canvas"]))},Wde={variant:M.MappedStatic("off",{off:M.EmptyGroup(),skybox:M.Group(jHe,{isExpanded:!0}),image:M.Group($He,{isExpanded:!0}),horizontalGradient:M.Group(WHe,{isExpanded:!0}),radialGradient:M.Group(qHe,{isExpanded:!0})},{label:"Environment"})},Ik=class{constructor(t,r,n,o){this.webgl=t,this.assetManager=r,this.camera=new Eo,this.target=D(),this.position=D(),this.dir=D(),this.renderable=r6e(t,n,o)}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&G.update(this.renderable.values.uTexSize,Ve.set(this.renderable.values.uTexSize.ref.value,t,r))}clearSkybox(){this.skybox!==void 0&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(t=>this.assetManager.release(t)),this.skybox=void 0)}updateSkybox(t,r,n){var o;let i=(o=this.skybox)===null||o===void 0?void 0:o.props.faces,s=r.faces.params;if(!s.nx||!s.ny||!s.nz||!s.px||!s.py||!s.pz){this.clearSkybox(),n?.(!1);return}if(!this.skybox||!i||!XHe(r.faces,this.skybox.props.faces)){this.clearSkybox();let{texture:u,assets:d}=YHe(this.webgl,this.assetManager,r.faces,m=>{this.skybox&&(this.skybox.loaded=!m),n?.(!0)});this.skybox={texture:u,props:{...r},assets:d,loaded:!1},G.update(this.renderable.values.tSkybox,u),this.renderable.update()}else n?.(!1);if(!this.skybox)return;let a=t;t.state.mode==="orthographic"&&(this.camera.setState({...t.state,mode:"perspective"}),this.camera.update(),a=this.camera);let l=this.renderable.values.uViewDirectionProjectionInverse.ref.value;D.sub(this.dir,a.state.position,a.state.target),D.setMagnitude(this.dir,this.dir,.1),D.copy(this.position,this.dir),de.lookAt(l,this.position,this.target,a.state.up),de.mul(l,a.projection,l),de.invert(l,l),G.update(this.renderable.values.uViewDirectionProjectionInverse,l);let c=this.renderable.values.uRotation.ref.value;nr.fromEuler(c,Iw.create(Pr(r.rotation.x),Pr(r.rotation.y),Pr(r.rotation.z)),"XYZ"),G.update(this.renderable.values.uRotation,c),G.updateIfChanged(this.renderable.values.uBlur,r.blur),G.updateIfChanged(this.renderable.values.uOpacity,r.opacity),G.updateIfChanged(this.renderable.values.uSaturation,r.saturation),G.updateIfChanged(this.renderable.values.uLightness,r.lightness),G.updateIfChanged(this.renderable.values.dVariant,"skybox"),this.renderable.update()}clearImage(){this.image!==void 0&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)}updateImage(t,r){if(!t.source.params){this.clearImage(),r?.(!1);return}if(!this.image||!this.image.props.source.params||!QHe(t.source,this.image.props.source)){this.clearImage();let{texture:n,asset:o}=JHe(this.webgl,this.assetManager,t.source,i=>{this.image&&(this.image.loaded=!i),r?.(!0)});this.image={texture:n,props:{...t},asset:o,loaded:!1},G.update(this.renderable.values.tImage,n),this.renderable.update()}else r?.(!1);this.image&&(G.updateIfChanged(this.renderable.values.uBlur,t.blur),G.updateIfChanged(this.renderable.values.uOpacity,t.opacity),G.updateIfChanged(this.renderable.values.uSaturation,t.saturation),G.updateIfChanged(this.renderable.values.uLightness,t.lightness),G.updateIfChanged(this.renderable.values.uViewportAdjusted,t.coverage==="viewport"),G.updateIfChanged(this.renderable.values.dVariant,"image"),this.renderable.update())}updateImageScaling(){var t,r;let n=this.renderable.values,[o,i]=n.uTexSize.ref.value,s=((t=this.image)===null||t===void 0?void 0:t.texture.getWidth())||0,a=((r=this.image)===null||r===void 0?void 0:r.texture.getHeight())||0,l=o/i,c=s/a;l<c?G.update(n.uImageScale,Ve.set(n.uImageScale.ref.value,s*i/a,i)):G.update(n.uImageScale,Ve.set(n.uImageScale.ref.value,o,a*o/s));let[u,d]=n.uImageScale.ref.value,m=u/d;m>l?G.update(n.uImageOffset,Ve.set(n.uImageOffset.ref.value,(1-l/m)/2,0)):G.update(n.uImageOffset,Ve.set(n.uImageOffset.ref.value,0,(1-m/l)/2))}updateGradient(t,r,n,o,i){G.update(this.renderable.values.uGradientColorA,ze.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,t)),G.update(this.renderable.values.uGradientColorB,ze.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,r)),G.updateIfChanged(this.renderable.values.uGradientRatio,n),G.updateIfChanged(this.renderable.values.uViewportAdjusted,i),G.updateIfChanged(this.renderable.values.dVariant,o),this.renderable.update()}update(t,r,n){if(r.variant.name==="off"){this.clearSkybox(),this.clearImage(),n?.(!1);return}else r.variant.name==="skybox"?(this.clearImage(),this.updateSkybox(t,r.variant.params,n)):r.variant.name==="image"?(this.clearSkybox(),this.updateImage(r.variant.params,n)):r.variant.name==="horizontalGradient"?(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.topColor,r.variant.params.bottomColor,r.variant.params.ratio,r.variant.name,r.variant.params.coverage==="viewport"),n?.(!1)):r.variant.name==="radialGradient"&&(this.clearSkybox(),this.clearImage(),this.updateGradient(r.variant.params.centerColor,r.variant.params.edgeColor,r.variant.params.ratio,r.variant.name,r.variant.params.coverage==="viewport"),n?.(!1));let{x:o,y:i,width:s,height:a}=t.viewport;G.update(this.renderable.values.uViewport,Ht.set(this.renderable.values.uViewport.ref.value,o,i,s,a))}isEnabled(t){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||t.variant.name==="horizontalGradient"||t.variant.name==="radialGradient")}isReady(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||this.renderable.values.dVariant.ref.value==="horizontalGradient"||this.renderable.values.dVariant.ref.value==="radialGradient")}render(){this.isReady()&&(this.renderable.values.dVariant.ref.value==="image"&&this.updateImageScaling(),bt&&this.webgl.timer.mark("BackgroundPass.render"),this.renderable.render(),bt&&this.webgl.timer.markEnd("BackgroundPass.render"))}dispose(){this.clearSkybox(),this.clearImage()}},Ude="background-skybox";function ZHe(e,t){return t.name==="urls"?{nx:Nr.getUrlAsset(e,t.params.nx),ny:Nr.getUrlAsset(e,t.params.ny),nz:Nr.getUrlAsset(e,t.params.nz),px:Nr.getUrlAsset(e,t.params.px),py:Nr.getUrlAsset(e,t.params.py),pz:Nr.getUrlAsset(e,t.params.pz)}:{nx:t.params.nx,ny:t.params.ny,nz:t.params.nz,px:t.params.px,py:t.params.py,pz:t.params.pz}}function KHe(e,t){let r=n=>e.resolve(n,"binary").run().then(o=>new Blob([o.data]));return{nx:r(t.nx),ny:r(t.ny),nz:r(t.nz),px:r(t.px),py:r(t.py),pz:r(t.pz)}}function zde(e){var t,r,n,o,i,s;return e.name==="urls"?`${Ude}_${e.params.nx}|${e.params.ny}|${e.params.nz}|${e.params.px}|${e.params.py}|${e.params.pz}`:`${Ude}_${(t=e.params.nx)===null||t===void 0?void 0:t.id}|${(r=e.params.ny)===null||r===void 0?void 0:r.id}|${(n=e.params.nz)===null||n===void 0?void 0:n.id}|${(o=e.params.px)===null||o===void 0?void 0:o.id}|${(i=e.params.py)===null||i===void 0?void 0:i.id}|${(s=e.params.pz)===null||s===void 0?void 0:s.id}`}function XHe(e,t){return zde(e)===zde(t)}function YHe(e,t,r,n){let o=ZHe(t,r),i=KHe(t,o),s=[o.nx,o.ny,o.nz,o.px,o.py,o.pz];return typeof HTMLImageElement>"u"?(n?.(!0),{texture:Ro(),assets:s}):{texture:e.resources.cubeTexture(i,!0,n),assets:s}}var Hde="background-image";function jde(e){var t;return e.name==="url"?`${Hde}_${e.params}`:`${Hde}_${(t=e.params)===null||t===void 0?void 0:t.id}`}function QHe(e,t){return jde(e)===jde(t)}function JHe(e,t,r,n){let o=r.name==="url"?Nr.getUrlAsset(t,r.params):r.params;if(typeof HTMLImageElement>"u")return n?.(!0),{texture:Ro(),asset:o};let i=e.resources.texture("image-uint8","rgba","ubyte","linear"),s=new Image;return s.onload=()=>{i.load(s),(e.isWebGL2||m0(s.width)&&m0(s.height))&&i.mipmap(),n?.()},s.onerror=()=>{n?.(!0)},t.resolve(o,"binary").run().then(a=>{let l=new Blob([a.data]);s.src=URL.createObjectURL(l)}),{texture:i,asset:o}}var e6e={drawCount:jn("number"),instanceCount:jn("number"),aPosition:cn("float32",2,0),tSkybox:kt("texture","rgba","ubyte","linear"),tImage:kt("texture","rgba","ubyte","linear"),uImageScale:Re("v2"),uImageOffset:Re("v2"),uTexSize:Re("v2"),uViewport:Re("v4"),uViewportAdjusted:Re("b"),uViewDirectionProjectionInverse:Re("m4"),uGradientColorA:Re("v3"),uGradientColorB:Re("v3"),uGradientRatio:Re("f"),uBlur:Re("f"),uOpacity:Re("f"),uSaturation:Re("f"),uLightness:Re("f"),uRotation:Re("m3"),dVariant:Bt("string",["skybox","image","verticalGradient","horizontalGradient","radialGradient"])},t6e=Gr("background",Gde,Vde,{shaderTextureLod:"optional"});function r6e(e,t,r){let n={drawCount:G.create(6),instanceCount:G.create(1),aPosition:G.create(B2),tSkybox:G.create(Ro()),tImage:G.create(Ro()),uImageScale:G.create(Ve()),uImageOffset:G.create(Ve()),uTexSize:G.create(Ve.create(t,r)),uViewport:G.create(Ht()),uViewportAdjusted:G.create(!0),uViewDirectionProjectionInverse:G.create(de()),uGradientColorA:G.create(D()),uGradientColorB:G.create(D()),uGradientRatio:G.create(.5),uBlur:G.create(0),uOpacity:G.create(1),uSaturation:G.create(0),uLightness:G.create(0),uRotation:G.create(nr.identity()),dVariant:G.create("skybox")},o={...e6e},i=on(e,"triangles",t6e,o,n);return sn(i,n)}var qde=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tDepth;
uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uNear;
uniform float uFar;

#if dLightCount != 0
    uniform vec3 uLightDirection[dLightCount];
    uniform vec3 uLightColor[dLightCount];
#endif

uniform mat4 uProjection;
uniform mat4 uInvProjection;

uniform float uMaxDistance;
uniform float uTolerance;
uniform float uBias;

bool isBackground(const in float depth) {
    return depth == 1.0;
}

bool outsideBounds(const in vec2 p) {
    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;
}

float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

float screenFade(const in vec2 coords) {
    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);
    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));
    return saturate(1.0 - dot(fade, fade));
}

// based on https://panoskarabelas.com/posts/screen_space_shadows/
float screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in float stepLength) {
    // Ray position and direction (in view-space)
    vec3 rayPos = position;
    vec3 rayDir = -lightDirection;

    // Compute ray step
    vec3 rayStep = rayDir * stepLength;

    // Ray march towards the light
    float occlusion = 0.0;
    vec4 rayCoords = vec4(0.0);
    for (int i = 0; i < dSteps; ++i) {
        // Step the ray
        rayPos += rayStep;

        rayCoords = uProjection * vec4(rayPos, 1.0);
        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;

        if (outsideBounds(rayCoords.xy))
            return 1.0;

        // Compute the difference between the ray's and the camera's depth
        float depth = getDepth(rayCoords.xy);
        float viewZ = getViewZ(depth);
        float zDelta = rayPos.z - viewZ;

        if (zDelta < uTolerance) {
            occlusion = 1.0;

            // Fade out as we approach the edges of the screen
            occlusion *= screenFade(rayCoords.xy);

            break;
        }
    }

    return 1.0 - (uBias * occlusion);
}

void main(void) {
    vec2 invTexSize = 1.0 / uTexSize;
    vec2 selfCoords = gl_FragCoord.xy * invTexSize;

    float selfDepth = getDepth(selfCoords);

    if (isBackground(selfDepth)) {
        gl_FragColor = vec4(0.0);
        return;
    }

    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);
    float stepLength = uMaxDistance / float(dSteps);

    float o = 1.0;
    #if dLightCount != 0
        float sh[dLightCount];
        #pragma unroll_loop_start
        for (int i = 0; i < dLightCount; ++i) {
            sh[i] = screenSpaceShadow(selfViewPos, uLightDirection[i], stepLength);
            o = min(o, sh[i]);
        }
        #pragma unroll_loop_end
    #endif

    gl_FragColor = vec4(o);
}
`;var Zde=`
precision mediump float;
precision mediump sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSizeInv;

uniform float uSharpness;

// adapted from https://www.shadertoy.com/view/stXSWB

/*
* FidelityFX Super Resolution scales up a low resolution
* image, while adding fine detail.
*
* MIT Open License
*
* https://gpuopen.com/fsr
*
* Left: FSR processed
* Right: Original texture, bilinear interpolation
*
* Mouse at top: Sharpness 0 stops (maximum)
* Mouse at bottom: Sharpness 2 stops (minimum)
*
* It works in two passes-
*   EASU upsamples the image with a clamped Lanczos kernel.
*   RCAS sharpens the image at the target resolution.
*
* I needed to make a few changes to improve readability and
* WebGL compatibility in an algorithm I don't fully understand.
* Expect bugs.
*
* Shader not currently running for WebGL1 targets (eg. mobile Safari)
*
* There is kind of no point to using FSR in Shadertoy, as it renders buffers
* at full target resolution. But this might be useful for WebGL based demos
* running smaller-than-target render buffers.
*
* For sharpening with a full resolution render buffer,
* FidelityFX CAS is a better option.
* https://www.shadertoy.com/view/ftsXzM
*
* For readability and compatibility, these optimisations have been removed:
*   * Fast approximate inverse and inversesqrt
*   * textureGather fetches (not WebGL compatible)
*   * Multiplying by reciprocal instead of division
*
* Apologies to AMD for the numerous slowdowns and errors I have introduced.
*
*/

/***** RCAS *****/
#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))

// Input callback prototypes that need to be implemented by calling shader
vec4 FsrRcasLoadF(vec2 p);
//------------------------------------------------------------------------------------------------------------------------------
void FsrRcasCon(
    out float con,
    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.
    float sharpness
) {
    // Transform from stops to linear value.
    con = exp2(-sharpness);
}

vec3 FsrRcasF(
    vec2 ip, // Integer pixel position in output.
    float con
) {
    // Constant generated by RcasSetup().
    // Algorithm uses minimal 3x3 pixel neighborhood.
    //    b
    //  d e f
    //    h
    vec2 sp = vec2(ip);
    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;
    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;
    vec3 e = FsrRcasLoadF(sp).rgb;
    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;
    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;

    // Luma times 2.
    float bL = b.g + .5 * (b.b + b.r);
    float dL = d.g + .5 * (d.b + d.r);
    float eL = e.g + .5 * (e.b + e.r);
    float fL = f.g + .5 * (f.b + f.r);
    float hL = h.g + .5 * (h.b + h.r);

    // Noise detection.
    #ifdef dDenoise
        float nz = .25 * (bL + dL + fL + hL) - eL;
        nz=clamp(
            abs(nz)
            /(
                max(max(bL,dL),max(eL,max(fL,hL)))
                -min(min(bL,dL),min(eL,min(fL,hL)))
            ),
            0., 1.
        );
        nz=1.-.5*nz;
    #endif

    // Min and max of ring.
    vec3 mn4 = min(b, min(f, h));
    vec3 mx4 = max(b, max(f, h));

    // Immediate constants for peak range.
    vec2 peakC = vec2(1., -4.);

    // Limiters, these need to be high precision RCPs.
    vec3 hitMin = mn4 / (4. * mx4);
    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);
    vec3 lobeRGB = max(-hitMin, hitMax);
    float lobe = max(
        -FSR_RCAS_LIMIT,
        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)
    )*con;

    // Apply noise removal.
    #ifdef dDenoise
        lobe *= nz;
    #endif

    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.
    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);
}


vec4 FsrRcasLoadF(vec2 p) {
    return texture2D(tColor, p * uTexSizeInv);
}

void main() {
    // Set up constants
    float con;
    FsrRcasCon(con, uSharpness);

    // Perform RCAS pass
    vec3 col = FsrRcasF(gl_FragCoord.xy, con);

    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);
}
`;var Kde={sharpness:M.Numeric(.5,{min:0,max:1,step:.05}),denoise:M.Boolean(!0)},Ak=class{constructor(t,r){this.webgl=t,this.renderable=i6e(t,r)}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:s,height:a}=t;n.viewport(o,i,s,a),n.scissor(o,i,s,a),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){G.update(this.renderable.values.uTexSizeInv,Ve.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/r))}update(t,r){let{values:n}=this.renderable,{sharpness:o,denoise:i}=r,s=!1;n.tColor.ref.value!==t&&(G.update(this.renderable.values.tColor,t),s=!0),G.updateIfChanged(n.uSharpness,2-2*Math.pow(o,.25)),n.dDenoise.ref.value!==i&&(s=!0),G.updateIfChanged(n.dDenoise,i),s&&this.renderable.update()}render(t,r){bt&&this.webgl.timer.mark("CasPass.render"),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),bt&&this.webgl.timer.markEnd("CasPass.render")}},n6e={...Rn,tColor:kt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uSharpness:Re("f"),dDenoise:Bt("boolean")},o6e=Gr("cas",Kn,Zde);function i6e(e,t){let r=t.getWidth(),n=t.getHeight(),o={...Bn,tColor:G.create(t),uTexSizeInv:G.create(Ve.create(1/r,1/n)),uSharpness:G.create(.5),dDenoise:G.create(!0)},i={...n6e},s=on(e,"triangles",o6e,i,o);return sn(s,o)}var Xde=`
precision highp float;
precision highp int;
precision highp sampler2D;

#include common

uniform sampler2D tColor;
uniform sampler2D tDepthOpaque;
uniform sampler2D tDepthTransparent;

uniform vec2 uTexSize;
uniform vec4 uBounds;

uniform float uBlurSpread;
uniform float uInFocus;
uniform float uPPM;

uniform float uNear; // Near plane
uniform float uFar;  // Far plane

uniform mat4 uInvProjection; // Inverse projection
uniform mat4 uProjection; // projection

uniform int uMode; // 0-planar, 1-spherical
uniform vec3 uCenter; // Center of focus sphere in view space

// Function to convert depth value from depth buffer to view space Z
float getViewZ(const in float depth) {
    #if dOrthographic == 1
        return orthographicDepthToViewZ(depth, uNear, uFar);
    #else
        return perspectiveDepthToViewZ(depth, uNear, uFar);
    #endif
}

// Retrieve depth from opaque depth texture
float getDepthOpaque(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepthOpaque, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));
    #endif
}

// Retrieve depth from transparent depth texture
float getDepthTransparent(const in vec2 coords) {
    return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

float getDepth(const in vec2 coords) {
    return min(getDepthOpaque(coords), getDepthTransparent(coords));
}

float getCOC(vec2 uv) {
    float depth = getDepth(uv);
    float viewDist = getViewZ(depth);
    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);
    float focusDist = length(aposition - uCenter);
    float coc = 0.0;  // Circle of Confusion
    if (uMode == 0) { // planar Depth of field
        coc = (abs(viewDist) - uInFocus) / uPPM;  //focus distance, focus range
    } else if(uMode == 1) { // spherical Depth of field
        coc = focusDist / uPPM ;
    }
    coc = clamp(coc, -1.0, 1.0);
    return coc;
}

// Simple box blur for blurring the image
vec3 getBlurredImage(vec2 coords) {
    vec4 blurColor = vec4(0);
    vec2 texelSize = vec2(1.0 / uTexSize.x, 1.0 / uTexSize.y);
    float count = 0.0;
    for (int x = 0; x < int(dBlurSize); x++) {
        for (int y = 0; y < int(dBlurSize); y++) {
            vec2 offset = vec2(float(x) - float(dBlurSize) / 2.0, float(y) - float(dBlurSize) / 2.0);
            vec2 uvPixel = coords.xy + offset * texelSize * uBlurSpread;
            float coc = getCOC(uvPixel);
            coc = smoothstep(0.0, 1.0, abs(coc));
            // mix blurColor with new color with weight coc
            blurColor.rgb = blurColor.rgb + texture2D(tColor, uvPixel).xyz * coc;
            count+=coc;
        }
    }
    blurColor = blurColor / count;
    return blurColor.rgb;
}

// simplification from https://catlikecoding.com/unity/tutorials/advanced-rendering/depth-of-field/
void main() {
    vec2 uv = gl_FragCoord.xy / uTexSize;
    vec4 color = texture2D(tColor, uv);
    float depth = getDepth(uv);

    float viewDist = getViewZ(depth);

    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);
    float focusDist = length(aposition - uCenter);
    vec3 blurColor = getBlurredImage(uv);

    float coc = getCOC(uv); // Circle of Confusion

    // for debugging the coc
    // color.rgb = (coc < 0.0) ? (1.0 - abs(coc)) * vec3(1.0,0.0,0.0) : vec3(0.0, 1.0 - coc, 0.0) ;//mix(color.rgb, blurColor.rgb, abs(coc));
    color.rgb = mix(color.rgb, blurColor, smoothstep(0.0, 1.0, abs(coc))); // Smooth blending based on CoC
    gl_FragColor = color;
}
`;var Yde={blurSize:M.Numeric(9,{min:1,max:32,step:1}),blurSpread:M.Numeric(1,{min:0,max:10,step:.1}),inFocus:M.Numeric(0,{min:-5e3,max:5e3,step:1},{description:"Distance from the scene center that will be in focus"}),PPM:M.Numeric(20,{min:0,max:5e3,step:.1},{description:"Size of the area that will be in focus"}),center:M.Select("camera-target",M.arrayToOptions(["scene-center","camera-target"])),mode:M.Select("plane",M.arrayToOptions(["plane","sphere"]))},eh=class{static isEnabled(t){return t.dof.name!=="off"}constructor(t,r,n){this.webgl=t,this.target=t.createRenderTarget(r,n,!1);let o=Ro();this.renderable=l6e(t,o,o,o)}updateState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:s,height:a}=t;n.viewport(o,i,s,a),n.scissor(o,i,s,a),n.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)}setSize(t,r){let n=this.target.texture.getWidth(),o=this.target.texture.getHeight();(t!==n||r!==o)&&(this.target.setSize(t,r),G.update(this.renderable.values.uTexSize,Ve.set(this.renderable.values.uTexSize.ref.value,t,r)))}update(t,r,n,o,i,s){let a=!1;this.renderable.values.tColor.ref.value!==r&&(G.update(this.renderable.values.tColor,r),a=!0),this.renderable.values.tDepthOpaque.ref.value!==n&&(G.update(this.renderable.values.tDepthOpaque,n),a=!0),this.renderable.values.tDepthTransparent.ref.value!==o&&(G.update(this.renderable.values.tDepthTransparent,o),a=!0);let l=t.state.mode==="orthographic"?1:0,c=this.renderable.values.uInvProjection.ref.value;de.invert(c,t.projection);let[u,d]=this.renderable.values.uTexSize.ref.value,m=t.viewport;G.update(this.renderable.values.uProjection,t.projection),G.update(this.renderable.values.uInvProjection,c),G.update(this.renderable.values.uMode,i.mode==="sphere"?1:0),Ht.set(this.renderable.values.uBounds.ref.value,m.x/u,m.y/d,(m.x+m.width)/u,(m.y+m.height)/d),G.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),G.updateIfChanged(this.renderable.values.uNear,t.near),G.updateIfChanged(this.renderable.values.uFar,t.far),G.updateIfChanged(this.renderable.values.dOrthographic,l),this.renderable.values.dBlurSize.ref.value!==i.blurSize&&(G.update(this.renderable.values.dBlurSize,i.blurSize),a=!0);let p=i.center==="scene-center"?s.center:t.state.target,f=D.distance(t.state.position,p)+i.inFocus;G.updateIfChanged(this.renderable.values.uInFocus,f);let C=this.renderable.values.uCenter.ref.value;D.transformMat4(C,p,t.view),G.update(this.renderable.values.uCenter,C),G.updateIfChanged(this.renderable.values.uBlurSpread,i.blurSpread),G.updateIfChanged(this.renderable.values.uPPM,i.PPM),a&&this.renderable.update()}render(t,r){bt&&this.webgl.timer.mark("DofPass.render"),r?r.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),bt&&this.webgl.timer.markEnd("DofPass.render")}},s6e={...Rn,tDepthOpaque:kt("texture","rgba","ubyte","nearest"),tDepthTransparent:kt("texture","rgba","ubyte","nearest"),tColor:kt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),uProjection:Re("m4"),uInvProjection:Re("m4"),uBounds:Re("v4"),uCenter:Re("v3"),uMode:Re("i"),dOrthographic:Bt("number"),uNear:Re("f"),uFar:Re("f"),dBlurSize:Bt("number"),uBlurSpread:Re("f"),uInFocus:Re("f"),uPPM:Re("f")},a6e=Gr("dof",Kn,Xde);function l6e(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),s={...Bn,tDepthOpaque:G.create(r),tDepthTransparent:G.create(n),tColor:G.create(t),uTexSize:G.create(Ve.create(o,i)),uProjection:G.create(de.identity()),uInvProjection:G.create(de.identity()),uBounds:G.create(Ht()),uCenter:G.create(D()),uMode:G.create(0),dOrthographic:G.create(0),uNear:G.create(1),uFar:G.create(1e4),dBlurSize:G.create(5),uBlurSpread:G.create(300),uInFocus:G.create(20),uPPM:G.create(20)},a={...s6e},l=on(e,"triangles",a6e,a,s);return sn(l,s)}var Qde=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform vec2 uTexSizeInv;

uniform sampler2D tBlur1;
uniform sampler2D tBlur2;
uniform sampler2D tBlur3;
uniform sampler2D tBlur4;
uniform sampler2D tBlur5;
uniform float uBloomStrength;
uniform float uBloomRadius;
uniform float uBloomFactors[5];
uniform vec3 uBloomTints[5];

float lerpBloomFactor(const in float factor) {
    float mirrorFactor = 1.2 - factor;
    return mix(factor, mirrorFactor, uBloomRadius);
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;

    gl_FragColor = uBloomStrength * (
        lerpBloomFactor(uBloomFactors[0]) * vec4(uBloomTints[0], 1.0) * texture2D(tBlur1, coords) +
        lerpBloomFactor(uBloomFactors[1]) * vec4(uBloomTints[1], 1.0) * texture2D(tBlur2, coords) +
        lerpBloomFactor(uBloomFactors[2]) * vec4(uBloomTints[2], 1.0) * texture2D(tBlur3, coords) +
        lerpBloomFactor(uBloomFactors[3]) * vec4(uBloomTints[3], 1.0) * texture2D(tBlur4, coords) +
        lerpBloomFactor(uBloomFactors[4]) * vec4(uBloomTints[4], 1.0) * texture2D(tBlur5, coords)
    );
}
`;var Jde=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
uniform sampler2D tEmissive;
uniform sampler2D tDepth;
uniform vec2 uTexSizeInv;

uniform vec3 uDefaultColor;
uniform float uDefaultOpacity;
uniform float uLuminosityThreshold;
uniform float uSmoothWidth;

#include common

float getDepth(const in vec2 coords) {
    #ifdef depthTextureSupport
        return texture2D(tDepth, coords).r;
    #else
        return unpackRGBAToDepth(texture2D(tDepth, coords));
    #endif
}

bool isBackground(const in float depth) {
    return depth == 1.0;
}

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 texel = texture2D(tColor, coords);
    float emissive = texture2D(tEmissive, coords).a;
    float depth = getDepth(coords);

    if (isBackground(depth)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
    }

    vec4 outputColor = vec4(uDefaultColor.rgb, uDefaultOpacity);

    #if defined(dMode_luminosity)
        vec3 luma = vec3(0.299, 0.587, 0.114);
        float v = dot(texel.xyz, luma);
        float alpha = smoothstep(uLuminosityThreshold, uLuminosityThreshold + uSmoothWidth, v);

        gl_FragColor = mix(outputColor, texel, alpha);
    #elif defined(dMode_emissive)
        gl_FragColor = mix(outputColor, texel, emissive);
    #endif
}
`;var eme=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInput;
uniform vec2 uTexSizeInv;

uniform vec2 uDirection;
uniform float uGaussianCoefficients[dKernelRadius];

void main(void) {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    float weightSum = uGaussianCoefficients[0];
    vec4 diffuseSum = texture2D(tInput, coords) * weightSum;

    for(int i = 1; i < dKernelRadius; ++i) {
        float x = float(i);
        float w = uGaussianCoefficients[i];
        vec2 offset = uDirection * uTexSizeInv * x;
        vec4 sample1 = texture2D(tInput, coords + offset);
        vec4 sample2 = texture2D(tInput, coords - offset);
        diffuseSum += (sample1 + sample2) * w;
        weightSum += 2.0 * w;
    }

    gl_FragColor = diffuseSum / weightSum;
}
`;var v9=5,tme={strength:M.Numeric(1,{min:0,max:3,step:.1}),radius:M.Numeric(0,{min:0,max:1,step:.01}),threshold:M.Numeric(0,{min:0,max:1,step:.01},{description:"Luminosity threshold",hideIf:e=>e.mode==="emissive"}),mode:M.Select("emissive",[["luminosity","Luminosity"],["emissive","Emissive"]])},wk=class{static isEnabled(t){return t.bloom.name==="on"}constructor(t,r,n){this.webgl=t,this.horizontalBlurTargets=[],this.verticalBlurTargets=[],this.emissiveTarget=t.createRenderTarget(r,n,!0,"uint8","linear","rgba"),this.luminosityTarget=t.createRenderTarget(r,n,!1,"uint8","linear"),this.compositeTarget=t.createRenderTarget(r,n,!1,"uint8","linear");let o=Math.round(r/2),i=Math.round(n/2);for(let a=0;a<v9;++a)this.horizontalBlurTargets[a]=t.createRenderTarget(o,i,!1,"uint8","linear"),this.verticalBlurTargets[a]=t.createRenderTarget(o,i,!1,"uint8","linear"),o=Math.round(o/2),i=Math.round(i/2);let s=Ro();this.luminosityRenderable=d6e(t,s,s,s),this.blurRenderable=v6e(t,s),this.compositeRenderable=C6e(t,r,n,this.verticalBlurTargets[0].texture,this.verticalBlurTargets[1].texture,this.verticalBlurTargets[2].texture,this.verticalBlurTargets[3].texture,this.verticalBlurTargets[4].texture),this.copyRenderable=pg(t,this.compositeTarget.texture)}setSize(t,r){let n=this.luminosityTarget.getWidth(),o=this.luminosityTarget.getHeight();if(t!==n||r!==o){this.emissiveTarget.setSize(t,r),this.luminosityTarget.setSize(t,r),this.compositeTarget.setSize(t,r);let i=Math.round(t/2),s=Math.round(r/2);for(let a=0;a<v9;++a)this.horizontalBlurTargets[a].setSize(i,s),this.verticalBlurTargets[a].setSize(i,s),i=Math.round(i/2),s=Math.round(s/2);G.update(this.luminosityRenderable.values.uTexSizeInv,Ve.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),G.update(this.compositeRenderable.values.uTexSizeInv,Ve.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/t,1/r)),G.update(this.copyRenderable.values.uTexSize,Ve.set(this.copyRenderable.values.uTexSize.ref.value,t,r))}}update(t,r,n,o){let i=!1;this.luminosityRenderable.values.tColor.ref.value!==t&&(G.update(this.luminosityRenderable.values.tColor,t),i=!0),this.luminosityRenderable.values.tEmissive.ref.value!==r&&(G.update(this.luminosityRenderable.values.tEmissive,r),i=!0),this.luminosityRenderable.values.tDepth.ref.value!==n&&(G.update(this.luminosityRenderable.values.tDepth,n),i=!0),this.luminosityRenderable.values.dMode.ref.value!==o.mode&&(G.update(this.luminosityRenderable.values.dMode,o.mode),i=!0),G.updateIfChanged(this.luminosityRenderable.values.uLuminosityThreshold,o.threshold),i&&this.luminosityRenderable.update();let s=!1;this.blurRenderable.values.tInput.ref.value!==t&&(G.update(this.blurRenderable.values.tInput,t),s=!0),s&&this.blurRenderable.update(),G.update(this.compositeRenderable.values.uBloomRadius,o.radius),G.update(this.compositeRenderable.values.uBloomStrength,o.strength)}render(t,r){bt&&this.webgl.timer.mark("BloomPass.render");let{gl:n,state:o}=this.webgl,{x:i,y:s,width:a,height:l}=t;o.viewport(i,s,a,l),o.scissor(i,s,a,l),o.enable(n.SCISSOR_TEST),o.disable(n.BLEND),o.disable(n.DEPTH_TEST),o.depthMask(!1),this.luminosityTarget.bind(),this.luminosityRenderable.render();for(let c=0;c<v9;++c){let u=this.horizontalBlurTargets[c].getWidth(),d=this.horizontalBlurTargets[c].getHeight();o.viewport(0,0,u,d),o.scissor(0,0,u,d),G.update(this.blurRenderable.values.dKernelRadius,b9[c]),G.update(this.blurRenderable.values.uGaussianCoefficients,p6e(b9[c])),G.update(this.blurRenderable.values.uTexSizeInv,Ve.set(this.blurRenderable.values.uTexSizeInv.ref.value,1/u,1/d)),this.horizontalBlurTargets[c].bind(),G.update(this.blurRenderable.values.tInput,c===0?this.luminosityTarget.texture:this.verticalBlurTargets[c-1].texture),G.update(this.blurRenderable.values.uDirection,f6e),this.blurRenderable.update(),this.blurRenderable.render(),this.verticalBlurTargets[c].bind(),G.update(this.blurRenderable.values.tInput,this.horizontalBlurTargets[c].texture),G.update(this.blurRenderable.values.uDirection,h6e),this.blurRenderable.update(),this.blurRenderable.render()}o.viewport(i,s,a,l),o.scissor(i,s,a,l),this.compositeTarget.bind(),this.compositeRenderable.update(),this.compositeRenderable.render(),r?r.bind():this.webgl.unbindFramebuffer(),o.enable(n.BLEND),o.blendFunc(n.ONE,n.ONE),this.copyRenderable.render(),bt&&this.webgl.timer.markEnd("BloomPass.render")}},c6e={...Rn,tColor:kt("texture","rgba","ubyte","linear"),tEmissive:kt("texture","rgba","ubyte","linear"),tDepth:kt("texture","rgba","ubyte","nearest"),uTexSizeInv:Re("v2"),uDefaultColor:Re("v3"),uDefaultOpacity:Re("f"),uLuminosityThreshold:Re("f"),uSmoothWidth:Re("f"),dMode:Bt("string",["luminosity","emissive"])},u6e=Gr("Bloom Luminosity",Kn,Jde);function d6e(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),s={...Bn,tColor:G.create(t),tEmissive:G.create(r),tDepth:G.create(n),uTexSizeInv:G.create(Ve.create(1/o,1/i)),uDefaultColor:G.create(D()),uDefaultOpacity:G.create(0),uLuminosityThreshold:G.create(0),uSmoothWidth:G.create(1),dMode:G.create("emissive")},a={...c6e},l=on(e,"triangles",u6e,a,s);return sn(l,s)}function m6e(e){let t=[];for(let r=0;r<e;++r)t.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return t}var p6e=gg(m6e),b9=[3,5,7,9,11],f6e=Ve.create(1,0),h6e=Ve.create(0,1),g6e={...Rn,tInput:kt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uDirection:Re("v2"),uGaussianCoefficients:Re("f[]"),dKernelRadius:Bt("number")},y6e=Gr("Bloom Blur",Kn,eme);function v6e(e,t){let r=t.getWidth(),n=t.getHeight(),o={...Bn,tInput:G.create(t),uTexSizeInv:G.create(Ve.create(1/r,1/n)),uDirection:G.create(Ve()),uGaussianCoefficients:G.create([]),dKernelRadius:G.create(b9[0])},i={...g6e},s=on(e,"triangles",y6e,i,o);return sn(s,o)}var b6e={...Rn,tBlur1:kt("texture","rgba","ubyte","linear"),tBlur2:kt("texture","rgba","ubyte","linear"),tBlur3:kt("texture","rgba","ubyte","linear"),tBlur4:kt("texture","rgba","ubyte","linear"),tBlur5:kt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uBloomStrength:Re("f"),uBloomRadius:Re("f"),uBloomFactors:Re("f[]"),uBloomTints:Re("v3[]")},x6e=Gr("Bloom Composite",Kn,Qde);function C6e(e,t,r,n,o,i,s,a){let l={...Bn,uTexSizeInv:G.create(Ve.create(t,r)),tBlur1:G.create(n),tBlur2:G.create(o),tBlur3:G.create(i),tBlur4:G.create(s),tBlur5:G.create(a),uBloomStrength:G.create(1),uBloomRadius:G.create(0),uBloomFactors:G.create([1,.8,.6,.4,.2]),uBloomTints:G.create(new Array(15).fill(1))},c={...b6e},u=on(e,"triangles",x6e,c,l);return sn(u,l)}var S6e={...Rn,tDepthOpaque:kt("texture","rgba","ubyte","nearest"),tDepthTransparent:kt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),dOrthographic:Bt("number"),uNear:Re("f"),uFar:Re("f"),uInvProjection:Re("m4"),uOutlineThreshold:Re("f"),dTransparentOutline:Bt("boolean")};function I6e(e,t,r,n){let o=t.getWidth(),i=t.getHeight(),s={...Bn,tDepthOpaque:G.create(t),tDepthTransparent:G.create(r),uTexSize:G.create(Ve.create(o,i)),dOrthographic:G.create(0),uNear:G.create(1),uFar:G.create(1e4),uInvProjection:G.create(de.identity()),uOutlineThreshold:G.create(.33),dTransparentOutline:G.create(n)},a={...S6e},l=Gr("outlines",Kn,_de),c=on(e,"triangles",l,a,s);return sn(c,s)}var A6e={...Rn,tDepth:kt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),uProjection:Re("m4"),uInvProjection:Re("m4"),uBounds:Re("v4"),dOrthographic:Bt("number"),uNear:Re("f"),uFar:Re("f"),dSteps:Bt("number"),uMaxDistance:Re("f"),uTolerance:Re("f"),uBias:Re("f"),uLightDirection:Re("v3[]"),uLightColor:Re("v3[]"),dLightCount:Bt("number")};function w6e(e,t){let r=t.getWidth(),n=t.getHeight(),o={...Bn,tDepth:G.create(t),uTexSize:G.create(Ve.create(r,n)),uProjection:G.create(de.identity()),uInvProjection:G.create(de.identity()),uBounds:G.create(Ht()),dOrthographic:G.create(0),uNear:G.create(1),uFar:G.create(1e4),dSteps:G.create(1),uMaxDistance:G.create(3),uTolerance:G.create(1),uBias:G.create(.6),uLightDirection:G.create([]),uLightColor:G.create([]),dLightCount:G.create(0)},i={...A6e},s=Gr("shadows",Kn,qde),a=on(e,"triangles",s,i,o);return sn(a,o)}var _6e={...Rn,tDepth:kt("texture","rgba","ubyte","nearest"),tDepthHalf:kt("texture","rgba","ubyte","nearest"),tDepthQuarter:kt("texture","rgba","ubyte","nearest"),uSamples:Re("v3[]"),dNSamples:Bt("number"),uProjection:Re("m4"),uInvProjection:Re("m4"),uBounds:Re("v4"),uTexSize:Re("v2"),uRadius:Re("f"),uBias:Re("f"),dMultiScale:Bt("boolean"),dLevels:Bt("number"),uLevelRadius:Re("f[]"),uLevelBias:Re("f[]"),uNearThreshold:Re("f"),uFarThreshold:Re("f")};function T6e(e,t,r,n){let o={...Bn,tDepth:G.create(t),tDepthHalf:G.create(r),tDepthQuarter:G.create(n),uSamples:G.create(ome(32)),dNSamples:G.create(32),uProjection:G.create(de.identity()),uInvProjection:G.create(de.identity()),uBounds:G.create(Ht()),uTexSize:G.create(Ve.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:G.create(Math.pow(2,5)),uBias:G.create(.8),dMultiScale:G.create(!1),dLevels:G.create(3),uLevelRadius:G.create([Math.pow(2,2),Math.pow(2,5),Math.pow(2,8)]),uLevelBias:G.create([.8,.8,.8]),uNearThreshold:G.create(10),uFarThreshold:G.create(1500)},i={..._6e},s=Gr("ssao",Kn,Tde),a=on(e,"triangles",s,i,o);return sn(a,o)}var E6e={...Rn,tSsaoDepth:kt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),uKernel:Re("f[]"),dOcclusionKernelSize:Bt("number"),uBlurDirectionX:Re("f"),uBlurDirectionY:Re("f"),uInvProjection:Re("m4"),uNear:Re("f"),uFar:Re("f"),uBounds:Re("v4"),dOrthographic:Bt("number")};function rme(e,t,r){let n={...Bn,tSsaoDepth:G.create(t),uTexSize:G.create(Ve.create(t.getWidth(),t.getHeight())),uKernel:G.create(nme(15)),dOcclusionKernelSize:G.create(15),uBlurDirectionX:G.create(r==="horizontal"?1:0),uBlurDirectionY:G.create(r==="vertical"?1:0),uInvProjection:G.create(de.identity()),uNear:G.create(0),uFar:G.create(1e4),uBounds:G.create(Ht()),dOrthographic:G.create(0)},o={...E6e},i=Gr("ssao_blur",Kn,Ede),s=on(e,"triangles",i,o,n);return sn(s,n)}function nme(e){let t=e/3,r=Math.floor((e+1)/2),n=[];for(let o=0;o<r;o++)n.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-o*o/(2*t*t)));return n}var _k=[];for(let e=0;e<256;e++){let t=D();t[0]=Math.random()*2-1,t[1]=Math.random()*2-1,t[2]=Math.random(),D.normalize(t,t),D.scale(t,t,Math.random()),_k.push(t)}function ome(e){let t=[];for(let r=0;r<e;r++){let n=(r*r+2*r+1)/(e*e);n=.1+n*(1-.1),t.push(_k[r][0]*n),t.push(_k[r][1]*n),t.push(_k[r][2]*n)}return t}var P6e={...Rn,tSsaoDepth:kt("texture","rgba","ubyte","nearest"),tColor:kt("texture","rgba","ubyte","nearest"),tDepthOpaque:kt("texture","rgba","ubyte","nearest"),tDepthTransparent:kt("texture","rgba","ubyte","nearest"),tShadows:kt("texture","rgba","ubyte","nearest"),tOutlines:kt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),dOrthographic:Bt("number"),uNear:Re("f"),uFar:Re("f"),uFogNear:Re("f"),uFogFar:Re("f"),uFogColor:Re("v3"),uOutlineColor:Re("v3"),uOcclusionColor:Re("v3"),uTransparentBackground:Re("b"),dOcclusionEnable:Bt("boolean"),uOcclusionOffset:Re("v2"),dShadowEnable:Bt("boolean"),dOutlineEnable:Bt("boolean"),dOutlineScale:Bt("number"),dTransparentOutline:Bt("boolean")};function D6e(e,t,r,n,o,i,s,a){let l={...Bn,tSsaoDepth:G.create(s),tColor:G.create(t),tDepthOpaque:G.create(r),tDepthTransparent:G.create(n),tShadows:G.create(o),tOutlines:G.create(i),uTexSize:G.create(Ve.create(t.getWidth(),t.getHeight())),dOrthographic:G.create(0),uNear:G.create(1),uFar:G.create(1e4),uFogNear:G.create(1e4),uFogFar:G.create(1e4),uFogColor:G.create(D.create(1,1,1)),uOutlineColor:G.create(D.create(0,0,0)),uOcclusionColor:G.create(D.create(0,0,0)),uTransparentBackground:G.create(!1),dOcclusionEnable:G.create(!0),uOcclusionOffset:G.create(Ve.create(0,0)),dShadowEnable:G.create(!1),dOutlineEnable:G.create(!1),dOutlineScale:G.create(1),dTransparentOutline:G.create(a)},c={...P6e},u=Gr("postprocessing",Kn,Pde),d=on(e,"triangles",u,c,l);return sn(d,l)}var iS={occlusion:M.MappedStatic("on",{on:M.Group({samples:M.Numeric(32,{min:1,max:256,step:1}),multiScale:M.MappedStatic("off",{on:M.Group({levels:M.ObjectList({radius:M.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x"}),bias:M.Numeric(1,{min:0,max:3,step:.1})},e=>`${e.radius}, ${e.bias}`,{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:M.Numeric(10,{min:0,max:50,step:1}),farThreshold:M.Numeric(1500,{min:0,max:1e4,step:100})}),off:M.Group({})},{cycle:!0}),radius:M.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x",hideIf:e=>e?.multiScale.name==="on"}),bias:M.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:M.Numeric(15,{min:1,max:25,step:2}),resolutionScale:M.Numeric(1,{min:.1,max:1,step:.05},{description:"Adjust resolution of occlusion calculation"}),color:M.Color(ze(0))}),off:M.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),shadow:M.MappedStatic("off",{on:M.Group({steps:M.Numeric(1,{min:1,max:64,step:1}),bias:M.Numeric(.6,{min:0,max:1,step:.01}),maxDistance:M.Numeric(3,{min:0,max:256,step:1}),tolerance:M.Numeric(1,{min:0,max:10,step:.1})}),off:M.Group({})},{cycle:!0,description:"Simplistic shadows"}),outline:M.MappedStatic("off",{on:M.Group({scale:M.Numeric(1,{min:1,max:5,step:1}),threshold:M.Numeric(.33,{min:.01,max:1,step:.01}),color:M.Color(ze(0)),includeTransparent:M.Boolean(!0,{description:"Whether to show outline for transparent objects"})}),off:M.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),dof:M.MappedStatic("off",{on:M.Group(Yde),off:M.Group({})},{cycle:!0,description:"DOF"}),antialiasing:M.MappedStatic("smaa",{fxaa:M.Group(kde),smaa:M.Group(Ode),off:M.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"}),sharpening:M.MappedStatic("off",{on:M.Group(Kde),off:M.Group({})},{cycle:!0,description:"Contrast Adaptive Sharpening"}),background:M.Group(Wde,{isFlat:!0}),bloom:M.MappedStatic("on",{on:M.Group(tme),off:M.Group({})},{cycle:!0,description:"Bloom"})};function k6e(e,t){let r=e.length,{radius:n,bias:o}=t||{radius:new Array(r*3).fill(0),bias:new Array(r*3).fill(0)};e=e.slice().sort((i,s)=>i.radius-s.radius);for(let i=0;i<r;++i){let s=e[i];n[i]=Math.pow(2,s.radius),o[i]=s.bias}return{count:r,radius:n,bias:o}}var lc=class{static isEnabled(t){return t.occlusion.name==="on"||t.shadow.name==="on"||t.outline.name==="on"||t.background.variant.name!=="off"}static isTransparentOutlineEnabled(t){return t.outline.name==="on"&&t.outline.params.includeTransparent}calcSsaoScale(t){return Math.min(1,1/this.webgl.pixelRatio)*t}constructor(t,r,n){this.webgl=t,this.drawPass=n,this.bgColor=D(),this.occlusionOffset=[0,0],this.transparentBackground=!1;let{colorTarget:o,depthTextureTransparent:i,depthTextureOpaque:s}=n,a=o.getWidth(),l=o.getHeight();this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.levels=[],this.target=t.createRenderTarget(a,l,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(a,l,!1),this.outlinesRenderable=I6e(t,s,i,!0),this.shadowsTarget=t.createRenderTarget(a,l,!1),this.shadowsRenderable=w6e(t,s),this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();let c=Math.floor(a*this.ssaoScale),u=Math.floor(l*this.ssaoScale),d=Math.max(1,Math.floor(c*.5)),m=Math.max(1,Math.floor(u*.5)),p=Math.max(1,Math.floor(c*.25)),h=Math.max(1,Math.floor(u*.25));this.downsampledDepthTarget=n.packedDepth?t.createRenderTarget(c,u,!1,"uint8","nearest","rgba"):t.createRenderTarget(c,u,!1,"float32","nearest",t.isWebGL2?"alpha":"rgba"),this.downsampleDepthRenderable=pg(t,s);let f=this.ssaoScale===1?s:this.downsampledDepthTarget.texture;this.depthHalfTarget=n.packedDepth?t.createRenderTarget(d,m,!1,"uint8","nearest","rgba"):t.createRenderTarget(d,m,!1,"float32","nearest",t.isWebGL2?"alpha":"rgba"),this.depthHalfRenderable=pg(t,f),this.depthQuarterTarget=n.packedDepth?t.createRenderTarget(p,h,!1,"uint8","nearest","rgba"):t.createRenderTarget(p,h,!1,"float32","nearest",t.isWebGL2?"alpha":"rgba"),this.depthQuarterRenderable=pg(t,this.depthHalfTarget.texture),this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthTexture.define(c,u),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","nearest"),this.ssaoDepthBlurProxyTexture.define(c,u),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=T6e(t,f,this.depthHalfTarget.texture,this.depthQuarterTarget.texture),this.ssaoBlurFirstPassRenderable=rme(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=rme(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=D6e(t,o.texture,s,i,this.shadowsTarget.texture,this.outlinesTarget.texture,this.ssaoDepthTexture,!0),this.background=new Ik(t,r,a,l)}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value,i=this.calcSsaoScale(1);if(t!==n||r!==o||this.ssaoScale!==i){this.ssaoScale=i,this.target.setSize(t,r),this.outlinesTarget.setSize(t,r),this.shadowsTarget.setSize(t,r);let s=Math.floor(t*this.ssaoScale),a=Math.floor(r*this.ssaoScale);this.downsampledDepthTarget.setSize(s,a),this.ssaoDepthTexture.define(s,a),this.ssaoDepthBlurProxyTexture.define(s,a);let l=Math.max(1,Math.floor(s*.5)),c=Math.max(1,Math.floor(a*.5));this.depthHalfTarget.setSize(l,c);let u=Math.max(1,Math.floor(s*.25)),d=Math.max(1,Math.floor(a*.25));this.depthQuarterTarget.setSize(u,d),G.update(this.renderable.values.uTexSize,Ve.set(this.renderable.values.uTexSize.ref.value,t,r)),G.update(this.outlinesRenderable.values.uTexSize,Ve.set(this.outlinesRenderable.values.uTexSize.ref.value,t,r)),G.update(this.shadowsRenderable.values.uTexSize,Ve.set(this.shadowsRenderable.values.uTexSize.ref.value,t,r)),G.update(this.downsampleDepthRenderable.values.uTexSize,Ve.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,s,a)),G.update(this.depthHalfRenderable.values.uTexSize,Ve.set(this.depthHalfRenderable.values.uTexSize.ref.value,l,c)),G.update(this.depthQuarterRenderable.values.uTexSize,Ve.set(this.depthQuarterRenderable.values.uTexSize.ref.value,u,d)),G.update(this.ssaoRenderable.values.uTexSize,Ve.set(this.ssaoRenderable.values.uTexSize.ref.value,s,a)),G.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Ve.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,a)),G.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Ve.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,a));let m=this.ssaoScale===1?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;G.update(this.depthHalfRenderable.values.tColor,m),G.update(this.ssaoRenderable.values.tDepth,m),this.depthHalfRenderable.update(),this.ssaoRenderable.update(),this.background.setSize(t,r)}}updateState(t,r,n,o,i){var s;let a=!1,l=!1,c=!1,u=!1,d=!1,m=!1,p=t.state.mode==="orthographic"?1:0,h=o.outline.name==="on",f=o.shadow.name==="on",C=o.occlusion.name==="on",g=de.identity();de.invert(g,t.projection);let[b,y]=this.renderable.values.uTexSize.ref.value,x=t.viewport;if(o.occlusion.name==="on"){G.update(this.ssaoRenderable.values.uProjection,t.projection),G.update(this.ssaoRenderable.values.uInvProjection,g);let _=this.ssaoRenderable.values.uBounds,I=this.ssaoScale;Ht.set(_.ref.value,Math.floor(x.x*I)/(b*I),Math.floor(x.y*I)/(y*I),Math.ceil((x.x+x.width)*I)/(b*I),Math.ceil((x.y+x.height)*I)/(y*I)),G.update(_,_.ref.value),G.update(this.ssaoBlurFirstPassRenderable.values.uBounds,_.ref.value),G.update(this.ssaoBlurSecondPassRenderable.values.uBounds,_.ref.value),G.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),G.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),G.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),G.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),G.update(this.ssaoBlurFirstPassRenderable.values.uInvProjection,g),G.update(this.ssaoBlurSecondPassRenderable.values.uInvProjection,g),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==p&&(u=!0,G.update(this.ssaoBlurFirstPassRenderable.values.dOrthographic,p),G.update(this.ssaoBlurSecondPassRenderable.values.dOrthographic,p)),this.nSamples!==o.occlusion.params.samples&&(c=!0,this.nSamples=o.occlusion.params.samples,G.update(this.ssaoRenderable.values.uSamples,ome(this.nSamples)),G.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples));let T=o.occlusion.params.multiScale.name==="on";if(this.ssaoRenderable.values.dMultiScale.ref.value!==T&&(c=!0,G.update(this.ssaoRenderable.values.dMultiScale,T)),o.occlusion.params.multiScale.name==="on"){let w=o.occlusion.params.multiScale.params;if(!ul(this.levels,w.levels)){c=!0,this.levels=w.levels;let S=k6e(w.levels);G.updateIfChanged(this.ssaoRenderable.values.dLevels,S.count),G.update(this.ssaoRenderable.values.uLevelRadius,S.radius),G.update(this.ssaoRenderable.values.uLevelBias,S.bias)}G.updateIfChanged(this.ssaoRenderable.values.uNearThreshold,w.nearThreshold),G.updateIfChanged(this.ssaoRenderable.values.uFarThreshold,w.farThreshold)}else G.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,o.occlusion.params.radius));if(G.updateIfChanged(this.ssaoRenderable.values.uBias,o.occlusion.params.bias),this.blurKernelSize!==o.occlusion.params.blurKernelSize){u=!0,this.blurKernelSize=o.occlusion.params.blurKernelSize;let w=nme(this.blurKernelSize);G.update(this.ssaoBlurFirstPassRenderable.values.uKernel,w),G.update(this.ssaoBlurSecondPassRenderable.values.uKernel,w),G.update(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),G.update(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}let E=this.calcSsaoScale(o.occlusion.params.resolutionScale);if(this.ssaoScale!==E){c=!0,d=!0,this.ssaoScale=E;let w=Math.floor(b*this.ssaoScale),S=Math.floor(y*this.ssaoScale);this.downsampledDepthTarget.setSize(w,S),this.ssaoDepthTexture.define(w,S),this.ssaoDepthBlurProxyTexture.define(w,S);let P=Math.floor(w*.5),k=Math.floor(S*.5);this.depthHalfTarget.setSize(P,k);let L=Math.floor(w*.25),R=Math.floor(S*.25);this.depthQuarterTarget.setSize(L,R);let N=this.ssaoScale===1?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;G.update(this.depthHalfRenderable.values.tColor,N),G.update(this.ssaoRenderable.values.tDepth,N),G.update(this.ssaoRenderable.values.tDepthHalf,this.depthHalfTarget.texture),G.update(this.ssaoRenderable.values.tDepthQuarter,this.depthQuarterTarget.texture),G.update(this.downsampleDepthRenderable.values.uTexSize,Ve.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,w,S)),G.update(this.depthHalfRenderable.values.uTexSize,Ve.set(this.depthHalfRenderable.values.uTexSize.ref.value,P,k)),G.update(this.depthQuarterRenderable.values.uTexSize,Ve.set(this.depthQuarterRenderable.values.uTexSize.ref.value,L,R)),G.update(this.ssaoRenderable.values.uTexSize,Ve.set(this.ssaoRenderable.values.uTexSize.ref.value,w,S)),G.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Ve.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,w,S)),G.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Ve.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,w,S))}G.update(this.renderable.values.uOcclusionColor,ze.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,o.occlusion.params.color))}if(o.shadow.name==="on"&&(G.update(this.shadowsRenderable.values.uProjection,t.projection),G.update(this.shadowsRenderable.values.uInvProjection,g),Ht.set(this.shadowsRenderable.values.uBounds.ref.value,x.x/b,x.y/y,(x.x+x.width)/b,(x.y+x.height)/y),G.update(this.shadowsRenderable.values.uBounds,this.shadowsRenderable.values.uBounds.ref.value),G.updateIfChanged(this.shadowsRenderable.values.uNear,t.near),G.updateIfChanged(this.shadowsRenderable.values.uFar,t.far),this.shadowsRenderable.values.dOrthographic.ref.value!==p&&(G.update(this.shadowsRenderable.values.dOrthographic,p),a=!0),G.updateIfChanged(this.shadowsRenderable.values.uMaxDistance,o.shadow.params.maxDistance),G.updateIfChanged(this.shadowsRenderable.values.uTolerance,o.shadow.params.tolerance),G.updateIfChanged(this.shadowsRenderable.values.uBias,o.shadow.params.bias),this.shadowsRenderable.values.dSteps.ref.value!==o.shadow.params.steps&&(G.update(this.shadowsRenderable.values.dSteps,o.shadow.params.steps),a=!0),G.update(this.shadowsRenderable.values.uLightDirection,i.direction),G.update(this.shadowsRenderable.values.uLightColor,i.color),this.shadowsRenderable.values.dLightCount.ref.value!==i.count&&(G.update(this.shadowsRenderable.values.dLightCount,i.count),a=!0)),o.outline.name==="on"){let _=(s=o.outline.params.includeTransparent)!==null&&s!==void 0?s:!0,I=Math.max(1,Math.round(o.outline.params.scale*this.webgl.pixelRatio))-1,T=50*o.outline.params.threshold*this.webgl.pixelRatio;G.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),G.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),G.update(this.outlinesRenderable.values.uInvProjection,g),this.outlinesRenderable.values.dTransparentOutline.ref.value!==_&&(m=!0,G.update(this.outlinesRenderable.values.dTransparentOutline,_)),this.outlinesRenderable.values.dOrthographic.ref.value!==p&&(m=!0,G.update(this.outlinesRenderable.values.dOrthographic,p)),G.updateIfChanged(this.outlinesRenderable.values.uOutlineThreshold,T),G.update(this.renderable.values.uOutlineColor,ze.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,o.outline.params.color)),this.renderable.values.dOutlineScale.ref.value!==I&&(l=!0,G.update(this.renderable.values.dOutlineScale,I)),this.renderable.values.dTransparentOutline.ref.value!==_&&(l=!0,G.update(this.renderable.values.dTransparentOutline,_))}G.updateIfChanged(this.renderable.values.uFar,t.far),G.updateIfChanged(this.renderable.values.uNear,t.near),G.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),G.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),G.update(this.renderable.values.uFogColor,ze.toVec3Normalized(this.renderable.values.uFogColor.ref.value,n)),G.updateIfChanged(this.renderable.values.uTransparentBackground,r),this.renderable.values.dOrthographic.ref.value!==p&&(l=!0,G.update(this.renderable.values.dOrthographic,p)),this.renderable.values.dOutlineEnable.ref.value!==h&&(l=!0,G.update(this.renderable.values.dOutlineEnable,h)),this.renderable.values.dShadowEnable.ref.value!==f&&(l=!0,G.update(this.renderable.values.dShadowEnable,f)),this.renderable.values.dOcclusionEnable.ref.value!==C&&(l=!0,G.update(this.renderable.values.dOcclusionEnable,C)),m&&this.outlinesRenderable.update(),a&&this.shadowsRenderable.update(),c&&this.ssaoRenderable.update(),u&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),d&&this.depthHalfRenderable.update(),l&&this.renderable.update();let{gl:A,state:v}=this.webgl;v.enable(A.SCISSOR_TEST),v.disable(A.BLEND),v.disable(A.DEPTH_TEST),v.depthMask(!1)}setOcclusionOffset(t,r){this.occlusionOffset[0]=t,this.occlusionOffset[1]=r,G.update(this.renderable.values.uOcclusionOffset,Ve.set(this.renderable.values.uOcclusionOffset.ref.value,t,r))}setTransparentBackground(t){this.transparentBackground=t}render(t,r,n,o,i,s){bt&&this.webgl.timer.mark("PostprocessingPass.render"),this.updateState(t,n,o,i,s);let{gl:a,state:l}=this.webgl,{x:c,y:u,width:d,height:m}=t.viewport;if(i.occlusion.name==="on"&&this.occlusionOffset[0]===0&&this.occlusionOffset[1]===0){bt&&this.webgl.timer.mark("SSAO.render");let p=Math.floor(c*this.ssaoScale),h=Math.floor(u*this.ssaoScale),f=Math.ceil(d*this.ssaoScale),C=Math.ceil(m*this.ssaoScale);l.viewport(p,h,f,C),l.scissor(p,h,f,C),this.ssaoScale<1&&(bt&&this.webgl.timer.mark("SSAO.downsample"),this.downsampledDepthTarget.bind(),this.downsampleDepthRenderable.render(),bt&&this.webgl.timer.markEnd("SSAO.downsample")),bt&&this.webgl.timer.mark("SSAO.half"),this.depthHalfTarget.bind(),this.depthHalfRenderable.render(),bt&&this.webgl.timer.markEnd("SSAO.half"),bt&&this.webgl.timer.mark("SSAO.quarter"),this.depthQuarterTarget.bind(),this.depthQuarterRenderable.render(),bt&&this.webgl.timer.markEnd("SSAO.quarter"),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),bt&&this.webgl.timer.markEnd("SSAO.render")}l.viewport(c,u,d,m),l.scissor(c,u,d,m),i.outline.name==="on"&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),i.shadow.name==="on"&&(this.shadowsTarget.bind(),this.shadowsRenderable.render()),r?this.webgl.unbindFramebuffer():this.target.bind(),this.background.update(t,i.background),this.background.isEnabled(i.background)?(this.transparentBackground?l.clearColor(0,0,0,0):(ze.toVec3Normalized(this.bgColor,o),l.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),a.clear(a.COLOR_BUFFER_BIT),l.enable(a.BLEND),l.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),this.background.render()):(l.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT)),this.renderable.render(),bt&&this.webgl.timer.markEnd("PostprocessingPass.render")}},By=class{static isEnabled(t){return t.antialiasing.name!=="off"}constructor(t,r,n){this.target=t.createRenderTarget(r,n,!1),this.internalTarget=t.createRenderTarget(r,n,!1),this.fxaa=new Ck(t,this.target.texture),this.smaa=new Sk(t,this.target.texture),this.cas=new Ak(t,this.target.texture)}setSize(t,r){let n=this.target.texture.getWidth(),o=this.target.texture.getHeight();(t!==n||r!==o)&&(this.target.setSize(t,r),this.internalTarget.setSize(t,r),this.fxaa.setSize(t,r),this.smaa.supported&&this.smaa.setSize(t,r),this.cas.setSize(t,r))}_renderFxaa(t,r,n,o){o.antialiasing.name==="fxaa"&&(this.fxaa.update(r,o.antialiasing.params),this.fxaa.render(t.viewport,n))}_renderSmaa(t,r,n,o){o.antialiasing.name==="smaa"&&(this.smaa.update(r,o.antialiasing.params),this.smaa.render(t.viewport,n))}_renderAntialiasing(t,r,n,o){o.antialiasing.name==="fxaa"?this._renderFxaa(t,r,n,o):o.antialiasing.name==="smaa"&&this._renderSmaa(t,r,n,o)}_renderCas(t,r,n,o){o.sharpening.name==="on"&&(o.antialiasing.name!=="off"&&(r=this.internalTarget.texture),this.cas.update(r,o.sharpening.params),this.cas.render(t.viewport,n))}render(t,r,n,o){if(o.antialiasing.name==="off"&&o.sharpening.name==="off"||o.antialiasing.name==="smaa"&&!this.smaa.supported)return;let i=n===!0?void 0:n===!1?this.target:n;o.sharpening.name==="off"?this._renderAntialiasing(t,r,i,o):o.antialiasing.name==="off"?this._renderCas(t,r,i,o):(this._renderAntialiasing(t,r,this.internalTarget,o),this._renderCas(t,r,i,o))}};var ime=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tColor;
uniform vec2 uTexSize;
uniform float uWeight;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tColor, coords) * uWeight;
}
`;var M6e={...Rn,tColor:kt("texture","rgba","ubyte","nearest"),uTexSize:Re("v2"),uWeight:Re("f")},R6e=Gr("compose",Kn,ime);function B6e(e,t){let r={...Bn,tColor:G.create(t),uTexSize:G.create(Ve.create(t.getWidth(),t.getHeight())),uWeight:G.create(1)},n={...M6e},o=on(e,"triangles",R6e,n,r);return sn(o,r)}var Tk={mode:M.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:M.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."}),reduceFlicker:M.Boolean(!0,{description:'Reduce flicker in "temporal" mode.'})},Ng=class{static isEnabled(t){return t.mode!=="off"}constructor(t,r){this.webgl=t,this.drawPass=r;let{colorBufferFloat:n,textureFloat:o,colorBufferHalfFloat:i,textureHalfFloat:s}=t.extensions,a=r.colorTarget.getWidth(),l=r.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(a,l,!1);let c=i&&s?"fp16":n&&o?"float32":"uint8";this.composeTarget=t.createRenderTarget(a,l,!1,c),this.holdTarget=t.createRenderTarget(a,l,!1),this.compose=B6e(t,r.colorTarget.texture)}syncSize(){let t=this.drawPass.colorTarget.getWidth(),r=this.drawPass.colorTarget.getHeight(),[n,o]=this.compose.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.colorTarget.setSize(t,r),this.composeTarget.setSize(t,r),this.holdTarget.setSize(t,r),G.update(this.compose.values.uTexSize,Ve.set(this.compose.values.uTexSize.ref.value,t,r)))}render(t,r,n,o,i){return n.multiSample.mode==="temporal"&&!i?this.renderTemporalMultiSample(t,r,n,o):(this.renderMultiSample(r,o,n),-2)}bindOutputTarget(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()}renderMultiSample(t,r,n){let{camera:o}=t,{compose:i,composeTarget:s,drawPass:a,webgl:l}=this,{gl:c,state:u}=l;bt&&l.timer.mark("MultiSamplePass.renderMultiSample");let d=x9[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],{x:m,y:p,width:h,height:f}=o.viewport,C=1/d.length,g=1/32;o.viewOffset.enabled=!0,G.update(i.values.tColor,a.getColorTarget(n.postprocessing).texture),i.update();for(let b=0;b<d.length;++b){let y=d[b];Eo.setViewOffset(o.viewOffset,h,f,y[0],y[1],h,f),o.update();let x=-.5+(b+.5)/d.length,A=C+g*x;G.update(i.values.uWeight,A),b===0?a.postprocessing.setOcclusionOffset(0,0):a.postprocessing.setOcclusionOffset(y[0]/h,y[1]/f),a.render(t,n,!1),s.bind(),u.enable(c.BLEND),u.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),u.blendFuncSeparate(c.ONE,c.ONE,c.ONE,c.ONE),u.disable(c.DEPTH_TEST),u.depthMask(!1),u.viewport(m,p,h,f),u.scissor(m,p,h,f),b===0&&(u.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT)),i.render()}a.postprocessing.setOcclusionOffset(0,0),G.update(i.values.uWeight,1),G.update(i.values.tColor,s.texture),i.update(),this.bindOutputTarget(r),u.viewport(m,p,h,f),u.scissor(m,p,h,f),u.disable(c.BLEND),i.render(),o.viewOffset.enabled=!1,o.update(),bt&&l.timer.markEnd("MultiSamplePass.renderMultiSample")}renderTemporalMultiSample(t,r,n,o){let{camera:i}=r,{compose:s,composeTarget:a,holdTarget:l,drawPass:c,webgl:u}=this,{gl:d,state:m}=u;bt&&u.timer.mark("MultiSamplePass.renderTemporalMultiSample");let p=x9[Math.max(0,Math.min(n.multiSample.sampleLevel,5))];if(t===-2||t>=p.length)return-2;let{x:h,y:f,width:C,height:g}=i.viewport,b=1/p.length;if(t===-1)c.render(r,n,!1),G.update(s.values.uWeight,1),G.update(s.values.tColor,c.getColorTarget(n.postprocessing).texture),s.update(),l.bind(),m.disable(d.BLEND),m.disable(d.DEPTH_TEST),m.depthMask(!1),m.viewport(h,f,C,g),m.scissor(h,f,C,g),s.render(),t+=1;else{i.viewOffset.enabled=!0,G.update(s.values.tColor,c.getColorTarget(n.postprocessing).texture),G.update(s.values.uWeight,b),s.update();let x=Math.pow(2,Math.max(0,n.multiSample.sampleLevel-2));for(let A=0;A<x;++A){let v=p[t];if(Eo.setViewOffset(i.viewOffset,C,g,v[0],v[1],C,g),i.update(),t===0?c.postprocessing.setOcclusionOffset(0,0):c.postprocessing.setOcclusionOffset(v[0]/C,v[1]/g),c.render(r,n,!1),a.bind(),m.enable(d.BLEND),m.blendEquationSeparate(d.FUNC_ADD,d.FUNC_ADD),m.blendFuncSeparate(d.ONE,d.ONE,d.ONE,d.ONE),m.disable(d.DEPTH_TEST),m.depthMask(!1),m.viewport(h,f,C,g),m.scissor(h,f,C,g),t===0&&(m.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT)),s.render(),t+=1,t>=p.length)break}}c.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(o),m.viewport(h,f,C,g),m.scissor(h,f,C,g);let y=t*b;return y>0&&(G.update(s.values.uWeight,1),G.update(s.values.tColor,a.texture),s.update(),m.disable(d.BLEND),s.render()),y<1&&(G.update(s.values.uWeight,1-y),G.update(s.values.tColor,l.texture),s.update(),y===0?m.disable(d.BLEND):m.enable(d.BLEND),s.render()),i.viewOffset.enabled=!1,i.update(),bt&&u.timer.markEnd("MultiSamplePass.renderTemporalMultiSample"),t>=p.length?-2:t}},x9=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];x9.forEach(e=>{e.forEach(t=>{t[0]*=.0625,t[1]*=.0625})});var sS=class{update(t,r){return t&&(this.sampleIndex=-1),r.mode==="temporal"?this.sampleIndex!==-2:!1}render(t,r,n,o){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,r,n,!!o),this.sampleIndex<0}constructor(t){this.multiSamplePass=t,this.sampleIndex=-2}};var C9={eyeSeparation:M.Numeric(.062,{min:.02,max:.1,step:.001},{description:"Distance between left and right camera."}),focus:M.Numeric(10,{min:1,max:20,step:.1},{description:"Apparent object distance."})},L6e=M.getDefaultValues(C9);var Kp=class{get viewport(){return this.parent.viewport}get viewOffset(){return this.parent.viewOffset}constructor(t,r={}){this.parent=t,this.left=new Ek,this.right=new Ek,this.props={...L6e,...r}}setProps(t){Object.assign(this.props,t)}update(){this.parent.update(),N6e(this.parent,this.props,this.left,this.right)}};(function(e){function t(r){return"left"in r&&"right"in r}e.is=t})(Kp||(Kp={}));var Ek=class{constructor(){this.viewport=Zo.create(0,0,0,0),this.view=de(),this.projection=de(),this.projectionView=de(),this.inverseProjectionView=de(),this.state=Eo.createDefaultSnapshot(),this.viewOffset=Eo.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}},sme=de.identity(),ame=de.identity();function N6e(e,t,r,n){Zo.copy(r.viewport,e.viewport),de.copy(r.view,e.view),de.copy(r.projection,e.projection),Eo.copySnapshot(r.state,e.state),Eo.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear,Zo.copy(n.viewport,e.viewport),de.copy(n.view,e.view),de.copy(n.projection,e.projection),Eo.copySnapshot(n.state,e.state),Eo.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear;let o=Math.floor(e.viewport.width/2),i=o/e.viewport.height;r.viewport.width=o,n.viewport.x+=o,n.viewport.width-=o;let s=t.eyeSeparation/2,a=s*e.near/t.focus,l=e.near*Math.tan(e.state.fov*.5),c,u;sme[12]=-s,ame[12]=s,c=-l*i+a,u=l*i+a,r.projection[0]=2*e.near/(u-c),r.projection[8]=(u+c)/(u-c),de.mul(r.view,r.view,sme),de.mul(r.projectionView,r.projection,r.view),de.invert(r.inverseProjectionView,r.projectionView),c=-l*i-a,u=l*i-a,n.projection[0]=2*e.near/(u-c),n.projection[8]=(u+c)/(u-c),de.mul(n.view,n.view,ame),de.mul(n.projectionView,n.projection,n.view),de.invert(n.inverseProjectionView,n.projectionView)}var S9=Math.pow(2,24)-2,Pk=class{constructor(t,r,n){this.webgl=t,this.drawPass=r,this.pickScale=n;let o=n/t.pixelRatio;this.pickWidth=Math.ceil(r.colorTarget.getWidth()*o),this.pickHeight=Math.ceil(r.colorTarget.getHeight()*o);let{resources:i,extensions:{drawBuffers:s},gl:a}=t;s?(this.objectPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=i.texture("image-uint8","rgba","ubyte","nearest"),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=i.framebuffer(),this.objectPickFramebuffer=i.framebuffer(),this.instancePickFramebuffer=i.framebuffer(),this.groupPickFramebuffer=i.framebuffer(),this.depthPickFramebuffer=i.framebuffer(),this.framebuffer.bind(),s.drawBuffers([s.COLOR_ATTACHMENT0,s.COLOR_ATTACHMENT1,s.COLOR_ATTACHMENT2,s.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer=er(a)?i.renderbuffer("depth32f","depth",this.pickWidth,this.pickHeight):i.renderbuffer("depth16","depth",this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0")):(this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight))}get pickRatio(){return this.pickScale/this.webgl.pixelRatio}setPickScale(t){this.pickScale=t,this.syncSize()}bindObject(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()}bindInstance(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()}bindGroup(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()}bindDepth(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()}get drawingBufferHeight(){return this.drawPass.colorTarget.getHeight()}syncSize(){let t=this.pickScale/this.webgl.pixelRatio,r=Math.ceil(this.drawPass.colorTarget.getWidth()*t),n=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(r!==this.pickWidth||n!==this.pickHeight)&&(this.pickWidth=r,this.pickHeight=n,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))}renderVariant(t,r,n,o,i,s){t.clear(!1),t.update(r,n),t.renderPick(n.primitives,r,i,null,s),o.handle.isEnabled&&t.renderPick(o.handle.scene,r,i,null,s),o.camera.isEnabled&&(o.camera.update(r),t.update(o.camera.camera,o.camera.scene),t.renderPick(o.camera.scene,o.camera.camera,i,null,s))}render(t,r,n,o){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(t,r,n,o,"pick",Lg.None)):(this.objectPickTarget.bind(),this.renderVariant(t,r,n,o,"pick",Lg.Object),this.instancePickTarget.bind(),this.renderVariant(t,r,n,o,"pick",Lg.Instance),this.groupPickTarget.bind(),this.renderVariant(t,r,n,o,"pick",Lg.Group),this.depthPickTarget.bind(),this.renderVariant(t,r,n,o,"depth",Lg.None))}},Dk=class{setupBuffers(){let t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))}setViewport(t,r,n,o){Zo.set(this.viewport,t,r,n,o),this.pickRatio=this.pickPass.pickRatio,this.pickX=Math.ceil(t*this.pickRatio),this.pickY=Math.ceil(r*this.pickRatio);let i=Math.floor(n*this.pickRatio),s=Math.floor(o*this.pickRatio);(i!==this.pickWidth||s!==this.pickHeight)&&(this.pickWidth=i,this.pickHeight=s,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers()),this.spiral=iq(Math.round(this.pickRatio*this.pickPadding))}syncBuffers(){bt&&this.webgl.timer.mark("PickHelper.syncBuffers");let{pickX:t,pickY:r,pickWidth:n,pickHeight:o}=this;this.pickPass.bindObject(),this.webgl.readPixels(t,r,n,o,this.objectBuffer),this.pickPass.bindInstance(),this.webgl.readPixels(t,r,n,o,this.instanceBuffer),this.pickPass.bindGroup(),this.webgl.readPixels(t,r,n,o,this.groupBuffer),this.pickPass.bindDepth(),this.webgl.readPixels(t,r,n,o,this.depthBuffer),bt&&this.webgl.timer.markEnd("PickHelper.syncBuffers")}getBufferIdx(t,r){return(r*this.pickWidth+t)*4}getDepth(t,r){let n=this.getBufferIdx(t,r),o=this.depthBuffer;return yre(o[n],o[n+1],o[n+2],o[n+3])}getId(t,r,n){let o=this.getBufferIdx(t,r);return Tb(n[o],n[o+1],n[o+2])}render(t){bt&&this.webgl.timer.mark("PickHelper.render",!0);let{pickX:r,pickY:n,pickWidth:o,pickHeight:i,halfPickWidth:s}=this,{renderer:a,scene:l,helper:c}=this;a.setTransparentBackground(!1),a.setDrawingBufferSize(o,i),a.setPixelRatio(this.pickRatio),Kp.is(t)?(a.setViewport(r,n,s,i),this.pickPass.render(a,t.left,l,c),a.setViewport(r+s,n,o-s,i),this.pickPass.render(a,t.right,l,c)):(a.setViewport(r,n,o,i),this.pickPass.render(a,t,l,c)),this.dirty=!1,bt&&this.webgl.timer.markEnd("PickHelper.render")}identifyInternal(t,r,n){let{webgl:o,pickRatio:i}=this;if(o.isContextLost)return;t*=o.pixelRatio,r*=o.pixelRatio,r=this.pickPass.drawingBufferHeight-r;let{viewport:s}=this;if(t<s.x||r<s.y||t>s.x+s.width||r>s.y+s.height)return;this.dirty&&(bt&&this.webgl.timer.mark("PickHelper.identify"),this.render(n),this.syncBuffers(),bt&&this.webgl.timer.markEnd("PickHelper.identify"));let a=t-s.x,l=r-s.y,c=Math.floor(a*i),u=Math.floor(l*i),d=this.getId(c,u,this.objectBuffer);if(d===-1||d===S9)return;let m=this.getId(c,u,this.instanceBuffer);if(m===-1||m===S9)return;let p=this.getId(c,u,this.groupBuffer);if(p===-1||p===S9)return;let h=this.getDepth(c,u),f=D.create(t,r,h);if(Kp.is(n)){let C=Math.floor(s.width/2);t>s.x+C?(f[0]=s.x+(a-C)*2,nS(f,f,s,n.right.inverseProjectionView)):(f[0]=s.x+a*2,nS(f,f,s,n.left.inverseProjectionView))}else nS(f,f,s,n.inverseProjectionView);return{id:{objectId:d,instanceId:m,groupId:p},position:f}}identify(t,r,n){for(let o of this.spiral){let i=this.identifyInternal(t+o[0],r+o[1],n);if(i)return i}}constructor(t,r,n,o,i,s,a=1){this.webgl=t,this.renderer=r,this.scene=n,this.helper=o,this.pickPass=i,this.pickPadding=a,this.dirty=!0,this.viewport=Zo(),this.setViewport(s.x,s.y,s.width,s.height)}};var lme=`
precision highp float;

uniform sampler2D tWboitA;
uniform sampler2D tWboitB;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;

    vec4 accum = texture2D(tWboitA, coords);
    float r = 1.0 - accum.a;

    accum.a = texture2D(tWboitB, coords).r;
    // divisor needs to allow very small values for nice fading
    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);
}
`;var F6e={...Rn,tWboitA:kt("texture","rgba","float","nearest"),tWboitB:kt("texture","rgba","float","nearest"),uTexSize:Re("v2")},O6e=Gr("evaluate-wboit",Kn,lme);function V6e(e,t,r){let n={...Bn,tWboitA:G.create(t),tWboitB:G.create(r),uTexSize:G.create(Ve.create(t.getWidth(),t.getHeight()))},o={...F6e},i=on(e,"triangles",O6e,o,n);return sn(i,n)}var kk=class e{get supported(){return this._supported}bind(){let{state:t,gl:r}=this.webgl;this.framebuffer.bind(),t.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),t.disable(r.DEPTH_TEST),t.blendFuncSeparate(r.ONE,r.ONE,r.ZERO,r.ONE_MINUS_SRC_ALPHA),t.enable(r.BLEND)}render(){bt&&this.webgl.timer.mark("WboitPass.render");let{state:t,gl:r}=this.webgl;t.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),t.enable(r.BLEND),this.renderable.update(),this.renderable.render(),bt&&this.webgl.timer.markEnd("WboitPass.render")}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;(t!==n||r!==o)&&(this.textureA.define(t,r),this.textureB.define(t,r),this.depthRenderbuffer.setSize(t,r),G.update(this.renderable.values.uTexSize,Ve.set(this.renderable.values.uTexSize.ref.value,t,r)))}reset(){this._supported&&this._init()}_init(){let{extensions:{drawBuffers:t}}=this.webgl;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)}static isSupported(t){let{extensions:{drawBuffers:r,textureFloat:n,colorBufferFloat:o,depthTexture:i}}=t;if(!n||!o||!i||!r){if(lr){let s=[];n||s.push("textureFloat"),o||s.push("colorBufferFloat"),i||s.push("depthTexture"),r||s.push("drawBuffers")}return!1}else return!0}constructor(t,r,n){if(this.webgl=t,this._supported=!1,!e.isSupported(t))return;let{resources:o,gl:i}=t;this.textureA=o.texture("image-float32","rgba","float","nearest"),this.textureA.define(r,n),this.textureB=o.texture("image-float32","rgba","float","nearest"),this.textureB.define(r,n),this.depthRenderbuffer=er(i)?o.renderbuffer("depth32f","depth",r,n):o.renderbuffer("depth16","depth",r,n),this.renderable=V6e(t,this.textureA,this.textureB),this.framebuffer=o.framebuffer(),this._supported=!0,this._init()}};var cme=`
precision highp float;

uniform sampler2D tDpoitFrontColor;
uniform vec2 uTexSize;

void main() {
    vec2 coords = gl_FragCoord.xy / uTexSize;
    gl_FragColor = texture2D(tDpoitFrontColor, coords);
}
`;var ume=`
    precision highp float;

    uniform sampler2D tDpoitBackColor;
    uniform vec2 uTexSize;

    void main() {
        vec2 coords = gl_FragCoord.xy / uTexSize;
        gl_FragColor = texture2D(tDpoitBackColor, coords);
        if (gl_FragColor.a == 0.0) {
            discard;
        }
    }
`;var G6e={...Rn,tDpoitBackColor:kt("texture","rgba","float","nearest"),uTexSize:Re("v2")},U6e=Gr("blend-back-dpoit",Kn,ume);function z6e(e,t){let r={...Bn,tDpoitBackColor:G.create(t),uTexSize:G.create(Ve.create(t.getWidth(),t.getHeight()))},n={...G6e},o=on(e,"triangles",U6e,n,r);return sn(o,r)}var H6e={...Rn,tDpoitFrontColor:kt("texture","rgba","float","nearest"),uTexSize:Re("v2")},j6e=Gr("evaluate-dpoit",Kn,cme);function $6e(e,t){let r={...Bn,tDpoitFrontColor:G.create(t),uTexSize:G.create(Ve.create(t.getWidth(),t.getHeight()))},n={...H6e},o=on(e,"triangles",j6e,n,r);return sn(o,r)}var Mk=class e{get supported(){return this._supported}bind(){let{state:t,gl:r,extensions:{blendMinMax:n}}=this.webgl;return this.passCount=0,this.depthFramebuffers[0].bind(),t.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),t.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),t.blendEquation(n.MAX),t.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}}bindDualDepthPeeling(){let{state:t,gl:r,extensions:{blendMinMax:n}}=this.webgl;return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),t.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),r.clear(r.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),t.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),t.blendEquation(n.MAX),t.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}}renderBlendBack(){bt&&this.webgl.timer.mark("DpoitPass.renderBlendBack");let{state:t,gl:r}=this.webgl;t.blendEquation(r.FUNC_ADD),t.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),G.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),bt&&this.webgl.timer.markEnd("DpoitPass.renderBlendBack")}render(){bt&&this.webgl.timer.mark("DpoitPass.render");let{state:t,gl:r}=this.webgl;t.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),G.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),bt&&this.webgl.timer.markEnd("DpoitPass.render")}setSize(t,r){let[n,o]=this.renderable.values.uTexSize.ref.value;if(t!==n||r!==o){for(let i=0;i<2;i++)this.depthTextures[i].define(t,r),this.colorFrontTextures[i].define(t,r),this.colorBackTextures[i].define(t,r);G.update(this.renderable.values.uTexSize,Ve.set(this.renderable.values.uTexSize.ref.value,t,r)),G.update(this.blendBackRenderable.values.uTexSize,Ve.set(this.blendBackRenderable.values.uTexSize.ref.value,t,r))}}reset(){this._supported&&this._init()}_init(){let{extensions:{drawBuffers:t}}=this.webgl;for(let r=0;r<2;r++)this.depthFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),this.colorFrontTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color1"),this.depthTextures[r].attachFramebuffer(this.depthFramebuffers[r],"color2"),this.colorFramebuffers[r].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.colorFrontTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color0"),this.colorBackTextures[r].attachFramebuffer(this.colorFramebuffers[r],"color1")}static isSupported(t){let{extensions:{drawBuffers:r,textureFloat:n,colorBufferFloat:o,depthTexture:i,blendMinMax:s}}=t;if(!n||!o||!i||!r||!s){if(lr){let a=[];n||a.push("textureFloat"),o||a.push("colorBufferFloat"),i||a.push("depthTexture"),r||a.push("drawBuffers"),s||a.push("blendMinMax")}return!1}else return!0}constructor(t,r,n){if(this.webgl=t,this.DEPTH_CLEAR_VALUE=-99999,this.MAX_DEPTH=1,this.MIN_DEPTH=0,this.passCount=0,this._supported=!1,!e.isSupported(t))return;let{resources:o,extensions:{colorBufferHalfFloat:i,textureHalfFloat:s}}=t;er(t.gl)?(this.depthTextures=[o.texture("image-float32","rg","float","nearest"),o.texture("image-float32","rg","float","nearest")],this.colorFrontTextures=i&&s?[o.texture("image-float16","rgba","fp16","nearest"),o.texture("image-float16","rgba","fp16","nearest")]:[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=i&&s?[o.texture("image-float16","rgba","fp16","nearest"),o.texture("image-float16","rgba","fp16","nearest")]:[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")]):(this.depthTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorFrontTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=[o.texture("image-float32","rgba","float","nearest"),o.texture("image-float32","rgba","float","nearest")]),this.depthTextures[0].define(r,n),this.depthTextures[1].define(r,n),this.colorFrontTextures[0].define(r,n),this.colorFrontTextures[1].define(r,n),this.colorBackTextures[0].define(r,n),this.colorBackTextures[1].define(r,n),this.depthFramebuffers=[o.framebuffer(),o.framebuffer()],this.colorFramebuffers=[o.framebuffer(),o.framebuffer()],this.blendBackRenderable=z6e(t,this.colorBackTextures[0]),this.renderable=$6e(t,this.colorFrontTextures[0]),this._supported=!0,this._init()}};var dme=`
precision highp float;
precision highp sampler2D;

uniform vec2 uTexSizeInv;
uniform sampler2D tEdgeTexture;
uniform vec3 uHighlightEdgeColor;
uniform vec3 uSelectEdgeColor;
uniform float uHighlightEdgeStrength;
uniform float uSelectEdgeStrength;
uniform float uGhostEdgeStrength;
uniform float uInnerEdgeFactor;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 edgeValue = texture2D(tEdgeTexture, coords);
    if (edgeValue.a > 0.0) {
        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;
        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;
        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;
        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;
        gl_FragColor.a *= edgeStrength;
    } else {
        gl_FragColor = vec4(0.0);
    }
}
`;var mme=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tMaskTexture;
uniform vec2 uTexSizeInv;

void main() {
    vec2 coords = gl_FragCoord.xy * uTexSizeInv;
    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);
    vec4 c0 = texture2D(tMaskTexture, coords);
    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);
    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);
    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);
    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);
    float diff1 = (c1.r - c2.r) * 0.5;
    float diff2 = (c3.r - c4.r) * 0.5;
    float d = length(vec2(diff1, diff2));
    if (d <= 0.0)
        discard;
    float a1 = min(c1.g, c2.g);
    float a2 = min(c3.g, c4.g);
    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;
    float mask = c0.r;
    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));
    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));
    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);
}
`;var Rk={enabled:M.Boolean(!0),highlightEdgeColor:M.Color(ze.darken(ze.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:M.Color(ze.darken(ze.fromNormalizedRgb(.2,1,.1),1)),edgeScale:M.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),highlightEdgeStrength:M.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:M.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:M.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:M.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})},Aw=class{static isEnabled(t){return t.enabled}constructor(t,r,n){this.webgl=t,this.depthTarget=t.createRenderTarget(r,n),this.maskTarget=t.createRenderTarget(r,n),this.edgesTarget=t.createRenderTarget(r,n),this.edge=Z6e(t,this.maskTarget.texture),this.overlay=Y6e(t,this.edgesTarget.texture)}setEdgeState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.enable(r.BLEND),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:s,height:a}=t;n.viewport(o,i,s,a),n.scissor(o,i,s,a),n.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT)}setOverlayState(t){let{gl:r,state:n}=this.webgl;n.enable(r.SCISSOR_TEST),n.enable(r.BLEND),n.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),n.blendEquation(r.FUNC_ADD),n.disable(r.DEPTH_TEST),n.depthMask(!1);let{x:o,y:i,width:s,height:a}=t;n.viewport(o,i,s,a),n.scissor(o,i,s,a)}setSize(t,r){let n=this.depthTarget.getWidth(),o=this.depthTarget.getHeight();(t!==n||r!==o)&&(this.depthTarget.setSize(t,r),this.maskTarget.setSize(t,r),this.edgesTarget.setSize(t,r),G.update(this.edge.values.uTexSizeInv,Ve.set(this.edge.values.uTexSizeInv.ref.value,1/t,1/r)),G.update(this.overlay.values.uTexSizeInv,Ve.set(this.overlay.values.uTexSizeInv.ref.value,1/t,1/r)))}update(t){let{highlightEdgeColor:r,selectEdgeColor:n,edgeScale:o,innerEdgeFactor:i,ghostEdgeStrength:s,highlightEdgeStrength:a,selectEdgeStrength:l}=t,{values:c}=this.edge,u=Math.max(1,Math.round(o*this.webgl.pixelRatio));c.dEdgeScale.ref.value!==u&&(G.update(c.dEdgeScale,u),this.edge.update());let{values:d}=this.overlay;G.update(d.uHighlightEdgeColor,ze.toVec3Normalized(d.uHighlightEdgeColor.ref.value,r)),G.update(d.uSelectEdgeColor,ze.toVec3Normalized(d.uSelectEdgeColor.ref.value,n)),G.updateIfChanged(d.uInnerEdgeFactor,i),G.updateIfChanged(d.uGhostEdgeStrength,s),G.updateIfChanged(d.uHighlightEdgeStrength,a),G.updateIfChanged(d.uSelectEdgeStrength,l)}render(t,r){bt&&this.webgl.timer.mark("MarkingPass.render"),this.edgesTarget.bind(),this.setEdgeState(t),this.edge.render(),r?r.bind():this.webgl.unbindFramebuffer(),this.setOverlayState(t),this.overlay.render(),bt&&this.webgl.timer.markEnd("MarkingPass.render")}},W6e={...Rn,tMaskTexture:kt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),dEdgeScale:Bt("number")},q6e=Gr("edge",Kn,mme);function Z6e(e,t){let r=t.getWidth(),n=t.getHeight(),o={...Bn,tMaskTexture:G.create(t),uTexSizeInv:G.create(Ve.create(1/r,1/n)),dEdgeScale:G.create(1)},i={...W6e},s=on(e,"triangles",q6e,i,o);return sn(s,o)}var K6e={...Rn,tEdgeTexture:kt("texture","rgba","ubyte","linear"),uTexSizeInv:Re("v2"),uHighlightEdgeColor:Re("v3"),uSelectEdgeColor:Re("v3"),uHighlightEdgeStrength:Re("f"),uSelectEdgeStrength:Re("f"),uGhostEdgeStrength:Re("f"),uInnerEdgeFactor:Re("f")},X6e=Gr("overlay",Kn,dme);function Y6e(e,t){let r=t.getWidth(),n=t.getHeight(),o={...Bn,tEdgeTexture:G.create(t),uTexSizeInv:G.create(Ve.create(1/r,1/n)),uHighlightEdgeColor:G.create(D()),uSelectEdgeColor:G.create(D()),uHighlightEdgeStrength:G.create(1),uSelectEdgeStrength:G.create(1),uGhostEdgeStrength:G.create(0),uInnerEdgeFactor:G.create(0)},i={...K6e},s=on(e,"triangles",X6e,i,o);return sn(s,o)}var aS=class{setTransparency(t){t==="wboit"?(this.transparencyMode=this.wboit.supported?"wboit":"blended",lr&&this.wboit.supported):t==="dpoit"?(this.transparencyMode=this.dpoit.supported?"dpoit":"blended",lr&&this.dpoit.supported):this.transparencyMode="blended",this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth")}get transparency(){return this.transparencyMode}constructor(t,r,n,o,i){this.webgl=t,this.transparencyMode="blended";let{extensions:s,resources:a,isWebGL2:l}=t;this.drawTarget=Jee(t.gl),this.colorTarget=t.createRenderTarget(n,o,!0,"uint8","linear"),this.packedDepth=!s.depthTexture,this.depthTargetTransparent=t.createRenderTarget(n,o),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?t.createRenderTarget(n,o):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:a.texture("image-depth","depth",l?"float":"ushort","nearest"),this.packedDepth||this.depthTextureOpaque.define(n,o),this.wboit=new kk(t,n,o),this.dpoit=new Mk(t,n,o),this.marking=new Aw(t,n,o),this.postprocessing=new lc(t,r,this),this.antialiasing=new By(t,n,o),this.bloom=new wk(t,n,o),this.dof=new eh(t,n,o),this.copyFboTarget=pg(t,this.colorTarget.texture),this.copyFboPostprocessing=pg(t,this.postprocessing.target.texture),this.setTransparency(i)}reset(){this.wboit.reset(),this.dpoit.reset()}setSize(t,r){let n=this.colorTarget.getWidth(),o=this.colorTarget.getHeight();(t!==n||r!==o)&&(this.colorTarget.setSize(t,r),this.depthTargetTransparent.setSize(t,r),this.depthTargetOpaque?this.depthTargetOpaque.setSize(t,r):this.depthTextureOpaque.define(t,r),G.update(this.copyFboTarget.values.uTexSize,Ve.set(this.copyFboTarget.values.uTexSize.ref.value,t,r)),G.update(this.copyFboPostprocessing.values.uTexSize,Ve.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,r))),this.wboit.supported&&this.wboit.setSize(t,r),this.dpoit.supported&&this.dpoit.setSize(t,r),this.marking.setSize(t,r),this.postprocessing.setSize(t,r),this.antialiasing.setSize(t,r),this.dof.setSize(t,r),this.bloom.setSize(t,r)}_renderDpoit(t,r,n,o,i,s){if(!this.dpoit.supported)throw new Error("expected dpoit to be supported");if(this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderDpoitOpaque(n.primitives,r,null),lc.isEnabled(s)&&((lc.isTransparentOutlineEnabled(s)||eh.isEnabled(s))&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,i,t.props.backgroundColor,s,t.light)),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,"depth"),n.opacityAverage<1){let a=lc.isEnabled(s)?this.postprocessing.target:this.colorTarget,l=this.dpoit.bind();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,l);for(let c=0;c<o;c++){bt&&this.webgl.timer.mark("DpoitPass.layer");let u=this.dpoit.bindDualDepthPeeling();t.renderDpoitTransparent(n.primitives,r,this.depthTextureOpaque,u),a.bind(),this.dpoit.renderBlendBack(),bt&&this.webgl.timer.markEnd("DpoitPass.layer")}a.bind(),this.dpoit.render()}n.volumes.renderables.length>0&&t.renderDpoitVolume(n.volumes,r,this.depthTextureOpaque)}_renderWboit(t,r,n,o,i){if(!this.wboit.supported)throw new Error("expected wboit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderWboitOpaque(n.primitives,r,null),lc.isEnabled(i)&&((lc.isTransparentOutlineEnabled(i)||eh.isEnabled(i))&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,o,t.props.backgroundColor,i,t.light)),(n.opacityAverage<1||n.volumes.renderables.length>0)&&(this.wboit.bind(),n.opacityAverage<1&&t.renderWboitTransparent(n.primitives,r,this.depthTextureOpaque),n.volumes.renderables.length>0&&t.renderWboitTransparent(n.volumes,r,this.depthTextureOpaque),lc.isEnabled(i)?this.postprocessing.target.bind():this.colorTarget.bind(),this.wboit.render())}_renderBlended(t,r,n,o,i,s){var a,l,c,u;if(o?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),n.hasOpaque&&t.renderBlendedOpaque(n.primitives,r,null),!o&&(this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),t.clearDepth(!0),t.renderDepthOpaque(n.primitives,r,null),this.colorTarget.bind()),lc.isEnabled(s)&&(this.packedDepth?(a=this.colorTarget.depthRenderbuffer)===null||a===void 0||a.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth"),(lc.isTransparentOutlineEnabled(s)||eh.isEnabled(s))&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),n.opacityAverage<1&&t.renderDepthTransparent(n.primitives,r,this.depthTextureOpaque)),this.postprocessing.render(r,!1,i,t.props.backgroundColor,s,t.light),this.packedDepth?(l=this.colorTarget.depthRenderbuffer)===null||l===void 0||l.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,"depth")),n.volumes.renderables.length>0)){let d=lc.isEnabled(s)?this.postprocessing.target:this.colorTarget;this.packedDepth?(c=this.colorTarget.depthRenderbuffer)===null||c===void 0||c.detachFramebuffer(d.framebuffer):this.depthTextureOpaque.detachFramebuffer(d.framebuffer,"depth"),d.bind(),t.renderBlendedVolume(n.volumes,r,this.depthTextureOpaque),this.packedDepth?(u=this.colorTarget.depthRenderbuffer)===null||u===void 0||u.attachFramebuffer(d.framebuffer):this.depthTextureOpaque.attachFramebuffer(d.framebuffer,"depth"),d.bind()}n.opacityAverage<1&&t.renderBlendedTransparent(n.primitives,r,null)}_render(t,r,n,o,i,s,a){var l,c;let u=n.volumes.renderables.length>0,d=lc.isEnabled(a.postprocessing),m=By.isEnabled(a.postprocessing),p=Aw.isEnabled(a.marking),h=eh.isEnabled(a.postprocessing),{x:f,y:C,width:g,height:b}=r.viewport;t.setViewport(f,C,g,b),t.update(r,n),s&&!m&&i&&(this.drawTarget.bind(),t.clear(!1));let y=!1;this.transparencyMode==="wboit"&&this.wboit.supported?(this._renderWboit(t,r,n,s,a.postprocessing),y=!0):this.transparencyMode==="dpoit"&&this.dpoit.supported?(this._renderDpoit(t,r,n,a.dpoitIterations,s,a.postprocessing),y=!0):this._renderBlended(t,r,n,!u&&!d&&!m&&i,s,a.postprocessing);let x=d?this.postprocessing.target:!i||u||y?this.colorTarget:this.drawTarget;if(p&&n.markerAverage>0){let v=a.marking.ghostEdgeStrength<1;v&&n.markerAverage!==1&&(this.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(n.primitives,r,null)),this.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(n.primitives,r,v?this.marking.depthTarget.texture:null),this.marking.update(a.marking),this.marking.render(r.viewport,x)}else x.bind();o.debug.isEnabled&&(o.debug.syncVisibility(),t.renderBlended(o.debug.scene,r)),o.handle.isEnabled&&t.renderBlended(o.handle.scene,r),o.camera.isEnabled&&(o.camera.update(r),t.update(o.camera.camera,o.camera.scene),t.renderBlended(o.camera.scene,o.camera.camera));let A=!1;if(m){let v=lc.isEnabled(a.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.antialiasing.render(r,v,i&&!h,a.postprocessing)}else i&&!eh.isEnabled(a.postprocessing)&&(A=!0);if(a.postprocessing.dof.name==="on"){let v=By.isEnabled(a.postprocessing)?this.antialiasing.target.texture:lc.isEnabled(a.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture;this.dof.update(r,v,((l=this.depthTargetOpaque)===null||l===void 0?void 0:l.texture)||this.depthTextureOpaque,this.depthTextureTransparent,a.postprocessing.dof.params,n.boundingSphereVisible),this.dof.render(r.viewport,i?void 0:this.getColorTarget(a.postprocessing))}else i&&!By.isEnabled(a.postprocessing)&&(A=!0);if(A&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),d?this.copyFboPostprocessing.render():(u||y)&&this.copyFboTarget.render()),a.postprocessing.bloom.name==="on"){let v=a.postprocessing.bloom.params.mode==="emissive";v&&n.emissiveAverage>0&&(this.bloom.emissiveTarget.bind(),t.clear(!1,!0),t.update(r,n),t.renderEmissive(n.primitives,r,null)),(!v||n.emissiveAverage>0)&&(this.bloom.update(this.colorTarget.texture,this.bloom.emissiveTarget.texture,((c=this.depthTargetOpaque)===null||c===void 0?void 0:c.texture)||this.depthTextureOpaque,a.postprocessing.bloom.params),this.bloom.render(r.viewport,i?void 0:this.getColorTarget(a.postprocessing)))}this.webgl.gl.flush()}render(t,r,n){bt&&this.webgl.timer.mark("DrawPass.render");let{renderer:o,camera:i,scene:s,helper:a}=t;this.postprocessing.setTransparentBackground(r.transparentBackground);let l=r.transparentBackground||this.postprocessing.background.isEnabled(r.postprocessing.background);o.setTransparentBackground(l),o.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),o.setPixelRatio(this.webgl.pixelRatio),Kp.is(i)?(bt&&this.webgl.timer.mark("StereoCamera.left"),this._render(o,i.left,s,a,n,l,r),bt&&this.webgl.timer.markEnd("StereoCamera.left"),bt&&this.webgl.timer.mark("StereoCamera.right"),this._render(o,i.right,s,a,n,l,r),bt&&this.webgl.timer.markEnd("StereoCamera.right")):this._render(o,i,s,a,n,l,r),bt&&this.webgl.timer.markEnd("DrawPass.render")}getColorTarget(t){return eh.isEnabled(t)?this.dof.target:By.isEnabled(t)?this.antialiasing.target:lc.isEnabled(t)?this.postprocessing.target:this.colorTarget}};var Q6e={alpha:M.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:"Opacity"}),colorX:M.Color(Gt.red,{isEssential:!0}),colorY:M.Color(Gt.green,{isEssential:!0}),colorZ:M.Color(Gt.blue,{isEssential:!0}),scale:M.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:M.Select("bottom-left",M.arrayToOptions(["bottom-left","bottom-right","top-left","top-right"])),locationOffsetX:M.Numeric(0),locationOffsetY:M.Numeric(0),originColor:M.Color(Gt.grey),radiusScale:M.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:M.Boolean(!0),planeColorXY:M.Color(Gt.grey,{label:"Plane Color XY"}),planeColorXZ:M.Color(Gt.grey,{label:"Plane Color XZ"}),planeColorYZ:M.Color(Gt.grey,{label:"Plane Color YZ"}),showLabels:M.Boolean(!1),labelX:M.Text("X"),labelY:M.Text("Y"),labelZ:M.Text("Z"),labelColorX:M.Color(Gt.grey),labelColorY:M.Color(Gt.grey),labelColorZ:M.Color(Gt.grey),labelOpacity:M.Numeric(1,{min:0,max:1,step:.01}),labelScale:M.Numeric(.25,{min:.1,max:1,step:.01})},Ly={axes:M.MappedStatic("on",{on:M.Group(Q6e),off:M.Group({})},{cycle:!0,description:"Show camera orientation axes"})},lS=class{constructor(t,r={}){this.webgl=t,this.props={axes:{name:"off",params:{}}},this.pixelRatio=1,this.eachGroup=(n,o)=>{if(!Bk(n))return!1;let i=!1;if(this.meshRenderObject){let s=this.meshRenderObject.values.uGroupCount.ref.value;for(let{groupId:a,instanceId:l}of n.elements){let c=l*s+a;o(Be.ofSingleton(c))&&(i=!0)}}if(this.textRenderObject){let s=this.textRenderObject.values.uGroupCount.ref.value;for(let{groupId:a,instanceId:l}of n.elements){let c=l*s+a;o(Be.ofSingleton(c))&&(i=!0)}}return i},this.scene=Jf.create(t,"blended"),this.camera=new Eo,D.set(this.camera.up,0,1,0),D.set(this.camera.target,0,0,0),this.setProps(r)}setProps(t){this.props=Jl(this.props,r=>{if(t.axes!==void 0&&(r.axes.name=t.axes.name,t.axes.name==="on")){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;let n={...t.axes.params,scale:t.axes.params.scale*this.pixelRatio,labelScale:t.axes.params.labelScale*this.pixelRatio};this.meshRenderObject=oje(n),this.scene.add(this.meshRenderObject),t.axes.params.showLabels?(this.textRenderObject=aje(n),this.scene.add(this.textRenderObject)):this.textRenderObject=void 0,this.scene.commit(),D.set(this.camera.position,0,0,n.scale*200),de.lookAt(this.camera.view,this.camera.position,this.camera.target,this.camera.up),r.axes.params={...t.axes.params}}})}get isEnabled(){return this.props.axes.name==="on"}getLoci(t){let{objectId:r,groupId:n,instanceId:o}=t;return(!this.meshRenderObject||r!==this.meshRenderObject.id)&&(!this.textRenderObject||r!==this.textRenderObject.id)||n===ro.None?pr:eje(this,n,o)}mark(t,r){return!si.is(si.Highlighting,r)||!cs(t)&&(!Bk(t)||t.data!==this)?!1:Er.mark(this.meshRenderObject,t,r,this.eachGroup)||Er.mark(this.textRenderObject,t,r,this.eachGroup)}update(t){if(!this.meshRenderObject||this.props.axes.name==="off")return;this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),tje(this.camera,t.viewport,t.viewOffset),de.extractRotation(this.scene.view,t.view);let r=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,n=this.props.axes.params.location,o=this.props.axes.params.locationOffsetX*this.pixelRatio,i=this.props.axes.params.locationOffsetY*this.pixelRatio;n==="bottom-left"?de.setTranslation(this.scene.view,D.create(-t.viewport.width/2+r+o,-t.viewport.height/2+r+i,0)):n==="bottom-right"?de.setTranslation(this.scene.view,D.create(t.viewport.width/2-r-o,-t.viewport.height/2+r+i,0)):n==="top-left"?de.setTranslation(this.scene.view,D.create(-t.viewport.width/2+r+o,t.viewport.height/2-r-i,0)):n==="top-right"?de.setTranslation(this.scene.view,D.create(t.viewport.width/2-r-o,t.viewport.height/2-r-i,0)):Sr(n)}},ro;(function(e){e[e.None=0]="None",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=3]="Z",e[e.XY=4]="XY",e[e.XZ=5]="XZ",e[e.YZ=6]="YZ",e[e.Origin=7]="Origin"})(ro||(ro={}));function J6e(e,t){let r=t.props.axes,n=r.name==="on"?r.params.labelX:"X",o=r.name==="on"?r.params.labelY:"Y",i=r.name==="on"?r.params.labelZ:"Z";switch(e){case ro.X:return`${n} Axis`;case ro.Y:return`${o} Axis`;case ro.Z:return`${i} Axis`;case ro.XY:return`${n}${o} Plane`;case ro.XZ:return`${n}${i} Plane`;case ro.YZ:return`${o}${i} Plane`;case ro.Origin:return"Origin";default:return"Axes"}}function eje(e,t,r){return by("camera-axes",e,[{groupId:t,instanceId:r}],void 0,()=>J6e(t,e))}function Bk(e){return e.kind==="data-loci"&&e.tag==="camera-axes"}function tje(e,t,r){let{near:n,far:o}=e,i=-t.width/2,s=t.width/2,a=t.height/2,l=-t.height/2,c=(s-i)/2,u=(a-l)/2,d=(s+i)/2,m=(a+l)/2,p=d-c,h=d+c,f=m+u,C=m-u;if(r.enabled){let g=(s-i)/r.width,b=(a-l)/r.height;p+=g*r.offsetX,h=p+g*r.width,f-=b*r.offsetY,C=f-b*r.height}de.ortho(e.projection,p,h,f,C,n,o)}function rje(e,t){let r=gt.createState(512,256,t),n=100*e.scale,o=e.radiusScale*n,i=e.showLabels?100*e.labelScale/3:0,s=D.scale(D(),D.unitX,n-i),a=D.scale(D(),D.unitY,n-i),l=D.scale(D(),D.unitZ,n-i),c={radiusTop:o,radiusBottom:o,radialSegments:32};if(r.currentGroup=ro.Origin,Rr(r,D.origin,o,2),r.currentGroup=ro.X,Rr(r,s,o,2),zr(r,D.origin,s,1,c),r.currentGroup=ro.Y,Rr(r,a,o,2),zr(r,D.origin,a,1,c),r.currentGroup=ro.Z,Rr(r,l,o,2),zr(r,D.origin,l,1,c),e.showPlanes){D.scale(s,s,.5),D.scale(a,a,.5),D.scale(l,l,.5),r.currentGroup=ro.XY,gt.addTriangle(r,D.origin,s,a),gt.addTriangle(r,D.origin,a,s);let u=D.add(D(),s,a);gt.addTriangle(r,u,s,a),gt.addTriangle(r,u,a,s),r.currentGroup=ro.XZ,gt.addTriangle(r,D.origin,s,l),gt.addTriangle(r,D.origin,l,s);let d=D.add(D(),s,l);gt.addTriangle(r,d,s,l),gt.addTriangle(r,d,l,s),r.currentGroup=ro.YZ,gt.addTriangle(r,D.origin,a,l),gt.addTriangle(r,D.origin,l,a);let m=D.add(D(),a,l);gt.addTriangle(r,m,a,l),gt.addTriangle(r,m,l,a)}return gt.getMesh(r)}function nje(e,t){let r=100*e.scale,n=rje(e,t?.geometry);n.setBoundingSphere(Pe.create(D.create(r/2,r/2,r/2),r+r/4));let o=i=>{switch(i){case ro.X:return e.colorX;case ro.Y:return e.colorY;case ro.Z:return e.colorZ;case ro.XY:return e.planeColorXY;case ro.XZ:return e.planeColorXZ;case ro.YZ:return e.planeColorYZ;case ro.Origin:return e.originColor;default:return Gt.grey}};return br.create("axes-mesh",{},n,o,()=>1,()=>"")}function oje(e){let t=nje(e);return br.createRenderObject(t,{...M.getDefaultValues(Ct.Params),...e,ignoreLight:!0,cellSize:0})}function ije(e,t){let r=kc.create(e,8,8,t),n=100*e.scale,o=D.scale(D(),D.unitX,n),i=D.scale(D(),D.unitY,n),s=D.scale(D(),D.unitZ,n),a=100*e.labelScale;return r.add(e.labelX,o[0],o[1],o[2],0,a,ro.X),r.add(e.labelY,i[0],i[1],i[2],0,a,ro.Y),r.add(e.labelZ,s[0],s[1],s[2],0,a,ro.Z),r.getText()}function sje(e,t){let r=100*e.scale,n=ije(e,t?.geometry);n.setBoundingSphere(Pe.create(D.create(r/2,r/2,r/2),r));let o=i=>{switch(i){case ro.X:return e.labelColorX;case ro.Y:return e.labelColorY;case ro.Z:return e.labelColorZ;default:return Gt.grey}};return br.create("axes-text",{},n,o,()=>1,()=>"")}function aje(e){let t=sje(e);return br.createRenderObject(t,{...M.getDefaultValues(Cs.Params),...e,alpha:e.labelOpacity,cellSize:0})}var lje={transparentBackground:M.Boolean(!1),dpoitIterations:M.Numeric(2,{min:1,max:10,step:1}),multiSample:M.Group(Tk),postprocessing:M.Group(iS),marking:M.Group(Rk),cameraHelper:M.Group(Ly)},Lk=class{get colorTarget(){return this._colorTarget}get width(){return this._width}get height(){return this._height}constructor(t,r,n,o,i,s,a,l){this.webgl=t,this.renderer=n,this.scene=o,this.camera=i,this._width=0,this._height=0,this._camera=new Eo,this.props={...M.getDefaultValues(lje),...l},this.drawPass=new aS(t,r,128,128,a),this.multiSamplePass=new Ng(t,this.drawPass),this.multiSampleHelper=new sS(this.multiSamplePass),this.helper={camera:new lS(t,this.props.cameraHelper),debug:s.debug,handle:s.handle},this.setSize(1024,768)}updateBackground(){return new Promise(t=>{this.drawPass.postprocessing.background.update(this.camera,this.props.postprocessing.background,()=>{t()})})}setSize(t,r){t===this._width&&r===this._height||(this._width=t,this._height=r,this.drawPass.setSize(t,r),this.multiSamplePass.syncSize())}setProps(t={}){Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)}render(){Eo.copySnapshot(this._camera.state,this.camera.state),Zo.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();let t={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};Ng.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(t,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(t,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))}getImageData(t,r,n){var o,i;this.setSize(t,r),this.render(),this.colorTarget.bind();let s=(o=n?.width)!==null&&o!==void 0?o:t,a=(i=n?.height)!==null&&i!==void 0?i:r,l=new Uint8Array(s*a*4);n?this.webgl.readPixels(n.x,r-n.y-n.height,s,a,l):this.webgl.readPixels(0,0,s,a,l);let c=ig.create(l,s,a);return ig.flipY(c),ig.divideByAlpha(c),new ImageData(new Uint8ClampedArray(l),s,a)}};var cje={...Ct.Params,alpha:{...Ct.Params.alpha,defaultValue:1},ignoreLight:{...Ct.Params.ignoreLight,defaultValue:!0},colorX:M.Color(Gt.red,{isEssential:!0}),colorY:M.Color(Gt.green,{isEssential:!0}),colorZ:M.Color(Gt.blue,{isEssential:!0}),scale:M.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})},Fk={handle:M.MappedStatic("off",{on:M.Group(cje),off:M.Group({})},{cycle:!0,description:"Show handle tool"})},Nk=class{getBoundingSphere(t,r){return this.renderObject&&(Pe.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),de.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,r*16),Pe.transform(t,t,this._transform)),t}setProps(t){this.props=Jl(this.props,r=>{if(t.handle!==void 0&&(r.handle.name=t.handle.name,t.handle.name==="on")){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;let n={...t.handle.params,scale:t.handle.params.scale*this.webgl.pixelRatio,cellSize:0};this.renderObject=pje(n),this.scene.add(this.renderObject),this.scene.commit(),r.handle.params={...t.handle.params}}})}get isEnabled(){return this.props.handle.name==="on"}update(t,r,n){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),de.setTranslation(this.renderObject.values.aTransform.ref.value,r),de.fromMat3(this.renderObject.values.aTransform.ref.value,n),G.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))}getLoci(t){let{objectId:r,groupId:n,instanceId:o}=t;return!this.renderObject||r!==this.renderObject.id?pr:dje(this,n,o)}mark(t,r){return!si.is(si.Highlighting,r)||!cs(t)&&(!pme(t)||t.data!==this)?!1:Er.mark(this.renderObject,t,r,this.eachGroup)}constructor(t,r={}){this.webgl=t,this.props={handle:{name:"off",params:{}}},this.pixelRatio=1,this._transform=de(),this.eachGroup=(n,o)=>{if(!this.renderObject||!pme(n))return!1;let i=!1,s=this.renderObject.values.uGroupCount.ref.value,{elements:a}=n;for(let{groupId:l,instanceId:c}of a){let u=c*s+l;o(Be.ofSingleton(u))&&(i=!0)}return i},this.scene=Jf.create(t,"blended"),this.setProps(r)}};function uje(e,t){let r=gt.createState(512,256,t),n=.05*e,o=D.scale(D(),D.unitX,e),i=D.scale(D(),D.unitY,e),s=D.scale(D(),D.unitZ,e),a={radiusTop:n,radiusBottom:n,radialSegments:32};return r.currentGroup=t1.TranslateScreenXY,Rr(r,D.origin,n*3,2),r.currentGroup=t1.TranslateObjectX,Rr(r,o,n,2),zr(r,D.origin,o,1,a),r.currentGroup=t1.TranslateObjectY,Rr(r,i,n,2),zr(r,D.origin,i,1,a),r.currentGroup=t1.TranslateObjectZ,Rr(r,s,n,2),zr(r,D.origin,s,1,a),gt.getMesh(r)}var t1={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function dje(e,t,r){return by("handle",e,[{groupId:t,instanceId:r}],n=>e.getBoundingSphere(n,r),()=>`Handle Helper | Group Id ${t} | Instance Id ${r}`)}function pme(e){return e.kind==="data-loci"&&e.tag==="handle"}function mje(e,t){let r=10*e.scale,n=uje(r,t?.geometry);n.setBoundingSphere(Pe.create(D.create(r/2,r/2,r/2),r+r/4));let o=i=>{switch(i){case t1.TranslateObjectX:return e.colorX;case t1.TranslateObjectY:return e.colorY;case t1.TranslateObjectZ:return e.colorZ;default:return Gt.grey}};return br.create("handle",{},n,o,()=>1,()=>"")}function pje(e){let t=mje(e);return br.createRenderObject(t,e)}var fje={debug:M.Group(Sw),camera:M.Group({helper:M.Group(Ly)}),handle:M.Group(Fk)},hje=M.getDefaultValues(fje),Ok=class{constructor(t,r,n={}){let o={...hje,...n};this.debug=new bk(t,r,o.debug),this.camera=new lS(t,o.camera.helper),this.handle=new Nk(t,o.handle)}};var Vk=class{constructor(t,r,n={}){this.webgl=t;let{gl:o}=t;this.draw=new aS(t,r,o.drawingBufferWidth,o.drawingBufferHeight,n.transparency||"blended"),this.pick=new Pk(t,this.draw,n.pickScale||.25),this.multiSample=new Ng(t,this.draw)}setPickScale(t){this.pick.setPickScale(t)}setTransparency(t){this.draw.setTransparency(t)}updateSize(){let{gl:t}=this.webgl,r=Math.max(t.drawingBufferWidth,2),n=Math.max(t.drawingBufferHeight,2);this.draw.setSize(r,n),this.pick.syncSize(),this.multiSample.syncSize()}};var fme=`
precision highp float;
precision highp sampler2D;

uniform sampler2D tPreviousLevel;
uniform vec2 uInvSize;
uniform vec2 uOffset;

void main(void) {
    vec2 position = gl_FragCoord.xy * uInvSize + uOffset;

    float x = texture(tPreviousLevel, position).r;
    float y = textureOffset(tPreviousLevel, position, ivec2(-1, 0)).r;
    float z = textureOffset(tPreviousLevel, position, ivec2(-1, -1)).r;
    float w = textureOffset(tPreviousLevel, position, ivec2(0, -1)).r;

    gl_FragColor = vec4(max(max(x, y), max(z, w)));
}
`;var gje={...Rn,tPreviousLevel:kt("texture","alpha","float","nearest"),uInvSize:Re("v2"),uOffset:Re("v2")},yje=Gr("hi-z",Kn,fme);function hme(e,t){let r={...Bn,tPreviousLevel:G.create(t),uInvSize:G.create(Ve()),uOffset:G.create(Ve())},n={...gje},o=on(e,"triangles",yje,n,r);return sn(o,r)}var gme=new ArrayBuffer(4),Bur=new Int32Array(gme),Lur=new Float32Array(gme);var yme=new ArrayBuffer(4),vje=new Int32Array(yme),bje=new Float32Array(yme);function xje(e){let t=e<-126?-126:e;return vje[0]=(1<<23)*(t+126.94269504),bje[0]}function vme(e){return xje(1.44269504*e)}var bme=new ArrayBuffer(8),Nur=new Int32Array(bme),Fur=new Float32Array(bme);var xme=new ArrayBuffer(4),Cje=new Int32Array(xme),Sje=new Float32Array(xme);function Cme(e){return Sje[0]=e,Cje[0]*11920928955078125e-23-126.94269504}var Our=Math.PI/2,Vur=2*Math.PI,Gur=1/(2*Math.PI),Uur=2/Math.PI,zur=4/Math.PI,Hur=4/(Math.PI*Math.PI),jur=Math.PI/2-2*Math.PI;var Sme=new ArrayBuffer(16),$ur=new Int32Array(Sme),Wur=new Float32Array(Sme);var Ime=new ArrayBuffer(8),qur=new Int32Array(Ime),Zur=new Float32Array(Ime);var Ame=new ArrayBuffer(4),Kur=new Int32Array(Ame),Xur=new Float32Array(Ame);var Yur=Math.PI/4;var Ije=D.transformMat4,wme=Ht.set,Aje=Cme;function wje(e,t,r){return t*r/((r-t)*e-r)}function _je(e,t,r){return e*(t-r)-t}function Gk(e,t,r,n){return n[11]===-1?wje(e,t,r):_je(e,t,r)}function Tje(e,t,r,n){let o=t[0]*r,i=t[1]*r,s=t[2]*r,a=t[2]*t[2]-r*r,l=Math.sqrt(t[0]*t[0]+a),c=(l*t[0]-s)/(l*t[2]+o)*n[0],u=(l*t[0]+s)/(l*t[2]-o)*n[0],d=Math.sqrt(t[1]*t[1]+a),m=(d*t[1]-s)/(d*t[2]+i)*n[5],p=(d*t[1]+s)/(d*t[2]-i)*n[5];return wme(e,u*-.5+.5,m*.5+.5,c*-.5+.5,p*.5+.5)}function Eje(e,t,r,n){let o=n[0],i=n[5],s=(t[0]+r)*o,a=(t[0]-r)*o,l=(t[1]+r)*i,c=(t[1]-r)*i;return wme(e,a*.5+.5,l*-.5+.5,s*.5+.5,c*-.5+.5)}function Pje(e,t,r,n){return n[11]===-1?Tje(e,t,r,n):Eje(e,t,r,n)}var I9={enabled:M.Boolean(!1,{description:"Hierarchical Z-buffer occlusion culling. Only available for WebGL2."}),maxFrameLag:M.Numeric(10,{min:1,max:30,step:1},{description:"Maximum number of frames to wait for Z-buffer data."}),minLevel:M.Numeric(3,{min:1,max:10,step:1})},Uk=class{clear(){if(!this.supported)return;let{gl:t}=this.webgl;er(t)&&(this.sync!==null&&(t.deleteSync(this.sync),this.sync=null),this.frameLag=0,this.ready=!1,this.debug&&(this.debug.rect.style.display="none",this.debug.container.style.display="none"))}render(t){if(!this.supported||!this.props.enabled)return;let{gl:r,state:n}=this.webgl;if(!er(r)||this.sync!==null)return;this.nextNear=t.near,this.nextFar=t.far,de.copy(this.nextView,t.view),de.copy(this.nextProjection,t.projection),bt&&this.webgl.timer.mark("hi-Z"),n.disable(r.CULL_FACE),n.disable(r.BLEND),n.disable(r.DEPTH_TEST),n.disable(r.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0);let o=this.renderable.values,i=Math.pow(2,Math.ceil(Math.log(Math.max(r.drawingBufferWidth,r.drawingBufferHeight))/Math.log(2))-1);for(let l=0,c=this.levelData.length;l<c;++l){let u=this.levelData[l];u.framebuffer.bind(),l>0?(G.update(o.uInvSize,u.invSize),G.update(o.uOffset,Ve.set(o.uOffset.ref.value,0,0)),G.update(o.tPreviousLevel,this.levelData[l-1].texture)):(G.update(o.uInvSize,Ve.set(o.uInvSize.ref.value,1/i,1/i)),G.update(o.uOffset,Ve.set(o.uOffset.ref.value,this.viewport.x/r.drawingBufferWidth,this.viewport.y/r.drawingBufferHeight)),G.update(o.tPreviousLevel,this.drawPass.depthTextureOpaque)),n.currentRenderItemId=-1,n.viewport(0,0,u.size[0],u.size[1]),r.clear(r.COLOR_BUFFER_BIT),this.renderable.update(),this.renderable.render(),l>=this.props.minLevel&&(this.tex.bind(0),r.copyTexSubImage2D(r.TEXTURE_2D,0,u.offset,0,0,0,u.size[0],u.size[1]),this.tex.unbind(0))}this.tex.attachFramebuffer(this.fb,0);let s=this.tex.getWidth(),a=this.tex.getHeight();r.bindBuffer(r.PIXEL_PACK_BUFFER,this.buf),r.bufferData(r.PIXEL_PACK_BUFFER,this.buffer.byteLength,r.STREAM_READ),r.readPixels(0,0,s,a,r.RED,r.FLOAT,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),this.sync=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0),r.flush(),bt&&this.webgl.timer.markEnd("hi-Z")}tick(){if(!this.supported||!this.props.enabled||this.sync===null)return;let{gl:t}=this.webgl;if(!er(t))return;let r=t.clientWaitSync(this.sync,0,0);r===t.WAIT_FAILED||this.frameLag>=this.props.maxFrameLag?(t.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!1):r===t.TIMEOUT_EXPIRED?this.frameLag+=1:(t.bindBuffer(t.PIXEL_PACK_BUFFER,this.buf),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this.buffer),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!0,this.near=this.nextNear,this.far=this.nextFar,de.copy(this.view,this.nextView),de.copy(this.projection,this.nextProjection))}transform(t){let{view:r,vp:n}=this;Ije(n,t.center,r);let o=t.radius*1.2+1.52;return{vp:n,r:o}}project(t,r){let{projection:n,aabb:o,viewport:i}=this;Pje(o,t,r,n);let s=o[2]-o[0],a=o[3]-o[1],l=Math.max(s*i.width,a*i.height),c=Math.ceil(Aje(l/2));return{aabb:o,w:s,h:a,pr:l,lod:c}}setViewport(t,r,n,o){if(!this.supported)return;n=Math.max(n,2),o=Math.max(o,2),Zo.set(this.viewport,t,r,n,o);let i=Math.ceil(Math.log(Math.max(n,o))/Math.log(2));if(i===this.levelData.length)return;let{minLevel:s}=this.props;this.buffer=new Float32Array(Math.pow(2,i-s)*Math.pow(2,i-1-s)),this.tex.define(Math.pow(2,i-s),Math.pow(2,i-1-s));for(let l of this.levelData)l.framebuffer.destroy(),l.texture.destroy();this.levelData.length=0;for(let l=0;l<i;++l){let c=this.webgl.resources.framebuffer(),u=Math.pow(2,i-l-1),d=Ve.create(u,u),m=Ve.create(1/u,1/u),p=this.webgl.resources.texture("image-float32","alpha","float","nearest");p.define(u,u),p.attachFramebuffer(c,0),this.levelData.push({texture:p,framebuffer:c,size:d,invSize:m,offset:0})}let a=0;for(let l=0,c=i;l<c;++l){let u=this.levelData[l];l>=s&&(this.levelData[l].offset=a,a+=u.size[0])}this.clear()}setProps(t){if(this.supported)if(this.props.minLevel!==t.minLevel){Object.assign(this.props,t);let{x:r,y:n,width:o,height:i}=this.viewport;this.setViewport(r,n,o,i)}else Object.assign(this.props,t),this.props.enabled||this.clear()}initDebug(t){if(!t.parentElement)return;let r=document.createElement("div");Object.assign(r.style,{display:"block",position:"absolute",pointerEvents:"none"}),t.parentElement.appendChild(r);let n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("Could not create canvas 2d context");Object.assign(n.style,{width:"100%",height:"100%",imageRendering:"pixelated",position:"relative",pointerEvents:"none"}),r.appendChild(n);let i=document.createElement("div");Object.assign(i.style,{display:"none",position:"absolute",pointerEvents:"none"}),t.parentElement.appendChild(i),this.debug={container:r,canvas:n,ctx:o,rect:i}}canDebug(t){return this.supported&&this.props.enabled&&this.ready&&!!this.debug}showRect(t,r){if(!this.canDebug(this.debug))return;let{gl:{drawingBufferHeight:n},pixelRatio:o}=this.webgl,{viewport:{x:i,y:s,width:a,height:l}}=this,c=(t[0]*a+i)/o,u=(t[1]*l-s)/o,d=(t[2]*a+i)/o,m=(t[3]*l-s)/o,p=(n-l)/o;Object.assign(this.debug.rect.style,{border:r?"solid red":"solid green",display:"block",left:`${c}px`,top:`${u+p}px`,width:`${d-c}px`,height:`${m-u}px`})}showBuffer(t){if(!this.canDebug(this.debug))return;if(t>=this.levelData.length||t<this.props.minLevel){this.debug.container.style.display="none";return}let{offset:r,size:[n,o]}=this.levelData[t],i=this.tex.getWidth(),s=new Uint8ClampedArray(n*o*4);s.fill(255);for(let p=0;p<o;++p)for(let h=0;h<n;++h){let f=(o-p-1)*n+h,C=this.buffer[p*i+h+r]*255;s[f*4+0]=C,s[f*4+3]=255-C}let a=new ImageData(s,n,o);this.debug.canvas.width=a.width,this.debug.canvas.height=a.height,this.debug.ctx.putImageData(a,0,0);let{viewport:{x:l,y:c,width:u,height:d},webgl:{pixelRatio:m}}=this;Object.assign(this.debug.container.style,{display:"block",bottom:`${c/m}px`,left:`${l/m}px`,width:`${u/m}px`,height:`${d/m}px`})}debugOcclusion(t){if(!this.canDebug(this.debug))return;if(!t){this.debug.rect.style.display="none",this.debug.container.style.display="none";return}let r=this.isOccluded(t),{vp:n,r:o}=this.transform(t),{aabb:i,lod:s}=this.project(n,o);this.showRect(i,r),this.showBuffer(s)}dispose(){if(this.supported){this.clear(),this.fb.destroy(),this.tex.destroy(),this.webgl.gl.deleteBuffer(this.buf),this.renderable.dispose();for(let t of this.levelData)t.framebuffer.destroy(),t.texture.destroy()}}constructor(t,r,n,o){this.webgl=t,this.drawPass=r,this.viewport=Zo(),this.near=0,this.far=0,this.view=de(),this.projection=de(),this.nextNear=0,this.nextFar=0,this.nextView=de(),this.nextProjection=de(),this.aabb=Ht(),this.vp=D(),this.levelData=[],this.sync=null,this.buffer=new Float32Array(0),this.frameLag=0,this.ready=!1,this.isOccluded=c=>{if(!this.supported||!this.props.enabled||!this.ready)return!1;let{vp:u,r:d}=this.transform(c),{near:m,far:p,projection:h}=this,f=u[2]+d;if(-f<m)return!1;let{aabb:C,w:g,h:b,lod:y}=this.project(u,d);if(y>=this.levelData.length||y<this.props.minLevel)return!1;let{offset:x,size:A}=this.levelData[y],v=C[0]+g/2,_=C[1]+b/2,I=A[0],T=v*I,E=_*I,w=Math.floor(T),S=Math.ceil(E),P=this.tex.getWidth();if(w+1>=I||S+1>=I)return!1;let k=(I-S-1)*P+w+x;if(f>Gk(this.buffer[k],m,p,h)||f>Gk(this.buffer[k+1],m,p,h))return!1;let L=(I-S+1-1)*P+w+x;return!(f>Gk(this.buffer[L],m,p,h)||f>Gk(this.buffer[L+1],m,p,h))};let{gl:i,extensions:s}=t;if(!er(i)||!s.colorBufferFloat){this.supported=!1;return}this.fb=t.resources.framebuffer(),this.tex=t.resources.texture("image-float32","alpha","float","nearest"),this.tex.attachFramebuffer(this.fb,0);let a=i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT),l=i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE);if(a!==i.RED||l!==i.FLOAT){this.supported=!1;return}this.supported=!0,this.props={...M.getDefaultValues(I9),...o},this.buf=c3(i),this.renderable=hme(t,this.drawPass.depthTextureOpaque),lr&&n&&this.initDebug(n)}};var Nl={camera:M.Group({mode:M.Select("perspective",M.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:M.Group(Ly,{isFlat:!0}),stereo:M.MappedStatic("off",{on:M.Group(C9),off:M.Group({})},{cycle:!0,hideIf:e=>e?.mode!=="perspective"}),fov:M.Numeric(45,{min:10,max:130,step:1},{label:"Field of View"}),manualReset:M.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:M.MappedStatic("on",{on:M.Group({intensity:M.Numeric(15,{min:1,max:100,step:1})}),off:M.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:M.Group({radius:M.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:M.Boolean(!0,{description:"Hide scene in the distance"}),minNear:M.Numeric(5,{min:.1,max:100,step:.1},{description:"Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0."})},{pivot:"radius"}),viewport:M.MappedStatic("canvas",{canvas:M.Group({}),"static-frame":M.Group({x:M.Numeric(0),y:M.Numeric(0),width:M.Numeric(128),height:M.Numeric(128)}),"relative-frame":M.Group({x:M.Numeric(.33,{min:0,max:1,step:.01}),y:M.Numeric(.33,{min:0,max:1,step:.01}),width:M.Numeric(.5,{min:.01,max:1,step:.01}),height:M.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:M.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),sceneRadiusFactor:M.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:M.Boolean(!1),dpoitIterations:M.Numeric(2,{min:1,max:10,step:1}),pickPadding:M.Numeric(3,{min:0,max:10,step:1},{description:"extra pixels to around target to check in case target is empty"}),multiSample:M.Group(Tk),postprocessing:M.Group(iS),marking:M.Group(Rk),hiZ:M.Group(I9),renderer:M.Group(pk),trackball:M.Group(f9),interaction:M.Group(y9),debug:M.Group(Sw),handle:M.Group(Fk)},ww=M.getDefaultValues(Nl);var Xp;(function(e){e.DefaultAttribs={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,preferWebGl1:!1,handleResize:()=>{}},e.Params={pixelScale:M.Numeric(1,{min:.1,max:2,step:.05}),pickScale:M.Numeric(.25,{min:.1,max:1,step:.05}),transparency:M.Select("wboit",[["blended","Blended"],["wboit","Weighted, Blended"],["dpoit","Depth Peeling"]])},e.DefaultProps=M.getDefaultValues(e.Params);function t(r,n,o={},i={}){let s={...e.DefaultAttribs,...o},a={...e.DefaultProps,...i},{powerPreference:l,failIfMajorPerformanceCaveat:c,antialias:u,preserveDrawingBuffer:d,preferWebGl1:m}=s,p=rte(r,{powerPreference:l,failIfMajorPerformanceCaveat:c,antialias:u,preserveDrawingBuffer:d,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:m});if(p===null)throw new Error("Could not create a WebGL rendering context");let{pixelScale:h,pickScale:f,transparency:C}=a,g=mk.fromElement(r,{pixelScale:h,preventGestures:!0}),b=ate(p,{pixelScale:h}),y=new Vk(b,n,{pickScale:f,transparency:C});if(lr){let I=p.getExtension("WEBGL_lose_context");I&&r.addEventListener("mousedown",T=>{b.isContextLost||!T.shiftKey||!T.ctrlKey||!T.altKey||(I.loseContext(),setTimeout(()=>{b.isContextLost&&I.restoreContext()},1e3))},!1)}let x=new jo(0),A=I=>{b.setContextLost(),I.preventDefault(),x.next(Zn())},v=()=>{b.isContextLost&&b.handleContextRestored(()=>{y.draw.reset()})};r.addEventListener("webglcontextlost",A,!1),r.addEventListener("webglcontextrestored",v,!1);let _=new jo(void 0);return{canvas:r,webgl:b,input:g,passes:y,attribs:s,get props(){return{...a}},contextLost:x,contextRestored:b.contextRestored,assetManager:n,changed:_,setProps:I=>{if(!I)return;let T=!1;I.pixelScale!==void 0&&I.pixelScale!==a.pixelScale&&(a.pixelScale=I.pixelScale,g.setPixelScale(I.pixelScale),b.setPixelScale(I.pixelScale),s.handleResize(),T=!0),I.pickScale!==void 0&&I.pickScale!==a.pickScale&&(a.pickScale=I.pickScale,y.setPickScale(I.pickScale),T=!0),I.transparency!==void 0&&I.transparency!==a.transparency&&(a.transparency=I.transparency,y.setTransparency(I.transparency),T=!0),T&&_.next(void 0)},dispose:I=>{g.dispose(),r.removeEventListener("webglcontextlost",A,!1),r.removeEventListener("webglcontextrestored",v,!1),b.destroy(I)}}}e.fromCanvas=t})(Xp||(Xp={}));var Dje=typeof window<"u"?window.requestAnimationFrame:e=>setImmediate(()=>e(Date.now())),_me=typeof window<"u"?window.cancelAnimationFrame:e=>clearImmediate(e),zk;(function(e){function t(r,n={}){var o;let{webgl:i,input:s,passes:a,assetManager:l,canvas:c}=r,u={...Xa(ww),...Xa(n)},d=new Map,m=new Map,p=new jo(0),h=Zn(),f=new jo(0),C=new jo(0),g=new jo(0),{gl:b,contextRestored:y}=i,x=0,A=0,v=128,_=128,I=!1,T=0;vt();let E=Jf.create(i,a.draw.transparency);function w(){return E.boundingSphere.radius*u.sceneRadiusFactor}let S=new Eo({position:D.create(0,0,100),mode:u.camera.mode,fog:u.cameraFog.name==="on"?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far,minNear:u.cameraClipping.minNear,fov:Pr(u.camera.fov)},{x,y:A,width:v,height:_}),P=new Kp(S,u.camera.stereo.params),k=hk.create(s,S,E,u.trackball),L=new Ok(i,E,u),R=new Uk(i,a.draw,c,u.hiZ),N=fk.create(i,u.renderer);N.setOcclusionTest(R.isOccluded);let F=new Dk(i,N,E,L,a.pick,{x,y:A,width:v,height:_},u.pickPadding),H=new xk(me,U,s,S,k,u.interaction),V=new sS(a.multiSample);a.draw.postprocessing.background.update(S,u.postprocessing.background,$e=>{$e&&oe()});let q=!1,Q,O,B=!1,j=!0;function U($e){let be=pr,Te=Wt.Empty;if($e){let De=L.camera.getLoci($e);if(De!==pr)return{loci:De,repr:Te};be=L.handle.getLoci($e),d.forEach((pe,Ce)=>{let he=Ce.getLoci($e);wi(he)||(wi(be),be=he,Te=Ce)})}return{loci:be,repr:Te}}let z=[];function $($e,be){z.push([$e,be])}function Z(){let $e=!1;for(let[be,Te]of z)$e=J(be,Te)||$e;return z=[],$e&&(E.update(void 0,!0),L.handle.scene.update(void 0,!0),L.camera.scene.update(void 0,!0)),$e}function J($e,be){let{repr:Te,loci:De}=$e,pe=!1;return Te?pe=Te.mark(De,be)||pe:d.forEach((Ce,he)=>{pe=he.mark(De,be)||pe}),pe=L.handle.mark(De,be)||pe,pe=L.camera.mark(De,be)||pe,pe}function ie($e){if(i.isContextLost)return!1;let be=!1;if(B&&(Ye(!1),B=!1,be=!0),x>b.drawingBufferWidth||x+v<0||A>b.drawingBufferHeight||A+_<0)return!1;let Te=Z()&&(N.props.colorMarker||u.marking.enabled),De=!1;k.update(T);let pe=S.update(),Ce=$e||pe||be||I;I=!1;let he=V.update(Te||Ce,u.multiSample);if(Ce||he||Te){let We=S;u.camera.stereo.name==="on"&&(P.update(),We=P),bt&&i.timer.mark("Canvas3D.render",!0);let It={renderer:N,camera:We,scene:E,helper:L};if(Ng.isEnabled(u.multiSample)){let St=u.multiSample.reduceFlicker&&!pe&&Te&&!k.isAnimating;V.render(It,u,!0,St)}else a.draw.render(It,u,!0);R.render(S),bt&&i.timer.markEnd("Canvas3D.render"),F.dirty=F.dirty||Ce,De=!0}return De}let ne=!1,le=!1;function ee($e){le||ie(!!$e?.force)&&j&&f.next(Zn()-h)}function oe(){I=!0}let te=0;function X($e,be){T=$e,Y(be?.isSynchronous),be?.updateControls&&k.update(T),S.transition.tick(T),R.tick(),!be?.manualDraw&&(ee(),!S.transition.inTransition&&!i.isContextLost&&H.tick(T))}function W(){X(Zn()),te=Dje(W)}function K($e){h=$e,k.start($e)}function re(){le=!1,k.start(Zn()),te===0&&W()}function se($e=!1){le=$e,_me(te),te=0}function me($e,be){let Te=u.camera.stereo.name==="on"?P:S;return i.isContextLost?void 0:F.identify($e,be,Te)}function Y($e=!1){Fe($e)&&(ae(),ne&&(L.debug.isEnabled&&L.debug.update(),ee({force:!0}),ne=!1),C.next(Zn()))}function ae(){if(!q)return;let $e=E.boundingSphereVisible,{center:be,radius:Te}=$e,De=k.props.autoAdjustMinMaxDistance;if(De.name==="on"){let pe=De.params.minDistanceFactor*Te+De.params.minDistancePadding,Ce=Math.max(De.params.maxDistanceFactor*Te,De.params.maxDistanceMin);k.setProps({minDistance:pe,maxDistance:Ce})}if(Te>0){let pe=Q===void 0?u.cameraResetDurationMs:Q,Ce=S.getFocus(be,Te),he=typeof O=="function"?O(E,S):O,We=he?{...Ce,...he}:Ce;S.setState({...We,radiusMax:w()},pe)}Q=void 0,O=void 0,q=!1}let ve=Pe(),ge=Pe();function Se(){if(S.state.radiusMax===0)return!0;if(S.transition.inTransition||O)return!1;let $e=!0,be=!0;Pe.set(ge,S.state.target,S.state.radius);for(let Te of E.renderables){if(!Te.state.visible)continue;let De=Te.values.boundingSphere.ref.value;if(!De.radius)continue;be=!1;let pe=D.distance(ge.center,De.center);if((pe>ge.radius||pe>De.radius||De.radius>S.state.radiusMax)&&!Pe.includes(ve,De))return!0;Pe.overlaps(ge,De)&&($e=!1)}return $e||!be&&ge.radius<=.1}let Ee=250;function Fe($e){return E.needsCommit?(Pe.copy(ve,E.boundingSphereVisible),R.clear(),E.commit($e?void 0:Ee)?(g.next(0),L.debug.isEnabled&&L.debug.update(),!u.camera.manualReset&&(p.value===0||Se())&&(q=!0),ve.radius===0&&(Q=0),u.camera.manualReset||S.setState({radiusMax:w()},0),p.next(d.size),lr&&Ae(),!0):(g.next(E.commitQueueSize),!1)):!0}function Ae(){E.renderables.map(pe=>({drawCount:pe.values.drawCount.ref.value,instanceCount:pe.values.instanceCount.ref.value,materialId:pe.materialId,renderItemId:pe.id})).length<50;let{texture:be,attribute:Te,elements:De}=i.resources.getByteCounts()}function we($e){Ke($e);let be=d.get($e),Te=new Set;$e.renderObjects.forEach(De=>Te.add(De)),be?$n.areEqual(Te,be)||(Te.forEach(De=>{be.has(De)||E.add(De)}),be.forEach(De=>{Te.has(De)||E.remove(De)})):$e.renderObjects.forEach(De=>E.add(De)),d.set($e,Te),E.update($e.renderObjects,!1),ne=!0,lr&&Ae()}function _e($e){rt($e);let be=d.get($e);be&&(be.forEach(Te=>E.remove(Te)),d.delete($e),ne=!0,lr&&Ae())}function Ke($e){m.has($e)||m.set($e,$e.updated.subscribe(be=>{$e.state.syncManually||we($e)}))}function rt($e){let be=m.get($e);be&&(be.unsubscribe(),m.delete($e))}function pt(){let $e=E.boundingSphere.radius>0?100-Math.round(S.transition.target.radius/w()*100):0;return{camera:{mode:S.state.mode,helper:{...L.camera.props},stereo:{...u.camera.stereo},fov:Math.round(ma(S.state.fov)),manualReset:!!u.camera.manualReset},cameraFog:S.state.fog>0?{name:"on",params:{intensity:S.state.fog}}:{name:"off",params:{}},cameraClipping:{far:S.state.clipFar,radius:$e,minNear:S.state.minNear},cameraResetDurationMs:u.cameraResetDurationMs,sceneRadiusFactor:u.sceneRadiusFactor,transparentBackground:u.transparentBackground,dpoitIterations:u.dpoitIterations,pickPadding:u.pickPadding,viewport:u.viewport,postprocessing:{...u.postprocessing},marking:{...u.marking},multiSample:{...u.multiSample},hiZ:{...R.props},renderer:{...N.props},trackball:{...k.props},interaction:{...H.props},debug:{...L.debug.props},handle:{...L.handle.props}}}let Ne=y.subscribe(()=>{F.dirty=!0,ee({force:!0}),ee({force:!0})}),je=new jo(0);function Ye($e=!0){a.updateSize(),vt(),yt(),$e&&oe(),je.next(+new Date)}NW(Ae);let mt=(o=r.changed)===null||o===void 0?void 0:o.subscribe(()=>{E.setTransparency(a.draw.transparency),oe()});if(lr&&c){let $e,be=Te=>{let De=Te&&Xt.getBoundingSphere(Xt.normalize(Te,"residue"));R.debugOcclusion(De)};s.click.subscribe(Te=>{if(!Te.modifiers.control||Te.button!==2)return;let De=me(Te.x,Te.y);if(!De){$e=void 0,be($e);return}$e=U(De.id).loci,be($e)}),f.subscribe(()=>{setTimeout(()=>{be($e)},100)})}return{webgl:i,add:we,remove:_e,commit:Y,update:($e,be)=>{if($e){if(!d.has($e))return;E.update($e.renderObjects,!!be)}else E.update(void 0,!!be);ne=!0},clear:()=>{m.forEach($e=>$e.unsubscribe()),m.clear(),d.clear(),E.clear(),L.debug.clear(),oe(),p.next(d.size)},syncVisibility:()=>{S.state.radiusMax===0&&(q=!0,Q=0),E.syncVisibility()&&L.debug.isEnabled&&L.debug.update(),oe()},requestDraw:oe,tick:X,animate:re,resetTime:K,pause:se,resume:()=>{le=!1},identify:me,mark:$,getLoci:U,handleResize:Ye,requestResize:()=>{B=!0},requestCameraReset:$e=>{Q=$e?.durationMs,O=$e?.snapshot,q=!0},camera:S,boundingSphere:E.boundingSphere,boundingSphereVisible:E.boundingSphereVisible,get notifyDidDraw(){return j},set notifyDidDraw($e){j=$e},didDraw:f,commited:C,commitQueueSize:g,reprCount:p,resized:je,setProps:($e,be=!1)=>{var Te,De,pe,Ce;let he=typeof $e=="function"?Jl(pt(),$e):$e;he.sceneRadiusFactor!==void 0&&(u.sceneRadiusFactor=he.sceneRadiusFactor,S.setState({radiusMax:w()},0));let We=Object.create(null);he.camera&&he.camera.mode!==void 0&&he.camera.mode!==S.state.mode&&(We.mode=he.camera.mode);let It=Math.round(ma(S.state.fov));if(he.camera&&he.camera.fov!==void 0&&he.camera.fov!==It&&(We.fov=Pr(he.camera.fov)),he.cameraFog!==void 0&&he.cameraFog.params){let St=he.cameraFog.name==="on"?he.cameraFog.params.intensity:0;St!==S.state.fog&&(We.fog=St)}if(he.cameraClipping!==void 0&&(he.cameraClipping.far!==void 0&&he.cameraClipping.far!==S.state.clipFar&&(We.clipFar=he.cameraClipping.far),he.cameraClipping.minNear!==void 0&&he.cameraClipping.minNear!==S.state.minNear&&(We.minNear=he.cameraClipping.minNear),he.cameraClipping.radius!==void 0)){let St=w()/100*(100-he.cameraClipping.radius);St>0&&St!==We.radius&&(We.radius=Math.max(St,.01))}Object.keys(We).length>0&&S.setState(We),!((Te=he.camera)===null||Te===void 0)&&Te.helper&&L.camera.setProps(he.camera.helper),((De=he.camera)===null||De===void 0?void 0:De.manualReset)!==void 0&&(u.camera.manualReset=he.camera.manualReset),((pe=he.camera)===null||pe===void 0?void 0:pe.stereo)!==void 0&&(Object.assign(u.camera.stereo,he.camera.stereo),P.setProps(u.camera.stereo.params)),he.cameraResetDurationMs!==void 0&&(u.cameraResetDurationMs=he.cameraResetDurationMs),he.transparentBackground!==void 0&&(u.transparentBackground=he.transparentBackground),he.dpoitIterations!==void 0&&(u.dpoitIterations=he.dpoitIterations),he.pickPadding!==void 0&&(u.pickPadding=he.pickPadding),he.viewport!==void 0&&(u.viewport===he.viewport||u.viewport.name===he.viewport.name&&zh(u.viewport.params,he.viewport.params)||(u.viewport=he.viewport,vt(),yt())),!((Ce=he.postprocessing)===null||Ce===void 0)&&Ce.background&&(Object.assign(u.postprocessing.background,he.postprocessing.background),a.draw.postprocessing.background.update(S,u.postprocessing.background,St=>{St&&!be&&oe()})),he.postprocessing&&Object.assign(u.postprocessing,he.postprocessing),he.marking&&Object.assign(u.marking,he.marking),he.multiSample&&Object.assign(u.multiSample,he.multiSample),he.hiZ&&R.setProps(he.hiZ),he.renderer&&N.setProps(he.renderer),he.trackball&&k.setProps(he.trackball),he.interaction&&H.setProps(he.interaction),he.debug&&L.debug.setProps(he.debug),he.handle&&L.handle.setProps(he.handle),We.mode==="orthographic"&&(u.camera.stereo.name="off"),be||oe()},getImagePass:($e={})=>new Lk(i,l,N,E,S,L,a.draw.transparency,$e),getRenderObjects(){let $e=[];return E.forEach((be,Te)=>$e.push(Te)),$e},get props(){return pt()},get input(){return s},get stats(){return N.stats},get interaction(){return H.events},dispose:()=>{Ne.unsubscribe(),mt?.unsubscribe(),_me(te),z=[],E.clear(),L.debug.clear(),k.dispose(),N.dispose(),H.dispose(),R.dispose(),FW(Ae)}};function vt(){let $e=x,be=A,Te=v,De=_;u.viewport.name==="canvas"?(x=0,A=0,v=b.drawingBufferWidth,_=b.drawingBufferHeight):u.viewport.name==="static-frame"?(x=u.viewport.params.x*i.pixelRatio,_=u.viewport.params.height*i.pixelRatio,A=b.drawingBufferHeight-_-u.viewport.params.y*i.pixelRatio,v=u.viewport.params.width*i.pixelRatio):u.viewport.name==="relative-frame"&&(x=Math.round(u.viewport.params.x*b.drawingBufferWidth),_=Math.round(u.viewport.params.height*b.drawingBufferHeight),A=Math.round(b.drawingBufferHeight-_-u.viewport.params.y*b.drawingBufferHeight),v=Math.round(u.viewport.params.width*b.drawingBufferWidth)),($e!==x||be!==A||Te!==v||De!==_)&&(I=!0)}function yt(){F.setViewport(x,A,v,_),N.setViewport(x,A,v,_),Zo.set(S.viewport,x,A,v,_),Zo.set(k.viewport,x,A,v,_),R.setViewport(x,A,v,_)}}e.create=t})(zk||(zk={}));function kje(e){Tme(e)}function Tme(e){ht.Canvas3D.ResetSettings.subscribe(e,()=>{var t;(t=e.canvas3d)===null||t===void 0||t.setProps(ww),e.events.canvas3d.settingsUpdated.next(void 0)}),ht.Canvas3D.SetSettings.subscribe(e,t=>{var r;e.canvas3d&&((r=e.canvas3d)===null||r===void 0||r.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}var _9={};Ui(_9,{DefaultFocusLociBindings:()=>Pme,DefaultLociLabelProvider:()=>Nje,DefaultSelectLociBindings:()=>Eme,FocusLoci:()=>o1,HighlightLoci:()=>Bje,SelectLoci:()=>w9});var r1=Vo,Ny=nl,n1=Mt.Trigger,Mje={hoverHighlightOnly:Mt([n1(r1.Flag.None)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:Mt([n1(r1.Flag.None,Ny.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},Rje={bindings:M.Value(Mje,{isHidden:!0}),ignore:M.Value([],{isHidden:!0}),preferAtoms:M.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:M.Boolean(!0)},Bje=tr.create({name:"representation-highlight-loci",category:"interaction",ctor:class extends tr.Handler{constructor(){super(...arguments),this.lociMarkProvider=(e,t)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark(e,t)}}getLoci(e){return this.params.preferAtoms&&_t.isLoci(e)&&e.bonds.length===2?_t.toFirstStructureElementLoci(e):e}register(){this.subscribeObservable(this.ctx.behaviors.interaction.hover,({current:e,buttons:t,modifiers:r})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return;let n=this.getLoci(e.loci);if(this.params.ignore.includes(n.kind)){this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:e.repr,loci:pr});return}let o=!1;Mt.match(this.params.bindings.hoverHighlightOnly,t,r)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:n}),o=!0),Mt.match(this.params.bindings.hoverHighlightOnlyExtend,t,r)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:n}),o=!0),o||this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:e.repr,loci:pr})}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)}unregister(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)}},params:()=>Rje,display:{name:"Highlight Loci on Canvas"}}),Eme={clickSelect:Mt.Empty,clickToggleExtend:Mt([n1(r1.Flag.Primary,Ny.create({shift:!0}))],"Toggle extended selection","Click on element using ${triggers} to extend selection along polymer"),clickSelectOnly:Mt.Empty,clickToggle:Mt([n1(r1.Flag.Primary,Ny.create())],"Toggle selection","Click on element using ${triggers}"),clickDeselect:Mt.Empty,clickDeselectAllOnEmpty:Mt([n1(r1.Flag.Primary,Ny.create())],"Deselect all","Click on nothing using ${triggers}")},Lje={bindings:M.Value(Eme,{isHidden:!0}),ignore:M.Value([],{isHidden:!0}),preferAtoms:M.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:M.Boolean(!0)},w9=tr.create({name:"representation-select-loci",category:"interaction",ctor:class extends tr.Handler{getLoci(e){return this.params.preferAtoms&&_t.isLoci(e)&&e.bonds.length===2?_t.toFirstStructureElementLoci(e):e}applySelectMark(e,t){let r=this.ctx.state.data.cells.get(e);if(r&&fe.isRepresentation3D(r.obj)){this.spine.current=r;let n=this.spine.getRootOfType(fe.Molecule.Structure);if(n){t&&this.lociMarkProvider({loci:qe.Loci(n.data)},zt.Deselect);let o=this.ctx.managers.structure.selection.getLoci(n.data);this.lociMarkProvider({loci:o},zt.Select)}}}register(){let e=n=>Xt.isEmpty(n),t=n=>!Xt.isEmpty(n),r=[["clickSelect",n=>this.ctx.managers.interactivity.lociSelects.select(n),t],["clickToggle",n=>this.ctx.managers.interactivity.lociSelects.toggle(n),t],["clickToggleExtend",n=>this.ctx.managers.interactivity.lociSelects.toggleExtend(n),t],["clickSelectOnly",n=>this.ctx.managers.interactivity.lociSelects.selectOnly(n),t],["clickDeselect",n=>this.ctx.managers.interactivity.lociSelects.deselect(n),t],["clickDeselectAllOnEmpty",()=>this.ctx.managers.interactivity.lociSelects.deselectAll(),e]];r.sort((n,o)=>{let i=this.params.bindings[n[0]],s=this.params.bindings[o[0]],a=i.triggers.length===0?0:Da(i.triggers.map(c=>Ny.size(c.modifiers)));return(s.triggers.length===0?0:Da(s.triggers.map(c=>Ny.size(c.modifiers))))-a}),this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:n,button:o,modifiers:i})=>{if(!this.ctx.canvas3d||this.ctx.isBusy||!this.ctx.selectionMode)return;let s=this.getLoci(n.loci);if(!this.params.ignore.includes(s.kind)){for(let[a,l,c]of r)if(Mt.match(this.params.bindings[a],o,i)&&(!c||c(s))){l({repr:n.repr,loci:s});break}}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,({ref:n})=>this.applySelectMark(n)),this.subscribeObservable(this.ctx.state.events.object.updated,({ref:n,obj:o,oldObj:i,oldData:s,action:a})=>{let l=this.ctx.state.data.cells.get(n);if(l&&fe.Molecule.Structure.is(l.obj)){let c=o.data,u=a==="recreate"?i?.data:a==="in-place"?s:void 0;if(u&&qe.areEquivalent(c,u)&&qe.areHierarchiesEqual(c,u))return;let d=this.ctx.state.data.select(Kt.children(n).ofType(fe.Molecule.Structure.Representation3D));for(let m of d)this.applySelectMark(m.transform.ref,!0)}})}unregister(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)}constructor(e,t){super(e,t),this.lociMarkProvider=(r,n)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark({loci:r.loci},n)},this.spine=new N0.Impl(e.state.data.cells)}},params:()=>Lje,display:{name:"Select Loci on Canvas"}}),Nje=tr.create({name:"default-loci-label-provider",category:"interaction",ctor:class{register(){this.ctx.managers.lociLabels.addProvider(this.f)}unregister(){this.ctx.managers.lociLabels.removeProvider(this.f)}constructor(e){this.ctx=e,this.f={label:t=>{let r=[];if(ce.Loci.is(t)){let n=new Set;for(let{unit:o}of t.elements){let i=ce.Location.create(t.structure,o,o.elements[0]),s=nt.entity.pdbx_description(i).join(", ");n.add(s)}n.size===1&&n.forEach(o=>r.push(o))}return r.push(Mm(t)),r.filter(n=>!!n).join("</br>")},group:t=>t.toString().replace(/Model [0-9]+/g,"Models"),priority:100}}},display:{name:"Provide Default Loci Label"}}),Pme={clickFocus:Mt([n1(r1.Flag.Primary,Ny.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:Mt([n1(r1.Flag.Primary,Ny.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:Mt([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:Mt([],"Representation Focus Add","Click element using ${triggers}")},Fje={bindings:M.Value(Pme,{isHidden:!0})},o1=tr.create({name:"representation-focus-loci",category:"interaction",ctor:class extends tr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:r})=>{var n,o,i,s,a;let{clickFocus:l,clickFocusAdd:c,clickFocusSelectMode:u,clickFocusAddSelectMode:d}=this.params.bindings,m=this.ctx.selectionMode?u:l,p=Mt.match(m,t,r),h=(s=(i=(o=(n=e.repr)===null||n===void 0?void 0:n.props)===null||o===void 0?void 0:o.snapshotKey)===null||i===void 0?void 0:i.trim())!==null&&s!==void 0?s:"";if(!this.ctx.selectionMode&&p&&h){this.ctx.managers.snapshot.applyKey(h);return}let{granularity:f}=this.ctx.managers.interactivity.props;if(f!=="residue"&&f!=="element")return;let C=this.ctx.selectionMode?d:c,g=Mt.match(C,t,r);if(!p&&!g)return;let b=Xt.normalize(e.loci,"residue"),y=this.ctx.managers.structure.focus.current;if(y&&Xt.areEqual(y.loci,b))this.ctx.managers.structure.focus.clear();else if(p)this.ctx.managers.structure.focus.setFromLoci(b);else{this.ctx.managers.structure.focus.addFromLoci(b);let x=(a=this.ctx.managers.structure.focus.current)===null||a===void 0?void 0:a.loci;x&&this.ctx.managers.camera.focusLoci(x)}})}},params:()=>Fje,display:{name:"Representation Focus Loci on Canvas"}});var P9={};Ui(P9,{CameraAxisHelper:()=>Gje,CameraControls:()=>zje,DefaultClickResetCameraOnEmpty:()=>T9,DefaultClickResetCameraOnEmptySelectMode:()=>E9,DefaultFocusLociBindings:()=>Dme,FocusLoci:()=>Vje});var th=Vo,Yp=nl,rh=Mt.Trigger,Hk=Mt.TriggerKey,T9=Mt([rh(th.Flag.Primary,Yp.create()),rh(th.Flag.Secondary,Yp.create()),rh(th.Flag.Primary,Yp.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),E9=Mt([rh(th.Flag.Secondary,Yp.create()),rh(th.Flag.Primary,Yp.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),Dme={clickCenterFocus:Mt([rh(th.Flag.Primary,Yp.create()),rh(th.Flag.Secondary,Yp.create()),rh(th.Flag.Primary,Yp.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:Mt([rh(th.Flag.Secondary,Yp.create()),rh(th.Flag.Primary,Yp.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickResetCameraOnEmpty:T9,clickResetCameraOnEmptySelectMode:E9},Oje={minRadius:M.Numeric(8,{min:1,max:50,step:1}),extraRadius:M.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:M.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:M.Value(Dme,{isHidden:!0})},Vje=tr.create({name:"camera-focus-loci",category:"interaction",ctor:class extends tr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:r})=>{var n,o;if(!this.ctx.canvas3d)return;let i=this.ctx.selectionMode?this.params.bindings.clickCenterFocusSelectMode:this.params.bindings.clickCenterFocus,s=this.ctx.selectionMode?(n=this.params.bindings.clickResetCameraOnEmptySelectMode)!==null&&n!==void 0?n:E9:(o=this.params.bindings.clickResetCameraOnEmpty)!==null&&o!==void 0?o:T9;if(Xt.isEmpty(e.loci)&&Mt.match(s,t,r)){ht.Camera.Reset(this.ctx,{});return}if(Mt.match(i,t,r)){let a=Xt.normalize(e.loci,this.ctx.managers.interactivity.props.granularity);this.ctx.managers.camera.focusLoci(a,this.params)}})}},params:()=>Oje,display:{name:"Camera Focus Loci on Canvas"}}),Gje=tr.create({name:"camera-axis-helper",category:"interaction",ctor:class extends tr.Handler{register(){let e=ro.None,t=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:r})=>{if(!this.ctx.canvas3d||!Bk(r.loci))return;let n=r.loci.elements[0].groupId;if(n===ro.None){e=ro.None,t=0;return}let{camera:o}=this.ctx.canvas3d,i,s;if(n>=ro.X&&n<=ro.Z){e=ro.None,t=0;let a=D.sub(D(),o.target,o.position),l=D.cross(D(),a,o.up);s=D(),s[n-1]=1,i=D.cross(D(),s,l),D.magnitude(i)===0&&(i=a)}else e===n?t=(t+1)%2:(e=n,t=0),n===ro.XY?(s=t?D.unitX:D.unitY,i=D.negUnitZ):n===ro.XZ?(s=t?D.unitX:D.unitZ,i=D.negUnitY):(s=t?D.unitY:D.unitZ,i=D.negUnitX);this.ctx.canvas3d.requestCameraReset({snapshot:(a,l)=>l.getInvariantFocus(a.boundingSphereVisible.center,a.boundingSphereVisible.radius,s,i)})})}},params:()=>({}),display:{name:"Camera Axis Helper"}}),kme={keySpinAnimation:Mt([Hk("I")],"Spin Animation","Press ${triggers}"),keyRockAnimation:Mt([Hk("O")],"Rock Animation","Press ${triggers}"),keyToggleFlyMode:Mt([Hk("Space",Yp.create({shift:!0}))],"Toggle Fly Mode","Press ${triggers}"),keyResetView:Mt([Hk("T")],"Reset View","Press ${triggers}")},Uje={bindings:M.Value(kme,{isHidden:!0})},zje=tr.create({name:"camera-controls",category:"interaction",ctor:class extends tr.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.key,({code:e,key:t,modifiers:r})=>{var n;if(!this.ctx.canvas3d)return;let o={...kme,...this.params.bindings},i=this.ctx.canvas3d.props.trackball;if(Mt.matchKey(o.keySpinAnimation,e,r,t)){let s=i.animate.name!=="spin"?"spin":"off";s==="off"?this.ctx.canvas3d.setProps({trackball:{animate:{name:s,params:{}}}}):this.ctx.canvas3d.setProps({trackball:{animate:{name:s,params:{speed:1}}}})}if(Mt.matchKey(o.keyRockAnimation,e,r,t)){let s=i.animate.name!=="rock"?"rock":"off";s==="off"?this.ctx.canvas3d.setProps({trackball:{animate:{name:s,params:{}}}}):this.ctx.canvas3d.setProps({trackball:{animate:{name:s,params:{speed:.3,angle:10}}}})}if(Mt.matchKey(o.keyToggleFlyMode,e,r,t)){let s=!i.flyMode;this.ctx.canvas3d.setProps({trackball:{flyMode:s}}),!((n=this.ctx.canvas3dContext)===null||n===void 0)&&n.canvas&&(this.ctx.canvas3dContext.canvas.style.cursor=s?"crosshair":"unset")}Mt.matchKey(o.keyResetView,e,r,t)&&ht.Camera.Reset(this.ctx,{})})}},params:()=>Uje,display:{name:"Camera Controls on Canvas"}});var pz={};Ui(pz,{AccessibleSurfaceArea:()=>Ume,BestDatabaseSequenceMapping:()=>_fe,CrossLinkRestraint:()=>Bfe,Interactions:()=>Cfe,SecondaryStructure:()=>Sfe,StructureInfo:()=>Mme,ValenceModel:()=>Ife});var Mme=tr.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:class extends tr.Handler{get maxModelIndex(){var e,t;let r=-1,n=this.ctx.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Model));for(let o of n){let i=((e=o.obj)===null||e===void 0?void 0:e.data)&&Ut.Index.get((t=o.obj)===null||t===void 0?void 0:t.data).value;i!==void 0&&i>r&&(r=i)}return r}get maxStructureIndex(){var e,t;let r=-1,n=this.ctx.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Structure));for(let o of n){let i=((e=o.obj)===null||e===void 0?void 0:e.data)&&qe.Index.get((t=o.obj)===null||t===void 0?void 0:t.data).value;i!==void 0&&i>r&&(r=i)}return r}get asymIdOffset(){var e;let t=0,r=0,n=this.ctx.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Model));for(let o of n){let i=(e=o.obj)===null||e===void 0?void 0:e.data;if(i){let s=Ut.AsymIdCount.get(i),a=Ut.AsymIdOffset.get(i).value;s!==void 0&&a!==void 0&&(t=Math.max(t,a.auth+s.auth),r=Math.max(r,a.label+s.label))}}return{auth:t,label:r}}setModelMaxIndex(){var e;let t=this.maxModelIndex,r=this.ctx.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Model));for(let n of r){let o=(e=n.obj)===null||e===void 0?void 0:e.data;o&&Ut.MaxIndex.get(o).value!==t&&Ut.MaxIndex.set(o,{value:t},t)}}setStructureMaxIndex(){var e;let t=this.maxModelIndex,r=this.ctx.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Structure));for(let n of r){let o=(e=n.obj)===null||e===void 0?void 0:e.data;o&&qe.MaxIndex.get(o).value!==t&&qe.MaxIndex.set(o,{value:t},t)}}handleModel(e,t){if(Ut.Index.get(e).value===void 0){let r=t&&Ut.Index.get(t).value,n=r??this.maxModelIndex+1;Ut.Index.set(e,{value:n},n)}if(Ut.AsymIdOffset.get(e).value===void 0){let r=t&&Ut.AsymIdOffset.get(t).value,n=r??{...this.asymIdOffset};Ut.AsymIdOffset.set(e,{value:n},n)}}handleStructure(e,t){if(e.parent!==void 0||qe.Index.get(e).value!==void 0)return;let r=t&&qe.Index.get(t).value,n=r??this.maxStructureIndex+1;qe.Index.set(e,{value:n},n)}handle(e,t,r){fe.Molecule.Structure.is(t)?!this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator&&t.data.parent===void 0&&this.handleStructure(t.data,r?.data):fe.Molecule.Model.is(t)&&(this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator||this.handleModel(t.data,r?.data))}register(){this.ctx.customModelProperties.register(Ut.AsymIdOffset,!0),this.ctx.customModelProperties.register(Ut.Index,!0),this.ctx.customModelProperties.register(Ut.MaxIndex,!0),this.ctx.customStructureProperties.register(qe.Index,!0),this.ctx.customStructureProperties.register(qe.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,e=>{this.handle(e.ref,e.obj),this.setModelMaxIndex(),this.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,e=>{this.handle(e.ref,e.obj,e.oldObj)})}unregister(){this.ctx.customModelProperties.unregister(Ut.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(Ut.Index.descriptor.name),this.ctx.customModelProperties.unregister(Ut.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(qe.Index.descriptor.name),this.ctx.customStructureProperties.unregister(qe.MaxIndex.descriptor.name)}}});var Qp=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],jk={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165},Rme=121;function Bme(e){let{key:t}=nt.residue,{type_symbol:r,label_atom_id:n,label_comp_id:o}=nt.atom,{structure:i,atomRadiusType:s,serialResidueIndex:a}=e,l=ce.Location.create(i),c=0,u=0,d=-1;l.structure=i;for(let m=0,p=0,h=i.units.length;m<h;++m){let f=i.units[m],{elements:C}=f;l.unit=f,c=-1;for(let g=0,b=C.length;g<b;++g){let y=C[g],x=p+g;l.element=y,u=t(l),c!==u&&++d,c=u;let A=r(l),v=Uu(A);if(Cm(v)){s[x]=0,a[x]=-1;continue}let _=n(l),I=CC(f,y);if(I===2||!e.nonPolymer&&!K0(I)){s[x]=0,a[x]=-1;continue}let T=o(l);if(e.traceOnly&&(_!=="CA"&&_!=="BB"||!jk[T])){s[x]=0,a[x]=d;continue}Wi(I)?s[x]=jje(_,A,T):I===5?s[x]=Hje(_,A,T):s[x]=D9(A),a[x]=d}p+=C.length}}function Hje(e,t,r){switch(t){case"O":return 5;case"S":return 6;case"N":return e==="NZ"?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(r){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return e==="CD"?1:2}}}return D9(t)}function jje(e,t,r){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return D9(t)}function D9(e){let t=qf(e),r=Qp.indexOf(t);return r===-1&&(r=Qp.length,Qp[r]=t),r}var Lme=5e3;async function Nme(e,t){let{atomRadiusType:r}=t;for(let n=0;n<r.length;n+=Lme)e.shouldUpdate&&await e.update({message:"Computing per residue surface accessibility...",current:n,max:r.length}),$je(t,n,Math.min(n+Lme,r.length))}function $je(e,t,r){let{structure:n,atomRadiusType:o,serialResidueIndex:i,area:s,spherePoints:a,scalingConstant:l,maxLookupRadius:c,probeSize:u}=e,{lookup3d:d,serialMapping:m,unitIndexMap:p,units:h}=n,{cumulativeUnitElementCount:f,elementIndices:C,unitIndices:g}=m;for(let b=t;b<r;++b){let y=Qp[o[b]];if(y===Qp[0])continue;let x=h[g[b]],A=C[b],v=x.conformation.x(A),_=x.conformation.y(A),I=x.conformation.z(A),{count:T,units:E,indices:w,squaredDistances:S}=d.find(v,_,I,c),P=u+y,k=u+P,L=[];for(let N=0;N<T;++N){let F=E[N],H=f[p.get(F.id)]+w[N],V=C[H],q=Qp[o[H]];if(x===F&&A===V||q===Qp[0])continue;let Q=u+q;if(S[N]<(k+q)*(k+q)){let O=C[H];L[L.length]=[S[N],(S[N]+P*P-Q*Q)/(2*P),F.conformation.x(O)-v,F.conformation.y(O)-_,F.conformation.z(O)-I]}}L.sort((N,F)=>N[0]-F[0]);let R=0;e:for(let N=0;N<a.length;++N){let[F,H,V]=a[N];for(let q=0;q<L.length;++q){let[,Q,O,B,j]=L[q];if(F*O+H*B+V*j>Q)continue e}++R}s[i[b]]+=l*R*P*P}}var k9={numberOfSpherePoints:M.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:M.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:M.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:M.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})};var Fy;(function(e){function t(c,u={}){let d={...M.getDefaultValues(k9),...u};return ke.create("Compute Accessible Surface Area",async m=>await r(m,c,d))}e.compute=t;async function r(c,u,d){let m=n(u,d);Bme(m),await Nme(c,m);let{area:p,serialResidueIndex:h}=m;return{area:p,serialResidueIndex:h}}function n(c,u){let{elementCount:d,atomicResidueCount:m}=c,{probeSize:p,nonPolymer:h,traceOnly:f,numberOfSpherePoints:C}=u;return{structure:c,probeSize:p,nonPolymer:h,traceOnly:f,spherePoints:o(C),scalingConstant:4*Math.PI/C,maxLookupRadius:2*u.probeSize+2*Qp[2],atomRadiusType:new Int8Array(d),serialResidueIndex:new Int32Array(d),area:new Float32Array(m)}}function o(c){let u=[],d=Math.PI*(3-Math.sqrt(5)),m=2/c;for(let p=0;p<c;++p){let h=p*m-1+m/2,f=Math.sqrt(1-h*h),C=p*d;u[u.length]=D.create(Math.cos(C)*f,h,Math.sin(C)*f)}return u}e.Flag={NA:0,Buried:1,Accessible:2};function i(c,u){let d=jk[c]||Rme;return u/d}e.normalize=i;function s(c,u){let{area:d,serialResidueIndex:m}=u,p=m[Qe.indexOf(Qe.ofSortedArray(c.structure.root.serialMapping.elementIndices),c.element)];return p===-1?-1:d[p]}e.getValue=s;function a(c,u){let d=s(c,u);return d===-1?-1:i(nt.atom.label_comp_id(c),d)}e.getNormalizedValue=a;function l(c,u){let d=a(c,u);return d===-1?0:d<.16?1:2}e.getFlag=l})(Fy||(Fy={}));var M9={...k9},$k={isBuried:lu.Dynamic(Hf("computed","accessible-surface-area.is-buried",He.Bool),e=>{if(!Le.isAtomic(e.element.unit))return!1;let t=Qu.get(e.element.structure).value;return t?Fy.getFlag(e.element,t)===1:!1}),isAccessible:lu.Dynamic(Hf("computed","accessible-surface-area.is-accessible",He.Bool),e=>{if(!Le.isAtomic(e.element.unit))return!1;let t=Qu.get(e.element.structure).value;return t?Fy.getFlag(e.element,t)===2:!1})},Qu=iu.createProvider({label:"Accessible Surface Area",descriptor:Ci({name:"molstar_accessible_surface_area",symbols:$k}),type:"root",defaultParams:M9,getParams:e=>M9,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...M.getDefaultValues(M9),...r};return{value:await Fy.compute(t,n).runInContext(e.runtime)}}});var R9=ze(16448250),Wje="Assigns a color based on the relative accessible surface area of a residue.",Fme={list:M.ColorList("rainbow",{presetKind:"scale"})};function qje(e){return Fme}function Ome(e,t){let r,n=ns.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),o=e.structure&&Qu.get(e.structure),i=o?wu(o.id,o.version):-1;if(o?.value&&e.structure){let s=ce.Location.create(e.structure),a=o.value,l=c=>{let u=Fy.getNormalizedValue(c,a);return u===-1?R9:n.color(u)};r=c=>ce.Location.is(c)&&Le.isAtomic(c.unit)?l(c):_t.isLocation(c)?(s.unit=c.aUnit,s.element=c.aUnit.elements[c.aIndex],l(s)):R9}else r=()=>R9;return{factory:Ome,granularity:"group",preferSmoothing:!0,color:r,props:t,contextHash:i,description:Wje,legend:n?n.legend:void 0}}var B9={name:"accessible-surface-area",label:"Accessible Surface Area",category:oi.Category.Residue,factory:Ome,getParams:qje,defaultValues:M.getDefaultValues(Fme),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?Qu.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&Qu.ref(e.structure,!1)}};var Ume=tr.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:class extends tr.Handler{constructor(){super(...arguments),this.provider=Qu,this.labelProvider={label:e=>{if(this.params.showTooltip)return Zje(e)}}}update(e){let t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){_m.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(B9),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(Vme),this.ctx.query.structure.registry.add(Gme)}unregister(){_m.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(B9),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(Vme),this.ctx.query.structure.registry.remove(Gme)}},params:()=>({autoAttach:M.Boolean(!1),showTooltip:M.Boolean(!0)})});function Zje(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;let t=Qu.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Qu.descriptor))return;let{getSerialIndex:r}=e.structure.root.serialMapping,{area:n,serialResidueIndex:o}=t,i=new Set,s=0;for(let{indices:l,unit:c}of e.elements){let{elements:u}=c;Ge.forEach(l,d=>{let m=o[r(c,u[d])];m!==-1&&!i.has(m)&&(s+=n[m],i.add(m))})}return i.size===0?void 0:`Accessible Surface Area ${`<small>(${i.size} ${i.size>1?"Residues sum":"Residue"})</small>`}: ${s.toFixed(2)} \u212B<sup>2</sup>`}else if(e.kind==="structure-loci"){let t=Qu.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Qu.descriptor)?void 0:`Accessible Surface Area <small>(Whole Structure)</small>: ${C4(t.area).toFixed(2)} \u212B<sup>2</sup>`}}var Vme=Nn("Buried Protein Residues",ye.struct.modifier.union([ye.struct.modifier.wholeResidues([ye.struct.modifier.union([ye.struct.generator.atomGroups({"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":$k.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:Ln.Residue,ensureCustomProperties:(e,t)=>Qu.attach(e,t)}),Gme=Nn("Accessible Protein Residues",ye.struct.modifier.union([ye.struct.modifier.wholeResidues([ye.struct.modifier.union([ye.struct.generator.atomGroups({"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":$k.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:Ln.Residue,ensureCustomProperties:(e,t)=>Qu.attach(e,t)});function tn(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function Wk(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function Oy(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function _w(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function Tw(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function Kje(e,t,r){let n=0,o=e.interUnitBonds.getEdgeIndices(r,t.id);for(let i=0,s=o.length;i<s;++i){let a=e.interUnitBonds.edges[o[i]];Br.isCovalent(a.props.flag)&&(n+=1)}return n}function Xje(e,t){let r=0,{offset:n,edgeProps:{flags:o}}=e.bonds;for(let i=n[t],s=n[t+1];i<s;++i)Br.isCovalent(o[i])&&(r+=1);return r}function Ju(e,t,r){return Kje(e,t,r)+Xje(t,r)}function Fl(e,t,r,n){let o=0;return ba(e,t,r,(i,s)=>{tn(i,s)===n&&(o+=1)}),o}function Yje(e,t,r){let{offset:n,b:o,edgeProps:{flags:i}}=e.bonds;Br.is;for(let s=n[t],a=n[t+1];s<a;++s)if(o[s]===r&&Br.isCovalent(i[s]))return!0;return!1}function Qje(e,t,r,n,o){let i=e.interUnitBonds.getEdge(r,t.id,o,n.id);return i&&Br.isCovalent(i.props.flag)}function zme(e,t,r,n,o){return t===n?Yje(t,r,o):Qje(e,t,r,n,o)}function Jje(e,t,r,n){let o=e.interUnitBonds.getEdgeIndices(r,t.id);for(let i=0,s=o.length;i<s;++i){let a=e.interUnitBonds.edges[o[i]],l=e.unitMap.get(a.unitB);Br.isCovalent(a.props.flag)&&n(l,a.indexB)}}function qk(e,t,r){let{offset:n,b:o,edgeProps:{flags:i}}=e.bonds;for(let s=n[t],a=n[t+1];s<a;++s)Br.isCovalent(i[s])&&r(e,o[s])}function ba(e,t,r,n){Jje(e,t,r,n),qk(t,r,n)}var ai;(function(e){e[e.Spherical=0]="Spherical",e[e.Terminal=1]="Terminal",e[e.Linear=2]="Linear",e[e.Trigonal=3]="Trigonal",e[e.Tetrahedral=4]="Tetrahedral",e[e.TrigonalBiPyramidal=5]="TrigonalBiPyramidal",e[e.Octahedral=6]="Octahedral",e[e.SquarePlanar=7]="SquarePlanar",e[e.Unknown=8]="Unknown"})(ai||(ai={}));function Hme(e){switch(e){case ai.Spherical:return"Spherical";case ai.Terminal:return"Terminal";case ai.Linear:return"Linear";case ai.Trigonal:return"Trigonal";case ai.Tetrahedral:return"Tetrahedral";case ai.TrigonalBiPyramidal:return"Trigonal Bi-Pyramidal";case ai.Octahedral:return"Octahedral";case ai.SquarePlanar:return"Square Planar";case ai.Unknown:return"Unknown"}}function s1(e){switch(e){case 0:return ai.Spherical;case 1:return ai.Terminal;case 2:return ai.Linear;case 3:return ai.Trigonal;case 4:return ai.Tetrahedral;default:return ai.Unknown}}var L9=new Map([[ai.Linear,Pr(180)],[ai.Trigonal,Pr(120)],[ai.Tetrahedral,Pr(109.4721)],[ai.Octahedral,Pr(90)]]),Zk=D(),Kk=D(),i1=D(),Xk=D(),cS=D();function uS(e,t,r,n,o){let i=[];return t.conformation.position(t.elements[r],i1),n.conformation.position(n.elements[o],Xk),D.sub(Zk,Xk,i1),ba(e,t,r,(s,a)=>{tn(s,a)!=="H"&&(s.conformation.position(s.elements[a],cS),D.sub(Kk,cS,i1),i.push(D.angle(Zk,Kk)))}),i}function N9(e,t,r,n,o){t.conformation.position(t.elements[r],i1),n.conformation.position(n.elements[o],Xk),D.sub(Zk,Xk,i1);let i=[D(),D()],s=0,a,l;if(ba(e,t,r,(c,u)=>{s>1||tn(c,u)!=="H"&&(a=c,l=u,c.conformation.position(c.elements[u],cS),D.sub(i[s++],cS,i1))}),s===1&&a&&l&&ba(e,a,l,(c,u)=>{s>1||c===t&&u===r||tn(c,u)!=="H"&&(c.conformation.position(c.elements[u],cS),D.sub(i[s++],cS,i1))}),s===2)return D.cross(Kk,i[0],i[1]),Math.abs(Math.PI/2-D.angle(Kk,Zk))}var F9=new _t.ElementBondIterator,O9=new _t.ElementBondIterator;function e8e(e,t,r){let n=tn(t,r),o=n==="O"||n==="N";if(o&&Ju(e,t,r)===4)return!1;for(F9.setElement(e,t,r);F9.hasNext;){let i=F9.move();if(i.order>1)return!0;if(o){let s=tn(i.otherUnit,i.otherIndex);for(O9.setElement(e,i.otherUnit,i.otherIndex);O9.hasNext;){let a=O9.move();if(a.order>1){if((s==="P"||s==="S")&&tn(a.otherUnit,a.otherIndex)==="O")continue;return!0}}}}return!1}function t8e(e,t,r){let n=0,{offset:o,edgeProps:{flags:i,order:s}}=t.bonds;for(let a=o[r],l=o[r+1];a<l;++a)Br.isCovalent(i[a])&&(n+=s[a]);return e.interUnitBonds.getEdgeIndices(r,t.id).forEach(a=>{let l=e.interUnitBonds.edges[a];Br.isCovalent(l.props.flag)&&(n+=l.props.order)}),n}var dS=new _t.ElementBondIterator,V9=new _t.ElementBondIterator;function r8e(e,t,r,n){let o=Fl(e,t,r,"H"),i=tn(t,r),s=Wk(t,r),a=n.assignCharge==="always"||n.assignCharge==="auto"&&s===0,l=n.assignH==="always"||n.assignH==="auto"&&o===0,c=Ju(e,t,r),u=t8e(e,t,r),d=e8e(e,t,r),m=u-c>0,p=0,h=ai.Unknown;switch(i){case"H":a&&(c===0?(s=1,h=ai.Spherical):c===1&&(s=0,h=ai.Terminal));break;case"C":a&&(s=0),l&&(p=Math.max(0,4-u-Math.abs(s))),h=s1(c+p+Math.max(0,-s));break;case"N":if(a)if(!l)s=u-3;else if(d&&u<4)c-o===1&&u-o===2?s=1:s=0;else for(dS.setElement(e,t,r);dS.hasNext;){let f=dS.move(),C=tn(f.otherUnit,f.otherIndex);if(C==="S"||Use(C)){s=0;break}else s=1}l&&(p=Math.max(0,3-u+s)),d&&!m?h=s1(c+p-s):h=s1(c+p+1-s);break;case"O":if(a&&(l||(s=u-2),u===1)){dS.setElement(e,t,r);e:for(;dS.hasNext;){let f=dS.move();for(V9.setElement(e,f.otherUnit,f.otherIndex);V9.hasNext;){let C=V9.move();if(!(C.otherUnit===t&&C.otherIndex===r)&&tn(C.otherUnit,C.otherIndex)==="O"&&C.order===2){s=-1;break e}}}}l&&(p=Math.max(0,2-u+s)),d&&!m?h=s1(c+p-s+1):h=s1(c+p-s+2);break;case"S":a&&(l||(u<=3&&Fl(e,t,r,"O")===0?s=u-2:s=0)),l&&u<2&&(p=Math.max(0,2-u+s)),u<=3&&(h=s1(c+p-s+2));break;case"F":case"CL":case"BR":case"I":case"AT":a&&(s=u-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":a&&(s=1-u);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":a&&(s=2-u);break;default:}return[s,p,p+o,h]}function n8e(e,t,r){let n=t.elements.length,o=new Int8Array(n),i=new Int8Array(n),s=new Int8Array(n),a=new Int8Array(n),l=!!e.parent,c;if(l){let u=e.root.unitMap.get(t.id);if(c=Qe.indicesOf(u.elements,t.elements),c.length!==t.elements.length)throw new Error("expected to find an index for every element");t=u,e=e.root}for(let u=0;u<n;++u){let d=l?c[u]:u,[m,p,h,f]=r8e(e,t,d,r);o[u]=m,i[u]=p,s[u]=h,a[u]=f}return{charge:o,implicitH:i,totalH:s,idealGeometry:a}}var G9={assignCharge:M.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:M.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};async function jme(e,t,r){let n={...M.getDefaultValues(G9),...r},o=new Map;for(let i=0,s=t.units.length;i<s;++i){let a=t.units[i];if(Le.isAtomic(a)){let l=n8e(t,a,n);o.set(a.id,l)}}return o}var U9={...G9},nh=iu.createProvider({label:"Valence Model",descriptor:Ci({name:"molstar_computed_valence_model"}),type:"local",defaultParams:U9,getParams:e=>U9,isApplicable:e=>!0,obtain:async(e,t,r)=>{let n={...M.getDefaultValues(U9),...r};return{value:await jme(e.runtime,t,n)}}});var bo;(function(e){function t(d,m,p,h){return D.set(d,h.x[p],h.y[p],h.z[p]),D.transformMat4(d,d,m.conformation.operator.matrix),d}e.setPosition=t;function r(d,m){let p=new Int32Array(m+1),h=new Int32Array(m),f=new Int32Array(m),{members:C,count:g,offsets:b}=d;for(let A=0,v=b[g];A<v;++A)++f[C[A]];let y=0;for(let A=0;A<m;A++)p[A]=y,y+=f[A];p[m]=y;let x=new Int32Array(y);for(let A=0;A<g;++A)for(let v=b[A],_=b[A+1];v<_;++v){let I=C[v],T=p[I]+h[I];x[T]=A,++h[I]}return{indices:x,offsets:p}}e.createElementsIndex=r;function n(d,m){let p,h;return{...m,get lookup3d(){if(!p){let f={x:m.x,y:m.y,z:m.z,indices:Ge.ofBounds(0,m.count)};p=Ma(f,Ec(f))}return p},get elementsIndex(){return h||(h=r(m,d))},subset:f=>o(m,f)}}e.create=n;function o(d,m){let p,{count:h,types:f}=d,C=[];for(let b=0;b<h;++b)m.has(f[b])&&C.push(b);let g=Qe.ofSortedArray(C);return{indices:g,get lookup3d(){if(!p){let b={x:d.x,y:d.y,z:d.z,indices:g};p=Ma(b,Ec(b))}return p}}}e.createSubset=o;function i(d,m,p){let h=nh.get(d).value;if(!h||!h.has(m.id))throw new Error("valence model required");return{unit:m,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:h.get(m.id).idealGeometry}}e.Info=i;function s(d,m){return D.set(d,m.x[m.feature],m.y[m.feature],m.z[m.feature]),D.transformMat4(d,d,m.unit.conformation.operator.matrix),d}e.position=s;let a=D(),l=D();function c(d,m){let p=d.members[d.offsets[d.feature]],h=m.members[m.offsets[m.feature]];return d.unit.conformation.position(d.unit.elements[p],a),m.unit.conformation.position(m.unit.elements[h],l),D.distance(a,l)}e.distance=c;function u(d,m){return{types:new Set(d),add:m}}e.Provider=u})(bo||(bo={}));var Yk;(function(e){function t(r=2048,n=1024,o){let i=it.create(Float32Array,1,n,o?o.x:r),s=it.create(Float32Array,1,n,o?o.y:r),a=it.create(Float32Array,1,n,o?o.z:r),l=it.create(Uint8Array,1,n,o?o.types:r),c=it.create(Uint8Array,1,n,o?o.groups:r),u=it.create(Uint32Array,1,n,o?o.offsets:r),d=it.create(Uint32Array,1,n,o?o.members:r),m={x:0,y:0,z:0,offset:0,count:0};return{startState:()=>{m.x=0,m.y=0,m.z=0,m.offset=d.elementCount,m.count=0},pushMember:(p,h,f,C)=>{it.add(d,C),m.x+=p,m.y+=h,m.z+=f,m.count+=1},finishState:(p,h)=>{let{count:f}=m;f!==0&&(it.add(l,p),it.add(c,h),it.add(i,m.x/f),it.add(s,m.y/f),it.add(a,m.z/f),it.add(u,m.offset))},add:(p,h,f,C,g,b)=>{it.add(l,p),it.add(c,h),it.add(i,f),it.add(s,C),it.add(a,g),it.add(u,d.elementCount),it.add(d,b)},getFeatures:p=>{it.add(u,d.elementCount);let h=it.compact(i,!0),f=it.compact(s,!0),C=it.compact(a,!0),g=i.elementCount;return bo.create(p,{x:h,y:f,z:C,count:g,types:it.compact(l,!0),groups:it.compact(c,!0),offsets:it.compact(u,!0),members:it.compact(d,!0)})}}}e.create=t})(Yk||(Yk={}));var Qk;(function(e){function t(r,n,o){let i=new Int32Array(o+1),s=new Int32Array(o),a=new Int32Array(o),{members:l,offsets:c}=n;for(let m=0,p=r.edgeCount*2;m<p;++m){let h=r.a[m],f=r.b[m];if(!(h>f)){for(let C=c[h],g=c[h+1];C<g;++C)++a[l[C]];for(let C=c[f],g=c[f+1];C<g;++C)++a[l[C]]}}let u=0;for(let m=0;m<o;m++)i[m]=u,u+=a[m];i[o]=u;let d=new Int32Array(u);for(let m=0,p=r.edgeCount*2;m<p;++m){let h=r.a[m],f=r.b[m];if(!(h>f)){for(let C=c[h],g=c[h+1];C<g;++C){let b=l[C],y=i[b]+s[b];d[y]=m,++s[b]}for(let C=c[f],g=c[f+1];C<g;++C){let b=l[C],y=i[b]+s[b];d[y]=m,++s[b]}}}return{indices:d,offsets:i}}e.createElementsIndex=t})(Qk||(Qk={}));var Jk=class extends Ed{getContactIndicesForElement(t,r){return this.elementKeyIndex.get(this.getElementKey(t,r.id))||[]}getElementKey(t,r){return`${t}|${r}`}constructor(t,r){super(t),this.elementKeyIndex=new Map;for(let n=0,o=this.edges.length;n<o;++n){let{unitA:i,indexA:s}=this.edges[n],{offsets:a,members:l}=r.get(i);for(let c=a[s],u=a[s+1];c<u;++c){let d=this.getElementKey(l[c],i),m=this.elementKeyIndex.get(d);m===void 0?this.elementKeyIndex.set(d,[n]):m.push(n)}}}},cu;(function(e){e[e.None=0]="None",e[e.Filtered=1]="Filtered"})(cu||(cu={}));var Or;(function(e){e[e.Unknown=0]="Unknown",e[e.Ionic=1]="Ionic",e[e.CationPi=2]="CationPi",e[e.PiStacking=3]="PiStacking",e[e.HydrogenBond=4]="HydrogenBond",e[e.HalogenBond=5]="HalogenBond",e[e.Hydrophobic=6]="Hydrophobic",e[e.MetalCoordination=7]="MetalCoordination",e[e.WeakHydrogenBond=8]="WeakHydrogenBond"})(Or||(Or={}));function z9(e){switch(e){case Or.HydrogenBond:return"Hydrogen Bond";case Or.Hydrophobic:return"Hydrophobic Contact";case Or.HalogenBond:return"Halogen Bond";case Or.Ionic:return"Ionic Interaction";case Or.MetalCoordination:return"Metal Coordination";case Or.CationPi:return"Cation-Pi Interaction";case Or.PiStacking:return"Pi Stacking";case Or.WeakHydrogenBond:return"Weak Hydrogen Bond";case Or.Unknown:return"Unknown Interaction"}}var $me;(function(e){e[e.None=0]="None",e[e.PositiveCharge=1]="PositiveCharge",e[e.NegativeCharge=2]="NegativeCharge",e[e.AromaticRing=3]="AromaticRing",e[e.HydrogenDonor=4]="HydrogenDonor",e[e.HydrogenAcceptor=5]="HydrogenAcceptor",e[e.HalogenDonor=6]="HalogenDonor",e[e.HalogenAcceptor=7]="HalogenAcceptor",e[e.HydrophobicAtom=8]="HydrophobicAtom",e[e.WeakHydrogenDonor=9]="WeakHydrogenDonor",e[e.IonicTypePartner=10]="IonicTypePartner",e[e.DativeBondPartner=11]="DativeBondPartner",e[e.TransitionMetal=12]="TransitionMetal",e[e.IonicTypeMetal=13]="IonicTypeMetal"})($me||($me={}));function Wme(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}var Gn;(function(e){e[e.None=0]="None",e[e.QuaternaryAmine=1]="QuaternaryAmine",e[e.TertiaryAmine=2]="TertiaryAmine",e[e.Sulfonium=3]="Sulfonium",e[e.SulfonicAcid=4]="SulfonicAcid",e[e.Sulfate=5]="Sulfate",e[e.Phosphate=6]="Phosphate",e[e.Halocarbon=7]="Halocarbon",e[e.Guanidine=8]="Guanidine",e[e.Acetamidine=9]="Acetamidine",e[e.Carboxylate=10]="Carboxylate"})(Gn||(Gn={}));function qme(e){switch(e){case Gn.None:return"None";case Gn.QuaternaryAmine:return"Quaternary Amine";case Gn.TertiaryAmine:return"Tertiary Amine";case Gn.Sulfonium:return"Sulfonium";case Gn.SulfonicAcid:return"Sulfonic Acid";case Gn.Sulfate:return"Sulfate";case Gn.Phosphate:return"Phosphate";case Gn.Halocarbon:return"Halocarbon";case Gn.Guanidine:return"Guanidine";case Gn.Acetamidine:return"Acetamidine";case Gn.Carboxylate:return"Carboxylate"}}var eM;(function(e){function t(r,n){let o=[],i=[],s=[];return{add(a,l,c){o[o.length]=a,i[i.length]=l,s[s.length]=c},getContacts(){let a=new Fs.EdgeBuilder(r.count,o,i),l=new Int8Array(a.slotCount),c=new Int8Array(a.slotCount);for(let p=0,h=a.edgeCount;p<h;p++)a.addNextEdge(),a.assignProperty(l,s[p]);let u=a.createGraph({type:l,flag:c}),d;return Object.defineProperty(u,"elementsIndex",{get:()=>d||(d=Qk.createElementsIndex(u,r,n))})}}}e.create=t})(eM||(eM={}));var tM;(function(e){function t(){let r=new Ed.Builder;return{startUnitPair(n,o){r.startUnitPair(n.id,o.id)},finishUnitPair(){r.finishUnitPair()},add(n,o,i){r.add(n,o,{type:i,flag:cu.None})},getContacts(n){return new Jk(r.getMap(),n)}}}e.create=t})(tM||(tM={}));var Xme={lineOfSightDistFactor:M.Numeric(1,{min:0,max:3,step:.1})},o8e=3;function Yme(e,t,r){let n=t.members[t.offsets[t.feature]],o=r.members[r.offsets[r.feature]];if(n===o&&t.unit===r.unit)return!1;let i=_w(t.unit,n),s=_w(r.unit,o);return!(i&&s&&i!==s||t.unit===r.unit&&t.unit.model.atomicHierarchy.residueAtomSegments.count>1&&t.unit.residueIndex[t.unit.elements[n]]===r.unit.residueIndex[r.unit.elements[o]]||zme(e,t.unit,n,r.unit,o))}function Zme(e,t,r,n){let o=_w(e,t),i=_w(r,n);return o&&i&&o!==i}function Kme(e,t){let{feature:r,offsets:n,members:o}=t;for(let i=n[r],s=n[r+1];i<s;++i)if(o[i]===e)return!0;return!1}var Vy=D(),H9=D(),j9=D(),i8e=FV();function Qme(e,t,r,n){let o=t.feature,i=r.feature,s=t.members[t.offsets[o]],a=r.members[r.offsets[i]];bo.position(H9,t),bo.position(j9,r),D.scale(Vy,D.add(Vy,H9,j9),.5);let l=n*o8e,{count:c,indices:u,units:d,squaredDistances:m}=e.lookup3d.find(Vy[0],Vy[1],Vy[2],l,i8e);if(c===0)return!0;for(let p=0;p<c;++p){let h=u[p],f=d[p];if(!Le.isAtomic(f))continue;let C=tn(f,h);if(C==="H")continue;let g=qf(C);if(!(g*g*n*n<=m[p])&&!(Zme(f,h,t.unit,s)||Zme(f,h,r.unit,a))&&!(t.unit===f&&Kme(h,t)||r.unit===f&&Kme(h,r))&&(f.conformation.position(f.elements[h],Vy),!(D.squaredDistance(Vy,H9)<1||D.squaredDistance(Vy,j9)<1)))return!1}return!0}function Jme(e,t,r,n,o,i){for(let s of o)s8e(e,t,r,n,s,i)}function s8e(e,t,r,n,o,i){let{x:s,y:a,z:l}=r,{lookup3d:c,indices:u}=r.subset(o.requiredFeatures),d=bo.Info(e,t,r),m={...d},p=i.lineOfSightDistFactor;for(let h=0,f=Ge.size(u);h<f;++h){let C=Ge.getAt(u,h),{count:g,indices:b,squaredDistances:y}=c.find(s[C],a[C],l[C],o.maxDistance);if(g!==0){d.feature=C;for(let x=0;x<g;++x){let A=Ge.getAt(u,b[x]);if(A<=C||(m.feature=A,!Yme(e,d,m)))continue;let v=o.getType(e,d,m,y[x]);v&&Qme(e,d,m,p)&&n.add(C,A,v)}}}}var a8e=de();function epe(e,t,r,n,o,i,s,a){let{count:l,x:c,y:u,z:d}=r,{lookup3d:m}=o,p=de.mul(a8e,n.conformation.operator.inverse,t.conformation.operator.matrix),h=!de.isIdentity(p),f=D(),C=Math.max(...s.map(_=>_.maxDistance)),{center:g,radius:b}=m.boundary.sphere,y=(b+C)*(b+C),x=a.lineOfSightDistFactor,A=bo.Info(e,t,r),v=bo.Info(e,n,o);i.startUnitPair(t,n);for(let _=0;_<l;++_){if(D.set(f,c[_],u[_],d[_]),h&&D.transformMat4(f,f,p),D.squaredDistance(f,g)>y)continue;let{indices:I,count:T,squaredDistances:E}=m.find(f[0],f[1],f[2],C);if(T!==0){A.feature=_;for(let w=0;w<T;++w){let S=I[w];if(v.feature=S,!Yme(e,A,v))continue;let P=E[w];for(let k of s)if(P<k.maxDistance*k.maxDistance){let L=k.getType(e,A,v,P);if(L&&Qme(e,A,v,x)){i.add(_,S,L);break}}}}}i.finishUnitPair()}var l8e={distanceMax:M.Numeric(4,{min:1,max:5,step:.1}),angleMax:M.Numeric(30,{min:0,max:60,step:1})},c8e=["CL","BR","I","AT"];function u8e(e,t,r){let{elements:n}=t,{x:o,y:i,z:s}=t.model.atomicConformation;for(let a=0,l=n.length;a<l;++a){let c=tn(t,a);c8e.includes(c)&&r.add(6,Gn.None,o[n[a]],i[n[a]],s[n[a]],a)}}var d8e=["N","O","S"],m8e=["C","N","P","S"];function p8e(e,t,r){let{elements:n}=t,{x:o,y:i,z:s}=t.model.atomicConformation;for(let a=0,l=n.length;a<l;++a){let c=tn(t,a);if(d8e.includes(c)){let u=!1;ba(e,t,a,(d,m)=>{m8e.includes(tn(d,m))&&(u=!0)}),u&&r.add(7,Gn.None,o[n[a]],i[n[a]],s[n[a]],a)}}}function f8e(e,t){return e===7&&t===6||e===6&&t===7}var h8e=Pr(180),g8e=Pr(120);function y8e(e){return{angleMax:Pr(e.angleMax)}}function v8e(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!f8e(o,i))return;let[s,a]=o===6?[t,r]:[r,t],l=s.members[s.offsets[s.feature]],c=a.members[a.offsets[a.feature]],u=uS(e,s.unit,l,a.unit,c);if(u.length!==1||h8e-u[0]>n.angleMax)return;let d=uS(e,a.unit,c,s.unit,l);if(d.length!==0&&!d.some(m=>g8e-m>n.angleMax))return Or.HalogenBond}var tpe=bo.Provider([6],u8e),rpe=bo.Provider([7],p8e),npe={name:"halogen-bonds",params:l8e,createTester:e=>{let t=y8e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:(r,n,o)=>v8e(r,n,o,t)}}};var ape={distanceMax:M.Numeric(3.5,{min:1,max:5,step:.1}),backbone:M.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:M.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:M.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:M.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:M.Numeric(45,{min:0,max:180,step:1})},b8e={...ape,water:M.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:M.Numeric(4.1,{min:1,max:5,step:.1})},x8e={...ape};function $9(e,t){let r=nh.get(e).value;if(!r)throw Error("expected valence model to be available");let n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function C8e(e,t,r){let{totalH:n}=$9(e,t),{elements:o}=t,{x:i,y:s,z:a}=t.model.atomicConformation;for(let l=0,c=o.length;l<c;++l){let u=tn(t,l);(lpe(t,l)||n[l]>0&&(u==="N"||u==="O"||u==="S"))&&r.add(4,Gn.None,i[o[l]],s[o[l]],a[o[l]],l)}}function S8e(e,t,r){let{totalH:n}=$9(e,t),{elements:o}=t,{x:i,y:s,z:a}=t.model.atomicConformation;for(let l=0,c=o.length;l<c;++l)tn(t,l)==="C"&&n[l]>0&&(Fl(e,t,l,"N")>0||Fl(e,t,l,"O")>0||I8e(t,l))&&r.add(9,Gn.None,i[o[l]],s[o[l]],a[o[l]],l)}function I8e(e,t){let{elementAromaticRingIndices:r,all:n}=e.rings,o=r.get(t);if(o===void 0)return!1;for(let i=0,s=o.length;i<s;++i){let a=n[o[i]];for(let l=0,c=a.length;l<c;++l){let u=tn(e,a[l]);if(u==="N"||u==="O")return!0}}return!1}function A8e(e,t,r){let{charge:n,implicitH:o,idealGeometry:i}=$9(e,t),{elements:s}=t,{x:a,y:l,z:c}=t.model.atomicConformation,u=d=>{r.add(5,Gn.None,a[s[d]],l[s[d]],c[s[d]],d)};for(let d=0,m=s.length;d<m;++d){let p=tn(t,d);if(p==="O")u(d);else if(p==="N"){if(lpe(t,d))u(d);else if(n[d]<1){let h=Ju(e,t,d)+o[d],f=i[d];(f===ai.Tetrahedral&&h<4||f===ai.Trigonal&&h<3||f===ai.Linear&&h<2)&&u(d)}}else if(p==="S"){let h=Tw(t,d);(h==="CYS"||h==="MET"||Wk(t,d)===-1)&&u(d)}}}function ope(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===2}function ipe(e,t){return Td.has(Oy(e,t))}function w8e(e,t){return e.rings.elementRingIndices.has(t)}function lpe(e,t){return Tw(e,t)==="HIS"&&tn(e,t)==="N"&&w8e(e,t)}function _8e(e,t,r,n){return ipe(e,t)&&ipe(r,n)}function T8e(e,t,r,n){return ope(e,t)&&ope(r,n)}function E8e(e,t){return e===5&&t===4||e===4&&t===5}function P8e(e,t){return e===9&&t===5||e===5&&t===9}function cpe(e){return{includeBackbone:e.backbone,maxAccAngleDev:Pr(e.accAngleDevMax),maxDonAngleDev:Pr(e.donAngleDevMax),maxAccOutOfPlaneAngle:Pr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:Pr(e.donOutOfPlaneAngleMax)}}function D8e(e){return{...cpe(e),includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax}}var spe=Pr(120);function upe(e,t,r,n){let o=t.members[t.offsets[t.feature]],i=r.members[r.offsets[r.feature]];if(!n.includeBackbone&&_8e(t.unit,o,r.unit,i))return;let s=uS(e,t.unit,o,r.unit,i),a=L9.get(t.idealGeometry[o])||spe;if(s.some(u=>Math.abs(a-u)>n.maxDonAngleDev))return;if(t.idealGeometry[o]===ai.Trigonal){let u=N9(e,t.unit,o,r.unit,i);if(u!==void 0&&u>n.maxDonOutOfPlaneAngle)return}let l=uS(e,r.unit,i,t.unit,o),c=L9.get(r.idealGeometry[i])||spe;if(!l.some(u=>c-u>n.maxAccAngleDev)){if(r.idealGeometry[i]===ai.Trigonal){let u=N9(e,r.unit,i,t.unit,o);if(u!==void 0&&u>n.maxAccOutOfPlaneAngle)return}return!0}}function k8e(e,t,r,n,o){let i=t.types[t.feature],s=r.types[r.feature];if(!E8e(i,s))return;let[a,l]=s===5?[t,r]:[r,t],c=a.members[a.offsets[a.feature]],u=l.members[l.offsets[l.feature]],d=tn(a.unit,c)==="S"||tn(l.unit,u)==="S"?o.maxSulfurDistSq:o.maxDistSq;if(!(n>d)&&!(!o.includeWater&&T8e(a.unit,c,l.unit,u))&&upe(e,a,l,o))return Or.HydrogenBond}function M8e(e,t,r,n,o){let i=t.types[t.feature],s=r.types[r.feature];if(!P8e(i,s))return;let[a,l]=s===5?[t,r]:[r,t];if(upe(e,a,l,o))return Or.WeakHydrogenBond}var dpe=bo.Provider([4],C8e),mpe=bo.Provider([9],S8e),ppe=bo.Provider([5],A8e),fpe={name:"hydrogen-bonds",params:b8e,createTester:e=>{let t=Math.max(e.distanceMax,e.sulfurDistanceMax),r=D8e(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:(n,o,i,s)=>k8e(n,o,i,s,r)}}},hpe={name:"weak-hydrogen-bonds",params:x8e,createTester:e=>{let t=cpe(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:(r,n,o,i)=>M8e(r,n,o,i,t)}}};function gpe(e,t,r){return tn(t,r)==="S"&&Fl(e,t,r,"O")===3}function ype(e,t,r){return tn(t,r)==="S"&&Fl(e,t,r,"O")===4}function W9(e,t,r){return tn(t,r)==="P"&&Fl(e,t,r,"O")===Ju(e,t,r)}function vpe(e,t,r){let n=0;return tn(t,r)==="C"&&Fl(e,t,r,"O")===2&&Fl(e,t,r,"C")===1&&ba(e,t,r,(o,i)=>{tn(o,i)==="O"&&Ju(e,o,i)-Fl(e,o,i,"H")===1&&(n+=1)}),n===2}function bpe(e,t,r){let n=0;return tn(t,r)==="C"&&Ju(e,t,r)===3&&Fl(e,t,r,"N")===3&&ba(e,t,r,(o,i)=>{Ju(e,o,i)-Fl(e,o,i,"H")===1&&(n+=1)}),n===2}function xpe(e,t,r){let n=0;return tn(t,r)==="C"&&Ju(e,t,r)===3&&Fl(e,t,r,"N")===2&&Fl(e,t,r,"C")===1&&ba(e,t,r,(o,i)=>{Ju(e,o,i)-Fl(e,o,i,"H")===1&&(n+=1)}),n===2}var R8e=new Set(["N","O","S","F","CL","BR","I"]);function B8e(e){return R8e.has(e)}function Cpe(e,t,r){let n=!1;return ba(e,t,r,(o,i)=>{B8e(tn(o,i))&&(n=!0)}),n}var L8e={distanceMax:M.Numeric(5,{min:0,max:8,step:.1})},N8e={distanceMax:M.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:M.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:M.Numeric(30,{min:0,max:180,step:1})},F8e={distanceMax:M.Numeric(6,{min:1,max:8,step:.1}),offsetMax:M.Numeric(2,{min:0,max:4,step:.1})},O8e=["ARG","HIS","LYS"],V8e=["GLU","ASP"];function wpe(e,t){let r=nh.get(e).value;if(!r)throw Error("expected valence model to be available");let n=r.get(t.id);if(!n)throw Error("expected valence model for unit to be available");return n}function G8e(e,t,r){let{charge:n}=wpe(e,t),{elements:o}=t,{x:i,y:s,z:a}=t.model.atomicConformation,l=new Set,{label_comp_id:c}=t.model.atomicHierarchy.atoms,u=Vt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,o);for(;u.hasNext;){let{index:d,start:m,end:p}=u.move(),h=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[d]);if(O8e.includes(h)){r.startState();for(let f=m;f<p;++f)tn(t,f)==="N"&&!Td.has(Oy(t,f))&&r.pushMember(i[o[f]],s[o[f]],a[o[f]],f);r.finishState(1,Gn.None)}else if(!hg.has(h)){l.clear();for(let f=m;f<p;++f){let C=Gn.None;bpe(e,t,f)?C=Gn.Guanidine:xpe(e,t,f)&&(C=Gn.Acetamidine),C&&(r.startState(),ba(e,t,f,(g,b)=>{tn(t,b)==="N"&&(l.add(b),r.pushMember(i[o[b]],s[o[b]],a[o[b]],b))}),r.finishState(1,C))}for(let f=m;f<p;++f)n[f]>0&&!l.has(f)&&r.add(1,Gn.None,i[o[f]],s[o[f]],a[o[f]],f)}}}function U8e(e,t,r){let{charge:n}=wpe(e,t),{elements:o}=t,{x:i,y:s,z:a}=t.model.atomicConformation,l=new Set,{label_comp_id:c}=t.model.atomicHierarchy.atoms,u=Vt.transientSegments(t.model.atomicHierarchy.residueAtomSegments,o);for(;u.hasNext;){let{index:d,start:m,end:p}=u.move(),h=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[d]);if(V8e.includes(h)){r.startState();for(let f=m;f<p;++f)tn(t,f)==="O"&&!Td.has(Oy(t,f))&&r.pushMember(i[o[f]],s[o[f]],a[o[f]],f);r.finishState(2,Gn.None)}else if(Pb.has(h))for(let f=m;f<p;++f)W9(e,t,f)&&(r.startState(),ba(e,t,f,(C,g)=>{tn(t,g)==="O"&&r.pushMember(i[o[g]],s[o[g]],a[o[g]],g)}),r.finishState(2,Gn.Phosphate));else if(!hg.has(h)){for(let f=m;f<p;++f){r.startState(),tn(t,f)==="N"&&!Td.has(Oy(t,f))&&r.pushMember(i[o[f]],s[o[f]],a[o[f]],f),r.finishState(2,Gn.None);let C=Gn.None;gpe(e,t,f)?C=Gn.SulfonicAcid:W9(e,t,f)?C=Gn.Phosphate:ype(e,t,f)?C=Gn.Sulfate:vpe(e,t,f)&&(C=Gn.Carboxylate),C&&(r.startState(),ba(e,t,f,(g,b)=>{tn(t,b)==="O"&&(l.add(b),r.pushMember(i[o[b]],s[o[b]],a[o[b]],b))}),r.finishState(2,C))}for(let f=m;f<p;++f)n[f]<0&&!l.has(f)&&r.add(2,Gn.None,i[o[f]],s[o[f]],a[o[f]],f)}}}function z8e(e,t,r){let{elements:n}=t,{x:o,y:i,z:s}=t.model.atomicConformation;for(let a of t.rings.aromaticRings){let l=t.rings.all[a];r.startState();for(let c=0,u=l.length;c<u;++c){let d=l[c];r.pushMember(o[n[d]],i[n[d]],s[n[d]],d)}r.finishState(3,Gn.None)}}function H8e(e,t){return e===2&&t===1||e===1&&t===2}function j8e(e,t){return e===3&&t===3}function $8e(e,t){return e===3&&t===1||e===1&&t===3}var Spe=D(),Ipe=D();function W8e(e,t,r){let{feature:n,offsets:o,members:i}=e,{feature:s,offsets:a,members:l}=t;for(let c=o[n],u=o[n+1];c<u;++c){let d=i[c];e.unit.conformation.position(e.unit.elements[d],Spe);for(let m=a[s],p=a[s+1];m<p;++m){let h=l[m];if(t.unit.conformation.position(t.unit.elements[h],Ipe),D.squaredDistance(Spe,Ipe)<r)return!0}}return!1}var nM=D(),mS=D(),oM=D(),rM=D();function Z9(e,t){let{unit:r,feature:n,offsets:o,members:i}=t,{elements:s}=r,a=o[n];return t.unit.conformation.position(s[i[a]],nM),t.unit.conformation.position(s[i[a+1]],mS),t.unit.conformation.position(s[i[a+2]],oM),D.triangleNormal(e,nM,mS,oM)}var K9=function(e,t,r){return bo.position(nM,e),bo.position(mS,t),D.sub(oM,nM,mS),D.projectOnPlane(rM,oM,r),D.add(rM,rM,mS),D.distance(rM,mS)};function q8e(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}function Z8e(e){return{offsetMax:e.offsetMax,angleDevMax:Pr(e.angleDevMax)}}function K8e(e){return{offsetMax:e.offsetMax}}var X8e=Pr(180),Ape=Pr(90),Ew=D(),q9=D();function Y8e(e,t,r,n,o){let i=t.types[t.feature],s=r.types[r.feature];if(H8e(i,s)&&W8e(t,r,o.distanceMaxSq))return Or.Ionic}function Q8e(e,t,r,n,o){let i=t.types[t.feature],s=r.types[r.feature];if(j8e(i,s)){Z9(Ew,t),Z9(q9,r);let a=D.angle(Ew,q9);if(Math.min(K9(t,r,q9),K9(r,t,Ew))<=o.offsetMax){if(a<=o.angleDevMax||a>=X8e-o.angleDevMax)return Or.PiStacking;if(a<=o.angleDevMax+Ape&&a>=Ape-o.angleDevMax)return Or.PiStacking}}}function J8e(e,t,r,n,o){let i=t.types[t.feature],s=r.types[r.feature];if($8e(i,s)){let[a,l]=i===3?[t,r]:[r,t];if(Z9(Ew,a),K9(l,a,Ew)<=o.offsetMax)return Or.CationPi}}var _pe=bo.Provider([2],U8e),Tpe=bo.Provider([1],G8e),Epe=bo.Provider([3],z8e),Ppe={name:"ionic",params:L8e,createTester:e=>{let t=q8e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:(r,n,o,i)=>Y8e(r,n,o,i,t)}}},Dpe={name:"pi-stacking",params:N8e,createTester:e=>{let t=Z8e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:(r,n,o,i)=>Q8e(r,n,o,i,t)}}},kpe={name:"cation-pi",params:F8e,createTester:e=>{let t=K8e(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:(r,n,o,i)=>J8e(r,n,o,i,t)}}};var e7e={distanceMax:M.Numeric(4,{min:1,max:5,step:.1})};function t7e(e,t,r){let{elements:n}=t,{x:o,y:i,z:s}=t.model.atomicConformation;for(let a=0,l=n.length;a<l;++a){let c=tn(t,a),u=!1;c==="C"?(u=!0,ba(e,t,a,(d,m)=>{let p=tn(d,m);p!=="C"&&p!=="H"&&(u=!1)})):c==="F"&&(u=!0),u&&r.add(8,Gn.None,o[n[a]],i[n[a]],s[n[a]],a)}}function r7e(e,t){return e===8&&t===8}function n7e(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!r7e(o,i))return;let s=t.members[t.offsets[t.feature]],a=r.members[r.offsets[r.feature]];if(!(tn(t.unit,s)==="F"&&tn(r.unit,a)==="F"))return Or.Hydrophobic}var Mpe=bo.Provider([8],t7e),Rpe={name:"hydrophobic",params:e7e,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:(t,r,n,o)=>n7e(t,r,n,o)})};var o7e={distanceMax:M.Numeric(3,{min:1,max:5,step:.1})},i7e=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function s7e(e,t,r){let{elements:n}=t,{x:o,y:i,z:s}=t.model.atomicConformation;for(let a=0,l=n.length;a<l;++a){let c=tn(t,a),u=0;i7e.includes(c)?u=13:(jG(c)||c==="ZN"||c==="CD")&&(u=12),u&&r.add(u,Gn.None,o[n[a]],i[n[a]],s[n[a]],a)}}function Bpe(e){return!Td.has(e)}function a7e(e){return Td.has(e)}function l7e(e){return fC.has(e)}function c7e(e,t,r){let{elements:n}=t,{x:o,y:i,z:s}=t.model.atomicConformation;for(let a=0,l=n.length;a<l;++a){let c=tn(t,a),u=Tw(t,a),d=Oy(t,a),m=!1,p=!1,h=Eb.has(u),f=Pb.has(u);!h&&!f?HG(c)||c==="O"||c==="S"?(m=!0,p=!0):c==="N"&&(m=!0):h?c==="O"?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(u)&&Bpe(d)||a7e(d))&&(m=!0,p=!0):c==="S"&&(u==="CYS"||u==="MET")?(m=!0,p=!0):c==="N"&&u==="HIS"&&Bpe(d)&&(m=!0):f&&(c==="O"&&l7e(d)?(m=!0,p=!0):["N3","N4","N7"].includes(d)?m=!0:["O2","O4","O6"].includes(d)&&(m=!0,p=!0)),m&&r.add(11,Gn.None,o[n[a]],i[n[a]],s[n[a]],a),p&&r.add(10,Gn.None,o[n[a]],i[n[a]],s[n[a]],a)}}function Lpe(e,t){if(e===12)return t===11||t===12;if(e===13)return t===10}function u7e(e,t,r,n){let o=t.types[t.feature],i=r.types[r.feature];if(!(!Lpe(o,i)&&!Lpe(i,o)))return Or.MetalCoordination}var Npe=bo.Provider([13,12],s7e),Fpe=bo.Provider([10,11],c7e),Ope={name:"metal-coordination",params:o7e,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:(t,r,n,o)=>u7e(t,r,n,o)})};function Vpe(e,t){let{contacts:r,unitsContacts:n,unitsFeatures:o}=t,i=[d7e(e,t),m7e(e,t),p7e(e,t),f7e(e,t),h7e(e,t)];for(let a=0,l=r.edgeCount;a<l;++a){let c=r.edges[a],u=e.unitMap.get(c.unitA),d=e.unitMap.get(c.unitB),m=bo.Info(e,u,o.get(c.unitA));m.feature=c.indexA;let p=bo.Info(e,d,o.get(c.unitB));p.feature=c.indexB;for(let h of i)h.isApplicable(c.props.type)&&h.handleInterContact(a,m,p)}let s=n.keys();for(;;){let{done:a,value:l}=s.next();if(a)break;let c=n.get(l),u=o.get(l),d=e.unitMap.get(l);if(!Le.isAtomic(d))continue;let m=bo.Info(e,d,u),p=bo.Info(e,d,u);for(let h of i)h.startUnit(d,c,u);for(let h=0,f=c.edgeCount*2;h<f;++h){m.feature=c.a[h],p.feature=c.b[h];for(let C of i)C.isApplicable(c.edgeProps.type[h])&&C.handleIntraContact(h,m,p)}}}function d7e(e,t){let{contacts:r}=t,n=function(c,u,d,m,p){let[h,f]=m.get(d)||[1/0,-1];c<h?(f!==-1&&p(f),m.set(d,[c,u])):p(u)};function o(c,u,d,m,p){let h=u.members[u.offsets[u.feature]],f=d.members[d.offsets[d.feature]],C=u.unit.getResidueIndex(h),g=d.unit.getResidueIndex(f),b=`${h}|${u.unit.id}|${g}|${d.unit.id}|A`,y=`${f}|${d.unit.id}|${C}|${u.unit.id}|B`,x=bo.distance(u,d);n(x,c,b,m,p),n(x,c,y,m,p)}let i=new Map,s=c=>r.edges[c].props.flag=cu.Filtered,a,l;return{isApplicable:c=>c===Or.Hydrophobic,handleInterContact:(c,u,d)=>{o(c,u,d,i,s)},startUnit:(c,u,d)=>{a=new Map,l=m=>u.edgeProps.flag[m]=cu.Filtered},handleIntraContact:(c,u,d)=>{o(c,u,d,a,l)}}}function m7e(e,t){let{contacts:r}=t,n=(o,i)=>{let s=o.types[o.feature]===9?i:o,a=s.members[s.offsets[s.feature]],{edgeProps:{type:l},elementsIndex:{offsets:c,indices:u}}=t.unitsContacts.get(s.unit.id);for(let m=c[a],p=c[a+1];m<p;++m)if(l[u[m]]===Or.HydrogenBond)return!0;let d=r.getEdgeIndices(s.feature,s.unit.id);for(let m=0,p=d.length;m<p;++m)if(r.edges[d[m]].props.type===Or.HydrogenBond)return!0;return!1};return{isApplicable:o=>o===Or.WeakHydrogenBond,handleInterContact:(o,i,s)=>{n(i,s)&&(r.edges[o].props.flag=cu.Filtered)},startUnit:()=>{},handleIntraContact:(o,i,s)=>{if(n(i,s)){let{flag:a}=t.unitsContacts.get(i.unit.id).edgeProps;a[o]=cu.Filtered}}}}function X9(e,t,r,n,o){let{offsets:i,feature:s}=r,{offsets:a,feature:l}=n;for(let c=i[s],u=i[s+1];c<u;++c){let d=r.members[c],m=o.getContactIndicesForElement(d,r.unit);for(let p=0,h=m.length;p<h;++p){let f=m[p];if(e.includes(o.edges[f].props.type))for(let C=a[l],g=a[l+1];C<g;++C){let b=n.members[C];if(o.getContactIndicesForElement(b,n.unit).includes(f)){o.edges[t].props.flag=cu.Filtered;return}}}}}function Y9(e,t,r,n,o){let{edgeProps:{type:i,flag:s},elementsIndex:{offsets:a,indices:l}}=o,{offsets:c,feature:u}=r,{offsets:d,feature:m}=n;for(let p=c[u],h=c[u+1];p<h;++p){let f=r.members[p];for(let C=a[f],g=a[f+1];C<g;++C){let b=l[C];if(e.includes(i[b]))for(let y=d[m],x=d[m+1];y<x;++y){let A=n.members[y];for(let v=a[A],_=a[A+1];v<_;++v)if(b===l[v]){s[t]=cu.Filtered;return}}}}}function p7e(e,t){let{contacts:r}=t;return{isApplicable:n=>n===Or.Ionic,handleInterContact:(n,o,i)=>{X9([Or.HydrogenBond,Or.WeakHydrogenBond],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{Y9([Or.HydrogenBond,Or.WeakHydrogenBond],n,o,i,t.unitsContacts.get(o.unit.id))}}}function f7e(e,t){let{contacts:r}=t;return{isApplicable:n=>n===Or.Hydrophobic||n===Or.CationPi,handleInterContact:(n,o,i)=>{X9([Or.PiStacking],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{Y9([Or.PiStacking],n,o,i,t.unitsContacts.get(o.unit.id))}}}function h7e(e,t){let{contacts:r}=t;return{isApplicable:n=>n===Or.Ionic,handleInterContact:(n,o,i)=>{X9([Or.MetalCoordination],n,o,i,r)},startUnit:()=>{},handleIntraContact:(n,o,i)=>{Y9([Or.MetalCoordination],n,o,i,t.unitsContacts.get(o.unit.id))}}}var Bm;(function(e){function t(u,d,m,p,h,f){return s3("interactions",{structure:d,interactions:u},{unitA:m,indexA:p,unitB:h,indexB:f})}e.Location=t;function r(u){return!!u&&u.kind==="data-location"&&u.tag==="interactions"}e.isLocation=r;function n(u,d){return u.data.structure===d.data.structure&&u.data.interactions===d.data.interactions&&u.element.indexA===d.element.indexA&&u.element.indexB===d.element.indexB&&u.element.unitA===d.element.unitA&&u.element.unitB===d.element.unitB}e.areLocationsEqual=n;function o(u,d){let{unitA:m,indexA:p,unitB:h,indexB:f}=d,{contacts:C,unitsContacts:g}=u;if(m===h){let b=g.get(m.id),y=b.getDirectedEdgeIndex(p,f);return z9(b.edgeProps.type[y])}else{let b=C.getEdgeIndex(p,m.id,f,h.id);return z9(C.edges[b].props.type)}}function i(u){return o(u.data.interactions,u.element)}e.locationLabel=i;function s(u,d,m){return by("interactions",{structure:u,interactions:d},m,p=>l(d,m,p),()=>c(u,d,m))}e.Loci=s;function a(u){return!!u&&u.kind==="data-loci"&&u.tag==="interactions"}e.isLoci=a;function l(u,d,m){let{unitsFeatures:p}=u;return ec.fromPairProvider(d.length,(h,f,C)=>{let g=d[h];bo.setPosition(f,g.unitA,g.indexA,p.get(g.unitA.id)),bo.setPosition(C,g.unitB,g.indexB,p.get(g.unitB.id))},m)}e.getBoundingSphere=l;function c(u,d,m){let p=m[0];if(p===void 0)return"";let{unitA:h,indexA:f,unitB:C,indexB:g}=p,{unitsFeatures:b}=d,{members:y,offsets:x}=b.get(h.id),{members:A,offsets:v}=b.get(C.id),_={granularity:"element"};return(x[f+1]-x[f]>1||v[g+1]-v[g]>1)&&(_.granularity="residue"),[o(d,p),pw(_t.Location(u,h,y[x[f]],u,C,A[v[g]]),_)].join("</br>")}e.getLabel=c})(Bm||(Bm={}));var g7e=[dpe,mpe,ppe,_pe,Tpe,Epe,tpe,rpe,Mpe,Npe,Fpe],iM={ionic:Ppe,"pi-stacking":Dpe,"cation-pi":kpe,"halogen-bonds":npe,"hydrogen-bonds":fpe,"weak-hydrogen-bonds":hpe,hydrophobic:Rpe,"metal-coordination":Ope};function y7e(e=[]){let t=Object.create(null);return Object.keys(iM).forEach(r=>{t[r]=M.MappedStatic(e.includes(r)?"on":"off",{on:M.Group(iM[r].params),off:M.Group({})},{cycle:!0})}),t}var v7e=y7e(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),Q9={providers:M.Group(v7e,{isFlat:!0}),contacts:M.Group(Xme,{label:"Advanced Options"})};async function Gpe(e,t,r){let n={...M.getDefaultValues(Q9),...r};await nh.attach(e,t);let o=[];Hh(iM).forEach(d=>{let{name:m,params:p}=n.providers[d];m==="on"&&o.push(iM[d].createTester(p))});let i=new Set;o.forEach(d=>$n.add(i,d.requiredFeatures));let s=g7e.filter(d=>$n.areIntersecting(i,d.types)),a=Ja.Mutable(),l=Ja.Mutable();for(let d=0,m=t.unitSymmetryGroups.length;d<m;++d){let p=t.unitSymmetryGroups[d];e.runtime.shouldUpdate&&await e.runtime.update({message:"computing interactions",current:d,max:m});let h=b7e(t,p.units[0],s),f=x7e(t,p.units[0],h,o,n.contacts);for(let C=0,g=p.units.length;C<g;++C){let b=p.units[C];a.set(b.id,h),l.set(b.id,f)}}let c=C7e(t,a,o,n.contacts),u={unitsFeatures:a,unitsContacts:l,contacts:c};return Vpe(t,u),u}function b7e(e,t,r){let n=t.elements.length,o=Yk.create(n,n/2);if(Le.isAtomic(t))for(let i of r)i.add(e,t,o);return o.getFeatures(n)}function x7e(e,t,r,n,o){let i=eM.create(r,t.elements.length);return Le.isAtomic(t)&&Jme(e,t,r,i,n,o),i.getContacts()}function C7e(e,t,r,n){let o=tM.create();return qe.eachUnitPair(e,(i,s)=>{let a=t.get(i.id),l=t.get(s.id);epe(e,i,a,s,l,o,r,n)},{maxRadius:Math.max(...r.map(i=>i.maxDistance)),validUnit:i=>Le.isAtomic(i),validUnitPair:(i,s)=>qe.validUnitPair(e,i,s)}),o.getContacts(t)}var J9={...Q9},li=iu.createProvider({label:"Interactions",descriptor:Ci({name:"molstar_computed_interactions"}),type:"local",defaultParams:J9,getParams:e=>J9,isApplicable:e=>!e.isCoarseGrained,obtain:async(e,t,r)=>{let n={...M.getDefaultValues(J9),...r};return{value:await Gpe(e,t,n)}}});var ez=ze(13421772),S7e="Assigns colors according the interaction type of a link.",Rc={HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404},I7e=[["Hydrogen Bond",Rc.HydrogenBond],["Hydrophobic",Rc.Hydrophobic],["Halogen Bond",Rc.HalogenBond],["Ionic",Rc.Ionic],["Metal Coordination",Rc.MetalCoordination],["Cation Pi",Rc.CationPi],["Pi Stacking",Rc.PiStacking],["Weak HydrogenBond",Rc.WeakHydrogenBond]];function Upe(e){switch(e){case Or.HydrogenBond:return Rc.HydrogenBond;case Or.Hydrophobic:return Rc.Hydrophobic;case Or.HalogenBond:return Rc.HalogenBond;case Or.Ionic:return Rc.Ionic;case Or.MetalCoordination:return Rc.MetalCoordination;case Or.CationPi:return Rc.CationPi;case Or.PiStacking:return Rc.PiStacking;case Or.WeakHydrogenBond:return Rc.WeakHydrogenBond;case Or.Unknown:return ez}}var zpe={};function A7e(e){return zpe}function Hpe(e,t){let r,n=e.structure?li.get(e.structure):void 0,o=n?wu(n.id,n.version):-1;return n&&n.value?r=i=>{if(Bm.isLocation(i)){let{unitsContacts:s,contacts:a}=i.data.interactions,{unitA:l,unitB:c,indexA:u,indexB:d}=i.element;if(l===c){let m=s.get(l.id),p=m.getDirectedEdgeIndex(u,d);return Upe(m.edgeProps.type[p])}else{let m=a.getEdgeIndex(u,l.id,d,c.id);return Upe(a.edges[m].props.type)}}return ez}:r=()=>ez,{factory:Hpe,granularity:"group",color:r,props:t,contextHash:o,description:S7e,legend:hl(I7e)}}var Pw={name:"interaction-type",label:"Interaction Type",category:oi.Category.Misc,factory:Hpe,getParams:A7e,defaultValues:M.getDefaultValues(zpe),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?li.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&li.ref(e.structure,!1)}};function us(e,t,r,n){let o=0,{webgl:i}=t,s=new Vn,a=new Wt.GeometryState,l=ru(),c=[],u=so.create(),d,m,p,h,f=ii.createEmpty();function C(I={},T){return T&&T!==m&&(p=r(t,T),m=T,h||(h=M.getDefaultValues(p))),h=Object.assign({},h,I),ke.create("Creating or updating ComplexRepresentation",async E=>{var w;let S=!1;d?!((w=d.mustRecreate)===null||w===void 0)&&w.call(d,m,h,i)&&(d.destroy(),d=n(l,m,h,i),S=!0):(d=n(l,m,h,i),S=!0);let P=d.createOrUpdate({webgl:i,runtime:E},f,h,T);P&&await P,S&&A(u),c.length=0,d&&d.renderObject&&(c.push(d.renderObject),a.add(d.renderObject.id,d.geometryVersion)),a.snapshot(),o+=1,s.next(o)})}function g(I){return d?d.getLoci(I):pr}function b(){var I;return[qe.Loci((I=m.child)!==null&&I!==void 0?I:m)]}function y(I){d?.eachLocation(I)}function x(I,T){if(!m||!si.is(u.markerActions,T))return!1;if(qe.isLoci(I)||ce.Loci.is(I)||_t.isLoci(I)){if(!qe.areRootsEquivalent(I.structure,m))return!1;I=Xt.remap(I,m),(qe.isLoci(I)||ce.Loci.is(I)&&ce.Loci.isWholeStructure(I))&&(I=vy)}else if(!cs(I)&&!Wb(I))return!1;return Xt.isEmpty(I)?!1:d?d.mark(I,T):!1}function A(I){if(so.update(u,I),I.visible!==void 0&&d&&d.setVisibility(I.visible&&(u.unitTransforms===null||u.unitTransforms.isIdentity)),I.alphaFactor!==void 0&&d&&d.setAlphaFactor(I.alphaFactor),I.pickable!==void 0&&d&&d.setPickable(I.pickable),I.overpaint!==void 0&&d){let T=Gs.remap(I.overpaint,m);d.setOverpaint(T,i)}if(I.transparency!==void 0&&d){let T=Us.remap(I.transparency,m);d.setTransparency(T,i)}if(I.emissive!==void 0&&d){let T=Hs.remap(I.emissive,m);d.setEmissive(T,i)}if(I.substance!==void 0&&d){let T=zs.remap(I.substance,m);d.setSubstance(T,i)}if(I.clipping!==void 0&&d){let T=io.remap(I.clipping,m);d.setClipping(T)}I.themeStrength!==void 0&&d&&d.setThemeStrength(I.themeStrength),I.transform!==void 0&&d&&d.setTransform(I.transform),I.unitTransforms!==void 0&&d&&d.setVisibility(u.visible&&(I.unitTransforms===null||I.unitTransforms.isIdentity))}function v(I){f=I}function _(){d&&d.destroy()}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return h},get params(){return p},get state(){return u},get theme(){return f},get geometryVersion(){return a.version},renderObjects:c,updated:s,createOrUpdate:C,setState:A,setTheme:v,getLoci:g,getAllLoci:b,eachLocation:y,mark:x,destroy:_}}var w7e=de.toArray;function sM(e,t,r){let{elements:n,model:o}=t;if(Ge.indexOf(n,r)!==-1){let{index:i,offsets:s}=o.atomicHierarchy.residueAtomSegments,a=i[r],l=[];for(let u=s[a],d=s[a+1];u<d;++u){let m=Ge.indexOf(n,u);m!==-1&&l.push(m)}let c=Ge.ofSortedArray(Qe.ofSortedArray(l));return ce.Loci(e,[{unit:t,indices:c}])}return pr}function jpe(e,t,r){let{elements:n,model:o}=t,{label_alt_id:i}=o.atomicHierarchy.atoms,s=i.value(r);if(Ge.indexOf(n,r)!==-1){let{index:a}=o.atomicHierarchy.residueAtomSegments,l=a[r];return Gy(e,t,l,s)}return ce.Loci(e,[])}function Gy(e,t,r,n){let{elements:o,model:i}=t,{label_alt_id:s}=i.atomicHierarchy.atoms,{offsets:a}=i.atomicHierarchy.residueAtomSegments,l=[];for(let u=a[r],d=a[r+1];u<d;++u){let m=Ge.indexOf(o,u);if(m!==-1){let p=s.value(u);(n===p||p==="")&&l.push(m)}}let c=Ge.ofSortedArray(Qe.ofSortedArray(l));return ce.Loci(e,[{unit:t,indices:c}])}function tz(e,t,r,n,o,i){let{child:s}=e.structure,a=t&&s?e.group.units.filter(d=>s.unitMap.has(d.id)):e.group.units,l=a.length,c=l*16,u=i&&i.aTransform.ref.value.length>=c?i.aTransform.ref.value:new Float32Array(c);for(let d=0;d<l;d++)w7e(a[d].conformation.operator.matrix,u,d*16);return D2(u,l,r,n,o,i)}var _7e={atomic:{},spheres:{},gaussians:{}},$pe=M.objectToOptions(_7e);function Wpe(e,t){for(let r=0,n=e.length;r<n;++r)if(Le.isAtomic(t)&&e[r]==="atomic"||Le.isSpheres(t)&&e[r]==="spheres"||Le.isGaussians(t)&&e[r]==="gaussians")return!0;return!1}var qpe=5e8;function rz(e,t,r=qpe){let n=xt.size(D(),e);D.ceil(n,n),n.sort((a,l)=>l-a);let o=Math.floor(Math.cbrt(r)*Math.cbrt(r)),i=n[0]*n[1],s=Math.ceil(i/(t*t));return{area:i,areaCells:s,maxAreaCells:o}}function Lm(e,t,r=qpe){let{area:n,areaCells:o,maxAreaCells:i}=rz(e,t.resolution,r),s=o>i?Math.sqrt(n/i):t.resolution;return{...t,resolution:s}}function T7e(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}var a1={ignoreHydrogens:M.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),traceOnly:M.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:M.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})},cgr=M.getDefaultValues(a1),E7e=D();function Zpe(e,t,r,n){return D.squaredDistance(D.set(E7e,e,t,r),n)}function P7e(e,t,r){let n=0,o=t.length;for(let i=0,s=r.length;i<s;++i){let a=Qe.indexOfInRange(t,r[i],n,o);a===-1?e[i]=-2:(e[i]=a,n=a)}}function pS(e,t,r,n){let{ignoreHydrogens:o,ignoreHydrogensVariant:i,traceOnly:s,includeParent:a}=n,l=a?e.root.unitMap.get(t.id):t,c=a&&l!==t,{x:u,y:d,z:m}=T7e(l),{elements:p}=l,{center:h,radius:f}=t.boundary.sphere,C=(4+1.5)*2,g=(f+C)*(f+C),b,y;if(o||s||c){let I=[],T=[];for(let E=0,w=p.length;E<w;++E){let S=p[E];o&&uu(e,l,S,i)||s&&!aM(l,S)||c&&Zpe(u[S],d[S],m[S],h)>g||(I.push(S),T.push(E))}b=Qe.ofSortedArray(I),y=T}else b=p,y=Rs(new Int32Array(b.length));a&&l!==t&&P7e(y,t.elements,b);let x={indices:b,x:u,y:d,z:m,id:y},A=c?Ec(x):t.boundary,v=ce.Location.create(e,l);return{position:x,boundary:A,radius:I=>(v.element=I,r.size(v))}}function fS(e,t,r){let{ignoreHydrogens:n,ignoreHydrogensVariant:o,traceOnly:i,includeParent:s}=r,a=s&&!!e.parent,l=ce.Location.create(e.root),{center:c,radius:u}=e.boundary.sphere,d=(4+1.5)*2,m=(u+d)*(u+d),p,h,f,C,g,b;if(n||i||a){let{getSerialIndex:v}=e.serialMapping,_=a?e.root.units:e.units,I=[],T=[],E=[],w=[],S=[];for(let P=0,k=_.length;P<k;++P){let L=_[P],{elements:R,conformation:N}=L,F=e.unitMap.get(L.id);l.unit=L;for(let H=0,V=R.length;H<V;++H){let q=R[H];if(n&&uu(e,L,q,o)||i&&!aM(L,q))continue;let Q=N.x(q),O=N.y(q),B=N.z(q);a&&Zpe(Q,O,B,c)>m||(I.push(Q),T.push(O),E.push(B),l.element=q,w.push(t.size(l)),a?(F?Qe.indexOf(F.elements,q):-1)===-1?S.push(-2):S.push(v(F,q)):S.push(v(L,q)))}}p=I,h=T,f=E,C=w,g=S,b=Ge.ofRange(0,g.length)}else{let{elementCount:v}=e,_=new Float32Array(v),I=new Float32Array(v),T=new Float32Array(v),E=new Float32Array(v);for(let w=0,S=0,P=e.units.length;w<P;++w){let k=e.units[w],{elements:L,conformation:R}=k;l.unit=k;for(let N=0,F=L.length;N<F;++N){let H=L[N],V=S+N;_[V]=R.x(H),I[V]=R.y(H),T[V]=R.z(H),l.element=H,E[V]=t.size(l)}S+=L.length}p=_,h=I,f=T,C=E,g=Rs(new Uint32Array(v)),b=Ge.ofRange(0,g.length)}let y={indices:b,x:p,y:h,z:f,id:g},x=a?Ec(y):e.boundary;return{position:y,boundary:x,radius:v=>C[v]}}var Kpe=U2.H;function uu(e,t,r,n){if(Le.isCoarse(t)||t.model.atomicHierarchy.derived.atom.atomicNumber[r]!==Kpe)return!1;if(n==="all")return!0;let o=Cpe(e,t,Qe.indexOf(t.elements,r));return!!(o&&n==="polar"||!o&&n==="non-polar")}function Xpe(e,t){return e[t]===Kpe}function aM(e,t){if(Le.isCoarse(e))return!0;let r=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return r==="CA"||r==="BB"||r==="P"}function Fg(e){return M.MultiSelect(e,$pe,{description:"For which kinds of units/chains to show the representation visuals."})}var cc={unitKinds:Fg(["atomic","spheres"]),includeParent:M.Boolean(!1,{isHidden:!0})},lM={...Ct.Params},cM={...Ra.Params},uM={...ss.Params},Ype={...Gu.Params},dM={...In.Params},mM={...Cs.Params},pM={...el.Params},fM={...Ns.Params};function D7e(e,t,r,n,o,i){let{createValues:s,createRenderableState:a}=Mi.getUtils(t),l=aC(),c=s(t,l,r,n,o),u=a(o);return gm(t.kind,c,u,i)}function Uy(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:s,setUpdateState:a,mustRecreate:l,processValues:c,dispose:u}=e,{updateValues:d,updateBoundingSphere:m,updateRenderableState:p,createPositionIterator:h}=e.geometryUtils,f=Zu.create(),C={loci:pr,action:zt.None,status:-1},g,b,y,x,A=Object.assign({},r),v=ii.createEmpty(),_,I,T=-1,E,w;function S(F,H,V){if(!V&&!_)throw new Error("missing structure");if(b=Object.assign({},A,H),y=F,x=V,Zu.reset(f),!g||!_){f.createNew=!0,f.createGeometry=!0;return}a(f,b,A,y,v,x,_),qe.areEquivalent(x,_)||(f.createGeometry=!0),qe.areHierarchiesEqual(x,_)||(f.updateTransform=!0,f.createGeometry=!0),oi.areEqual(F.color,v.color)||(f.updateColor=!0),ul(b.unitKinds,A.unitKinds)||(f.createGeometry=!0),_.child!==x.child&&(f.createGeometry=!0),b.instanceGranularity!==A.instanceGranularity&&(f.updateTransform=!0),f.updateSize&&!("uSize"in g.values)&&(f.createGeometry=!0),f.createGeometry&&(f.updateColor=!0,f.updateSize=!0)}function P(F){if(f.createNew)if(E=o(x,b),F)g=D7e(x,F,E,y,b,t),w=h(F,g.values);else throw new Error("expected geometry to be given");else{if(!g)throw new Error("expected renderObject to be available");if(f.updateTransform){E=o(x,b);let{instanceCount:H,groupCount:V}=E;b.instanceGranularity?to(H,"instance",g.values):to(H*V,"groupInstance",g.values)}if(f.createGeometry)if(F)G.updateIfChanged(g.values.drawCount,Mi.getDrawCount(F)),G.updateIfChanged(g.values.uVertexCount,Mi.getVertexCount(F)),G.updateIfChanged(g.values.uGroupCount,Mi.getGroupCount(F));else throw new Error("expected geometry to be given");(f.updateTransform||f.createGeometry)&&(m(g.values,F||I),w=h(I,g.values)),f.updateSize&&"uSize"in g.values&&Sl(E,y.size,g.values),f.updateColor&&$i(E,w,y.color,g.values),d(g.values,b),p(g.state,b)}A=b,v=y,_=x,F&&(I=F,T+=1)}function k(F){return!!(cs(F)||qe.isLoci(F)&&qe.areRootsEquivalent(F.structure,_)||ce.Loci.is(F)&&qe.areRootsEquivalent(F.structure,_)&&ce.Loci.isWholeStructure(F))}function L(F,H,V){let q=!1;return!ce.Loci.is(F)&&!_t.isLoci(F)||!qe.areEquivalent(F.structure,H)?!1:(V(Be.ofSingleton(0))&&(q=!0),q)}function R(F,H,V){return k(F)?A.instanceGranularity?H(Be.ofBounds(0,E.instanceCount)):H(Be.ofBounds(0,E.groupCount*E.instanceCount)):A.instanceGranularity?L(F,_,H):s(F,_,H,V)}function N(F){g&&c?.(g.values,I,A,v,F.webgl)}return{get groupCount(){return E?E.count:0},get renderObject(){return E&&E.count?g:void 0},get geometryVersion(){return T},createOrUpdate(F,H,V={},q){if(S(H,V,q||_),f.createGeometry){let Q=n(F,x,y,b,I);if(p0(Q))return Q.then(O=>{P(O),N(F)});P(Q)}else P();N(F)},getLoci(F){return g?i(F,_,g.id):pr},eachLocation(F){for(E.reset();E.hasNext;){let{location:H,isSecondary:V}=E.move();F(H,V)}},mark(F,H){return Er.mark(g,F,H,R,C)},setVisibility(F){Er.setVisibility(g,F)},setAlphaFactor(F){Er.setAlphaFactor(g,F)},setPickable(F){Er.setPickable(g,F)},setColorOnly(F){Er.setColorOnly(g,F)},setTransform(F,H){Er.setTransform(g,F,H)},setOverpaint(F,H){let V={geometry:I,props:A,webgl:H};Er.setOverpaint(g,F,R,!0,V)},setTransparency(F,H){let V={geometry:I,props:A,webgl:H};Er.setTransparency(g,F,R,!0,V)},setEmissive(F,H){let V={geometry:I,props:A,webgl:H};Er.setEmissive(g,F,R,!0,V)},setSubstance(F,H){let V={geometry:I,props:A,webgl:H};Er.setSubstance(g,F,R,!0,V)},setClipping(F){Er.setClipping(g,F,R,!0)},setThemeStrength(F){Er.setThemeStrength(g,F)},destroy(){u?.(I),g&&(g.state.disposed=!0,g=void 0)},mustRecreate:l}}var Nm={...lM,...cc};function Ol(e,t){return Uy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.createGeometry=!0)},geometryUtils:Ct.Utils},t)}var Qpe={...cM,...cc};function Jpe(e,t){return Uy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.updateSize=!0)},geometryUtils:Ra.Utils},t)}var efe={...uM,...cc};function tfe(e,t){return Uy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.updateSize=!0)},geometryUtils:ss.Utils},t)}var rfe={...dM,...cc};function nfe(e,t){return Uy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.updateSize=!0)},geometryUtils:In.Utils},t)}var ofe={...mM,...cc};function ife(e,t){return Uy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.updateSize=!0),n.background!==o.background&&(r.createGeometry=!0),n.backgroundMargin!==o.backgroundMargin&&(r.createGeometry=!0),n.tether!==o.tether&&(r.createGeometry=!0),n.tetherLength!==o.tetherLength&&(r.createGeometry=!0),n.tetherBaseWidth!==o.tetherBaseWidth&&(r.createGeometry=!0),n.attachment!==o.attachment&&(r.createGeometry=!0),n.fontFamily!==o.fontFamily&&(r.createGeometry=!0),n.fontQuality!==o.fontQuality&&(r.createGeometry=!0),n.fontStyle!==o.fontStyle&&(r.createGeometry=!0),n.fontVariant!==o.fontVariant&&(r.createGeometry=!0),n.fontWeight!==o.fontWeight&&(r.createGeometry=!0)},geometryUtils:Cs.Utils},t)}var sfe={...pM,...cc};function afe(e,t){return Uy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.createGeometry=!0)},geometryUtils:el.Utils},t)}var lfe={...fM,...cc};function cfe(e,t){return Uy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.createGeometry=!0)},geometryUtils:Ns.Utils},t)}function Fn(e,t,r,n){let o=0,{webgl:i}=t,s=new Vn,a=ru(),l=[],c=new Wt.GeometryState,u=so.create(),d=new Map,m,p,h,f,C=ii.createEmpty();function g(E={},w){return w&&w!==m&&(h=r(t,w),f||(f=M.getDefaultValues(h))),f=Object.assign({},f,E),ke.create("Creating or updating UnitsRepresentation",async S=>{var P,k,L;if(!m&&!w)throw new Error("missing structure");if(w&&!m){p=w.unitSymmetryGroups;for(let R=0;R<p.length;R++){let N=p[R],F=n(a,w,f,i),H=F.createOrUpdate({webgl:i,runtime:S},C,f,{group:N,structure:w});H&&await H,v(F,N,u),d.set(N.hashCode,{visual:F,group:N}),S.shouldUpdate&&await S.update({message:"Creating or updating UnitsVisual",current:R,max:p.length})}}else if(w&&(!qe.areUnitIdsAndIndicesEqual(w,m)||w.child!==m.child)){p=w.unitSymmetryGroups;let R=d;d=new Map;for(let N=0;N<p.length;N++){let F=p[N],H=R.get(F.hashCode);if(H){let{visual:V}=H;if(!((P=V.mustRecreate)===null||P===void 0)&&P.call(V,{group:F,structure:w},f,i)){V.destroy(),V=n(a,w,f,i);let q=V.createOrUpdate({webgl:i,runtime:S},C,f,{group:F,structure:w});q&&await q,v(V,F,u)}else{let q=V.createOrUpdate({webgl:i,runtime:S},C,f,{group:F,structure:w});q&&await q}if(d.set(F.hashCode,{visual:V,group:F}),R.delete(F.hashCode),V.renderObject){let q=V.renderObject.values.tMarker.ref.value.array;Rl(q,Be.ofBounds(0,q.length),zt.RemoveHighlight)}}else{let V=n(a,w,f,i),q=V.createOrUpdate({webgl:i,runtime:S},C,f,{group:F,structure:w});q&&await q,v(V,F,u),d.set(F.hashCode,{visual:V,group:F})}S.shouldUpdate&&await S.update({message:"Creating or updating UnitsVisual",current:N,max:p.length})}R.forEach(({visual:N})=>{N.destroy()})}else if(w&&w!==m&&qe.areUnitIdsAndIndicesEqual(w,m)){p=w.unitSymmetryGroups;for(let R=0;R<p.length;R++){let N=p[R],F=d.get(N.hashCode);if(F){let{visual:H}=F;if(!((k=H.mustRecreate)===null||k===void 0)&&k.call(H,{group:N,structure:w},f,t.webgl)){H.destroy(),H=n(a,w,f,t.webgl),F.visual=H;let V=H.createOrUpdate({webgl:i,runtime:S},C,f,{group:N,structure:w});V&&await V,v(H,N,u)}else{let V=H.createOrUpdate({webgl:i,runtime:S},C,f,{group:N,structure:w});V&&await V}F.group=N}else throw new Error(`expected to find visual for hashCode ${N.hashCode}`);S.shouldUpdate&&await S.update({message:"Creating or updating UnitsVisual",current:R,max:p.length})}}else{let R=[];d.forEach(N=>R.push(N));for(let N=0,F=R.length;N<F;++N){let{visual:H,group:V}=R[N];if(!((L=H.mustRecreate)===null||L===void 0)&&L.call(H,{group:V,structure:m},f,t.webgl)){H.destroy(),H=n(a,m,f,i),R[N].visual=H;let q=H.createOrUpdate({webgl:i,runtime:S},C,f,{group:V,structure:m});q&&await q,v(H,V,u)}else{let q=H.createOrUpdate({webgl:i,runtime:S},C,f);q&&await q}S.shouldUpdate&&await S.update({message:"Creating or updating UnitsVisual",current:N,max:F})}}l.length=0,d.forEach(({visual:R})=>{R.renderObject&&(l.push(R.renderObject),c.add(R.renderObject.id,R.geometryVersion))}),c.snapshot(),w&&(m=w),s.next(o++)})}function b(E){let w=pr;return d.forEach(({visual:S})=>{let P=S.getLoci(E);wi(P)||(w=P)}),w}function y(E){d.forEach(({visual:w})=>{w.eachLocation(E)})}function x(){var E;return[qe.Loci((E=m.child)!==null&&E!==void 0?E:m)]}function A(E,w){if(!m||!si.is(u.markerActions,w))return!1;if(qe.isLoci(E)||ce.Loci.is(E)||_t.isLoci(E)){if(!qe.areRootsEquivalent(E.structure,m))return!1;E=Xt.remap(E,m),(qe.isLoci(E)||ce.Loci.is(E)&&ce.Loci.isWholeStructure(E))&&(E=vy)}else if(!cs(E)&&!Wb(E))return!1;if(Xt.isEmpty(E))return!1;let S=!1;return d.forEach(({visual:P})=>{S=P.mark(E,w)||S}),S}function v(E,w,S){let{visible:P,alphaFactor:k,pickable:L,overpaint:R,transparency:N,emissive:F,substance:H,clipping:V,themeStrength:q,transform:Q,unitTransforms:O}=S;P!==void 0&&E.setVisibility(P),k!==void 0&&E.setAlphaFactor(k),L!==void 0&&E.setPickable(L),R!==void 0&&E.setOverpaint(R,i),N!==void 0&&E.setTransparency(N,i),F!==void 0&&E.setEmissive(F,i),H!==void 0&&E.setSubstance(H,i),V!==void 0&&E.setClipping(V),q!==void 0&&E.setThemeStrength(q),Q!==void 0&&(Q!==u.transform||!de.areEqual(Q,u.transform,1e-6))&&E.setTransform(Q),O!==void 0&&(O?E.setTransform(void 0,O.getSymmetryGroupTransforms(w)):O!==u.unitTransforms&&E.setTransform(void 0,null))}function _(E){let{visible:w,alphaFactor:S,pickable:P,overpaint:k,transparency:L,emissive:R,substance:N,clipping:F,themeStrength:H,transform:V,unitTransforms:q,syncManually:Q,markerActions:O}=E,B={};w!==void 0&&(B.visible=w),S!==void 0&&(B.alphaFactor=S),P!==void 0&&(B.pickable=P),k!==void 0&&m&&(B.overpaint=Gs.remap(k,m)),L!==void 0&&m&&(B.transparency=Us.remap(L,m)),R!==void 0&&m&&(B.emissive=Hs.remap(R,m)),N!==void 0&&m&&(B.substance=zs.remap(N,m)),F!==void 0&&m&&(B.clipping=io.remap(F,m)),H!==void 0&&(B.themeStrength=H),V!==void 0&&!de.areEqual(V,u.transform,1e-6)&&(B.transform=V),(q!==u.unitTransforms||q?.version!==u.unitTransformsVersion)&&(B.unitTransforms=q,u.unitTransformsVersion=q?q?.version:-1),Q!==void 0&&(B.syncManually=Q),O!==void 0&&(B.markerActions=O),d.forEach(({visual:j,group:U})=>v(j,U,B)),so.update(u,B)}function I(E){C=E}function T(){d.forEach(({visual:E})=>E.destroy()),d.clear()}return{label:e,get groupCount(){let E=0;return d.forEach(({visual:w})=>{w.renderObject&&(E+=w.groupCount)}),E},get geometryVersion(){return c.version},get props(){return f},get params(){return h},get state(){return u},get theme(){return C},renderObjects:l,updated:s,createOrUpdate:g,setState:_,setTheme:I,getLoci:b,getAllLoci:x,eachLocation:y,mark:A,destroy:T}}function k7e(e,t,r,n,o,i){let{createValues:s,createRenderableState:a}=Mi.getUtils(t),l=tz(e,o.includeParent,t.boundingSphere,o.cellSize,o.batchSize),c=s(t,l,r,n,o),u=a(o);return gm(t.kind,c,u,i)}function zy(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:s,setUpdateState:a,mustRecreate:l,processValues:c,dispose:u}=e,{createEmpty:d,updateValues:m,updateBoundingSphere:p,updateRenderableState:h,createPositionIterator:f}=e.geometryUtils,C=Zu.create(),g={loci:pr,action:zt.None,status:-1},b,y=Object.assign({},r),x=ii.createEmpty(),A,v,_,I,T,E=-1,w,S;function P(V,q,Q){if(!Q&&!I)throw new Error("missing structureGroup");if(y=q,x=V,A=Q,Zu.reset(C),!b||!I){C.createNew=!0,C.createGeometry=!0;return}a(C,y,v,x,_,A,I),qe.areHierarchiesEqual(I.structure,A.structure)||(C.updateTransform=!0,C.updateColor=!0,C.updateSize=!0),oi.areEqual(x.color,_.color)||(C.updateColor=!0),I.structure.child!==A.structure.child&&(C.createGeometry=!0),(y.instanceGranularity!==v.instanceGranularity||y.cellSize!==v.cellSize||y.batchSize!==v.batchSize)&&(C.updateTransform=!0),ul(y.unitKinds,v.unitKinds)||(C.createGeometry=!0),A.group.transformHash!==I.group.transformHash&&(A.group.units.length!==I.group.units.length||C.updateColor?C.updateTransform=!0:C.updateMatrix=!0);let O=A.group.units[0],B=I.group.units[0];Le.areOperatorsEqual(O,B)||(C.updateTransform=!0),Le.areConformationsEqual(O,B)||(C.createGeometry=!0),C.updateTransform&&(C.updateMatrix=!0),C.updateSize&&!("uSize"in b.values)&&(C.createGeometry=!0),(C.createGeometry||C.updateTransform)&&(I.structure.hashCode!==A.structure.hashCode&&(C.updateColor=!0,C.updateSize=!0),(x.color.granularity.startsWith("vertex")||b.values.dColorType.ref.value.startsWith("vertex")||x.color.granularity.startsWith("volume")||b.values.dColorType.ref.value.startsWith("volume"))&&(C.updateColor=!0))}function k(V){if(C.createNew)if(w=o(A,y),V)b=k7e(A,V,w,x,y,t),S=f(V,b.values);else throw new Error("expected geometry to be given");else{if(!b)throw new Error("expected renderObject to be available");if(C.updateTransform){w=o(A,y);let{instanceCount:q,groupCount:Q}=w;y.instanceGranularity?to(q,"instance",b.values):to(q*Q,"groupInstance",b.values)}if(C.updateMatrix&&(tz(A,y.includeParent,b.values.invariantBoundingSphere.ref.value,y.cellSize,y.batchSize,b.values),"lodLevels"in b.values&&G.update(b.values.lodLevels,b.values.lodLevels.ref.value)),C.createGeometry)if(V)G.updateIfChanged(b.values.drawCount,Mi.getDrawCount(V)),G.updateIfChanged(b.values.uVertexCount,Mi.getVertexCount(V)),G.updateIfChanged(b.values.uGroupCount,Mi.getGroupCount(V));else throw new Error("expected geometry to be given");(C.updateTransform||C.createGeometry)&&(p(b.values,V||T),S=f(V||T,b.values)),C.updateSize&&"uSize"in b.values&&Sl(w,x.size,b.values),C.updateColor&&$i(w,S,x.color,b.values),m(b.values,y),h(b.state,y)}v=y,_=x,I=A,V&&(T=V,E+=1)}function L(V,q,Q,O,B,j){return Wpe(B.unitKinds,q)?n(V,q,Q,O,B,j):d(j)}function R(V){return!!(cs(V)||qe.isLoci(V)&&qe.areRootsEquivalent(V.structure,I.structure)||ce.Loci.is(V)&&qe.areRootsEquivalent(V.structure,I.structure)&&ce.Loci.isWholeStructure(V))}function N(V,q,Q){let O=!1;if(_t.isLoci(V)){let{structure:B,group:j}=q;if(!qe.areEquivalent(V.structure,B))return!1;for(let U of V.bonds){if(U.aUnit!==U.bUnit)continue;let z=j.unitIndexMap.get(U.aUnit.id);z!==void 0&&Q(Be.ofSingleton(z))&&(O=!0)}}else if(ce.Loci.is(V)){let{structure:B,group:j}=q;if(!qe.areEquivalent(V.structure,B))return!1;for(let U of V.elements){let z=j.unitIndexMap.get(U.unit.id);z!==void 0&&Q(Be.ofSingleton(z))&&(O=!0)}}return O}function F(V,q,Q){return R(V)?v.instanceGranularity?q(Be.ofBounds(0,w.instanceCount)):q(Be.ofBounds(0,w.groupCount*w.instanceCount)):v.instanceGranularity?N(V,I,q):s(V,I,q,Q)}function H(V){b&&c?.(b.values,T,v,_,V.webgl)}return{get groupCount(){return w?w.count:0},get renderObject(){return w&&w.count?b:void 0},get geometryVersion(){return E},createOrUpdate(V,q,Q,O){if(P(q,Q,O||I),C.createGeometry){let B=L(V,A.group.units[0],A.structure,x,y,T);if(p0(B))return B.then(j=>{k(j),H(V)});k(B)}else k();H(V)},getLoci(V){return b?i(V,I,b.id):pr},eachLocation(V){for(w.reset();w.hasNext;){let{location:q,isSecondary:Q}=w.move();V(q,Q)}},mark(V,q){let Q=!0;if(ce.Loci.is(V)){Q=!1;let{invariantId:O}=I.group.units[0];for(let B of V.elements)if(B.unit.invariantId===O){Q=!0;break}}return Q?Er.mark(b,V,q,F,g):!1},setVisibility(V){Er.setVisibility(b,V)},setAlphaFactor(V){Er.setAlphaFactor(b,V)},setPickable(V){Er.setPickable(b,V)},setColorOnly(V){Er.setColorOnly(b,V)},setTransform(V,q){Er.setTransform(b,V,q)},setOverpaint(V,q){let Q={geometry:T,props:v,webgl:q};Er.setOverpaint(b,V,F,!0,Q)},setTransparency(V,q){let Q={geometry:T,props:v,webgl:q};Er.setTransparency(b,V,F,!0,Q)},setEmissive(V,q){let Q={geometry:T,props:v,webgl:q};Er.setEmissive(b,V,F,!0,Q)},setSubstance(V,q){let Q={geometry:T,props:v,webgl:q};Er.setSubstance(b,V,F,!0,Q)},setClipping(V){Er.setClipping(b,V,F,!0)},setThemeStrength(V){Er.setThemeStrength(b,V)},destroy(){u?.(T),b&&(b.state.disposed=!0,b=void 0)},mustRecreate:l}}var Xn={...lM,...cc};function xo(e,t){return zy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.createGeometry=!0)},geometryUtils:Ct.Utils},t)}var hS={...cM,...cc};function gS(e,t){return zy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.updateSize=!0)},geometryUtils:Ra.Utils},t)}var yS={...uM,...cc};function vS(e,t){return zy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.updateSize=!0)},geometryUtils:ss.Utils},t)}var ufe={...Ype,...cc};function dfe(e,t){return zy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.updateSize=!0)},geometryUtils:Gu.Utils},t)}var Hy={...dM,...cc};function jy(e,t){return zy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.updateSize=!0)},geometryUtils:In.Utils},t)}var O0r={...mM,...cc};var mfe={...pM,...cc};function pfe(e,t){return zy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.createGeometry=!0)},geometryUtils:el.Utils},t)}var ffe={...fM,...cc};function hfe(e,t){return zy({...e,setUpdateState:(r,n,o,i,s,a,l)=>{e.setUpdateState(r,n,o,i,s,a,l),Vi.areEqual(i.size,s.size)||(r.createGeometry=!0)},geometryUtils:Ns.Utils},t)}var so={create:()=>({...Wt.createState(),unitTransforms:null,unitTransformsVersion:-1}),update:(e,t)=>{Wt.updateState(e,t),t.unitTransforms!==void 0&&(e.unitTransforms=t.unitTransforms)}};var Og=D(),bS=D(),Dw=D(),hM=it.add,gfe=it.add3,$y;(function(e){function t(r=2048,n=1024,o){let i=it.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r),s=it.create(Float32Array,3,n,o?o.startBuffer.ref.value:r),a=it.create(Float32Array,3,n,o?o.endBuffer.ref.value:r),l=it.create(Float32Array,1,n,o?o.scaleBuffer.ref.value:r),c=it.create(Float32Array,1,n,o?o.capBuffer.ref.value:r),u=it.create(Float32Array,1,n,o?o.colorModeBuffer.ref.value:r),d=(p,h,f,C,g,b,y,x,A,v,_)=>{for(let I=0;I<6;++I)gfe(s,p,h,f),gfe(a,C,g,b),hM(i,_),hM(l,y),hM(c,(x?1:0)+(A?2:0)),hM(u,v)},m=(p,h,f,C,g,b,y,x,A)=>{let v=D.distance(p,h),_=f%2!==0,I=Math.floor((f+1)/2),T=v/(f+.5),E=2;D.setMagnitude(Dw,D.sub(Dw,h,p),T),D.copy(Og,p);for(let w=0;w<I;++w)D.add(Og,Og,Dw),_&&w===I-1?(D.copy(bS,h),y||(b=!1)):D.add(bS,Og,Dw),x&&(E=D.distance(p,bS)/(v*2)),d(Og[0],Og[1],Og[2],bS[0],bS[1],bS[2],C,g,b,E,A),D.add(Og,Og,Dw)};return{add:d,addFixedCountDashes:m,addFixedLengthDashes:(p,h,f,C,g,b,y,x)=>{let A=D.distance(p,h);m(p,h,A/f,C,g,b,!0,y,x)},getCylinders:()=>{let p=i.elementCount/6,h=it.compact(i,!0),f=it.compact(s,!0),C=it.compact(a,!0),g=it.compact(l,!0),b=it.compact(c,!0),y=it.compact(u,!0),x=o&&p<=o.cylinderCount?o.mappingBuffer.ref.value:new Float32Array(p*18),A=o&&p<=o.cylinderCount?o.indexBuffer.ref.value:new Uint32Array(p*12);return(!o||p>o.cylinderCount)&&M7e(p,x,A),ss.create(x,A,h,f,C,g,b,y,p,o)}}}e.create=t})($y||($y={}));function M7e(e,t,r){for(let n=0;n<e;++n){let o=n*18;t[o]=-1,t[o+1]=1,t[o+2]=-1,t[o+3]=-1,t[o+4]=-1,t[o+5]=-1,t[o+6]=1,t[o+7]=1,t[o+8]=-1,t[o+9]=1,t[o+10]=1,t[o+11]=1,t[o+12]=1,t[o+13]=-1,t[o+14]=-1,t[o+15]=1,t[o+16]=-1,t[o+17]=1}for(let n=0;n<e;++n){let o=n*6,i=n*12;r[i]=o,r[i+1]=o+1,r[i+2]=o+2,r[i+3]=o+1,r[i+4]=o+4,r[i+5]=o+2,r[i+6]=o+2,r[i+7]=o+4,r[i+8]=o+3,r[i+9]=o+4,r[i+10]=o+5,r[i+11]=o+3}}var Ld={linkScale:M.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:M.Numeric(1,{min:0,max:2,step:.01}),linkCap:M.Boolean(!1),aromaticScale:M.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:M.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:M.Numeric(2,{min:1,max:6,step:1}),dashCount:M.Numeric(4,{min:0,max:10,step:1}),dashScale:M.Numeric(.8,{min:0,max:2,step:.1}),dashCap:M.Boolean(!0),stubCap:M.Boolean(!0),radialSegments:M.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo),colorMode:M.Select("default",M.arrayToOptions(["default","interpolate"]),at.ShadingCategory)},ayr=M.getDefaultValues(Ld),nz={linkScale:M.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:M.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:M.Numeric(2,{min:1,max:6,step:1}),dashCount:M.Numeric(4,{min:0,max:10,step:1})},lyr=M.getDefaultValues(nz),Bo=D(),Wy=D(),Fm=D(),R7e=D.create(0,1,0);function oz(e,t,r,n){D.normalize(Wy,D.sub(Wy,t,r)),n!==null?D.sub(Fm,t,n):D.copy(Fm,t),D.normalize(Fm,Fm);let o=D.dot(Wy,Fm);return 1-Math.abs(o)<1e-5&&(D.set(Fm,1,0,0),o=D.dot(Wy,Fm),1-Math.abs(o)<1e-5&&(D.set(Fm,0,1,0),o=D.dot(Wy,Fm))),D.setMagnitude(Wy,Wy,o),D.sub(Fm,Fm,Wy),D.normalize(e,Fm)}var Jp=D.scale,Gi=D.add,js=D.sub,Vl=D.setMagnitude,B7e=D.dot;function ed(e,t,r,n){let{linkCount:o,referencePosition:i,position:s,style:a,radius:l,ignore:c,stub:u}=t;if(!o)return{mesh:Ct.createEmpty(n)};let{linkScale:d,linkSpacing:m,radialSegments:p,linkCap:h,aromaticScale:f,aromaticSpacing:C,aromaticDashCount:g,dashCount:b,dashScale:y,dashCap:x,stubCap:A}=r,v=p*2*o*2,_=gt.createState(v,v/4,n),I=D(),T=D(),E=D(),w=D(),S=0,P={radiusTop:1,radiusBottom:1,radialSegments:p,topCap:h,bottomCap:h};for(let R=0,N=o;R<N;++R){if(c&&c(R))continue;s(I,T,R),Gi(w,w,I),Gi(w,w,T),S+=2,js(Bo,T,I);let F=B7e(Bo,R7e)>0,H=l(R),V=a?a(R):0,q=A&&(u?u(R):!1),[Q,O]=F?[q,h]:[h,q];if(_.currentGroup=R,V===0)P.radiusTop=P.radiusBottom=H,P.topCap=Q,P.bottomCap=O,zr(_,I,T,.5,P);else if(V===1)P.radiusTop=P.radiusBottom=H*y,P.topCap=P.bottomCap=x,_b(_,I,T,.5,b,q,P);else if(V===2||V===3||V===4||V===5||V===7||V===8){let B=V===2||V===3?2:V===4||V===5?3:1.5,j=H*(d/(.5*B)),U=(H-j)*m;if(oz(E,I,T,i?i(R):null),P.topCap=Q,P.bottomCap=O,V===7||V===8){P.radiusTop=P.radiusBottom=H,zr(_,I,T,.5,P);let z=H+f*H+f*H*C;Vl(Bo,js(Bo,T,I),H*.5),Gi(I,I,Bo),js(T,T,Bo),P.radiusTop=P.radiusBottom=H*f,P.topCap=P.bottomCap=x,Vl(E,E,z),js(I,I,E),js(T,T,E),_b(_,I,T,.5,g,q,P),V===8&&(Vl(E,E,z*2),Gi(I,I,E),Gi(T,T,E),_b(_,I,T,.5,g,q,P))}else if(V===3||V===5){let z=H+j+d*H*m;Vl(E,E,z),P.radiusTop=P.radiusBottom=H,zr(_,I,T,.5,P),Jp(Bo,Bo,m*d*.2),Gi(I,I,Bo),js(T,T,Bo),P.radiusTop=P.radiusBottom=j,P.topCap=F?q:x,P.bottomCap=F?x:q,Vl(E,E,z),js(I,I,E),js(T,T,E),zr(_,I,T,.5,P),B===3&&(Vl(E,E,z*2),Gi(I,I,E),Gi(T,T,E),zr(_,I,T,.5,P))}else Vl(E,E,U),P.radiusTop=P.radiusBottom=j,B===3&&zr(_,I,T,.5,P),dre(_,I,T,.5,E,P)}else V===6&&(Jp(Bo,Bo,.475),Gi(I,I,Bo),js(T,T,Bo),P.radiusTop=P.radiusBottom=H,P.topCap=Q,P.bottomCap=O,zr(_,I,T,.5,P))}let k=n?Pe.clone(n.boundingSphere):void 0,L=gt.getMesh(_);return S===0?{mesh:L}:(D.scale(w,w,1/S),k&&D.distance(w,k.center)/k.radius<.1?{mesh:L,boundingSphere:k}:{mesh:L})}function gM(e,t,r,n){let{linkCount:o,referencePosition:i,position:s,style:a,radius:l,ignore:c,stub:u}=t;if(!o)return{cylinders:ss.createEmpty(n)};let{linkScale:d,linkSpacing:m,linkCap:p,aromaticScale:h,aromaticSpacing:f,aromaticDashCount:C,dashCount:g,dashScale:b,dashCap:y,stubCap:x,colorMode:A}=r,v=A==="interpolate",_=v===!0?3:2,I=o*2,T=$y.create(I,I/4,n),E=D(),w=D(),S=D(),P=D(),k=D(),L=0;for(let F=0,H=o;F<H;++F){if(c&&c(F))continue;s(E,w,F),Gi(k,k,E),Gi(k,k,w),L+=2;let V=l(F),q=a?a(F):0,Q=x&&(u?u(F):!1);if(q===0)Jp(S,Gi(S,E,w),.5),T.add(E[0],E[1],E[2],S[0],S[1],S[2],1,p,Q,_,F);else if(q===1)Jp(S,Gi(S,E,w),.5),T.addFixedCountDashes(E,S,g,b,y,y,Q,v,F);else if(q===2||q===3||q===4||q===5||q===7||q===8){let O=q===2||q===3?2:q===4||q===5?3:1.5,B=d/(.5*O),j=(V-B*V)*m;if(Jp(S,Gi(S,E,w),.5),oz(P,E,w,i?i(F):null),q===7||q===8){T.add(E[0],E[1],E[2],S[0],S[1],S[2],1,p,Q,_,F);let U=V+h*V+h*V*f;Vl(Bo,js(Bo,w,E),V*.5),Gi(E,E,Bo),Vl(P,P,U),js(E,E,P),js(S,S,P),T.addFixedCountDashes(E,S,C,h,y,y,Q,v,F),q===8&&(Vl(P,P,U*2),Gi(E,E,P),Gi(S,S,P),T.addFixedCountDashes(E,S,C,h,y,y,Q,v,F))}else if(q===3||q===5){let U=V+B*V+d*V*m;Vl(P,P,U),T.add(E[0],E[1],E[2],S[0],S[1],S[2],1,p,Q,_,F),Vl(Bo,js(Bo,E,S),V/1.5),js(E,E,Bo),O===3&&T.add(E[0]+P[0],E[1]+P[1],E[2]+P[2],S[0]+P[0],S[1]+P[1],S[2]+P[2],B,p,Q,_,F),T.add(E[0]-P[0],E[1]-P[1],E[2]-P[2],S[0]-P[0],S[1]-P[1],S[2]-P[2],B,y,Q,_,F)}else Vl(P,P,j),O===3&&T.add(E[0],E[1],E[2],S[0],S[1],S[2],B,p,Q,_,F),T.add(E[0]+P[0],E[1]+P[1],E[2]+P[2],S[0]+P[0],S[1]+P[1],S[2]+P[2],B,p,Q,_,F),T.add(E[0]-P[0],E[1]-P[1],E[2]-P[2],S[0]-P[0],S[1]-P[1],S[2]-P[2],B,p,Q,_,F)}else q===6&&(Jp(Bo,js(Bo,S,E),.475),Gi(E,E,Bo),js(S,S,Bo),T.add(E[0],E[1],E[2],S[0],S[1],S[2],1,p,Q,_,F))}let R=n?Pe.clone(n.boundingSphere):void 0,N=T.getCylinders();return L===0?{cylinders:N}:(D.scale(k,k,1/L),R&&D.distance(k,R.center)/R.radius<.1?{cylinders:N,boundingSphere:R}:{cylinders:N})}function yM(e,t,r,n){let{linkCount:o,referencePosition:i,position:s,style:a,ignore:l}=t;if(!o)return{lines:In.createEmpty(n)};let{linkScale:c,linkSpacing:u,aromaticDashCount:d,dashCount:m}=r,p=o*2,h=ga.create(p,p/4,n),f=D(),C=D(),g=D(),b=D(),y=D(),x=0,A=4.5,v=3;for(let T=0,E=o;T<E;++T){if(l&&l(T))continue;s(f,C,T),Gi(y,y,f),Gi(y,y,C),x+=2;let w=a?a(T):0;if(w===0)Jp(g,Gi(g,f,C),.5),h.add(f[0],f[1],f[2],g[0],g[1],g[2],T);else if(w===1)Jp(g,Gi(g,f,C),.5),h.addFixedCountDashes(f,g,m,T);else if(w===2||w===3||w===4||w===5||w===7||w===8){let S=w===2||w===3?2:w===4||w===5?3:1.5,k=(1-1*(c/(.5*S)))*u;if(Jp(g,Gi(g,f,C),.5),oz(b,f,C,i?i(T):null),w===7||w===8){h.add(f[0],f[1],f[2],g[0],g[1],g[2],T);let L=k*A;Vl(Bo,js(Bo,C,f),L*.5),Gi(f,f,Bo),Vl(b,b,L),js(f,f,b),js(g,g,b),h.addFixedCountDashes(f,g,d,T),w===8&&(Vl(b,b,L*2),Gi(f,f,b),Gi(g,g,b),h.addFixedCountDashes(f,g,d,T))}else w===3||w===5?(Vl(b,b,k*v),h.add(f[0],f[1],f[2],g[0],g[1],g[2],T),Jp(Bo,js(Bo,f,g),u*c),js(f,f,Bo),S===3&&h.add(f[0]+b[0],f[1]+b[1],f[2]+b[2],g[0]+b[0],g[1]+b[1],g[2]+b[2],T),h.add(f[0]-b[0],f[1]-b[1],f[2]-b[2],g[0]-b[0],g[1]-b[1],g[2]-b[2],T)):(Vl(b,b,k*1.5),S===3&&h.add(f[0],f[1],f[2],g[0],g[1],g[2],T),h.add(f[0]+b[0],f[1]+b[1],f[2]+b[2],g[0]+b[0],g[1]+b[1],g[2]+b[2],T),h.add(f[0]-b[0],f[1]-b[1],f[2]-b[2],g[0]-b[0],g[1]-b[1],g[2]-b[2],T))}else w===6&&(Jp(Bo,js(Bo,g,f),.475),Gi(f,f,Bo),js(g,g,Bo),h.add(f[0],f[1],f[2],g[0],g[1],g[2],T))}let _=n?Pe.clone(n.boundingSphere):void 0,I=h.getLines();return x===0?{lines:I}:(D.scale(y,y,1/x),_&&D.distance(y,_.center)/_.radius<.1?{lines:I,boundingSphere:_}:{lines:I})}var vM={sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),dashCount:M.Numeric(6,{min:1,max:10,step:1}),dashScale:M.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),includeParent:M.Boolean(!1),parentDisplay:M.Select("stub",M.arrayToOptions(["stub","full","between"]),{description:'Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.'})};async function L7e(e,t,r,n,o,i){if(!Le.isAtomic(t))return Ct.createEmpty(i);let{child:s}=r,a=s?.unitMap.get(t.id);if(s&&!a)return Ct.createEmpty(i);let l=ce.Location.create(r,t),c=li.get(r).value,u=c.unitsFeatures.get(t.id),d=c.unitsContacts.get(t.id),{x:m,y:p,z:h,members:f,offsets:C}=u,{edgeCount:g,a:b,b:y,edgeProps:{flag:x,type:A}}=d,{sizeFactor:v,ignoreHydrogens:_,ignoreHydrogensVariant:I,parentDisplay:T}=o;if(!g)return Ct.createEmpty(i);let{elements:E,conformation:w}=t,S=D(),P=D(),k=D(),L={linkCount:g*2,position:(F,H,V)=>{let q=A[V];if((!_||I!=="all")&&(q===Or.HydrogenBond||q===Or.WeakHydrogenBond)){let Q=f[C[b[V]]],O=f[C[y[V]]];w.invariantPosition(E[Q],P),w.invariantPosition(E[O],k);let B=D.distance(P,k),j=B;D.copy(F,P),D.copy(H,k),qk(t,Q,(U,z)=>{if(uu(r,t,E[z],"polar")){w.invariantPosition(E[z],S);let $=D.distance(S,k);$<B&&(B=$,D.copy(F,S))}}),qk(t,O,(U,z)=>{if(uu(r,t,E[z],"polar")){w.invariantPosition(E[z],S);let $=D.distance(S,P);$<j&&(j=$,D.copy(H,S))}})}else D.set(F,m[b[V]],p[b[V]],h[b[V]]),D.set(H,m[y[V]],p[y[V]],h[y[V]])},style:F=>1,radius:F=>{l.element=E[f[C[b[F]]]];let H=n.size.size(l);l.element=E[f[C[y[F]]]];let V=n.size.size(l);return Math.min(H,V)*v},ignore:F=>{if(x[F]===cu.Filtered)return!0;if(a)if(T==="stub"){let H=b[F];for(let V=C[H],q=C[H+1];V<q;++V){let Q=E[f[C[V]]];if(!Qe.has(a.elements,Q))return!0}}else if(T==="full"||T==="between"){let H=!1,V=!1,q=b[F];for(let O=C[q],B=C[q+1];O<B;++O){let j=E[f[C[O]]];Qe.has(a.elements,j)||(H=!0)}let Q=y[F];for(let O=C[Q],B=C[Q+1];O<B;++O){let j=E[f[C[O]]];Qe.has(a.elements,j)||(V=!0)}return T==="full"?H&&V:H===V}else Sr(T);return!1}},{mesh:R,boundingSphere:N}=ed(e,L,o,i);if(N)R.setBoundingSphere(N);else if(R.triangleCount>0){let F=Pe.expand(Pe(),(a??t).boundary.sphere,1*v);R.setBoundingSphere(F)}return R}var sz={...Xn,...Ld,...vM};function yfe(e){return xo({defaultProps:M.getDefaultValues(sz),createGeometry:L7e,createLocationIterator:O7e,getLoci:N7e,eachLocation:F7e,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;let l=li.get(s.structure).version;t.info.interactionsHash!==l&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=l)}},e)}function N7e(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:s,group:a}=t,l=s.unitMap.get(a.units[o].id),c=li.get(s).value,{a:u,b:d}=c.unitsContacts.get(l.id);return Bm.Loci(s,c,[{unitA:l,indexA:u[i],unitB:l,indexB:d[i]},{unitA:l,indexA:d[i],unitB:l,indexB:u[i]}])}return pr}var iz=new Set;function F7e(e,t,r,n){let o=!1;if(Bm.isLoci(e)){let{structure:i,group:s}=t;if(!qe.areEquivalent(e.data.structure,i))return!1;let a=li.get(i).value;if(e.data.interactions!==a)return!1;let l=s.units[0],c=a.unitsContacts.get(l.id),u=c.edgeCount*2;for(let d of e.elements){if(d.unitA!==d.unitB)continue;let m=s.unitIndexMap.get(d.unitA.id);if(m!==void 0){let p=c.getDirectedEdgeIndex(d.indexA,d.indexB);p!==-1&&r(Be.ofSingleton(m*u+p))&&(o=!0)}}}else if(ce.Loci.is(e)){let{structure:i,group:s}=t;if(!qe.areEquivalent(e.structure,i))return!1;let a=li.get(i).value;if(!a)return!1;let l=s.units[0],c=a.unitsContacts.get(l.id),u=a.unitsFeatures.get(l.id),d=c.edgeCount*2,{offset:m}=c,{offsets:p,indices:h}=u.elementsIndex,{members:f,offsets:C}=u;for(let g of e.elements){let b=s.unitIndexMap.get(g.unit.id);b!==void 0&&(Ge.forEach(g.indices,y=>{for(let x=p[y],A=p[y+1];x<A;++x){let v=h[x];for(let _=m[v],I=m[v+1];_<I;++_)iz.add(_)}}),iz.forEach(y=>{if(n){let x=c.a[y];for(let v=C[x],_=C[x+1];v<_;++v)if(!Ge.has(g.indices,f[v]))return;let A=c.b[y];for(let v=C[A],_=C[A+1];v<_;++v)if(!Ge.has(g.indices,f[v]))return}r(Be.ofSingleton(b*d+y))&&(o=!0)}),iz.clear())}}return o}function O7e(e){let{structure:t,group:r}=e,n=r.units[0],o=li.get(t).value,i=o.unitsContacts.get(n.id),s=i.edgeCount*2,a=r.units.length,l=Bm.Location(o,t),{element:c}=l;return Mr(s,a,1,(d,m)=>{let p=r.units[m];return c.unitA=p,c.indexA=i.a[d],c.unitB=p,c.indexB=i.b[d],l})}function V7e(e,t,r,n,o){if(!t.hasAtomic)return Ct.createEmpty(o);let i=ce.Location.create(t),s=li.get(t).value,{contacts:a,unitsFeatures:l}=s,{edgeCount:c,edges:u}=a,{sizeFactor:d,ignoreHydrogens:m,ignoreHydrogensVariant:p,parentDisplay:h}=n;if(!c)return Ct.createEmpty(o);let{child:f}=t,C=D(),g=D(),b=D(),y={linkCount:c,position:(v,_,I)=>{let{unitA:T,indexA:E,unitB:w,indexB:S,props:{type:P}}=u[I],k=l.get(T),L=l.get(w),R=t.unitMap.get(T),N=t.unitMap.get(w);if((!m||p!=="all")&&(P===Or.HydrogenBond||P===Or.WeakHydrogenBond)){let F=k.members[k.offsets[E]],H=L.members[L.offsets[S]];R.conformation.position(R.elements[F],g),N.conformation.position(N.elements[H],b);let V=D.distance(g,b),q=V;D.copy(v,g),D.copy(_,b),ba(t,R,F,(Q,O)=>{let B=Q.elements[O];if(uu(t,Q,B,"polar")){Q.conformation.position(B,C);let j=D.distance(C,b);j<V&&(V=j,D.copy(v,C))}}),ba(t,N,H,(Q,O)=>{let B=Q.elements[O];if(uu(t,Q,B,"polar")){Q.conformation.position(B,C);let j=D.distance(C,g);j<q&&(q=j,D.copy(_,C))}})}else D.set(v,k.x[E],k.y[E],k.z[E]),D.transformMat4(v,v,R.conformation.operator.matrix),D.set(_,L.x[S],L.y[S],L.z[S]),D.transformMat4(_,_,N.conformation.operator.matrix)},style:v=>1,radius:v=>{let _=u[v],I=l.get(_.unitA);i.unit=t.unitMap.get(_.unitA),i.element=i.unit.elements[I.members[I.offsets[_.indexA]]];let T=r.size.size(i),E=l.get(_.unitB);i.unit=t.unitMap.get(_.unitB),i.element=i.unit.elements[E.members[E.offsets[_.indexB]]];let w=r.size.size(i);return Math.min(T,w)*d},ignore:v=>{if(u[v].props.flag===cu.Filtered)return!0;if(f){let _=u[v];if(h==="stub"){let I=f.unitMap.get(_.unitA);if(!I)return!0;let T=t.unitMap.get(_.unitA),{offsets:E,members:w}=l.get(_.unitA);for(let S=E[_.indexA],P=E[_.indexA+1];S<P;++S){let k=T.elements[w[S]];if(!Qe.has(I.elements,k))return!0}}else if(h==="full"||h==="between"){let I=!1,T=!1,E=f.unitMap.get(_.unitA);if(!E)I=!0;else{let S=t.unitMap.get(_.unitA),{offsets:P,members:k}=l.get(_.unitA);for(let L=P[_.indexA],R=P[_.indexA+1];L<R;++L){let N=S.elements[k[L]];Qe.has(E.elements,N)||(I=!0)}}let w=f.unitMap.get(_.unitB);if(!w)T=!0;else{let S=t.unitMap.get(_.unitB),{offsets:P,members:k}=l.get(_.unitB);for(let L=P[_.indexB],R=P[_.indexB+1];L<R;++L){let N=S.elements[k[L]];Qe.has(w.elements,N)||(T=!0)}}return h==="full"?I&&T:I===T}else Sr(h)}return!1}},{mesh:x,boundingSphere:A}=ed(e,y,n,o);if(A)x.setBoundingSphere(A);else if(x.triangleCount>0){let{child:v}=t,_=Pe.expand(Pe(),(v??t).boundary.sphere,1*d);x.setBoundingSphere(_)}return x}var lz={...Nm,...Ld,...vM};function vfe(e){return Ol({defaultProps:M.getDefaultValues(lz),createGeometry:V7e,createLocationIterator:z7e,getLoci:G7e,eachLocation:U7e,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.radialSegments!==n.radialSegments||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.parentDisplay!==n.parentDisplay;let l=li.get(s).version;t.info.interactionsHash!==l&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=l)}},e)}function G7e(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=li.get(t).value,s=i.contacts.edges[o],a=t.unitMap.get(s.unitA),l=t.unitMap.get(s.unitB);return Bm.Loci(t,i,[{unitA:a,indexA:s.indexA,unitB:l,indexB:s.indexB},{unitA:l,indexA:s.indexB,unitB:a,indexB:s.indexA}])}return pr}var bM=new Map,az=new Set;function U7e(e,t,r,n){let o=!1;if(Bm.isLoci(e)){if(!qe.areEquivalent(e.data.structure,t))return!1;let i=li.get(t).value;if(e.data.interactions!==i)return!1;let{contacts:s}=i;for(let a of e.elements){let l=s.getEdgeIndex(a.indexA,a.unitA.id,a.indexB,a.unitB.id);l!==-1&&r(Be.ofSingleton(l))&&(o=!0)}}else if(ce.Loci.is(e)){if(!qe.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;let i=li.get(t).value;if(!i)return!1;let{contacts:s,unitsFeatures:a}=i;for(let l of e.elements)bM.set(l.unit.id,l.indices);for(let l of e.elements){let{unit:c}=l;Le.isAtomic(c)&&Ge.forEach(l.indices,u=>{for(let d of s.getContactIndicesForElement(u,c))az.add(d)})}az.forEach(l=>{if(n){let{indexA:c,unitA:u,indexB:d,unitB:m}=s.edges[l],p=bM.get(u),h=bM.get(m);if(!p||!h)return;let{offsets:f,members:C}=a.get(u);for(let y=f[c],x=f[c+1];y<x;++y)if(!Ge.has(p,C[y]))return;let{offsets:g,members:b}=a.get(m);for(let y=g[d],x=g[d+1];y<x;++y)if(!Ge.has(h,b[y]))return}r(Be.ofSingleton(l))&&(o=!0)}),bM.clear(),az.clear()}return o}function z7e(e){let t=li.get(e).value,{contacts:r}=t,n=r.edgeCount,o=1,i=Bm.Location(t,e),{element:s}=i;return Mr(n,o,1,l=>{let c=r.edges[l];return s.unitA=e.unitMap.get(c.unitA),s.indexA=c.indexA,s.unitB=e.unitMap.get(c.unitB),s.indexB=c.indexB,i},!0)}var bfe={"intra-unit":(e,t)=>Fn("Intra-unit interactions cylinder",e,t,yfe),"inter-unit":(e,t)=>us("Inter-unit interactions cylinder",e,t,vfe)},xfe={...sz,...lz,unitKinds:Fg(["atomic"]),sizeFactor:M.Numeric(.2,{min:.01,max:1,step:.01}),visuals:M.MultiSelect(["intra-unit","inter-unit"],M.objectToOptions(bfe))};function H7e(e,t){return M.clone(xfe)}function j7e(e,t){return Wt.createMulti("Interactions",e,t,so,bfe)}var xS={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:j7e,getParams:H7e,defaultValues:M.getDefaultValues(xfe),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&li.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>li.attach(e,t,void 0,!0),detach:e=>li.ref(e,!1)},getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};var Cfe=tr.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:class extends tr.Handler{constructor(){super(...arguments),this.provider=li,this.labelProvider={label:e=>{if(this.params.showTooltip)switch(e.kind){case"element-loci":if(e.elements.length===0)return;let t=[],r=this.getStructures(e.structure);for(let n of r){let o=this.provider.get(n).value;if(!o)continue;let i=ce.Loci.remap(e,n);if(i.elements.length!==1)continue;let s=i.elements[0];if(Ge.size(s.indices)!==1)continue;let a=o.unitsFeatures.get(s.unit.id);if(!a)continue;let l=[],c=[],u=[],d=Ge.start(s.indices),{types:m,groups:p,elementsIndex:{indices:h,offsets:f}}=a;for(let C=f[d],g=f[d+1];C<g;++C){let b=h[C],y=m[b],x=p[b];y&&l.push(Wme(y)),x&&c.push(qme(x))}l.length&&u.push(`<small>Types</small> ${l.join(", ")}`),c.length&&u.push(`<small>Groups</small> ${c.join(", ")}`),u.length&&t.push(`Interaction Feature: ${u.join(" | ")}`)}return t.length?t.join("<br/>"):void 0;default:return}}}}getStructures(e){let t=[],r=this.ctx.helpers.substructureParent.get(e);if(r){let o=this.ctx.state.data.select(Kt.Generators.ofType(fe.Molecule.Structure,r.transform.ref));for(let i of o)i.obj&&Ho(t,i.obj.data)}return t}update(e){let t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Pw),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(xS)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Pw),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(xS)}},params:()=>({autoAttach:M.Boolean(!1),showTooltip:M.Boolean(!0)})});var Sfe=tr.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:class extends tr.Handler{constructor(){super(...arguments),this.provider=tl}update(e){let t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)}},params:()=>({autoAttach:M.Boolean(!1)})});var Ife=tr.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:class extends tr.Handler{constructor(){super(...arguments),this.provider=nh,this.labelProvider={label:e=>{if(this.params.showTooltip)switch(e.kind){case"element-loci":if(e.elements.length===0)return;let t=[],r=this.getStructures(e.structure);for(let n of r){let o=this.provider.get(n).value;if(!o)continue;let i=ce.Loci.remap(e,n);if(i.elements.length!==1)continue;let s=i.elements[0];if(Ge.size(s.indices)!==1)continue;let a=o.get(s.unit.id);if(!a)continue;let l=Ge.start(s.indices),c=a.charge[l],u=a.idealGeometry[l],d=a.implicitH[l],m=a.totalH[l];t.push(`Valence Model: <small>Charge</small> ${c} | <small>Ideal Geometry</small> ${Hme(u)} | <small>Implicit H</small> ${d} | <small>Total H</small> ${m}`)}return t.length?t.join("<br/>"):void 0;default:return}}}}getStructures(e){let t=[],r=this.ctx.helpers.substructureParent.get(e);if(r){let o=this.ctx.state.data.select(Kt.Generators.ofType(fe.Molecule.Structure,r.transform.ref));for(let i of o)i.obj&&Ho(t,i.obj.data)}return t}update(e){let t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:M.Boolean(!1),showTooltip:M.Boolean(!0)})});var cz=ze(16448250),$7e="Assigns a color based on SIFTS mapping.",kw=new Map,Afe={...ni({type:"colors",colorList:"set-1"})};function W7e(e){return Afe}function wfe(e,t){let r;if(e.structure){for(let a of e.structure.models){let l=ic.Provider.get(a).value;if(l)for(let c of l.accession)!c||kw.has(c)||kw.set(c,kw.size)}let n=ce.Location.create(e.structure),o=pi(kw.size+1,t,{valueLabel:a=>`${a}`}),i=new Map,s=a=>{let l=ic.getKey(a);if(!l)return cz;if(i.has(l))return i.get(l);let c=o.color(kw.get(l));return i.set(l,c),c};r=a=>ce.Location.is(a)&&Le.isAtomic(a.unit)?s(a):_t.isLocation(a)?(n.unit=a.aUnit,n.element=a.aUnit.elements[a.aIndex],s(n)):cz}else r=()=>cz;return{factory:wfe,granularity:"group",preferSmoothing:!0,color:r,props:t,description:$7e}}var uz={name:"sifts-mapping",label:"SIFTS Mapping",category:oi.Category.Residue,factory:wfe,getParams:W7e,defaultValues:M.getDefaultValues(Afe),isApplicable:e=>{var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(r=>ic.Provider.isApplicable(r)))},ensureCustomProperties:{attach:async(e,t)=>{if(t.structure)for(let r of t.structure.models)await ic.Provider.attach(e,r,void 0,!0)},detach:e=>{if(e.structure)for(let t of e.structure.models)ic.Provider.ref(t,!1)}}};var _fe=tr.create({name:"sifts-mapping-prop",category:"custom-props",display:{name:"SIFTS Mapping"},ctor:class extends tr.Handler{constructor(){super(...arguments),this.provider=ic.Provider,this.labelProvider={label:e=>{if(this.params.showTooltip)return q7e(e)}}}update(e){let t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(uz),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(uz),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:M.Boolean(!0),showTooltip:M.Boolean(!0)})});function q7e(e){if(e.kind==="element-loci"){if(e.elements.length===0)return;let t=e.elements[0],r=t.unit,n=ce.Location.create(e.structure,r,r.elements[Ge.getAt(t.indices,0)]);return ic.getLabel(n)}}var ef;(function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=ea.create(e.Descriptor);function t(r,n){let o={entity_id:r.entity_id_1,asym_id:r.asym_id_1,seq_id:r.seq_id_1,atom_id:r.atom_id_1},i={entity_id:r.entity_id_2,asym_id:r.asym_id_2,seq_id:r.seq_id_2,atom_id:r.atom_id_2};function s(p,h,f){let C=p.get(h);C?C.push(f):p.set(h,[f])}function a(p,h){let f=h.entity_id.value(p),C=h.asym_id.value(p),g=h.seq_id.value(p);if(r.model_granularity.value(p)==="by-atom"){let b=n.atomicHierarchy.index.findAtom({auth_seq_id:g,label_asym_id:C,label_atom_id:h.atom_id.value(p),label_entity_id:f});b>=0&&s(c,b,p)}else if(n.coarseHierarchy.isDefined){let b=n.coarseHierarchy.spheres.findSequenceKey(f,C,g);if(b>=0)s(u,b,p);else{let y=n.coarseHierarchy.gaussians.findSequenceKey(f,C,g);y>=0&&s(d,y,p)}}}function l(p){switch(p){case 0:return c;case 1:return u;case 2:return d}}let c=new Map,u=new Map,d=new Map,m=[];for(let p=0;p<r._rowCount;++p)a(p,o),a(p,i);return{getIndicesByElement:(p,h)=>{let C=l(h).get(p);return C!==void 0?C:m},data:r}}e.fromTable=t})(ef||(ef={}));var Z7e=[];function Tfe(e,t,r,n){return`${e}|${t.id}|${r}|${n.id}`}var Mw=class{getPairIndices(t,r,n,o){let i=Tfe(t,r,n,o);return this.pairKeyIndices.get(i)||Z7e}getPairs(t,r,n,o){return this.getPairIndices(t,r,n,o).map(s=>this.pairs[s])}constructor(t){this.pairs=t;let r=new Map;this.pairs.forEach((n,o)=>{let i=Tfe(n.indexA,n.unitA,n.indexB,n.unitB),s=r.get(i);s?s.push(o):r.set(i,[o])}),this.count=t.length,this.pairKeyIndices=r}};var tf=iu.createProvider({label:"Cross Link Restraint",descriptor:Ci({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:e=>({}),isApplicable:e=>e.models.some(t=>!!ef.Provider.get(t)),obtain:async(e,t,r)=>({value:Y7e(t)})});var Nd;(function(e){let t;(function(f){f.CrossLinkRestraint="cross-link-restraint"})(t=e.Tag||(e.Tag={}));function r(f){return f.models.some(C=>!!ef.Provider.get(C))}e.isApplicable=r;let n=D(),o=D();function i(f){return f.unitA.conformation.position(f.unitA.elements[f.indexA],n),f.unitB.conformation.position(f.unitB.elements[f.indexB],o),D.distance(n,o)}e.distance=i;function s(f,C,g){return s3("cross-link-restraints",{structure:C,crossLinkRestraints:f},g)}e.Location=s;function a(f){return!!f&&f.kind==="data-location"&&f.tag==="cross-link-restraints"}e.isLocation=a;function l(f,C){return f.data.structure===C.data.structure&&f.data.crossLinkRestraints===C.data.crossLinkRestraints&&f.element===C.element}e.areLocationsEqual=l;function c(f,C){let g=f.pairs[C];return`Cross Link Restraint | Type: ${g.restraintType} | Threshold: ${g.distanceThreshold} \u212B | Psi: ${g.psi} | Sigma 1: ${g.sigma1} | Sigma 2: ${g.sigma2} | Distance: ${i(g).toFixed(2)} \u212B`}function u(f){return c(f.data.crossLinkRestraints,f.element)}e.locationLabel=u;function d(f,C,g){return by("cross-link-restraints",{structure:f,crossLinkRestraints:C},g,b=>p(C,g,b),()=>h(f,C,g))}e.Loci=d;function m(f){return!!f&&f.kind==="data-loci"&&f.tag==="interactions"}e.isLoci=m;function p(f,C,g){return ec.fromPairProvider(C.length,(b,y,x)=>{let A=f.pairs[C[b]];A.unitA.conformation.position(A.unitA.elements[A.indexA],y),A.unitB.conformation.position(A.unitB.elements[A.indexB],x)},g)}e.getBoundingSphere=p;function h(f,C,g){let b=g[0];if(b===void 0)return"";let y=C.pairs[b];return[c(C,b),pw(_t.Location(f,y.unitA,y.indexA,f,y.unitB,y.indexB))].join("</br>")}e.getLabel=h})(Nd||(Nd={}));function Efe(e,t,r){let{elements:n}=t,o=n.length,i=t.kind;for(let s=0;s<o;s++){let a=n[s];r.getIndicesByElement(a,i).forEach(l=>e.set(l,s))}}function K7e(e,t,r){if(t.model!==r.model||t.model.sourceData.kind!=="mmCIF")return;let n=ef.Provider.get(t.model);if(!n)return;let o=new Map,i=new Map;Efe(o,t,n),Efe(i,r,n),o.forEach((s,a)=>{let l=i.get(a);l!==void 0&&e.push(xM(t,s,r,l,n,a),xM(r,l,t,s,n,a))})}function X7e(e,t){if(t.model.sourceData.kind!=="mmCIF")return;let r=ef.Provider.get(t.model);if(!r)return;let{elements:n}=t,o=n.length,i=t.kind,s=new Map;for(let a=0;a<o;a++){let l=n[a];r.getIndicesByElement(l,i).forEach(c=>{let u=s.get(c);u?u.push(a):s.set(c,[a])})}s.forEach((a,l)=>{if(a.length<2)return;let[c,u]=a;e.push(xM(t,c,t,u,r,l),xM(t,u,t,c,r,l))})}function xM(e,t,r,n,o,i){return{unitA:e,indexA:t,unitB:r,indexB:n,restraintType:o.data.restraint_type.value(i),distanceThreshold:o.data.distance_threshold.value(i),psi:o.data.psi.value(i),sigma1:o.data.sigma_1.value(i),sigma2:o.data.sigma_2.value(i)}}function Y7e(e){let t=[];if(!e.models.some(n=>ef.Provider.get(n)))return new Mw(t);let r=e.units.length;for(let n=0;n<r;++n){let o=e.units[n];X7e(t,o);for(let i=n+1;i<r;++i){let s=e.units[i];o.model===s.model&&K7e(t,o,s)}}return new Mw(t)}function Q7e(e,t,r,n,o){let i=tf.get(t).value;if(!i.count)return Ct.createEmpty(o);let{sizeFactor:s}=n,a=ce.Location.create(t),l={linkCount:i.count,position:(d,m,p)=>{let h=i.pairs[p],f=h.unitA,C=h.unitB;f.conformation.position(f.elements[h.indexA],d),C.conformation.position(C.elements[h.indexB],m)},radius:d=>{let m=i.pairs[d];return a.unit=m.unitA,a.element=m.unitA.elements[m.indexA],r.size.size(a)*s}},{mesh:c,boundingSphere:u}=ed(e,l,n,o);if(u)c.setBoundingSphere(u);else if(c.triangleCount>0){let d=Pe.expand(Pe(),t.boundary.sphere,1*s);c.setBoundingSphere(d)}return c}var Pfe={...Nm,...Ld,sizeFactor:M.Numeric(.5,{min:0,max:10,step:.1})};function J7e(e){return Ol({defaultProps:M.getDefaultValues(Pfe),createGeometry:Q7e,createLocationIterator:e$e,getLoci:t$e,eachLocation:r$e,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function e$e(e){let t=tf.get(e).value,{pairs:r}=t,n=r.length,o=1,i=Nd.Location(t,e);return Mr(n,o,1,a=>(i.element=a,i),!0)}function t$e(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=tf.get(t).value;if(i.pairs[o])return Nd.Loci(t,i,[o])}return pr}function r$e(e,t,r){let n=!1;if(Nd.isLoci(e)){if(!qe.areEquivalent(e.data.structure,t))return!1;let o=tf.get(t).value;if(e.data.crossLinkRestraints!==o)return!1;for(let i of e.elements)r(Be.ofSingleton(i))&&(n=!0)}return n}var n$e={"cross-link-restraint":(e,t)=>us("Cross-link restraint",e,t,J7e)},Dfe={...Pfe};function o$e(e,t){return M.clone(Dfe)}function i$e(e,t){return Wt.createMulti("CrossLinkRestraint",e,t,so,n$e)}var dz={name:Nd.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:i$e,getParams:o$e,defaultValues:M.getDefaultValues(Dfe),defaultColorTheme:{name:Nd.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:e=>Nd.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>tf.attach(e,t,void 0,!0),detach:e=>tf.ref(e,!1)}};var kfe=ze(13421772),s$e="Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",Mfe={domain:M.Interval([.5,1.5],{step:.01}),list:M.ColorList("red-grey",{presetKind:"scale"})};function a$e(e){return Mfe}function Rfe(e,t){let r,n,o=e.structure&&tf.get(e.structure).value;if(o){n=ns.create({domain:t.domain,listOrName:t.list.colors});let i=n.color;r=s=>{if(Nd.isLocation(s)){let a=o.pairs[s.element];if(a)return i(Nd.distance(a)/a.distanceThreshold)}return kfe}}else r=()=>kfe;return{factory:Rfe,granularity:"group",color:r,props:t,description:s$e,legend:n?n.legend:void 0}}var mz={name:"cross-link",label:"Cross Link",category:oi.Category.Misc,factory:Rfe,getParams:a$e,defaultValues:M.getDefaultValues(Mfe),isApplicable:e=>!!e.structure&&Nd.isApplicable(e.structure),ensureCustomProperties:{attach:(e,t)=>t.structure?tf.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&tf.ref(e.structure,!1)}};var Bfe=tr.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:class extends tr.Handler{constructor(){super(...arguments),this.provider=ef.Provider}register(){this.provider.formatRegistry.add("mmCIF",l$e),this.ctx.representation.structure.themes.colorThemeRegistry.add(mz),this.ctx.representation.structure.registry.add(dz)}unregister(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(mz),this.ctx.representation.structure.registry.remove(dz)}}});function l$e(e){if(!qr.is(e.sourceData))return;let{ihm_cross_link_restraint:t}=e.sourceData.data.db;if(t._rowCount!==0)return ef.fromTable(t,e)}var Rw={State:l9,Representation:u9,Camera:d9,Misc:A9},mu={Representation:_9,Camera:P9,CustomProps:pz};var c$e=64e3;async function fz(e,t){let r=await Nfe(e,t,{offset:0,size:c$e}),n=r.length-1;for(;n>=0&&r[n]===0;n--);return rb(r.slice(0,n+1))}async function Lfe(e,t,r,n){if(!t.offsets[n])throw new Error(`Resolution ${n} not available.`);let o=await Nfe(e,r,t.offsets[n]),i=await e.runTask(ke.create("Unzip",s=>HK(s,o)));return{header:t,resolution:n,data:rb(i)}}async function Nfe(e,t,r){return typeof t=="string"?await e.runTask(e.fetch({url:t,headers:[["Range",`bytes=${r.offset}-${r.offset+r.size-1}`]],type:"binary"})):t.slice(r.offset,r.offset+r.size)}function u$e(e){let{data:t}=e,r=0;Ao(t,s=>Ao(s,a=>r+=a.start.length));let n={entity_id:new Array(r),chromosome:new Array(r),seq_id_begin:new Int32Array(r),seq_id_end:new Int32Array(r),start:new Int32Array(r),x:new Float32Array(r),y:new Float32Array(r),z:new Float32Array(r),r:new Float32Array(r),haplotype:new Array(r)},o=[D(),D(),D()],i=0;return Ao(t,(s,a)=>{Ao(s,(l,c)=>{let u=`${c}-${a}`,d=l.start.length;if(d===0)return;let m=l.x[0],p=l.y[0],h=l.z[0];D.set(o[0],m,p,h),D.set(o[2],m,p,h);for(let f=0;f<d;f++){n.entity_id[i]=u,n.chromosome[i]=c,n.start[i]=l.start[f],n.seq_id_begin[i]=i,n.seq_id_end[i]=i,m=l.x[f],p=l.y[f],h=l.z[f],D.set(o[1],m,p,h),f+1<d?D.set(o[2],l.x[f+1],l.y[f+1],l.z[f+1]):D.set(o[2],m,p,h),n.x[i]=m,n.y[i]=p,n.z[i]=h,n.r[i]=2/3*Math.min(D.distance(o[0],o[1]),D.distance(o[1],o[2])),n.haplotype[i]=a;let C=o[0];o[0]=o[1],o[1]=C,i++}d===1&&(n.r[i-1]=1)})}),n}async function d$e(e,t){let r=u$e(t),n=r.seq_id_begin.length,o=new Array(n),i=new qi,s={customName:""};for(let u=0;u<n;++u){let d=r.entity_id[u];s.customName=d;let m=i.getEntityId(d,7,d,s);o[u]=m}let a=gr.ofPartialColumns(wo.ihm_sphere_obj_site,{id:ue.range(0,n),entity_id:ue.ofStringArray(o),seq_id_begin:ue.ofIntArray(r.seq_id_begin),seq_id_end:ue.ofIntArray(r.seq_id_end),asym_id:ue.ofStringArray(r.chromosome),Cartn_x:ue.ofFloatArray(r.x),Cartn_y:ue.ofFloatArray(r.y),Cartn_z:ue.ofFloatArray(r.z),object_radius:ue.ofFloatArray(r.r),rmsf:ue.ofConst(0,n,ue.Schema.float),model_id:ue.ofConst(1,n,ue.Schema.int)},n),l=as({entity:i.getEntityTable(),ihm_model_list:gr.ofPartialColumns(wo.ihm_model_list,{model_id:ue.ofIntArray([1]),model_name:ue.ofStringArray(["G3D Model"])},1),ihm_sphere_obj_site:a}),c=await va(l,{kind:"g3d",name:"G3D",data:t},e);return CS.set(c.representative,{haplotypes:Object.keys(t.data),haplotype:r.haplotype,resolution:t.resolution,start:r.start,chroms:r.chromosome}),c}function Ffe(e){return ke.create("Parse G3D",async t=>d$e(t,e))}var CM={haplotype:lu.Dynamic(Hf("g3d","haplotype",He.Str),e=>{if(Le.isAtomic(e.element.unit))return"";let t=CS.get(e.element.unit.model);if(!t)return"";let r=e.element.unit.model.coarseHierarchy.spheres.seq_id_begin.value(e.element.element);return t.haplotype[r]||""}),chromosome:lu.Dynamic(Hf("g3d","chromosome",He.Str),e=>{if(Le.isAtomic(e.element.unit))return"";let{asym_id:t}=e.element.unit.model.coarseHierarchy.spheres;return t.value(e.element.element)||""}),region:lu.Dynamic(Hf("g3d","region",He.Num),e=>{if(Le.isAtomic(e.element.unit))return"";let t=CS.get(e.element.unit.model);if(!t)return 0;let r=e.element.unit.model.coarseHierarchy.spheres.seq_id_begin.value(e.element.element);return t.start[r]||0})},CS=ea.create({name:"g3d_info"});function Ofe(e){return ye.struct.generator.atomGroups({"chain-test":ye.core.rel.eq([CM.haplotype.symbol(),e])})}var hz={label:e=>{if(e.kind!=="element-loci"||Xt.isEmpty(e))return;let t=e.elements[0];if(e.elements.length!==1||Le.isAtomic(t.unit))return;let r=CS.get(t.unit.model);if(!r)return;let n=t.unit.elements[Ge.getAt(t.indices,0)],o=t.unit.model.coarseHierarchy.spheres.seq_id_begin.value(n);return`<b>Start:</b> ${r.start[o]} <small>| resolution ${r.resolution}<small>`}};function qy(e,t,r={}){let n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?m$e(e,t||qe.Empty,r):Gfe(e,t||qe.Empty,r)}function Vfe(e,t){let{themes:r}=e.representation.structure;return t?r.colorThemeRegistry.getApplicableTypes({structure:t}):r.colorThemeRegistry.types}function Bw(e,t,r,n,o){let{registry:i,themes:s}=e.representation.structure,a=i.get(r||i.default.name),l=s.colorThemeRegistry.get(n||a.defaultColorTheme.name),c=M.getDefaultValues(l.getParams({structure:t||qe.Empty}));return l.name===a.defaultColorTheme.name&&Object.assign(c,a.defaultColorTheme.props),{name:l.name,params:Object.assign(c,o)}}function gz(e,t,r,n,o){let{registry:i,themes:s}=e.representation.structure,a=i.get(r||i.default.name),l=s.sizeThemeRegistry.get(n||a.defaultSizeTheme.name),c=M.getDefaultValues(l.getParams({structure:t||qe.Empty}));return l.name===a.defaultSizeTheme.name&&Object.assign(c,a.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,o)}}function m$e(e,t,r){let n=r.type&&e.representation.structure.registry.get(r.type)||e.representation.structure.registry.default.provider,o=r.color&&e.representation.structure.themes.colorThemeRegistry.get(r.color)||e.representation.structure.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.structure.themes.sizeThemeRegistry.get(r.size)||e.representation.structure.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return Gfe(e,t,{type:n,typeParams:r.typeParams,color:o,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function Gfe(e,t,r={}){let{themes:n}=e.representation.structure,o={structure:t},i=r.type||e.representation.structure.registry.default.provider,s=M.getDefaultValues(i.getParams(n,t)),a=Object.assign(s,r.typeParams),l=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),c=M.getDefaultValues(l.getParams(o));l.name===i.defaultColorTheme.name&&Object.assign(c,i.defaultColorTheme.props);let u=Object.assign(c,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),m=M.getDefaultValues(d.getParams(o));d.name===i.defaultSizeTheme.name&&Object.assign(m,i.defaultSizeTheme.props);let p=Object.assign(m,r.sizeParams);return{type:{name:i.name,params:a},colorTheme:{name:l.name,params:u},sizeTheme:{name:d.name,params:p}}}var zfe={label:"G3D",description:"G3D",category:Ku,binaryExtensions:["g3d"],parse:async(e,t)=>({trajectory:await e.state.data.build().to(t).apply(p$e,{},{state:{isGhost:!0}}).apply(jfe).commit()}),visuals:Hfe};async function Hfe(e,t){let r=e.builders.structure,n=await r.createModel(t.trajectory);if(!n)return;let o=await r.createStructure(n),i=CS.get(n.data);if(!i)return;let s=e.build().to(o),a=qy(e,void 0,{type:"cartoon",color:"polymer-index",size:"uniform",sizeParams:{value:.25}});for(let l of i.haplotypes)s.apply(Je.Model.StructureSelectionFromExpression,{expression:Ofe(l),label:Ms(l)}).apply(Je.Representation.StructureRepresentation3D,a);await s.commit()}var l1=class extends fe.Create({name:"G3D Header",typeClass:"Data"}){},p$e=Lt.BuiltIn({name:"g3d-header-from-file",display:{name:"G3D Header",description:"Parse G3D Header"},from:fe.Data.Binary,to:l1})({apply({a:e},t){return ke.create("Parse G3D",async()=>{let r=await fz(t,e.data);return new l1({header:r,urlOrData:e.data,cache:{}},{label:r.name,description:r.genome})})}}),f$e=Lt.BuiltIn({name:"g3d-header-from-url",display:{name:"G3D Header",description:"Parse G3D Header"},params:{url:M.Text("")},from:fe.Root,to:l1})({apply({params:e},t){return ke.create("Parse G3D",async()=>{let r=await fz(t,e.url);return new l1({header:r,urlOrData:e.url,cache:{}},{label:r.name,description:r.genome})})}}),jfe=Lt.BuiltIn({name:"g3d-trajecotry",display:{name:"G3D Trajectory",description:"Create G3D Trajectory"},params:e=>{if(!e)return{resolution:M.Numeric(2e5)};let t=e.data.header.resolutions;return{resolution:M.Select(t[t.length-1],t.map(r=>[r,""+r]))}},from:l1,to:fe.Molecule.Trajectory})({apply({a:e,params:t},r){return ke.create("G3D Trajectory",async n=>{if(e.data.cache[t.resolution])return new fe.Molecule.Trajectory(e.data.cache[t.resolution],{label:e.label,description:e.description});let o=await Lfe(r,e.data.header,e.data.urlOrData,t.resolution),i=await Ffe(o).runInContext(n);return e.data.cache[t.resolution]=i,new fe.Molecule.Trajectory(i,{label:e.label,description:e.description})})}}),Ufe=ki.build({display:{name:"Load Genome 3D (G3D)",description:"Load G3D file from the specified URL."},from:fe.Root,params:{url:M.Text("")}})(({params:e,state:t},r)=>ke.create("Genome3D",n=>t.transaction(async()=>{if(e.url.trim().length===0)throw new Error("Specify URL");r.behaviors.layout.leftPanelTabName.next("data");let o=await t.build().toRoot().apply(f$e,{url:e.url}).apply(jfe).commit();await Hfe(r,{trajectory:o})}).runInContext(n))),A1r=tr.create({name:"g3d",category:"misc",display:{name:"G3D",description:"G3D Format Support"},ctor:class extends tr.Handler{register(){this.ctx.state.data.actions.add(Ufe),Ao(CM,e=>_m.addSymbol(e)),this.ctx.managers.lociLabels.addProvider(hz)}unregister(){this.ctx.state.data.actions.remove(Ufe),Ao(CM,e=>_m.removeSymbol(e)),this.ctx.managers.lociLabels.removeProvider(hz)}}});var Gl;(function(e){let t={value:{localMetrics:new Map}};function r(o,i){if(!o||!qr.is(o.sourceData))return!1;let{db:s}=o.sourceData.data,a=s.ma_qa_metric.id.isDefined&&s.ma_qa_metric_local.ordinal_id.isDefined;if(i&&a){for(let l=0,c=s.ma_qa_metric._rowCount;l<c;l++)if(s.ma_qa_metric.mode.value(l)==="local"&&i===s.ma_qa_metric.name.value(l))return!0;return!1}else return a}e.isApplicable=r;async function n(o,i,s){if(!i||!qr.is(i.sourceData))return t;let{ma_qa_metric:a,ma_qa_metric_local:l}=i.sourceData.data.db,{model_id:c,label_asym_id:u,label_seq_id:d,metric_id:m,metric_value:p}=l,{index:h}=i.atomicHierarchy,f=new Map,C=new Map;for(let b=0,y=a._rowCount;b<y;b++){if(a.mode.value(b)!=="local")continue;let x=a.name.value(b);f.has(x)||(f.set(x,new Map),C.set(a.id.value(b),x))}let g={label_entity_id:"",label_asym_id:"",label_seq_id:0,pdbx_PDB_ins_code:void 0};for(let b=0,y=l._rowCount;b<y;b++){if(c.value(b)!==i.modelNum)continue;let x=u.value(b),A=h.findEntity(x);g.label_entity_id=i.entities.data.id.value(A),g.label_asym_id=x,g.label_seq_id=d.value(b);let v=h.findResidueLabel(g);if(v>=0){let _=C.get(m.value(b));f.get(_).set(v,p.value(b))}}return{value:{localMetrics:f,pLDDT:f.get("pLDDT"),qmean:f.get("qmean")}}}e.obtain=n,e.symbols={pLDDT:lu.Dynamic(Hf("ma","quality-assessment.pLDDT",He.Num),o=>{var i,s;let{unit:a,element:l}=o.element;if(!Le.isAtomic(a))return-1;let c=td.get(a.model).value;return(s=(i=c?.pLDDT)===null||i===void 0?void 0:i.get(a.model.atomicHierarchy.residueAtomSegments.index[l]))!==null&&s!==void 0?s:-1}),qmean:lu.Dynamic(Hf("ma","quality-assessment.qmean",He.Num),o=>{var i,s;let{unit:a,element:l}=o.element;if(!Le.isAtomic(a))return-1;let c=td.get(a.model).value;return(s=(i=c?.qmean)===null||i===void 0?void 0:i.get(a.model.atomicHierarchy.residueAtomSegments.index[l]))!==null&&s!==void 0?s:-1})}})(Gl||(Gl={}));var yz={},td=Hu.createProvider({label:"QualityAssessment",descriptor:Ci({name:"ma_quality_assessment",symbols:Gl.symbols}),type:"static",defaultParams:yz,getParams:e=>yz,isApplicable:e=>Gl.isApplicable(e),obtain:async(e,t,r)=>{let n={...M.getDefaultValues(yz),...r};return await Gl.obtain(e,t,n)}});var Lw=ze(11184810),h$e={"No Score":Lw,"Very Low":ze(16743749),Low:ze(16767763),Confident:ze(6671347),"Very High":ze(21462)},g$e=hl(Object.entries(h$e));function $fe(e){return{}}function Wfe(e,t){let r=()=>Lw;if(e.structure){let n=ce.Location.create(e.structure.root),o=i=>{var s,a;let{unit:l,element:c}=i;if(!Le.isAtomic(l))return Lw;let u=td.get(l.model).value,d=(a=(s=u?.pLDDT)===null||s===void 0?void 0:s.get(l.model.atomicHierarchy.residueAtomSegments.index[c]))!==null&&a!==void 0?a:-1;return d<0?Lw:d<=50?ze(16743749):d<=70?ze(16767763):d<=90?ze(6671347):ze(21462)};r=i=>ce.Location.is(i)?o(i):_t.isLocation(i)?(n.unit=i.aUnit,n.element=i.aUnit.elements[i.aIndex],o(n)):Lw}return{factory:Wfe,granularity:"group",preferSmoothing:!0,color:r,props:t,description:"Assigns residue colors according to the pLDDT Confidence score.",legend:g$e}}var SM={name:"plddt-confidence",label:"pLDDT Confidence",category:oi.Category.Validation,factory:Wfe,getParams:$fe,defaultValues:M.getDefaultValues($fe({})),isApplicable:e=>{var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(r=>Gl.isApplicable(r,"pLDDT")))},ensureCustomProperties:{attach:async(e,t)=>{if(t.structure)for(let r of t.structure.models)await td.attach(e,r,void 0,!0)},detach:async e=>{if(e.structure)for(let t of e.structure.models)td.ref(t,!1)}}};var IM=ze(11184810);function qfe(e){return{}}function Zfe(e,t){let r=()=>IM,n=ns.create({domain:[0,1],listOrName:[[ze(16732160),.5],[ze(154365),1]]});if(e.structure){let o=ce.Location.create(e.structure.root),i=s=>{var a,l;let{unit:c,element:u}=s;if(!Le.isAtomic(c))return IM;let d=td.get(c.model).value,m=(l=(a=d?.qmean)===null||a===void 0?void 0:a.get(c.model.atomicHierarchy.residueAtomSegments.index[u]))!==null&&l!==void 0?l:-1;return m<0?IM:n.color(m)};r=s=>ce.Location.is(s)?i(s):_t.isLocation(s)?(o.unit=s.aUnit,o.element=s.aUnit.elements[s.aIndex],i(o)):IM}return{factory:Zfe,granularity:"group",preferSmoothing:!0,color:r,props:t,description:"Assigns residue colors according to the QMEAN score.",legend:n.legend}}var AM={name:"qmean-score",label:"QMEAN Score",category:oi.Category.Validation,factory:Zfe,getParams:qfe,defaultValues:M.getDefaultValues(qfe({})),isApplicable:e=>{var t;return!!(!((t=e.structure)===null||t===void 0)&&t.models.some(r=>Gl.isApplicable(r,"qmean")))},ensureCustomProperties:{attach:async(e,t)=>{if(t.structure)for(let r of t.structure.models)await td.attach(e,r,void 0,!0)},detach:async e=>{if(e.structure)for(let t of e.structure.models)td.ref(t,!1)}}};var y$e=e=>{let t=Je.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:M.Numeric(5,{min:1,max:10,step:1}),targetParams:M.Group(t,{label:"Target",customDefault:qy(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:M.Group(t,{label:"Surroundings",customDefault:qy(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:M.Group(t,{label:"Non-covalent Int.",customDefault:qy(e,void 0,{type:xS,color:Pw,size:Vi.BuiltIn.uniform})}),components:M.MultiSelect(Kfe,M.arrayToOptions(Kfe)),excludeTargetFromSurroundings:M.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),ignoreLight:M.Boolean(!1),material:Bs.getParam(),clip:M.Group(Lp.Params)}},Kfe=["target","surroundings","interactions"],Ko;(function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"})(Ko||(Ko={}));var v$e=new Set([Ko.TargetSel,Ko.TargetRepr,Ko.SurrSel,Ko.SurrRepr,Ko.SurrNciRepr]),vz=class extends tr.WithSubscribers{constructor(){super(...arguments),this.currentSource=void 0}get surrLabel(){return`[Focus] Surroundings (${this.params.expandRadius} \xC5)`}getReprParams(t){return{...t,type:{name:t.type.name,params:{...t.type.params,ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip}}}}ensureShape(t){var r;let n=this.plugin.state.data,o=n.tree,i=n.build(),s=Kt.findUniqueTagsInSubtree(o,t.transform.ref,v$e);s[Ko.TargetSel]||(s[Ko.TargetSel]=i.to(t).apply(Je.Model.StructureSelectionFromBundle,{bundle:ce.Bundle.Empty,label:"[Focus] Target"},{tags:Ko.TargetSel}).ref),s[Ko.SurrSel]||(s[Ko.SurrSel]=i.to(t).apply(Je.Model.StructureSelectionFromExpression,{expression:ye.struct.generator.empty(),label:this.surrLabel},{tags:Ko.SurrSel}).ref);let a=this.params.components;return a.indexOf("target")>=0&&!s[Ko.TargetRepr]&&(s[Ko.TargetRepr]=i.to(s[Ko.TargetSel]).apply(Je.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:Ko.TargetRepr}).ref),a.indexOf("surroundings")>=0&&!s[Ko.SurrRepr]&&(s[Ko.SurrRepr]=i.to(s[Ko.SurrSel]).apply(Je.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:Ko.SurrRepr}).ref),a.indexOf("interactions")>=0&&!s[Ko.SurrNciRepr]&&t.obj&&xS.isApplicable((r=t.obj)===null||r===void 0?void 0:r.data)&&(s[Ko.SurrNciRepr]=i.to(s[Ko.SurrSel]).apply(Je.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:Ko.SurrNciRepr}).ref),{state:n,builder:i,refs:s}}clear(t){let r=this.plugin.state.data;this.currentSource=void 0;let n=r.select(Kt.Generators.byRef(t).subtree().withTag(Ko.TargetSel)),o=r.select(Kt.Generators.byRef(t).subtree().withTag(Ko.SurrSel));if(n.length===0&&o.length===0)return;let i=r.build(),s=ce.Bundle.Empty;for(let l of n)i.to(l).update(Je.Model.StructureSelectionFromBundle,c=>({...c,bundle:s}));let a=ye.struct.generator.empty();for(let l of o)i.to(l).update(Je.Model.StructureSelectionFromExpression,c=>({...c,expression:a}));return ht.State.Update(this.plugin,{state:r,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}async focus(t){let r=this.plugin.helpers.substructureParent.get(t.structure);if(!r||!r.obj)return;this.currentSource=t;let n=ce.Loci.remap(t,r.obj.data),o=ce.Loci.extendToWholeResidues(n),i=ce.Bundle.fromLoci(o),s=ce.Bundle.toExpression(i),a=ye.struct.modifier.includeSurroundings({0:s,radius:this.params.expandRadius,"as-whole-residues":!0});this.params.excludeTargetFromSurroundings&&(a=ye.struct.modifier.exceptBy({0:a,by:s}));let{state:l,builder:c,refs:u}=this.ensureShape(r);c.to(u[Ko.TargetSel]).update(Je.Model.StructureSelectionFromBundle,d=>({...d,bundle:i})),c.to(u[Ko.SurrSel]).update(Je.Model.StructureSelectionFromExpression,d=>({...d,expression:a,label:this.surrLabel})),await ht.State.Update(this.plugin,{state:l,tree:c,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}register(t){this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,r=>{r?this.focus(r.loci):this.clear(xr.RootRef)})}async update(t){let r=this.params;if(this.params=t,r.excludeTargetFromSurroundings!==t.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),!0;let n=this.plugin.state.data,o=n.build(),i=Kt.Generators.root.subtree(),s=this.params.components,a=s.indexOf("target")>=0;for(let l of n.select(i.withTag(Ko.TargetRepr)))a?o.to(l).update(this.getReprParams(this.params.targetParams)):o.delete(l.transform.ref);a=s.indexOf("surroundings")>=0;for(let l of n.select(i.withTag(Ko.SurrRepr)))a?o.to(l).update(this.getReprParams(this.params.surroundingsParams)):o.delete(l.transform.ref);a=s.indexOf("interactions")>=0;for(let l of n.select(i.withTag(Ko.SurrNciRepr)))a?o.to(l).update(this.getReprParams(this.params.nciParams)):o.delete(l.transform.ref);return await ht.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}}),t.expandRadius!==r.expandRadius&&this.currentSource&&this.focus(this.currentSource),!0}},c1=tr.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:vz,params:(e,t)=>y$e(t)});function Go(e){return e}(function(e){e.CommonParams={ignoreHydrogens:M.Optional(M.Boolean(!1)),ignoreHydrogensVariant:M.Optional(M.Select("all",M.arrayToOptions(["all","non-polar"]))),ignoreLight:M.Optional(M.Boolean(!1)),quality:M.Optional(M.Select("auto",ag)),theme:M.Optional(M.Group({globalName:M.Optional(M.Text("")),globalColorParams:M.Optional(M.Value({},{isHidden:!0})),carbonColor:M.Optional(M.Select("chain-id",M.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:M.Optional(M.Text("")),symmetryColorParams:M.Optional(M.Value({},{isHidden:!0})),focus:M.Optional(M.Group({name:M.Optional(M.Text("")),params:M.Optional(M.Value({}))}))}))};function t(i){return i==="chain-id"?{name:i,params:OD.defaultValues}:i==="operator-name"?{name:i,params:VC.defaultValues}:{name:i,params:{}}}function r(i){return i.units.some(s=>!s.conformation.operator.assembly&&s.conformation.operator.spgrOp>=0)}function n(i,s,a){var l,c,u,d,m,p,h,f,C,g,b,y,x,A;let v=i.state.data.build(),_=i.builders.structure.representation,I=i.managers.structure.component.state.options.hydrogens,T={quality:i.managers.structure.component.state.options.visualQuality,ignoreHydrogens:I!=="all",ignoreHydrogensVariant:I==="only-polar"?"non-polar":"all",ignoreLight:i.managers.structure.component.state.options.ignoreLight};s.quality&&s.quality!=="auto"&&(T.quality=s.quality),s.ignoreHydrogens!==void 0&&(T.ignoreHydrogens=!!s.ignoreHydrogens),s.ignoreHydrogensVariant!==void 0&&(T.ignoreHydrogensVariant=s.ignoreHydrogensVariant),s.ignoreLight!==void 0&&(T.ignoreLight=!!s.ignoreLight);let E=!((l=s.theme)===null||l===void 0)&&l.globalName?(c=s.theme)===null||c===void 0?void 0:c.globalName:void 0,w=((u=s.theme)===null||u===void 0?void 0:u.carbonColor)!==void 0?{carbonColor:t((d=s.theme)===null||d===void 0?void 0:d.carbonColor),...(m=s.theme)===null||m===void 0?void 0:m.globalColorParams}:{...(p=s.theme)===null||p===void 0?void 0:p.globalColorParams},S=a&&(!((h=s.theme)===null||h===void 0)&&h.symmetryColor)&&r(a)?(f=s.theme)===null||f===void 0?void 0:f.symmetryColor:E,P=!((C=s.theme)===null||C===void 0)&&C.symmetryColorParams?{...(g=s.theme)===null||g===void 0?void 0:g.globalColorParams,...(b=s.theme)===null||b===void 0?void 0:b.symmetryColorParams}:{...(y=s.theme)===null||y===void 0?void 0:y.globalColorParams},k=!((x=s.theme)===null||x===void 0)&&x.globalColorParams?{...(A=s.theme)===null||A===void 0?void 0:A.globalColorParams}:void 0;return{update:v,builder:_,color:E,symmetryColor:S,symmetryColorParams:P,globalColorParams:k,typeParams:T,ballAndStickColor:w}}e.reprBuilder=n;function o(i,s,a,l){if(i.state.hasBehavior(c1))return i.state.updateBehavior(c1,c=>{let u=Bw(i,s,"ball-and-stick",a||"element-symbol",l);c.surroundingsParams.colorTheme=u,c.targetParams.colorTheme=u})}e.updateFocusRepr=o})(Go||(Go={}));var Zy=Go.CommonParams,u1=Go.reprBuilder,d1=Go.updateFocusRepr,b$e=Go({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:()=>Zy,apply(e,t,r){var n,o;let i=(o=(n=Jn.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||o===void 0?void 0:o.data;if(!i)return{};let s=r.config.get(Ot.Structure.SizeThresholds)||qe.DefaultSizeThresholds,a=qe.getSize(i,s),l=i.polymerResidueCount/i.polymerGapCount;switch(a){case qe.Size.Gigantic:case qe.Size.Huge:return Qfe.apply(e,t,r);case qe.Size.Large:return Jfe.apply(e,t,r);case qe.Size.Medium:if(l>3)return Yfe.apply(e,t,r);case qe.Size.Small:return ehe.apply(e,{...t,showCarbohydrateSymbol:!0},r);default:Sr(a)}}}),x$e=Go({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},async apply(e,t,r){return{}}}),Nw="Basic",Yfe=Go({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:Nw,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:()=>Zy,async apply(e,t,r){var n,o,i,s,a,l,c,u,d,m;let p=Jn.resolveAndCheck(r.state.data,e);if(!p)return{};let h={polymer:await pu(r,p,"polymer"),ligand:await pu(r,p,"ligand"),nonStandard:await pu(r,p,"non-standard"),branched:await pu(r,p,"branched",{label:"Carbohydrate"}),water:await pu(r,p,"water"),ion:await pu(r,p,"ion"),lipid:await pu(r,p,"lipid"),coarse:await pu(r,p,"coarse")},f=p.obj.data,C={sizeFactor:f.isCoarseGrained?.8:.2},g=(((i=(o=(n=h.water)===null||n===void 0?void 0:n.obj)===null||o===void 0?void 0:o.data)===null||i===void 0?void 0:i.elementCount)||0)>5e4?"line":"ball-and-stick",b=(((l=(a=(s=h.lipid)===null||s===void 0?void 0:s.obj)===null||a===void 0?void 0:a.data)===null||l===void 0?void 0:l.elementCount)||0)>2e4?"line":"ball-and-stick",{update:y,builder:x,typeParams:A,color:v,symmetryColor:_,symmetryColorParams:I,globalColorParams:T,ballAndStickColor:E}=u1(r,t,f),w={polymer:x.buildRepresentation(y,h.polymer,{type:"cartoon",typeParams:{...A,...C},color:_,colorParams:I},{tag:"polymer"}),ligand:x.buildRepresentation(y,h.ligand,{type:"ball-and-stick",typeParams:A,color:v,colorParams:E},{tag:"ligand"}),nonStandard:x.buildRepresentation(y,h.nonStandard,{type:"ball-and-stick",typeParams:A,color:v,colorParams:E},{tag:"non-standard"}),branchedBallAndStick:x.buildRepresentation(y,h.branched,{type:"ball-and-stick",typeParams:{...A,alpha:.3},color:v,colorParams:E},{tag:"branched-ball-and-stick"}),branchedSnfg3d:x.buildRepresentation(y,h.branched,{type:"carbohydrate",typeParams:A,color:v,colorParams:T},{tag:"branched-snfg-3d"}),water:x.buildRepresentation(y,h.water,{type:g,typeParams:{...A,alpha:.6,visuals:g==="line"?["intra-bond","element-point"]:void 0},color:v,colorParams:{carbonColor:{name:"element-symbol",params:{}},...T}},{tag:"water"}),ion:x.buildRepresentation(y,h.ion,{type:"ball-and-stick",typeParams:A,color:v,colorParams:{carbonColor:{name:"element-symbol",params:{}},...T}},{tag:"ion"}),lipid:x.buildRepresentation(y,h.lipid,{type:b,typeParams:{...A,alpha:.6,visuals:b==="line"?["intra-bond"]:void 0},color:v,colorParams:{carbonColor:{name:"element-symbol",params:{}},...T}},{tag:"lipid"}),coarse:x.buildRepresentation(y,h.coarse,{type:"spacefill",typeParams:A,color:v||"chain-id",colorParams:T},{tag:"coarse"})};return await y.commit({revertOnError:!1}),await d1(r,f,(u=(c=t.theme)===null||c===void 0?void 0:c.focus)===null||u===void 0?void 0:u.name,(m=(d=t.theme)===null||d===void 0?void 0:d.focus)===null||m===void 0?void 0:m.params),{components:h,representations:w}}}),C$e=Go({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:Nw,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:()=>Zy,async apply(e,t,r){var n,o,i,s;let a=Jn.resolveAndCheck(r.state.data,e);if(!a)return{};let l={protein:await Xfe(r,a,"protein"),nucleic:await Xfe(r,a,"nucleic")},c=a.obj.data,u={sizeFactor:c.isCoarseGrained?.8:.2},d={radiusOffset:c.isCoarseGrained?2:0,smoothness:c.isCoarseGrained?1:1.5},{update:m,builder:p,typeParams:h,symmetryColor:f,symmetryColorParams:C}=u1(r,t,c),g={protein:p.buildRepresentation(m,l.protein,{type:"cartoon",typeParams:{...h,...u},color:f,colorParams:C},{tag:"protein"}),nucleic:p.buildRepresentation(m,l.nucleic,{type:"gaussian-surface",typeParams:{...h,...d},color:f,colorParams:C},{tag:"nucleic"})};return await m.commit({revertOnError:!0}),await d1(r,c,(o=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||o===void 0?void 0:o.name,(s=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||s===void 0?void 0:s.params),{components:l,representations:g}}}),Qfe=Go({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:Nw,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:()=>Zy,async apply(e,t,r){var n,o,i,s;let a=Jn.resolveAndCheck(r.state.data,e);if(!a)return{};let l={polymer:await pu(r,a,"polymer"),lipid:await pu(r,a,"lipid")},c=a.obj.data,u=r.config.get(Ot.Structure.SizeThresholds)||qe.DefaultSizeThresholds,d=qe.getSize(c,u),m=Object.create(null);d===qe.Size.Gigantic?Object.assign(m,{traceOnly:!c.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):d===qe.Size.Huge?Object.assign(m,{radiusOffset:c.isCoarseGrained?2:0,smoothness:1}):c.isCoarseGrained&&Object.assign(m,{radiusOffset:2,smoothness:1});let{update:p,builder:h,typeParams:f,symmetryColor:C,symmetryColorParams:g}=u1(r,t,c),b={polymer:h.buildRepresentation(p,l.polymer,{type:"gaussian-surface",typeParams:{...f,...m},color:C,colorParams:g},{tag:"polymer"}),lipid:h.buildRepresentation(p,l.lipid,{type:"gaussian-surface",typeParams:{...f,...m},color:C,colorParams:g},{tag:"lipid"})};return await p.commit({revertOnError:!0}),await d1(r,c,(o=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||o===void 0?void 0:o.name,(s=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||s===void 0?void 0:s.params),{components:l,representations:b}}}),Jfe=Go({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:Nw,description:"Shows polymers as Cartoon."},params:()=>Zy,async apply(e,t,r){var n,o,i,s;let a=Jn.resolveAndCheck(r.state.data,e);if(!a)return{};let l={polymer:await pu(r,a,"polymer")},c=a.obj.data,u={sizeFactor:c.isCoarseGrained?.8:.2},{update:d,builder:m,typeParams:p,symmetryColor:h,symmetryColorParams:f}=u1(r,t,c),C={polymer:m.buildRepresentation(d,l.polymer,{type:"cartoon",typeParams:{...p,...u},color:h,colorParams:f},{tag:"polymer"})};return await d.commit({revertOnError:!0}),await d1(r,c,(o=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||o===void 0?void 0:o.name,(s=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||s===void 0?void 0:s.params),{components:l,representations:C}}}),ehe=Go({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:Nw,description:"Shows everything in atomic detail with Ball & Stick."},params:()=>({...Zy,showCarbohydrateSymbol:M.Boolean(!1)}),async apply(e,t,r){var n,o,i,s,a,l;let c=Jn.resolveAndCheck(r.state.data,e);if(!c)return{};let u={all:await pu(r,c,"all"),branched:void 0},d=c.obj.data,m=d.elementCount>1e5,p=d.atomicResidueCount&&d.elementCount>1e3&&d.atomicResidueCount/d.elementCount<3,h=d.models[0],f=!!Zi.Provider.get(h)||oc.isExhaustive(h),C="ball-and-stick";d.isCoarseGrained?C=d.elementCount>1e6?"point":"spacefill":p&&!f?C="spacefill":m&&(C="line");let g=t.showCarbohydrateSymbol&&!m&&!p;g&&Object.assign(u,{branched:await pu(r,c,"branched",{label:"Carbohydrate"})});let{update:b,builder:y,typeParams:x,color:A,ballAndStickColor:v,globalColorParams:_}=u1(r,t,d),I=p&&!f?{carbonColor:{name:"element-symbol",params:{}},..._}:v,T={all:y.buildRepresentation(b,u.all,{type:C,typeParams:x,color:A,colorParams:I},{tag:"all"})};return g&&Object.assign(T,{snfg3d:y.buildRepresentation(b,u.branched,{type:"carbohydrate",typeParams:{...x,alpha:.4,visuals:["carbohydrate-symbol"]},color:A,colorParams:_},{tag:"snfg-3d"})}),await b.commit({revertOnError:!0}),await d1(r,d,(i=(o=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||o===void 0?void 0:o.name)!==null&&i!==void 0?i:A,(l=(a=(s=t.theme)===null||s===void 0?void 0:s.focus)===null||a===void 0?void 0:a.params)!==null&&l!==void 0?l:I),{components:u,representations:T}}}),S$e=Go({id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"..."},params:()=>({...Zy,showCarbohydrateSymbol:M.Boolean(!1)}),async apply(e,t,r){var n,o,i,s,a;let l=Jn.resolveAndCheck(r.state.data,e);if(!l)return{};let c={all:await pu(r,l,"all"),branched:void 0},u=l.obj.data,{update:d,builder:m,typeParams:p,color:h}=u1(r,t,u),f={all:m.buildRepresentation(d,c.all,{type:"spacefill",typeParams:{...p,ignoreLight:!0},color:"illustrative"},{tag:"all"})};return await d.commit({revertOnError:!0}),await d1(r,u,(i=(o=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||o===void 0?void 0:o.name)!==null&&i!==void 0?i:h,(a=(s=t.theme)===null||s===void 0?void 0:s.focus)===null||a===void 0?void 0:a.params),{components:c,representations:f}}}),I$e=Go({id:"preset-structure-representation-auto-lod",display:{name:"Automatic Detail",group:"Miscellaneous",description:"Shows more (or less) detailed representations automatically based on camera distance."},params:()=>Zy,async apply(e,t,r){var n,o,i,s;let a=Jn.resolveAndCheck(r.state.data,e);if(!a)return{};let l={all:await pu(r,a,"all")},c=a.obj.data,u={sizeFactor:c.isCoarseGrained?.8:.2},{update:d,builder:m,typeParams:p,color:h,symmetryColor:f,symmetryColorParams:C,ballAndStickColor:g}=u1(r,t,c),b={gaussianSurface:m.buildRepresentation(d,l.all,{type:"gaussian-surface",typeParams:{...p,lod:D.create(30,1e7,100)},color:f,colorParams:C},{tag:"gaussian-surface"}),cartoon:m.buildRepresentation(d,l.all,{type:"cartoon",typeParams:{...p,...u,lod:D.create(-20,300,100)},color:f,colorParams:C},{tag:"cartoon"}),ballAndStick:m.buildRepresentation(d,l.all,{type:"ball-and-stick",typeParams:{...p,lod:D.create(-20,40,20)},color:h,colorParams:g},{tag:"ball-and-stick"})};return await d.commit({revertOnError:!1}),await d1(r,c,(o=(n=t.theme)===null||n===void 0?void 0:n.focus)===null||o===void 0?void 0:o.name,(s=(i=t.theme)===null||i===void 0?void 0:i.focus)===null||s===void 0?void 0:s.params),{components:l,representations:b}}});function pu(e,t,r,n){return e.builders.structure.tryCreateComponentStatic(t,r,n)}function Xfe(e,t,r,n){return e.builders.structure.tryCreateComponentFromSelection(t,Ai[r],`selection-${r}`,n)}var ds={empty:x$e,auto:b$e,"atomic-detail":ehe,"polymer-cartoon":Jfe,"polymer-and-ligand":Yfe,"protein-and-nucleic":C$e,"coarse-surface":Qfe,illustrative:S$e,"auto-lod":I$e};var Nxr=tr.create({name:"ma-quality-assessment-prop",category:"custom-props",display:{name:"Quality Assessment",description:"Data included in Model Archive files."},ctor:class extends tr.Handler{constructor(){super(...arguments),this.provider=td,this.labelProvider={label:e=>{if(this.params.showTooltip)return[w$e(e),_$e(e)].filter(t=>!!t).join("</br>")}}}register(){_m.addCustomProp(this.provider.descriptor),this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.themes.colorThemeRegistry.add(SM),this.ctx.representation.structure.themes.colorThemeRegistry.add(AM),this.ctx.query.structure.registry.add(the),this.ctx.builders.structure.representation.registerPreset(wM),this.ctx.builders.structure.representation.registerPreset(_M)}update(e){let t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}unregister(){_m.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.themes.colorThemeRegistry.remove(SM),this.ctx.representation.structure.themes.colorThemeRegistry.remove(AM),this.ctx.query.structure.registry.remove(the),this.ctx.builders.structure.representation.unregisterPreset(wM),this.ctx.builders.structure.representation.unregisterPreset(_M)}},params:()=>({autoAttach:M.Boolean(!1),showTooltip:M.Boolean(!0)})});function A$e(e){return e>50&&e<=70?"Low":e>70&&e<=90?"Confident":e>90?"Very high":"Very low"}function w$e(e){return rhe(e,"pLDDT",(t,r)=>`pLDDT Score ${r}: ${t.toFixed(2)} <small>(${A$e(t)})</small>`)}function _$e(e){return rhe(e,"qmean",(t,r)=>`QMEAN Score ${r}: ${t.toFixed(2)}`)}function rhe(e,t,r){var n;if(e.kind==="element-loci"){if(e.elements.length===0)return;let o=new Set,i=new Set,s=0;for(let{indices:l,unit:c}of e.elements){let u=(n=td.get(c.model).value)===null||n===void 0?void 0:n[t];if(!u)continue;let d=c.model.atomicHierarchy.residueAtomSegments.index,{elements:m}=c;Ge.forEach(l,p=>{var h;let f=m[p],C=d[f],g=Ys(C,c.id);if(!o.has(g)){let b=(h=u.get(d[f]))!==null&&h!==void 0?h:-1;b!==-1&&(s+=b,i.add(g)),o.add(g)}})}if(o.size===0)return;let a=[];if(i.size){let l=`<small>(${i.size} ${i.size>1?"Residues avg.":"Residue"})</small>`,c=s/i.size;a.push(r(c,l))}if(a.length)return a.join("</br>")}}var the=Nn("Confident pLDDT (> 70)",ye.struct.modifier.union([ye.struct.modifier.wholeResidues([ye.struct.modifier.union([ye.struct.generator.atomGroups({"chain-test":ye.core.rel.eq([ye.ammp("objectPrimitive"),"atomistic"]),"residue-test":ye.core.rel.gr([Gl.symbols.pLDDT.symbol(),70])})])])]),{description:"Select residues with a pLDDT > 70 (confident).",category:Ln.Validation,ensureCustomProperties:async(e,t)=>{for(let r of t.models)await td.attach(e,r,void 0,!0)}}),wM=Go({id:"preset-structure-representation-ma-quality-assessment-plddt",display:{name:"Quality Assessment (pLDDT)",group:"Annotation",description:"Color structure based on pLDDT Confidence."},isApplicable(e){return!!e.data.models.some(t=>Gl.isApplicable(t,"pLDDT"))},params:()=>Go.CommonParams,async apply(e,t,r){var n;let o=Jn.resolveAndCheck(r.state.data,e),i=(n=o?.obj)===null||n===void 0?void 0:n.data;if(!o||!i)return{};let s=SM.name;return await ds.auto.apply(e,{...t,theme:{globalName:s,focus:{name:s}}},r)}}),_M=Go({id:"preset-structure-representation-ma-quality-assessment-qmean",display:{name:"Quality Assessment (QMEAN)",group:"Annotation",description:"Color structure based on QMEAN Score."},isApplicable(e){return!!e.data.models.some(t=>Gl.isApplicable(t,"qmean"))},params:()=>Go.CommonParams,async apply(e,t,r){var n;let o=Jn.resolveAndCheck(r.state.data,e),i=(n=o?.obj)===null||n===void 0?void 0:n.data;if(!o||!i)return{};let s=AM.name;return await ds.auto.apply(e,{...t,theme:{globalName:s,focus:{name:s}}},r)}});var T$e={typeId:M.Select(0,[[0,"0"]])},ohe=M.clone(T$e);function E$e(e){var t,r;return(r=(t=ihe(e).value)===null||t===void 0?void 0:t.params)!==null&&r!==void 0?r:ohe}var bz="sb-ncbr-partial-charges-property-data";function ihe(e){if(bz in e._staticPropertyData)return e._staticPropertyData[bz];let t;if(!ol.isApplicable(e))t={value:void 0};else{let r=P$e(e),n=D$e(e),o=k$e(e,n),i=nhe(n),s=nhe(o),a=M$e(i,s),l=Array.from(r.entries()).map(([u,d])=>[u,d]),c={typeId:M.Select(1,l)};t={value:{typeIdToMethod:r,typeIdToAtomIdToCharge:n,typeIdToResidueToCharge:o,maxAbsoluteAtomCharges:i,maxAbsoluteResidueCharges:s,maxAbsoluteAtomChargeAll:a,params:c}}}return e._staticPropertyData[bz]=t,t}function P$e(e){let t=new Map,r=e.sourceData,n=r.data.frame.categories.sb_ncbr_partial_atomic_charges_meta.rowCount,o=r.data.frame.categories.sb_ncbr_partial_atomic_charges_meta.getField("id"),i=r.data.frame.categories.sb_ncbr_partial_atomic_charges_meta.getField("method");if(!o||!i)return t;for(let s=0;s<n;++s){let a=o.int(s),l=i.str(s);t.set(a,l)}return t}function D$e(e){var t;let r=new Map,n=e.sourceData,o=n.data.frame.categories.sb_ncbr_partial_atomic_charges.rowCount,i=n.data.frame.categories.sb_ncbr_partial_atomic_charges.getField("type_id"),s=n.data.frame.categories.sb_ncbr_partial_atomic_charges.getField("atom_id"),a=n.data.frame.categories.sb_ncbr_partial_atomic_charges.getField("charge");if(!i||!s||!a)return r;for(let l=0;l<o;++l){let c=i.int(l),u=s.int(l),d=a.float(l);r.has(c)||r.set(c,new Map),(t=r.get(c))===null||t===void 0||t.set(u,d)}return r}function k$e(e,t){let{offsets:r,count:n}=e.atomicHierarchy.residueAtomSegments,{atomId:o}=e.atomicConformation,i=new Map;return t.forEach((s,a)=>{i.has(a)||i.set(a,new Map);let l=i.get(a);for(let c=0;c<n;c++){let u=0;for(let d=r[c],m=r[c+1];d<m;d++){let p=o.value(d);u+=s.get(p)||0}for(let d=r[c],m=r[c+1];d<m;d++){let p=o.value(d);l.set(p,u)}}}),i}function nhe(e){let t=new Map;return e.forEach((r,n)=>{let o=Array.from(r.values()),[i,s]=ml(o),a=Math.max(Math.abs(i),s);t.set(n,a)}),t}function M$e(e,t){let r=0;return e.forEach((n,o)=>{let i=e.get(o)||0;i>r&&(r=i)}),t.forEach((n,o)=>{let i=t.get(o)||0;i>r&&(r=i)}),r}function xz(e){if(!e||!qr.is(e.sourceData))return!1;let{categories:t}=e.sourceData.data.frame;return"atom_site"in t&&"sb_ncbr_partial_atomic_charges"in t&&"sb_ncbr_partial_atomic_charges_meta"in t}var ol=Hu.createProvider({label:"SB NCBR Partial Charges Property Provider",descriptor:Ci({name:"sb-ncbr-partial-charges-property-provider"}),type:"static",defaultParams:ohe,getParams:e=>E$e(e),isApplicable:e=>xz(e),obtain:(e,t)=>Promise.resolve(ihe(t))});var Vg={Bond:ze(16777215),Error:ze(65280),MissingCharge:ze(16777215),Negative:ze(16711680),Zero:ze(16777215),Positive:ze(255),getColor:(e,t)=>{if(e===0)return Vg.Zero;if(e<=-t)return Vg.Negative;if(e>=t)return Vg.Positive;let r=t!==0?Math.abs(e)/t:1,n=e<0?Vg.Negative:Vg.Positive;return ze.interpolate(Vg.Zero,n,r)}},she={maxAbsoluteCharge:M.Numeric(0,{min:0},{label:"Charge Range"}),absolute:M.Boolean(!1,{isHidden:!1,label:"Use Range"}),chargeType:M.Select("residue",[["atom","Atom charges"],["residue","Residue charges"]],{isHidden:!1})};function R$e(){return M.clone(she)}function ahe(e,t){var r,n;let o=(r=e.structure)===null||r===void 0?void 0:r.models[0];if(!o)throw new Error("No model found");let i=ol.get(o).value;if(!i)throw new Error("No partial charges data found");let{absolute:s,chargeType:a}=t,{typeIdToAtomIdToCharge:l,typeIdToResidueToCharge:c,maxAbsoluteAtomCharges:u,maxAbsoluteResidueCharges:d}=i,m=ol.props(o).typeId,p=l.get(m),h=c.get(m),f=0;s?f=t.maxAbsoluteCharge<0?0:t.maxAbsoluteCharge:a==="atom"?f=u.get(m)||0:f=d.get(m)||0;let C=(n=ol.get(o))===null||n===void 0?void 0:n.version,g=a==="atom"?p:h,b;return g?b=y=>{var x;let A=-1;if(ce.Location.is(y))Le.isAtomic(y.unit)&&(A=nt.atom.id(y));else if(_t.isLocation(y)&&Le.isAtomic(y.aUnit)){let _=ce.Location.create((x=e.structure)===null||x===void 0?void 0:x.root);_.unit=y.aUnit,_.element=y.aUnit.elements[y.aIndex],A=nt.atom.id(_)}let v=g.get(A);return v===void 0?Vg.MissingCharge:Vg.getColor(v,f)}:b=y=>Vg.MissingCharge,{factory:ahe,granularity:"group",color:b,props:t,description:"Color atoms and residues based on their partial charge.",preferSmoothing:!1,contextHash:C}}var Fw={label:"SB NCBR Partial Charges",name:"sb-ncbr-partial-charges",category:oi.Category.Atom,factory:ahe,getParams:R$e,defaultValues:M.getDefaultValues(she),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>ol.isApplicable(t)),ensureCustomProperties:{attach:(e,t)=>t.structure?ol.attach(e,t.structure.models[0],void 0,!0):Promise.resolve(),detach:e=>e.structure&&ol.ref(e.structure.models[0],!1)}};function lhe(e){return{label:t=>{var r,n;if(!ce.Loci.is(t))return;let o=t.structure.model;if(!xz(o))return;let i=ol.get(o).value;if(!i)return;let s=ce.Loci.getFirstLocation(t);if(!s)return;let a=e.managers.interactivity.props.granularity;if(a!=="element"&&a!=="residue")return;let l=nt.atom.id(s),{typeIdToAtomIdToCharge:c,typeIdToResidueToCharge:u}=i,d=ol.props(o).typeId,p=a==="residue"?(r=u.get(d))===null||r===void 0?void 0:r.get(l):(n=c.get(d))===null||n===void 0?void 0:n.get(l);return`<strong>${a==="residue"?"Residue charge":"Atom charge"}: ${p?.toFixed(4)||"undefined"}</strong>`},group:t=>t.toString().replace(/Model [0-9]+/g,"Models")}}var SS=Go({id:"sb-ncbr-partial-charges-preset",display:{name:"SB NCBR Partial Charges",group:"Annotation",description:"Color atoms and residues based on their partial charge."},isApplicable(e){return!!e.data.models.some(t=>ol.isApplicable(t))},params:()=>Go.CommonParams,async apply(e,t,r){var n;let o=Jn.resolveAndCheck(r.state.data,e),i=(n=o?.obj)===null||n===void 0?void 0:n.data;if(!o||!i)return{};let s=Fw.name;return ds.auto.apply(e,{...t,theme:{globalName:s,focus:{name:s,params:{chargeType:"atom"}}}},r)}});var B$e=tr.create({name:"sb-ncbr-partial-charges",category:"misc",display:{name:"SB NCBR Partial Charges"},ctor:class extends tr.Handler{constructor(){super(...arguments),this.SbNcbrPartialChargesLociLabelProvider=lhe(this.ctx)}register(){this.ctx.customModelProperties.register(ol,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Fw),this.ctx.managers.lociLabels.addProvider(this.SbNcbrPartialChargesLociLabelProvider),this.ctx.builders.structure.representation.registerPreset(SS)}unregister(){this.ctx.customModelProperties.unregister(ol.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Fw),this.ctx.managers.lociLabels.removeProvider(this.SbNcbrPartialChargesLociLabelProvider),this.ctx.builders.structure.representation.unregisterPreset(SS)}},params:()=>({autoAttach:M.Boolean(!0),showToolTip:M.Boolean(!0)})});var Ow;(function(e){e.DefaultServerUrl="https://channelsdb2.biodata.ceitec.cz/api",e.DefaultServerType="pdb"})(Ow||(Ow={}));var che={serverType:M.Select("pdb",[["pdb","pdb"]]),serverUrl:M.Text(Ow.DefaultServerUrl)},m1={DefaultServerUrl:new Yf("channelsdb-server","https://channelsdb2.biodata.ceitec.cz/api"),DefaultServerType:new Yf("serverType","pdb")};function uhe(e){var t,r,n,o;return{DefaultServerUrl:(r=(t=e.config.get(m1.DefaultServerUrl))!==null&&t!==void 0?t:m1.DefaultServerUrl.defaultValue)!==null&&r!==void 0?r:Ow.DefaultServerUrl,DefaultServerType:(o=(n=e.config.get(m1.DefaultServerType))!==null&&n!==void 0?n:m1.DefaultServerType.defaultValue)!==null&&o!==void 0?o:Ow.DefaultServerType}}var dhe={webgl:M.Value(null),colorTheme:M.Color(ze(16711680)),visual:M.MappedStatic("mesh",{mesh:M.Group({resolution:M.Numeric(2)}),spheres:M.Group({resolution:M.Numeric(2)})}),samplingRate:M.Numeric(1,{min:.05,max:1,step:.05}),showRadii:M.Boolean(!1)},Ky=class extends fe.Create({name:"Tunnel Entry",typeClass:"Data"}){},IS=class extends fe.Create({name:"Tunnels",typeClass:"Data"}){};function Xy(e,t,r){return{i:e,j:t,k:r}}function Om(e,t){return{a:e,b:t}}var Ts=[Xy(0,0,0),Xy(1,0,0),Xy(1,1,0),Xy(0,1,0),Xy(0,0,1),Xy(1,0,1),Xy(1,1,1),Xy(0,1,1)],mhe=[Om(Ts[0],Ts[1]),Om(Ts[1],Ts[2]),Om(Ts[2],Ts[3]),Om(Ts[3],Ts[0]),Om(Ts[4],Ts[5]),Om(Ts[5],Ts[6]),Om(Ts[6],Ts[7]),Om(Ts[7],Ts[4]),Om(Ts[0],Ts[4]),Om(Ts[1],Ts[5]),Om(Ts[2],Ts[6]),Om(Ts[3],Ts[7])],phe=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],fhe=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],Yy=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],TM=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function hhe(e,t){let r=Math.min(65536,e*4),n=it.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),o=it.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),i=it.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),s=it.create(Uint32Array,3,r,t&&t.indexBuffer.ref.value),a=0,l=0;return{addVertex:(c,u,d)=>(++a,it.add3(n,c,u,d)),addNormal:(c,u,d)=>{it.add3(o,c,u,d)},addGroup:c=>{it.add(i,c)},addTriangle:(c,u,d,m)=>{let p=c[u],h=c[d],f=c[m];p>=0&&h>=0&&f>=0&&(++l,it.add3(s,p,h,f))},get:()=>{let c=it.compact(n,!0),u=it.compact(o,!0),d=it.compact(s,!0),m=it.compact(i,!0);return Ct.create(c,d,u,m,a,l,t)}}}function ghe(e,t){let r=it.create(Float32Array,3,e),n=it.create(Float32Array,1,e),o=it.create(Float32Array,2,e),i=0;return{addVertex:(s,a,l)=>it.add3(r,s,a,l),addNormal:()=>vc,addGroup:s=>{it.add(n,s)},addTriangle:(s,a,l,c,u)=>{let d=s[a],m=s[l],p=s[c];d>=0&&m>=0&&p>=0&&(TM[a][l]&u&&(++i,it.add2(o,s[a],s[l])),TM[l][c]&u&&(++i,it.add2(o,s[l],s[c])),TM[a][c]&u&&(++i,it.add2(o,s[a],s[c])))},get:()=>{let s=it.compact(r,!0),a=it.compact(o,!0),l=it.compact(n,!0),c=ga.create(i,i/10,t);for(let u=0;u<i;++u){let d=a[u*2],m=a[u*2+1];c.add(s[d*3],s[d*3+1],s[d*3+2],s[m*3],s[m*3+1],s[m*3+2],l[d])}return c.getLines()}}}function yhe(e){return{...e,bottomLeft:Qi(e.bottomLeft,[0,0,0]),topRight:Qi(e.topRight,e.scalarField.space.dimensions)}}function vhe(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function Vm(e,t){return ke.create("Marching Cubes Mesh",async r=>{let n=yhe(e),{dX:o,dY:i,dZ:s}=vhe(n),a=Math.min(262144,Math.max(o*i*s/32,1024)),l=hhe(a,t);return await new EM(r,l,n).run(),l.get()})}function AS(e,t){return ke.create("Marching Cubes Lines",async r=>{let n=yhe(e),{dX:o,dY:i,dZ:s}=vhe(n),a=Math.min(262144,Math.max(o*i*s/32,1024)),l=ghe(a,t);return await new EM(r,l,n).run(),l.get()})}var EM=class{async doSlices(){let t=0;this.edgeFilter=15;for(let r=this.minZ;r<this.maxZ;r++,this.edgeFilter&=-5)this.slice(r),t+=this.sliceSize,this.ctx.shouldUpdate&&await this.ctx.update({message:"Computing surface...",current:t,max:this.size})}slice(t){this.edgeFilter|=2;for(let r=this.minY;r<this.maxY;r++,this.edgeFilter&=-3){this.edgeFilter|=1;for(let n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,r,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)}async run(){await this.doSlices()}constructor(t,r,n){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new Cz(r,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}},Cz=class{get3dOffsetFromEdgeInfo(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i}clearEdgeVertexIndexSlice(t){let r=t%2===0?0:3*this.nX*this.nY,n=t%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;this.verticesOnEdges.fill(0,r,n)}interpolate(t){let r=phe[t],n=3*this.get3dOffsetFromEdgeInfo(r)+r.e,o=this.verticesOnEdges[n];if(o>0)return o-1;let i=this.scalarField,s=this.scalarFieldGet,a=mhe[t],l=a.a,c=a.b,u=l.i+this.i,d=l.j+this.j,m=l.k+this.k,p=c.i+this.i,h=c.j+this.j,f=c.k+this.k,C=s(i,u,d,m),g=s(i,p,h,f),b=(this.isoLevel-C)/(C-g);if(this.idField){let P=this.idFieldGet(this.idField,u,d,m),k=this.idFieldGet(this.idField,p,h,f),L=b<.5?P:k;if(L===-1&&(L=b<.5?k:P),L===-2)return-1;this.builder.addGroup(L)}else this.builder.addGroup(0);let y=this.builder.addVertex(u+b*(u-p),d+b*(d-h),m+b*(m-f));this.verticesOnEdges[n]=y+1;let x=s(i,Math.max(0,u-1),d,m)-s(i,Math.min(this.nX-1,u+1),d,m),A=s(i,u,Math.max(0,d-1),m)-s(i,u,Math.min(this.nY-1,d+1),m),v=s(i,u,d,Math.max(0,m-1))-s(i,u,d,Math.min(this.nZ,m+1)),_=s(i,Math.max(0,p-1),h,f)-s(i,Math.min(this.nX-1,p+1),h,f),I=s(i,p,Math.max(0,h-1),f)-s(i,p,Math.min(this.nY-1,h+1),f),T=s(i,p,h,Math.max(0,f-1))-s(i,p,h,Math.min(this.nZ-1,f+1)),E=x+b*(x-_),w=A+b*(A-I),S=v+b*(v-T);return this.isoLevel>=0?this.builder.addNormal(E,w,S):this.builder.addNormal(-E,-w,-S),y}constructor(t,r){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;let n=r.scalarField.space.dimensions;this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=r.isoLevel,this.scalarFieldGet=r.scalarField.space.get,this.scalarField=r.scalarField.data,r.idField&&(this.idField=r.idField.data,this.idFieldGet=r.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}get(t,r,n){return this.scalarFieldGet(this.scalarField,t,r,n)}processCell(t,r,n,o){let i=0;if(this.get(t,r,n)<this.isoLevel&&(i|=1),this.get(t+1,r,n)<this.isoLevel&&(i|=2),this.get(t+1,r+1,n)<this.isoLevel&&(i|=4),this.get(t,r+1,n)<this.isoLevel&&(i|=8),this.get(t,r,n+1)<this.isoLevel&&(i|=16),this.get(t+1,r,n+1)<this.isoLevel&&(i|=32),this.get(t+1,r+1,n+1)<this.isoLevel&&(i|=64),this.get(t,r+1,n+1)<this.isoLevel&&(i|=128),i===0||i===255)return;this.i=t,this.j=r,this.k=n;let s=fhe[i];(s&1)>0&&(this.vertList[0]=this.interpolate(0)),(s&2)>0&&(this.vertList[1]=this.interpolate(1)),(s&4)>0&&(this.vertList[2]=this.interpolate(2)),(s&8)>0&&(this.vertList[3]=this.interpolate(3)),(s&16)>0&&(this.vertList[4]=this.interpolate(4)),(s&32)>0&&(this.vertList[5]=this.interpolate(5)),(s&64)>0&&(this.vertList[6]=this.interpolate(6)),(s&128)>0&&(this.vertList[7]=this.interpolate(7)),(s&256)>0&&(this.vertList[8]=this.interpolate(8)),(s&512)>0&&(this.vertList[9]=this.interpolate(9)),(s&1024)>0&&(this.vertList[10]=this.interpolate(10)),(s&2048)>0&&(this.vertList[11]=this.interpolate(11));let a=Yy[i];for(let l=0;l<a.length;l+=3){let c=a[l],u=a[l+1],d=a[l+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,c,u,d,o):this.builder.addTriangle(this.vertList,d,u,c,o)}}};function L$e(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function N$e(e){let t=0,r=2*Math.PI/e,n=new Float32Array(e),o=new Float32Array(e);for(let i=0;i<e;i++)n[i]=Math.cos(t),o[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:o}}var Vw={probeRadius:M.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:M.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing.",...at.CustomQualityParamInfo}),probePositions:M.Numeric(36,{min:12,max:90,step:1},{description:"Number of positions tested for probe target intersection.",...at.CustomQualityParamInfo})},bhe=M.getDefaultValues(Vw);async function xhe(e,t,r,n,o,i){let s=-1;function a(me,Y,ae,ve,ge){if(s!==-1){let Se=s;if(Se!==ve&&Se!==ge&&l(Se,me,Y,ae))return Se;s=-1}for(let Se=0,Ee=T.count;Se<Ee;++Se){let Fe=Ge.getAt(E,T.indices[Se]);if(Fe!==ve&&Fe!==ge&&l(Fe,me,Y,ae))return s=Fe,Fe}return-1}function l(me,Y,ae,ve){let ge=L[me],Se=w[me]-Y,Ee=S[me]-ae,Fe=P[me]-ve;return Se*Se+Ee*Ee+Fe*Fe<ge*ge}function c(me,Y){for(let ae=me;ae<Y;++ae){let ve=Ge.getAt(E,ae),ge=w[ve],Se=S[ve],Ee=P[ve],Fe=L[ve],Ae=Fe*Fe;I.find(ge,Se,Ee,Fe);let we=Math.ceil(Fe*A),_e=Math.floor(A*(ge-H)),Ke=Math.floor(A*(Se-V)),rt=Math.floor(A*(Ee-q)),pt=Math.max(0,_e-we),Ne=Math.max(0,Ke-we),je=Math.max(0,rt-we),Ye=Math.min(B,_e+we+2),mt=Math.min(j,Ke+we+2),vt=Math.min(U,rt+we+2);for(let yt=pt;yt<Ye;++yt){let $e=oe[yt]-ge,be=yt*Z;for(let Te=Ne;Te<mt;++Te){let De=te[Te]-Se,pe=$e*$e+De*De,Ce=Te*z+be;for(let he=je;he<vt;++he){let We=X[he]-Ee,It=pe+We*We;if(It<Ae){let St=he+Ce;le[St]<0&&(le[St]*=-1);let Yt=Math.sqrt(It),sr=Fe/Yt,Xr=$e*sr+ge,mn=De*sr+Se,no=We*sr+Ee;if(a(Xr,mn,no,ve,-1)===-1){let qn=Fe-Yt;qn<le[St]&&(le[St]=qn,ee[St]=k[ae])}}}}}}}async function u(){for(let me=0;me<R;me+=W)c(me,Math.min(me+W,R)),e.shouldUpdate&&await e.update({message:"projecting points",current:me,max:R})}let d=D(),m=D(),p=D(),h=D();function f(me,Y){let ae=L[me],ve=L[Y],ge=d[0]=w[Y]-w[me],Se=d[1]=S[Y]-S[me],Ee=d[2]=P[Y]-P[me],Fe=ge*ge+Se*Se+Ee*Ee,Ae=Math.sqrt(Fe),we=(ae*ae+Ae*Ae-ve*ve)/(2*ae*Ae),_e=ae*we;D.normalize(d,d),L$e(p,d),D.normalize(p,p),D.cross(h,d,p),D.normalize(h,h);let Ke=Math.sqrt(ae*ae-_e*_e);D.scale(p,p,Ke),D.scale(h,h,Ke),D.scale(d,d,_e),m[0]=d[0]+w[me],m[1]=d[1]+S[me],m[2]=d[2]+P[me],s=-1;for(let rt=0;rt<x;++rt){let pt=J[rt],Ne=ie[rt],je=m[0]+pt*p[0]+Ne*h[0],Ye=m[1]+pt*p[1]+Ne*h[1],mt=m[2]+pt*p[2]+Ne*h[2];if(a(je,Ye,mt,me,Y)===-1){let vt=Math.floor(A*(je-H)),yt=Math.floor(A*(Ye-V)),$e=Math.floor(A*(mt-q)),be=Math.max(0,vt-v),Te=Math.max(0,yt-v),De=Math.max(0,$e-v),pe=Math.min(B,vt+v+2),Ce=Math.min(j,yt+v+2),he=Math.min(U,$e+v+2);for(let We=be;We<pe;++We){let It=je-oe[We],St=We*Z;for(let Yt=Te;Yt<Ce;++Yt){let sr=Ye-te[Yt],Xr=It*It+sr*sr,mn=Yt*z+St;for(let no=De;no<he;++no){let qn=mt-X[no],Ze=Xr+qn*qn,Me=no+mn,Ie=le[Me];if(Ie>0&&Ze<Ie*Ie){le[Me]=Math.sqrt(Ze);let et=It*d[0]+sr*d[1]+qn*d[2];ee[Me]=k[Ge.indexOf(E,et<0?Y:me)]}}}}}}}function C(me,Y){for(let ae=me;ae<Y;++ae){let ve=Ge.getAt(E,ae);I.find(w[ve],S[ve],P[ve],L[ve]);for(let ge=0,Se=T.count;ge<Se;++ge){let Ee=Ge.getAt(E,T.indices[ge]);ve<Ee&&f(ve,Ee)}}}async function g(){for(let me=0;me<R;me+=W)C(me,Math.min(me+W,R)),e.shouldUpdate&&await e.update({message:"projecting torii",current:me,max:R})}let{resolution:b,probeRadius:y,probePositions:x}=i,A=1/b,v=Math.max(5,2+Math.floor(y*A)),_=D.create(n,n,n);D.scale(_,_,2);let I=Ma(t,r,_),T=I.result;o===null&&(o=I.boundary.box);let{indices:E,x:w,y:S,z:P,id:k,radius:L}=t,R=Ge.size(E),N=n+b,F=xt.expand(xt(),o,D.create(N,N,N)),[H,V,q]=F.min,Q=xt.scale(xt(),F,A),O=xt.size(D(),Q);D.ceil(O,O);let[B,j,U]=O,z=U,$=j,Z=z*$,{cosTable:J,sinTable:ie}=N$e(x),ne=cr.Space(O,[0,1,2],Float32Array),le=ne.create(),ee=ne.create();le.fill(-1001),ee.fill(-1);let oe=lm(B,H,b),te=lm(j,V,b),X=lm(U,q,b),W=Math.ceil(1e5/(Math.pow(Math.pow(n,3),3)*A));await u(),await g();let K=cr.create(ne,le),re=cr.create(ne,ee),se=de.identity();return de.fromScaling(se,D.create(b,b,b)),de.setTranslation(se,F.min),{field:K,idField:re,transform:se,resolution:b,maxRadius:n}}async function Che(e){var t;let r=gt.createState(512,512,(t=e.prev)===null||t===void 0?void 0:t.geometry),n=e.tunnel,o=Ihe(n.data,e.sampleRate);if(e.showRadii)for(let a=0;a<o.length;a+=1){let l=o[a];r.currentGroup=a;let c=[l.X,l.Y,l.Z];Rr(r,c,l.Radius,e.resolution)}else for(let a=0;a<o.length;a+=1){let l=o[a];r.currentGroup=0;let c=[l.X,l.Y,l.Z];Rr(r,c,l.Radius,e.resolution)}let i=gt.getMesh(r),s=n.props.highlight_label?n.props.highlight_label:n.props.type&&n.props.id?`${n.props.type} ${n.props.id}`:"Tunnel";return e.showRadii?br.create(s,n.props,i,()=>ze(e.color),()=>1,a=>`[${o[a].X.toFixed(3)}, ${o[a].Y.toFixed(3)}, ${o[a].Z.toFixed(3)}] - radius: ${o[a].Radius.toFixed(3)}`):br.create(s,n.props,i,()=>ze(e.color),()=>1,()=>s)}async function She(e){var t;let r=e.tunnel,n=await V$e(r.data,{detail:e.resolution,sampleRate:e.sampleRate,webgl:e.webgl,prev:(t=e.prev)===null||t===void 0?void 0:t.geometry}),o=r.props.highlight_label?r.props.highlight_label:r.props.type&&r.props.id?`${r.props.type} ${r.props.id}`:"Tunnel";return br.create(o,r.props,n,()=>ze(e.color),()=>1,()=>o)}function F$e(e){return D.create(e.X,e.Y,e.Z)}function Ihe(e,t){let r=[];if(e.length<4)return e;r.push(e[0]);let n=F$e(e[0]),o=0,i=1/t;for(let s=1;s<e.length-2;s++){let a=e[s-1],l=e[s],c=e[s+1],u=e[s+2];for(let d=0;d<=1;d+=.05){let m=Xd(a.X,l.X,c.X,u.X,d,.5),p=Xd(a.Y,l.Y,c.Y,u.Y,d,.5),h=Xd(a.Z,l.Z,c.Z,u.Z,d,.5),f=D.create(m,p,h),C=D.distance(n,f);o+=C,o>=i&&(r.push({X:m,Y:p,Z:h,Radius:Xd(a.Radius,l.Radius,c.Radius,u.Radius,d,.5),Charge:zn(l.Charge,c.Charge,d),FreeRadius:Xd(a.FreeRadius,l.FreeRadius,c.FreeRadius,u.FreeRadius,d,.5),T:zn(l.T,c.T,d),Distance:zn(l.Distance,c.Distance,d)}),n=f,o-=i)}}return r.push(e[e.length-1]),r}function O$e(e,t){let r={},n=[],o=[],i=[],s=[],a=[],l=Number.MIN_SAFE_INTEGER,c=0;for(let u of e)n.push(u.X),o.push(u.Y),i.push(u.Z),s.push(c),a.push(u.Radius+t),u.Radius>l&&(l=u.Radius),c++;return r={x:n,y:o,z:i,indices:Ge.ofSortedArray(s),radius:a,id:s},r}async function V$e(e,t){let r={...bhe},n=Ihe(e,t.sampleRate),o=O$e(n,r.probeRadius),i=Ec(o),s=0;for(let f=0;f<o.radius.length;++f){let C=o.radius[f];s<C&&(s=C)}let a=Lm(i.box,r),{field:l,transform:c,maxRadius:u}=await U$e({positions:o,boundary:i,maxRadius:s,box:i.box,props:a}).run(),d={isoLevel:a.probeRadius,scalarField:l},m=await Vm(d,t.prev).run(),p=Math.ceil(2/1);Ct.smoothEdges(m,{iterations:p,maxNewEdgeLength:Math.sqrt(2)}),Ct.transform(m,c),t.webgl&&!t.webgl.isWebGL2?(Ct.uniformTriangleGroup(m),G.updateIfChanged(m.varyingGroup,!1)):G.updateIfChanged(m.varyingGroup,!0);let h=Pe.expand(Pe(),i.sphere,u);return m.setBoundingSphere(h),m.meta.resolution=t.detail,m}function G$e(e,t){return e[0]=e[1]=e[2]=1,t[0]!==0?e[0]=(t[1]+t[2])/-t[0]:t[1]!==0?e[1]=(t[0]+t[2])/-t[1]:t[2]!==0&&(e[2]=(t[0]+t[1])/-t[2]),e}function U$e(e){return ke.create("Tunnel Surface",async t=>await H$e(t,e))}function z$e(e){let t=0,r=2*Math.PI/e,n=new Float32Array(e),o=new Float32Array(e);for(let i=0;i<e;i++)n[i]=Math.cos(t),o[i]=Math.sin(t),t+=r;return{cosTable:n,sinTable:o}}async function H$e(e,t){let r=-1;function n(W,K,re,se,me){if(r!==-1){let Y=r;if(Y!==se&&Y!==me&&o(Y,W,K,re))return Y;r=-1}for(let Y=0,ae=A.count;Y<ae;++Y){let ve=Ge.getAt(v,A.indices[Y]);if(ve!==se&&ve!==me&&o(ve,W,K,re))return r=ve,ve}return-1}function o(W,K,re,se){let me=w[W],Y=_[W]-K,ae=I[W]-re,ve=T[W]-se;return Y*Y+ae*ae+ve*ve<me*me}function i(W,K){for(let re=W;re<K;++re){let se=Ge.getAt(v,re),me=_[se],Y=I[se],ae=T[se],ve=w[se],ge=ve*ve;x.find(me,Y,ae,ve);let Se=Math.ceil(ve*g),Ee=Math.floor(g*(me-L)),Fe=Math.floor(g*(Y-R)),Ae=Math.floor(g*(ae-N)),we=Math.max(0,Ee-Se),_e=Math.max(0,Fe-Se),Ke=Math.max(0,Ae-Se),rt=Math.min(V,Ee+Se+2),pt=Math.min(q,Fe+Se+2),Ne=Math.min(Q,Ae+Se+2);for(let je=we;je<rt;++je){let Ye=ie[je]-me,mt=je*j;for(let vt=_e;vt<pt;++vt){let yt=ne[vt]-Y,$e=Ye*Ye+yt*yt,be=vt*O+mt;for(let Te=Ke;Te<Ne;++Te){let De=le[Te]-ae,pe=$e+De*De;if(pe<ge){let Ce=Te+be;Z[Ce]<0&&(Z[Ce]*=-1);let he=Math.sqrt(pe),We=ve/he,It=Ye*We+me,St=yt*We+Y,Yt=De*We+ae;if(n(It,St,Yt,se,-1)===-1){let sr=ve-he;sr<Z[Ce]&&(Z[Ce]=sr,J[Ce]=E[re])}}}}}}}async function s(){for(let W=0;W<S;W+=ee)i(W,Math.min(W+ee,S)),e.shouldUpdate&&await e.update({message:"projecting points",current:W,max:S})}let a=D(),l=D(),c=D(),u=D();function d(W,K){let re=w[W],se=w[K],me=a[0]=_[K]-_[W],Y=a[1]=I[K]-I[W],ae=a[2]=T[K]-T[W],ve=me*me+Y*Y+ae*ae,ge=Math.sqrt(ve),Se=(re*re+ge*ge-se*se)/(2*re*ge),Ee=re*Se;D.normalize(a,a),G$e(c,a),D.normalize(c,c),D.cross(u,a,c),D.normalize(u,u);let Fe=Math.sqrt(re*re-Ee*Ee);D.scale(c,c,Fe),D.scale(u,u,Fe),D.scale(a,a,Ee),l[0]=a[0]+_[W],l[1]=a[1]+I[W],l[2]=a[2]+T[W],r=-1;for(let Ae=0;Ae<C;++Ae){let we=U[Ae],_e=z[Ae],Ke=l[0]+we*c[0]+_e*u[0],rt=l[1]+we*c[1]+_e*u[1],pt=l[2]+we*c[2]+_e*u[2];if(n(Ke,rt,pt,W,K)===-1){let Ne=Math.floor(g*(Ke-L)),je=Math.floor(g*(rt-R)),Ye=Math.floor(g*(pt-N)),mt=Math.max(0,Ne-b),vt=Math.max(0,je-b),yt=Math.max(0,Ye-b),$e=Math.min(V,Ne+b+2),be=Math.min(q,je+b+2),Te=Math.min(Q,Ye+b+2);for(let De=mt;De<$e;++De){let pe=Ke-ie[De],Ce=De*j;for(let he=vt;he<be;++he){let We=rt-ne[he],It=pe*pe+We*We,St=he*O+Ce;for(let Yt=yt;Yt<Te;++Yt){let sr=pt-le[Yt],Xr=It+sr*sr,mn=Yt+St,no=Z[mn];if(no>0&&Xr<no*no){Z[mn]=Math.sqrt(Xr);let qn=pe*a[0]+We*a[1]+sr*a[2];J[mn]=E[Ge.indexOf(v,qn<0?K:W)]}}}}}}}function m(W,K){for(let re=W;re<K;++re){let se=Ge.getAt(v,re);x.find(_[se],I[se],T[se],w[se]);for(let me=0,Y=A.count;me<Y;++me){let ae=Ge.getAt(v,A.indices[me]);se<ae&&d(se,ae)}}}async function p(){for(let W=0;W<S;W+=ee)m(W,Math.min(W+ee,S)),e.shouldUpdate&&await e.update({message:"projecting torii",current:W,max:S})}let{resolution:h,probeRadius:f,probePositions:C}=t.props,g=1/h,b=Math.max(5,2+Math.floor(f*g)),y=D.create(t.maxRadius,t.maxRadius,t.maxRadius);D.scale(y,y,2);let x=Ma(t.positions,t.boundary,y),A=x.result;t.box===null&&(t.box=x.boundary.box);let{indices:v,x:_,y:I,z:T,id:E,radius:w}=t.positions,S=Ge.size(v),P=t.maxRadius+h,k=xt.expand(xt(),t.box,D.create(P,P,P)),[L,R,N]=k.min,F=xt.scale(xt(),k,g),H=xt.size(D(),F);D.ceil(H,H);let[V,q,Q]=H,O=Q,B=q,j=O*B,{cosTable:U,sinTable:z}=z$e(C),$=cr.Space(H,[0,1,2],Float32Array),Z=$.create(),J=$.create();Z.fill(-1001),J.fill(-1);let ie=lm(V,L,h),ne=lm(q,R,h),le=lm(Q,N,h),ee=Math.ceil(1e5/(Math.pow(Math.pow(t.maxRadius,3),3)*g));await s(),await p();let oe=cr.create($,Z),te=cr.create($,J),X=de.identity();return de.fromScaling(X,D.create(h,h,h)),de.setTranslation(X,k.min),{field:oe,idField:te,transform:X,resolution:h,maxRadius:t.maxRadius}}var PM=st.builderFactory("sb-ncbr-tunnels"),Sz=PM({name:"sb-ncbr-tunnels-from-data",display:{name:"Tunnels"},from:fe.Root,to:IS,params:{data:M.Value([])}})({apply({params:e}){return new IS({tunnels:e.data})}}),Iz=PM({name:"sb-ncbr-tunnel-from-tunnels",display:{name:"Tunnel Selection"},from:IS,to:Ky,params:e=>({index:M.Numeric(0,{min:0,max:e.data.tunnels.length-1,step:1})})})({apply({a:e,params:t}){return new Ky({tunnel:e.data.tunnels[t.index]})}}),Az=PM({name:"sb-ncbr-tunnel-from-data",display:{name:"Tunnel Entry"},from:fe.Root,to:Ky,params:{data:M.Value(void 0,{isHidden:!0})}})({apply({params:e}){return new Ky({tunnel:e.data})}}),Gw=PM({name:"sb-ncbr-tunnel-shape-provider",display:{name:"Tunnel"},from:Ky,to:fe.Shape.Provider,params:e=>dhe})({apply({a:e,params:t}){return ke.create("Tunnel Shape Representation",async r=>{var n,o;return new fe.Shape.Provider({label:"Surface",data:{params:t,data:e.data},params:Ct.Params,geometryUtils:Ct.Utils,getShape:(i,s,a,l)=>s.params.visual.name==="mesh"&&!s.params.showRadii?She({tunnel:s.data.tunnel,color:s.params.colorTheme,resolution:s.params.visual.params.resolution,sampleRate:s.params.samplingRate,webgl:s.params.webgl,prev:l}):Che({tunnel:s.data.tunnel,color:s.params.colorTheme,resolution:s.params.visual.params.resolution,sampleRate:s.params.samplingRate,showRadii:s.params.showRadii,prev:l})},{label:(n=e.data.tunnel.props.label)!==null&&n!==void 0?n:"Tunnel",description:((o=e.data.tunnel.props.description)!==null&&o!==void 0?o:e.data.tunnel.props.type&&e.data.tunnel.props.id)?`${e.data.tunnel.props.type} ${e.data.tunnel.props.id}`:""})})}});var Ahe={channelsdb:M.EmptyGroup({label:"ChannelsDB"})},wz=ki.build({display:{name:"Download Tunnels",description:"Load a tunnels from the provided source and create theirs representations"},from:fe.Root,params:(e,t)=>({source:M.MappedStatic("pdb",{pdb:M.Group({provider:M.Group({id:M.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:M.MappedStatic("channelsdb",Ahe)},{pivot:"id"})},{isFlat:!0,label:"PDB"}),alphafolddb:M.Group({provider:M.Group({id:M.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),server:M.MappedStatic("channelsdb",Ahe)},{pivot:"id"})},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),url:M.Group({url:M.Url("")},{isFlat:!0,label:"URL"})})})})(({params:e,state:t},r)=>ke.create("Download Tunnels",async n=>{r.behaviors.layout.leftPanelTabName.next("data");let o=e.source,i;switch(o.name){case"url":i=[{url:o.params.url}];break;case"pdb":i=o.params.provider.server.name==="channelsdb"?[{url:`${r?.config.get(m1.DefaultServerUrl)}/channels/pdb/${o.params.provider.id}`}]:Sr(o);break;case"alphafolddb":i=o.params.provider.server.name==="channelsdb"?[{url:`${r?.config.get(m1.DefaultServerUrl)}/channels/alphafill/${o.params.provider.id.toLowerCase()}`}]:Sr(o);break;default:Sr(o)}await t.transaction(async()=>{var s;let a=r.build(),l=(s=r.canvas3dContext)===null||s===void 0?void 0:s.webgl;for(let c of i){let u=await(await fetch(c.url.toString())).json(),d=[];Object.entries(u.Channels).forEach(([m,p])=>{p.length>0&&p.forEach(h=>{d.push({data:h.Profile,props:{id:h.Id,type:h.Type}})})}),a.toRoot().apply(Sz,{data:d}).apply(Iz).apply(Gw,{webgl:l}).apply(Je.Representation.ShapeRepresentation3D),await a.commit()}}).runInContext(n)}));var Uw=ue.Schema.int,_z=ue.Schema.float,j$e={mesh:{id:Uw},mesh_vertex:{mesh_id:Uw,vertex_id:Uw,x:_z,y:_z,z:_z},mesh_triangle:{mesh_id:Uw,vertex_id:Uw}},whe=e=>bc(j$e,e);function Tz(e,t){if(t.scale!==void 0){let[r,n,o]=t.scale,i=e.vertexBuffer.ref.value;for(let s=0;s<i.length;s+=3)i[s]*=r,i[s+1]*=n,i[s+2]*=o}if(t.shift!==void 0){let[r,n,o]=t.shift,i=e.vertexBuffer.ref.value;for(let s=0;s<i.length;s+=3)i[s]+=r,i[s+1]+=n,i[s+2]+=o}if(t.matrix!==void 0){let r=e.vertexBuffer.ref.value,n=t.matrix,o=3*e.vertexCount;for(let i=0;i<o;i+=3)D.transformMat4Offset(r,r,n,i,i,0)}if(t.group!==void 0){let r=e.groupBuffer.ref.value;for(let n=0;n<r.length;n++)r[n]=t.group}if(t.invertSides){let r=e.indexBuffer.ref.value,n;for(let i=0;i<r.length;i+=3)n=r[i],r[i]=r[i+1],r[i+1]=n;let o=e.normalBuffer.ref.value;for(let i=0;i<o.length;i++)o[i]*=-1}}async function _he(e,t=void 0,r="cartesian"){let n=e.blocks.find(v=>v.header==="VOLUME_INFO"),o=e.blocks.find(v=>v.header==="MESHES");if(!n||!o)throw new Error("Missing VOLUME_INFO or MESHES block in mesh CIF file");let i=Di.schema.densityServer(n),s=whe(o),a=s.mesh_vertex._rowCount,l=Math.floor(s.mesh_triangle._rowCount/3),c=s.mesh.id.toArray(),u=s.mesh_vertex.mesh_id.toArray(),d=s.mesh_vertex.x.toArray(),m=s.mesh_vertex.y.toArray(),p=s.mesh_vertex.z.toArray(),h=s.mesh_triangle.mesh_id.toArray(),f=s.mesh_triangle.vertex_id.toArray(),C=new Uint32Array(3*l),g=Z$e(u);for(let v=0;v<3*l;v++){let _=g.get(h[v]);C[v]=_+f[v]}let b=q$e(d,m,p),y=new Float32Array(3*a),x=new Float32Array(u),A=Ct.create(b,C,y,x,a,l);if(t??(t=$$e(A)),t&&Tz(A,{invertSides:!0}),r==="cartesian"){let v=await Uf(i).run(),_=go.getGridToCartesianTransform(v.grid);Tz(A,{matrix:_})}else if(r==="fractional"){let v=i.volume_data_3d_info.sample_count.value(0),_=i.volume_data_3d_info.origin.value(0),I=i.volume_data_3d_info.dimensions.value(0);if(I[0]!==1||I[1]!==1||I[2]!==1)throw new Error(`Asserted the fractional dimensions are [1,1,1], but are actually [${I}]`);let T=[1/v[0],1/v[1],1/v[2]];Tz(A,{scale:T,shift:Array.from(_)})}return Ct.computeNormals(A),{mesh:A,meshIds:Array.from(c)}}function $$e(e){let t=e.vertexBuffer.ref.value,r=e.indexBuffer.ref.value,n=W$e(e),o=D.create(3*n[0],3*n[1],3*n[2]),i=0,[s,a,l,c,u,d,m]=[D(),D(),D(),D(),D(),D(),D()];for(let p=0;p<r.length;p+=3)D.fromArray(s,t,3*r[p]),D.fromArray(a,t,3*r[p+1]),D.fromArray(l,t,3*r[p+2]),D.sub(c,a,s),D.sub(u,l,a),D.cross(d,c,u),D.add(m,s,a),D.add(m,m,l),D.sub(m,m,o),i+=D.dot(m,d);return i<0}function W$e(e){let t=e.vertexBuffer.ref.value,r=t.length,n=0,o=0,i=0;for(let s=0;s<t.length;s+=3)n+=t[s],o+=t[s+1],i+=t[s+2];return D.create(n/r,o/r,i/r)}function q$e(e,t,r){let n=e.length,o=new Float32Array(3*n);for(let i=0;i<n;i++)o[3*i]=e[i],o[3*i+1]=t[i],o[3*i+2]=r[i];return o}function Z$e(e){let t=new Map;for(let r=0;r<e.length;r++)t.has(e[r])||t.set(e[r],r);return t}function The(e){let t=e.vertexCount,r=e.vertexBuffer.ref.value;if(t===0)return null;let n=r[0],o=r[1],i=r[2],s=n,a=o,l=i;for(let c=0;c<3*t;c+=3){let u=r[c],d=r[c+1],m=r[c+2];u<n&&(n=u),d<o&&(o=d),m<i&&(i=m),u>s&&(s=u),d>a&&(a=d),m>l&&(l=m)}return xt.create(D.create(n,o,i),D.create(s,a,l))}var DM=function*(){let e=K$e(Object.values(Gt)),t=0;for(;;)yield e[t],t++,t>=e.length&&(t=0)}();function K$e(e){let t=e.length;for(;t!==0;){let r=Math.floor(Math.random()*t);t-=1;let n=e[t];e[t]=e[r],e[r]=n}return e}var Y$e=tr.create({name:"sb-ncbr-tunnels",category:"misc",display:{name:"SB NCBR Tunnels"},ctor:class extends tr.Handler{register(){this.ctx.state.data.actions.add(wz),this.ctx.builders.structure.representation.registerPreset(Ehe)}unregister(){this.ctx.state.data.actions.remove(wz),this.ctx.builders.structure.representation.unregisterPreset(Ehe)}},params:()=>({autoAttach:M.Boolean(!0)})});function Q$e(e){return!!e&&e.models.length===1&&Ut.hasPdbId(e.models[0])}var Ehe=Go({id:"sb-ncbr-preset-structure-tunnels",display:{name:"Tunnels",group:"Annotation",description:"Shows Tunnels from ChannelsDB contained in the structure."},isApplicable(e){return Q$e(e.data)},params:(e,t)=>({...Go.CommonParams,...J$e(t)}),async apply(e,t,r){var n,o;let i=Jn.resolveAndCheck(r.state.data,e),s=(n=i?.obj)===null||n===void 0?void 0:n.data;if(!i||!s)return{};let a=r.build(),l=(o=r.canvas3dContext)===null||o===void 0?void 0:o.webgl,c=await(await fetch(`${t.serverUrl}/channels/${t.serverType}/${s.model.entryId.toLowerCase()}`)).json(),u=[];Object.entries(c.Channels).forEach(([m,p])=>{p.length>0&&p.forEach(h=>{u.push({data:h.Profile,props:{id:h.Id,type:h.Type}})})}),await u.forEach(async m=>{await a.toRoot().apply(Az,{data:m}).apply(Gw,{webgl:l,colorTheme:DM.next().value}).apply(Je.Representation.ShapeRepresentation3D),await a.commit()});let d=await ds.auto.apply(e,{...t},r);return{components:d.components,representations:{...d.representations}}}});function J$e(e){let t=uhe(e),r=M.clone(che);return M.setDefaultValues(r,{serverType:t.DefaultServerType,serverUrl:t.DefaultServerUrl}),r}var p1="https://molstarvolseg.ncbr.muni.cz/v2",wS=class{constructor(t=p1){this.volumeServerUrl=t.replace(/\/$/,"")}entryListUrl(t,r){return`${this.volumeServerUrl}/list_entries/${t}/${r??""}`}metadataUrl(t,r){return`${this.volumeServerUrl}/${t}/${r}/metadata`}volumeUrl(t,r,n,o){if(n){let[[i,s,a],[l,c,u]]=n;return`${this.volumeServerUrl}/${t}/${r}/volume/box/${i}/${s}/${a}/${l}/${c}/${u}?max_points=${o}`}else return`${this.volumeServerUrl}/${t}/${r}/volume/cell?max_points=${o}`}latticeUrl(t,r,n,o,i){if(o){let[[s,a,l],[c,u,d]]=o;return`${this.volumeServerUrl}/${t}/${r}/segmentation/box/${n}/${s}/${a}/${l}/${c}/${u}/${d}?max_points=${i}`}else return`${this.volumeServerUrl}/${t}/${r}/segmentation/cell/${n}?max_points=${i}`}meshUrl_Json(t,r,n,o){return`${this.volumeServerUrl}/${t}/${r}/mesh/${n}/${o}`}meshUrl_Bcif(t,r,n,o){return`${this.volumeServerUrl}/${t}/${r}/mesh_bcif/${n}/${o}`}volumeInfoUrl(t,r){return`${this.volumeServerUrl}/${t}/${r}/volume_info`}async getEntryList(t,r){return await(await fetch(this.entryListUrl(t,r))).json()}async getMetadata(t,r){let n=this.metadataUrl(t,r),o=await fetch(n);if(!o.ok)throw new Error(`Failed to fetch metadata from ${n}`);return await o.json()}};var Gm=class{constructor(t,r){this.defaultValue=r,this.options=Object.keys(t).map(n=>[n,t[n]]),this.nameDict=t}PDSelect(t,r){return M.Select(t??this.defaultValue,this.options,r)}prettyName(t){return this.nameDict[t]}get values(){return this.options.map(([t,r])=>t)}};var _S=class{constructor(t){this.raw=t}get allSegments(){var t,r;return(r=(t=this.raw.annotation)===null||t===void 0?void 0:t.segment_list)!==null&&r!==void 0?r:[]}get allSegmentIds(){return this.allSegments.map(t=>t.id)}getSegment(t){if(!this.segmentMap){this.segmentMap={};for(let r of this.allSegments)this.segmentMap[r.id]=r}return this.segmentMap[t]}getSegmentColor(t){var r;let n=(r=this.getSegment(t))===null||r===void 0?void 0:r.colour;return n?ze.fromNormalizedArray(n,0):void 0}getMeshDetailLevels(t){let r=this.raw.grid.segmentation_meshes.mesh_component_numbers.segment_ids;if(!r)return[];let n=r[t].detail_lvls;return Object.keys(n).map(o=>parseInt(o))}getSufficientMeshDetail(t,r){let n=this.getMeshDetailLevels(t);return r!==null&&(n=n.filter(o=>o<=r)),Math.max(...n)}get meshSegmentIds(){let t=this.raw.grid.segmentation_meshes.mesh_component_numbers.segment_ids;return t?Object.keys(t).map(r=>parseInt(r)):[]}get gridTotalVolume(){let[t,r,n]=this.raw.grid.volumes.voxel_size[1],[o,i,s]=this.raw.grid.volumes.grid_dimensions;return t*r*n*o*i*s}};var eWe=.2,tWe=1,Phe=st.builderFactory("volseg"),Gg;(function(e){function t(){return{segmentId:0,segmentName:"Empty",detail:0,meshIds:[],mesh:Ct.createEmpty()}}e.empty=t;async function r(l,c,u,d){let{mesh:m,meshIds:p}=await _he(l);return{segmentId:c,segmentName:u,detail:d,meshIds:p,mesh:m}}e.fromCIF=r;function n(l){return`Meshlist "${l.segmentName}" (detail ${l.detail}): ${l.meshIds.length} meshes, ${l.mesh.vertexCount} vertices, ${l.mesh.triangleCount} triangles`}e.stats=n;function o(l,c){let u=l.mesh;return br.create(l.segmentName,l,u,()=>c,()=>1,m=>l.segmentName)}e.getShape=o;function i(l){let c=null;for(let u of l)u&&(c?(D.min(c.min,c.min,u.min),D.max(c.max,c.max,u.max)):(c=xt.zero(),xt.copy(c,u)));return c}e.combineBBoxes=i;function s(l){return The(l.mesh)}e.bbox=s;function a(l){let c=new Set;for(let u=0;u<l.mesh.vertexCount;u++)c.add(u);for(let u=0;u<3*l.mesh.triangleCount;u++){let d=l.mesh.vertexBuffer.ref.value[u];c.delete(d)}return c.size===0}e.allVerticesUsed=a})(Gg||(Gg={}));var TS=class extends fe.Create({name:"Parsed Meshlist",typeClass:"Object"}){},rWe=Phe({name:"meshlist-from-string",from:fe.Format.Cif,to:TS,params:{label:M.Text(TS.type.name,{isHidden:!0}),segmentId:M.Numeric(1,{},{isHidden:!0}),segmentName:M.Text("Segment"),detail:M.Numeric(1,{},{isHidden:!0}),ownerId:M.Text("",{isHidden:!0})}})({apply({a:e,params:t},r){return ke.create("Create Parsed Meshlist",async n=>{let o=await Gg.fromCIF(e.data,t.segmentId,t.segmentName,t.detail);o.ownerId=t.ownerId;let i=o.meshIds.length===1?"":"es";return new TS(o,{label:t.label,description:`${o.segmentName} (${o.meshIds.length} mesh${i})`})})}}),Ez;(function(e){function t(r,n){let o=n??DM.next().value;return{label:"Mesh",data:r,params:nWe,geometryUtils:Ct.Utils,getShape:(i,s)=>Gg.getShape(s,o)}}e.fromMeshlistData=t})(Ez||(Ez={}));var nWe={...Ct.Params,quality:M.Select("custom",ag,{isEssential:!0,description:"Visual/rendering quality of the representation."}),doubleSided:M.Boolean(!0,at.CustomQualityParamInfo),transparentBackfaces:M.Select("on",M.arrayToOptions(["off","on","opaque"]),at.ShadingCategory)},oWe=Phe({name:"shape-from-meshlist",display:{name:"Shape from Meshlist",description:"Create Shape from Meshlist data"},from:TS,to:fe.Shape.Provider,params:{color:M.Value(void 0)}})({apply({a:e,params:t}){let r=Ez.fromMeshlistData(e.data,t.color);return new fe.Shape.Provider(r,{label:fe.Shape.Provider.type.name,description:e.description})}});async function Dhe(e,t,r,n,o,i,s,a,l,c){let u=s?e.build().to(s):e.build().toRoot(),d=u.apply(Ru,{url:t,isBinary:!0,label:`Downloaded Data ${r}`},{state:{isCollapsed:o}}).ref,m=await u.to(d).apply(Je.Data.ParseCif).apply(rWe,{label:void 0,segmentId:r,segmentName:l??`Segment ${r}`,detail:n,ownerId:c},{}).commit(),p=!1;if(a!==void 0&&m.data){let h=Gg.bbox(m.data)||xt.zero();p=xt.volume(h)>a}return await e.build().to(m).apply(oWe,{color:i}).apply(qp,{alpha:p?eWe:tWe},{tags:["mesh-segment-visual",`segment-${r}`]}).commit(),d}var iWe="Untitled segment",sWe=Gt.lightgray,khe=-1,Pz=10,Mhe=7,Dz=.5,kM=class extends fe.CreateBehavior({name:"Mesh Streaming"}){};(function(e){let t;(function(o){o.ViewTypeChoice=new Gm({off:"Off",select:"Select",all:"All"},"select");function i(c){return{view:M.MappedStatic("select",{off:M.Group({}),select:M.Group({baseDetail:M.Numeric(Mhe,{min:1,max:Pz,step:1},{description:"Detail level for the non-selected segments (lower number = better)"}),focusDetail:M.Numeric(1,{min:1,max:Pz,step:1},{description:"Detail level for the selected segment (lower number = better)"}),selectedSegment:M.Numeric(khe,{},{isHidden:!0})},{isFlat:!0}),all:M.Group({detail:M.Numeric(Mhe,{min:1,max:Pz,step:1},{description:"Detail level for all segments (lower number = better)"})},{isFlat:!0})},{description:`"Off" hides all segments. 
"Select" shows all segments in lower detail, clicked segment in better detail. "All" shows all segment in the same level.`})}}o.create=i;function s(c){return{view:{name:c.view.name,params:{...c.view.params}}}}o.copyValues=s;function a(c,u){if(c.view.name!==u.view.name)return!1;for(let d in c.view.params)if(c.view.params[d]!==u.view.params[d])return!1;return!0}o.valuesEqual=a;function l(c,u){switch(c.view.name){case"off":return u.view.name==="off";case"select":return u.view.name==="select"&&c.view.params.baseDetail===u.view.params.baseDetail&&c.view.params.focusDetail===u.view.params.focusDetail;case"all":return u.view.name==="all"&&c.view.params.detail===u.view.params.detail;default:throw new Error("Not implemented")}}o.detailsEqual=l})(t=e.Params||(e.Params={}));let r;(function(o){o.DetailTypes=["low","high"];function i(s,a){return`${a}-${s}`}o.tagFor=i})(r=e.VisualInfo||(e.VisualInfo={}));class n extends tr.WithSubscribers{constructor(i,s,a){super(i,a),this.ref="",this.backgroundSegments={},this.focusObservable=this.plugin.behaviors.interaction.click.pipe(kp(l=>l.current.loci),kp(l=>l.kind==="group-loci"?l.shape.sourceData:null),kp(l=>l?.ownerId===this.id?l:null),rg((l,c)=>l?.segmentId===c?.segmentId)),this.focusSubscription=void 0,this.backgroundSegmentsInitialized=!1,this.id=jr.create22(),this.parentData=s}register(i){this.ref=i}unregister(){this.focusSubscription&&(this.focusSubscription.unsubscribe(),this.focusSubscription=void 0)}selectSegment(i){if(this.params.view.name==="select"){if(this.params.view.params.selectedSegment===i)return;let s=t.copyValues(this.params);s.view.name==="select"&&(s.view.params.selectedSegment=i);let a=this.plugin.state.data,l=a.build().to(this.ref).update(s);ht.State.Update(this.plugin,{state:a,tree:l,options:{doNotUpdateCurrent:!0}})}}async update(i){let s=this.params;if(this.params=i,!this.metadata){let l=await(await fetch(this.getMetadataUrl())).json();this.metadata=new _S(l)}switch(this.visuals?t.detailsEqual(this.params,s)||this.updateVisualInfoDetails():this.initVisualInfos(),i.view.name){case"off":await this.disableVisuals();break;case"select":await this.enableVisuals(i.view.params.selectedSegment);break;case"all":await this.enableVisuals();break;default:throw new Error("Not implemented")}return i.view.name!=="off"&&!this.backgroundSegmentsInitialized&&(this.guessBackgroundSegments(),this.backgroundSegmentsInitialized=!0),i.view.name==="select"&&!this.focusSubscription?this.focusSubscription=this.subscribeObservable(this.focusObservable,a=>{var l;this.selectSegment((l=a?.segmentId)!==null&&l!==void 0?l:khe)}):i.view.name!=="select"&&this.focusSubscription&&(this.focusSubscription.unsubscribe(),this.focusSubscription=void 0),!0}getMetadataUrl(){return`${this.parentData.serverUrl}/${this.parentData.source}/${this.parentData.entryId}/metadata`}getMeshUrl(i,s){return`${this.parentData.serverUrl}/${this.parentData.source}/${this.parentData.entryId}/mesh_bcif/${i}/${s}`}initVisualInfos(){var i,s,a,l,c;let u={};for(let d of this.metadata.meshSegmentIds){let m=(a=(s=(i=this.metadata)===null||i===void 0?void 0:i.getSegment(d))===null||s===void 0?void 0:s.biological_annotation.name)!==null&&a!==void 0?a:iWe,p=(c=(l=this.metadata)===null||l===void 0?void 0:l.getSegmentColor(d))!==null&&c!==void 0?c:sWe;for(let h of r.DetailTypes){let f={tag:r.tagFor(d,h),segmentId:d,segmentName:m,detailType:h,detail:-1,color:p,visible:!1,data:void 0};u[f.tag]=f}}this.visuals=u,this.updateVisualInfoDetails()}updateVisualInfoDetails(){let i,s;switch(this.params.view.name){case"off":s=void 0,i=void 0;break;case"select":s=this.params.view.params.baseDetail,i=this.params.view.params.focusDetail;break;case"all":s=this.params.view.params.detail,i=void 0;break}for(let a in this.visuals){let l=this.visuals[a],c=l.detailType==="high"?i:s;c!==void 0&&(l.detail=this.metadata.getSufficientMeshDetail(l.segmentId,c))}}async enableVisuals(i){for(let s in this.visuals){let a=this.visuals[s],l=a.segmentId===i?"high":"low";a.detailType===l?(a.data=await this.getMeshData(a),a.visible=!0):a.visible=!1}}async disableVisuals(){for(let i in this.visuals){let s=this.visuals[i];s.visible=!1}}async getMeshData(i){if(i.data&&i.data.detail===i.detail)return i.data;let s=this.getMeshUrl(i.segmentId,i.detail),a=Nr.getUrlAsset(this.plugin.managers.asset,s),l=await this.plugin.runTask(this.plugin.managers.asset.resolve(a,"binary")),c=await this.plugin.runTask(Di.parseBinary(l.data));if(c.isError)throw new Error(`Failed parsing CIF file from ${s}`);let u=await Gg.fromCIF(c.result,i.segmentId,i.segmentName,i.detail);return u.ownerId=this.id,u}async guessBackgroundSegments(){let i={};for(let c in this.visuals){let u=this.visuals[c];if(u.detailType==="low"&&u.data){let d=Gg.bbox(u.data);d&&(i[u.segmentId]=d)}}let s=Gg.combineBBoxes(Object.values(i)),a=s?xt.volume(s):0,l={};for(let c in i){let u=i[c],d=xt.volume(u);l[c]=d>a*Dz}this.backgroundSegments=l}getDescription(){return t.ViewTypeChoice.prettyName(this.params.view.name)}}e.Behavior=n})(kM||(kM={}));var aWe=5,MM=class{constructor(t){this.entryData=t}async loadSegmentation(){this.entryData.metadata.meshSegmentIds.length>0&&await this.showSegments(this.entryData.metadata.allSegmentIds)}updateOpacity(t){let r=this.entryData.findNodesByTags("mesh-segment-visual"),n=this.entryData.newUpdate();for(let o of r)n.to(o).update(qp,i=>{i.alpha=t});return n.commit()}async highlightSegment(t){let r=this.entryData.findNodesByTags("mesh-segment-visual",`segment-${t.id}`);for(let n of r)await ht.Interactivity.Object.Highlight(this.entryData.plugin,{state:this.entryData.plugin.state.data,ref:n.transform.ref})}async selectSegment(t){var r;if(t===void 0||t<0)return;let o=(r=this.entryData.findNodesByTags("mesh-segment-visual",`segment-${t}`)[0])===null||r===void 0?void 0:r.obj;if(!o)return;let i=o.data.repr.getAllLoci()[0];i&&this.entryData.plugin.managers.interactivity.lociSelects.select({loci:i,repr:o.data.repr},!1)}async showSegments(t){var r,n,o,i;let s=new Set(t),a=this.entryData.findNodesByTags("mesh-segment-visual");for(let m of a){let p=(n=(r=m.obj)===null||r===void 0?void 0:r.tags)===null||n===void 0?void 0:n.find(C=>C.startsWith("segment-"));if(!p)continue;let h=parseInt(p.split("-")[1]),f=s.has(h);vo(this.entryData.plugin.state.data,m.transform.ref,!f),s.delete(h)}let l=this.entryData.metadata.meshSegmentIds.filter(m=>s.has(m));if(l.length===0)return;let c=(o=this.entryData.findNodesByTags("mesh-segmentation-group")[0])===null||o===void 0?void 0:o.transform.ref;c||(c=(await this.entryData.newUpdate().apply(Qa,{label:"Segmentation",description:"Mesh"},{tags:["mesh-segmentation-group"],state:{isCollapsed:!0}}).commit()).ref);let u=this.entryData.metadata.gridTotalVolume,d=[];for(let m of l){let p=this.entryData.metadata.getSegment(m);if(!p)continue;let h=this.entryData.metadata.getSufficientMeshDetail(m,aWe),f=p.colour.length>=3?ze.fromNormalizedArray(p.colour,0):Gt.gray,C=this.entryData.api.meshUrl_Bcif(this.entryData.source,this.entryData.entryId,m,h),g=(i=p.biological_annotation.name)!==null&&i!==void 0?i:`Segment ${m}`,b=Dhe(this.entryData.plugin,C,m,h,!0,f,c,Dz*u,`<b>${g}</b>`,this.entryData.ref);d.push(b)}for(let m of d)await m}};var RM=class{constructor(t){this.entryData=t}async loadPdb(t,r){let n=`https://www.ebi.ac.uk/pdbe/entry-files/download/${t}.bcif`,o=await this.entryData.plugin.build().to(r).apply(Ru,{url:n,isBinary:!0},{tags:["fitted-model-data",`pdbid-${t}`]}).commit(),i=await this.entryData.plugin.build().to(o).apply(bb).commit(),s=await this.entryData.plugin.build().to(i).apply(ow).commit();return await this.entryData.plugin.builders.structure.hierarchy.applyPreset(s,"default",{representationPreset:"polymer-cartoon"}),o}async showPdbs(t){var r,n,o;let i=new Set(t),s=this.entryData.findNodesByTags("fitted-model-data");for(let u of s){let d=(n=(r=u.obj)===null||r===void 0?void 0:r.tags)===null||n===void 0?void 0:n.find(h=>h.startsWith("pdbid-"));if(!d)continue;let m=d.split("-")[1],p=i.has(m);vo(this.entryData.plugin.state.data,u.transform.ref,!p),i.delete(m)}let a=Array.from(i);if(a.length===0)return;let l=(o=this.entryData.findNodesByTags("fitted-models-group")[0])===null||o===void 0?void 0:o.transform.ref;l||(l=(await this.entryData.newUpdate().apply(Qa,{label:"Fitted Models"},{tags:["fitted-models-group"],state:{isCollapsed:!0}}).commit()).ref);let c=[];for(let u of a)c.push(this.loadPdb(u,l));for(let u of c)await u}};function Ul(e,t,r={}){let n=r;return typeof n.type=="string"||typeof n.color=="string"||typeof n.size=="string"?lWe(e,t||ot.One,r):Rhe(e,t||ot.One,r)}function lWe(e,t,r){let n=r.type&&e.representation.volume.registry.get(r.type)||e.representation.volume.registry.default.provider,o=r.color&&e.representation.volume.themes.colorThemeRegistry.get(r.color)||e.representation.volume.themes.colorThemeRegistry.get(n.defaultColorTheme.name),i=r.size&&e.representation.volume.themes.sizeThemeRegistry.get(r.size)||e.representation.volume.themes.sizeThemeRegistry.get(n.defaultSizeTheme.name);return Rhe(e,t,{type:n,typeParams:r.typeParams,color:o,colorParams:r.colorParams,size:i,sizeParams:r.sizeParams})}function Rhe(e,t,r={}){let{themes:n}=e.representation.volume,o={volume:t},i=r.type||e.representation.volume.registry.default.provider,s=M.getDefaultValues(i.getParams(n,t)),a=Object.assign(s,r.typeParams),l=r.color||n.colorThemeRegistry.get(i.defaultColorTheme.name),c=M.getDefaultValues(l.getParams(o));l.name===i.defaultColorTheme.name&&Object.assign(c,i.defaultColorTheme.props);let u=Object.assign(c,r.colorParams),d=r.size||n.sizeThemeRegistry.get(i.defaultSizeTheme.name),m=M.getDefaultValues(d.getParams(o));d.name===i.defaultSizeTheme.name&&Object.assign(m,i.defaultSizeTheme.props);let p=Object.assign(m,r.sizeParams);return{type:{name:i.name,params:a},colorTheme:{name:l.name,params:u},sizeTheme:{name:d.name,params:p}}}function zw(e){var t;let r={emd:"emdb"},[n,o]=e.split("-");return{source:(t=r[n])!==null&&t!==void 0?t:n,entryNumber:o}}function Bhe(e,t){var r;return`${(r={emdb:"emd"}[e])!==null&&r!==void 0?r:e}-${t}`}function ES(e){return e!==void 0}var cWe=st.builderFactory("volseg"),WIr=cWe({name:"create-transformer",from:fe.Root,to:fe.Volume.Data,params:{label:M.Text("Volume",{isHidden:!0}),description:M.Text("",{isHidden:!0}),volume:M.Value(void 0,{isHidden:!0})}})({apply({params:e}){return new fe.Volume.Data(e.volume,{label:e.label,description:e.description})}});function Lhe(e,t=60){if(e.length<=t)return e;let r=e.substring(0,t),n=r.lastIndexOf(" ");return n===-1?r+"...":(n>0&&",;.".includes(e.charAt(n-1))&&n--,e.substring(0,n)+"...")}function Nhe(e,t){let r;return()=>{if(r===void 0&&(r=e()),t&&r===void 0)throw new Error(t);return r}}var Hw={tryUseGpu:M.Boolean(!0,{description:`Attempt using GPU for faster rendering. 
Caution: with some hardware setups, this might render some objects incorrectly or not at all.`}),selectionMode:M.Boolean(!0,{description:"Allow selecting/deselecting a segment by clicking on it."})},oh=class extends fe.CreateBehavior({name:"Vol & Seg Global State"}){},rf=class extends tr.WithSubscribers{constructor(t,r){super(t,r),this.currentState=new jo(M.getDefaultValues(Hw)),this.currentState.next(r)}register(t){this.ref=t}unregister(){this.ref=""}isRegistered(){return this.ref!==""}async updateState(t,r){let n=this.currentState.value,o=[],i=t.state.data.selectQ(s=>s.ofType(ih)).map(s=>{var a;return(a=s.obj)===null||a===void 0?void 0:a.data}).filter(ES);if(r.tryUseGpu!==void 0&&r.tryUseGpu!==n.tryUseGpu)for(let s of i)o.push(s.setTryUseGpu(r.tryUseGpu));if(r.selectionMode!==void 0&&r.selectionMode!==n.selectionMode)for(let s of i)o.push(s.setSelectionMode(r.selectionMode));await Promise.all(o),await t.build().to(this.ref).update(r).commit()}static getGlobalState(t){var r,n;return(n=(r=t.state.data.selectQ(o=>o.ofType(oh))[0])===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data.currentState.value}};var Fhe="lattice-segmentation-group",jw="lattice-segment-visual",uWe=ze.fromNormalizedRgb(.8,.8,.8),BM=class{constructor(t){this.entryData=t}async loadSegmentation(){var t,r,n;if(this.entryData.metadata.raw.grid.segmentation_lattices.segmentation_lattice_ids.length>0){let i=this.entryData.api.latticeUrl(this.entryData.source,this.entryData.entryId,0,NM,LM),s=(t=this.entryData.findNodesByTags(Fhe)[0])===null||t===void 0?void 0:t.transform.ref;s||(s=(await this.entryData.newUpdate().apply(Qa,{label:"Segmentation",description:"Lattice"},{tags:[Fhe],state:{isCollapsed:!0}}).commit()).ref);let a=this.entryData.metadata.allSegments.map(m=>({id:m.id,label:m.biological_annotation.name?`<b>${m.biological_annotation.name}</b>`:""})),l=await this.entryData.newUpdate().to(s).apply(Ru,{url:i,isBinary:!0,label:`Segmentation Data: ${i}`}).apply(bb).apply(vU,{blockHeader:"SEGMENTATION_DATA",segmentLabels:a,ownerId:this.entryData.ref}).commit(),c=l.data,u=ot.Segmentation.get(c),d=Array.from((r=u?.segments.keys())!==null&&r!==void 0?r:[]);await this.entryData.newUpdate().to(l).apply(Je.Representation.VolumeRepresentation3D,Ul(this.entryData.plugin,c,{type:"segment",typeParams:{tryUseGpu:(n=rf.getGlobalState(this.entryData.plugin))===null||n===void 0?void 0:n.tryUseGpu},color:"volume-segment",colorParams:{palette:this.createPalette(d)}}),{tags:[jw]}).commit()}}createPalette(t){let r=new Map;for(let o of this.entryData.metadata.allSegments){let i=ze.fromNormalizedArray(o.colour,0);r.set(o.id,i)}if(r.size===0)return;for(let o of t)r.get(o);return{name:"colors",params:{list:{kind:"set",colors:t.map(o=>{var i;return(i=r.get(o))!==null&&i!==void 0?i:uWe})}}}}async updateOpacity(t){let r=this.entryData.findNodesByTags(jw),n=this.entryData.newUpdate();for(let o of r)n.to(o).update(Je.Representation.VolumeRepresentation3D,i=>{i.type.params.alpha=t});return await n.commit()}makeLoci(t){var r;let n=this.entryData.findNodesByTags(jw)[0];if(!n)return;let o=(r=n.obj)===null||r===void 0?void 0:r.data.repr,i=o.getAllLoci()[0];if(!(!i||!ot.Segment.isLoci(i)))return{loci:ot.Segment.Loci(i.volume,t),repr:o}}async highlightSegment(t){let r=this.makeLoci([t.id]);r&&this.entryData.plugin.managers.interactivity.lociHighlights.highlight(r,!1)}async selectSegment(t){if(t===void 0||t<0)return;let r=this.makeLoci([t]);r&&this.entryData.plugin.managers.interactivity.lociSelects.select(r,!1)}async showSegments(t){var r;let n=this.entryData.findNodesByTags(jw)[0];if(!n)return;let o=this.entryData.currentState.value.selectedSegment,i=t.includes(o)&&!(!((r=n.params)===null||r===void 0)&&r.values.type.params.segments.includes(o)),s=this.entryData.newUpdate();s.to(n).update(Je.Representation.VolumeRepresentation3D,a=>{a.type.params.segments=t}),await s.commit(),i&&await this.selectSegment(this.entryData.currentState.value.selectedSegment)}async setTryUseGpu(t){let r=this.entryData.findNodesByTags(jw);for(let n of r){let o=n.transform.params;if(o.type.params.tryUseGpu===!t){let i={...o,type:{...o.type,params:{...o.type.params,tryUseGpu:t}}},s=this.entryData.newUpdate().to(n.transform.ref).update(i);await ht.State.Update(this.entryData.plugin,{state:this.entryData.plugin.state.data,tree:s,options:{doNotUpdateCurrent:!0}})}}}};var kz=new Gm({isosurface:"Isosurface","direct-volume":"Direct volume",off:"Off"},"isosurface"),PS={volumeType:kz.PDSelect(),volumeIsovalueKind:M.Select("relative",[["relative","Relative"],["absolute","Absolute"]]),volumeIsovalueValue:M.Numeric(1),volumeOpacity:M.Numeric(.2,{min:0,max:1,step:.05}),segmentOpacity:M.Numeric(1,{min:0,max:1,step:.05}),selectedSegment:M.Numeric(-1,{step:1}),visibleSegments:M.ObjectList({segmentId:M.Numeric(0)},e=>e.segmentId.toString()),visibleModels:M.ObjectList({pdbId:M.Text("")},e=>e.pdbId.toString())},f1=class extends fe.Create({name:"Vol & Seg Entry State",typeClass:"Data"}){},Ohe="volseg-state-from-entry";async function Vhe(e){var t,r;let n=zw(e);if(n.source==="emdb")try{let i=await(await fetch(`https://www.ebi.ac.uk/emdb/api/entry/map/${n.entryNumber}`)).json(),s=(r=(t=i?.map)===null||t===void 0?void 0:t.contour_list)===null||r===void 0?void 0:r.contour;if(s&&s.length>0){let a=s.find(l=>l.primary)||s[0];if(a.level===void 0)throw new Error("EMDB API response missing contour level.");return{kind:"absolute",value:a.level}}}catch{}}async function Ghe(e){var t,r,n;let o=zw(e),i=[];if(o.source==="emdb"){e=e.toUpperCase();let s=`https://www.ebi.ac.uk/pdbe/api/emdb/entry/fitted/${e}`;try{let a=await fetch(s);if(a.ok){let c=(t=(await a.json())[e])!==null&&t!==void 0?t:[];for(let u of c){let d=(n=(r=u?.fitted_emdb_id_list)===null||r===void 0?void 0:r.pdb_id)!==null&&n!==void 0?n:[];i.push(...d)}}}catch{}}return i}var zhe="volume-group",h1="volume-visual",dWe=.5,Hhe={volumeType:kz.PDSelect(),opacity:M.Numeric(.2,{min:0,max:1,step:.05},{hideIf:e=>e.volumeType==="off"})},FM=class{constructor(t){this.visualTypeParamCache={},this.entryData=t}async loadVolume(){var t,r,n,o;if(this.entryData.metadata.raw.grid.volumes.volume_downsamplings.length>0){let s=Vhe((t=this.entryData.metadata.raw.grid.general.source_db_id)!==null&&t!==void 0?t:this.entryData.entryId),a=(r=this.entryData.findNodesByTags(zhe)[0])===null||r===void 0?void 0:r.transform.ref;a||(a=(await this.entryData.newUpdate().apply(Qa,{label:"Volume"},{tags:[zhe],state:{isCollapsed:!0}}).commit()).ref);let l=this.entryData.api.volumeUrl(this.entryData.source,this.entryData.entryId,NM,LM),c=await this.entryData.newUpdate().to(a).apply(Ru,{url:l,isBinary:!0,label:`Volume Data: ${l}`}).commit(),u=await this.entryData.plugin.dataFormats.get("dscif").parse(this.entryData.plugin,c),d=(o=(n=u.volumes)===null||n===void 0?void 0:n[0])!==null&&o!==void 0?o:u.volume,m=d.cell.obj.data,p=PS.volumeType.defaultValue,h=await s;if(!h){let g=m.grid.stats,b=(g.max-g.mean)/g.sigma;b>1?h={kind:"relative",value:1}:h={kind:"relative",value:b*.5}}let f=ot.adjustedIsoValue(m,h.value,h.kind),C=this.createVolumeVisualParams(m,p);return this.changeIsovalueInVolumeVisualParams(C,f,m.grid.stats),await this.entryData.newUpdate().to(d).apply(Je.Representation.VolumeRepresentation3D,C,{tags:[h1],state:{isHidden:p==="off"}}).commit(),{isovalue:f}}}async setVolumeVisual(t){var r,n;let o=this.entryData.findNodesByTags(h1)[0];if(!o)return;let i=o.transform.params;if(this.visualTypeParamCache[i.type.name]=i.type.params,t==="off")vo(this.entryData.plugin.state.data,o.transform.ref,!0);else{if(vo(this.entryData.plugin.state.data,o.transform.ref,!1),i.type.name===t)return;let s={...i,type:{name:t,params:(r=this.visualTypeParamCache[t])!==null&&r!==void 0?r:i.type.params}},a=(n=o.obj)===null||n===void 0?void 0:n.data.sourceData.grid.stats;if(!a)throw new Error(`Cannot get volume stats from volume visual ${o.transform.ref}`);this.changeIsovalueInVolumeVisualParams(s,void 0,a);let l=this.entryData.newUpdate().to(o.transform.ref).update(s);await ht.State.Update(this.entryData.plugin,{state:this.entryData.plugin.state.data,tree:l,options:{doNotUpdateCurrent:!0}})}}async updateVolumeVisual(t){var r,n;let{volumeType:o,opacity:i}=t,s=this.entryData.findNodesByTags(h1)[0];if(!s)return;let a=s.transform.params;if(this.visualTypeParamCache[a.type.name]=a.type.params,o==="off")vo(this.entryData.plugin.state.data,s.transform.ref,!0);else{vo(this.entryData.plugin.state.data,s.transform.ref,!1);let l={...a,type:{name:o,params:(r=this.visualTypeParamCache[o])!==null&&r!==void 0?r:a.type.params}};l.type.params.alpha=i;let c=(n=s.obj)===null||n===void 0?void 0:n.data.sourceData.grid.stats;if(!c)throw new Error(`Cannot get volume stats from volume visual ${s.transform.ref}`);this.changeIsovalueInVolumeVisualParams(l,void 0,c);let u=this.entryData.newUpdate().to(s.transform.ref).update(l);await ht.State.Update(this.entryData.plugin,{state:this.entryData.plugin.state.data,tree:u,options:{doNotUpdateCurrent:!0}})}}async setTryUseGpu(t){let r=this.entryData.findNodesByTags(h1);for(let n of r){let o=n.transform.params;if(o.type.params.tryUseGpu===!t){let i={...o,type:{...o.type,params:{...o.type.params,tryUseGpu:t}}},s=this.entryData.newUpdate().to(n.transform.ref).update(i);await ht.State.Update(this.entryData.plugin,{state:this.entryData.plugin.state.data,tree:s,options:{doNotUpdateCurrent:!0}})}}}getIsovalueFromState(){let{volumeIsovalueKind:t,volumeIsovalueValue:r}=this.entryData.currentState.value;return t==="relative"?ot.IsoValue.relative(r):ot.IsoValue.absolute(r)}createVolumeVisualParams(t,r){var n;return r==="off"&&(r="isosurface"),Ul(this.entryData.plugin,t,{type:r,typeParams:{alpha:.2,tryUseGpu:(n=rf.getGlobalState(this.entryData.plugin))===null||n===void 0?void 0:n.tryUseGpu},color:"uniform",colorParams:{value:ze(1184274)}})}changeIsovalueInVolumeVisualParams(t,r,n){var o;switch(r??(r=this.getIsovalueFromState()),t.type.name){case"isosurface":t.type.params.isoValue=r,t.type.params.tryUseGpu=(o=rf.getGlobalState(this.entryData.plugin))===null||o===void 0?void 0:o.tryUseGpu;break;case"direct-volume":let s=(ot.IsoValue.toAbsolute(r,n).absoluteValue-n.min)/(n.max-n.min),a=dWe*n.sigma/(n.max-n.min);t.type.params.controlPoints=[Ve.create(Math.max(s-a,0),0),Ve.create(s,1),Ve.create(Math.min(s+a,1),0)];break}}};var LM=10**7,NM=null,Mz=6,Rz=new Gm({emdb:"EMDB",empiar:"EMPIAR",idr:"IDR"},"emdb");function jhe(e,t={}){var r;let n=(r=e?.config.get(Qy.DefaultServer))!==null&&r!==void 0?r:p1;return{serverUrl:M.Text(n),source:M.Mapped(Rz.values[0],Rz.options,o=>mWe(t[o]))}}function mWe(e=[]){let t=e.map(r=>[r,r]);return t.push(["__custom__","Custom"]),M.Group({entryId:M.Select(t[0][0],t,{description:'Choose an entry from the list, or choose "Custom" and type any entry ID (useful when using other than default server).'}),customEntryId:M.Text("",{hideIf:r=>r.entryId!=="__custom__",description:'Entry identifier, including the source prefix, e.g. "emd-1832"'})},{isFlat:!0})}function $he(e){var t;let r=(t=e?.config.get(Qy.DefaultServer))!==null&&t!==void 0?t:p1;return{serverUrl:M.Text(r),source:Rz.PDSelect(),entryId:M.Text("emd-1832",{description:'Entry identifier, including the source prefix, e.g. "emd-1832"'})}}var OM;(function(e){function t(r){let n=r.source.params.entryId;return n==="__custom__"&&(n=r.source.params.customEntryId),{serverUrl:r.serverUrl,source:r.source.name,entryId:n}}e.fromLoadVolsegParamValues=t})(OM||(OM={}));var ih=class extends fe.CreateBehavior({name:"Vol & Seg Entry"}){},DS=class e extends tr.WithSubscribers{constructor(t,r){super(t,r),this.ref="",this.volumeData=new FM(this),this.latticeSegmentationData=new BM(this),this.meshSegmentationData=new MM(this),this.modelData=new RM(this),this.highlightRequest=new Vn,this.getStateNode=Nhe(()=>this.plugin.state.data.selectQ(n=>n.byRef(this.ref).subtree().ofType(f1))[0],"Missing VolsegState node. Must first create VolsegState for this VolsegEntry."),this.currentState=new jo(M.getDefaultValues(PS)),this.currentVolume=new jo(void 0),this.labelProvider={label:n=>{let o=this.getSegmentIdFromLoci(n);if(o===void 0)return;let i=this.metadata.getSegment(o);if(!i)return;let s=i.biological_annotation.external_references.map(a=>`${Lhe(a.label)} [${a.resource}:${a.accession}]`);if(s.length!==0){if(s.length>Mz+1){let a=s.length-Mz;s.length=Mz,s.push(`(${a} more annotations, click on the segment to see all)`)}return'<hr class="msp-highlight-info-hr"/>'+s.filter(ES).join("<br/>")}}},this.plugin=t,this.api=new wS(r.serverUrl),this.source=r.source,this.entryId=r.entryId,this.entryNumber=zw(this.entryId).entryNumber}async initialize(){var t;let r=await this.api.getMetadata(this.source,this.entryId);this.metadata=new _S(r),this.pdbs=await Ghe((t=this.metadata.raw.grid.general.source_db_id)!==null&&t!==void 0?t:this.entryId)}static async create(t,r){let n=new e(t,r);return await n.initialize(),n}async register(t){var r;this.ref=t,this.plugin.managers.lociLabels.addProvider(this.labelProvider);try{let i=(r=this.getStateNode().obj)===null||r===void 0?void 0:r.data;i&&this.currentState.next(i)}catch{}let n=this.findNodesByTags(h1)[0];n&&this.currentVolume.next(n.transform);let o;this.subscribeObservable(this.plugin.state.data.events.cell.stateUpdated,i=>{var s,a;try{this.getStateNode()}catch{return}if(i.cell.transform.ref===this.getStateNode().transform.ref){let l=(s=this.getStateNode().obj)===null||s===void 0?void 0:s.data;l&&!Au(l,this.currentState.value)&&this.currentState.next(l)}else!((a=i.cell.transform.tags)===null||a===void 0)&&a.includes(h1)&&(i.ref===o?this.currentVolume.next(i.cell.transform):Kt.findAncestor(this.plugin.state.data.tree,this.plugin.state.data.cells,i.ref,l=>l.transform.ref===t)&&(o=i.ref,this.currentVolume.next(i.cell.transform)))}),this.subscribeObservable(this.plugin.state.data.events.cell.removed,i=>{i.ref===o&&(o=void 0,this.currentVolume.next(void 0))}),this.subscribeObservable(this.plugin.behaviors.interaction.click,async i=>{let s=i.current.loci,a=this.getSegmentIdFromLoci(s);a!==void 0&&(a===this.currentState.value.selectedSegment?this.actionSelectSegment(void 0):this.actionSelectSegment(a))}),this.subscribeObservable(this.highlightRequest.pipe(fl(50,void 0,{leading:!0,trailing:!0})),async i=>await this.highlightSegment(i)),this.subscribeObservable(this.currentState.pipe(rg((i,s)=>i.selectedSegment===s.selectedSegment)),async i=>{var s;!((s=rf.getGlobalState(this.plugin))===null||s===void 0)&&s.selectionMode&&await this.selectSegment(i.selectedSegment)})}async unregister(){this.plugin.managers.lociLabels.removeProvider(this.labelProvider)}async loadVolume(){let t=await this.volumeData.loadVolume();if(t){let r=t.isovalue.kind==="relative"?t.isovalue.relativeValue:t.isovalue.absoluteValue;await this.updateStateNode({volumeIsovalueKind:t.isovalue.kind,volumeIsovalueValue:r})}}async loadSegmentations(){await this.latticeSegmentationData.loadSegmentation(),await this.meshSegmentationData.loadSegmentation(),await this.actionShowSegments(this.metadata.allSegmentIds)}actionHighlightSegment(t){this.highlightRequest.next(t)}async actionToggleSegment(t){let r=this.currentState.value.visibleSegments.map(n=>n.segmentId);r.includes(t)?await this.actionShowSegments(r.filter(n=>n!==t)):await this.actionShowSegments([...r,t])}async actionToggleAllSegments(){this.currentState.value.visibleSegments.map(r=>r.segmentId).length!==this.metadata.allSegments.length?await this.actionShowSegments(this.metadata.allSegmentIds):await this.actionShowSegments([])}async actionSelectSegment(t){t!==void 0&&this.currentState.value.visibleSegments.find(r=>r.segmentId===t)===void 0&&await this.actionToggleSegment(t),await this.updateStateNode({selectedSegment:t})}async actionSetOpacity(t){var r;t!==((r=this.getStateNode().obj)===null||r===void 0?void 0:r.data.segmentOpacity)&&(this.latticeSegmentationData.updateOpacity(t),this.meshSegmentationData.updateOpacity(t),await this.updateStateNode({segmentOpacity:t}))}async actionShowFittedModel(t){await this.modelData.showPdbs(t),await this.updateStateNode({visibleModels:t.map(r=>({pdbId:r}))})}async actionSetVolumeVisual(t){await this.volumeData.setVolumeVisual(t),await this.updateStateNode({volumeType:t})}async actionUpdateVolumeVisual(t){await this.volumeData.updateVolumeVisual(t),await this.updateStateNode({volumeType:t.volumeType,volumeOpacity:t.opacity})}async actionShowSegments(t){await this.latticeSegmentationData.showSegments(t),await this.meshSegmentationData.showSegments(t),await this.updateStateNode({visibleSegments:t.map(r=>({segmentId:r}))})}async highlightSegment(t){await ht.Interactivity.ClearHighlights(this.plugin),t&&(await this.latticeSegmentationData.highlightSegment(t),await this.meshSegmentationData.highlightSegment(t))}async selectSegment(t){this.plugin.managers.interactivity.lociSelects.deselectAll(),await this.latticeSegmentationData.selectSegment(t),await this.meshSegmentationData.selectSegment(t),await this.highlightSegment()}async updateStateNode(t){let n={...this.getStateNode().transform.params,...t},o=this.plugin.state.data,i=o.build().to(this.getStateNode().transform.ref).update(n);await ht.State.Update(this.plugin,{state:o,tree:i,options:{doNotUpdateCurrent:!0}})}findNodesByTags(...t){return this.plugin.state.data.selectQ(r=>{let n=r.byRef(this.ref).subtree();for(let o of t)n=n.withTag(o);return n})}newUpdate(){return this.ref!==""?this.plugin.build().to(this.ref):this.plugin.build().toRoot()}getSegmentIdFromLoci(t){var r;if(ot.Segment.isLoci(t)&&t.volume._propertyData.ownerId===this.ref&&t.segments.length===1)return t.segments[0];if(Fi.isLoci(t)){let n=(r=t.shape.sourceData)!==null&&r!==void 0?r:{};if(n.ownerId===this.ref&&n.segmentId!==void 0)return n.segmentId}}async setTryUseGpu(t){await Promise.all([this.volumeData.setTryUseGpu(t),this.latticeSegmentationData.setTryUseGpu(t)])}async setSelectionMode(t){t?await this.selectSegment(this.currentState.value.selectedSegment):this.plugin.managers.interactivity.lociSelects.deselectAll()}};var Whe=Lt.BuiltIn({name:"volseg-entry-from-root",display:{name:"Vol & Seg Entry",description:"Vol & Seg Entry"},from:fe.Root,to:ih,params:(e,t)=>$he(t)})({apply({a:e,params:t},r){return ke.create("Load Vol & Seg Entry",async()=>{let n=await DS.create(r,t);return new ih(n,{label:n.entryId,description:"Vol & Seg Entry"})})},update({b:e,oldParams:t,newParams:r}){return Object.assign(r,t),st.UpdateResult.Unchanged}}),qhe=Lt.BuiltIn({name:Ohe,display:{name:"Vol & Seg Entry State",description:"Vol & Seg Entry State"},from:ih,to:f1,params:PS})({apply({a:e,params:t},r){return ke.create("Create Vol & Seg Entry State",async()=>new f1(t,{label:"State"}))}}),Zhe=Lt.BuiltIn({name:"volseg-global-state-from-root",display:{name:"Vol & Seg Global State",description:"Vol & Seg Global State"},from:fe.Root,to:oh,params:Hw})({apply({a:e,params:t},r){return ke.create("Create Vol & Seg Global State",async()=>{let n=new rf(r,t);return new oh(n,{label:"Global State",description:"Vol & Seg Global State"})})},update({b:e,oldParams:t,newParams:r}){return e.data.currentState.next(r),st.UpdateResult.Updated}});var wn=ar(un()),dh=ar(hi());var y1=ar(un()),MS=ar(hi());var ao=ar(un()),zg=ar(hi());var ut=ar(un());function an(e){return e.svg?(0,ut.jsx)("span",{className:`msp-icon msp-material-icon${e.inline?" msp-icon-inline":""}`,title:e.title,style:e.style,children:(0,ut.jsx)(e.svg,{})}):null}var HM=(0,ut.jsx)("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"}),jM=(0,ut.jsx)("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"}),BWe=(0,ut.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,ut.jsxs)("defs",{children:[HM,jM]}),(0,ut.jsxs)("g",{children:[(0,ut.jsx)("use",{href:"#circle-left",className:"msp-shape-filled"}),(0,ut.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"}),(0,ut.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"})]})]});function Ww(){return BWe}var LWe=(0,ut.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,ut.jsxs)("defs",{children:[HM,jM,(0,ut.jsxs)("mask",{id:"mask-left",children:[(0,ut.jsx)("use",{href:"#circle-left",fill:"white",stroke:"white"}),(0,ut.jsx)("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"})]})]}),(0,ut.jsxs)("g",{children:[(0,ut.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"}),(0,ut.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function qw(){return LWe}var NWe=(0,ut.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,ut.jsxs)("defs",{children:[HM,jM,(0,ut.jsx)("clipPath",{id:"clip-left",children:(0,ut.jsx)("use",{href:"#circle-right"})})]}),(0,ut.jsxs)("g",{children:[(0,ut.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"}),(0,ut.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,ut.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function Zw(){return NWe}var FWe=(0,ut.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,ut.jsxs)("defs",{children:[HM,jM]}),(0,ut.jsxs)("g",{children:[(0,ut.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,ut.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"})]})]});function g1(){return FWe}var OWe=(0,ut.jsx)("svg",{width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px",children:(0,ut.jsx)("g",{children:(0,ut.jsx)("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"})})});function dge(){return OWe}var VWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,ut.jsx)("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"})});function Kw(){return VWe}var c2r=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,ut.jsx)("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"})});var u2r=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,ut.jsx)("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"})});var GWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"})});function UWe(){return GWe}var d2r=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,ut.jsx)("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})});var m2r=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,ut.jsx)("path",{fill:"currentColor",d:"M20,11H23V13H20V11M1,11H4V13H1V11M13,1V4H11V1H13M4.92,3.5L7.05,5.64L5.63,7.05L3.5,4.93L4.92,3.5M16.95,5.63L19.07,3.5L20.5,4.93L18.37,7.05L16.95,5.63M12,6A6,6 0 0,1 18,12C18,14.22 16.79,16.16 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.21,16.16 6,14.22 6,12A6,6 0 0,1 12,6M14,21V22A1,1 0 0,1 13,23H11A1,1 0 0,1 10,22V21H14M11,18H13V15.87C14.73,15.43 16,13.86 16,12A4,4 0 0,0 12,8A4,4 0 0,0 8,12C8,13.86 9.27,15.43 11,15.87V18Z"})});var zWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{fill:"currentColor",d:"M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z"})});function mge(){return zWe}var HWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,ut.jsx)("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"})});function pge(){return HWe}var jWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"})});function Vz(){return jWe}var $We=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})});function nf(){return $We}var WWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"})});function Jy(){return WWe}var qWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M7 10l5 5 5-5z"})});function Bc(){return qWe}var ZWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M10 17l5-5-5-5v10z"})});function Lc(){return ZWe}var KWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"})});function ev(){return KWe}var XWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})});function fge(){return XWe}var YWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"})});function Gz(){return YWe}var QWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"})});function Ug(){return QWe}var JWe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"})});function $M(){return JWe}var eqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"})});function hge(){return eqe}var tqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"})});function gge(){return tqe}var rqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"})});function yge(){return rqe}var nqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"})});function vge(){return nqe}var oqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"})});function Xw(){return oqe}var iqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"})});function WM(){return iqe}var sqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"})});function bge(){return sqe}var aqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})});function Fd(){return aqe}var lqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function Uz(){return lqe}var cqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function hu(){return cqe}var uqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"})});function xge(){return uqe}var dqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})});function Cge(){return dqe}var mqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"})});function Sge(){return mqe}var pqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"})});function Ige(){return pqe}var fqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"})});function Age(){return fqe}var hqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"})});function wge(){return hqe}var gqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"})});function Fa(){return gqe}var p2r=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})});var yqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})});function zz(){return yqe}var vqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"})});function qM(){return vqe}var bqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,ut.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"})});function xqe(){return bqe}var Cqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})});function _ge(){return Cqe}var Sqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})});function Yw(){return Sqe}var Iqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"})});function Nc(){return Iqe}var Aqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"})});function Qw(){return Aqe}var f2r=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"})});var wqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"})});function _qe(){return wqe}var Tqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})});function Um(){return Tqe}var Eqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})});function Hz(){return Eqe}var Pqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})});function jz(){return Pqe}var Dqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"})});function Tge(){return Dqe}var kqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M8 5v14l11-7z"})});function ZM(){return kqe}var Mqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})});function Jw(){return Mqe}var Rqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M19 13H5v-2h14v2z"})});function e_(){return Rqe}var Bqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})});function t_(){return Bqe}var Lqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,ut.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"})});function KM(){return Lqe}var Nqe=(0,ut.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,ut.jsx)("circle",{cx:"7",cy:"14",r:"3"}),(0,ut.jsx)("circle",{cx:"11",cy:"6",r:"3"}),(0,ut.jsx)("circle",{cx:"16.6",cy:"17.6",r:"3"})]});function Fqe(){return Nqe}var h2r=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})});var Oqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})});function Ege(){return Oqe}var Vqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M6 6h12v12H6z"})});function $z(){return Vqe}var Gqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"})});function Pge(){return Gqe}var Uqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"})});function Dge(){return Uqe}var zqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})});function gu(){return zqe}var Hqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"})});function uc(){return Hqe}var jqe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"})});function dc(){return jqe}var $qe=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})});function XM(){return $qe}var g2r=(0,ut.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,ut.jsx)("path",{d:"M 9.64 7.64 c 0.23 -0.5 0.36 -1.05 0.36 -1.64 c 0 -2.21 -1.79 -4 -4 -4 S 2 3.79 2 6 s 1.79 4 4 4 c 0.59 0 1.14 -0.13 1.64 -0.36 L 10 12 l -2.36 2.36 C 7.14 14.13 6.59 14 6 14 c -2.21 0 -4 1.79 -4 4 s 1.79 4 4 4 s 4 -1.79 4 -4 c 0 -0.59 -0.13 -1.14 -0.36 -1.64 L 12 14 l 7 7 h 3 v -1 L 9.64 7.64 Z M 6 8 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 0 12 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 6 -7.5 c -0.28 0 -0.5 -0.22 -0.5 -0.5 s 0.22 -0.5 0.5 -0.5 s 0.5 0.22 0.5 0.5 s -0.22 0.5 -0.5 0.5 Z M 19 3 l -6 6 l 2 2 l 7 -7 V 3 Z"})});var kge=UWe,Mge=Fqe,Wz=_qe,Rge=xqe;var zl=class extends zg.Component{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initialExpanded},this.headerClicked=()=>{this.props.onHeaderClick?this.props.onHeaderClick():this.setState({isExpanded:!this.state.isExpanded})}}render(){let t=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(t+=" "+this.props.childrenClassName),(0,ao.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0},children:[(0,ao.jsx)("div",{className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title,children:(0,ao.jsxs)(or,{onClick:this.headerClicked,children:[!this.props.hideExpander&&(0,ao.jsx)(an,{svg:this.state.isExpanded?Lc:Bc}),this.props.topRightIcon&&(0,ao.jsx)(an,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}}),(0,ao.jsx)("b",{children:this.props.header})]})}),this.state.isExpanded&&(0,ao.jsx)("div",{className:t,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"},children:this.props.children})]})}};function Bge(e){return e}var mc=class extends zg.PureComponent{constructor(){super(...arguments),this.input=zg.createRef(),this.delayHandle=void 0,this.pendingValue=void 0,this.state={originalValue:"",value:""},this.onBlur=()=>{this.setState({value:""+this.state.originalValue}),this.props.onBlur&&this.props.onBlur()},this.raiseOnChange=()=>{this.pendingValue!==void 0&&(this.props.onChange(this.pendingValue),this.pendingValue=void 0)},this.onChange=t=>{let r=t.target.value;if(this.props.isValid&&!this.props.isValid(r)||this.props.numeric&&Number.isNaN(+r)){this.clearTimeout(),this.setState({value:r});return}if(this.props.numeric)this.setState({value:r},()=>this.triggerChanged(r,+r));else{let o=(this.props.toValue||Bge)(r),i=(this.props.fromValue||Bge)(o);this.setState({value:i},()=>this.triggerChanged(i,o))}},this.onKeyUp=t=>{(t.charCode===27||t.keyCode===27||t.key==="Escape")&&this.props.blurOnEscape&&this.input.current&&this.input.current.blur()},this.onKeyPress=t=>{(t.keyCode===13||t.charCode===13||t.key==="Enter")&&(this.isPending&&(this.clearTimeout(),this.raiseOnChange()),this.props.blurOnEnter&&this.input.current&&this.input.current.blur(),this.props.onEnter&&this.props.onEnter()),t.stopPropagation()}}get isPending(){return typeof this.delayHandle<"u"}clearTimeout(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)}triggerChanged(t,r){this.clearTimeout(),t!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=r,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(r))}static getDerivedStateFromProps(t,r){let n=t.fromValue?t.fromValue(t.value):t.value;return n===r.originalValue?null:{originalValue:n,value:n}}render(){return(0,ao.jsx)("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled})}},YM=class extends zg.Component{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){let{label:t,pivot:r,controls:n}=this.props;return(0,ao.jsxs)(ao.Fragment,{children:[(0,ao.jsx)($s,{label:(0,ao.jsxs)(ao.Fragment,{children:[t,(0,ao.jsx)("button",{className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:`${this.state.isExpanded?"Less":"More"} options`,style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,ao.jsx)(an,{svg:this.state.isExpanded?e_:nf,style:{display:"inline-block"}})})]}),control:r,children:this.props.colorStripe&&(0,ao.jsx)("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:ze.toStyle(this.props.colorStripe)}})}),this.state.isExpanded&&(0,ao.jsx)("div",{className:"msp-control-offset",children:n})]})}};function of(e){return(0,ao.jsxs)("div",{className:`msp-section-header${e.accent?" msp-transform-header-brand-"+e.accent:""}`,children:[e.icon&&(0,ao.jsx)(an,{svg:e.icon}),e.title," ",(0,ao.jsx)("small",{children:e.desc})]})}function or(e){let t="msp-btn";e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),(e.commit==="on"||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),e.commit==="off"&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className);let r;return e.flex&&(typeof e.flex=="number"?r={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:typeof e.flex=="string"&&(r={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex})),e.style&&(r?Object.assign(r,e.style):r=e.style),(0,ao.jsxs)("button",{onClick:e.onClick,title:e.title,disabled:e.disabled,style:r,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[e.icon&&(0,ao.jsx)(an,{svg:e.icon}),e.children]})}function Jt(e){let t=`msp-btn msp-btn-icon${e.small?"-small":""}${e.className?" "+e.className:""}`;typeof e.toggleState<"u"&&(t+=` msp-btn-link-toggle-${e.toggleState?"on":"off"}`),e.transparent&&(t+=" msp-transparent-bg");let r;return e.flex&&(typeof e.flex=="boolean"?r={flex:"0 0 32px",padding:0}:typeof e.flex=="number"?r={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:r={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex}),e.style&&(r?Object.assign(r,e.style):r=e.style),(0,ao.jsxs)("button",{className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:r,children:[e.svg&&(0,ao.jsx)(an,{svg:e.svg}),e.extraContent]})}var gi=class extends zg.PureComponent{constructor(){super(...arguments),this.onClick=t=>{t.currentTarget.blur(),this.props.toggle()}}render(){let t=this.props,r=t.label,n=t.isSelected?`${t.className||""} msp-control-current`:t.className;return(0,ao.jsx)(or,{icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:t.disabled,style:t.style,className:n,children:r&&this.props.isSelected?(0,ao.jsx)("b",{children:r}):r})}},lo=class extends zg.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,ao.jsxs)(ao.Fragment,{children:[(0,ao.jsx)("div",{className:"msp-control-group-header",style:{marginTop:this.props.marginTop!==void 0?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin},children:(0,ao.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle,children:[(0,ao.jsx)(an,{svg:this.state.isExpanded?Bc:Lc}),this.props.header]})}),this.state.isExpanded&&(this.props.noOffset?this.props.children:(0,ao.jsx)("div",{className:this.props.accent?"msp-accent-offset":"msp-control-offset",children:this.props.children}))]})}};function $s(e){let t="msp-control-row";return e.className&&(t+=" "+e.className),(0,ao.jsxs)("div",{className:t,children:[(0,ao.jsx)("span",{className:"msp-control-row-label",title:e.title,children:e.label}),(0,ao.jsx)("div",{className:"msp-control-row-ctrl",children:e.control}),e.children]})}var rd=MS.createContext(void 0),yr=class extends MS.Component{subscribe(t,r){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(t.subscribe(r))}componentWillUnmount(){if(this.subs){for(let t of this.subs)t.unsubscribe();this.subs=void 0}}constructor(t,r){super(t),this.subs=void 0,this.plugin=r,this.init&&this.init()}};yr.contextType=rd;var Xo=class extends MS.PureComponent{subscribe(t,r){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(t.subscribe(r))}componentWillUnmount(){if(this.subs){for(let t of this.subs)t.unsubscribe();this.subs=void 0}}constructor(t,r){super(t,r),this.subs=void 0,this.plugin=r,this.init&&this.init()}};Xo.contextType=rd;var il=class extends yr{componentDidUpdate(t){this.props.initiallyCollapsed!==void 0&&t.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})}render(){var t;if(this.state.isHidden)return null;let r=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";return(0,y1.jsxs)("div",{className:r,children:[(0,y1.jsx)("div",{className:"msp-transform-header",children:(0,y1.jsxs)(or,{icon:this.state.brand?void 0:this.state.isCollapsed?Lc:Bc,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?`msp-transform-header-brand msp-transform-header-brand-${this.state.brand.accent}`:void 0,title:`Click to ${this.state.isCollapsed?"expand":"collapse"}`,children:[(0,y1.jsx)(an,{svg:(t=this.state.brand)===null||t===void 0?void 0:t.svg,inline:!0}),this.state.header,(0,y1.jsx)("small",{style:{margin:"0 6px"},children:this.state.isCollapsed?"":this.state.description})]})}),!this.state.isCollapsed&&this.renderControls()]})}constructor(t,r){super(t,r),this.toggleCollapsed=()=>{this.setState({isCollapsed:!this.state.isCollapsed})};let n=this.defaultState();t.initiallyCollapsed!==void 0&&(n.isCollapsed=t.initiallyCollapsed),t.header!==void 0&&(n.header=t.header),this.state=n}};var dt=ar(un()),Ti=ar(hi());var na=ar(un()),Yz=ar(hi());var hr=class extends Yz.PureComponent{constructor(){super(...arguments),this.hide=()=>this.props.onSelect(void 0)}render(){let t=this.props,r=(0,na.jsx)(Kz,{items:t.items,onSelect:t.onSelect,current:t.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent});return(0,na.jsxs)("div",{className:`msp-action-menu-options${t.header?"":" msp-action-menu-options-no-header"}`,children:[t.header&&(0,na.jsx)(zl,{header:t.header,title:t.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:hu,children:r}),!t.header&&r]})}};(function(e){function t(c,u){return u?{kind:"header",label:c,...u}:{kind:"header",label:c}}e.Header=t;function r(c,u,d){return{kind:"item",label:c,value:u,...d}}e.Item=r;function n(c,u){let{label:d,value:m,category:p,selected:h,icon:f,addOn:C,description:g}=u||{},b,y=[];for(let x=0;x<c.length;x++){let A=c[x];if(u?.filter&&!u.filter(A))continue;let v=p?.(A),_=d?d(A):""+A,I=m?m(A):A,T=g?g(A):typeof A=="string"?A:void 0,E;v?(b||(b=new Map),E=b.get(v),E||(E=[e.Header(v,{description:v})],b.set(v,E),y.push(E))):E=y;let w=C?.(A);E.push({kind:"item",label:_,value:I,icon:f?f(A):void 0,selected:h?h(A):void 0,addOn:w,description:T})}return y}e.createItems=n;let o={value:c=>c[0],label:c=>c[1],category:c=>c[2]};function i(c,u){return n(c,u?{...o,...u}:o)}e.createItemsFromSelectOptions=i;function s(c){if(Hg(c))return!1;if(RS(c))return!!c.selected;for(let u of c)if(s(u))return!0;return!1}e.hasSelectedItem=s;function a(c,u){if(!Hg(c)){if(RS(c))return c.value===u?c:void 0;for(let d of c){let m=a(d,u);if(m)return m}}}e.findItem=a;function l(c){if(!Hg(c)){if(RS(c))return c;for(let u of c){let d=l(u);if(d)return d}}}e.getFirstItem=l})(hr||(hr={}));var Kz=class e extends Yz.PureComponent{constructor(){super(...arguments),this.state=e.createState(this.props),this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()},this.selectAll=()=>{let t=Xz(this.props.items,[]).filter(r=>!r.selected);this.props.onSelect(t)},this.selectNone=()=>{let t=Xz(this.props.items,[]).filter(r=>!!r.selected);this.props.onSelect(t)}}static createState(t,r){let n=Zz(t.items)&&Hg(t.items[0])?t.items[0]:void 0,o=n?.isIndependent?!1:t.multiselect?hr.hasSelectedItem(t.items):!!t.current&&!!hr.findItem(t.items,t.current.value)||hr.hasSelectedItem(t.items);return{header:n,hasCurrent:o,isExpanded:o||(r??!!n?.initiallyExpanded)}}componentDidUpdate(t){if(this.props.items!==t.items||this.props.current!==t.current){let r=Zz(this.props.items)&&Zz(t.items)&&Hg(this.props.items[0])&&Hg(t.items[0])&&this.props.items[0].label===t.items[0].label?this.state.isExpanded:void 0;this.setState(e.createState(this.props,r))}}get multiselectHeader(){let{header:t,hasCurrent:r}=this.state;return(0,na.jsxs)("div",{className:"msp-flex-row msp-control-group-header",children:[(0,na.jsx)(or,{icon:this.state.isExpanded?Bc:Lc,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}.${t?.description?` ${t?.description}`:""}`,children:r?(0,na.jsx)("b",{children:t?.label}):t?.label}),(0,na.jsx)(or,{icon:Fd,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"},children:"All"}),(0,na.jsx)(or,{icon:hu,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"},children:"None"})]})}get basicHeader(){let{header:t,hasCurrent:r}=this.state;return(0,na.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,na.jsx)(or,{noOverflow:!0,icon:this.state.isExpanded?Bc:Lc,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}. ${t?.description?t?.description:""}`,children:r?(0,na.jsx)("b",{children:t?.label}):t?.label})})}render(){let{items:t,onSelect:r,current:n}=this.props;if(Hg(t))return null;if(RS(t))return(0,na.jsx)(Lge,{item:t,onSelect:r,current:n,multiselect:this.props.multiselect});let{header:o}=this.state;return(0,na.jsxs)(na.Fragment,{children:[o&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),(0,na.jsx)("div",{className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset",children:(!o||this.state.isExpanded)&&t.map((i,s)=>Hg(i)?null:RS(i)?(0,na.jsx)(Lge,{item:i,onSelect:r,current:n,multiselect:this.props.multiselect},s):(0,na.jsx)(e,{items:i,onSelect:r,current:n,multiselect:this.props.multiselect,noAccent:!0},s))})]})}},Lge=({item:e,onSelect:t,current:r,multiselect:n})=>{let o=r===e,i=e.addOn?{position:"relative"}:void 0;return(0,na.jsxs)(or,{icon:e.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:s=>t(n?[e]:e,s),disabled:e.disabled,style:i,title:e.description,children:[o||e.selected?(0,na.jsx)("b",{children:e.label}):e.label,e.addOn]})};function Zz(e){return!!e&&Array.isArray(e)}function RS(e){let t=e;return t&&t.kind==="item"}function Hg(e){let t=e;return t&&t.kind==="header"}function Xz(e,t){if(Hg(e))return t;if(RS(e))return t.push(e),t;for(let r of e)Xz(r,t);return t}var xa=ar(un());var Nge=ar(hi());var Qz=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]];var BS=class extends Nge.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded||!!this.props.hideNameRow,lightness:0},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()},this.onClickSwatch=t=>{let r=ze.fromHexString(t.currentTarget.getAttribute("data-color")||"0");r!==this.props.value&&(this.props.param.isExpanded||this.setState({isExpanded:!1}),this.update(r))},this.onR=t=>{let[,r,n]=ze.toRgb(this.props.value),o=ze.fromRgb(t,r,n);o!==this.props.value&&this.update(o)},this.onG=t=>{let[r,,n]=ze.toRgb(this.props.value),o=ze.fromRgb(r,t,n);o!==this.props.value&&this.update(o)},this.onB=t=>{let[r,n]=ze.toRgb(this.props.value),o=ze.fromRgb(r,n,t);o!==this.props.value&&this.update(o)},this.onRGB=t=>{let r=ze.fromHexStyle(t.currentTarget.value||"0");r!==this.props.value&&this.update(r)},this.onLighten=()=>{this.update(ze.lighten(this.props.value,.1))},this.onDarken=()=>{this.update(ze.darken(this.props.value,.1))}}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}swatch(){return(0,xa.jsx)("div",{className:"msp-combined-color-swatch",children:Qz.map(t=>(0,xa.jsx)(or,{inline:!0,"data-color":t[1],onClick:this.onClickSwatch,style:{background:ze.toStyle(t[1])}},t[1]))})}render(){let t=this.props.param.label||Pa(this.props.name),[r,n,o]=ze.toRgb(this.props.value),i=(0,xa.jsxs)(xa.Fragment,{children:[this.swatch(),(0,xa.jsx)($s,{label:"RGB",className:"msp-control-label-short",control:(0,xa.jsxs)("div",{style:{display:"flex",textAlignLast:"center",left:"80px"},children:[(0,xa.jsx)(mc,{onChange:this.onR,numeric:!0,value:r,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,xa.jsx)(mc,{onChange:this.onG,numeric:!0,value:n,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,xa.jsx)(mc,{onChange:this.onB,numeric:!0,value:o,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,xa.jsx)("input",{onInput:this.onRGB,type:"color",value:ze.toHexStyle(this.props.value),style:{order:4,flex:"1 1 auto",minWidth:"32px",width:"32px",height:"32px",padding:"0 2px 0 2px",background:"none",border:"none",cursor:"pointer"}})]})}),(0,xa.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,xa.jsx)(or,{onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Lighten"}),(0,xa.jsx)(or,{onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Darken"})]})]});return this.props.hideNameRow?i:(0,xa.jsxs)(xa.Fragment,{children:[(0,xa.jsx)($s,{title:this.props.param.description,label:t,control:(0,xa.jsx)(or,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:ze.toStyle(this.props.value)}})}),this.state.isExpanded&&(0,xa.jsx)("div",{className:"msp-control-offset",children:i})]})}};var R2r=function(){let e=new Map;for(let t of Qz)e.set(t[1],t[0]);return e}();var sh=ar(un());var tH=ar(hi());function Fge(e){switch(e.kind){case"scale-legend":return Jz;case"table-legend":return eH;default:let t=e;return}}var Jz=class extends tH.PureComponent{render(){let{legend:t}=this.props,r=t.colors.map(n=>Array.isArray(n)?`${ze.toStyle(n[0])} ${100*n[1]}%`:ze.toStyle(n)).join(", ");return(0,sh.jsx)("div",{className:"msp-scale-legend",children:(0,sh.jsxs)("div",{style:{background:`linear-gradient(to right, ${r})`},children:[(0,sh.jsx)("span",{style:{float:"left"},children:t.minLabel}),(0,sh.jsx)("span",{style:{float:"right"},children:t.maxLabel})]})})}},eH=class extends tH.PureComponent{render(){let{legend:t}=this.props;return(0,sh.jsx)("div",{className:"msp-table-legend",children:t.table.map((r,n)=>{let[o,i]=r;return(0,sh.jsxs)("div",{children:[(0,sh.jsx)("div",{className:"msp-table-legend-color",style:{backgroundColor:ze.toStyle(i)}}),(0,sh.jsx)("div",{className:"msp-table-legend-text",children:o})]},n)})})}};var ah=ar(un());var Oge=ar(un()),Vge=ar(hi());var QM=class extends Vge.Component{constructor(t){super(t),this.state={show:!1},this.handleHover=this.handleHover.bind(this),this.handleHoverOff=this.handleHoverOff.bind(this),this.deletePoint=this.deletePoint.bind(this)}handleHover(){this.setState({show:!0});let t=Ve.create(this.props.nX,this.props.nY);this.props.onmouseover(t)}handleHoverOff(){this.setState({show:!1}),this.props.onmouseover(void 0)}deletePoint(){this.props.delete(this.props.id)}render(){return[(0,Oge.jsx)("circle",{r:"10",id:`${this.props.id}`,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},`${this.props.id}circle`)]}};var eR=ar(hi());var JM=class extends eR.Component{constructor(t){super(t),this.handleKeyDown=r=>{},this.handleKeyUp=r=>{},this.handleClick=r=>n=>{},this.handleMouseDown=r=>n=>{if(r===0||r===this.state.points.length-1||this.state.canSelectMultiple)return;let o=this.normalizePoint(Ve.create(this.state.points[r][0],this.state.points[r][1]));this.ghostPoints.push(document.createElementNS(this.namespace,"circle")),this.ghostPoints[0].setAttribute("r","10"),this.ghostPoints[0].setAttribute("fill","orange"),this.ghostPoints[0].setAttribute("cx",`${o[0]}`),this.ghostPoints[0].setAttribute("cy",`${o[1]}`),this.ghostPoints[0].setAttribute("style","display: none"),this.gElement.appendChild(this.ghostPoints[0]),this.updatedX=o[0],this.updatedY=o[1],this.selected=[r]},this.deletePoint=r=>n=>{if(r===0||r===this.state.points.length-1)return;let o=this.state.points.filter((i,s)=>s!==r);o.sort((i,s)=>i[0]===s[0]?i[0]===0?i[1]-s[1]:i[1]===1?s[1]-i[1]:i[1]-s[1]:i[0]-s[0]),this.setState({points:o}),this.change(o),n.stopPropagation()},this.myRef=eR.createRef(),this.state={points:[Ve.create(0,0),Ve.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},this.height=400,this.width=600,this.padding=70,this.selected=void 0,this.ghostPoints=[],this.namespace="http://www.w3.org/2000/svg";for(let r of this.props.data)this.state.points.push(r);this.state.points.sort((r,n)=>r[0]===n[0]?r[0]===0?r[1]-n[1]:r[1]===1?n[1]-r[1]:r[1]-n[1]:r[0]-n[0]),this.handleDrag=this.handleDrag.bind(this),this.handleMultipleDrag=this.handleMultipleDrag.bind(this),this.handleDoubleClick=this.handleDoubleClick.bind(this),this.refCallBack=this.refCallBack.bind(this),this.handlePointUpdate=this.handlePointUpdate.bind(this),this.change=this.change.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleEnter=this.handleEnter.bind(this)}render(){let t=this.renderPoints(),r=this.renderLines(),n=this.renderHistogram();return[(0,ah.jsx)("div",{children:(0,ah.jsxs)("svg",{className:"msp-canvas",ref:this.refCallBack,viewBox:`0 0 ${this.width+this.padding} ${this.height+this.padding}`,onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick,children:[(0,ah.jsxs)("g",{stroke:"black",fill:"black",children:[n,r,t]}),(0,ah.jsx)("g",{className:"ghost-points",stroke:"black",fill:"black"})]})},"LineGraph"),(0,ah.jsx)("div",{id:"modal-root"},"modal")]}componentDidMount(){this.gElement=document.getElementsByClassName("ghost-points")[0]}change(t){let r=t.slice();r.shift(),r.pop(),this.props.onChange(r)}handleDrag(t){if(this.selected===void 0)return;let r=this.myRef.createSVGPoint(),n,o=this.padding/2;r.x=t.clientX,r.y=t.clientY;let i=r.matrixTransform(this.myRef.getScreenCTM().inverse());n=Ve.create(i.x,i.y),(i.x<o||i.x>this.width+o)&&(i.y>this.height+o||i.y<o)?n=Ve.create(this.updatedX,this.updatedY):i.x<o?n=Ve.create(o,i.y):i.x>this.width+o?n=Ve.create(this.width+o,i.y):i.y>this.height+o?n=Ve.create(i.x,this.height+o):i.y<o?n=Ve.create(i.x,o):n=Ve.create(i.x,i.y),this.updatedX=n[0],this.updatedY=n[1];let s=this.unNormalizePoint(n);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",`${n[0]}`),this.ghostPoints[0].setAttribute("cy",`${n[1]}`),this.props.onDrag(s)}handleMultipleDrag(){}handlePointUpdate(t){let r=this.selected;if(this.state.canSelectMultiple)return;if(r===void 0||r[0]===0||r[0]===this.state.points.length-1){this.setState({copyPoint:void 0});return}this.selected=void 0;let n=this.unNormalizePoint(Ve.create(this.updatedX,this.updatedY)),o=this.state.points.filter((i,s)=>s!==r[0]);o.push(n),o.sort((i,s)=>i[0]===s[0]?i[0]===0?i[1]-s[1]:i[1]===1?s[1]-i[1]:i[1]-s[1]:i[0]-s[0]),this.setState({points:o}),this.change(o),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}handleDoubleClick(t){let r=this.myRef.createSVGPoint();r.x=t.clientX,r.y=t.clientY;let n=r.matrixTransform(this.myRef.getScreenCTM().inverse()),o=this.state.points,i=this.padding/2;if(n.x<i||n.x>this.width+i||n.y>this.height+i||n.y<this.padding/2)return;let s=this.unNormalizePoint(Ve.create(n.x,n.y));o.push(s),o.sort((a,l)=>a[0]===l[0]?a[0]===0?a[1]-l[1]:a[1]===1?l[1]-a[1]:a[1]-l[1]:a[0]-l[0]),this.setState({points:o}),this.change(o)}handleLeave(){this.selected!==void 0&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))}handleEnter(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}normalizePoint(t){let r=this.padding/2,n=this.width+r,o=this.height+r,i=t[0]*(n-r)+r,s=t[1]*(o-r)+r,a=this.height+this.padding-s;return Ve.create(i,a)}unNormalizePoint(t){let r=this.padding/2,n=this.width+r,o=this.height+r,i=(t[0]-r)/(n-r),s=(this.height+this.padding-t[1]-r)/(o-r);return Ve.create(i,s)}refCallBack(t){t&&(this.myRef=t)}renderHistogram(){if(!this.props.volume)return null;let t=go.getHistogram(this.props.volume.grid,40),r=[],n=t.counts.length,o=this.width/n,i=this.padding/2,s=Da(t.counts)||1;for(let a=0;a<n;a++){let l=this.width*a/(n-1)+i,c=this.height+i,u=this.height*(1-t.counts[a]/s)+i;r.push((0,ah.jsx)("line",{x1:l,x2:l,y1:c,y2:u,stroke:"#ded9ca",strokeWidth:o},`histogram${a}`))}return r}renderPoints(){let t=[],r;for(let n=0;n<this.state.points.length;n++)n!==0&&n!==this.state.points.length-1&&(r=this.normalizePoint(this.state.points[n]),t.push((0,ah.jsx)(QM,{id:n,x:r[0],y:r[1],nX:this.state.points[n][0],nY:this.state.points[n][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(n),onclick:this.handleClick(n)},n)));return t}renderLines(){let t=[],r=[],n,o,i,s,a,l=this.padding/2;for(let d of this.state.points)n=this.width+l,o=this.height+this.padding,i=d[0]*(n-l)+l,s=d[1]*(o-l)+l,a=this.height+this.padding-s,t.push(Ve.create(i,a));let c=t,u=c.length;for(let d=0;d<u-1;d++){let m=c[d][0],p=c[d][1],h=c[d+1][0],f=c[d+1][1];r.push((0,ah.jsx)("line",{x1:m,x2:h,y1:p,y2:f,stroke:"#cec9ba",strokeWidth:"5"},`lineOf${d}`))}return r}};var Hl=ar(un()),lh=ar(hi());var ch=class extends lh.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:0},this.begin=()=>{this.setState({isChanging:!0})},this.end=t=>{this.setState({isChanging:!1}),this.props.onChange(t)},this.updateCurrent=t=>{var r,n;this.setState({current:t}),(n=(r=this.props).onChangeImmediate)===null||n===void 0||n.call(r,t)},this.updateManually=t=>{this.setState({isChanging:!0});let r=t;this.props.step===1&&(r=Math.round(r)),r<this.props.min&&(r=this.props.min),r>this.props.max&&(r=this.props.max),this.setState({current:r,isChanging:!0})},this.onManualBlur=()=>{this.setState({isChanging:!1}),this.props.onChange(this.state.current)}}static getDerivedStateFromProps(t,r){return r.isChanging||t.value===r.current?null:{current:t.value}}render(){let t=this.props.step;return t===void 0&&(t=1),(0,Hl.jsxs)("div",{className:"msp-slider",children:[(0,Hl.jsx)("div",{children:(0,Hl.jsx)(r_,{min:this.props.min,max:this.props.max,step:t,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end})}),(0,Hl.jsx)("div",{children:(0,Hl.jsx)(mc,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually})})]})}},tR=class extends lh.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:[0,1]},this.begin=()=>{this.setState({isChanging:!0})},this.end=t=>{this.setState({isChanging:!1}),this.props.onChange(t)},this.updateCurrent=t=>{this.setState({current:t})},this.updateMax=t=>{let r=t;this.props.step===1&&(r=Math.round(r)),r<this.state.current[0]?r=this.state.current[0]:r<this.props.min&&(r=this.props.min),r>this.props.max&&(r=this.props.max),this.props.onChange([this.state.current[0],r])},this.updateMin=t=>{let r=t;this.props.step===1&&(r=Math.round(r)),r<this.props.min&&(r=this.props.min),r>this.state.current[1]?r=this.state.current[1]:r>this.props.max&&(r=this.props.max),this.props.onChange([r,this.state.current[1]])}}static getDerivedStateFromProps(t,r){return r.isChanging||t.value[0]===r.current[0]&&t.value[1]===r.current[1]?null:{current:t.value}}render(){let t=this.props.step;return t===void 0&&(t=1),(0,Hl.jsxs)("div",{className:"msp-slider2",children:[(0,Hl.jsx)("div",{children:(0,Hl.jsx)(mc,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin})}),(0,Hl.jsx)("div",{children:(0,Hl.jsx)(r_,{min:this.props.min,max:this.props.max,step:t,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0})}),(0,Hl.jsx)("div",{children:(0,Hl.jsx)(mc,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax})})]})}};function nH(e){let t=[],r={}.hasOwnProperty;for(let n=0;n<arguments.length;n++){let o=arguments[n];if(!o)continue;let i=typeof o;if(i==="string"||i==="number")t.push(o);else if(Array.isArray(o))t.push(nH.apply(null,o));else if(i==="object")for(let s in o)r.call(o,s)&&o[s]&&t.push(s)}return t.join(" ")}function Gge(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function Uge(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function zge(e,t){return e?t.clientY:t.pageX}function Hge(e,t){let r=t.getBoundingClientRect();return e?r.top+r.height*.5:r.left+r.width*.5}function rH(e){e.stopPropagation(),e.preventDefault()}var oH=class extends lh.Component{render(){let{className:t,tipFormatter:r,vertical:n,offset:o,value:i,index:s}=this.props,a=n?{bottom:`${o}%`}:{left:`${o}%`};return(0,Hl.jsx)("div",{className:t,style:a,title:r(i,s)})}},r_=class extends lh.Component{constructor(t){super(t),this.sliderElement=lh.createRef(),this.handleElements=[],this.dragOffset=0,this.startPosition=0,this.startValue=0,this._getPointsCache=void 0,this.onMouseDown=u=>{if(u.button!==0)return;let d=zge(this.props.vertical,u);if(!this.isEventFromHandle(u))this.dragOffset=0;else{let m=Hge(this.props.vertical,u.target);this.dragOffset=d-m,d=m}this.onStart(d),this.addDocumentEvents("mouse"),rH(u)},this.onTouchMove=u=>{if(Gge(u)){this.end("touch");return}let d=Uge(this.props.vertical,u);this.onMove(u,d-this.dragOffset)},this.onTouchStart=u=>{if(Gge(u))return;let d=Uge(this.props.vertical,u);if(!this.isEventFromHandle(u))this.dragOffset=0;else{let m=Hge(this.props.vertical,u.target);this.dragOffset=d-m,d=m}this.onStart(d),this.addDocumentEvents("touch"),rH(u)},this.eventHandlers={touchmove:u=>this.onTouchMove(u),touchend:u=>this.end("touch"),mousemove:u=>this.onMouseMove(u),mouseup:u=>this.end("mouse")},this.calcOffset=u=>{let{min:d,max:m}=this.props;return(u-d)/(m-d)*100};let{range:r,min:n,max:o}=t,i=r?Array.apply(null,Array(+r+1)).map(()=>n):n,s="defaultValue"in t?t.defaultValue:i,a=t.value!==void 0?t.value:s,l=(r?a:[n,a]).map(u=>this.trimAlignValue(u)),c;r&&l[0]===l[l.length-1]&&l[0]===o?c=0:c=l.length-1,this.state={handle:null,recent:c,bounds:l}}componentDidUpdate(t){if(!("value"in this.props||"min"in this.props||"max"in this.props))return;let{bounds:r}=this.state;if(t.range){let o=(this.props.value||r).map(i=>this.trimAlignValue(i,this.props));if(o.every((i,s)=>i===r[s]))return;this.setState({bounds:o}),r.some(i=>this.isValueOutOfBounds(i,this.props))&&this.props.onChange(o)}else{let n=this.props.value!==void 0?this.props.value:r[1],o=this.trimAlignValue(n,this.props);if(o===r[1]&&r[0]===t.min)return;this.setState({bounds:[t.min,o]}),this.isValueOutOfBounds(r[1],this.props)&&this.props.onChange(o)}}onChange(t){let r=this.props;!("value"in r)?this.setState(t):t.handle!==void 0&&this.setState({handle:t.handle});let o={...this.state,...t},i=r.range?o.bounds:o.bounds[1];r.onChange(i)}onMouseMove(t){let r=zge(this.props.vertical,t);this.onMove(t,r-this.dragOffset)}onMove(t,r){rH(t);let n=this.props,o=this.state,i=r-this.startPosition;i=this.props.vertical?-i:i;let s=i/this.getSliderLength()*(n.max-n.min),a=this.trimAlignValue(this.startValue+s),l=o.bounds[o.handle];if(a===l)return;let c=[...o.bounds];c[o.handle]=a;let u=o.handle;if(n.pushable){let d=o.bounds[u];this.pushSurroundingHandles(c,u,d)}else n.allowCross&&(c.sort((d,m)=>d-m),u=c.indexOf(a));this.onChange({handle:u,bounds:c})}onStart(t){this.props.onBeforeChange(this.getValue());let n=this.calcValueByPos(t);this.startValue=n,this.startPosition=t;let o=this.state,{bounds:i}=o,s=1;if(this.props.range){let c=0;for(let d=1;d<i.length-1;++d)n>i[d]&&(c=d);Math.abs(i[c+1]-n)<Math.abs(i[c]-n)&&(c=c+1),s=c;let u=i[c+1]===i[c];u&&(s=o.recent),u&&n!==i[c+1]&&(s=n<i[c+1]?c:c+1)}this.setState({handle:s,recent:s});let a=o.bounds[s];if(n===a)return;let l=[...o.bounds];l[s]=n,this.onChange({bounds:l})}getPoints(){let{marks:t,step:r,min:n,max:o}=this.props,i=this._getPointsCache;if(!i||i.marks!==t||i.step!==r){let s={...t};if(r!==null)for(let l=n;l<=o;l+=r)s[l]=l;let a=Object.keys(s).map(parseFloat);a.sort((l,c)=>l-c),this._getPointsCache={marks:t,step:r,points:a}}return this._getPointsCache.points}getPrecision(t){let r=t.toString(),n=0;return r.indexOf(".")>=0&&(n=r.length-r.indexOf(".")-1),n}getSliderLength(){let t=this.sliderElement.current;return t?this.props.vertical?t.clientHeight:t.clientWidth:0}getSliderStart(){let r=this.sliderElement.current.getBoundingClientRect();return this.props.vertical?r.top:r.left}getValue(){let{bounds:t}=this.state;return this.props.range?t:t[1]}addDocumentEvents(t){t==="touch"?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):t==="mouse"&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))}calcValue(t){let{vertical:r,min:n,max:o}=this.props,i=Math.abs(t/this.getSliderLength());return r?(1-i)*(o-n)+n:i*(o-n)+n}calcValueByPos(t){let r=t-this.getSliderStart();return this.trimAlignValue(this.calcValue(r))}end(t){this.removeEvents(t),this.props.onAfterChange(this.getValue()),this.setState({handle:null})}isEventFromHandle(t){for(let r of this.handleElements)if(r.current===t.target)return!0;return!1}isValueOutOfBounds(t,r){return t<r.min||t>r.max}pushHandle(t,r,n,o){let i=t[r],s=t[r];for(;n*(s-i)<o;){if(!this.pushHandleOnePoint(t,r,n))return t[r]=i,!1;s=t[r]}return!0}pushHandleOnePoint(t,r,n){let o=this.getPoints(),s=o.indexOf(t[r])+n;if(s>=o.length||s<0)return!1;let a=r+n,l=o[s],{pushable:c}=this.props,u=n*(t[a]-l);return this.pushHandle(t,a,n,+c-u)?(t[r]=l,!0):!1}pushSurroundingHandles(t,r,n){let{pushable:o}=this.props,i=t[r],s=0;if(t[r+1]-i<+o?s=1:i-t[r-1]<+o&&(s=-1),s===0)return;let a=r+s,l=s*(t[a]-i);this.pushHandle(t,a,s,+o-l)||(t[r]=n)}removeEvents(t){t==="touch"?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):t==="mouse"&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))}trimAlignValue(t,r){let{handle:n,bounds:o}=this.state||{},{marks:i,step:s,min:a,max:l,allowCross:c}={...this.props,...r||{}},u=t;u<=a&&(u=a),u>=l&&(u=l),!c&&n!=null&&n>0&&u<=o[n-1]&&(u=o[n-1]),!c&&n!=null&&n<o.length-1&&u>=o[n+1]&&(u=o[n+1]);let d=Object.keys(i).map(parseFloat);if(s!==null){let h=Math.round((u-a)/s)*s+a;d.push(h)}let m=d.map(h=>Math.abs(u-h)),p=d[m.indexOf(Math.min.apply(Math,m))];return s!==null?parseFloat(p.toFixed(this.getPrecision(s))):p}render(){let{handle:t,bounds:r}=this.state,{className:n,prefixCls:o,disabled:i,vertical:s,range:a,step:l,marks:c,tipFormatter:u}=this.props,d=this.props.handle,m=r.map(this.calcOffset),p=`${o}-handle`,h=r.map((y,x)=>nH({[p]:!0,[`${p}-${x+1}`]:!0,[`${p}-lower`]:x===0,[`${p}-upper`]:x===r.length-1})),C={prefixCls:o,noTip:l===null||u===null,tipFormatter:u,vertical:s};if(this.handleElements.length!==r.length){this.handleElements=[];for(let y=0;y<r.length;y++)this.handleElements.push(lh.createRef())}let g=r.map((y,x)=>lh.cloneElement(d,{...C,className:h[x],value:y,offset:m[x],dragging:t===x,index:x,key:x,ref:this.handleElements[x]}));a||g.shift();let b=nH({[o]:!0,[`${o}-with-marks`]:Object.keys(c).length,[`${o}-disabled`]:i,[`${o}-vertical`]:this.props.vertical,[n]:!!n});return(0,Hl.jsxs)("div",{ref:this.sliderElement,className:b,onTouchStart:i?vc:this.onTouchStart,onMouseDown:i?vc:this.onMouseDown,children:[(0,Hl.jsx)("div",{className:`${o}-rail`}),g]})}};r_.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:(0,Hl.jsx)(oH,{className:"",vertical:!1,offset:0,tipFormatter:e=>e,value:0,index:0}),onBeforeChange:vc,onChange:vc,onAfterChange:vc,tipFormatter:(e,t)=>e,disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1};var An=class extends Ti.PureComponent{constructor(){super(...arguments),this.onChange=t=>{var r,n;if((n=(r=this.props).onChange)===null||n===void 0||n.call(r,t,this.props.values),this.props.onChangeValues){let o={...this.props.values,[t.name]:t.value};this.props.onChangeValues(o,this.props.values)}},this.paramGroups=nu(t=>Wqe(t))}renderGroup(t){var r;if(t.length===0)return null;let n=this.props.values,o=null,i;for(let[s,a,l]of t)!((r=a.hideIf)===null||r===void 0)&&r.call(a,n)||(o||(o=[]),i=a.category,o.push((0,dt.jsx)(l,{param:a,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:s,value:n[s]},s)));return o?i?[(0,dt.jsx)(lo,{header:i,children:o},i)]:o:null}renderPart(t){let r=null;for(let n of t){let o=this.renderGroup(n);if(o){r||(r=[]);for(let i of o)r.push(i)}}return r}render(){let t=this.paramGroups(this.props.params),r=this.renderPart(t.essentials),n=this.renderPart(t.advanced);return r&&n?(0,dt.jsxs)(dt.Fragment,{children:[r,(0,dt.jsx)(lo,{header:"Advanced Options",children:n})]}):r||n}},nR=class extends yr{constructor(){super(...arguments),this.state={isDisabled:!1},this.setSettings=(t,r)=>{let n={...r,[t.name]:t.value},o=this.props.mapping.update(n,this.plugin);this.props.mapping.apply(o,this.plugin)}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,t=>{this.setState({isDisabled:t})})}render(){let t=this.props.mapping.getTarget(this.plugin),r=this.props.mapping.getValues(t,this.plugin),n=this.props.mapping.params(this.plugin);return(0,dt.jsx)(An,{params:n,values:r,onChange:this.setSettings,isDisabled:this.state.isDisabled})}};function Wqe(e){function t(s,a,l){let c=a_(a);if(c)if(!a.category)l.params[0].push([s,a,c]);else{l.map||(l.map=new Map);let u=l.map.get(a.category);u||(u=[],l.map.set(a.category,u),l.params.push(u)),u.push([s,a,c])}}function r(s,a){let l=s[0],c=a[0];return!l||!l[1].category?-1:!c||!c[1].category?1:l[1].category<c[1].category?-1:1}let n=Object.keys(e),o={params:[[]],map:void 0},i={params:[[]],map:void 0};for(let s of n){let a=e[s];a.isHidden||(a.isEssential?t(s,a,o):t(s,a,i))}return o.params.sort(r),i.params.sort(r),{essentials:o.params,advanced:i.params}}function a_(e){switch(e.type){case"value":return;case"boolean":return i_;case"number":return typeof e.min<"u"&&typeof e.max<"u"?aH:sH;case"converted":return CH;case"conditioned":return xH;case"multi-select":return yH;case"color":return BS;case"color-list":return e.offsets?dH:uH;case"vec3":return mH;case"mat4":return pH;case"url":return fH;case"file":return hH;case"file-list":return gH;case"select":return LS;case"value-ref":return iR;case"data-ref":return;case"text":return oR;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?cH:lH;case"group":return sR;case"mapped":return vH;case"line-graph":return iH;case"script":return SH;case"object-list":return s_;default:let t=e;return}}var o_=class extends Ti.PureComponent{render(){let{legend:t,description:r}=this.props,n=t&&Fge(t);return(0,dt.jsx)("div",{className:"msp-help-text",children:(0,dt.jsxs)("div",{children:[(0,dt.jsxs)("div",{className:"msp-help-description",children:[(0,dt.jsx)(an,{svg:Nc,inline:!0}),r]}),n&&(0,dt.jsx)("div",{className:"msp-help-legend",children:(0,dt.jsx)(n,{legend:t})})]})})}};function b1(e){let{props:t,state:r,control:n,toggleHelp:o,addOn:i}=e,s=[];t.param.shortLabel&&s.push("msp-control-label-short"),t.param.twoColumns&&s.push("msp-control-col-2"),t.param.multiline&&s.push("msp-control-twoline");let a=s.join(" "),l=t.param.label||Pa(t.name),c=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},u=c.description||c.legend,d=l+(u?". Click for help.":"");return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)($s,{className:a,title:d,label:(0,dt.jsxs)(dt.Fragment,{children:[l,u&&(0,dt.jsx)(IH,{show:r.showHelp,toggle:o,title:d})]}),control:n}),u&&r.showHelp&&(0,dt.jsx)("div",{className:"msp-control-offset",children:(0,dt.jsx)(o_,{legend:c.legend,description:c.description})}),i]})}function IH({show:e,toggle:t,title:r}){return(0,dt.jsx)("button",{className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:t,title:r||`${e?"Hide":"Show"} help`,style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,dt.jsx)(an,{svg:Nc})})}var v1=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}renderAddOn(){return null}render(){return b1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}},i_=class extends v1{constructor(){super(...arguments),this.onClick=t=>{this.update(!this.props.value),t.currentTarget.blur()}}renderControl(){return(0,dt.jsxs)("button",{onClick:this.onClick,disabled:this.props.isDisabled,children:[(0,dt.jsx)(an,{svg:this.props.value?Fd:Uz}),this.props.value?"On":"Off"]})}},iH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1,isOverPoint:!1,message:`${this.props.param.defaultValue.length} points`},this.onHover=t=>{this.setState({isOverPoint:!this.state.isOverPoint}),t?this.setState({message:this.pointToLabel(t)}):this.setState({message:`${this.props.value.length} points`})},this.onDrag=t=>{this.setState({message:this.pointToLabel(t)})},this.onChange=t=>{this.props.onChange({name:this.props.name,param:this.props.param,value:t})},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}pointToLabel(t){var r,n;if(!t)return"";let o=(n=(r=this.props.param).getVolume)===null||n===void 0?void 0:n.call(r);if(o){let{min:i,max:s,mean:a,sigma:l}=o.grid.stats,c=i+(s-i)*t[0],u=(c-a)/l;return`(${c.toFixed(2)} | ${u.toFixed(2)}\u03C3, ${t[1].toFixed(2)})`}else return`(${t[0].toFixed(2)}, ${t[1].toFixed(2)})`}render(){var t,r;let n=this.props.param.label||Pa(this.props.name);return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)($s,{label:n,control:(0,dt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${this.state.message}`})}),(0,dt.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none",marginTop:1},children:(0,dt.jsx)(JM,{data:this.props.value,volume:(r=(t=this.props.param).getVolume)===null||r===void 0?void 0:r.call(t),onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag})})]})}},sH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={value:"0"},this.update=t=>{let r=OA(this.props.param.step||.01);t=parseFloat(t.toFixed(r)),this.props.onChange({param:this.props.param,name:this.props.name,value:t})}}render(){let t=this.props.param.label||Pa(this.props.name),r=this.props.param.label||Pa(this.props.name),n=OA(this.props.param.step||.01);return(0,dt.jsx)($s,{title:this.props.param.description,label:r,control:(0,dt.jsx)(mc,{numeric:!0,value:parseFloat(this.props.value.toFixed(n)),onEnter:this.props.onEnter,placeholder:t,isDisabled:this.props.isDisabled,onChange:this.update})})}},aH=class extends v1{constructor(){super(...arguments),this.onChange=t=>{this.update(t)}}renderControl(){let t=typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value;return(0,dt.jsx)(ch,{value:t,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}},oR=class extends v1{constructor(){super(...arguments),this.updateValue=t=>{t!==this.props.value&&this.update(t)}}renderControl(){let t=this.props.param.placeholder||this.props.param.label||Pa(this.props.name);return(0,dt.jsx)(qqe,{props:this.props,placeholder:t,update:this.updateValue})}};function qqe({props:e,placeholder:t,update:r}){let[n,o]=Ti.useState(e.value);return Ti.useEffect(()=>o(e.value),[e.value]),e.param.multiline?(0,dt.jsx)("div",{className:"msp-control-text-area-wrapper",children:(0,dt.jsx)("textarea",{value:e.param.disableInteractiveUpdates?n||"":e.value,placeholder:t,onChange:i=>{e.param.disableInteractiveUpdates?o(i.target.value):r(i.target.value)},onBlur:i=>{e.param.disableInteractiveUpdates&&r(i.target.value)},onKeyDown:i=>{i.key==="Enter"&&(i.shiftKey||i.ctrlKey||i.metaKey)&&i.currentTarget.blur()},disabled:e.isDisabled})}):(0,dt.jsx)("input",{type:"text",value:e.param.disableInteractiveUpdates?n||"":e.value,placeholder:t,onChange:i=>{e.param.disableInteractiveUpdates?o(i.target.value):r(i.target.value)},onBlur:i=>{e.param.disableInteractiveUpdates&&r(i.target.value)},disabled:e.isDisabled,onKeyDown:i=>{i.key==="Enter"&&(e.onEnter?(i.stopPropagation(),e.onEnter()):i.key==="Enter"&&(i.shiftKey||i.ctrlKey||i.metaKey)?i.currentTarget.blur():e.param.disableInteractiveUpdates&&r(n))}})}var uh=class extends Ti.PureComponent{constructor(){super(...arguments),this.onChange=t=>{typeof this.props.param.defaultValue=="number"?this.update(parseInt(t.target.value,10)):this.update(t.target.value)}}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}render(){let t=this.props.value!==void 0&&!this.props.param.options.some(r=>r[0]===this.props.value);return(0,dt.jsxs)("select",{className:"msp-form-control",title:this.props.title,value:this.props.value!==void 0?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled,children:[t&&(0,dt.jsx)("option",{value:this.props.value,children:`[Invalid] ${this.props.value}`},this.props.value),this.props.param.options.map(([r,n])=>(0,dt.jsx)("option",{value:r,children:n},r))]})}},LS=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=t=>{!t||t.value===this.props.value?this.setState({showOptions:!1}):this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:t.value})})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.cycle=()=>{let{options:t}=this.props.param,r=t.findIndex(o=>o[0]===this.props.value),n=r===t.length-1?0:r+1;this.props.onChange({param:this.props.param,name:this.props.name,value:t[n][0]})},this.items=nu(t=>hr.createItemsFromSelectOptions(t.options)),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}renderControl(){var t;let r=this.items(this.props.param),n=this.props.value!==void 0?hr.findItem(r,this.props.value):void 0,o=n?n.label:typeof this.props.value>"u"?`${((t=hr.getFirstItem(r))===null||t===void 0?void 0:t.label)||""} [Default]`:`[Invalid] ${this.props.value}`,i=this.props.param.cycle?this.cycle:this.toggle,s=this.props.param.cycle?"center":"left",a=this.props.param.cycle?this.props.value==="on"?Fd:this.props.value==="off"?Uz:void 0:void 0;return(0,dt.jsx)(gi,{disabled:this.props.isDisabled,style:{textAlign:s,overflow:"hidden",textOverflow:"ellipsis"},label:o,title:o,icon:a,toggle:i,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;let t=this.items(this.props.param),r=hr.findItem(t,this.props.value);return(0,dt.jsx)(hr,{items:t,current:r,onSelect:this.onSelect})}render(){return b1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}},iR=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=t=>{!t||t.value===this.props.value?this.setState({showOptions:!1}):this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:{ref:t.value}})})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}get items(){return hr.createItemsFromSelectOptions(this.props.param.getOptions(this.context))}renderControl(){var t;let r=this.items,n=this.props.value.ref?hr.findItem(r,this.props.value.ref):void 0,o=n?n.label:`[Ref] ${(t=this.props.value.ref)!==null&&t!==void 0?t:""}`;return(0,dt.jsx)(gi,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:o,title:o,toggle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;let t=this.items,r=hr.findItem(t,this.props.value.ref);return(0,dt.jsx)(hr,{items:t,current:r,onSelect:this.onSelect})}render(){return b1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}};iR.contextType=rd;var lH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:M.Numeric(0,{step:this.props.param.step},{label:"Min"}),1:M.Numeric(0,{step:this.props.param.step},{label:"Max"})},this.componentChange=({name:t,value:r})=>{let n=[...this.props.value];n[+t]=r,this.change(n)},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}render(){let t=this.props.value,r=this.props.param.label||Pa(this.props.name),n=OA(this.props.param.step||.01),o=`[${t[0].toFixed(n)}, ${t[1].toFixed(n)}]`;return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)($s,{label:r,control:(0,dt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:o})}),this.state.isExpanded&&(0,dt.jsx)("div",{className:"msp-control-offset",children:(0,dt.jsx)(An,{params:this.components,values:t,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}},cH=class extends v1{constructor(){super(...arguments),this.onChange=t=>{this.update(t)}}renderControl(){return(0,dt.jsx)(tR,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}};function n_(e,t=!1){return Array.isArray(e)?t?`${ze.toStyle(e[0])} ${(100*e[1]).toFixed(2)}%`:ze.toStyle(e[0]):ze.toStyle(e)}var Zqe=gg(e=>`linear-gradient(to right, ${e.map(r=>n_(r,!0)).join(", ")})`),Kqe=gg(e=>{let t=e.length,r=[`${n_(e[0])} ${100*(1/t)}%`];for(let n=1,o=t-1;n<o;++n)r.push(`${n_(e[n])} ${100*(n/t)}%`,`${n_(e[n])} ${100*((n+1)/t)}%`);return r.push(`${n_(e[t-1])} ${100*((t-1)/t)}%`),`linear-gradient(to right, ${r.join(", ")})`});function AH(e,t="0"){return{background:Xqe(e.colors,e.kind==="set"),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function Xqe(e,t){return t?Kqe(e):Zqe(e)}function Yqe(){let e=t=>{let r=fa(t[0]);return(0,dt.jsx)("div",{style:AH({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})})};return{ColorPresets:{all:hr.createItemsFromSelectOptions(cP,{addOn:e}),scale:hr.createItemsFromSelectOptions(TK,{addOn:e}),set:hr.createItemsFromSelectOptions(EK,{addOn:e})},ColorsParam:M.ObjectList({color:M.Color(0)},({color:t})=>ze.toHexString(t).toUpperCase()),OffsetColorsParam:M.ObjectList({color:M.Color(0),offset:M.Numeric(0,{min:0,max:1,step:.01})},({color:t,offset:r})=>`${ze.toHexString(t).toUpperCase()} [${r.toFixed(2)}]`),IsInterpolatedParam:M.Boolean(!1,{label:"Interpolated"})}}var rR;function jge(){return rR||(rR=Yqe(),rR)}var uH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:this.state.show==="edit"?void 0:"edit"}),this.togglePresets=()=>this.setState({show:this.state.show==="presets"?void 0:"presets"}),this.selectPreset=t=>{if(!t)return;this.setState({show:void 0});let r=fa(t.value);this.update({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},this.colorsChanged=({value:t})=>{this.update({kind:this.props.value.kind,colors:t.map(r=>r.color)})},this.isInterpolatedChanged=({value:t})=>{this.update({kind:t?"interpolate":"set",colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}renderControl(){let{value:t}=this.props;return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[t.colors.length===1?"1 color":`${t.colors.length} colors`,(0,dt.jsx)("div",{style:AH(t,"33px")})]}),(0,dt.jsx)(Jt,{svg:Ug,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;let{ColorPresets:t,ColorsParam:r,IsInterpolatedParam:n}=jge(),o=t[this.props.param.presetKind];if(this.state.show==="presets")return(0,dt.jsx)(hr,{items:o,onSelect:this.selectPreset});let i=this.props.value.colors.map(s=>({color:s}));return(0,dt.jsxs)("div",{className:"msp-control-offset",children:[(0,dt.jsx)(s_,{name:"colors",param:r,value:i,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,dt.jsx)(i_,{name:"isInterpolated",param:n,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return b1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}},dH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:this.state.show==="edit"?void 0:"edit"}),this.togglePresets=()=>this.setState({show:this.state.show==="presets"?void 0:"presets"}),this.selectPreset=t=>{if(!t)return;this.setState({show:void 0});let r=fa(t.value);this.update({kind:r.type!=="qualitative"?"interpolate":"set",colors:r.list})},this.colorsChanged=({value:t})=>{let r=t.map(n=>[n.color,n.offset]);r.sort((n,o)=>n[1]-o[1]),this.update({kind:this.props.value.kind,colors:r})},this.isInterpolatedChanged=({value:t})=>{this.update({kind:t?"interpolate":"set",colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}renderControl(){let{value:t}=this.props;return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[t.colors.length===1?"1 color":`${t.colors.length} colors`,(0,dt.jsx)("div",{style:AH(t,"33px")})]}),(0,dt.jsx)(Jt,{svg:Ug,onClick:this.togglePresets,toggleState:this.state.show==="presets",title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;let{ColorPresets:t,OffsetColorsParam:r,IsInterpolatedParam:n}=jge(),o=t[this.props.param.presetKind];if(this.state.show==="presets")return(0,dt.jsx)(hr,{items:o,onSelect:this.selectPreset});let i=this.props.value.colors,s=i.map((a,l)=>Array.isArray(a)?{color:a[0],offset:a[1]}:{color:a,offset:l/i.length});return s.sort((a,l)=>a.offset-l.offset),(0,dt.jsxs)("div",{className:"msp-control-offset",children:[(0,dt.jsx)(s_,{name:"colors",param:r,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,dt.jsx)(i_,{name:"isInterpolated",param:n,value:this.props.value.kind==="interpolate",onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return b1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}},mH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:M.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.x||"X"}),1:M.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.y||"Y"}),2:M.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.z||"Z"})},this.componentChange=({name:t,value:r})=>{let n=D.copy(D.zero(),this.props.value);n[+t]=r,this.change(n)},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}render(){let t=this.props.value,r=this.props.param.label||Pa(this.props.name),n=OA(this.props.param.step||.01),o=`[${t[0].toFixed(n)}, ${t[1].toFixed(n)}, ${t[2].toFixed(n)}]`;return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)($s,{label:r,control:(0,dt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:o})}),this.state.isExpanded&&(0,dt.jsx)("div",{className:"msp-control-offset",children:(0,dt.jsx)(An,{params:this.components,values:t,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}},pH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={json:M.Text(JSON.stringify(de()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},this.componentChange=({name:t,value:r})=>{let n=de.copy(de(),this.props.value);t==="json"?de.copy(n,JSON.parse(r)):n[+t]=r,this.change(n)},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}changeValue(t){return r=>{let n=de.copy(de(),this.props.value);n[t]=r,this.change(n)}}get grid(){let t=this.props.value,r=[];for(let n=0;n<4;n++){let o=[];for(let i=0;i<4;i++)o.push((0,dt.jsx)(mc,{numeric:!0,delayMs:50,value:de.getValue(t,n,i),onChange:this.changeValue(4*i+n),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},i));r.push((0,dt.jsx)("div",{className:"msp-flex-row",children:o},n))}return(0,dt.jsx)("div",{className:"msp-parameter-matrix",children:r})}render(){let t={json:JSON.stringify(this.props.value)},r=this.props.param.label||Pa(this.props.name);return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)($s,{label:r,control:(0,dt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:"4\xD74 Matrix"})}),this.state.isExpanded&&(0,dt.jsxs)("div",{className:"msp-control-offset",children:[this.grid,(0,dt.jsx)(An,{params:this.components,values:t,onChange:this.componentChange,onEnter:this.props.onEnter})]})]})}},fH=class extends v1{constructor(){super(...arguments),this.onChange=t=>{let r=t.target.value;r!==Nr.getUrl(this.props.value||"")&&this.update(Nr.Url(r))},this.onKeyPress=t=>{(t.keyCode===13||t.charCode===13||t.key==="Enter")&&this.props.onEnter&&this.props.onEnter(),t.stopPropagation()}}renderControl(){let t=this.props.param.label||Pa(this.props.name);return(0,dt.jsx)("input",{type:"text",value:Nr.getUrl(this.props.value||""),placeholder:t,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled})}},hH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFile=t=>{this.change(t.target.files[0])},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:Nr.File(t)})}renderControl(){let t=this.props.value;return(0,dt.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[t?t.name:"Select a file..."," ",(0,dt.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept})]})}render(){return this.props.param.label?b1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}},gH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFileList=t=>{this.change(t.target.files)},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(t){let r=[];if(t)for(let n=0,o=t.length;n<o;++n)r.push(Nr.File(t[n]));this.props.onChange({name:this.props.name,param:this.props.param,value:r})}renderControl(){let t=this.props.value,r=[];if(t)for(let o of t)r.push(o.name);let n=r.length===0?"Select files...":r.length===1?r[0]:`${r.length} files selected`;return(0,dt.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[n," ",(0,dt.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept})]})}render(){return this.props.param.label?b1({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}},yH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}toggle(t){return r=>{this.props.value.indexOf(t)<0?this.change(this.props.value.concat(t)):this.change(this.props.value.filter(n=>n!==t)),r.currentTarget.blur()}}render(){let t=this.props.value,r=this.props.param.emptyValue,n=this.props.param.label||Pa(this.props.name);return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)($s,{label:n,control:(0,dt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:t.length===0&&r?r:`${t.length} of ${this.props.param.options.length}`})}),this.state.isExpanded&&(0,dt.jsx)("div",{className:"msp-control-offset",children:this.props.param.options.map(([o,i])=>{let s=t.indexOf(o)>=0;return(0,dt.jsx)(or,{onClick:this.toggle(o),disabled:this.props.isDisabled,style:{marginTop:"1px"},children:(0,dt.jsx)("span",{style:{float:s?"left":"right"},children:s?`\u2713 ${i}`:`${i} \u2717`})},o)})})]})}},sR=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded,showPresets:!1,showHelp:!1},this.onChangeParam=t=>{this.change({...this.props.value,[t.name]:t.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.toggleShowPresets=()=>this.setState({showPresets:!this.state.showPresets}),this.presetItems=nu(t=>{var r;return hr.createItemsFromSelectOptions((r=t.presets)!==null&&r!==void 0?r:[])}),this.onSelectPreset=t=>{this.setState({showPresets:!1}),this.change(t?.value)}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}pivotedPresets(){if(!this.props.param.presets)return null;let t=this.props.param.label||Pa(this.props.name);return(0,dt.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,dt.jsx)("div",{className:"msp-control-group-header",children:(0,dt.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,dt.jsx)(an,{svg:Ug}),t," Presets"]})}),this.state.showPresets&&(0,dt.jsx)(hr,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]})}presets(){return this.props.param.presets?(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)("div",{className:"msp-control-group-presets-wrapper",children:(0,dt.jsx)("div",{className:"msp-control-group-header",children:(0,dt.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,dt.jsx)(an,{svg:Ug}),"Presets"]})})}),this.state.showPresets&&(0,dt.jsx)(hr,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]}):null}pivoted(){let t=this.props.param.pivot,r=this.props.param.params,n=r[t],o=a_(n),i=(0,dt.jsx)(o,{name:t,param:n,value:this.props.value[t],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});if(!this.state.isExpanded)return(0,dt.jsxs)("div",{className:"msp-mapped-parameter-group",children:[i,(0,dt.jsx)(Jt,{svg:Um,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"})]});let s=Object.create(null);for(let a of Object.keys(r))a!==t&&(s[a]=r[a]);return(0,dt.jsxs)("div",{className:"msp-mapped-parameter-group",children:[i,(0,dt.jsx)(Jt,{svg:Um,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"}),(0,dt.jsxs)("div",{className:"msp-control-offset",children:[this.pivotedPresets(),(0,dt.jsx)(An,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled})]})]})}render(){let t=this.props.param.params;if(Object.keys(t).length===0)return null;if(this.props.param.pivot)return this.pivoted();let r=this.props.param.label||Pa(this.props.name),n=(0,dt.jsx)(An,{params:t,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});return this.props.inMapped?(0,dt.jsx)("div",{className:"msp-control-offset",children:n}):this.props.param.isFlat?n:(0,dt.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative"},children:[(0,dt.jsx)("div",{className:"msp-control-group-header",children:(0,dt.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,children:[(0,dt.jsx)(an,{svg:this.state.isExpanded?Bc:Lc}),r]})}),this.presets(),this.state.isExpanded&&(0,dt.jsx)("div",{className:"msp-control-offset",children:n})]})}},vH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.valuesCache={},this.onChangeName=t=>{this.change({name:t.value,params:this.getValues(t.value)})},this.onChangeParam=t=>{this.setValues(this.props.value.name,t.value),this.change({name:this.props.value.name,params:t.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}setValues(t,r){this.valuesCache[t]=r}getValues(t){return t in this.valuesCache?this.valuesCache[t]:this.props.param.map(t).defaultValue}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}areParamsEmpty(t){for(let r of Object.keys(t))if(!t[r].isHidden)return!1;return!0}render(){let t=this.props.value||this.props.param.defaultValue,r=this.props.param.map(t.name),n=this.props.param.label||Pa(this.props.name),o=a_(r),i=this.props.param.help,s=i?{...this.props.param.select,help:l=>i({name:l,params:this.getValues(l)})}:this.props.param.select,a=(0,dt.jsx)(LS,{param:s,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:n,value:t.name});return o?r.type==="group"&&!r.isFlat?this.areParamsEmpty(r.params)?a:(0,dt.jsxs)("div",{className:"msp-mapped-parameter-group",children:[a,(0,dt.jsx)(Jt,{svg:Um,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`${n} Properties`}),this.state.isExpanded&&(0,dt.jsx)(sR,{inMapped:!0,param:r,value:t.params,name:t.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):(0,dt.jsxs)(dt.Fragment,{children:[a,(0,dt.jsx)(o,{param:r,value:t.params,name:t.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):a}},aR=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={current:this.props.value},this.onChangeParam=t=>{this.setState({current:{...this.state.current,[t.name]:t.value}})},this.apply=()=>{this.props.apply(this.state.current)}}componentDidUpdate(t){(this.props.params!==t.params||this.props.value!==t.value)&&this.setState({current:this.props.value})}render(){return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)(An,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled}),(0,dt.jsx)("button",{className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled,children:this.props.isUpdate?"Update":"Add"})]})}},bH=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.update=t=>{this.props.actions.update(t,this.props.index)},this.moveUp=()=>{this.props.actions.move(this.props.index,-1)},this.moveDown=()=>{this.props.actions.move(this.props.index,1)},this.remove=()=>{this.setState({isExpanded:!1}),this.props.actions.remove(this.props.index)},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}render(){return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsxs)("div",{className:"msp-param-object-list-item",children:[(0,dt.jsxs)("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded,children:[(0,dt.jsx)("span",{children:`${this.props.index+1}: `}),this.props.param.getLabel(this.props.value)]}),(0,dt.jsxs)("div",{children:[(0,dt.jsx)(Jt,{svg:Jy,title:"Move Up",onClick:this.moveUp,small:!0}),(0,dt.jsx)(Jt,{svg:ev,title:"Move Down",onClick:this.moveDown,small:!0}),(0,dt.jsx)(Jt,{svg:Fa,title:"Remove",onClick:this.remove,small:!0})]})]}),this.state.isExpanded&&(0,dt.jsx)("div",{className:"msp-control-offset",children:(0,dt.jsx)(aR,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled})})]})}},s_=class extends Ti.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.add=t=>{this.change([...this.props.value,t])},this.actions={update:(t,r)=>{let n=this.props.value.slice(0);n[r]=t,this.change(n)},move:(t,r)=>{let n=this.props.value;if(n.length===1)return;let o=(t+r)%n.length;o<0&&(o+=n.length),n=n.slice(0);let i=n[t];n[t]=n[o],n[o]=i,this.change(n)},remove:t=>{let r=this.props.value,n=[];for(let o=0;o<r.length;o++)t!==o&&n.push(r[o]);this.change(n)}},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}render(){let t=this.props.value,r=this.props.param.label||Pa(this.props.name),n=`${t.length} item${t.length!==1?"s":""}`;return(0,dt.jsxs)(dt.Fragment,{children:[(0,dt.jsx)($s,{label:r,control:(0,dt.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:n})}),this.state.isExpanded&&(0,dt.jsxs)("div",{className:"msp-control-offset",children:[this.props.value.map((o,i)=>(0,dt.jsx)(bH,{param:this.props.param,value:o,index:i,actions:this.actions,isDisabled:this.props.isDisabled},i)),(0,dt.jsx)(zl,{header:"New Item",children:(0,dt.jsx)(aR,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled})})]})]})}},xH=class extends Ti.PureComponent{constructor(){super(...arguments),this.onChangeCondition=t=>{this.change(this.props.param.conditionedValue(this.props.value,t.value))},this.onChangeParam=t=>{this.change(t.value)}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}render(){let t=this.props.value,r=this.props.param.conditionForValue(t),n=this.props.param.conditionParams[r],o=this.props.param.label||Pa(this.props.name),i=a_(n),s=(0,dt.jsx)(LS,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:`${o} Kind`,value:r});return i?(0,dt.jsxs)(dt.Fragment,{children:[s,(0,dt.jsx)(i,{param:n,value:t,name:o,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):s}},CH=class extends Ti.PureComponent{constructor(){super(...arguments),this.onChange=t=>{this.props.onChange({name:this.props.name,param:this.props.param,value:this.props.param.toValue(t.value)})}}render(){let t=this.props.param.fromValue(this.props.value),r=a_(this.props.param.converted);return r?(0,dt.jsx)(r,{param:this.props.param.converted,value:t,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled}):null}},SH=class extends Ti.PureComponent{constructor(){super(...arguments),this.onChange=({name:t,value:r})=>{let n=t;r!==this.props.value[n]&&this.props.onChange({param:this.props.param,name:this.props.name,value:{...this.props.value,[n]:r}})}}render(){let t={defaultValue:this.props.value.language,options:M.objectToOptions(To.Info),type:"select"},r=(0,dt.jsx)(LS,{param:t,isDisabled:this.props.isDisabled,onChange:this.onChange,onEnter:this.props.onEnter,name:"language",value:this.props.value.language}),n={defaultValue:this.props.value.language,type:"text"},o=(0,dt.jsx)(oR,{param:n,isDisabled:this.props.isDisabled,onChange:this.onChange,name:"expression",value:this.props.value.expression});return(0,dt.jsxs)(dt.Fragment,{children:[r,this.props.value.language!=="mol-script"&&(0,dt.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,dt.jsx)(an,{svg:XM})," Support for PyMOL, VMD, and Jmol selections is an experimental feature and may not always work as intended."]}),o]})}};var tv=ar(hi());function Qqe(e){let[,t]=tv.default.useState({}),r=tv.default.useRef();return r.current=e?.value,tv.default.useEffect(()=>{if(!e)return;let n=e.subscribe(o=>{r.current!==o&&t({})});return()=>n.unsubscribe()},[e]),e?.value}function Jqe(e){return tv.default.useSyncExternalStore(tv.default.useCallback(t=>{let r=e?.pipe(b2(1)).subscribe(t);return()=>r?.unsubscribe()},[e]),tv.default.useCallback(()=>e?.value,[e]))}var eZe=tv.default.useSyncExternalStore?Jqe:Qqe;function Po(e){return eZe(e)}var tZe=ar(un());var oa=ar(un());var sf=class extends Xo{constructor(){super(...arguments),this.onChange=({name:t,value:r})=>{let n={...this.props.params,[t]:r};this.props.events.onChange(n,this.areInitial(n),this.validate(n))}}validate(t){}areInitial(t){return M.areEqual(this.props.info.params,t,this.props.info.initialValues)}render(){return(0,oa.jsx)(An,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})}};(function(e){function t(o){let i=Object.keys(o);for(let s of i)if(!o[s].isHidden)return!1;return!0}function r(o,i,s,a){let l=i.cells.get(a).obj,c=s.definition.params?s.definition.params(l,o):{};return{initialValues:M.getDefaultValues(c),params:c,isEmpty:t(c)}}e.infoFromAction=r;function n(o,i,s){let a=i.cells.get(s.ref),l=a.params&&a.params.definition||{};return{initialValues:a.params&&a.params.values||{},params:l,isEmpty:t(l)}}e.infoFromTransform=n})(sf||(sf={}));var NS=class extends Xo{constructor(){super(...arguments),this.busy=new jo(!1),this.onEnter=()=>{this.state.error||this.apply()},this.autoApplyHandle=void 0,this.events={onEnter:this.onEnter,onChange:(t,r,n)=>{this.clearAutoApply(),this.setState({params:t,isInitial:r,error:n&&n[0]},()=>{!r&&!this.state.error&&this.canAutoApply(t)&&(this.clearAutoApply(),this.autoApplyHandle=setTimeout(this.apply,50))})}},this.apply=async()=>{var t,r;this.clearAutoApply(),this.setState({busy:!0});try{await this.applyAction()}catch{}finally{(r=(t=this.props).onApply)===null||r===void 0||r.call(t),this.busy.next(!1)}},this.refresh=()=>{this.setState({params:this.getInfo().initialValues,isInitial:!0,error:void 0})},this.setDefault=()=>{let t=this.getInfo(),r=M.getDefaultValues(t.params);this.setState({params:r,isInitial:M.areEqual(t.params,r,t.initialValues),error:void 0})},this.toggleExpanded=()=>{this.setState({isCollapsed:!this.state.isCollapsed})}}clearAutoApply(){this.autoApplyHandle!==void 0&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)}componentDidMount(){this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.busy.value!==t&&this.busy.next(t)}),this.subscribe(this.busy.pipe(b2(1)),t=>{this.setState({busy:t})})}renderApply(){let t=this.canApply();return this.props.autoHideApply&&(!t||this.canAutoApply(this.state.params))?null:(0,oa.jsxs)("div",{className:"msp-transform-apply-wrap",children:[(0,oa.jsx)(Jt,{svg:Jw,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"}),(0,oa.jsx)("div",{className:"msp-transform-apply-wider",children:(0,oa.jsx)(or,{icon:t?Fd:void 0,className:`msp-btn-commit msp-btn-commit-${t?"on":"off"}`,onClick:this.apply,disabled:!t,children:this.props.applyLabel||this.applyText()})})]})}renderDefault(){let t=this.getInfo(),r=t.isEmpty&&this.isUpdate(),n=this.getHeader(),o=this.getTransformerId(),i=this.plugin.customParamEditors.has(o)?this.plugin.customParamEditors.get(o):sf,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",a=null;if(!r&&!this.state.isCollapsed){let{a:c,b:u,bCell:d}=this.getSourceAndTarget(),m=this.renderApply();a=(0,oa.jsxs)(oa.Fragment,{children:[(0,oa.jsx)(i,{info:t,a:c,b:u,bCell:d,events:this.events,params:this.state.params,isDisabled:this.state.busy}),m]})}let l=(0,oa.jsxs)("div",{className:s,style:{marginBottom:this.props.noMargin?0:void 0},children:[n!=="none"&&!this.props.wrapInExpander&&(0,oa.jsx)("div",{className:"msp-transform-header",children:(0,oa.jsxs)(or,{onClick:this.toggleExpanded,title:n.description,children:[!r&&(0,oa.jsx)(an,{svg:this.state.isCollapsed?Lc:Bc}),n.name]})}),a]});return r||!this.props.wrapInExpander?l:(0,oa.jsx)(lo,{header:this.isUpdate()?`Update ${n==="none"?"":n.name}`:`Apply ${n==="none"?"":n.name}`,headerLeftMargin:this.props.expanderHeaderLeftMargin,children:l})}renderSimple(){var t,r,n;let o=this.getInfo(),i=this.canApply(),s=(0,oa.jsxs)("div",{className:"msp-flex-row",children:[(0,oa.jsx)(or,{icon:(t=this.props.simpleApply)===null||t===void 0?void 0:t.icon,title:(r=this.props.simpleApply)===null||r===void 0?void 0:r.title,disabled:this.state.busy||!i,onClick:this.apply,className:"msp-btn-apply-simple",children:(n=this.props.simpleApply)===null||n===void 0?void 0:n.header}),!o.isEmpty&&(0,oa.jsx)(gi,{icon:gu,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}})]});if(this.state.isCollapsed)return s;let a=this.getTransformerId(),l=this.plugin.customParamEditors.has(a)?this.plugin.customParamEditors.get(a):sf,{a:c,b:u,bCell:d}=this.getSourceAndTarget();return(0,oa.jsxs)(oa.Fragment,{children:[s,(0,oa.jsx)(l,{info:o,a:c,b:u,bCell:d,events:this.events,params:this.state.params,isDisabled:this.state.busy})]})}render(){return this.props.simpleApply?this.renderSimple():this.renderDefault()}};var Oa=class extends NS{constructor(){super(...arguments),this._getInfo=nu(t=>sf.infoFromTransform(this.plugin,this.props.state,t)),this.state={error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)}getInfo(){return this._getInfo(this.props.transform)}getTransformerId(){return this.props.transform.transformer.id}getHeader(){return this.props.customHeader||this.props.transform.transformer.definition.display}canApply(){let{state:t}=this.props,r=t.cells.get(this.props.transform.ref);if(!r)return!1;if(r.status==="error"){let n=t.cells.get(this.props.transform.parent);return n?n.status==="ok":!1}return!this.state.error&&!this.state.busy&&!this.state.isInitial}applyText(){return this.canApply()?"Update":"Nothing to Update"}isUpdate(){return!0}getSourceAndTarget(){let t=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:t?.obj,bCell:t}}canAutoApply(t){let r=this.props.transform.transformer.definition.canAutoUpdate;if(!r)return!1;let{state:n}=this.props,o=n.cells.get(this.props.transform.ref);if(!o||!o.sourceRef||o.status!=="ok")return!1;let i=n.cells.get(o.sourceRef);return r({a:i.obj,b:o.obj,oldParams:this.getInfo().initialValues,newParams:t},this.plugin)}componentDidMount(){super.componentDidMount(),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,()=>this.setState({isCollapsed:!this.state.isCollapsed})),this.subscribe(this.plugin.state.events.object.updated,({ref:t,state:r})=>{this.props.transform.ref!==t||this.props.state!==r||this.state.params!==this.props.transform.params&&(this._getInfo=nu(n=>sf.infoFromTransform(this.plugin,this.props.state,n)),this.setState({params:this.props.transform.params,isInitial:!0}))})}componentDidUpdate(t){var r;if(this.props.transform!==t.transform){let n=this.props.state.cells.get(this.props.transform.ref);this.setState({params:((r=n.params)===null||r===void 0?void 0:r.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}}};function x1(e){return new Promise(t=>setTimeout(t,e))}var l_;(function(e){function t(o,i){var s;let a=i.length>o.availableNodes.length?i[i.length-1]:(s=i.find(l=>{var c;return l.data.ref===((c=o.activeNode)===null||c===void 0?void 0:c.data.ref)}))!==null&&s!==void 0?s:i[0];return{...o,availableNodes:i,activeNode:a}}e.changeAvailableNodes=t;function r(o,i){var s;let a=(s=o.availableNodes.find(l=>l.data.ref===i))!==null&&s!==void 0?s:o.availableNodes[0];return{...o,availableNodes:o.availableNodes,activeNode:a}}e.changeActiveNode=r;function n(o,i){return RA(o.availableNodes,i.availableNodes)&&o.activeNode===i.activeNode&&o.globalState===i.globalState}e.equals=n})(l_||(l_={}));var lR=class extends il{defaultState(){return{header:"Volume & Segmentation",isCollapsed:!0,brand:{accent:"orange",svg:qM},data:{globalState:void 0,availableNodes:[],activeNode:void 0}}}renderControls(){return(0,wn.jsx)(rZe,{plugin:this.plugin,data:this.state.data,setData:t=>this.setState({data:t})})}componentDidMount(){this.setState({isHidden:!0,isCollapsed:!1}),this.subscribe(this.plugin.state.data.events.changed,t=>{var r,n,o;let i=t.state.selectQ(l=>l.ofType(ih)).map(l=>l?.obj).filter(ES),s=i.length===0,a=l_.changeAvailableNodes(this.state.data,i);if(!(!((r=this.state.data.globalState)===null||r===void 0)&&r.isRegistered())){let l=(o=(n=t.state.selectQ(c=>c.ofType(oh))[0])===null||n===void 0?void 0:n.obj)===null||o===void 0?void 0:o.data;l&&(a.globalState=l)}(!l_.equals(this.state.data,a)||this.state.isHidden!==s)&&this.setState({data:a,isHidden:s})})}};function rZe({plugin:e,data:t,setData:r}){var n;let o=(n=t.activeNode)===null||n===void 0?void 0:n.data;if(!o)return(0,wn.jsx)("p",{children:"No data!"});if(!t.globalState)return(0,wn.jsx)("p",{children:"No global state!"});let i={entry:M.Select(t.activeNode.data.ref,t.availableNodes.map(l=>[l.data.ref,l.data.entryId]))},s={entry:t.activeNode.data.ref},a=Po(t.globalState.currentState);return(0,wn.jsxs)(wn.Fragment,{children:[(0,wn.jsx)(An,{params:i,values:s,onChangeValues:l=>r(l_.changeActiveNode(t,l.entry))}),(0,wn.jsx)(lo,{header:"Global options",children:(0,wn.jsx)(Wge,{params:Hw,values:a,onChangeValues:async l=>{var c;return await((c=t.globalState)===null||c===void 0?void 0:c.updateState(e,l))}})}),(0,wn.jsx)(nZe,{entryData:o},o.ref)]})}function nZe({entryData:e}){var t,r,n;let o=Po(e.currentState),i=e.metadata.allSegments,s=e.metadata.getSegment(o.selectedSegment),a=o.visibleSegments.map(u=>u.segmentId),l=o.visibleModels.map(u=>u.pdbId),c=e.pdbs;return(0,wn.jsxs)(wn.Fragment,{children:[(0,wn.jsx)("div",{style:{fontWeight:"bold",padding:8,paddingTop:6,paddingBottom:4,overflow:"hidden"},children:(r=(t=e.metadata.raw.annotation)===null||t===void 0?void 0:t.name)!==null&&r!==void 0?r:"Unnamed Annotation"}),c.length>0&&(0,wn.jsx)(lo,{header:"Fitted models in PDB",initiallyExpanded:!0,children:c.map(u=>(0,wn.jsx)($ge,{onClick:()=>e.actionShowFittedModel(l.includes(u)?[]:[u]),style:{fontWeight:l.includes(u)?"bold":void 0,textAlign:"left",marginTop:1},children:u},u))}),(0,wn.jsx)(oZe,{entryData:e}),(0,wn.jsxs)(lo,{header:"Segmentation data",initiallyExpanded:!0,children:[(0,wn.jsx)($s,{label:"Opacity",control:(0,wn.jsx)(iZe,{min:0,max:1,value:o.segmentOpacity,step:.05,onChange:async u=>await e.actionSetOpacity(u)})}),i.length>0&&(0,wn.jsxs)(wn.Fragment,{children:[(0,wn.jsx)($ge,{onClick:async()=>{await x1(20),await e.actionToggleAllSegments()},style:{marginTop:1},children:"Toggle All segments"}),(0,wn.jsx)("div",{style:{maxHeight:200,overflow:"hidden",overflowY:"auto",marginBlock:1},children:i.map(u=>{var d,m;return(0,wn.jsxs)("div",{style:{display:"flex",marginBottom:1},onMouseEnter:()=>e.actionHighlightSegment(u),onMouseLeave:()=>e.actionHighlightSegment(),children:[(0,wn.jsx)(or,{onClick:()=>e.actionSelectSegment(u!==s?u.id:void 0),style:{fontWeight:u.id===s?.id?"bold":void 0,marginRight:1,flexGrow:1,textAlign:"left"},children:(0,wn.jsxs)("div",{title:(d=u.biological_annotation.name)!==null&&d!==void 0?d:"Unnamed segment",style:{maxWidth:240,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[(m=u.biological_annotation.name)!==null&&m!==void 0?m:"Unnamed segment"," (",u.id,")"]})}),(0,wn.jsx)(Jt,{svg:a.includes(u.id)?dc:uc,onClick:()=>e.actionToggleSegment(u.id)})]},u.id)})})]})]}),(0,wn.jsx)(lo,{header:"Selected segment annotation",initiallyExpanded:!0,children:(0,wn.jsxs)("div",{style:{paddingTop:4,paddingRight:8,maxHeight:300,overflow:"hidden",overflowY:"auto"},children:[!s&&"No segment selected",s&&(0,wn.jsxs)("b",{children:["Segment ",s.id,":",(0,wn.jsx)("br",{}),(n=s.biological_annotation.name)!==null&&n!==void 0?n:"Unnamed segment"]}),s?.biological_annotation.external_references.map(u=>(0,wn.jsxs)("p",{style:{marginTop:4},children:[(0,wn.jsxs)("small",{children:[u.resource,":",u.accession]}),(0,wn.jsx)("br",{}),(0,wn.jsx)("b",{children:sZe(u.label)}),(0,wn.jsx)("br",{}),u.description]},u.id))]})})]})}function oZe({entryData:e}){var t,r;let n=Po(e.currentVolume);if(!n)return null;let o={volumeType:n.state.isHidden?"off":(t=n.params)===null||t===void 0?void 0:t.type.name,opacity:(r=n.params)===null||r===void 0?void 0:r.type.params.alpha};return(0,wn.jsxs)(lo,{header:"Volume data",initiallyExpanded:!0,children:[(0,wn.jsx)(Wge,{params:Hhe,values:o,onChangeValues:async i=>{await x1(20),await e.actionUpdateVolumeVisual(i)}}),(0,wn.jsx)(lo,{header:"Detailed Volume Params",headerStyle:{marginTop:1},children:(0,wn.jsx)(Oa,{state:e.plugin.state.data,transform:n,customHeader:"none"})})]})}function iZe({value:e,onChange:t,...r}){let[n,o,i]=wH(e);return(0,wn.jsx)(ch,{value:o,disabled:n,onChange:s=>i(t,s),...r})}function $ge({onClick:e,...t}){let[r,n,o]=wH(void 0);return(0,wn.jsx)(or,{disabled:r,onClick:()=>o(e,void 0),...t,children:t.children})}function Wge({values:e,onChangeValues:t,...r}){let[n,o,i]=wH(e);return(0,wn.jsx)(An,{isDisabled:n,values:o,onChangeValues:s=>i(t,s),...r})}function sZe(e){let t=e.charAt(0),r=e.slice(1);return t.toUpperCase()+r}function wH(e){let[t,r]=(0,dh.useState)(!1),[n,o]=(0,dh.useState)(e),i=(0,dh.useRef)(!1);(0,dh.useEffect)(()=>o(e),[e]),(0,dh.useEffect)(()=>(i.current=!0,()=>{i.current=!1}),[]);let s=(0,dh.useCallback)(async(a,l)=>{r(!0),o(l);try{await a(l)}catch(c){throw i.current&&o(e),c}finally{i.current&&r(!1)}},[]);return[t,n,s]}var _H,TH=typeof window<"u"?((_H=window?.location)===null||_H===void 0?void 0:_H.hostname)==="localhost":!1,Qy={DefaultServer:new Yf("volseg-volume-server",TH?"http://localhost:9000/v2":p1)},Qwr=tr.create({name:"volseg",category:"misc",display:{name:"Volseg",description:"Volseg"},ctor:class extends tr.Handler{register(){this.ctx.state.data.actions.add(qge),this.ctx.customStructureControls.set("volseg",lR),this.initializeEntryLists();let e=new Map;this.subscribeObservable(this.ctx.state.data.events.cell.created,t=>{t.cell.obj instanceof DS&&e.set(t.ref,t.cell.obj)}),this.subscribeObservable(this.ctx.state.data.events.cell.removed,t=>{e.has(t.ref)&&(e.get(t.ref).dispose(),e.delete(t.ref))})}unregister(){this.ctx.state.data.actions.remove(qge),this.ctx.customStructureControls.delete("volseg")}async initializeEntryLists(){var e;let t=(e=this.ctx.config.get(Qy.DefaultServer))!==null&&e!==void 0?e:p1,n=await new wS(t).getEntryList(10**6);Object.values(n).forEach(o=>o.sort()),this.ctx.customState.volsegAvailableEntries=n}}}),qge=ki.build({display:{name:"Load Volume & Segmentation"},from:fe.Root,params:(e,t)=>jhe(t,t.customState.volsegAvailableEntries)})(({params:e,state:t},r)=>ke.create("Loading Volume & Segmentation",n=>t.transaction(async()=>{let o=OM.fromLoadVolsegParamValues(e);if(o.entryId.trim().length===0)throw alert("Must specify Entry Id!"),new Error("Specify Entry Id");o.entryId.includes("-")||(o.entryId=Bhe(o.source,o.entryId)),r.behaviors.layout.leftPanelTabName.next("data"),r.state.data.selectQ(a=>a.ofType(oh))[0]||await t.build().toRoot().apply(Zhe,{},{state:{isGhost:!TH}}).commit();let s=await t.build().toRoot().apply(Whe,o).commit();await t.build().to(s).apply(qhe,{},{state:{isGhost:!TH}}).commit(),s.data&&(await s.data.loadVolume(),await s.data.loadSegmentations())}).runInContext(n)));var KCe=ar(hi());var Wn=ar(un()),N1=ar(hi());var hn=ar(un()),R1=ar(hi());function Zge(e,t){let r=t||{};return(e[e.length-1]===""?[...e,""]:e).join((r.padRight?" ":"")+","+(r.padLeft===!1?"":" ")).trim()}var aZe=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,lZe=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,cZe={};function cR(e,t){return((t||cZe).jsx?lZe:aZe).test(e)}var uZe=/[ \t\n\f\r]/g;function EH(e){return typeof e=="object"?e.type==="text"?Kge(e.value):!1:Kge(e)}function Kge(e){return e.replace(uZe,"")===""}var jg=class{constructor(t,r,n){this.property=t,this.normal=r,n&&(this.space=n)}};jg.prototype.property={};jg.prototype.normal={};jg.prototype.space=null;function PH(e,t){let r={},n={},o=-1;for(;++o<e.length;)Object.assign(r,e[o].property),Object.assign(n,e[o].normal);return new jg(r,n,t)}function c_(e){return e.toLowerCase()}var Fc=class{constructor(t,r){this.property=t,this.attribute=r}};Fc.prototype.space=null;Fc.prototype.boolean=!1;Fc.prototype.booleanish=!1;Fc.prototype.overloadedBoolean=!1;Fc.prototype.number=!1;Fc.prototype.commaSeparated=!1;Fc.prototype.spaceSeparated=!1;Fc.prototype.commaOrSpaceSeparated=!1;Fc.prototype.mustUseProperty=!1;Fc.prototype.defined=!1;var u_={};Ui(u_,{boolean:()=>kn,booleanish:()=>ia,commaOrSpaceSeparated:()=>nd,commaSeparated:()=>rv,number:()=>qt,overloadedBoolean:()=>DH,spaceSeparated:()=>Ei});var dZe=0,kn=C1(),ia=C1(),DH=C1(),qt=C1(),Ei=C1(),rv=C1(),nd=C1();function C1(){return 2**++dZe}var kH=Object.keys(u_),S1=class extends Fc{constructor(t,r,n,o){let i=-1;if(super(t,r),Xge(this,"space",o),typeof n=="number")for(;++i<kH.length;){let s=kH[i];Xge(this,kH[i],(n&u_[s])===u_[s])}}};S1.prototype.defined=!0;function Xge(e,t,r){r&&(e[t]=r)}var mZe={}.hasOwnProperty;function zm(e){let t={},r={},n;for(n in e.properties)if(mZe.call(e.properties,n)){let o=e.properties[n],i=new S1(n,e.transform(e.attributes||{},n),o,e.space);e.mustUseProperty&&e.mustUseProperty.includes(n)&&(i.mustUseProperty=!0),t[n]=i,r[c_(n)]=n,r[c_(i.attribute)]=n}return new jg(t,r,e.space)}var MH=zm({space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}});var RH=zm({space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function uR(e,t){return t in e?e[t]:t}function dR(e,t){return uR(e,t.toLowerCase())}var BH=zm({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:dR,properties:{xmlns:null,xmlnsXLink:null}});var LH=zm({transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:ia,ariaAutoComplete:null,ariaBusy:ia,ariaChecked:ia,ariaColCount:qt,ariaColIndex:qt,ariaColSpan:qt,ariaControls:Ei,ariaCurrent:null,ariaDescribedBy:Ei,ariaDetails:null,ariaDisabled:ia,ariaDropEffect:Ei,ariaErrorMessage:null,ariaExpanded:ia,ariaFlowTo:Ei,ariaGrabbed:ia,ariaHasPopup:null,ariaHidden:ia,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Ei,ariaLevel:qt,ariaLive:null,ariaModal:ia,ariaMultiLine:ia,ariaMultiSelectable:ia,ariaOrientation:null,ariaOwns:Ei,ariaPlaceholder:null,ariaPosInSet:qt,ariaPressed:ia,ariaReadOnly:ia,ariaRelevant:null,ariaRequired:ia,ariaRoleDescription:Ei,ariaRowCount:qt,ariaRowIndex:qt,ariaRowSpan:qt,ariaSelected:ia,ariaSetSize:qt,ariaSort:null,ariaValueMax:qt,ariaValueMin:qt,ariaValueNow:qt,ariaValueText:null,role:null}});var Yge=zm({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:dR,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:rv,acceptCharset:Ei,accessKey:Ei,action:null,allow:null,allowFullScreen:kn,allowPaymentRequest:kn,allowUserMedia:kn,alt:null,as:null,async:kn,autoCapitalize:null,autoComplete:Ei,autoFocus:kn,autoPlay:kn,blocking:Ei,capture:null,charSet:null,checked:kn,cite:null,className:Ei,cols:qt,colSpan:null,content:null,contentEditable:ia,controls:kn,controlsList:Ei,coords:qt|rv,crossOrigin:null,data:null,dateTime:null,decoding:null,default:kn,defer:kn,dir:null,dirName:null,disabled:kn,download:DH,draggable:ia,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:kn,formTarget:null,headers:Ei,height:qt,hidden:kn,high:qt,href:null,hrefLang:null,htmlFor:Ei,httpEquiv:Ei,id:null,imageSizes:null,imageSrcSet:null,inert:kn,inputMode:null,integrity:null,is:null,isMap:kn,itemId:null,itemProp:Ei,itemRef:Ei,itemScope:kn,itemType:Ei,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:kn,low:qt,manifest:null,max:null,maxLength:qt,media:null,method:null,min:null,minLength:qt,multiple:kn,muted:kn,name:null,nonce:null,noModule:kn,noValidate:kn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:kn,optimum:qt,pattern:null,ping:Ei,placeholder:null,playsInline:kn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:kn,referrerPolicy:null,rel:Ei,required:kn,reversed:kn,rows:qt,rowSpan:qt,sandbox:Ei,scope:null,scoped:kn,seamless:kn,selected:kn,shadowRootClonable:kn,shadowRootDelegatesFocus:kn,shadowRootMode:null,shape:null,size:qt,sizes:null,slot:null,span:qt,spellCheck:ia,src:null,srcDoc:null,srcLang:null,srcSet:null,start:qt,step:null,style:null,tabIndex:qt,target:null,title:null,translate:null,type:null,typeMustMatch:kn,useMap:null,value:ia,width:qt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Ei,axis:null,background:null,bgColor:null,border:qt,borderColor:null,bottomMargin:qt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:kn,declare:kn,event:null,face:null,frame:null,frameBorder:null,hSpace:qt,leftMargin:qt,link:null,longDesc:null,lowSrc:null,marginHeight:qt,marginWidth:qt,noResize:kn,noHref:kn,noShade:kn,noWrap:kn,object:null,profile:null,prompt:null,rev:null,rightMargin:qt,rules:null,scheme:null,scrolling:ia,standby:null,summary:null,text:null,topMargin:qt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:qt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:kn,disableRemotePlayback:kn,prefix:null,property:null,results:qt,security:null,unselectable:null}});var Qge=zm({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:uR,properties:{about:nd,accentHeight:qt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:qt,amplitude:qt,arabicForm:null,ascent:qt,attributeName:null,attributeType:null,azimuth:qt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:qt,by:null,calcMode:null,capHeight:qt,className:Ei,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:qt,diffuseConstant:qt,direction:null,display:null,dur:null,divisor:qt,dominantBaseline:null,download:kn,dx:null,dy:null,edgeMode:null,editable:null,elevation:qt,enableBackground:null,end:null,event:null,exponent:qt,externalResourcesRequired:null,fill:null,fillOpacity:qt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:rv,g2:rv,glyphName:rv,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:qt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:qt,horizOriginX:qt,horizOriginY:qt,id:null,ideographic:qt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:qt,k:qt,k1:qt,k2:qt,k3:qt,k4:qt,kernelMatrix:nd,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:qt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:qt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:qt,overlineThickness:qt,paintOrder:null,panose1:null,path:null,pathLength:qt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Ei,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:qt,pointsAtY:qt,pointsAtZ:qt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:nd,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:nd,rev:nd,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:nd,requiredFeatures:nd,requiredFonts:nd,requiredFormats:nd,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:qt,specularExponent:qt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:qt,strikethroughThickness:qt,string:null,stroke:null,strokeDashArray:nd,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:qt,strokeOpacity:qt,strokeWidth:null,style:null,surfaceScale:qt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:nd,tabIndex:qt,tableValues:null,target:null,targetX:qt,targetY:qt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:nd,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:qt,underlineThickness:qt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:qt,values:null,vAlphabetic:qt,vMathematical:qt,vectorEffect:null,vHanging:qt,vIdeographic:qt,version:null,vertAdvY:qt,vertOriginX:qt,vertOriginY:qt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:qt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}});var pZe=/^data[-\w.:]+$/i,Jge=/-[a-z]/g,fZe=/[A-Z]/g;function NH(e,t){let r=c_(t),n=t,o=Fc;if(r in e.normal)return e.property[e.normal[r]];if(r.length>4&&r.slice(0,4)==="data"&&pZe.test(t)){if(t.charAt(4)==="-"){let i=t.slice(5).replace(Jge,gZe);n="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{let i=t.slice(4);if(!Jge.test(i)){let s=i.replace(fZe,hZe);s.charAt(0)!=="-"&&(s="-"+s),t="data"+s}}o=S1}return new o(n,t)}function hZe(e){return"-"+e.toLowerCase()}function gZe(e){return e.charAt(1).toUpperCase()}var FH={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"};var e0e=PH([RH,MH,BH,LH,Yge],"html"),mR=PH([RH,MH,BH,LH,Qge],"svg");function t0e(e){return e.join(" ").trim()}var OH=ar(l0e(),1),c0e=OH.default.default||OH.default;var pR=u0e("end"),FS=u0e("start");function u0e(e){return t;function t(r){let n=r&&r.position&&r.position[e]||{};if(typeof n.line=="number"&&n.line>0&&typeof n.column=="number"&&n.column>0)return{line:n.line,column:n.column,offset:typeof n.offset=="number"&&n.offset>-1?n.offset:void 0}}}function VH(e){let t=FS(e),r=pR(e);if(t&&r)return{start:t,end:r}}function nv(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?d0e(e.position):"start"in e||"end"in e?d0e(e):"line"in e||"column"in e?GH(e):""}function GH(e){return m0e(e&&e.line)+":"+m0e(e&&e.column)}function d0e(e){return GH(e&&e.start)+"-"+GH(e&&e.end)}function m0e(e){return e&&typeof e=="number"?e:1}var Ca=class extends Error{constructor(t,r,n){super(),typeof r=="string"&&(n=r,r=void 0);let o="",i={},s=!1;if(r&&("line"in r&&"column"in r?i={place:r}:"start"in r&&"end"in r?i={place:r}:"type"in r?i={ancestors:[r],place:r.position}:i={...r}),typeof t=="string"?o=t:!i.cause&&t&&(s=!0,o=t.message,i.cause=t),!i.ruleId&&!i.source&&typeof n=="string"){let l=n.indexOf(":");l===-1?i.ruleId=n:(i.source=n.slice(0,l),i.ruleId=n.slice(l+1))}if(!i.place&&i.ancestors&&i.ancestors){let l=i.ancestors[i.ancestors.length-1];l&&(i.place=l.position)}let a=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file,this.message=o,this.line=a?a.line:void 0,this.name=nv(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=s&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual,this.expected,this.note,this.url}};Ca.prototype.file="";Ca.prototype.name="";Ca.prototype.reason="";Ca.prototype.message="";Ca.prototype.stack="";Ca.prototype.column=void 0;Ca.prototype.line=void 0;Ca.prototype.ancestors=void 0;Ca.prototype.cause=void 0;Ca.prototype.fatal=void 0;Ca.prototype.place=void 0;Ca.prototype.ruleId=void 0;Ca.prototype.source=void 0;var UH={}.hasOwnProperty,DZe=new Map,kZe=/[A-Z]/g,MZe=/-([a-z])/g,RZe=new Set(["table","tbody","thead","tfoot","tr"]),BZe=new Set(["td","th"]),p0e="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function zH(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");let r=t.filePath||void 0,n;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");n=zZe(r,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");n=UZe(r,t.jsx,t.jsxs)}let o={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:n,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:r,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?mR:e0e,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},i=f0e(o,e,void 0);return i&&typeof i!="string"?i:o.create(e,o.Fragment,{children:i||void 0},void 0)}function f0e(e,t,r){if(t.type==="element")return LZe(e,t,r);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return NZe(e,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return OZe(e,t,r);if(t.type==="mdxjsEsm")return FZe(e,t);if(t.type==="root")return VZe(e,t,r);if(t.type==="text")return GZe(e,t)}function LZe(e,t,r){let n=e.schema,o=n;t.tagName.toLowerCase()==="svg"&&n.space==="html"&&(o=mR,e.schema=o),e.ancestors.push(t);let i=g0e(e,t.tagName,!1),s=HZe(e,t),a=jH(e,t);return RZe.has(t.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!EH(l):!0})),h0e(e,s,i,t),HH(s,a),e.ancestors.pop(),e.schema=n,e.create(t,i,s,r)}function NZe(e,t){if(t.data&&t.data.estree&&e.evaluater){let n=t.data.estree.body[0];return n.type,e.evaluater.evaluateExpression(n.expression)}m_(e,t.position)}function FZe(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);m_(e,t.position)}function OZe(e,t,r){let n=e.schema,o=n;t.name==="svg"&&n.space==="html"&&(o=mR,e.schema=o),e.ancestors.push(t);let i=t.name===null?e.Fragment:g0e(e,t.name,!0),s=jZe(e,t),a=jH(e,t);return h0e(e,s,i,t),HH(s,a),e.ancestors.pop(),e.schema=n,e.create(t,i,s,r)}function VZe(e,t,r){let n={};return HH(n,jH(e,t)),e.create(t,e.Fragment,n,r)}function GZe(e,t){return t.value}function h0e(e,t,r,n){typeof r!="string"&&r!==e.Fragment&&e.passNode&&(t.node=n)}function HH(e,t){if(t.length>0){let r=t.length>1?t:t[0];r&&(e.children=r)}}function UZe(e,t,r){return n;function n(o,i,s,a){let c=Array.isArray(s.children)?r:t;return a?c(i,s,a):c(i,s)}}function zZe(e,t){return r;function r(n,o,i,s){let a=Array.isArray(i.children),l=FS(n);return t(o,i,s,a,{columnNumber:l?l.column-1:void 0,fileName:e,lineNumber:l?l.line:void 0},void 0)}}function HZe(e,t){let r={},n,o;for(o in t.properties)if(o!=="children"&&UH.call(t.properties,o)){let i=$Ze(e,o,t.properties[o]);if(i){let[s,a]=i;e.tableCellAlignToStyle&&s==="align"&&typeof a=="string"&&BZe.has(t.tagName)?n=a:r[s]=a}}if(n){let i=r.style||(r.style={});i[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=n}return r}function jZe(e,t){let r={};for(let n of t.attributes)if(n.type==="mdxJsxExpressionAttribute")if(n.data&&n.data.estree&&e.evaluater){let i=n.data.estree.body[0];i.type;let s=i.expression;s.type;let a=s.properties[0];a.type,Object.assign(r,e.evaluater.evaluateExpression(a.argument))}else m_(e,t.position);else{let o=n.name,i;if(n.value&&typeof n.value=="object")if(n.value.data&&n.value.data.estree&&e.evaluater){let a=n.value.data.estree.body[0];a.type,i=e.evaluater.evaluateExpression(a.expression)}else m_(e,t.position);else i=n.value===null?!0:n.value;r[o]=i}return r}function jH(e,t){let r=[],n=-1,o=e.passKeys?new Map:DZe;for(;++n<t.children.length;){let i=t.children[n],s;if(e.passKeys){let l=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(l){let c=o.get(l)||0;s=l+"-"+c,o.set(l,c+1)}}let a=f0e(e,i,s);a!==void 0&&r.push(a)}return r}function $Ze(e,t,r){let n=NH(e.schema,t);if(!(r==null||typeof r=="number"&&Number.isNaN(r))){if(Array.isArray(r)&&(r=n.commaSeparated?Zge(r):t0e(r)),n.property==="style"){let o=typeof r=="object"?r:WZe(e,String(r));return e.stylePropertyNameCase==="css"&&(o=qZe(o)),["style",o]}return[e.elementAttributeNameCase==="react"&&n.space?FH[n.property]||n.property:n.attribute,r]}}function WZe(e,t){let r={};try{c0e(t,n)}catch(o){if(!e.ignoreInvalidStyle){let i=o,s=new Ca("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:i,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=e.filePath||void 0,s.url=p0e+"#cannot-parse-style-attribute",s}}return r;function n(o,i){let s=o;s.slice(0,2)!=="--"&&(s.slice(0,4)==="-ms-"&&(s="ms-"+s.slice(4)),s=s.replace(MZe,KZe)),r[s]=i}}function g0e(e,t,r){let n;if(!r)n={type:"Literal",value:t};else if(t.includes(".")){let o=t.split("."),i=-1,s;for(;++i<o.length;){let a=cR(o[i])?{type:"Identifier",name:o[i]}:{type:"Literal",value:o[i]};s=s?{type:"MemberExpression",object:s,property:a,computed:!!(i&&a.type==="Literal"),optional:!1}:a}n=s}else n=cR(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(n.type==="Literal"){let o=n.value;return UH.call(e.components,o)?e.components[o]:o}if(e.evaluater)return e.evaluater.evaluateExpression(n);m_(e)}function m_(e,t){let r=new Ca("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw r.file=e.filePath||void 0,r.url=p0e+"#cannot-handle-mdx-estrees-without-createevaluater",r}function qZe(e){let t={},r;for(r in e)UH.call(e,r)&&(t[ZZe(r)]=e[r]);return t}function ZZe(e){let t=e.replace(kZe,XZe);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function KZe(e,t){return t.toUpperCase()}function XZe(e){return"-"+e.toLowerCase()}var p_={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]};var HS=ar(un(),1);var YZe={};function $H(e,t){let r=t||YZe,n=typeof r.includeImageAlt=="boolean"?r.includeImageAlt:!0,o=typeof r.includeHtml=="boolean"?r.includeHtml:!0;return v0e(e,n,o)}function v0e(e,t,r){if(QZe(e)){if("value"in e)return e.type==="html"&&!r?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return y0e(e.children,t,r)}return Array.isArray(e)?y0e(e,t,r):""}function y0e(e,t,r){let n=[],o=-1;for(;++o<e.length;)n[o]=v0e(e[o],t,r);return n.join("")}function QZe(e){return!!(e&&typeof e=="object")}var b0e=document.createElement("i");function OS(e){let t="&"+e+";";b0e.innerHTML=t;let r=b0e.textContent;return r.charCodeAt(r.length-1)===59&&e!=="semi"||r===t?!1:r}function Oc(e,t,r,n){let o=e.length,i=0,s;if(t<0?t=-t>o?0:o+t:t=t>o?o:t,r=r>0?r:0,n.length<1e4)s=Array.from(n),s.unshift(t,r),e.splice(...s);else for(r&&e.splice(t,r);i<n.length;)s=n.slice(i,i+1e4),s.unshift(t,0),e.splice(...s),i+=1e4,t+=1e4}function yu(e,t){return e.length>0?(Oc(e,e.length,0,t),e):t}var x0e={}.hasOwnProperty;function C0e(e){let t={},r=-1;for(;++r<e.length;)JZe(t,e[r]);return t}function JZe(e,t){let r;for(r in t){let o=(x0e.call(e,r)?e[r]:void 0)||(e[r]={}),i=t[r],s;if(i)for(s in i){x0e.call(o,s)||(o[s]=[]);let a=i[s];eKe(o[s],Array.isArray(a)?a:a?[a]:[])}}}function eKe(e,t){let r=-1,n=[];for(;++r<t.length;)(t[r].add==="after"?e:n).push(t[r]);Oc(e,0,0,n)}function fR(e,t){let r=Number.parseInt(e,t);return r<9||r===11||r>13&&r<32||r>126&&r<160||r>55295&&r<57344||r>64975&&r<65008||(r&65535)===65535||(r&65535)===65534||r>1114111?"\uFFFD":String.fromCodePoint(r)}function $g(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}var Od=ov(/[A-Za-z]/),jl=ov(/[\dA-Za-z]/),S0e=ov(/[#-'*+\--9=?A-Z^-~]/);function f_(e){return e!==null&&(e<32||e===127)}var h_=ov(/\d/),I0e=ov(/[\dA-Fa-f]/),A0e=ov(/[!-/:-@[-`{-~]/);function Ir(e){return e!==null&&e<-2}function Sa(e){return e!==null&&(e<0||e===32)}function Mn(e){return e===-2||e===-1||e===32}var w0e=ov(new RegExp("\\p{P}|\\p{S}","u")),_0e=ov(/\s/);function ov(e){return t;function t(r){return r!==null&&r>-1&&e.test(String.fromCharCode(r))}}function Hm(e){let t=[],r=-1,n=0,o=0;for(;++r<e.length;){let i=e.charCodeAt(r),s="";if(i===37&&jl(e.charCodeAt(r+1))&&jl(e.charCodeAt(r+2)))o=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(s=String.fromCharCode(i));else if(i>55295&&i<57344){let a=e.charCodeAt(r+1);i<56320&&a>56319&&a<57344?(s=String.fromCharCode(i,a),o=1):s="\uFFFD"}else s=String.fromCharCode(i);s&&(t.push(e.slice(n,r),encodeURIComponent(s)),n=r+o+1,s=""),o&&(r+=o,o=0)}return t.join("")+e.slice(n)}function On(e,t,r,n){let o=n?n-1:Number.POSITIVE_INFINITY,i=0;return s;function s(l){return Mn(l)?(e.enter(r),a(l)):t(l)}function a(l){return Mn(l)&&i++<o?(e.consume(l),a):(e.exit(r),t(l))}}var T0e={tokenize:tKe};function tKe(e){let t=e.attempt(this.parser.constructs.contentInitial,n,o),r;return t;function n(a){if(a===null){e.consume(a);return}return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),On(e,t,"linePrefix")}function o(a){return e.enter("paragraph"),i(a)}function i(a){let l=e.enter("chunkText",{contentType:"text",previous:r});return r&&(r.next=l),r=l,s(a)}function s(a){if(a===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(a);return}return Ir(a)?(e.consume(a),e.exit("chunkText"),i):(e.consume(a),s)}}var P0e={tokenize:rKe},E0e={tokenize:nKe};function rKe(e){let t=this,r=[],n=0,o,i,s;return a;function a(y){if(n<r.length){let x=r[n];return t.containerState=x[1],e.attempt(x[0].continuation,l,c)(y)}return c(y)}function l(y){if(n++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,o&&b();let x=t.events.length,A=x,v;for(;A--;)if(t.events[A][0]==="exit"&&t.events[A][1].type==="chunkFlow"){v=t.events[A][1].end;break}g(n);let _=x;for(;_<t.events.length;)t.events[_][1].end=Object.assign({},v),_++;return Oc(t.events,A+1,0,t.events.slice(x)),t.events.length=_,c(y)}return a(y)}function c(y){if(n===r.length){if(!o)return m(y);if(o.currentConstruct&&o.currentConstruct.concrete)return h(y);t.interrupt=!!(o.currentConstruct&&!o._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(E0e,u,d)(y)}function u(y){return o&&b(),g(n),m(y)}function d(y){return t.parser.lazy[t.now().line]=n!==r.length,s=t.now().offset,h(y)}function m(y){return t.containerState={},e.attempt(E0e,p,h)(y)}function p(y){return n++,r.push([t.currentConstruct,t.containerState]),m(y)}function h(y){if(y===null){o&&b(),g(0),e.consume(y);return}return o=o||t.parser.flow(t.now()),e.enter("chunkFlow",{contentType:"flow",previous:i,_tokenizer:o}),f(y)}function f(y){if(y===null){C(e.exit("chunkFlow"),!0),g(0),e.consume(y);return}return Ir(y)?(e.consume(y),C(e.exit("chunkFlow")),n=0,t.interrupt=void 0,a):(e.consume(y),f)}function C(y,x){let A=t.sliceStream(y);if(x&&A.push(null),y.previous=i,i&&(i.next=y),i=y,o.defineSkip(y.start),o.write(A),t.parser.lazy[y.start.line]){let v=o.events.length;for(;v--;)if(o.events[v][1].start.offset<s&&(!o.events[v][1].end||o.events[v][1].end.offset>s))return;let _=t.events.length,I=_,T,E;for(;I--;)if(t.events[I][0]==="exit"&&t.events[I][1].type==="chunkFlow"){if(T){E=t.events[I][1].end;break}T=!0}for(g(n),v=_;v<t.events.length;)t.events[v][1].end=Object.assign({},E),v++;Oc(t.events,I+1,0,t.events.slice(_)),t.events.length=v}}function g(y){let x=r.length;for(;x-- >y;){let A=r[x];t.containerState=A[1],A[0].exit.call(t,e)}r.length=y}function b(){o.write([null]),i=void 0,o=void 0,t.containerState._closeFlow=void 0}}function nKe(e,t,r){return On(e,e.attempt(this.parser.constructs.document,t,r),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function WH(e){if(e===null||Sa(e)||_0e(e))return 1;if(w0e(e))return 2}function VS(e,t,r){let n=[],o=-1;for(;++o<e.length;){let i=e[o].resolveAll;i&&!n.includes(i)&&(t=i(t,r),n.push(i))}return t}var g_={name:"attention",tokenize:iKe,resolveAll:oKe};function oKe(e,t){let r=-1,n,o,i,s,a,l,c,u;for(;++r<e.length;)if(e[r][0]==="enter"&&e[r][1].type==="attentionSequence"&&e[r][1]._close){for(n=r;n--;)if(e[n][0]==="exit"&&e[n][1].type==="attentionSequence"&&e[n][1]._open&&t.sliceSerialize(e[n][1]).charCodeAt(0)===t.sliceSerialize(e[r][1]).charCodeAt(0)){if((e[n][1]._close||e[r][1]._open)&&(e[r][1].end.offset-e[r][1].start.offset)%3&&!((e[n][1].end.offset-e[n][1].start.offset+e[r][1].end.offset-e[r][1].start.offset)%3))continue;l=e[n][1].end.offset-e[n][1].start.offset>1&&e[r][1].end.offset-e[r][1].start.offset>1?2:1;let d=Object.assign({},e[n][1].end),m=Object.assign({},e[r][1].start);D0e(d,-l),D0e(m,l),s={type:l>1?"strongSequence":"emphasisSequence",start:d,end:Object.assign({},e[n][1].end)},a={type:l>1?"strongSequence":"emphasisSequence",start:Object.assign({},e[r][1].start),end:m},i={type:l>1?"strongText":"emphasisText",start:Object.assign({},e[n][1].end),end:Object.assign({},e[r][1].start)},o={type:l>1?"strong":"emphasis",start:Object.assign({},s.start),end:Object.assign({},a.end)},e[n][1].end=Object.assign({},s.start),e[r][1].start=Object.assign({},a.end),c=[],e[n][1].end.offset-e[n][1].start.offset&&(c=yu(c,[["enter",e[n][1],t],["exit",e[n][1],t]])),c=yu(c,[["enter",o,t],["enter",s,t],["exit",s,t],["enter",i,t]]),c=yu(c,VS(t.parser.constructs.insideSpan.null,e.slice(n+1,r),t)),c=yu(c,[["exit",i,t],["enter",a,t],["exit",a,t],["exit",o,t]]),e[r][1].end.offset-e[r][1].start.offset?(u=2,c=yu(c,[["enter",e[r][1],t],["exit",e[r][1],t]])):u=0,Oc(e,n-1,r-n+3,c),r=n+c.length-u-2;break}}for(r=-1;++r<e.length;)e[r][1].type==="attentionSequence"&&(e[r][1].type="data");return e}function iKe(e,t){let r=this.parser.constructs.attentionMarkers.null,n=this.previous,o=WH(n),i;return s;function s(l){return i=l,e.enter("attentionSequence"),a(l)}function a(l){if(l===i)return e.consume(l),a;let c=e.exit("attentionSequence"),u=WH(l),d=!u||u===2&&o||r.includes(l),m=!o||o===2&&u||r.includes(n);return c._open=!!(i===42?d:d&&(o||!m)),c._close=!!(i===42?m:m&&(u||!d)),t(l)}}function D0e(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}var qH={name:"autolink",tokenize:sKe};function sKe(e,t,r){let n=0;return o;function o(p){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i}function i(p){return Od(p)?(e.consume(p),s):p===64?r(p):c(p)}function s(p){return p===43||p===45||p===46||jl(p)?(n=1,a(p)):c(p)}function a(p){return p===58?(e.consume(p),n=0,l):(p===43||p===45||p===46||jl(p))&&n++<32?(e.consume(p),a):(n=0,c(p))}function l(p){return p===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),t):p===null||p===32||p===60||f_(p)?r(p):(e.consume(p),l)}function c(p){return p===64?(e.consume(p),u):S0e(p)?(e.consume(p),c):r(p)}function u(p){return jl(p)?d(p):r(p)}function d(p){return p===46?(e.consume(p),n=0,u):p===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),t):m(p)}function m(p){if((p===45||jl(p))&&n++<63){let h=p===45?m:d;return e.consume(p),h}return r(p)}}var iv={tokenize:aKe,partial:!0};function aKe(e,t,r){return n;function n(i){return Mn(i)?On(e,o,"linePrefix")(i):o(i)}function o(i){return i===null||Ir(i)?t(i):r(i)}}var hR={name:"blockQuote",tokenize:lKe,continuation:{tokenize:cKe},exit:uKe};function lKe(e,t,r){let n=this;return o;function o(s){if(s===62){let a=n.containerState;return a.open||(e.enter("blockQuote",{_container:!0}),a.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(s),e.exit("blockQuoteMarker"),i}return r(s)}function i(s){return Mn(s)?(e.enter("blockQuotePrefixWhitespace"),e.consume(s),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(s))}}function cKe(e,t,r){let n=this;return o;function o(s){return Mn(s)?On(e,i,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):i(s)}function i(s){return e.attempt(hR,t,r)(s)}}function uKe(e){e.exit("blockQuote")}var gR={name:"characterEscape",tokenize:dKe};function dKe(e,t,r){return n;function n(i){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(i),e.exit("escapeMarker"),o}function o(i){return A0e(i)?(e.enter("characterEscapeValue"),e.consume(i),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):r(i)}}var yR={name:"characterReference",tokenize:mKe};function mKe(e,t,r){let n=this,o=0,i,s;return a;function a(d){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),l}function l(d){return d===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(d),e.exit("characterReferenceMarkerNumeric"),c):(e.enter("characterReferenceValue"),i=31,s=jl,u(d))}function c(d){return d===88||d===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(d),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,s=I0e,u):(e.enter("characterReferenceValue"),i=7,s=h_,u(d))}function u(d){if(d===59&&o){let m=e.exit("characterReferenceValue");return s===jl&&!OS(n.sliceSerialize(m))?r(d):(e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return s(d)&&o++<i?(e.consume(d),u):r(d)}}var k0e={tokenize:fKe,partial:!0},vR={name:"codeFenced",tokenize:pKe,concrete:!0};function pKe(e,t,r){let n=this,o={tokenize:A,partial:!0},i=0,s=0,a;return l;function l(v){return c(v)}function c(v){let _=n.events[n.events.length-1];return i=_&&_[1].type==="linePrefix"?_[2].sliceSerialize(_[1],!0).length:0,a=v,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),u(v)}function u(v){return v===a?(s++,e.consume(v),u):s<3?r(v):(e.exit("codeFencedFenceSequence"),Mn(v)?On(e,d,"whitespace")(v):d(v))}function d(v){return v===null||Ir(v)?(e.exit("codeFencedFence"),n.interrupt?t(v):e.check(k0e,f,x)(v)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),m(v))}function m(v){return v===null||Ir(v)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),d(v)):Mn(v)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),On(e,p,"whitespace")(v)):v===96&&v===a?r(v):(e.consume(v),m)}function p(v){return v===null||Ir(v)?d(v):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),h(v))}function h(v){return v===null||Ir(v)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),d(v)):v===96&&v===a?r(v):(e.consume(v),h)}function f(v){return e.attempt(o,x,C)(v)}function C(v){return e.enter("lineEnding"),e.consume(v),e.exit("lineEnding"),g}function g(v){return i>0&&Mn(v)?On(e,b,"linePrefix",i+1)(v):b(v)}function b(v){return v===null||Ir(v)?e.check(k0e,f,x)(v):(e.enter("codeFlowValue"),y(v))}function y(v){return v===null||Ir(v)?(e.exit("codeFlowValue"),b(v)):(e.consume(v),y)}function x(v){return e.exit("codeFenced"),t(v)}function A(v,_,I){let T=0;return E;function E(L){return v.enter("lineEnding"),v.consume(L),v.exit("lineEnding"),w}function w(L){return v.enter("codeFencedFence"),Mn(L)?On(v,S,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(L):S(L)}function S(L){return L===a?(v.enter("codeFencedFenceSequence"),P(L)):I(L)}function P(L){return L===a?(T++,v.consume(L),P):T>=s?(v.exit("codeFencedFenceSequence"),Mn(L)?On(v,k,"whitespace")(L):k(L)):I(L)}function k(L){return L===null||Ir(L)?(v.exit("codeFencedFence"),_(L)):I(L)}}}function fKe(e,t,r){let n=this;return o;function o(s){return s===null?r(s):(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),i)}function i(s){return n.parser.lazy[n.now().line]?r(s):t(s)}}var y_={name:"codeIndented",tokenize:gKe},hKe={tokenize:yKe,partial:!0};function gKe(e,t,r){let n=this;return o;function o(c){return e.enter("codeIndented"),On(e,i,"linePrefix",5)(c)}function i(c){let u=n.events[n.events.length-1];return u&&u[1].type==="linePrefix"&&u[2].sliceSerialize(u[1],!0).length>=4?s(c):r(c)}function s(c){return c===null?l(c):Ir(c)?e.attempt(hKe,s,l)(c):(e.enter("codeFlowValue"),a(c))}function a(c){return c===null||Ir(c)?(e.exit("codeFlowValue"),s(c)):(e.consume(c),a)}function l(c){return e.exit("codeIndented"),t(c)}}function yKe(e,t,r){let n=this;return o;function o(s){return n.parser.lazy[n.now().line]?r(s):Ir(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),o):On(e,i,"linePrefix",5)(s)}function i(s){let a=n.events[n.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?t(s):Ir(s)?o(s):r(s)}}var ZH={name:"codeText",tokenize:xKe,resolve:vKe,previous:bKe};function vKe(e){let t=e.length-4,r=3,n,o;if((e[r][1].type==="lineEnding"||e[r][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(n=r;++n<t;)if(e[n][1].type==="codeTextData"){e[r][1].type="codeTextPadding",e[t][1].type="codeTextPadding",r+=2,t-=2;break}}for(n=r-1,t++;++n<=t;)o===void 0?n!==t&&e[n][1].type!=="lineEnding"&&(o=n):(n===t||e[n][1].type==="lineEnding")&&(e[o][1].type="codeTextData",n!==o+2&&(e[o][1].end=e[n-1][1].end,e.splice(o+2,n-o-2),t-=n-o-2,n=o+2),o=void 0);return e}function bKe(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function xKe(e,t,r){let n=this,o=0,i,s;return a;function a(m){return e.enter("codeText"),e.enter("codeTextSequence"),l(m)}function l(m){return m===96?(e.consume(m),o++,l):(e.exit("codeTextSequence"),c(m))}function c(m){return m===null?r(m):m===32?(e.enter("space"),e.consume(m),e.exit("space"),c):m===96?(s=e.enter("codeTextSequence"),i=0,d(m)):Ir(m)?(e.enter("lineEnding"),e.consume(m),e.exit("lineEnding"),c):(e.enter("codeTextData"),u(m))}function u(m){return m===null||m===32||m===96||Ir(m)?(e.exit("codeTextData"),c(m)):(e.consume(m),u)}function d(m){return m===96?(e.consume(m),i++,d):i===o?(e.exit("codeTextSequence"),e.exit("codeText"),t(m)):(s.type="codeTextData",u(m))}}var bR=class{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,r){let n=r??Number.POSITIVE_INFINITY;return n<this.left.length?this.left.slice(t,n):t>this.left.length?this.right.slice(this.right.length-n+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-n+this.left.length).reverse())}splice(t,r,n){let o=r||0;this.setCursor(Math.trunc(t));let i=this.right.splice(this.right.length-o,Number.POSITIVE_INFINITY);return n&&v_(this.left,n),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),v_(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),v_(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){let r=this.left.splice(t,Number.POSITIVE_INFINITY);v_(this.right,r.reverse())}else{let r=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);v_(this.left,r.reverse())}}};function v_(e,t){let r=0;if(t.length<1e4)e.push(...t);else for(;r<t.length;)e.push(...t.slice(r,r+1e4)),r+=1e4}function xR(e){let t={},r=-1,n,o,i,s,a,l,c,u=new bR(e);for(;++r<u.length;){for(;r in t;)r=t[r];if(n=u.get(r),r&&n[1].type==="chunkFlow"&&u.get(r-1)[1].type==="listItemPrefix"&&(l=n[1]._tokenizer.events,i=0,i<l.length&&l[i][1].type==="lineEndingBlank"&&(i+=2),i<l.length&&l[i][1].type==="content"))for(;++i<l.length&&l[i][1].type!=="content";)l[i][1].type==="chunkText"&&(l[i][1]._isInFirstContentOfListItem=!0,i++);if(n[0]==="enter")n[1].contentType&&(Object.assign(t,CKe(u,r)),r=t[r],c=!0);else if(n[1]._container){for(i=r,o=void 0;i--&&(s=u.get(i),s[1].type==="lineEnding"||s[1].type==="lineEndingBlank");)s[0]==="enter"&&(o&&(u.get(o)[1].type="lineEndingBlank"),s[1].type="lineEnding",o=i);o&&(n[1].end=Object.assign({},u.get(o)[1].start),a=u.slice(o,r),a.unshift(n),u.splice(o,r-o+1,a))}}return Oc(e,0,Number.POSITIVE_INFINITY,u.slice(0)),!c}function CKe(e,t){let r=e.get(t)[1],n=e.get(t)[2],o=t-1,i=[],s=r._tokenizer||n.parser[r.contentType](r.start),a=s.events,l=[],c={},u,d,m=-1,p=r,h=0,f=0,C=[f];for(;p;){for(;e.get(++o)[1]!==p;);i.push(o),p._tokenizer||(u=n.sliceStream(p),p.next||u.push(null),d&&s.defineSkip(p.start),p._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(u),p._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=r;++m<a.length;)a[m][0]==="exit"&&a[m-1][0]==="enter"&&a[m][1].type===a[m-1][1].type&&a[m][1].start.line!==a[m][1].end.line&&(f=m+1,C.push(f),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(s.events=[],p?(p._tokenizer=void 0,p.previous=void 0):C.pop(),m=C.length;m--;){let g=a.slice(C[m],C[m+1]),b=i.pop();l.push([b,b+g.length-1]),e.splice(b,2,g)}for(l.reverse(),m=-1;++m<l.length;)c[h+l[m][0]]=h+l[m][1],h+=l[m][1]-l[m][0]-1;return c}var KH={tokenize:AKe,resolve:IKe},SKe={tokenize:wKe,partial:!0};function IKe(e){return xR(e),e}function AKe(e,t){let r;return n;function n(a){return e.enter("content"),r=e.enter("chunkContent",{contentType:"content"}),o(a)}function o(a){return a===null?i(a):Ir(a)?e.check(SKe,s,i)(a):(e.consume(a),o)}function i(a){return e.exit("chunkContent"),e.exit("content"),t(a)}function s(a){return e.consume(a),e.exit("chunkContent"),r.next=e.enter("chunkContent",{contentType:"content",previous:r}),r=r.next,o}}function wKe(e,t,r){let n=this;return o;function o(s){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),On(e,i,"linePrefix")}function i(s){if(s===null||Ir(s))return r(s);let a=n.events[n.events.length-1];return!n.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?t(s):e.interrupt(n.parser.constructs.flow,r,t)(s)}}function CR(e,t,r,n,o,i,s,a,l){let c=l||Number.POSITIVE_INFINITY,u=0;return d;function d(g){return g===60?(e.enter(n),e.enter(o),e.enter(i),e.consume(g),e.exit(i),m):g===null||g===32||g===41||f_(g)?r(g):(e.enter(n),e.enter(s),e.enter(a),e.enter("chunkString",{contentType:"string"}),f(g))}function m(g){return g===62?(e.enter(i),e.consume(g),e.exit(i),e.exit(o),e.exit(n),t):(e.enter(a),e.enter("chunkString",{contentType:"string"}),p(g))}function p(g){return g===62?(e.exit("chunkString"),e.exit(a),m(g)):g===null||g===60||Ir(g)?r(g):(e.consume(g),g===92?h:p)}function h(g){return g===60||g===62||g===92?(e.consume(g),p):p(g)}function f(g){return!u&&(g===null||g===41||Sa(g))?(e.exit("chunkString"),e.exit(a),e.exit(s),e.exit(n),t(g)):u<c&&g===40?(e.consume(g),u++,f):g===41?(e.consume(g),u--,f):g===null||g===32||g===40||f_(g)?r(g):(e.consume(g),g===92?C:f)}function C(g){return g===40||g===41||g===92?(e.consume(g),f):f(g)}}function SR(e,t,r,n,o,i){let s=this,a=0,l;return c;function c(p){return e.enter(n),e.enter(o),e.consume(p),e.exit(o),e.enter(i),u}function u(p){return a>999||p===null||p===91||p===93&&!l||p===94&&!a&&"_hiddenFootnoteSupport"in s.parser.constructs?r(p):p===93?(e.exit(i),e.enter(o),e.consume(p),e.exit(o),e.exit(n),t):Ir(p)?(e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),u):(e.enter("chunkString",{contentType:"string"}),d(p))}function d(p){return p===null||p===91||p===93||Ir(p)||a++>999?(e.exit("chunkString"),u(p)):(e.consume(p),l||(l=!Mn(p)),p===92?m:d)}function m(p){return p===91||p===92||p===93?(e.consume(p),a++,d):d(p)}}function IR(e,t,r,n,o,i){let s;return a;function a(m){return m===34||m===39||m===40?(e.enter(n),e.enter(o),e.consume(m),e.exit(o),s=m===40?41:m,l):r(m)}function l(m){return m===s?(e.enter(o),e.consume(m),e.exit(o),e.exit(n),t):(e.enter(i),c(m))}function c(m){return m===s?(e.exit(i),l(s)):m===null?r(m):Ir(m)?(e.enter("lineEnding"),e.consume(m),e.exit("lineEnding"),On(e,c,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),u(m))}function u(m){return m===s||m===null||Ir(m)?(e.exit("chunkString"),c(m)):(e.consume(m),m===92?d:u)}function d(m){return m===s||m===92?(e.consume(m),u):u(m)}}function A1(e,t){let r;return n;function n(o){return Ir(o)?(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),r=!0,n):Mn(o)?On(e,n,r?"linePrefix":"lineSuffix")(o):t(o)}}var XH={name:"definition",tokenize:TKe},_Ke={tokenize:EKe,partial:!0};function TKe(e,t,r){let n=this,o;return i;function i(p){return e.enter("definition"),s(p)}function s(p){return SR.call(n,e,a,r,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function a(p){return o=$g(n.sliceSerialize(n.events[n.events.length-1][1]).slice(1,-1)),p===58?(e.enter("definitionMarker"),e.consume(p),e.exit("definitionMarker"),l):r(p)}function l(p){return Sa(p)?A1(e,c)(p):c(p)}function c(p){return CR(e,u,r,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function u(p){return e.attempt(_Ke,d,d)(p)}function d(p){return Mn(p)?On(e,m,"whitespace")(p):m(p)}function m(p){return p===null||Ir(p)?(e.exit("definition"),n.parser.defined.push(o),t(p)):r(p)}}function EKe(e,t,r){return n;function n(a){return Sa(a)?A1(e,o)(a):r(a)}function o(a){return IR(e,i,r,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function i(a){return Mn(a)?On(e,s,"whitespace")(a):s(a)}function s(a){return a===null||Ir(a)?t(a):r(a)}}var YH={name:"hardBreakEscape",tokenize:PKe};function PKe(e,t,r){return n;function n(i){return e.enter("hardBreakEscape"),e.consume(i),o}function o(i){return Ir(i)?(e.exit("hardBreakEscape"),t(i)):r(i)}}var QH={name:"headingAtx",tokenize:kKe,resolve:DKe};function DKe(e,t){let r=e.length-2,n=3,o,i;return e[n][1].type==="whitespace"&&(n+=2),r-2>n&&e[r][1].type==="whitespace"&&(r-=2),e[r][1].type==="atxHeadingSequence"&&(n===r-1||r-4>n&&e[r-2][1].type==="whitespace")&&(r-=n+1===r?2:4),r>n&&(o={type:"atxHeadingText",start:e[n][1].start,end:e[r][1].end},i={type:"chunkText",start:e[n][1].start,end:e[r][1].end,contentType:"text"},Oc(e,n,r-n+1,[["enter",o,t],["enter",i,t],["exit",i,t],["exit",o,t]])),e}function kKe(e,t,r){let n=0;return o;function o(u){return e.enter("atxHeading"),i(u)}function i(u){return e.enter("atxHeadingSequence"),s(u)}function s(u){return u===35&&n++<6?(e.consume(u),s):u===null||Sa(u)?(e.exit("atxHeadingSequence"),a(u)):r(u)}function a(u){return u===35?(e.enter("atxHeadingSequence"),l(u)):u===null||Ir(u)?(e.exit("atxHeading"),t(u)):Mn(u)?On(e,a,"whitespace")(u):(e.enter("atxHeadingText"),c(u))}function l(u){return u===35?(e.consume(u),l):(e.exit("atxHeadingSequence"),a(u))}function c(u){return u===null||u===35||Sa(u)?(e.exit("atxHeadingText"),a(u)):(e.consume(u),c)}}var M0e=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],JH=["pre","script","style","textarea"];var e6={name:"htmlFlow",tokenize:LKe,resolveTo:BKe,concrete:!0},MKe={tokenize:FKe,partial:!0},RKe={tokenize:NKe,partial:!0};function BKe(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function LKe(e,t,r){let n=this,o,i,s,a,l;return c;function c(O){return u(O)}function u(O){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(O),d}function d(O){return O===33?(e.consume(O),m):O===47?(e.consume(O),i=!0,f):O===63?(e.consume(O),o=3,n.interrupt?t:V):Od(O)?(e.consume(O),s=String.fromCharCode(O),C):r(O)}function m(O){return O===45?(e.consume(O),o=2,p):O===91?(e.consume(O),o=5,a=0,h):Od(O)?(e.consume(O),o=4,n.interrupt?t:V):r(O)}function p(O){return O===45?(e.consume(O),n.interrupt?t:V):r(O)}function h(O){let B="CDATA[";return O===B.charCodeAt(a++)?(e.consume(O),a===B.length?n.interrupt?t:S:h):r(O)}function f(O){return Od(O)?(e.consume(O),s=String.fromCharCode(O),C):r(O)}function C(O){if(O===null||O===47||O===62||Sa(O)){let B=O===47,j=s.toLowerCase();return!B&&!i&&JH.includes(j)?(o=1,n.interrupt?t(O):S(O)):M0e.includes(s.toLowerCase())?(o=6,B?(e.consume(O),g):n.interrupt?t(O):S(O)):(o=7,n.interrupt&&!n.parser.lazy[n.now().line]?r(O):i?b(O):y(O))}return O===45||jl(O)?(e.consume(O),s+=String.fromCharCode(O),C):r(O)}function g(O){return O===62?(e.consume(O),n.interrupt?t:S):r(O)}function b(O){return Mn(O)?(e.consume(O),b):E(O)}function y(O){return O===47?(e.consume(O),E):O===58||O===95||Od(O)?(e.consume(O),x):Mn(O)?(e.consume(O),y):E(O)}function x(O){return O===45||O===46||O===58||O===95||jl(O)?(e.consume(O),x):A(O)}function A(O){return O===61?(e.consume(O),v):Mn(O)?(e.consume(O),A):y(O)}function v(O){return O===null||O===60||O===61||O===62||O===96?r(O):O===34||O===39?(e.consume(O),l=O,_):Mn(O)?(e.consume(O),v):I(O)}function _(O){return O===l?(e.consume(O),l=null,T):O===null||Ir(O)?r(O):(e.consume(O),_)}function I(O){return O===null||O===34||O===39||O===47||O===60||O===61||O===62||O===96||Sa(O)?A(O):(e.consume(O),I)}function T(O){return O===47||O===62||Mn(O)?y(O):r(O)}function E(O){return O===62?(e.consume(O),w):r(O)}function w(O){return O===null||Ir(O)?S(O):Mn(O)?(e.consume(O),w):r(O)}function S(O){return O===45&&o===2?(e.consume(O),R):O===60&&o===1?(e.consume(O),N):O===62&&o===4?(e.consume(O),q):O===63&&o===3?(e.consume(O),V):O===93&&o===5?(e.consume(O),H):Ir(O)&&(o===6||o===7)?(e.exit("htmlFlowData"),e.check(MKe,Q,P)(O)):O===null||Ir(O)?(e.exit("htmlFlowData"),P(O)):(e.consume(O),S)}function P(O){return e.check(RKe,k,Q)(O)}function k(O){return e.enter("lineEnding"),e.consume(O),e.exit("lineEnding"),L}function L(O){return O===null||Ir(O)?P(O):(e.enter("htmlFlowData"),S(O))}function R(O){return O===45?(e.consume(O),V):S(O)}function N(O){return O===47?(e.consume(O),s="",F):S(O)}function F(O){if(O===62){let B=s.toLowerCase();return JH.includes(B)?(e.consume(O),q):S(O)}return Od(O)&&s.length<8?(e.consume(O),s+=String.fromCharCode(O),F):S(O)}function H(O){return O===93?(e.consume(O),V):S(O)}function V(O){return O===62?(e.consume(O),q):O===45&&o===2?(e.consume(O),V):S(O)}function q(O){return O===null||Ir(O)?(e.exit("htmlFlowData"),Q(O)):(e.consume(O),q)}function Q(O){return e.exit("htmlFlow"),t(O)}}function NKe(e,t,r){let n=this;return o;function o(s){return Ir(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),i):r(s)}function i(s){return n.parser.lazy[n.now().line]?r(s):t(s)}}function FKe(e,t,r){return n;function n(o){return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),e.attempt(iv,t,r)}}var t6={name:"htmlText",tokenize:OKe};function OKe(e,t,r){let n=this,o,i,s;return a;function a(V){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(V),l}function l(V){return V===33?(e.consume(V),c):V===47?(e.consume(V),A):V===63?(e.consume(V),y):Od(V)?(e.consume(V),I):r(V)}function c(V){return V===45?(e.consume(V),u):V===91?(e.consume(V),i=0,h):Od(V)?(e.consume(V),b):r(V)}function u(V){return V===45?(e.consume(V),p):r(V)}function d(V){return V===null?r(V):V===45?(e.consume(V),m):Ir(V)?(s=d,N(V)):(e.consume(V),d)}function m(V){return V===45?(e.consume(V),p):d(V)}function p(V){return V===62?R(V):V===45?m(V):d(V)}function h(V){let q="CDATA[";return V===q.charCodeAt(i++)?(e.consume(V),i===q.length?f:h):r(V)}function f(V){return V===null?r(V):V===93?(e.consume(V),C):Ir(V)?(s=f,N(V)):(e.consume(V),f)}function C(V){return V===93?(e.consume(V),g):f(V)}function g(V){return V===62?R(V):V===93?(e.consume(V),g):f(V)}function b(V){return V===null||V===62?R(V):Ir(V)?(s=b,N(V)):(e.consume(V),b)}function y(V){return V===null?r(V):V===63?(e.consume(V),x):Ir(V)?(s=y,N(V)):(e.consume(V),y)}function x(V){return V===62?R(V):y(V)}function A(V){return Od(V)?(e.consume(V),v):r(V)}function v(V){return V===45||jl(V)?(e.consume(V),v):_(V)}function _(V){return Ir(V)?(s=_,N(V)):Mn(V)?(e.consume(V),_):R(V)}function I(V){return V===45||jl(V)?(e.consume(V),I):V===47||V===62||Sa(V)?T(V):r(V)}function T(V){return V===47?(e.consume(V),R):V===58||V===95||Od(V)?(e.consume(V),E):Ir(V)?(s=T,N(V)):Mn(V)?(e.consume(V),T):R(V)}function E(V){return V===45||V===46||V===58||V===95||jl(V)?(e.consume(V),E):w(V)}function w(V){return V===61?(e.consume(V),S):Ir(V)?(s=w,N(V)):Mn(V)?(e.consume(V),w):T(V)}function S(V){return V===null||V===60||V===61||V===62||V===96?r(V):V===34||V===39?(e.consume(V),o=V,P):Ir(V)?(s=S,N(V)):Mn(V)?(e.consume(V),S):(e.consume(V),k)}function P(V){return V===o?(e.consume(V),o=void 0,L):V===null?r(V):Ir(V)?(s=P,N(V)):(e.consume(V),P)}function k(V){return V===null||V===34||V===39||V===60||V===61||V===96?r(V):V===47||V===62||Sa(V)?T(V):(e.consume(V),k)}function L(V){return V===47||V===62||Sa(V)?T(V):r(V)}function R(V){return V===62?(e.consume(V),e.exit("htmlTextData"),e.exit("htmlText"),t):r(V)}function N(V){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(V),e.exit("lineEnding"),F}function F(V){return Mn(V)?On(e,H,"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(V):H(V)}function H(V){return e.enter("htmlTextData"),s(V)}}var w1={name:"labelEnd",tokenize:jKe,resolveTo:HKe,resolveAll:zKe},VKe={tokenize:$Ke},GKe={tokenize:WKe},UKe={tokenize:qKe};function zKe(e){let t=-1;for(;++t<e.length;){let r=e[t][1];(r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd")&&(e.splice(t+1,r.type==="labelImage"?4:2),r.type="data",t++)}return e}function HKe(e,t){let r=e.length,n=0,o,i,s,a;for(;r--;)if(o=e[r][1],i){if(o.type==="link"||o.type==="labelLink"&&o._inactive)break;e[r][0]==="enter"&&o.type==="labelLink"&&(o._inactive=!0)}else if(s){if(e[r][0]==="enter"&&(o.type==="labelImage"||o.type==="labelLink")&&!o._balanced&&(i=r,o.type!=="labelLink")){n=2;break}}else o.type==="labelEnd"&&(s=r);let l={type:e[i][1].type==="labelLink"?"link":"image",start:Object.assign({},e[i][1].start),end:Object.assign({},e[e.length-1][1].end)},c={type:"label",start:Object.assign({},e[i][1].start),end:Object.assign({},e[s][1].end)},u={type:"labelText",start:Object.assign({},e[i+n+2][1].end),end:Object.assign({},e[s-2][1].start)};return a=[["enter",l,t],["enter",c,t]],a=yu(a,e.slice(i+1,i+n+3)),a=yu(a,[["enter",u,t]]),a=yu(a,VS(t.parser.constructs.insideSpan.null,e.slice(i+n+4,s-3),t)),a=yu(a,[["exit",u,t],e[s-2],e[s-1],["exit",c,t]]),a=yu(a,e.slice(s+1)),a=yu(a,[["exit",l,t]]),Oc(e,i,e.length,a),e}function jKe(e,t,r){let n=this,o=n.events.length,i,s;for(;o--;)if((n.events[o][1].type==="labelImage"||n.events[o][1].type==="labelLink")&&!n.events[o][1]._balanced){i=n.events[o][1];break}return a;function a(m){return i?i._inactive?d(m):(s=n.parser.defined.includes($g(n.sliceSerialize({start:i.end,end:n.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(m),e.exit("labelMarker"),e.exit("labelEnd"),l):r(m)}function l(m){return m===40?e.attempt(VKe,u,s?u:d)(m):m===91?e.attempt(GKe,u,s?c:d)(m):s?u(m):d(m)}function c(m){return e.attempt(UKe,u,d)(m)}function u(m){return t(m)}function d(m){return i._balanced=!0,r(m)}}function $Ke(e,t,r){return n;function n(d){return e.enter("resource"),e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),o}function o(d){return Sa(d)?A1(e,i)(d):i(d)}function i(d){return d===41?u(d):CR(e,s,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function s(d){return Sa(d)?A1(e,l)(d):u(d)}function a(d){return r(d)}function l(d){return d===34||d===39||d===40?IR(e,c,r,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):u(d)}function c(d){return Sa(d)?A1(e,u)(d):u(d)}function u(d){return d===41?(e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),e.exit("resource"),t):r(d)}}function WKe(e,t,r){let n=this;return o;function o(a){return SR.call(n,e,i,s,"reference","referenceMarker","referenceString")(a)}function i(a){return n.parser.defined.includes($g(n.sliceSerialize(n.events[n.events.length-1][1]).slice(1,-1)))?t(a):r(a)}function s(a){return r(a)}}function qKe(e,t,r){return n;function n(i){return e.enter("reference"),e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),o}function o(i){return i===93?(e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),e.exit("reference"),t):r(i)}}var r6={name:"labelStartImage",tokenize:ZKe,resolveAll:w1.resolveAll};function ZKe(e,t,r){let n=this;return o;function o(a){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(a),e.exit("labelImageMarker"),i}function i(a){return a===91?(e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelImage"),s):r(a)}function s(a){return a===94&&"_hiddenFootnoteSupport"in n.parser.constructs?r(a):t(a)}}var n6={name:"labelStartLink",tokenize:KKe,resolveAll:w1.resolveAll};function KKe(e,t,r){let n=this;return o;function o(s){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(s),e.exit("labelMarker"),e.exit("labelLink"),i}function i(s){return s===94&&"_hiddenFootnoteSupport"in n.parser.constructs?r(s):t(s)}}var b_={name:"lineEnding",tokenize:XKe};function XKe(e,t){return r;function r(n){return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),On(e,t,"linePrefix")}}var _1={name:"thematicBreak",tokenize:YKe};function YKe(e,t,r){let n=0,o;return i;function i(c){return e.enter("thematicBreak"),s(c)}function s(c){return o=c,a(c)}function a(c){return c===o?(e.enter("thematicBreakSequence"),l(c)):n>=3&&(c===null||Ir(c))?(e.exit("thematicBreak"),t(c)):r(c)}function l(c){return c===o?(e.consume(c),n++,l):(e.exit("thematicBreakSequence"),Mn(c)?On(e,a,"whitespace")(c):a(c))}}var Vc={name:"list",tokenize:eXe,continuation:{tokenize:tXe},exit:nXe},QKe={tokenize:oXe,partial:!0},JKe={tokenize:rXe,partial:!0};function eXe(e,t,r){let n=this,o=n.events[n.events.length-1],i=o&&o[1].type==="linePrefix"?o[2].sliceSerialize(o[1],!0).length:0,s=0;return a;function a(p){let h=n.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(h==="listUnordered"?!n.containerState.marker||p===n.containerState.marker:h_(p)){if(n.containerState.type||(n.containerState.type=h,e.enter(h,{_container:!0})),h==="listUnordered")return e.enter("listItemPrefix"),p===42||p===45?e.check(_1,r,c)(p):c(p);if(!n.interrupt||p===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),l(p)}return r(p)}function l(p){return h_(p)&&++s<10?(e.consume(p),l):(!n.interrupt||s<2)&&(n.containerState.marker?p===n.containerState.marker:p===41||p===46)?(e.exit("listItemValue"),c(p)):r(p)}function c(p){return e.enter("listItemMarker"),e.consume(p),e.exit("listItemMarker"),n.containerState.marker=n.containerState.marker||p,e.check(iv,n.interrupt?r:u,e.attempt(QKe,m,d))}function u(p){return n.containerState.initialBlankLine=!0,i++,m(p)}function d(p){return Mn(p)?(e.enter("listItemPrefixWhitespace"),e.consume(p),e.exit("listItemPrefixWhitespace"),m):r(p)}function m(p){return n.containerState.size=i+n.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(p)}}function tXe(e,t,r){let n=this;return n.containerState._closeFlow=void 0,e.check(iv,o,i);function o(a){return n.containerState.furtherBlankLines=n.containerState.furtherBlankLines||n.containerState.initialBlankLine,On(e,t,"listItemIndent",n.containerState.size+1)(a)}function i(a){return n.containerState.furtherBlankLines||!Mn(a)?(n.containerState.furtherBlankLines=void 0,n.containerState.initialBlankLine=void 0,s(a)):(n.containerState.furtherBlankLines=void 0,n.containerState.initialBlankLine=void 0,e.attempt(JKe,t,s)(a))}function s(a){return n.containerState._closeFlow=!0,n.interrupt=void 0,On(e,e.attempt(Vc,t,r),"linePrefix",n.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function rXe(e,t,r){let n=this;return On(e,o,"listItemIndent",n.containerState.size+1);function o(i){let s=n.events[n.events.length-1];return s&&s[1].type==="listItemIndent"&&s[2].sliceSerialize(s[1],!0).length===n.containerState.size?t(i):r(i)}}function nXe(e){e.exit(this.containerState.type)}function oXe(e,t,r){let n=this;return On(e,o,"listItemPrefixWhitespace",n.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function o(i){let s=n.events[n.events.length-1];return!Mn(i)&&s&&s[1].type==="listItemPrefixWhitespace"?t(i):r(i)}}var AR={name:"setextUnderline",tokenize:sXe,resolveTo:iXe};function iXe(e,t){let r=e.length,n,o,i;for(;r--;)if(e[r][0]==="enter"){if(e[r][1].type==="content"){n=r;break}e[r][1].type==="paragraph"&&(o=r)}else e[r][1].type==="content"&&e.splice(r,1),!i&&e[r][1].type==="definition"&&(i=r);let s={type:"setextHeading",start:Object.assign({},e[o][1].start),end:Object.assign({},e[e.length-1][1].end)};return e[o][1].type="setextHeadingText",i?(e.splice(o,0,["enter",s,t]),e.splice(i+1,0,["exit",e[n][1],t]),e[n][1].end=Object.assign({},e[i][1].end)):e[n][1]=s,e.push(["exit",s,t]),e}function sXe(e,t,r){let n=this,o;return i;function i(c){let u=n.events.length,d;for(;u--;)if(n.events[u][1].type!=="lineEnding"&&n.events[u][1].type!=="linePrefix"&&n.events[u][1].type!=="content"){d=n.events[u][1].type==="paragraph";break}return!n.parser.lazy[n.now().line]&&(n.interrupt||d)?(e.enter("setextHeadingLine"),o=c,s(c)):r(c)}function s(c){return e.enter("setextHeadingLineSequence"),a(c)}function a(c){return c===o?(e.consume(c),a):(e.exit("setextHeadingLineSequence"),Mn(c)?On(e,l,"lineSuffix")(c):l(c))}function l(c){return c===null||Ir(c)?(e.exit("setextHeadingLine"),t(c)):r(c)}}var R0e={tokenize:aXe};function aXe(e){let t=this,r=e.attempt(iv,n,e.attempt(this.parser.constructs.flowInitial,o,On(e,e.attempt(this.parser.constructs.flow,o,e.attempt(KH,o)),"linePrefix")));return r;function n(i){if(i===null){e.consume(i);return}return e.enter("lineEndingBlank"),e.consume(i),e.exit("lineEndingBlank"),t.currentConstruct=void 0,r}function o(i){if(i===null){e.consume(i);return}return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),t.currentConstruct=void 0,r}}var B0e={resolveAll:O0e()},L0e=F0e("string"),N0e=F0e("text");function F0e(e){return{tokenize:t,resolveAll:O0e(e==="text"?lXe:void 0)};function t(r){let n=this,o=this.parser.constructs[e],i=r.attempt(o,s,a);return s;function s(u){return c(u)?i(u):a(u)}function a(u){if(u===null){r.consume(u);return}return r.enter("data"),r.consume(u),l}function l(u){return c(u)?(r.exit("data"),i(u)):(r.consume(u),l)}function c(u){if(u===null)return!0;let d=o[u],m=-1;if(d)for(;++m<d.length;){let p=d[m];if(!p.previous||p.previous.call(n,n.previous))return!0}return!1}}}function O0e(e){return t;function t(r,n){let o=-1,i;for(;++o<=r.length;)i===void 0?r[o]&&r[o][1].type==="data"&&(i=o,o++):(!r[o]||r[o][1].type!=="data")&&(o!==i+2&&(r[i][1].end=r[o-1][1].end,r.splice(i+2,o-i-2),o=i+2),i=void 0);return e?e(r,n):r}}function lXe(e,t){let r=0;for(;++r<=e.length;)if((r===e.length||e[r][1].type==="lineEnding")&&e[r-1][1].type==="data"){let n=e[r-1][1],o=t.sliceStream(n),i=o.length,s=-1,a=0,l;for(;i--;){let c=o[i];if(typeof c=="string"){for(s=c.length;c.charCodeAt(s-1)===32;)a++,s--;if(s)break;s=-1}else if(c===-2)l=!0,a++;else if(c!==-1){i++;break}}if(a){let c={type:r===e.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{line:n.end.line,column:n.end.column-a,offset:n.end.offset-a,_index:n.start._index+i,_bufferIndex:i?s:n.start._bufferIndex+s},end:Object.assign({},n.end)};n.end=Object.assign({},c.start),n.start.offset===n.end.offset?Object.assign(n,c):(e.splice(r,0,["enter",c,t],["exit",c,t]),r+=2)}r++}return e}function V0e(e,t,r){let n=Object.assign(r?Object.assign({},r):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1}),o={},i=[],s=[],a=[],l=!0,c={consume:x,enter:A,exit:v,attempt:T(_),check:T(I),interrupt:T(I,{interrupt:!0})},u={previous:null,code:null,containerState:{},events:[],parser:e,sliceStream:f,sliceSerialize:h,now:C,defineSkip:g,write:p},d=t.tokenize.call(u,c),m;return t.resolveAll&&i.push(t),u;function p(P){return s=yu(s,P),b(),s[s.length-1]!==null?[]:(E(t,0),u.events=VS(i,u.events,u),u.events)}function h(P,k){return uXe(f(P),k)}function f(P){return cXe(s,P)}function C(){let{line:P,column:k,offset:L,_index:R,_bufferIndex:N}=n;return{line:P,column:k,offset:L,_index:R,_bufferIndex:N}}function g(P){o[P.line]=P.column,S()}function b(){let P;for(;n._index<s.length;){let k=s[n._index];if(typeof k=="string")for(P=n._index,n._bufferIndex<0&&(n._bufferIndex=0);n._index===P&&n._bufferIndex<k.length;)y(k.charCodeAt(n._bufferIndex));else y(k)}}function y(P){l=void 0,m=P,d=d(P)}function x(P){Ir(P)?(n.line++,n.column=1,n.offset+=P===-3?2:1,S()):P!==-1&&(n.column++,n.offset++),n._bufferIndex<0?n._index++:(n._bufferIndex++,n._bufferIndex===s[n._index].length&&(n._bufferIndex=-1,n._index++)),u.previous=P,l=!0}function A(P,k){let L=k||{};return L.type=P,L.start=C(),u.events.push(["enter",L,u]),a.push(L),L}function v(P){let k=a.pop();return k.end=C(),u.events.push(["exit",k,u]),k}function _(P,k){E(P,k.from)}function I(P,k){k.restore()}function T(P,k){return L;function L(R,N,F){let H,V,q,Q;return Array.isArray(R)?B(R):"tokenize"in R?B([R]):O(R);function O($){return Z;function Z(J){let ie=J!==null&&$[J],ne=J!==null&&$.null,le=[...Array.isArray(ie)?ie:ie?[ie]:[],...Array.isArray(ne)?ne:ne?[ne]:[]];return B(le)(J)}}function B($){return H=$,V=0,$.length===0?F:j($[V])}function j($){return Z;function Z(J){return Q=w(),q=$,$.partial||(u.currentConstruct=$),$.name&&u.parser.constructs.disable.null.includes($.name)?z(J):$.tokenize.call(k?Object.assign(Object.create(u),k):u,c,U,z)(J)}}function U($){return l=!0,P(q,Q),N}function z($){return l=!0,Q.restore(),++V<H.length?j(H[V]):F}}}function E(P,k){P.resolveAll&&!i.includes(P)&&i.push(P),P.resolve&&Oc(u.events,k,u.events.length-k,P.resolve(u.events.slice(k),u)),P.resolveTo&&(u.events=P.resolveTo(u.events,u))}function w(){let P=C(),k=u.previous,L=u.currentConstruct,R=u.events.length,N=Array.from(a);return{restore:F,from:R};function F(){n=P,u.previous=k,u.currentConstruct=L,u.events.length=R,a=N,S()}}function S(){n.line in o&&n.column<2&&(n.column=o[n.line],n.offset+=o[n.line]-1)}}function cXe(e,t){let r=t.start._index,n=t.start._bufferIndex,o=t.end._index,i=t.end._bufferIndex,s;if(r===o)s=[e[r].slice(n,i)];else{if(s=e.slice(r,o),n>-1){let a=s[0];typeof a=="string"?s[0]=a.slice(n):s.shift()}i>0&&s.push(e[o].slice(0,i))}return s}function uXe(e,t){let r=-1,n=[],o;for(;++r<e.length;){let i=e[r],s;if(typeof i=="string")s=i;else switch(i){case-5:{s="\r";break}case-4:{s=`
`;break}case-3:{s=`\r
`;break}case-2:{s=t?" ":"	";break}case-1:{if(!t&&o)continue;s=" ";break}default:s=String.fromCharCode(i)}o=i===-2,n.push(s)}return n.join("")}var o6={};Ui(o6,{attentionMarkers:()=>vXe,contentInitial:()=>mXe,disable:()=>bXe,document:()=>dXe,flow:()=>fXe,flowInitial:()=>pXe,insideSpan:()=>yXe,string:()=>hXe,text:()=>gXe});var dXe={42:Vc,43:Vc,45:Vc,48:Vc,49:Vc,50:Vc,51:Vc,52:Vc,53:Vc,54:Vc,55:Vc,56:Vc,57:Vc,62:hR},mXe={91:XH},pXe={[-2]:y_,[-1]:y_,32:y_},fXe={35:QH,42:_1,45:[AR,_1],60:e6,61:AR,95:_1,96:vR,126:vR},hXe={38:yR,92:gR},gXe={[-5]:b_,[-4]:b_,[-3]:b_,33:r6,38:yR,42:g_,60:[qH,t6],91:n6,92:[YH,gR],93:w1,95:g_,96:ZH},yXe={null:[g_,B0e]},vXe={null:[42,95]},bXe={null:[]};function i6(e){let r=C0e([o6,...(e||{}).extensions||[]]),n={defined:[],lazy:{},constructs:r,content:o(T0e),document:o(P0e),flow:o(R0e),string:o(L0e),text:o(N0e)};return n;function o(i){return s;function s(a){return V0e(n,i,a)}}}function s6(e){for(;!xR(e););return e}var G0e=/[\0\t\n\r]/g;function a6(){let e=1,t="",r=!0,n;return o;function o(i,s,a){let l=[],c,u,d,m,p;for(i=t+(typeof i=="string"?i.toString():new TextDecoder(s||void 0).decode(i)),d=0,t="",r&&(i.charCodeAt(0)===65279&&d++,r=void 0);d<i.length;){if(G0e.lastIndex=d,c=G0e.exec(i),m=c&&c.index!==void 0?c.index:i.length,p=i.charCodeAt(m),!c){t=i.slice(d);break}if(p===10&&d===m&&n)l.push(-3),n=void 0;else switch(n&&(l.push(-5),n=void 0),d<m&&(l.push(i.slice(d,m)),e+=m-d),p){case 0:{l.push(65533),e++;break}case 9:{for(u=Math.ceil(e/4)*4,l.push(-2);e++<u;)l.push(-1);break}case 10:{l.push(-4),e=1;break}default:n=!0,e=1}d=m+1}return a&&(n&&l.push(-5),t&&l.push(t),l.push(null)),l}}var xXe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function U0e(e){return e.replace(xXe,CXe)}function CXe(e,t,r){if(t)return t;if(r.charCodeAt(0)===35){let o=r.charCodeAt(1),i=o===120||o===88;return fR(r.slice(i?2:1),i?16:10)}return OS(r)||e}var H0e={}.hasOwnProperty;function l6(e,t,r){return typeof t!="string"&&(r=t,t=void 0),SXe(r)(s6(i6(r).document().write(a6()(e,t,!0))))}function SXe(e){let t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(K),autolinkProtocol:T,autolinkEmail:T,atxHeading:i(oe),blockQuote:i(J),characterEscape:T,characterReference:T,codeFenced:i(ie),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:i(ie,s),codeText:i(ne,s),codeTextData:T,data:T,codeFlowValue:T,definition:i(le),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:i(ee),hardBreakEscape:i(te),hardBreakTrailing:i(te),htmlFlow:i(X,s),htmlFlowData:T,htmlText:i(X,s),htmlTextData:T,image:i(W),label:s,link:i(K),listItem:i(se),listItemValue:m,listOrdered:i(re,d),listUnordered:i(re),paragraph:i(me),reference:O,referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:i(oe),strong:i(Y),thematicBreak:i(ve)},exit:{atxHeading:l(),atxHeadingSequence:A,autolink:l(),autolinkEmail:Z,autolinkProtocol:$,blockQuote:l(),characterEscapeValue:E,characterReferenceMarkerHexadecimal:j,characterReferenceMarkerNumeric:j,characterReferenceValue:U,characterReference:z,codeFenced:l(C),codeFencedFence:f,codeFencedFenceInfo:p,codeFencedFenceMeta:h,codeFlowValue:E,codeIndented:l(g),codeText:l(L),codeTextData:E,data:E,definition:l(),definitionDestinationString:x,definitionLabelString:b,definitionTitleString:y,emphasis:l(),hardBreakEscape:l(S),hardBreakTrailing:l(S),htmlFlow:l(P),htmlFlowData:E,htmlText:l(k),htmlTextData:E,image:l(N),label:H,labelText:F,lineEnding:w,link:l(R),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:B,resourceDestinationString:V,resourceTitleString:q,resource:Q,setextHeading:l(I),setextHeadingLineSequence:_,setextHeadingText:v,strong:l(),thematicBreak:l()}};j0e(t,(e||{}).mdastExtensions||[]);let r={};return n;function n(ge){let Se={type:"root",children:[]},Ee={stack:[Se],tokenStack:[],config:t,enter:a,exit:c,buffer:s,resume:u,data:r},Fe=[],Ae=-1;for(;++Ae<ge.length;)if(ge[Ae][1].type==="listOrdered"||ge[Ae][1].type==="listUnordered")if(ge[Ae][0]==="enter")Fe.push(Ae);else{let we=Fe.pop();Ae=o(ge,we,Ae)}for(Ae=-1;++Ae<ge.length;){let we=t[ge[Ae][0]];H0e.call(we,ge[Ae][1].type)&&we[ge[Ae][1].type].call(Object.assign({sliceSerialize:ge[Ae][2].sliceSerialize},Ee),ge[Ae][1])}if(Ee.tokenStack.length>0){let we=Ee.tokenStack[Ee.tokenStack.length-1];(we[1]||z0e).call(Ee,void 0,we[0])}for(Se.position={start:sv(ge.length>0?ge[0][1].start:{line:1,column:1,offset:0}),end:sv(ge.length>0?ge[ge.length-2][1].end:{line:1,column:1,offset:0})},Ae=-1;++Ae<t.transforms.length;)Se=t.transforms[Ae](Se)||Se;return Se}function o(ge,Se,Ee){let Fe=Se-1,Ae=-1,we=!1,_e,Ke,rt,pt;for(;++Fe<=Ee;){let Ne=ge[Fe];switch(Ne[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Ne[0]==="enter"?Ae++:Ae--,pt=void 0;break}case"lineEndingBlank":{Ne[0]==="enter"&&(_e&&!pt&&!Ae&&!rt&&(rt=Fe),pt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:pt=void 0}if(!Ae&&Ne[0]==="enter"&&Ne[1].type==="listItemPrefix"||Ae===-1&&Ne[0]==="exit"&&(Ne[1].type==="listUnordered"||Ne[1].type==="listOrdered")){if(_e){let je=Fe;for(Ke=void 0;je--;){let Ye=ge[je];if(Ye[1].type==="lineEnding"||Ye[1].type==="lineEndingBlank"){if(Ye[0]==="exit")continue;Ke&&(ge[Ke][1].type="lineEndingBlank",we=!0),Ye[1].type="lineEnding",Ke=je}else if(!(Ye[1].type==="linePrefix"||Ye[1].type==="blockQuotePrefix"||Ye[1].type==="blockQuotePrefixWhitespace"||Ye[1].type==="blockQuoteMarker"||Ye[1].type==="listItemIndent"))break}rt&&(!Ke||rt<Ke)&&(_e._spread=!0),_e.end=Object.assign({},Ke?ge[Ke][1].start:Ne[1].end),ge.splice(Ke||Fe,0,["exit",_e,Ne[2]]),Fe++,Ee++}if(Ne[1].type==="listItemPrefix"){let je={type:"listItem",_spread:!1,start:Object.assign({},Ne[1].start),end:void 0};_e=je,ge.splice(Fe,0,["enter",je,Ne[2]]),Fe++,Ee++,rt=void 0,pt=!0}}}return ge[Se][1]._spread=we,Ee}function i(ge,Se){return Ee;function Ee(Fe){a.call(this,ge(Fe),Fe),Se&&Se.call(this,Fe)}}function s(){this.stack.push({type:"fragment",children:[]})}function a(ge,Se,Ee){this.stack[this.stack.length-1].children.push(ge),this.stack.push(ge),this.tokenStack.push([Se,Ee]),ge.position={start:sv(Se.start),end:void 0}}function l(ge){return Se;function Se(Ee){ge&&ge.call(this,Ee),c.call(this,Ee)}}function c(ge,Se){let Ee=this.stack.pop(),Fe=this.tokenStack.pop();if(Fe)Fe[0].type!==ge.type&&(Se?Se.call(this,ge,Fe[0]):(Fe[1]||z0e).call(this,ge,Fe[0]));else throw new Error("Cannot close `"+ge.type+"` ("+nv({start:ge.start,end:ge.end})+"): it\u2019s not open");Ee.position.end=sv(ge.end)}function u(){return $H(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function m(ge){if(this.data.expectingFirstListItemValue){let Se=this.stack[this.stack.length-2];Se.start=Number.parseInt(this.sliceSerialize(ge),10),this.data.expectingFirstListItemValue=void 0}}function p(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.lang=ge}function h(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.meta=ge}function f(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function C(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.value=ge.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.value=ge.replace(/(\r?\n|\r)$/g,"")}function b(ge){let Se=this.resume(),Ee=this.stack[this.stack.length-1];Ee.label=Se,Ee.identifier=$g(this.sliceSerialize(ge)).toLowerCase()}function y(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.title=ge}function x(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.url=ge}function A(ge){let Se=this.stack[this.stack.length-1];if(!Se.depth){let Ee=this.sliceSerialize(ge).length;Se.depth=Ee}}function v(){this.data.setextHeadingSlurpLineEnding=!0}function _(ge){let Se=this.stack[this.stack.length-1];Se.depth=this.sliceSerialize(ge).codePointAt(0)===61?1:2}function I(){this.data.setextHeadingSlurpLineEnding=void 0}function T(ge){let Ee=this.stack[this.stack.length-1].children,Fe=Ee[Ee.length-1];(!Fe||Fe.type!=="text")&&(Fe=ae(),Fe.position={start:sv(ge.start),end:void 0},Ee.push(Fe)),this.stack.push(Fe)}function E(ge){let Se=this.stack.pop();Se.value+=this.sliceSerialize(ge),Se.position.end=sv(ge.end)}function w(ge){let Se=this.stack[this.stack.length-1];if(this.data.atHardBreak){let Ee=Se.children[Se.children.length-1];Ee.position.end=sv(ge.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(Se.type)&&(T.call(this,ge),E.call(this,ge))}function S(){this.data.atHardBreak=!0}function P(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.value=ge}function k(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.value=ge}function L(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.value=ge}function R(){let ge=this.stack[this.stack.length-1];if(this.data.inReference){let Se=this.data.referenceType||"shortcut";ge.type+="Reference",ge.referenceType=Se,delete ge.url,delete ge.title}else delete ge.identifier,delete ge.label;this.data.referenceType=void 0}function N(){let ge=this.stack[this.stack.length-1];if(this.data.inReference){let Se=this.data.referenceType||"shortcut";ge.type+="Reference",ge.referenceType=Se,delete ge.url,delete ge.title}else delete ge.identifier,delete ge.label;this.data.referenceType=void 0}function F(ge){let Se=this.sliceSerialize(ge),Ee=this.stack[this.stack.length-2];Ee.label=U0e(Se),Ee.identifier=$g(Se).toLowerCase()}function H(){let ge=this.stack[this.stack.length-1],Se=this.resume(),Ee=this.stack[this.stack.length-1];if(this.data.inReference=!0,Ee.type==="link"){let Fe=ge.children;Ee.children=Fe}else Ee.alt=Se}function V(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.url=ge}function q(){let ge=this.resume(),Se=this.stack[this.stack.length-1];Se.title=ge}function Q(){this.data.inReference=void 0}function O(){this.data.referenceType="collapsed"}function B(ge){let Se=this.resume(),Ee=this.stack[this.stack.length-1];Ee.label=Se,Ee.identifier=$g(this.sliceSerialize(ge)).toLowerCase(),this.data.referenceType="full"}function j(ge){this.data.characterReferenceType=ge.type}function U(ge){let Se=this.sliceSerialize(ge),Ee=this.data.characterReferenceType,Fe;Ee?(Fe=fR(Se,Ee==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Fe=OS(Se);let Ae=this.stack[this.stack.length-1];Ae.value+=Fe}function z(ge){let Se=this.stack.pop();Se.position.end=sv(ge.end)}function $(ge){E.call(this,ge);let Se=this.stack[this.stack.length-1];Se.url=this.sliceSerialize(ge)}function Z(ge){E.call(this,ge);let Se=this.stack[this.stack.length-1];Se.url="mailto:"+this.sliceSerialize(ge)}function J(){return{type:"blockquote",children:[]}}function ie(){return{type:"code",lang:null,meta:null,value:""}}function ne(){return{type:"inlineCode",value:""}}function le(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function ee(){return{type:"emphasis",children:[]}}function oe(){return{type:"heading",depth:0,children:[]}}function te(){return{type:"break"}}function X(){return{type:"html",value:""}}function W(){return{type:"image",title:null,url:"",alt:null}}function K(){return{type:"link",title:null,url:"",children:[]}}function re(ge){return{type:"list",ordered:ge.type==="listOrdered",start:null,spread:ge._spread,children:[]}}function se(ge){return{type:"listItem",spread:ge._spread,checked:null,children:[]}}function me(){return{type:"paragraph",children:[]}}function Y(){return{type:"strong",children:[]}}function ae(){return{type:"text",value:""}}function ve(){return{type:"thematicBreak"}}}function sv(e){return{line:e.line,column:e.column,offset:e.offset}}function j0e(e,t){let r=-1;for(;++r<t.length;){let n=t[r];Array.isArray(n)?j0e(e,n):IXe(e,n)}}function IXe(e,t){let r;for(r in t)if(H0e.call(t,r))switch(r){case"canContainEols":{let n=t[r];n&&e[r].push(...n);break}case"transforms":{let n=t[r];n&&e[r].push(...n);break}case"enter":case"exit":{let n=t[r];n&&Object.assign(e[r],n);break}}}function z0e(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+nv({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+nv({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+nv({start:t.start,end:t.end})+") is still open")}function wR(e){let t=this;t.parser=r;function r(n){return l6(n,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function $0e(e,t){let r={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,r),e.applyData(t,r)}function W0e(e,t){let r={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,r),[e.applyData(t,r),{type:"text",value:`
`}]}function q0e(e,t){let r=t.value?t.value+`
`:"",n={};t.lang&&(n.className=["language-"+t.lang]);let o={type:"element",tagName:"code",properties:n,children:[{type:"text",value:r}]};return t.meta&&(o.data={meta:t.meta}),e.patch(t,o),o=e.applyData(t,o),o={type:"element",tagName:"pre",properties:{},children:[o]},e.patch(t,o),o}function Z0e(e,t){let r={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function K0e(e,t){let r={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function X0e(e,t){let r=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=String(t.identifier).toUpperCase(),o=Hm(n.toLowerCase()),i=e.footnoteOrder.indexOf(n),s,a=e.footnoteCounts.get(n);a===void 0?(a=0,e.footnoteOrder.push(n),s=e.footnoteOrder.length):s=i+1,a+=1,e.footnoteCounts.set(n,a);let l={type:"element",tagName:"a",properties:{href:"#"+r+"fn-"+o,id:r+"fnref-"+o+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(s)}]};e.patch(t,l);let c={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,c),e.applyData(t,c)}function Y0e(e,t){let r={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function Q0e(e,t){if(e.options.allowDangerousHtml){let r={type:"raw",value:t.value};return e.patch(t,r),e.applyData(t,r)}}function _R(e,t){let r=t.referenceType,n="]";if(r==="collapsed"?n+="[]":r==="full"&&(n+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+n}];let o=e.all(t),i=o[0];i&&i.type==="text"?i.value="["+i.value:o.unshift({type:"text",value:"["});let s=o[o.length-1];return s&&s.type==="text"?s.value+=n:o.push({type:"text",value:n}),o}function J0e(e,t){let r=String(t.identifier).toUpperCase(),n=e.definitionById.get(r);if(!n)return _R(e,t);let o={src:Hm(n.url||""),alt:t.alt};n.title!==null&&n.title!==void 0&&(o.title=n.title);let i={type:"element",tagName:"img",properties:o,children:[]};return e.patch(t,i),e.applyData(t,i)}function eye(e,t){let r={src:Hm(t.url)};t.alt!==null&&t.alt!==void 0&&(r.alt=t.alt),t.title!==null&&t.title!==void 0&&(r.title=t.title);let n={type:"element",tagName:"img",properties:r,children:[]};return e.patch(t,n),e.applyData(t,n)}function tye(e,t){let r={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,r);let n={type:"element",tagName:"code",properties:{},children:[r]};return e.patch(t,n),e.applyData(t,n)}function rye(e,t){let r=String(t.identifier).toUpperCase(),n=e.definitionById.get(r);if(!n)return _R(e,t);let o={href:Hm(n.url||"")};n.title!==null&&n.title!==void 0&&(o.title=n.title);let i={type:"element",tagName:"a",properties:o,children:e.all(t)};return e.patch(t,i),e.applyData(t,i)}function nye(e,t){let r={href:Hm(t.url)};t.title!==null&&t.title!==void 0&&(r.title=t.title);let n={type:"element",tagName:"a",properties:r,children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function oye(e,t,r){let n=e.all(t),o=r?AXe(r):iye(t),i={},s=[];if(typeof t.checked=="boolean"){let u=n[0],d;u&&u.type==="element"&&u.tagName==="p"?d=u:(d={type:"element",tagName:"p",properties:{},children:[]},n.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let a=-1;for(;++a<n.length;){let u=n[a];(o||a!==0||u.type!=="element"||u.tagName!=="p")&&s.push({type:"text",value:`
`}),u.type==="element"&&u.tagName==="p"&&!o?s.push(...u.children):s.push(u)}let l=n[n.length-1];l&&(o||l.type!=="element"||l.tagName!=="p")&&s.push({type:"text",value:`
`});let c={type:"element",tagName:"li",properties:i,children:s};return e.patch(t,c),e.applyData(t,c)}function AXe(e){let t=!1;if(e.type==="list"){t=e.spread||!1;let r=e.children,n=-1;for(;!t&&++n<r.length;)t=iye(r[n])}return t}function iye(e){let t=e.spread;return t??e.children.length>1}function sye(e,t){let r={},n=e.all(t),o=-1;for(typeof t.start=="number"&&t.start!==1&&(r.start=t.start);++o<n.length;){let s=n[o];if(s.type==="element"&&s.tagName==="li"&&s.properties&&Array.isArray(s.properties.className)&&s.properties.className.includes("task-list-item")){r.className=["contains-task-list"];break}}let i={type:"element",tagName:t.ordered?"ol":"ul",properties:r,children:e.wrap(n,!0)};return e.patch(t,i),e.applyData(t,i)}function aye(e,t){let r={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function lye(e,t){let r={type:"root",children:e.wrap(e.all(t))};return e.patch(t,r),e.applyData(t,r)}function cye(e,t){let r={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function uye(e,t){let r=e.all(t),n=r.shift(),o=[];if(n){let s={type:"element",tagName:"thead",properties:{},children:e.wrap([n],!0)};e.patch(t.children[0],s),o.push(s)}if(r.length>0){let s={type:"element",tagName:"tbody",properties:{},children:e.wrap(r,!0)},a=FS(t.children[1]),l=pR(t.children[t.children.length-1]);a&&l&&(s.position={start:a,end:l}),o.push(s)}let i={type:"element",tagName:"table",properties:{},children:e.wrap(o,!0)};return e.patch(t,i),e.applyData(t,i)}function dye(e,t,r){let n=r?r.children:void 0,i=(n?n.indexOf(t):1)===0?"th":"td",s=r&&r.type==="table"?r.align:void 0,a=s?s.length:t.children.length,l=-1,c=[];for(;++l<a;){let d=t.children[l],m={},p=s?s[l]:void 0;p&&(m.align=p);let h={type:"element",tagName:i,properties:m,children:[]};d&&(h.children=e.all(d),e.patch(d,h),h=e.applyData(d,h)),c.push(h)}let u={type:"element",tagName:"tr",properties:{},children:e.wrap(c,!0)};return e.patch(t,u),e.applyData(t,u)}function mye(e,t){let r={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function fye(e){let t=String(e),r=/\r?\n|\r/g,n=r.exec(t),o=0,i=[];for(;n;)i.push(pye(t.slice(o,n.index),o>0,!0),n[0]),o=n.index+n[0].length,n=r.exec(t);return i.push(pye(t.slice(o),o>0,!1)),i.join("")}function pye(e,t,r){let n=0,o=e.length;if(t){let i=e.codePointAt(n);for(;i===9||i===32;)n++,i=e.codePointAt(n)}if(r){let i=e.codePointAt(o-1);for(;i===9||i===32;)o--,i=e.codePointAt(o-1)}return o>n?e.slice(n,o):""}function hye(e,t){let r={type:"text",value:fye(String(t.value))};return e.patch(t,r),e.applyData(t,r)}function gye(e,t){let r={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,r),e.applyData(t,r)}var yye={blockquote:$0e,break:W0e,code:q0e,delete:Z0e,emphasis:K0e,footnoteReference:X0e,heading:Y0e,html:Q0e,imageReference:J0e,image:eye,inlineCode:tye,linkReference:rye,link:nye,listItem:oye,list:sye,paragraph:aye,root:lye,strong:cye,table:uye,tableCell:mye,tableRow:dye,text:hye,thematicBreak:gye,toml:TR,yaml:TR,definition:TR,footnoteDefinition:TR};function TR(){}var vye=typeof self=="object"?self:globalThis,wXe=(e,t)=>{let r=(o,i)=>(e.set(i,o),o),n=o=>{if(e.has(o))return e.get(o);let[i,s]=t[o];switch(i){case 0:case-1:return r(s,o);case 1:{let a=r([],o);for(let l of s)a.push(n(l));return a}case 2:{let a=r({},o);for(let[l,c]of s)a[n(l)]=n(c);return a}case 3:return r(new Date(s),o);case 4:{let{source:a,flags:l}=s;return r(new RegExp(a,l),o)}case 5:{let a=r(new Map,o);for(let[l,c]of s)a.set(n(l),n(c));return a}case 6:{let a=r(new Set,o);for(let l of s)a.add(n(l));return a}case 7:{let{name:a,message:l}=s;return r(new vye[a](l),o)}case 8:return r(BigInt(s),o);case"BigInt":return r(Object(BigInt(s)),o)}return r(new vye[i](s),o)};return n},m6=e=>wXe(new Map,e)(0);var GS="",{toString:_Xe}={},{keys:TXe}=Object,I_=e=>{let t=typeof e;if(t!=="object"||!e)return[0,t];let r=_Xe.call(e).slice(8,-1);switch(r){case"Array":return[1,GS];case"Object":return[2,GS];case"Date":return[3,GS];case"RegExp":return[4,GS];case"Map":return[5,GS];case"Set":return[6,GS]}return r.includes("Array")?[1,r]:r.includes("Error")?[7,r]:[2,r]},MR=([e,t])=>e===0&&(t==="function"||t==="symbol"),EXe=(e,t,r,n)=>{let o=(s,a)=>{let l=n.push(s)-1;return r.set(a,l),l},i=s=>{if(r.has(s))return r.get(s);let[a,l]=I_(s);switch(a){case 0:{let u=s;switch(l){case"bigint":a=8,u=s.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+l);u=null;break;case"undefined":return o([-1],s)}return o([a,u],s)}case 1:{if(l)return o([l,[...s]],s);let u=[],d=o([a,u],s);for(let m of s)u.push(i(m));return d}case 2:{if(l)switch(l){case"BigInt":return o([l,s.toString()],s);case"Boolean":case"Number":case"String":return o([l,s.valueOf()],s)}if(t&&"toJSON"in s)return i(s.toJSON());let u=[],d=o([a,u],s);for(let m of TXe(s))(e||!MR(I_(s[m])))&&u.push([i(m),i(s[m])]);return d}case 3:return o([a,s.toISOString()],s);case 4:{let{source:u,flags:d}=s;return o([a,{source:u,flags:d}],s)}case 5:{let u=[],d=o([a,u],s);for(let[m,p]of s)(e||!(MR(I_(m))||MR(I_(p))))&&u.push([i(m),i(p)]);return d}case 6:{let u=[],d=o([a,u],s);for(let m of s)(e||!MR(I_(m)))&&u.push(i(m));return d}}let{message:c}=s;return o([a,{name:l,message:c}],s)};return i},p6=(e,{json:t,lossy:r}={})=>{let n=[];return EXe(!(t||r),!!t,new Map,n)(e),n};var US=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?m6(p6(e,t)):structuredClone(e):(e,t)=>m6(p6(e,t));function PXe(e,t){let r=[{type:"text",value:"\u21A9"}];return t>1&&r.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),r}function DXe(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function bye(e){let t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=e.options.footnoteBackContent||PXe,n=e.options.footnoteBackLabel||DXe,o=e.options.footnoteLabel||"Footnotes",i=e.options.footnoteLabelTagName||"h2",s=e.options.footnoteLabelProperties||{className:["sr-only"]},a=[],l=-1;for(;++l<e.footnoteOrder.length;){let c=e.footnoteById.get(e.footnoteOrder[l]);if(!c)continue;let u=e.all(c),d=String(c.identifier).toUpperCase(),m=Hm(d.toLowerCase()),p=0,h=[],f=e.footnoteCounts.get(d);for(;f!==void 0&&++p<=f;){h.length>0&&h.push({type:"text",value:" "});let b=typeof r=="string"?r:r(l,p);typeof b=="string"&&(b={type:"text",value:b}),h.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+m+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof n=="string"?n:n(l,p),className:["data-footnote-backref"]},children:Array.isArray(b)?b:[b]})}let C=u[u.length-1];if(C&&C.type==="element"&&C.tagName==="p"){let b=C.children[C.children.length-1];b&&b.type==="text"?b.value+=" ":C.children.push({type:"text",value:" "}),C.children.push(...h)}else u.push(...h);let g={type:"element",tagName:"li",properties:{id:t+"fn-"+m},children:e.wrap(u,!0)};e.patch(c,g),a.push(g)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...US(s),id:"footnote-label"},children:[{type:"text",value:o}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(a,!0)},{type:"text",value:`
`}]}}var RR=function(e){if(e==null)return BXe;if(typeof e=="function")return BR(e);if(typeof e=="object")return Array.isArray(e)?kXe(e):MXe(e);if(typeof e=="string")return RXe(e);throw new Error("Expected function, string, or object as test")};function kXe(e){let t=[],r=-1;for(;++r<e.length;)t[r]=RR(e[r]);return BR(n);function n(...o){let i=-1;for(;++i<t.length;)if(t[i].apply(this,o))return!0;return!1}}function MXe(e){let t=e;return BR(r);function r(n){let o=n,i;for(i in e)if(o[i]!==t[i])return!1;return!0}}function RXe(e){return BR(t);function t(r){return r&&r.type===e}}function BR(e){return t;function t(r,n,o){return!!(LXe(r)&&e.call(this,r,typeof n=="number"?n:void 0,o||void 0))}}function BXe(){return!0}function LXe(e){return e!==null&&typeof e=="object"&&"type"in e}var xye=[],f6=!0,LR=!1,h6="skip";function g6(e,t,r,n){let o;typeof t=="function"&&typeof r!="function"?(n=r,r=t):o=t;let i=RR(o),s=n?-1:1;a(e,void 0,[])();function a(l,c,u){let d=l&&typeof l=="object"?l:{};if(typeof d.type=="string"){let p=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(m,"name",{value:"node ("+(l.type+(p?"<"+p+">":""))+")"})}return m;function m(){let p=xye,h,f,C;if((!t||i(l,c,u[u.length-1]||void 0))&&(p=NXe(r(l,u)),p[0]===LR))return p;if("children"in l&&l.children){let g=l;if(g.children&&p[0]!==h6)for(f=(n?g.children.length:-1)+s,C=u.concat(g);f>-1&&f<g.children.length;){let b=g.children[f];if(h=a(b,f,C)(),h[0]===LR)return h;f=typeof h[1]=="number"?h[1]:f+s}}return p}}}function NXe(e){return Array.isArray(e)?e:typeof e=="number"?[f6,e]:e==null?xye:[e]}function A_(e,t,r,n){let o,i,s;typeof t=="function"&&typeof r!="function"?(i=void 0,s=t,o=r):(i=t,s=r,o=n),g6(e,i,a,o);function a(l,c){let u=c[c.length-1],d=u?u.children.indexOf(l):void 0;return s(l,d,u)}}var y6={}.hasOwnProperty,FXe={};function Sye(e,t){let r=t||FXe,n=new Map,o=new Map,i=new Map,s={...yye,...r.handlers},a={all:c,applyData:VXe,definitionById:n,footnoteById:o,footnoteCounts:i,footnoteOrder:[],handlers:s,one:l,options:r,patch:OXe,wrap:UXe};return A_(e,function(u){if(u.type==="definition"||u.type==="footnoteDefinition"){let d=u.type==="definition"?n:o,m=String(u.identifier).toUpperCase();d.has(m)||d.set(m,u)}}),a;function l(u,d){let m=u.type,p=a.handlers[m];if(y6.call(a.handlers,m)&&p)return p(a,u,d);if(a.options.passThrough&&a.options.passThrough.includes(m)){if("children"in u){let{children:f,...C}=u,g=US(C);return g.children=a.all(u),g}return US(u)}return(a.options.unknownHandler||GXe)(a,u,d)}function c(u){let d=[];if("children"in u){let m=u.children,p=-1;for(;++p<m.length;){let h=a.one(m[p],u);if(h){if(p&&m[p-1].type==="break"&&(!Array.isArray(h)&&h.type==="text"&&(h.value=Cye(h.value)),!Array.isArray(h)&&h.type==="element")){let f=h.children[0];f&&f.type==="text"&&(f.value=Cye(f.value))}Array.isArray(h)?d.push(...h):d.push(h)}}}return d}}function OXe(e,t){e.position&&(t.position=VH(e))}function VXe(e,t){let r=t;if(e&&e.data){let n=e.data.hName,o=e.data.hChildren,i=e.data.hProperties;if(typeof n=="string")if(r.type==="element")r.tagName=n;else{let s="children"in r?r.children:[r];r={type:"element",tagName:n,properties:{},children:s}}r.type==="element"&&i&&Object.assign(r.properties,US(i)),"children"in r&&r.children&&o!==null&&o!==void 0&&(r.children=o)}return r}function GXe(e,t){let r=t.data||{},n="value"in t&&!(y6.call(r,"hProperties")||y6.call(r,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function UXe(e,t){let r=[],n=-1;for(t&&r.push({type:"text",value:`
`});++n<e.length;)n&&r.push({type:"text",value:`
`}),r.push(e[n]);return t&&e.length>0&&r.push({type:"text",value:`
`}),r}function Cye(e){let t=0,r=e.charCodeAt(t);for(;r===9||r===32;)t++,r=e.charCodeAt(t);return e.slice(t)}function NR(e,t){let r=Sye(e,t),n=r.one(e,void 0),o=bye(r),i=Array.isArray(n)?{type:"root",children:n}:n||{type:"root",children:[]};return o&&("children"in i,i.children.push({type:"text",value:`
`},o)),i}function FR(e,t){return e&&"run"in e?async function(r,n){let o=NR(r,{file:n,...t});await e.run(o,n)}:function(r,n){return NR(r,{file:n,...t||e})}}function v6(e){if(e)throw e}var GR=ar(kye(),1);function w_(e){if(typeof e!="object"||e===null)return!1;let t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function b6(){let e=[],t={run:r,use:n};return t;function r(...o){let i=-1,s=o.pop();if(typeof s!="function")throw new TypeError("Expected function as last argument, not "+s);a(null,...o);function a(l,...c){let u=e[++i],d=-1;if(l){s(l);return}for(;++d<o.length;)(c[d]===null||c[d]===void 0)&&(c[d]=o[d]);o=c,u?Mye(u,a)(...c):s(null,...c)}}function n(o){if(typeof o!="function")throw new TypeError("Expected `middelware` to be a function, not "+o);return e.push(o),t}}function Mye(e,t){let r;return n;function n(...s){let a=e.length>s.length,l;a&&s.push(o);try{l=e.apply(this,s)}catch(c){let u=c;if(a&&r)throw u;return o(u)}a||(l&&l.then&&typeof l.then=="function"?l.then(i,o):l instanceof Error?o(l):i(l))}function o(s,...a){r||(r=!0,t(s,...a))}function i(s){o(null,s)}}var af={basename:zXe,dirname:HXe,extname:jXe,join:$Xe,sep:"/"};function zXe(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');__(e);let r=0,n=-1,o=e.length,i;if(t===void 0||t.length===0||t.length>e.length){for(;o--;)if(e.codePointAt(o)===47){if(i){r=o+1;break}}else n<0&&(i=!0,n=o+1);return n<0?"":e.slice(r,n)}if(t===e)return"";let s=-1,a=t.length-1;for(;o--;)if(e.codePointAt(o)===47){if(i){r=o+1;break}}else s<0&&(i=!0,s=o+1),a>-1&&(e.codePointAt(o)===t.codePointAt(a--)?a<0&&(n=o):(a=-1,n=s));return r===n?n=s:n<0&&(n=e.length),e.slice(r,n)}function HXe(e){if(__(e),e.length===0)return".";let t=-1,r=e.length,n;for(;--r;)if(e.codePointAt(r)===47){if(n){t=r;break}}else n||(n=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function jXe(e){__(e);let t=e.length,r=-1,n=0,o=-1,i=0,s;for(;t--;){let a=e.codePointAt(t);if(a===47){if(s){n=t+1;break}continue}r<0&&(s=!0,r=t+1),a===46?o<0?o=t:i!==1&&(i=1):o>-1&&(i=-1)}return o<0||r<0||i===0||i===1&&o===r-1&&o===n+1?"":e.slice(o,r)}function $Xe(...e){let t=-1,r;for(;++t<e.length;)__(e[t]),e[t]&&(r=r===void 0?e[t]:r+"/"+e[t]);return r===void 0?".":WXe(r)}function WXe(e){__(e);let t=e.codePointAt(0)===47,r=qXe(e,!t);return r.length===0&&!t&&(r="."),r.length>0&&e.codePointAt(e.length-1)===47&&(r+="/"),t?"/"+r:r}function qXe(e,t){let r="",n=0,o=-1,i=0,s=-1,a,l;for(;++s<=e.length;){if(s<e.length)a=e.codePointAt(s);else{if(a===47)break;a=47}if(a===47){if(!(o===s-1||i===1))if(o!==s-1&&i===2){if(r.length<2||n!==2||r.codePointAt(r.length-1)!==46||r.codePointAt(r.length-2)!==46){if(r.length>2){if(l=r.lastIndexOf("/"),l!==r.length-1){l<0?(r="",n=0):(r=r.slice(0,l),n=r.length-1-r.lastIndexOf("/")),o=s,i=0;continue}}else if(r.length>0){r="",n=0,o=s,i=0;continue}}t&&(r=r.length>0?r+"/..":"..",n=2)}else r.length>0?r+="/"+e.slice(o+1,s):r=e.slice(o+1,s),n=s-o-1;o=s,i=0}else a===46&&i>-1?i++:i=-1}return r}function __(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}var Rye={cwd:ZXe};function ZXe(){return"/"}function zS(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function Bye(e){if(typeof e=="string")e=new URL(e);else if(!zS(e)){let t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){let t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return KXe(e)}function KXe(e){if(e.hostname!==""){let n=new TypeError('File URL host must be "localhost" or empty on darwin');throw n.code="ERR_INVALID_FILE_URL_HOST",n}let t=e.pathname,r=-1;for(;++r<t.length;)if(t.codePointAt(r)===37&&t.codePointAt(r+1)===50){let n=t.codePointAt(r+2);if(n===70||n===102){let o=new TypeError("File URL path must not include encoded / characters");throw o.code="ERR_INVALID_FILE_URL_PATH",o}}return decodeURIComponent(t)}var x6=["history","path","basename","stem","extname","dirname"],T1=class{constructor(t){let r;t?zS(t)?r={path:t}:typeof t=="string"||XXe(t)?r={value:t}:r=t:r={},this.cwd=Rye.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n=-1;for(;++n<x6.length;){let i=x6[n];i in r&&r[i]!==void 0&&r[i]!==null&&(this[i]=i==="history"?[...r[i]]:r[i])}let o;for(o in r)x6.includes(o)||(this[o]=r[o])}get basename(){return typeof this.path=="string"?af.basename(this.path):void 0}set basename(t){S6(t,"basename"),C6(t,"basename"),this.path=af.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?af.dirname(this.path):void 0}set dirname(t){Lye(this.basename,"dirname"),this.path=af.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?af.extname(this.path):void 0}set extname(t){if(C6(t,"extname"),Lye(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=af.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){zS(t)&&(t=Bye(t)),S6(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?af.basename(this.path,this.extname):void 0}set stem(t){S6(t,"stem"),C6(t,"stem"),this.path=af.join(this.dirname||"",t+(this.extname||""))}fail(t,r,n){let o=this.message(t,r,n);throw o.fatal=!0,o}info(t,r,n){let o=this.message(t,r,n);return o.fatal=void 0,o}message(t,r,n){let o=new Ca(t,r,n);return this.path&&(o.name=this.path+":"+o.name,o.file=this.path),o.fatal=!1,this.messages.push(o),o}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}};function C6(e,t){if(e&&e.includes(af.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+af.sep+"`")}function S6(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function Lye(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function XXe(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}var Nye=function(e){let n=this.constructor.prototype,o=n[e],i=function(){return o.apply(i,arguments)};Object.setPrototypeOf(i,n);let s=Object.getOwnPropertyNames(o);for(let a of s){let l=Object.getOwnPropertyDescriptor(o,a);l&&Object.defineProperty(i,a,l)}return i};var YXe={}.hasOwnProperty,_6=class e extends Nye{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=b6()}copy(){let t=new e,r=-1;for(;++r<this.attachers.length;){let n=this.attachers[r];t.use(...n)}return t.data((0,GR.default)(!0,{},this.namespace)),t}data(t,r){return typeof t=="string"?arguments.length===2?(w6("data",this.frozen),this.namespace[t]=r,this):YXe.call(this.namespace,t)&&this.namespace[t]||void 0:t?(w6("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;let t=this;for(;++this.freezeIndex<this.attachers.length;){let[r,...n]=this.attachers[this.freezeIndex];if(n[0]===!1)continue;n[0]===!0&&(n[0]=void 0);let o=r.call(t,...n);typeof o=="function"&&this.transformers.use(o)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();let r=VR(t),n=this.parser||this.Parser;return I6("parse",n),n(String(r),r)}process(t,r){let n=this;return this.freeze(),I6("process",this.parser||this.Parser),A6("process",this.compiler||this.Compiler),r?o(void 0,r):new Promise(o);function o(i,s){let a=VR(t),l=n.parse(a);n.run(l,a,function(u,d,m){if(u||!d||!m)return c(u);let p=d,h=n.stringify(p,m);JXe(h)?m.value=h:m.result=h,c(u,m)});function c(u,d){u||!d?s(u):i?i(d):r(void 0,d)}}}processSync(t){let r=!1,n;return this.freeze(),I6("processSync",this.parser||this.Parser),A6("processSync",this.compiler||this.Compiler),this.process(t,o),Oye("processSync","process",r),n;function o(i,s){r=!0,v6(i),n=s}}run(t,r,n){Fye(t),this.freeze();let o=this.transformers;return!n&&typeof r=="function"&&(n=r,r=void 0),n?i(void 0,n):new Promise(i);function i(s,a){let l=VR(r);o.run(t,l,c);function c(u,d,m){let p=d||t;u?a(u):s?s(p):n(void 0,p,m)}}}runSync(t,r){let n=!1,o;return this.run(t,r,i),Oye("runSync","run",n),o;function i(s,a){v6(s),o=a,n=!0}}stringify(t,r){this.freeze();let n=VR(r),o=this.compiler||this.Compiler;return A6("stringify",o),Fye(t),o(t,n)}use(t,...r){let n=this.attachers,o=this.namespace;if(w6("use",this.frozen),t!=null)if(typeof t=="function")l(t,r);else if(typeof t=="object")Array.isArray(t)?a(t):s(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function i(c){if(typeof c=="function")l(c,[]);else if(typeof c=="object")if(Array.isArray(c)){let[u,...d]=c;l(u,d)}else s(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function s(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(c.plugins),c.settings&&(o.settings=(0,GR.default)(!0,o.settings,c.settings))}function a(c){let u=-1;if(c!=null)if(Array.isArray(c))for(;++u<c.length;){let d=c[u];i(d)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function l(c,u){let d=-1,m=-1;for(;++d<n.length;)if(n[d][0]===c){m=d;break}if(m===-1)n.push([c,...u]);else if(u.length>0){let[p,...h]=u,f=n[m][1];w_(f)&&w_(p)&&(p=(0,GR.default)(!0,f,p)),n[m]=[c,p,...h]}}}},T6=new _6().freeze();function I6(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function A6(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function w6(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Fye(e){if(!w_(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function Oye(e,t,r){if(!r)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function VR(e){return QXe(e)?e:new T1(e)}function QXe(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function JXe(e){return typeof e=="string"||eYe(e)}function eYe(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}var tYe="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Vye=[],Gye={allowDangerousHtml:!0},rYe=/^(https?|ircs?|mailto|xmpp)$/i,nYe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function jS(e){let t=e.allowedElements,r=e.allowElement,n=e.children||"",o=e.className,i=e.components,s=e.disallowedElements,a=e.rehypePlugins||Vye,l=e.remarkPlugins||Vye,c=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...Gye}:Gye,u=e.skipHtml,d=e.unwrapDisallowed,m=e.urlTransform||Uye,p=T6().use(wR).use(l).use(FR,c).use(a),h=new T1;typeof n=="string"?h.value=n:(""+n,void 0),t&&s&&void 0;for(let b of nYe)Object.hasOwn(e,b.from)&&(""+b.from+(b.to?"use `"+b.to+"` instead":"remove it")+tYe+b.id,void 0);let f=p.parse(h),C=p.runSync(f,h);return o&&(C={type:"element",tagName:"div",properties:{className:o},children:C.type==="root"?C.children:[C]}),A_(C,g),zH(C,{Fragment:HS.Fragment,components:i,ignoreInvalidStyle:!0,jsx:HS.jsx,jsxs:HS.jsxs,passKeys:!0,passNode:!0});function g(b,y,x){if(b.type==="raw"&&x&&typeof y=="number")return u?x.children.splice(y,1):x.children[y]={type:"text",value:b.value},y;if(b.type==="element"){let A;for(A in p_)if(Object.hasOwn(p_,A)&&Object.hasOwn(b.properties,A)){let v=b.properties[A],_=p_[A];(_===null||_.includes(b.tagName))&&(b.properties[A]=m(String(v||""),A,b))}}if(b.type==="element"){let A=t?!t.includes(b.tagName):s?s.includes(b.tagName):!1;if(!A&&r&&typeof y=="number"&&(A=!r(b,y,x)),A&&x&&typeof y=="number")return d&&b.children?x.children.splice(y,1,...b.children):x.children.splice(y,1),y}}}function Uye(e){let t=e.indexOf(":"),r=e.indexOf("?"),n=e.indexOf("#"),o=e.indexOf("/");return t<0||o>-1&&t>o||r>-1&&t>r||n>-1&&t>n||rYe.test(e.slice(0,t))?e:""}var E6={};Ui(E6,{AddTrajectory:()=>bYe,DownloadStructure:()=>pYe,EnableModelCustomProps:()=>yYe,EnableStructureCustomProps:()=>vYe,LoadTrajectory:()=>xYe,PdbDownloadProvider:()=>jye,UpdateTrajectory:()=>T_});var oYe=["gz","zip"];function Wg(e){let t=e,r="",n=t.lastIndexOf("?"),o=n!==-1?t.substring(n):"";t=t.substring(0,n===-1?t.length:n);let i=t.replace(/^.*[\\/]/,""),s=i.substring(0,i.lastIndexOf(".")),a=i.split("."),l=a.length>1?(a.pop()||"").toLowerCase():"",c=t.match(/^(.+):\/\/(.+)$/);c&&(r=c[1].toLowerCase(),t=c[2]||"");let u=t.substring(0,t.lastIndexOf("/")+1);if(oYe.includes(l)){let d=t.length-l.length-1;l=(t.substr(0,d).split(".").pop()||"").toLowerCase();let m=s.length-l.length-1;s=s.substr(0,m)}return{path:t,name:i,ext:l,base:s,dir:u,protocol:r,query:o}}var $S="Topology";var iYe={label:"PSF",description:"PSF",category:$S,stringExtensions:["psf"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Je.Data.ParsePsf,{},{state:{isGhost:!0}}),n=r.apply(Je.Model.TopologyFromPsf);return await r.commit(),{format:r.selector,topology:n.selector}}};var sYe={label:"PRMTOP",description:"PRMTOP",category:$S,stringExtensions:["prmtop","parm7"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Je.Data.ParsePrmtop,{},{state:{isGhost:!0}}),n=r.apply(Je.Model.TopologyFromPrmtop);return await r.commit(),{format:r.selector,topology:n.selector}}};var aYe={label:"TOP",description:"TOP",category:$S,stringExtensions:["top"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Je.Data.ParseTop,{},{state:{isGhost:!0}}),n=r.apply(Je.Model.TopologyFromTop);return await r.commit(),{format:r.selector,topology:n.selector}}},zye=[["psf",iYe],["prmtop",sYe],["top",aYe]];var E1="Coordinates";var lYe={label:"DCD",description:"DCD",category:E1,binaryExtensions:["dcd"],parse:(e,t)=>e.state.data.build().to(t).apply(Je.Model.CoordinatesFromDcd).commit()};var cYe={label:"XTC",description:"XTC",category:E1,binaryExtensions:["xtc"],parse:(e,t)=>e.state.data.build().to(t).apply(Je.Model.CoordinatesFromXtc).commit()};var uYe={label:"TRR",description:"TRR",category:E1,binaryExtensions:["trr"],parse:(e,t)=>e.state.data.build().to(t).apply(Je.Model.CoordinatesFromTrr).commit()};var dYe={label:"NCTRAJ",description:"NCTRAJ",category:E1,binaryExtensions:["nc","nctraj"],parse:(e,t)=>e.state.data.build().to(t).apply(Je.Model.CoordinatesFromNctraj).commit()},Hye=[["dcd",lYe],["xtc",cYe],["trr",uYe],["nctraj",dYe]];var mYe=e=>{let t=e.config.get(Ot.Structure.DefaultRepresentationPreset)||ds.auto.id;return M.Group({type:Xf.getParams(void 0,"auto").type,representation:M.Select(t,e.builders.structure.representation.getPresets().map(r=>[r.id,r.display.name,r.display.group]),{description:"Which representation preset to use."}),representationParams:M.Group(Go.CommonParams,{isHidden:!0}),asTrajectory:M.Optional(M.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})},jye={rcsb:M.Group({encoding:M.Select("bcif",M.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:M.Group({variant:M.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:M.EmptyGroup({label:"PDBj"})};var pYe=ki.build({from:fe.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:(e,t)=>{let r=mYe(t),n=t.config.get(Ot.Download.DefaultPdbProvider)||"pdbe";return{source:M.MappedStatic("pdb",{pdb:M.Group({provider:M.Group({id:M.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:M.MappedStatic(n,jye)},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB"}),"pdb-dev":M.Group({provider:M.Group({id:M.Text("PDBDEV_00000001",{label:"PDB-Dev Id(s)",description:"One or more comma/space separated ids."}),encoding:M.Select("bcif",M.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:r},{isFlat:!0,label:"PDB-Dev"}),swissmodel:M.Group({id:M.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:M.Group({id:M.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:M.Group({id:M.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:r},{isFlat:!0,label:"Model Archive"}),pubchem:M.Group({id:M.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:r},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:M.Group({url:M.Url(""),format:M.Select("mmcif",M.arrayToOptions(lk.map(o=>o[0]),o=>o)),isBinary:M.Boolean(!1),label:M.Optional(M.Text("")),options:r},{isFlat:!0,label:"URL"})})}}})(({params:e,state:t},r)=>ke.create("Download Structure",async n=>{r.behaviors.layout.leftPanelTabName.next("data");let o=e.source,i,s=!1,a="mmcif";switch(o.name){case"url":i=[{url:o.params.url,isBinary:o.params.isBinary,label:o.params.label||void 0}],a=o.params.format;break;case"pdb":i=await(o.params.provider.server.name==="pdbe"?fYe(o):o.params.provider.server.name==="pdbj"?hYe(o):o.params.provider.server.name==="rcsb"?gYe(o):Sr(o)),s=!!o.params.options.asTrajectory;break;case"pdb-dev":i=await lf(o.params.provider.id,d=>{let m=d.toUpperCase().startsWith("PDBDEV_")?d:`PDBDEV_${d.padStart(8,"0")}`;return o.params.provider.encoding==="bcif"?`https://pdb-dev.wwpdb.org/bcif/${m.toUpperCase()}.bcif`:`https://pdb-dev.wwpdb.org/cif/${m.toUpperCase()}.cif`},d=>d.toUpperCase().startsWith("PDBDEV_")?d:`PDBDEV_${d.padStart(8,"0")}`,o.params.provider.encoding==="bcif"),s=!!o.params.options.asTrajectory;break;case"swissmodel":i=await lf(o.params.id,d=>`https://swissmodel.expasy.org/repository/uniprot/${d.toUpperCase()}.pdb`,d=>`SWISS-MODEL: ${d}`,!1),s=!!o.params.options.asTrajectory,a="pdb";break;case"alphafolddb":i=await lf(o.params.id,async d=>{let m=`https://www.alphafold.ebi.ac.uk/api/prediction/${d.toUpperCase()}`,p=await r.runTask(r.fetch({url:m,type:"json"}));if(Array.isArray(p)&&p.length>0)return p[0].cifUrl;throw new Error(`No AlphaFold DB entry for '${d}'`)},d=>`AlphaFold DB: ${d}`,!1),s=!!o.params.options.asTrajectory,a="mmcif";break;case"modelarchive":i=await lf(o.params.id,d=>`https://www.modelarchive.org/doi/10.5452/${d.toLowerCase()}.cif`,d=>`Model Archive: ${d}`,!1),s=!!o.params.options.asTrajectory,a="mmcif";break;case"pubchem":i=await lf(o.params.id,d=>`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/${d.trim()}/record/SDF/?record_type=3d`,d=>`PubChem: ${d}`,!1),s=!!o.params.options.asTrajectory,a="mol";break;default:Sr(o)}let l=e.source.params.options.representation||r.config.get(Ot.Structure.DefaultRepresentationPreset)||ds.auto.id,c=l!==ds.empty.id,u=o.params.options.type.name==="auto"?void 0:o.params.options.type;await t.transaction(async()=>{if(i.length>0&&s){let d=await r.builders.data.downloadBlob({sources:i.map((p,h)=>({id:""+h,url:p.url,isBinary:p.isBinary})),maxConcurrency:6},{state:{isGhost:!0}}),m=await r.builders.structure.parseTrajectory(d,{formats:i.map((p,h)=>({id:""+h,format:"cif"}))});await r.builders.structure.hierarchy.applyPreset(m,"default",{structure:u,showUnitcell:c,representationPreset:l,representationPresetParams:e.source.params.options.representationParams})}else for(let d of i){let m=await r.builders.data.download(d,{state:{isGhost:!0}}),p=r.dataFormats.get(a);if(!p)throw new Error("unknown file format");let h=await r.builders.structure.parseTrajectory(m,p);await r.builders.structure.hierarchy.applyPreset(h,"default",{structure:u,showUnitcell:c,representationPreset:l,representationPresetParams:e.source.params.options.representationParams})}}).runInContext(n)}));async function lf(e,t,r,n){let o=e.split(/[,\s]/).map(s=>s.trim()).filter(s=>!!s&&(s.length>=4||/^[1-9][0-9]*$/.test(s))),i=[];for(let s of o)i.push({url:Nr.Url(await t(s)),isBinary:n,label:r(s)});return i}async function fYe(e){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbe")throw new Error("expected pdbe");return e.params.provider.server.params.variant==="updated"?lf(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/static/entry/${t.toLowerCase()}_updated.cif`,t=>`PDBe: ${t} (updated cif)`,!1):e.params.provider.server.params.variant==="updated-bcif"?lf(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/entry-files/download/${t.toLowerCase()}.bcif`,t=>`PDBe: ${t} (updated cif)`,!0):lf(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/static/entry/${t.toLowerCase()}.cif`,t=>`PDBe: ${t} (cif)`,!1)}async function hYe(e){if(e.name!=="pdb"||e.params.provider.server.name!=="pdbj")throw new Error("expected pdbj");return lf(e.params.provider.id,t=>`https://data.pdbjbk1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/${t.toLowerCase().substring(1,3)}/${t.toLowerCase()}.cif`,t=>`PDBj: ${t} (cif)`,!1)}async function gYe(e){if(e.name!=="pdb"||e.params.provider.server.name!=="rcsb")throw new Error("expected rcsb");return e.params.provider.server.params.encoding==="cif"?lf(e.params.provider.id,t=>`https://files.rcsb.org/download/${t.toUpperCase()}.cif`,t=>`RCSB PDB: ${t} (cif)`,!1):lf(e.params.provider.id,t=>`https://models.rcsb.org/${t.toUpperCase()}.bcif`,t=>`RCSB PDB: ${t} (bcif)`,!0)}var T_=ki.build({display:{name:"Update Trajectory"},params:{action:M.Select("advance",M.arrayToOptions(["advance","reset"])),by:M.Optional(M.Numeric(1,{min:-1,max:1,step:1}))}})(({params:e,state:t})=>{let r=t.selectQ(o=>o.ofTransformer(Je.Model.ModelFromTrajectory)),n=t.build();if(e.action==="reset")for(let o of r)n.to(o).update({modelIndex:0});else for(let o of r){let i=Kt.findAncestorOfType(t.tree,t.cells,o.transform.ref,fe.Molecule.Trajectory);if(!i||!i.obj)continue;let s=i.obj;n.to(o).update(a=>{let l=(a.modelIndex+e.by)%s.data.frameCount;return l<0&&(l+=s.data.frameCount),{modelIndex:l}})}return t.updateTree(n)}),yYe=ki.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:fe.Molecule.Model,params(e,t){return t.customModelProperties.getParams(e?.data)},isApplicable(e,t,r){return t.transformer!==dU}})(({ref:e,params:t},r)=>r.builders.structure.insertModelProperties(e,t)),vYe=ki.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:fe.Molecule.Structure,params(e,t){return t.customStructureProperties.getParams(e?.data)},isApplicable(e,t,r){return t.transformer!==mU}})(({ref:e,params:t},r)=>r.builders.structure.insertStructureProperties(e,t)),bYe=ki.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:fe.Root,params(e,t){let r=t.state.data,o=[...r.selectQ(a=>a.rootsOfType(fe.Molecule.Model)),...r.selectQ(a=>a.rootsOfType(fe.Molecule.Topology))].map(a=>[a.transform.ref,a.obj.label]),s=r.selectQ(a=>a.rootsOfType(fe.Molecule.Coordinates)).map(a=>[a.transform.ref,a.obj.label]);return{model:M.Select(o.length?o[0][0]:"",o),coordinates:M.Select(s.length?s[0][0]:"",s)}}})(({params:e,state:t},r)=>ke.create("Add Trajectory",n=>t.transaction(async()=>{let o=[e.model,e.coordinates],i=t.build().toRoot().apply(LD,{modelRef:e.model,coordinatesRef:e.coordinates},{dependsOn:o}).apply(Je.Model.ModelFromTrajectory,{modelIndex:0});await t.updateTree(i).runInContext(n);let s=await r.builders.structure.createStructure(i.selector);await r.builders.structure.representation.applyPreset(s,"auto")}).runInContext(n))),xYe=ki.build({display:{name:"Load Trajectory",description:"Load trajectory of model/topology and coordinates from URL or file."},from:fe.Root,params(e,t){let{options:r}=t.dataFormats,n=r.filter(a=>a[2]===Ku||a[2]===$S),o=r.filter(a=>a[2]===E1),i=[],s=[];for(let{provider:a}of t.dataFormats.list)a.category===Ku||a.category===$S?(a.binaryExtensions&&i.push(...a.binaryExtensions),a.stringExtensions&&i.push(...a.stringExtensions)):a.category===E1&&(a.binaryExtensions&&s.push(...a.binaryExtensions),a.stringExtensions&&s.push(...a.stringExtensions));return{source:M.MappedStatic("file",{url:M.Group({model:M.Group({url:M.Url(""),format:M.Select(n[0][0],n),isBinary:M.Boolean(!1)},{isExpanded:!0}),coordinates:M.Group({url:M.Url(""),format:M.Select(o[0][0],o)},{isExpanded:!0})},{isFlat:!0}),file:M.Group({model:M.File({accept:i.map(a=>`.${a}`).join(","),label:"Model"}),coordinates:M.File({accept:s.map(a=>`.${a}`).join(","),label:"Coordinates"})},{isFlat:!0})},{options:[["url","URL"],["file","File"]]})}}})(({params:e,state:t},r)=>ke.create("Load Trajectory",n=>t.transaction(async()=>{let o=e.source;if(o.name==="file"&&(o.params.model===null||o.params.coordinates===null)){r.log.error("No file(s) selected");return}if(o.name==="url"&&(!o.params.model||!o.params.coordinates)){r.log.error("No URL(s) given");return}let i=async(a,l,c)=>{let u=await r.builders.data.download({url:a,isBinary:c}),d=r.dataFormats.get(l);if(!d){r.log.warn(`LoadTrajectory: could not find data provider for '${l}'`);return}return d.parse(r,u)},s=async a=>{var l,c,u;if(!a)throw new Error("No file selected");let d=Wg((c=(l=a.file)===null||l===void 0?void 0:l.name)!==null&&c!==void 0?c:""),m=r.dataFormats.binaryExtensions.has(d.ext),{data:p}=await r.builders.data.readFile({file:a,isBinary:m}),h=r.dataFormats.auto(d,(u=p.cell)===null||u===void 0?void 0:u.obj);if(!h){r.log.warn(`LoadTrajectory: could not find data provider for '${d.ext}'`),await r.state.data.build().delete(p).commit();return}return h.parse(r,p)};try{let a=o.name==="url"?await i(o.params.model.url,o.params.model.format,o.params.model.isBinary):await s(o.params.model),l;"trajectory"in a?l=await t.build().to(a.trajectory).apply(uU,{modelIndex:0}).commit():l=a.topology;let c=o.name==="url"?await i(o.params.coordinates.url,o.params.coordinates.format,!0):await s(o.params.coordinates),u=[l.ref,c.ref],d=t.build().toRoot().apply(LD,{modelRef:l.ref,coordinatesRef:c.ref},{dependsOn:u}).apply(Je.Model.ModelFromTrajectory,{modelIndex:0});await t.updateTree(d).runInContext(n);let m=await r.builders.structure.createStructure(d.selector);await r.builders.structure.representation.applyPreset(m,"auto")}catch{r.log.error("Error loading trajectory")}}).runInContext(n)));var qg=ar(un());var zR=class extends yr{constructor(){super(...arguments),this.updateParams=t=>{this.plugin.managers.animation.updateParams({[t.name]:t.value})},this.updateCurrentParams=t=>{this.plugin.managers.animation.updateCurrentParams({[t.name]:t.value})},this.startOrStop=()=>{let t=this.plugin.managers.animation;t.state.animationState==="playing"?t.stop():(this.props.onStart&&this.props.onStart(),t.start())}}componentDidMount(){this.subscribe(this.plugin.managers.animation.events.updated,()=>this.forceUpdate())}render(){var t,r;let n=this.plugin.managers.animation;if(n.isEmpty)return null;let o=n.state.animationState==="playing",i=(r=(t=n.current.anim).canApply)===null||r===void 0?void 0:r.call(t,this.plugin);return(0,qg.jsxs)(qg.Fragment,{children:[(0,qg.jsx)(An,{params:n.getParams(),values:n.state.params,onChange:this.updateParams,isDisabled:o}),(0,qg.jsx)(An,{params:n.current.params,values:n.current.paramValues,onChange:this.updateCurrentParams,isDisabled:o}),(0,qg.jsx)("div",{className:"msp-flex-row",children:(0,qg.jsx)(or,{icon:n.state.animationState!=="playing"?void 0:ZM,onClick:this.startOrStop,disabled:i!==void 0&&i.canApply===!1,children:n.state.animationState==="playing"?"Stop":i===void 0||i.canApply?"Start":i.reason||"Start"})})]})}};var rn=ar(un());var Wye="overpaint-controls";async function P6(e,t,r,n,o){await CYe(e,t,async(i,s,a)=>{if(o&&o.length>0&&!o.includes(s.params.values.type.name))return;let l=s.obj.data.sourceData,c=await n(l.root);if(Xt.isEmpty(c)||wi(c))return;let u={bundle:ce.Bundle.fromLoci(c),color:r===-1?ze(0):r,clear:r===-1};if(a){let d=[...a.params.values.layers,u],m=$ye(d,l);i.to(a).update(Gs.toBundle(m))}else{let d=$ye([u],l);i.to(s.transform.ref).apply(Je.Representation.OverpaintStructureRepresentation3DFromBundle,Gs.toBundle(d),{tags:Wye})}})}async function CYe(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let s of i.representations){let a=n.select(Kt.Generators.ofTransformer(Je.Representation.OverpaintStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(Wye));await r(o,s.cell,a[0])}return o.commit({doNotUpdateCurrent:!0})}function $ye(e,t){let r=Gs.ofBundle(e,t.root),n=Gs.merge(r);return Gs.filter(n,t)}var Zye="clipping-controls";async function Kye(e,t,r,n,o){await SYe(e,t,async(i,s,a)=>{if(o&&o.length>0&&!o.includes(s.params.values.type.name))return;let l=s.obj.data.sourceData,c=await n(l.root);if(Xt.isEmpty(c)||wi(c))return;let u={bundle:ce.Bundle.fromLoci(c),groups:r};if(a){let d=[...a.params.values.layers,u],m=qye(d,l);i.to(a).update(io.toBundle(m))}else{let d=qye([u],l);i.to(s.transform.ref).apply(Je.Representation.ClippingStructureRepresentation3DFromBundle,io.toBundle(d),{tags:Zye})}})}async function SYe(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let s of i.representations){let a=n.select(Kt.Generators.ofTransformer(Je.Representation.ClippingStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(Zye));await r(o,s.cell,a[0])}return o.commit({doNotUpdateCurrent:!0})}function qye(e,t){let r=io.ofBundle(e,t.root),n=io.merge(r);return io.filter(n,t)}var Yye="transparency-controls";async function Qye(e,t,r,n,o){await IYe(e,t,async(i,s,a)=>{if(o&&o.length>0&&!o.includes(s.params.values.type.name))return;let l=s.obj.data.sourceData,c=await n(l.root);if(Xt.isEmpty(c)||wi(c))return;let u={bundle:ce.Bundle.fromLoci(c),value:r};if(a){let d=[...a.params.values.layers,u],m=Xye(d,l);i.to(a).update(Us.toBundle(m))}else{let d=Xye([u],l);i.to(s.transform.ref).apply(Je.Representation.TransparencyStructureRepresentation3DFromBundle,Us.toBundle(d),{tags:Yye})}})}async function IYe(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let s of i.representations){let a=n.select(Kt.Generators.ofTransformer(Je.Representation.TransparencyStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(Yye));await r(o,s.cell,a[0])}return o.commit({doNotUpdateCurrent:!0})}function Xye(e,t){let r=Us.ofBundle(e,t.root),n=Us.merge(r);return Us.filter(n,t)}var eve="substance-controls";async function D6(e,t,r,n,o){await AYe(e,t,async(i,s,a)=>{if(o&&o.length>0&&!o.includes(s.params.values.type.name))return;let l=s.obj.data.sourceData,c=await n(l.root);if(Xt.isEmpty(c)||wi(c))return;let u={bundle:ce.Bundle.fromLoci(c),material:r??Bs(),clear:!r};if(a){let d=[...a.params.values.layers,u],m=Jye(d,l);i.to(a).update(zs.toBundle(m))}else{let d=Jye([u],l);i.to(s.transform.ref).apply(Je.Representation.SubstanceStructureRepresentation3DFromBundle,zs.toBundle(d),{tags:eve})}})}async function AYe(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let s of i.representations){let a=n.select(Kt.Generators.ofTransformer(Je.Representation.SubstanceStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(eve));await r(o,s.cell,a[0])}return o.commit({doNotUpdateCurrent:!0})}function Jye(e,t){let r=zs.ofBundle(e,t.root),n=zs.merge(r);return zs.filter(n,t)}var rve="emissive-controls";async function nve(e,t,r,n,o){await wYe(e,t,async(i,s,a)=>{if(o&&o.length>0&&!o.includes(s.params.values.type.name))return;let l=s.obj.data.sourceData,c=await n(l.root);if(Xt.isEmpty(c)||wi(c))return;let u={bundle:ce.Bundle.fromLoci(c),value:r};if(a){let d=[...a.params.values.layers,u],m=tve(d,l);i.to(a).update(Hs.toBundle(m))}else{let d=tve([u],l);i.to(s.transform.ref).apply(Je.Representation.EmissiveStructureRepresentation3DFromBundle,Hs.toBundle(d),{tags:rve})}})}async function wYe(e,t,r){let n=e.state.data,o=n.build();for(let i of t)for(let s of i.representations){let a=n.select(Kt.Generators.ofTransformer(Je.Representation.EmissiveStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(rve));await r(o,s.cell,a[0])}return o.commit({doNotUpdateCurrent:!0})}function tve(e,t){let r=Hs.ofBundle(e,t.root),n=Hs.merge(r);return Hs.filter(n,t)}var od=class e extends Na{get currentStructures(){return this.plugin.managers.structure.hierarchy.selection.structures}get pivotStructure(){return this.currentStructures[0]}_setSnapshotState(t){this.updateState({options:t}),this.events.optionsUpdated.next(void 0)}async setOptions(t){let r=t.interactions!==this.state.options.interactions;this.updateState({options:t}),this.events.optionsUpdated.next(void 0);let n=this.dataState.build();for(let o of this.currentStructures)for(let i of o.components)this.updateReprParams(n,i);return this.plugin.dataTransaction(async()=>{await n.commit(),await this.plugin.state.updateBehavior(c1,o=>{o.ignoreHydrogens=t.hydrogens!=="all",o.ignoreHydrogensVariant=t.hydrogens==="only-polar"?"non-polar":"all",o.ignoreLight=t.ignoreLight,o.material=t.materialStyle,o.clip=t.clipObjects}),r&&await this.updateInterationProps()})}updateReprParams(t,r){let{hydrogens:n,visualQuality:o,ignoreLight:i,materialStyle:s,clipObjects:a}=this.state.options,l=n!=="all",c=n==="only-polar"?"non-polar":"all";for(let u of r.representations){if(u.cell.transform.transformer!==eS)continue;let d=u.cell.transform.params;(!!d.type.params.ignoreHydrogens!==l||d.type.params.ignoreHydrogensVariant!==c||d.type.params.quality!==o||d.type.params.ignoreLight!==i||!zh(d.type.params.material,s)||!M.areEqual(Lp.Params,d.type.params.clip,a))&&t.to(u.cell).update(m=>{m.type.params.ignoreHydrogens=l,m.type.params.ignoreHydrogensVariant=c,m.type.params.quality=o,m.type.params.ignoreLight=i,m.type.params.material=s,m.type.params.clip=a})}}async updateInterationProps(){var t,r,n;for(let o of this.currentStructures){let i=li.getParams((t=o.cell.obj)===null||t===void 0?void 0:t.data);if(o.properties){let s=(r=o.properties.cell.transform.params)===null||r===void 0?void 0:r.properties[li.descriptor.name];if(M.areEqual(i,s,this.state.options.interactions))continue;await this.dataState.build().to(o.properties.cell).update(a=>{a.properties[li.descriptor.name]=this.state.options.interactions}).commit()}else{let s=this.plugin.customStructureProperties.getParams((n=o.cell.obj)===null||n===void 0?void 0:n.data),a=M.getDefaultValues(s);if(M.areEqual(i,a.properties[li.descriptor.name],this.state.options.interactions))continue;a.properties[li.descriptor.name]=this.state.options.interactions,await this.plugin.builders.structure.insertStructureProperties(o.cell,a)}}}applyPreset(t,r,n){return this.plugin.dataTransaction(async()=>{for(let o of t){let i=await this.plugin.builders.structure.representation.applyPreset(o.cell,r,n);await this.syncPreset(o,i)}},{canUndo:"Preset"})}syncPreset(t,r){if(!r||!r.components)return this.clearComponents([t]);let n=new Set;if(Ao(r.components,a=>{a&&n.add(a.ref)}),r.representations&&Ao(r.representations,a=>{a&&n.add(a.ref)}),n.size===0)return this.clearComponents([t]);let o=!1,i=this.dataState.build(),s=a=>{n.has(a.cell.transform.ref)||(o=!0,i.delete(a.cell))};for(let a of t.components){s(a);for(let l of a.representations)s(l);if(a.genericRepresentations)for(let l of a.genericRepresentations)s(l)}if(t.genericRepresentations)for(let a of t.genericRepresentations)s(a);if(o)return i.commit()}clear(t){return this.clearComponents(t)}selectThis(t){var r;let n=this.plugin.managers.structure.selection;n.clear();for(let o of t){let i=qe.toSubStructureElementLoci(o.structure.cell.obj.data,(r=o.cell.obj)===null||r===void 0?void 0:r.data);n.fromLoci("set",i)}}canBeModified(t){return this.plugin.builders.structure.isComponentTransform(t.cell)}modifyByCurrentSelection(t,r){return this.plugin.runTask(ke.create("Modify Component",async n=>{let o=this.dataState.build();for(let i of t){if(!this.canBeModified(i))continue;let s=this.plugin.managers.structure.selection.getStructure(i.structure.cell.obj.data);!s||s.elementCount===0||this.modifyComponent(o,i,s,r)}await this.dataState.updateTree(o,{canUndo:"Modify Selection"}).runInContext(n)}))}toggleVisibility(t,r){if(t.length!==0)if(r){let n=t[0].representations.indexOf(r),o=!r.cell.state.isHidden;for(let i of t){let s=i.representations[n];s&&vo(this.dataState,s.cell.transform.ref,o)}}else{let n=!t[0].cell.state.isHidden;for(let o of t)vo(this.dataState,o.cell.transform.ref,n)}}removeRepresentations(t,r){if(t.length===0)return;let n=[];if(r){let o=t[0].representations.indexOf(r);if(o<0)return;for(let i of t)i.representations[o]&&n.push(i.representations[o])}else for(let o of t)for(let i of o.representations)n.push(i);return this.plugin.managers.structure.hierarchy.remove(n,!0)}updateRepresentations(t,r,n){if(t.length===0)return Promise.resolve();let o=t[0].representations.indexOf(r);if(o<0)return Promise.resolve();let i=this.dataState.build();for(let s of t){let a=s.representations[o];a&&a.cell.transform.transformer===r.cell.transform.transformer&&i.to(a.cell).update(n)}return i.commit({canUndo:"Update Representation"})}updateRepresentationsTheme(t,r){var n,o,i,s;if(t.length===0)return;let a=this.dataState.build();for(let l of t)for(let c of l.representations){let u=c.cell.transform.params,d=typeof r=="function"?r(l,c):r,m=d.color==="default"?Bw(this.plugin,(n=l.structure.cell.obj)===null||n===void 0?void 0:n.data,u?.type.name):d.color?Bw(this.plugin,(o=l.structure.cell.obj)===null||o===void 0?void 0:o.data,u?.type.name,d.color,d.colorParams):void 0,p=d.size==="default"?gz(this.plugin,(i=l.structure.cell.obj)===null||i===void 0?void 0:i.data,u?.type.name):d.color?gz(this.plugin,(s=l.structure.cell.obj)===null||s===void 0?void 0:s.data,u?.type.name,d.size,d.sizeParams):void 0;(m||p)&&a.to(c.cell).update(h=>{m&&(h.colorTheme=m),p&&(h.sizeTheme=p)})}return a.commit({canUndo:"Update Theme"})}addRepresentation(t,r){if(t.length===0)return;let{hydrogens:n,visualQuality:o,ignoreLight:i,materialStyle:s,clipObjects:a}=this.state.options,u={ignoreHydrogens:n!=="all",ignoreHydrogensVariant:n==="only-polar"?"non-polar":"all",quality:o,ignoreLight:i,material:s,clip:a};return this.plugin.dataTransaction(async()=>{for(let d of t)await this.plugin.builders.structure.representation.addRepresentation(d.cell,{type:this.plugin.representation.structure.registry.get(r),typeParams:u})},{canUndo:"Add Representation"})}tryFindComponent(t,r){if(t.components.length!==0)return this.plugin.runTask(ke.create("Find Component",async n=>{var o,i;let s=(o=t.cell.obj)===null||o===void 0?void 0:o.data;if(!s)return;let a=wt.unionStructure(await r.getSelection(this.plugin,n,s));for(let l of t.components){let c=(i=l.cell.obj)===null||i===void 0?void 0:i.data;if(!(!c||!l.cell.parent)&&Ioe(a,c))return l.cell}}))}async add(t,r){return this.plugin.dataTransaction(async()=>{let n=r||this.currentStructures;if(n.length===0)return;let{hydrogens:o,visualQuality:i,ignoreLight:s,materialStyle:a,clipObjects:l}=this.state.options,d={ignoreHydrogens:o!=="all",ignoreHydrogensVariant:o==="only-polar"?"non-polar":"all",quality:i,ignoreLight:s,material:a,clip:l},m=jr.create22();for(let p of n){let h;t.options.checkExisting&&(h=await this.tryFindComponent(p,t.selection)),h||(h=await this.plugin.builders.structure.tryCreateComponentFromSelection(p.cell,t.selection,m,{label:t.options.label||(t.selection===Ai.current?"Custom Selection":"")})),!(t.representation==="none"||!h)&&await this.plugin.builders.structure.representation.addRepresentation(h,{type:this.plugin.representation.structure.registry.get(t.representation),typeParams:d})}},{canUndo:"Add Selection"})}async applyTheme(t,r){return this.plugin.dataTransaction(async n=>{let o=r||this.currentStructures;if(o.length===0)return;let i=async s=>wt.toLociWithSourceUnits(await t.selection.getSelection(this.plugin,n,s));for(let s of o)if(t.action.name==="color"){let a=t.action.params;await P6(this.plugin,s.components,a.color,i,t.representations)}else if(t.action.name==="resetColor")await P6(this.plugin,s.components,-1,i,t.representations);else if(t.action.name==="transparency"){let a=t.action.params;await Qye(this.plugin,s.components,a.value,i,t.representations)}else if(t.action.name==="emissive"){let a=t.action.params;await nve(this.plugin,s.components,a.value,i,t.representations)}else if(t.action.name==="material"){let a=t.action.params;await D6(this.plugin,s.components,a.material,i,t.representations)}else if(t.action.name==="resetMaterial")await D6(this.plugin,s.components,void 0,i,t.representations);else if(t.action.name==="clipping"){let a=t.action.params;await Kye(this.plugin,s.components,io.Groups.fromNames(a.excludeGroups),i,t.representations)}},{canUndo:"Apply Theme"})}modifyComponent(t,r,n,o){var i,s,a;let l=(i=r.cell.obj)===null||i===void 0?void 0:i.data;if(!l||(o==="subtract"||o==="intersect")&&!IC(l,n))return;let c=(s=r.structure.cell.obj)===null||s===void 0?void 0:s.data,u=o==="union"?Cg(c,[l,n]):o==="intersect"?rD(l,n):AC(l,n);if(u.elementCount===0)t.delete(r.cell.transform.ref);else{let m={type:{name:"bundle",params:ce.Bundle.fromSubStructure(c,u)},nullIfEmpty:!0,label:(a=r.cell.obj)===null||a===void 0?void 0:a.label};t.to(r.cell).update(m)}}updateLabel(t,r){var n,o;let i={type:(n=t.cell.params)===null||n===void 0?void 0:n.values.type,nullIfEmpty:(o=t.cell.params)===null||o===void 0?void 0:o.values.nullIfEmpty,label:r};this.dataState.build().to(t.cell).update(i).commit()}get dataState(){return this.plugin.state.data}clearComponents(t){let r=this.dataState.build();for(let n of t)for(let o of n.components)r.delete(o.cell.transform.ref);return r.commit({canUndo:"Clear Selections"})}constructor(t){super({options:M.getDefaultValues(e.OptionsParams)}),this.plugin=t,this.events={optionsUpdated:this.ev()}}};(function(e){e.OptionsParams={hydrogens:M.Select("all",[["all","Show All"],["hide-all","Hide All"],["only-polar","Only Polar"]],{description:"Determine display of hydrogen atoms in representations"}),visualQuality:M.Select("auto",ag,{description:"Control the visual/rendering quality of representations"}),ignoreLight:M.Boolean(!1,{description:"Ignore light for stylized rendering of representations"}),materialStyle:Bs.getParam(),clipObjects:M.Group(Lp.Params),interactions:M.Group(li.defaultParams,{label:"Non-covalent Interactions"})};function t(i,s){let{options:a}=i.query.structure.registry;return s={pivot:i.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1,...s},{selection:M.Select(a[1][0],a,{isHidden:s?.hideSelection}),representation:o(i,s?.pivot,s?.allowNone?[["none","< Create Later >"]]:[]),options:M.Group({label:M.Text(""),checkExisting:M.Boolean(!!s?.checkExisting,{help:()=>({description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."})})})}}e.getAddParams=t;function r(i,s){let{options:a}=i.query.structure.registry;return{selection:M.Select(a[1][0],a,{isHidden:!1}),action:M.MappedStatic("color",{color:M.Group({color:M.Color(Gt.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:M.EmptyGroup({label:"Reset Color"}),transparency:M.Group({value:M.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),emissive:M.Group({value:M.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:M.Group({material:Bs.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:M.EmptyGroup({label:"Reset Material"}),clipping:M.Group({excludeGroups:M.MultiSelect([],M.objectToOptions(io.Groups.Names))},{isFlat:!0})}),representations:M.MultiSelect([],n(i,s),{emptyValue:"All"})}}e.getThemeParams=r;function n(i,s){var a,l;return!((a=s?.cell.obj)===null||a===void 0)&&a.data?i.representation.structure.registry.getApplicableTypes((l=s.cell.obj)===null||l===void 0?void 0:l.data):i.representation.structure.registry.types}e.getRepresentationTypes=n;function o(i,s,a,l){let c=[...a,...n(i,s)];return M.Select(c[0][0],c,{label:l})}})(od||(od={}));var WS;(function(e){function t(s,a){return{key:s,data:a}}function r(s){return{entries:S2(),capacity:Math.max(1,s)}}e.create=r;function n(s,a){for(let l=s.entries.first;l;l=l.next)if(l.value.key===a)return s.entries.remove(l),s.entries.addLast(l.value),l.value.data}e.get=n;function o(s,a,l){let c;if(s.entries.count>=s.capacity){let u=s.entries.first;c=u.value.data,s.entries.remove(u)}return s.entries.addLast(t(a,l)),c}e.set=o;function i(s,a){for(let l=s.entries.first;l;l=l.next)if(l.value.key===a){s.entries.remove(l);break}}e.remove=i})(WS||(WS={}));var HR=class{constructor(t=!1){this.isRunning=!1,this.queue=[],this.counter=0,this.log=t}enqueue(t){this.log,this.queue[0]={id:this.counter,func:t},this.counter++,this.run()}async run(){if(this.isRunning)return;let t=this.queue.pop();if(t){this.isRunning=!0;try{this.log,await t.func(),this.log}finally{this.isRunning=!1,this.run()}}}};var sa=class extends fe.CreateBehavior({name:"Volume Streaming"}){};(function(e){e.RootTag="volume-streaming-info";function t(l,c,u,d,m={}){var p,h,f,C;return M.Group({isoValue:ot.createIsoValueParam((p=m.isoValue)!==null&&p!==void 0?p:u,d),color:M.Color((h=m.color)!==null&&h!==void 0?h:c),wireframe:M.Boolean((f=m.wireframe)!==null&&f!==void 0?f:!1),opacity:M.Numeric((C=m.opacity)!==null&&C!==void 0?C:.3,{min:0,max:1,step:.01})},{label:l,isExpanded:!0})}let r={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function n(l={}){let{data:c,defaultView:u,channelParams:d}=l,m=new Map;c&&c.entries.forEach(f=>m.set(f.dataId,f));let p=c?c.entries.map(f=>[f.dataId,f.dataId]):[],h=c?c.entries[0].dataId:"";return{entry:M.Mapped(h,p,f=>M.Group(o({entryData:m.get(f),defaultView:u,structure:c&&c.structure,channelParams:d})))}}e.createParams=n;function o(l){let{entryData:c,defaultView:u,structure:d,channelParams:m={}}=l,p=c||{kind:"em",header:{sampling:[r],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:ot.IsoValue.relative(0)},h=d&&d.boundary.box||xt();return{view:M.MappedStatic(u||(p.kind==="em"?"auto":"selection-box"),{off:M.Group({}),box:M.Group({bottomLeft:M.Vec3(h.min),topRight:M.Vec3(h.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":M.Group({radius:M.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),bottomLeft:M.Vec3(D.create(0,0,0),{},{isHidden:!0}),topRight:M.Vec3(D.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),"camera-target":M.Group({radius:M.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),dynamicDetailLevel:i(p.header.availablePrecisions,0,{label:"Dynamic Detail"}),bottomLeft:M.Vec3(D.create(0,0,0),{},{isHidden:!0}),topRight:M.Vec3(D.create(0,0,0),{},{isHidden:!0})},{description:"Box around camera target.",isFlat:!0}),cell:M.Group({}),auto:M.Group({radius:M.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),selectionDetailLevel:i(p.header.availablePrecisions,6,{label:"Selection Detail"}),isSelection:M.Boolean(!1,{isHidden:!0}),bottomLeft:M.Vec3(h.min,{},{isHidden:!0}),topRight:M.Vec3(h.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:i(p.header.availablePrecisions,3),channels:p.kind==="em"?M.Group({em:t("EM",ze(6524815),p.emDefaultContourLevel||ot.IsoValue.relative(1),p.header.sampling[0].valuesInfo[0],m.em)},{isFlat:!0}):M.Group({"2fo-fc":t("2Fo-Fc",ze(3367602),ot.IsoValue.relative(1.5),p.header.sampling[0].valuesInfo[0],m["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",ze(3390259),ot.IsoValue.relative(3),p.header.sampling[0].valuesInfo[1],m["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",ze(12268339),ot.IsoValue.relative(-3),p.header.sampling[0].valuesInfo[1],m["fo-fc(-ve)"])},{isFlat:!0})}}e.createEntryParams=o;function i(l,c,u){return M.Select(Math.min(c,l.length-1),l.map((d,m)=>[m,`${m+1} [ ${Math.pow(d.maxVoxels,1/3)|0}^3 cells ]`]),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels).",...u})}function s(l){return{entry:{name:l.entry.name,params:{detailLevel:l.entry.params.detailLevel,channels:l.entry.params.channels,view:{name:l.entry.params.view.name,params:{...l.entry.params.view.params}}}}}}e.copyParams=s,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["camera-target","Around Camera"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]];class a extends tr.WithSubscribers{get info(){return this.infoMap.get(this.params.entry.name)}async queryData(c){let u=Ty(this.data.serverUrl,`${this.info.kind}/${this.info.dataId.toLowerCase()}`);if(c){let{min:g,max:b}=c;u+=`/box/${g.map(y=>Math.round(1e3*y)/1e3).join(",")}/${b.map(y=>Math.round(1e3*y)/1e3).join(",")}`}else u+="/cell";let d=this.params.entry.params.detailLevel;this.params.entry.params.view.name==="auto"&&this.params.entry.params.view.params.isSelection&&(d=this.params.entry.params.view.params.selectionDetailLevel),this.params.entry.params.view.name==="camera-target"&&c&&(d=this.decideDetail(c,this.params.entry.params.view.params.dynamicDetailLevel)),u+=`?detail=${d}`;let m=WS.get(this.cache,u);if(m)return m.data;let p=Nr.getUrlAsset(this.plugin.managers.asset,u),h=await this.plugin.runTask(this.plugin.managers.asset.resolve(p,"binary")),f=await this.parseCif(h.data);if(!f)return;let C=WS.set(this.cache,u,{data:f,asset:h});return C&&C.asset.dispose(),f}async parseCif(c){let u=await this.plugin.runTask(Di.parseBinary(c));if(u.isError){this.plugin.log.error("VolumeStreaming, parsing CIF: "+u.toString());return}if(u.result.blocks.length<2){this.plugin.log.error("VolumeStreaming: Invalid data.");return}let d={};for(let m=1;m<u.result.blocks.length;m++){let p=u.result.blocks[m],h=Di.schema.densityServer(p),f=await this.plugin.runTask(Uf(h));d[p.header]=f}return d}async updateParams(c,u=!1){let d=s(this.params),m=d.entry.params.view.name;m!=="off"&&m!=="cell"&&(d.entry.params.view.params.bottomLeft=c?.min||D.zero(),d.entry.params.view.params.topRight=c?.max||D.zero()),m==="auto"&&(d.entry.params.view.params.isSelection=u);let p=this.plugin.state.data,h=p.build().to(this.ref).update(d);await ht.State.Update(this.plugin,{state:p,tree:h,options:{doNotUpdateCurrent:!0}})}getStructureRoot(){return this.plugin.state.data.select(Kt.Generators.byRef(this.ref).rootOfType(fe.Molecule.Structure))[0]}register(c){this.ref=c,this.subscribeObservable(this.plugin.state.events.object.removed,u=>{!fe.Molecule.Structure.is(u.obj)||!ce.Loci.is(this.lastLoci)||this.lastLoci.structure===u.obj.data&&(this.lastLoci=pr)}),this.subscribeObservable(this.plugin.state.events.object.updated,u=>{!fe.Molecule.Structure.is(u.oldObj)||!ce.Loci.is(this.lastLoci)||this.lastLoci.structure===u.oldObj.data&&(this.lastLoci=pr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,u=>{if(!this.plugin.state.data.tree.children.has(this.ref))return;let d=u?u.loci:pr;switch(this.params.entry.params.view.name){case"auto":this.updateAuto(d);break;case"selection-box":this.updateSelectionBox(d);break;default:this.lastLoci=d;break}})}unregister(){let c=this.cache.entries.first;for(;c;)c.value.data.asset.dispose(),c=c.next}isCameraTargetSame(c,u){if(!c||!u)return!1;let d=D.equals(c.target,u.target),m=D.squaredDistance(c.target,c.position),p=D.squaredDistance(u.target,u.position),h=Math.abs(m-p)/m<.001;return d&&h}cameraTargetDistance(c){return D.distance(c.target,c.position)}getBoxFromLoci(c){var u,d,m;if(Xt.isEmpty(c)||wi(c))return xt();let p=this.plugin.helpers.substructureParent.get(c.structure,!0);if(!p)return xt();let h=this.getStructureRoot();if(!h||((u=h.obj)===null||u===void 0?void 0:u.data)!==((d=p.obj)===null||d===void 0?void 0:d.data))return xt();let f=Zf.get((m=h.obj)===null||m===void 0?void 0:m.data.models[0]);f&&de.invert(this._invTransform,f);let C=ce.Loci.extendToWholeResidues(c),g=ce.Loci.getBoundary(C,f&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return ce.Loci.size(C)===1&&xt.expand(g,g,D.create(1,1,1)),g}updateAuto(c){this.updateQueue.enqueue(async()=>{this.lastLoci=c,wi(c)?await this.updateParams(this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0,!1):await this.updateParams(this.getBoxFromLoci(c),!0)})}updateSelectionBox(c){this.updateQueue.enqueue(async()=>{Xt.areEqual(this.lastLoci,c)?this.lastLoci=pr:this.lastLoci=c;let u=this.getBoxFromLoci(this.lastLoci);await this.updateParams(u)})}updateCameraTarget(c){this.updateQueue.enqueue(async()=>{var u,d,m;let p=(u=this.plugin.canvas3d)===null||u===void 0?void 0:u.props.camera.manualReset;try{p||(d=this.plugin.canvas3d)===null||d===void 0||d.setProps({camera:{manualReset:!0}});let h=this.boxFromCameraTarget(c,!0);await this.updateParams(h)}finally{p||(m=this.plugin.canvas3d)===null||m===void 0||m.setProps({camera:{manualReset:p}})}})}boxFromCameraTarget(c,u){var d;let m=c.target,p=this.cameraTargetDistance(c),f=Math.tan(.5*c.fov)*p,C=(d=this.plugin.canvas3d)===null||d===void 0?void 0:d.camera.viewport;C&&C.width>C.height&&(f*=C.width/C.height);let g=this.params.entry.params.view.name==="camera-target"?this.params.entry.params.view.params.radius:.5;f*=g;let b,y,x;if(u){let A=D.zero();xt.size(A,this.data.structure.boundary.box),b=Math.min(f,.5*A[0]),y=Math.min(f,.5*A[1]),x=Math.min(f,.5*A[2])}else b=y=x=f;return xt.create(D.create(m[0]-b,m[1]-y,m[2]-x),D.create(m[0]+b,m[1]+y,m[2]+x))}decideDetail(c,u){let d=this.info.kind==="x-ray"?xt.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce((C,g)=>C*g,1),p=xt.volume(c)/d,h=this.info.header.availablePrecisions.length-1,f=u;for(;p<=.5&&f<h;)p*=2,f+=1;return f}async update(c){let u=c.entry.params.view.name==="selection-box"&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&this.params.entry.params.view.name!=="selection-box";this.params=c;let d,m=!1;switch(c.entry.params.view.name!=="camera-target"&&this.cameraTargetSubscription&&(this.cameraTargetSubscription.unsubscribe(),this.cameraTargetSubscription=void 0),c.entry.params.view.name){case"off":m=!0;break;case"box":d=xt.create(c.entry.params.view.params.bottomLeft,c.entry.params.view.params.topRight),m=xt.volume(d)<1e-4;break;case"selection-box":{u?d=this.getBoxFromLoci(this.lastLoci)||xt():d=xt.create(D.clone(c.entry.params.view.params.bottomLeft),D.clone(c.entry.params.view.params.topRight));let f=c.entry.params.view.params.radius;m=xt.volume(d)<1e-4,xt.expand(d,d,D.create(f,f,f));break}case"camera-target":this.cameraTargetSubscription||(this.cameraTargetSubscription=this.subscribeObservable(this.cameraTargetObservable,f=>this.updateCameraTarget(f))),d=this.boxFromCameraTarget(this.plugin.canvas3d.camera.getSnapshot(),!0);break;case"cell":d=this.info.kind==="x-ray"?this.data.structure.boundary.box:void 0;break;case"auto":if(d=c.entry.params.view.params.isSelection||this.info.kind==="x-ray"?xt.create(D.clone(c.entry.params.view.params.bottomLeft),D.clone(c.entry.params.view.params.topRight)):void 0,d&&(m=xt.volume(d)<1e-4,c.entry.params.view.params.isSelection)){let f=c.entry.params.view.params.radius;xt.expand(d,d,D.create(f,f,f))}break}let p=m?{}:await this.queryData(d);if(!p)return!1;let h=c.entry.params.channels;return this.info.kind==="x-ray"?(this.channels["2fo-fc"]=this.createChannel(p["2FO-FC"]||ot.One,h["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(p["FO-FC"]||ot.One,h["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(p["FO-FC"]||ot.One,h["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(p.EM||ot.One,h.em,this.info.header.sampling[0].valuesInfo[0]),!0}createChannel(c,u,d){let m=u;return{data:c,color:m.color,wireframe:m.wireframe,opacity:m.opacity,isoValue:m.isoValue.kind==="relative"?m.isoValue:ot.IsoValue.toRelative(m.isoValue,d)}}getDescription(){return this.params.entry.params.view.name==="selection-box"?"Selection":this.params.entry.params.view.name==="camera-target"?"Camera":this.params.entry.params.view.name==="box"?"Static Box":this.params.entry.params.view.name==="cell"?"Cell":""}constructor(c,u){super(c,{}),this.plugin=c,this.data=u,this.cache=WS.create(25),this.params={},this.lastLoci=pr,this.ref="",this.cameraTargetObservable=this.plugin.canvas3d.didDraw.pipe(fl(500,void 0,{leading:!0,trailing:!0}),kp(()=>{var d;return(d=this.plugin.canvas3d)===null||d===void 0?void 0:d.camera.getSnapshot()}),rg((d,m)=>this.isCameraTargetSame(d,m)),Bf(d=>d!==void 0)),this.cameraTargetSubscription=void 0,this.channels={},this._invTransform=de(),this.infoMap=new Map,this.data.entries.forEach(d=>this.infoMap.set(d.dataId,d)),this.updateQueue=new HR}}e.Behavior=a})(sa||(sa={}));function lve(e,t){let r=NYe(e,t||$R());return GYe(e.tree,r),t&&t.refs.forEach(OYe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function $R(){return{trajectories:[],models:[],structures:[],refs:new Map}}function _Ye(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function ove(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function TYe(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function EYe(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function ive(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function PYe(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function DYe(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function kYe(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function MYe(e){return e.transform.tags?[...e.transform.tags].sort().join():e.transform.ref}function RYe(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:MYe(e),representations:[]}}function BYe(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function LYe(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function NYe(e,t){return{state:e,oldHierarchy:t,hierarchy:$R(),changed:!1,added:new Set}}function qS(e,t,r,n,...o){let i=n(...o);r.push(i),e.hierarchy.refs.set(t.transform.ref,i);let s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function P1(e,t,r,...n){let o=r(...n);e.hierarchy.refs.set(t.transform.ref,o);let i=e.oldHierarchy.refs.get(t.transform.ref);return i?i.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function sve(e){return t=>e.is(t.obj)}function ave(e,t){return(r,n)=>!t(n)&&e.is(r.obj)}function jR(e){return t=>t.transform.transformer===e}function D1(){}var FYe=[[sve(fe.Molecule.Trajectory),(e,t)=>{e.currentTrajectory=qS(e,t,e.hierarchy.trajectories,_Ye,t)},e=>e.currentTrajectory=void 0],[ave(fe.Molecule.Model,e=>e.currentModel),(e,t)=>{e.currentTrajectory?e.currentModel=qS(e,t,e.currentTrajectory.models,ove,t,e.currentTrajectory):e.currentModel=P1(e,t,ove,t),e.hierarchy.models.push(e.currentModel)},e=>e.currentModel=void 0],[jR(Je.Model.CustomModelProperties),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.properties=P1(e,t,TYe,t,e.currentModel)},D1],[jR(Je.Representation.ModelUnitcell3D),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.unitcell=P1(e,t,EYe,t,e.currentModel)},D1],[ave(fe.Molecule.Structure,e=>e.currentStructure),(e,t)=>{e.currentModel?e.currentStructure=qS(e,t,e.currentModel.structures,ive,t,e.currentModel):e.currentStructure=P1(e,t,ive,t),e.hierarchy.structures.push(e.currentStructure)},e=>e.currentStructure=void 0],[jR(Je.Model.CustomStructureProperties),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.properties=P1(e,t,PYe,t,e.currentStructure)},D1],[jR(Je.Model.TransformStructureConformation),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.transform=P1(e,t,DYe,t,e.currentStructure)},D1],[sve(sa),(e,t)=>(e.currentStructure&&(e.currentStructure.volumeStreaming=P1(e,t,kYe,t,e.currentStructure)),!1),D1],[(e,t)=>t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator?!1:fe.Molecule.Structure.is(e.obj),(e,t)=>{e.currentStructure&&(e.currentComponent=qS(e,t,e.currentStructure.components,RYe,t,e.currentStructure))},e=>e.currentComponent=void 0],[(e,t)=>!e.state.isGhost&&!!t.currentComponent&&fe.Molecule.Structure.Representation3D.is(e.obj),(e,t)=>(e.currentComponent&&qS(e,t,e.currentComponent.representations,BYe,t,e.currentComponent),!1),D1],[e=>!e.state.isGhost&&fe.isRepresentation3D(e.obj),(e,t)=>{let r=e.currentComponent||e.currentStructure||e.currentModel;r&&(r.genericRepresentations||(r.genericRepresentations=[]),qS(e,t,r.genericRepresentations,LYe,t,r))},D1]];function cve(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;let{obj:t}=e;return!(!t||t===Hn.Null||e.status!=="ok"&&e.status!=="error")}function OYe(e){let{cell:t}=e;cve(t)||(this.changed=!0)}function VYe(e){uve(this,this.tree.transforms.get(e))}function uve(e,t){let{state:r}=e,n=r.state.cells.get(t.ref);if(!cve(n))return;let o,i=!1;for(let[a,l,c]of FYe)if(a(n,r)){if(l(r,n)===!1){i=!0;break}o=c;break}if(i)return;let s=e.tree.children.get(t.ref);s&&s.size&&s.forEach(VYe,e),o&&o(r)}function GYe(e,t){let r={tree:e,state:t};return uve(r,e.root),r.state}var mh=class e extends Xu{get dataState(){return this.plugin.state.data}get currentComponentGroups(){return this._currentComponentGroups?this._currentComponentGroups:(this._currentComponentGroups=e.getComponentGroups(this.selection.structures),this._currentComponentGroups)}get seletionSet(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(let t of this.selection.trajectories)this._currentSelectionSet.add(t.cell.transform.ref);for(let t of this.selection.models)this._currentSelectionSet.add(t.cell.transform.ref);for(let t of this.selection.structures)this._currentSelectionSet.add(t.cell.transform.ref);return this._currentSelectionSet}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}getStructuresWithSelection(){let t=this.plugin.managers.structure.hierarchy.current.structures,r=[];for(let n of t)this.plugin.managers.structure.selection.structureHasSelection(n)&&r.push(n);return r}findStructure(t){if(!t)return;let r=this.plugin.helpers.substructureParent.get(t);if(!r)return;let n=this.plugin.state.data.selectQ(o=>o.byValue(r).rootOfType(fe.Molecule.Structure))[0];if(n)return this.behaviors.selection.value.structures.find(o=>o.cell===n)}syncCurrent(t,r){let n=this.seletionSet,o=[];for(let i of t){let s=i.cell.transform.ref;(n.has(s)||r.has(s))&&o.push(i)}return o.length===0?t.length>0?[t[0]]:[]:o}sync(t){if(!t&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree){t&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,...this.state.selection}));return}this.state.syncedTree=this.dataState.tree;let r=lve(this.plugin.state.data,this.current);if(!r.changed)return;let{hierarchy:n}=r,o=this.syncCurrent(n.trajectories,r.added),i=this.syncCurrent(n.models,r.added),s=this.syncCurrent(n.structures,r.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=n,this.state.selection.trajectories=o,this.state.selection.models=i,this.state.selection.structures=s,t?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:n,trajectories:o,models:i,structures:s})):this.state.notified=!1}updateCurrent(t,r){let n=this.current,o=r==="add"?$n.union(this.seletionSet,new Set(t.map(l=>l.cell.transform.ref))):$n.difference(this.seletionSet,new Set(t.map(l=>l.cell.transform.ref))),i=[],s=[],a=[];for(let l of n.trajectories)o.has(l.cell.transform.ref)&&i.push(l);for(let l of n.models)o.has(l.cell.transform.ref)&&s.push(l);for(let l of n.structures)o.has(l.cell.transform.ref)&&a.push(l);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=i,this.state.selection.models=s,this.state.selection.structures=a,this.behaviors.selection.next({hierarchy:n,trajectories:i,models:s,structures:a})}remove(t,r){if(t.length===0)return;let n=this.plugin.state.data.build();for(let o of t)n.delete(typeof o=="string"?o:o.cell.transform.ref);return n.commit({canUndo:r?"Remove":!1})}toggleVisibility(t,r){if(t.length===0)return;let n=r!==void 0?r!=="show":!t[0].cell.state.isHidden;for(let o of t)vo(this.dataState,o.cell.transform.ref,n)}applyPreset(t,r,n){return this.plugin.dataTransaction(async()=>{for(let o of t)o.models.length>0&&await this.clearTrajectory(o),await this.plugin.builders.structure.hierarchy.applyPreset(o.cell,r,n)})}async updateStructure(t,r){await this.plugin.dataTransaction(async()=>{let n=mi.getDecoratorRoot(this.dataState.tree,t.cell.transform.ref),o=this.dataState.tree.children.get(n).toArray();await this.remove(o,!1),await this.plugin.state.updateTransform(this.plugin.state.data,t.cell.transform.ref,r,"Structure Type"),await this.plugin.builders.structure.representation.applyPreset(t.cell.transform.ref,"auto")},{canUndo:"Structure Type"}),ht.Camera.Reset(this.plugin)}clearTrajectory(t){let r=this.dataState.build();for(let n of t.models)r.delete(n.cell);return r.commit()}constructor(t){super(),this.plugin=t,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:$R(),selection:{trajectories:[],models:[],structures:[]}},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,trajectories:this.selection.trajectories,models:this.selection.models,structures:this.selection.structures})},this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.subscribe(t.state.data.events.changed,r=>{r.inTransaction||t.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(t.behaviors.state.isAnimating,r=>{!r&&!t.behaviors.state.isUpdating.value&&this.sync(!0)})}};(function(e){function t(n){if(!n.length)return[];if(n.length===1)return n[0].components.map(s=>[s]);let o=[],i=new Map;for(let s of n)for(let a of s.components){let l=a.key;if(!l)continue;let c=i.get(l);c||(c=[],i.set(l,c),o.push(c)),c.push(a)}return o}e.getComponentGroups=t;function r(n){var o,i,s,a,l,c,u,d,m;let{structures:p}=n.managers.structure.hierarchy.selection;if(p.length===0)return"";if(p.length===1){let g=p[0],b=(o=g.cell.obj)===null||o===void 0?void 0:o.data;if(!b)return((i=g.cell.obj)===null||i===void 0?void 0:i.label)||"Structure";let y=b.models[0]||b.representativeModel||b.masterModel;if(!y)return((s=g.cell.obj)===null||s===void 0?void 0:s.label)||"Structure";let x=y.entryId;return!((l=(a=g.model)===null||a===void 0?void 0:a.trajectory)===null||l===void 0)&&l.models&&g.model.trajectory.models.length===1?x:g.model?`${(c=g.model.cell.obj)===null||c===void 0?void 0:c.label} | ${x}`:x}let h=p[0],f=(u=h?.model)===null||u===void 0?void 0:u.trajectory,C=!0;for(let g of p)if(((d=g?.model)===null||d===void 0?void 0:d.trajectory)!==f){C=!1;break}return C&&f?`${(m=f.cell.obj)===null||m===void 0?void 0:m.label} | ${p.length} structures`:`${p.length} structures`}e.getSelectedStructuresDescription=r})(mh||(mh={}));var Va=ar(un());var WR=class extends Xo{get current(){return this.plugin.managers.structure.hierarchy.behaviors.selection}componentDidMount(){this.subscribe(this.current,()=>this.forceUpdate())}get unitcell(){var t;let{selection:r}=this.plugin.managers.structure.hierarchy;if(r.structures.length===0)return null;let n=[];for(let o of r.structures){let i=o.model;i?.unitcell&&(!((t=i.unitcell)===null||t===void 0)&&t.cell.obj)&&n.push(i.unitcell)}return n.length===0?null:(0,Va.jsx)(qR,{refs:n,labelMultiple:"Unit Cells"})}get customControls(){let t=[];return this.plugin.genericRepresentationControls.forEach((r,n)=>{let[o,i]=r(this.plugin.managers.structure.hierarchy.selection);o.length>0&&t.push((0,Va.jsx)("div",{children:(0,Va.jsx)(qR,{refs:o,labelMultiple:i})},n))}),t.length>0?t:null}render(){return(0,Va.jsx)(Va.Fragment,{children:(0,Va.jsxs)("div",{style:{marginTop:"6px"},children:[this.unitcell,this.customControls]})})}},qR=class extends Xo{constructor(){super(...arguments),this.state={showOptions:!1},this.toggleVisibility=t=>{t.preventDefault(),this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs),t.currentTarget.blur()},this.highlight=t=>{t.preventDefault(),this.pivot.cell.parent&&ht.Interactivity.Object.Highlight(this.plugin,{state:this.pivot.cell.parent,ref:this.props.refs.map(r=>r.cell.transform.ref)})},this.clearHighlight=t=>{t.preventDefault(),ht.Interactivity.ClearHighlights(this.plugin)},this.focus=t=>{var r;t.preventDefault();let n=!0;for(let i of this.props.refs)if(!i.cell.state.isHidden){n=!1;break}n&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs,"show");let o=[];for(let i of this.props.refs){if(i.cell.state.isHidden)continue;let s=(r=i.cell.obj)===null||r===void 0?void 0:r.data.repr.getLoci();s&&o.push(s)}this.plugin.managers.camera.focusLoci(o)},this.toggleOptions=()=>this.setState({showOptions:!this.state.showOptions})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{var r;Mu.ObjectEvent.isCell(t,(r=this.pivot)===null||r===void 0?void 0:r.cell)&&this.forceUpdate()})}get pivot(){return this.props.refs[0]}render(){let{refs:t,labelMultiple:r}=this.props;if(t.length===0)return null;let n=t[0],o,i;if(t.length===1){let{obj:s}=n.cell;if(!s)return null;o=s?.label,i=s?.description}else o=`${t.length} ${r||"Objects"}`;return(0,Va.jsxs)(Va.Fragment,{children:[(0,Va.jsxs)("div",{className:"msp-flex-row",children:[(0,Va.jsxs)("button",{className:"msp-form-control msp-control-button-label",title:`${o}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[o," ",(0,Va.jsx)("small",{children:i})]}),(0,Va.jsx)(Jt,{svg:n.cell.state.isHidden?uc:dc,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:`${n.cell.state.isHidden?"Show":"Hide"}`,small:!0,flex:!0}),t.length===1&&(0,Va.jsx)(Jt,{svg:Um,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0})]}),t.length===1&&this.state.showOptions&&n.cell.parent&&(0,Va.jsx)(Va.Fragment,{children:(0,Va.jsx)("div",{className:"msp-control-offset",children:(0,Va.jsx)(Oa,{state:n.cell.parent,transform:n.cell.transform,customHeader:"none",autoHideApply:!0})})})]})}};var ZR=class extends il{defaultState(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:Kw}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>this.setState({description:mh.getSelectedStructuresDescription(this.plugin)}))}renderControls(){return(0,rn.jsxs)(rn.Fragment,{children:[(0,rn.jsx)(k6,{}),(0,rn.jsx)(R6,{}),(0,rn.jsx)(WR,{})]})}},k6=class extends Xo{constructor(){super(...arguments),this.state={isEmpty:!0,isBusy:!1,canUndo:!1},this.togglePreset=this.toggleAction("preset"),this.toggleAdd=this.toggleAction("add"),this.toggleOptions=this.toggleAction("options"),this.hideAction=()=>this.setState({action:void 0}),this.applyPreset=t=>{if(this.hideAction(),!t)return;let r=this.plugin.managers.structure,{structures:n}=r.hierarchy.selection;t.value===null?r.component.clear(n):r.component.applyPreset(n,t.value)},this.undo=()=>{let t=this.plugin.state.data.undo();t&&this.plugin.runTask(t)}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>this.setState({action:this.state.action!=="options"||t.structures.length===0?void 0:"options",isEmpty:t.structures.length===0})),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t,action:this.state.action!=="options"?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:t})=>{this.setState({canUndo:t.canUndo})})}toggleAction(t){return()=>this.setState({action:this.state.action===t?void 0:t})}get presetControls(){return(0,rn.jsx)(hr,{items:this.presetActions,onSelect:this.applyPreset})}get presetActions(){let t=this.plugin.managers.structure.component.pivotStructure,r=this.plugin.builders.structure.representation.getPresets(t?.cell.obj);return hr.createItems(r,{label:n=>n.display.name,category:n=>n.display.group,description:n=>n.display.description})}render(){let t=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone.";return(0,rn.jsxs)(rn.Fragment,{children:[(0,rn.jsxs)("div",{className:"msp-flex-row",children:[(0,rn.jsx)(gi,{icon:Ug,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:this.state.action==="preset",disabled:this.isDisabled}),(0,rn.jsx)(gi,{icon:nf,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled}),(0,rn.jsx)(gi,{icon:gu,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.isDisabled}),(0,rn.jsx)(Jt,{svg:t_,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:t})]}),this.state.action==="preset"&&this.presetControls,this.state.action==="add"&&(0,rn.jsx)("div",{className:"msp-control-offset",children:(0,rn.jsx)(E_,{onApply:this.hideAction})}),this.state.action==="options"&&(0,rn.jsx)("div",{className:"msp-control-offset",children:(0,rn.jsx)(M6,{isDisabled:this.isDisabled})})]})}},E_=class extends Xo{constructor(){super(...arguments),this.state=this.createState(),this.apply=()=>{let t=this.props.forSelection?this.currentStructures:this.selectedStructures;this.props.onApply(),this.plugin.managers.structure.component.add(this.state.values,t)},this.paramsChanged=t=>this.setState({values:t})}createState(){let t=od.getAddParams(this.plugin);return{params:t,values:M.getDefaultValues(t)}}get selectedStructures(){return this.plugin.managers.structure.component.currentStructures}get currentStructures(){return this.plugin.managers.structure.hierarchy.current.structures}render(){return(0,rn.jsxs)(rn.Fragment,{children:[(0,rn.jsx)(An,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,rn.jsx)(or,{icon:nf,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Create Component"})]})}},M6=class extends Xo{constructor(){super(...arguments),this.update=t=>this.plugin.managers.structure.component.setOptions(t)}componentDidMount(){this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,()=>this.forceUpdate())}render(){return(0,rn.jsx)(An,{params:od.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled})}},R6=class extends Xo{componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.forceUpdate()})}render(){let t=this.plugin.managers.structure.hierarchy.currentComponentGroups;return t.length===0?null:(0,rn.jsx)("div",{style:{marginTop:"6px"},children:t.map(r=>(0,rn.jsx)(B6,{group:r},r[0].cell.transform.ref))})}},B6=class extends Xo{constructor(){super(...arguments),this.state={action:void 0},this.toggleVisible=t=>{t.preventDefault(),t.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group)},this.selectAction=t=>{t&&(0,t?.value)()},this.remove=()=>this.plugin.managers.structure.hierarchy.remove(this.props.group,!0),this.toggleAction=()=>this.setState({action:this.state.action==="action"?void 0:"action"}),this.toggleLabel=()=>this.setState({action:this.state.action==="label"?void 0:"label"}),this.highlight=t=>{t.preventDefault(),this.props.group[0].cell.parent&&ht.Interactivity.Object.Highlight(this.plugin,{state:this.props.group[0].cell.parent,ref:this.props.group.map(r=>r.cell.transform.ref)})},this.clearHighlight=t=>{t.preventDefault(),ht.Interactivity.ClearHighlights(this.plugin)},this.focus=()=>{let t=!0;for(let r of this.props.group)if(!r.cell.state.isHidden){t=!1;break}t&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.group,"show"),this.plugin.managers.camera.focusSpheres(this.props.group,r=>{var n;if(!r.cell.state.isHidden)return(n=r.cell.obj)===null||n===void 0?void 0:n.data.boundary.sphere})},this.updateLabel=t=>{this.plugin.managers.structure.component.updateLabel(this.pivot,t)}}get pivot(){return this.props.group[0]}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{Mu.ObjectEvent.isCell(t,this.pivot.cell)&&this.forceUpdate()})}get colorByActions(){var t,r;let n=this.plugin.managers.structure.component,i=(t=this.pivot.representations[0].cell.transform.params)===null||t===void 0?void 0:t.colorTheme.name,s=Vfe(this.plugin,(r=this.pivot.cell.obj)===null||r===void 0?void 0:r.data);return hr.createItemsFromSelectOptions(s,{value:a=>()=>n.updateRepresentationsTheme(this.props.group,{color:a[0]}),selected:a=>a[0]===i})}get actions(){let t=this.plugin.managers.structure.component,r=[[hr.Header("Add Representation"),...od.getRepresentationTypes(this.plugin,this.props.group[0]).map(n=>hr.Item(n[1],()=>t.addRepresentation(this.props.group,n[0])))]];return this.pivot.representations.length>0&&r.push([hr.Header("Set Coloring",{isIndependent:!0}),...this.colorByActions]),t.canBeModified(this.props.group[0])&&r.push([hr.Header("Modify by Selection"),hr.Item("Include",()=>t.modifyByCurrentSelection(this.props.group,"union"),{icon:Ww}),hr.Item("Subtract",()=>t.modifyByCurrentSelection(this.props.group,"subtract"),{icon:qw}),hr.Item("Intersect",()=>t.modifyByCurrentSelection(this.props.group,"intersect"),{icon:Zw})]),r.push(hr.Item("Select This",()=>t.selectThis(this.props.group),{icon:g1})),t.canBeModified(this.props.group[0])&&r.push(hr.Item("Edit Label",this.toggleLabel)),r}get reprLabel(){var t;let r=this.pivot;return r.representations.length===0?"No repr.":r.representations.length===1?(t=r.representations[0].cell.obj)===null||t===void 0?void 0:t.label:`${r.representations.length} reprs`}render(){var t;let r=this.pivot,n=r.cell,o=(t=n.obj)===null||t===void 0?void 0:t.label,i=this.reprLabel;return(0,rn.jsxs)(rn.Fragment,{children:[(0,rn.jsxs)("div",{className:"msp-flex-row",children:[(0,rn.jsxs)(or,{noOverflow:!0,className:"msp-control-button-label",title:`${o}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[o,(0,rn.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:i})]}),(0,rn.jsx)(Jt,{svg:n.state.isHidden?uc:dc,toggleState:!1,onClick:this.toggleVisible,title:`${n.state.isHidden?"Show":"Hide"} component`,small:!0,className:"msp-form-control",flex:!0}),(0,rn.jsx)(Jt,{svg:Fa,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0}),(0,rn.jsx)(Jt,{svg:Um,onClick:this.toggleAction,title:"Actions",toggleState:this.state.action==="action",className:"msp-form-control",flex:!0})]}),this.state.action==="label"&&(0,rn.jsx)("div",{className:"msp-control-offset",style:{marginBottom:"6px"},children:(0,rn.jsx)($s,{label:"Label",control:(0,rn.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,rn.jsx)(mc,{onChange:this.updateLabel,value:o,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0}),(0,rn.jsx)(Jt,{svg:Fd,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0})]})})}),this.state.action==="action"&&(0,rn.jsxs)("div",{className:"msp-accent-offset",children:[(0,rn.jsx)("div",{style:{marginBottom:"6px"},children:(0,rn.jsx)(hr,{items:this.actions,onSelect:this.selectAction,noOffset:!0})}),(0,rn.jsx)("div",{style:{marginBottom:"6px"},children:r.representations.map(s=>(0,rn.jsx)(L6,{group:this.props.group,representation:s},s.cell.transform.ref))})]})]})}},L6=class extends Xo{constructor(){super(...arguments),this.remove=()=>this.plugin.managers.structure.component.removeRepresentations(this.props.group,this.props.representation),this.toggleVisible=t=>{t.preventDefault(),t.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group,this.props.representation)},this.update=t=>this.plugin.managers.structure.component.updateRepresentations(this.props.group,this.props.representation,t)}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{Mu.ObjectEvent.isCell(t,this.props.representation.cell)&&this.forceUpdate()})}render(){var t;let r=this.props.representation.cell;return(0,rn.jsxs)("div",{className:"msp-representation-entry",children:[r.parent&&(0,rn.jsx)(lo,{header:`${((t=r.obj)===null||t===void 0?void 0:t.label)||""} Representation`,noOffset:!0,children:(0,rn.jsx)(Oa,{state:r.parent,transform:r.transform,customHeader:"none",customUpdate:this.update,noMargin:!0})}),(0,rn.jsx)(Jt,{svg:Fa,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}}),(0,rn.jsx)(Jt,{svg:this.props.representation.cell.state.isHidden?uc:dc,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}})]})}};var dn=ar(un());var N6="measurement-group",KR="measurement-order-label",F6={distanceUnitLabel:M.Text("\u212B",{isEssential:!0}),textColor:jU.textColor},UYe=M.getDefaultValues(F6),XR=class extends Na{stateUpdated(){this.behaviors.state.next(this.state)}getGroup(){let t=this.plugin.state.data,r=Kt.findTagInSubtree(t.tree,xr.RootRef,N6),n=this.plugin.state.data.build();return r?n.to(r):n.toRoot().group(Je.Misc.CreateGroup,{label:"Measurements"},{tags:N6})}async setOptions(t){this.updateState({options:t})&&this.stateUpdated();let r=this.plugin.state.data.build();for(let n of this.state.distances)r.to(n).update(o=>{o.unitLabel=t.distanceUnitLabel,o.textColor=t.textColor});for(let n of this.state.labels)r.to(n).update(o=>{o.textColor=t.textColor});for(let n of this.state.angles)r.to(n).update(o=>{o.textColor=t.textColor});for(let n of this.state.dihedrals)r.to(n).update(o=>{o.textColor=t.textColor});r.editInfo.count!==0&&await ht.State.Update(this.plugin,{state:this.plugin.state.data,tree:r,options:{doNotLogTiming:!0}})}async addDistance(t,r,n){let o=this.plugin.helpers.substructureParent.get(t.structure),i=this.plugin.helpers.substructureParent.get(r.structure);if(!o||!i)return;let s=[o.transform.ref];Ho(s,i.transform.ref);let l=this.getGroup().apply(Je.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:o.transform.ref,expression:ce.Loci.toExpression(t)},{key:"b",groupId:"b",ref:i.transform.ref,expression:ce.Loci.toExpression(r)}],isTransitive:!0,label:"Distance"},{dependsOn:s,tags:n?.selectionTags}),c=l.apply(Je.Representation.StructureSelectionsDistance3D,{customText:n?.customText||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor,...n?.lineParams,...n?.labelParams,...n?.visualParams},{tags:n?.reprTags}),u=this.plugin.state.data;return await ht.State.Update(this.plugin,{state:u,tree:c,options:{doNotLogTiming:!0}}),{selection:l.selector,representation:c.selector}}async addAngle(t,r,n,o){let i=this.plugin.helpers.substructureParent.get(t.structure),s=this.plugin.helpers.substructureParent.get(r.structure),a=this.plugin.helpers.substructureParent.get(n.structure);if(!i||!s||!a)return;let l=[i.transform.ref];Ho(l,s.transform.ref),Ho(l,a.transform.ref);let u=this.getGroup().apply(Je.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:i.transform.ref,expression:ce.Loci.toExpression(t)},{key:"b",ref:s.transform.ref,expression:ce.Loci.toExpression(r)},{key:"c",ref:a.transform.ref,expression:ce.Loci.toExpression(n)}],isTransitive:!0,label:"Angle"},{dependsOn:l,tags:o?.selectionTags}),d=u.apply(Je.Representation.StructureSelectionsAngle3D,{customText:o?.customText||"",textColor:this.state.options.textColor,...o?.lineParams,...o?.labelParams,...o?.visualParams},{tags:o?.reprTags}),m=this.plugin.state.data;return await ht.State.Update(this.plugin,{state:m,tree:d,options:{doNotLogTiming:!0}}),{selection:u.selector,representation:d.selector}}async addDihedral(t,r,n,o,i){let s=this.plugin.helpers.substructureParent.get(t.structure),a=this.plugin.helpers.substructureParent.get(r.structure),l=this.plugin.helpers.substructureParent.get(n.structure),c=this.plugin.helpers.substructureParent.get(o.structure);if(!s||!a||!l||!c)return;let u=[s.transform.ref];Ho(u,a.transform.ref),Ho(u,l.transform.ref),Ho(u,c.transform.ref);let m=this.getGroup().apply(Je.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:ce.Loci.toExpression(t)},{key:"b",ref:a.transform.ref,expression:ce.Loci.toExpression(r)},{key:"c",ref:l.transform.ref,expression:ce.Loci.toExpression(n)},{key:"d",ref:c.transform.ref,expression:ce.Loci.toExpression(o)}],isTransitive:!0,label:"Dihedral"},{dependsOn:u,tags:i?.selectionTags}),p=m.apply(Je.Representation.StructureSelectionsDihedral3D,{customText:i?.customText||"",textColor:this.state.options.textColor,...i?.lineParams,...i?.labelParams,...i?.visualParams},{tags:i?.reprTags}),h=this.plugin.state.data;return await ht.State.Update(this.plugin,{state:h,tree:p,options:{doNotLogTiming:!0}}),{selection:m.selector,representation:p.selector}}async addLabel(t,r){let n=this.plugin.helpers.substructureParent.get(t.structure);if(!n)return;let o=[n.transform.ref],s=this.getGroup().apply(Je.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:n.transform.ref,expression:ce.Loci.toExpression(t)}],isTransitive:!0,label:"Label"},{dependsOn:o,tags:r?.selectionTags}),a=s.apply(Je.Representation.StructureSelectionsLabel3D,{textColor:this.state.options.textColor,...r?.labelParams,...r?.visualParams},{tags:r?.reprTags}),l=this.plugin.state.data;return await ht.State.Update(this.plugin,{state:l,tree:a,options:{doNotLogTiming:!0}}),{selection:s.selector,representation:a.selector}}async addOrientation(t){let r=[],n=[];for(let l=0,c=t.length;l<c;++l){let u=t[l],d=this.plugin.helpers.substructureParent.get(u.structure);d&&(Ho(n,d.transform.ref),r.push({key:`l${l}`,ref:d.transform.ref,expression:ce.Loci.toExpression(u)}))}if(r.length===0)return;let i=this.getGroup().apply(Je.Model.MultiStructureSelectionFromExpression,{selections:r,isTransitive:!0,label:"Orientation"},{dependsOn:n}),s=i.apply(Je.Representation.StructureSelectionsOrientation3D),a=this.plugin.state.data;return await ht.State.Update(this.plugin,{state:a,tree:s,options:{doNotLogTiming:!0}}),{selection:i.selector,representation:s.selector}}async addPlane(t){let r=[],n=[];for(let l=0,c=t.length;l<c;++l){let u=t[l],d=this.plugin.helpers.substructureParent.get(u.structure);d&&(Ho(n,d.transform.ref),r.push({key:`l${l}`,ref:d.transform.ref,expression:ce.Loci.toExpression(u)}))}if(r.length===0)return;let o=this.getGroup(),i=o.apply(Je.Model.MultiStructureSelectionFromExpression,{selections:r,isTransitive:!0,label:"Plane"},{dependsOn:n}),s=i.apply(Je.Representation.StructureSelectionsPlane3D),a=this.plugin.state.data;return await ht.State.Update(this.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}}),{selection:i.selector,representation:s.selector}}async addOrderLabels(t){let r=this.getGroup(),n=this.plugin.state.data.select(Kt.Generators.ofType(fe.Molecule.Structure.Selections).withTag(KR));for(let s of n)r.delete(s);let o=1;for(let s of t){let a=this.plugin.helpers.substructureParent.get(s.structure);if(!a)continue;let l=[a.transform.ref];r.apply(Je.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:ce.Loci.toExpression(s)}],isTransitive:!0,label:"Order"},{dependsOn:l,tags:KR}).apply(Je.Representation.StructureSelectionsLabel3D,{textColor:ze.fromRgb(255,255,255),borderColor:ze.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:`${o++}`},{tags:KR})}let i=this.plugin.state.data;return await ht.State.Update(this.plugin,{state:i,tree:r,options:{doNotLogTiming:!0}}),{representation:r.selector}}getTransforms(t){let r=this.plugin.state.data,n=Kt.findTagInSubtree(r.tree,xr.RootRef,N6),o=n?r.select(Kt.Generators.ofTransformer(t,n)):this._empty;return o.length===0?this._empty:o}sync(){let t=[];for(let n of this.getTransforms(Je.Representation.StructureSelectionsLabel3D)){let o=n.obj.tags;(!o||!o.includes(KR))&&t.push(n)}this.updateState({labels:t,distances:this.getTransforms(Je.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(Je.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(Je.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(Je.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(Je.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()}constructor(t){super({labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:UYe}),this.plugin=t,this.behaviors={state:this.ev.behavior(this.state)},this._empty=[],t.state.data.events.changed.subscribe(r=>{r.inTransaction||t.behaviors.state.isAnimating.value||this.sync()}),t.behaviors.state.isAnimating.subscribe(r=>{!r&&!t.behaviors.state.isUpdating.value&&this.sync()})}};var Lr=ar(un()),mve=ar(hi());var av=class e extends Na{get props(){return{...this.state.props}}setProps(t){let r=this.props,n={...this.state.props,...t};A0(r,n)||(this.updateState({props:n}),this.lociSelects.setProps(n),this.lociHighlights.setProps(n),this.events.propsUpdated.next(void 0))}dispose(){super.dispose(),this.lociSelects.dispose(),this.lociHighlights.dispose()}constructor(t,r={}){super({props:{...M.getDefaultValues(e.Params),...r}}),this.plugin=t,this._props=M.getDefaultValues(e.Params),this.events={propsUpdated:this.ev()},this.lociSelects=new e.LociSelectManager(t,this._props),this.lociHighlights=new e.LociHighlightManager(t,this._props)}};(function(e){e.Params={granularity:M.Select("residue",Xt.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};class t{setProps(i){Object.assign(this.props,i)}addProvider(i){this.providers.push(i)}removeProvider(i){this.providers=this.providers.filter(s=>s!==i)}normalizedLoci(i,s,a=!1){let{loci:l,repr:c}=i,u=s?this.props.granularity:void 0;return{loci:Xt.normalize(l,u,a),repr:c}}mark(i,s,a=!1){if(!Xt.isEmpty(i.loci))for(let l of this.providers)l(i,s,a)}dispose(){this.providers.length=0,this.sel.dispose()}constructor(i,s={}){this.ctx=i,this.providers=[],this.props=M.getDefaultValues(e.Params),this.sel=i.managers.structure.selection,this.setProps(s)}}e.LociMarkManager=t;class r extends t{constructor(){super(...arguments),this.prev=[],this.clearHighlights=(i=!1)=>{for(let s of this.prev)this.mark(s,zt.RemoveHighlight,i);this.prev.length=0}}isHighlighted(i){for(let s of this.prev)if(Wt.Loci.areEqual(s,i))return!0;return!1}addHighlight(i){this.mark(i,zt.Highlight),this.prev.push(i)}highlight(i,s=!0){let a=this.normalizedLoci(i,s);this.isHighlighted(a)||this.addHighlight(a)}highlightOnly(i,s=!0){let a=this.normalizedLoci(i,s);this.isHighlighted(a)||(Xt.isEmpty(a.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(a)))}highlightOnlyExtend(i,s=!0){let a=this.normalizedLoci(i,s);if(ce.Loci.is(a.loci)){let l={loci:this.sel.tryGetRange(a.loci)||a.loci,repr:a.repr};this.isHighlighted(l)||(Xt.isEmpty(l.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(l)))}}dispose(){super.dispose(),this.prev.length=0}}e.LociHighlightManager=r;class n extends t{toggle(i,s=!0){if(Xt.isEmpty(i.loci))return;let a=this.normalizedLoci(i,s,!0);ce.Loci.is(a.loci)?this.toggleSel(a):super.mark(a,zt.Toggle)}toggleExtend(i,s=!0){if(Xt.isEmpty(i.loci))return;let a=this.normalizedLoci(i,s,!0);if(ce.Loci.is(a.loci)){let l=this.sel.tryGetRange(a.loci)||a.loci;this.toggleSel({loci:l,repr:a.repr})}}select(i,s=!0){let a=this.normalizedLoci(i,s,!0);ce.Loci.is(a.loci)&&this.sel.modify("add",a.loci),this.mark(a,zt.Select)}selectJoin(i,s=!0){let a=this.normalizedLoci(i,s,!0);ce.Loci.is(a.loci)&&this.sel.modify("intersect",a.loci),this.mark(a,zt.Select)}selectOnly(i,s=!0){let a=this.normalizedLoci(i,s,!0);ce.Loci.is(a.loci)&&(this.mark({loci:qe.Loci(a.loci.structure),repr:a.repr},zt.Deselect),this.sel.modify("set",a.loci)),this.mark(a,zt.Select)}deselect(i,s=!0){let a=this.normalizedLoci(i,s,!0);ce.Loci.is(a.loci)&&this.sel.modify("remove",a.loci),this.mark(a,zt.Deselect)}deselectAll(){this.sel.clear(),this.mark({loci:vy},zt.Deselect)}deselectAllOnEmpty(i){wi(i.loci)&&this.deselectAll()}mark(i,s){let{loci:a}=i;if(!Xt.isEmpty(a))if(ce.Loci.is(a)){let l=this.sel.getLoci(a.structure);super.mark({loci:qe.Loci(a.structure)},zt.Deselect,!Xt.isEmpty(l)),super.mark({loci:l},zt.Select)}else super.mark(i,s)}toggleSel(i){this.sel.has(i.loci)?(this.sel.modify("remove",i.loci),this.mark(i,zt.Deselect)):(this.sel.modify("add",i.loci),this.mark(i,zt.Select))}}e.LociSelectManager=n})(av||(av={}));function zYe(e,t){var r;let n=[],o=t==="auth"?"auth_asym_id":"label_asym_id",i=t==="auth"?"auth_seq_id":"label_seq_id";for(let a of e)if(a.kind==="range")n.push(ye.struct.generator.atomGroups({"chain-test":ye.core.rel.eq([ye.ammp(o),a.asym_id]),"residue-test":ye.core.rel.inRange([ye.ammp(i),a.seq_id_beg,a.seq_id_end])}));else{let l=((r=a.ins_code)!==null&&r!==void 0?r:"").trim();n.push(ye.struct.generator.atomGroups({"chain-test":ye.core.rel.eq([ye.ammp(o),a.asym_id]),"residue-test":ye.core.logic.and([ye.core.rel.eq([ye.ammp(i),a.seq_id]),ye.core.rel.eq([ye.ammp("pdbx_PDB_ins_code"),l])])}))}let s=ye.struct.combinator.merge(n);return $p(s)}function HYe(e){let t=vn.create();for(let[n,o]of e)for(let i=n;i<=o;i++)vn.add(t,i,i);let r=ye.struct.generator.atomGroups({"atom-test":ye.core.set.has([ye.set(...t.array),ye.ammp("id")])});return $p(r)}function jYe(e,t,r){if(!(!e||t.length===0||Number.isNaN(+t[0])))return Number.isNaN(r)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:r}}function $Ye(e){return e?e.split(":"):[]}function WYe(e){return e.split(",").map(t=>t.trim().split(/\s+|[-]/g).filter(r=>!!r)).map(t=>jYe(t[0],$Ye(t[1]),+t[2])).filter(t=>!!t)}function qYe(e){return e.split(",").map(t=>t.trim().split(/\s+|[-]/g).filter(r=>!!r)).filter(t=>t.length===1||t.length===2).map(t=>t.length===1?[+t[0],+t[0]]:[+t[0],+t[1]])}function dve(e,t){if(t==="atom-id"){let r=qYe(e);return HYe(r)}else{let r=WYe(e);return zYe(r,t)}}var Ar=ar(un()),QR=ar(hi());function ZYe(e){return Object.keys(e).map(t=>[t,e[t]]).filter(t=>Mt.isBinding(t[1]))}var ZS=class extends QR.PureComponent{getBindingComponents(){let t=ZYe(this.props.bindings);return(0,Ar.jsx)(Ar.Fragment,{children:t.map(r=>{let[n,o]=r;return Mt.isEmpty(o)?null:(0,Ar.jsxs)("div",{style:{marginBottom:"6px"},children:[(0,Ar.jsx)("b",{children:o.action}),(0,Ar.jsx)("br",{}),(0,Ar.jsx)("span",{dangerouslySetInnerHTML:{__html:Mt.format(o,n)}})]},n)})})}render(){return(0,Ar.jsx)(Vd,{children:this.getBindingComponents()})}},Vd=class extends QR.PureComponent{render(){return(0,Ar.jsx)("div",{className:"msp-help-text",children:(0,Ar.jsx)("div",{children:this.props.children})})}},Gd=class extends QR.PureComponent{constructor(){super(...arguments),this.state={header:this.props.header,isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,Ar.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,Ar.jsx)("div",{className:"msp-control-group-header",children:(0,Ar.jsxs)(or,{onClick:this.toggleExpanded,children:[(0,Ar.jsx)(an,{svg:this.state.isExpanded?Bc:Lc}),this.props.header]})}),this.state.isExpanded&&(0,Ar.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"},children:this.props.children})]})}};function O6(e){return(0,Ar.jsx)("div",{className:"msp-simple-help-section",children:e.header})}var k1=class extends yr{constructor(){super(...arguments),this.getInteractionBindings=nu(t=>{let r;return t.forEach(n=>{var o;let i=(o=n.params)===null||o===void 0?void 0:o.values;i?.bindings&&Object.keys(i.bindings).length>0&&(r||(r={}),Object.assign(r,i.bindings))}),r})}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}render(){let t=this.getInteractionBindings(this.plugin.state.behaviors.cells);return(0,Ar.jsxs)(Ar.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&(0,Ar.jsx)(Gd,{header:"Moving in 3D",children:(0,Ar.jsx)(ZS,{bindings:this.plugin.canvas3d.props.trackball.bindings})},"trackball"),!!t&&(0,Ar.jsx)(Gd,{header:"Mouse & Key Controls",children:(0,Ar.jsx)(ZS,{bindings:t})},"interactions")]})}},YR=class extends yr{componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}formatTriggers(t){return t.triggers.map(r=>Mt.Trigger.format(r)).join(" or ")}getTriggerFor(t,r){let o=this.plugin.state.behaviors.select(Kt.Generators.ofTransformer(t)),i=o.length===1?o[0].params:void 0,s=i?i.values.bindings:{},a=r in s?s[r]:Mt.Empty;return this.formatTriggers(a)}render(){let t=this.getTriggerFor(w9,"clickSelectToggle"),r=this.getTriggerFor(o1,"clickFocus");return(0,Ar.jsxs)("div",{children:[(0,Ar.jsx)(O6,{header:"Interface Controls"}),(0,Ar.jsxs)(Gd,{header:"Inline Help",children:[(0,Ar.jsx)(Vd,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."}),(0,Ar.jsx)(Vd,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."})]}),(0,Ar.jsx)(Gd,{header:"Selections",children:(0,Ar.jsxs)(Vd,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",(0,Ar.jsxs)("ul",{style:{paddingLeft:"20px"},children:[(0,Ar.jsxs)("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",t," (for more see help section on ",(0,Ar.jsx)("i",{children:"Mouse Controls"}),")"]}),(0,Ar.jsxs)("li",{children:["using the ",(0,Ar.jsx)("i",{children:"Add"}),", ",(0,Ar.jsx)("i",{children:"Remove"})," and ",(0,Ar.jsx)("i",{children:"Only"})," dropdown buttons in the ",(0,Ar.jsx)("i",{children:"Manage Selection"})," panel which allow modifing the current selection by predefined sets"]})]})]})}),(0,Ar.jsx)(Gd,{header:"Coloring",children:(0,Ar.jsxs)(Vd,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",(0,Ar.jsx)("i",{children:"Structure Settings"})," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",(0,Ar.jsx)("i",{children:"Selections"}),") and, second, choose a color from the color dropdown botton in the ",(0,Ar.jsx)("i",{children:"Selection"})," row of the ",(0,Ar.jsx)("i",{children:"Change Representation"})," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]})}),(0,Ar.jsx)(Gd,{header:"Representations",children:(0,Ar.jsxs)(Vd,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",(0,Ar.jsx)("i",{children:"Change Representation"})," panel offers a collection of predefined styles which can be applied using the ",(0,Ar.jsx)("i",{children:"Preset"})," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",(0,Ar.jsx)("i",{children:"Selections"}),") and, second, choose a representation to hide or show from the ",(0,Ar.jsx)("i",{children:"Show"})," and ",(0,Ar.jsx)("i",{children:"Hide"})," dropdown bottons in the ",(0,Ar.jsx)("i",{children:"Selection"})," row of the ",(0,Ar.jsx)("i",{children:"Change Representation"})," panel. The ",(0,Ar.jsx)("i",{children:"Everything"})," row applies the action to the whole structure instead of the current selection."]})}),(0,Ar.jsx)(Gd,{header:"Surroundings",children:(0,Ar.jsxs)(Vd,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",r,"."]})}),(0,Ar.jsx)(O6,{header:"How-to Guides"}),(0,Ar.jsx)(Gd,{header:"Create an Image",children:(0,Ar.jsxs)(Vd,{children:[(0,Ar.jsxs)("p",{children:["Use the ",(0,Ar.jsx)(an,{svg:vge})," icon in the viewport to bring up the screenshot controls."]}),(0,Ar.jsxs)("p",{children:["To adjust the size of the image, use the ",(0,Ar.jsx)("i",{children:"Resolution"})," dropdown."]})]})}),(0,Ar.jsx)(O6,{header:"Mouse Controls"}),(0,Ar.jsx)(k1,{})]})}};var lv=class extends Xo{constructor(){super(...arguments),this._toggleSelMode=()=>{this.plugin.selectionMode=!this.plugin.selectionMode}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){let t=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"};return(0,Lr.jsx)(Jt,{svg:kge,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:t,toggleState:this.plugin.selectionMode})}},KYe={granularity:av.Params.granularity},KS=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]),JR=class extends yr{constructor(){super(...arguments),this.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},this.set=(t,r)=>{this.plugin.managers.structure.selection.fromSelectionQuery(t,r,!1)},this.selectQuery=(t,r)=>{if(!t||!this.state.action){this.setState({action:void 0});return}let n=this.state.action;r?.shiftKey?this.set(n,t.value):this.setState({action:void 0},()=>{this.set(n,t.value)})},this.selectHelper=(t,r)=>{if(!t||!this.state.action){this.setState({action:void 0,helper:void 0});return}this.setState({helper:t.value.kind})},this.queriesItems=[],this.queriesVersion=-1,this.helpersItems=void 0,this.toggleAdd=this.showAction("add"),this.toggleRemove=this.showAction("remove"),this.toggleIntersect=this.showAction("intersect"),this.toggleSet=this.showAction("set"),this.toggleTheme=this.showAction("theme"),this.toggleAddComponent=this.showAction("add-component"),this.toggleHelp=this.showAction("help"),this.setGranuality=({value:t})=>{this.plugin.managers.interactivity.setProps({granularity:t})},this.turnOff=()=>this.plugin.selectionMode=!1,this.undo=()=>{let t=this.plugin.state.data.undo();t&&this.plugin.runTask(t)},this.subtract=()=>{let t=this.plugin.managers.structure.hierarchy.getStructuresWithSelection(),r=[];for(let n of t)r.push(...n.components);r.length!==0&&this.plugin.managers.structure.component.modifyByCurrentSelection(r,"subtract")}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{let r=t.hierarchy.structures.length===0;this.state.isEmpty!==r&&this.setState({isEmpty:r}),this.queriesVersion=-1,this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:t})=>{this.setState({canUndo:t.canUndo})})}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get structures(){var t;let r=[];for(let n of this.plugin.managers.structure.hierarchy.selection.structures){let o=(t=n.cell.obj)===null||t===void 0?void 0:t.data;o&&r.push(o)}return r}get queries(){let{registry:t}=this.plugin.query.structure;if(t.version!==this.queriesVersion){let r=this.structures,n=[...t.list,...Kse(r),...Zse(r),...qse(r)].sort((o,i)=>i.priority-o.priority);this.queriesItems=hr.createItems(n,{filter:o=>o!==Ai.current&&!o.isHidden,label:o=>o.label,category:o=>o.category,description:o=>o.description}),this.queriesVersion=t.version}return this.queriesItems}get helpers(){if(this.helpersItems)return this.helpersItems;let t=[{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}];return this.helpersItems=hr.createItems(t,{label:r=>r.label,category:r=>r.category,description:r=>r.description}),this.helpersItems}showAction(t){return()=>this.setState({action:this.state.action===t?void 0:t,helper:void 0})}render(){let t=this.plugin.managers.interactivity.props.granularity,r=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone.",n;if(this.state.action&&!this.state.helper)n=(0,Lr.jsxs)(Lr.Fragment,{children:[this.state.action&&this.state.action!=="theme"&&this.state.action!=="add-component"&&this.state.action!=="help"&&(0,Lr.jsxs)("div",{className:"msp-selection-viewport-controls-actions",children:[(0,Lr.jsx)(hr,{header:KS.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0}),(0,Lr.jsx)(hr,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0})]}),this.state.action==="theme"&&(0,Lr.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Lr.jsx)(zl,{header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:hu,children:(0,Lr.jsx)(V6,{onApply:this.toggleTheme})})}),this.state.action==="add-component"&&(0,Lr.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Lr.jsx)(zl,{header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:hu,children:(0,Lr.jsx)(E_,{onApply:this.toggleAddComponent,forSelection:!0})})}),this.state.action==="help"&&(0,Lr.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Lr.jsxs)(zl,{header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:hu,maxHeight:"300px",children:[(0,Lr.jsx)(Gd,{header:"Selection Operations",children:(0,Lr.jsxs)(Vd,{children:["Use ",(0,Lr.jsx)(an,{svg:Ww,inline:!0})," ",(0,Lr.jsx)(an,{svg:qw,inline:!0})," ",(0,Lr.jsx)(an,{svg:Zw,inline:!0})," ",(0,Lr.jsx)(an,{svg:g1,inline:!0})," to modify the selection."]})}),(0,Lr.jsx)(Gd,{header:"Representation Operations",children:(0,Lr.jsxs)(Vd,{children:["Use ",(0,Lr.jsx)(an,{svg:$M,inline:!0})," ",(0,Lr.jsx)(an,{svg:Kw,inline:!0})," ",(0,Lr.jsx)(an,{svg:e_,inline:!0})," ",(0,Lr.jsx)(an,{svg:t_,inline:!0})," to color, create components, remove from components, or undo actions."]})}),(0,Lr.jsx)(k1,{selectOnly:!0})]})})]});else if(KS.has(this.state.action)&&this.state.helper==="residue-list"){let o=()=>this.setState({action:void 0,helper:void 0});n=(0,Lr.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,Lr.jsx)(zl,{header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:o,topRightIcon:hu,children:(0,Lr.jsx)(YYe,{modifier:this.state.action,plugin:this.plugin,close:o})})})}return(0,Lr.jsxs)(Lr.Fragment,{children:[(0,Lr.jsxs)("div",{className:"msp-flex-row",style:{background:"none"},children:[(0,Lr.jsx)(uh,{title:"Picking Level for selecting and highlighting",param:KYe.granularity,name:"granularity",value:t,onChange:this.setGranuality,isDisabled:this.isDisabled}),(0,Lr.jsx)(gi,{icon:Ww,title:`${KS.get("add")}. Hold shift key to keep menu open.`,toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.isDisabled}),(0,Lr.jsx)(gi,{icon:qw,title:`${KS.get("remove")}. Hold shift key to keep menu open.`,toggle:this.toggleRemove,isSelected:this.state.action==="remove",disabled:this.isDisabled}),(0,Lr.jsx)(gi,{icon:Zw,title:`${KS.get("intersect")}. Hold shift key to keep menu open.`,toggle:this.toggleIntersect,isSelected:this.state.action==="intersect",disabled:this.isDisabled}),(0,Lr.jsx)(gi,{icon:g1,title:`${KS.get("set")}. Hold shift key to keep menu open.`,toggle:this.toggleSet,isSelected:this.state.action==="set",disabled:this.isDisabled}),(0,Lr.jsx)(gi,{icon:$M,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:this.state.action==="theme",disabled:this.isDisabled,style:{marginLeft:"10px"}}),(0,Lr.jsx)(gi,{icon:Kw,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:this.state.action==="add-component",disabled:this.isDisabled}),(0,Lr.jsx)(Jt,{svg:e_,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled}),(0,Lr.jsx)(Jt,{svg:t_,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:r}),(0,Lr.jsx)(gi,{icon:Nc,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:this.state.action==="help"}),this.plugin.config.get(Ot.Viewport.ShowSelectionMode)&&(0,Lr.jsx)(Jt,{svg:Xw,title:"Turn selection mode off",onClick:this.turnOff})]}),n]})}},eB=class extends yr{constructor(){super(...arguments),this.state={isEmpty:!0,isBusy:!1},this.clear=()=>this.plugin.managers.interactivity.lociSelects.deselectAll(),this.focus=()=>{if(this.plugin.managers.structure.selection.stats.elementCount===0)return;let{sphere:t}=this.plugin.managers.structure.selection.getBoundary();this.plugin.managers.camera.focusSphere(t)},this.highlight=t=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights(),this.plugin.managers.structure.selection.entries.forEach(r=>{this.plugin.managers.interactivity.lociHighlights.highlight({loci:r.selection},!1)})},this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{let r=t.structures.length===0;this.state.isEmpty!==r&&this.setState({isEmpty:r})}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get stats(){let t=this.plugin.managers.structure.selection.stats;return t.structureCount===0||t.elementCount===0?"Nothing Selected":`${_p(t.label)} Selected`}render(){let t=this.plugin.managers.structure.selection.stats,r=t.structureCount===0||t.elementCount===0;return r&&this.props.hideOnEmpty?null:(0,Lr.jsx)(Lr.Fragment,{children:(0,Lr.jsxs)("div",{className:"msp-flex-row",children:[(0,Lr.jsx)(or,{noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:r,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:r?void 0:"left"},children:this.stats}),!r&&(0,Lr.jsx)(Jt,{svg:Xw,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0})]})})}},V6=class extends Xo{constructor(){super(...arguments),this._params=nu(t=>od.getThemeParams(this.plugin,t)),this.state={values:M.getDefaultValues(this.params)},this.apply=()=>{var t,r;this.plugin.managers.structure.component.applyTheme(this.state.values,this.plugin.managers.structure.hierarchy.current.structures),(r=(t=this.props).onApply)===null||r===void 0||r.call(t)},this.paramsChanged=t=>this.setState({values:t})}get params(){return this._params(this.plugin.managers.structure.component.pivotStructure)}render(){return(0,Lr.jsxs)(Lr.Fragment,{children:[(0,Lr.jsx)(An,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,Lr.jsx)(or,{icon:$M,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Apply Theme"})]})}},pve={idType:M.Select("auth",M.arrayToOptions(["auth","label","atom-id"])),identifiers:M.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},XYe=M.getDefaultValues(pve);function YYe({modifier:e,plugin:t,close:r}){let[n,o]=mve.useState(XYe),i=()=>{if(n.identifiers.trim().length!==0)try{r();let s=dve(n.identifiers,n.idType);t.managers.structure.selection.fromCompiledQuery(e,s,!1)}catch{t.log.error("Failed to create selection")}};return(0,Lr.jsxs)(Lr.Fragment,{children:[(0,Lr.jsx)(An,{params:pve,values:n,onChangeValues:o,onEnter:i}),(0,Lr.jsxs)(or,{className:"msp-btn-commit msp-btn-commit-on",disabled:n.identifiers.trim().length===0,onClick:i,style:{marginTop:"1px"},children:[nm(e)," Selection"]})]})}var tB=class extends il{defaultState(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:pge}}}renderControls(){return(0,dn.jsxs)(dn.Fragment,{children:[(0,dn.jsx)(U6,{}),(0,dn.jsx)(G6,{})]})}},G6=class extends Xo{componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()})}renderGroup(t,r){let n=[];for(let o of t)o.obj&&n.push((0,dn.jsx)(H6,{cell:o},o.obj.id));return n.length?(0,dn.jsx)(lo,{header:r,initiallyExpanded:!0,children:n}):null}render(){let t=this.plugin.managers.structure.measurement.state;return(0,dn.jsxs)("div",{style:{marginTop:"6px"},children:[this.renderGroup(t.labels,"Labels"),this.renderGroup(t.distances,"Distances"),this.renderGroup(t.angles,"Angles"),this.renderGroup(t.dihedrals,"Dihedrals"),this.renderGroup(t.orientations,"Orientations"),this.renderGroup(t.planes,"Planes")]})}},U6=class extends Xo{constructor(){super(...arguments),this.state={isBusy:!1,action:void 0},this.measureDistance=()=>{let t=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDistance(t[0].loci,t[1].loci)},this.measureAngle=()=>{let t=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addAngle(t[0].loci,t[1].loci,t[2].loci)},this.measureDihedral=()=>{let t=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDihedral(t[0].loci,t[1].loci,t[2].loci,t[3].loci)},this.addLabel=()=>{let t=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addLabel(t[0].loci)},this.addOrientation=()=>{let t=[];this.plugin.managers.structure.selection.entries.forEach(r=>{t.push(r.selection)}),this.plugin.managers.structure.measurement.addOrientation(t)},this.addPlane=()=>{let t=[];this.plugin.managers.structure.selection.entries.forEach(r=>{t.push(r.selection)}),this.plugin.managers.structure.measurement.addPlane(t)},this.selectAction=t=>{this.toggleAdd(),t&&(0,t?.value)()},this.toggleAdd=()=>this.setState({action:this.state.action==="add"?void 0:"add"}),this.toggleOptions=()=>this.setState({action:this.state.action==="options"?void 0:"options"})}componentDidMount(){this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate(),this.updateOrderLabels()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}componentWillUnmount(){this.clearOrderLabels(),super.componentWillUnmount()}componentDidUpdate(t,r){this.state.action!==r.action&&this.updateOrderLabels()}clearOrderLabels(){this.plugin.managers.structure.measurement.addOrderLabels([])}updateOrderLabels(){if(this.state.action!=="add"){this.clearOrderLabels();return}let t=[],r=this.selection.additionsHistory;for(let n=0;n<r.length&&n<4;n++)t.push(r[n].loci);this.plugin.managers.structure.measurement.addOrderLabels(t)}get selection(){return this.plugin.managers.structure.selection}get actions(){let t=this.selection.additionsHistory;return[{kind:"item",label:`Label ${t.length===0?" (1 selection item required)":" (1st selection item)"}`,value:this.addLabel,disabled:t.length===0},{kind:"item",label:`Distance ${t.length<2?" (2 selection items required)":" (top 2 selection items)"}`,value:this.measureDistance,disabled:t.length<2},{kind:"item",label:`Angle ${t.length<3?" (3 selection items required)":" (top 3 items)"}`,value:this.measureAngle,disabled:t.length<3},{kind:"item",label:`Dihedral ${t.length<4?" (4 selection items required)":" (top 4 selection items)"}`,value:this.measureDihedral,disabled:t.length<4},{kind:"item",label:`Orientation ${t.length===0?" (selection required)":" (current selection)"}`,value:this.addOrientation,disabled:t.length===0},{kind:"item",label:`Plane ${t.length===0?" (selection required)":" (current selection)"}`,value:this.addPlane,disabled:t.length===0}]}highlight(t){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:t},!1)}moveHistory(t,r){this.plugin.managers.structure.selection.modifyHistory(t,r,4)}focusLoci(t){this.plugin.managers.camera.focusLoci(t)}historyEntry(t,r){let n=this.plugin.managers.structure.selection.additionsHistory;return(0,dn.jsxs)("div",{className:"msp-flex-row",onMouseEnter:()=>this.highlight(t.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[(0,dn.jsxs)(or,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(t.loci),style:{width:"auto",textAlign:"left"},children:[r,". ",(0,dn.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}})]}),n.length>1&&(0,dn.jsx)(Jt,{svg:ev,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(t,"up"),flex:"20px",title:"Move up"}),n.length>1&&(0,dn.jsx)(Jt,{svg:Jy,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(t,"down"),flex:"20px",title:"Move down"}),(0,dn.jsx)(Jt,{svg:Fa,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(t,"remove"),flex:!0,title:"Remove"})]},t.id)}add(){let t=this.plugin.managers.structure.selection.additionsHistory,r=[];for(let i=0,s=Math.min(t.length,4);i<s;i++)r.push(this.historyEntry(t[i],i+1));let o=this.plugin.config.get(Ot.Viewport.ShowSelectionMode)?(0,dn.jsxs)(dn.Fragment,{children:[" ","(toggle ",(0,dn.jsx)(lv,{inline:!0})," mode)"]}):null;return(0,dn.jsxs)(dn.Fragment,{children:[(0,dn.jsx)(hr,{items:this.actions,onSelect:this.selectAction}),r.length>0&&(0,dn.jsx)("div",{className:"msp-control-offset",children:r}),r.length===0&&(0,dn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,dn.jsxs)("div",{className:"msp-help-description",children:[(0,dn.jsx)(an,{svg:Nc,inline:!0}),"Add one or more selections",o]})})]})}render(){return(0,dn.jsxs)(dn.Fragment,{children:[(0,dn.jsxs)("div",{className:"msp-flex-row",children:[(0,dn.jsx)(gi,{icon:nf,label:"Add",toggle:this.toggleAdd,isSelected:this.state.action==="add",disabled:this.state.isBusy,className:"msp-btn-apply-simple"}),(0,dn.jsx)(gi,{icon:gu,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),this.state.action==="add"&&this.add(),this.state.action==="options"&&(0,dn.jsx)(z6,{})]})}},z6=class extends Xo{constructor(){super(...arguments),this.state={isDisabled:!1},this.changed=t=>{this.plugin.managers.structure.measurement.setOptions(t)}}componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isDisabled:t})})}render(){let t=this.plugin.managers.structure.measurement.state;return(0,dn.jsx)("div",{className:"msp-control-offset",children:(0,dn.jsx)(An,{params:F6,values:t.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled})})}},H6=class extends Xo{constructor(){super(...arguments),this.state={showUpdate:!1},this.delete=()=>{ht.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent,removeParentGhosts:!0})},this.toggleVisibility=t=>{t.preventDefault(),ht.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent}),t.currentTarget.blur()},this.highlight=()=>{var t;if(!this.selections)return;this.plugin.managers.interactivity.lociHighlights.clearHighlights();for(let o of this.lociArray)this.plugin.managers.interactivity.lociHighlights.highlight({loci:o},!1);let n=(t=this.props.cell.obj)===null||t===void 0?void 0:t.data.repr.getAllLoci();if(n)for(let o of n)this.plugin.managers.interactivity.lociHighlights.highlight({loci:o},!1)},this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()},this.toggleUpdate=()=>this.setState({showUpdate:!this.state.showUpdate}),this.focus=()=>{if(!this.selections)return;let r=Xt.getBundleBoundingSphere({loci:this.lociArray});r&&this.plugin.managers.camera.focusSphere(r)},this.selectAction=t=>{t&&(this.setState({showUpdate:!1}),(0,t?.value)())}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{this.forceUpdate()})}get selections(){var t;return(t=this.props.cell.obj)===null||t===void 0?void 0:t.data.sourceData}get lociArray(){let t=this.selections;return t?t.infos?[t.infos[0].loci]:t.pairs?t.pairs[0].loci:t.triples?t.triples[0].loci:t.quads?t.quads[0].loci:t.locis?t.locis:[]:[]}get label(){let t=this.selections;return t?t.infos?Mm(t.infos[0].loci,{condensed:!0}):t.pairs?YC(t.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):t.triples?QC(t.triples[0],{condensed:!0}):t.quads?JC(t.quads[0],{condensed:!0}):t.locis?Cy(t.locis,{countsOnly:!0}):"<empty>":"<empty>"}get actions(){return this.props.cell.sourceRef,[hr.Item("Select This",()=>this.plugin.managers.structure.selection.fromSelections(this.props.cell.sourceRef),{icon:g1})]}render(){let{cell:t}=this.props,{obj:r}=t;return r?(0,dn.jsxs)(dn.Fragment,{children:[(0,dn.jsxs)("div",{className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,children:[(0,dn.jsx)("button",{className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"},children:(0,dn.jsx)("span",{dangerouslySetInnerHTML:{__html:this.label}})}),(0,dn.jsx)(Jt,{svg:t.state.isHidden?uc:dc,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:t.state.isHidden?"Show":"Hide"}),(0,dn.jsx)(Jt,{svg:Fa,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1}),(0,dn.jsx)(Jt,{svg:Um,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate})]},r.id),this.state.showUpdate&&t.parent&&(0,dn.jsx)(dn.Fragment,{children:(0,dn.jsxs)("div",{className:"msp-accent-offset",children:[(0,dn.jsx)(hr,{items:this.actions,onSelect:this.selectAction,noOffset:!0}),(0,dn.jsx)(lo,{header:"Options",noOffset:!0,children:(0,dn.jsx)(Oa,{state:t.parent,transform:t.transform,customHeader:"none",autoHideApply:!0})})]})})]}):null}};var pc=ar(un());var ph=ar(un());function j6(e,t,r,n){let o=Qe.indexOf(t.unit.elements,t.element),i=ce.Loci(t.structure,[{unit:t.unit,indices:Ge.ofSingleton(o)}]),s=n==="residue"?ce.Loci.extendToWholeResidues(i):ce.Loci.extendToWholeChains(i),a=nt.entity.pdbx_description(t).join(", ");for(let l of r.units){let c=ce.Loci(s.structure,[{unit:l,indices:s.elements[0].indices}]),u=Mm(c,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:n});u||(u=Mm(c,{hidePrefix:!1,htmlStyling:!1})),r.units.length>1&&(u+=` | ${c.elements[0].unit.conformation.operator.name}`);let d={label:u,category:a,loci:c};e.has(a)?e.get(a).push(d):e.set(a,[d])}}function QYe(e){let t=new Map,r=ce.Location.create(e);for(let o of e.unitSymmetryGroups){if(!Le.isAtomic(o.units[0]))continue;r.unit=o.units[0],r.element=o.elements[0];let i=Le.Traits.is(r.unit.traits,Le.Trait.MultiChain),s=nt.entity.type(r),a=s==="non-polymer",l=s==="branched";if(!!nt.entity.prd_id(r))j6(t,r,o,"chain");else if(a&&!i)j6(t,r,o,"residue");else if(l||a&&i){let u=r.unit,{index:d}=u.model.atomicHierarchy.residueAtomSegments,m=-1;for(let p=0,h=u.elements.length;p<h;++p){let f=u.elements[p],C=d[f];C!==m&&(r.element=f,j6(t,r,o,"residue"),m=C)}}}let n=[];return t.forEach((o,i)=>{o.length===1?n.push({label:`${i}: ${o[0].label}`,loci:o[0].loci}):o.length<2e3&&n.push(...o)}),n}var rB=class extends yr{constructor(){super(...arguments),this.state={isBusy:!1,showAction:!1},this.getSelectionItems=nu(t=>{var r;let n=[];for(let o of t){let i=(r=o.cell.obj)===null||r===void 0?void 0:r.data;if(i){let s=QYe(i);s.length>0&&n.push([hr.Header(i.label,{description:i.label}),...hr.createItems(s,{label:a=>a.label,category:a=>a.category,description:a=>a.label})])}}return n}),this.selectAction=(t,r)=>{if(!t||!this.state.showAction){this.setState({showAction:!1});return}let n=t.value;r?.shiftKey?this.plugin.managers.structure.focus.addFromLoci(n.loci):this.plugin.managers.structure.focus.set(n),this.focusCamera()},this.toggleAction=()=>this.setState({showAction:!this.state.showAction}),this.focusCamera=()=>{let{current:t}=this.plugin.managers.structure.focus;t&&this.plugin.managers.camera.focusLoci(t.loci)},this.clear=()=>{this.plugin.managers.structure.focus.clear(),this.plugin.managers.camera.reset()},this.highlightCurrent=()=>{let{current:t}=this.plugin.managers.structure.focus;t&&this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:t.loci},!1)},this.clearHighlights=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.focus.behaviors.current,t=>{this.getSelectionItems([]),this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,t=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t,showAction:!1})})}get isDisabled(){return this.state.isBusy||this.plugin.managers.structure.hierarchy.selection.structures.length===0}get actionItems(){let t=[],{history:r}=this.plugin.managers.structure.focus;r.length>0&&t.push([hr.Header("History",{description:"Previously focused on items."}),...hr.createItems(r,{label:i=>i.label,description:i=>i.category&&i.label!==i.category?`${i.category} | ${i.label}`:i.label})]);let n=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);if(n.length===1){let s=n[0][0];s.initiallyExpanded=!0}let o=[];return n.length>0&&o.push(...n),t.length>0&&o.push(...t),o}getToggleBindingLabel(){var t;let r=this.plugin.state.behaviors.transforms.get(o1.id);if(!r)return"";let n=(t=r.params)===null||t===void 0?void 0:t.bindings.clickFocus;return!n||Mt.isEmpty(n)?"":Mt.formatTriggers(n)}render(){let{current:t}=this.plugin.managers.structure.focus,r=t?.label||"Nothing Focused",n="Click to Center Camera";if(!t){n="Select focus using the menu";let o=this.getToggleBindingLabel();o&&(n+=`
or use '${o}' on element`)}return(0,ph.jsxs)(ph.Fragment,{children:[(0,ph.jsxs)("div",{className:"msp-flex-row",children:[(0,ph.jsx)(or,{noOverflow:!0,onClick:this.focusCamera,title:n,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!t,style:{textAlignLast:t?"left":void 0},children:r}),t&&(0,ph.jsx)(Jt,{svg:Xw,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled}),(0,ph.jsx)(gi,{icon:bge,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}})]}),this.state.showAction&&(0,ph.jsx)(hr,{items:this.actionItems,onSelect:this.selectAction})]})}};var nB=class extends il{constructor(){super(...arguments),this.item=t=>{var r,n,o,i,s,a,l,c,u;let d=this.plugin.managers.structure.hierarchy.seletionSet,m;switch(t.kind){case"model":{let h=(r=t.cell.obj)===null||r===void 0?void 0:r.data;h&&Ut.TrajectoryInfo.get(h).size>1&&(m=`${(n=t.cell.obj)===null||n===void 0?void 0:n.data.entryId} | Model ${Ut.TrajectoryInfo.get(h).index+1} of ${Ut.TrajectoryInfo.get(h).size}`),m=`${(o=t.cell.obj)===null||o===void 0?void 0:o.data.entryId} | ${(i=t.cell.obj)===null||i===void 0?void 0:i.label}`;break}case"structure":{let h=(s=t.cell.obj)===null||s===void 0?void 0:s.data.models[0];if(h&&Ut.TrajectoryInfo.get(h).size>1){m=`${h.entryId} | ${(a=t.cell.obj)===null||a===void 0?void 0:a.label} (Model ${Ut.TrajectoryInfo.get(h).index+1} of ${Ut.TrajectoryInfo.get(h).size})`;break}else if(h){m=`${h.entryId} | ${(l=t.cell.obj)===null||l===void 0?void 0:l.label}`;break}else{m=`${(c=t.cell.obj)===null||c===void 0?void 0:c.label}`;break}}default:m=(u=t.cell.obj)===null||u===void 0?void 0:u.label;break}return{kind:"item",label:m||t.kind,selected:d.has(t.cell.transform.ref),value:[t]}},this.getTrajectoryItems=t=>{var r;return t.models.length===0?this.item(t):[hr.Header((r=t.cell.obj)===null||r===void 0?void 0:r.label),...t.models.map(this.getModelItems)]},this.getModelItems=t=>{var r,n,o;if(t.structures.length===0)return this.item(t);if(t.structures.length===1){let i=this.plugin.managers.structure.hierarchy.seletionSet,s=t.structures[0];return{label:`${(r=t.cell.obj)===null||r===void 0?void 0:r.label} | ${(n=s.cell.obj)===null||n===void 0?void 0:n.label}`,selected:i.has(s.cell.transform.ref),value:[t,s]}}return[hr.Header((o=t.cell.obj)===null||o===void 0?void 0:o.label),...t.structures.map(this.item)]},this.selectHierarchy=t=>{if(!t||t.length===0)return;let r=[];for(let n of t)for(let o of n.value)r.push(o);this.plugin.managers.structure.hierarchy.updateCurrent(r,t[0].selected?"remove":"add")},this.toggleHierarchy=()=>this.setState({show:this.state.show!=="hierarchy"?"hierarchy":void 0}),this.togglePreset=()=>this.setState({show:this.state.show!=="presets"?"presets":void 0}),this.applyPreset=t=>{if(this.setState({show:void 0}),!t)return;let r=this.plugin.managers.structure,{trajectories:n}=r.hierarchy.selection;r.hierarchy.applyPreset(n,t.value)},this.updateModelQueueParams=void 0,this.isUpdatingModel=!1,this.updateStructureModel=t=>{this.updateModelQueueParams=t,this._updateStructureModel()},this.updateStructure=t=>{let{selection:r}=this.plugin.managers.structure.hierarchy,n=r.structures[0];return this.plugin.managers.structure.hierarchy.updateStructure(n,t)}}defaultState(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:dge}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get hierarchyItems(){let t=this.plugin.managers.structure.hierarchy,{current:r}=t,n=[];return r.trajectories.length>1&&n.push([hr.Header("Trajectories"),...r.trajectories.map(this.item)]),(r.models.length>1||r.trajectories.length>1)&&n.push([hr.Header("Models"),...r.models.map(this.item)]),r.trajectories.length===1&&r.models.length===1?n.push(...r.structures.map(this.item)):r.structures.length>0&&n.push([hr.Header("Structures"),...r.structures.map(this.item)]),n}get isEmpty(){let{structures:t,models:r,trajectories:n}=this.plugin.managers.structure.hierarchy.current;return n.length===0&&r.length===0&&t.length===0}get label(){var t,r,n,o,i,s,a,l,c,u,d,m,p,h;let{structures:f,models:C,trajectories:g}=this.plugin.managers.structure.hierarchy.selection;if(f.length===1){let b=f[0];return!((r=(t=b.model)===null||t===void 0?void 0:t.trajectory)===null||r===void 0)&&r.models&&b.model.trajectory.models.length===1?(n=b.cell.obj)===null||n===void 0?void 0:n.data.label:b.model?`${(o=b.model.cell.obj)===null||o===void 0?void 0:o.label} | ${(i=b.cell.obj)===null||i===void 0?void 0:i.data.label}`:(s=b.cell.obj)===null||s===void 0?void 0:s.data.label}if(f.length>1){let b=f[0],y=(a=b?.model)===null||a===void 0?void 0:a.trajectory,x=!0;for(let A of f)if(((l=A?.model)===null||l===void 0?void 0:l.trajectory)!==y){x=!1;break}return x&&y?`${(c=y.cell.obj)===null||c===void 0?void 0:c.label} | ${f.length} structures`:`${f.length} structures`}if(C.length>0){let b=C[0].trajectory;if(C.length===1){let x=(u=C[0].cell.obj)===null||u===void 0?void 0:u.data;return x&&Ut.TrajectoryInfo.get(x).size>1?`${(d=b?.cell.obj)===null||d===void 0?void 0:d.label} | Model ${Ut.TrajectoryInfo.get(x).index+1} of ${Ut.TrajectoryInfo.get(x).size}`:`${(m=b?.cell.obj)===null||m===void 0?void 0:m.label} | Model`}let y=!0;for(let x of C)if(x.trajectory!==b){y=!1;break}return y?`${(p=b?.cell.obj)===null||p===void 0?void 0:p.label} | ${C.length} models`:`${C.length} models`}return g.length>0?g.length===1?`${(h=g[0].cell.obj)===null||h===void 0?void 0:h.label} trajectory`:`${g.length} trajectories`:g.length===0&&C.length===0&&f.length===0?"Nothing Loaded":"Nothing Selected"}get presetActions(){let t=[],{trajectories:r}=this.plugin.managers.structure.hierarchy.selection;if(r.length===0)return t;let n=this.plugin.builders.structure.hierarchy.getPresets(r[0].cell.obj);if(r.length>1){let o=new Set(n);for(let i=1;i<r.length;i++){let s=this.plugin.builders.structure.hierarchy.getPresets(r[i].cell.obj),a=new Set(s);for(let l of s)a.has(l)||o.delete(l)}n=n.filter(i=>o.has(i))}for(let o of n)t.push(hr.Item(o.display.name,o,{description:o.display.description}));return t}async _updateStructureModel(){if(!this.updateModelQueueParams||this.isUpdatingModel)return;let t=this.updateModelQueueParams;this.updateModelQueueParams=void 0;try{this.isUpdatingModel=!0;let{selection:r}=this.plugin.managers.structure.hierarchy,n=r.structures[0].model;await this.plugin.state.updateTransform(this.plugin.state.data,n.cell.transform.ref,t,"Model Index")}finally{this.isUpdatingModel=!1,this._updateStructureModel()}}get modelIndex(){var t,r;let{selection:n}=this.plugin.managers.structure.hierarchy;if(n.structures.length!==1)return null;let o=n.structures[0].model;if(!o||o.cell.transform.transformer!==Je.Model.ModelFromTrajectory||!o.cell.obj||Ut.TrajectoryInfo.get(o.cell.obj.data).size<=1)return null;let i=(t=o.cell.params)===null||t===void 0?void 0:t.definition;return i?(0,pc.jsx)(An,{params:i,values:(r=o.cell.params)===null||r===void 0?void 0:r.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy}):null}get structureType(){var t;let{selection:r}=this.plugin.managers.structure.hierarchy;if(r.structures.length!==1)return null;let n=r.structures[0];return!((t=n.cell.params)===null||t===void 0?void 0:t.definition)||!n.cell.parent?null:(0,pc.jsx)(Oa,{state:n.cell.parent,transform:n.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0})}get transform(){let{selection:t}=this.plugin.managers.structure.hierarchy;if(t.structures.length!==1)return null;let r=t.structures[0];if(!r.cell.parent)return null;let n=Kt.tryFindDecorator(this.plugin.state.data,r.cell.transform.ref,Je.Model.TransformStructureConformation);if(n)return(0,pc.jsx)(lo,{header:"Conformation Transform",children:(0,pc.jsx)(Oa,{state:n.parent,transform:n.transform,customHeader:"none",noMargin:!0,autoHideApply:!0})})}renderControls(){let t=this.state.isBusy||this.isEmpty,r=this.presetActions,n=this.label;return(0,pc.jsxs)(pc.Fragment,{children:[(0,pc.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,pc.jsx)(or,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:t,title:n,children:n}),r.length>0&&(0,pc.jsx)(Jt,{svg:Ug,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="presets",disabled:t})]}),this.state.show==="hierarchy"&&(0,pc.jsx)(hr,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0}),this.state.show==="presets"&&(0,pc.jsx)(hr,{items:r,onSelect:this.applyPreset}),this.modelIndex,this.structureType,this.transform,(0,pc.jsxs)("div",{style:{marginTop:"6px"},children:[(0,pc.jsx)(rB,{}),(0,pc.jsx)(eB,{hideOnEmpty:!0})]})]})}};var Yo=ar(un());function hve(e,t){let r=rQe(e,t||oB());return aQe(e.tree,r),t&&t.refs.forEach(iQe,r),{hierarchy:r.hierarchy,added:r.added,changed:r.changed}}function oB(){return{volumes:[],lazyVolumes:[],refs:new Map}}function JYe(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function eQe(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function tQe(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function rQe(e,t){return{state:e,oldHierarchy:t,hierarchy:oB(),changed:!1,added:new Set}}function $6(e,t,r,n,...o){let i=n(...o);r.push(i),e.hierarchy.refs.set(t.transform.ref,i);let s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function nQe(e,t){return(r,n)=>!t(n)&&e.is(r.obj)}function fve(){}var oQe=[[nQe(fe.Volume.Data,e=>e.currentVolume),(e,t)=>{e.currentVolume=$6(e,t,e.hierarchy.volumes,JYe,t)},e=>e.currentVolume=void 0],[e=>fe.Volume.Lazy.is(e.obj),(e,t)=>{$6(e,t,e.hierarchy.lazyVolumes,eQe,t)},fve],[(e,t)=>!e.state.isGhost&&!!t.currentVolume&&fe.Volume.Representation3D.is(e.obj),(e,t)=>(e.currentVolume&&$6(e,t,e.currentVolume.representations,tQe,t,e.currentVolume),!1),fve]];function gve(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;let{obj:t}=e;return!(!t||t===Hn.Null||e.status!=="ok"&&e.status!=="error")}function iQe(e){let{cell:t}=e;gve(t)||(this.changed=!0)}function sQe(e){yve(this,this.tree.transforms.get(e))}function yve(e,t){let{state:r}=e,n=r.state.cells.get(t.ref);if(!gve(n))return;let o,i=!1;for(let[a,l,c]of oQe)if(a(n,r)){if(l(r,n)===!1){i=!0;break}o=c;break}if(i)return;let s=e.tree.children.get(t.ref);s&&s.size&&s.forEach(sQe,e),o&&o(r)}function aQe(e,t){let r={tree:e,state:t};return yve(r,e.root),r.state}var cv=class extends Xu{get dataState(){return this.plugin.state.data}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}sync(t){if(!t&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree){t&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection}));return}this.state.syncedTree=this.dataState.tree;let r=hve(this.plugin.state.data,this.current);if(!r.changed)return;let{hierarchy:n}=r;this.state.hierarchy=n,this.state.selection?this.state.selection=n.refs.has(this.state.selection.cell.transform.ref)?n.refs.get(this.state.selection.cell.transform.ref):n.volumes[0]:this.state.selection=n.volumes[0],t?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:n,volume:this.state.selection})):this.state.notified=!1}setCurrent(t){this.state.selection=t||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:t||this.state.hierarchy.volumes[0]})}remove(t,r){if(t.length===0)return;let n=this.plugin.state.data.build();for(let o of t)n.delete(typeof o=="string"?o:o.cell.transform.ref);return n.commit({canUndo:r?"Remove":!1})}toggleVisibility(t,r){if(t.length===0)return;let n=r!==void 0?r!=="show":!t[0].cell.state.isHidden;for(let o of t)vo(this.dataState,o.cell.transform.ref,n)}addRepresentation(t,r){var n;return this.dataState.build().to(t.cell).apply(Je.Representation.VolumeRepresentation3D,Ul(this.plugin,(n=t.cell.obj)===null||n===void 0?void 0:n.data,{type:r})).commit({canUndo:"Add Representation"})}constructor(t){super(),this.plugin=t,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:oB(),selection:void 0},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,volume:this.selection})},this.subscribe(t.state.data.events.changed,r=>{r.inTransaction||t.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(t.behaviors.state.isAnimating,r=>{!r&&!t.behaviors.state.isUpdating.value&&this.sync(!0)})}};(function(e){function t(r,n){var o,i;return!((o=n?.cell.obj)===null||o===void 0)&&o.data?r.representation.volume.registry.getApplicableTypes((i=n.cell.obj)===null||i===void 0?void 0:i.data):r.representation.volume.registry.types}e.getRepresentationTypes=t})(cv||(cv={}));var XS=class extends fe.Create({name:"Volume Streaming",typeClass:"Object"}){},vve;(function(e){let t;(function(r){r.Float32="float32",r.Int8="int8"})(t=e.ValueType||(e.ValueType={}))})(vve||(vve={}));function bve(e,t="x-ray"){if(!e)return t;let r=e.models[0];return qr.is(r.sourceData)?Ut.hasEmMap(r)?"em":Ut.hasXrayMap(r)?"x-ray":Ut.isFromEm(r)?"em":Ut.isFromXray(r)?"x-ray":t:t}function lQe(e){let t=[];if(!qr.is(e.sourceData))return[e.entryId];let{db_id:r,db_name:n,content_type:o}=e.sourceData.data.db.pdbx_database_related;if(!n.isDefined)return[e.entryId];for(let i=0,s=n.rowCount;i<s;++i)n.value(i).toUpperCase()==="EMDB"&&o.value(i)==="associated EM volume"&&t.push(r.value(i));return t}function cQe(e){return[e.entryId]}function xve(e,t){if(!t||!t.models.length)return[];let r=t.models[0];switch(e){case"em":return lQe(r);case"x-ray":return cQe(r)}}async function W6(e,t,r,n){switch(e){case"emdb":return q6(t,r,n);case"pdbe":return uQe(t,r,n)}}async function q6(e,t,r){let n=e.config.get(Ot.VolumeStreaming.EmdbHeaderServer),s=(await e.fetch({url:`${n}/${r.toUpperCase()}/header/${r.toLowerCase()}.xml`,type:"xml"}).runInContext(t)).getElementsByTagName("map")[0].getElementsByTagName("contour"),a=s[0];for(let c=1;c<s.length;c++)if(s[c].getAttribute("primary")==="true"){a=s[c];break}return parseFloat(a.getElementsByTagName("level")[0].textContent)}async function uQe(e,t,r){var n,o,i,s;r=r.toUpperCase();let a=await e.fetch({url:`https://www.ebi.ac.uk/emdb/api/entry/map/${r}`,type:"json"}).runInContext(t),l=(o=(n=a?.map)===null||n===void 0?void 0:n.contour_list)===null||o===void 0?void 0:o.contour;return!l||l.length===0?dQe(e,t,r):(s=(i=l.find(c=>c.primary))===null||i===void 0?void 0:i.level)!==null&&s!==void 0?s:l[0].level}async function dQe(e,t,r){var n,o,i;r=r.toUpperCase();let s=await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/${r}`,type:"json"}).runInContext(t),a=s?.[r],l;return((i=(o=(n=a?.[0])===null||n===void 0?void 0:n.map)===null||o===void 0?void 0:o.contour_level)===null||i===void 0?void 0:i.value)!==void 0&&(l=+a[0].map.contour_level.value),l}async function Cve(e,t,r){var n;let o=await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/${r}`,type:"json"}).runInContext(t),i=o?.[r],s=[];if(!((n=i?.[0])===null||n===void 0)&&n.related_structures){let a=i[0].related_structures.filter(l=>l.resource==="EMDB"&&l.relationship==="associated EM volume");if(!a.length)throw new Error(`No related EMDB entry found for '${r}'.`);s.push(...a.map(l=>l.accession))}else throw new Error(`No related EMDB entry found for '${r}'.`);return s}function mQe(e,t,r,n,o,i){let{createValues:s,createRenderableState:a}=Mi.getUtils(t),l=aC(),c=s(t,l,r,n,o),u=a(o);return gm(t.kind,c,u,i)}function cf(e,t){let{defaultProps:r,createGeometry:n,createLocationIterator:o,getLoci:i,eachLocation:s,setUpdateState:a,mustRecreate:l,dispose:c}=e,{updateValues:u,updateBoundingSphere:d,updateRenderableState:m,createPositionIterator:p}=e.geometryUtils,h=Zu.create(),f,C,g,b,y,x=Object.assign({},r),A=ii.createEmpty(),v,_,I,T=-1,E,w;function S(R,N,F,H){if(!F&&!v)throw new Error("missing volume");if(C=Object.assign({},x,N),g=R,b=F,y=H,Zu.reset(h),f?(!ot.areEquivalent(b,v)||y!==_)&&(h.createNew=!0):h.createNew=!0,h.createNew){h.createGeometry=!0;return}a(h,F,C,x,g,A),oi.areEqual(R.color,A.color)||(h.updateColor=!0),h.createGeometry&&(h.updateColor=!0),C.instanceGranularity!==x.instanceGranularity&&(h.updateTransform=!0)}function P(R){if(h.createNew)if(E=o(b,y),R)f=mQe(b,R,E,g,C,t),w=p(R,f.values);else throw new Error("expected geometry to be given");else{if(!f)throw new Error("expected renderObject to be available");if(h.updateTransform){E=o(b,y);let{instanceCount:N,groupCount:F}=E;C.instanceGranularity?to(N,"instance",f.values):to(N*F,"groupInstance",f.values)}else E.reset();if(h.createGeometry)if(R)G.updateIfChanged(f.values.drawCount,Mi.getDrawCount(R)),G.updateIfChanged(f.values.uVertexCount,Mi.getVertexCount(R)),G.updateIfChanged(f.values.uGroupCount,Mi.getGroupCount(R));else throw new Error("expected geometry to be given");(h.updateTransform||h.createGeometry)&&(d(f.values,R||I),w=p(R||I,f.values)),h.updateSize&&"uSize"in f.values&&Sl(E,g.size,f.values),h.updateColor&&$i(E,w,g.color,f.values),u(f.values,C),m(f.state,C)}x=C,A=g,v=b,_=y,R&&(I=R,T+=1)}function k(R,N,F,H){let V=!1;if(ot.Cell.isLoci(R)){if(ot.Cell.isLociEmpty(R)||!ot.areEquivalent(R.volume,N))return!1;H(Be.ofSingleton(0))&&(V=!0)}else if(ot.Segment.isLoci(R)){if(ot.Segment.isLociEmpty(R)||!ot.areEquivalent(R.volume,N)||!Qe.has(R.segments,F))return!1;H(Be.ofSingleton(0))&&(V=!0)}return V}function L(R,N){return cs(R)?x.instanceGranularity?N(Be.ofBounds(0,E.instanceCount)):N(Be.ofBounds(0,E.groupCount*E.instanceCount)):x.instanceGranularity?k(R,v,_,N):s(R,v,_,x,N)}return{get groupCount(){return E?E.count:0},get renderObject(){return f},get geometryVersion(){return T},async createOrUpdate(R,N,F={},H){if(S(N,F,H?.volume||v,H?.key||_),h.createGeometry){let V=n(R,b,y,g,C,I);return p0(V)?V.then(P):P(V)}else P()},getLoci(R){return f?i(R,v,_,x,f.id):pr},eachLocation(R){for(E.reset();E.hasNext;){let{location:N,isSecondary:F}=E.move();R(N,F)}},mark(R,N){return Er.mark(f,R,N,L)},setVisibility(R){Er.setVisibility(f,R)},setAlphaFactor(R){Er.setAlphaFactor(f,R)},setPickable(R){Er.setPickable(f,R)},setColorOnly(R){Er.setColorOnly(f,R)},setTransform(R,N){Er.setTransform(f,R,N)},setOverpaint(R){return Er.setOverpaint(f,R,L,!0)},setTransparency(R){return Er.setTransparency(f,R,L,!0)},setEmissive(R){return Er.setEmissive(f,R,L,!0)},setSubstance(R){return Er.setSubstance(f,R,L,!0)},setClipping(R){return Er.setClipping(f,R,L,!0)},setThemeStrength(R){Er.setThemeStrength(f,R)},destroy(){c?.(I),f&&(f.state.disposed=!0,f=void 0)},mustRecreate:l}}var uFr={...at.Params};function Zg(e,t,r,n,o,i=()=>[-1]){let s=0,{webgl:a}=t,l=new Vn,c=new Wt.GeometryState,u=ru(),d=[],m=Wt.createState(),p=new Map,h,f,C,g,b=ii.createEmpty();async function y(E,w){var S;let P=p.get(w);return P?!((S=P.mustRecreate)===null||S===void 0)&&S.call(P,{volume:h,key:w},g,a)&&(P.destroy(),P=n(u,h,w,g,a),p.set(w,P)):(P=n(u,h,w,g,a),p.set(w,P)),P.createOrUpdate({webgl:a,runtime:E},b,g,{volume:h,key:w})}function x(E={},w){w&&w!==h&&(C=r(t,w),h=w,g||(g=M.getDefaultValues(C)));let S=aw(Object.assign({},g,E),h);return Object.assign(g,E,S),f=i(g),ke.create("Creating or updating VolumeRepresentation",async P=>{let k=new Set(p.keys());for(let L=0,R=f.length;L<R;++L){let N=f[L];k.delete(N);let F=y(P,N);F&&await F}k.forEach(L=>{var R;(R=p.get(L))===null||R===void 0||R.destroy(),p.delete(L)}),d.length=0,p.forEach(L=>{L.renderObject&&(d.push(L.renderObject),c.add(L.renderObject.id,L.geometryVersion))}),c.snapshot(),l.next(s++)})}function A(E,w){let S=!1;return p.forEach(P=>{S=P.mark(E,w)||S}),S}function v(E,w){w.visible!==void 0&&E&&E.setVisibility(w.visible),w.alphaFactor!==void 0&&E&&E.setAlphaFactor(w.alphaFactor),w.pickable!==void 0&&E&&E.setPickable(w.pickable),w.overpaint!==void 0&&E&&E.setOverpaint(w.overpaint),w.transparency!==void 0&&E&&E.setTransparency(w.transparency),w.emissive!==void 0&&E&&E.setEmissive(w.emissive),w.substance!==void 0&&E&&E.setSubstance(w.substance),w.clipping!==void 0&&E&&E.setClipping(w.clipping),w.transform!==void 0&&E&&E.setTransform(w.transform),w.themeStrength!==void 0&&E&&E.setThemeStrength(w.themeStrength)}function _(E){let{visible:w,alphaFactor:S,pickable:P,overpaint:k,transparency:L,emissive:R,substance:N,clipping:F,transform:H,themeStrength:V,syncManually:q,markerActions:Q}=E,O={};w!==void 0&&(O.visible=w),S!==void 0&&(O.alphaFactor=S),P!==void 0&&(O.pickable=P),k!==void 0&&(O.overpaint=k),L!==void 0&&(O.transparency=L),R!==void 0&&(O.emissive=R),N!==void 0&&(O.substance=N),F!==void 0&&(O.clipping=F),V!==void 0&&(O.themeStrength=V),H!==void 0&&!de.areEqual(H,m.transform,1e-6)&&(O.transform=H),q!==void 0&&(O.syncManually=q),Q!==void 0&&(O.markerActions=Q),p.forEach(B=>v(B,O)),Wt.updateState(m,E)}function I(E){b=E}function T(){p.forEach(E=>E.destroy()),p.clear()}return{label:e,get groupCount(){let E=0;return p.forEach(w=>{w.renderObject&&(E+=w.groupCount)}),E},get props(){return g},get params(){return C},get state(){return m},get theme(){return b},get geometryVersion(){return c.version},renderObjects:d,updated:l,createOrUpdate:x,setState:_,setTheme:I,getLoci:E=>{let w=pr;return p.forEach(S=>{let P=S.getLoci(E);wi(P)||(w=P)}),w},getAllLoci:()=>[o(h,g)],eachLocation:E=>{p.forEach(w=>{w.eachLocation(E)})},mark:A,destroy:T}}var Sve=`
precision highp float;
precision highp int;

#if __VERSION__ == 100
    precision highp sampler2D;
    uniform sampler2D tTexture;
#else
    precision highp isampler2D;
    uniform isampler2D tTexture;
#endif

void main(void) {
    #if __VERSION__ == 100
        gl_FragColor = texture2D(tTexture, vec2(0.5));
    #else
        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);
    #endif
}
`;var pQe={...Rn,tTexture:kt("texture","rgba","float","nearest")},jm="histopyramid-sum";function fQe(e,t){if(e.namedComputeRenderables[jm]){let r=e.namedComputeRenderables[jm].values;G.update(r.tTexture,t),e.namedComputeRenderables[jm].update()}else e.namedComputeRenderables[jm]=hQe(e,t);return e.namedComputeRenderables[jm]}function hQe(e,t){let r={...Bn,tTexture:G.create(t)},n={...pQe},o=Gr("sum",Kn,Sve,{},{0:"ivec4"}),i=on(e,"triangles",o,n,r);return sn(i,r)}function gQe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}var iB=new Uint8Array(4),Ive=new Int32Array(4);function Ave(e,t){bt&&e.timer.mark("getHistopyramidSum");let{gl:r,state:n,resources:o}=e,i=fQe(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[jm]||(e.namedFramebuffers[jm]=o.framebuffer());let s=e.namedFramebuffers[jm];return e.namedTextures[jm]||(e.namedTextures[jm]=er(r)?o.texture("image-int32","rgba","int","nearest"):o.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[jm].define(1,1)),e.namedTextures[jm].attachFramebuffer(s,0),gQe(e),n.viewport(0,0,1,1),i.render(),r.finish(),e.readPixels(0,0,1,1,er(r)?Ive:iB),e.unbindFramebuffer(),bt&&e.timer.markEnd("getHistopyramidSum"),er(r)?Ive[0]:Tb(iB[0],iB[1],iB[2])}var wve=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tInputLevel;

// previous level used to evaluate the new level
#if __VERSION__ == 100
    uniform sampler2D tPreviousLevel;
#else
    precision highp isampler2D;
    uniform isampler2D tPreviousLevel;
#endif

// inverted size of the previous level texture.
uniform float uSize;
uniform float uTexSize;
uniform bool uFirst;

#include common

void main(void) {
    float k = 0.5 * uSize;
    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;

    #if __VERSION__ == 100
        float a, b, c, d;

        if (uFirst) {
            a = texture2D(tInputLevel, position).r * 255.0;
            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;
            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;
            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;
        } else {
            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);
            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);
            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);
            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);
        }
        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);
    #else
        int a, b, c, d;

        if (uFirst) {
            a = int(texture2D(tInputLevel, position).r * 255.0);
            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);
            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);
            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);
        } else {
            a = texture2D(tPreviousLevel, position).r;
            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;
            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;
            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;
        }
        gl_FragColor = ivec4(a + b + c + d);
    #endif
}
`;var yQe={...Rn,tInputLevel:kt("texture","rgba","float","nearest"),tPreviousLevel:kt("texture","rgba","float","nearest"),uSize:Re("f"),uTexSize:Re("f"),uFirst:Re("b")},uv="histogram-pyramid";function vQe(e,t,r){if(e.namedComputeRenderables[uv]){let n=e.namedComputeRenderables[uv].values;G.update(n.tInputLevel,t),G.update(n.tPreviousLevel,r),e.namedComputeRenderables[uv].update()}else e.namedComputeRenderables[uv]=bQe(e,t,r);return e.namedComputeRenderables[uv]}function bQe(e,t,r){let n={...Bn,tInputLevel:G.create(t),tPreviousLevel:G.create(r),uSize:G.create(0),uTexSize:G.create(0),uFirst:G.create(!0)},o={...yQe},i=Gr("reduction",Kn,wve,{},{0:"ivec4"}),s=on(e,"triangles",i,o,n);return sn(s,n)}function xQe(e,t){let r=Math.pow(2,t),n=`level${t}`,o=e.isWebGL2?sB(n,e,"image-int32","alpha","int","nearest"):sB(n,e,"image-uint8","rgba","ubyte","nearest");o.define(r,r);let i=SQe(n,e);return i||(i=_ve(n,e),o.attachFramebuffer(i,0)),{texture:o,framebuffer:i}}function CQe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function _ve(e,t){let r=`${uv}-${e}`;return t.namedFramebuffers[r]||(t.namedFramebuffers[r]=t.resources.framebuffer()),t.namedFramebuffers[r]}function sB(e,t,r,n,o,i){let s=`${uv}-${e}`;return t.namedTextures[s]||(t.namedTextures[s]=t.resources.texture(r,n,o,i)),t.namedTextures[s]}function SQe(e,t){let r=`${uv}-${e}`;return t.namedFramebuffers[r]}function Tve(e,t,r,n){bt&&e.timer.mark("createHistogramPyramid");let{gl:o,state:i}=e,s=t.getWidth(),a=t.getHeight();if(s!==a||!m0(s))throw new Error("inputTexture must be of square power-of-two size");let l=Math.ceil(Math.log(s)/Math.log(2)),c=Math.pow(2,l),u=Math.pow(2,l),d=Math.pow(2,l-1),m=e.isWebGL2?sB("pyramid",e,"image-int32","alpha","int","nearest"):sB("pyramid",e,"image-uint8","rgba","ubyte","nearest");m.define(u,d);let p=_ve("pyramid",e);m.attachFramebuffer(p,0),i.viewport(0,0,u,d),er(o)?o.clearBufferiv(o.COLOR,0,[0,0,0,0]):o.clear(o.COLOR_BUFFER_BIT);let h=[];for(let y=0;y<l;++y)h.push(xQe(e,y));let f=vQe(e,t,h[0].texture);i.currentRenderItemId=-1,CQe(e);let C=0;for(let y=0;y<l;y++){let x=l-1-y;h[x].framebuffer.bind();let v=Math.pow(2,x);G.update(f.values.uSize,Math.pow(2,y+1)/c),G.update(f.values.uTexSize,v),G.updateIfChanged(f.values.uFirst,y===0),y>0&&(G.update(f.values.tPreviousLevel,h[l-y].texture),f.update()),i.currentRenderItemId=-1,i.viewport(0,0,v,v),i.scissor(0,0,v,v),er(o)?o.clearBufferiv(o.COLOR,0,[0,0,0,0]):o.clear(o.COLOR_BUFFER_BIT),i.scissor(0,0,n[0],n[1]),f.render(),m.bind(0),o.copyTexSubImage2D(o.TEXTURE_2D,0,C,0,0,0,v,v),m.unbind(0),C+=v}o.finish(),bt&&e.timer.markEnd("createHistogramPyramid");let g=Math.max(1,Ave(e,h[0].texture)),b=Math.ceil(g/Math.pow(2,l));return{pyramidTex:m,count:g,height:b,levels:l,scale:r}}var P_;function Eve(){if(P_!==void 0)return P_;P_=mo(16*16,1,Uint8Array);let{array:e}=P_;for(let t=0,r=Yy.length;t<r;++t)e[t]=Yy[t].length/3;return P_}var D_;function Pve(){if(D_!==void 0)return D_;D_=mo(64*64,1,Uint8Array);let{array:e}=D_;for(let t=0,r=Yy.length;t<r;++t)for(let n=0;n<16;++n)n<Yy[t].length?e[t*16+n]=Yy[t][n]:e[t*16+n]=255;return D_}var Dve=`
precision highp float;
precision highp int;
precision highp sampler2D;

#if __VERSION__ == 100
    uniform sampler2D tActiveVoxelsPyramid;
#else
    precision highp isampler2D;
    uniform isampler2D tActiveVoxelsPyramid;
#endif

uniform sampler2D tActiveVoxelsBase;
uniform sampler2D tVolumeData;
uniform sampler2D tTriIndices;

uniform float uIsoValue;
uniform float uLevels;
uniform float uSize;
uniform float uCount;
uniform bool uInvert;

uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform mat4 uGridTransform;

// scale to volume data coord
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord + 0.5 / (texDim / uScale));
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

vec4 voxelPadded(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

int idot2(const in ivec2 a, const in ivec2 b) {
    return a.x * b.x + a.y * b.y;
}

int idot4(const in ivec4 a, const in ivec4 b) {
    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;
}

#if __VERSION__ == 100
    int pyramidVoxel(vec2 pos) {
        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));
    }
#else
    int pyramidVoxel(vec2 pos) {
        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;
    }
#endif

vec4 baseVoxel(vec2 pos) {
    return texture2D(tActiveVoxelsBase, pos / uSize);
}

vec4 getGroup(const in vec3 p) {
    vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding
    // note that we swap x and z because the texture is flipped around y
    #if defined(dAxisOrder_012)
        float group = p.z + p.y * gridDim.z + p.x * gridDim.z * gridDim.y; // 210
    #elif defined(dAxisOrder_021)
        float group = p.y + p.z * gridDim.y + p.x * gridDim.y * gridDim.z; // 120
    #elif defined(dAxisOrder_102)
        float group = p.z + p.x * gridDim.z + p.y * gridDim.z * gridDim.x; // 201
    #elif defined(dAxisOrder_120)
        float group = p.x + p.z * gridDim.x + p.y * gridDim.x * gridDim.z; // 021
    #elif defined(dAxisOrder_201)
        float group = p.y + p.x * gridDim.y + p.z * gridDim.y * gridDim.x; // 102
    #elif defined(dAxisOrder_210)
        float group = p.x + p.y * gridDim.x + p.z * gridDim.x * gridDim.y; // 012
    #endif
    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);
}

void main(void) {
    // get 1D index
    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);

    // ignore 1D indices outside of the grid
    if(vI >= int(uCount)) discard;

    ivec2 offset = ivec2(int(uSize) - 2, 0);

    int start = 0;
    ivec4 starts = ivec4(0);
    ivec4 ends = ivec4(0);
    int diff = 2;
    ivec4 m = ivec4(0);
    ivec2 position = ivec2(0);
    ivec4 vI4 = ivec4(vI);

    ivec2 relativePosition = ivec2(0);
    int end = 0;
    ivec2 pos1 = ivec2(0);
    ivec2 pos2 = ivec2(0);
    ivec2 pos3 = ivec2(0);
    ivec2 pos4 = ivec2(0);
    ivec3 vI3 = ivec3(vI);
    ivec3 mask = ivec3(0);

    // traverse the different levels of the pyramid
    for(int i = 1; i < 14; i++) {
        if(float(i) >= uLevels) break;

        offset.x -= diff;
        diff *= 2;
        relativePosition = position + offset;

        end = start + pyramidVoxel(vec2(relativePosition));
        pos1 = ivec2(relativePosition);
        starts.x = start;
        ends.x = end;
        pos2 = ivec2(relativePosition + ivec2(1, 0));
        starts.y = ends.x;
        ends.y = ends.x + pyramidVoxel(vec2(pos2));
        pos3 = relativePosition + ivec2(0, 1);
        starts.z = ends.y;
        ends.z = ends.y + pyramidVoxel(vec2(pos3));
        pos4 = relativePosition + ivec2(1, 1);
        starts.w = ends.z;
        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
        m = ivec4(mask, 1 - int(any(bvec3(mask))));

        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;
        start = idot4(m, starts);
        position = 2 * (relativePosition - offset);
    }

    end = start + int(baseVoxel(vec2(position)).r * 255.0);
    pos1 = position;
    starts.x = start;
    ends.x = end;
    pos2 = position + ivec2(1, 0);
    starts.y = ends.x;
    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);
    pos3 = position + ivec2(0, 1);
    starts.z = ends.y;
    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);
    pos4 = position + ivec2(1, 1);
    starts.w = ends.z;
    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));
    m = ivec4(mask, 1 - int(any(bvec3(mask))));
    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;

    vec2 coord2d = (vec2(position) / uSize) / uScale;
    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);

    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);

    // current vertex for the up to 15 MC cases
    int currentVertex = vI - idot4(m, starts);

    // ensure winding-order is the same for negative and positive iso-levels
    if (uInvert) {
        int v = imod(currentVertex + 1, 3);
        if (v == 1) currentVertex += 2;
        else if (v == 0) currentVertex -= 2;
    }

    // get index into triIndices table
    int mcIndex = 16 * int(edgeIndex) + currentVertex;
    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);

    // bit mask to avoid conditionals (see comment below) for getting MC case corner
    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));

    // get edge value masks
    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));
    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));
    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));

    // apply bit masks
    vec3 b0 = coord3d +
                m1.y * c1 +
                m1.z * c2 +
                m1.w * c3 +
                m2.x * c4 +
                m2.y * c5 +
                m2.z * c6 +
                m2.w * c7 +
                m3.y * c1 +
                m3.z * c2 +
                m3.w * c3;
    vec3 b1 = coord3d +
                m1.x * c1 +
                m1.y * c2 +
                m1.z * c3 +
                m2.x * c5 +
                m2.y * c6 +
                m2.z * c7 +
                m2.w * c4 +
                m3.x * c4 +
                m3.y * c5 +
                m3.z * c6 +
                m3.w * c7;

    // the conditionals that are avoided by above bitmasks
    // vec3 b0 = coord3d;
    // vec3 b1 = coord3d;
    // if (mcIndex == 0.0) {
    //     b1 += c1;
    // } else if (mcIndex == 1.0) {
    //     b0 += c1; b1 += c2;
    // } else if (mcIndex == 2.0) {
    //     b0 += c2; b1 += c3;
    // } else if (mcIndex == 3.0) {
    //     b0 += c3;
    // } else if (mcIndex == 4.0) {
    //     b0 += c4; b1 += c5;
    // } else if (mcIndex == 5.0) {
    //     b0 += c5; b1 += c6;
    // } else if (mcIndex == 6.0) {
    //     b0 += c6; b1 += c7;
    // } else if (mcIndex == 7.0) {
    //     b0 += c7; b1 += c4;
    // } else if (mcIndex == 8.0) {
    //     b1 += c4;
    // } else if (mcIndex == 9.0) {
    //     b0 += c1; b1 += c5;
    // } else if (mcIndex == 10.0) {
    //     b0 += c2; b1 += c6;
    // } else if (mcIndex == 11.0) {
    //     b0 += c3; b1 += c7;
    // }
    // b0 = floor(b0 + 0.5);
    // b1 = floor(b1 + 0.5);

    vec4 d0 = voxel(b0);
    vec4 d1 = voxel(b1);

    float v0 = d0.a;
    float v1 = d1.a;

    float t = (uIsoValue - v0) / (v0 - v1);
    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;

    // group id
    #if __VERSION__ == 100 || defined(dConstantGroup)
        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)
        // ensure a constant group id per triangle as needed
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(coord3d);
        #endif
    #else
        #ifdef dPackedGroup
            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);
        #else
            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);
        #endif
    #endif

    // normals from gradients
    vec3 n0 = -normalize(vec3(
        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,
        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,
        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a
    ));
    vec3 n1 = -normalize(vec3(
        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,
        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,
        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a
    ));
    gl_FragData[2].xyz = -vec3(
        n0.x + t * (n0.x - n1.x),
        n0.y + t * (n0.y - n1.y),
        n0.z + t * (n0.z - n1.z)
    );

    // ensure normal-direction is the same for negative and positive iso-levels
    if (uInvert) {
        gl_FragData[2].xyz *= -1.0;
    }

    // apply normal matrix
    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));
}
`;var kve=`
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tTriCount;
uniform sampler2D tVolumeData;

uniform float uIsoValue;
uniform vec3 uGridDim;
uniform vec3 uGridTexDim;
uniform vec2 uScale;

#include common

// cube corners (excluding origin)
const vec3 c1 = vec3(1., 0., 0.);
const vec3 c2 = vec3(1., 1., 0.);
const vec3 c3 = vec3(0., 1., 0.);
const vec3 c4 = vec3(0., 0., 1.);
const vec3 c5 = vec3(1., 0., 1.);
const vec3 c6 = vec3(1., 1., 1.);
const vec3 c7 = vec3(0., 1., 1.);

vec3 index3dFrom2d(vec2 coord) {
    vec2 gridTexPos = coord * uGridTexDim.xy;
    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);
    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;
    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;
    return vec3(posXY, posZ);
}

vec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {
    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice
    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);
    float row = intDiv(zSlice * gridDim.x, texDim.x);
    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);
    return texture2D(tex, coord);
}

vec4 voxel(vec3 pos) {
    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));
    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);
}

void main(void) {
    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;
    vec3 posXYZ = index3dFrom2d(uv);

    // get MC case as the sum of corners that are below the given iso level
    float c = step(voxel(posXYZ).a, uIsoValue)
        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)
        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)
        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)
        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)
        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)
        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)
        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);
    c *= step(c, 254.);

    // handle out of bounds positions
    posXYZ += 1.0;
    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)
    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)
        c = 0.0;

    // get total triangles to generate for calculated MC case from triCount texture
    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;
    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);
}
`;var IQe={...Rn,tTriCount:kt("image-uint8","alpha","ubyte","nearest"),tVolumeData:kt("texture","rgba","ubyte","nearest"),uIsoValue:Re("f"),uGridDim:Re("v3"),uGridTexDim:Re("v3"),uScale:Re("v2")},uf="active-voxels";function AQe(e,t,r,n,o,i){if(e.namedComputeRenderables[uf]){let s=e.namedComputeRenderables[uf].values;G.update(s.uQuadScale,i),G.update(s.tVolumeData,t),G.updateIfChanged(s.uIsoValue,o),G.update(s.uGridDim,r),G.update(s.uGridTexDim,n),G.update(s.uScale,i),e.namedComputeRenderables[uf].update()}else e.namedComputeRenderables[uf]=wQe(e,t,r,n,o,i);return e.namedComputeRenderables[uf]}function wQe(e,t,r,n,o,i){let s={...Bn,tTriCount:G.create(Eve()),uQuadScale:G.create(i),tVolumeData:G.create(t),uIsoValue:G.create(o),uGridDim:G.create(r),uGridTexDim:G.create(n),uScale:G.create(i)},a={...IQe},l=Gr("active-voxels",Kn,kve),c=on(e,"triangles",l,a,s);return sn(c,s)}function _Qe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function Mve(e,t,r,n,o,i){bt&&e.timer.mark("calcActiveVoxels");let{gl:s,state:a,resources:l}=e,c=t.getWidth(),u=t.getHeight();e.namedFramebuffers[uf]||(e.namedFramebuffers[uf]=l.framebuffer());let d=e.namedFramebuffers[uf];d.bind(),e.namedTextures[uf]||(e.namedTextures[uf]=l.texture("image-uint8","rgba","ubyte","nearest"));let m=e.namedTextures[uf];m.define(c,u);let p=AQe(e,t,r,n,o,i);return e.state.currentRenderItemId=-1,m.attachFramebuffer(d,0),_Qe(e),a.viewport(0,0,c,u),a.scissor(0,0,c,u),s.clear(s.COLOR_BUFFER_BIT),a.scissor(0,0,n[0],n[1]),p.render(),s.finish(),bt&&e.timer.markEnd("calcActiveVoxels"),m}var TQe={...Rn,tTriIndices:kt("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:kt("texture","rgba","float","nearest"),tActiveVoxelsBase:kt("texture","rgba","float","nearest"),tVolumeData:kt("texture","rgba","ubyte","nearest"),uIsoValue:Re("f"),uSize:Re("f"),uLevels:Re("f"),uCount:Re("f"),uInvert:Re("b"),uGridDim:Re("v3"),uGridTexDim:Re("v3"),uGridTransform:Re("m4"),uScale:Re("v2"),dPackedGroup:Bt("boolean"),dAxisOrder:Bt("string",["012","021","102","120","201","210"]),dConstantGroup:Bt("boolean")},dv="isosurface";function EQe(e,t,r,n,o,i,s,a,l,c,u,d,m,p,h){if(e.namedComputeRenderables[dv]){let f=e.namedComputeRenderables[dv].values;G.update(f.tActiveVoxelsPyramid,t),G.update(f.tActiveVoxelsBase,r),G.update(f.tVolumeData,n),G.updateIfChanged(f.uIsoValue,a),G.updateIfChanged(f.uSize,Math.pow(2,l)),G.updateIfChanged(f.uLevels,l),G.updateIfChanged(f.uCount,u),G.updateIfChanged(f.uInvert,d),G.update(f.uGridDim,o),G.update(f.uGridTexDim,i),G.update(f.uGridTransform,s),G.update(f.uScale,c),G.updateIfChanged(f.dPackedGroup,m),G.updateIfChanged(f.dAxisOrder,p.join("")),G.updateIfChanged(f.dConstantGroup,h),e.namedComputeRenderables[dv].update()}else e.namedComputeRenderables[dv]=PQe(e,t,r,n,o,i,s,a,l,c,u,d,m,p,h);return e.namedComputeRenderables[dv]}function PQe(e,t,r,n,o,i,s,a,l,c,u,d,m,p,h){let f={...Bn,tTriIndices:G.create(Pve()),tActiveVoxelsPyramid:G.create(t),tActiveVoxelsBase:G.create(r),tVolumeData:G.create(n),uIsoValue:G.create(a),uSize:G.create(Math.pow(2,l)),uLevels:G.create(l),uCount:G.create(u),uInvert:G.create(d),uGridDim:G.create(o),uGridTexDim:G.create(i),uGridTransform:G.create(s),uScale:G.create(c),dPackedGroup:G.create(m),dAxisOrder:G.create(p.join("")),dConstantGroup:G.create(h)},C={...TQe},g=Gr("isosurface",Kn,Dve,{drawBuffers:"required"}),b=on(e,"triangles",g,C,f);return sn(b,f)}function DQe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.disable(t.BLEND),r.disable(t.DEPTH_TEST),r.disable(t.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0)}function kQe(e,t,r,n,o,i,s,a,l,c,u,d,m,p,h){let{drawBuffers:f}=e.extensions;if(!f)throw new Error("need WebGL draw buffers");bt&&e.timer.mark("createIsosurfaceBuffers");let{gl:C,state:g,resources:b,extensions:y}=e,{pyramidTex:x,height:A,levels:v,scale:_,count:I}=n,T=x.getWidth();e.namedFramebuffers[dv]||(e.namedFramebuffers[dv]=b.framebuffer());let E=e.namedFramebuffers[dv];er(C)?(m||(m=b.texture("image-float32","rgba","float","nearest")),p||(p=b.texture("image-uint8","rgba","ubyte","nearest")),h||(h=y.colorBufferHalfFloat&&y.textureHalfFloat?b.texture("image-float16","rgba","fp16","nearest"):b.texture("image-float32","rgba","float","nearest"))):(m||(m=b.texture("image-float32","rgba","float","nearest")),p||(p=b.texture("image-float32","rgba","float","nearest")),h||(h=b.texture("image-float32","rgba","float","nearest"))),m.define(T,A),p.define(T,A),h.define(T,A),m.attachFramebuffer(E,0),p.attachFramebuffer(E,1),h.attachFramebuffer(E,2);let w=EQe(e,x,t,r,o,i,s,a,v,_,I,l,c,u,d);return e.state.currentRenderItemId=-1,E.bind(),f.drawBuffers([f.COLOR_ATTACHMENT0,f.COLOR_ATTACHMENT1,f.COLOR_ATTACHMENT2]),DQe(e),g.viewport(0,0,T,A),C.clear(C.COLOR_BUFFER_BIT),w.render(),C.finish(),bt&&e.timer.markEnd("createIsosurfaceBuffers"),{vertexTexture:m,groupTexture:p,normalTexture:h,vertexCount:I}}function M1(e,t,r,n,o,i,s,a,l,c,u,d,m,p){bt&&e.timer.mark("extractIsosurface");let h=Mve(e,t,r,n,s,o),f=Tve(e,h,o,n),C=kQe(e,h,t,f,r,n,i,s,a,l,c,u,d,m,p);return bt&&e.timer.markEnd("extractIsosurface"),C}var Bve={isoValue:ot.IsoValueParam};function MQe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var k_=1;function X6(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;let r=e.grid.cells.space.dimensions,{powerOfTwoSize:n}=Dm(r,k_);return n<=t.maxTextureSize/2}function RQe(e,t,r,n,o){return n.tryUseGpu&&o&&MQe(o)&&X6(t,o)?FQe(e):LQe(e)}function Rve(e,t){return ot.Isosurface.Loci(e,t.isoValue)}function Y6(e,t,r,n,o){let{objectId:i,groupId:s}=e;if(o===i){let a=ot.PickingGranularity.get(t);return a==="volume"?ot.Loci(t):a==="object"?ot.Isosurface.Loci(t,n.isoValue):ot.Cell.Loci(t,Be.ofSingleton(s))}return pr}function Q6(e,t,r,n,o){return xy(e,t,{isoValue:n.isoValue},o)}async function BQe(e,t,r,n,o,i){e.runtime.update({message:"Marching cubes..."});let s=Rs(new Int32Array(t.grid.cells.data.length)),a=await Vm({isoLevel:ot.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:cr.create(t.grid.cells.space,cr.Data1(s))},i).runAsChild(e.runtime),l=go.getGridToCartesianTransform(t.grid);return Ct.transform(a,l),e.webgl&&!e.webgl.isWebGL2?(Ct.uniformTriangleGroup(a,!1),G.updateIfChanged(a.varyingGroup,!1)):G.updateIfChanged(a.varyingGroup,!0),a.setBoundingSphere(ot.Isosurface.getBoundingSphere(t,o.isoValue)),a}var J6={...Ct.Params,...Ns.Params,...Bve,quality:{...Ct.Params.quality,isEssential:!1},tryUseGpu:M.Boolean(!0)};function LQe(e){return cf({defaultProps:M.getDefaultValues(J6),createGeometry:BQe,createLocationIterator:t=>Mr(t.grid.cells.data.length,1,1,()=>bs),getLoci:Y6,eachLocation:Q6,setUpdateState:(t,r,n,o)=>{ot.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Ct.Utils,mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&X6(t.volume,n)},e)}var Z6;(function(e){let t="volume-isosurface-texture";e.descriptor=Ci({name:t});function r(n,o){let{resources:i}=o,s=go.getGridToCartesianTransform(n.grid),a=D.clone(n.grid.cells.space.dimensions),{width:l,height:c,powerOfTwoSize:u}=Dm(a,k_),d=D.create(l,c,0),m=Ve.create(l/u,c/u);if(u>o.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!n._propertyData[t]){n._propertyData[t]=i.texture("image-uint8","alpha","ubyte","linear");let p=n._propertyData[t];p.define(u,u),p.load(JD(n,"data",k_),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:()=>p.destroy()}])}return a[0]+=k_,a[1]+=k_,{texture:n._propertyData[t],transform:s,gridDimension:a,gridTexDim:d,gridTexScale:m}}e.get=r})(Z6||(Z6={}));async function NQe(e,t,r,n,o,i){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");if(t.grid.cells.data.length<=1)return Ns.createEmpty(i);let{max:s,min:a}=t.grid.stats,l=s-a,c=ot.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,u=(c-a)/l,{texture:d,gridDimension:m,gridTexDim:p,gridTexScale:h,transform:f}=Z6.get(t,e.webgl),C=t.grid.cells.space.axisOrderSlowToFast,g=i?.doubleBuffer.get(),b=M1(e.webgl,d,m,p,h,f,u,c<0,!1,C,!0,g?.vertex,g?.group,g?.normal),y=t.grid.cells.data.length,x=ot.getBoundingSphere(t),A=Ns.create(b.vertexCount,y,b.vertexTexture,b.groupTexture,b.normalTexture,x,i);return A.meta.webgl=e.webgl,A}function FQe(e){return cf({defaultProps:M.getDefaultValues(J6),createGeometry:NQe,createLocationIterator:t=>Mr(t.grid.cells.data.length,1,1,()=>bs),getLoci:Y6,eachLocation:Q6,setUpdateState:(t,r,n,o)=>{ot.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:Ns.Utils,mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!X6(t.volume,n),dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}async function OQe(e,t,r,n,o,i){e.runtime.update({message:"Marching cubes..."});let s=Rs(new Int32Array(t.grid.cells.data.length)),a=await AS({isoLevel:ot.IsoValue.toAbsolute(o.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:cr.create(t.grid.cells.space,cr.Data1(s))},i).runAsChild(e.runtime),l=go.getGridToCartesianTransform(t.grid);return In.transform(a,l),a.setBoundingSphere(ot.Isosurface.getBoundingSphere(t,o.isoValue)),a}var Lve={...In.Params,...Bve,quality:{...In.Params.quality,isEssential:!1},sizeFactor:M.Numeric(3,{min:0,max:10,step:.1})};function VQe(e){return cf({defaultProps:M.getDefaultValues(Lve),createGeometry:OQe,createLocationIterator:t=>Mr(t.grid.cells.data.length,1,1,()=>bs),getLoci:Y6,eachLocation:Q6,setUpdateState:(t,r,n,o)=>{ot.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||(t.createGeometry=!0)},geometryUtils:In.Utils},e)}var Nve={solid:(e,t)=>Zg("Isosurface mesh",e,t,RQe,Rve),wireframe:(e,t)=>Zg("Isosurface wireframe",e,t,VQe,Rve)},Fve={...J6,...Lve,visuals:M.MultiSelect(["solid"],M.objectToOptions(Nve)),bumpFrequency:M.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)};function GQe(e,t){let r=M.clone(Fve);return r.isoValue=ot.createIsoValueParam(ot.IsoValue.relative(2),t.grid.stats),r}function UQe(e,t){return Wt.createMulti("Isosurface",e,t,Wt.StateBuilder,Nve)}var Ove={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:UQe,getParams:GQe,defaultValues:M.getDefaultValues(Fve),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!ot.isEmpty(e)&&!ot.Segmentation.get(e)};async function zQe(e,t,r,n,o,i){let{dimension:{name:s},isoValue:a}=o,{space:l,data:c}=t.grid.cells,{min:u,max:d}=t.grid.stats,m=ot.IsoValue.toAbsolute(a,t.grid.stats).absoluteValue,p="color"in n.color?n.color.color(bs,!1):ze(16777215),[h,f,C]=ze.toRgbNormalized(p),{width:g,height:b,x:y,y:x,z:A,x0:v,y0:_,z0:I,nx:T,ny:E,nz:w}=ej(t.grid,o),S=new Float32Array(s==="x"?[y,0,0,y,x,0,y,0,A,y,x,A]:s==="y"?[0,x,0,y,x,0,0,x,A,y,x,A]:[0,0,A,0,x,A,y,0,A,y,x,A]),P=new Uint8Array(g*b*4),k=HQe(t.grid,o),L=0;for(let H=_;H<E;++H)for(let V=v;V<T;++V)for(let q=I;q<w;++q){let Q=l.get(c,V,H,q),O=(Q-u)/(d-u);P[L]=h*O*2*255,P[L+1]=f*O*2*255,P[L+2]=C*O*2*255,P[L+3]=Q>=m?255:0,L+=4}let R={width:g,height:b,array:P,flipY:!0},N={width:g,height:b,array:k,flipY:!0},F=go.getGridToCartesianTransform(t.grid);return um(F,S,0,4),Up.create(R,S,N,i)}function ej(e,t){let{dimension:{name:r,params:n}}=t,{space:o}=e.cells,i,s,a,l,c,u=0,d=0,m=0,[p,h,f]=o.dimensions;return r==="x"?(a=n,l=h-1,c=f-1,i=f,s=h,u=a,p=u+1):r==="y"?(a=p-1,l=n,c=f-1,i=f,s=p,d=l,h=d+1):(a=p-1,l=h-1,c=n,i=p,s=h,m=c,f=m+1),{width:i,height:s,x:a,y:l,z:c,x0:u,y0:d,z0:m,nx:p,ny:h,nz:f}}function HQe(e,t){let{space:r}=e.cells,{width:n,height:o,x0:i,y0:s,z0:a,nx:l,ny:c,nz:u}=ej(e,t),d=new Uint8Array(n*o*4),m=0;for(let p=s;p<c;++p)for(let h=i;h<l;++h)for(let f=a;f<u;++f)W0(r.dataOffset(h,p,f),d,m),m+=4;return d}function jQe(e,t){let{space:r}=e.cells,{width:n,height:o,x0:i,y0:s,z0:a,nx:l,ny:c,nz:u}=ej(e,t),d=new Uint32Array(n*o),m=0;for(let p=s;p<c;++p)for(let h=i;h<l;++h)for(let f=a;f<u;++f)d[m]=r.dataOffset(h,p,f),m+=1;return d}function Gve(e,t){let r=jQe(e.grid,t);return ot.Cell.Loci(e,Qe.ofUnsortedArray(r))}function $Qe(e,t,r,n,o){let{objectId:i,groupId:s}=e;if(o===i){let a=ot.PickingGranularity.get(t);return a==="volume"?ot.Loci(t):a==="object"?Gve(t,n):ot.Cell.Loci(t,Be.ofSingleton(s))}return pr}function WQe(e,t,r,n,o){return xy(e,t,void 0,o)}var tj={...Up.Params,quality:{...Up.Params.quality,isEssential:!1},dimension:M.MappedStatic("x",{x:M.Numeric(0,{min:0,max:0,step:1}),y:M.Numeric(0,{min:0,max:0,step:1}),z:M.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:ot.IsoValueParam};function qQe(e,t){let r=M.clone(tj),n=t.grid.cells.space.dimensions;return r.dimension=M.MappedStatic("x",{x:M.Numeric(0,{min:0,max:n[0]-1,step:1}),y:M.Numeric(0,{min:0,max:n[1]-1,step:1}),z:M.Numeric(0,{min:0,max:n[2]-1,step:1})},{isEssential:!0}),r.isoValue=ot.createIsoValueParam(ot.IsoValue.absolute(t.grid.stats.min),t.grid.stats),r}function ZQe(e){return cf({defaultProps:M.getDefaultValues(tj),createGeometry:zQe,createLocationIterator:t=>Mr(t.grid.cells.data.length,1,1,()=>bs),getLoci:$Qe,eachLocation:WQe,setUpdateState:(t,r,n,o,i,s)=>{t.createGeometry=n.dimension.name!==o.dimension.name||n.dimension.params!==o.dimension.params||!ot.IsoValue.areSame(n.isoValue,o.isoValue,r.grid.stats)||!oi.areEqual(i.color,s.color)},geometryUtils:{...Up.Utils,createRenderableState:t=>{let r=Up.Utils.createRenderableState(t);return Vve(r,t),r},updateRenderableState:Vve}},e)}function Vve(e,t){Up.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}function KQe(e,t){return Zg("Slice",e,t,ZQe,Gve)}var Uve={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:KQe,getParams:qQe,defaultValues:M.getDefaultValues(tj),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!ot.isEmpty(e)&&!ot.Segmentation.get(e)};function zve(e,t){let r=xt();return xt.add(r,e),xt.transform(r,r,t),r}function XQe(e,t,r,n){let o=r.grid.cells.space.dimensions,{width:i,height:s}=Dm(o);if(Math.max(i,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");let a=JD(r,"normals"),l=go.getGridToCartesianTransform(r.grid),c=zve(o,l),u=n?n.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");u.load(a);let{unitToCartn:d,cellDim:m}=Hve(r.grid),p=r.grid.cells.space.axisOrderSlowToFast;return el.create(c,o,l,d,m,u,r.grid.stats,!1,p,n)}function Hve(e){if(e.transform.kind==="matrix")return{unitToCartn:de.mul(de(),e.transform.matrix,de.fromScaling(de(),e.cells.space.dimensions)),cellDim:de.getScaling(D(),e.transform.matrix)};let t=e.transform.fractionalBox,r=xt.size(D(),t);return{unitToCartn:de.mul3(de(),e.transform.cell.fromFractional,de.fromTranslation(de(),t.min),de.fromScaling(de(),r)),cellDim:D.div(D(),e.transform.cell.size,e.cells.space.dimensions)}}function YQe(e,t,r,n){let o=r.grid.cells.space.dimensions;if(Math.max(...o)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");let i=Kce(r),s=go.getGridToCartesianTransform(r.grid),a=zve(o,s),l=n?n.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");l.load(i);let{unitToCartn:c,cellDim:u}=Hve(r.grid),d=r.grid.cells.space.axisOrderSlowToFast;return el.create(a,o,s,c,u,l,r.grid.stats,!1,d,n)}async function QQe(e,t,r,n,o,i){let{runtime:s,webgl:a}=e;if(a===void 0)throw new Error("DirectVolumeVisual requires `webgl` in props");return a.isWebGL2?YQe(s,a,t,i):XQe(s,a,t,i)}function JQe(e,t){return ot.Loci(e)}function eJe(e,t,r,n,o){let{objectId:i,groupId:s}=e;return o===i?ot.Cell.Loci(t,Be.ofSingleton(s)):pr}function tJe(e,t,r,n,o){return xy(e,t,void 0,o)}var rj={...el.Params,quality:{...el.Params.quality,isEssential:!1}};function rJe(e,t){let r=M.clone(rj);return r.controlPoints.getVolume=()=>t,r}function nJe(e){return cf({defaultProps:M.getDefaultValues(rj),createGeometry:QQe,createLocationIterator:t=>Mr(t.grid.cells.data.length,1,1,()=>bs),getLoci:eJe,eachLocation:tJe,setUpdateState:(t,r,n,o)=>{},geometryUtils:el.Utils,dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}function oJe(e,t){return Zg("Direct Volume",e,t,nJe,JQe)}var jve={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:oJe,getParams:rJe,defaultValues:M.getDefaultValues(rj),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!ot.isEmpty(e)&&!ot.Segmentation.get(e)};var iJe={segments:M.Converted(e=>e.map(t=>`${t}`),e=>e.map(t=>parseInt(t)),M.MultiSelect(["0"],M.arrayToOptions(["0"]),{isEssential:!0}))};function sJe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}var M_=1;function oj(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;let r=e.grid.cells.space.dimensions,{powerOfTwoSize:n}=Dm(r,M_);return n<=t.maxTextureSize/2}var aJe=de();function $ve(e,t){let r=go.getGridToCartesianTransform(e),n=de.fromTranslation(aJe,t.min);return de.mul(de(),r,n)}function lJe(e,t,r,n,o){return n.tryUseGpu&&o&&sJe(o)&&oj(t,o)?hJe(e):mJe(e)}function cJe(e,t){return ot.Segment.Loci(e,t.segments)}function Wve(e,t,r,n,o){let{objectId:i,groupId:s}=e;if(o===i){let a=ot.PickingGranularity.get(t);return a==="volume"?ot.Loci(t):a==="object"?ot.Segment.Loci(t,[r]):ot.Cell.Loci(t,Be.ofSingleton(s))}return pr}function qve(e,t,r,n,o){let i=Qe.ofSingleton(r);return xy(e,t,{segments:i},o)}function uJe(e,t,r){let n=r.data,o=r.space.dataOffset,i=xt.size(D(),t),[s,a,l]=i,c=s-1,u=a-1,d=l-1,[m,p,h]=t.min,[f,C,g]=t.max,b=[...r.space.axisOrderSlowToFast],y=cr.Space(i,b,Uint8Array),x=cr.create(y,y.create()),A=x.data,v=y.set;for(let _=0;_<l;++_)for(let I=0;I<a;++I)for(let T=0;T<s;++T){let E=e.includes(n[o(T+m,I+p,_+h)])?255:0,w=e.includes(n[o(Math.min(c+f,T+1+m),I+p,_+h)])?255:0,S=e.includes(n[o(Math.max(0,T-1+m),I+p,_+h)])?255:0,P=e.includes(n[o(T+m,Math.min(u+C,I+1+p),_+h)])?255:0,k=e.includes(n[o(T+m,Math.max(0,I-1+p),_+h)])?255:0,L=e.includes(n[o(T+m,I+p,Math.min(d+g,_+1+h))])?255:0,R=e.includes(n[o(T+m,I+p,Math.max(0,_-1+h))])?255:0;v(A,T,I,_,Math.round((E+E+w+S+P+k+L+R)/8))}return x}async function dJe(e,t,r,n,o,i){let s=ot.Segmentation.get(t);if(!s)throw new Error("missing volume segmentation");e.runtime.update({message:"Marching cubes..."});let a=xt.clone(s.bounds[r]);xt.expand(a,a,D.create(2,2,2));let l=Array.from(s.segments.get(r).values()),c=uJe(l,a,t.grid.cells),u=Rs(new Int32Array(c.data.length)),d=await Vm({isoLevel:128,scalarField:c,idField:cr.create(c.space,cr.Data1(u))},i).runAsChild(e.runtime),m=$ve(t.grid,a);return Ct.transform(d,m),e.webgl&&!e.webgl.isWebGL2?(Ct.uniformTriangleGroup(d,!1),G.updateIfChanged(d.varyingGroup,!1)):G.updateIfChanged(d.varyingGroup,!0),d.setBoundingSphere(ot.Segment.getBoundingSphere(t,[r])),d}var ij={...Ct.Params,...Ns.Params,...iJe,quality:{...Ct.Params.quality,isEssential:!1},tryUseGpu:M.Boolean(!0)};function mJe(e){return cf({defaultProps:M.getDefaultValues(ij),createGeometry:dJe,createLocationIterator:(t,r)=>{let n=ot.Segment.Location(t,r);return Mr(t.grid.cells.data.length,1,1,()=>n)},getLoci:Wve,eachLocation:qve,setUpdateState:(t,r,n,o)=>{},geometryUtils:Ct.Utils,mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&oj(t.volume,n)},e)}var nj="segment-texture";function pJe(e,t,r){let n=ot.Segmentation.get(e);if(!n)throw new Error("missing volume segmentation");let{resources:o}=r,i=xt.clone(n.bounds[t]);xt.expand(i,i,D.create(2,2,2));let s=$ve(e.grid,i),a=xt.size(D(),i),{width:l,height:c,powerOfTwoSize:u}=Dm(a,M_),d=D.create(l,c,0),m=Ve.create(l/u,c/u);if(u>r.maxTextureSize/2)throw new Error("volume too large for gpu segment extraction");r.namedTextures[nj]||(r.namedTextures[nj]=o.texture("image-uint8","alpha","ubyte","linear"));let p=r.namedTextures[nj];p.define(u,u);let h=Array.from(n.segments.get(t).values());return p.load(Xce(e,h,i,M_),!0),a[0]+=M_,a[1]+=M_,{texture:p,transform:s,gridDimension:a,gridTexDim:d,gridTexScale:m}}async function fJe(e,t,r,n,o,i){if(!e.webgl)throw new Error("webgl context required to create volume segment texture-mesh");if(t.grid.cells.data.length<=1)return Ns.createEmpty(i);let{texture:s,gridDimension:a,gridTexDim:l,gridTexScale:c,transform:u}=pJe(t,r,e.webgl),d=t.grid.cells.space.axisOrderSlowToFast,m=i?.doubleBuffer.get(),p=M1(e.webgl,s,a,l,c,u,.5,!1,!1,d,!0,m?.vertex,m?.group,m?.normal),h=t.grid.cells.data.length;return Ns.create(p.vertexCount,h,p.vertexTexture,p.groupTexture,p.normalTexture,ot.Segment.getBoundingSphere(t,[r]),i)}function hJe(e){return cf({defaultProps:M.getDefaultValues(ij),createGeometry:fJe,createLocationIterator:(t,r)=>{let n=ot.Segment.Location(t,r);return Mr(t.grid.cells.data.length,1,1,()=>n)},getLoci:Wve,eachLocation:qve,setUpdateState:(t,r,n,o)=>{},geometryUtils:Ns.Utils,mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!oj(t.volume,n),dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}function gJe(e){return Qe.ofUnsortedArray(e.segments)}var Zve={segment:(e,t)=>Zg("Segment mesh",e,t,lJe,cJe,gJe)},Kve={...ij,visuals:M.MultiSelect(["segment"],M.objectToOptions(Zve)),bumpFrequency:M.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)};function yJe(e,t){let r=M.clone(Kve),n=ot.Segmentation.get(t);if(n){let o=Array.from(n.segments.keys());r.segments=M.Converted(i=>i.map(s=>`${s}`),i=>i.map(s=>parseInt(s)),M.MultiSelect(o.map(i=>`${i}`),M.arrayToOptions(o.map(i=>`${i}`)),{isEssential:!0}))}return r}function vJe(e,t){return Wt.createMulti("Segment",e,t,Wt.StateBuilder,Zve)}var Xve={name:"segment",label:"Segment",description:"Displays a triangulated segment of volumetric data.",factory:vJe,getParams:yJe,defaultValues:M.getDefaultValues(Kve),defaultColorTheme:{name:"volume-segment"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!ot.isEmpty(e)&&!!ot.Segmentation.get(e)};var mv=class e extends qC{constructor(){super(),Ao(e.BuiltIn,(t,r)=>{if(t.name!==r)throw new Error(`Fix BuiltInVolumeRepresentations to have matching names. ${t.name} ${r}`);this.add(t)})}};(function(e){e.BuiltIn={isosurface:Ove,slice:Uve,"direct-volume":jve,segment:Xve}})(mv||(mv={}));function Yve(e,t,r,n){e.push({source:t==="em"?{name:"em",params:{isoValue:ot.IsoValue.absolute(n||0)}}:{name:"x-ray",params:{}},dataId:r})}var R_=ki.build({display:{name:"Volume Streaming"},from:fe.Molecule.Structure,params(e,t){let r=bve(e&&e.data),n=xve(r,e&&e.data);return{method:M.Select(r,[["em","EM"],["x-ray","X-Ray"]]),entries:M.ObjectList({id:M.Text(n[0]||"")},({id:o})=>o,{defaultValue:n.map(o=>({id:o}))}),defaultView:M.Select(r==="em"?"auto":"selection-box",sa.ViewTypeOptions),options:M.Group({serverUrl:M.Text(t.config.get(Ot.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:M.Text("",{isHidden:!0}),emContourProvider:M.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:M.Value({},{isHidden:!0})})}},isApplicable:(e,t,r)=>{let n=r.config.get(Ot.VolumeStreaming.CanStream);return n?n(e.data,r):e.data.models.length===1&&Ut.probablyHasDensityMap(e.data.models[0])}})(({ref:e,state:t,params:r},n)=>ke.create("Volume Streaming",async o=>{let i=[];for(let d=0,m=r.entries.length;d<m;++d){let p=r.entries[d].id.toLowerCase(),h;if(r.method==="em"){if(!p.toUpperCase().startsWith("EMD")){await o.update("Getting EMDB info...");let f=await Cve(n,o,p);for(let C=0,g=f.length;C<g;++C){let b=f[C],y;try{y=await W6(r.options.emContourProvider,n,o,b)}catch{continue}Yve(i,r.method,b,y||0)}continue}try{h=await W6(r.options.emContourProvider,n,o,p)}catch{continue}}Yve(i,r.method,p,h||0)}let s=t.build().to(e).applyOrUpdateTagged(sa.RootTag,xJe,{serverUrl:r.options.serverUrl,entries:i});await s.commit();let a=s.selector;if(!a.isOk)return;let l=t.tree.children.get(a.ref);l?.size>0&&await n.managers.structure.hierarchy.remove(l?.toArray());let c=a.cell.obj,u=t.build().to(s.ref).apply(B_,M.getDefaultValues(sa.createParams({data:c.data,defaultView:r.defaultView,channelParams:r.options.channelParams})),{ref:r.options.behaviorRef?r.options.behaviorRef:void 0});r.method==="em"?u.apply(aB,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(u.apply(aB,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),u.apply(aB,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),u.apply(aB,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),await t.updateTree(u).runInContext(o)})),Jve=ki.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:sa,isApplicable:e=>e.data.params.entry.params.view.name==="selection-box"})(({a:e,ref:t,state:r},n)=>{let o=e.data.params;if(o.entry.params.view.name!=="selection-box")return;let i=xt.create(D.clone(o.entry.params.view.params.bottomLeft),D.clone(o.entry.params.view.params.topRight)),s=o.entry.params.view.params.radius;xt.expand(i,i,D.create(s,s,s));let a={...o,entry:{name:o.entry.name,params:{...o.entry.params,view:{name:"box",params:{bottomLeft:i.min,topRight:i.max}}}}};return r.updateTree(r.build().to(t).update(a))}),bJe={dataId:M.Text(""),source:M.MappedStatic("x-ray",{em:M.Group({isoValue:ot.createIsoValueParam(ot.IsoValue.relative(1))}),"x-ray":M.Group({})})};var xJe=Lt.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:fe.Molecule.Structure,to:XS,params(e){return{serverUrl:M.Text("https://ds.litemol.org"),entries:M.ObjectList(bJe,({dataId:t})=>t,{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})}}})({apply:({a:e,params:t},r)=>ke.create("",async n=>{let o=[];for(let s=0,a=t.entries.length;s<a;++s){let l=t.entries[s],c=l.dataId,u=l.source.name==="em"?l.source.params.isoValue:ot.IsoValue.relative(1);await n.update("Getting server header...");let d=await r.fetch({url:Ty(t.serverUrl,`${l.source.name}/${c.toLocaleLowerCase()}`),type:"json"}).runInContext(n);o.push({dataId:c,kind:l.source.name,header:d,emDefaultContourLevel:u})}let i={serverUrl:t.serverUrl,entries:o,structure:e.data};return new XS(i,{label:"Volume Server",description:`${o.map(s=>s.dataId).join(", ")}`})})});var B_=Lt.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:XS,to:sa,params(e){return sa.createParams({data:e&&e.data})}})({canAutoUpdate:({oldParams:e,newParams:t})=>e.entry.params.view===t.entry.params.view||t.entry.params.view.name==="selection-box"||t.entry.params.view.name==="camera-target"||t.entry.params.view.name==="off",apply:({a:e,params:t},r)=>ke.create("Volume streaming",async n=>{let o=new sa.Behavior(r,e.data);return await o.update(t),new sa(o,{label:"Volume Streaming",description:o.getDescription()})}),update({a:e,b:t,oldParams:r,newParams:n}){return ke.create("Update Volume Streaming",async o=>{if(r.entry.name!==n.entry.name&&"em"in n.entry.params.channels){let{emDefaultContourLevel:s}=t.data.infoMap.get(n.entry.name);s&&(n.entry.params.channels.em.isoValue=s)}let i=await t.data.update(n)?st.UpdateResult.Updated:st.UpdateResult.Unchanged;return t.description=t.data.getDescription(),i})}});var aB=Lt.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:sa,to:fe.Volume.Representation3D,params:{channel:M.Select("em",sa.ChannelTypeOptions,{isHidden:!0})}})({apply:({a:e,params:t,spine:r},n)=>ke.create("Volume Representation",async o=>{var i,s;let a=e.data.channels[t.channel];if(!a)return Hn.Null;let l=Qve(e.data,t.channel),c=mv.BuiltIn.isosurface,u=l.type.params||{},d=c.factory({webgl:(i=n.canvas3d)===null||i===void 0?void 0:i.webgl,...n.representation.volume.themes},c.getParams);d.setTheme(ii.create(n.representation.volume.themes,{volume:a.data},l));let m=(s=r.getAncestorOfType(fe.Molecule.Structure))===null||s===void 0?void 0:s.data,p=m?.models.length===0?void 0:Zf.get(m?.models[0]);return await d.createOrUpdate(u,a.data).runInContext(o),p&&d.setState({transform:p}),new fe.Volume.Representation3D({repr:d,sourceData:a.data},{label:`${Math.round(a.isoValue.relativeValue*100)/100} \u03C3 [${t.channel}]`})}),update:({a:e,b:t,newParams:r,spine:n},o)=>ke.create("Volume Representation",async i=>{let s=e.data.channels[r.channel];if(!s)return st.UpdateResult.Unchanged;let a=t.data.repr.state.visible,l=Qve(e.data,r.channel),c={...t.data.repr.props,...l.type.params};return t.data.repr.setTheme(ii.create(o.representation.volume.themes,{volume:s.data},l)),await t.data.repr.createOrUpdate(c,s.data).runInContext(i),t.data.repr.setState({visible:a}),t.data.sourceData=s.data,st.UpdateResult.Updated})});function Qve(e,t){let r=e.channels[t];return Rm.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:r.isoValue,alpha:r.opacity,visuals:r.wireframe?["wireframe"]:["solid"]},"uniform",{value:r.color})}var pv=class extends NS{constructor(){super(...arguments),this._getInfo=nu((t,r,n)=>sf.infoFromAction(this.plugin,this.props.state,this.props.action,this.props.nodeRef)),this.state={plugin:this.plugin,ref:this.props.nodeRef,version:this.props.state.transforms.get(this.props.nodeRef).version,error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return ht.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})}getInfo(){var t;return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version,(t=this.state)===null||t===void 0?void 0:t.isCollapsed)}getTransformerId(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id}getHeader(){return this.props.hideHeader?"none":this.props.action.definition.display}canApply(){return!this.state.error&&!this.state.busy}canAutoApply(){return!1}applyText(){return"Apply"}isUpdate(){return!1}getSourceAndTarget(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}}static getDerivedStateFromProps(t,r){let n=t.state.transforms.get(t.nodeRef).version;if(t.nodeRef===r.ref&&n===r.version)return null;let o=t.state.cells.get(t.nodeRef).obj,i=t.action.definition.params?M.getDefaultValues(t.action.definition.params(o,r.plugin)):{};return{plugin:r.plugin,ref:t.nodeRef,version:n,params:i,isInitial:!0,error:void 0}}};var lB=class extends il{defaultState(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:Gz}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.setState({isHidden:!this.canEnable(),description:mh.getSelectedStructuresDescription(this.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{xr.hasTag(t.cell.transform,sa.RootTag)&&this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get pivot(){return this.plugin.managers.structure.hierarchy.selection.structures[0]}canEnable(){var t,r;let{selection:n}=this.plugin.managers.structure.hierarchy;if(n.structures.length!==1)return!1;let o=this.pivot.cell;return o.obj?!!(!((r=(t=R_.definition).isApplicable)===null||r===void 0)&&r.call(t,o.obj,o.transform,this.plugin)):!1}renderEnable(){var t,r;let n=this.pivot;if(!n.cell.parent)return null;let o=Kt.findTagInSubtree(n.cell.parent.tree,this.pivot.cell.transform.ref,sa.RootTag),i=o&&n.cell.parent.cells.get(o),s=i&&i.status==="error"?{header:i.errorText&&(!((t=i.errorText)===null||t===void 0)&&t.includes("404"))?"No Density Data Available":"Error Enabling",icon:zz,title:i.errorText}:i&&((r=i.obj)===null||r===void 0?void 0:r.data.entries.length)===0?{header:"Error Enabling",icon:zz,title:"No Entry for Streaming Found"}:{header:"Enable",icon:Fd,title:"Enable"};return(0,Yo.jsx)(pv,{state:n.cell.parent,action:R_,initiallyCollapsed:!0,nodeRef:n.cell.transform.ref,simpleApply:s})}renderParams(){var t,r,n,o,i;let s=this.pivot;if(!s.cell.parent)return null;let a=((r=(t=s.volumeStreaming)===null||t===void 0?void 0:t.cell.transform.params)===null||r===void 0?void 0:r.entry.params.view.name)==="selection-box"&&((i=(o=(n=this.plugin.state.behaviors.cells.get(o1.id))===null||n===void 0?void 0:n.params)===null||o===void 0?void 0:o.values)===null||i===void 0?void 0:i.bindings);return(0,Yo.jsxs)(Yo.Fragment,{children:[(0,Yo.jsx)(Oa,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0}),a&&(0,Yo.jsx)(lo,{header:"Controls Help",children:(0,Yo.jsx)(ZS,{bindings:a})})]})}renderControls(){let t=this.pivot;return t?t.volumeStreaming?this.renderParams():this.renderEnable():null}},cB=class extends il{constructor(){super(...arguments),this.item=t=>{var r;let n=this.plugin.managers.volume.hierarchy.selection,o=((r=t.cell.obj)===null||r===void 0?void 0:r.label)||"Volume";return{kind:"item",label:(t.kind==="lazy-volume"?"Load ":"")+(o||t.kind),selected:n===t,value:t}},this.selectCurrent=t=>{if(this.toggleHierarchy(),!t)return;let r=t.value;r.kind==="volume"?this.plugin.managers.volume.hierarchy.setCurrent(r):this.lazyLoad(r.cell)},this.selectAdd=t=>{t&&(this.setState({show:void 0}),t.value())},this.toggleHierarchy=()=>this.setState({show:this.state.show!=="hierarchy"?"hierarchy":void 0}),this.toggleAddRepr=()=>this.setState({show:this.state.show!=="add-repr"?"add-repr":void 0})}defaultState(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:Gz}}}componentDidMount(){this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,t=>{this.setState({isHidden:t.hierarchy.volumes.length===0&&t.hierarchy.lazyVolumes.length===0})}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get hierarchyItems(){let t=this.plugin.managers.volume.hierarchy,{current:r}=t,n=[];for(let o of r.volumes)n.push(this.item(o));for(let o of r.lazyVolumes)n.push(this.item(o));return n}get addActions(){let t=this.plugin.managers.volume.hierarchy,r=t.selection;return[...cv.getRepresentationTypes(this.plugin,r).map(o=>hr.Item(o[1],()=>t.addRepresentation(r,o[0])))]}get isEmpty(){let{volumes:t,lazyVolumes:r}=this.plugin.managers.volume.hierarchy.current;return t.length===0&&r.length===0}get label(){var t;if(this.state.loadingLabel)return`Loading ${this.state.loadingLabel}...`;let r=this.plugin.managers.volume.hierarchy.selection;return r?((t=r?.cell.obj)===null||t===void 0?void 0:t.label)||"Volume":"Nothing Selected"}async lazyLoad(t){let{url:r,isBinary:n,format:o,entryId:i,isovalues:s}=t.obj.data;this.setState({isBusy:!0,loadingLabel:t.obj.label});try{let a=this.plugin;await a.dataTransaction(async()=>{var l,c,u,d;let m=await a.builders.data.download({url:r,isBinary:n},{state:{isGhost:!0}}),p=await a.dataFormats.get(o).parse(a,m,{entryId:i}),h=p.volume||p.volumes[0];if(!h?.isOk)throw new Error("Failed to parse any volume.");let f=a.build();for(let C of s)f.to((u=(l=p.volumes)===null||l===void 0?void 0:l[(c=C.volumeIndex)!==null&&c!==void 0?c:0])!==null&&u!==void 0?u:p.volume).apply(Je.Representation.VolumeRepresentation3D,Ul(this.plugin,h.data,{type:"isosurface",typeParams:{alpha:(d=C.alpha)!==null&&d!==void 0?d:1,isoValue:C.type==="absolute"?{kind:"absolute",absoluteValue:C.value}:{kind:"relative",relativeValue:C.value}},color:"uniform",colorParams:{value:C.color}}));await f.commit(),await a.build().delete(t).commit()})}finally{this.setState({isBusy:!1,loadingLabel:void 0})}}renderControls(){let t=this.state.isBusy||this.isEmpty,r=this.label,n=this.plugin.managers.volume.hierarchy.selection;return(0,Yo.jsxs)(Yo.Fragment,{children:[(0,Yo.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,Yo.jsx)(or,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:t,title:r,children:r}),!this.isEmpty&&n&&(0,Yo.jsx)(Jt,{svg:nf,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:this.state.show==="add-repr",disabled:t})]}),this.state.show==="hierarchy"&&(0,Yo.jsx)(hr,{items:this.hierarchyItems,onSelect:this.selectCurrent}),this.state.show==="add-repr"&&(0,Yo.jsx)(hr,{items:this.addActions,onSelect:this.selectAdd}),n&&n.representations.length>0&&(0,Yo.jsx)("div",{style:{marginTop:"6px"},children:n.representations.map(o=>(0,Yo.jsx)(sj,{representation:o},o.cell.transform.ref))})]})}},sj=class extends Xo{constructor(){super(...arguments),this.state={action:void 0},this.remove=()=>this.plugin.managers.volume.hierarchy.remove([this.props.representation],!0),this.toggleVisible=t=>{t.preventDefault(),t.currentTarget.blur(),this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation])},this.toggleColor=()=>{this.setState({action:this.state.action==="select-color"?void 0:"select-color"})},this.toggleUpdate=()=>this.setState({action:this.state.action==="update"?void 0:"update"}),this.highlight=t=>{t.preventDefault(),this.props.representation.cell.parent&&ht.Interactivity.Object.Highlight(this.plugin,{state:this.props.representation.cell.parent,ref:this.props.representation.cell.transform.ref})},this.clearHighlight=t=>{t.preventDefault(),ht.Interactivity.ClearHighlights(this.plugin)},this.focus=()=>{var t;let r=this.props.representation,n=(t=r.cell.obj)===null||t===void 0?void 0:t.data.repr.getAllLoci();r.cell.state.isHidden&&this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation],"show"),n&&this.plugin.managers.camera.focusLoci(n,{extraRadius:1})},this.updateColor=({value:t})=>{let r=this.props.representation.cell.transform;return this.plugin.build().to(r.ref).update({...r.params,colorTheme:{name:"uniform",params:{value:t}}}).commit()}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{Mu.ObjectEvent.isCell(t,this.props.representation.cell)&&this.forceUpdate()})}get color(){var t,r;let n=this.props.representation.cell;if(((t=n.transform.params)===null||t===void 0?void 0:t.colorTheme.name)==="uniform")return(r=n.transform.params)===null||r===void 0?void 0:r.colorTheme.params.value}render(){var t,r,n;let o=this.props.representation.cell,i=this.color;return(0,Yo.jsxs)(Yo.Fragment,{children:[(0,Yo.jsxs)("div",{className:"msp-flex-row",children:[i!==void 0&&(0,Yo.jsx)(or,{style:{backgroundColor:ze.toStyle(i),minWidth:32,width:32},onClick:this.toggleColor}),(0,Yo.jsxs)(or,{noOverflow:!0,className:"msp-control-button-label",title:`${(t=o.obj)===null||t===void 0?void 0:t.label}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[(r=o.obj)===null||r===void 0?void 0:r.label,(0,Yo.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:(n=o.obj)===null||n===void 0?void 0:n.description})]}),(0,Yo.jsx)(Jt,{svg:o.state.isHidden?uc:dc,toggleState:!1,onClick:this.toggleVisible,title:`${o.state.isHidden?"Show":"Hide"} component`,small:!0,className:"msp-form-control",flex:!0}),(0,Yo.jsx)(Jt,{svg:Fa,onClick:this.remove,title:"Remove",small:!0}),(0,Yo.jsx)(Jt,{svg:Um,onClick:this.toggleUpdate,title:"Actions",toggleState:this.state.action==="update"})]}),this.state.action==="update"&&!!o.parent&&(0,Yo.jsx)("div",{style:{marginBottom:"6px"},className:"msp-accent-offset",children:(0,Yo.jsx)(Oa,{state:o.parent,transform:o.transform,customHeader:"none",noMargin:!0})}),this.state.action==="select-color"&&i!==void 0&&(0,Yo.jsx)("div",{style:{marginBottom:"6px",marginTop:1},className:"msp-accent-offset",children:(0,Yo.jsx)(zl,{header:"Select Color",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleColor,topRightIcon:hu,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,Yo.jsx)(BS,{param:CJe,value:this.color,onChange:this.updateColor,name:"color",hideNameRow:!0})})})]})}},CJe=M.Color(ze(1184274));var fn=ar(un());var L_;(function(e){function t(n){return{size:n,matrix:pn.create(n,n),eigenValues:new Float64Array(n),D:new Float64Array(n),E:new Float64Array(n)}}e.createCache=t;function r(n){SJe(n.size,n.matrix.data,n.eigenValues,n.D,n.E)}e.compute=r})(L_||(L_={}));function SJe(e,t,r,n,o){for(let s=0;s<e;s++)o[s]=0;let i=e-1;for(let s=0;s<e;s++)n[s]=t[s*e+i];IJe(t,n,o,e),AJe(t,n,o,e);for(let s=0;s<e;s++)r[s]=n[s]}function IJe(e,t,r,n){for(let o=n-1;o>0;o--){let i=0,s=0;for(let a=0;a<o;a++)i=i+Math.abs(t[a]);if(i===0){r[o]=t[o-1];for(let a=0;a<o;a++)t[a]=e[a*n+o-1],e[a*n+o]=0,e[o*n+a]=0}else{for(let u=0;u<o;u++)t[u]/=i,s+=t[u]*t[u];let a=t[o-1],l=Math.sqrt(s);a>0&&(l=-l),r[o]=i*l,s=s-a*l,t[o-1]=a-l;for(let u=0;u<o;u++)r[u]=0;for(let u=0;u<o;u++){a=t[u],e[o*n+u]=a,l=r[u]+e[u*n+u]*a;for(let d=u+1;d<=o-1;d++)l+=e[u*n+d]*t[d],r[d]+=e[u*n+d]*a;r[u]=l}a=0;for(let u=0;u<o;u++)r[u]/=s,a+=r[u]*t[u];let c=a/(s+s);for(let u=0;u<o;u++)r[u]-=c*t[u];for(let u=0;u<o;u++){a=t[u],l=r[u];for(let d=u;d<=o-1;d++)e[u*n+d]-=a*r[d]+l*t[d];t[u]=e[u*n+o-1],e[u*n+o]=0}}t[o]=s}for(let o=0;o<n-1;o++){e[o*n+n-1]=e[o*n+o],e[o*n+o]=1;let i=t[o+1];if(i!==0){for(let s=0;s<=o;s++)t[s]=e[(o+1)*n+s]/i;for(let s=0;s<=o;s++){let a=0;for(let l=0;l<=o;l++)a+=e[(o+1)*n+l]*e[s*n+l];for(let l=0;l<=o;l++)e[s*n+l]-=a*t[l]}}for(let s=0;s<=o;s++)e[(o+1)*n+s]=0}for(let o=0;o<n;o++)t[o]=e[o*n+n-1],e[o*n+n-1]=0;e[n*n-1]=1,r[0]=0}function AJe(e,t,r,n){for(let l=1;l<n;l++)r[l-1]=r[l];r[n-1]=0;let i=0,s=0,a=Math.pow(2,-53);for(let l=0;l<n;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(r[l]));let c=l;for(;c<n&&!(Math.abs(r[c])<=a*s);)c++;if(c>l){let u=0;do{u=u+1;let d=t[l],m=(t[l+1]-d)/(2*r[l]),p=ebe(m,1);m<0&&(p=-p),t[l]=r[l]/(m+p),t[l+1]=r[l]*(m+p);let h=t[l+1],f=d-t[l];for(let v=l+2;v<n;v++)t[v]-=f;i=i+f,m=t[c];let C=1,g=C,b=C,y=r[l+1],x=0,A=0;for(let v=c-1;v>=l;v--){b=g,g=C,A=x,d=C*r[v],f=C*m,p=ebe(m,r[v]),r[v+1]=x*p,x=r[v]/p,C=m/p,m=C*t[v]-x*d,t[v+1]=f+x*(C*d+x*t[v]);for(let _=0;_<n;_++)f=e[(v+1)*n+_],e[(v+1)*n+_]=x*e[v*n+_]+C*f,e[v*n+_]=C*e[v*n+_]-x*f}if(m=-x*A*b*y*r[l]/h,r[l]=x*m,t[l]=C*m,u>=1e3)throw new Error("SVD: Not converging.")}while(Math.abs(r[l])>a*s)}t[l]=t[l]+i,r[l]=0}for(let l=0;l<n-1;l++){let c=l,u=t[l];for(let d=l+1;d<n;d++)t[d]<u&&(c=d,u=t[d]);if(c!==l){t[c]=t[l],t[l]=u;for(let d=0;d<n;d++)u=e[l*n+d],e[l*n+d]=e[c*n+d],e[c*n+d]=u}}}function ebe(e,t){if(Math.abs(e)>Math.abs(t)){let r=t/e;return Math.abs(e)*Math.sqrt(1+r*r)}if(t!==0){let r=e/t;return Math.abs(t)*Math.sqrt(1+r*r)}return 0}var df;(function(e){let t;(function(n){function o(i){return{x:new Float64Array(i),y:new Float64Array(i),z:new Float64Array(i)}}n.empty=o})(t=e.Positions||(e.Positions={}));function r(n,o){return typeof o>"u"&&(o={bTransform:de.zero(),rmsd:0}),TJe(new aj(n,o)),o}e.compute=r})(df||(df={}));var aj=class{constructor(t,r){this.evdCache=L_.createCache(4),this.translateB=de.identity(),this.rotateB=de.identity(),this.tempMatrix=de.identity(),this.a=t.a,this.b=t.b,t.centerA?this.centerA=t.centerA:this.centerA=t.centerA=ec.fromArrays(t.a,Pe()).center,t.centerB?this.centerB=t.centerB:this.centerB=t.centerB=ec.fromArrays(t.b,Pe()).center,this.result=r}};function wJe(e){let t=e.evdCache.matrix;pn.makeZero(t);let r=e.a.x,n=e.a.y,o=e.a.z,i=e.b.x,s=e.b.y,a=e.b.z,l=e.centerA,c=e.centerB,u=0,d=Math.min(e.a.x.length,e.b.x.length);for(let m=0;m<d;m++){let p=r[m]-l[0],h=n[m]-l[1],f=o[m]-l[2],C=i[m]-c[0],g=s[m]-c[1],b=a[m]-c[2];u+=p*p+h*h+f*f+C*C+g*g+b*b,pn.add(t,0,0,p*C+h*g+f*b),pn.add(t,0,1,-(f*g)+h*b),pn.add(t,0,2,f*C-p*b),pn.add(t,0,3,-(h*C)+p*g),pn.add(t,1,0,-(f*g)+h*b),pn.add(t,1,1,p*C-h*g-f*b),pn.add(t,1,2,h*C+p*g),pn.add(t,1,3,f*C+p*b),pn.add(t,2,0,f*C-p*b),pn.add(t,2,1,h*C+p*g),pn.add(t,2,2,-(p*C)+h*g-f*b),pn.add(t,2,3,f*g+h*b),pn.add(t,3,0,-(h*C)+p*g),pn.add(t,3,1,f*C+p*b),pn.add(t,3,2,f*g+h*b),pn.add(t,3,3,-(p*C)-h*g+f*b)}return u}function _Je(e){let t=e.evdCache.matrix,r=pn.get(t,1,3),n=pn.get(t,2,3),o=pn.get(t,3,3),i=pn.get(t,0,3),s=2*n*n,a=2*o*o,l=2*r*r,c=2*r*n,u=2*i*o,d=2*r*o,m=2*i*n,p=2*n*o,h=2*i*r,f=e.translateB;de.setValue(f,0,3,-e.centerB[0]),de.setValue(f,1,3,-e.centerB[1]),de.setValue(f,2,3,-e.centerB[2]),f=e.rotateB,de.setValue(f,0,0,1-s-a),de.setValue(f,0,1,c+u),de.setValue(f,0,2,d-m),de.setValue(f,1,0,c-u),de.setValue(f,1,1,1-l-a),de.setValue(f,1,2,p+h),de.setValue(f,2,0,d+m),de.setValue(f,2,1,p-h),de.setValue(f,2,2,1-l-s),de.setValue(f,3,3,1),de.mul(e.tempMatrix,e.rotateB,e.translateB),f=e.translateB,de.setValue(f,0,3,e.centerA[0]),de.setValue(f,1,3,e.centerA[1]),de.setValue(f,2,3,e.centerA[2]),de.mul(e.result.bTransform,e.translateB,e.tempMatrix)}function TJe(e){let t=wJe(e);L_.compute(e.evdCache);let r=t-2*e.evdCache.eigenValues[3];r=r<0?0:Math.sqrt(r/e.a.x.length),_Je(e),e.result.rmsd=r}var EJe="ACDEFGHIKLMNPQRSTVWY",PJe="ARNDCQEGHILKMFPSTWYVBZX",DJe=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]],kJe=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]];function tbe(e,t){let r,n=0,o={};return t.forEach(i=>{r=0;let s={};i.forEach(a=>s[e[r++]]=a),o[e[n++]]=s}),o}var rbe={blosum62:tbe(PJe,kJe),blosum62x:tbe(EJe,DJe)};var MJe={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};function nbe(e,t,r={}){let n={...MJe,...r},o=new lj(e,t,n);return o.calculate(),o.trace()}var lj=class{constructor(t,r,n){this.seqA=t,this.seqB=r,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix=n.substMatrix==="default"?void 0:rbe[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}initMatrices(){let{n:t,m:r,gapPenalty:n,S:o,V:i,H:s}=this;for(let a=0;a<=t;++a){o[a]=[],i[a]=[],s[a]=[];for(let l=0;l<=r;++l)o[a][l]=0,i[a][l]=0,s[a][l]=0}for(let a=0;a<=t;++a)o[a][0]=n,s[a][0]=-1/0;for(let a=0;a<=r;++a)o[0][a]=n,i[0][a]=-1/0;o[0][0]=0}makeScoreFn(){let{seqA:t,seqB:r,substMatrix:n}=this;return n?function(i,s){var a,l;let c=t[i],u=r[s];return(l=(a=n[c])===null||a===void 0?void 0:a[u])!==null&&l!==void 0?l:-4}:function(i,s){let a=t[i],l=r[s];return a===l?5:-3}}calculate(){this.initMatrices();let t=this.makeScoreFn(),{V:r,H:n,S:o,n:i,m:s,gapExtensionPenalty:a,gapPenalty:l}=this,c,u,d,m,p;for(let h=1;h<=i;++h){u=o[h-1],c=r[h-1],d=r[h],m=n[h],p=o[h];for(let f=1;f<=s;++f)d[f]=Math.max(u[f]+l,c[f]+a),m[f]=Math.max(p[f-1]+l,m[f-1]+a),p[f]=Math.max(u[f-1]+t(h-1,f-1),d[f],m[f])}}trace(){let t=this.makeScoreFn(),{V:r,H:n,S:o,seqA:i,seqB:s,gapExtensionPenalty:a,gapPenalty:l}=this,c=this.n,u=this.m,d,m,p="",h="";for(o[c][u]>=r[c][u]?(d="S",m=o[c][u]):r[c][u]>=n[c][u]?(d="V",m=r[c][u]):(d="H",m=n[c][u]);c>0&&u>0;)d==="S"?o[c][u]===o[c-1][u-1]+t(c-1,u-1)?(p=i[c-1]+p,h=s[u-1]+h,--c,--u,d="S"):o[c][u]===r[c][u]?d="V":o[c][u]===n[c][u]?d="H":(--c,--u):d==="V"?r[c][u]===r[c-1][u]+a?(p=i[c-1]+p,h="-"+h,--c,d="V"):r[c][u]===o[c-1][u]+l?(p=i[c-1]+p,h="-"+h,--c,d="S"):--c:d==="H"&&(n[c][u]===n[c][u-1]+a?(p="-"+p,h=s[u-1]+h,--u,d="H"):n[c][u]===o[c][u-1]+l?(p="-"+p,h=s[u-1]+h,--u,d="S"):--u);for(;c>0;)p=i[c-1]+p,h="-"+h,--c;for(;u>0;)p="-"+p,h=s[u-1]+h,--u;return{aliA:p,aliB:h,score:m}}};var uB;(function(e){function t(n){let o=new Map;if(Le.isAtomic(n.unit)){let{label_seq_id:i}=n.unit.model.atomicHierarchy.residues,{residueIndex:s}=n.unit;for(let a=0,l=Ge.size(n.indices);a<l;++a){let c=Ge.getAt(n.indices,a),u=n.unit.elements[c],d=i.value(s[u]);o.has(d)?o.get(d).push(c):o.set(d,[c])}}else if(Le.isCoarse(n.unit)){let{seq_id_begin:i}=Le.isSpheres(n.unit)?n.unit.model.coarseHierarchy.spheres:n.unit.model.coarseHierarchy.gaussians;for(let s=0,a=Ge.size(n.indices);s<a;++s){let l=Ge.getAt(n.indices,s),c=n.unit.elements[l],u=i.value(c);o.set(u,[l])}}return o}e.createSeqIdIndicesMap=t;function r(n,o={}){let i=obe(n.a.unit),s=obe(n.b.unit),a=t(n.a),l=t(n.b),c=[],u=[],{aliA:d,aliB:m,score:p}=nbe(i.code.toArray(),s.code.toArray(),o),h=0,f=0;for(let b=0,y=d.length;b<y;++b){if(d[b]==="-"||m[b]==="-"){d[b]!=="-"&&(h+=1),m[b]!=="-"&&(f+=1);continue}let x=i.seqId.value(h),A=s.seqId.value(f);if(a.has(x)&&l.has(A)){let v=a.get(x),_=l.get(A);for(let I=0,T=Math.min(v.length,_.length);I<T;++I)c.push(v[I]),u.push(_[I])}h+=1,f+=1}let C=Ge.intersect(Ge.ofSortedArray(c),n.a.indices),g=Ge.intersect(Ge.ofSortedArray(u),n.b.indices);return{a:{unit:n.a.unit,indices:C},b:{unit:n.b.unit,indices:g},score:p}}e.compute=r})(uB||(uB={}));function RJe(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}function obe(e){return e.model.sequence.byEntityKey[RJe(e)].sequence}function cj(e){let t=[];if(e.length<=0)return t;let r=LJe(e),n={a:N_(e[0],r),b:N_(e[1],r)};t[0]=df.compute(n);for(let o=2;o<e.length;o++)n.b=N_(e[o],r),n.centerB=void 0,t.push(df.compute(n));return t}var BJe=/(polypeptide|cyclic-pseudo-peptide)/i;function ibe(e){let t=[];if(e.length<=0)return t;let r=ce.Loci.getFirstLocation(e[0]),o=nt.entity.subtype(r).match(BJe)?"blosum62":"default";for(let i=1;i<e.length;i++){let{a:s,b:a,score:l}=uB.compute({a:e[0].elements[0],b:e[i].elements[0]},{substMatrix:o}),c=ce.Loci(e[0].structure,[s]),u=ce.Loci(e[i].structure,[a]),d=Ge.size(s.indices);t.push({...df.compute({a:N_(c,d),b:N_(u,d)}),alignmentScore:l})}return t}function N_(e,t){let r=df.Positions.empty(t),n=0;for(let o of e.elements){let{unit:i,indices:s}=o,{elements:a,conformation:l}=i;for(let c=0,u=Ge.size(s);c<u;c++){let d=a[Ge.getAt(s,c)];if(r.x[n]=l.x(d),r.y[n]=l.y(d),r.z[n]=l.z(d),n++,n>=t)break}if(n>=t)break}return r}function LJe(e){if(e.length===0)return 0;let t=ce.Loci.size(e[0]);for(let r=1;r<e.length;r++){let n=ce.Loci.size(e[r]);n<t&&(t=n)}return t}function sbe(e,t){var r,n;let o=new Map;for(let u=0;u<e.length;u++)VJe(e[u],o,u,(r=t?.traceOnly)!==null&&r!==void 0?r:!0,(n=t?.includeResidueTest)!==null&&n!==void 0?n:OJe);let i=Array.from(o.values()),s=FJe(e.length,i),a=[],l=[],c=[];for(let u of s)if(u.count===0)a.push([u.i,u.j]);else{let[d,m]=NJe(i,u.i,u.j,u.count),p=df.compute({a:d,b:m});Number.isNaN(p.rmsd)?l.push([u.i,u.j]):c.push({transform:p,pivot:u.i,other:u.j})}return{entries:c,zeroOverlapPairs:a,failedPairs:l}}function NJe(e,t,r,n){let o=df.Positions.empty(n),i=df.Positions.empty(n),s=0;for(let{pivots:a}of e){let l=a[t],c=a[r];if(!l||!c)continue;let u=Math.min(l[2]-l[1],c[2]-c[1]);for(let d=0;d<u;d++){let m=l[1]+d;o.x[s]=l[0].conformation.x(m),o.y[s]=l[0].conformation.y(m),o.z[s]=l[0].conformation.z(m),m=c[1]+d,i.x[s]=c[0].conformation.x(m),i.y[s]=c[0].conformation.y(m),i.z[s]=c[0].conformation.z(m),s++}}return[o,i]}function FJe(e,t){let r=[];for(let o=0;o<e;o++){r[o]=[];for(let i=0;i<e;i++)r[o][i]=0}for(let{pivots:o}of t)for(let i=0;i<e;i++){if(!o[i])continue;let s=o[i][2]-o[i][1];for(let a=i+1;a<e;a++){if(!o[a])continue;let l=o[a][2]-o[a][1];r[i][a]=r[i][a]+Math.min(s,l)}}let n=[];for(let o=1;o<e;o++)n[o-1]={i:0,j:o,count:r[0][o]};return n}function OJe(){return!0}function VJe(e,t,r,n,o){let i=ce.Location.create(e);for(let s of e.units){if(s.kind!==0)continue;let{elements:a,model:l}=s;i.unit=s;let c=ic.Provider.get(l).value;if(!c)return;let{dbName:u,accession:d,num:m}=c,p=Vt.transientSegments(s.model.atomicHierarchy.chainAtomSegments,a),h=Vt.transientSegments(s.model.atomicHierarchy.residueAtomSegments,a),f=s.model.atomicHierarchy.derived.residue.traceElementIndex;for(;p.hasNext;){let C=p.move();for(h.setSegment(C);h.hasNext;){let g=h.move(),b=g.index;if(!u[b])continue;let y=f[b],x,A;if(n){if(x=y,x===-1)continue;A=x+1}else x=a[g.start],A=a[g.end-1]+1;if(i.element=y>=0?y:x,!o(i,b,x,A))continue;let v=`${u[b]}-${d[b]}-${m[b]}`;if(!t.has(v))t.set(v,{key:v,pivots:{[r]:[s,x,A]}});else{let _=t.get(v);_.pivots[r]||(_.pivots[r]=[s,x,A])}}}}}var dB=class extends il{defaultState(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:Rge},isHidden:!0}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{this.setState({isHidden:t.structures.length<2})})}renderControls(){return(0,fn.jsx)(fn.Fragment,{children:(0,fn.jsx)(uj,{})})}},abe={alignSequences:M.Boolean(!0,{isEssential:!0,description:"For Chain-based 3D superposition, perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."}),traceOnly:M.Boolean(!0,{description:"For Chain- and Uniprot-based 3D superposition, base superposition only on CA (and equivalent) atoms."})},GJe=M.getDefaultValues(abe),UJe="SuperpositionTransform",uj=class extends Xo{constructor(){super(...arguments),this.state={isBusy:!1,canUseDb:!1,action:void 0,options:GJe},this.superposeChains=async()=>{var t,r,n;let{query:o}=this.state.options.traceOnly?Ai.trace:Ai.polymer,i=this.chainEntries,s=i.map(d=>{let m=ce.Loci.toStructure(d.loci),p=wt.toLociWithSourceUnits(o(new ls(m)));return ce.Loci.remap(p,this.getRootStructure(d.loci.structure))}),a=this.plugin.managers.structure.hierarchy.findStructure((t=s[0])===null||t===void 0?void 0:t.structure),l=(n=(r=a?.transform)===null||r===void 0?void 0:r.cell.obj)===null||n===void 0?void 0:n.data.coordinateSystem,c=this.state.options.alignSequences?ibe(s):cj(s),u=i[0];for(let d=1,m=s.length;d<m;++d){let p=i[d],{bTransform:h,rmsd:f}=c[d-1];await this.transform(p.cell,h,l);let C=_p(u.label),g=_p(p.label);this.plugin.log.info(`Superposed [${C}] and [${g}] with RMSD ${f.toFixed(2)}.`)}await this.cameraReset()},this.superposeAtoms=async()=>{var t,r,n;let o=this.atomEntries,i=o.map(u=>ce.Loci.remap(u.loci,this.getRootStructure(u.loci.structure))),s=cj(i),a=this.plugin.managers.structure.hierarchy.findStructure((t=i[0])===null||t===void 0?void 0:t.structure),l=(n=(r=a?.transform)===null||r===void 0?void 0:r.cell.obj)===null||n===void 0?void 0:n.data.coordinateSystem,c=o[0];for(let u=1,d=i.length;u<d;++u){let m=o[u],{bTransform:p,rmsd:h}=s[u-1];await this.transform(m.cell,p,l);let f=_p(c.label),C=_p(m.label),g=o[u].atoms.length;this.plugin.log.info(`Superposed ${g} ${g===1?"atom":"atoms"} of [${f}] and [${C}] with RMSD ${h.toFixed(2)}.`)}await this.cameraReset()},this.superposeDb=async()=>{var t,r,n;let o=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,i=this.state.options.traceOnly,s=o.map(p=>{var h;return(h=p.cell.obj)===null||h===void 0?void 0:h.data}),{entries:a,failedPairs:l,zeroOverlapPairs:c}=sbe(s,{traceOnly:i}),u=(n=(r=(t=o[0])===null||t===void 0?void 0:t.transform)===null||r===void 0?void 0:r.cell.obj)===null||n===void 0?void 0:n.data.coordinateSystem,d=0;for(let p of a)await this.transform(o[p.other].cell,p.transform.bTransform,u),d+=p.transform.rmsd;d/=Math.max(a.length-1,1);let m=p=>`[${p.map(([h,f])=>`(${s[h].models[0].entryId}, ${s[f].models[0].entryId})`).join(", ")}]`;c.length&&this.plugin.log.warn(`Superposition: No UNIPROT mapping overlap between structures ${m(c)}.`),l.length&&this.plugin.log.error(`Superposition: Failed to superpose structures ${m(l)}.`),a.length&&(this.plugin.log.info(`Superposed ${a.length+1} structures with avg. RMSD ${d.toFixed(2)} \xC5.`),await this.cameraReset())},this.toggleByChains=()=>this.setState({action:this.state.action==="byChains"?void 0:"byChains"}),this.toggleByAtoms=()=>this.setState({action:this.state.action==="byAtoms"?void 0:"byAtoms"}),this.toggleOptions=()=>this.setState({action:this.state.action==="options"?void 0:"options"}),this.setOptions=t=>{this.setState({options:t})}}componentDidMount(){this.subscribe(this.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{this.setState({canUseDb:t.structures.every(r=>{var n;return!!(!((n=r.cell.obj)===null||n===void 0)&&n.data)&&r.cell.obj.data.models.some(o=>ic.Provider.isApplicable(o))})})})}get selection(){return this.plugin.managers.structure.selection}async transform(t,r,n){let o=Jn.resolveAndCheck(this.plugin.state.data,t);if(!o)return;let i=this.plugin.state.data.selectQ(c=>c.byRef(o.transform.ref).subtree().withTransformer(Je.Model.TransformStructureConformation))[0],a={transform:{name:"matrix",params:{data:n&&!de.isIdentity(n.matrix)?de.mul(de(),n.matrix,r):r,transpose:!1}}},l=i?this.plugin.state.data.build().to(i).update(a):this.plugin.state.data.build().to(t).insert(Je.Model.TransformStructureConformation,a,{tags:UJe});await this.plugin.runTask(this.plugin.state.data.updateTree(l))}getRootStructure(t){var r;let n=this.plugin.helpers.substructureParent.get(t);return(r=this.plugin.state.data.selectQ(o=>o.byValue(n).rootOfType(fe.Molecule.Structure))[0].obj)===null||r===void 0?void 0:r.data}async cameraReset(){await new Promise(t=>requestAnimationFrame(t)),ht.Camera.Reset(this.plugin)}highlight(t){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:t},!1)}moveHistory(t,r){this.plugin.managers.structure.selection.modifyHistory(t,r,void 0,!0)}focusLoci(t){this.plugin.managers.camera.focusLoci(t)}lociEntry(t,r){return(0,fn.jsx)("div",{className:"msp-flex-row",children:(0,fn.jsx)(or,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(t.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(t.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:(0,fn.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}})})},r)}historyEntry(t,r){let n=this.plugin.managers.structure.selection.additionsHistory;return(0,fn.jsxs)("div",{className:"msp-flex-row",children:[(0,fn.jsxs)(or,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(t.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(t.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[r,". ",(0,fn.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}})]}),n.length>1&&(0,fn.jsx)(Jt,{svg:ev,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(t,"up"),flex:"20px",title:"Move up"}),n.length>1&&(0,fn.jsx)(Jt,{svg:Jy,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(t,"down"),flex:"20px",title:"Move down"}),(0,fn.jsx)(Jt,{svg:Fa,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(t,"remove"),flex:!0,title:"Remove"})]},t.id)}atomsLociEntry(t,r){return(0,fn.jsxs)("div",{children:[(0,fn.jsx)("div",{className:"msp-control-group-header",children:(0,fn.jsx)("div",{className:"msp-no-overflow",title:t.label,children:t.label})}),(0,fn.jsx)("div",{className:"msp-control-offset",children:t.atoms.map((n,o)=>this.historyEntry(n,o))})]},r)}get chainEntries(){let t=ce.Location.create(),r=[];return this.plugin.managers.structure.selection.entries.forEach(({selection:n},o)=>{let i=Jn.resolveAndCheck(this.plugin.state.data,o);if(!i||ce.Loci.isEmpty(n))return;let s=ce.Loci.getFirstLocation(n,t);if(n.elements.length>1||nt.entity.type(s)!=="polymer")return;let a=ce.Stats.ofLoci(n),l=Zb(a,{countsOnly:!0}),c=Rd(s,{reverse:!0,granularity:"chain"}).split("|"),u=`${l} | ${c[0]} | ${c[c.length-1]}`;r.push({loci:n,label:u,cell:i})}),r}get atomEntries(){let t=new Map,r=this.plugin.managers.structure.selection.additionsHistory;for(let o=0,i=r.length;o<i;++o){let s=r[o];if(ce.Loci.size(s.loci)!==1)continue;let a=s.loci.structure;t.has(a)?t.get(a).push(s):t.set(a,[s])}let n=[];return t.forEach((o,i)=>{let s=this.plugin.helpers.substructureParent.get(i),a=[];for(let u=0,d=o.length;u<d;++u)a.push(o[u].loci.elements[0]);let l=ce.Loci(o[0].loci.structure,a),c=l.structure.label.split(" | ")[0];n.push({loci:l,label:c,cell:s,atoms:o})}),n}toggleHint(){return this.plugin.config.get(Ot.Viewport.ShowSelectionMode)?(0,fn.jsxs)(fn.Fragment,{children:[" ","(toggle ",(0,fn.jsx)(lv,{inline:!0})," mode)"]}):null}addByChains(){let t=this.chainEntries;return(0,fn.jsxs)(fn.Fragment,{children:[t.length>0&&(0,fn.jsx)("div",{className:"msp-control-offset",children:t.map((r,n)=>this.lociEntry(r,n))}),t.length<2&&(0,fn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,fn.jsxs)("div",{className:"msp-help-description",children:[(0,fn.jsx)(an,{svg:Nc,inline:!0}),"Add 2 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single polymer chains or residues therein."]})}),t.length>1&&(0,fn.jsx)(or,{title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"},children:"Superpose"})]})}addByAtoms(){let t=this.atomEntries;return(0,fn.jsxs)(fn.Fragment,{children:[t.length>0&&(0,fn.jsx)("div",{className:"msp-control-offset",children:t.map((r,n)=>this.atomsLociEntry(r,n))}),t.length<2&&(0,fn.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,fn.jsxs)("div",{className:"msp-help-description",children:[(0,fn.jsx)(an,{svg:Nc,inline:!0}),"Add 1 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single atoms."]})}),t.length>1&&(0,fn.jsx)(or,{title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"},children:"Superpose"})]})}superposeByDbMapping(){return(0,fn.jsx)(fn.Fragment,{children:(0,fn.jsx)(or,{icon:Wz,title:"Superpose structures using intersection of residues from SIFTS UNIPROT mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy,children:"Uniprot"})})}render(){return(0,fn.jsxs)(fn.Fragment,{children:[(0,fn.jsxs)("div",{className:"msp-flex-row",children:[(0,fn.jsx)(gi,{icon:Wz,label:"Chains",toggle:this.toggleByChains,isSelected:this.state.action==="byChains",disabled:this.state.isBusy}),(0,fn.jsx)(gi,{icon:Mge,label:"Atoms",toggle:this.toggleByAtoms,isSelected:this.state.action==="byAtoms",disabled:this.state.isBusy}),this.state.canUseDb&&this.superposeByDbMapping(),(0,fn.jsx)(gi,{icon:gu,label:"",title:"Options",toggle:this.toggleOptions,isSelected:this.state.action==="options",disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),this.state.action==="byChains"&&this.addByChains(),this.state.action==="byAtoms"&&this.addByAtoms(),this.state.action==="options"&&(0,fn.jsx)("div",{className:"msp-control-offset",children:(0,fn.jsx)(An,{params:abe,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy})})]})}};var fh=ar(un());var mB=class extends il{defaultState(){return{isCollapsed:!1,header:"Quick Styles",brand:{accent:"gray",svg:mge}}}renderControls(){return(0,fh.jsx)(fh.Fragment,{children:(0,fh.jsx)(dj,{})})}},dj=class extends Xo{async default(){let{structures:t}=this.plugin.managers.structure.hierarchy.selection,r=this.plugin.config.get(Ot.Structure.DefaultRepresentationPreset)||ds.auto.id,n=this.plugin.builders.structure.representation.resolveProvider(r);if(await this.plugin.managers.structure.component.applyPreset(t,n),this.plugin.managers.structure.component.setOptions(M.getDefaultValues(od.OptionsParams)),this.plugin.canvas3d){let o=M.getDefaultValues(iS);this.plugin.canvas3d.setProps({postprocessing:{outline:o.outline,occlusion:o.occlusion}})}}async illustrative(){let{structures:t}=this.plugin.managers.structure.hierarchy.selection;await this.plugin.managers.structure.component.applyPreset(t,ds.illustrative),this.plugin.canvas3d&&this.plugin.canvas3d.setProps({postprocessing:{outline:{name:"on",params:{scale:1,color:ze(0),threshold:.25,includeTransparent:!0}},occlusion:{name:"on",params:{multiScale:{name:"off",params:{}},radius:5,bias:.8,blurKernelSize:15,samples:32,resolutionScale:1,color:ze(0)}},shadow:{name:"off",params:{}}}})}async stylized(){if(this.plugin.managers.structure.component.setOptions({...this.plugin.managers.structure.component.state.options,ignoreLight:!0}),this.plugin.canvas3d){let t=this.plugin.canvas3d.props.postprocessing;this.plugin.canvas3d.setProps({postprocessing:{outline:{name:"on",params:t.outline.name==="on"?t.outline.params:{scale:1,color:ze(0),threshold:.33,includeTransparent:!0}},occlusion:{name:"on",params:t.occlusion.name==="on"?t.occlusion.params:{multiScale:{name:"off",params:{}},radius:5,bias:.8,blurKernelSize:15,samples:32,resolutionScale:1,color:ze(0)}},shadow:{name:"off",params:{}}}})}}render(){return(0,fh.jsxs)("div",{className:"msp-flex-row",children:[(0,fh.jsx)(or,{noOverflow:!0,title:"Applies default representation preset. Set outline and occlusion effects to defaults.",onClick:()=>this.default(),style:{width:"auto"},children:"Default"}),(0,fh.jsx)(or,{noOverflow:!0,title:"Applies no representation preset. Enables outline and occlusion effects. Enables ignore-light representation parameter.",onClick:()=>this.stylized(),style:{width:"auto"},children:"Stylized"}),(0,fh.jsx)(or,{noOverflow:!0,title:"Applies illustrative representation preset. Enables outline and occlusion effects. Enables ignore-light parameter.",onClick:()=>this.illustrative(),style:{width:"auto"},children:"Illustrative"})]})}};var pB=class extends yr{constructor(){super(...arguments),this.state={show:!1,label:""},this.update=()=>{let t=this.plugin.state.data,r=t.selectQ(s=>s.ofTransformer(Je.Model.ModelFromTrajectory));if(r.length===0){this.setState({show:!1});return}let n="",o=0,i=new Set;for(let s of r){if(!s.sourceRef)continue;let a=t.cells.get(s.sourceRef).obj;if(a&&a.data.frameCount>1){if(i.has(s.sourceRef)){this.setState({show:!1});return}i.add(s.sourceRef),o++,n||(n=`Model ${s.transform.params.modelIndex+1} / ${a.data.frameCount}`)}}o>1&&(n=""),this.setState({show:o>0,label:n})},this.reset=()=>ht.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:T_.create({action:"reset"})}),this.prev=()=>ht.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:T_.create({action:"advance",by:-1})}),this.next=()=>ht.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:T_.create({action:"advance",by:1})})}componentDidMount(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)}render(){let t=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||t&&!this.state.label||!this.plugin.config.get(Ot.Viewport.ShowTrajectoryControls)?null:(0,hn.jsxs)("div",{className:"msp-traj-controls",children:[!t&&(0,hn.jsx)(Jt,{svg:Ege,title:"First Model",onClick:this.reset,disabled:t}),!t&&(0,hn.jsx)(Jt,{svg:Hz,title:"Previous Model",onClick:this.prev,disabled:t}),!t&&(0,hn.jsx)(Jt,{svg:jz,title:"Next Model",onClick:this.next,disabled:t}),!!this.state.label&&(0,hn.jsx)("span",{children:this.state.label})]})}},fB=class extends yr{constructor(){super(...arguments),this.state={isBusy:!1,show:!0},this.keyUp=t=>{if(!t.ctrlKey||this.state.isBusy||t.target!==document.body)return;let r=this.plugin.managers.snapshot;if(t.keyCode===37||t.key==="ArrowLeft")r.state.isPlaying&&r.stop(),this.prev();else if(t.keyCode===38||t.key==="ArrowUp"){if(r.state.isPlaying&&r.stop(),r.state.entries.size===0)return;let n=r.state.entries.get(0);this.update(n.snapshot.id)}else if(t.keyCode===39||t.key==="ArrowRight")r.state.isPlaying&&r.stop(),this.next();else if(t.keyCode===40||t.key==="ArrowDown"){if(r.state.isPlaying&&r.stop(),r.state.entries.size===0)return;let n=r.state.entries.get(r.state.entries.size-1);this.update(n.snapshot.id)}},this.change=t=>{t.target.value!=="none"&&this.update(t.target.value)},this.prev=()=>{let t=this.plugin.managers.snapshot,r=t.getNextId(t.state.current,-1);r&&this.update(r)},this.next=()=>{let t=this.plugin.managers.snapshot,r=t.getNextId(t.state.current,1);r&&this.update(r)},this.togglePlay=()=>{this.plugin.managers.snapshot.togglePlay()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,t=>this.setState({isBusy:t})),this.subscribe(this.plugin.behaviors.state.isAnimating,t=>this.setState({isBusy:t})),window.addEventListener("keyup",this.keyUp,!1)}componentWillUnmount(){super.componentWillUnmount(),window.removeEventListener("keyup",this.keyUp,!1)}async update(t){this.setState({isBusy:!0}),await ht.State.Snapshots.Apply(this.plugin,{id:t}),this.setState({isBusy:!1})}render(){let t=this.plugin.managers.snapshot,r=t.state.entries.size;if(r<2||!this.state.show)return null;let n=t.state.current,o=t.state.isPlaying;return(0,hn.jsxs)("div",{className:"msp-state-snapshot-viewport-controls",children:[(0,hn.jsxs)("select",{className:"msp-form-control",value:n||"none",onChange:this.change,disabled:this.state.isBusy||o,children:[!n&&(0,hn.jsx)("option",{value:"none"},"none"),t.state.entries.valueSeq().map((i,s)=>(0,hn.jsxs)("option",{value:i.snapshot.id,children:[`[${s+1}/${r}]`," ",i.name||new Date(i.timestamp).toLocaleString()]},i.snapshot.id))]}),(0,hn.jsx)(Jt,{svg:o?$z:ZM,title:o?"Pause":"Cycle States",onClick:this.togglePlay,disabled:o?!1:this.state.isBusy}),!o&&(0,hn.jsxs)(hn.Fragment,{children:[(0,hn.jsx)(Jt,{svg:Hz,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||o}),(0,hn.jsx)(Jt,{svg:jz,title:"Next State",onClick:this.next,disabled:this.state.isBusy||o})]})]})}};function lbe(){var e;let t=R1.useContext(rd),[r,n]=R1.useState(0);R1.useEffect(()=>{let s=t.managers.snapshot.events.changed.subscribe(()=>n(a=>a+1));return()=>s.unsubscribe()},[t]);let o=t.managers.snapshot.state.current;if(!o)return null;let i=t.managers.snapshot.getEntry(o);return!((e=i?.description)===null||e===void 0)&&e.trim()?(0,hn.jsx)("div",{className:"msp-snapshot-description-wrapper",children:(0,hn.jsx)(jS,{skipHtml:!0,components:{a:zJe},children:i.description})}):null}function zJe({href:e,children:t,element:r}){let n=R1.useContext(rd);return e&&e[0]==="#"?(0,hn.jsx)("a",{href:"#",onClick:o=>{o.preventDefault(),n.managers.snapshot.applyKey(e.substring(1))},children:t}):r}var hB=class extends yr{constructor(){super(...arguments),this.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.stop=()=>{this.plugin.managers.animation.stop(),this.plugin.managers.snapshot.stop()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>{this.plugin.managers.snapshot.state.isPlaying?this.setState({isPlaying:!0,isExpanded:!1}):this.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{t?this.setState({isBusy:!0,isExpanded:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2}):this.setState({isBusy:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,t=>{t?this.setState({isAnimating:!0,isExpanded:!1}):this.setState({isAnimating:!1})})}render(){let t=this.plugin.managers.snapshot.state.isPlaying;if(t||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(Ot.Viewport.ShowAnimation))return null;let r=this.state.isAnimating;return(0,hn.jsxs)("div",{className:"msp-animation-viewport-controls",children:[(0,hn.jsxs)("div",{children:[(0,hn.jsx)("div",{className:"msp-semi-transparent-background"}),(0,hn.jsx)(Jt,{svg:r||t?$z:Pge,transparent:!0,title:r?"Stop":"Select Animation",onClick:r||t?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:r||t?!1:this.state.isBusy||this.state.isPlaying||this.state.isEmpty})]}),this.state.isExpanded&&!this.state.isBusy&&(0,hn.jsx)("div",{className:"msp-animation-viewport-controls-select",children:(0,hn.jsx)(zR,{onStart:this.toggleExpanded})})]})}},gB=class extends yr{componentDidMount(){this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){return this.plugin.selectionMode?(0,hn.jsx)("div",{className:"msp-selection-viewport-controls",children:(0,hn.jsx)(JR,{})}):null}},yB=class extends yr{constructor(){super(...arguments),this.state={labels:[]}}componentDidMount(){this.subscribe(this.plugin.behaviors.labels.highlight,t=>this.setState({labels:t.labels}))}render(){return this.state.labels.length===0?null:(0,hn.jsx)("div",{className:"msp-highlight-info",children:this.state.labels.map((t,r)=>t.indexOf(`
`)>0?(0,hn.jsx)("div",{className:"msp-highlight-markdown-row",children:(0,hn.jsx)(jS,{skipHtml:!0,children:t})},""+r):(0,hn.jsx)("div",{className:"msp-highlight-simple-row",dangerouslySetInnerHTML:{__html:t}},""+r))})}},mj=class extends yr{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){let t=[];return this.plugin.customStructureControls.forEach((r,n)=>{t.push((0,hn.jsx)(r,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),t.length>0?(0,hn.jsx)(hn.Fragment,{children:t}):null}},vB=class extends yr{render(){return(0,hn.jsxs)(hn.Fragment,{children:[(0,hn.jsxs)("div",{className:"msp-section-header",children:[(0,hn.jsx)(an,{svg:gge}),"Structure Tools"]}),(0,hn.jsx)(nB,{}),(0,hn.jsx)(tB,{}),(0,hn.jsx)(dB,{}),(0,hn.jsx)(mB,{}),(0,hn.jsx)(ZR,{}),this.plugin.config.get(Ot.VolumeStreaming.Enabled)&&(0,hn.jsx)(lB,{}),(0,hn.jsx)(cB,{}),(0,hn.jsx)(mj,{})]})}};var Qr=ar(un());var YS=ar(un());var bB=class extends yr{get current(){return this.props.state.behaviors.currentObject.value}componentDidMount(){this.subscribe(this.plugin.state.events.object.updated,({ref:t,state:r})=>{let n=this.current;n.ref!==t||n.state!==r||this.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,()=>this.forceUpdate()),this.subscribe(this.plugin.state.data.actions.events.removed,()=>this.forceUpdate())}render(){let{state:t,nodeRef:r}=this.props,n=t.cells.get(r),o=t.actions.fromCell(n,this.plugin);if(o.length===0)return null;let i=n.transform.transformer.definition,s=n.obj?n.obj.label:i.display&&i.display.name||i.name;return(0,YS.jsxs)("div",{className:"msp-state-actions",children:[!this.props.hideHeader&&(0,YS.jsxs)("div",{className:"msp-section-header",children:[(0,YS.jsx)(an,{svg:Cge})," ",`Actions (${s})`]}),o.map((a,l)=>(0,YS.jsx)(pv,{state:t,action:a,nodeRef:r,initiallyCollapsed:l===0?!this.props.alwaysExpandFirst&&this.props.initiallyCollapsed:this.props.initiallyCollapsed},`${a.id}`))]})}};var rr=ar(un());var B1=ar(hi());var fv=class e extends Xu{get animation(){return this.plugin.managers.animation}getSnapshot(t){var r,n,o;let i={...this.snapshotParams.value,...t};return{id:jr.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:((r=i?.cameraTransition)===null||r===void 0?void 0:r.name)==="animate"?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3dContext:i.canvas3dContext?{props:(n=this.plugin.canvas3dContext)===null||n===void 0?void 0:n.props}:void 0,canvas3d:i.canvas3d?{props:(o=this.plugin.canvas3d)===null||o===void 0?void 0:o.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:i.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:i.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:i?.durationInMs}}async setSnapshot(t){var r,n,o,i,s;if(await this.animation.stop(),!((r=t.structureComponentManager)===null||r===void 0)&&r.options&&this.plugin.managers.structure.component._setSnapshotState((n=t.structureComponentManager)===null||n===void 0?void 0:n.options),t.behaviour&&await this.plugin.runTask(this.behaviors.setSnapshot(t.behaviour)),t.data&&await this.plugin.runTask(this.data.setSnapshot(t.data)),!((o=t.canvas3d)===null||o===void 0)&&o.props){let a=M.normalizeParams(Nl,t.canvas3d.props,"children");await ht.Canvas3D.SetSettings(this.plugin,{settings:a})}if(!((i=t.canvas3dContext)===null||i===void 0)&&i.props){let a=M.normalizeParams(Xp.Params,t.canvas3dContext.props,"children");(s=this.plugin.canvas3dContext)===null||s===void 0||s.setProps(a)}t.interactivity&&t.interactivity.props&&this.plugin.managers.interactivity.setProps(t.interactivity.props),t.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(t.structureFocus),t.structureSelection&&this.plugin.managers.structure.selection.setSnapshot(t.structureSelection),t.animation&&this.animation.setSnapshot(t.animation),t.camera&&ht.Camera.Reset(this.plugin,{snapshot:t.camera.current,durationMs:t.camera.transitionStyle==="animate"?t.camera.transitionDurationInMs:void 0}),t.startAnimation&&this.animation.start()}updateTransform(t,r,n,o){let i=t.build().to(r).update(n);return ht.State.Update(this.plugin,{state:t,tree:i,options:{canUndo:o}})}hasBehavior(t){return this.behaviors.tree.transforms.has(t.id)}updateBehavior(t,r){let n=this.behaviors.build();if(this.behaviors.tree.transforms.has(t.id))n.to(t.id).update(r);else{let o=t.createDefaultParams(void 0,this.plugin);n.to(tr.getCategoryId(t)).apply(t,Jl(o,r),{ref:t.id})}return this.plugin.runTask(this.behaviors.updateTree(n))}dispose(){this.behaviors.cells.forEach(t=>{var r,n,o,i;tr.Behavior.is(t.obj)&&((n=(r=t.obj.data).unregister)===null||n===void 0||n.call(r),(i=(o=t.obj.data).dispose)===null||i===void 0||i.call(o))}),super.dispose(),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()}constructor(t){super(),this.plugin=t,this.data=Mu.create(new fe.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,historyCapacity:this.plugin.config.get(Ot.State.HistoryCapacity)}),this.behaviors=Mu.create(new tr.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,rootState:{isLocked:!0}}),this.events={cell:{stateUpdated:im(this.data.events.cell.stateUpdated,this.behaviors.events.cell.stateUpdated),created:im(this.data.events.cell.created,this.behaviors.events.cell.created),removed:im(this.data.events.cell.removed,this.behaviors.events.cell.removed)},object:{created:im(this.data.events.object.created,this.behaviors.events.object.created),removed:im(this.data.events.object.removed,this.behaviors.events.object.removed),updated:im(this.data.events.object.updated,this.behaviors.events.object.updated)}},this.snapshotParams=this.ev.behavior(e.DefaultSnapshotParams),this.setSnapshotParams=r=>{this.snapshotParams.next({...e.DefaultSnapshotParams,...r})}}};(function(e){e.SnapshotParams={durationInMs:M.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:M.Boolean(!0),behavior:M.Boolean(!1),structureSelection:M.Boolean(!1),componentManager:M.Boolean(!0),animation:M.Boolean(!0),startAnimation:M.Boolean(!1),canvas3d:M.Boolean(!0),canvas3dContext:M.Boolean(!0),interactivity:M.Boolean(!0),camera:M.Boolean(!0),cameraTransition:M.MappedStatic("animate",{animate:M.Group({durationInMs:M.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:M.Group({})},{options:[["animate","Animate"],["instant","Instant"]]}),image:M.Boolean(!1)},e.DefaultSnapshotParams=M.getDefaultValues(e.SnapshotParams)})(fv||(fv={}));var xB=class extends yr{render(){var t;return(0,rr.jsxs)("div",{children:[(0,rr.jsx)(of,{icon:KM,title:"Plugin State"}),(0,rr.jsx)("div",{style:{marginBottom:"10px"},children:(0,rr.jsx)(lo,{header:"Save Options",initiallyExpanded:!1,children:(0,rr.jsx)(O_,{})})}),(0,rr.jsx)(CB,{}),(0,rr.jsx)(pj,{}),(0,rr.jsx)(of,{title:"Save as File",accent:"blue"}),(0,rr.jsx)(F_,{}),((t=this.plugin.spec.components)===null||t===void 0?void 0:t.remoteState)!=="none"&&(0,rr.jsx)(V_,{})]})}},F_=class extends yr{constructor(){super(...arguments),this.downloadToFileJson=()=>{var t,r;(r=(t=this.props).onAction)===null||r===void 0||r.call(t),ht.State.Snapshots.DownloadToFile(this.plugin,{type:"json"})},this.downloadToFileZip=()=>{var t,r;(r=(t=this.props).onAction)===null||r===void 0||r.call(t),ht.State.Snapshots.DownloadToFile(this.plugin,{type:"zip"})},this.open=t=>{var r,n;if(!t.target.files||!t.target.files[0]){this.plugin.log.error("No state file selected");return}(n=(r=this.props).onAction)===null||n===void 0||n.call(r),ht.State.Snapshots.OpenFile(this.plugin,{file:t.target.files[0]})}}render(){return(0,rr.jsxs)(rr.Fragment,{children:[(0,rr.jsxs)("div",{className:"msp-flex-row",children:[(0,rr.jsx)(or,{icon:Yw,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input.",children:"State"}),(0,rr.jsx)(or,{icon:Yw,onClick:this.downloadToFileZip,title:"Save the state including the input data.",children:"Session"}),(0,rr.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",children:[(0,rr.jsx)(an,{svg:Tge,inline:!0})," Open ",(0,rr.jsx)("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"})]})]}),(0,rr.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,rr.jsx)(an,{svg:XM})," This is an experimental feature and stored states/sessions might not be openable in a future version."]})]})}},O_=class extends yr{componentDidMount(){this.subscribe(this.plugin.state.snapshotParams,()=>this.forceUpdate())}render(){return(0,rr.jsx)(An,{params:fv.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams})}},CB=class e extends yr{constructor(){super(...arguments),this.state={params:M.getDefaultValues(e.Params)},this.add=()=>{ht.State.Snapshots.Add(this.plugin,{name:this.state.params.name,description:this.state.params.description})},this.updateParams=t=>this.setState({params:t}),this.clear=()=>{ht.State.Snapshots.Clear(this.plugin,{})}}shouldComponentUpdate(t,r){return!Au(this.props,t)||!Au(this.state,r)}render(){return(0,rr.jsx)("div",{children:(0,rr.jsx)(HJe,{parent:this})})}};CB.Params={name:M.Text(),description:M.Text()};function cbe(e,t,r){return t?e.managers.snapshot.state.entries.some(n=>(!r||n.snapshot.id!==r)&&n.key===t):!1}function HJe({parent:e}){let[t,r]=B1.useState({key:"",name:"",description:""}),n=()=>{ht.State.Snapshots.Add(e.plugin,{key:t.key,name:t.name,description:t.description}),r({key:"",name:"",description:""})},o=cbe(e.plugin,t.key);return(0,rr.jsxs)(rr.Fragment,{children:[(0,rr.jsx)(ube,{state:t,setState:r,apply:n}),(0,rr.jsxs)("div",{className:"msp-flex-row",children:[(0,rr.jsx)(Jt,{onClick:e.clear,svg:Fa,title:"Remove All"}),(0,rr.jsx)(or,{onClick:n,icon:o?void 0:nf,style:{textAlign:"right"},commit:o?"off":"on",disabled:o,children:o?"Key must be unique":"Add"})]})]})}var pj=class extends yr{constructor(){super(...arguments),this.state={editingId:void 0},this.edit=t=>{let r=t.currentTarget.getAttribute("data-id");if(!r)return;let n=this.state.editingId;this.setState({editingId:r===n?void 0:r})},this.doneEdit=()=>this.setState({editingId:void 0}),this.apply=t=>{let r=t.currentTarget.getAttribute("data-id");r&&ht.State.Snapshots.Apply(this.plugin,{id:r})},this.remove=t=>{let r=t.currentTarget.getAttribute("data-id");r&&ht.State.Snapshots.Remove(this.plugin,{id:r})},this.moveUp=t=>{let r=t.currentTarget.getAttribute("data-id");r&&ht.State.Snapshots.Move(this.plugin,{id:r,dir:-1})},this.moveDown=t=>{let r=t.currentTarget.getAttribute("data-id");r&&ht.State.Snapshots.Move(this.plugin,{id:r,dir:1})},this.replace=t=>{let r=t.currentTarget.getAttribute("data-id");r&&ht.State.Snapshots.Replace(this.plugin,{id:r})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate())}render(){let t=this.plugin.managers.snapshot.state.current,r=[];return this.plugin.managers.snapshot.state.entries.forEach(n=>{var o;r.push((0,rr.jsxs)("li",{className:"msp-flex-row",children:[(0,rr.jsxs)(or,{"data-id":n.snapshot.id,onClick:this.apply,className:"msp-no-overflow",children:[(0,rr.jsxs)("span",{style:{fontWeight:n.snapshot.id===t?"bold":void 0},children:[!!n.key&&`[${n.key}] `,n.name||new Date(n.timestamp).toLocaleString()]})," ",(0,rr.jsx)("small",{children:`${n.snapshot.durationInMs?yx(n.snapshot.durationInMs,!1):""}`})]}),(0,rr.jsx)(Jt,{svg:gu,"data-id":n.snapshot.id,title:"Edit",onClick:this.edit,flex:"28px"}),(0,rr.jsx)(Jt,{svg:ev,"data-id":n.snapshot.id,title:"Move Up",onClick:this.moveUp,flex:"20px"}),(0,rr.jsx)(Jt,{svg:Jy,"data-id":n.snapshot.id,title:"Move Down",onClick:this.moveDown,flex:"20px"}),(0,rr.jsx)(Jt,{svg:Dge,"data-id":n.snapshot.id,title:"Replace",onClick:this.replace,flex:"20px"}),(0,rr.jsx)(Jt,{svg:Fa,"data-id":n.snapshot.id,title:"Remove",onClick:this.remove,flex:"20px"})]},n.snapshot.id)),this.state.editingId===n.snapshot.id&&r.push((0,rr.jsx)(jJe,{entry:n,plugin:this.plugin,done:this.doneEdit},`${n.snapshot.id}-edit`));let i=n.image&&((o=this.plugin.managers.asset.get(n.image))===null||o===void 0?void 0:o.file);i&&r.push((0,rr.jsx)("li",{className:"msp-state-image-row",children:(0,rr.jsx)(or,{"data-id":n.snapshot.id,onClick:this.apply,children:(0,rr.jsx)("img",{draggable:!1,src:URL.createObjectURL(i)})})},`${n.snapshot.id}-image`))}),(0,rr.jsx)(rr.Fragment,{children:(0,rr.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:r})})}};function ube({state:e,setState:t,apply:r}){let n=B1.useRef(),o=B1.useRef(),[i,s]=B1.useState(!1);return(0,rr.jsxs)(rr.Fragment,{children:[(0,rr.jsx)($s,{label:"Name",control:(0,rr.jsx)("input",{type:"text",value:e.name,placeholder:"Name",onChange:a=>t({...e,name:a.target.value}),onKeyUp:a=>{var l;a.key==="Enter"&&((l=n.current)===null||l===void 0||l.focus())}})}),(0,rr.jsx)($s,{label:(0,rr.jsxs)(rr.Fragment,{children:["Key",(0,rr.jsx)(IH,{show:i,toggle:()=>s(a=>!a)})]}),control:(0,rr.jsx)("input",{type:"text",ref:n,value:e.key,placeholder:"Key (optional)",onChange:a=>t({...e,key:a.target.value}),onKeyUp:a=>{var l;a.key==="Enter"&&((l=o.current)===null||l===void 0||l.focus())}})}),i&&(0,rr.jsx)("div",{className:"msp-control-offset",children:(0,rr.jsx)(o_,{description:"Optional snapshot key used to activate snapshots from descriptions, labels, etc."})}),(0,rr.jsx)("div",{className:"msp-flex-row msp-text-area-wrapper",style:{marginBottom:1},children:(0,rr.jsx)("textarea",{ref:o,placeholder:`Markdown Description

- Use [title](#key) to link to a snapshot`,className:"msp-form-control",value:e.description,onChange:a=>t({...e,description:a.target.value}),onKeyUp:a=>{a.key==="Enter"&&a.ctrlKey&&r(e)}})})]})}function jJe({entry:e,plugin:t,done:r}){var n,o,i;let[s,a]=B1.useState({key:(n=e.key)!==null&&n!==void 0?n:"",name:(o=e.name)!==null&&o!==void 0?o:"",description:(i=e.description)!==null&&i!==void 0?i:""}),l=()=>{t.managers.snapshot.update(e,s),r()},c=cbe(t,s.key,e.snapshot.id);return(0,rr.jsxs)(rr.Fragment,{children:[(0,rr.jsx)(ube,{state:s,setState:a,apply:l}),(0,rr.jsx)("div",{className:"msp-flex-row",style:{marginBottom:1},children:(0,rr.jsx)(or,{onClick:l,icon:c?void 0:Fd,style:{textAlign:"right"},commit:c?"off":"on",disabled:c,children:c?"Key must be unique":"Apply"})})]})}var V_=class extends yr{constructor(){super(...arguments),this.Params={name:M.Text(),options:M.Group({description:M.Text(),playOnLoad:M.Boolean(!1),serverUrl:M.Text(this.plugin.config.get(Ot.State.CurrentServer))})},this.state={params:M.getDefaultValues(this.Params),entries:Ea(),isBusy:!1},this.ListOnlyParams={options:M.Group({serverUrl:M.Text(this.plugin.config.get(Ot.State.CurrentServer))},{isFlat:!0})},this._mounted=!1,this.refresh=async()=>{try{this.setState({isBusy:!0}),this.plugin.config.set(Ot.State.CurrentServer,this.state.params.options.serverUrl);let t=await this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))||[];t.sort((n,o)=>n.isSticky===o.isSticky?n.timestamp-o.timestamp:n.isSticky?-1:1);let r=Ea().asMutable();for(let n of t)r.set(n.id,{...n,url:this.serverUrl(`get/${n.id}`),removeUrl:this.serverUrl(`remove/${n.id}`)});this._mounted&&this.setState({entries:r.asImmutable(),isBusy:!1})}catch{this.plugin.log.error("Error fetching remote snapshots"),this._mounted&&this.setState({entries:Ea(),isBusy:!1})}},this.upload=async()=>{this.setState({isBusy:!0}),this.plugin.config.set(Ot.State.CurrentServer,this.state.params.options.serverUrl),await ht.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl}),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh())},this.fetch=async t=>{let r=t.currentTarget.getAttribute("data-id");if(!r)return;let n=this.state.entries.get(r);if(n){this.setState({isBusy:!0});try{await ht.State.Snapshots.Fetch(this.plugin,{url:n.url})}finally{this._mounted&&this.setState({isBusy:!1})}}},this.remove=async t=>{let r=t.currentTarget.getAttribute("data-id");if(!r)return;let n=this.state.entries.get(r);if(n){this.setState({entries:this.state.entries.remove(r)});try{await fetch(n.removeUrl)}catch{}}}}componentDidMount(){this.refresh(),this._mounted=!0}componentWillUnmount(){super.componentWillUnmount(),this._mounted=!1}serverUrl(t){return t?Ty(this.state.params.options.serverUrl,t):this.state.params.options.serverUrl}render(){return(0,rr.jsxs)(rr.Fragment,{children:[(0,rr.jsx)(of,{title:"Remote States",accent:"blue"}),!this.props.listOnly&&(0,rr.jsxs)(rr.Fragment,{children:[(0,rr.jsx)(An,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:t=>{this.setState({params:{...this.state.params,[t.name]:t.value}})},isDisabled:this.state.isBusy}),(0,rr.jsxs)("div",{className:"msp-flex-row",children:[(0,rr.jsx)(Jt,{onClick:this.refresh,disabled:this.state.isBusy,svg:Jw}),(0,rr.jsx)(or,{icon:xge,onClick:this.upload,disabled:this.state.isBusy,commit:!0,children:"Upload"})]})]}),(0,rr.jsx)(fj,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove}),this.props.listOnly&&(0,rr.jsxs)("div",{style:{marginTop:"10px"},children:[(0,rr.jsx)(An,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:t=>{this.setState({params:{...this.state.params,[t.name]:t.value}})},isDisabled:this.state.isBusy}),(0,rr.jsx)("div",{className:"msp-flex-row",children:(0,rr.jsx)(or,{onClick:this.refresh,disabled:this.state.isBusy,icon:Jw,children:"Refresh"})})]})]})}},fj=class extends Xo{constructor(){super(...arguments),this.open=async t=>{let r=t.currentTarget.getAttribute("data-id");if(!r)return;let n=this.props.entries.get(r);if(!n)return;t.preventDefault();let o=`${window.location}`,i=o.indexOf("?");i>0&&(o=o.substr(0,i)),window.open(`${o}?snapshot-url=${encodeURIComponent(n.url)}`,"_blank")}}render(){return(0,rr.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:this.props.entries.valueSeq().map(t=>(0,rr.jsxs)("li",{className:"msp-flex-row",children:[(0,rr.jsxs)(or,{"data-id":t.id,onClick:this.props.fetch,disabled:this.props.isBusy,onContextMenu:this.open,title:"Click to download, right-click to open in a new tab.",children:[t.name||new Date(t.timestamp).toLocaleString()," ",(0,rr.jsx)("small",{children:t.description})]}),!t.isSticky&&this.props.remove&&(0,rr.jsx)(Jt,{svg:Fa,"data-id":t.id,title:"Remove",onClick:this.props.remove,disabled:this.props.isBusy,small:!0})]},t.id))})}};var Lo=ar(un());var G_=class extends yr{constructor(){super(...arguments),this.state={showActions:!0}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,t=>{t.cell.transform.parent===xr.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,t=>{t.parent===xr.RootRef&&this.forceUpdate()})}static getDerivedStateFromProps(t,r){let n=t.state.tree.root.ref,i=t.state.tree.children.get(n).size===0;return r.showActions===i?null:{showActions:i}}render(){let t=this.props.state.tree.root.ref;return this.state.showActions?(0,Lo.jsxs)("div",{style:{margin:"10px",cursor:"default"},children:[(0,Lo.jsx)("p",{children:"Nothing to see here yet."}),(0,Lo.jsxs)("p",{children:["Structures and Volumes can be loaded from the ",(0,Lo.jsx)(an,{svg:Qw})," tab."]})]}):(0,Lo.jsx)(hj,{cell:this.props.state.cells.get(t),depth:0})}},hj=class e extends yr{constructor(){super(...arguments),this.state={isCollapsed:!!this.props.cell.state.isCollapsed,isNull:e.isNull(this.props.cell),showLabel:e.showLabel(this.props.cell)}}is(t){return t.ref===this.ref&&t.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{this.props.cell===t.cell&&this.is(t)&&t.state.cells.has(this.ref)&&(this.state.isCollapsed!==!!t.cell.state.isCollapsed||this.state.isNull!==e.isNull(t.cell)||this.state.showLabel!==e.showLabel(t.cell))&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,t=>{this.props.cell.parent===t.state&&this.ref===t.cell.transform.parent&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,t=>{this.props.cell.parent===t.state&&this.ref===t.parent&&this.forceUpdate()})}static getDerivedStateFromProps(t,r){let n=e.isNull(t.cell),o=e.showLabel(t.cell);return!!t.cell.state.isCollapsed===r.isCollapsed&&r.isNull===n&&r.showLabel===o?null:{isCollapsed:!!t.cell.state.isCollapsed,isNull:n,showLabel:o}}static hasDecorator(t){var r;let n=t.parent.tree.children.get(t.transform.ref);return n.size!==1?!1:!!(!((r=t.parent)===null||r===void 0)&&r.tree.transforms.get(n.first()).transformer.definition.isDecorator)}static isNull(t){return!t||!t.parent||t.obj===Hn.Null||!t.parent.tree.transforms.has(t.transform.ref)}static showLabel(t){return t.transform.ref!==xr.RootRef&&(t.status!=="ok"||!t.state.isGhost&&!e.hasDecorator(t))}render(){if(this.state.isNull)return null;let t=this.props.cell,r=t.parent.tree.children.get(this.ref);if(!this.state.showLabel)return r.size===0?null:(0,Lo.jsx)(Lo.Fragment,{children:r.map(o=>(0,Lo.jsx)(e,{cell:t.parent.cells.get(o),depth:this.props.depth},o))});let n=this.props.depth+1;return(0,Lo.jsxs)(Lo.Fragment,{children:[(0,Lo.jsx)(gj,{cell:t,depth:this.props.depth}),r.size===0?void 0:(0,Lo.jsx)("div",{style:{display:this.state.isCollapsed?"none":"block"},children:r.map(o=>(0,Lo.jsx)(e,{cell:t.parent.cells.get(o),depth:n},o))})]})}},gj=class extends yr{constructor(){super(...arguments),this.state={isCurrent:this.props.cell.parent.current===this.ref,isCollapsed:!!this.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},this.setCurrent=t=>{t?.preventDefault(),t?.currentTarget.blur(),ht.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:this.ref})},this.setCurrentRoot=t=>{t?.preventDefault(),t?.currentTarget.blur(),ht.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:xr.RootRef})},this.remove=t=>{t?.preventDefault(),ht.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.ref,removeParentGhosts:!0})},this.toggleVisible=t=>{t.preventDefault(),ht.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.ref}),t.currentTarget.blur()},this.toggleExpanded=t=>{t.preventDefault(),ht.State.ToggleExpanded(this.plugin,{state:this.props.cell.parent,ref:this.ref}),t.currentTarget.blur()},this.highlight=t=>{t.preventDefault(),ht.Interactivity.Object.Highlight(this.plugin,{state:this.props.cell.parent,ref:this.ref}),t.currentTarget.blur()},this.clearHighlight=t=>{t.preventDefault(),ht.Interactivity.ClearHighlights(this.plugin),t.currentTarget.blur()},this.hideApply=()=>{this.setCurrentRoot()},this.selectAction=t=>{t&&(0,t?.value)()}}is(t){return t.ref===this.ref&&t.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(Bf(t=>this.is(t)),v2(33)),t=>{this.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,t=>{if(!this.is(t)){this.state.isCurrent&&t.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,this.state.isCollapsed);return}t.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,!!this.props.cell.state.isCollapsed)})}_setCurrent(t,r){t?this.setState({isCurrent:t,action:"options",currentAction:void 0,isCollapsed:r}):this.setState({isCurrent:t,action:void 0,currentAction:void 0,isCollapsed:r})}static getDerivedStateFromProps(t,r){let n=t.cell.parent.current===t.cell.transform.ref,o=!!t.cell.state.isCollapsed;return r.isCollapsed===o&&r.isCurrent===n?null:{isCurrent:n,isCollapsed:o,action:void 0,currentAction:void 0}}get actions(){let t=this.props.cell,r=[...t.parent.actions.fromCell(t,this.plugin)];if(r.length!==0)return r.sort((n,o)=>n.definition.display.name<o.definition.display.name?-1:n.definition.display.name===o.definition.display.name?0:1),[hr.Header("Apply Action"),...r.map(n=>hr.Item(n.definition.display.name,()=>this.setState({action:"apply",currentAction:n})))]}updates(t){let r=this.props.cell,n=N0.getDecoratorChain(r.parent,r.transform.ref),o=[];for(let i=n.length-1;i>=0;i--){let s=n[i];o.push((0,Lo.jsx)(Oa,{state:r.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:t},`${s.transform.transformer.id}-${i}`))}return(0,Lo.jsx)("div",{className:"msp-tree-updates-wrapper",children:o})}render(){let t=this.props.cell,r=t.transform;if(!t)return null;let n=this.is(t.parent.behaviors.currentObject.value),o=t.status!=="error"&&t.status!=="ok",i;if(t.status==="error"||!t.obj){let p=t.status==="error"?t.errorText:r.transformer.definition.display.name;i=(0,Lo.jsxs)(or,{className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:p,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:o,children:[t.status==="error"&&(0,Lo.jsxs)("b",{children:["[",t.status,"]"]})," ",(0,Lo.jsx)("span",{children:p})]})}else{let p=t.obj,h=`${p.label} ${p.description?p.description:""}`;i=(0,Lo.jsxs)(or,{className:`msp-btn-tree-label msp-type-class-${p.type.typeClass}`,noOverflow:!0,disabled:o,title:h,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,children:[(0,Lo.jsx)("span",{children:p.label})," ",p.description?(0,Lo.jsx)("small",{children:p.description}):void 0]})}let s=t.parent.tree.children.get(this.ref),a=t.state,l=(0,Lo.jsx)(Jt,{svg:a.isCollapsed?Lc:Bc,flex:"20px",disabled:o,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:s.size>0?"visible":"hidden"}}),c=t.state.isLocked?void 0:(0,Lo.jsx)(Jt,{svg:Fa,onClick:this.remove,disabled:o,small:!0,toggleState:!1}),u=(0,Lo.jsx)(Jt,{svg:a.isHidden?uc:dc,toggleState:!1,disabled:o,small:!0,onClick:this.toggleVisible}),d={marginLeft:`${this.props.depth*8}px`},m=(0,Lo.jsxs)("div",{className:`msp-flex-row msp-tree-row${n?" msp-tree-row-current":""}`,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:d,children:[l,i,c,u]});if(!n)return m;if(this.state.action==="apply"&&this.state.currentAction)return(0,Lo.jsxs)("div",{style:{marginBottom:"1px"},children:[m,(0,Lo.jsx)(zl,{header:`Apply ${this.state.currentAction.definition.display.name}`,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:hu,headerLeftMargin:`${this.props.depth*8+21}px`,children:(0,Lo.jsx)(pv,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0})})]});if(this.state.action==="options"){let p=this.actions,h=this.updates(`${this.props.depth*8+21}px`);return(0,Lo.jsxs)("div",{style:{marginBottom:"1px"},children:[m,h,p&&(0,Lo.jsx)("div",{style:{marginLeft:`${this.props.depth*8+21}px`,marginTop:"-1px"},children:(0,Lo.jsx)(hr,{items:p,onSelect:this.selectAction})})]})}return m}};var yj=class extends yr{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){let t=[];return this.plugin.customImportControls.forEach((r,n)=>{t.push((0,Qr.jsx)(r,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),t.length>0?(0,Qr.jsx)(Qr.Fragment,{children:t}):null}},SB=class extends yr{constructor(){var t;super(...arguments),this.state={tab:this.plugin.behaviors.layout.leftPanelTabName.value},this.set=r=>{if(this.state.tab===r){this.setState({tab:"none"},()=>this.plugin.behaviors.layout.leftPanelTabName.next("none")),ht.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}});return}this.setState({tab:r},()=>this.plugin.behaviors.layout.leftPanelTabName.next(r)),this.plugin.layout.state.regionState.left!=="full"&&ht.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"full"}}})},this.tabs={none:(0,Qr.jsx)(Qr.Fragment,{}),root:(0,Qr.jsxs)(Qr.Fragment,{children:[(0,Qr.jsx)(of,{icon:Qw,title:"Home"}),(0,Qr.jsx)(bB,{state:this.plugin.state.data,nodeRef:xr.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0}),(0,Qr.jsx)(yj,{}),((t=this.plugin.spec.components)===null||t===void 0?void 0:t.remoteState)!=="none"&&(0,Qr.jsx)(V_,{listOnly:!0})]}),data:(0,Qr.jsxs)(Qr.Fragment,{children:[(0,Qr.jsx)(of,{icon:Vz,title:(0,Qr.jsxs)(Qr.Fragment,{children:[(0,Qr.jsx)(xj,{})," State Tree"]})}),(0,Qr.jsx)(G_,{state:this.plugin.state.data})]}),states:(0,Qr.jsx)(xB,{}),settings:(0,Qr.jsxs)(Qr.Fragment,{children:[(0,Qr.jsx)(of,{icon:gu,title:"Plugin Settings"}),(0,Qr.jsx)(bj,{})]}),help:(0,Qr.jsxs)(Qr.Fragment,{children:[(0,Qr.jsx)(of,{icon:Nc,title:"Help"}),(0,Qr.jsx)(YR,{})]})}}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,t=>{this.state.tab!==t&&this.setState({tab:t}),t==="none"&&this.plugin.layout.state.regionState.left!=="collapsed"&&ht.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}})}),this.subscribe(this.plugin.state.data.events.changed,({state:t})=>{this.state.tab==="data"&&t.cells.size===1&&this.set("root")})}render(){let t=this.state.tab;return(0,Qr.jsxs)("div",{className:"msp-left-panel-controls",children:[(0,Qr.jsxs)("div",{className:"msp-left-panel-controls-buttons",children:[(0,Qr.jsx)(Jt,{svg:Qw,toggleState:t==="root",transparent:!0,onClick:()=>this.set("root"),title:"Home"}),(0,Qr.jsx)(vj,{set:this.set}),(0,Qr.jsx)(Jt,{svg:KM,toggleState:t==="states",transparent:!0,onClick:()=>this.set("states"),title:"Plugin State"}),(0,Qr.jsx)(Jt,{svg:Nc,toggleState:t==="help",transparent:!0,onClick:()=>this.set("help"),title:"Help"}),(0,Qr.jsx)("div",{className:"msp-left-panel-controls-buttons-bottom",children:(0,Qr.jsx)(Jt,{svg:gu,toggleState:t==="settings",transparent:!0,onClick:()=>this.set("settings"),title:"Settings"})})]}),(0,Qr.jsx)("div",{className:"msp-scrollable-container",children:this.tabs[t]})]})}},vj=class extends yr{constructor(){super(...arguments),this.state={changed:!1}}get tab(){return this.plugin.behaviors.layout.leftPanelTabName.value}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,t=>{this.tab==="data"?this.setState({changed:!1}):this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,t=>{this.tab!=="data"&&this.setState({changed:!0})})}render(){return(0,Qr.jsx)(Jt,{svg:Vz,toggleState:this.tab==="data",transparent:!0,onClick:()=>this.props.set("data"),title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?(0,Qr.jsx)("div",{className:"msp-left-panel-controls-button-data-dirty"}):void 0})}},bj=class extends yr{constructor(){super(...arguments),this.setSettings=t=>{ht.Canvas3D.SetSettings(this.plugin,{settings:{[t.name]:t.value}})},this.setCanvas3DContextProps=t=>{var r;(r=this.plugin.canvas3dContext)===null||r===void 0||r.setProps({[t.name]:t.value}),this.plugin.events.canvas3d.settingsUpdated.next(void 0)}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(fl(500,void 0,{leading:!0,trailing:!0})),t=>{(t.radiusMax!==void 0||t.radius!==void 0)&&this.forceUpdate()})}render(){return(0,Qr.jsxs)(Qr.Fragment,{children:[this.plugin.canvas3d&&this.plugin.canvas3dContext&&(0,Qr.jsxs)(Qr.Fragment,{children:[(0,Qr.jsx)(of,{title:"Viewport"}),(0,Qr.jsx)(An,{params:Nl,values:this.plugin.canvas3d.props,onChange:this.setSettings}),(0,Qr.jsx)(An,{params:Xp.Params,values:this.plugin.canvas3dContext.props,onChange:this.setCanvas3DContextProps})]}),(0,Qr.jsx)(of,{title:"Behavior"}),(0,Qr.jsx)(G_,{state:this.plugin.state.behaviors})]})}},xj=class extends yr{constructor(){super(...arguments),this.remove=t=>{t.preventDefault(),ht.State.RemoveObject(this.plugin,{state:this.plugin.state.data,ref:xr.RootRef})}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,t=>{t.cell.transform.parent===xr.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,t=>{t.parent===xr.RootRef&&this.forceUpdate()})}render(){return this.plugin.state.data.tree.children.get(xr.RootRef).size===0?null:(0,Qr.jsx)(Jt,{svg:Fa,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0})}};var ms=ar(un()),gbe=ar(hi());var IB=ar(un()),mbe=ar(hi());var dbe=5,AB=class extends yr{constructor(){super(...arguments),this.parentDiv=mbe.createRef(),this.lastMouseOverSeqIdx=-1,this.highlightQueue=new Vn,this.lociHighlightProvider=(t,r)=>{this.props.sequenceWrapper.markResidue(t.loci,r)&&this.updateMarker()},this.lociSelectionProvider=(t,r)=>{this.props.sequenceWrapper.markResidue(t.loci,r)&&this.updateMarker()},this.contextMenu=t=>{t.preventDefault()},this.mouseDownLoci=void 0,this.mouseDown=t=>{t.stopPropagation();let r=this.getSeqIdx(t),n=this.getLoci(r),o=Py(t.nativeEvent),i=e1(t.nativeEvent),s=vw(t.nativeEvent);this.click(n,o,i,s),this.mouseDownLoci=n},this.mouseUp=t=>{if(t.stopPropagation(),this.mouseDownLoci===void 0)return;let r=this.getSeqIdx(t),n=this.getLoci(r);if(n&&!ce.Loci.areEqual(this.mouseDownLoci,n)){let o=Py(t.nativeEvent),i=e1(t.nativeEvent),s=vw(t.nativeEvent),a=this.mouseDownLoci.elements[0],l=n.elements[0],c=Math.min(Ge.min(a.indices),Ge.min(l.indices)),u=Math.max(Ge.max(a.indices),Ge.max(l.indices)),d=ce.Loci(n.structure,[{unit:a.unit,indices:Ge.ofRange(c,u)}]);this.click(ce.Loci.subtract(d,this.mouseDownLoci),o,i,s)}this.mouseDownLoci=void 0},this.location=ce.Location.create(void 0),this.mouseMove=t=>{t.stopPropagation();let r=Py(t.nativeEvent),n=e1(t.nativeEvent),o=vw(t.nativeEvent),i=t.target;if(!i||!i.getAttribute){if(this.lastMouseOverSeqIdx===-1)return;this.lastMouseOverSeqIdx=-1,this.highlightQueue.next({seqIdx:-1,buttons:r,button:n,modifiers:o});return}let s=i.hasAttribute("data-seqid")?+i.getAttribute("data-seqid"):-1;if(this.lastMouseOverSeqIdx!==s)if(this.lastMouseOverSeqIdx=s,this.mouseDownLoci!==void 0){let a=this.getLoci(s);this.hover(a,Vo.Flag.None,Vo.Flag.None,{...o,shift:!0})}else this.highlightQueue.next({seqIdx:s,buttons:r,button:n,modifiers:o})},this.mouseLeave=t=>{if(t.stopPropagation(),this.mouseDownLoci=void 0,this.lastMouseOverSeqIdx===-1)return;this.lastMouseOverSeqIdx=-1;let r=Py(t.nativeEvent),n=e1(t.nativeEvent),o=vw(t.nativeEvent);this.highlightQueue.next({seqIdx:-1,buttons:r,button:n,modifiers:o})}}get sequenceNumberPeriod(){return this.props.sequenceNumberPeriod!==void 0?this.props.sequenceNumberPeriod:this.props.sequenceWrapper.length>10?10:this.getSequenceNumber(this.props.sequenceWrapper.length-1).length>1?5:1}componentDidMount(){this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(this.highlightQueue.pipe(fl(3*16.666,void 0,{leading:!0,trailing:!0})),t=>{let r=this.getLoci(t.seqIdx<0?void 0:t.seqIdx);this.hover(r,t.buttons,t.button,t.modifiers)})}componentWillUnmount(){super.componentWillUnmount(),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)}getLoci(t){if(t!==void 0){let r=this.props.sequenceWrapper.getLoci(t);if(!ce.Loci.isEmpty(r))return r}}getSeqIdx(t){let r,n=t.target;return n&&n.getAttribute&&(r=n.hasAttribute("data-seqid")?+n.getAttribute("data-seqid"):void 0),r}hover(t,r,n,o){let i={current:Wt.Loci.Empty,buttons:r,button:n,modifiers:o};t!==void 0&&!ce.Loci.isEmpty(t)&&(i.current={loci:t}),this.plugin.behaviors.interaction.hover.next(i)}click(t,r,n,o){let i={current:Wt.Loci.Empty,buttons:r,button:n,modifiers:o};t!==void 0&&!ce.Loci.isEmpty(t)&&(i.current={loci:t}),this.plugin.behaviors.interaction.click.next(i)}getBackgroundColor(t){return t===0?"":t%2===0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"}getResidueClass(t,r){return r.length>1?this.props.sequenceWrapper.residueClass(t)+(t===0?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(t)}residue(t,r,n){return(0,IB.jsx)("span",{"data-seqid":t,style:{backgroundColor:this.getBackgroundColor(n)},className:this.getResidueClass(t,r),children:`\u200B${r}\u200B`},t)}getSequenceNumberClass(t,r,n){let o=["msp-sequence-number"];return r.startsWith("-")?n.length>1&&t>0?o.push("msp-sequence-number-long-negative"):o.push("msp-sequence-number-negative"):n.length>1&&t>0&&o.push("msp-sequence-number-long"),o.join(" ")}getSequenceNumber(t){let r="",n=this.props.sequenceWrapper.getLoci(t),o=ce.Loci.getFirstLocation(n,this.location);if(o)if(Le.isAtomic(o.unit)){let i=nt.residue.auth_seq_id(o),s=nt.residue.pdbx_PDB_ins_code(o);r=`${i}${s||""}`}else Le.isCoarse(o.unit)&&(r=`${t+1}`);return r}padSeqNum(t){return t.length<dbe?t+new Array(dbe-t.length+1).join("\xA0"):t}getSequenceNumberSpan(t,r){let n=this.getSequenceNumber(t);return(0,IB.jsx)("span",{className:this.getSequenceNumberClass(t,n,r),children:this.padSeqNum(n)},`marker-${t}`)}updateMarker(){if(!this.parentDiv.current)return;let t=this.parentDiv.current.children,{markerArray:r}=this.props.sequenceWrapper,n=!this.props.hideSequenceNumbers,o=this.sequenceNumberPeriod,i=0;for(let s=0,a=r.length;s<a;s++){n&&s%o===0&&s<a&&i++;let l=t[i];if(!l)return;i++;let c=this.getBackgroundColor(r[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}}render(){let t=this.props.sequenceWrapper,r=[],n=!this.props.hideSequenceNumbers,o=this.sequenceNumberPeriod;for(let i=0,s=t.length;i<s;++i){let a=t.residueLabel(i);n&&i%o===0&&i<s&&(r[r.length]=this.getSequenceNumberSpan(i,a)),r[r.length]=this.residue(i,a,t.markerArray[i])}return this.updateMarker(),(0,IB.jsx)("div",{className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv,children:r})}};var hh=class{markResidue(t,r){return cs(t)?Rl(this.markerArray,Be.ofLength(this.length),r):this.mark(t,r)}constructor(t,r,n){this.data=t,this.markerArray=r,this.length=n}};var wB=class extends hh{seqId(t){return this.sequence.seqId.value(t)}residueLabel(t){return this.sequence.label.value(t)||this.sequence.code.value(t)}residueColor(t){return this.missing.has(this.modelNum,this.asymId,this.seqId(t))?Gt.grey:Gt.black}residueClass(t){return this.missing.has(this.modelNum,this.asymId,this.seqId(t))?"msp-sequence-missing":"msp-sequence-present"}mark(t,r){let n=!1,{structure:o}=this.data,i=s=>this.sequence.index(s);if(ce.Loci.is(t)){if(!qe.areRootsEquivalent(t.structure,o))return!1;t=ce.Loci.remap(t,o);for(let s of t.elements)this.unitMap.has(s.unit.id)&&(Le.isAtomic(s.unit)?n=WJe(s,r,this.markerArray,i)||n:n=qJe(s,r,this.markerArray,i)||n)}else if(qe.isLoci(t)){if(!qe.areRootsEquivalent(t.structure,o))return!1;Rl(this.markerArray,this.observed,r)&&(n=!0)}return n}getLoci(t){let r=$Je(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(t));return wt.toLociWithSourceUnits(G2.run(r,this.data.structure))}constructor(t){let r=ce.Location.create(t.structure,t.units[0],t.units[0].elements[0]),n=t.units[0].model.sequence.byEntityKey[nt.entity.key(r)],o=n.sequence.length,i=new Uint8Array(o);super(t,i,o),this.unitMap=new Map;for(let a of t.units)this.unitMap.set(a.id,a);this.sequence=n.sequence,this.missing=t.units[0].model.properties.missingResidues,this.modelNum=t.units[0].model.modelNum,this.asymId=Le.isAtomic(t.units[0])?nt.chain.label_asym_id(r):nt.coarse.asym_id(r);let s=[];for(let a=0;a<o;++a)this.missing.has(this.modelNum,this.asymId,this.seqId(a))&&s.push(a);this.observed=Ge.subtract(Be.ofBounds(0,o),Qe.ofSortedArray(s))}};function $Je(e,t,r){return Pn.generators.atoms({unitTest:n=>nt.unit.chainGroupId(n.element)===e&&nt.unit.operator_name(n.element)===t,residueTest:n=>n.element.unit.kind===0?nt.residue.label_seq_id(n.element)===r:nt.coarse.seq_id_begin(n.element)<=r&&nt.coarse.seq_id_end(n.element)>=r})}function WJe(e,t,r,n){let{model:o,elements:i}=e.unit,{index:s}=o.atomicHierarchy.residueAtomSegments,{label_seq_id:a}=o.atomicHierarchy.residues;return Ge.forEachSegment(e.indices,l=>s[i[l]],l=>{let c=a.value(l);HC(r,n(c),t)}),!0}function qJe(e,t,r,n){let{model:o,elements:i}=e.unit,s=Le.isSpheres(e.unit)?o.coarseHierarchy.spheres.seq_id_begin:o.coarseHierarchy.gaussians.seq_id_begin,a=Le.isSpheres(e.unit)?o.coarseHierarchy.spheres.seq_id_end:o.coarseHierarchy.gaussians.seq_id_end;return Ge.forEach(e.indices,l=>{let c=i[l];for(let u=n(s.value(c)),d=n(a.value(c));u<=d;u++)HC(r,u,t)}),!0}var _B=class extends hh{residueLabel(t){return this.sequence[t]}residueColor(t){return Gt.black}residueClass(t){return"msp-sequence-present"}mark(t,r){let n=!1,{structure:o}=this.data;if(ce.Loci.is(t)){if(!qe.areRootsEquivalent(t.structure,o))return!1;t=ce.Loci.remap(t,o);for(let i of t.elements){let s=this.unitMap.get(i.unit.id);if(s){let{index:a}=i.unit.model.atomicHierarchy.residueAtomSegments;Ge.forEach(i.indices,l=>{let c=this.sequenceIndices.get(a[s.elements[l]]);c!==void 0&&Rl(this.markerArray,Be.ofSingleton(c),r)&&(n=!0)})}}}else if(qe.isLoci(t)){if(!qe.areRootsEquivalent(t.structure,o))return!1;Rl(this.markerArray,Be.ofBounds(0,this.length),r)&&(n=!0)}return n}getLoci(t){let r=[],n=this.residueIndices.get(t);if(n!==void 0){let o=this.seqToUnit.get(t),{offsets:i}=o.model.atomicHierarchy.residueAtomSegments,s=Qe.findPredecessorIndex(o.elements,i[n]),a=Qe.findPredecessorIndex(o.elements,i[n+1]);r.push({unit:o,indices:Be.ofBounds(s,a)})}return ce.Loci(this.data.structure,r)}constructor(t){let r=[],n=new Map,o=new Map,i=new Map;for(let l=0,c=t.units.length;l<c;++l){let u=t.units[l],{residueAtomSegments:d,atoms:m}=u.model.atomicHierarchy,p=Vt.transientSegments(d,u.elements);for(;p.hasNext;){let{index:h}=p.move();n.set(h,r.length),o.set(r.length,h),i.set(r.length,u),r.push(m.label_comp_id.value(d.offsets[h]))}}let s=r.length,a=new Uint8Array(s);super(t,a,s),this.unitMap=new Map;for(let l of t.units)this.unitMap.set(l.id,l);this.sequence=r,this.sequenceIndices=n,this.residueIndices=o,this.seqToUnit=i}};var QS=class extends hh{residueLabel(t){return this.label}residueColor(t){return Gt.black}residueClass(t){return"msp-sequence-present"}mark(t,r){let n=!1,{structure:o}=this.data;if(ce.Loci.is(t)){if(!qe.areRootsEquivalent(t.structure,o))return!1;t=ce.Loci.remap(t,o);for(let i of t.elements){let s=this.unitIndices.get(i.unit.id);s&&Ge.isSubset(s,i.indices)&&Rl(this.markerArray,Be.ofSingleton(0),r)&&(n=!0)}}else if(qe.isLoci(t)){if(!qe.areRootsEquivalent(t.structure,o))return!1;Rl(this.markerArray,Be.ofSingleton(0),r)&&(n=!0)}return n}getLoci(t){return this.loci}constructor(t){let r=0,n=0,o=[],i=ce.Location.create(t.structure),s=new Map,a=[];for(let u=0,d=t.units.length;u<d;++u){let m=t.units[u];ce.Location.set(i,t.structure,m,m.elements[0]);let p=m.model.sequence.byEntityKey[nt.entity.key(i)];p&&(r+=p.sequence.length),n+=m.elements.length;let h=Be.ofBounds(0,m.elements.length);s.set(m.id,h),a.push({unit:m,indices:h})}r>0&&o.push(`${r} residues`),o.push(`${n} elements`);let l=1,c=new Uint8Array(l);super(t,c,l),this.label=`Whole Chain (${o.join(", ")})`,this.unitIndices=s,this.loci=ce.Loci(this.data.structure,a)}};var TB=class extends hh{residueLabel(t){return"X"}residueColor(t){return Gt.black}residueClass(t){return"msp-sequence-present"}mark(t,r){let n=!1,{structure:o,units:i}=this.data;if(ce.Loci.is(t)){if(!qe.areRootsEquivalent(t.structure,o))return!1;t=ce.Loci.remap(t,o);for(let s of t.elements){let a=this.unitIndices.get(s.unit.id);a&&Ge.isSubset(a,s.indices)&&Rl(this.markerArray,s.indices,r)&&(n=!0)}}else if(qe.isLoci(t)){if(!qe.areRootsEquivalent(t.structure,o))return!1;for(let s=0,a=i.length;s<a;++s){let l=this.unitIndices.get(i[s].id);Rl(this.markerArray,l,r)&&(n=!0)}}return n}getLoci(t){let{units:r}=this.data,n=[],o=0;for(let i=0,s=r.length;i<s;++i){let a=r[i];if(t<o+a.elements.length){n.push({unit:a,indices:Be.ofSingleton(t-o)});break}o+=a.elements.length}return ce.Loci(this.data.structure,n)}constructor(t){let r=0,n=new Map,o=[];for(let s=0,a=t.units.length;s<a;++s){let l=t.units[s];r+=l.elements.length;let c=Be.ofBounds(0,l.elements.length);n.set(l.id,c),o.push({unit:l,indices:c})}let i=new Uint8Array(r);super(t,i,r),this.unitIndices=n}};var Cj=5e3,Sj=1e3,ZJe=30;function ybe(e){let t=nt.unit.pdbx_struct_oper_list_ids(e),r=nt.unit.struct_ncs_oper_id(e),n=nt.unit.hkl(e),o=nt.unit.spgrOp(e);return`${t.sort().join(",")}|${r}|${n}|${o}`}function Ij(e){let[t,r]=e.split("|");return[parseInt(t),r]}function pbe(e,t){let{structure:r,modelEntityId:n,chainGroupId:o,operatorKey:i}=e,s=ce.Location.create(r),[a,l]=Ij(n),c=[];for(let u of r.units)ce.Location.set(s,r,u,u.elements[0]),r.getModelIndex(u.model)===a&&nt.entity.id(s)===l&&u.chainGroupId===o&&ybe(s)===i&&c.push(u);if(c.length>0){let u={structure:r,units:c},d=c[0],m;if(d.polymerElements.length){let p=ce.Location.create(r,d,d.elements[0]),h=d.model.sequence.byEntityKey[nt.entity.key(p)];if(h&&h.sequence.length<=Cj)m=new wB(u);else{let f=c.reduce((C,g)=>C+g.polymerElements.length,0);Le.isAtomic(d)||f>Cj?m=new QS(u):m=new TB(u)}}else Le.isAtomic(d)?c.reduce((h,f)=>h+f.residueCount,0)>Cj?m=new QS(u):m=new _B(u):m=new QS(u);return m.markResidue(t.getLoci(r),zt.Select),m}else return"No sequence available"}function EB(e,t=!1){let r=[],n=ce.Location.create(e),o=new Set;for(let i of e.units){ce.Location.set(n,e,i,i.elements[0]);let s=nt.entity.id(n),a=e.getModelIndex(i.model),l=`${a}|${s}`;if(o.has(l)||t&&nt.entity.type(n)!=="polymer")continue;let c=nt.entity.pdbx_description(n).join(", ");e.models.length&&(e.representativeModel?c+=` (Model ${e.models[a].modelNum})`:c.startsWith("Polymer ")&&(c+=` (${e.models[a].entry})`));let u=`${s}: ${c}`;if(r.push([l,u]),o.add(l),r.length>Sj)return[["","Too many entities"]]}return r.length===0&&r.push(["","No entities"]),r}function U_(e,t){let r=[],n=ce.Location.create(e),o=new Set,[i,s]=Ij(t);for(let a of e.units){if(ce.Location.set(n,e,a,a.elements[0]),e.getModelIndex(a.model)!==i||nt.entity.id(n)!==s)continue;let l=a.chainGroupId;if(o.has(l))continue;let c=Rd(n,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});if(r.push([l,c]),o.add(l),r.length>Sj)return[[-1,"Too many chains"]]}return r.length===0&&r.push([-1,"No chains"]),r}function JS(e,t,r){let n=[],o=ce.Location.create(e),i=new Set,[s,a]=Ij(t);for(let l of e.units){if(ce.Location.set(o,e,l,l.elements[0]),e.getModelIndex(l.model)!==s||nt.entity.id(o)!==a||l.chainGroupId!==r)continue;let c=ybe(o);if(i.has(c))continue;let u=l.conformation.operator.name;if(n.push([c,u]),i.add(c),n.length>Sj)return[["","Too many operators"]]}return n.length===0&&n.push(["","No operators"]),n}function fbe(e){var t;let r=[],n=[],o=e.select(Kt.Generators.rootsOfType(fe.Molecule.Structure));for(let i of o)!((t=i.obj)===null||t===void 0)&&t.data&&(n.push(i.obj.data),r.push([i.transform.ref,i.obj.data.label]));return r.length===0&&r.push(["","No structure"]),{options:r,all:n}}var hbe=M.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]),PB=class extends yr{constructor(){super(...arguments),this.state={structureOptions:{options:[],all:[]},structure:qe.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},this.setParamProps=t=>{let r={...this.state};switch(t.name){case"mode":if(r.mode=t.value,this.state.mode===r.mode)return;if(r.mode==="all"||r.mode==="polymers")break;case"structure":t.name==="structure"&&(r.structureRef=t.value),r.structure=this.getStructure(r.structureRef),r.modelEntityId=EB(r.structure)[0][0],r.chainGroupId=U_(r.structure,r.modelEntityId)[0][0],r.operatorKey=JS(r.structure,r.modelEntityId,r.chainGroupId)[0][0];break;case"entity":r.modelEntityId=t.value,r.chainGroupId=U_(r.structure,r.modelEntityId)[0][0],r.operatorKey=JS(r.structure,r.modelEntityId,r.chainGroupId)[0][0];break;case"chain":r.chainGroupId=t.value,r.operatorKey=JS(r.structure,r.modelEntityId,r.chainGroupId)[0][0];break;case"operator":r.operatorKey=t.value;break}this.setState(r)}}componentDidMount(){this.plugin.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,({ref:t,obj:r})=>{t===this.state.structureRef&&r&&r.type===fe.Molecule.Structure.type&&r.data!==this.state.structure&&this.sync()}),this.subscribe(this.plugin.state.events.object.created,({obj:t})=>{t&&t.type===fe.Molecule.Structure.type&&this.sync()}),this.subscribe(this.plugin.state.events.object.removed,({obj:t})=>{t&&t.type===fe.Molecule.Structure.type&&t.data===this.state.structure&&this.sync()})}sync(){let t=fbe(this.plugin.state.data);Xx(t.all,this.state.structureOptions.all)||this.setState(this.getInitialState())}getStructure(t){let n=this.plugin.state.data.select(t)[0];return!t||!n||!n.obj?qe.Empty:n.obj.data}getSequenceWrapper(t){return{wrapper:pbe(this.state,this.plugin.managers.structure.selection),label:`${M.optionLabel(t.chain,this.state.chainGroupId)} | ${M.optionLabel(t.entity,this.state.modelEntityId)}`}}getSequenceWrappers(t){if(this.state.mode==="single")return[this.getSequenceWrapper(t)];let r=this.getStructure(this.state.structureRef),n=[];for(let[o,i]of EB(r,this.state.mode==="polymers"))for(let[s,a]of U_(r,o))for(let[l]of JS(r,o,s))if(n.push({wrapper:pbe({structure:r,modelEntityId:o,chainGroupId:s,operatorKey:l},this.plugin.managers.structure.selection),label:`${a} | ${i}`}),n.length>ZJe)return[];return n}getInitialState(){var t;let r=fbe(this.plugin.state.data),n=r.options[0][0],o=this.getStructure(n),i=EB(o)[0][0],s=U_(o,i)[0][0],a=JS(o,i,s)[0][0];return this.state.structure&&this.state.structure===o&&(i=this.state.modelEntityId,s=this.state.chainGroupId,a=this.state.operatorKey),{structureOptions:r,structure:o,structureRef:n,modelEntityId:i,chainGroupId:s,operatorKey:a,mode:(t=this.props.defaultMode)!==null&&t!==void 0?t:"single"}}get params(){let{structureOptions:t,structure:r,modelEntityId:n,chainGroupId:o}=this.state,i=EB(r),s=U_(r,n),a=JS(r,n,o);return{structure:M.Select(t.options[0][0],t.options,{shortLabel:!0}),entity:M.Select(i[0][0],i,{shortLabel:!0}),chain:M.Select(s[0][0],s,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:M.Select(a[0][0],a,{shortLabel:!0,twoColumns:!0}),mode:hbe}}get values(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}}render(){if(this.getStructure(this.state.structureRef)===qe.Empty)return(0,ms.jsx)("div",{className:"msp-sequence",children:(0,ms.jsxs)("div",{className:"msp-sequence-select",children:[(0,ms.jsx)(an,{svg:Nc,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."}),(0,ms.jsx)("span",{children:"Sequence"}),(0,ms.jsx)("span",{style:{fontWeight:"normal"},children:"No structure available"})]})});let t=this.params,r=this.values,n=this.getSequenceWrappers(t);return(0,ms.jsxs)("div",{className:"msp-sequence",children:[(0,ms.jsxs)("div",{className:"msp-sequence-select",children:[(0,ms.jsx)(an,{svg:Nc,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."}),(0,ms.jsx)("span",{children:"Sequence of"}),(0,ms.jsx)(uh,{title:`[Structure] ${M.optionLabel(t.structure,r.structure)}`,param:t.structure,name:"structure",value:r.structure,onChange:this.setParamProps}),(0,ms.jsx)(uh,{title:"[Mode]",param:hbe,name:"mode",value:r.mode,onChange:this.setParamProps}),r.mode==="single"&&(0,ms.jsx)(uh,{title:`[Entity] ${M.optionLabel(t.entity,r.entity)}`,param:t.entity,name:"entity",value:r.entity,onChange:this.setParamProps}),r.mode==="single"&&(0,ms.jsx)(uh,{title:`[Chain] ${M.optionLabel(t.chain,r.chain)}`,param:t.chain,name:"chain",value:r.chain,onChange:this.setParamProps}),t.operator.options.length>1&&(0,ms.jsx)(ms.Fragment,{children:(0,ms.jsx)(uh,{title:`[Instance] ${M.optionLabel(t.operator,r.operator)}`,param:t.operator,name:"operator",value:r.operator,onChange:this.setParamProps})})]}),(0,ms.jsx)(KJe,{children:n.map((o,i)=>{let s=typeof o.wrapper=="string"?(0,ms.jsx)("div",{className:"msp-sequence-wrapper",children:o.wrapper},i):(0,ms.jsx)(AB,{sequenceWrapper:o.wrapper},i);return r.mode==="single"?s:(0,ms.jsxs)(gbe.Fragment,{children:[(0,ms.jsx)("div",{className:"msp-sequence-chain-label",children:o.label}),s]},i)})})]})}};function KJe({children:e}){return(0,ms.jsx)("div",{className:"msp-sequence-wrapper-non-empty",children:e})}var sl=ar(un());var gh=ar(hi());function vbe(){let e=(0,gh.useContext)(rd),[t,r]=(0,gh.useState)(Ea());return(0,gh.useEffect)(()=>{let n=e.events.task.progress.subscribe(i=>{var s;let a=!!(!((s=e.spec.components)===null||s===void 0)&&s.hideTaskOverlay);i.level==="background"&&(a||!i.useOverlay)&&r(l=>l.set(i.id,i))}),o=e.events.task.finished.subscribe(({id:i})=>{r(s=>s.delete(i))});return()=>{n.unsubscribe(),o.unsubscribe()}},[e]),(0,sl.jsxs)("div",{className:"msp-background-tasks",children:[t.valueSeq().map(n=>(0,sl.jsx)(DB,{event:n},n.id)),(0,sl.jsx)(XJe,{})]})}function XJe(){var e;let t=(0,gh.useContext)(rd),r=Po((e=t.canvas3d)===null||e===void 0?void 0:e.commitQueueSize);return r?(0,sl.jsx)("div",{className:"msp-task-state",children:(0,sl.jsx)("div",{children:(0,sl.jsxs)("div",{children:["Commiting renderables... ",r," remaining"]})})}):null}var DB=class extends yr{constructor(){super(...arguments),this.abort=()=>{this.plugin.managers.task.requestAbort(this.props.event.progress.root.progress.taskId,"User Request")}}render(){let t=this.props.event.progress.root,r=bbe(this.props.event.progress.root)-1,n=t.progress.isIndeterminate?void 0:(0,sl.jsxs)(sl.Fragment,{children:["[",t.progress.current,"/",t.progress.max,"]"]}),o=r>0?(0,sl.jsxs)(sl.Fragment,{children:["[",r," subtask(s)]"]}):void 0;return(0,sl.jsx)("div",{className:"msp-task-state",children:(0,sl.jsxs)("div",{children:[t.progress.canAbort&&(0,sl.jsx)(Jt,{svg:WM,onClick:this.abort,title:"Abort"}),(0,sl.jsxs)("div",{children:[t.progress.message," ",n," ",o]})]})})}};function bbe(e){if(e.children.length===0)return 1;let t=0;for(let r of e.children)t+=bbe(r);return t}function xbe(){let e=(0,gh.useContext)(rd),[t,r]=(0,gh.useState)(Ea());return(0,gh.useEffect)(()=>{let n=e.events.task.progress.subscribe(i=>{i.useOverlay&&r(s=>s.set(i.id,i))}),o=e.events.task.finished.subscribe(({id:i})=>{r(s=>s.delete(i))});return()=>{n.unsubscribe(),o.unsubscribe()}},[e]),t.size===0?null:(0,sl.jsx)("div",{className:"msp-overlay-tasks",children:t.valueSeq().map(n=>(0,sl.jsx)(DB,{event:n},n.id))})}var Ud=ar(un());var Aj=class extends yr{constructor(){super(...arguments),this.hide=()=>{(this.props.entry.hide||function(){}).call(null)}}render(){let t=this.props.entry,r=typeof t.message=="string"?(0,Ud.jsx)("div",{dangerouslySetInnerHTML:{__html:t.message}}):(0,Ud.jsx)("div",{children:(0,Ud.jsx)(t.message,{})});return(0,Ud.jsxs)("div",{className:"msp-toast-entry",children:[(0,Ud.jsx)("div",{className:"msp-toast-title",onClick:()=>this.hide(),children:t.title}),(0,Ud.jsx)("div",{className:"msp-toast-message",children:r}),(0,Ud.jsx)("div",{className:"msp-toast-clear"}),(0,Ud.jsx)("div",{className:"msp-toast-hide",children:(0,Ud.jsx)(Jt,{svg:WM,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"})})]})}},kB=class extends yr{componentDidMount(){this.subscribe(this.plugin.managers.toast.events.changed,()=>this.forceUpdate())}render(){let t=this.plugin.managers.toast.state;if(!t.entries.count())return null;let r=[];return t.entries.forEach((n,o)=>r.push(n)),r.sort(function(n,o){return n.serialNumber-o.serialNumber}),(0,Ud.jsx)("div",{className:"msp-toast-container",children:r.map(n=>(0,Ud.jsx)(Aj,{entry:n},n.serialNumber))})}};var ci=ar(un());var $m=ar(un()),Cbe=ar(hi());var MB=class extends yr{constructor(){super(...arguments),this.container=Cbe.createRef(),this.state={noWebGl:!1,showLogo:!0},this.handleLogo=()=>{var t;this.setState({showLogo:!(!((t=this.plugin.canvas3d)===null||t===void 0)&&t.reprCount.value)})}}componentDidMount(){if(!this.container.current||!this.plugin.mount(this.container.current,{checkeredCanvasBackground:!0})){this.setState({noWebGl:!0});return}this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)}componentWillUnmount(){super.componentWillUnmount(),this.plugin.unmount()}renderMissing(){if(this.props.noWebGl){let t=this.props.noWebGl;return(0,$m.jsx)(t,{})}return(0,$m.jsx)("div",{className:"msp-no-webgl",children:(0,$m.jsxs)("div",{children:[(0,$m.jsx)("p",{children:(0,$m.jsx)("b",{children:"WebGL does not seem to be available."})}),(0,$m.jsx)("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps. Also, make sure hardware acceleration is enabled in your browser."}),(0,$m.jsxs)("p",{children:["For a list of supported browsers, refer to ",(0,$m.jsx)("a",{href:"http://caniuse.com/#feat=webgl",target:"_blank",children:"http://caniuse.com/#feat=webgl"}),"."]})]})})}render(){if(this.state.noWebGl)return this.renderMissing();let t=this.props.logo;return(0,$m.jsx)("div",{className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle,ref:this.container,children:this.state.showLogo&&t&&(0,$m.jsx)(t,{})})}};var Ws=ar(un());var al=ar(un()),RB=ar(hi()),id=ar(hi());var YJe=e=>{let{plugin:t,cropFrameColor:r}=e,n=t.helpers.viewportScreenshot,[o,i]=(0,id.useState)(null),s=(0,id.useRef)(null),a=(0,id.useRef)(e);return(0,id.useEffect)(()=>{a.current=e},Object.values(e)),(0,id.useEffect)(()=>{o!==s.current&&i(s.current)}),(0,id.useEffect)(()=>{var l;let c=!1,u=[];function d(C,g){C&&u.push(C.subscribe(g))}function m(){let C=a.current;!C.suspend&&s.current&&Sbe(n,s.current,C.customBackground,C.borderColor,C.borderWidth),s.current||(c=!0)}let p=setInterval(()=>{c&&(c=!1,m())},1e3/8);d(t.events.canvas3d.settingsUpdated,()=>c=!0),d((l=t.canvas3d)===null||l===void 0?void 0:l.didDraw,()=>c=!0),d(t.state.data.behaviors.isUpdating,C=>{C||(c=!0)}),d(n?.behaviors.values,()=>c=!0),d(n?.behaviors.cropParams,()=>c=!0);let h;typeof ResizeObserver<"u"&&(h=new ResizeObserver(()=>c=!0));let f=s.current;return h?.observe(f),m(),()=>{clearInterval(p),u.forEach(C=>C.unsubscribe()),h?.unobserve(f)}},[n]),(0,id.useLayoutEffect)(()=>{s.current&&Sbe(n,s.current,e.customBackground,e.borderColor,e.borderWidth)},[...Object.values(e)]),(0,al.jsx)(al.Fragment,{children:(0,al.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[(0,al.jsx)("canvas",{ref:s,onContextMenu:l=>{l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}}),(0,al.jsx)(QJe,{plugin:t,canvas:o,color:r})]})})},Abe=RB.memo(YJe,(e,t)=>A0(e,t));function Sbe(e,t,r,n,o){if(!e)return;let{canvas:i,width:s,height:a}=e.getPreview(),l=t.getContext("2d");if(!l)return;let c=t.clientWidth,u=t.clientHeight;t.width=c,t.height=u,l.clearRect(0,0,c,u);let d=wbe(s,a,c,u);if(r)l.fillStyle=r,l.fillRect(d.x,d.y,d.width,d.height);else if(e.values.transparent)for(let p=0;p<d.width;p+=13)for(let h=0;h<d.height;h+=13){l.fillStyle=(p+h)%2?"#ffffff":"#bfbfbf";let f=d.x+p,C=d.y+h,g=p+13>d.width?d.width-p:13,b=h+13>d.height?d.height-h:13;l.fillRect(f,C,g,b)}if(l.drawImage(i,d.x,d.y,d.width,d.height),n&&o){let m=o;l.rect(d.x,d.y,d.width,d.height),l.rect(d.x+m,d.y+m,d.width-2*m,d.height-2*m),l.fillStyle=n,l.fill("evenodd")}}function QJe({plugin:e,canvas:t,color:r="rgba(255, 87, 45, 0.75)"}){var n;let o=e.helpers.viewportScreenshot,i=Po(o?.behaviors.values),s=Po(o?.behaviors.cropParams),a=Po(o?.behaviors.relativeCrop),l=(0,id.useRef)({x:0,y:0,width:0,height:0});Po(i?.resolution.name==="viewport"?(n=e.canvas3d)===null||n===void 0?void 0:n.resized:void 0);let[c,u]=RB.useState(""),[d,m]=(0,id.useState)([0,0]),[p,h]=(0,id.useState)([0,0]);if(!o||!t||!a)return null;let{width:f,height:C}=o.getSizeAndViewport(),g=wbe(f,C,t.clientWidth,t.clientHeight),b={x:g.x+Math.floor(g.width*a.x),y:g.y+Math.floor(g.height*a.y),width:Math.ceil(g.width*a.width),height:Math.ceil(g.height*a.height)},y=Ibe(b),x=Ibe(g);if(c==="move"?(y.l+=p[0]-d[0],y.r+=p[0]-d[0],y.t+=p[1]-d[1],y.b+=p[1]-d[1]):c&&(c.indexOf("left")>=0?y.l+=p[0]-d[0]:c.indexOf("right")>=0&&(y.r+=p[0]-d[0]),c.indexOf("top")>=0?y.t+=p[1]-d[1]:c.indexOf("bottom")>=0&&(y.b+=p[1]-d[1])),y.l>y.r){let N=y.l;y.l=y.r,y.r=N}if(y.t>y.b){let N=y.t;y.t=y.b,y.b=N}let A=40;y.l=Math.min(x.r-A,Math.max(x.l,y.l)),y.r=Math.max(x.l+A,Math.min(x.r,y.r)),y.t=Math.min(x.b-A,Math.max(x.t,y.t)),y.b=Math.max(x.t+A,Math.min(x.b,y.b)),b.x=y.l,b.y=y.t,b.width=y.r-y.l+1,b.height=y.b-y.t+1,l.current=b;let v=N=>{N.preventDefault(),h([N.pageX,N.pageY])},_=N=>{N.preventDefault();let F=N.touches[0];h([F.pageX,F.pageY])},I=N=>{N.preventDefault(),u(N.currentTarget.getAttribute("data-drag"));let F=N.touches[0],H=[F.pageX,F.pageY];m(H),h(H),window.addEventListener("touchend",w),window.addEventListener("touchmove",_)},T=N=>{N.preventDefault(),u(N.currentTarget.getAttribute("data-drag"));let F=[N.pageX,N.pageY];m(F),h(F),window.addEventListener("mouseup",E),window.addEventListener("mousemove",v)},E=()=>{window.removeEventListener("mouseup",E),window.removeEventListener("mousemove",v),S()},w=()=>{window.removeEventListener("touchend",w),window.removeEventListener("touchmove",_),S()};function S(){let N=l.current;s?.auto&&o?.behaviors.cropParams.next({...s,auto:!1}),o?.behaviors.relativeCrop.next({x:(N.x-g.x)/g.width,y:(N.y-g.y)/g.height,width:N.width/g.width,height:N.height/g.height}),u("");let F=[0,0];m(F),h(F)}let P=N=>{N.preventDefault(),N.stopPropagation()},k=4,L=`3px solid ${r}`,R="transparent";return(0,al.jsxs)(al.Fragment,{children:[(0,al.jsx)("div",{"data-drag":"move",style:{position:"absolute",left:b.x,top:b.y,width:b.width,height:b.height,border:L,cursor:"move"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P}),(0,al.jsx)("div",{"data-drag":"left",style:{position:"absolute",left:b.x-k,top:b.y+k,width:4*k,height:b.height-k,background:R,cursor:"w-resize"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P}),(0,al.jsx)("div",{"data-drag":"right",style:{position:"absolute",left:y.r-2*k,top:b.y,width:4*k,height:b.height-k,background:R,cursor:"w-resize"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P}),(0,al.jsx)("div",{"data-drag":"top",style:{position:"absolute",left:b.x-k,top:b.y-k,width:b.width+2*k,height:4*k,background:R,cursor:"n-resize"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P}),(0,al.jsx)("div",{"data-drag":"bottom",style:{position:"absolute",left:b.x-k,top:y.b-2*k,width:b.width+2*k,height:4*k,background:R,cursor:"n-resize"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P}),(0,al.jsx)("div",{"data-drag":"top, left",style:{position:"absolute",left:y.l-k,top:y.t-k,width:4*k,height:4*k,background:R,cursor:"nw-resize"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P}),(0,al.jsx)("div",{"data-drag":"bottom, right",style:{position:"absolute",left:y.r-2*k,top:y.b-2*k,width:4*k,height:4*k,background:R,cursor:"nw-resize"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P}),(0,al.jsx)("div",{"data-drag":"top, right",style:{position:"absolute",left:y.r-2*k,top:y.t-k,width:4*k,height:4*k,background:R,cursor:"ne-resize"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P}),(0,al.jsx)("div",{"data-drag":"bottom, left",style:{position:"absolute",left:y.l-k,top:y.b-2*k,width:4*k,height:4*k,background:R,cursor:"ne-resize"},onMouseDown:T,onTouchStart:I,draggable:!1,onContextMenu:P})]})}function Ibe(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function wbe(e,t,r,n){let o=e/t,i=r/n;if(o<=i){let s=n*o;return{x:Math.round((r-s)/2),y:0,width:Math.round(s),height:n}}else{let s=r/o;return{x:0,y:Math.round((n-s)/2),width:r,height:Math.round(s)}}}var BB=class extends yr{constructor(){super(...arguments),this.state={showPreview:!0,isDisabled:!1},this.download=()=>{var t;(t=this.plugin.helpers.viewportScreenshot)===null||t===void 0||t.download(),this.props.close()},this.copy=async()=>{var t;try{await((t=this.plugin.helpers.viewportScreenshot)===null||t===void 0?void 0:t.copyToClipboard()),ht.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500})}catch{return this.copyImg()}},this.copyImg=async()=>{var t;let r=await((t=this.plugin.helpers.viewportScreenshot)===null||t===void 0?void 0:t.getImageDataUri());this.setState({imageData:r})},this.open=t=>{!t.target.files||!t.target.files[0]||ht.State.Snapshots.OpenFile(this.plugin,{file:t.target.files[0]})}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,t=>{this.setState({isDisabled:t})})}componentWillUnmount(){super.componentWillUnmount(),this.setState({imageData:void 0})}render(){var t;let r=!!(!((t=navigator.clipboard)===null||t===void 0)&&t.write);return(0,Ws.jsxs)("div",{children:[this.state.showPreview&&(0,Ws.jsxs)("div",{className:"msp-image-preview",children:[(0,Ws.jsx)(Abe,{plugin:this.plugin}),(0,Ws.jsx)(eet,{plugin:this.plugin})]}),(0,Ws.jsxs)("div",{className:"msp-flex-row",children:[!this.state.imageData&&(0,Ws.jsx)(or,{icon:Sge,onClick:r?this.copy:this.copyImg,disabled:this.state.isDisabled,children:"Copy"}),this.state.imageData&&(0,Ws.jsx)(or,{onClick:()=>this.setState({imageData:void 0}),disabled:this.state.isDisabled,children:"Clear"}),(0,Ws.jsx)(or,{icon:Yw,onClick:this.download,disabled:this.state.isDisabled,children:"Download"})]}),this.state.imageData&&(0,Ws.jsxs)("div",{className:"msp-row msp-copy-image-wrapper",children:[(0,Ws.jsx)("div",{children:"Right click below + Copy Image"}),(0,Ws.jsx)("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}})]}),(0,Ws.jsx)(JJe,{plugin:this.plugin,isDisabled:this.state.isDisabled}),(0,Ws.jsxs)(lo,{header:"State",children:[(0,Ws.jsx)(F_,{onAction:this.props.close}),(0,Ws.jsx)(lo,{header:"Save Options",initiallyExpanded:!1,noOffset:!0,children:(0,Ws.jsx)(O_,{})})]})]})}};function JJe({plugin:e,isDisabled:t}){let r=e.helpers.viewportScreenshot,n=Po(r?.behaviors.values);return r?(0,Ws.jsx)(An,{params:r.params,values:n,onChangeValues:o=>r.behaviors.values.next(o),isDisabled:t}):null}function eet({plugin:e}){let t=e.helpers.viewportScreenshot,r=Po(t?.behaviors.cropParams);return Po(t?.behaviors.relativeCrop),!t||!r?null:(0,Ws.jsxs)("div",{style:{width:"100%",height:"24px",marginTop:"8px"},children:[(0,Ws.jsx)(gi,{icon:wge,title:"Auto-crop",inline:!0,isSelected:r.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:()=>t.toggleAutocrop(),label:"Auto-crop "+(r.auto?"On":"Off")}),!r.auto&&(0,Ws.jsx)(or,{icon:Ige,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.autocrop()}),!r.auto&&!t.isFullFrame&&(0,Ws.jsx)(or,{icon:Age,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.resetCrop()})]})}var L1=ar(un());function _be(e){return({values:t,update:r,apply:n})=>({params:typeof e.params=="function"?e.params:o=>e.params,getTarget:e.target,getValues:t,update(o,i){let s=e.target(i);return Jl(s,a=>r(o,a,i))},apply:n||(()=>{})})}var LB=class extends yr{componentDidMount(){this.plugin.canvas3d&&(this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(fl(500,void 0,{leading:!0,trailing:!0})),t=>{(t.radiusMax!==void 0||t.radius!==void 0)&&this.forceUpdate()}))}render(){return this.plugin.canvas3d?(0,L1.jsxs)(L1.Fragment,{children:[(0,L1.jsx)(nR,{mapping:ret}),(0,L1.jsx)(k1,{})]}):null}},z_={sequence:"Sequence",log:"Log",left:"Left Panel",right:"Right Panel"},tet={animate:Nl.trackball.params.animate,camera:Nl.camera,background:M.Group({color:M.Color(ze(16579577),{label:"Background",description:"Custom background color"}),transparent:M.Boolean(!1),style:Nl.postprocessing.params.background},{pivot:"color"}),lighting:M.Group({occlusion:Nl.postprocessing.params.occlusion,shadow:Nl.postprocessing.params.shadow,outline:Nl.postprocessing.params.outline,dof:Nl.postprocessing.params.dof,fog:Nl.cameraFog},{isFlat:!0}),clipping:M.Group({...Nl.cameraClipping.params},{pivot:"radius"}),layout:M.MultiSelect([],M.objectToOptions(z_)),advanced:M.Group({multiSample:Nl.multiSample,hiZ:Nl.hiZ,sharpening:Nl.postprocessing.params.sharpening,pixelScale:Xp.Params.pixelScale,transparency:Xp.Params.transparency})},ret=_be({params:e=>{var t;let r=M.clone(tet),n=(t=e.spec.components)===null||t===void 0?void 0:t.controls;if(n){let i=[];n.top!=="none"&&i.push(["sequence",z_.sequence]),n.bottom!=="none"&&i.push(["log",z_.log]),n.left!=="none"&&i.push(["left",z_.left]),n.right!=="none"&&i.push(["right",z_.right]),r.layout.options=i}let o=e.config.get(Ot.Background.Styles)||[];return o.length>0&&Object.assign(r.background.params.style,{presets:Xa(o),isFlat:!1}),r},target(e){var t,r,n;let o=(t=e.spec.components)===null||t===void 0?void 0:t.controls,i=e.layout.state.regionState,s=[];i.top!=="hidden"&&(!o||o.top!=="none")&&s.push("sequence"),i.bottom!=="hidden"&&(!o||o.bottom!=="none")&&s.push("log"),i.left!=="hidden"&&(!o||o.left!=="none")&&s.push("left"),i.right!=="hidden"&&(!o||o.right!=="none")&&s.push("right");let{pixelScale:a,transparency:l}=(r=e.canvas3dContext)===null||r===void 0?void 0:r.props;return{canvas:(n=e.canvas3d)===null||n===void 0?void 0:n.props,layout:s,pixelScale:a,transparency:l}}})({values(e,t){let{canvas:r}=e,n=r.renderer;return{layout:e.layout,animate:r.trackball.animate,camera:r.camera,background:{color:n.backgroundColor,transparent:r.transparentBackground,style:r.postprocessing.background},lighting:{occlusion:r.postprocessing.occlusion,shadow:r.postprocessing.shadow,outline:r.postprocessing.outline,dof:r.postprocessing.dof,fog:r.cameraFog},clipping:{...r.cameraClipping},advanced:{multiSample:r.multiSample,hiZ:r.hiZ,sharpening:r.postprocessing.sharpening,pixelScale:e.pixelScale,transparency:e.transparency}}},update(e,t){let r=t.canvas;r.trackball.animate=e.animate,r.camera=e.camera,r.transparentBackground=e.background.transparent,r.renderer.backgroundColor=e.background.color,r.postprocessing.occlusion=e.lighting.occlusion,r.postprocessing.shadow=e.lighting.shadow,r.postprocessing.outline=e.lighting.outline,r.postprocessing.background=e.background.style,r.cameraFog=e.lighting.fog,r.cameraClipping={radius:e.clipping.radius,far:e.clipping.far,minNear:e.clipping.minNear},r.multiSample=e.advanced.multiSample,r.hiZ=e.advanced.hiZ,r.postprocessing.sharpening=e.advanced.sharpening,r.postprocessing.dof=e.lighting.dof,t.layout=e.layout,t.pixelScale=e.advanced.pixelScale,t.transparency=e.advanced.transparency},async apply(e,t){var r;await ht.Canvas3D.SetSettings(t,{settings:e.canvas});let n=e.layout.indexOf("left")<0,o=Jl(t.layout.state,i=>{i.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",i.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",i.regionState.left=n?"hidden":t.behaviors.layout.leftPanelTabName.value==="none"?"collapsed":"full",i.regionState.right=e.layout.indexOf("right")>=0?"full":"hidden"});await ht.Layout.Update(t,{state:o}),n&&ht.State.SetCurrentObject(t,{state:t.state.data,ref:xr.RootRef}),(r=t.canvas3dContext)===null||r===void 0||r.setProps({pixelScale:e.pixelScale,transparency:e.transparency})}});var NB=class extends yr{constructor(){super(...arguments),this.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},this.state={...this.allCollapsedState,isCameraResetEnabled:!0},this.resetCamera=()=>{ht.Camera.Reset(this.plugin,{})},this.toggleSettingsExpanded=this.toggle("isSettingsExpanded"),this.toggleScreenshotExpanded=this.toggle("isScreenshotExpanded"),this.toggleControls=()=>{ht.Layout.Update(this.plugin,{state:{showControls:!this.plugin.layout.state.showControls}})},this.toggleExpanded=()=>{ht.Layout.Update(this.plugin,{state:{isExpanded:!this.plugin.layout.state.isExpanded}})},this.setSettings=t=>{ht.Canvas3D.SetSettings(this.plugin,{settings:{[t.name]:t.value}})},this.setLayout=t=>{ht.Layout.Update(this.plugin,{state:{[t.name]:t.value}})},this.screenshot=()=>{var t;(t=this.plugin.helpers.viewportScreenshot)===null||t===void 0||t.download()},this.enableCameraReset=t=>{this.setState(r=>({...r,isCameraResetEnabled:t}))}}toggle(t){return r=>{this.setState(n=>({...n,...this.allCollapsedState,[t]:!this.state[t]})),r?.currentTarget.blur()}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(fl(500,void 0,{leading:!0,trailing:!0})),t=>this.enableCameraReset(t.radius!==0&&t.radiusMax!==0))}icon(t,r,n,o=!0){return(0,ci.jsx)(Jt,{svg:t,toggleState:o,onClick:r,title:n,style:{background:"transparent"}})}render(){return(0,ci.jsxs)("div",{className:"msp-viewport-controls",children:[(0,ci.jsxs)("div",{className:"msp-viewport-controls-buttons",children:[(0,ci.jsxs)("div",{className:"msp-hover-box-wrapper",children:[(0,ci.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(fge,this.resetCamera,"Reset Zoom"),(0,ci.jsx)("div",{className:"msp-hover-box-body",children:(0,ci.jsxs)("div",{className:"msp-flex-column",children:[(0,ci.jsx)("div",{className:"msp-flex-row",children:(0,ci.jsx)(or,{onClick:()=>this.resetCamera(),disabled:!this.state.isCameraResetEnabled,title:"Set camera zoom to fit the visible scene into view",children:"Reset Zoom"})}),(0,ci.jsx)("div",{className:"msp-flex-row",children:(0,ci.jsx)(or,{onClick:()=>ht.Camera.OrientAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align principal component axes of the loaded structures to the screen axes (\u201Clay flat\u201D)",children:"Orient Axes"})}),(0,ci.jsx)("div",{className:"msp-flex-row",children:(0,ci.jsx)(or,{onClick:()=>ht.Camera.ResetAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align Cartesian axes to the screen axes",children:"Reset Axes"})})]})}),(0,ci.jsx)("div",{className:"msp-hover-box-spacer"})]}),(0,ci.jsxs)("div",{children:[(0,ci.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(yge,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]}),(0,ci.jsxs)("div",{children:[(0,ci.jsx)("div",{className:"msp-semi-transparent-background"}),this.plugin.config.get(Ot.Viewport.ShowControls)&&this.icon(hge,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(Ot.Viewport.ShowExpand)&&this.icon(_ge,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(Ot.Viewport.ShowSettings)&&this.icon(gu,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]}),this.plugin.config.get(Ot.Viewport.ShowSelectionMode)&&(0,ci.jsxs)("div",{children:[(0,ci.jsx)("div",{className:"msp-semi-transparent-background"}),(0,ci.jsx)(lv,{})]})]}),this.state.isScreenshotExpanded&&(0,ci.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,ci.jsx)(zl,{header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:hu,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,ci.jsx)(BB,{close:this.toggleScreenshotExpanded})})}),this.state.isSettingsExpanded&&(0,ci.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,ci.jsx)(zl,{header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:hu,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,ci.jsx)(LB,{})})})]})}},net=()=>(0,ci.jsx)("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"}),Tbe=()=>(0,ci.jsx)(MB,{logo:net});var wj={};Ui(wj,{DownloadFile:()=>oet,OpenFiles:()=>H_});async function FB(e,t,r,n){var o,i,s,a;let l=Wg((i=(o=e.file)===null||o===void 0?void 0:o.name)!==null&&i!==void 0?i:""),c=t.dataFormats.binaryExtensions.has(l.ext),{data:u}=await t.builders.data.readFile({file:e,isBinary:c}),d=r==="auto"?t.dataFormats.auto(l,(s=u.cell)===null||s===void 0?void 0:s.obj):t.dataFormats.get(r);if(!d){t.log.warn(`OpenFiles: could not find data provider for '${l.ext}'`),await t.state.data.build().delete(u).commit();return}let m=await d.parse(t,u);n&&await((a=d.visuals)===null||a===void 0?void 0:a.call(d,t,m))}var H_=ki.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:fe.Root,params:(e,t)=>{let{extensions:r,options:n}=t.dataFormats;return{files:M.FileList({accept:Array.from(r.values()).map(o=>`.${o}`).join(",")+",.gz,.zip",multiple:!0}),format:M.MappedStatic("auto",{auto:M.EmptyGroup(),specific:M.Select(n[0][0],n)}),visuals:M.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},r)=>ke.create("Open Files",async n=>{r.behaviors.layout.leftPanelTabName.next("data"),await t.transaction(async()=>{if(e.files===null){r.log.error("No file(s) selected");return}for(let o of e.files)try{if(o.file&&o.name.toLowerCase().endsWith(".zip")){let i=await P0(n,await o.file.arrayBuffer());for(let[s,a]of Object.entries(i)){if(!(a instanceof Uint8Array)||a.length===0)continue;let l=Nr.File(new File([a],s));await FB(l,r,"auto",e.visuals)}}else{let i=e.format.name==="auto"?"auto":e.format.params;await FB(o,r,i,e.visuals)}}catch{r.log.error(`Error opening file '${o.name}'`)}}).runInContext(n)})),oet=ki.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:fe.Root,params:(e,t)=>{let r=[...t.dataFormats.options,["zip","Zip"],["gzip","Gzip"]];return{url:M.Url(""),format:M.Select(r[0][0],r),isBinary:M.Boolean(!1),visuals:M.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},r)=>ke.create("Open Files",async n=>{r.behaviors.layout.leftPanelTabName.next("data"),await t.transaction(async()=>{var o,i,s;try{if(e.format==="zip"||e.format==="gzip"){let a=await r.builders.data.download({url:e.url,isBinary:!0});if(e.format==="zip"){let l=await P0(n,((o=a.obj)===null||o===void 0?void 0:o.data).buffer);for(let[c,u]of Object.entries(l)){if(!(u instanceof Uint8Array)||u.length===0)continue;let d=Nr.File(new File([u],c));await FB(d,r,"auto",e.visuals)}}else{let l=Nr.getUrl(e.url),c=Wg(l).name;await FB(Nr.File(new File([(i=a.obj)===null||i===void 0?void 0:i.data],c)),r,"auto",e.visuals)}}else{let a=r.dataFormats.get(e.format);if(!a){r.log.warn(`DownloadFile: could not find data provider for '${e.format}'`);return}let l=await r.builders.data.download({url:e.url,isBinary:e.isBinary}),c=await a.parse(r,l);e.visuals&&await((s=a.visuals)===null||s===void 0?void 0:s.call(a,r,c))}}catch{r.log.error(`Error downloading '${typeof e.url=="string"?e.url:e.url.url}'`)}}).runInContext(n)}));function Ebe({plugin:e}){return e.isInitialized?(0,Wn.jsx)(rd.Provider,{value:e,children:(0,Wn.jsx)(OB,{})}):(0,Wn.jsx)(iet,{plugin:e})}function iet({plugin:e}){let[t,r]=N1.useState({kind:"pending"});return N1.useEffect(()=>{r({kind:"pending"});let n=!0;return e.initialized.then(()=>{n&&r({kind:"initialized"})}).catch(o=>{n&&r({kind:"error",message:`${o}`})}),()=>{n=!1}},[e]),t.kind==="pending"?null:t.kind==="error"?(0,Wn.jsx)("div",{className:"msp-plugin",children:(0,Wn.jsxs)("div",{className:"msp-plugin-init-error",children:["Initialization error: ",t.message]})}):(0,Wn.jsx)(rd.Provider,{value:e,children:(0,Wn.jsx)(OB,{})})}var OB=class extends yr{constructor(){super(...arguments),this.onDrop=t=>{t.preventDefault();let r=[];if(t.dataTransfer.items)for(let o=0;o<t.dataTransfer.items.length;o++){if(t.dataTransfer.items[o].kind!=="file")continue;let i=t.dataTransfer.items[o].getAsFile();i&&r.push(i)}else for(let o=0;o<t.dataTransfer.files.length;o++){let i=t.dataTransfer.files[o];i&&r.push(i)}let n=r.filter(o=>{let i=o.name.toLowerCase();return i.endsWith(".molx")||i.endsWith(".molj")});n.length>0?ht.State.Snapshots.OpenFile(this.plugin,{file:n[0]}):this.plugin.runTask(this.plugin.state.data.applyAction(H_,{files:r.map(o=>Nr.File(o)),format:{name:"auto",params:{}},visuals:!0}))},this.onDragOver=t=>{t.preventDefault()},this.showDragOverlay=new jo(!1),this.onDragEnter=t=>{let r=!1;if(t.dataTransfer.items&&t.dataTransfer.items.length>0){for(let n=0;n<t.dataTransfer.items.length;n++)if(t.dataTransfer.items[n].kind==="file"){r=!0;break}}else for(let n=0;n<t.dataTransfer.types.length;n++)if(t.dataTransfer.types[n]==="Files"){r=!0;break}r&&this.showDragOverlay.next(!0)}}componentDidMount(){this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate())}region(t,r){return(0,Wn.jsx)("div",{className:`msp-layout-region msp-layout-${t}`,children:(0,Wn.jsx)("div",{className:"msp-layout-static",children:r?(0,Wn.jsx)(r,{}):null})})}get layoutVisibilityClassName(){var t,r;let n=this.plugin.layout.state,o=(r=(t=this.plugin.spec.components)===null||t===void 0?void 0:t.controls)!==null&&r!==void 0?r:{},i=[];return(o.top==="none"||!n.showControls||n.regionState.top==="hidden")&&i.push("msp-layout-hide-top"),o.left==="none"||!n.showControls||n.regionState.left==="hidden"?i.push("msp-layout-hide-left"):n.regionState.left==="collapsed"&&i.push("msp-layout-collapse-left"),(o.right==="none"||!n.showControls||n.regionState.right==="hidden")&&i.push("msp-layout-hide-right"),(o.bottom==="none"||!n.showControls||n.regionState.bottom==="hidden")&&i.push("msp-layout-hide-bottom"),i.join(" ")}get layoutClassName(){let t=this.plugin.layout.state,r=["msp-plugin-content"];return t.isExpanded?r.push("msp-layout-expanded"):r.push("msp-layout-standard",`msp-layout-standard-${t.controlsDisplay}`),r.join(" ")}render(){var t,r,n,o,i,s,a;let l=this.plugin.layout.state,c=((t=this.plugin.spec.components)===null||t===void 0?void 0:t.controls)||{},u=((n=(r=this.plugin.spec.components)===null||r===void 0?void 0:r.viewport)===null||n===void 0?void 0:n.view)||Tj,d=((i=(o=this.plugin.spec.components)===null||o===void 0?void 0:o.sequenceViewer)===null||i===void 0?void 0:i.view)||PB;return(0,Wn.jsx)("div",{className:"msp-plugin",children:(0,Wn.jsxs)("div",{className:this.layoutClassName,onDragEnter:this.onDragEnter,children:[(0,Wn.jsxs)("div",{className:this.layoutVisibilityClassName,children:[this.region("main",u),l.showControls&&c.top!=="none"&&this.region("top",c.top||d),l.showControls&&c.left!=="none"&&this.region("left",c.left||SB),l.showControls&&c.right!=="none"&&this.region("right",c.right||_j),l.showControls&&c.bottom!=="none"&&this.region("bottom",c.bottom||Ej)]}),!(!((s=this.plugin.spec.components)===null||s===void 0)&&s.hideTaskOverlay)&&(0,Wn.jsx)(xbe,{}),!(!((a=this.plugin.spec.components)===null||a===void 0)&&a.disableDragOverlay)&&(0,Wn.jsx)(aet,{plugin:this.plugin,showDragOverlay:this.showDragOverlay})]})})}};function set(e,t,r){e.preventDefault(),e.stopPropagation(),r.next(!1);let n=[];if(e.dataTransfer.items)for(let o=0;o<e.dataTransfer.items.length;o++){if(e.dataTransfer.items[o].kind!=="file")continue;let i=e.dataTransfer.items[o].getAsFile();i&&n.push(i)}else for(let o=0;o<e.dataTransfer.files.length;o++){let i=e.dataTransfer.files[o];i&&n.push(i)}t.managers.dragAndDrop.handle(n)}function aet({plugin:e,showDragOverlay:t}){let r=Po(t),n=o=>{o.dataTransfer.dropEffect="copy",o.preventDefault(),o.stopPropagation()};return(0,Wn.jsx)("div",{className:"msp-drag-drop-overlay",style:{display:r?"flex":"none"},onDragEnter:n,onDragOver:n,onDragLeave:()=>t.next(!1),onDrop:o=>set(o,e,t),children:"Load File(s)"})}var _j=class extends yr{render(){var t;let r=((t=this.plugin.spec.components)===null||t===void 0?void 0:t.structureTools)||vB;return(0,Wn.jsx)("div",{className:"msp-scrollable-container",children:(0,Wn.jsx)(r,{})})}},Tj=class extends yr{render(){var t,r;let n=((r=(t=this.plugin.spec.components)===null||t===void 0?void 0:t.viewport)===null||r===void 0?void 0:r.controls)||NB;return(0,Wn.jsxs)(Wn.Fragment,{children:[(0,Wn.jsx)(Tbe,{}),(0,Wn.jsxs)("div",{className:"msp-viewport-top-left-controls",children:[(0,Wn.jsx)(hB,{}),(0,Wn.jsx)(pB,{}),(0,Wn.jsx)(fB,{}),(0,Wn.jsx)(lbe,{})]}),(0,Wn.jsx)(gB,{}),(0,Wn.jsx)(n,{}),(0,Wn.jsx)(vbe,{}),(0,Wn.jsxs)("div",{className:"msp-highlight-toast-wrapper",children:[(0,Wn.jsx)(yB,{}),(0,Wn.jsx)(kB,{})]})]})}},Ej=class extends yr{constructor(){super(...arguments),this.wrapper=N1.createRef(),this.state={entries:this.plugin.log.entries}}componentDidMount(){this.subscribe(this.plugin.events.log,()=>this.setState({entries:this.plugin.log.entries}))}componentDidUpdate(){this.scrollToBottom()}scrollToBottom(){let t=this.wrapper.current;t&&(t.scrollTop=t.scrollHeight-t.clientHeight-1)}render(){let r=this.state.entries,n=r.size,o=[];for(let i=Math.max(0,n-10),s=0;i<n;i++){let a=r.get(i);o.push((0,Wn.jsxs)("li",{children:[(0,Wn.jsx)("div",{className:"msp-log-entry-badge msp-log-entry-"+a.type}),(0,Wn.jsx)("div",{className:"msp-log-timestamp",children:XW(a.timestamp)}),(0,Wn.jsx)("div",{className:"msp-log-entry",children:a.message})]},s++))}return(0,Wn.jsx)("div",{ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"},children:(0,Wn.jsx)("ul",{className:"msp-list-unstyled",children:o})})}};var j_;(function(e){class t{constructor(){this.providers=Ea().asMutable(),this.defaultAutoAttachValues=new Map}getParams(n){let o={},i=[],s=[];if(n){let a=this.providers.values();for(;;){let l=a.next();if(l.done)break;let c=l.value;c.isApplicable(n)&&(c.isHidden||(i.push([c.descriptor.name,c.label]),this.defaultAutoAttachValues.get(c.descriptor.name)&&s.push(c.descriptor.name)),o[c.descriptor.name]=M.Group({...c.getParams(n)},{label:c.label,isHidden:c.isHidden}))}}return{autoAttach:M.MultiSelect(s,i),properties:M.Group(o,{isFlat:!0})}}setDefaultAutoAttach(n,o){this.defaultAutoAttachValues.set(n,o)}get(n){if(!this.providers.get(n))throw new Error(`Custom property '${n}' is not registered.`);return this.providers.get(n)}register(n,o){this.providers.set(n.descriptor.name,n),this.defaultAutoAttachValues.set(n.descriptor.name,o)}unregister(n){this.providers.delete(n),this.defaultAutoAttachValues.delete(n)}}e.Registry=t})(j_||(j_={}));var VB=class{get dataState(){return this.plugin.state.data}rawData(t,r){return this.dataState.build().toRoot().apply(J4,t,r).commit({revertOnError:!0})}download(t,r){return this.dataState.build().toRoot().apply(Ru,t,r).commit({revertOnError:!0})}downloadBlob(t,r){return this.dataState.build().toRoot().apply(Q4,t,r).commit({revertOnError:!0})}async readFile(t,r){var n,o,i;let s=await this.dataState.build().toRoot().apply(e5,t,r).commit({revertOnError:!0}),a=Wg((i=(o=(n=t.file)===null||n===void 0?void 0:n.file)===null||o===void 0?void 0:o.name)!==null&&i!==void 0?i:"");return{data:s,fileInfo:a}}constructor(t){this.plugin=t}};var GB=class{get dataState(){return this.plugin.state.data}resolveProvider(t){var r;return typeof t=="string"?(r=ds[t])!==null&&r!==void 0?r:Ax(this._providers,n=>n.id===t):t}hasPreset(t){for(let r of this._providers)if(!r.isApplicable||r.isApplicable(t,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(t){if(!t)return this.providers;let r=[];for(let n of this._providers)n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push(n);return r}getPresetSelect(t){let r=[];for(let n of this._providers)t&&n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push([n.id,n.display.name,n.display.group]);return M.Select("auto",r)}getPresetsWithOptions(t){let r=[],n=Object.create(null);for(let o of this._providers)o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?M.Group(o.params(t,this.plugin)):M.EmptyGroup());return r.length===0?M.MappedStatic("",{"":M.EmptyGroup()}):M.MappedStatic(r[0][0],n,{options:r})}registerPreset(t){if(this.providerMap.has(t.id))throw new Error(`Representation provider with id '${t.id}' already registered.`);this._providers.push(t),this.providerMap.set(t.id,t)}unregisterPreset(t){this.providerMap.delete(t.id),Jh(this._providers,t)}applyPreset(t,r,n){var o;let i=this.resolveProvider(r);if(!i)return;let s=this.plugin.state.data,a=Jn.resolveAndCheck(s,t);if(!a)return;let l=((o=i.params)===null||o===void 0?void 0:o.call(i,a.obj,this.plugin))||{},c=n||(i.params?M.getDefaultValues(l):{}),u=this.plugin.config.get(Ot.Structure.DefaultRepresentationPresetParams);c=M.merge(l,u,c);let d=ke.create(`${i.display.name}`,()=>i.apply(a,c,this.plugin));return this.plugin.runTask(d)}async addRepresentation(t,r,n){let o=this.dataState.build(),i=this.buildRepresentation(o,t,r,n);if(i)return await o.commit(),i}buildRepresentation(t,r,n,o){var i,s;if(!r)return;let a=(s=(i=Jn.resolveAndCheck(this.dataState,r))===null||i===void 0?void 0:i.obj)===null||s===void 0?void 0:s.data;if(!a)return;let l=qy(this.plugin,a,n);return o?.tag?t.to(r).applyOrUpdateTagged(o.tag,eS,l,{state:o?.initialState}).selector:t.to(r).apply(eS,l,{state:o?.initialState}).selector}constructor(t){this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=ds.auto,Ao(ds,r=>this.registerPreset(r))}};function hv(e){return e}(function(e){e.CommonParams=(t,r)=>({modelProperties:M.Optional(M.Group(st.getParamDefinition(Je.Model.CustomModelProperties,void 0,r))),structureProperties:M.Optional(M.Group(st.getParamDefinition(Je.Model.CustomStructureProperties,void 0,r))),representationPreset:M.Optional(M.Text("auto"))})})(hv||(hv={}));var UB=hv.CommonParams,cet=(e,t)=>({model:M.Optional(M.Group(st.getParamDefinition(Je.Model.ModelFromTrajectory,e,t))),showUnitcell:M.Optional(M.Boolean(!1)),structure:M.Optional(Xf.getParams(void 0,"assembly").type),representationPresetParams:M.Optional(M.Group(Go.CommonParams)),...UB(e,t)}),Pbe=hv({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:e=>!0,params:cet,async apply(e,t,r){let n=r.builders.structure,o=await n.createModel(e,t.model),i=await n.insertModelProperties(o,t.modelProperties),s=await n.createStructure(i||o,t.structure),a=await n.insertStructureProperties(s,t.structureProperties),l=t.showUnitcell===void 0||t.showUnitcell?await n.tryCreateUnitcell(i,void 0,{isHidden:!0}):void 0,c=t.representationPreset||r.config.get(Ot.Structure.DefaultRepresentationPreset)||ds.auto.id,u=await r.builders.structure.representation.applyPreset(a,c,t.representationPresetParams);return{model:o,modelProperties:i,unitcell:l,structure:s,structureProperties:a,representation:u}}}),uet=(e,t)=>({useDefaultIfSingleModel:M.Optional(M.Boolean(!1)),representationPresetParams:M.Optional(M.Group(Go.CommonParams)),...UB(e,t)}),det=hv({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by trajectory-index."},isApplicable:e=>e.data.frameCount>1,params:uet,async apply(e,t,r){var n,o;let i=(o=(n=Jn.resolveAndCheck(r.state.data,e))===null||n===void 0?void 0:n.obj)===null||o===void 0?void 0:o.data;if(!i)return{};if(i.frameCount===1&&t.useDefaultIfSingleModel)return Pbe.apply(e,t,r);let s=r.builders.structure,a=[],l=[];for(let c=0;c<i.frameCount;c++){let u=await s.createModel(e,{modelIndex:c}),d=await s.insertModelProperties(u,t.modelProperties,{isCollapsed:!0}),m=await s.createStructure(d||u,{name:"model",params:{}}),p=await s.insertStructureProperties(m,t.structureProperties);a.push(u),l.push(m);let h=m.obj?LU(m.obj.data,{elementCountFactor:i.frameCount}):"medium",f=t.representationPreset||r.config.get(Ot.Structure.DefaultRepresentationPreset)||ds.auto.id;await s.representation.applyPreset(p,f,{theme:{globalName:"trajectory-index"},quality:h})}return{models:a,structures:l}}}),Dbe=(e,t)=>({model:M.Optional(M.Group(st.getParamDefinition(Je.Model.ModelFromTrajectory,e,t))),...UB(e,t)});async function kbe(e,t,r,n){let o=n.builders.structure,i=await o.createModel(t,r.model),s=await o.insertModelProperties(i,r.modelProperties),a=await o.createStructure(s||i,{name:"symmetry",params:e}),l=await o.insertStructureProperties(a,r.structureProperties),c=await o.tryCreateUnitcell(s,void 0,{isHidden:!1}),u=r.representationPreset||n.config.get(Ot.Structure.DefaultRepresentationPreset)||ds.auto.id,d=await n.builders.structure.representation.applyPreset(l,u,{theme:{globalName:e.theme}});return{model:i,modelProperties:s,unitcell:c,structure:a,structureProperties:l,representation:d}}var met=hv({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:e=>Ut.hasCrystalSymmetry(e.data.representative),params:Dbe,async apply(e,t,r){return await kbe({ijkMin:D.create(0,0,0),ijkMax:D.create(0,0,0)},e,t,r)}}),pet=hv({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:e=>Ut.hasCrystalSymmetry(e.data.representative),params:Dbe,async apply(e,t,r){return await kbe({ijkMin:D.create(-1,-1,-1),ijkMax:D.create(1,1,1),theme:"operator-hkl"},e,t,r)}}),fet=(e,t)=>({model:M.Optional(M.Group(st.getParamDefinition(Je.Model.ModelFromTrajectory,e,t))),...UB(e,t)}),het=hv({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212B, i.e., symmetry mates."},isApplicable:e=>Ut.hasCrystalSymmetry(e.data.representative),params:fet,async apply(e,t,r){let n=r.builders.structure,o=await n.createModel(e,t.model),i=await n.insertModelProperties(o,t.modelProperties),s=await n.createStructure(i||o,{name:"symmetry-mates",params:{radius:5}}),a=await n.insertStructureProperties(s,t.structureProperties),l=await n.tryCreateUnitcell(i,void 0,{isHidden:!0}),c=t.representationPreset||r.config.get(Ot.Structure.DefaultRepresentationPreset)||ds.auto.id,u=await r.builders.structure.representation.applyPreset(a,c,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:VC.defaultValues}}}}});return{model:o,modelProperties:i,unitcell:l,structure:s,structureProperties:a,representation:u}}}),zB={default:Pbe,"all-models":det,unitcell:met,supercell:pet,crystalContacts:het};var HB=class{resolveProvider(t){var r;return typeof t=="string"?(r=zB[t])!==null&&r!==void 0?r:Ax(this._providers,n=>n.id===t):t}hasPreset(t){for(let r of this._providers)if(!r.isApplicable||r.isApplicable(t,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(t){if(!t)return this.providers;let r=[];for(let n of this._providers)n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push(n);return r}getPresetSelect(t){let r=[];for(let n of this._providers)t&&n.isApplicable&&!n.isApplicable(t,this.plugin)||r.push([n.id,n.display.name]);return M.Select("auto",r)}getPresetsWithOptions(t){let r=[],n=Object.create(null);for(let o of this._providers)o.isApplicable&&!o.isApplicable(t,this.plugin)||(r.push([o.id,o.display.name]),n[o.id]=o.params?M.Group(o.params(t,this.plugin)):M.EmptyGroup());return r.length===0?M.MappedStatic("",{"":M.EmptyGroup()}):M.MappedStatic(r[0][0],n,{options:r})}registerPreset(t){if(this.providerMap.has(t.id))throw new Error(`Hierarchy provider with id '${t.id}' already registered.`);this._providers.push(t),this.providerMap.set(t.id,t)}unregisterPreset(t){this.providerMap.delete(t.id),Jh(this._providers,t)}applyPreset(t,r,n){let o=this.resolveProvider(r);if(!o)return;let i=this.plugin.state.data,s=Jn.resolveAndCheck(i,t);if(!s)return;let a=n||(o.params?M.getDefaultValues(o.params(s.obj,this.plugin)):{}),l=ke.create(`${o.display.name}`,()=>o.apply(s,a,this.plugin));return this.plugin.runTask(l)}constructor(t){this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=zB.default,Ao(zB,r=>this.registerPreset(r))}};var jB=class{get dataState(){return this.plugin.state.data}async parseTrajectoryData(t,r){let n=typeof r=="string"?this.plugin.dataFormats.get(r):r;if(!n)throw new Error(`'${r}' is not a supported data format.`);let{trajectory:o}=await n.parse(this.plugin,t);return o}parseTrajectoryBlob(t,r){return this.dataState.build().to(t).apply(Je.Data.ParseBlob,r,{state:{isGhost:!0}}).apply(Je.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})}parseTrajectory(t,r){let n=Jn.resolveAndCheck(this.dataState,t);if(!n)throw new Error("Invalid data cell.");return fe.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(t,r):this.parseTrajectoryData(t,r)}createModel(t,r,n){return this.dataState.build().to(t).apply(Je.Model.ModelFromTrajectory,r||{modelIndex:0},{state:n}).commit({revertOnError:!0})}insertModelProperties(t,r,n){return this.dataState.build().to(t).apply(Je.Model.CustomModelProperties,r,{state:n}).commit({revertOnError:!0})}tryCreateUnitcell(t,r,n){var o,i,s;let a=this.dataState,l=(i=(o=Jn.resolveAndCheck(a,t))===null||o===void 0?void 0:o.obj)===null||i===void 0?void 0:i.data;if(!l)return;let c=(s=_o.Provider.get(l))===null||s===void 0?void 0:s.spacegroup.cell;return Ni.isZero(c)?void 0:a.build().to(t).apply(Je.Representation.ModelUnitcell3D,r,{state:n}).commit({revertOnError:!0})}createStructure(t,r,n,o){var i;let s=this.dataState;if(!r){let l=Jn.resolveAndCheck(s,t);if(l){let c=_o.Provider.get((i=l.obj)===null||i===void 0?void 0:i.data);(!c||c?.assemblies.length===0)&&(r={name:"model",params:{}})}}return s.build().to(t).apply(Je.Model.StructureFromModel,{type:r||{name:"assembly",params:{}}},{state:n,tags:o}).commit({revertOnError:!0})}insertStructureProperties(t,r){return this.dataState.build().to(t).apply(Je.Model.CustomStructureProperties,r).commit({revertOnError:!0})}isComponentTransform(t){return t.transform.transformer===Je.Model.StructureComponent}async tryCreateComponent(t,r,n,o){var i,s;let a=this.dataState,l=a.build().to(t),c=`structure-component-${n}`,u=l.applyOrUpdateTagged(c,Je.Model.StructureComponent,r,{tags:o?[...o,c]:[c]});await u.commit();let d=u.selector;if(!d.isOk||((s=(i=d.cell)===null||i===void 0?void 0:i.obj)===null||s===void 0?void 0:s.data.elementCount)===0){await a.build().delete(d.ref).commit();return}return d}tryCreateComponentFromExpression(t,r,n,o){return this.tryCreateComponent(t,{type:{name:"expression",params:r},nullIfEmpty:!0,label:(o?.label||"").trim()},n,o?.tags)}tryCreateComponentStatic(t,r,n){return this.tryCreateComponent(t,{type:{name:"static",params:r},nullIfEmpty:!0,label:(n?.label||"").trim()},`static-${r}`,n?.tags)}tryCreateComponentFromSelection(t,r,n,o){return this.plugin.runTask(ke.create("Query Component",async i=>{var s,a;let{label:l,tags:c}=o||{};l=(l||"").trim();let u=(a=(s=Jn.resolveAndCheck(this.dataState,t))===null||s===void 0?void 0:s.obj)===null||a===void 0?void 0:a.data;if(!u)return;let d=r.referencesCurrent?{type:{name:"bundle",params:ce.Bundle.fromSelection(await r.getSelection(this.plugin,i,u))},nullIfEmpty:!0,label:l||r.label}:{type:{name:"expression",params:r.expression},nullIfEmpty:!0,label:l||r.label};return r.ensureCustomProperties&&await r.ensureCustomProperties({runtime:i,assetManager:this.plugin.managers.asset},u),this.tryCreateComponent(t,d,n,c)}))}constructor(t){this.plugin=t,this.hierarchy=new HB(this.plugin),this.representation=new GB(this.plugin)}};var Pj;(function(e){function t(r){let{name:n}=r;return{descriptor:r,get(o){return o._propertyData[n]},set(o,i){o.customProperties.add(r),o._propertyData[n]=i}}}e.create=t})(Pj||(Pj={}));var $_;(function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=Pj.create(e.Descriptor)})($_||($_={}));var eI="Volume";async function W_(e,t){if(!t)return;let{entryId:r}=t;if(!(!r||!r.toLowerCase().startsWith("emd")))return e.runTask(ke.create("Try Set Recommended IsoValue",async n=>{try{let o=await q6(e,n,r);$_.Provider.set(t,ot.IsoValue.absolute(o))}catch{}}))}function Mbe(e){let t=$_.Provider.get(e);if(t)return t.kind==="relative"?t:ot.adjustedIsoValue(e,t.absoluteValue,"absolute")}async function Dj(e,t){let r={},n=t.volume.data&&Mbe(t.volume.data);return n&&(r.isoValue=n),[await e.build().to(t.volume).apply(Je.Representation.VolumeRepresentation3D,Ul(e,t.volume.data,{type:"isosurface",typeParams:r})).commit()]}var get={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:eI,binaryExtensions:["ccp4","mrc","map"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Je.Data.ParseCcp4,{},{state:{isGhost:!0}}),o=n.apply(Je.Volume.VolumeFromCcp4,{entryId:r?.entryId});return await n.commit({revertOnError:!0}),await W_(e,o.selector.data),{format:n.selector,volume:o.selector}},visuals:Dj},yet={label:"DSN6/BRIX",description:"DSN6/BRIX",category:eI,binaryExtensions:["dsn6","brix"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Je.Data.ParseDsn6,{},{state:{isGhost:!0}}),o=n.apply(Je.Volume.VolumeFromDsn6,{entryId:r?.entryId});return await n.commit({revertOnError:!0}),await W_(e,o.selector.data),{format:n.selector,volume:o.selector}},visuals:Dj},vet={label:"DX",description:"DX",category:eI,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:async(e,t,r)=>{let o=e.build().to(t).apply(Je.Data.ParseDx,{},{state:{isGhost:!0}}).apply(Je.Volume.VolumeFromDx,{entryId:r?.entryId});return await o.commit({revertOnError:!0}),await W_(e,o.selector.data),{volume:o.selector}},visuals:Dj},bet={label:"Cube",description:"Cube",category:eI,stringExtensions:["cub","cube"],parse:async(e,t,r)=>{let n=e.build().to(t).apply(Je.Data.ParseCube,{},{state:{isGhost:!0}}),o=n.apply(Je.Volume.VolumeFromCube,{entryId:r?.entryId}),i=n.apply(Je.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(Je.Model.ModelFromTrajectory).apply(Je.Model.StructureFromModel);return await n.commit({revertOnError:!0}),await W_(e,o.selector.data),{format:n.selector,volume:o.selector,structure:i.selector}},visuals:async(e,t)=>{var r,n;let o=e.build(),i=[],s=(n=(r=t.volume.cell)===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;if(s&&ot.isOrbitals(s)){let c=o.to(t.volume).apply(Je.Representation.VolumeRepresentation3D,Ul(e,s,{type:"isosurface",typeParams:{isoValue:ot.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:Gt.blue}})),u=o.to(t.volume).apply(Je.Representation.VolumeRepresentation3D,Ul(e,s,{type:"isosurface",typeParams:{isoValue:ot.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:Gt.red}}));i.push(c.selector,u.selector)}else{let c=o.to(t.volume).apply(Je.Representation.VolumeRepresentation3D,Ul(e,s,{type:"isosurface",typeParams:{isoValue:ot.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:Gt.grey}}));i.push(c.selector)}let a=await e.builders.structure.representation.applyPreset(t.structure,"auto");await o.commit();let l=[];return Ao(a?.representations,c=>{c&&l.push(c)}),[...i,...l]}},xet={label:"DensityServer CIF",description:"DensityServer CIF",category:eI,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>tS(e,t)==="dscif",parse:async(e,t,r)=>{var n;let o=await e.build().to(t).apply(Je.Data.ParseCif).commit(),i=e.build().to(o),s=o.obj.data.blocks;if(s.length===0)throw new Error("no data blocks");let a=[],l=0;for(let c of s){if(c.header.toUpperCase()==="SERVER")continue;let u=Array.isArray(r?.entryId)?r?.entryId[l]:r?.entryId;((n=c.categories.volume_data_3d_info)===null||n===void 0?void 0:n.rowCount)>0&&(a.push(i.apply(Je.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:u}).selector),l++)}await i.commit();for(let c of a)await W_(e,c.data);return{volumes:a}},visuals:async(e,t)=>{let{volumes:r}=t,n=e.build(),o=[];if(r.length>0){let i=r[0].data&&Mbe(r[0].data)||ot.IsoValue.relative(1.5);o[0]=n.to(r[0]).apply(Je.Representation.VolumeRepresentation3D,Rm.getDefaultParamsStatic(e,"isosurface",{isoValue:i,alpha:1},"uniform",{value:Gt.teal})).selector}if(r.length>1){let i=Rm.getDefaultParamsStatic(e,"isosurface",{isoValue:ot.IsoValue.relative(3),alpha:.3},"uniform",{value:Gt.green}),s=Rm.getDefaultParamsStatic(e,"isosurface",{isoValue:ot.IsoValue.relative(-3),alpha:.3},"uniform",{value:Gt.red});o[o.length]=n.to(r[1]).apply(Je.Representation.VolumeRepresentation3D,i).selector,o[o.length]=n.to(r[1]).apply(Je.Representation.VolumeRepresentation3D,s).selector}return await n.commit(),o}},Cet={label:"Segmentation CIF",description:"Segmentation CIF",category:eI,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>tS(e,t)==="segcif",parse:async(e,t)=>{var r;let n=await e.build().to(t).apply(Je.Data.ParseCif).commit(),o=e.build().to(n),i=n.obj.data.blocks;if(i.length===0)throw new Error("no data blocks");let s=[];for(let a of i)a.header.toUpperCase()!=="SERVER"&&((r=a.categories.volume_data_3d_info)===null||r===void 0?void 0:r.rowCount)>0&&s.push(o.apply(Je.Volume.VolumeFromSegmentationCif,{blockHeader:a.header}).selector);return await o.commit(),{volumes:s}},visuals:async(e,t)=>{let{volumes:r}=t,n=e.build(),o=[];return r.length>0&&ot.Segmentation.get(r[0].data)&&(o[o.length]=n.to(r[0]).apply(Je.Representation.VolumeRepresentation3D,Rm.getDefaultParams(e,"segment",r[0].data,{alpha:1,instanceGranularity:!0},"volume-segment",{})).selector),await n.commit(),o}},Rbe=[["ccp4",get],["dsn6",yet],["cube",bet],["dx",vet],["dscif",xet],["segcif",Cet]];var Iet="Shape",Aet={label:"PLY",description:"PLY",category:Iet,stringExtensions:["ply"],parse:async(e,t)=>{let r=e.state.data.build().to(t).apply(Je.Data.ParsePly,{},{state:{isGhost:!0}}),n=r.apply(Je.Model.ShapeFromPly);return await r.commit(),{format:r.selector,shape:n.selector}},visuals(e,t){return e.state.data.build().to(t.shape).apply(Je.Representation.ShapeRepresentation3D).commit()}},Bbe=[["ply",Aet]];var $B=class{get types(){return this._list.map(t=>[t.name,t.provider.label])}get extensions(){if(this._extensions)return this._extensions;let t=new Set;return this._list.forEach(({provider:r})=>{var n,o;(n=r.stringExtensions)===null||n===void 0||n.forEach(i=>t.add(i)),(o=r.binaryExtensions)===null||o===void 0||o.forEach(i=>t.add(i))}),this._extensions=t,t}get binaryExtensions(){if(this._binaryExtensions)return this._binaryExtensions;let t=new Set;return this._list.forEach(({provider:r})=>{var n;return(n=r.binaryExtensions)===null||n===void 0?void 0:n.forEach(o=>t.add(o))}),this._binaryExtensions=t,t}get options(){if(this._options)return this._options;let t=[];return this._list.forEach(({name:r,provider:n})=>t.push([r,n.label,n.category||""])),this._options=t,t}constructor(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(let[t,r]of Rbe)this.add(t,r);for(let[t,r]of zye)this.add(t,r);for(let[t,r]of Hye)this.add(t,r);for(let[t,r]of Bbe)this.add(t,r);for(let[t,r]of lk)this.add(t,r)}_clear(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0}add(t,r){this._clear(),this._list.push({name:t,provider:r}),this._map.set(t,r)}remove(t){this._clear(),this._list.splice(this._list.findIndex(r=>r.name===t),1),this._map.delete(t)}auto(t,r){var n,o;for(let i=0,s=this.list.length;i<s;++i){let a=this._list[i].provider,l=!1;if((!((n=a.binaryExtensions)===null||n===void 0)&&n.includes(t.ext)||!((o=a.stringExtensions)===null||o===void 0)&&o.includes(t.ext))&&(l=!0),l&&(!a.isApplicable||a.isApplicable(t,r.data)))return a}}get(t){if(this._map.has(t))return this._map.get(t);throw new Error(`unknown data format name '${t}'`)}get list(){return this._list}};var WB=class extends Na{get isEmpty(){return this._animations.length===0}get current(){return this._current}get animations(){return this._animations}triggerUpdate(){this.events.updated.next(void 0)}triggerApply(){this.events.applied.next(void 0)}getParams(){return this._params||(this._params={current:M.Select(this._animations[0]&&this._animations[0].name,this._animations.map(t=>[t.name,t.display.name]),{label:"Animation"})}),this._params}updateParams(t){if(this.isEmpty)return;this.updateState({params:{...this.state.params,...t}});let r=this.map.get(this.state.params.current),n=r.params(this.context);this._current={anim:r,params:n,paramValues:M.getDefaultValues(n),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}updateCurrentParams(t){this.isEmpty||(this._current.paramValues={...this._current.paramValues,...t},this.triggerUpdate())}register(t){if(this.map.has(t.name)){this.context.log.error(`Animation '${t.name}' is already registered.`);return}this._params=void 0,this.map.set(t.name,t),this._animations.push(t),this._animations.length===1?this.updateParams({current:t.name}):this.triggerUpdate()}async play(t,r){await this.stop(),this.map.has(t.name)||this.register(t),this.updateParams({current:t.name}),this.updateCurrentParams(r),await this.start()}async tick(t,r,n){this.currentTime=t,!this.isStopped&&(r||n?await this.applyFrame(n):this.applyAsync())}async start(){this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate();let t=this._current.anim,r=this._current.anim.initialState(this._current.paramValues,this.context);if(t.setup){let n=await t.setup(this._current.paramValues,r,this.context);n&&(r=n)}this._current.lastTime=0,this._current.startedTime=-1,this._current.state=r,this.isStopped=!1}async stop(){if(this.isStopped=!0,this.state.animationState!=="stopped"){let t=this._current.anim;t.teardown&&await t.teardown(this._current.paramValues,this._current.state,this.context),this.updateState({animationState:"stopped"}),this.triggerUpdate()}this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1)}get isAnimating(){return this.state.animationState==="playing"}async applyAsync(){if(!this.isApplying){this.isApplying=!0;try{await this.applyFrame()}finally{this.isApplying=!1}}}async applyFrame(t){let r=this.currentTime;this._current.startedTime<0&&(this._current.startedTime=r);let n=await this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:r-this._current.startedTime,animation:t},{params:this._current.paramValues,plugin:this.context});n.kind==="finished"?this.stop():n.kind==="next"&&(this._current.state=n.state,this._current.lastTime=r-this._current.startedTime),this.triggerApply()}getSnapshot(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}}setSnapshot(t){this.isEmpty||(this.updateState({animationState:t.state.animationState}),this.updateParams(t.state.params),t.current&&(this.current.paramValues=t.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(t.current.state):t.current.state,this.triggerUpdate(),this.state.animationState==="playing"&&this.resume()))}async resume(){this._current.lastTime=0,this._current.startedTime=-1;let t=this._current.anim;this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),t.setup&&await t.setup(this._current.paramValues,this._current.state,this.context),this.isStopped=!1}constructor(t){super({params:{current:""},animationState:"stopped"}),this.context=t,this.map=new Map,this._animations=[],this.currentTime=0,this._params=void 0,this.events={updated:this.ev(),applied:this.ev()},this.isStopped=!0,this.isApplying=!1}};function Lbe(e,t,r){let n=r[0],o=r[1],i=r[2],s=-n*t[0]-o*t[1]-i*t[2],a=e[0],l=e[1],c=e[2];return(n*a+o*l+i*c+s)/Math.sqrt(n*n+o*o+i*i)}function wet(e,t,r,n){let o=Lbe(e,t,n);return{aroundX:Lbe(e,t,r)<0,aroundY:o<0}}function Nbe(e,t,r){if(!e.canvas3d)return;let{origin:n,dirA:o,dirB:i,dirC:s}=r.principalAxes.boxAxes,a=D.clone(o),l=D.clone(s);if(r.positionToFlip){let{aroundX:u,aroundY:d}=wet(r.positionToFlip,n,a,i);u&&(D.negate(l,l),D.negate(a,a)),d&&D.negate(l,l)}let c=D.scale(D(),n,-100);return D.dot(c,a)<=0&&D.negate(l,l),D.dot(D.unitY,l)<=0&&D.negate(a,a),e.canvas3d.camera.getFocus(n,t,a,l,Eo.createDefaultSnapshot())}var _et=3,yh={identity:nr.create(1,0,0,0,1,0,0,0,1),rotX90:nr.create(1,0,0,0,0,1,0,-1,0),rotY90:nr.create(0,0,-1,0,1,0,1,0,0),rotZ90:nr.create(0,1,0,-1,0,0,0,0,1),rotX270:nr.create(1,0,0,0,0,-1,0,1,0),rotY270:nr.create(0,0,1,0,1,0,-1,0,0),rotZ270:nr.create(0,-1,0,1,0,0,0,0,1),rotX180:nr.create(1,0,0,0,-1,0,0,0,-1),rotY180:nr.create(-1,0,0,0,1,0,0,0,-1),rotZ180:nr.create(-1,0,0,0,-1,0,0,0,1)};function Fbe(e,t){let r=Eet(e,_et);return Tet(r,t)}function Tet(e,t){if(e.length===0)return{rotation:yh.identity,origin:D.zero()};let r=gl.calculateMomentsAxes(e),n=gl.calculateNormalizedAxes(r),o=Met(n.dirA,n.dirB,n.dirC);Ret(o);let i=t?Pet(o,t):Det(e,o,r.origin);return nr.mul(o,i,o),{rotation:o,origin:n.origin}}function Eet(e,t){let r;return r=kj(e,{onlyTrace:!0}),r.length>=3*t||(r=kj(e,{skipHydrogens:!0,skipWater:!0}),r.length>=3*t)||(r=kj(e,{})),r}function kj(e,t){let{onlyTrace:r,skipHydrogens:n,skipWater:o}=t,{x:i,y:s,z:a,type_symbol:l,label_comp_id:c}=nt.atom,u=[];for(let d of e){let m=ce.Location.create(d);for(let p of d.units){m.unit=p;let h=r?p.polymerElements:p.elements;for(let f=0;f<h.length;f++)m.element=h[f],!(n&&l(m)==="H")&&(o&&c(m)==="HOH"||u.push(i(m),s(m),a(m)))}}return u}function Pet(e,t){let r=yh.identity,n=0,o=nr();for(let i of[yh.identity,yh.rotX180,yh.rotY180,yh.rotZ180]){let s=nr.innerProduct(nr.mul(o,i,e),t);s>n&&(r=i,n=s)}return r}function Det(e,t,r){let n=D.create(nr.getValue(t,0,0),nr.getValue(t,0,1),nr.getValue(t,0,2)),o=D.create(nr.getValue(t,1,0),nr.getValue(t,1,1),nr.getValue(t,1,2)),i=D.create(nr.getValue(t,2,0),nr.getValue(t,2,1),nr.getValue(t,2,2)),s=Math.floor(e.length/3),a=D(),l=0,c=0,u=0;for(let p=0;p<s;p++)D.fromArray(a,e,3*p),D.sub(a,a,r),l+=p*D.dot(a,n),c+=p*D.dot(a,o),u+=ket(p,s)*D.dot(a,i);let d=u<0,m=d?l+c<0:l-c<0;return m&&d?yh.rotY180:d?yh.rotX180:m?yh.rotZ180:yh.identity}function ket(e,t){let r=Math.floor(t/2);return e<r?t%2?r-e:r-e-1:e-r}function Met(e,t,r){let n=nr();return nr.setValue(n,0,0,e[0]),nr.setValue(n,0,1,e[1]),nr.setValue(n,0,2,e[2]),nr.setValue(n,1,0,t[0]),nr.setValue(n,1,1,t[1]),nr.setValue(n,1,2,t[2]),nr.setValue(n,2,0,r[0]),nr.setValue(n,2,1,r[1]),nr.setValue(n,2,2,r[2]),n}function Ret(e){nr.determinant(e)<0&&(nr.setValue(e,2,0,-nr.getValue(e,2,0)),nr.setValue(e,2,1,-nr.getValue(e,2,1)),nr.setValue(e,2,2,-nr.getValue(e,2,2)))}function Mj(e,t){let r=nr.invert(nr(),t),n=D.distance(e.position,e.target),o=D.transformMat3(D(),D.create(0,0,n),r),i=D.transformMat3(D(),D.create(0,1,0),r),s=D.add(D(),e.target,o);return{...e,position:s,up:i}}var Bet={minRadius:5,extraRadius:4,durationMs:250},qB=class{transformedLoci(t){var r,n;if(ce.Loci.is(t)){let o=(n=(r=this.plugin.helpers.substructureParent.get(t.structure))===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;o&&(t=ce.Loci.remap(t,o))}return t}focusRenderObjects(t,r){if(!t)return;let n=[];for(let o of t){let i=o.values.boundingSphere.ref.value;i.radius!==0&&n.push(i)}this.focusSpheres(n,o=>o,r)}focusLoci(t,r){let n;if(Array.isArray(t)&&t.length>1){let o=[];for(let i of t){let s=Xt.getBoundingSphere(this.transformedLoci(i));s&&o.push(s)}if(o.length===0)return;this.boundaryHelper.reset();for(let i of o)this.boundaryHelper.includeSphere(i);this.boundaryHelper.finishedIncludeStep();for(let i of o)this.boundaryHelper.radiusSphere(i);n=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(t.length===0)return;n=Xt.getBoundingSphere(this.transformedLoci(t[0]))}else n=Xt.getBoundingSphere(this.transformedLoci(t));n&&this.focusSphere(n,r)}focusSpheres(t,r,n){let o=[];for(let i of t){let s=r(i);s&&o.push(s)}if(o.length!==0){if(o.length===1)return this.focusSphere(o[0],n);this.boundaryHelper.reset();for(let i of o)this.boundaryHelper.includeSphere(i);this.boundaryHelper.finishedIncludeStep();for(let i of o)this.boundaryHelper.radiusSphere(i);this.focusSphere(this.boundaryHelper.getSphere(),n)}}focusSphere(t,r){var n;let{canvas3d:o}=this.plugin;if(!o)return;let{extraRadius:i,minRadius:s,durationMs:a}={...Bet,...r},l=Math.max(t.radius+i,s);if(r?.principalAxes){let c=Nbe(this.plugin,l,r);(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({durationMs:a,snapshot:c})}else{let c=o.camera.getFocus(t.center,l);o.requestCameraReset({durationMs:a,snapshot:c})}}orientAxes(t,r){if(!this.plugin.canvas3d)return;t||(t=this.plugin.state.data.selectQ(a=>a.ofType(fe.Molecule.Structure)).filter(a=>a.obj&&!a.transform.transformer.definition.isDecorator&&!a.obj.data.parent).map(a=>{var l;return(l=a.obj)===null||l===void 0?void 0:l.data}).filter(a=>!!a));let{rotation:n}=Fbe(t),o=Mj(this.plugin.canvas3d.camera.getSnapshot(),n);this.setSnapshot(o,r)}resetAxes(t){if(!this.plugin.canvas3d)return;let r=Mj(this.plugin.canvas3d.camera.getSnapshot(),nr.Identity);this.setSnapshot(r,t)}setSnapshot(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})}reset(t,r){var n;(n=this.plugin.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t,durationMs:r})}constructor(t){this.plugin=t,this.boundaryHelper=new is("98")}};var ZB=class{clearProviders(){this.providers=[],this.isDirty=!0,this.showLabels()}addProvider(t){this.providers.push(t),this.providers.sort((r,n)=>(n.priority||0)-(r.priority||0)),this.isDirty=!0,this.showLabels()}removeProvider(t){this.providers=this.providers.filter(r=>r!==t),this.isDirty=!0,this.showLabels()}mark(t,r){let n=this.locis.findIndex(o=>Wt.Loci.areEqual(t,o));n===-1&&r===zt.Highlight?(this.locis.push(t),this.isDirty=!0):n!==-1&&r===zt.RemoveHighlight&&(R0(this.locis,n),this.isDirty=!0)}showLabels(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})}getLabels(){if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(let t of this.providers)for(let r of this.locis){if(Xt.isEmpty(r.loci))continue;let n=t.label(r.loci,r.repr);if(n){let o=t.group?t.group(n):n.toString(),i=this.groupedLabels.get(o);i?i.push(n):this.groupedLabels.set(o,[n])}}this.labels.length=0,this.groupedLabels.forEach((t,r)=>{let n=t.length,o=n>1&&t[0]!==t[1]?r:t[0];this.labels.push(n===1?o:`${o} <small>|| \xD7 ${n}</small>`)}),this.isDirty=!1}return this.labels}constructor(t){this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider((r,n,o)=>{this.providers.length!==0&&(this.mark(r,n),o||this.showLabels())})}};var Let=8,KB=class extends Na{get current(){return this.state.current}get history(){return this.state.history}tryAddHistory(t){if(ce.Loci.isEmpty(t.loci))return;let r=0,n;for(let o of this.state.history){if(ce.Loci.areEqual(o.loci,t.loci)){n=o;break}r++}if(n){R0(this.state.history,r),this.state.history.unshift(t),this.events.historyUpdated.next(void 0);return}this.state.history.unshift(t),this.state.history.length>Let&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}set(t){this.tryAddHistory(t),(!this.state.current||!ce.Loci.areEqual(this.state.current.loci,t.loci))&&(this.state.current=t,this.behaviors.current.next(t))}setFromLoci(t){let r=Xt.normalize(t);if(!ce.Loci.is(r)||ce.Loci.isEmpty(r)){this.clear();return}this.set({loci:r,label:Mm(r,{reverse:!0,hidePrefix:!0,htmlStyling:!1})})}addFromLoci(t){let r=this.state.current&&ce.Loci.is(t)&&t.structure===this.state.current.loci.structure?ce.Loci.union(t,this.state.current.loci):t;this.setFromLoci(r)}clear(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))}getSnapshot(){if(!this.current)return{};let t=this.plugin.helpers.substructureParent.get(this.current.loci.structure),r=t?.transform.ref;return r?{current:{label:this.current.label,ref:r,bundle:ce.Bundle.fromLoci(this.current.loci),category:this.current.category}}:{}}setSnapshot(t){var r,n;if(!t.current){this.clear();return}let{label:o,ref:i,bundle:s,category:a}=t.current,l=(n=(r=this.plugin.state.data.select(Kt.Generators.byRef(i))[0])===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;if(!l)return;let c=ce.Bundle.toLoci(s,l);this.set({label:o,loci:c,category:a})}constructor(t){super({history:[]}),this.plugin=t,this.events={historyUpdated:this.ev()},this.behaviors={current:this.ev.behavior(void 0)},t.state.data.events.object.removed.subscribe(({obj:n})=>{var o;if(!fe.Molecule.Structure.is(n))return;((o=this.current)===null||o===void 0?void 0:o.loci.structure)===n.data&&this.clear();let i=[];for(let s of this.history)s.loci.structure===n.data&&i.push(s);i.length!==this.history.length&&(this.history.length=0,this.history.push(...i),this.events.historyUpdated.next(void 0))});let r=Pe();t.state.data.events.object.updated.subscribe(({oldData:n,obj:o,action:i})=>{var s;if(fe.Molecule.Structure.is(o)&&n!==o.data&&i==="in-place"){let a=this.state.current,l=o.data;if(a&&a.loci.structure===n){let c=ce.Loci.remap(a.loci,l);this.state.current={...a,loci:c},this.behaviors.current.next(this.state.current),Xt.getBoundingSphere(c,r);let u=(s=this.plugin.canvas3d)===null||s===void 0?void 0:s.camera,d=u.getTargetDistance(r.radius+4);(D.distance(u.target,r.center)>r.radius||d>u.viewport.height/u.zoom)&&this.plugin.managers.camera.focusSphere(r,{durationMs:0})}}})}};var q_=new is("98"),Net=24,XB=class extends Na{get entries(){return this.state.entries}get additionsHistory(){return this.state.additionsHistory}get stats(){return this.state.stats?this.state.stats:(this.state.stats=this.calcStats(),this.state.stats)}getEntry(t){let r=this.plugin.helpers.substructureParent.get(t,!0);if(!r)return;let n=r.transform.ref;if(!this.entries.has(n)){let o=new Z_(ce.Loci(t,[]));return this.entries.set(n,o),o}return this.entries.get(n)}calcStats(){let t=0,r=0,n=ce.Stats.create();this.entries.forEach(i=>{let{elements:s}=i.selection;if(s.length){t+=1;for(let a=0,l=s.length;a<l;++a)r+=Ge.size(s[a].indices);ce.Stats.add(n,n,ce.Stats.ofLoci(i.selection))}});let o=Zb(n,{countsOnly:!0});return{structureCount:t,elementCount:r,label:o}}add(t){if(!ce.Loci.is(t))return!1;let r=this.getEntry(t.structure);if(!r)return!1;let n=r.selection;return r.selection=ce.Loci.union(r.selection,t),this.tryAddHistory(t),this.referenceLoci=t,this.events.loci.add.next(t),!ce.Loci.areEqual(n,r.selection)}remove(t){if(!ce.Loci.is(t))return!1;let r=this.getEntry(t.structure);if(!r)return!1;let n=r.selection;return r.selection=ce.Loci.subtract(r.selection,t),this.referenceLoci=t,this.events.loci.remove.next(t),!ce.Loci.areEqual(n,r.selection)}intersect(t){if(!ce.Loci.is(t))return!1;let r=this.getEntry(t.structure);if(!r)return!1;let n=r.selection;return r.selection=ce.Loci.intersect(r.selection,t),this.referenceLoci=t,!ce.Loci.areEqual(n,r.selection)}set(t){if(!ce.Loci.is(t))return!1;let r=this.getEntry(t.structure);if(!r)return!1;let n=r.selection;return r.selection=t,this.tryAddHistory(t),this.referenceLoci=void 0,!ce.Loci.areEqual(n,r.selection)}modifyHistory(t,r,n,o=!1){let i=this.additionsHistory,s=i.indexOf(t);if(s<0)return;let a;switch(r){case"remove":R0(i,s);break;case"up":a=s-1;break;case"down":a=s+1;break}if(a!==void 0){let l=n?Math.min(i.length,n):i.length;for(;;)if(a=a%l,a<0&&(a+=l),!o||i[s].loci.structure===i[a].loci.structure){let c=i[s];i[s]=i[a],i[a]=c;break}else a+=r==="up"?-1:1}this.events.additionsHistoryUpdated.next(void 0)}tryAddHistory(t){if(Xt.isEmpty(t))return;let r=0,n;for(let s of this.additionsHistory){if(Xt.areEqual(s.loci,t)){n=s;break}r++}if(n){R0(this.additionsHistory,r),this.additionsHistory.unshift(n),this.events.additionsHistoryUpdated.next(void 0);return}let o=ce.Stats.ofLoci(t),i=Zb(o,{reverse:!0});this.additionsHistory.unshift({id:jr.create22(),loci:t,label:i}),this.additionsHistory.length>Net&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}clearHistory(){this.state.additionsHistory.length!==0&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))}clearHistoryForStructure(t){let r=[];for(let n of this.state.additionsHistory)n.loci.structure.root===t.root&&r.push(n);for(let n of r)this.modifyHistory(n,"remove");r.length!==0&&this.events.additionsHistoryUpdated.next(void 0)}onRemove(t,r){var n;this.entries.has(t)&&(this.entries.delete(t),r?.data&&this.clearHistoryForStructure(r.data),((n=this.referenceLoci)===null||n===void 0?void 0:n.structure)===r?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))}onUpdate(t,r,n){var o,i,s,a;if(r===n||r?.data===n.data)return;let l=this.plugin.helpers.substructureParent.get(n.data,!0);if(!l||t!==l.transform.ref||!this.entries.has(t))return;let c=(i=(o=this.plugin.helpers.substructureParent.get(n.data))===null||o===void 0?void 0:o.obj)===null||i===void 0?void 0:i.data;if(c)if(!r?.data||qe.areUnitIdsAndIndicesEqual(r.data,n.data)){this.entries.set(t,Oet(this.entries.get(t),c)),((s=this.referenceLoci)===null||s===void 0?void 0:s.structure.root)===c.root&&(this.referenceLoci=ce.Loci.remap(this.referenceLoci,c));let u=!1;for(let d of this.state.additionsHistory)d.loci.structure.root===c.root&&(d.loci=ce.Loci.remap(d.loci,c),u=!0);u&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(t,new Z_(ce.Loci(c,[]))),((a=this.referenceLoci)===null||a===void 0?void 0:a.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next(void 0)}clear(){let t=this.entries.keys(),r=[];for(;;){let n=t.next();if(n.done)break;let o=this.entries.get(n.value);ce.Loci.isEmpty(o.selection)||r.push(o.selection),o.selection=ce.Loci(o.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),r}getLoci(t){let r=this.getEntry(t);return r?r.selection:pr}getStructure(t){let r=this.getEntry(t);if(r)return r.structure}structureHasSelection(t){var r,n;let o=(n=(r=t.cell)===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;if(!o)return!1;let i=this.getEntry(o);return!!i&&!ce.Loci.isEmpty(i.selection)}has(t){if(ce.Loci.is(t)){let r=this.getEntry(t.structure);if(r)return ce.Loci.isSubset(r.selection,t)}return!1}tryGetRange(t){if(!ce.Loci.is(t)||t.elements.length!==1||!this.getEntry(t.structure))return;let n=t.elements[0];if(!n)return;let o=this.referenceLoci;if(!o||!ce.Loci.is(o)||o.structure!==t.structure)return;let i;for(let s of o.elements)if(n.unit===s.unit){i=s;break}if(i&&n.unit===i.unit)return Vet(t.structure,i,n)}elementCount(){let t=0;return this.entries.forEach(r=>{t+=ce.Loci.size(r.selection)}),t}getBoundary(){let t=D.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=D.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);q_.reset();let n=[];this.entries.forEach(o=>{let i=o.selection;ce.Loci.isEmpty(i)||n.push(ce.Loci.getBoundary(i))});for(let o=0,i=n.length;o<i;++o){let{box:s,sphere:a}=n[o];D.min(t,t,s.min),D.max(r,r,s.max),q_.includePositionRadius(a.center,a.radius)}q_.finishedIncludeStep();for(let o=0,i=n.length;o<i;++o){let{sphere:s}=n[o];q_.radiusPositionRadius(s.center,s.radius)}return{box:{min:t,max:r},sphere:q_.getSphere()}}getPrincipalAxes(){let t=wx(this.entries.values());return ce.Loci.getPrincipalAxesMany(t.map(r=>r.selection))}modify(t,r){let n=!1;switch(t){case"add":n=this.add(r);break;case"remove":n=this.remove(r);break;case"intersect":n=this.intersect(r);break;case"set":n=this.set(r);break}n&&(this.state.stats=void 0,this.events.changed.next(void 0))}get applicableStructures(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(t=>!!t.cell.obj).map(t=>t.cell.obj.data)}triggerInteraction(t,r,n=!0){switch(t){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:r},n);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:r},n);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:r},n);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:r},n);break}}fromLoci(t,r,n=!0){this.triggerInteraction(t,r,n)}fromCompiledQuery(t,r,n=!0){for(let o of this.applicableStructures){let i=r(new ls(o));this.triggerInteraction(t,wt.toLociWithSourceUnits(i),n)}}fromSelectionQuery(t,r,n=!0){this.plugin.runTask(ke.create("Structure Selection",async o=>{for(let i of this.applicableStructures){let s=await r.getSelection(this.plugin,o,i);this.triggerInteraction(t,wt.toLociWithSourceUnits(s),n)}}))}fromSelections(t){var r;let n=Jn.resolveAndCheck(this.plugin.state.data,t);if(!(!n||!n.obj)&&fe.Molecule.Structure.Selections.is(n.obj)){this.clear();for(let o of(r=n.obj)===null||r===void 0?void 0:r.data)this.fromLoci("set",o.loci)}}getSnapshot(){let t=[];return this.entries.forEach((r,n)=>{t.push({ref:n,bundle:ce.Bundle.fromLoci(r.selection)})}),{entries:t}}setSnapshot(t){var r,n;this.entries.clear();for(let{ref:o,bundle:i}of t.entries){let s=(n=(r=this.plugin.state.data.select(Kt.Generators.byRef(o))[0])===null||r===void 0?void 0:r.obj)===null||n===void 0?void 0:n.data;if(!s)continue;let a=ce.Bundle.toLoci(i,s);this.fromLoci("set",a,!1)}}constructor(t){super({entries:new Map,additionsHistory:[],stats:Fet()}),this.plugin=t,this.events={changed:this.ev(),additionsHistoryUpdated:this.ev(),loci:{add:this.ev(),remove:this.ev(),clear:this.ev()}},t.helpers.substructureParent.events.removed.subscribe(r=>this.onRemove(r.ref,r.obj)),t.helpers.substructureParent.events.updated.subscribe(r=>this.onUpdate(r.ref,r.oldObj,r.obj))}};function Fet(){return{structureCount:0,elementCount:0,label:"Nothing Selected"}}var Z_=class{get selection(){return this._selection}set selection(t){this._selection=t,this._structure=void 0}get structure(){return this._structure?this._structure:(Xt.isEmpty(this._selection)?this._structure=void 0:this._structure=ce.Loci.toStructure(this._selection),this._structure)}constructor(t){this._structure=void 0,this._selection=t}};function Oet(e,t){return new Z_(ce.Loci.remap(e.selection,t))}function Vet(e,t,r){let n=Math.min(Ge.min(t.indices),Ge.min(r.indices)),o=Math.max(Ge.max(t.indices),Ge.max(r.indices));return ce.Loci(e,[{unit:t.unit,indices:Ge.ofRange(n,o)}])}var Get=[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]],Rj=[["full","Full"],["hidden","Hidden"]],Uet={isExpanded:M.Boolean(!1),showControls:M.Boolean(!0),regionState:M.Group({left:M.Select("full",Get),top:M.Select("full",Rj),right:M.Select("full",Rj),bottom:M.Select("full",Rj)}),controlsDisplay:M.Value("outside",{isHidden:!0})},YB=class extends Na{updateProps(t){let r=!!this.state.isExpanded;this.updateState(t),this.root&&typeof t.isExpanded=="boolean"&&t.isExpanded!==r&&this.handleExpand(),this.events.updated.next(void 0)}setProps(t){this.updateState(t)}setRoot(t){this.root=t,this.state.isExpanded&&this.handleExpand()}getScrollElement(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body}handleExpand(){try{let t=document.getElementsByTagName("body")[0],r=document.getElementsByTagName("head")[0];if(!t||!r||!this.root)return;if(this.state.isExpanded){let n=r.children,o=[],i=!1;for(let u=0;u<n.length;u++)n[u]===this.expandedViewport?i=!0:(n[u].name||"").toLowerCase()==="viewport"&&o.push(n[u]);for(let u of o)r.removeChild(u);i||r.appendChild(this.expandedViewport);let s=t.style,a=this.getScrollElement(),l=a.scrollLeft,c=a.scrollTop;this.rootState={top:s.top,bottom:s.bottom,right:s.right,left:s.left,scrollTop:c,scrollLeft:l,position:s.position,overflow:s.overflow,viewports:o,zIndex:this.root.style.zIndex,width:s.width,height:s.height,maxWidth:s.maxWidth,maxHeight:s.maxHeight,margin:s.margin,marginLeft:s.marginLeft,marginRight:s.marginRight,marginTop:s.marginTop,marginBottom:s.marginBottom},s.overflow="hidden",s.position="fixed",s.top="0",s.bottom="0",s.right="0",s.left="0",s.width="100%",s.height="100%",s.maxWidth="100%",s.maxHeight="100%",s.margin="0",s.marginLeft="0",s.marginRight="0",s.marginTop="0",s.marginBottom="0"}else{let n=r.children;for(let o=0;o<n.length;o++)if(n[o]===this.expandedViewport){r.removeChild(this.expandedViewport);break}if(this.rootState){let o=this.rootState;for(let a of o.viewports)r.appendChild(a);let i=t.style;i.top=o.top,i.bottom=o.bottom,i.left=o.left,i.right=o.right,i.width=o.width,i.height=o.height,i.maxWidth=o.maxWidth,i.maxHeight=o.maxHeight,i.margin=o.margin,i.marginLeft=o.marginLeft,i.marginRight=o.marginRight,i.marginTop=o.marginTop,i.marginBottom=o.marginBottom,i.position=o.position,i.overflow=o.overflow||"";let s=this.getScrollElement();s.scrollTop=o.scrollTop,s.scrollLeft=o.scrollLeft,this.rootState=void 0,this.root.style.zIndex=o.zIndex}}}catch{this.context.log.error("Layout change error, you might have to reload the page.")}}constructor(t){super({...M.getDefaultValues(Uet),...t.spec.layout&&t.spec.layout.initial}),this.context=t,this.events={updated:this.ev()},this.rootState=void 0,ht.Layout.Update.subscribe(t,r=>this.updateProps(r.state)),typeof document<"u"&&(this.expandedViewport=document.createElement("meta"),this.expandedViewport.name="viewport",this.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}};var Lj={includeTypes:M.MultiSelect(Hh(Br.Names),M.objectToOptions(Br.Names)),excludeTypes:M.MultiSelect([],M.objectToOptions(Br.Names)),ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),aromaticBonds:M.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:M.Select("symmetric",M.arrayToOptions(["off","symmetric","offset"]))},E6r=M.getDefaultValues(Lj),K_={...Ld,...Lj,adjustCylinderLength:M.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})},P6r=M.getDefaultValues(K_),X_={...nz,...Lj},D6r=M.getDefaultValues(X_);function tI(e,t,r){return!Br.is(e,r)||Br.is(t,r)}function QB(e,t,r){let n=t.elements,o=t.bonds,{a:i,b:s,edgeProps:a}=o,{flags:l}=a,{ignoreHydrogens:c,ignoreHydrogensVariant:u,includeTypes:d,excludeTypes:m}=r,p=Br.fromNames(d),h=Br.fromNames(m),f=Br.isAll(p)&&h===0,{child:C}=e,g=C?.unitMap.get(t.id);if(C&&!g)throw new Error("expected childUnit to exist if child exists");if(!(f&&!c&&!C))return b=>{let y=i[b],x=s[b];return g&&!Qe.has(g.elements,n[y])||!f&&tI(p,h,l[b])?!0:c?!!(uu(e,t,n[y],u)||uu(e,t,n[x],u)):!1}}function JB(e,t){let r=e.interUnitBonds,{edges:n}=r,{ignoreHydrogens:o,ignoreHydrogensVariant:i,includeTypes:s,excludeTypes:a}=t,l=Br.fromNames(s),c=Br.fromNames(a),u=Br.isAll(l)&&c===0,{child:d}=e;if(!(u&&!o&&!d))return m=>{if(d){let p=n[m],h=d.unitMap.get(p.unitA);if(!h)return!0;let C=e.unitMap.get(p.unitA).elements[p.indexA];if(!Qe.has(h.elements,C))return!0}if(o){let p=n[m],h=e.unitMap.get(p.unitA),f=e.unitMap.get(p.unitB);if(uu(e,h,h.elements[p.indexA],i)||uu(e,f,f.elements[p.indexB],i))return!0}return!!(!u&&tI(l,c,n[m].props.flag))}}var Wm;(function(e){function t(n,o){let{group:i,structure:s}=n,a=i.units[0],l=Le.isAtomic(a)?a.bonds.edgeCount*2:0,c=i.units.length,u=_t.Location(s,void 0,void 0,s,void 0,void 0),d=(m,p)=>{let h=i.units[p];return u.aUnit=h,u.bUnit=h,u.aIndex=h.bonds.a[m],u.bIndex=h.bonds.b[m],u};if(o?.includeLocation2){let m=_t.Location(s,void 0,void 0,s,void 0,void 0);return Mr(l,c,1,d,!1,()=>!1,(h,f)=>{let C=i.units[f];return m.aUnit=C,m.bUnit=C,m.aIndex=C.bonds.b[h],m.bIndex=C.bonds.a[h],m})}return Mr(l,c,1,d)}e.fromGroup=t;function r(n,o){let i=n.interUnitBonds.edgeCount,s=1,a=_t.Location(n,void 0,void 0,n,void 0,void 0),l=c=>{let u=n.interUnitBonds.edges[c];return a.aUnit=n.unitMap.get(u.unitA),a.aIndex=u.indexA,a.bUnit=n.unitMap.get(u.unitB),a.bIndex=u.indexB,a};if(o?.includeLocation2){let c=_t.Location(n,void 0,void 0,n,void 0,void 0);return Mr(i,s,1,l,!0,()=>!1,d=>{let m=n.interUnitBonds.edges[d];return c.aUnit=n.unitMap.get(m.unitB),c.aIndex=m.indexB,c.bUnit=n.unitMap.get(m.unitA),c.bIndex=m.indexA,c})}return Mr(i,s,1,l,!0)}e.fromStructure=r})(Wm||(Wm={}));function Y_(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:s,group:a}=t,l=a.units[o];if(Le.isAtomic(l)){let{target:c}=s,u=l.bonds.a[i],d=l.bonds.b[i];return _t.Loci(c,[_t.Location(c,l,u,c,l,d),_t.Location(c,l,d,c,l,u)])}}return pr}function Q_(e,t,r,n){let o=!1;if(_t.isLoci(e)){let{structure:i,group:s}=t;if(!qe.areEquivalent(e.structure,i))return!1;let a=s.units[0];if(!Le.isAtomic(a))return!1;let l=a.bonds.edgeCount*2;for(let c of e.bonds){if(c.aUnit!==c.bUnit)continue;let u=s.unitIndexMap.get(c.aUnit.id);if(u!==void 0){let d=a.bonds.getDirectedEdgeIndex(c.aIndex,c.bIndex);d!==-1&&r(Be.ofSingleton(u*l+d))&&(o=!0)}}}else if(ce.Loci.is(e)){let{structure:i,group:s}=t;if(!qe.areEquivalent(e.structure,i))return!1;let a=s.units[0];if(!Le.isAtomic(a))return!1;let l=a.bonds.edgeCount*2;for(let c of e.elements){let u=s.unitIndexMap.get(c.unit.id);if(u!==void 0){let{offset:d,b:m}=a.bonds;Ge.forEach(c.indices,p=>{for(let h=d[p],f=d[p+1];h<f;h++)(!n||Ge.has(c.indices,m[h]))&&r(Be.ofSingleton(u*l+h))&&(o=!0)})}}}return o}function J_(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{target:i}=t,s=t.interUnitBonds.edges[o],a=t.unitMap.get(s.unitA),l=t.unitMap.get(s.unitB);return _t.Loci(i,[_t.Location(i,a,s.indexA,i,l,s.indexB),_t.Location(i,l,s.indexB,i,a,s.indexA)])}return pr}var Bj=new Map;function eT(e,t,r,n){let o=!1;if(_t.isLoci(e)){if(!qe.areEquivalent(e.structure,t))return!1;for(let i of e.bonds){let s=t.interUnitBonds.getBondIndexFromLocation(i);s!==-1&&r(Be.ofSingleton(s))&&(o=!0)}}else if(ce.Loci.is(e)){if(!qe.areEquivalent(e.structure,t)||n&&e.elements.length===1)return!1;for(let i of e.elements)Bj.set(i.unit.id,i.indices);for(let i of e.elements){let{unit:s}=i;Le.isAtomic(s)&&t.interUnitBonds.getConnectedUnits(s.id).forEach(a=>{let l=Bj.get(a.unitB);(!n||l)&&Ge.forEach(i.indices,c=>{a.connectedIndices.includes(c)&&a.getEdges(c).forEach(u=>{if(!n||l&&Ge.has(l,u.indexB)){let d=t.interUnitBonds.getEdgeIndex(c,s.id,u.indexB,a.unitB);r(Be.ofSingleton(d))&&(o=!0)}})})})}Bj.clear()}return o}var Nj=Br.is;function Obe(e,t,r,n){let o=e.elements,i=e.bonds,{edgeCount:s,a,b:l,edgeProps:c,offset:u}=i,{order:d,flags:m}=c,{sizeFactor:p,sizeAspectRatio:h,adjustCylinderLength:f,aromaticBonds:C,includeTypes:g,excludeTypes:b,multipleBonds:y}=n,x=y==="off",A=y==="symmetric",v=Br.fromNames(g),_=Br.fromNames(b),I=tI(v,_,32),T=D(),E=D(),w=e.conformation,S,P=ce.Location.create(t,e),k=_t.Location(t,e,void 0,t,e,void 0),{child:L}=t;if(n.includeParent&&L){let Q=L.unitMap.get(e.id);if(!Q)throw new Error("expected childUnit to exist");S=O=>{let B=o[a[O]],j=o[l[O]];return Qe.has(Q.elements,B)&&!Qe.has(Q.elements,j)}}let R=Q=>(k.aIndex=a[Q],k.bIndex=l[Q],r.size.size(k)*p),N=Q=>(P.element=o[a[Q]],r.size.size(P)*p),F=Q=>(P.element=o[l[Q]],r.size.size(P)*p),{elementRingIndices:H,elementAromaticRingIndices:V}=e.rings,q=C?e.resonance.delocalizedTriplets:void 0;return{linkCount:s*2,referencePosition:Q=>{let O=a[Q],B=l[Q],j=q?.getThirdElement(O,B);if(j!==void 0)return w.invariantPosition(o[j],T);O>B&&([O,B]=[B,O]),u[O+1]-u[O]===1&&([O,B]=[B,O]);let U=V.get(O)||H.get(O),z=0;for(let $=u[O],Z=u[O+1];$<Z;++$){let J=l[$];if(J!==B&&J!==O)if(U){let ie=V.get(J)||H.get(J);if(!ie)continue;let ne=Kx(U,ie);ne>z&&(z=ne,w.invariantPosition(o[J],T))}else return w.invariantPosition(o[J],T)}return z>0?T:null},position:(Q,O,B)=>{if(w.invariantPosition(o[a[B]],Q),w.invariantPosition(o[l[B]],O),f){let j=N(B),U=F(B),z=Math.min(j,U)*h,$=Math.sqrt(Math.max(0,j*j-z*z))-.05,Z=Math.sqrt(Math.max(0,U*U-z*z))-.05;if($<=.01&&Z<=.01)return;D.normalize(E,D.sub(E,O,Q)),D.scaleAndAdd(Q,Q,E,$),D.scaleAndAdd(O,O,E,-Z)}},style:Q=>{let O=d[Q],B=m[Q];if(Nj(B,2)||Nj(B,4))return 1;if(O===3)return x?0:A?4:5;if(C){let j=a[Q],U=l[Q],z=V.get(j),$=V.get(U),Z=z&&$?Kx(z,$):0;if(Nj(B,16)||Z&&!I)return Z===2?8:7}return O!==2||x?0:A?2:3},radius:Q=>R(Q)*h,ignore:QB(t,e,n),stub:S}}function zet(e,t,r,n,o,i){if(!Le.isAtomic(t))return ss.createEmpty(i);if(!t.bonds.edgeCount)return ss.createEmpty(i);let{child:s}=r,a=s?.unitMap.get(t.id);if(s&&!a)return ss.createEmpty(i);let l=Obe(t,r,n,o),{cylinders:c,boundingSphere:u}=gM(e,l,o,i);if(u)c.setBoundingSphere(u);else if(c.cylinderCount>0){let d=Pe.expand(Pe(),(a??t).boundary.sphere,1*o.sizeFactor);c.setBoundingSphere(d)}return c}function Het(e,t,r,n,o,i){if(!Le.isAtomic(t))return Ct.createEmpty(i);if(!t.bonds.edgeCount)return Ct.createEmpty(i);let{child:s}=r,a=s?.unitMap.get(t.id);if(s&&!a)return Ct.createEmpty(i);let l=Obe(t,r,n,o),{mesh:c,boundingSphere:u}=ed(e,l,o,i);if(u)c.setBoundingSphere(u);else if(c.triangleCount>0){let d=Pe.expand(Pe(),(a??t).boundary.sphere,1*o.sizeFactor);c.setBoundingSphere(d)}return c}var rI={...Xn,...yS,...K_,sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:M.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:M.Boolean(!0),includeParent:M.Boolean(!1)};function eL(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?jet(e):$et(e)}function jet(e){return vS({defaultProps:M.getDefaultValues(rI),createGeometry:zet,createLocationIterator:(t,r)=>Wm.fromGroup(t,{includeLocation2:r.colorMode==="interpolate"}),getLoci:Y_,eachLocation:Q_,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!da(r.includeTypes,n.includeTypes)||!da(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds,r.colorMode!==n.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0);let l=s.group.units[0],c=a.group.units[0];Le.isAtomic(l)&&Le.isAtomic(c)&&(Fs.areEqual(l.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function $et(e){return xo({defaultProps:M.getDefaultValues(rI),createGeometry:Het,createLocationIterator:t=>Wm.fromGroup(t),getLoci:Y_,eachLocation:Q_,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!da(r.includeTypes,n.includeTypes)||!da(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;let l=s.group.units[0],c=a.group.units[0];Le.isAtomic(l)&&Le.isAtomic(c)&&(Fs.areEqual(l.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var Fj=new _t.ElementBondIterator;function Vbe(e,t,r,n){for(Fj.setElement(t,r,n);Fj.hasNext;){let o=Fj.move();return o.otherUnit.conformation.position(o.otherUnit.elements[o.otherIndex],e),e}return null}var Gbe=D();function Ube(e,t,r){let n=ce.Location.create(e),o=_t.Location(e,void 0,void 0,e,void 0,void 0),i=e.interUnitBonds,{edgeCount:s,edges:a}=i,{sizeFactor:l,sizeAspectRatio:c,adjustCylinderLength:u,aromaticBonds:d,multipleBonds:m}=r,p=m==="off",h=m==="symmetric",f=D(),C,{child:g}=e;r.includeParent&&g&&(C=A=>{let v=a[A],_=g.unitMap.get(v.unitA),I=g.unitMap.get(v.unitB),E=e.unitMap.get(v.unitA).elements[v.indexA],S=e.unitMap.get(v.unitB).elements[v.indexB];return _&&Qe.has(_.elements,E)&&(!I||!Qe.has(I.elements,S))});let b=A=>{let v=a[A];return o.aUnit=e.unitMap.get(v.unitA),o.aIndex=v.indexA,o.bUnit=e.unitMap.get(v.unitB),o.bIndex=v.indexB,t.size.size(o)*l},y=A=>{let v=a[A];return n.unit=e.unitMap.get(v.unitA),n.element=n.unit.elements[v.indexA],t.size.size(n)*l},x=A=>{let v=a[A];return n.unit=e.unitMap.get(v.unitB),n.element=n.unit.elements[v.indexB],t.size.size(n)*l};return{linkCount:s,referencePosition:A=>{let v=a[A],_,I,T,E;if(v.unitA<v.unitB)_=e.unitMap.get(v.unitA),I=e.unitMap.get(v.unitB),T=v.indexA,E=v.indexB;else if(v.unitA>v.unitB)_=e.unitMap.get(v.unitB),I=e.unitMap.get(v.unitA),T=v.indexB,E=v.indexA;else throw new Error("same units in createInterUnitBondCylinderMesh");return Vbe(Gbe,e,_,T)||Vbe(Gbe,e,I,E)},position:(A,v,_)=>{let I=a[_],T=e.unitMap.get(I.unitA),E=e.unitMap.get(I.unitB);if(T.conformation.position(T.elements[I.indexA],A),E.conformation.position(E.elements[I.indexB],v),u){let w=y(_),S=x(_),P=Math.min(w,S)*c,k=Math.sqrt(Math.max(0,w*w-P*P))-.05,L=Math.sqrt(Math.max(0,S*S-P*P))-.05;if(k<=.01&&L<=.01)return;D.normalize(f,D.sub(f,v,A)),D.scaleAndAdd(A,A,f,k),D.scaleAndAdd(v,v,f,-L)}},style:A=>{let v=a[A].props.order,_=zi.create(a[A].props.flag);return Br.is(_,2)||Br.is(_,4)?1:v===3?p?0:h?4:5:d&&Br.is(_,16)?7:v!==2||p?0:h?2:3},radius:A=>b(A)*c,ignore:JB(e,r),stub:C}}function Wet(e,t,r,n,o){if(!t.interUnitBonds.edgeCount)return ss.createEmpty(o);let i=Ube(t,r,n),{cylinders:s,boundingSphere:a}=gM(e,i,n,o);if(a)s.setBoundingSphere(a);else if(s.cylinderCount>0){let{child:l}=t,c=Pe.expand(Pe(),(l??t).boundary.sphere,1*n.sizeFactor);s.setBoundingSphere(c)}return s}function qet(e,t,r,n,o){if(!t.interUnitBonds.edgeCount)return Ct.createEmpty(o);let i=Ube(t,r,n),{mesh:s,boundingSphere:a}=ed(e,i,n,o);if(a)s.setBoundingSphere(a);else if(s.triangleCount>0){let{child:l}=t,c=Pe.expand(Pe(),(l??t).boundary.sphere,1*n.sizeFactor);s.setBoundingSphere(c)}return s}var nI={...Nm,...efe,...K_,sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:M.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:M.Boolean(!0),includeParent:M.Boolean(!1)};function tL(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?Zet(e):Ket(e)}function Zet(e){return tfe({defaultProps:M.getDefaultValues(nI),createGeometry:Wet,createLocationIterator:(t,r)=>Wm.fromStructure(t,{includeLocation2:r.colorMode==="interpolate"}),getLoci:J_,eachLocation:eT,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!da(r.includeTypes,n.includeTypes)||!da(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,r.colorMode!==n.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0),s.interUnitBonds!==a.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function Ket(e){return Ol({defaultProps:M.getDefaultValues(nI),createGeometry:qet,createLocationIterator:t=>Wm.fromStructure(t),getLoci:J_,eachLocation:eT,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.sizeAspectRatio!==n.sizeAspectRatio||r.radialSegments!==n.radialSegments||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.linkCap!==n.linkCap||r.aromaticScale!==n.aromaticScale||r.aromaticSpacing!==n.aromaticSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.dashScale!==n.dashScale||r.dashCap!==n.dashCap||r.stubCap!==n.stubCap||!da(r.includeTypes,n.includeTypes)||!da(r.excludeTypes,n.excludeTypes)||r.adjustCylinderLength!==n.adjustCylinderLength||r.multipleBonds!==n.multipleBonds,s.interUnitBonds!==a.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var Xet=it.add3,Yet=it.add,Kg;(function(e){function t(r=2048,n=1024,o){let i=it.create(Float32Array,3,n,o?o.centerBuffer.ref.value:r),s=it.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r);return{add:(a,l,c,u)=>{Xet(i,a,l,c),Yet(s,u)},getSpheres:()=>{let a=it.compact(i,!0),l=it.compact(s,!0);return Ra.create(a,l,i.elementCount,o)}}}e.create=t})(Kg||(Kg={}));var oI=D.add;function vh(e,t,r){let{ignoreHydrogens:n,ignoreHydrogensVariant:o,traceOnly:i}=r,s=Le.isCoarse(t),{child:a}=e,l=a?.unitMap.get(t.id);if(a&&!l)throw new Error("expected childUnit to exist if child exists");if(!(!a&&!n&&!i))return c=>!!l&&!Qe.has(l.elements,c)||!s&&n&&uu(e,t,c,o)||i&&!aM(t,c)}function zbe(e,t,r,n,o,i){let{child:s}=r,a=s?.unitMap.get(t.id);if(s&&!a)return Ct.createEmpty(i);let{detail:l,sizeFactor:c,stride:u}=o,{elements:d,conformation:m}=t,p=d.length,h=p*Fp(l),f=gt.createState(h,h/2,i),C=D(),g=vh(r,t,o),b=ce.Location.create(r,t),y=n.size.size,x=D(),A=0,v=0;for(let E=0;E<p;E++){if(u&&E%u!==0||g&&g(d[E]))continue;m.invariantPosition(d[E],C),oI(x,x,C),v+=1,b.element=d[E];let w=y(b);w>A&&(A=w),f.currentGroup=E,Rr(f,C,w*c,l)}let _=i?Pe.clone(i.boundingSphere):void 0,I=gt.getMesh(f);if(v===0)return I;let T;return D.scale(x,x,1/v),_&&D.distance(x,_.center)/_.radius<.1?T=_:T=Pe.expand(Pe(),(a??t).boundary.sphere,A*c+.05),I.setBoundingSphere(T),I}function Hbe(e,t,r,n,o,i){let{child:s}=r,a=s?.unitMap.get(t.id);if(s&&!a)return Ra.createEmpty(i);let{sizeFactor:l,stride:c}=o,{elements:u,conformation:d}=t,m=u.length,p=Kg.create(m,m/2,i),h=D(),f=vh(r,t,o),C=ce.Location.create(r,t),g=n.size.size,b=D(),y=0,x=0;if(c&&c>1||f||n.size.granularity!=="uniform")for(let I=0;I<m;I++){if(c&&I%c!==0||f&&f(u[I]))continue;d.invariantPosition(u[I],h),p.add(h[0],h[1],h[2],I),oI(b,b,h),x+=1,C.element=u[I];let T=g(C);T>y&&(y=T)}else{for(let I=0;I<m;I++)d.invariantPosition(u[I],h),p.add(h[0],h[1],h[2],I),oI(b,b,h);x=m,y=g(C)}let A=i?Pe.clone(i.boundingSphere):void 0,v=p.getSpheres();if(x===0)return v;let _;return D.scale(b,b,1/x),A&&D.distance(b,A.center)/A.radius<.1?_=A:_=Pe.expand(Pe(),(a??t).boundary.sphere,y*l+.05),v.setBoundingSphere(_),v}function Ga(e,t,r){let n=!1;if(!ce.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!qe.areEquivalent(e.structure,o))return!1;let s=i.elements.length,{unitIndexMap:a}=i;for(let l of e.elements){let c=a.get(l.unit.id);if(c!==void 0){let u=c*s;if(Be.is(l.indices)){let d=u+Be.start(l.indices),m=u+Be.end(l.indices);r(Be.ofBounds(d,m))&&(n=!0)}else for(let d=0,m=l.indices.length;d<m;d++){let p=l.indices[d],h=d+1;for(;h<m&&l.indices[h]===p;)h++;d=h-1;let f=l.indices[d];n=r(Be.ofRange(u+p,u+f))||n}}}return n}function Ua(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:s,group:a}=t,l=a.units[o],c=Ge.ofSingleton(i);return ce.Loci(s.target,[{unit:l,indices:c}])}return pr}function jbe(e,t,r,n,o){let{child:i}=t,{detail:s,sizeFactor:a,stride:l}=n,{getSerialIndex:c}=t.serialMapping,d=t.elementCount*Fp(s),m=gt.createState(d,d/2,o),p=r.size.size,h=D(),f=0,C=0;for(let x of t.units){let A=i?.unitMap.get(x.id);if(i&&!A)continue;let{elements:v,conformation:_}=x,I=v.length,T=D(),E=vh(t,x,n),w=ce.Location.create(t,x);for(let S=0;S<I;S++){let P=v[S];if(l&&S%l!==0||E&&E(P))continue;_.position(P,T),oI(h,h,T),C+=1,w.element=P;let k=p(w);k>f&&(f=k),m.currentGroup=c(x,P),Rr(m,T,k*a,s)}}let g=o?Pe.clone(o.boundingSphere):void 0,b=gt.getMesh(m);if(C===0)return b;let y;return D.scale(h,h,1/C),g&&D.distance(h,g.center)/g.radius<1?y=g:y=Pe.expand(Pe(),(i??t).boundary.sphere,f*a+.05),b.setBoundingSphere(y),b}function $be(e,t,r,n,o){let{child:i}=t,{sizeFactor:s,stride:a}=n,{getSerialIndex:l}=t.serialMapping,c=t.elementCount,u=Kg.create(c,c/2,o),d=r.size.size,m=D(),p=0,h=0;for(let b of t.units){let y=i?.unitMap.get(b.id);if(i&&!y)return Ra.createEmpty(o);let{elements:x,conformation:A}=b,v=x.length,_=D(),I=vh(t,b,n),T=ce.Location.create(t,b);if(a&&a>1||I||r.size.granularity!=="uniform")for(let E=0;E<v;E++){let w=x[E];if(a&&E%a!==0||I&&I(w))continue;A.position(w,_),u.add(_[0],_[1],_[2],l(b,w)),oI(m,m,_),h+=1,T.element=w;let S=d(T);S>p&&(p=S)}else{for(let E=0;E<v;E++){let w=x[E];A.position(w,_),u.add(_[0],_[1],_[2],l(b,w)),oI(m,m,_)}h+=v,p=d(T)}}let f=o?Pe.clone(o.boundingSphere):void 0,C=u.getSpheres();if(h===0)return C;let g;return D.scale(m,m,1/h),f&&D.distance(m,f.center)/f.radius<1?g=f:g=Pe.expand(Pe(),(i??t).boundary.sphere,p*s+.05),C.setBoundingSphere(g),C}function qm(e,t,r){let n=!1;if(!ce.Loci.is(e)||!qe.areEquivalent(e.structure,t))return!1;let{cumulativeUnitElementCount:o}=t.serialMapping;for(let i of e.elements){let s=t.unitIndexMap.get(i.unit.id);if(s!==void 0)if(Be.is(i.indices)){let a=o[s]+Be.start(i.indices),l=o[s]+Be.end(i.indices);r(Be.ofBounds(a,l))&&(n=!0)}else for(let a=0,l=i.indices.length;a<l;a++){let c=o[s]+i.indices[a];r(Be.ofSingleton(c))&&(n=!0)}}return n}function Zm(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{unitIndices:i,cumulativeUnitElementCount:s}=t.serialMapping,a=i[o],l=t.units[a],c=o-s[a],u=Ge.ofSingleton(c);return ce.Loci(t,[{unit:l,indices:u}])}return pr}var yi;(function(e){function t(n){let{group:o,structure:i}=n,s=o.elements.length,a=o.units.length,l=ce.Location.create(i);return Mr(s,a,1,(u,d)=>{let m=o.units[d];return l.unit=m,l.element=m.elements[u],l})}e.fromGroup=t;function r(n){let{units:o,elementCount:i}=n,s=i,a=1,{unitIndices:l,elementIndices:c}=n.serialMapping,u=ce.Location.create(n);return Mr(s,a,1,m=>(u.unit=o[l[m]],u.element=c[m],u),!0)}e.fromStructure=r})(yi||(yi={}));var Wbe={sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),traceOnly:M.Boolean(!1),tryUseImpostor:M.Boolean(!0),stride:M.Numeric(1,{min:1,max:100,step:1})},iI={...Xn,...hS,...Wbe};function rL(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?Qet(e):Jet(e)}function Qet(e){return gS({defaultProps:M.getDefaultValues(iI),createGeometry:Hbe,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function Jet(e){return xo({defaultProps:M.getDefaultValues(iI),createGeometry:zbe,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var qbe={...Nm,...Qpe,...Wbe};function Zbe(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?ett(e):ttt(e)}function ett(e){return Jpe({defaultProps:M.getDefaultValues(qbe),createGeometry:$be,createLocationIterator:yi.fromStructure,getLoci:Zm,eachLocation:qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function ttt(e){return Ol({defaultProps:M.getDefaultValues(qbe),createGeometry:jbe,createLocationIterator:yi.fromStructure,getLoci:Zm,eachLocation:qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var Kbe={"element-sphere":(e,t)=>Fn("Element sphere",e,t,rL),"intra-bond":(e,t)=>Fn("Intra-unit bond cylinder",e,t,eL),"inter-bond":(e,t)=>us("Inter-unit bond cylinder",e,t,tL)},Oj={...iI,traceOnly:M.Boolean(!1,{isHidden:!0}),...rI,...nI,includeParent:M.Boolean(!1),unitKinds:Fg(["atomic"]),sizeFactor:M.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:M.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:M.MultiSelect(["element-sphere","intra-bond","inter-bond"],M.objectToOptions(Kbe)),bumpFrequency:M.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory)};function rtt(e,t){if(qe.getSize(t)>=qe.Size.Huge){let n=M.clone(Oj);return n.visuals.defaultValue=["element-sphere","intra-bond"],n}else return Oj}function ntt(e,t){return Wt.createMulti("Ball & Stick",e,t,so,Kbe)}var Xbe={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:ntt,getParams:rtt,defaultValues:M.getDefaultValues(Oj),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};function ott(e,t,r,n,o){let{links:i,elements:s}=t.carbohydrates,{linkSizeFactor:a}=n,l=ce.Location.create(t),c={linkCount:i.length,position:(m,p,h)=>{let f=i[h];D.copy(m,s[f.carbohydrateIndexA].geometry.center),D.copy(p,s[f.carbohydrateIndexB].geometry.center)},radius:m=>{let p=i[m],h=s[p.carbohydrateIndexA],f=h.unit.rings.all[h.ringIndex];return l.unit=h.unit,l.element=h.unit.elements[f[0]],r.size.size(l)*a}},{mesh:u,boundingSphere:d}=ed(e,c,n,o);if(d)u.setBoundingSphere(d);else if(u.triangleCount>0){let m=Pe.expand(Pe(),t.boundary.sphere,1*a);u.setBoundingSphere(m)}return u}var Gj={...Xn,...Ld,linkSizeFactor:M.Numeric(.3,{min:0,max:3,step:.01})};function Ybe(e){return Ol({defaultProps:M.getDefaultValues(Gj),createGeometry:ott,createLocationIterator:itt,getLoci:stt,eachLocation:att,setUpdateState:(t,r,n)=>{t.createGeometry=r.linkSizeFactor!==n.linkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function itt(e){let{elements:t,links:r}=e.carbohydrates,n=r.length,o=1,i=ce.Location.create(e);return Mr(n,o,1,a=>{let l=r[a],c=t[l.carbohydrateIndexA],u=c.unit.rings.all[c.ringIndex];return i.unit=c.unit,i.element=c.unit.elements[u[0]],i},!0)}function stt(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{links:i,elements:s}=t.carbohydrates,a=i[o],l=s[a.carbohydrateIndexA],c=s[a.carbohydrateIndexB];return ce.Loci.union(Gy(t,l.unit,l.residueIndex,l.altId),Gy(t,c.unit,c.residueIndex,c.altId))}return pr}var Vj=new Set;function att(e,t,r){let n=!1;if(!ce.Loci.is(e)||!qe.areEquivalent(e.structure,t))return!1;let{getLinkIndices:o}=t.carbohydrates;for(let{unit:i,indices:s}of e.elements)Le.isAtomic(i)&&(Vj.clear(),Ge.forEach(s,a=>{let l=o(i,i.elements[a]);for(let c=0,u=l.length;c<u;++c)Vj.has(l[c])||(Vj.add(l[c]),r(Be.ofSingleton(l[c]))&&(n=!0))}));return n}var ltt=D.create(0,0,-.5),ctt=D.create(0,0,.5),gv=D(),yv=D(),nL=D(),Qbe=D();function jj(e){let t=e.length/3,n=(t===3?1:t===4?2:t)+t,o=t===4?t*3+4:n*3,i=Np(n,o);for(let s=0;s<t;++s){let a=(s+1)%t;D.set(gv,e[s*3],e[s*3+1],-.5),D.set(yv,e[a*3],e[a*3+1],-.5),i.add(gv,yv,ctt)}if(t===3)D.set(gv,e[0],e[1],-.5),D.set(yv,e[3],e[4],-.5),D.set(nL,e[6],e[7],-.5),i.add(nL,yv,gv);else if(t===4)D.set(gv,e[0],e[1],-.5),D.set(yv,e[3],e[4],-.5),D.set(nL,e[6],e[7],-.5),D.set(Qbe,e[9],e[10],-.5),i.addQuad(Qbe,nL,yv,gv);else for(let s=0;s<t;++s){let a=(s+1)%t;D.set(gv,e[s*3],e[s*3+1],-.5),D.set(yv,e[a*3],e[a*3+1],-.5),i.add(ltt,yv,gv)}return i.getPrimitive()}var Uj;function Jbe(){return Uj||(Uj=jj(nc(3,!0))),Uj}var zj;function e1e(){return zj||(zj=jj(nc(8,!0))),zj}var Hj;function t1e(){if(!Hj){let e=nc(8,!0),t=new Float32Array(8*3+6);for(let n=0;n<8;++n)t[n*3]=e[n*3],t[n*3+1]=e[n*3+1],t[n*3+2]=-.5;t[8*3]=0,t[8*3+1]=0,t[8*3+2]=-.5,t[8*3+3]=0,t[8*3+4]=0,t[8*3+5]=.5,Hj=Ab(t,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return Hj}var utt={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},$j=D.zero(),Wj=D.zero(),qj=D.zero(),tT=D.zero(),Zj=D.zero();function r1e(e){let{outerRadius:t,innerRadius:r,thickness:n,pointCount:o}={...utt,...e},i=o*2*2,s=Np(i),a=new Float32Array(o*2),l=new Float32Array(o*2);for(let c=0;c<o;++c){let u=c*2,d=c*2+1,m=(u+1)/o*Math.PI,p=(d+1)/o*Math.PI;l[u]=Math.cos(m)*t,l[d]=Math.sin(m)*t,a[u]=Math.cos(p)*r,a[d]=Math.sin(p)*r}D.set($j,0,0,n/2),D.set(Wj,0,0,-n/2);for(let c=0;c<o;++c){let u=(c+1)%o;D.set(qj,l[c*2],l[c*2+1],0),D.set(tT,a[c*2],a[c*2+1],0),D.set(Zj,l[u*2],l[u*2+1],0),s.add($j,qj,tT),s.add(tT,qj,Wj),s.add($j,tT,Zj),s.add(Zj,tT,Wj)}return s.getPrimitive()}var Yj=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],dtt=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],mtt=[0,2,4,0,4,3,1,2,5,1,5,3],ptt=[0,2,1,3,2,1,3,0,0,4,1,4,2,4,3,4,0,5,1,5,2,5,3,5],Kj;function n1e(){return Kj||(Kj=Ab(Yj,dtt)),Kj}var Xj;function o1e(){return Xj||(Xj=Ab(Yj,mtt)),Xj}var l8r=Nf(Yj,ptt);var fr=de.identity(),Xg=D(),i1e=D(),ftt=2*.806,s1e=Z0(),a1e=Are(),htt=e1e(),l1e=t1e(),gtt=r1e({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),ytt=n1e(),c1e=o1e(),u1e=tre(),vtt=rre(),btt=nre(),xtt=ore(),Ctt=ire();function Stt(e,t,r,n,o){let i=gt.createState(256,128,o),{detail:s,sizeFactor:a}=n,l=t.carbohydrates,c=l.elements.length,u=ce.Location.create(t);for(let d=0;d<c;++d){let m=l.elements[d],p=m.unit.rings.all[m.ringIndex],h=rne(m.component.type,p.length);u.unit=m.unit,u.element=m.unit.elements[p[0]];let f=r.size.size(u),C=f*a,g=f*a*ftt,{center:b,normal:y,direction:x}=m.geometry;switch(D.add(i1e,b,x),de.targetTo(fr,b,i1e,y),de.setTranslation(fr,b),i.currentGroup=d*2,h){case yo.FilledSphere:Rr(i,b,C,s);break;case yo.FilledCube:de.scaleUniformly(fr,fr,g),gt.addPrimitive(i,fr,s1e);break;case yo.CrossedCube:de.scaleUniformly(fr,fr,g),gt.addPrimitive(i,fr,a1e),de.mul(fr,fr,de.rotZ90X180),i.currentGroup+=1,gt.addPrimitive(i,fr,a1e);break;case yo.FilledCone:de.scaleUniformly(fr,fr,g*1.2),gt.addPrimitive(i,fr,htt);break;case yo.DevidedCone:de.scaleUniformly(fr,fr,g*1.2),gt.addPrimitive(i,fr,l1e),de.mul(fr,fr,de.rotZ90),i.currentGroup+=1,gt.addPrimitive(i,fr,l1e);break;case yo.FlatBox:de.mul(fr,fr,de.rotZY90),de.scale(fr,fr,D.set(Xg,g,g,g/2)),gt.addPrimitive(i,fr,s1e);break;case yo.FilledStar:de.scaleUniformly(fr,fr,g),de.mul(fr,fr,de.rotZY90),gt.addPrimitive(i,fr,gtt);break;case yo.FilledDiamond:de.mul(fr,fr,de.rotZY90),de.scale(fr,fr,D.set(Xg,g*1.4,g*1.4,g*1.4)),gt.addPrimitive(i,fr,ytt);break;case yo.DividedDiamond:de.mul(fr,fr,de.rotZY90),de.scale(fr,fr,D.set(Xg,g*1.4,g*1.4,g*1.4)),gt.addPrimitive(i,fr,c1e),de.mul(fr,fr,de.rotY90),i.currentGroup+=1,gt.addPrimitive(i,fr,c1e);break;case yo.FlatDiamond:de.mul(fr,fr,de.rotZY90),de.scale(fr,fr,D.set(Xg,g,g/2,g/2)),gt.addPrimitive(i,fr,u1e);break;case yo.DiamondPrism:de.mul(fr,fr,de.rotZY90),de.scale(fr,fr,D.set(Xg,g,g,g/2)),gt.addPrimitive(i,fr,u1e);break;case yo.PentagonalPrism:case yo.Pentagon:de.mul(fr,fr,de.rotZY90),de.scale(fr,fr,D.set(Xg,g,g,g/2)),gt.addPrimitive(i,fr,vtt);break;case yo.HexagonalPrism:de.mul(fr,fr,de.rotZY90),de.scale(fr,fr,D.set(Xg,g,g,g/2)),gt.addPrimitive(i,fr,btt);break;case yo.HeptagonalPrism:de.mul(fr,fr,de.rotZY90),de.scale(fr,fr,D.set(Xg,g,g,g/2)),gt.addPrimitive(i,fr,Ctt);break;case yo.FlatHexagon:default:de.mul(fr,fr,de.rotZYZ90),de.scale(fr,fr,D.set(Xg,g/1.5,g,g/2)),gt.addPrimitive(i,fr,xtt);break}}return gt.getMesh(i)}var Jj={...Nm,detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),sizeFactor:M.Numeric(1.75,{min:0,max:10,step:.01})};function d1e(e){return Ol({defaultProps:M.getDefaultValues(Jj),createGeometry:Stt,createLocationIterator:Itt,getLoci:Att,eachLocation:wtt,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function Itt(e){let t=e.carbohydrates.elements,r=t.length*2,n=1,o=ce.Location.create(e);function i(a,l){let c=t[Math.floor(a/2)],u=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[u[0]],o}function s(a,l){return a%2===1}return Mr(r,n,1,i,!0,s)}function Att(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let i=t.carbohydrates.elements[Math.floor(o/2)];return Gy(t,i.unit,i.residueIndex,i.altId)}return pr}var Qj=new Set;function wtt(e,t,r){let{getElementIndices:n}=t.carbohydrates,o=!1;if(!ce.Loci.is(e)||!qe.areEquivalent(e.structure,t))return!1;for(let{unit:i,indices:s}of e.elements)Le.isAtomic(i)&&(Qj.clear(),Ge.forEach(s,a=>{let l=n(i,i.elements[a]);for(let c=0,u=l.length;c<u;++c)Qj.has(l[c])||(Qj.add(l[c]),r(Be.ofSingleton(l[c]*2))&&(o=!0))}));return o}function _tt(e,t,r,n,o){let{terminalLinks:i,elements:s}=t.carbohydrates,{terminalLinkSizeFactor:a}=n,l=ce.Location.create(t),c={linkCount:i.length,position:(m,p,h)=>{let f=i[h];f.fromCarbohydrate?(D.copy(m,s[f.carbohydrateIndex].geometry.center),f.elementUnit.conformation.position(f.elementUnit.elements[f.elementIndex],p)):(f.elementUnit.conformation.position(f.elementUnit.elements[f.elementIndex],m),D.copy(p,s[f.carbohydrateIndex].geometry.center))},radius:m=>{let p=i[m];if(p.fromCarbohydrate){let h=s[p.carbohydrateIndex],f=h.unit.rings.all[h.ringIndex];l.unit=h.unit,l.element=h.unit.elements[f[0]]}else l.unit=p.elementUnit,l.element=p.elementUnit.elements[p.elementIndex];return r.size.size(l)*a},style:m=>{let p=i[m],h=p.elementUnit.elements[p.elementIndex],f=Uu(p.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(h));return Q0.has(f)?1:0}},{mesh:u,boundingSphere:d}=ed(e,c,n,o);if(d)u.setBoundingSphere(d);else if(u.triangleCount>0){let m=Pe.expand(Pe(),t.boundary.sphere,1*a);u.setBoundingSphere(m)}return u}var t8={...Xn,...Ld,terminalLinkSizeFactor:M.Numeric(.2,{min:0,max:3,step:.01})};function m1e(e){return Ol({defaultProps:M.getDefaultValues(t8),createGeometry:_tt,createLocationIterator:Ttt,getLoci:Ett,eachLocation:Ptt,setUpdateState:(t,r,n)=>{t.createGeometry=r.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||r.radialSegments!==n.radialSegments||r.linkCap!==n.linkCap}},e)}function Ttt(e){let{elements:t,terminalLinks:r}=e.carbohydrates,n=r.length,o=1,i=ce.Location.create(e);return Mr(n,o,1,a=>{let l=r[a];if(l.fromCarbohydrate){let c=t[l.carbohydrateIndex],u=c.unit.rings.all[c.ringIndex];i.unit=c.unit,i.element=c.unit.elements[u[0]]}else i.unit=l.elementUnit,i.element=l.elementUnit.elements[l.elementIndex];return i},!0)}function Ett(e,t,r){let{objectId:n,groupId:o}=e;if(r===n){let{terminalLinks:i,elements:s}=t.carbohydrates,a=i[o],l=s[a.carbohydrateIndex];return ce.Loci.union(Gy(t,l.unit,l.residueIndex,l.altId),jpe(t,a.elementUnit,a.elementUnit.elements[a.elementIndex]))}return pr}var e8=new Set;function Ptt(e,t,r){let n=!1;if(!ce.Loci.is(e)||!qe.areEquivalent(e.structure,t))return!1;let{getTerminalLinkIndices:o}=t.carbohydrates;for(let{unit:i,indices:s}of e.elements)Le.isAtomic(i)&&(e8.clear(),Ge.forEach(s,a=>{let l=o(i,i.elements[a]);for(let c=0,u=l.length;c<u;++c)e8.has(l[c])||(e8.add(l[c]),r(Be.ofSingleton(l[c]))&&(n=!0))}));return n}var p1e={"carbohydrate-symbol":(e,t)=>us("Carbohydrate symbol mesh",e,t,d1e),"carbohydrate-link":(e,t)=>us("Carbohydrate link cylinder",e,t,Ybe),"carbohydrate-terminal-link":(e,t)=>us("Carbohydrate terminal link cylinder",e,t,m1e)},f1e={...Jj,...Gj,...t8,visuals:M.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],M.objectToOptions(p1e)),bumpFrequency:M.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory)};function Dtt(e,t){return f1e}function ktt(e,t){return Wt.createMulti("Carbohydrate",e,t,so,p1e)}var h1e={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:ktt,getParams:Dtt,defaultValues:M.getDefaultValues(f1e),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.models.some(t=>Ut.hasCarbohydrate(t))};function r8(e,t){switch(e.kind){case 0:return Mtt(e,t);case 1:case 2:return Rtt(e,t)}}function Mtt(e,t){let r=e.model.atomicRanges.cyclicPolymerMap,n=Sn.transientSegments(F1(e),e.elements),o=Vt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex,{moleculeType:s}=e.model.atomicHierarchy.derived.residue,a=-1,l=-1,c=!0,u=-1,d=0;for(;n.hasNext;){for(c=!0,u=d,o.setSegment(n.move());o.hasNext;){if(c){let p=o.move().index;if(++d,!o.hasNext)continue;c=!1,l=p}let m=o.move().index;a=l,l=m,t(i[a],i[l],d-1,d,s[a]),++d}r.has(l)&&(a=l,l=r.get(a),t(i[a],i[l],d-1,u,s[a]))}}function Rtt(e,t){let r=Sn.transientSegments(F1(e),e.elements),{elements:n}=e,o=!0,i=0;for(;r.hasNext;){o=!0;let s=r.move(),a=s.start,l=s.end;for(let c=a,u=l;c<u;++c){if(o){if(++c,++i,c>u)continue;o=!1}t(n[c-1],n[c],i-1,i,0),++i}}}function n8(e,t){switch(e.kind){case 0:return Btt(e,t);case 1:case 2:return Ltt(e,t)}}function Btt(e,t){let r=Sn.transientSegments(F1(e),e.elements),n=Vt.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),o=e.model.atomicHierarchy.derived.residue.traceElementIndex,i=0;for(;r.hasNext;)for(n.setSegment(r.move());n.hasNext;){let s=n.move().index;t(o[s],i),++i}}function Ltt(e,t){let r=Sn.transientSegments(F1(e),e.elements),{elements:n}=e,o=0;for(;r.hasNext;){let i=r.move(),s=i.start,a=i.end;for(let l=s,c=a;l<c;++l)t(n[l],o),++o}}function g1e(e,t){switch(t.kind){case 0:return new o8(e,t);case 1:case 2:return new i8(e,t)}}function y1e(e,t){return{centerA:ce.Location.create(e,t),centerB:ce.Location.create(e,t)}}var o8=class{move(){let{elements:t,residueIndex:r}=this.unit,n=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[r[t[n.start]]],this.value.centerB.element=this.traceElementIndex[r[t[n.end-1]]],this.hasNext=this.gapIt.hasNext,this.value}constructor(t,r){this.unit=r,this.hasNext=!1,this.traceElementIndex=r.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Sn.transientSegments(s8(r),r.elements),this.value=y1e(t,r),this.hasNext=this.gapIt.hasNext}},i8=class{move(){let t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value}constructor(t,r){this.unit=r,this.hasNext=!1,this.gapIt=Sn.transientSegments(s8(r),r.elements),this.value=y1e(t,r),this.hasNext=this.gapIt.hasNext}};function v1e(e){let{x:t,y:r,z:n}=e.atomicConformation,{polymerType:o,traceElementIndex:i}=e.atomicHierarchy.derived.residue,s=o.length,a=Ge.ofBounds(0,e.atomicConformation.atomId.rowCount),l=Sn.transientSegments(e.atomicRanges.polymerRanges,a),c=Vt.transientSegments(e.atomicHierarchy.residueAtomSegments,a),u=new Float32Array(s*3),d=new Float32Array(s*3),m=0,p=-1,h=-1,f=D(),C=D(),g=D(),b=D(),y=D(),x=D(),A=D(),v=D(),_=D(),I=D(),T=D(),E=D(),w=D(),S=D();for(;l.hasNext;){let P=l.move();for(c.setSegment(P),m=-1,h=-1;c.hasNext;){m+=1;let{index:H}=c.move();m===0&&(h=H),p=H-2;let V=p*3;D.copy(f,C),D.copy(C,g),D.copy(g,b);let q=i[H];if(D.set(b,t[q],r[q],n[q]),m<3)continue;D.sub(y,C,f),D.sub(x,g,C),D.sub(A,b,g),D.sub(T,y,x),D.sub(E,x,A),D.cross(w,T,E),D.normalize(w,w),D.toArray(w,d,V);let Q=Math.cos(D.angle(T,E)),O=D.magnitude(T),B=D.magnitude(E),j=Math.sqrt(B*O)/Math.max(2,2*(1-Q));D.scale(v,T,j/O),D.sub(v,C,v),D.toArray(v,u,V),D.scale(_,E,j/B),D.sub(_,g,_),D.toArray(_,u,V+3),D.copy(S,w)}let k=h*3;D.fromArray(v,u,k+3),D.fromArray(_,u,k+6),D.normalize(w,D.sub(w,v,_));let L=i[h];D.set(f,t[L],r[L],n[L]),D.copy(I,f),D.projectPointOnVector(I,I,w,v),D.toArray(I,u,k);let R=p+2,N=R*3;D.fromArray(v,u,N-3),D.fromArray(_,u,N-6),D.normalize(w,D.sub(w,v,_));let F=i[R];D.set(f,t[F],r[F],n[F]),D.copy(I,f),D.projectPointOnVector(I,I,w,v),D.toArray(I,u,N)}return{centers:u}}var rT=Hu.createProvider({label:"Helix Orientation",descriptor:Ci({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:()=>({}),isApplicable:e=>!0,obtain:async(e,t)=>({value:v1e(t)})});function mf(e){return bn.is(e,2)}function Ntt(e){return bn.is(e,4)}function sI(e,t,r={}){switch(e.kind){case 0:return new a8(e,t,r);case 1:case 2:return new l8(e,t)}}var sL=bn.create(536870912);function b1e(e,t){return{center:ce.Location.create(e,t),centerPrev:ce.Location.create(e,t),centerNext:ce.Location.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:sL,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:D(),p1:D(),p2:D(),p3:D(),p4:D(),d12:D(),d23:D()}}var kr=D(),oL=D(),iL=D(),a8=class{atomicPos(t,r){r!==-1&&(t[0]=this.atomicConformation.x[r],t[1]=this.atomicConformation.y[r],t[2]=this.atomicConformation.z[r])}pos(t,r,n){let o=this.traceElementIndex[r];this.helixOrientationCenters&&mf(n)?D.fromArray(t,this.helixOrientationCenters,r*3):this.atomicPos(t,o)}updateResidueSegmentRange(t){let{index:r}=this.residueAtomSegments;this.residueSegmentMin=r[this.polymerRanges[t.index*2]],this.residueSegmentMax=r[this.polymerRanges[t.index*2+1]]}getResidueIndex(t){if(t<this.residueSegmentMin){let r=this.cyclicPolymerMap.get(this.residueSegmentMin);r!==void 0?t=r-(this.residueSegmentMin-t-1):t=this.residueSegmentMin}else if(t>this.residueSegmentMax){let r=this.cyclicPolymerMap.get(this.residueSegmentMax);r!==void 0?t=r+(t-this.residueSegmentMax-1):t=this.residueSegmentMax}return t}getSecStruc(t){if(this.secondaryStructure){let{type:r,getIndex:n}=this.secondaryStructure,o=r[n(t)];return mf(o)?2:o}else return sL}setControlPoint(t,r,n,o,i){Ntt(i)||this.helixOrientationCenters&&mf(i)?D.scale(t,D.add(t,r,D.add(t,o,D.add(t,n,n))),1/4):D.copy(t,n)}setFromToVector(t,r,n){this.value.isCoarseBackbone||this.helixOrientationCenters&&mf(n)?D.set(t,1,0,0):(this.atomicPos(oL,this.directionFromElementIndex[r]),this.atomicPos(iL,this.directionToElementIndex[r]),D.sub(t,iL,oL))}setDirection(t,r,n,o){D.matchDirection(oL,r,n),D.matchDirection(iL,o,n),D.scale(t,D.add(t,oL,D.add(t,iL,D.add(t,n,n))),1/4)}move(){let{residueIt:t,polymerIt:r,value:n}=this;if(this.state===0){for(;r.hasNext;)if(this.polymerSegment=r.move(),t.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),t.hasNext){this.state=1;let o=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],i=this.getResidueIndex(o-1);this.currSecStrucType=o===i?sL:this.getSecStruc(i),this.nextSecStrucType=this.getSecStruc(o),this.currCoarseBackbone=this.directionFromElementIndex[i]===-1||this.directionToElementIndex[i]===-1,this.nextCoarseBackbone=this.directionFromElementIndex[o]===-1||this.directionToElementIndex[o]===-1;break}}if(this.state===1){let{index:o}=t.move(),i=this.getResidueIndex(o-3),s=this.getResidueIndex(o-2),a=this.getResidueIndex(o-1),l=this.getResidueIndex(o+1),c=this.getResidueIndex(o+2),u=this.getResidueIndex(o+3);this.prevSecStrucType=this.getSecStruc(a),this.currSecStrucType=this.getSecStruc(o),this.nextSecStrucType=o===l?sL:this.getSecStruc(l),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=this.directionFromElementIndex[l]===-1||this.directionToElementIndex[l]===-1,n.secStrucType=this.currSecStrucType,n.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,n.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,n.isCoarseBackbone=this.currCoarseBackbone,n.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,n.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,n.first=o===this.residueSegmentMin,n.last=o===this.residueSegmentMax,n.moleculeType=this.moleculeType[o],n.initial=o===a,n.final=o===l,n.centerPrev.element=this.traceElementIndex[a],n.center.element=this.traceElementIndex[o],n.centerNext.element=this.traceElementIndex[l];let d=this.getSecStruc(i),m=this.getSecStruc(s),p=this.getSecStruc(a),h=this.getSecStruc(o),f=this.getSecStruc(l),C=this.getSecStruc(c),g=this.getSecStruc(u);this.pos(this.p0,i,d),this.pos(this.p1,s,m),this.pos(this.p2,a,p),this.pos(this.p3,o,h),this.pos(this.p4,l,f),this.pos(this.p5,c,C),this.pos(this.p6,u,g);let b=mf(d),y=mf(m),x=mf(p),A=mf(h),v=mf(f),_=mf(C),I=mf(g);this.helixOrientationCenters&&(A!==x?A?(D.copy(this.p0,this.p3),D.copy(this.p1,this.p3),D.copy(this.p2,this.p3)):x&&(D.scale(kr,D.sub(kr,this.p2,this.p3),2),D.add(this.p2,this.p3,kr),D.add(this.p1,this.p2,kr),D.add(this.p0,this.p1,kr)):A!==y?A?(D.copy(this.p0,this.p2),D.copy(this.p1,this.p2)):y&&(D.scale(kr,D.sub(kr,this.p1,this.p2),2),D.add(this.p1,this.p2,kr),D.add(this.p0,this.p1,kr)):A!==b&&(A?D.copy(this.p0,this.p1):b&&(D.scale(kr,D.sub(kr,this.p0,this.p1),2),D.add(this.p0,this.p1,kr))),A!==v?A?(D.copy(this.p4,this.p3),D.copy(this.p5,this.p3),D.copy(this.p6,this.p3)):v&&(D.scale(kr,D.sub(kr,this.p4,this.p3),2),D.add(this.p4,this.p3,kr),D.add(this.p5,this.p4,kr),D.add(this.p6,this.p5,kr)):A!==_?A?(D.copy(this.p5,this.p4),D.copy(this.p6,this.p4)):_&&(D.scale(kr,D.sub(kr,this.p5,this.p4),2),D.add(this.p5,this.p4,kr),D.add(this.p6,this.p5,kr)):A!==I&&(A?D.copy(this.p6,this.p5):I&&(D.scale(kr,D.sub(kr,this.p6,this.p5),2),D.add(this.p6,this.p5,kr)))),this.setFromToVector(this.d01,a,p),this.setFromToVector(this.d12,o,h),this.setFromToVector(this.d23,l,f),this.setFromToVector(this.d34,c,C);let T=A&&this.helixOrientationCenters,E=1.5;o===a||h!==p&&T?(D.setMagnitude(kr,D.sub(kr,this.p3,this.p4),E),D.add(this.p2,this.p3,kr),D.add(this.p1,this.p2,kr),D.add(this.p0,this.p1,kr)):a===s||h!==m&&T?(D.setMagnitude(kr,D.sub(kr,this.p2,this.p3),E),D.add(this.p1,this.p2,kr),D.add(this.p0,this.p1,kr)):(s===i||h!==d&&T)&&(D.setMagnitude(kr,D.sub(kr,this.p1,this.p2),E),D.add(this.p0,this.p1,kr)),o===l||h!==f&&T?(D.setMagnitude(kr,D.sub(kr,this.p3,this.p2),E),D.add(this.p4,this.p3,kr),D.add(this.p5,this.p4,kr),D.add(this.p6,this.p5,kr)):l===c||h!==C&&T?(D.setMagnitude(kr,D.sub(kr,this.p4,this.p3),E),D.add(this.p5,this.p4,kr),D.add(this.p6,this.p5,kr)):(c===u||h!==g&&T)&&(D.setMagnitude(kr,D.sub(kr,this.p5,this.p4),E),D.add(this.p6,this.p5,kr)),this.setControlPoint(n.p0,this.p0,this.p1,this.p2,m),this.setControlPoint(n.p1,this.p1,this.p2,this.p3,p),this.setControlPoint(n.p2,this.p2,this.p3,this.p4,h),this.setControlPoint(n.p3,this.p3,this.p4,this.p5,f),this.setControlPoint(n.p4,this.p4,this.p5,this.p6,C),this.setDirection(n.d12,this.d01,this.d12,this.d23),this.setDirection(n.d23,this.d12,this.d23,this.d34),t.hasNext||(this.state=0)}return this.hasNext=t.hasNext||r.hasNext,this.value}constructor(t,r,n={}){var o;if(this.unit=t,this.state=0,this.p0=D(),this.p1=D(),this.p2=D(),this.p3=D(),this.p4=D(),this.p5=D(),this.p6=D(),this.d01=D(),this.d12=D(),this.d23=D(),this.d34=D(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Sn.transientSegments(this.polymerRanges,t.elements),this.residueIt=Vt.transientSegments(this.residueAtomSegments,t.elements),this.value=b1e(r,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=(o=tl.get(r).value)===null||o===void 0?void 0:o.get(t.invariantId)),n.useHelixOrientation){let i=rT.get(t.model).value;if(!i)throw new Error("missing helix-orientation");this.helixOrientationCenters=i.centers}}},l8=class{getElementIndex(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)}pos(t,r){let n=this.unit.elements[r];t[0]=this.conformation.x[n],t[1]=this.conformation.y[n],t[2]=this.conformation.z[n]}move(){if(this.state===0){for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}}if(this.state===1){let t=this.getElementIndex(this.elementIndex-2),r=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),o=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[r],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,t),this.pos(this.value.p1,r),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,o);let i=.5;this.elementIndex===r?(D.scale(kr,D.sub(kr,this.value.p2,this.value.p3),i),D.add(this.value.p1,this.value.p2,kr),D.add(this.value.p0,this.value.p1,kr)):r===t&&(D.scale(kr,D.sub(kr,this.value.p1,this.value.p2),i),D.add(this.value.p0,this.value.p1,kr)),this.elementIndex===n?(D.scale(kr,D.sub(kr,this.value.p2,this.value.p1),i),D.add(this.value.p3,this.value.p2,kr),D.add(this.value.p4,this.value.p3,kr)):n===o&&(D.scale(kr,D.sub(kr,this.value.p3,this.value.p2),i),D.add(this.value.p4,this.value.p3,kr)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value}constructor(t,r){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=Sn.transientSegments(F1(t),t.elements),this.value=b1e(r,t),D.set(this.value.d12,1,0,0),D.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians;break}this.hasNext=this.polymerIt.hasNext}};var O1=D.fromArray,cI=D.toArray,f8=D.normalize,Ftt=D.sub,aI=D.spline,Ott=D.slerp,x1e=D.copy,C1e=D.cross,c8=D.orthogonalize,Vtt=D.matchDirection,Gtt=D.scale,S1e=D.add;function uI(e){let t=e+1,r=t*3;return{curvePoints:new Float32Array(r),tangentVectors:new Float32Array(r),normalVectors:new Float32Array(r),binormalVectors:new Float32Array(r),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function dI(e,t,r,n){Utt(e,t,r,n),Htt(e,t)}var u8=D(),d8=D(),m8=D();function Utt(e,t,r,n){let{curvePoints:o,tangentVectors:i,linearSegments:s}=e,{p0:a,p1:l,p2:c,p3:u,p4:d,secStrucFirst:m,secStrucLast:p}=t,h=1-n,f=m?.5:r,C=p?.5:r;for(let g=0;g<=s;++g){let b=g*1/s;if(b<h){let y=zn(f,r,b);aI(m8,a,l,c,u,b+n,y),aI(u8,a,l,c,u,b+n+.01,f),aI(d8,a,l,c,u,b+n-.01,f)}else{let y=zn(r,C,b);aI(m8,l,c,u,d,b-h,y),aI(u8,l,c,u,d,b-h+.01,y),aI(d8,l,c,u,d,b-h-.01,y)}cI(m8,o,g*3),f8(vv,Ftt(vv,u8,d8)),cI(vv,i,g*3)}}var ztt=D(),vv=D(),pf=D(),lI=D(),nT=D(),I1e=D(),A1e=D(),w1e=D(),p8=D(),aL=D();function Htt(e,t){let{curvePoints:r,tangentVectors:n,normalVectors:o,binormalVectors:i}=e,{d12:s,d23:a}=t,l=r.length/3;O1(A1e,n,0),O1(w1e,n,(l-1)*3),c8(p8,A1e,s),c8(aL,w1e,a),Vtt(aL,aL,p8),x1e(nT,p8);let c=l-1;for(let u=0;u<l;++u){let d=IE(0,c,u)*c,m=u===0?0:1/(l-d);O1(vv,n,u*3),c8(pf,vv,Ott(ztt,nT,aL,m)),cI(pf,o,u*3),x1e(nT,pf),f8(lI,C1e(lI,vv,pf)),cI(lI,i,u*3)}for(let u=1;u<c;++u)O1(nT,o,(u-1)*3),O1(pf,o,u*3),O1(I1e,o,(u+1)*3),Gtt(pf,S1e(pf,nT,S1e(pf,I1e,pf)),1/3),cI(pf,o,u*3),O1(vv,n,u*3),f8(lI,C1e(lI,vv,pf)),cI(lI,i,u*3)}function oT(e,t,r,n,o,i,s,a){let{widthValues:l,heightValues:c,linearSegments:u}=e,d=1-a;for(let m=0;m<=u;++m){let p=m*1/u;p<d?(l[m]=zn(t,r,p+a),c[m]=zn(o,i,p+a)):(l[m]=zn(r,n,p-d),c[m]=zn(i,s,p-d))}}var cL=.5,T1e=.9,V1=.5,G1=.3,mI=2;function F1(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function s8(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var sd;(function(e){function t(r,n){let{group:o,structure:i}=r,s=o.units[0].polymerElements,a=s.length,l=o.units.length,c=ce.Location.create(i),u=(p,h)=>{let f=o.units[h];return c.unit=f,c.element=s[p],c},d=!!n?.asSecondary;function m(p,h){return d}return Mr(a,l,1,u,!1,m)}e.fromGroup=t})(sd||(sd={}));var lL;(function(e){function t(r){let{group:n,structure:o}=r,i=n.units[0].gapElements,s=i.length,a=n.units.length,l=ce.Location.create(o);return Mr(s,a,1,(u,d)=>{let m=n.units[d];return l.unit=m,l.element=i[u],l})}e.fromGroup=t})(lL||(lL={}));function Km(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:s,group:a}=t,l=a.units[o];if(Le.isAtomic(l))return sM(s,l,l.polymerElements[i]);{let{elements:c}=l,u=l.polymerElements[i],d=Ge.indexOf(c,u);if(d!==-1){let m=Ge.ofSingleton(d);return ce.Loci(s,[{unit:l,indices:m}])}}}return pr}function _1e(e,t,r,n,o,i){let s=-1,a=-1;for(let c=o;c<=i;c++){let u=r[c];if(!(u<0)&&(s=Ge.indexOf(t,u),s>=0)){a=c;break}}if(s<0)return!1;let l=s;for(let c=i;c>a;c--){let u=r[c];if(u<0)continue;let d=Ge.indexOf(t,u);if(d>=0){l=d;break}}return n(Be.ofRange(e+s,e+l))}function h8(e,t,r,n,o){let i=!1,{elements:s}=o.unit,{traceElementIndex:a}=o.unit.model.atomicHierarchy.derived.residue,{index:l}=o.unit.model.atomicHierarchy.residueAtomSegments,c=r(o.unit);if(Be.is(o.indices))if(Be.start(o.indices)===0&&Be.end(o.indices)===o.unit.elements.length)i=n(Be.ofBounds(e,e+t))||i;else{let u=l[s[Be.min(o.indices)]],d=l[s[Be.max(o.indices)]];i=_1e(e,c,a,n,u,d)||i}else{let{indices:u}=o;for(let d=0,m=u.length;d<m;d++){let p=l[s[u[d]]],h=p,f=d+1;for(;f<m;){let C=l[s[u[f]]];if(C-h>1)break;h=C,f++}d=f-1,i=_1e(e,c,a,n,p,h)||i}}return i}function jtt(e){return e.polymerElements}function Xm(e,t,r){let n=!1;if(!ce.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!qe.areEquivalent(e.structure,o))return!1;let s=i.units[0].polymerElements.length;for(let a of e.elements){if(!i.unitIndexMap.has(a.unit.id))continue;let l=i.unitIndexMap.get(a.unit.id)*s;if(Le.isAtomic(a.unit))n=h8(l,s,jtt,r,a)||n;else if(Be.is(a.indices)){let c=l+Be.start(a.indices),u=l+Be.end(a.indices);n=r(Be.ofBounds(c,u))||n}else for(let c=0,u=a.indices.length;c<u;c++){let d=a.indices[c],m=c+1;for(;m<u&&a.indices[m]===d;)m++;c=m-1;let p=a.indices[c];n=r(Be.ofRange(l+d,l+p))||n}}return n}function E1e(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:s,group:a}=t,l=a.units[o],c=Ge.indexOf(l.elements,l.gapElements[i]),u=Ge.indexOf(l.elements,l.gapElements[i%2?i-1:i+1]);if(c!==-1&&u!==-1)return _t.Loci(s,[_t.Location(s,l,c,s,l,u),_t.Location(s,l,u,s,l,c)])}return pr}function P1e(e,t,r){let n=!1;if(_t.isLoci(e)){let{structure:o,group:i}=t;if(!qe.areRootsEquivalent(e.structure,o))return!1;e=_t.remapLoci(e,o);let s=i.units[0].gapElements.length;for(let a of e.bonds){let l=i.unitIndexMap.get(a.aUnit.id);if(l!==void 0){let c=Ge.indexOf(a.aUnit.gapElements,a.aUnit.elements[a.aIndex]),u=Ge.indexOf(a.bUnit.gapElements,a.bUnit.elements[a.bIndex]);c!==-1&&u!==-1&&r(Be.ofSingleton(l*s+c))&&(n=!0)}}}else if(ce.Loci.is(e)){let{structure:o,group:i}=t;if(!qe.areRootsEquivalent(e.structure,o))return!1;e=ce.Loci.remap(e,o);let s=i.units[0].gapElements.length;for(let a of e.elements){let l=i.unitIndexMap.get(a.unit.id);l!==void 0&&Ge.forEach(a.indices,c=>{let u=Ge.indexOf(a.unit.gapElements,a.unit.elements[c]);u!==-1&&r(Be.ofSingleton(l*s+u))&&(n=!0)})}}return n}var ad;(function(e){function t(r){let{group:n,structure:o}=r,i=n.units[0],s=Le.isAtomic(i)?i.nucleotideElements:[],a=s.length,l=n.units.length,c=ce.Location.create(o);return Mr(a,l,1,(d,m)=>{let p=n.units[m];return c.unit=p,c.element=s[d],c})}e.fromGroup=t})(ad||(ad={}));function Ym(e,t,r){let{objectId:n,instanceId:o,groupId:i}=e;if(r===n){let{structure:s,group:a}=t,l=a.units[o];if(Le.isAtomic(l))return sM(s,l,l.nucleotideElements[i])}return pr}function $tt(e){return e.nucleotideElements}function Qm(e,t,r){let n=!1;if(!ce.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!qe.areEquivalent(e.structure,o))return!1;let s=i.units[0];if(!Le.isAtomic(s))return!1;let{nucleotideElements:a}=s,l=a.length;for(let c of e.elements){if(!Le.isAtomic(c.unit)||!i.unitIndexMap.has(c.unit.id))continue;let u=i.unitIndexMap.get(c.unit.id)*l;Le.isAtomic(c.unit)&&(n=h8(u,l,$tt,r,c)||n)}return n}var Wtt=D(),qtt=D();function Jm(e,t){let{model:r,conformation:n}=e,{residueAtomSegments:o,atoms:i,index:s}=r.atomicHierarchy,{label_comp_id:a}=i,l=a.value(o.offsets[t]),c=Cne(l),u=Sne(l);if(!c&&!u){let d=s.findAtomOnResidue(t,"C4"),m=s.findAtomOnResidue(t,"N9");d!==-1&&m!==-1&&D.distance(n.invariantPosition(d,Wtt),n.invariantPosition(m,qtt))<1.6?c=!0:u=!0}return{isPurine:c,isPyrimidine:u}}function ep(){return{trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1}}function tp(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.N1=n.findAtomOnResidue(r,"N1"),e.C2=n.findAtomOnResidue(r,"C2"),e.N3=n.findAtomOnResidue(r,"N3"),e.C4=n.findAtomOnResidue(r,"C4"),e.C5=n.findAtomOnResidue(r,"C5"),e.C5===-1&&(e.C5=n.findAtomOnResidue(r,"N5")),e.C6=n.findAtomOnResidue(r,"C6"),e.N7=n.findAtomOnResidue(r,"N7"),e.N7===-1&&(e.N7=n.findAtomOnResidue(r,"C7")),e.C8=n.findAtomOnResidue(r,"C8"),e.N9=n.findAtomOnResidue(r,"N9"),e}function bh(e){return e.trace!==-1&&e.N1!==-1&&e.C2!==-1&&e.N3!==-1&&e.C4!==-1&&e.C5!==-1&&e.C6!==-1&&e.N7!==-1&&e.C8!==-1&&e.N9!==-1}function rp(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.N1=n.findAtomOnResidue(r,"N1"),e.N1===-1&&(e.N1=n.findAtomOnResidue(r,"C1")),e.C2=n.findAtomOnResidue(r,"C2"),e.N3=n.findAtomOnResidue(r,"N3"),e.C4=n.findAtomOnResidue(r,"C4"),e.C5=n.findAtomOnResidue(r,"C5"),e.C6=n.findAtomOnResidue(r,"C6"),e}function xh(e){return e.trace!==-1&&e.N1!==-1&&e.C2!==-1&&e.N3!==-1&&e.C4!==-1&&e.C5!==-1&&e.C6!==-1}function bv(e,t,r){let n=t.model.atomicHierarchy.index,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue;return e.trace=o[r],e.C1_1=n.findAtomOnResidue(r,"C1'"),e.C2_1=n.findAtomOnResidue(r,"C2'"),e.C3_1=n.findAtomOnResidue(r,"C3'"),e.C4_1=n.findAtomOnResidue(r,"C4'"),e.O4_1=n.findAtomOnResidue(r,"O4'"),e}function xv(e){return e.trace!==-1&&e.C1_1!==-1&&e.C2_1!==-1&&e.C3_1!==-1&&e.C4_1!==-1&&e.O4_1!==-1}var uL=D(),g8=D(),D1e=D(),k1e=D(),M1e=D(),R1e=D(),dL=D(),y8=D(),v8=D(),B1e=D(),iT=de.identity(),Ztt=D(),L1e=Z0(),N1e={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:M.Numeric(1,{min:0,max:2,step:.01}),radialSegments:M.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)},n$r=M.getDefaultValues(N1e);function Ktt(e,t,r,n,o,i){if(!Le.isAtomic(t))return Ct.createEmpty(i);let s=t.nucleotideElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a,thicknessFactor:l,radialSegments:c}=o,u=s*(L1e.vertices.length/3+c*2),d=gt.createState(u,u/4,i),{elements:m,model:p,conformation:h}=t,{chainAtomSegments:f,residueAtomSegments:C}=p.atomicHierarchy,{moleculeType:g}=p.atomicHierarchy.derived.residue,b=Vt.transientSegments(f,m),y=Vt.transientSegments(C,m),x=1*a,A=4.5,v=l*a*2,_={radiusTop:x,radiusBottom:x,radialSegments:c,bottomCap:!0},I=0;for(;b.hasNext;)for(y.setSegment(b.move());y.hasNext;){let{index:w}=y.move();if(Wi(g[w])){let S=ep(),P=-1,k=-1,L=-1,R=-1,N=-1,F=4.5,{isPurine:H,isPyrimidine:V}=Jm(t,w);H?(F=4.5,tp(S,t,w),P=S.N1,k=S.C4,L=S.C6,R=S.C2,N=S.N9):V&&(F=3,rp(S,t,w),P=S.N3,k=S.C6,L=S.C4,R=S.C2,N=S.N1),N!==-1&&S.trace!==-1&&(h.invariantPosition(N,M1e),h.invariantPosition(S.trace,R1e),d.currentGroup=I,zr(d,M1e,R1e,1,_),P!==-1&&k!==-1&&L!==-1&&R!==-1&&(h.invariantPosition(P,uL),h.invariantPosition(k,g8),h.invariantPosition(L,D1e),h.invariantPosition(R,k1e),D.normalize(dL,D.sub(dL,g8,uL)),D.normalize(y8,D.sub(y8,k1e,D1e)),D.normalize(v8,D.cross(v8,dL,y8)),de.targetTo(iT,uL,g8,v8),D.scaleAndAdd(B1e,uL,dL,F/2-.2),de.scale(iT,iT,D.set(Ztt,A,v,F)),de.setTranslation(iT,B1e),gt.addPrimitive(d,iT,L1e))),++I}}let T=gt.getMesh(d),E=Pe.expand(Pe(),t.boundary.sphere,x);return T.setBoundingSphere(E),T}var b8={...Xn,...N1e};function F1e(e){return xo({defaultProps:M.getDefaultValues(b8),createGeometry:Ktt,createLocationIterator:ad.fromGroup,getLoci:Ym,eachLocation:Qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor||r.radialSegments!==n.radialSegments}},e)}var mL=D(),Cv=D(),pL=D(),fL=D(),pI=D(),fI=D(),hL=D(),O1e=D(),V1e=D(),gL=D(),Sv=D(),z1e={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:M.Numeric(1,{min:0,max:2,step:.01}),radialSegments:M.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo),detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo)},v$r=M.getDefaultValues(z1e),yL=new Float32Array(2*9*3),Xtt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Ytt=new Uint32Array([8,12,14,16,6,4,2,0,10]),Qtt=new Uint32Array([9,11,1,3,5,7,17,15,13]),vL=new Float32Array(2*6*3),Jtt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),ert=new Uint32Array([0,10,8,6,4,2]),trt=new Uint32Array([1,3,5,7,9,11]),G1e=D();function U1e(e,t,...r){for(let n=0,o=r.length;n<o;++n){let i=r[n];D.toArray(D.add(G1e,i,t),e,n*2*3),D.toArray(D.sub(G1e,i,t),e,(n*2+1)*3)}}function rrt(e,t,r,n,o,i){if(!Le.isAtomic(t))return Ct.createEmpty(i);let s=t.nucleotideElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a,thicknessFactor:l,radialSegments:c,detail:u}=o,d=s*(26+c*2),m=gt.createState(d,d/4,i),{elements:p,model:h,conformation:f}=t,{chainAtomSegments:C,residueAtomSegments:g}=h.atomicHierarchy,{moleculeType:b}=h.atomicHierarchy.derived.residue,y=Vt.transientSegments(C,p),x=Vt.transientSegments(g,p),A=1*a,v=l*a,_={radiusTop:A,radiusBottom:A,radialSegments:c},I=0;for(;y.hasNext;)for(x.setSegment(y.move());x.hasNext;){let{index:w}=x.move();if(Wi(b[w])){let S=ep();m.currentGroup=I;let{isPurine:P,isPyrimidine:k}=Jm(t,w);P?(tp(S,t,w),S.N9!==-1&&S.trace!==-1&&(f.invariantPosition(S.N9,gL),f.invariantPosition(S.trace,mL),m.currentGroup=I,zr(m,gL,mL,1,_),Rr(m,gL,A,u)),bh(S)&&(f.invariantPosition(S.N1,Cv),f.invariantPosition(S.C2,pL),f.invariantPosition(S.N3,fL),f.invariantPosition(S.C4,pI),f.invariantPosition(S.C5,fI),f.invariantPosition(S.C6,hL),f.invariantPosition(S.N7,O1e),f.invariantPosition(S.C8,V1e),D.triangleNormal(Sv,Cv,pI,fI),D.scale(Sv,Sv,v),U1e(yL,Sv,Cv,pL,fL,pI,fI,hL,O1e,V1e,gL),gt.addTriangleStrip(m,yL,Xtt),gt.addTriangleFan(m,yL,Ytt),gt.addTriangleFan(m,yL,Qtt))):k&&(rp(S,t,w),S.N1!==-1&&S.trace!==-1&&(f.invariantPosition(S.N1,Cv),f.invariantPosition(S.trace,mL),m.currentGroup=I,zr(m,Cv,mL,1,_),Rr(m,Cv,A,u)),xh(S)&&(f.invariantPosition(S.C2,pL),f.invariantPosition(S.N3,fL),f.invariantPosition(S.C4,pI),f.invariantPosition(S.C5,fI),f.invariantPosition(S.C6,hL),D.triangleNormal(Sv,Cv,pI,fI),D.scale(Sv,Sv,v),U1e(vL,Sv,Cv,pL,fL,pI,fI,hL),gt.addTriangleStrip(m,vL,Jtt),gt.addTriangleFan(m,vL,ert),gt.addTriangleFan(m,vL,trt))),++I}}let T=gt.getMesh(m),E=Pe.expand(Pe(),t.boundary.sphere,A);return T.setBoundingSphere(E),T}var x8={...Xn,...z1e};function H1e(e){return xo({defaultProps:M.getDefaultValues(x8),createGeometry:rrt,createLocationIterator:ad.fromGroup,getLoci:Ym,eachLocation:Qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor||r.radialSegments!==n.radialSegments}},e)}var hI=D(),bL=D(),xL=D(),gI=D(),yI=D(),CL=D(),j1e=D(),$1e=D(),W1e=D(),SL=D(),C8=D(),IL=D(),AL=D(),S8=D(),vI=D(),$l=D(),bI=D(),Z1e={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:M.Numeric(1,{min:0,max:2,step:.01})},D$r=M.getDefaultValues(Z1e),wL=new Float32Array(2*9*3),nrt=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),ort=new Uint32Array([8,12,14,16,6,4,2,0,10]),irt=new Uint32Array([9,11,1,3,5,7,17,15,13]),_L=new Float32Array(2*6*3),srt=new Uint32Array([2,3,4,5,6,7,8,9,10,11,2,3]),art=new Uint32Array([0,10,8,6,4,2,10]),lrt=new Uint32Array([1,3,5,7,9,11,3]),TL=new Float32Array(2*6*3),crt=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),urt=new Uint32Array([0,10,8,6,4,2]),drt=new Uint32Array([1,3,5,7,9,11]),q1e=D();function I8(e,t,...r){for(let n=0,o=r.length;n<o;++n){let i=r[n];D.toArray(D.add(q1e,i,t),e,n*2*3),D.toArray(D.sub(q1e,i,t),e,(n*2+1)*3)}}function mrt(e,t,r,n,o,i){if(!Le.isAtomic(t))return Ct.createEmpty(i);let s=t.nucleotideElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a,thicknessFactor:l}=o,c=s*25,u=gt.createState(c,c/4,i),{elements:d,model:m,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=m.atomicHierarchy,{moleculeType:C}=m.atomicHierarchy.derived.residue,g=Vt.transientSegments(h,d),b=Vt.transientSegments(f,d),y=a*l,x=0;for(;g.hasNext;)for(b.setSegment(g.move());b.hasNext;){let{index:_}=b.move();if(Wi(C[_])){let I=ep();u.currentGroup=x,bv(I,t,_),xv(I)&&(p.invariantPosition(I.C1_1,SL),p.invariantPosition(I.C2_1,C8),p.invariantPosition(I.C3_1,IL),p.invariantPosition(I.C4_1,AL),p.invariantPosition(I.O4_1,S8),D.triangleNormal($l,IL,AL,SL),D.scale(vI,D.add(vI,S8,D.add(vI,AL,D.add(vI,IL,D.add(vI,SL,C8)))),.2),D.scale(bI,$l,y),I8(_L,bI,vI,IL,AL,S8,SL,C8),gt.addTriangleStrip(u,_L,srt),gt.addTriangleFanWithNormal(u,_L,art,$l),D.negate($l,$l),gt.addTriangleFanWithNormal(u,_L,lrt,$l));let{isPurine:T,isPyrimidine:E}=Jm(t,_);T?(tp(I,t,_),bh(I)&&(p.invariantPosition(I.N1,hI),p.invariantPosition(I.C2,bL),p.invariantPosition(I.N3,xL),p.invariantPosition(I.C4,gI),p.invariantPosition(I.C5,yI),p.invariantPosition(I.C6,CL),p.invariantPosition(I.N7,j1e),p.invariantPosition(I.C8,$1e),p.invariantPosition(I.N9,W1e),D.triangleNormal($l,hI,gI,yI),D.scale(bI,$l,y),I8(wL,bI,hI,bL,xL,gI,yI,CL,j1e,$1e,W1e),gt.addTriangleStrip(u,wL,nrt),gt.addTriangleFanWithNormal(u,wL,ort,$l),D.negate($l,$l),gt.addTriangleFanWithNormal(u,wL,irt,$l))):E&&(rp(I,t,_),xh(I)&&(p.invariantPosition(I.N1,hI),p.invariantPosition(I.C2,bL),p.invariantPosition(I.N3,xL),p.invariantPosition(I.C4,gI),p.invariantPosition(I.C5,yI),p.invariantPosition(I.C6,CL),D.triangleNormal($l,hI,gI,yI),D.scale(bI,$l,y),I8(TL,bI,hI,bL,xL,gI,yI,CL),gt.addTriangleStrip(u,TL,crt),gt.addTriangleFanWithNormal(u,TL,urt,$l),D.negate($l,$l),gt.addTriangleFanWithNormal(u,TL,drt,$l))),++x}}let A=gt.getMesh(u),v=Pe.expand(Pe(),t.boundary.sphere,y);return A.setBoundingSphere(v),A}var A8={...Xn,...Z1e};function K1e(e){return xo({defaultProps:M.getDefaultValues(A8),createGeometry:mrt,createLocationIterator:ad.fromGroup,getLoci:Ym,eachLocation:Qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.thicknessFactor!==n.thicknessFactor}},e)}var Wl=D(),Qo=D(),za=D(),Ha=D(),Es=D(),Ps=D(),ja=D(),Ch=D(),Sh=D(),aa=D(),la=D(),Ih=D(),ld=D(),Ah=D(),wh=D(),EL={...Xn,...yS,sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:M.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo),tryUseImpostor:M.Boolean(!0)};function X1e(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?frt(e):grt(e)}function prt(e,t,r,n,o,i){if(!Le.isAtomic(t))return ss.createEmpty(i);let s=t.nucleotideElements.length;if(!s)return ss.createEmpty(i);let a=s*15,l=$y.create(a,a/4,i),{elements:c,model:u,conformation:d}=t,{chainAtomSegments:m,residueAtomSegments:p}=u.atomicHierarchy,{moleculeType:h}=u.atomicHierarchy.derived.residue,f=Vt.transientSegments(m,c),C=Vt.transientSegments(p,c),g=0,b=2;for(;f.hasNext;)for(C.setSegment(f.move());C.hasNext;){let{index:A}=C.move();if(Wi(h[A])){let v=ep();bv(v,t,A),xv(v)&&(d.invariantPosition(v.C1_1,la),d.invariantPosition(v.C2_1,Ih),d.invariantPosition(v.C3_1,ld),d.invariantPosition(v.C4_1,Ah),d.invariantPosition(v.O4_1,wh),d.invariantPosition(v.trace,Wl),l.add(ld[0],ld[1],ld[2],Wl[0],Wl[1],Wl[2],1,!0,!0,b,g),l.add(ld[0],ld[1],ld[2],Ah[0],Ah[1],Ah[2],1,!0,!0,b,g),l.add(Ah[0],Ah[1],Ah[2],wh[0],wh[1],wh[2],1,!0,!0,b,g),l.add(wh[0],wh[1],wh[2],la[0],la[1],la[2],1,!0,!0,b,g),l.add(la[0],la[1],la[2],Ih[0],Ih[1],Ih[2],1,!0,!0,b,g),l.add(Ih[0],Ih[1],Ih[2],ld[0],ld[1],ld[2],1,!0,!0,b,g));let{isPurine:_,isPyrimidine:I}=Jm(t,A);_?(tp(v,t,A),v.C1_1!==-1&&v.N9!==-1?(d.invariantPosition(v.C1_1,la),d.invariantPosition(v.N9,aa),l.add(aa[0],aa[1],aa[2],la[0],la[1],la[2],1,!0,!0,b,g)):v.N9!==-1&&v.trace!==-1&&(d.invariantPosition(v.N9,aa),d.invariantPosition(v.trace,Wl),l.add(aa[0],aa[1],aa[2],Wl[0],Wl[1],Wl[2],1,!0,!0,b,g)),bh(v)&&(d.invariantPosition(v.N1,Qo),d.invariantPosition(v.C2,za),d.invariantPosition(v.N3,Ha),d.invariantPosition(v.C4,Es),d.invariantPosition(v.C5,Ps),d.invariantPosition(v.C6,ja),d.invariantPosition(v.N7,Ch),d.invariantPosition(v.C8,Sh),d.invariantPosition(v.N9,aa),l.add(aa[0],aa[1],aa[2],Sh[0],Sh[1],Sh[2],1,!0,!0,b,g),l.add(Sh[0],Sh[1],Sh[2],Ch[0],Ch[1],Ch[2],1,!0,!0,b,g),l.add(Ch[0],Ch[1],Ch[2],Ps[0],Ps[1],Ps[2],1,!0,!0,b,g),l.add(Ps[0],Ps[1],Ps[2],ja[0],ja[1],ja[2],1,!0,!0,b,g),l.add(ja[0],ja[1],ja[2],Qo[0],Qo[1],Qo[2],1,!0,!0,b,g),l.add(Qo[0],Qo[1],Qo[2],za[0],za[1],za[2],1,!0,!0,b,g),l.add(za[0],za[1],za[2],Ha[0],Ha[1],Ha[2],1,!0,!0,b,g),l.add(Ha[0],Ha[1],Ha[2],Es[0],Es[1],Es[2],1,!0,!0,b,g),l.add(Es[0],Es[1],Es[2],Ps[0],Ps[1],Ps[2],1,!0,!0,b,g),l.add(Es[0],Es[1],Es[2],aa[0],aa[1],aa[2],1,!0,!0,b,g))):I&&(rp(v,t,A),v.C1_1!==-1&&v.N1!==-1?(d.invariantPosition(v.N1,Qo),d.invariantPosition(v.C1_1,la),l.add(Qo[0],Qo[1],Qo[2],la[0],la[1],la[2],1,!0,!0,b,g)):v.N1!==-1&&v.trace!==-1&&(d.invariantPosition(v.N1,Qo),d.invariantPosition(v.trace,Wl),l.add(Qo[0],Qo[1],Qo[2],Wl[0],Wl[1],Wl[2],1,!0,!0,b,g)),xh(v)&&(d.invariantPosition(v.N1,Qo),d.invariantPosition(v.C2,za),d.invariantPosition(v.N3,Ha),d.invariantPosition(v.C4,Es),d.invariantPosition(v.C5,Ps),d.invariantPosition(v.C6,ja),l.add(Qo[0],Qo[1],Qo[2],ja[0],ja[1],ja[2],1,!0,!0,b,g),l.add(ja[0],ja[1],ja[2],Ps[0],Ps[1],Ps[2],1,!0,!0,b,g),l.add(Ps[0],Ps[1],Ps[2],Es[0],Es[1],Es[2],1,!0,!0,b,g),l.add(Es[0],Es[1],Es[2],Ha[0],Ha[1],Ha[2],1,!0,!0,b,g),l.add(Ha[0],Ha[1],Ha[2],za[0],za[1],za[2],1,!0,!0,b,g),l.add(za[0],za[1],za[2],Qo[0],Qo[1],Qo[2],1,!0,!0,b,g))),++g}}let y=l.getCylinders(),x=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return y.setBoundingSphere(x),y}function frt(e){return vS({defaultProps:M.getDefaultValues(EL),createGeometry:prt,createLocationIterator:ad.fromGroup,getLoci:Ym,eachLocation:Qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function hrt(e,t,r,n,o,i){if(!Le.isAtomic(t))return Ct.createEmpty(i);let s=t.nucleotideElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a,radialSegments:l}=o,c=s*(l*15),u=gt.createState(c,c/4,i),{elements:d,model:m,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=m.atomicHierarchy,{moleculeType:C}=m.atomicHierarchy.derived.residue,g=Vt.transientSegments(h,d),b=Vt.transientSegments(f,d),y={radiusTop:1*a,radiusBottom:1*a,radialSegments:l},x=0;for(;g.hasNext;)for(b.setSegment(g.move());b.hasNext;){let{index:_}=b.move();if(Wi(C[_])){let I=ep();u.currentGroup=x,bv(I,t,_),xv(I)&&(p.invariantPosition(I.C1_1,la),p.invariantPosition(I.C2_1,Ih),p.invariantPosition(I.C3_1,ld),p.invariantPosition(I.C4_1,Ah),p.invariantPosition(I.O4_1,wh),p.invariantPosition(I.trace,Wl),zr(u,ld,Wl,1,y),zr(u,ld,Ah,1,y),zr(u,Ah,wh,1,y),zr(u,wh,la,1,y),zr(u,la,Ih,1,y),zr(u,Ih,ld,1,y));let{isPurine:T,isPyrimidine:E}=Jm(t,_);T?(tp(I,t,_),I.C1_1!==-1&&I.N9!==-1?(p.invariantPosition(I.C1_1,la),p.invariantPosition(I.N9,aa),zr(u,aa,la,1,y)):I.N9!==-1&&I.trace!==-1&&(p.invariantPosition(I.N9,aa),p.invariantPosition(I.trace,Wl),zr(u,aa,Wl,1,y)),bh(I)&&(p.invariantPosition(I.N1,Qo),p.invariantPosition(I.C2,za),p.invariantPosition(I.N3,Ha),p.invariantPosition(I.C4,Es),p.invariantPosition(I.C5,Ps),p.invariantPosition(I.C6,ja),p.invariantPosition(I.N7,Ch),p.invariantPosition(I.C8,Sh),p.invariantPosition(I.N9,aa),zr(u,aa,Sh,1,y),zr(u,Sh,Ch,1,y),zr(u,Ch,Ps,1,y),zr(u,Ps,ja,1,y),zr(u,ja,Qo,1,y),zr(u,Qo,za,1,y),zr(u,za,Ha,1,y),zr(u,Ha,Es,1,y),zr(u,Es,Ps,1,y),zr(u,Es,aa,1,y))):E&&(rp(I,t,_),I.C1_1!==-1&&I.N1!==-1?(p.invariantPosition(I.N1,Qo),p.invariantPosition(I.C1_1,la),zr(u,Qo,la,1,y)):I.N1!==-1&&I.trace!==-1&&(p.invariantPosition(I.N1,Qo),p.invariantPosition(I.trace,Wl),zr(u,Qo,Wl,1,y)),xh(I)&&(p.invariantPosition(I.N1,Qo),p.invariantPosition(I.C2,za),p.invariantPosition(I.N3,Ha),p.invariantPosition(I.C4,Es),p.invariantPosition(I.C5,Ps),p.invariantPosition(I.C6,ja),zr(u,Qo,ja,1,y),zr(u,ja,Ps,1,y),zr(u,Ps,Es,1,y),zr(u,Es,Ha,1,y),zr(u,Ha,za,1,y),zr(u,za,Qo,1,y))),++x}}let A=gt.getMesh(u),v=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return A.setBoundingSphere(v),A}function grt(e){return xo({defaultProps:M.getDefaultValues(EL),createGeometry:hrt,createLocationIterator:ad.fromGroup,getLoci:Ym,eachLocation:Qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var xI=D(),np=D(),op=D(),ip=D(),sp=D(),zd=D(),ap=D(),CI=D(),SI=D(),II=D(),AI=D(),wI=D(),_I=D(),TI=D(),EI=D(),PL={...Xn,...hS,sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),tryUseImpostor:M.Boolean(!0)};function Y1e(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?vrt(e):xrt(e)}function yrt(e,t,r,n,o,i){if(!Le.isAtomic(t))return Ra.createEmpty(i);let s=t.nucleotideElements.length;if(!s)return Ra.createEmpty(i);let a=s*15,l=Kg.create(a,a/4,i),{elements:c,model:u,conformation:d}=t,{chainAtomSegments:m,residueAtomSegments:p}=u.atomicHierarchy,{moleculeType:h}=u.atomicHierarchy.derived.residue,f=Vt.transientSegments(m,c),C=Vt.transientSegments(p,c),g=0;for(;f.hasNext;)for(C.setSegment(f.move());C.hasNext;){let{index:x}=C.move();if(Wi(h[x])){let A=ep();bv(A,t,x),xv(A)&&(d.invariantPosition(A.C1_1,AI),d.invariantPosition(A.C2_1,wI),d.invariantPosition(A.C3_1,_I),d.invariantPosition(A.C4_1,TI),d.invariantPosition(A.O4_1,EI),d.invariantPosition(A.trace,xI),l.add(xI[0],xI[1],xI[2],g),l.add(_I[0],_I[1],_I[2],g),l.add(TI[0],TI[1],TI[2],g),l.add(EI[0],EI[1],EI[2],g),l.add(AI[0],AI[1],AI[2],g),l.add(wI[0],wI[1],wI[2],g));let{isPurine:v,isPyrimidine:_}=Jm(t,x);v?(tp(A,t,x),bh(A)&&(d.invariantPosition(A.N1,np),d.invariantPosition(A.C2,op),d.invariantPosition(A.N3,ip),d.invariantPosition(A.C4,sp),d.invariantPosition(A.C5,zd),d.invariantPosition(A.C6,ap),d.invariantPosition(A.N7,CI),d.invariantPosition(A.C8,SI),d.invariantPosition(A.N9,II),l.add(II[0],II[1],II[2],g),l.add(SI[0],SI[1],SI[2],g),l.add(CI[0],CI[1],CI[2],g),l.add(zd[0],zd[1],zd[2],g),l.add(ap[0],ap[1],ap[2],g),l.add(np[0],np[1],np[2],g),l.add(op[0],op[1],op[2],g),l.add(ip[0],ip[1],ip[2],g),l.add(sp[0],sp[1],sp[2],g))):_&&(rp(A,t,x),xh(A)&&(d.invariantPosition(A.N1,np),d.invariantPosition(A.C2,op),d.invariantPosition(A.N3,ip),d.invariantPosition(A.C4,sp),d.invariantPosition(A.C5,zd),d.invariantPosition(A.C6,ap),l.add(np[0],np[1],np[2],g),l.add(ap[0],ap[1],ap[2],g),l.add(zd[0],zd[1],zd[2],g),l.add(sp[0],sp[1],sp[2],g),l.add(ip[0],ip[1],ip[2],g),l.add(op[0],op[1],op[2],g))),++g}}let b=l.getSpheres(),y=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return b.setBoundingSphere(y),b}function vrt(e){return gS({defaultProps:M.getDefaultValues(PL),createGeometry:yrt,createLocationIterator:ad.fromGroup,getLoci:Ym,eachLocation:Qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function brt(e,t,r,n,o,i){if(!Le.isAtomic(t))return Ct.createEmpty(i);let s=t.nucleotideElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a,detail:l}=o,c=s*Fp(l),u=gt.createState(c,c/2,i),{elements:d,model:m,conformation:p}=t,{chainAtomSegments:h,residueAtomSegments:f}=m.atomicHierarchy,{moleculeType:C}=m.atomicHierarchy.derived.residue,g=Vt.transientSegments(h,d),b=Vt.transientSegments(f,d),y=1*a,x=0;for(;g.hasNext;)for(b.setSegment(g.move());b.hasNext;){let{index:_}=b.move();if(Wi(C[_])){let I=ep();u.currentGroup=x,bv(I,t,_),xv(I)&&(p.invariantPosition(I.C1_1,AI),p.invariantPosition(I.C2_1,wI),p.invariantPosition(I.C3_1,_I),p.invariantPosition(I.C4_1,TI),p.invariantPosition(I.O4_1,EI),p.invariantPosition(I.trace,xI),Rr(u,xI,y,l),Rr(u,TI,y,l),Rr(u,EI,y,l),Rr(u,AI,y,l),Rr(u,wI,y,l),Rr(u,_I,y,l));let{isPurine:T,isPyrimidine:E}=Jm(t,_);T?(tp(I,t,_),bh(I)&&(p.invariantPosition(I.N1,np),p.invariantPosition(I.C2,op),p.invariantPosition(I.N3,ip),p.invariantPosition(I.C4,sp),p.invariantPosition(I.C5,zd),p.invariantPosition(I.C6,ap),p.invariantPosition(I.N7,CI),p.invariantPosition(I.C8,SI),p.invariantPosition(I.N9,II),Rr(u,SI,y,l),Rr(u,CI,y,l),Rr(u,zd,y,l),Rr(u,ap,y,l),Rr(u,np,y,l),Rr(u,op,y,l),Rr(u,ip,y,l),Rr(u,sp,y,l),Rr(u,zd,y,l),Rr(u,II,y,l))):E&&(rp(I,t,_),xh(I)&&(p.invariantPosition(I.N1,np),p.invariantPosition(I.C2,op),p.invariantPosition(I.N3,ip),p.invariantPosition(I.C4,sp),p.invariantPosition(I.C5,zd),p.invariantPosition(I.C6,ap),Rr(u,ap,y,l),Rr(u,zd,y,l),Rr(u,sp,y,l),Rr(u,ip,y,l),Rr(u,op,y,l),Rr(u,np,y,l))),++x}}let A=gt.getMesh(u),v=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return A.setBoundingSphere(v),A}function xrt(e){return xo({defaultProps:M.getDefaultValues(PL),createGeometry:brt,createLocationIterator:ad.fromGroup,getLoci:Ym,eachLocation:Qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var U1=D.zero(),PI=D.zero(),z1=D.zero(),Q1e=D.zero(),$a=nc(3,!1);function Crt(){let e=Np(8);for(let t=0;t<3;++t){let r=(t+1)%3;D.set(U1,$a[t*3],$a[t*3+1],-.5),D.set(PI,$a[r*3],$a[r*3+1],-.5),D.set(z1,$a[r*3],$a[r*3+1],.5),D.set(Q1e,$a[t*3],$a[t*3+1],.5),e.add(U1,PI,z1),e.add(z1,Q1e,U1)}return D.set(U1,$a[0],$a[1],-.5),D.set(PI,$a[3],$a[4],-.5),D.set(z1,$a[6],$a[7],-.5),e.add(z1,PI,U1),D.set(U1,$a[0],$a[1],.5),D.set(PI,$a[3],$a[4],.5),D.set(z1,$a[6],$a[7],.5),e.add(U1,PI,z1),e.getPrimitive()}var w8;function J1e(){return w8||(w8=Crt()),w8}var H1=de.identity(),Srt=D.zero(),exe=D.zero(),txe=D.zero(),_8=D.zero(),Irt=4,Art=4,wrt=6,_rt=J1e(),rxe={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01})},AWr=M.getDefaultValues(rxe);function Trt(e,t,r,n,o,i){let s=t.polymerElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a}=o,l=s*24,c=gt.createState(l,l/10,i),d=uI(1),{normalVectors:m,binormalVectors:p}=d,h=0,f=sI(t,r);for(;f.hasNext;){let b=f.move();c.currentGroup=h;let y=Wi(b.moleculeType),x=bn.is(b.secStrucType,4);if(dI(d,b,y||x?.5:.9,y?.3:.5),x&&!b.secStrucLast||!x){let _=n.size.size(b.center)*a,I=Irt*_,T=Art*_,E=wrt*_,w=y?p:m;D.fromArray(exe,w,0),D.fromArray(txe,w,3),D.normalize(_8,D.add(_8,exe,txe)),de.targetTo(H1,b.p3,b.p1,_8),de.mul(H1,H1,de.rotY90Z180),de.scale(H1,H1,D.set(Srt,E,T,I)),de.setTranslation(H1,b.p2),gt.addPrimitive(c,H1,_rt)}++h}let C=gt.getMesh(c),g=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return C.setBoundingSphere(g),C}var T8={...Xn,...rxe};function nxe(e){return xo({defaultProps:M.getDefaultValues(T8),createGeometry:Trt,createLocationIterator:t=>sd.fromGroup(t),getLoci:Km,eachLocation:Xm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor}},e)}var E8=10,oxe={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:M.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)},LWr=M.getDefaultValues(oxe);function Ert(e,t,r,n,o,i){let s=t.gapElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a,radialSegments:l}=o,c=E8*l*2*s*2,u=gt.createState(c,c/10,i),d=D(),m=D(),p={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:l},h=0,f=g1e(r,t);for(;f.hasNext;){let{centerA:b,centerB:y}=f.move();b.element===y.element||(t.conformation.invariantPosition(b.element,d),t.conformation.invariantPosition(y.element,m),p.radiusTop=p.radiusBottom=n.size.size(b)*a,u.currentGroup=h,_b(u,d,m,.5,E8,!1,p),p.radiusTop=p.radiusBottom=n.size.size(y)*a,u.currentGroup=h+1,_b(u,m,d,.5,E8,!1,p)),h+=2}let C=gt.getMesh(u),g=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return C.setBoundingSphere(g),C}var j1={...Xn,...oxe};function DI(e){return xo({defaultProps:M.getDefaultValues(j1),createGeometry:Ert,createLocationIterator:lL.fromGroup,getLoci:E1e,eachLocation:P1e,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments}},e)}var Un=D(),Co=D(),Prt=D(),Hd=D(),_h=D(),DL=D(),kL=D(),sT=D(),ff=D(),Th=D(),P8=D(),Iv=D(),Av=D(),wv=D(),_v=D(),lp=D.fromArray,kI=D.scale,cp=D.add,Yg=D.sub,Drt=D.magnitude,ixe=D.negate,D8=D.copy,sxe=D.cross,krt=D.set,No=it.add3,Mrt=it.add;function ML(e,t,r,n,o,i,s,a,l){let{vertices:c,normals:u,indices:d}=t,m=c.elementCount;if(lp(Un,n,e),kI(kL,Un,s),kI(DL,Un,a),lp(Co,o,e),kI(Hd,Co,i),sxe(Th,Co,Un),lp(ff,r,e),cp(Iv,cp(Iv,ff,Hd),DL),Yg(Av,cp(Av,ff,Hd),kL),Yg(wv,Yg(wv,ff,Hd),kL),cp(_v,Yg(_v,ff,Hd),DL),s<a?(No(c,_v[0],_v[1],_v[2]),No(c,wv[0],wv[1],wv[2]),No(c,Av[0],Av[1],Av[2]),No(c,Iv[0],Iv[1],Iv[2]),D8(_h,DL)):(No(c,Iv[0],Iv[1],Iv[2]),No(c,Av[0],Av[1],Av[2]),No(c,wv[0],wv[1],wv[2]),No(c,_v[0],_v[1],_v[2]),D8(_h,kL)),l){for(let p=0;p<4;++p)No(u,-Th[0],-Th[1],-Th[2]);No(d,m,m+1,m+2),No(d,m+2,m+3,m)}else{for(let p=0;p<4;++p)No(u,Th[0],Th[1],Th[2]);No(d,m+2,m+1,m),No(d,m,m+3,m+2)}}function MI(e,t,r,n,o,i,s,a,l,c){let{currentGroup:u,vertices:d,normals:m,indices:p,groups:h}=e,f=d.elementCount,C=0;a>0?(lp(Un,t,0),lp(Co,t,o*3),C=a/Drt(Yg(Prt,Co,Un))):krt(sT,0,0,0);for(let b=0;b<=o;++b){let y=i[b],x=s[b],A=a===0?x:a*(1-b/o),v=b*3;lp(_h,r,v),kI(_h,_h,A),lp(Hd,n,v),kI(Hd,Hd,y),a>0&&(lp(Un,r,v),lp(Co,n,v),kI(sT,sxe(sT,Un,Co),C)),lp(ff,t,v),lp(Th,r,v),lp(P8,n,v),cp(Un,cp(Un,ff,Hd),_h),cp(Co,Th,sT),No(d,Un[0],Un[1],Un[2]),No(m,Co[0],Co[1],Co[2]),cp(Un,Yg(Un,ff,Hd),_h),No(d,Un[0],Un[1],Un[2]),No(m,Co[0],Co[1],Co[2]),ixe(Co,P8),No(d,Un[0],Un[1],Un[2]),No(m,Co[0],Co[1],Co[2]),Yg(Un,Yg(Un,ff,Hd),_h),No(d,Un[0],Un[1],Un[2]),No(m,Co[0],Co[1],Co[2]),cp(Co,ixe(Co,Th),sT),No(d,Un[0],Un[1],Un[2]),No(m,Co[0],Co[1],Co[2]),Yg(Un,cp(Un,ff,Hd),_h),No(d,Un[0],Un[1],Un[2]),No(m,Co[0],Co[1],Co[2]),D8(Co,P8),No(d,Un[0],Un[1],Un[2]),No(m,Co[0],Co[1],Co[2]),cp(Un,cp(Un,ff,Hd),_h),No(d,Un[0],Un[1],Un[2]),No(m,Co[0],Co[1],Co[2])}for(let b=0;b<o;++b){for(let y=0;y<2;y++)No(p,f+b*8+2*y,f+(b+1)*8+2*y+1,f+b*8+2*y+1),No(p,f+b*8+2*y,f+(b+1)*8+2*y,f+(b+1)*8+2*y+1);for(let y=2;y<4;y++)No(p,f+b*8+2*y,f+(b+1)*8+2*y,f+b*8+2*y+1),No(p,f+(b+1)*8+2*y,f+(b+1)*8+2*y+1,f+b*8+2*y+1)}if(l){let b=i[0],y=s[0],x=a===0?y:a;ML(0,e,t,r,n,b,x,x,!1)}else if(a>0){let b=i[0],y=s[0];ML(0,e,t,r,n,b,a,-y,!1),ML(0,e,t,r,n,b,-a,y,!1)}if(c&&a===0){let b=i[o],y=s[o];ML(o*3,e,t,r,n,b,y,y,!0)}let g=(o+1)*8+(l?4:a>0?8:0)+(c&&a===0?4:0);for(let b=0,y=g;b<y;++b)Mrt(h,u)}var qs=D(),Ia=D(),vu=D(),ql=D(),Gc=D();function RL(e,t,r,n,o){e[0]=t[0]*n+r[0]*o,e[1]=t[1]*n+r[1]*o,e[2]=t[2]*n+r[2]*o}function RI(e,t,r,n,o,i){e[0]=t[0]*o+r[0]*i+n[0],e[1]=t[1]*o+r[1]*i+n[1],e[2]=t[2]*o+r[2]*i+n[2]}var Qg=D.fromArray,Rrt=D.normalize,k8=D.scaleAndAdd,axe=D.cross,Brt=D.dot,Lrt=D.unitX,Uc=it.add3,M8=new Map;function Nrt(e,t){let r=t?1:0,n=Ys(e,r);if(!M8.has(n)){let o=[],i=[];for(let s=0;s<e;++s){let a=(s*2+r)/e*Math.PI;o[s]=Math.cos(a),i[s]=Math.sin(a)}M8.set(n,{cos:o,sin:i})}return M8.get(n)}function aT(e,t,r,n,o,i,s,a,l,c,u){let{currentGroup:d,vertices:m,normals:p,indices:h,groups:f}=e,C=m.elementCount,{cos:g,sin:b}=Nrt(i,u==="rounded"),y=Math.round(i/4),x=y*3;for(let _=0;_<=o;++_){let I=_*3;Qg(ql,r,I),Qg(Gc,n,I),Qg(vu,t,I);let T=s[_],E=a[_],w=u==="rounded"&&E>T;for(let S=0;S<i;++S){if(w){RI(Ia,ql,Gc,vu,T*g[S],T*b[S]);let P=Brt(Gc,Lrt)<0?S<y||S>=x?E-T:-E+T:S>=y&&S<x?-E+T:E-T;k8(Ia,Ia,ql,P),S===y||S===y-1?RL(qs,ql,Gc,0,1):S===x||S===x-1?RL(qs,ql,Gc,0,-1):RL(qs,ql,Gc,g[S],b[S])}else RI(Ia,ql,Gc,vu,E*g[S],T*b[S]),RL(qs,ql,Gc,T*g[S],E*b[S]);Rrt(qs,qs),Uc(m,Ia[0],Ia[1],Ia[2]),Uc(p,qs[0],qs[1],qs[2])}}let A=Math.round(i/2);for(let _=0;_<o;++_){for(let I=0;I<A;++I)Uc(h,C+_*i+(I+1)%i,C+(_+1)*i+(I+1)%i,C+_*i+I),Uc(h,C+(_+1)*i+(I+1)%i,C+(_+1)*i+I,C+_*i+I);for(let I=A;I<i;++I)Uc(h,C+_*i+(I+1)%i,C+(_+1)*i+I,C+_*i+I),Uc(h,C+(_+1)*i+(I+1)%i,C+(_+1)*i+I,C+_*i+(I+1)%i)}if(l){let I=m.elementCount;Qg(ql,r,0),Qg(Gc,n,0),Qg(vu,t,0),axe(qs,Gc,ql),Uc(m,vu[0],vu[1],vu[2]),Uc(p,qs[0],qs[1],qs[2]);let T=s[0],E=a[0],w=u==="rounded"&&E>T;w&&(E-=T),C=m.elementCount;for(let S=0;S<i;++S)w?(RI(Ia,ql,Gc,vu,T*g[S],T*b[S]),k8(Ia,Ia,ql,S<y||S>=x?E:-E)):RI(Ia,ql,Gc,vu,E*g[S],T*b[S]),Uc(m,Ia[0],Ia[1],Ia[2]),Uc(p,qs[0],qs[1],qs[2]),Uc(h,C+(S+1)%i,C+S,I)}if(c){let _=o*3,I=m.elementCount;Qg(ql,r,_),Qg(Gc,n,_),Qg(vu,t,_),axe(qs,ql,Gc),Uc(m,vu[0],vu[1],vu[2]),Uc(p,qs[0],qs[1],qs[2]);let T=s[o],E=a[o],w=u==="rounded"&&E>T;w&&(E-=T),C=m.elementCount;for(let S=0;S<i;++S)w?(RI(Ia,ql,Gc,vu,T*g[S],T*b[S]),k8(Ia,Ia,ql,S<y||S>=x?E:-E)):RI(Ia,ql,Gc,vu,E*g[S],T*b[S]),Uc(m,Ia[0],Ia[1],Ia[2]),Uc(p,qs[0],qs[1],qs[2]),Uc(h,C+S,C+(S+1)%i,I)}let v=(o+1)*i+(l?i+1:0)+(c?i+1:0);it.addRepeat(f,v,d)}var Jg=D.fromArray,Frt=D.magnitude,R8=D.sub,lxe=D.add,B8=D.scale,Ort=D.negate,Vrt=D.copy,Grt=D.cross,up=it.add3,Urt=it.add,Wa=D(),Zl=D(),zrt=D(),L8=D(),$1=D(),cxe=D(),lT=D(),Hrt=D(),N8=D();function BI(e,t,r,n,o,i,s,a){let{currentGroup:l,vertices:c,normals:u,indices:d,groups:m}=e,p=c.elementCount,h=0;a>0&&(Jg(Wa,t,0),Jg(Zl,t,o*3),h=a/Frt(R8(zrt,Zl,Wa)));for(let C=0;C<=o;++C){let g=i[C],b=s[C],y=a===0?b:a*(1-C/o),x=C*3;Jg($1,r,x),B8($1,$1,y),Jg(L8,n,x),B8(L8,L8,g),a>0&&(Jg(Wa,r,x),Jg(Zl,n,x),B8(cxe,Grt(cxe,Wa,Zl),h)),Jg(lT,t,x),Jg(Hrt,r,x),Jg(N8,n,x),lxe(Wa,lT,$1),Ort(Zl,N8),up(c,Wa[0],Wa[1],Wa[2]),up(u,Zl[0],Zl[1],Zl[2]),R8(Wa,lT,$1),up(c,Wa[0],Wa[1],Wa[2]),up(u,Zl[0],Zl[1],Zl[2]),lxe(Wa,lT,$1),Vrt(Zl,N8),up(c,Wa[0],Wa[1],Wa[2]),up(u,Zl[0],Zl[1],Zl[2]),R8(Wa,lT,$1),up(c,Wa[0],Wa[1],Wa[2]),up(u,Zl[0],Zl[1],Zl[2])}for(let C=0;C<o;++C)up(d,p+C*4,p+(C+1)*4+1,p+C*4+1),up(d,p+C*4,p+(C+1)*4,p+(C+1)*4+1),up(d,p+C*4+2+1,p+(C+1)*4+2+1,p+C*4+2),up(d,p+C*4+2,p+(C+1)*4+2+1,p+(C+1)*4+2);let f=(o+1)*4;for(let C=0,g=f;C<g;++C)Urt(m,l)}var uxe={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:M.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:M.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:M.Boolean(!1,{description:"Draw alpha helices as tubes"}),helixProfile:M.Select("elliptical",M.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein helix trace profile"}),nucleicProfile:M.Select("square",M.arrayToOptions(["elliptical","rounded","square"]),{description:"Nucleic strand trace profile"}),detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),linearSegments:M.Numeric(8,{min:1,max:48,step:1},at.CustomQualityParamInfo),radialSegments:M.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)},aqr=M.getDefaultValues(uxe),cd=D();function jrt(e,t,r,n,o,i){let s=t.polymerElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a,detail:l,linearSegments:c,radialSegments:u,aspectRatio:d,arrowFactor:m,tubularHelices:p,helixProfile:h,nucleicProfile:f}=o,C=c*u*s+(u+1)*s*2,g=gt.createState(C,C/10,i),b=Le.isCoarse(t),y=uI(c),{curvePoints:x,normalVectors:A,binormalVectors:v,widthValues:_,heightValues:I}=y,T=0,E=sI(t,r,{ignoreSecondaryStructure:!1,useHelixOrientation:p});for(;E.hasNext;){let P=E.move();g.currentGroup=T;let k=Wi(P.moleculeType),L=bn.is(P.secStrucType,4),R=bn.is(P.secStrucType,2),N=R&&!p?T1e:cL,F=k?G1:V1;dI(y,P,N,F);let H=n.size.size(P.centerPrev)*a,V=n.size.size(P.center)*a,q=n.size.size(P.centerNext)*a;b&&(H*=d/2,V*=d/2,q*=d/2);let Q=P.secStrucFirst||P.coarseBackboneFirst||P.first,O=P.secStrucLast||P.coarseBackboneLast||P.last,B=c;if(P.initial){B=Math.max(Math.round(c*F),1);let j=c-B;x.copyWithin(0,j*3),v.copyWithin(0,j*3),A.copyWithin(0,j*3),D.fromArray(cd,x,3),D.normalize(cd,D.sub(cd,P.p2,cd)),D.scaleAndAdd(cd,P.p2,cd,V*mI),D.toArray(cd,x,0)}else P.final&&(B=Math.max(Math.round(c*(1-F)),1),D.fromArray(cd,x,B*3-3),D.normalize(cd,D.sub(cd,P.p2,cd)),D.scaleAndAdd(cd,P.p2,cd,V*mI),D.toArray(cd,x,B*3));if(P.initial===!0&&P.final===!0)Rr(g,P.p2,V*2,l);else if(L){let j=H*d,U=V*d,z=q*d,$=P.secStrucLast?U*m:0;oT(y,H,V,q,j,U,z,F),u===2?BI(g,x,A,v,B,_,I,$):MI(g,x,A,v,B,_,I,$,Q,O)}else{let j,U,z;R&&!P.isCoarseBackbone?p?(H*=d*1.5,V*=d*1.5,q*=d*1.5,j=H,U=V,z=q):(j=H*d,U=V*d,z=q*d):k&&!P.isCoarseBackbone?(j=H*d,U=V*d,z=q*d):(j=H,U=V,z=q),oT(y,H,V,q,j,U,z,F);let[$,Z]=k&&!P.isCoarseBackbone?[v,A]:[A,v];if(k&&!P.isCoarseBackbone)for(let ie=0,ne=$.length;ie<ne;ie++)$[ie]*=-1;let J=k?f:h;u===2?k&&!P.isCoarseBackbone?BI(g,x,$,Z,B,I,_,0):BI(g,x,$,Z,B,_,I,0):u===4?MI(g,x,$,Z,B,_,I,0,Q,O):U===V?aT(g,x,$,Z,B,u,_,I,Q,O,"elliptical"):J==="square"?MI(g,x,$,Z,B,_,I,0,Q,O):aT(g,x,$,Z,B,u,_,I,Q,O,J)}++T}let w=gt.getMesh(g),S=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return w.setBoundingSphere(S),w}var F8={...Xn,...uxe};function dxe(e){return xo({defaultProps:M.getDefaultValues(F8),createGeometry:jrt,createLocationIterator:t=>sd.fromGroup(t,{asSecondary:!0}),getLoci:Km,eachLocation:Xm,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.tubularHelices!==n.tubularHelices||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments||r.aspectRatio!==n.aspectRatio||r.arrowFactor!==n.arrowFactor||r.helixProfile!==n.helixProfile||r.nucleicProfile!==n.nucleicProfile;let l=tl.get(s.structure).version;t.info.secondaryStructureHash!==l&&(t.info.secondaryStructureHash!==void 0&&(t.createGeometry=!0),t.info.secondaryStructureHash=l)}},e)}var mxe={"polymer-trace":(e,t)=>Fn("Polymer trace mesh",e,t,dxe),"polymer-gap":(e,t)=>Fn("Polymer gap cylinder",e,t,DI),"nucleotide-block":(e,t)=>Fn("Nucleotide block mesh",e,t,F1e),"nucleotide-ring":(e,t)=>Fn("Nucleotide ring mesh",e,t,H1e),"nucleotide-atomic-ring-fill":(e,t)=>Fn("Nucleotide atomic ring fill",e,t,K1e),"nucleotide-atomic-bond":(e,t)=>Fn("Nucleotide atomic bond",e,t,X1e),"nucleotide-atomic-element":(e,t)=>Fn("Nucleotide atomic element",e,t,Y1e),"direction-wedge":(e,t)=>Fn("Polymer direction wedge",e,t,nxe)},pxe={...F8,...j1,...b8,...x8,...EL,...PL,...A8,...T8,sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),visuals:M.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring","nucleotide-atomic-ring-fill","nucleotide-atomic-bond","nucleotide-atomic-element"],M.objectToOptions(mxe)),bumpFrequency:M.Numeric(2,{min:0,max:10,step:.1},at.ShadingCategory),colorMode:M.Select("default",M.arrayToOptions(["default","interpolate"]),{...at.ShadingCategory,isHidden:!0})};function $rt(e,t){let r=M.clone(pxe),n=!1,o=!1;return t.units.forEach(i=>{!n&&Le.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!o&&i.gapElements.length&&(o=!0)}),r.visuals.defaultValue=["polymer-trace"],n&&r.visuals.defaultValue.push("nucleotide-ring"),o&&r.visuals.defaultValue.push("polymer-gap"),r}function Wrt(e,t){return Wt.createMulti("Cartoon",e,t,so,mxe)}var fxe={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:Wrt,getParams:$rt,defaultValues:M.getDefaultValues(pxe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0,ensureCustomProperties:{attach:async(e,t)=>{await tl.attach(e,t,void 0,!0);for(let r of t.models)await rT.attach(e,r,void 0,!0)},detach:e=>{tl.ref(e,!1);for(let t of e.models)rT.ref(t,!1)}}};var O8={...Xn,sizeFactor:M.Numeric(1,{min:0,max:10,step:.1}),detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),ignoreHydrogens:M.Boolean(!1)};function hxe(e){return xo({defaultProps:M.getDefaultValues(O8),createGeometry:qrt,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.ignoreHydrogens!==n.ignoreHydrogens}},e)}function qrt(e,t,r,n,o,i){let{child:s}=r,a=s?.unitMap.get(t.id);if(s&&!a)return Ct.createEmpty(i);let{detail:l,sizeFactor:c,ignoreHydrogens:u}=o,{elements:d,model:m}=t,{atomicNumber:p}=t.model.atomicHierarchy.derived.atom,h=d.length,f=h*Fp(l),C=gt.createState(f,f/2,i),g=ju.Provider.get(m);if(!g)return Ct.createEmpty(i);let b=D(),y=nr(),x=D(),A=D(),v=D(),{elementToAnsiotrop:_,data:I}=g,{U:T}=I,E=I._schema.U.space,w=t.conformation,S=ce.Location.create(r);S.unit=t;for(let L=0;L<h;L++){let R=d[L],N=_[R];if(N!==-1&&!(a&&!Qe.has(a.elements,R)||u&&Xpe(p,R))){S.element=R,w.invariantPosition(R,b),C.currentGroup=L,cr.toMat3(y,E,T.value(N)),nr.symmtricFromLower(y,y),nr.symmetricEigenvalues(x,y),nr.eigenvector(A,y,x[1]),nr.eigenvector(v,y,x[2]);for(let F=0;F<3;++F)x[F]=c*1.5958*Math.sqrt(Math.abs(x[F]));oo(x[0],x[1],1e-6)&&oo(x[1],x[2],1e-6)?Rr(C,b,x[0],l):Ay(C,b,v,A,x,l)}}let P=gt.getMesh(C),k=Pe.expand(Pe(),(a||t).boundary.sphere,1*c);return P.setBoundingSphere(k),P}var gxe={"ellipsoid-mesh":(e,t)=>Fn("Ellipsoid Mesh",e,t,hxe),"intra-bond":(e,t)=>Fn("Intra-unit bond cylinder",e,t,eL),"inter-bond":(e,t)=>us("Inter-unit bond cylinder",e,t,tL)},yxe={...O8,...rI,...nI,includeParent:M.Boolean(!1),adjustCylinderLength:M.Boolean(!1,{isHidden:!0}),unitKinds:Fg(["atomic"]),sizeFactor:M.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:M.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:M.Boolean(!0),visuals:M.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],M.objectToOptions(gxe)),bumpFrequency:M.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory)};function Zrt(e,t){return yxe}function Krt(e,t){return Wt.createMulti("Ellipsoid",e,t,so,gxe)}var vxe={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:Krt,getParams:Zrt,defaultValues:M.getDefaultValues(yxe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&e.models.some(t=>ju.Provider.isApplicable(t)),getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};var bxe=`
precision highp float;

attribute vec3 aPosition;
attribute float aRadius;

varying vec3 vPosition;
varying float vRadiusSqInv;

#if defined(dCalcType_groupId)
    attribute float aGroup;
    varying float vGroup;
#endif

uniform vec3 uBboxSize;
uniform vec3 uBboxMin;
uniform float uResolution;

void main() {
    vRadiusSqInv = 1.0 / (aRadius * aRadius);
    #if defined(dCalcType_groupId)
        vGroup = aGroup;
    #endif
    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);
    vPosition = (aPosition - uBboxMin) / uResolution;
    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);
}
`;var xxe=`
precision highp float;

varying vec3 vPosition;
varying float vRadiusSqInv;
#if defined(dCalcType_groupId)
    #if defined(dGridTexType_2d)
        precision highp sampler2D;
        uniform sampler2D tMinDistanceTex;
        uniform vec3 uGridTexDim;
    #elif defined(dGridTexType_3d)
        precision highp sampler3D;
        uniform sampler3D tMinDistanceTex;
    #endif
    varying float vGroup;
#endif

#include common

uniform vec3 uGridDim;
uniform vec2 uGridTexScale;
uniform float uCurrentSlice;
uniform float uCurrentX;
uniform float uCurrentY;
uniform float uAlpha;
uniform float uResolution;
uniform float uRadiusFactorInv;

void main() {
    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;
    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);
    float dist = distance(fragPos, vPosition) * uResolution;

    #if defined(dCalcType_density)
        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));
        gl_FragColor.a = density * uRadiusFactorInv;
    #elif defined(dCalcType_minDistance)
        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;
    #elif defined(dCalcType_groupId)
        #if defined(dGridTexType_2d)
            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;
        #elif defined(dGridTexType_3d)
            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;
        #endif
        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)
            discard;
        gl_FragColor.rgb = packIntToRGB(vGroup);
    #endif
}
`;var Xrt={drawCount:jn("number"),instanceCount:jn("number"),aRadius:cn("float32",1,0),aPosition:cn("float32",3,0),aGroup:cn("float32",1,0),uCurrentSlice:Re("f"),uCurrentX:Re("f"),uCurrentY:Re("f"),uBboxMin:Re("v3","material"),uBboxSize:Re("v3","material"),uGridDim:Re("v3","material"),uGridTexDim:Re("v3","material"),uGridTexScale:Re("v2","material"),uAlpha:Re("f","material"),uResolution:Re("f","material"),uRadiusFactorInv:Re("f","material"),tMinDistanceTex:kt("texture","rgba","float","nearest","material"),dGridTexType:Bt("string",["2d","3d"]),dCalcType:Bt("string",["density","minDistance","groupId"])},Eh="gaussian-density";function Cxe(e){return e.namedFramebuffers[Eh]||(e.namedFramebuffers[Eh]=e.resources.framebuffer()),e.namedFramebuffers[Eh]}function Sxe(e,t,r,n,o,i){let s=`${Eh}-${e}`;return t.namedTextures[s]||(t.namedTextures[s]=t.resources.texture(r,n,o,i)),t.namedTextures[s]}function V8(e,t,r,n,o,i){return e.isWebGL2?Yrt(e,t,r,n,o,i):BL(e,t,r,n,!1,o,i)}function BL(e,t,r,n,o,i,s){bt&&e.timer.mark("GaussianDensityTexture2d");let a=Jrt(e,t,r,n,o,i,s);return bt&&e.timer.markEnd("GaussianDensityTexture2d"),Ixe(a)}function Yrt(e,t,r,n,o,i){bt&&e.timer.mark("GaussianDensityTexture3d");let s=ent(e,t,r,n,o,i);return bt&&e.timer.markEnd("GaussianDensityTexture3d"),Ixe(s)}function Ixe({texture:e,scale:t,bbox:r,gridDim:n,gridTexDim:o,gridTexScale:i,radiusFactor:s,resolution:a,maxRadius:l}){return{transform:Qrt(t,r),texture:e,bbox:r,gridDim:n,gridTexDim:o,gridTexScale:i,radiusFactor:s,resolution:a,maxRadius:l}}function Qrt(e,t){let r=de.identity();return de.fromScaling(r,e),de.setTranslation(r,t.min),r}function Jrt(e,t,r,n,o,i,s){let{gl:a,resources:l,state:c,extensions:{colorBufferFloat:u,textureFloat:d,colorBufferHalfFloat:m,textureHalfFloat:p,blendMinMax:h}}=e,{smoothness:f,resolution:C}=i,{drawCount:g,positions:b,radii:y,groups:x,scale:A,expandedBox:v,dim:_,maxRadius:I}=Axe(t,r,n,i),[T,E,w]=_,{texDimX:S,texDimY:P,texCols:k,powerOfTwoSize:L}=rnt(_),R=D.create(S,P,0),N=Ve.create(S/L,P/L),F=I*2,H=o?L:S,V=o?L:P,q=Sxe("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");q.define(H,V);let Q=wxe(e,g,b,y,x,q,v,_,R,N,f,C,F),{uCurrentSlice:O,uCurrentX:B,uCurrentY:j}=Q.values,U=Cxe(e);U.bind(),_xe(e),s||(s=m&&p?l.texture("image-float16","rgba","fp16","linear"):u&&d?l.texture("image-float32","rgba","float","linear"):l.texture("image-uint8","rgba","ubyte","linear")),s.define(H,V);function z($,Z){c.currentRenderItemId=-1,$.attachFramebuffer(U,0),Z&&(c.viewport(0,0,H,V),c.scissor(0,0,H,V),a.clear(a.COLOR_BUFFER_BIT)),G.update(j,0);let J=0,ie=0,ne=0;for(let le=0;le<w;++le)J>=k&&(J-=k,ie+=E,ne=0,G.update(j,ie)),G.update(B,ne),G.update(O,le),c.viewport(ne,ie,T,E),c.scissor(ne,ie,T,E),Q.render(),++J,ne+=T;a.flush()}return Exe(e,Q),z(s,!0),h&&(Txe(e,Q),z(q,!0),Pxe(e,Q),z(s,!1)),{texture:s,scale:A,bbox:v,gridDim:_,gridTexDim:R,gridTexScale:N,radiusFactor:F,resolution:C,maxRadius:I}}function ent(e,t,r,n,o,i){let{gl:s,resources:a,state:l,extensions:{colorBufferFloat:c,textureFloat:u,colorBufferHalfFloat:d,textureHalfFloat:m}}=e,{smoothness:p,resolution:h}=o,{drawCount:f,positions:C,radii:g,groups:b,scale:y,expandedBox:x,dim:A,maxRadius:v}=Axe(t,r,n,o),[_,I,T]=A,E=Sxe("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");E.define(_,I,T);let w=Ve.create(1,1),S=v*2,P=wxe(e,f,C,g,b,E,x,A,A,w,p,h,S),{uCurrentSlice:k}=P.values,L=Cxe(e);L.bind(),_xe(e),l.viewport(0,0,_,I),l.scissor(0,0,_,I),i||(i=d&&m?a.texture("volume-float16","rgba","fp16","linear"):c&&u?a.texture("volume-float32","rgba","float","linear"):a.texture("volume-uint8","rgba","ubyte","linear")),i.define(_,I,T);function R(N,F){l.currentRenderItemId=-1;for(let H=0;H<T;++H)G.update(k,H),N.attachFramebuffer(L,0,H),F&&s.clear(s.COLOR_BUFFER_BIT),P.render();s.flush()}return Exe(e,P),R(i,!0),Txe(e,P),R(E,!0),Pxe(e,P),R(i,!1),{texture:i,scale:y,bbox:x,gridDim:A,gridTexDim:A,gridTexScale:w,radiusFactor:S,resolution:h,maxRadius:v}}function Axe(e,t,r,n){let{resolution:o,radiusOffset:i}=n,s=1/o,{indices:a,x:l,y:c,z:u,id:d}=e,m=Ge.size(a),p=new Float32Array(m*3),h=new Float32Array(m),f=new Float32Array(m),C=0;for(let v=0;v<m;++v){let _=Ge.getAt(a,v);p[v*3]=l[_],p[v*3+1]=c[_],p[v*3+2]=u[_];let I=r(_)+i;C<I&&(C=I),h[v]=I,f[v]=d?d[v]:v}let g=C*2+o*4,b=xt.expand(xt(),t,D.create(g,g,g)),y=xt.scale(xt(),b,s),x=xt.size(D(),y);D.ceil(x,x);let A=D.create(o,o,o);return{drawCount:m,positions:p,radii:h,groups:f,scale:A,expandedBox:b,dim:x,maxRadius:C}}function wxe(e,t,r,n,o,i,s,a,l,c,u,d,m){if(e.namedComputeRenderables[Eh]){let p=D.sub(D(),s.max,s.min),h=e.namedComputeRenderables[Eh].values;G.updateIfChanged(h.drawCount,t),G.updateIfChanged(h.instanceCount,1),G.update(h.aRadius,n),G.update(h.aPosition,r),G.update(h.aGroup,o),G.updateIfChanged(h.uCurrentSlice,0),G.updateIfChanged(h.uCurrentX,0),G.updateIfChanged(h.uCurrentY,0),G.update(h.uBboxMin,s.min),G.update(h.uBboxSize,p),G.update(h.uGridDim,a),G.update(h.uGridTexDim,l),G.update(h.uGridTexScale,c),G.updateIfChanged(h.uAlpha,u),G.updateIfChanged(h.uResolution,d),G.updateIfChanged(h.uRadiusFactorInv,1/m),G.update(h.tMinDistanceTex,i),G.updateIfChanged(h.dGridTexType,i.getDepth()>0?"3d":"2d"),G.updateIfChanged(h.dCalcType,"density"),e.namedComputeRenderables[Eh].update()}else e.namedComputeRenderables[Eh]=tnt(e,t,r,n,o,i,s,a,l,c,u,d,m);return e.namedComputeRenderables[Eh]}function tnt(e,t,r,n,o,i,s,a,l,c,u,d,m){let p=D.sub(D(),s.max,s.min),h={drawCount:G.create(t),instanceCount:G.create(1),aRadius:G.create(n),aPosition:G.create(r),aGroup:G.create(o),uCurrentSlice:G.create(0),uCurrentX:G.create(0),uCurrentY:G.create(0),uBboxMin:G.create(s.min),uBboxSize:G.create(p),uGridDim:G.create(a),uGridTexDim:G.create(l),uGridTexScale:G.create(c),uAlpha:G.create(u),uResolution:G.create(d),uRadiusFactorInv:G.create(1/m),tMinDistanceTex:G.create(i),dGridTexType:G.create(i.getDepth()>0?"3d":"2d"),dCalcType:G.create("density")},f={...Xrt},C=Gr(Eh,bxe,xxe),g=on(e,"points",C,f,h);return sn(g,h)}function _xe(e){let{gl:t,state:r}=e;r.disable(t.CULL_FACE),r.enable(t.BLEND),r.disable(t.DEPTH_TEST),r.enable(t.SCISSOR_TEST),r.depthMask(!1),r.clearColor(0,0,0,0)}function Txe(e,t){let{gl:r,state:n}=e;if(G.update(t.values.dCalcType,"minDistance"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");n.blendEquation(e.extensions.blendMinMax.MAX)}function Exe(e,t){let{gl:r,state:n}=e;G.update(t.values.dCalcType,"density"),t.update(),n.colorMask(!1,!1,!1,!0),n.blendFunc(r.ONE,r.ONE),n.blendEquation(r.FUNC_ADD)}function Pxe(e,t){let{gl:r,state:n}=e;G.update(t.values.dCalcType,"groupId"),t.update(),n.colorMask(!0,!0,!0,!1),n.blendFunc(r.ONE,r.ZERO),n.blendEquation(r.FUNC_ADD)}function rnt(e){let t=e[0]*e[1]*e[2],r=Math.sqrt(t),n=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))),o=0,i=e[1],s=1,a=e[2];return n<e[0]*e[2]?(a=Math.floor(n/e[0]),s=Math.ceil(e[2]/a),o=a*e[0],i*=s):o=e[0]*e[2],{texDimX:o,texDimY:i,texRows:s,texCols:a,powerOfTwoSize:i<n?n:n*2}}async function G8(e,t,r,n,o){let{resolution:i,radiusOffset:s,smoothness:a}=o,l=1/i,{indices:c,x:u,y:d,z:m,id:p}=t,h=Ge.size(c),f=new Float32Array(h),C=0;for(let U=0;U<h;++U){let z=n(Ge.getAt(c,U))+s;C<z&&(C=z),f[U]=z}let g=C*2+i,b=xt.expand(xt(),r,D.create(g,g,g)),y=b.min,x=xt.scale(xt(),b,l),A=xt.size(D(),x);D.ceil(A,A);let v=cr.Space(A,[0,1,2],Float32Array),_=v.create(),I=cr.create(v,_),T=v.create();T.fill(-1);let E=cr.create(v,T),[w,S,P]=A,k=P,L=S,R=k*L,N=lm(A[0],y[0],i),F=lm(A[1],y[1],i),H=lm(A[2],y[2],i),V=v.create(),q=a,Q=Math.ceil(1e5/(Math.pow(Math.pow(C,3),3)*l));function O(U,z){for(let $=U;$<z;++$){let Z=Ge.getAt(c,$),J=u[Z],ie=d[Z],ne=m[Z],le=f[$],oe=1/(le*le),te=le*2,X=te*te,W=Math.ceil(te*l),K=Math.floor(l*(J-y[0])),re=Math.floor(l*(ie-y[1])),se=Math.floor(l*(ne-y[2])),me=Math.max(0,K-W),Y=Math.max(0,re-W),ae=Math.max(0,se-W),ve=Math.min(w,K+W+2),ge=Math.min(S,re+W+2),Se=Math.min(P,se+W+2);for(let Ee=me;Ee<ve;++Ee){let Fe=N[Ee]-J,Ae=Ee*R;for(let we=Y;we<ge;++we){let _e=F[we]-ie,Ke=Fe*Fe+_e*_e,rt=we*k+Ae;for(let pt=ae;pt<Se;++pt){let Ne=H[pt]-ne,je=Ke+Ne*Ne;if(je<=X){let Ye=vme(-q*(je*oe)),mt=pt+rt;_[mt]+=Ye,Ye>V[mt]&&(V[mt]=Ye,T[mt]=p?p[$]:$)}}}}}}async function B(){for(let U=0;U<h;U+=Q)O(U,Math.min(U+Q,h)),e.shouldUpdate&&await e.update({message:"filling density grid",current:U,max:h})}await B();let j=de.identity();return de.fromScaling(j,D.create(i,i,i)),de.setTranslation(j,b.min),{field:I,idField:E,transform:j,radiusFactor:1,resolution:i,maxRadius:C}}var Tv={resolution:M.Numeric(1,{min:.1,max:20,step:.1},{description:"Grid resolution/cell spacing.",...at.CustomQualityParamInfo}),radiusOffset:M.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:M.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."}),...a1},wZr=M.getDefaultValues(Tv);function Dxe(e,t){let r=e.maxTextureSize/3;return r*r/Math.max(1,t?t.units.length/16:1)}function LL(e,t,r,n){let{position:o,boundary:i,radius:s}=pS(e,t,r,n),a=Lm(i.box,n);return ke.create("Gaussian Density",async l=>await G8(l,o,i.box,s,a))}function kxe(e,t,r,n,o,i){let{position:s,boundary:a,radius:l}=pS(e,t,r,n),c=Lm(a.box,n,Dxe(o,e));return ke.create("Gaussian Density",async u=>V8(o,s,a.box,l,c,i))}function Mxe(e,t,r,n,o,i,s){let{position:a,boundary:l,radius:c}=pS(e,t,r,o),u=Lm(l.box,o,Dxe(i,e));return ke.create("Gaussian Density",async d=>BL(i,a,l.box,c,n,u,s))}function Rxe(e,t,r){let{position:n,boundary:o,radius:i}=fS(e,t,r),s=Lm(o.box,r);return ke.create("Gaussian Density",async a=>await G8(a,n,o.box,i,s))}function Bxe(e,t,r,n,o){let{position:i,boundary:s,radius:a}=fS(e,t,r),l=Lm(s.box,r);return ke.create("Gaussian Density",async c=>V8(n,i,s.box,a,l,o))}function Lxe(e,t,r,n,o,i){let{box:s}=e.lookup3d.boundary,{position:a,boundary:l,radius:c}=fS(e,t,n),u=Lm(l.box,n);return ke.create("Gaussian Density",async d=>BL(o,a,s,c,r,u,i))}var Nxe={...Tv,...g3,ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),tryUseGpu:M.Boolean(!0),includeParent:M.Boolean(!1,{isHidden:!0})},NL={...Xn,...ffe,...Nxe},Fxe={...Nm,...lfe,...Nxe};function Oxe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.textureFloatLinear&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function NI(e,t,r){if(t.resolution>1)return!1;let n=r.maxTextureSize/3,{areaCells:o,maxAreaCells:i}=rz(e.boundary.box,t.resolution,n*n);return o<i}function Vxe(e,t,r,n){return r.tryUseGpu&&n&&Oxe(n)&&NI(t,r,n)?lnt(e):ont(e)}function Gxe(e,t,r,n){return r.tryUseGpu&&n&&Oxe(n)&&NI(t,r,n)?unt(e):snt(e)}async function nnt(e,t,r,n,o,i){let{smoothness:s}=o,{transform:a,field:l,idField:c,radiusFactor:u,resolution:d,maxRadius:m}=await LL(r,t,n.size,o).runInContext(e.runtime),p={isoLevel:Math.exp(-s)/u,scalarField:l,idField:c},h=await Vm(p,i).runAsChild(e.runtime);h.meta.resolution=d,Ct.transform(h,a),e.webgl&&!e.webgl.isWebGL2?(Ct.uniformTriangleGroup(h),G.updateIfChanged(h.varyingGroup,!1)):G.updateIfChanged(h.varyingGroup,!0);let f=Pe.expand(Pe(),t.boundary.sphere,m);return h.setBoundingSphere(f),h}function ont(e){return xo({defaultProps:M.getDefaultValues(NL),createGeometry:nnt,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&NI(t.structure,r,n),processValues:(t,r,n,o,i)=>{let{resolution:s,colorTexture:a}=r.meta,l=rc(n.smoothColors,o.color.preferSmoothing,s);l&&(jC(t,l.resolution,l.stride,i,a),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}async function int(e,t,r,n,o){let{smoothness:i}=n,{transform:s,field:a,idField:l,radiusFactor:c,resolution:u,maxRadius:d}=await Rxe(t,r.size,n).runInContext(e.runtime),m={isoLevel:Math.exp(-i)/c,scalarField:a,idField:l},p=await Vm(m,o).runAsChild(e.runtime);p.meta.resolution=u,Ct.transform(p,s),e.webgl&&!e.webgl.isWebGL2?(Ct.uniformTriangleGroup(p),G.updateIfChanged(p.varyingGroup,!1)):G.updateIfChanged(p.varyingGroup,!0);let h=Pe.expand(Pe(),t.boundary.sphere,d);return p.setBoundingSphere(h),p}function snt(e){return Ol({defaultProps:M.getDefaultValues(Fxe),createGeometry:int,createLocationIterator:yi.fromStructure,getLoci:Zm,eachLocation:qm,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>r.tryUseGpu&&!!n&&NI(t,r,n),processValues:(t,r,n,o,i)=>{let{resolution:s,colorTexture:a}=r.meta,l=rc(n.smoothColors,o.color.preferSmoothing,s);l&&(jC(t,l.resolution,l.stride,i,a),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var LI="gaussian-surface";async function ant(e,t,r,n,o,i){if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");bt&&e.webgl.timer.mark("createGaussianSurfaceTextureMesh");let{namedTextures:s,resources:a,extensions:{colorBufferFloat:l,textureFloat:c,colorBufferHalfFloat:u,textureHalfFloat:d}}=e.webgl;s[LI]||(s[LI]=u&&d?a.texture("image-float16","rgba","fp16","linear"):l&&c?a.texture("image-float32","rgba","float","linear"):a.texture("image-uint8","rgba","ubyte","linear"));let m=await Mxe(r,t,n.size,!0,o,e.webgl,s[LI]).runInContext(e.runtime),p=Math.exp(-o.smoothness)/m.radiusFactor,h=D.create(0,1,2),f=i?.doubleBuffer.get(),C=M1(e.webgl,m.texture,m.gridDim,m.gridTexDim,m.gridTexScale,m.transform,p,!1,!0,h,!0,f?.vertex,f?.group,f?.normal);bt&&e.webgl.timer.markEnd("createGaussianSurfaceTextureMesh");let g=t.elements.length,b=Pe.expand(Pe(),t.boundary.sphere,m.maxRadius),y=Ns.create(C.vertexCount,g,C.vertexTexture,C.groupTexture,C.normalTexture,b,i);return y.meta.resolution=m.resolution,y.meta.webgl=e.webgl,y}function lnt(e){return hfe({defaultProps:M.getDefaultValues(NL),createGeometry:ant,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!NI(t.structure,r,n),processValues:(t,r,n,o,i)=>{let{resolution:s,colorTexture:a}=r.meta,l=rc(n.smoothColors,o.color.preferSmoothing,s);l&&i&&(FU(t,l.resolution,l.stride,i,a),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}async function cnt(e,t,r,n,o){if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");bt&&e.webgl.timer.mark("createStructureGaussianSurfaceTextureMesh");let{namedTextures:i,resources:s,extensions:{colorBufferFloat:a,textureFloat:l,colorBufferHalfFloat:c,textureHalfFloat:u}}=e.webgl;i[LI]||(i[LI]=c&&u?s.texture("image-float16","rgba","fp16","linear"):a&&l?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear"));let d=await Lxe(t,r.size,!0,n,e.webgl,i[LI]).runInContext(e.runtime),m=Math.exp(-n.smoothness)/d.radiusFactor,p=D.create(0,1,2),h=o?.doubleBuffer.get(),f=M1(e.webgl,d.texture,d.gridDim,d.gridTexDim,d.gridTexScale,d.transform,m,!1,!0,p,!0,h?.vertex,h?.group,h?.normal);bt&&e.webgl.timer.markEnd("createStructureGaussianSurfaceTextureMesh");let C=t.elementCount,g=Pe.expand(Pe(),t.boundary.sphere,d.maxRadius),b=Ns.create(f.vertexCount,C,f.vertexTexture,f.groupTexture,f.normalTexture,g,o);return b.meta.resolution=d.resolution,b.meta.webgl=e.webgl,b}function unt(e){return cfe({defaultProps:M.getDefaultValues(Fxe),createGeometry:cnt,createLocationIterator:yi.fromStructure,getLoci:Zm,eachLocation:qm,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,r,n)=>!r.tryUseGpu||!n||!NI(t,r,n),processValues:(t,r,n,o,i)=>{let{resolution:s,colorTexture:a}=r.meta,l=rc(n.smoothColors,o.color.preferSmoothing,s);l&&i&&(FU(t,l.resolution,l.stride,i,a),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var r;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}async function dnt(e,t,r,n,o,i){let{smoothness:s}=o,{transform:a,field:l,idField:c,maxRadius:u}=await LL(r,t,n.size,o).runInContext(e.runtime),d={isoLevel:Math.exp(-s),scalarField:l,idField:c},m=await AS(d,i).runAsChild(e.runtime);In.transform(m,a);let p=Pe.expand(Pe(),t.boundary.sphere,u);return m.setBoundingSphere(p),m}var U8={...Hy,...Tv,sizeFactor:M.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:M.Boolean(!1),ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),includeParent:M.Boolean(!1,{isHidden:!0})};function Uxe(e){return jy({defaultProps:M.getDefaultValues(U8),createGeometry:dnt,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var zxe={"gaussian-surface-mesh":(e,t)=>Fn("Gaussian surface mesh",e,t,Vxe),"structure-gaussian-surface-mesh":(e,t)=>us("Structure-Gaussian surface mesh",e,t,Gxe),"gaussian-surface-wireframe":(e,t)=>Fn("Gaussian surface wireframe",e,t,Uxe)},Hxe={...NL,...U8,visuals:M.MultiSelect(["gaussian-surface-mesh"],M.objectToOptions(zxe)),bumpFrequency:M.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)};function mnt(e,t){return Hxe}function pnt(e,t){return Wt.createMulti("Gaussian Surface",e,t,so,zxe)}var jxe={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:pnt,getParams:mnt,defaultValues:M.getDefaultValues(Hxe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var z8={...ofe,background:M.Boolean(!1),backgroundMargin:M.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:M.Color(Gt.black),backgroundOpacity:M.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:M.Numeric(.25,{min:0,max:.5,step:.01}),level:M.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),chainScale:M.Numeric(10,{min:0,max:20,step:.1}),residueScale:M.Numeric(1,{min:0,max:20,step:.1}),elementScale:M.Numeric(.5,{min:0,max:20,step:.1})};function $xe(e){return ife({defaultProps:M.getDefaultValues(z8),createGeometry:fnt,createLocationIterator:yi.fromStructure,getLoci:Zm,eachLocation:qm,setUpdateState:(t,r,n)=>{t.createGeometry=r.level!==n.level||r.level==="chain"&&r.chainScale!==n.chainScale||r.level==="residue"&&r.residueScale!==n.residueScale||r.level==="element"&&r.elementScale!==n.elementScale||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant}},e)}function fnt(e,t,r,n,o){switch(n.level){case"chain":return hnt(e,t,r,n,o);case"residue":return gnt(e,t,r,n,o);case"element":return ynt(e,t,r,n,o)}}var dp=D(),cT=new is("98");function hnt(e,t,r,n,o){let i=ce.Location.create(t),{units:s,serialMapping:a}=t,{auth_asym_id:l,label_asym_id:c}=nt.chain,{cumulativeUnitElementCount:u}=a,d=s.length,{chainScale:m}=n,p=kc.create(n,d,d/2,o);for(let h=0,f=s.length;h<f;++h){let C=s[h];i.unit=C,i.element=C.elements[0];let{center:g,radius:b}=C.lookup3d.boundary.sphere;D.transformMat4(dp,g,C.conformation.operator.matrix);let y=l(i),x=c(i),A=y===x?x:`${x} [${y}]`;p.add(A,dp[0],dp[1],dp[2],b,m,u[h])}return p.getText()}function gnt(e,t,r,n,o){let i=ce.Location.create(t),{units:s,serialMapping:a}=t,{label_comp_id:l}=nt.atom,{auth_seq_id:c}=nt.residue,{cumulativeUnitElementCount:u}=a,d=t.polymerResidueCount*2,{residueScale:m}=n,p=kc.create(n,d,d/2,o);for(let h=0,f=s.length;h<f;++h){let C=s[h],g=C.conformation,{elements:b}=C;i.unit=C,i.element=C.elements[0];let y=C.model.atomicHierarchy.residueAtomSegments.index,x=u[h],A=0,v=b.length;for(;A<v;){let _=A,I=y[b[A]];for(A++;A<v&&y[b[A]]===I;)A++;cT.reset();for(let k=_;k<A;k++)g.position(b[k],dp),cT.includePosition(dp);cT.finishedIncludeStep();for(let k=_;k<A;k++)g.position(b[k],dp),cT.radiusPosition(dp);i.element=b[_];let{center:T,radius:E}=cT.getSphere(),w=c(i),P=`${l(i)} ${w}`;p.add(P,T[0],T[1],T[2],E,m,x+_)}}return p.getText()}function ynt(e,t,r,n,o){let i=ce.Location.create(t),{units:s,serialMapping:a}=t,{label_atom_id:l,label_alt_id:c}=nt.atom,{cumulativeUnitElementCount:u}=a,d=r.size,m=t.elementCount,{elementScale:p}=n,h=kc.create(n,m,m/2,o);for(let f=0,C=s.length;f<C;++f){let g=s[f],b=g.conformation,{elements:y}=g;i.unit=g;let x=u[f],A=vh(t,g,{...n,traceOnly:!1});for(let v=0,_=y.length;v<_;v++){if(A&&A(y[v]))continue;i.element=y[v],b.position(i.element,dp);let I=l(i),T=c(i),E=T?`${I}%${T}`:I;h.add(E,dp[0],dp[1],dp[2],d.size(i),p,x+v)}}return h.getText()}var Wxe={"label-text":(e,t)=>us("Label text",e,t,$xe)},qxe={...z8,visuals:M.MultiSelect(["label-text"],M.objectToOptions(Wxe))};function vnt(e,t){return qxe}function bnt(e,t){let r=Wt.createMulti("Label",e,t,so,Wxe);return r.setState({pickable:!1,markerActions:zt.None}),r}var Zxe={name:"label",label:"Label",description:"Displays labels.",factory:bnt,getParams:vnt,defaultValues:M.getDefaultValues(qxe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};function xnt(e,t,r,n){let{probeRadius:o}=n,{position:i,boundary:s,radius:a}=pS(e,t,r,n),{indices:l}=i,c=Ge.size(l),u=new Float32Array(Ge.end(l)),d=0;for(let m=0;m<c;++m){let p=Ge.getAt(l,m),h=a(p);d<h&&(d=h),u[p]=h+o}return{position:{...i,radius:u},boundary:s,maxRadius:d}}function FL(e,t,r,n){let{position:o,boundary:i,maxRadius:s}=xnt(e,t,r,n),a=Lm(i.box,n);return ke.create("Molecular Surface",async l=>await Xxe(l,o,i,s,i.box,a))}function Cnt(e,t,r){let{probeRadius:n}=r,{position:o,boundary:i,radius:s}=fS(e,t,r),{indices:a}=o,l=Ge.size(a),c=new Float32Array(Ge.end(a)),u=0;for(let d=0;d<l;++d){let m=Ge.getAt(a,d),p=s(m);u<p&&(u=p),c[m]=p+n}return{position:{...o,radius:c},boundary:i,maxRadius:u}}function Kxe(e,t,r){let{position:n,boundary:o,maxRadius:i}=Cnt(e,t,r),s=Lm(o.box,r);return ke.create("Molecular Surface",async a=>await Xxe(a,n,o,i,o.box,s))}async function Xxe(e,t,r,n,o,i){return xhe(e,t,r,n,o,i)}var OL={...Xn,...Vw,...a1,...g3};async function Snt(e,t,r,n,o,i){let{transform:s,field:a,idField:l,resolution:c,maxRadius:u}=await FL(r,t,n.size,o).runInContext(e.runtime),d={isoLevel:o.probeRadius,scalarField:a,idField:l},m=await Vm(d,i).runAsChild(e.runtime);if(o.includeParent){let h=Math.ceil(2/o.resolution);Ct.smoothEdges(m,{iterations:h,maxNewEdgeLength:Math.sqrt(2)})}Ct.transform(m,s),e.webgl&&!e.webgl.isWebGL2?(Ct.uniformTriangleGroup(m),G.updateIfChanged(m.varyingGroup,!1)):G.updateIfChanged(m.varyingGroup,!0);let p=Pe.expand(Pe(),t.boundary.sphere,u);return m.setBoundingSphere(p),m.meta.resolution=c,m}function Yxe(e){return xo({defaultProps:M.getDefaultValues(OL),createGeometry:Snt,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:(t,r,n,o,i)=>{let{resolution:s,colorTexture:a}=r.meta,l=rc(n.smoothColors,o.color.preferSmoothing,s);l&&(jC(t,l.resolution,l.stride,i,a),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}async function Int(e,t,r,n,o){let{transform:i,field:s,idField:a,resolution:l,maxRadius:c}=await Kxe(t,r.size,n).runInContext(e.runtime),u={isoLevel:n.probeRadius,scalarField:s,idField:a},d=await Vm(u,o).runAsChild(e.runtime);if(n.includeParent){let p=Math.ceil(2/n.resolution);Ct.smoothEdges(d,{iterations:p,maxNewEdgeLength:Math.sqrt(2)})}Ct.transform(d,i),e.webgl&&!e.webgl.isWebGL2?(Ct.uniformTriangleGroup(d),G.updateIfChanged(d.varyingGroup,!1)):G.updateIfChanged(d.varyingGroup,!0);let m=Pe.expand(Pe(),t.boundary.sphere,c);return d.setBoundingSphere(m),d.meta.resolution=l,d}function Qxe(e){return Ol({defaultProps:M.getDefaultValues(OL),createGeometry:Int,createLocationIterator:yi.fromStructure,getLoci:Zm,eachLocation:qm,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0),r.smoothColors.name!==n.smoothColors.name?t.updateColor=!0:r.smoothColors.name==="on"&&n.smoothColors.name==="on"&&(r.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(t.updateColor=!0),r.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:(t,r,n,o,i)=>{let{resolution:s,colorTexture:a}=r.meta,l=rc(n.smoothColors,o.color.preferSmoothing,s);l&&(jC(t,l.resolution,l.stride,i,a),r.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var r;(r=t.meta.colorTexture)===null||r===void 0||r.destroy()}},e)}var H8={...Hy,...Vw,...a1,sizeFactor:M.Numeric(1.5,{min:0,max:10,step:.1})};async function Ant(e,t,r,n,o,i){let{transform:s,field:a,idField:l,maxRadius:c}=await FL(r,t,n.size,o).runInContext(e.runtime),u={isoLevel:o.probeRadius,scalarField:a,idField:l},d=await AS(u,i).runAsChild(e.runtime);In.transform(d,s);let m=Pe.expand(Pe(),t.boundary.sphere,c);return d.setBoundingSphere(m),d}function Jxe(e){return jy({defaultProps:M.getDefaultValues(H8),createGeometry:Ant,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.probeRadius!==n.probeRadius&&(t.createGeometry=!0),r.probePositions!==n.probePositions&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)}},e)}var eCe={"molecular-surface-mesh":(e,t)=>Fn("Molecular surface mesh",e,t,Yxe),"structure-molecular-surface-mesh":(e,t)=>us("Structure Molecular surface mesh",e,t,Qxe),"molecular-surface-wireframe":(e,t)=>Fn("Molecular surface wireframe",e,t,Jxe)},tCe={...OL,...H8,visuals:M.MultiSelect(["molecular-surface-mesh"],M.objectToOptions(eCe)),bumpFrequency:M.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)};function wnt(e,t){return tCe}function _nt(e,t){return Wt.createMulti("Molecular Surface",e,t,so,eCe)}var rCe={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:_nt,getParams:wnt,defaultValues:M.getDefaultValues(tCe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var j8={...Xn,sizeFactor:M.Numeric(1,{min:0,max:2,step:.1}),detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo)};function nCe(e){return xo({defaultProps:M.getDefaultValues(j8),createGeometry:Ent,createLocationIterator:Pnt,getLoci:Dnt,eachLocation:knt,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail}},e)}function Tnt(e){if(Le.Traits.is(e.traits,Le.Trait.MultiChain)||Le.Traits.is(e.traits,Le.Trait.Partitioned))return!1;if(Le.isCoarse(e))return!0;if(e.elements.length===0)return!1;e.model.atomicHierarchy.derived.residue.moleculeType;let t=e.residueIndex[e.elements[0]],r=e.model.atomicHierarchy.derived.residue.moleculeType[t];return!(r===3||r===2)}function Ent(e,t,r,n,o,i){if(!Tnt(t))return Ct.createEmpty(i);let{detail:s,sizeFactor:a}=o,l=256,c=gt.createState(l,l/2,i),u=t.principalAxes.boxAxes,{origin:d,dirA:m,dirB:p}=u,h=os.size(D(),u);D.scale(h,h,a/2);let f=D.create(h[2],h[1],h[0]);c.currentGroup=0,Ay(c,d,m,p,f,s+1);let C=gt.getMesh(c),g=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return C.setBoundingSphere(g),C}function Pnt(e){let{group:t,structure:r}=e,n=1,o=t.units.length,i=ce.Location.create(r);return Mr(n,o,1,(a,l)=>{let c=t.units[l];return i.unit=c,i.element=c.elements[a],i})}function Dnt(e,t,r){let{objectId:n,instanceId:o}=e;if(r===n){let{structure:i,group:s}=t,a=s.units[o],l=Ge.ofBounds(0,a.elements.length);return ce.Loci(i,[{unit:a,indices:l}])}return pr}function knt(e,t,r){let n=!1;if(!ce.Loci.is(e))return!1;let{structure:o,group:i}=t;if(!qe.areEquivalent(e.structure,o))return!1;let s=i.elements.length;for(let a of e.elements){let l=i.unitIndexMap.get(a.unit.id);l!==void 0&&Ge.size(a.indices)===s&&r(Be.ofSingleton(l))&&(n=!0)}return n}var oCe={"orientation-ellipsoid-mesh":(e,t)=>Fn("Orientation ellipsoid mesh",e,t,nCe)},iCe={...j8,visuals:M.MultiSelect(["orientation-ellipsoid-mesh"],M.objectToOptions(oCe)),bumpFrequency:M.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory)};function Mnt(e,t){return iCe}function Rnt(e,t){return Wt.createMulti("Orientation",e,t,so,oCe)}var sCe={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:Rnt,getParams:Mnt,defaultValues:M.getDefaultValues(iCe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0};var Bnt=it.add3,Lnt=it.add,VL;(function(e){function t(r=2048,n=1024,o){let i=it.create(Float32Array,3,n,o?o.centerBuffer.ref.value:r),s=it.create(Float32Array,1,n,o?o.groupBuffer.ref.value:r);return{add:(a,l,c,u)=>{Bnt(i,a,l,c),Lnt(s,u)},getPoints:()=>{let a=it.compact(i,!0),l=it.compact(s,!0);return Gu.create(a,l,i.elementCount,o)}}}e.create=t})(VL||(VL={}));var aCe=D.add,uT={...ufe,pointSizeAttenuation:M.Boolean(!1),ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),traceOnly:M.Boolean(!1),stride:M.Numeric(1,{min:1,max:100,step:1})};function Nnt(e,t,r,n,o,i){let{child:s}=r;if(s&&!s.unitMap.get(t.id))return Gu.createEmpty(i);let a=t.elements,l=a.length,c=VL.create(l,l/10,i),u=D(),d=t.conformation,m=vh(r,t,o),p=D(),h=0;if(m)for(let b=0;b<l;++b)m(a[b])||(d.invariantPosition(a[b],u),aCe(p,p,u),h+=1,c.add(u[0],u[1],u[2],b));else for(let b=0;b<l;++b)d.invariantPosition(a[b],u),aCe(p,p,u),h+=1,c.add(u[0],u[1],u[2],b);let f=i?Pe.clone(i.boundingSphere):void 0,C=c.getPoints();if(h===0)return C;let g;return D.scale(p,p,1/h),f&&D.distance(p,f.center)/f.radius<.1?g=f:g=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor),C.setBoundingSphere(g),C}function GL(e){return dfe({defaultProps:M.getDefaultValues(uT),createGeometry:Nnt,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.stride!==n.stride}},e)}var Fnt={"element-point":(e,t)=>Fn("Points",e,t,GL)},lCe={...uT};function Ont(e,t){return lCe}function Vnt(e,t){return Wt.createMulti("Point",e,t,so,Fnt)}var cCe={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:Vnt,getParams:Ont,defaultValues:M.getDefaultValues(lCe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0};var uCe={sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),linearSegments:M.Numeric(8,{min:1,max:48,step:1},at.CustomQualityParamInfo),radialSegments:M.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo)},rYr=M.getDefaultValues(uCe),ud=D();function Gnt(e,t,r,n,o,i){let s=t.polymerElements.length;if(!s)return Ct.createEmpty(i);let{sizeFactor:a,detail:l,linearSegments:c,radialSegments:u}=o,d=c*u*s+(u+1)*s*2,m=gt.createState(d,d/10,i),p=uI(c),{curvePoints:h,normalVectors:f,binormalVectors:C,widthValues:g,heightValues:b}=p,y=0,x=sI(t,r,{ignoreSecondaryStructure:!0});for(;x.hasNext;){let _=x.move();m.currentGroup=y;let T=Wi(_.moleculeType)?G1:V1;dI(p,_,cL,T);let E=_.coarseBackboneFirst||_.first,w=_.coarseBackboneLast||_.last,S=n.size.size(_.centerPrev)*a,P=n.size.size(_.center)*a,k=n.size.size(_.centerNext)*a;oT(p,S,P,k,S,P,k,T);let L=c;if(_.initial){L=Math.max(Math.round(c*T),1);let R=c-L;h.copyWithin(0,R*3),C.copyWithin(0,R*3),f.copyWithin(0,R*3),g.copyWithin(0,R*3),b.copyWithin(0,R*3),D.fromArray(ud,h,3),D.normalize(ud,D.sub(ud,_.p2,ud)),D.scaleAndAdd(ud,_.p2,ud,P*mI),D.toArray(ud,h,0)}else _.final&&(L=Math.max(Math.round(c*(1-T)),1),D.fromArray(ud,h,L*3-3),D.normalize(ud,D.sub(ud,_.p2,ud)),D.scaleAndAdd(ud,_.p2,ud,P*mI),D.toArray(ud,h,L*3));_.initial===!0&&_.final===!0?Rr(m,_.p2,P*2,l):u===2?BI(m,h,f,C,L,g,b,0):u===4?MI(m,h,f,C,L,g,b,0,E,w):aT(m,h,f,C,L,u,g,b,E,w,"elliptical"),++y}let A=gt.getMesh(m),v=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return A.setBoundingSphere(v),A}var $8={...Xn,...uCe};function dCe(e){return xo({defaultProps:M.getDefaultValues($8),createGeometry:Gnt,createLocationIterator:t=>sd.fromGroup(t,{asSecondary:!0}),getLoci:Km,eachLocation:Xm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail||r.linearSegments!==n.linearSegments||r.radialSegments!==n.radialSegments}},e)}var mCe={"polymer-tube":(e,t)=>Fn("Polymer tube mesh",e,t,dCe),"polymer-gap":(e,t)=>Fn("Polymer gap cylinder",e,t,DI)},pCe={...$8,...j1,sizeFactor:M.Numeric(.2,{min:0,max:10,step:.01}),visuals:M.MultiSelect(["polymer-tube","polymer-gap"],M.objectToOptions(mCe)),bumpFrequency:M.Numeric(2,{min:0,max:10,step:.1},at.ShadingCategory)};function Unt(e,t){let r=M.clone(pCe),n=!1,o=!1;return t.units.forEach(i=>{!n&&Le.isAtomic(i)&&i.nucleotideElements.length&&(n=!0),!o&&i.gapElements.length&&(o=!0)}),r.visuals.defaultValue=["polymer-tube"],o&&r.visuals.defaultValue.push("polymer-gap"),r}function znt(e,t){return Wt.createMulti("Putty",e,t,so,mCe)}var fCe={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:znt,getParams:Unt,defaultValues:M.getDefaultValues(pCe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:e=>e.polymerResidueCount>0};var hCe={"element-sphere":(e,t)=>Fn("Sphere mesh/impostor",e,t,rL),"structure-element-sphere":(e,t)=>us("Structure sphere mesh/impostor",e,t,Zbe)},W8={...iI,bumpFrequency:M.Numeric(1,{min:0,max:10,step:.1},at.ShadingCategory),visuals:M.MultiSelect(["element-sphere"],M.objectToOptions(hCe))},UL;function Hnt(e,t){return t.isCoarseGrained?(UL||(UL=M.clone(W8),UL.sizeFactor.defaultValue=2),UL):W8}function jnt(e,t){return Wt.createMulti("Spacefill",e,t,so,hCe)}var gCe={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:jnt,getParams:Hnt,defaultValues:M.getDefaultValues(W8),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var q8=Br.is;function $nt(e,t,r,n,o,i){if(!Le.isAtomic(t))return In.createEmpty(i);let{child:s}=r,a=s?.unitMap.get(t.id);if(s&&!a)return In.createEmpty(i);let l=ce.Location.create(r,t),c=t.elements,u=t.bonds,{edgeCount:d,a:m,b:p,edgeProps:h,offset:f}=u;if(!d)return In.createEmpty(i);let{order:C,flags:g}=h,{sizeFactor:b,aromaticBonds:y,includeTypes:x,excludeTypes:A,multipleBonds:v}=o,_=v==="off",I=v==="symmetric",T=Br.fromNames(x),E=Br.fromNames(A),w=tI(T,E,32),S=D(),P=t.conformation,{elementRingIndices:k,elementAromaticRingIndices:L}=t.rings,R=y?t.resonance.delocalizedTriplets:void 0,N={linkCount:d*2,referencePosition:V=>{let q=m[V],Q=p[V],O=R?.getThirdElement(q,Q);if(O!==void 0)return P.invariantPosition(c[O],S);q>Q&&([q,Q]=[Q,q]),f[q+1]-f[q]===1&&([q,Q]=[Q,q]);let B=L.get(q)||k.get(q),j=0;for(let U=f[q],z=f[q+1];U<z;++U){let $=p[U];if($!==Q&&$!==q)if(B){let Z=L.get($)||k.get($);if(!Z)continue;let J=Kx(B,Z);J>j&&(j=J,P.invariantPosition(c[$],S))}else return P.invariantPosition(c[$],S)}return j>0?S:null},position:(V,q,Q)=>{P.invariantPosition(c[m[Q]],V),P.invariantPosition(c[p[Q]],q)},style:V=>{let q=C[V],Q=g[V];if(q8(Q,2)||q8(Q,4))return 1;if(q===3)return _?0:I?4:5;if(y){let O=m[V],B=p[V],j=L.get(O),U=L.get(B),z=j&&U?Kx(j,U):0;if(q8(Q,16)||z&&!w)return z===2?8:7}return q!==2||_?0:I?2:3},radius:V=>{l.element=c[m[V]];let q=n.size.size(l);l.element=c[p[V]];let Q=n.size.size(l);return Math.min(q,Q)*b},ignore:QB(r,t,o)},{lines:F,boundingSphere:H}=yM(e,N,o,i);if(H)F.setBoundingSphere(H);else if(F.lineCount>0){let V=Pe.expand(Pe(),(a??t).boundary.sphere,1*b);F.setBoundingSphere(V)}return F}var Z8={...Hy,...X_,includeParent:M.Boolean(!1)};function yCe(e){return jy({defaultProps:M.getDefaultValues(Z8),createGeometry:$nt,createLocationIterator:t=>Wm.fromGroup(t),getLoci:Y_,eachLocation:Q_,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!da(r.includeTypes,n.includeTypes)||!da(r.excludeTypes,n.excludeTypes)||r.aromaticBonds!==n.aromaticBonds||r.multipleBonds!==n.multipleBonds;let l=s.group.units[0],c=a.group.units[0];Le.isAtomic(l)&&Le.isAtomic(c)&&(Fs.areEqual(l.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}var K8=new _t.ElementBondIterator;function vCe(e,t,r,n){for(K8.setElement(t,r,n);K8.hasNext;){let o=K8.move();return o.otherUnit.conformation.position(o.otherUnit.elements[o.otherIndex],e),e}return null}function Wnt(e,t,r,n,o){let i=t.interUnitBonds,{edgeCount:s,edges:a}=i;if(!s)return In.createEmpty(o);let{sizeFactor:l,aromaticBonds:c,multipleBonds:u}=n,d=u==="off",m=u==="symmetric",p=D(),h=ce.Location.create(),f={linkCount:s,referencePosition:b=>{let y=a[b],x,A,v,_;if(y.unitA<y.unitB)x=t.unitMap.get(y.unitA),A=t.unitMap.get(y.unitB),v=y.indexA,_=y.indexB;else if(y.unitA>y.unitB)x=t.unitMap.get(y.unitB),A=t.unitMap.get(y.unitA),v=y.indexB,_=y.indexA;else throw new Error("same units in createInterUnitBondLines");return vCe(p,t,x,v)||vCe(p,t,A,_)},position:(b,y,x)=>{let A=a[x],v=t.unitMap.get(A.unitA),_=t.unitMap.get(A.unitB);v.conformation.position(v.elements[A.indexA],b),_.conformation.position(_.elements[A.indexB],y)},style:b=>{let y=a[b].props.order,x=zi.create(a[b].props.flag);return Br.is(x,2)||Br.is(x,4)?1:y===3?d?0:m?4:5:c&&Br.is(x,16)?7:y!==2||d?0:m?2:3},radius:b=>{let y=a[b];h.structure=t,h.unit=t.unitMap.get(y.unitA),h.element=h.unit.elements[y.indexA];let x=r.size.size(h);h.unit=t.unitMap.get(y.unitB),h.element=h.unit.elements[y.indexB];let A=r.size.size(h);return Math.min(x,A)*l},ignore:JB(t,n)},{lines:C,boundingSphere:g}=yM(e,f,n,o);if(g)C.setBoundingSphere(g);else if(C.lineCount>0){let{child:b}=t,y=Pe.expand(Pe(),(b??t).boundary.sphere,1*l);C.setBoundingSphere(y)}return C}var X8={...rfe,...X_,includeParent:M.Boolean(!1)};function bCe(e){return nfe({defaultProps:M.getDefaultValues(X8),createGeometry:Wnt,createLocationIterator:t=>Wm.fromStructure(t),getLoci:J_,eachLocation:eT,setUpdateState:(t,r,n,o,i,s,a)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.linkScale!==n.linkScale||r.linkSpacing!==n.linkSpacing||r.aromaticDashCount!==n.aromaticDashCount||r.dashCount!==n.dashCount||r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!da(r.includeTypes,n.includeTypes)||!da(r.excludeTypes,n.excludeTypes)||r.multipleBonds!==n.multipleBonds,s.interUnitBonds!==a.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}var FI=D.scaleAndAdd,xCe=D.unitX,CCe=D.unitY,SCe=D.unitZ,Y8={...Hy,lineSizeAttenuation:M.Boolean(!1),ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),traceOnly:M.Boolean(!1),crosses:M.Select("lone",M.arrayToOptions(["lone","all"])),crossSize:M.Numeric(.35,{min:0,max:2,step:.01})};function qnt(e,t,r,n,o,i){let{child:s}=r;if(s&&!s.unitMap.get(t.id))return In.createEmpty(i);let a=t.elements,l=a.length,c=ga.create(l,l/10,i),u=D(),d=D(),m=D(),p=t.conformation,h=vh(r,t,o),f=o.crossSize/2,C=o.crosses==="lone";for(let y=0;y<l;++y)h&&h(a[y])||C&&Le.isAtomic(t)&&Ju(r,t,y)!==0||(p.invariantPosition(a[y],u),FI(d,u,xCe,f),FI(m,u,xCe,-f),c.add(d[0],d[1],d[2],m[0],m[1],m[2],y),FI(d,u,CCe,f),FI(m,u,CCe,-f),c.add(d[0],d[1],d[2],m[0],m[1],m[2],y),FI(d,u,SCe,f),FI(m,u,SCe,-f),c.add(d[0],d[1],d[2],m[0],m[1],m[2],y));let g=c.getLines(),b=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return g.setBoundingSphere(b),g}function ICe(e){return jy({defaultProps:M.getDefaultValues(Y8),createGeometry:qnt,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{t.createGeometry=r.ignoreHydrogens!==n.ignoreHydrogens||r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||r.traceOnly!==n.traceOnly||r.crosses!==n.crosses||r.crossSize!==n.crossSize}},e)}var ACe={"intra-bond":(e,t)=>Fn("Intra-unit bond line",e,t,yCe),"inter-bond":(e,t)=>us("Inter-unit bond line",e,t,bCe),"element-point":(e,t)=>Fn("Points",e,t,GL),"element-cross":(e,t)=>Fn("Crosses",e,t,ICe)},Q8={...Z8,...X8,...uT,...Y8,pointStyle:M.Select("circle",M.objectToOptions(Gu.StyleTypes)),multipleBonds:M.Select("offset",M.arrayToOptions(["off","symmetric","offset"])),includeParent:M.Boolean(!1),sizeFactor:M.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:Fg(["atomic"]),visuals:M.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],M.objectToOptions(ACe))};function Znt(e,t){if(qe.getSize(t)>=qe.Size.Huge){let n=M.clone(Q8);return n.visuals.defaultValue=["intra-bond","element-point","element-cross"],n}else return Q8}function Knt(e,t){return Wt.createMulti("Line",e,t,so,ACe)}var wCe={name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:Knt,getParams:Znt,defaultValues:M.getDefaultValues(Q8),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};async function Xnt(e,t,r,n,o){let{runtime:i,webgl:s}=e;if(!s||!s.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");let a=o?o.gridTexture.ref.value:void 0,l=await Bxe(t,r.size,n,s,a).runInContext(i),{transform:c,texture:u,bbox:d,gridDim:m}=l,p={min:0,max:1,mean:.04,sigma:.01},h=de.mul(de(),c,de.fromScaling(de(),m)),f=de.getScaling(D(),c),C=D.create(0,1,2),g=el.create(d,m,c,h,f,u,p,!0,C,o),b=Pe.expand(Pe(),t.boundary.sphere,l.maxRadius);return g.setBoundingSphere(b),g}var J8={...sfe,...Tv,ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),includeParent:M.Boolean(!1,{isHidden:!0})};function _Ce(e){return afe({defaultProps:M.getDefaultValues(J8),createGeometry:Xnt,createLocationIterator:yi.fromStructure,getLoci:Zm,eachLocation:qm,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}async function Ynt(e,t,r,n,o,i){let{runtime:s,webgl:a}=e;if(!a)throw new Error("GaussianDensityVolume requires `webgl`");let l=i?i.gridTexture.ref.value:void 0,c=await kxe(r,t,n.size,o,a,l).runInContext(s),{transform:u,texture:d,bbox:m,gridDim:p}=c,h={min:0,max:1,mean:.04,sigma:.01},f=de.mul(de(),u,de.fromScaling(de(),p)),C=de.getScaling(D(),u),g=D.create(0,1,2),b=el.create(m,p,u,f,C,d,h,!0,g,i),y=Pe.expand(Pe(),t.boundary.sphere,c.maxRadius);return b.setBoundingSphere(y),b}var Qnt={...mfe,...Tv,ignoreHydrogens:M.Boolean(!1),ignoreHydrogensVariant:M.Select("all",M.arrayToOptions(["all","non-polar"])),includeParent:M.Boolean(!1,{isHidden:!0})};function TCe(e){return pfe({defaultProps:M.getDefaultValues(Qnt),createGeometry:Ynt,createLocationIterator:yi.fromGroup,getLoci:Ua,eachLocation:Ga,setUpdateState:(t,r,n)=>{r.resolution!==n.resolution&&(t.createGeometry=!0),r.radiusOffset!==n.radiusOffset&&(t.createGeometry=!0),r.smoothness!==n.smoothness&&(t.createGeometry=!0),r.ignoreHydrogens!==n.ignoreHydrogens&&(t.createGeometry=!0),r.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(t.createGeometry=!0),r.traceOnly!==n.traceOnly&&(t.createGeometry=!0),r.includeParent!==n.includeParent&&(t.createGeometry=!0)},dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}var ECe={"gaussian-volume":(e,t)=>us("Gaussian volume",e,t,_Ce),"units-gaussian-volume":(e,t)=>Fn("Units-Gaussian volume",e,t,TCe)},PCe={...J8,jumpLength:M.Numeric(4,{min:0,max:20,step:.1}),visuals:M.MultiSelect(["gaussian-volume"],M.objectToOptions(ECe))};function Jnt(e,t){return PCe}function eot(e,t){return Wt.createMulti("Gaussian Volume",e,t,so,ECe)}var DCe={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:eot,getParams:Jnt,defaultValues:M.getDefaultValues(PCe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0};var tot=D.scale,rot=D.add,not=D.sub,zL={...Xn,...yS,sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:M.Numeric(16,{min:2,max:56,step:2},at.CustomQualityParamInfo),tryUseImpostor:M.Boolean(!0)};function kCe(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth?iot(e):aot(e)}function oot(e,t,r,n,o,i){let s=t.polymerElements.length;if(!s)return ss.createEmpty(i);let a=s*2,l=$y.create(a,a/4,i),c=t.conformation,u=D(),d=D(),m=D();r8(t,function(C,g,b,y,x){c.invariantPosition(C,u),c.invariantPosition(g,d);let v=Wi(x)?G1:V1;rot(m,u,tot(m,not(m,d,u),v)),l.add(u[0],u[1],u[2],m[0],m[1],m[2],1,!1,!1,2,b),l.add(m[0],m[1],m[2],d[0],d[1],d[2],1,!1,!1,2,y)});let h=l.getCylinders(),f=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return h.setBoundingSphere(f),h}function iot(e){return vS({defaultProps:M.getDefaultValues(zL),createGeometry:oot,createLocationIterator:t=>sd.fromGroup(t),getLoci:Km,eachLocation:Xm,setUpdateState:(t,r,n)=>{},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function sot(e,t,r,n,o,i){let s=t.polymerElements.length;if(!s)return Ct.createEmpty(i);let{radialSegments:a,sizeFactor:l}=o,c=a*2*s*2,u=gt.createState(c,c/10,i),d=t.conformation,m=D(),p=D(),h={radiusTop:1,radiusBottom:1,radialSegments:a},f=ce.Location.create(r,t),C=ce.Location.create(r,t);r8(t,function(x,A,v,_,I){f.element=x,C.element=A,d.invariantPosition(f.element,m),d.invariantPosition(C.element,p);let E=Wi(I)?G1:V1;h.radiusTop=h.radiusBottom=n.size.size(f)*l,u.currentGroup=v,zr(u,m,p,E,h),h.radiusTop=h.radiusBottom=n.size.size(C)*l,u.currentGroup=_,zr(u,p,m,1-E,h)});let b=gt.getMesh(u),y=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return b.setBoundingSphere(y),b}function aot(e){return xo({defaultProps:M.getDefaultValues(zL),createGeometry:sot,createLocationIterator:t=>sd.fromGroup(t),getLoci:Km,eachLocation:Xm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.radialSegments!==n.radialSegments},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var HL={...Xn,...hS,sizeFactor:M.Numeric(.3,{min:0,max:10,step:.01}),detail:M.Numeric(0,{min:0,max:3,step:1},at.CustomQualityParamInfo),tryUseImpostor:M.Boolean(!0)};function MCe(e,t,r,n){return r.tryUseImpostor&&n&&n.extensions.fragDepth&&n.extensions.textureFloat?cot(e):dot(e)}function lot(e,t,r,n,o,i){let s=t.polymerElements.length;if(!s)return Ra.createEmpty(i);let a=Kg.create(s,s/2,i),l=t.conformation,c=D();n8(t,(p,h)=>{l.invariantPosition(p,c),a.add(c[0],c[1],c[2],h)});let d=a.getSpheres(),m=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return d.setBoundingSphere(m),d}function cot(e){return gS({defaultProps:M.getDefaultValues(HL),createGeometry:lot,createLocationIterator:t=>sd.fromGroup(t),getLoci:Km,eachLocation:Xm,setUpdateState:(t,r,n)=>{},mustRecreate:(t,r,n)=>!r.tryUseImpostor||!n},e)}function uot(e,t,r,n,o,i){let s=t.polymerElements.length;if(!s)return Ct.createEmpty(i);let{detail:a,sizeFactor:l}=o,c=s*Fp(a),u=gt.createState(c,c/2,i),d=t.conformation,m=D(),p=ce.Location.create(r,t);n8(t,(g,b)=>{p.element=g,d.invariantPosition(p.element,m),u.currentGroup=b,Rr(u,m,n.size.size(p)*l,a)});let f=gt.getMesh(u),C=Pe.expand(Pe(),t.boundary.sphere,1*o.sizeFactor);return f.setBoundingSphere(C),f}function dot(e){return xo({defaultProps:M.getDefaultValues(HL),createGeometry:uot,createLocationIterator:t=>sd.fromGroup(t),getLoci:Km,eachLocation:Xm,setUpdateState:(t,r,n)=>{t.createGeometry=r.sizeFactor!==n.sizeFactor||r.detail!==n.detail},mustRecreate:(t,r,n)=>r.tryUseImpostor&&!!n},e)}var RCe={"polymer-backbone-cylinder":(e,t)=>Fn("Polymer backbone cylinder",e,t,kCe),"polymer-backbone-sphere":(e,t)=>Fn("Polymer backbone sphere",e,t,MCe),"polymer-gap":(e,t)=>Fn("Polymer gap cylinder",e,t,DI)},BCe={...HL,...zL,...j1,sizeAspectRatio:M.Numeric(1,{min:.1,max:3,step:.1}),visuals:M.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],M.objectToOptions(RCe)),bumpFrequency:M.Numeric(0,{min:0,max:10,step:.1},at.ShadingCategory),colorMode:M.Select("default",M.arrayToOptions(["default","interpolate"]),{...at.ShadingCategory,isHidden:!0})};function mot(e,t){let r=M.clone(BCe),n=!1;return t.units.forEach(o=>{!n&&o.gapElements.length&&(n=!0)}),r.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],n&&r.visuals.defaultValue.push("polymer-gap"),r}function pot(e,t){return Wt.createMulti("Backbone",e,t,so,RCe)}var LCe={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:pot,getParams:mot,defaultValues:M.getDefaultValues(BCe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0};var OI=class e extends qC{constructor(){super(),Ao(e.BuiltIn,(t,r)=>{if(t.name!==r)throw new Error(`Fix BuiltInStructureRepresentations to have matching names. ${t.name} ${r}`);this.add(t)})}};(function(e){e.BuiltIn={cartoon:fxe,backbone:LCe,"ball-and-stick":Xbe,carbohydrate:h1e,ellipsoid:vxe,"gaussian-surface":jxe,"gaussian-volume":DCe,label:Zxe,line:wCe,"molecular-surface":rCe,orientation:sCe,point:cCe,putty:fCe,spacefill:gCe}})(OI||(OI={}));var jL=class{get isAnimating(){return this._isAnimating}async tick(t,r){var n,o;if(await this.plugin.managers.animation.tick(t,r?.isSynchronous,r?.animation),(n=this.plugin.canvas3d)===null||n===void 0||n.tick(t,r),bt){let i=(o=this.plugin.canvas3d)===null||o===void 0?void 0:o.webgl.timer.resolve();if(i)for(let s of i)F5([s])}}resetTime(t=Zn()){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resetTime(t)}start(t){var r;(r=this.plugin.canvas3d)===null||r===void 0||r.resume(),this._isAnimating=!0,this.resetTime(),t?.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)}stop(t){var r;this._isAnimating=!1,this.currentFrame!==void 0&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t?.noDraw&&((r=this.plugin.canvas3d)===null||r===void 0||r.pause(t?.noDraw))}constructor(t){this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=()=>{this.tick(Zn()),this._isAnimating&&(this.currentFrame=requestAnimationFrame(this.frame))}}};var $L=class{getDecorator(t){let r=this.plugin.state.data.tree,n=r.children.get(t);if(n.size!==1)return t;let o=n.first();return r.transforms.get(o).transformer.definition.isDecorator?this.getDecorator(o):t}get(t,r=!1){let n=this.root.get(t);if(n)return r?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))}addMapping(t,r,n){if(!fe.Molecule.Structure.is(n))return!1;if(this.tracked.set(r,n.data),this.root.has(n.data)){let o=this.root.get(n.data);o.count++}else{let o=t.select(Kt.Generators.byRef(r).rootOfType([fe.Molecule.Structure]))[0];o?this.root.set(n.data,{ref:o.transform.ref,count:1}):this.root.set(n.data,{ref:r,count:1})}return!0}removeMapping(t){if(!this.tracked.has(t))return!1;let r=this.tracked.get(t);this.tracked.delete(t);let n=this.root.get(r);return n.count>1?n.count--:this.root.delete(r),!0}updateMapping(t,r,n,o){return fe.Molecule.Structure.is(o)?(this.removeMapping(r),this.addMapping(t,r,o),!0):!1}dispose(){this.ev.dispose()}constructor(t){this.plugin=t,this.ev=Sc.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(r=>{this.addMapping(r.state,r.ref,r.obj)}),t.state.data.events.object.removed.subscribe(r=>{this.removeMapping(r.ref)&&this.events.removed.next({ref:r.ref,obj:r.obj})}),t.state.data.events.object.updated.subscribe(r=>{this.updateMapping(r.state,r.ref,r.oldObj,r.obj)&&this.events.updated.next({ref:r.ref,oldObj:r.oldObj,obj:r.obj})})}};var VI=class{constructor(){this.ev=Sc.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}tryGetAbortTaskId(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(let r of t.children){let n=this.tryGetAbortTaskId(r);if(n!==void 0)return n}}track(t,r){return n=>{var o;if(n.canAbort&&n.requestAbort){let s=this.tryGetAbortTaskId(n.root);s!==void 0&&n.requestAbort(this.abortRequests.get(s))}let i=Zn()-n.root.progress.startedTime;this.events.progress.next({id:t,useOverlay:(o=this.options.get(r))===null||o===void 0?void 0:o.useOverlay,level:i<250?"none":"background",progress:n})}}async run(t,r){let n=this.id++,o;r?.createNewContext||this.currentContext.length===0?o={ctx:VW(t,this.track(n,t.id),100),refCount:1}:(o=this.currentContext[this.currentContext.length-1],o.refCount++);try{return this.options.set(t.id,{useOverlay:!!r?.useOverlay}),this.runningTasks.add(t.id),await bE(o.ctx,t)}finally{this.options.delete(t.id),this.runningTasks.delete(t.id),this.events.finished.next({id:n}),this.abortRequests.delete(t.id),o.refCount--,o.refCount===0&&Jh(this.currentContext,o)}}requestAbortAll(t){this.runningTasks.forEach(r=>this.abortRequests.set(r,t))}requestAbort(t,r){let n=typeof t=="number"?t:t.root.progress.taskId;this.abortRequests.set(n,r)}dispose(){this.ev.dispose()}};(function(e){function t(n){return new Promise(o=>setTimeout(o,n))}function r(n){return ke.create("Test",async o=>{let i=0;for(;i<n;)await t(100+Math.random()*200),o.shouldUpdate&&await o.update({message:"Step "+i,current:i,max:n,isIndeterminate:!1}),i++})}e.testTask=r})(VI||(VI={}));var WL=class extends Na{findByKey(t){return this.state.entries.find(r=>!!r&&r.key===t)}show(t){let r=this.state.entries,n,o=++this.serialId,i;t.key&&(n=this.findByKey(t.key))?(n.timeout!==void 0&&clearTimeout(n.timeout),i=n.serialNumber,r=r.remove(n.id)):i=++this.serialNumber,n={id:o,serialNumber:i,key:t.key,title:t.title,message:t.message,timeout:this.timeout(o,t.timeoutMs),hide:()=>this.hideId(o)},this.updateState({entries:r.set(o,n)})&&this.events.changed.next(void 0)}timeout(t,r){if(r!==void 0)return r<0&&(r=500),setTimeout(()=>{let n=this.state.entries.get(t);n.timeout=void 0,this.hide(n)},r)}hideId(t){this.hide(this.state.entries.get(t))}hide(t){t&&(t.timeout!==void 0&&clearTimeout(t.timeout),t.hide=void 0,this.updateState({entries:this.state.entries.delete(t.id)})&&this.events.changed.next(void 0))}constructor(t){super({entries:Ea()}),this.events={changed:this.ev()},this.serialNumber=0,this.serialId=0,ht.Toast.Show.subscribe(t,r=>this.show(r)),ht.Toast.Hide.subscribe(t,r=>this.hide(this.findByKey(r.key)))}};var qL=class extends Xu{createParams(){let t=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:M.MappedStatic("viewport",{viewport:M.Group({}),hd:M.Group({}),"full-hd":M.Group({}),"ultra-hd":M.Group({}),custom:M.Group({width:M.Numeric(1920,{min:128,max:t,step:1}),height:M.Numeric(1080,{min:128,max:t,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:M.Boolean(!1),axes:Ly.axes}}get params(){return this._params?this._params:this._params=this.createParams()}get values(){return this.behaviors.values.value}get cropParams(){return this.behaviors.cropParams.value}get relativeCrop(){return this.behaviors.relativeCrop.value}getCanvasSize(){var t,r;return{width:((t=this.plugin.canvas3d)===null||t===void 0?void 0:t.webgl.gl.drawingBufferWidth)||0,height:((r=this.plugin.canvas3d)===null||r===void 0?void 0:r.webgl.gl.drawingBufferHeight)||0}}getSize(){let t=this.values;switch(t.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:t.resolution.params.width,height:t.resolution.params.height}}}createPass(t){let r=this.plugin.canvas3d,{colorBufferFloat:n,textureFloat:o}=r.webgl.extensions,i=r.props.postprocessing.occlusion;return r.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{...r.props.multiSample,mode:t?"on":"off",sampleLevel:n&&o?4:2},postprocessing:{...r.props.postprocessing,occlusion:i.name==="on"?{name:"on",params:{...i.params,samples:128,resolutionScale:r.webgl.pixelRatio}}:i},marking:{...r.props.marking}})}get previewPass(){return this._previewPass||(this._previewPass=this.createPass(!1))}get imagePass(){if(this._imagePass){let t=this.plugin.canvas3d,r=t.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:{...t.props.postprocessing,occlusion:r.name==="on"?{name:"on",params:{...r.params,samples:128,resolutionScale:t.webgl.pixelRatio}}:r},marking:{...t.props.marking}}),this._imagePass}return this._imagePass=this.createPass(!0)}getFilename(t=".png"){let r=this.plugin.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Model)).map(i=>i.obj.data),n=new Set;return r.forEach(i=>n.add(i.entryId.toUpperCase())),`${$n.toArray(n).join("-")||"molstar-image"}${t}`}resetCrop(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})}toggleAutocrop(){this.cropParams.auto?(this.behaviors.cropParams.next({...this.cropParams,auto:!1}),this.resetCrop()):this.behaviors.cropParams.next({...this.cropParams,auto:!0})}get isFullFrame(){let t=this.relativeCrop;return oo(t.x,0,1e-5)&&oo(t.y,0,1e-5)&&oo(t.width,1,1e-5)&&oo(t.height,1,1e-5)}autocrop(t=this.cropParams.relativePadding){let{data:r,width:n,height:o}=this.previewData.image,i=this.previewData.transparent,s=i?this.previewData.background:4278190080|this.previewData.background,a=n,l=0,c=o,u=0;for(let h=0;h<o;h++){let f=h*n;for(let C=0;C<n;C++){let g=4*(f+C);if(i){if(r[g+3]===0)continue}else if((r[g]<<16|r[g+1]<<8|r[g+2]|r[g+3]<<24)===s)continue;C<a&&(a=C),C>l&&(l=C),h<c&&(c=h),h>u&&(u=h)}}if(a>l){let h=a;a=l,l=h}if(c>u){let h=c;c=u,u=h}let d=l-a+1,m=u-c+1;a-=t*d,l+=t*d,c-=t*m,u+=t*m;let p={x:Math.max(0,a/n),y:Math.max(0,c/o),width:Math.min(1,(l-a+1)/n),height:Math.min(1,(u-c+1)/o)};this.behaviors.relativeCrop.next(p)}getPreview(t=320){let{width:r,height:n}=this.getSize();if(r<=0||n<=0)return;let o=r/n,i=0,s=0;o>1?(i=t,s=Math.round(t/o)):(s=t,i=Math.round(t*o));let a=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:a.postprocessing,marking:a.marking});let l=this.previewPass.getImageData(i,s),c=this.previewCanvas;c.width=l.width,c.height=l.height,this.previewData.image=l,this.previewData.background=a.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;let u=c.getContext("2d");if(!u)throw new Error("Could not create canvas 2d context");return u.putImageData(l,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:c,width:i,height:s}}getSizeAndViewport(){let{width:t,height:r}=this.getSize(),n=this.relativeCrop,o={x:Math.floor(n.x*t),y:Math.floor(n.y*r),width:Math.ceil(n.width*t),height:Math.ceil(n.height*r)};return o.width+o.x>t&&(o.width=t-o.x),o.height+o.y>r&&(o.height=r-o.y),{width:t,height:r,viewport:o}}async draw(t){let{width:r,height:n,viewport:o}=this.getSizeAndViewport();if(r<=0||n<=0)return;await t.update("Rendering image...");let i=this.imagePass;await i.updateBackground();let s=i.getImageData(r,n,o);await t.update("Encoding image...");let a=this.canvas;a.width=s.width,a.height=s.height;let l=a.getContext("2d");if(!l)throw new Error("Could not create canvas 2d context");l.putImageData(s,0,0)}copyToClipboardTask(){let t=navigator.clipboard;if(!t?.write){this.plugin.log.error("clipboard.write not supported!");return}return ke.create("Copy Image",async r=>{await this.draw(r),await r.update("Converting image...");let n=await yw(this.canvas,"png"),o=new ClipboardItem({"image/png":n});await t.write([o]),this.plugin.log.message("Image copied to clipboard.")})}getImageDataUri(){return this.plugin.runTask(ke.create("Generate Image",async t=>(await this.draw(t),await t.update("Converting image..."),this.canvas.toDataURL("png"))))}copyToClipboard(){let t=this.copyToClipboardTask();if(t)return this.plugin.runTask(t)}downloadTask(t){return ke.create("Download Image",async r=>{await this.draw(r),await r.update("Downloading image...");let n=await yw(this.canvas,"png");ck(n,t??this.getFilename())})}download(t){this.plugin.runTask(this.downloadTask(t))}constructor(t){super(),this.plugin=t,this._params=void 0,this.behaviors={values:this.ev.behavior({transparent:this.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:this.params.resolution.defaultValue}),cropParams:this.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:this.ev.behavior({x:0,y:0,width:1,height:1})},this.events={previewed:this.ev()},this.canvas=function(){return document.createElement("canvas")}(),this.previewCanvas=function(){return document.createElement("canvas")}(),this.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:ze(0),transparent:!1}}};var ZL=class{addHandler(t,r){let n=this.handlers.findIndex(o=>o[0]===t);n<0?this.handlers.push([t,r]):this.handlers[n][1]=r}removeHandler(t){let r=this.handlers.findIndex(n=>n[0]===t);r>=0&&this.handlers.splice(r,1)}async handle(t){for(let r=this.handlers.length-1;r>=0;r--){let n=this.handlers[r][1];if(await n(t,this.plugin))return}fot(this.plugin,t)}dispose(){this.handlers.length=0}constructor(t){this.plugin=t,this.handlers=[]}};function fot(e,t){let r=t.filter(n=>{let o=n.name.toLowerCase();return o.endsWith(".molx")||o.endsWith(".molj")});r.length>0?ht.State.Snapshots.OpenFile(e,{file:r[0]}):e.runTask(e.state.data.applyAction(H_,{files:t.map(n=>Nr.File(n)),format:{name:"auto",params:{}},visuals:!0}))}var KL=class{get isInitialized(){return this._isInitialized}build(){return this.state.data.build()}initContainer(t){var r;if(this.canvasContainer)return!0;let n=document.createElement("div");Object.assign(n.style,{position:"absolute",left:0,top:0,right:0,bottom:0,"-webkit-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none","touch-action":"manipulation"});let o=(r=t?.canvas3dContext)===null||r===void 0?void 0:r.canvas;return o||(o=document.createElement("canvas"),t?.checkeredCanvasBackground&&Object.assign(o.style,{"background-image":"linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)","background-size":"60px 60px","background-position":"0 0, 30px 30px"}),n.appendChild(o)),this.initViewer(o,n,t?.canvas3dContext)?(this.canvasContainer=n,!0):!1}mount(t,r){var n;if(this.disposed)throw new Error("Cannot mount a disposed context");return this.initContainer(r)?(this.canvasContainer.parentElement!==t&&((n=this.canvasContainer.parentElement)===null||n===void 0||n.removeChild(this.canvasContainer)),t.appendChild(this.canvasContainer),this.handleResize(),!0):!1}unmount(){var t,r;(r=(t=this.canvasContainer)===null||t===void 0?void 0:t.parentElement)===null||r===void 0||r.removeChild(this.canvasContainer)}initViewer(t,r,n){var o,i,s,a,l,c;try{this.layout.setRoot(r),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n||(n=Xp.fromCanvas(t,this.managers.asset,{antialias:!((o=this.config.get(Ot.General.DisableAntialiasing))!==null&&o!==void 0&&o),preserveDrawingBuffer:!((i=this.config.get(Ot.General.DisablePreserveDrawingBuffer))!==null&&i!==void 0&&i),preferWebGl1:this.config.get(Ot.General.PreferWebGl1)||!1,failIfMajorPerformanceCaveat:!((s=this.config.get(Ot.General.AllowMajorPerformanceCaveat))!==null&&s!==void 0&&s),powerPreference:this.config.get(Ot.General.PowerPreference)||"high-performance",handleResize:this.handleResize},{pixelScale:this.config.get(Ot.General.PixelScale)||1,pickScale:this.config.get(Ot.General.PickScale)||.25,transparency:this.config.get(Ot.General.Transparency)||"wboit"})),this.canvas3dContext=n,this.canvas3d=zk.create(this.canvas3dContext),this.canvas3dInit.next(!0);let u=this.spec.canvas3d,d=ze(16579577);return u?(((l=u.renderer)===null||l===void 0?void 0:l.backgroundColor)===void 0&&(u=Jl(u,m=>{m.renderer?m.renderer.backgroundColor=d:m.renderer={backgroundColor:d}})),(c=this.canvas3d)===null||c===void 0||c.setProps(u)):(a=this.canvas3d)===null||a===void 0||a.setProps({renderer:{backgroundColor:d}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new qL(this),this.subs.push(this.canvas3d.interaction.click.subscribe(m=>this.behaviors.interaction.click.next(m))),this.subs.push(this.canvas3d.interaction.drag.subscribe(m=>this.behaviors.interaction.drag.next(m))),this.subs.push(this.canvas3d.interaction.hover.subscribe(m=>this.behaviors.interaction.hover.next(m))),this.subs.push(this.canvas3d.input.resize.pipe(v2(50),fl(100,void 0,{leading:!1,trailing:!0})).subscribe(()=>this.handleResize())),this.subs.push(this.canvas3d.input.keyDown.subscribe(m=>this.behaviors.interaction.key.next(m))),this.subs.push(this.canvas3d.input.keyUp.subscribe(m=>this.behaviors.interaction.keyReleased.next(m))),this.subs.push(this.layout.events.updated.subscribe(()=>requestAnimationFrame(()=>this.handleResize()))),this.handleResize(),Gh.setImmediate(()=>this.initCanvas3dPromiseCallbacks[0]()),!0}catch(u){return this.log.error(""+u),Gh.setImmediate(()=>this.initCanvas3dPromiseCallbacks[1](u)),!1}}get isBusy(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value}get selectionMode(){return this.behaviors.interaction.selectionMode.value}set selectionMode(t){this.behaviors.interaction.selectionMode.next(t)}dataTransaction(t,r){return this.runTask(this.state.data.transaction(t,r))}clear(t=!1){var r;return t&&((r=this.canvas3d)===null||r===void 0||r.setProps(ww)),ht.State.RemoveObject(this,{state:this.state.data,ref:xr.RootRef})}dispose(t){var r,n;if(!this.disposed){for(let o of this.subs)o.unsubscribe();this.subs=[],this.animationLoop.stop(),this.commands.dispose(),(r=this.canvas3d)===null||r===void 0||r.dispose(),(n=this.canvas3dContext)===null||n===void 0||n.dispose(t),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),Ao(this.managers,o=>{var i;return(i=o?.dispose)===null||i===void 0?void 0:i.call(o)}),Ao(this.managers.structure,o=>{var i;return(i=o?.dispose)===null||i===void 0?void 0:i.call(o)}),Ao(this.managers.volume,o=>{var i;return(i=o?.dispose)===null||i===void 0?void 0:i.call(o)}),this.unmount(),this.canvasContainer=void 0,this.customState={},this.disposed=!0}}initBehaviorEvents(){this.subs.push(im(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(s=>{this.behaviors.state.isUpdating.value!==s&&this.behaviors.state.isUpdating.next(s)}));let t=this.config.get(Ot.General.IsBusyTimeoutMs)||750,r=this.behaviors.state.isBusy,n,o=()=>{r.value||r.next(!0)},i=()=>{n!==void 0&&clearTimeout(n),n=void 0};this.subs.push(im(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(s=>{let a=this.behaviors.state.isUpdating.value,l=this.behaviors.state.isAnimating.value;a||l?r.value||(i(),n=setTimeout(o,t)):(i(),r.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(s=>{var a;s||(a=this.managers.interactivity)===null||a===void 0||a.lociSelects.deselectAll()}))}initBuiltInBehavior(){Rw.State.registerDefault(this),Rw.Representation.registerDefault(this),Rw.Camera.registerDefault(this),Rw.Misc.registerDefault(this),this.subs.push(im(this.state.data.events.log,this.state.behaviors.events.log).subscribe(t=>this.events.log.next(t)))}async initBehaviors(){let t=this.state.behaviors.build();for(let r of Object.keys(tr.Categories))t.toRoot().apply(tr.CreateCategory,{label:tr.Categories[r]},{ref:r,state:{isLocked:!0}});for(let r of this.spec.behaviors)tr.getCategoryId(r.transformer)==="custom-props"&&t.to(tr.getCategoryId(r.transformer)).apply(r.transformer,r.defaultParams,{ref:r.transformer.id});await this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0})),t=this.state.behaviors.build();for(let r of this.spec.behaviors)tr.getCategoryId(r.transformer)!=="custom-props"&&t.to(tr.getCategoryId(r.transformer)).apply(r.transformer,r.defaultParams,{ref:r.transformer.id});await this.runTask(this.state.behaviors.updateTree(t,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))}initCustomFormats(){if(this.spec.customFormats)for(let t of this.spec.customFormats)this.dataFormats.add(t[0],t[1])}initAnimations(){if(this.spec.animations)for(let t of this.spec.animations)this.managers.animation.register(t)}initDataActions(){if(this.spec.actions)for(let t of this.spec.actions)this.state.data.actions.add(t.action)}async init(){try{this.subs.push(this.events.log.subscribe(t=>this.log.entries=this.log.entries.push(t))),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new av(this),this.managers.lociLabels=new ZB(this),this.builders.structure=new jB(this),this.initAnimations(),this.initDataActions(),await this.initBehaviors(),this.log.message(`Mol* Plugin ${rS} [${que.toLocaleString()}]`),Uh||this.log.message("Development mode enabled"),lr&&this.log.message("Debug mode enabled"),this._isInitialized=!0,this.initializedPromiseCallbacks[0]()}catch(t){throw this.initializedPromiseCallbacks[1](t),t}}constructor(t){var r;this.spec=t,this.runTask=(n,o)=>this.managers.task.run(n,o),this.resolveTask=n=>{if(n)return ke.is(n)?this.runTask(n):n},this.subs=[],this.initCanvas3dPromiseCallbacks=[()=>{},()=>{}],this._isInitialized=!1,this.initializedPromiseCallbacks=[()=>{},()=>{}],this.disposed=!1,this.canvasContainer=void 0,this.ev=Sc.create(),this.config=new dk(this.spec.config),this.state=new fv(this),this.commands=new uk,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:Wt.Loci.Empty,modifiers:nl.None,buttons:0,button:0}),click:this.ev.behavior({current:Wt.Loci.Empty,modifiers:nl.None,buttons:0,button:0}),drag:this.ev.behavior({current:Wt.Loci.Empty,modifiers:nl.None,buttons:0,button:0,pageStart:Ve(),pageEnd:Ve()}),key:this.ev.behavior(m9),keyReleased:this.ev.behavior(m9),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(Bf(n=>!!n),R4(1))}},this.canvas3dInitialized=new Promise((n,o)=>{this.initCanvas3dPromiseCallbacks=[n,o]}),this.initialized=new Promise((n,o)=>{this.initializedPromiseCallbacks=[n,o]}),this.layout=new YB(this),this.animationLoop=new jL(this),this.representation={structure:{registry:new OI,themes:{colorThemeRegistry:oi.createRegistry(),sizeThemeRegistry:Vi.createRegistry()}},volume:{registry:new mv,themes:{colorThemeRegistry:oi.createRegistry(),sizeThemeRegistry:Vi.createRegistry()}}},this.query={structure:{registry:new PD}},this.dataFormats=new $B,this.builders={data:new VB(this),structure:void 0},this.helpers={substructureParent:new $L(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new mh(this),component:new od(this),measurement:new XR(this),selection:new XB(this),focus:new KB(this)},volume:{hierarchy:new cv(this)},interactivity:void 0,camera:new qB(this),animation:new WB(this),snapshot:new Zp(this),lociLabels:void 0,toast:new WL(this),asset:new mP,task:new VI,dragAndDrop:new ZL(this)},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new j_.Registry,this.customStructureProperties=new j_.Registry,this.customStructureControls=new Map,this.customImportControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.handleResize=()=>{var n,o;let i=(n=this.canvas3dContext)===null||n===void 0?void 0:n.canvas,s=this.layout.root;s&&i&&(Zue(i,s,this.canvas3dContext.props.pixelScale),(o=this.canvas3d)===null||o===void 0||o.requestResize())},this.log={entries:Df(),entry:n=>this.events.log.next(n),error:n=>this.events.log.next(sm.error(n)),message:n=>this.events.log.next(sm.message(n)),info:n=>this.events.log.next(sm.info(n)),warn:n=>this.events.log.next(sm.warning(n))},this.fetch=d2,qX(!1),lne((r=this.config.get(Ot.Structure.SaccharideCompIdMapType))!==null&&r!==void 0?r:"default")}};var XL=class extends KL{initCustomParamEditors(){if(this.spec.customParamEditors)for(let[t,r]of this.spec.customParamEditors)this.customParamEditors.set(t.id,r)}dispose(t){super.dispose(t),this.layout.dispose()}constructor(t){super(t),this.spec=t,this.customParamEditors=new Map,this.initCustomParamEditors()}};var zc;(function(e){function t(n){return n}e.create=t;function r(n,o){var i,s;if(o.customDurationMs)return o.customDurationMs;let a=(s=(i=o.definition).getDuration)===null||s===void 0?void 0:s.call(i,o.params,n);if(a?.kind==="fixed")return a.durationMs}e.getDuration=r})(zc||(zc={}));var NCe=zc.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:e=>{let t=[["all","All"]],r=e.state.data.select(Kt.Generators.rootsOfType(fe.Molecule.Structure));for(let n of r)t.push([n.transform.ref,n.obj.data.models[0].label]);return{durationInMs:M.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:M.Boolean(!1),target:M.Select(t[0][0],t)}},canApply(e){let t=e.state.data,r=xr.RootRef;return{canApply:t.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3D,r)).length>0}},getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),initialState:()=>({t:0}),setup(e,t,r){let n=r.state.data,o=!e.target||e.target==="all"?xr.RootRef:e.target,i=n.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3D,o)),s=n.build(),a=!1;for(let l of i)n.select(Kt.Generators.ofTransformer(Je.Representation.UnwindStructureAssemblyRepresentation3D,l.transform.ref)).length>0||(a=!0,s.to(l).apply(Je.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}));if(a)return s.commit({doNotUpdateCurrent:!0})},teardown(e,t,r){let n=r.state.data,o=n.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(o.length===0)return;let i=n.build();for(let s of o)i.delete(s.transform.ref);return i.commit()},async apply(e,t,r){let n=r.plugin.state.data,o=!r.params.target||r.params.target==="all"?xr.RootRef:r.params.target,i=n.select(Kt.Generators.ofTransformer(Je.Representation.UnwindStructureAssemblyRepresentation3D,o));if(i.length===0)return{kind:"finished"};let s=n.build(),a=(t.current-t.lastApplied)/r.params.durationInMs,l=e.t+a,c=!1;r.params.playOnce&&l>=1?(c=!0,l=1):l=l%1;for(let u of i)s.to(u).update({t:l});return await ht.State.Update(r.plugin,{state:n,tree:s,options:{doNotLogTiming:!0}}),c?{kind:"finished"}:{kind:"next",state:{t:l}}}});var YL=D(),FCe=D(),OCe=Tn(),VCe=zc.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:M.Numeric(4e3,{min:100,max:2e4,step:100}),speed:M.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:M.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}),initialState:(e,t)=>{var r;return{snapshot:(r=t.canvas3d)===null||r===void 0?void 0:r.camera.getSnapshot()}},getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,r)=>{var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,r){var n,o;if(t.current===0)return{kind:"next",state:e};let i=e.snapshot;if(i.radiusMax<1e-4)return{kind:"finished"};let s=t.animation?((n=t.animation)===null||n===void 0?void 0:n.currentFrame)/(t.animation.frameCount+1):ko(t.current/r.params.durationInMs,0,1),a=2*Math.PI*s*r.params.speed*(r.params.direction==="ccw"?-1:1);D.sub(YL,i.position,i.target),D.normalize(FCe,i.up),Tn.setAxisAngle(OCe,FCe,a),D.transformQuat(YL,YL,OCe);let l=D.add(D(),i.target,YL);return(o=r.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({snapshot:{...i,position:l},durationMs:0}),s>=.99999?{kind:"finished"}:{kind:"next",state:e}}});var GCe=zc.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:()=>({mode:M.MappedStatic("loop",{palindrome:M.Group({}),loop:M.Group({direction:M.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:M.Group({direction:M.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:M.MappedStatic("fixed",{fixed:M.Group({durationInS:M.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:M.Group({targetFps:M.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:M.Group({maxFps:M.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}),canApply(e){let t=e.state.data,r=t.select(Kt.Generators.ofTransformer(Je.Model.ModelFromTrajectory));for(let n of r){let o=Kt.findAncestorOfType(t.tree,t.cells,n.transform.ref,fe.Molecule.Trajectory);if(o&&o.obj&&o.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:(e,t)=>{var r;if(((r=e.duration)===null||r===void 0?void 0:r.name)==="fixed")return{kind:"fixed",durationMs:e.duration.params.durationInS*1e3};if(e.duration.name==="computed"){let n=t.state.data,o=n.select(Kt.Generators.ofTransformer(Je.Model.ModelFromTrajectory)),i=0;for(let s of o){let a=Kt.findAncestorOfType(n.tree,n.cells,s.transform.ref,fe.Molecule.Trajectory);if(!a||!a.obj)continue;let l=a.obj;i=Math.max(Math.ceil(1e3*l.data.frameCount/e.duration.params.targetFps),i)}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:()=>({}),async apply(e,t,r){if(r.params.duration.name==="sequential"&&t.current>0&&t.current-t.lastApplied<1e3/r.params.duration.params.maxFps)return{kind:"skip"};let n=r.plugin.state.data,o=n.select(Kt.Generators.ofTransformer(Je.Model.ModelFromTrajectory));if(o.length===0)return{kind:"finished"};let i=n.build(),s=r.params,a=e.palindromeDirections||{},l=!1,c=!0;for(let u of o){let d=Kt.findAncestorOfType(n.tree,n.cells,u.transform.ref,fe.Molecule.Trajectory);if(!d||!d.obj)continue;let m=d.obj;m.data.frameCount<=1||i.to(u).update(p=>{let h=m.data.frameCount;if(h!==1)c=!1;else return p;if(s.duration.name==="sequential"){let f=1;if(s.mode.name==="once"){if(f=s.mode.params.direction==="backward"?-1:1,f===-1&&p.modelIndex===0||f===1&&p.modelIndex===h-1)return l=!0,p}else s.mode.name==="palindrome"&&(p.modelIndex===0?f=1:p.modelIndex===h-1?f=-1:f=a[u.transform.ref]||1);a[u.transform.ref]=f;let C=(p.modelIndex+f)%h;return C<0&&(C+=h),l=l||f===-1&&C===0||f===1&&C===h-1,{modelIndex:C}}else{let f=s.duration.name==="fixed"?s.duration.params.durationInS*1e3:Math.ceil(1e3*m.data.frameCount/s.duration.params.targetFps);if(s.mode.name==="once"&&t.current>=f)return l=!0,{modelIndex:m.data.frameCount-1};let C=t.current%f/f;return s.mode.name==="loop"&&s.mode.params.direction==="backward"&&(C=1-C),s.mode.name==="palindrome"&&(C=2*C,C>1&&(C=2-C)),{modelIndex:Math.min(Math.floor(m.data.frameCount*C),m.data.frameCount-1)}}})}return c||await ht.State.Update(r.plugin,{state:n,tree:i,options:{doNotLogTiming:!0}}),c||s.mode.name==="once"&&l?{kind:"finished"}:s.mode.name==="palindrome"?{kind:"next",state:{palindromeDirections:a}}:{kind:"next",state:{}}}});async function UCe(e,t,r=!1){var n,o,i,s;t.snapshot.data&&(await e.runTask(e.state.data.setSnapshot(t.snapshot.data)),(n=e.canvas3d)===null||n===void 0||n.setProps({trackball:(i=(o=t.snapshot.canvas3d)===null||o===void 0?void 0:o.props)===null||i===void 0?void 0:i.trackball})),t.snapshot.camera&&((s=e.canvas3d)===null||s===void 0||s.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:r||t.snapshot.camera.transitionStyle==="instant"?0:t.snapshot.camera.transitionDurationInMs}))}var zCe=zc.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:()=>({}),canApply(e){let t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(r=>!!r?.snapshot.startAnimation)?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup(e,t,r){let n=r.managers.snapshot.state.entries.get(0);UCe(r,n,!0)},getDuration:(e,t)=>({kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce((r,n)=>{var o;return r+((o=n.snapshot.durationInMs)!==null&&o!==void 0?o:0)},0)}),initialState:(e,t)=>{let r=t.managers.snapshot.state.entries.toArray();return{totalDuration:r.reduce((n,o)=>{var i;return n+((i=o.snapshot.durationInMs)!==null&&i!==void 0?i:0)},0),snapshots:r,currentIndex:0}},async apply(e,t,r){var n;if(t.current>=e.totalDuration)return{kind:"finished"};let o=0,i=0;for(let s of e.snapshots){if(o+=(n=s.snapshot.durationInMs)!==null&&n!==void 0?n:0,t.current<o)break;i++}return i>=e.snapshots.length?{kind:"finished"}:i===e.currentIndex?{kind:"skip"}:(await UCe(r.plugin,e.snapshots[i]),{kind:"next",state:{...e,currentIndex:i}})}});var t7={};Ui(t7,{AssignColorVolume:()=>e7,DownloadDensity:()=>hot});var hot=ki.build({from:fe.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:(e,t)=>{let{options:r}=t.dataFormats;return{source:M.MappedStatic("pdb-xray",{"pdb-xray":M.Group({provider:M.Group({id:M.Text("1tqn",{label:"Id"}),server:M.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:M.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":M.Group({provider:M.Group({id:M.Text("1tqn",{label:"Id"}),server:M.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:M.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":M.Group({provider:M.Group({id:M.Text("emd-8004",{label:"Id"}),server:M.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:M.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:M.Group({url:M.Url(""),isBinary:M.Boolean(!1),format:M.Select("auto",r)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(({params:e},t)=>ke.create("Download Density",async r=>{var n,o;let i=e.source,s,a;switch(i.name){case"url":s=i.params;break;case"pdb-xray":s=i.params.provider.server==="pdbe"?{url:Nr.Url(i.params.type==="2fofc"?`https://www.ebi.ac.uk/pdbe/coordinates/files/${i.params.provider.id.toLowerCase()}.ccp4`:`https://www.ebi.ac.uk/pdbe/coordinates/files/${i.params.provider.id.toLowerCase()}_diff.ccp4`),isBinary:!0,label:`PDBe X-ray map: ${i.params.provider.id}`}:{url:Nr.Url(i.params.type==="2fofc"?`https://edmaps.rcsb.org/maps/${i.params.provider.id.toLowerCase()}_2fofc.dsn6`:`https://edmaps.rcsb.org/maps/${i.params.provider.id.toLowerCase()}_fofc.dsn6`),isBinary:!0,label:`RCSB X-ray map: ${i.params.provider.id}`};break;case"pdb-emd-ds":s=i.params.provider.server==="pdbe"?{url:Nr.Url(`https://www.ebi.ac.uk/pdbe/densities/emd/${i.params.provider.id.toLowerCase()}/cell?detail=${i.params.detail}`),isBinary:!0,label:`PDBe EMD Density Server: ${i.params.provider.id}`}:{url:Nr.Url(`https://maps.rcsb.org/em/${i.params.provider.id.toLowerCase()}/cell?detail=${i.params.detail}`),isBinary:!0,label:`RCSB PDB EMD Density Server: ${i.params.provider.id}`};break;case"pdb-xray-ds":s=i.params.provider.server==="pdbe"?{url:Nr.Url(`https://www.ebi.ac.uk/pdbe/densities/x-ray/${i.params.provider.id.toLowerCase()}/cell?detail=${i.params.detail}`),isBinary:!0,label:`PDBe X-ray Density Server: ${i.params.provider.id}`}:{url:Nr.Url(`https://maps.rcsb.org/x-ray/${i.params.provider.id.toLowerCase()}/cell?detail=${i.params.detail}`),isBinary:!0,label:`RCSB PDB X-ray Density Server: ${i.params.provider.id}`};break;default:Sr(i)}let l=await t.builders.data.download(s),c;switch(i.name){case"url":s=i.params,a=i.params.format==="auto"?t.dataFormats.auto(Wg(Nr.getUrl(s.url)),(n=l.cell)===null||n===void 0?void 0:n.obj):t.dataFormats.get(i.params.format);break;case"pdb-xray":c=i.params.provider.id,a=i.params.provider.server==="pdbe"?t.dataFormats.get("ccp4"):t.dataFormats.get("dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":c=i.params.provider.id,a=t.dataFormats.get("dscif");break;default:Sr(i)}if(!a){t.log.warn("DownloadDensity: Format provider not found.");return}let u=await a.parse(t,l,{entryId:c});await((o=a.visuals)===null||o===void 0?void 0:o.call(a,t,u))})),e7=ki.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:fe.Volume.Data,isApplicable(e){return!e.data.colorVolume},params(e,t){let r=t.state.data.select(Kt.Generators.root.subtree().ofType(fe.Volume.Data).filter(n=>{var o;return!!n.obj&&!(!((o=n.obj)===null||o===void 0)&&o.data.colorVolume)&&n.obj!==e}));return r.length===0?{ref:M.Text("",{isHidden:!0,label:"Volume"})}:{ref:M.Select(r[0].transform.ref,r.map(n=>[n.transform.ref,n.obj.label]),{label:"Volume"})}}})(({ref:e,params:t,state:r},n)=>n.build().to(e).apply(Je.Volume.AssignColorVolume,{ref:t.ref},{dependsOn:[t.ref]}).commit());var Ev={Structure:E6,Volume:t7,DataFormat:wj};var HCe=zc.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:()=>({transtionDurationInMs:M.Numeric(2e3,{min:100,max:3e4,step:10})}),canApply(e){return{canApply:e.managers.snapshot.state.entries.size>1}},initialState:()=>({}),async apply(e,t,r){let n=r.plugin.managers.snapshot.state.entries;if(n.size<2)return{kind:"finished"};let o=t.current%r.params.transtionDurationInMs/r.params.transtionDurationInMs,i=Math.floor(t.current/r.params.transtionDurationInMs)%n.size,s=Math.ceil(t.current/r.params.transtionDurationInMs);s===i&&s++,s=s%n.size;let a=n.get(i).snapshot,l=n.get(s).snapshot;if(!a.data||!l.data)return{kind:"skip"};let c=a.data.tree.transforms,u=l.data.tree.transforms,d=r.plugin.state.data,m=d.build();for(let p of c)for(let h of u){if(h.ref!==p.ref||h.version===p.version)continue;let f=xr.fromJSON(p),C=xr.fromJSON(h),g=d.cells.get(p.ref);if(!g)continue;let b;f.transformer.definition.interpolate?b=f.transformer.definition.interpolate(f.params,C.params,o,r.plugin):b=o<=.5?f.params:C.params,zh(g,b)||m.to(p.ref).update(b)}return await ht.State.Update(r.plugin,{state:d,tree:m,options:{doNotLogTiming:!0}}),{kind:"next",state:{}}}});var jCe=zc.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:()=>({durationInMs:M.Numeric(3e3,{min:100,max:1e4,step:100})}),initialState:()=>({t:0}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),async setup(e,t,r){let n=r.state.data,o=n.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3D)),i=n.build(),s=!1;for(let a of o)n.select(Kt.Generators.ofTransformer(Je.Representation.SpinStructureRepresentation3D,a.transform.ref)).length>0||(s=!0,i.to(a.transform.ref).apply(Je.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));if(s)return i.commit({doNotUpdateCurrent:!0})},teardown(e,t,r){let n=r.state.data,o=n.select(Kt.Generators.ofType(fe.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(o.length===0)return;let i=n.build();for(let s of o)i.delete(s.transform.ref);return i.commit()},async apply(e,t,r){var n;let o=r.plugin.state.data,i=o.select(Kt.Generators.ofTransformer(Je.Representation.SpinStructureRepresentation3D));if(i.length===0)return{kind:"finished"};let s=o.build(),a=(t.current-t.lastApplied)/r.params.durationInMs,l=(e.t+a)%1;for(let c of i)s.to(c).update({...(n=c.params)===null||n===void 0?void 0:n.values,t:l});return await ht.State.Update(r.plugin,{state:o,tree:s,options:{doNotLogTiming:!0}}),{kind:"next",state:{t:l}}}});var QL=D(),$Ce=D(),WCe=Tn(),qCe=zc.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:M.Numeric(4e3,{min:100,max:2e4,step:100}),speed:M.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:M.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}),initialState:(e,t)=>({snapshot:t.canvas3d.camera.getSnapshot()}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,r)=>{var n;(n=r.canvas3d)===null||n===void 0||n.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,r){var n,o;if(t.current===0)return{kind:"next",state:e};let i=e.snapshot;if(i.radiusMax<1e-4)return{kind:"finished"};let s=t.animation?((n=t.animation)===null||n===void 0?void 0:n.currentFrame)/(t.animation.frameCount+1):ko(t.current/r.params.durationInMs,0,1),a=Math.sin(s*r.params.speed*Math.PI*2)*Pr(r.params.angle);D.sub(QL,i.position,i.target),D.normalize($Ce,i.up),Tn.setAxisAngle(WCe,$Ce,a),D.transformQuat(QL,QL,WCe);let l=D.add(D(),i.target,QL);return(o=r.plugin.canvas3d)===null||o===void 0||o.requestCameraReset({snapshot:{...i,position:l},durationMs:0}),s>=.99999?{kind:"finished"}:{kind:"next",state:e}}});var _r;(function(e){function t(n,o){return{action:n,customControl:o&&o.customControl,autoUpdate:o&&o.autoUpdate}}e.Action=t;function r(n,o={}){return{transformer:n,defaultParams:o}}e.Behavior=r})(_r||(_r={}));var ZCe=()=>({actions:[_r.Action(Ev.Structure.DownloadStructure),_r.Action(Ev.Volume.DownloadDensity),_r.Action(Ev.DataFormat.DownloadFile),_r.Action(Ev.DataFormat.OpenFiles),_r.Action(Ev.Structure.LoadTrajectory),_r.Action(Ev.Structure.EnableModelCustomProps),_r.Action(Ev.Structure.EnableStructureCustomProps),_r.Action(R_),_r.Action(Jve),_r.Action(B_),_r.Action(Je.Data.Download),_r.Action(Je.Data.ParseCif),_r.Action(Je.Data.ParseCcp4),_r.Action(Je.Data.ParseDsn6),_r.Action(Je.Model.TrajectoryFromMmCif),_r.Action(Je.Model.TrajectoryFromCifCore),_r.Action(Je.Model.TrajectoryFromPDB),_r.Action(Je.Model.TransformStructureConformation),_r.Action(Je.Model.StructureFromModel),_r.Action(Je.Model.StructureFromTrajectory),_r.Action(Je.Model.ModelFromTrajectory),_r.Action(Je.Model.StructureSelectionFromScript),_r.Action(Je.Representation.StructureRepresentation3D),_r.Action(Je.Representation.StructureSelectionsDistance3D),_r.Action(Je.Representation.StructureSelectionsAngle3D),_r.Action(Je.Representation.StructureSelectionsDihedral3D),_r.Action(Je.Representation.StructureSelectionsLabel3D),_r.Action(Je.Representation.StructureSelectionsOrientation3D),_r.Action(Je.Representation.ModelUnitcell3D),_r.Action(Je.Representation.StructureBoundingBox3D),_r.Action(Je.Representation.ExplodeStructureRepresentation3D),_r.Action(Je.Representation.SpinStructureRepresentation3D),_r.Action(Je.Representation.UnwindStructureAssemblyRepresentation3D),_r.Action(Je.Representation.OverpaintStructureRepresentation3DFromScript),_r.Action(Je.Representation.TransparencyStructureRepresentation3DFromScript),_r.Action(Je.Representation.ClippingStructureRepresentation3DFromScript),_r.Action(Je.Representation.SubstanceStructureRepresentation3DFromScript),_r.Action(Je.Representation.ThemeStrengthRepresentation3D),_r.Action(e7),_r.Action(Je.Volume.VolumeFromCcp4),_r.Action(Je.Volume.VolumeFromDsn6),_r.Action(Je.Volume.VolumeFromCube),_r.Action(Je.Volume.VolumeFromDx),_r.Action(Je.Representation.VolumeRepresentation3D)],behaviors:[_r.Behavior(mu.Representation.HighlightLoci),_r.Behavior(mu.Representation.SelectLoci),_r.Behavior(mu.Representation.DefaultLociLabelProvider),_r.Behavior(mu.Representation.FocusLoci),_r.Behavior(mu.Camera.FocusLoci),_r.Behavior(mu.Camera.CameraAxisHelper),_r.Behavior(mu.Camera.CameraControls),_r.Behavior(c1),_r.Behavior(mu.CustomProps.StructureInfo),_r.Behavior(mu.CustomProps.AccessibleSurfaceArea),_r.Behavior(mu.CustomProps.BestDatabaseSequenceMapping),_r.Behavior(mu.CustomProps.Interactions),_r.Behavior(mu.CustomProps.SecondaryStructure),_r.Behavior(mu.CustomProps.ValenceModel),_r.Behavior(mu.CustomProps.CrossLinkRestraint)],animations:[GCe,VCe,qCe,zCe,NCe,jCe,HCe]});var Hc=ar(un());var got={color:M.Color(Gt.black,{description:"Display color of the volume."}),wireframe:M.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:M.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},yot=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]),GI=class extends yr{constructor(){super(...arguments),this.ref=Kt.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name),this.getVisible=()=>{let t=this.plugin.state.data,r=this.ref;return r?!t.cells.get(r).state.isHidden:!1},this.toggleVisible=()=>{let t=this.plugin.state.data,r=this.ref;r&&vo(t,r,!t.cells.get(r).state.isHidden)}}componentDidUpdate(){this.ref=Kt.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)}componentDidMount(){this.subscribe(this.plugin.state.data.events.cell.stateUpdated,t=>{this.ref===t.ref&&this.forceUpdate()})}render(){let t=this.props,{isRelative:r,stats:n}=t,o=t.channels[t.name],{min:i,max:s,mean:a,sigma:l}=n,c=Math.round(100*(o.isoValue.kind==="relative"?o.isoValue.relativeValue:o.isoValue.absoluteValue))/100,u=(i-a)/l,d=(s-a)/l;if(!this.props.isUnbounded){let g=yot.get(this.props.name);this.props.name==="em"?(u=Math.max(g[0],u),d=Math.min(g[1],d)):(u=g[0],d=g[1])}let m=a+l*u,p=a+l*d,h=VA(r?Math.round((p-m)/l)/100:l/100,2),f=r?u:m,C=r?d:p;return(0,Hc.jsx)(YM,{label:t.label+(t.isRelative?" \u03C3":""),colorStripe:o.color,pivot:(0,Hc.jsxs)("div",{className:"msp-volume-channel-inline-controls",children:[(0,Hc.jsx)(ch,{value:c,min:f,max:C,step:h,onChange:g=>t.changeIso(t.name,g,r),onChangeImmediate:g=>t.changeIso(t.name,g,r),disabled:t.params.isDisabled,onEnter:t.params.events.onEnter}),(0,Hc.jsx)(Jt,{svg:this.getVisible()?dc:uc,onClick:this.toggleVisible,toggleState:!1,disabled:t.params.isDisabled})]}),controls:(0,Hc.jsx)(An,{onChange:({name:g,value:b})=>t.changeParams(t.name,g,b),params:got,values:o,onEnter:t.params.events.onEnter,isDisabled:t.params.isDisabled})})}},JL=class extends yr{constructor(){super(...arguments),this.changeIso=(t,r,n)=>{let o=this.props.params;this.newParams({...o,entry:{name:o.entry.name,params:{...o.entry.params,channels:{...o.entry.params.channels,[t]:{...o.entry.params.channels[t],isoValue:n?ot.IsoValue.relative(r):ot.IsoValue.absolute(r)}}}}})},this.changeParams=(t,r,n)=>{let o=this.props.params;this.newParams({...o,entry:{name:o.entry.name,params:{...o.entry.params,channels:{...o.entry.params.channels,[t]:{...o.entry.params.channels[t],[r]:n}}}}})},this.changeOption=({name:t,value:r})=>{let n=this.props.params;if(t==="entry")this.newParams({...n,entry:{name:r,params:n.entry.params}});else{let o=this.props.b.data,i=o.info.kind==="em",s=r.params.isRelative,a=o.info.header.sampling[0],l=n.entry.params.channels,u={...n.entry.params.view.name===r.name?n.entry.params.view.params:this.props.info.params.entry.map(n.entry.name).params.view.map(r.name).defaultValue};r.name==="selection-box"?u.radius=r.params.radius:r.name==="camera-target"?(u.radius=r.params.radius,u.dynamicDetailLevel=r.params.dynamicDetailLevel):r.name==="box"?(u.bottomLeft=r.params.bottomLeft,u.topRight=r.params.topRight):r.name==="auto"&&(u.radius=r.params.radius,u.selectionDetailLevel=r.params.selectionDetailLevel),u.isUnbounded=!!r.params.isUnbounded,this.newParams({...n,entry:{name:n.entry.name,params:{...n.entry.params,view:{name:r.name,params:u},detailLevel:r.params.detailLevel,channels:i?{em:this.convert(l.em,a.valuesInfo[0],s)}:{"2fo-fc":this.convert(l["2fo-fc"],a.valuesInfo[0],s),"fo-fc(+ve)":this.convert(l["fo-fc(+ve)"],a.valuesInfo[1],s),"fo-fc(-ve)":this.convert(l["fo-fc(-ve)"],a.valuesInfo[1],s)}}}})}}}areInitial(t){return M.areEqual(this.props.info.params,t,this.props.info.initialValues)}newParams(t){this.props.events.onChange(t,this.areInitial(t))}convert(t,r,n){return{...t,isoValue:n?ot.IsoValue.toRelative(t.isoValue,r):ot.IsoValue.toAbsolute(t.isoValue,r)}}render(){if(!this.props.b)return null;let t=this.props.b.data,r=t.info.kind==="em",n=r?"em":"2fo-fc",o=this.props.params,i=this.props.info.params.entry.map(o.entry.name),s=i.params.detailLevel,a={...s,label:"Dynamic Detail",defaultValue:i.params.view.map("camera-target").params.dynamicDetailLevel.defaultValue},l={...s,label:"Selection Detail",defaultValue:i.params.view.map("auto").params.selectionDetailLevel.defaultValue},c=t.info.header.sampling[0],u=o.entry.params.channels[n].isoValue.kind==="relative",d=M.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),m=!!o.entry.params.view.params.isUnbounded,p=M.Boolean(m,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),h=o.entry.params.view.name==="off",f={entry:M.Select(o.entry.name,t.data.entries.map(g=>[g.dataId,g.dataId]),{isHidden:h,description:"Which entry with volume data to display."}),view:M.MappedStatic(o.entry.params.view.name,{off:M.Group({isRelative:M.Boolean(u,{isHidden:!0}),isUnbounded:M.Boolean(m,{isHidden:!0})},{description:"Display off."}),box:M.Group({bottomLeft:M.Vec3(D.zero()),topRight:M.Vec3(D.zero()),detailLevel:s,isRelative:d,isUnbounded:p},{description:"Static box defined by cartesian coords."}),"selection-box":M.Group({radius:M.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,isRelative:d,isUnbounded:p},{description:"Box around focused element."}),"camera-target":M.Group({radius:M.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),detailLevel:{...s,isHidden:!0},dynamicDetailLevel:a,isRelative:d,isUnbounded:p},{description:"Box around camera target."}),cell:M.Group({detailLevel:s,isRelative:d,isUnbounded:p},{description:"Box around the structure's bounding box."}),auto:M.Group({radius:M.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212B within which the volume is shown."}),detailLevel:s,selectionDetailLevel:l,isRelative:d,isUnbounded:p},{description:"Box around focused element."})},{options:sa.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Around Camera" shows the volume around the point the camera is targeting. "Whole Structure" shows the volume for the whole structure.'})},C={entry:o.entry.name,view:{name:o.entry.params.view.name,params:{detailLevel:o.entry.params.detailLevel,radius:o.entry.params.view.params.radius,bottomLeft:o.entry.params.view.params.bottomLeft,topRight:o.entry.params.view.params.topRight,selectionDetailLevel:o.entry.params.view.params.selectionDetailLevel,dynamicDetailLevel:o.entry.params.view.params.dynamicDetailLevel,isRelative:u,isUnbounded:m}}};return h?(0,Hc.jsx)(An,{onChange:this.changeOption,params:f,values:C,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled}):(0,Hc.jsxs)(Hc.Fragment,{children:[!r&&(0,Hc.jsx)(GI,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:o.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:c.valuesInfo[0],isUnbounded:m}),!r&&(0,Hc.jsx)(GI,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:o.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:c.valuesInfo[1],isUnbounded:m}),!r&&(0,Hc.jsx)(GI,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:o.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:c.valuesInfo[1],isUnbounded:m}),r&&(0,Hc.jsx)(GI,{label:"EM",name:"em",bCell:this.props.bCell,channels:o.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:c.valuesInfo[0],isUnbounded:m}),(0,Hc.jsx)(An,{onChange:this.changeOption,params:f,values:C,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})]})}};var eN=()=>({...ZCe(),customParamEditors:[[B_,JL]]});async function XCe(e){let{spec:t,target:r,onBeforeUIRender:n,render:o}=e,i=new XL(t||eN());await i.init(),n&&await n(i),o((0,KCe.createElement)(Ebe,{plugin:i}),r);try{await i.canvas3dInitialized}catch{}return i}var y2e=ar(g2e());function v2e(e,t){(0,y2e.createRoot)(t).render(e)}typeof window<"u"&&function(){window.console=window.console||{};let e=window.console,t,r,n={},o=function(){},i="memory".split(","),s="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");for(;t=i.pop();)e[t]||(e[t]=n);for(;r=s.pop();)e[r]||(e[r]=o)}();typeof window.HTMLCanvasElement<"u"&&!window.HTMLCanvasElement.prototype.toBlob&&Object.defineProperty(window.HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,r){let n=window.atob(this.toDataURL(t,r).split(",")[1]),o=n.length,i=o>>2,s=new Uint8Array(o),a=new Uint32Array(s.buffer,0,i),l=0;for(let u=0;u<i;u++)a[u]=n.charCodeAt(l++)|n.charCodeAt(l++)<<8|n.charCodeAt(l++)<<16|n.charCodeAt(l++)<<24;let c=o&3;for(;c--;)s[l]=n.charCodeAt(l++);e(new window.Blob([s],{type:t||"image/png"}))}});Math.cbrt=Math.cbrt||function(e){let t=Math.pow(Math.abs(e),.3333333333333333);return e<0?-t:t};Math.sign||(Math.sign=function(e){return e=+e,e===0||isNaN(e)?Number(e):e>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&t>-9007199254740992&&t<9007199254740992&&Math.floor(t)===t});Number.isNaN||(Number.isNaN=function(t){return t!==t});Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(e==null)throw new TypeError("Cannot convert first argument to object");let t=Object(e),r=!1,n;for(let o=1;o<arguments.length;o++){let i=arguments[o];if(i==null)continue;let s=Object.keys(Object(i));for(let a=0,l=s.length;a<l;a++){let c=s[a];try{let u=Object.getOwnPropertyDescriptor(i,c);u!==void 0&&u.enumerable&&(t[c]=i[c])}catch(u){r||(r=!0,n=u)}}if(r)throw n}return t}});String.prototype.startsWith||function(){"use strict";let e=function(){let n;try{let o={},i=Object.defineProperty;n=i(o,o,o)&&i}catch{}return n}(),t={}.toString,r=function(n){if(this===null)throw TypeError();let o=String(this);if(n&&t.call(n)==="[object RegExp]")throw TypeError();let i=o.length,s=String(n),a=s.length,l=arguments.length>1?arguments[1]:void 0,c=l?Number(l):0;Number.isNaN(c)&&(c=0);let u=Math.min(Math.max(c,0),i);if(a+u>i)return!1;let d=-1;for(;++d<a;)if(o.charCodeAt(u+d)!==s.charCodeAt(d))return!1;return!0};e?e(String.prototype,"startsWith",{value:r,configurable:!0,writable:!0}):String.prototype.startsWith=r}();String.prototype.endsWith||(String.prototype.endsWith=function(e,t){let r=this.toString();(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length),t-=e.length;let n=r.indexOf(e,t);return n!==-1&&n===t});String.prototype.repeat||(String.prototype.repeat=function(e){"use strict";if(this===null)throw new TypeError("can't convert "+this+" to object");let t=""+this;if(e=+e,Number.isNaN(e)&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),t.length===0||e===0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");let r="";for(;(e&1)===1&&(r+=t),e>>>=1,e!==0;)t+=t;return r});String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return typeof t!="number"&&(t=0),t+e.length>this.length?!1:this.indexOf(e,t)!==-1});Array.prototype.includes||(Array.prototype.includes=function(e){"use strict";if(this==null)throw new TypeError("Array.prototype.includes called on null or undefined");let t=Object(this),r=parseInt(t.length,10)||0;if(r===0)return!1;let n=parseInt(arguments[1],10)||0,o;n>=0?o=n:(o=r+n,o<0&&(o=0));let i;for(;o<r;){if(i=t[o],e===i||Number.isNaN(e)&&Number.isNaN(i))return!0;o++}return!1});Array.from||(Array.from=function(){let e=Object.prototype.toString,t=function(i){return typeof i=="function"||e.call(i)==="[object Function]"},r=function(i){let s=Number(i);return isNaN(s)?0:s===0||!isFinite(s)?s:(s>0?1:-1)*Math.floor(Math.abs(s))},n=Math.pow(2,53)-1,o=function(i){let s=r(i);return Math.min(Math.max(s,0),n)};return function(s){let a=this,l=Object(s);if(s==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");let c=arguments.length>1?arguments[1]:void 0,u;if(typeof c<"u"){if(!t(c))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(u=arguments[2])}let d=o(l.length),m=t(a)?Object(new a(d)):new Array(d),p=0,h;for(;p<d;)h=l[p],c?m[p]=typeof u>"u"?c(h,p):c.call(u,h,p):m[p]=h,p+=1;return m.length=d,m}}());typeof window<"u"&&function(){let e=0,t=["ms","moz","webkit","o"];for(let r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(r){let n=new Date().getTime(),o=Math.max(0,16-(n-e)),i=window.setTimeout(function(){let s=n+o;r(s)},o);return e=n+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(r){clearTimeout(r)})}();Function.prototype.name===void 0&&Object.defineProperty!==void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});typeof window<"u"&&(window.performance===void 0&&(window.performance={}),window.performance.now===void 0&&function(){let e=Date.now();window.performance.now=function(){return Date.now()-e}}());Object.defineProperty!==void 0&&(Number.MAX_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:Math.pow(2,53)-1}),Number.MIN_SAFE_INTEGER===void 0&&Object.defineProperty(Number,"MIN_SAFE_INTEGER",{enumerable:!1,configurable:!1,writable:!1,value:-(Math.pow(2,53)-1)}));Object.entries||(Object.entries=function(e){let t=Object.keys(e),r=t.length,n=new Array(r);for(;r--;)n[r]=[t[r],e[t[r]]];return n});Object.hasOwn||(Object.hasOwn=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)});Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null)throw TypeError('"this" is null or not defined');let t=Object(this),r=t.length>>>0;if(typeof e!="function")throw TypeError("predicate must be a function");let n=arguments[1],o=0;for(;o<r;){let i=t[o];if(e.call(n,i,o,t))return i;o++}},configurable:!0,writable:!0});Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(this==null)throw new TypeError("this is null or not defined");let t=Object(this),r=t.length>>>0,o=arguments[1]>>0,i=o<0?Math.max(r+o,0):Math.min(o,r),s=arguments[2],a=s===void 0?r:s>>0,l=a<0?Math.max(r+a,0):Math.min(a,r);for(;i<l;)t[i]=e,i++;return t}});Array.prototype.copyWithin||Object.defineProperty(Array.prototype,"copyWithin",{value:function(e,t){if(this==null)throw new TypeError("this is null or not defined");let r=Object(this),n=r.length>>>0,o=e>>0,i=o<0?Math.max(n+o,0):Math.min(o,n),s=t>>0,a=s<0?Math.max(n+s,0):Math.min(s,n),l=arguments[2],c=l===void 0?n:l>>0,u=c<0?Math.max(n+c,0):Math.min(c,n),d=Math.min(u-a,n-i),m=1;for(a<i&&i<a+d&&(m=-1,a+=d-1,i+=d-1);d>0;)a in r?r[i]=r[a]:delete r[i],a+=m,i+=m,d--;return r},configurable:!0,writable:!0});Int8Array.prototype.copyWithin||Object.defineProperty(Int8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int16Array.prototype.copyWithin||Object.defineProperty(Int16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Int32Array.prototype.copyWithin||Object.defineProperty(Int32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint8Array.prototype.copyWithin||Object.defineProperty(Uint8Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint16Array.prototype.copyWithin||Object.defineProperty(Uint16Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Uint32Array.prototype.copyWithin||Object.defineProperty(Uint32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float32Array.prototype.copyWithin||Object.defineProperty(Float32Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});Float64Array.prototype.copyWithin||Object.defineProperty(Float64Array.prototype,"copyWithin",{value:Array.prototype.copyWithin});var ax="https://molstarvolseg.ncbr.muni.cz/v2",gA=class{constructor(t=ax){this.volumeServerUrl=t.replace(/\/$/,"")}async updateAnnotationsJson(t,r,n){let o=`${this.volumeServerUrl}/${t}/${r}/annotations_json/update`,i=JSON.stringify({annotations_json:n});await fetch(o,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})}async editDescriptionsUrl(t,r,n){let o=`${this.volumeServerUrl}/${t}/${r}/descriptions/edit`,i=JSON.stringify({descriptions:n});await fetch(o,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})}async editSegmentAnnotationsUrl(t,r,n){let o=`${this.volumeServerUrl}/${t}/${r}/segment_annotations/edit`,i=JSON.stringify({segment_annotations:n});await fetch(o,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})}async removeDescriptionsUrl(t,r,n){let o=`${this.volumeServerUrl}/${t}/${r}/descriptions/remove`,i=JSON.stringify({description_ids:n});await fetch(o,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})}async removeSegmentAnnotationsUrl(t,r,n){let o=`${this.volumeServerUrl}/${t}/${r}/segment_annotations/remove`,i=JSON.stringify({annotation_ids:n});await fetch(o,{method:"POST",body:i,headers:{"Content-Type":"application/json"}})}entryListUrl(t,r){return`${this.volumeServerUrl}/list_entries/${t}/${r??""}`}metadataUrl(t,r){return`${this.volumeServerUrl}/${t}/${r}/metadata`}volumeUrl(t,r,n,o,i,s){if(i){let[[a,l,c],[u,d,m]]=i;return`${this.volumeServerUrl}/${t}/${r}/volume/box/${n}/${o}/${a}/${l}/${c}/${u}/${d}/${m}?max_points=${s}`}else return`${this.volumeServerUrl}/${t}/${r}/volume/cell/${n}/${o}?max_points=${s}`}latticeUrl(t,r,n,o,i,s){if(i){let[[a,l,c],[u,d,m]]=i;return`${this.volumeServerUrl}/${t}/${r}/segmentation/box/${n}/${o}/${a}/${l}/${c}/${u}/${d}/${m}?max_points=${s}`}else return`${this.volumeServerUrl}/${t}/${r}/segmentation/cell/${n}/${o}?max_points=${s}`}geometricSegmentationUrl(t,r,n,o){return`${this.volumeServerUrl}/${t}/${r}/geometric_segmentation/${n}/${o}`}meshUrl_Json(t,r,n,o,i,s){return`${this.volumeServerUrl}/${t}/${r}/mesh/${n}/${o}/${i}/${s}`}meshUrl_Bcif(t,r,n,o,i,s){return`${this.volumeServerUrl}/${t}/${r}/mesh_bcif/${n}/${o}/${i}/${s}`}volumeInfoUrl(t,r){return`${this.volumeServerUrl}/${t}/${r}/volume_info`}async getEntryList(t,r){return await(await fetch(this.entryListUrl(t,r))).json()}async getMetadata(t,r){let n=this.metadataUrl(t,r),o=await fetch(n);if(!o.ok)throw new Error(`Failed to fetch metadata from ${n}`);return await o.json()}};var rE=ue.Schema.int,yW=ue.Schema.float,xst={mesh:{id:rE},mesh_vertex:{mesh_id:rE,vertex_id:rE,x:yW,y:yW,z:yW},mesh_triangle:{mesh_id:rE,vertex_id:rE}},b2e=e=>bc(xst,e);function vW(e,t){if(t.scale!==void 0){let[r,n,o]=t.scale,i=e.vertexBuffer.ref.value;for(let s=0;s<i.length;s+=3)i[s]*=r,i[s+1]*=n,i[s+2]*=o}if(t.shift!==void 0){let[r,n,o]=t.shift,i=e.vertexBuffer.ref.value;for(let s=0;s<i.length;s+=3)i[s]+=r,i[s+1]+=n,i[s+2]+=o}if(t.matrix!==void 0){let r=e.vertexBuffer.ref.value,n=t.matrix,o=3*e.vertexCount;for(let i=0;i<o;i+=3)D.transformMat4Offset(r,r,n,i,i,0)}if(t.group!==void 0){let r=e.groupBuffer.ref.value;for(let n=0;n<r.length;n++)r[n]=t.group}if(t.invertSides){let r=e.indexBuffer.ref.value,n;for(let i=0;i<r.length;i+=3)n=r[i],r[i]=r[i+1],r[i+1]=n;let o=e.normalBuffer.ref.value;for(let i=0;i<o.length;i++)o[i]*=-1}}async function x2e(e,t=void 0,r="cartesian"){let n=e.blocks.find(v=>v.header==="VOLUME_INFO"),o=e.blocks.find(v=>v.header==="MESHES");if(!n||!o)throw new Error("Missing VOLUME_INFO or MESHES block in mesh CIF file");let i=Di.schema.densityServer(n),s=b2e(o),a=s.mesh_vertex._rowCount,l=Math.floor(s.mesh_triangle._rowCount/3),c=s.mesh.id.toArray(),u=s.mesh_vertex.mesh_id.toArray(),d=s.mesh_vertex.x.toArray(),m=s.mesh_vertex.y.toArray(),p=s.mesh_vertex.z.toArray(),h=s.mesh_triangle.mesh_id.toArray(),f=s.mesh_triangle.vertex_id.toArray(),C=new Uint32Array(3*l),g=Ast(u);for(let v=0;v<3*l;v++){let _=g.get(h[v]);C[v]=_+f[v]}let b=Ist(d,m,p),y=new Float32Array(3*a),x=new Float32Array(u),A=Ct.create(b,C,y,x,a,l);if(t??=Cst(A),t&&vW(A,{invertSides:!0}),r==="cartesian"){let v=await Uf(i).run(),_=go.getGridToCartesianTransform(v.grid);vW(A,{matrix:_})}else if(r==="fractional"){let v=i.volume_data_3d_info.sample_count.value(0),_=i.volume_data_3d_info.origin.value(0),I=i.volume_data_3d_info.dimensions.value(0);if(I[0]!==1||I[1]!==1||I[2]!==1)throw new Error(`Asserted the fractional dimensions are [1,1,1], but are actually [${I}]`);let T=[1/v[0],1/v[1],1/v[2]];vW(A,{scale:T,shift:Array.from(_)})}return Ct.computeNormals(A),{mesh:A,meshIds:Array.from(c)}}function Cst(e){let t=e.vertexBuffer.ref.value,r=e.indexBuffer.ref.value,n=Sst(e),o=D.create(3*n[0],3*n[1],3*n[2]),i=0,[s,a,l,c,u,d,m]=[D(),D(),D(),D(),D(),D(),D()];for(let p=0;p<r.length;p+=3)D.fromArray(s,t,3*r[p]),D.fromArray(a,t,3*r[p+1]),D.fromArray(l,t,3*r[p+2]),D.sub(c,a,s),D.sub(u,l,a),D.cross(d,c,u),D.add(m,s,a),D.add(m,m,l),D.sub(m,m,o),i+=D.dot(m,d);return i<0}function Sst(e){let t=e.vertexBuffer.ref.value,r=t.length,n=0,o=0,i=0;for(let s=0;s<t.length;s+=3)n+=t[s],o+=t[s+1],i+=t[s+2];return D.create(n/r,o/r,i/r)}function Ist(e,t,r){let n=e.length,o=new Float32Array(3*n);for(let i=0;i<n;i++)o[3*i]=e[i],o[3*i+1]=t[i],o[3*i+2]=r[i];return o}function Ast(e){let t=new Map;for(let r=0;r<e.length;r++)t.has(e[r])||t.set(e[r],r);return t}function C2e(e){let t=e.vertexCount,r=e.vertexBuffer.ref.value;if(t===0)return null;let n=r[0],o=r[1],i=r[2],s=n,a=o,l=i;for(let c=0;c<3*t;c+=3){let u=r[c],d=r[c+1],m=r[c+2];u<n&&(n=u),d<o&&(o=d),m<i&&(i=m),u>s&&(s=u),d>a&&(a=d),m>l&&(l=m)}return xt.create(D.create(n,o,i),D.create(s,a,l))}var S2e=function*(){let e=wst(Object.values(Gt)),t=0;for(;;)yield e[t],t++,t>=e.length&&(t=0)}();function wst(e){let t=e.length;for(;t!==0;){let r=Math.floor(Math.random()*t);t-=1;let n=e[t];e[t]=e[r],e[r]=n}return e}var I2e=.5,A2e=.2,w2e=1,bW=st.builderFactory("volseg-v2"),CF=e=>!!e?.detail,vA;(a=>{function e(){return{segmentId:0,segmentName:"Empty",detail:0,meshIds:[],mesh:Ct.createEmpty()}}a.empty=e;async function t(l,c,u,d){let{mesh:m,meshIds:p}=await x2e(l);return{segmentId:c,segmentName:u,detail:d,meshIds:p,mesh:m}}a.fromCIF=t;function r(l){return`Meshlist "${l.segmentName}" (detail ${l.detail}): ${l.meshIds.length} meshes, ${l.mesh.vertexCount} vertices, ${l.mesh.triangleCount} triangles`}a.stats=r;function n(l,c){let u=l.mesh;return br.create(l.segmentName,l,u,()=>c,()=>1,m=>l.segmentName)}a.getShape=n;function o(l){let c=null;for(let u of l)u&&(c?(D.min(c.min,c.min,u.min),D.max(c.max,c.max,u.max)):(c=xt.zero(),xt.copy(c,u)));return c}a.combineBBoxes=o;function i(l){return C2e(l.mesh)}a.bbox=i;function s(l){let c=new Set;for(let u=0;u<l.mesh.vertexCount;u++)c.add(u);for(let u=0;u<3*l.mesh.triangleCount;u++){let d=l.mesh.vertexBuffer.ref.value[u];c.delete(d)}return c.size===0}a.allVerticesUsed=s})(vA||={});var Xv=class extends fe.Create({name:"Parsed Meshlist",typeClass:"Object"}){},Pnn=bW({name:"new-meshlist-from-string",from:fe.Format.Cif,to:Xv,params:{label:M.Text(Xv.type.name,{isHidden:!0}),segmentId:M.Numeric(1,{},{isHidden:!0}),segmentName:M.Text("Segment"),detail:M.Numeric(1,{},{isHidden:!0}),ownerId:M.Text("",{isHidden:!0})}})({apply({a:e,params:t},r){return ke.create("Create Parsed Meshlist",async n=>{let o=await vA.fromCIF(e.data,t.segmentId,t.segmentName,t.detail);o.ownerId=t.ownerId;let i=o.meshIds.length===1?"":"es";return new Xv(o,{label:t.label,description:`${o.segmentName} (${o.meshIds.length} mesh${i})`})})}}),_2e;(t=>{function e(r,n){let o=n??S2e.next().value;return{label:"Mesh",data:r,params:Tst,geometryUtils:Ct.Utils,getShape:(i,s)=>vA.getShape(s,o)}}t.fromMeshlistData=e})(_2e||={});var Tst={...Ct.Params,quality:M.Select("custom",ag,{isEssential:!0,description:"Visual/rendering quality of the representation."}),doubleSided:M.Boolean(!0,at.CustomQualityParamInfo),transparentBackfaces:M.Select("on",M.arrayToOptions(["off","on","opaque"]),at.ShadingCategory)},T2e=bW({name:"new-shape-from-meshlist",display:{name:"Shape from Meshlist",description:"Create Shape from Meshlist data"},from:Xv,to:fe.Shape.Provider,params:{color:M.Value(void 0)}})({apply({a:e,params:t}){let r=_2e.fromMeshlistData(e.data,t.color);return new fe.Shape.Provider(r,{label:fe.Shape.Provider.type.name,description:e.description})}}),Est={id:M.Numeric(0),label:M.Text(""),color:M.Color(ze(1184274)),detail:M.Numeric(1)},E2e={meshSegmentParams:M.ObjectList(Est,e=>e.id.toString())},xF=class{constructor(t){this.meshData=t}},yA=class extends fe.Create({name:"Vol & Seg Mesh Segmentation",typeClass:"Data"}){},P2e=bW({name:"create-meshlist-from-mesh-segmentation",from:yA,to:Xv,params:{segmentId:M.Numeric(1,{},{isHidden:!0}),ownerId:M.Text(""),segmentationId:M.Text("0")}})({apply({a:e,params:t,spine:r},n){return ke.create("Create Parsed Meshlist",async o=>{let i=t.segmentId,s=e.data.meshData.find(p=>p.meshSegmentParams.id===i);if(!s)throw Error("no segment data found");let a=s.parsedCif,{detail:l,label:c}=s.meshSegmentParams,u=await vA.fromCIF(a,t.segmentId,c,l);u.ownerId=t.ownerId,u.segmentationId=t.segmentationId;let d=u.meshIds.length===1?"":"es",m=c.replace(/<\/?[^>]+(>|$)/g,"");return new Xv(u,{label:m,description:`${m} (${u.meshIds.length} mesh${d})`})})}});function D2e(e){if(e){let t=[],r=Object.entries(e);for(let n of r)t.push(n[1]);return t}else return[]}function nE(e){let t={emd:"emdb"},[r,n]=e.split("-");return{source:t[r]??r,entryNumber:n}}function k2e(e,t){return`${{emdb:"emd"}[e]??e}-${t}`}function bA(e){return e!==void 0}var If=st.builderFactory("volseg-v2"),Fnn=If({name:"new-create-transformer",from:fe.Root,to:fe.Volume.Data,params:{label:M.Text("Volume",{isHidden:!0}),description:M.Text("",{isHidden:!0}),volume:M.Value(void 0,{isHidden:!0})}})({apply({params:e}){return new fe.Volume.Data(e.volume,{label:e.label,description:e.description})}});function M2e(e,t=60){if(e.length<=t)return e;let r=e.substring(0,t),n=r.lastIndexOf(" ");return n===-1?r+"...":(n>0&&",;.".includes(e.charAt(n-1))&&n--,e.substring(0,n)+"...")}function R2e(e,t){let r;return()=>{if(r===void 0&&(r=e()),t&&r===void 0)throw new Error(t);return r}}function Pst(e,t){if(!e||!t)return!1;let r=!0;return Object.keys(e).length===Object.keys(t).length?Object.keys(e).forEach(n=>{e[n]!==t[n]&&(r=!1)}):r=!1,r}var xA=class{constructor(t){this.raw=t}setCurrentlyUsedVolumeDownsampling(t){this.currentlyUsedVolumeDownsampling=t}get currentVolumeDownsampling(){if(this.currentlyUsedVolumeDownsampling)return this.currentlyUsedVolumeDownsampling;throw Error("Currently used volume downsampling is not set")}hasLatticeSegmentations(){let t=this.raw.grid;return t.segmentation_lattices&&t.segmentation_lattices.segmentation_ids.length>0?t.segmentation_lattices:!1}hasMeshSegmentations(){let t=this.raw.grid;return t.segmentation_meshes&&t.segmentation_meshes.segmentation_ids.length>0?t.segmentation_meshes:!1}hasGeometricSegmentations(){let t=this.raw.grid;return t.geometric_segmentation&&t.geometric_segmentation.segmentation_ids.length>0?t.geometric_segmentation:!1}hasSegmentations(){let t=this.raw.grid;return!!(t.geometric_segmentation&&t.geometric_segmentation.segmentation_ids.length>0||t.segmentation_lattices&&t.segmentation_lattices.segmentation_ids.length>0||t.segmentation_meshes&&t.segmentation_meshes.segmentation_ids.length>0)}removeDescription(t){let r=this.raw.annotation?.descriptions;this.raw.annotation&&r&&(delete r[t],this.raw.annotation.descriptions=r)}removeSegmentAnnotation(t){let n=this.allAnnotations.filter(o=>o.id!==t);this.raw.annotation.segment_annotations=n}get allDescriptions(){let t=this.raw.annotation?.descriptions;return t?D2e(t):[]}getDescriptions(t,r,n){return this.allDescriptions.filter(a=>a.target_id&&a.target_id.segmentation_id===t&&a.target_kind===r).filter(a=>{if(a.hasOwnProperty("time")&&Number.isFinite(a.time)){if(n===a.time)return a}else if(a.hasOwnProperty("time")&&Array.isArray(a.time)&&a.time.every(l=>Number.isFinite(l))){if(a.time.includes(n))return a}else return a})}get allAnnotations(){let t=this.raw.annotation?.segment_annotations;return t||[]}getAllAnnotations(t){return this.allAnnotations.filter(n=>{if(n.hasOwnProperty("time")&&Number.isFinite(n.time)){if(t===n.time)return n}else if(n.hasOwnProperty("time")&&Array.isArray(n.time)&&n.time.every(o=>Number.isFinite(o))){if(n.time.includes(t))return n}else return n})}get allSegmentIds(){return this.allAnnotations?.map(t=>t.segment_id)}get channelAnnotations(){return this.raw.annotation?.volume_channels_annotations}getVolumeChannelColor(t){if(!this.channelAnnotations)return ze(1184274);let r=this.channelAnnotations.filter(n=>n.label===t)[0]?.color;return r?ze.fromNormalizedArray(r,0):ze(1184274)}getVolumeChannelLabel(t){if(!this.channelAnnotations)return null;let r=this.channelAnnotations.filter(n=>n.channel_id===t)[0]?.label;return r||null}getSegmentAnnotation(t,r,n){return this.allAnnotations.find(i=>i.segment_id===t&&i.segment_kind===n&&i.segmentation_id===r)}getSegmentDescription(t,r,n){let o=Lh(t,r,n);if(this.allDescriptions){if(!this.segmentMap){this.segmentMap=new Map;for(let i of this.allDescriptions)if(i.target_id&&i.target_kind!=="entry"){let s=i.target_kind,a=i.target_id.segmentation_id,l=i.target_id.segment_id,c=Lh(l,a,s),u=this.segmentMap.get(c);u?this.segmentMap.set(c,[...u,i]):this.segmentMap.set(c,[i])}}return this.segmentMap.get(o)}}getMeshDetailLevels(t,r,n){if(!this.raw.grid.segmentation_meshes)return[];let i=this.raw.grid.segmentation_meshes.segmentation_metadata[t].mesh_timeframes[r].segment_ids;if(!i)return[];let s=i[n].detail_lvls;return Object.keys(s).map(a=>parseInt(a))}getSufficientMeshDetail(t,r,n,o){let i=this.getMeshDetailLevels(t,r,n);return o!==null&&(i=i.filter(s=>s<=o)),Math.max(...i)}getMeshSegmentIdsForSegmentationIdAndTimeframe(t,r){let o=this.raw.grid.segmentation_meshes.segmentation_metadata[t].mesh_timeframes[r].segment_ids;return o?Object.keys(o).map(i=>parseInt(i)):[]}getAllDescriptionsBasedOnMetadata(t){return this.allDescriptions.filter(o=>Pst(o.metadata,t))}filterDescriptions(t,r){if(r==="")return t;let n=r.toLowerCase();return t.filter(i=>{if(i.name&&i.name.toLowerCase().includes(n)||i.metadata&&Object.values(i.metadata).map(l=>l.toLowerCase()).includes(n))return!0})}getAllSegmentAnotationsForSegmentationAndTimeframe(t,r,n){return this.allAnnotations.filter(a=>a.segmentation_id===t&&a.segment_kind===r).filter(a=>{if(a.hasOwnProperty("time")&&Number.isFinite(a.time)){if(n===a.time)return a}else if(a.hasOwnProperty("time")&&Array.isArray(a.time)&&a.time.every(l=>Number.isFinite(l))){if(a.time.includes(n))return a}else return a})}get gridTotalVolume(){let t=this.currentVolumeDownsampling,[r,n,o]=this.raw.grid.volumes.volume_sampling_info.boxes[t].voxel_size,[i,s,a]=this.raw.grid.volumes.volume_sampling_info.boxes[t].grid_dimensions;return r*n*o*i*s*a}};function B2e(e){return"shape_primitive_list"in e}function Lh(e,t,r){return`${r}:${t}:${e}`}function Su(e){let t=e.split(":")[0],r=e.split(":")[1],n=e.split(":")[2];return{kind:t,segmentationId:r,segmentId:Number(n)}}function CA(e){return e.map(t=>({id:t.target_id.segment_id,label:t?.name&&!t?.is_hidden?`<b>${t?.name}</b>`:"No label provided or description is hidden"}))}var xW=5,SF=class{constructor(t){this.entryData=t}async loadSegmentation(){}updateOpacity(t,r){let n=this.entryData.findNodesByTags("mesh-segment-visual",r),o=this.entryData.newUpdate();for(let i of n)o.to(i).update(qp,s=>{s.alpha=t});return o.commit()}async createMeshRepresentation3D(t,r){let n=t.data.meshData,o=this.entryData.ref,i=this.entryData.metadata.value.gridTotalVolume,s=r.segmentationId;for(let a of n){let c=await this.entryData.plugin.build().to(t).to(t).apply(P2e,{segmentId:a.meshSegmentParams.id,ownerId:o,segmentationId:s}).commit(),u=I2e*i,d=!1;if(u!==void 0&&c.data){let m=vA.bbox(c.data)||xt.zero();d=xt.volume(m)>u}await this.entryData.plugin.build().to(c).apply(T2e,{color:a.meshSegmentParams.color}).apply(qp,{alpha:d?A2e:w2e},{tags:["mesh-segment-visual",`segment-${a.meshSegmentParams.id}`,s]}).commit()}}getMeshSegmentParams(t,r){let n=[],o=this.entryData.metadata.value.getMeshSegmentIdsForSegmentationIdAndTimeframe(t,r),i=this.entryData.metadata.value.getAllSegmentAnotationsForSegmentationAndTimeframe(t,"mesh",r);for(let s of o){let a=i.find(m=>m.segment_id===s)?.color,l=a&&a.length>=3?ze.fromNormalizedArray(a,0):Gt.gray,c=`${t} | Segment ${s}`,u=this.entryData.metadata.value.getSufficientMeshDetail(t,r,s,xW),d={id:s,label:c,color:l,detail:u};n.push(d)}return n}async createMeshGroup(){let t=this.entryData.findNodesByTags("mesh-segmentation-group")[0]?.transform.ref;return t||(t=(await this.entryData.newUpdate().apply(Qa,{label:"Segmentation",description:"Mesh"},{tags:["mesh-segmentation-group"],state:{isCollapsed:!0}}).commit()).ref),t}async highlightSegment(t,r){let n=this.entryData.findNodesByTags("mesh-segment-visual",`segment-${t}`,r);for(let o of n)await ht.Interactivity.Object.Highlight(this.entryData.plugin,{state:this.entryData.plugin.state.data,ref:o.transform.ref})}async selectSegment(t,r){if(t===void 0||t<0||r===void 0)return;let o=this.entryData.findNodesByTags("mesh-segment-visual",`segment-${t}`,r)[0]?.obj;if(!o)return;let i=o.data.repr.getAllLoci()[0];i&&this.entryData.plugin.managers.interactivity.lociSelects.select({loci:i,repr:o.data.repr},!1)}async showSegments(t,r){let n=new Set(t),o=this.entryData.findNodesByTags("mesh-segment-visual",r);for(let i of o){let s=i.obj?.tags?.find(c=>c.startsWith("segment-"));if(!s)continue;let a=parseInt(s.split("-")[1]),l=n.has(a);vo(this.entryData.plugin.state.data,i.transform.ref,!l),n.delete(a)}}};var IF=class{constructor(t){this.entryData=t}async loadPdb(t,r){let n=`https://www.ebi.ac.uk/pdbe/entry-files/download/${t}.bcif`,o=await this.entryData.plugin.build().to(r).apply(Ru,{url:n,isBinary:!0},{tags:["fitted-model-data",`pdbid-${t}`]}).commit(),i=await this.entryData.plugin.build().to(o).apply(bb).commit(),s=await this.entryData.plugin.build().to(i).apply(ow).commit();return await this.entryData.plugin.builders.structure.hierarchy.applyPreset(s,"default",{representationPreset:"polymer-cartoon"}),o}async showPdbs(t){let r=new Set(t),n=this.entryData.findNodesByTags("fitted-model-data");for(let a of n){let l=a.obj?.tags?.find(d=>d.startsWith("pdbid-"));if(!l)continue;let c=l.split("-")[1],u=r.has(c);vo(this.entryData.plugin.state.data,a.transform.ref,!u),r.delete(c)}let o=Array.from(r);if(o.length===0)return;let i=this.entryData.findNodesByTags("fitted-models-group")[0]?.transform.ref;i||(i=(await this.entryData.newUpdate().apply(Qa,{label:"Fitted Models"},{tags:["fitted-models-group"],state:{isCollapsed:!0}}).commit()).ref);let s=[];for(let a of o)s.push(this.loadPdb(a,i));for(let a of s)await a}};var SA={tryUseGpu:M.Boolean(!0,{description:`Attempt using GPU for faster rendering. 
Caution: with some hardware setups, this might render some objects incorrectly or not at all.`}),selectionMode:M.Boolean(!0,{description:"Allow selecting/deselecting a segment by clicking on it."})},bp=class extends fe.CreateBehavior({name:"Vol & Seg Global State"}){},xp=class extends tr.WithSubscribers{constructor(r,n){super(r,n);this.ref="";this.currentState=new jo(M.getDefaultValues(SA));this.currentState.next(n)}register(r){this.ref=r}unregister(){this.ref=""}isRegistered(){return this.ref!==""}async updateState(r,n){let o=this.currentState.value,i=[],s=r.state.data.selectQ(a=>a.ofType(Yl)).map(a=>a.obj?.data).filter(bA);if(n.tryUseGpu!==void 0&&n.tryUseGpu!==o.tryUseGpu)for(let a of s)i.push(a.setTryUseGpu(n.tryUseGpu));if(n.selectionMode!==void 0&&n.selectionMode!==o.selectionMode)for(let a of s)i.push(a.setSelectionMode(n.selectionMode));await Promise.all(i),await r.build().to(this.ref).update(n).commit()}static getGlobalState(r){return r.state.data.selectQ(n=>n.ofType(bp))[0]?.obj?.data.currentState.value}};var L2e="lattice-segmentation-group",Yv="lattice-segment-visual",N2e=ze.fromNormalizedRgb(.8,.8,.8),AF=class{constructor(t){this.colorMap=new Map;this.entryData=t}async createSegmentationGroup(){this.createColorMap();let t=this.entryData.findNodesByTags(L2e)[0]?.transform.ref;return t||(t=(await this.entryData.newUpdate().apply(Qa,{label:"Segmentation",description:"Lattice"},{tags:[L2e],state:{isCollapsed:!0}}).commit()).ref),t}async createSegmentationRepresentation3D(t,r){let n=t.data,o=r.segmentationId,i=ot.Segmentation.get(n),s=Array.from(i?.segments.keys()??[]);await this.entryData.newUpdate().to(t).apply(Je.Representation.VolumeRepresentation3D,Ul(this.entryData.plugin,n,{type:"segment",typeParams:{tryUseGpu:xp.getGlobalState(this.entryData.plugin)?.tryUseGpu},color:"volume-segment",colorParams:{palette:this.getPaletteForSegmentation(o,s)}}),{tags:[Yv,o]}).commit()}getPaletteForSegmentation(t,r){let n=this.colorMap.get(t);return n?{name:"colors",params:{list:{kind:"set",colors:r.map(i=>n.get(i)??N2e)}}}:{name:"colors",params:{list:{kind:"set",colors:r.map(i=>N2e)}}}}createColorMap(){let t=new Map;if(this.entryData.metadata.value.allAnnotations){for(let r of this.entryData.metadata.value.allAnnotations)if(r.color){let n=ze.fromNormalizedArray(r.color,0);if(t.get(r.segmentation_id)){let o=t.get(r.segmentation_id);o.set(r.segment_id,n),t.set(r.segmentation_id,o)}else{let o=new Map;o.set(r.segment_id,n),t.set(r.segmentation_id,o)}this.colorMap=t}}}async updateOpacity(t,r){let n=this.entryData.findNodesByTags(Yv,r)[0],o=this.entryData.newUpdate();return o.to(n).update(Je.Representation.VolumeRepresentation3D,i=>{i.type.params.alpha=t}),await o.commit()}makeLoci(t,r){let n=this.entryData.findNodesByTags(Yv,r)[0];if(!n)return;let o=n.obj?.data.repr,i=o.getAllLoci()[0];if(!(!i||!ot.Segment.isLoci(i)))return{loci:ot.Segment.Loci(i.volume,t),repr:o}}async highlightSegment(t,r){let n=this.makeLoci([t],r);n&&this.entryData.plugin.managers.interactivity.lociHighlights.highlight(n,!1)}async selectSegment(t,r){if(t===void 0||t<0||!r)return;let n=this.makeLoci([t],r);n&&this.entryData.plugin.managers.interactivity.lociSelects.select(n,!1)}async showSegments(t,r){let n=this.entryData.findNodesByTags(Yv,r)[0];if(!n)return;let o=this.entryData.currentState.value.selectedSegment,i=Su(o),s=i.segmentId,a=i.segmentationId,l=t.includes(s)&&!n.params?.values.type.params.segments.includes(s),c=this.entryData.newUpdate();c.to(n).update(Je.Representation.VolumeRepresentation3D,u=>{u.type.params.segments=t}),await c.commit(),l&&await this.selectSegment(s,a)}async setTryUseGpu(t){let r=this.entryData.findNodesByTags(Yv);for(let n of r){let o=n.transform.params;if(o.type.params.tryUseGpu===!t){let i={...o,type:{...o.type,params:{...o.type.params,tryUseGpu:t}}},s=this.entryData.newUpdate().to(n.transform.ref).update(i);await ht.State.Update(this.entryData.plugin,{state:this.entryData.plugin.state.data,tree:s,options:{doNotUpdateCurrent:!0}})}}}};var wF=new Gm({isosurface:"Isosurface","direct-volume":"Direct volume",slice:"Slice",off:"Off"},"isosurface"),_F={selectedSegment:M.Text(""),visibleSegments:M.ObjectList({segmentKey:M.Text("")},e=>e.segmentKey),visibleModels:M.ObjectList({pdbId:M.Text("")},e=>e.pdbId.toString()),channelsData:M.ObjectList({channelId:M.Text("0"),volumeIsovalueKind:M.Select("relative",[["relative","Relative"],["absolute","Absolute"]]),volumeIsovalueValue:M.Numeric(1),volumeType:wF.PDSelect(),volumeOpacity:M.Numeric(.2,{min:0,max:1,step:.05}),label:M.Text(""),color:M.Color(ze(1184274))},e=>e.channelId)},lx=class extends fe.Create({name:"Vol & Seg Entry State",typeClass:"Data"}){},F2e="volseg-state-from-entry";async function O2e(e){let t=nE(e);if(t.source==="emdb")try{let o=(await(await fetch(`https://www.ebi.ac.uk/emdb/api/entry/map/${t.entryNumber}`)).json())?.map?.contour_list?.contour;if(o&&o.length>0){let i=o.find(s=>s.primary)||o[0];if(i.level===void 0)throw new Error("EMDB API response missing contour level.");return{kind:"absolute",value:i.level}}}catch{}}async function V2e(e){let t=nE(e),r=[];if(t.source==="emdb"){e=e.toUpperCase();let n=`https://www.ebi.ac.uk/pdbe/api/emdb/entry/fitted/${e}`;try{let o=await fetch(n);if(o.ok){let s=(await o.json())[e]??[];for(let a of s){let l=a?.fitted_emdb_id_list?.pdb_id??[];r.push(...l)}}}catch{}}return r}var U2e="volume-group",oE="volume-visual",Dst=.5,z2e={volumeType:wF.PDSelect(),opacity:M.Numeric(.2,{min:0,max:1,step:.05},{hideIf:e=>e.volumeType==="off"})},TF=class{constructor(t){this.visualTypeParamCache={};this.entryData=t}async createVolumeGroup(){let t=this.entryData.findNodesByTags(U2e)[0]?.transform.ref;return t||(t=(await this.entryData.newUpdate().apply(Qa,{label:"Volume"},{tags:[U2e],state:{isCollapsed:!0}}).commit()).ref),t}async createVolumeRepresentation3D(t,r){let{channelId:n}=r,o=O2e(this.entryData.metadata.value.raw.annotation?.entry_id.source_db_id??this.entryData.entryId),i=this.entryData.metadata.value.getVolumeChannelColor(n),s=t.cell.obj.data,a=this.entryData.metadata.value.getVolumeChannelLabel(n);a||(a=n.toString());let l=wF.defaultValue,c=await o;if(!c){let f=s.grid.stats,C=(f.max-f.mean)/f.sigma;C>1?c={kind:"relative",value:1}:c={kind:"relative",value:C*.5}}let u=ot.adjustedIsoValue(s,c.value,c.kind),d=this.createVolumeVisualParams(s,l,i);this.changeIsovalueInVolumeVisualParams(d,u,s.grid.stats,n);let p=(await this.entryData.newUpdate().to(t).apply(Je.Representation.VolumeRepresentation3D,d,{tags:[oE]}).commit()).cell?.transform;if(!p)return null;let h={volumeType:p.state.isHidden?"off":p.params?.type.name,opacity:p.params?.type.params.alpha};return{isovalue:u,volumeType:h.volumeType,opacity:h.opacity,channelId:n,label:a,color:i}}async setVolumeVisual(t,r,n){let o=this.entryData.findNodesByRef(n.ref);if(!o)return;let i=o.transform.params;if(this.visualTypeParamCache[i.type.name]=i.type.params,t==="off")vo(this.entryData.plugin.state.data,o.transform.ref,!0);else{if(vo(this.entryData.plugin.state.data,o.transform.ref,!1),i.type.name===t)return;let s={...i,type:{name:t,params:this.visualTypeParamCache[t]??i.type.params}},a=o.obj?.data.sourceData.grid.stats;if(!a)throw new Error(`Cannot get volume stats from volume visual ${o.transform.ref}`);this.changeIsovalueInVolumeVisualParams(s,void 0,a,r);let l=this.entryData.newUpdate().to(o.transform.ref).update(s);await ht.State.Update(this.entryData.plugin,{state:this.entryData.plugin.state.data,tree:l,options:{doNotUpdateCurrent:!0}})}}async updateVolumeVisual(t,r,n){let{volumeType:o,opacity:i}=t,s=this.entryData.findNodesByRef(n.ref);if(!s)return;let a=s.transform.params;if(this.visualTypeParamCache[a.type.name]=a.type.params,o==="off")vo(this.entryData.plugin.state.data,s.transform.ref,!0);else{vo(this.entryData.plugin.state.data,s.transform.ref,!1);let l={...a,type:{name:o,params:this.visualTypeParamCache[o]??a.type.params}};l.type.params.alpha=i;let c=s.obj?.data.sourceData.grid.stats;if(!c)throw new Error(`Cannot get volume stats from volume visual ${s.transform.ref}`);this.changeIsovalueInVolumeVisualParams(l,void 0,c,r);let u=this.entryData.newUpdate().to(s.transform.ref).update(l);await ht.State.Update(this.entryData.plugin,{state:this.entryData.plugin.state.data,tree:u,options:{doNotUpdateCurrent:!0}})}}async setTryUseGpu(t){let r=this.entryData.findNodesByTags(oE);for(let n of r){let o=n.transform.params;if(o.type.params.tryUseGpu===!t){let i={...o,type:{...o.type,params:{...o.type.params,tryUseGpu:t}}},s=this.entryData.newUpdate().to(n.transform.ref).update(i);await ht.State.Update(this.entryData.plugin,{state:this.entryData.plugin.state.data,tree:s,options:{doNotUpdateCurrent:!0}})}}}getIsovalueFromState(t){let{volumeIsovalueKind:r,volumeIsovalueValue:n}=this.entryData.currentState.value.channelsData.filter(o=>o.channelId===t)[0];return r==="relative"?ot.IsoValue.relative(n):ot.IsoValue.absolute(n)}createVolumeVisualParams(t,r,n){r==="off"&&(r="isosurface");let o=t.grid.cells.space.dimensions,i={0:"x",1:"y",2:"z"};for(let s in o)if(o[s]===1)return Ul(this.entryData.plugin,t,{type:"slice",typeParams:{dimension:{name:i[s],params:0},isoValue:{kind:"relative",relativeValue:0}},color:"uniform",colorParams:{value:n}});return Ul(this.entryData.plugin,t,{type:r,typeParams:{alpha:.2,tryUseGpu:xp.getGlobalState(this.entryData.plugin)?.tryUseGpu},color:"uniform",colorParams:{value:n}})}changeIsovalueInVolumeVisualParams(t,r,n,o){switch(r??=this.getIsovalueFromState(o),t.type.name){case"isosurface":t.type.params.isoValue=r,t.type.params.tryUseGpu=xp.getGlobalState(this.entryData.plugin)?.tryUseGpu;break;case"direct-volume":let s=(ot.IsoValue.toAbsolute(r,n).absoluteValue-n.min)/(n.max-n.min),a=Dst*n.sigma/(n.max-n.min);t.type.params.controlPoints=[Ve.create(Math.max(s-a,0),0),Ve.create(s,1),Ve.create(Math.min(s+a,1),0)];break}}};var EF=class{constructor(t){this.shapePrimitiveData=t}},IA=class extends fe.Create({name:"Vol & Seg Geometric Segmentation",typeClass:"Data"}){};function kst(e,t=D.create(.5,.5,.5),r=D.create(1,1,1)){let n=de.identity();de.scale(n,n,r),de.translate(n,n,t),gt.addPrimitive(e,n,Z0())}function Mst(e,t=D.create(.5,.5,.5),r=D.create(1,1,1)){let n=de.identity();de.scale(n,n,r),de.translate(n,n,t),gt.addPrimitive(e,n,Jbe())}var PF=e=>!!e?.segmentAnnotations,Rst={segmentAnnotations:M.Value([],{isHidden:!0}),descriptions:M.Value([],{isHidden:!0}),segmentationId:M.Text(""),segmentId:M.Numeric(0)},Bst=st.builderFactory("msvolseg"),H2e=Bst({name:"create-shape-primitive-provider",display:{name:"Shape Primitives"},from:IA,to:fe.Shape.Provider,params:Rst})({apply({a:e,params:t}){return new fe.Shape.Provider({label:"Shape Primitives",data:t,params:Ct.Params,geometryUtils:Ct.Utils,getShape:(r,n)=>Nst(e.data.shapePrimitiveData,t)},{label:"Shape Primitives"})}});function Lst(e,t){return e.filter(n=>n.target_id&&n.target_id.segment_id===t)[0].name}function CW(e,t){return e.find(o=>o.segment_id===t)?.color??[.9,.9,.9,1]}function Nst(e,t){let r=gt.createState(512,512),n=t.descriptions,o=t.segmentAnnotations,i=e.shape_primitive_list.find(s=>s.id===t.segmentId);switch(r.currentGroup=0,i.kind){case"sphere":Rr(r,i.center,i.radius,2);break;case"cylinder":zr(r,i.start,i.end,1,{radiusTop:i.radius_top,radiusBottom:i.radius_bottom,bottomCap:!0,topCap:!0});break;case"box":kst(r,i.translation,i.scaling);break;case"pyramid":Mst(r,i.translation,i.scaling);break;case"ellipsoid":Ay(r,i.center,i.dir_major,i.dir_minor,i.radius_scale,2);break}return br.create("Shape Primitives",t,gt.getMesh(r),s=>ze.fromNormalizedArray(CW(o,i.id),0),()=>1,s=>Lst(n,i.id))}var j2e="geometric-segmentation-group",DF=class{constructor(t){this.entryData=t}async createGeometricSegmentationGroup(){let t=this.entryData.findNodesByTags(j2e)[0]?.transform.ref;return t||(t=(await this.entryData.newUpdate().apply(Qa,{label:"Segmentation",description:"Geometric segmentation"},{tags:[j2e],state:{isCollapsed:!0}}).commit()).ref),t}async createGeometricSegmentationRepresentation3D(t,r){let n=t.cell.obj.data,{timeframeIndex:o,segmentationId:i}=r,s=this.entryData.metadata.value.getDescriptions(i,"primitive",o),a=this.entryData.metadata.value.getAllSegmentAnotationsForSegmentationAndTimeframe(i,"primitive",o),l=this.entryData.newUpdate().to(t.ref);for(let c of n.shapePrimitiveData.shape_primitive_list){let d=CW(a,c.id)[3];l.apply(H2e,{segmentId:c.id,descriptions:s,segmentAnnotations:a,segmentationId:i}).apply(Je.Representation.ShapeRepresentation3D,{alpha:d},{tags:["geometric-segmentation-visual",i,`segment-${c.id}`]})}await l.commit()}async showSegments(t,r){let n=new Set(t),o=this.entryData.findNodesByTags("geometric-segmentation-visual",r);for(let i of o){let s=i.obj?.tags?.find(c=>c.startsWith("segment-"));if(!s)continue;let a=parseInt(s.split("-")[1]),l=n.has(a);vo(this.entryData.plugin.state.data,i.transform.ref,!l),n.delete(a)}}async highlightSegment(t,r){let n=this.entryData.findNodesByTags("geometric-segmentation-visual",`segment-${t}`,r);for(let o of n)await ht.Interactivity.Object.Highlight(this.entryData.plugin,{state:this.entryData.plugin.state.data,ref:o.transform.ref})}updateOpacity(t,r){let n=this.entryData.findNodesByTags("geometric-segmentation-visual",r),o=this.entryData.newUpdate();for(let i of n)o.to(i).update(qp,s=>{s.alpha=t});return o.commit()}async selectSegment(t,r){if(t===void 0||t<0||r===void 0)return;let o=this.entryData.findNodesByTags("geometric-segmentation-visual",`segment-${t}`,r)[0]?.obj;if(!o)return;let i=o.data.repr.getAllLoci()[0];i&&this.entryData.plugin.managers.interactivity.lociSelects.select({loci:i,repr:o.data.repr},!1)}};async function cx(e,t){let[r,n]=e,o=new File([n],r),i=Nr.File(o),a=(await t.managers.asset.resolve(i,"string").run()).data;return JSON.parse(a)}async function $2e(e,t,r,n){let o=e.currentState.value.visibleSegments.map(l=>l.segmentKey),i=o.filter(l=>Su(l).segmentationId===t&&Su(l).kind===r),s=o.filter(l=>i.indexOf(l)<0),a=n.map(l=>{if(l.target_kind!=="entry")return Lh(l.target_id.segment_id,l.target_id.segmentation_id,l.target_kind)}).filter(Boolean);if(i.length!==n.length){let l=[...a,...s];await AA(l,e)}else await AA(s,e)}async function AA(e,t){let r=t.metadata.value.raw.grid.segmentation_lattices.segmentation_ids,n=t.metadata.value.raw.grid.segmentation_meshes.segmentation_ids,o=t.metadata.value.raw.grid.geometric_segmentation.segmentation_ids;if(e.length===0){for(let s of r)await MF([],s,"lattice",t);for(let s of n)await MF([],s,"mesh",t);for(let s of o)await MF([],s,"primitive",t)}let i=e.map(s=>Su(s));SW(i,r,"lattice",t),SW(i,n,"mesh",t),SW(i,o,"primitive",t),await t.updateStateNode({visibleSegments:e.map(s=>({segmentKey:s}))})}async function SW(e,t,r,n){let o=e.filter(a=>a.kind===r),i=new Map;for(let a of o)if(!i.has(a.segmentationId))i.set(a.segmentationId,[a.segmentId]);else{let l=i.get(a.segmentationId);i.set(a.segmentationId,[...l,a.segmentId])}for(let a of t)i.has(a)||i.set(a,[]);let s=[];i.forEach((a,l)=>{s.push(MF(a,l,r,n))}),await Promise.all(s)}function kF(e,...t){return e.state.data.selectQ(r=>{let n=r.root.subtree();for(let o of t)n=n.withTag(o);return n})}function IW(e,t){return e.state.data.selectQ(r=>r.byRef(t).subtree())[0]}async function Fst(e,t,r){if(t===void 0||t<0||!r)return;let n=Ost([t],r,e);n&&e.plugin.managers.interactivity.lociSelects.select(n,!1)}function Ost(e,t,r){let n=kF(r.plugin,Yv,t)[0];if(!n)return;let o=n.obj?.data.repr,i=o.getAllLoci()[0];if(!(!i||!ot.Segment.isLoci(i)))return{loci:ot.Segment.Loci(i.volume,e),repr:o}}async function MF(e,t,r,n){if(r==="lattice"){let o=kF(n.plugin,Yv,t)[0];if(!o)return;let i=n.currentState.value.selectedSegment,s=Su(i),a=s.segmentId,l=s.segmentationId,c=e.includes(a)&&!o.params?.values.type.params.segments.includes(a),u=n.plugin.build().toRoot();u.to(o).update(Je.Representation.VolumeRepresentation3D,d=>{d.type.params.segments=e}),await u.commit(),c&&await Fst(n,a,l)}else if(r==="mesh"){let o=new Set(e),i=kF(n.plugin,"mesh-segment-visual",t);for(let s of i){let a=s.obj?.tags?.find(u=>u.startsWith("segment-"));if(!a)continue;let l=parseInt(a.split("-")[1]),c=o.has(l);vo(n.plugin.state.data,s.transform.ref,!c),o.delete(l)}}else if(r==="primitive"){let o=new Set(e),i=kF(n.plugin,"geometric-segmentation-visual",t);for(let s of i){let a=s.obj?.tags?.find(u=>u.startsWith("segment-"));if(!a)continue;let l=parseInt(a.split("-")[1]),c=o.has(l);vo(n.plugin.state.data,s.transform.ref,!c),o.delete(l)}}else throw new Error("Not supported")}async function iE(e,t){t!==void 0&&e.currentState.value.visibleSegments.find(r=>r.segmentKey===t)===void 0&&await AW(e,t),await e.updateStateNode({selectedSegment:t})}async function AW(e,t){let r=e.currentState.value.visibleSegments.map(n=>n.segmentKey);r.includes(t)?await AA(r.filter(n=>n!==t),e):await AA([...r,t],e)}var RF=new Gm({emdb:"EMDB",empiar:"EMPIAR",idr:"IDR",pdbe:"PDBe",custom:"CUSTOM"},"emdb");var BF=class{constructor(t,r){this.cvsxFilesIndex=t;this.plugin=r}volumeDataFromRaw(t){return t.map(n=>({channelId:this.cvsxFilesIndex.volumes[n[0]].channelId,timeframeIndex:this.cvsxFilesIndex.volumes[n[0]].timeframeIndex,data:n[1]}))}latticeSegmentationDataFromRaw(t){let r=this.cvsxFilesIndex.latticeSegmentations;return!t||!r?void 0:t.map(o=>({segmentationId:r[o[0]].segmentationId,timeframeIndex:r[o[0]].timeframeIndex,data:o[1]}))}meshSegmentationDataFromRaw(t){let r=[],n=this.cvsxFilesIndex.meshSegmentations;if(!(!t||!n)){for(let o of n){let i=t.filter(a=>o.segmentsFilenames.includes(a[0])),s={segmentationId:o.segmentationId,timeframeIndex:o.timeframeIndex,data:i};r.push(s)}return r}}async geometricSegmentationDataFromRaw(t){let r=[],n=this.cvsxFilesIndex.geometricSegmentations;if(!(!t||!n)){for(let o in n){let i=t.find(l=>l[0]===o);if(!i)throw Error("Geometric segmentation file not found");let s=await cx(i,this.plugin),a={segmentationId:n[o].segmentationId,timeframeIndex:n[o].timeframeIndex,data:s};r.push(a)}return r}}};var aE="geometric-segmentation-node",lE="mesh-segmentation-node",W2e=10**7,q2e=null,cE="volume-node-tag",uE="segmenation-node-tag";function Z2e(e,t={}){let r=e?.config.get(NF.DefaultServer)??ax;return{serverUrl:M.Text(r),source:M.Mapped(RF.values[0],RF.options,n=>Vst(t[n]))}}function Vst(e=[]){let t=e.map(r=>[r,r]);return t.push(["__custom__","Custom"]),M.Group({entryId:M.Select(t[0][0],t,{description:'Choose an entry from the list, or choose "Custom" and type any entry ID (useful when using other than default server).'}),customEntryId:M.Text("",{hideIf:r=>r.entryId!=="__custom__",description:'Entry identifier, including the source prefix, e.g. "emd-1832"'})},{isFlat:!0})}function K2e(e){let t=e?.config.get(NF.DefaultServer)??ax;return{serverUrl:M.Text(t),source:RF.PDSelect(),entryId:M.Text("emd-1832",{description:'Entry identifier, including the source prefix, e.g. "emd-1832"'})}}var wW;(t=>{function e(r){let n=r.source.params.entryId;return n==="__custom__"&&(n=r.source.params.customEntryId),{serverUrl:r.serverUrl,source:r.source.name,entryId:n}}t.fromLoadVolsegParamValues=e})(wW||={});var Yl=class extends fe.CreateBehavior({name:"Vol & Seg Entry"}){},LF=class{constructor(t,r){this.segmentId=t;this.data=r}},sE=class extends Xu{constructor(r,n,o){super();this.timeframeIndex=r;this.channelId=n;this.data=o}},u0=class extends Xu{constructor(r,n,o){super();this.timeframeIndex=r;this.segmentationId=n;this.data=o}},wA=class{constructor(t,r){this.entryData=t;this.kind=r;this.cache=new Map;this.maxEntries=0;this.totalSizeLimitInBytes=1e9}setCacheSizeInItems(t){if(!this.maxEntries){let r=this._getEntrySize(t);this._setCacheSizeInItems(r)}}_createKey(t,r){return`${t.toString()}_${r}`}_getEntrySize(t){let r=t.data,n=0;if(r instanceof Uint8Array)n=r.length;else if(r instanceof String)n=new TextEncoder().encode(r).length;else if(B2e(r))n=JSON.stringify(r).length;else{let o=r;for(let i of o){let s=this._getEntrySize(i);n=n+s}}return n}_setCacheSizeInItems(t){let r=this.totalSizeLimitInBytes/t;this.maxEntries=Math.round(r)}add(t){if(this.cache.size>=this.maxEntries){let i=this.cache.keys().next().value;this.cache.delete(i)}let r=t.timeframeIndex,n;if(t instanceof sE)n=this._createKey(r,t.channelId);else if(t instanceof u0)n=this._createKey(r,t.segmentationId);else throw Error(`data type ${t}is not supported`);if(this.cache.has(n))return null;this.cache.set(n,t),this.setCacheSizeInItems(t)}async get(t,r,n){let o=this._createKey(t,r);if(this.cache.has(o)){let s=this.cache.get(o);return this.cache.delete(o),this.cache.set(o,s),s}else{if(this.cache.size>=this.maxEntries){let a=this.cache.keys().next().value;this.cache.delete(a)}let s;if(n==="volume")s=await this.entryData._loadRawChannelData(t,r);else if(n==="segmentation")s=await this.entryData._loadRawLatticeSegmentationData(t,r);else if(n==="mesh")s=await this.entryData._loadRawMeshSegmentationData(t,r);else if(n==="primitive")s=await this.entryData._loadGeometricSegmentationData(t,r);else throw Error(`Data kind ${n} is not supported`);return this.cache.delete(o),this.cache.set(o,s),this.setCacheSizeInItems(s),s}}},ux=class e extends tr.WithSubscribers{constructor(r,n,o){super(r,n);this.ref="";this.pdbs=[];this.kind="api";this.filesData=void 0;this.metadata=new jo(void 0);this.cachedVolumeTimeframesData=new wA(this,"volume");this.cachedSegmentationTimeframesData=new wA(this,"segmentation");this.cachedMeshesTimeframesData=new wA(this,"mesh");this.cachedShapePrimitiveData=new wA(this,"primitive");this.state={hierarchy:new jo(void 0)};this.volumeData=new TF(this);this.geometricSegmentationData=new DF(this);this.latticeSegmentationData=new AF(this);this.meshSegmentationData=new SF(this);this.modelData=new IF(this);this.highlightRequest=new Vn;this.getStateNode=R2e(()=>this.plugin.state.data.selectQ(r=>r.byRef(this.ref).subtree().ofType(lx))[0],"Missing VolsegState node. Must first create VolsegState for this VolsegEntry.");this.currentState=new jo(M.getDefaultValues(_F));this.currentVolume=new jo([]);this.currentTimeframe=new jo(0);this.labelProvider={label:r=>{let n=this.getSegmentIdFromLoci(r),o=this.getSegmentationIdFromLoci(r),i=this.getSegmentationKindFromLoci(r);if(n===void 0||!o||!i)return;let s=this.metadata.value.getSegmentDescription(n,o,i);if(!s)return;let l=s[0].name,c=s[0].external_references?.map(d=>`${M2e(d.label?d.label:"")} [${d.resource}:${d.accession}]`);if(s[0].is_hidden===!0)return;let u="";if(l&&(u=u+'<hr class="msp-highlight-info-hr"/><b>'+l+"</b>"),c&&c.length>0&&(u=u+'<hr class="msp-highlight-info-hr"/>'+c.filter(bA).join("<br/>")),u!=="")return u}};this.plugin=r,this.api=new gA(n.serverUrl),this.source=n.source,this.entryId=n.entryId,this.entryNumber=nE(this.entryId).entryNumber,this.filesData=o}async initialize(){let r=await this.api.getMetadata(this.source,this.entryId);this.metadata.next(new xA(r)),this.pdbs=await V2e(this.metadata.value.raw.annotation?.entry_id.source_db_id??this.entryId),await this.init()}async initializeFromFile(r){r&&this.metadata.next(new xA(r)),await this.initFromFile()}static async create(r,n){let o=new e(r,n);return await o.initialize(),o}static getRawLatticeSegmentationsFromCSVX(r,n){let o;if(r.latticeSegmentations){let i=r.latticeSegmentations;o=n.filter(s=>i.hasOwnProperty(s[0]))}return o}static getRawGeometricSegmentationsFromCVSX(r,n){let o;if(r.geometricSegmentations){let i=r.geometricSegmentations;o=n.filter(s=>i.hasOwnProperty(s[0]))}return o}static getRawMeshSegmentationsFromCSVX(r,n){let o;if(r.meshSegmentations){let i=r.meshSegmentations;if(i){o=new Array;for(let s of i){let a=n.filter(l=>{if(s.segmentsFilenames.includes(l[0]))return l});o=o.concat(a)}}}return o}static async createFromFile(r,n,o){let i=await P0(o,n.buffer),s=Object.entries(i),a=s.find(E=>E[0]==="index.json");if(!a)throw new Error("No index.json found, CVSX has wrong content");let l=await cx(a,r),c=s.find(E=>E[0]===l.query),u=s.find(E=>E[0]===l.metadata),d=s.find(E=>E[0]===l.annotations),m=s.filter(E=>l.volumes.hasOwnProperty(E[0])),p=this.getRawLatticeSegmentationsFromCSVX(l,s),h=this.getRawMeshSegmentationsFromCSVX(l,s),f=this.getRawGeometricSegmentationsFromCVSX(l,s);if(!c||!u||!d)throw new Error("CVSX has wrong content, some obligatory components are missing");let C=await cx(c,r),g={serverUrl:"",source:C.source_db,entryId:C.entry_id},b=await cx(u,r),y=await cx(d,r),x=b.entry_id.source_db_name,A=b.entry_id.source_db_id;g={serverUrl:"",source:x,entryId:A};let v={grid:b,annotation:y},_=new BF(l,r),I={volumes:_.volumeDataFromRaw(m),latticeSegmentations:_.latticeSegmentationDataFromRaw(p),meshSegmentations:_.meshSegmentationDataFromRaw(h),geometricSegmentations:await _.geometricSegmentationDataFromRaw(f),annotations:y,metadata:b,query:C,index:l},T=new e(r,g,I);return await T.initializeFromFile(v),T}async getData(r,n,o){if(o==="volume")return(await this.cachedVolumeTimeframesData.get(r,n,"volume")).data;if(o==="segmentation")return(await this.cachedSegmentationTimeframesData.get(r,n,"segmentation")).data;if(o==="mesh")return(await this.cachedMeshesTimeframesData.get(r,n,"mesh")).data;if(o==="primitive")return(await this.cachedShapePrimitiveData.get(r,n,"primitive")).data}sync(){let r=this.findNodesByTags(cE),n=this.findNodesByTags(uE),o=this.findNodesByTags(aE),i=this.findNodesByTags(lE);this.state.hierarchy.next({volumes:r,segmentations:n,geometricSegmentations:o,meshSegmentations:i})}async init(){this.sync(),this.subscribeObservable(this.plugin.state.data.events.changed,s=>{this.sync()}),this.metadata.value.raw.grid.volumes.volume_sampling_info.spatial_downsampling_levels.length>0&&await this.preloadVolumeTimeframesData(),this.metadata.value.raw.grid.segmentation_lattices&&await this.preloadSegmentationTimeframesData(),this.metadata.value.raw.grid.segmentation_meshes&&await this.preloadMeshesTimeframesData(),this.metadata.value.raw.grid.geometric_segmentation&&await this.preloadMeshesTimeframesData()}async initFromFile(){this.kind="file",this.sync(),this.subscribeObservable(this.plugin.state.data.events.changed,s=>{this.sync()}),this.metadata.value.raw.grid.volumes.volume_sampling_info.spatial_downsampling_levels.length>0&&this.preloadVolumeTimeframesDataFromFile(),this.metadata.value.raw.grid.segmentation_lattices&&this.preloadSegmentationTimeframesDataFromFile(),this.metadata.value.raw.grid.geometric_segmentation&&this.preloadShapePrimitivesTimeframesDataFromFile(),this.metadata.value.raw.grid.segmentation_meshes&&this.preloadMeshTimeframesDataFromFile()}async updateMetadata(){let r=await this.api.getMetadata(this.source,this.entryId);this.metadata.next(new xA(r))}async register(r){this.ref=r,this.plugin.managers.lociLabels.addProvider(this.labelProvider);try{let i=this.getStateNode().obj?.data;i&&this.currentState.next(i)}catch{}let n=this.findNodesByTags(oE)[0];n&&this.addCurrentVolume(n.transform);let o=new Set;this.subscribeObservable(this.plugin.state.data.events.cell.stateUpdated,i=>{try{this.getStateNode()}catch{return}if(i.cell.transform.ref===this.getStateNode().transform.ref){let s=this.getStateNode().obj?.data;s&&!Au(s,this.currentState.value)&&this.currentState.next(s)}else i.cell.transform.tags?.includes(oE)&&(o.has(i.ref)?this.addCurrentVolume(i.cell.transform):Kt.findAncestor(this.plugin.state.data.tree,this.plugin.state.data.cells,i.ref,s=>s.transform.ref===r)&&(o.add(i.ref),this.addCurrentVolume(i.cell.transform)))}),this.subscribeObservable(this.plugin.state.data.events.cell.removed,i=>{o.has(i.ref)&&(o.delete(i.ref),this.removeCurrentVolume(i.ref))}),this.subscribeObservable(this.plugin.behaviors.interaction.click,async i=>{if(i.current.loci.kind==="empty-loci")return;let s=i.current.loci,a=this.getSegmentIdFromLoci(s),l=this.getSegmentationIdFromLoci(s),c=this.getSegmentationKindFromLoci(s);if(l===void 0||a===void 0||c===void 0)return;let u=Lh(a,l,c);u===this.currentState.value.selectedSegment?iE(this,void 0):iE(this,u)}),this.subscribeObservable(this.highlightRequest.pipe(fl(50,void 0,{leading:!0,trailing:!0})),async i=>await this.highlightSegment(i)),this.subscribeObservable(this.currentState.pipe(rg((i,s)=>i.selectedSegment===s.selectedSegment)),async i=>{xp.getGlobalState(this.plugin)?.selectionMode&&await this.selectSegment(i.selectedSegment)})}async unregister(){this.plugin.managers.lociLabels.removeProvider(this.labelProvider)}async removeSegmentAnnotation(r,n,o){let i=this.metadata.value.getSegmentAnnotation(r,n,o);this.api.removeSegmentAnnotationsUrl(this.source,this.entryId,[i.id]),this.metadata.value.removeSegmentAnnotation(i.id)}async removeDescription(r){this.api.removeDescriptionsUrl(this.source,this.entryId,[r]),this.metadata.value.removeDescription(r)}async editDescriptions(r){await this.api.editDescriptionsUrl(this.source,this.entryId,r)}async editSegmentAnnotations(r){await this.api.editSegmentAnnotationsUrl(this.source,this.entryId,r)}async _resolveBinaryUrl(r){let n=Nr.getUrlAsset(this.plugin.managers.asset,r);return(await this.plugin.managers.asset.resolve(n,"binary").run()).data}async _resolveStringUrl(r){let n=Nr.getUrlAsset(this.plugin.managers.asset,r);return(await this.plugin.managers.asset.resolve(n,"string").run()).data}async _loadRawMeshSegmentationData(r,n){let o=[],i=this.metadata.value.getMeshSegmentIdsForSegmentationIdAndTimeframe(n,r);for(let s of i){let a=this.metadata.value.getSufficientMeshDetail(n,r,s,xW),l=this.api.meshUrl_Bcif(this.source,this.entryId,n,r,s,a),c=await this._resolveBinaryUrl(l);o.push(new LF(s,c))}return new u0(r,n,o)}async _loadGeometricSegmentationData(r,n){let o=this.api.geometricSegmentationUrl(this.source,this.entryId,n,r),i=await this._resolveStringUrl(o),s=JSON.parse(i);return new u0(r,n,s)}async _loadRawChannelData(r,n){let o=this.api.volumeUrl(this.source,this.entryId,r,n,q2e,W2e),i=await this._resolveBinaryUrl(o);return new sE(r,n,i)}async _loadRawLatticeSegmentationData(r,n){let o=this.api.latticeUrl(this.source,this.entryId,n,r,q2e,W2e),i=await this._resolveBinaryUrl(o);return new u0(r,n,i)}async loadRawChannelsData(r,n){let o=r.start,i=r.end;for(let s=o;s<=i;s++)for(let a of n){let l=await this._loadRawChannelData(s,a);this.cachedVolumeTimeframesData.add(l)}}async loadRawLatticeSegmentationData(r,n){for(let o of n){let i=r[o],s=i.start,a=i.end;for(let l=s;l<=a;l++){let c=await this._loadRawLatticeSegmentationData(l,o);this.cachedSegmentationTimeframesData.add(c)}}}async loadRawMeshSegmentationData(r,n){for(let o of n){let i=r[o],s=i.start,a=i.end;for(let l=s;l<=a;l++){let c=await this._loadRawMeshSegmentationData(l,o);this.cachedMeshesTimeframesData.add(c)}}}async loadRawShapePrimitiveData(r,n){for(let o of n){let i=r[o],s=i.start,a=i.end;for(let l=s;l<=a;l++){let c=await this._loadGeometricSegmentationData(l,o);this.cachedShapePrimitiveData.add(c)}}}async preloadVolumeTimeframesData(){let r=this.metadata.value.raw.grid.volumes.time_info,n=this.metadata.value.raw.grid.volumes.channel_ids;this.loadRawChannelsData(r,n)}preloadSegmentationTimeframesDataFromFile(){if(this.filesData.latticeSegmentations)for(let r of this.filesData.latticeSegmentations){let n=new u0(r.timeframeIndex,r.segmentationId,r.data);this.cachedSegmentationTimeframesData.add(n)}}preloadShapePrimitivesTimeframesDataFromFile(){if(this.filesData.geometricSegmentations)for(let r of this.filesData.geometricSegmentations){let n=new u0(r.timeframeIndex,r.segmentationId,r.data);this.cachedShapePrimitiveData.add(n)}}preloadMeshTimeframesDataFromFile(){if(this.filesData.meshSegmentations)for(let r of this.filesData.meshSegmentations){let n=[],o=r.data;for(let[s,a]of o){let l=parseInt(s.split("_")[1]);n.push(new LF(l,a))}let i=new u0(r.timeframeIndex,r.segmentationId,n);this.cachedMeshesTimeframesData.add(i)}}preloadVolumeTimeframesDataFromFile(){for(let r of this.filesData.volumes){let n=new sE(r.timeframeIndex,r.channelId,r.data);this.cachedVolumeTimeframesData.add(n)}}async preloadSegmentationTimeframesData(){if(this.metadata.value.raw.grid.segmentation_lattices){let r=this.metadata.value.raw.grid.segmentation_lattices.segmentation_ids,n=this.metadata.value.raw.grid.segmentation_lattices.time_info;this.loadRawLatticeSegmentationData(n,r)}}async preloadMeshesTimeframesData(){if(this.metadata.value.raw.grid.segmentation_meshes){let r=this.metadata.value.raw.grid.segmentation_meshes.segmentation_ids,n=this.metadata.value.raw.grid.segmentation_meshes.time_info;this.loadRawMeshSegmentationData(n,r)}}async preloadShapePrimitivesTimeframesData(){if(this.metadata.value.raw.grid.geometric_segmentation){let r=this.metadata.value.raw.grid.geometric_segmentation.segmentation_ids,n=this.metadata.value.raw.grid.geometric_segmentation.time_info;this.loadRawShapePrimitiveData(n,r)}}async updateProjectData(r){this.changeCurrentTimeframe(r);let n=this.state.hierarchy.value.volumes,o=this.state.hierarchy.value.segmentations,i=this.state.hierarchy.value.geometricSegmentations,s=this.state.hierarchy.value.meshSegmentations;for(let a of n){let l=a.transform.ref,u={channelId:a.transform.params.channelId,timeframeIndex:r};await this.plugin.state.updateTransform(this.plugin.state.data,l,u,"Project Data Transform")}for(let a of o){let l=a.transform.ref,c=a.transform.params,u=this.metadata.value.getDescriptions(c.segmentationId,"lattice",this.currentTimeframe.value),d=CA(u),m={...c,segmentLabels:d,timeframeIndex:r};await this.plugin.state.updateTransform(this.plugin.state.data,l,m,"Project Data Transform")}for(let a of i){let l=a.transform.ref,u={...a.transform.params,timeframeIndex:r};await this.plugin.state.updateTransform(this.plugin.state.data,l,u,"Project Data Transform")}for(let a of s){let l=a.transform.ref,u={...a.transform.params,timeframeIndex:r};await this.plugin.state.updateTransform(this.plugin.state.data,l,u,"Project Data Transform")}}changeCurrentTimeframe(r){this.currentTimeframe.next(r)}addCurrentVolume(r){let n=this.currentVolume.value,o=[],i=!1;for(let s of n)s.ref===r.ref?(o.push(r),i=!0):o.push(s);i||o.push(r),this.currentVolume.next(o)}removeCurrentVolume(r){let n=this.currentVolume.value,o=[];for(let i of n)i.ref!==r&&o.push(i);this.currentVolume.next(o)}actionHighlightSegment(r){this.highlightRequest.next(r)}async actionSetOpacity(r,n,o){o==="lattice"?this.latticeSegmentationData.updateOpacity(r,n):o==="mesh"?this.meshSegmentationData.updateOpacity(r,n):o==="primitive"&&this.geometricSegmentationData.updateOpacity(r,n)}async actionShowFittedModel(r){await this.modelData.showPdbs(r),await this.updateStateNode({visibleModels:r.map(n=>({pdbId:n}))})}async actionSetVolumeVisual(r,n,o){await this.volumeData.setVolumeVisual(r,n,o);let i=this.currentState.value.channelsData,s=i.filter(a=>a.channelId===n)[0];s.volumeType=r,await this.updateStateNode({channelsData:[...i]})}async actionUpdateVolumeVisual(r,n,o){await this.volumeData.updateVolumeVisual(r,n,o);let i=this.currentState.value.channelsData,s=i.filter(a=>a.channelId===n)[0];s.volumeType=r.volumeType,s.volumeOpacity=r.opacity,await this.updateStateNode({channelsData:[...i]})}async highlightSegment(r){if(await ht.Interactivity.ClearHighlights(this.plugin),r){let n=Su(r),{segmentId:o,segmentationId:i,kind:s}=n;s==="lattice"?await this.latticeSegmentationData.highlightSegment(o,i):s==="mesh"?await this.meshSegmentationData.highlightSegment(o,i):s==="primitive"&&await this.geometricSegmentationData.highlightSegment(o,i)}}async selectSegment(r){this.plugin.managers.interactivity.lociSelects.deselectAll();let n=Su(r);n.kind==="lattice"?await this.latticeSegmentationData.selectSegment(n.segmentId,n.segmentationId):n.kind==="mesh"?await this.meshSegmentationData.selectSegment(n.segmentId,n.segmentationId):n.kind==="primitive"&&await this.geometricSegmentationData.selectSegment(n.segmentId,n.segmentationId),await this.highlightSegment()}async updateStateNode(r){let o={...this.getStateNode().transform.params,...r},i=this.plugin.state.data,s=i.build().to(this.getStateNode().transform.ref).update(o);await ht.State.Update(this.plugin,{state:i,tree:s,options:{doNotUpdateCurrent:!0}})}findNodesByRef(r){return this.plugin.state.data.selectQ(n=>n.byRef(r).subtree())[0]}findNodesByTags(...r){return this.plugin.state.data.selectQ(n=>{let o=n.byRef(this.ref).subtree();for(let i of r)o=o.withTag(i);return o})}newUpdate(){return this.ref!==""?this.plugin.build().to(this.ref):this.plugin.build().toRoot()}getSegmentationIdFromLoci(r){if(ot.Segment.isLoci(r))return r.volume.label;if(Fi.isLoci(r)){let n=r.shape.sourceData;if(CF(n))return(r.shape.sourceData??{}).segmentationId;if(PF(n))return(r.shape.sourceData??{}).segmentationId}}getSegmentationKindFromLoci(r){if(ot.Segment.isLoci(r))return"lattice";if(Fi.isLoci(r)){let n=r.shape.sourceData;if(CF(n))return"mesh";if(PF(n))return"primitive"}}getSegmentIdFromLoci(r){if(ot.Segment.isLoci(r)&&r.volume._propertyData.ownerId===this.ref&&r.segments.length===1)return r.segments[0];if(Fi.isLoci(r)){let n=r.shape.sourceData;if(CF(n)){let o=r.shape.sourceData??{};if(o.ownerId===this.ref&&o.segmentId!==void 0)return o.segmentId}else if(PF(n))return(r.shape.sourceData??{}).segmentId}}async setTryUseGpu(r){await Promise.all([this.volumeData.setTryUseGpu(r),this.latticeSegmentationData.setTryUseGpu(r)])}async setSelectionMode(r){r?await this.selectSegment(this.currentState.value.selectedSegment):this.plugin.managers.interactivity.lociSelects.deselectAll()}};var Gst={timeframeIndex:M.Numeric(0,{step:1}),channelId:M.Text("0")},Ust={timeframeIndex:M.Numeric(0,{step:1}),segmentationId:M.Text("0"),segmentLabels:M.ObjectList({id:M.Numeric(-1),label:M.Text("")},e=>`${e.id} = ${e.label}`,{description:"Mapping of segment IDs to segment labels"}),ownerId:M.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})},zst={timeframeIndex:M.Numeric(0,{step:1}),segmentationId:M.Text("0"),...E2e},FF=If({name:"project-volume-data",display:{name:"Project Volume Data",description:"Project Volume Data"},from:fe.Root,to:fe.Volume.Data,params:Gst})({apply({a:e,params:t,spine:r},n){return ke.create("Project Volume Data",async o=>{let{timeframeIndex:i,channelId:s}=t,l=r.getAncestorOfType(Yl).data,c=await l.getData(i,s,"volume"),u=l.metadata.value.getVolumeChannelLabel(s);u||(u=s.toString());let d=await Di.parse(c).runInContext(o);if(d.isError)throw new Error(d.message);let m=new fe.Format.Cif(d.result),p=m.data.blocks[1].header,h=m.data.blocks.find(I=>I.header===p);if(!h)throw new Error(`Data block '${[p]}' not found.`);let f=Di.schema.densityServer(h),C=await Uf(f).runInContext(o),[g,b,y]=C.grid.cells.space.dimensions,x={label:`Volume channel: ${u}`,description:`Volume ${g}\xD7${b}\xD7${y}`},_=C.sourceData.data.volume_data_3d_info.sample_rate.__array[0];return l.metadata.value.setCurrentlyUsedVolumeDownsampling(_),new fe.Volume.Data(C,x)})}}),OF=If({name:"project-segmentation-data",display:{name:"Project Segmentation Data",description:"Project Segmentation Data"},from:fe.Root,to:fe.Volume.Data,params:Ust})({apply({a:e,params:t,spine:r},n){return ke.create("Project Volume Data",async o=>{let{timeframeIndex:i,segmentationId:s}=t,c=await r.getAncestorOfType(Yl).data.getData(i,s,"segmentation"),u=s,d=await Di.parse(c).runInContext(o);if(d.isError)throw new Error(d.message);let m=new fe.Format.Cif(d.result),p=m.data.blocks[1].header,h=m.data.blocks.find(v=>v.header===p);if(!h)throw new Error(`Data block '${[p]}' not found.`);let f=Di.schema.segmentation(h),C={};for(let v of t.segmentLabels)C[v.id]="";let g=await ND(f,{label:u,segmentLabels:C,ownerId:t.ownerId}).runInContext(o),[b,y,x]=g.grid.cells.space.dimensions,A={label:`ID: ${u}`,description:`${u} ${b}\xD7${y}\xD7${x}`};return new fe.Volume.Data(g,A)})}}),VF=If({name:"project-mesh-data",display:{name:"Project Mesh Data",description:"Project Mesh Data"},from:Yl,to:yA,params:zst})({apply({a:e,params:t,spine:r},n){return ke.create("Project Mesh Data",async o=>{let{timeframeIndex:i,segmentationId:s}=t,l=r.getAncestorOfType(Yl).data,c=[],u=t.meshSegmentParams,d=await l.getData(i,s,"mesh");for(let m of u){let p=d.find(b=>b.segmentId===m.id);if(!p)throw new Error("no segment");let h=p.data,f=await Di.parse(h).runInContext(o);if(f.isError)throw new Error(f.message);let C=f.result,g={meshSegmentParams:m,parsedCif:C};c.push(g)}return new yA(new xF(c),{label:`Segmentation ID: ${s}`})})}}),Hst={timeframeIndex:M.Numeric(0,{step:1}),segmentationId:M.Text("0")},GF=If({name:"project-geometric-segmentation",display:{name:"Project Geometric Segmentation",description:"Project Geometric Segmentation"},from:Yl,to:IA,params:Hst})({apply({a:e,params:t,spine:r},n){return ke.create("Project Geometric Segmentation Data",async o=>{let{timeframeIndex:i,segmentationId:s}=t,c=await r.getAncestorOfType(Yl).data.getData(i,s,"primitive");return new IA(new EF(c),{label:`Segmentation ID: ${s}`})})}}),X2e=If({name:"volseg-entry-from-root",display:{name:"Vol & Seg Entry",description:"Vol & Seg Entry"},from:fe.Root,to:Yl,params:(e,t)=>K2e(t)})({apply({a:e,params:t},r){return ke.create("Load Vol & Seg Entry",async()=>{let n=await ux.create(r,t);return new Yl(n,{label:n.entryId,description:"Vol & Seg Entry"})})},update({b:e,oldParams:t,newParams:r}){return Object.assign(r,t),st.UpdateResult.Unchanged}}),Y2e=If({name:"volseg-entry-from-file",display:{name:"Vol & Seg Entry",description:"Vol & Seg Entry"},from:fe.Data.Binary,to:Yl})({apply({a:e,params:t},r){return ke.create("Load Vol & Seg Entry",async n=>{let o=await ux.createFromFile(r,e.data,n);return new Yl(o,{label:o.entryId,description:"Vol & Seg Entry"})})},update({b:e,oldParams:t,newParams:r}){return Object.assign(r,t),st.UpdateResult.Unchanged}}),UF=If({name:F2e,display:{name:"Vol & Seg Entry State",description:"Vol & Seg Entry State"},from:Yl,to:lx,params:_F})({apply({a:e,params:t},r){return ke.create("Create Vol & Seg Entry State",async()=>new lx(t,{label:"State"}))}}),Q2e=If({name:"volseg-global-state-from-file",display:{name:"Vol & Seg Global State",description:"Vol & Seg Global State"},from:fe.Data.Binary,to:bp,params:SA})({apply({a:e,params:t},r){return ke.create("Create Vol & Seg Global State",async()=>{let n=new xp(r,t);return new bp(n,{label:"Global State",description:"Vol & Seg Global State"})})},update({b:e,oldParams:t,newParams:r}){return e.data.currentState.next(r),st.UpdateResult.Updated}}),J2e=If({name:"volseg-global-state-from-root",display:{name:"Vol & Seg Global State",description:"Vol & Seg Global State"},from:fe.Root,to:bp,params:SA})({apply({a:e,params:t},r){return ke.create("Create Vol & Seg Global State",async()=>{let n=new xp(r,t);return new bp(n,{label:"Global State",description:"Vol & Seg Global State"})})},update({b:e,oldParams:t,newParams:r}){return e.data.currentState.next(r),st.UpdateResult.Updated}});var Jo=ar(hi()),ewe=ar(hW());function mE(){return mE=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mE.apply(this,arguments)}var jst=function(t,r){r===void 0&&(r=!0),(0,Jo.useEffect)(function(){if(r){var n=function(i){i.key==="Escape"&&t(i)};return document.addEventListener("keyup",n),function(){r&&document.removeEventListener("keyup",n)}}},[t,r])},$st=function(t,r){r===void 0&&(r=!0),(0,Jo.useEffect)(function(){if(r){var n=function(){t()};return window.addEventListener("resize",n),function(){r&&window.removeEventListener("resize",n)}}},[t,r])},Wst=function(t,r,n){n===void 0&&(n=!0),(0,Jo.useEffect)(function(){if(n){var o=function(s){var a=Array.isArray(t)?t:[t],l=!1;a.forEach(function(c){if(!c.current||c.current.contains(s.target)){l=!0;return}}),s.stopPropagation(),l||r(s)};return document.addEventListener("mousedown",o),document.addEventListener("touchstart",o),function(){n&&(document.removeEventListener("mousedown",o),document.removeEventListener("touchstart",o))}}},[t,r,n])},qst=function(t,r){r===void 0&&(r=!0),(0,Jo.useEffect)(function(){if(r){var n=function(i){if(i.keyCode===9){var s,a=t==null||(s=t.current)===null||s===void 0?void 0:s.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]'),l=Array.prototype.slice.call(a);if(l.length===1){i.preventDefault();return}var c=l[0],u=l[l.length-1];i.shiftKey&&document.activeElement===c?(i.preventDefault(),u.focus()):document.activeElement===u&&(i.preventDefault(),c.focus())}};return document.addEventListener("keydown",n),function(){r&&document.removeEventListener("keydown",n)}}},[t,r])},Zst=typeof window<"u"?Jo.useLayoutEffect:Jo.useEffect,dE={popupContent:{tooltip:{position:"absolute",zIndex:999},modal:{position:"relative",margin:"auto"}},popupArrow:{height:"8px",width:"16px",position:"absolute",background:"transparent",color:"#FFF",zIndex:-1},overlay:{tooltip:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",zIndex:999},modal:{position:"fixed",top:"0",bottom:"0",left:"0",right:"0",display:"flex",zIndex:999}}},Kst=["top left","top center","top right","right top","right center","right bottom","bottom left","bottom center","bottom right","left top","left center","left bottom"],Xst=function(t,r,n,o,i){var s=i.offsetX,a=i.offsetY,l=o?8:0,c=n.split(" "),u=t.top+t.height/2,d=t.left+t.width/2,m=r.height,p=r.width,h=u-m/2,f=d-p/2,C="",g="0%",b="0%";switch(c[0]){case"top":h-=m/2+t.height/2+l,C="rotate(180deg)  translateX(50%)",g="100%",b="50%";break;case"bottom":h+=m/2+t.height/2+l,C="rotate(0deg) translateY(-100%) translateX(-50%)",b="50%";break;case"left":f-=p/2+t.width/2+l,C=" rotate(90deg)  translateY(50%) translateX(-25%)",b="100%",g="50%";break;case"right":f+=p/2+t.width/2+l,C="rotate(-90deg)  translateY(-150%) translateX(25%)",g="50%";break}switch(c[1]){case"top":h=t.top,g=t.height/2+"px";break;case"bottom":h=t.top-m+t.height,g=m-t.height/2+"px";break;case"left":f=t.left,b=t.width/2+"px";break;case"right":f=t.left-p+t.width,b=p-t.width/2+"px";break}return h=c[0]==="top"?h-a:h+a,f=c[0]==="left"?f-s:f+s,{top:h,left:f,transform:C,arrowLeft:b,arrowTop:g}},Yst=function(t){var r={top:0,left:0,width:window.innerWidth,height:window.innerHeight};if(typeof t=="string"){var n=document.querySelector(t);n!==null&&(r=n.getBoundingClientRect())}return r},Qst=function(t,r,n,o,i,s){var a=i.offsetX,l=i.offsetY,c={arrowLeft:"0%",arrowTop:"0%",left:0,top:0,transform:"rotate(135deg)"},u=0,d=Yst(s),m=Array.isArray(n)?n:[n];for((s||Array.isArray(n))&&(m=[].concat(m,Kst));u<m.length;){c=Xst(t,r,m[u],o,{offsetX:a,offsetY:l});var p={top:c.top,left:c.left,width:r.width,height:r.height};if(p.top<=d.top||p.left<=d.left||p.top+p.height>=d.top+d.height||p.left+p.width>=d.left+d.width)u++;else break}return c},Jst=0,eat=function(){var t=document.getElementById("popup-root");return t===null&&(t=document.createElement("div"),t.setAttribute("id","popup-root"),document.body.appendChild(t)),t},tat=(0,Jo.forwardRef)(function(e,t){var r=e.trigger,n=r===void 0?null:r,o=e.onOpen,i=o===void 0?function(){}:o,s=e.onClose,a=s===void 0?function(){}:s,l=e.defaultOpen,c=l===void 0?!1:l,u=e.open,d=u===void 0?void 0:u,m=e.disabled,p=m===void 0?!1:m,h=e.nested,f=h===void 0?!1:h,C=e.closeOnDocumentClick,g=C===void 0?!0:C,b=e.repositionOnResize,y=b===void 0?!0:b,x=e.closeOnEscape,A=x===void 0?!0:x,v=e.on,_=v===void 0?["click"]:v,I=e.contentStyle,T=I===void 0?{}:I,E=e.arrowStyle,w=E===void 0?{}:E,S=e.overlayStyle,P=S===void 0?{}:S,k=e.className,L=k===void 0?"":k,R=e.position,N=R===void 0?"bottom center":R,F=e.modal,H=F===void 0?!1:F,V=e.lockScroll,q=V===void 0?!1:V,Q=e.arrow,O=Q===void 0?!0:Q,B=e.offsetX,j=B===void 0?0:B,U=e.offsetY,z=U===void 0?0:U,$=e.mouseEnterDelay,Z=$===void 0?100:$,J=e.mouseLeaveDelay,ie=J===void 0?100:J,ne=e.keepTooltipInside,le=ne===void 0?!1:ne,ee=e.children,oe=(0,Jo.useState)(d||c),te=oe[0],X=oe[1],W=(0,Jo.useRef)(null),K=(0,Jo.useRef)(null),re=(0,Jo.useRef)(null),se=(0,Jo.useRef)(null),me=(0,Jo.useRef)("popup-"+ ++Jst),Y=H?!0:!n,ae=(0,Jo.useRef)(0);Zst(function(){return te?(se.current=document.activeElement,rt(),Ke(),we()):_e(),function(){clearTimeout(ae.current)}},[te]),(0,Jo.useEffect)(function(){typeof d=="boolean"&&(d?ve():ge())},[d,p]);var ve=function($e){te||p||(X(!0),setTimeout(function(){return i($e)},0))},ge=function($e){var be;!te||p||(X(!1),Y&&((be=se.current)===null||be===void 0||be.focus()),setTimeout(function(){return a($e)},0))},Se=function($e){$e?.stopPropagation(),te?ge($e):ve($e)},Ee=function($e){clearTimeout(ae.current),ae.current=setTimeout(function(){return ve($e)},Z)},Fe=function($e){$e?.preventDefault(),Se()},Ae=function($e){clearTimeout(ae.current),ae.current=setTimeout(function(){return ge($e)},ie)},we=function(){Y&&q&&(document.getElementsByTagName("body")[0].style.overflow="hidden")},_e=function(){Y&&q&&(document.getElementsByTagName("body")[0].style.overflow="auto")},Ke=function(){var $e,be=K==null||($e=K.current)===null||$e===void 0?void 0:$e.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]'),Te=Array.prototype.slice.call(be)[0];Te?.focus()};(0,Jo.useImperativeHandle)(t,function(){return{open:function(){ve()},close:function(){ge()},toggle:function(){Se()}}});var rt=function(){if(!(Y||!te)&&!(!W?.current||!W?.current||!K?.current)){var $e=W.current.getBoundingClientRect(),be=K.current.getBoundingClientRect(),Te=Qst($e,be,N,O,{offsetX:j,offsetY:z},le);if(K.current.style.top=Te.top+window.scrollY+"px",K.current.style.left=Te.left+window.scrollX+"px",O&&re.current){var De,pe;re.current.style.transform=Te.transform,re.current.style.setProperty("-ms-transform",Te.transform),re.current.style.setProperty("-webkit-transform",Te.transform),re.current.style.top=((De=w.top)===null||De===void 0?void 0:De.toString())||Te.arrowTop,re.current.style.left=((pe=w.left)===null||pe===void 0?void 0:pe.toString())||Te.arrowLeft}}};jst(ge,A),qst(K,te&&Y),$st(rt,y),Wst(n?[K,W]:[K],ge,g&&!f);var pt=function(){for(var $e={key:"T",ref:W,"aria-describedby":me.current},be=Array.isArray(_)?_:[_],Te=0,De=be.length;Te<De;Te++)switch(be[Te]){case"click":$e.onClick=Se;break;case"right-click":$e.onContextMenu=Fe;break;case"hover":$e.onMouseEnter=Ee,$e.onMouseLeave=Ae;break;case"focus":$e.onFocus=Ee,$e.onBlur=Ae;break}if(typeof n=="function"){var pe=n(te);return!!n&&Jo.default.cloneElement(pe,$e)}return!!n&&Jo.default.cloneElement(n,$e)},Ne=function(){var $e=Y?dE.popupContent.modal:dE.popupContent.tooltip,be={className:"popup-content "+(L!==""?L.split(" ").map(function(Te){return Te+"-content"}).join(" "):""),style:mE({},$e,T,{pointerEvents:"auto"}),ref:K,onClick:function(De){De.stopPropagation()}};return!H&&_.indexOf("hover")>=0&&(be.onMouseEnter=Ee,be.onMouseLeave=Ae),be},je=function(){return Jo.default.createElement("div",Object.assign({},Ne(),{key:"C",role:Y?"dialog":"tooltip",id:me.current}),O&&!Y&&Jo.default.createElement("div",{ref:re,style:dE.popupArrow},Jo.default.createElement("svg",{"data-testid":"arrow",className:"popup-arrow "+(L!==""?L.split(" ").map(function($e){return $e+"-arrow"}).join(" "):""),viewBox:"0 0 32 16",style:mE({position:"absolute"},w)},Jo.default.createElement("path",{d:"M16 0l16 16H0z",fill:"currentcolor"}))),ee&&typeof ee=="function"?ee(ge,te):ee)},Ye=!(_.indexOf("hover")>=0),mt=Y?dE.overlay.modal:dE.overlay.tooltip,vt=[Ye&&Jo.default.createElement("div",{key:"O","data-testid":"overlay","data-popup":Y?"modal":"tooltip",className:"popup-overlay "+(L!==""?L.split(" ").map(function(yt){return yt+"-overlay"}).join(" "):""),style:mE({},mt,P,{pointerEvents:g&&f||Y?"auto":"none"}),onClick:g&&f?ge:void 0,tabIndex:-1},Y&&je()),!Y&&je()];return Jo.default.createElement(Jo.default.Fragment,null,pt(),te&&ewe.default.createPortal(vt,eat()))}),twe=tat;var Nh=ar(hi(),1);var _W=ar(hi(),1),gn=ar(un(),1);function rwe({descriptionText:e}){if(e.format==="markdown")return(0,gn.jsxs)(gn.Fragment,{children:[(0,gn.jsx)("br",{}),(0,gn.jsx)("br",{}),(0,gn.jsx)("b",{children:"Description: "}),(0,gn.jsx)(jS,{skipHtml:!0,children:e.text})]});if(e.format==="text")return(0,gn.jsxs)(gn.Fragment,{children:[(0,gn.jsx)("br",{}),(0,gn.jsx)("br",{}),(0,gn.jsx)("b",{children:"Description: "}),(0,gn.jsx)("p",{children:e.text})]})}function nwe({externalReferences:e}){return(0,gn.jsx)(gn.Fragment,{children:e.map(t=>(0,gn.jsxs)("p",{style:{marginTop:4},children:[t.url?(0,gn.jsxs)("a",{href:t.url,children:[t.resource,":",t.accession]}):(0,gn.jsxs)("small",{children:[t.resource,":",t.accession]}),(0,gn.jsx)("br",{}),(0,gn.jsx)("b",{children:nm(t.label?t.label:"")}),(0,gn.jsx)("br",{}),t.description]},t.id))})}function owe({entryDescriptionData:e}){return(0,gn.jsx)(lo,{header:"Entry description data",children:(0,gn.jsxs)("div",{children:[e.name??"",e.details&&(0,gn.jsx)(rwe,{descriptionText:e.details}),e.external_references&&(0,gn.jsx)(nwe,{externalReferences:e.external_references})]},e.id)})}var rat=({setFilteredDescriptions:e,descriptions:t,model:r})=>{let[n,o]=(0,_W.useState)("");function i(s){return r.metadata.value.filterDescriptions(t,s)}return(0,gn.jsx)(mc,{style:{order:1,flex:"1 1 auto",minWidth:0,marginBlock:1},className:"msp-form-control",value:n,placeholder:"Type keyword to filter segments...",onChange:s=>{o(s);let a=i(s);e(a)}})};function nat({model:e,d:t,currentTimeframe:r,selectedSegmentDescription:n,visibleSegmentKeys:o}){let i=Po(e.metadata);if(t.target_kind==="entry"||!t.target_id||t.is_hidden===!0||t.time&&Number.isFinite(t.time)&&t.time!==r||t.time&&Array.isArray(t.time)&&t.time.every(l=>Number.isFinite(l))&&!t.time.includes(r))return;let s=Lh(t.target_id.segment_id,t.target_id.segmentation_id,t.target_kind);if(t=i.raw.annotation.descriptions[t.id],!(t.target_kind==="entry"||!t.target_id||t.is_hidden===!0))return(0,gn.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,gn.jsx)(or,{noOverflow:!0,flex:!0,onClick:()=>iE(e,t!==n?s:void 0),style:{fontWeight:t.target_id.segment_id===n?.target_id?.segment_id&&t.target_id.segmentation_id===n?.target_id.segmentation_id?"bold":void 0,textAlign:"left"},children:(0,gn.jsxs)("div",{title:t.name??"Unnamed segment",style:{maxWidth:240,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.name??"Unnamed segment"," (",t.target_id?.segment_id,") (",t.target_id?.segmentation_id,")"]})}),(0,gn.jsx)(Jt,{svg:o.includes(s)?dc:uc,title:o.includes(s)?"Hide segment":"Show segment",onClick:()=>AW(e,s)})]},`${t.target_id?.segment_id}:${t.target_id?.segmentation_id}:${t.target_kind}`)}function iwe({model:e,targetSegmentationId:t,targetKind:r}){let n=Po(e.currentState),o=Po(e.currentTimeframe),s=Po(e.metadata).getDescriptions(t,r,o),[a,l]=(0,_W.useState)(s),c=Su(n.selectedSegment),{segmentId:u,segmentationId:d,kind:m}=c,p=e.metadata.value.getSegmentDescription(u,d,m),h=p?p[0]:void 0,f=n.visibleSegments.map(C=>C.segmentKey);return(0,gn.jsxs)(gn.Fragment,{children:[(0,gn.jsx)(rat,{setFilteredDescriptions:l,descriptions:s,model:e}),a.length>0&&(0,gn.jsxs)("div",{children:[(0,gn.jsx)(TW,{onClick:async()=>{await x1(20),await $2e(e,t,r,a)},style:{marginTop:1},children:"Toggle All segments"}),(0,gn.jsx)("div",{style:{maxHeight:200,overflow:"hidden",overflowY:"auto",marginBlock:1},children:a.map(C=>(0,gn.jsx)(nat,{model:e,d:C,currentTimeframe:o,selectedSegmentDescription:h,visibleSegmentKeys:f},C.id))})]},t)]})}function swe({model:e,targetSegmentationId:t,targetKind:r}){let n=Po(e.currentState);Po(e.currentTimeframe);let i=Po(e.metadata).allDescriptions.length>0,s=Su(n.selectedSegment),{segmentId:a,segmentationId:l,kind:c}=s,u=e.metadata.value.getSegmentDescription(a,l,c),d=u?u[0]:void 0;return(0,gn.jsx)(gn.Fragment,{children:i&&(0,gn.jsx)(lo,{header:"Selected segment descriptions",initiallyExpanded:!0,children:(0,gn.jsxs)("div",{style:{paddingTop:4,paddingRight:8,maxHeight:300,overflow:"hidden",overflowY:"auto"},children:[!d&&"No segment selected",d&&d.target_kind!=="entry"&&d.target_id&&(0,gn.jsxs)("b",{children:["Segment ",d.target_id.segment_id," from segmentation ",d.target_id.segmentation_id,":",(0,gn.jsx)("br",{}),d.name??"Unnamed segment"]}),d&&d.details&&(0,gn.jsx)(rwe,{descriptionText:d.details}),d?.external_references&&(0,gn.jsx)(nwe,{externalReferences:d.external_references})]})})})}var pE=ar(hi(),1),lwe=ar(awe(),1);var fE=ar(un(),1);async function oat(e,t){await t.api.updateAnnotationsJson(t.source,t.entryId,e),await t.updateMetadata()}var cwe=({jsonData:e,entryData:t})=>{let r=(0,pE.useRef)(null),n=null,o=(0,pE.useRef)(e);return(0,pE.useEffect)(()=>{if(r.current){let i={onChangeJSON:async s=>{o.current=s}};n=new lwe.default(r.current,i),n.set(e)}return()=>{n&&n.destroy()}},[e]),(0,fE.jsxs)("div",{style:{flex:"1",flexDirection:"column"},children:[(0,fE.jsx)("div",{ref:r,style:{width:"100%",height:"400px"}}),(0,fE.jsx)(or,{onClick:async()=>await oat(o.current,t),children:"Update annotations.json"})]})};var ln=ar(un(),1),HF;(n=>{function e(o,i){let s=i.length>o.availableNodes.length?i[i.length-1]:i.find(a=>a.data.ref===o.activeNode?.data.ref)??i[0];return{...o,availableNodes:i,activeNode:s}}n.changeAvailableNodes=e;function t(o,i){let s=o.availableNodes.find(a=>a.data.ref===i)??o.availableNodes[0];return{...o,availableNodes:o.availableNodes,activeNode:s}}n.changeActiveNode=t;function r(o,i){return RA(o.availableNodes,i.availableNodes)&&o.activeNode===i.activeNode&&o.globalState===i.globalState}n.equals=r})(HF||={});var jF=class extends il{defaultState(){return{header:"Volume & Segmentation",isCollapsed:!0,brand:{accent:"orange",svg:qM},data:{globalState:void 0,availableNodes:[],activeNode:void 0}}}renderControls(){return(0,ln.jsx)(iat,{plugin:this.plugin,data:this.state.data,setData:t=>this.setState({data:t})})}syncState(t){let r=t.selectQ(i=>i.ofType(Yl)).map(i=>i?.obj).filter(bA),n=r.length===0,o=HF.changeAvailableNodes(this.state.data,r);if(!this.state.data.globalState?.isRegistered()){let i=t.selectQ(s=>s.ofType(bp))[0]?.obj?.data;i&&(o.globalState=i)}(!HF.equals(this.state.data,o)||this.state.isHidden!==n)&&this.setState({data:o,isHidden:n})}componentDidMount(){this.setState({isHidden:!0,isCollapsed:!1}),this.syncState(this.plugin.state.data),this.subscribe(k4([this.plugin.state.data.events.changed,this.plugin.behaviors.state.isAnimating]),([t,r])=>{r||this.syncState(t.state)})}};function iat({plugin:e,data:t,setData:r}){let n=t.activeNode?.data;if(!n)return(0,ln.jsx)("p",{children:"No data!"});if(!t.globalState)return(0,ln.jsx)("p",{children:"No global state!"});let o={entry:M.Select(t.activeNode.data.ref,t.availableNodes.map(a=>[a.data.ref,a.data.entryId]))},i={entry:t.activeNode.data.ref},s=Po(t.globalState.currentState);return(0,ln.jsxs)(ln.Fragment,{children:[(0,ln.jsx)(An,{params:o,values:i,onChangeValues:a=>r(HF.changeActiveNode(t,a.entry))}),(0,ln.jsx)(aat,{entryData:n}),(0,ln.jsx)(lo,{header:"Global options",children:(0,ln.jsx)(dwe,{params:SA,values:s,onChangeValues:async a=>await t.globalState?.updateState(e,a)})}),(0,ln.jsx)(sat,{entryData:n},n.ref)]})}function sat({entryData:e}){let t=Po(e.currentState),r=Po(e.metadata),o=e.metadata.value.allDescriptions.filter(d=>d.target_kind==="entry"),i=Su(t.selectedSegment),{segmentationId:s,kind:a}=i,l=t.visibleModels.map(d=>d.pdbId),c=e.pdbs;Po(e.currentTimeframe);let u=r.raw.annotation;return(0,ln.jsxs)(ln.Fragment,{children:[(0,ln.jsx)("div",{style:{fontWeight:"bold",padding:8,paddingTop:6,paddingBottom:4,overflow:"hidden"},children:r.raw.annotation?.name??"Unnamed Annotation"}),o.length>0&&o.map(d=>(0,ln.jsx)(owe,{entryDescriptionData:d},d.id)),(0,ln.jsx)(twe,{nested:!0,trigger:(0,ln.jsx)("button",{className:"msp-btn msp-btn-block",children:"Annotation Editor"}),modal:!0,children:(0,ln.jsx)(ln.Fragment,{children:(0,ln.jsx)(cwe,{jsonData:u,entryData:e})})}),c&&c.length>0&&(0,ln.jsx)(lo,{header:"Fitted models in PDB",initiallyExpanded:!0,children:c.map(d=>(0,ln.jsx)(TW,{onClick:()=>e.actionShowFittedModel(l.includes(d)?[]:[d]),style:{fontWeight:l.includes(d)?"bold":void 0,textAlign:"left",marginTop:1},children:d},d))}),(0,ln.jsx)(uat,{entryData:e}),(0,ln.jsx)(dat,{model:e}),(0,ln.jsx)(swe,{model:e,targetSegmentationId:s,targetKind:a})]})}function aat({entryData:e}){let t=e.metadata.value.raw.grid.volumes.time_info,r=t.start,n=Po(e.currentTimeframe),o=t.end;return e.filesData&&e.filesData.query.time||o===0?null:(0,ln.jsx)($s,{label:"Time Frame",control:(0,ln.jsx)(uwe,{min:r,max:o,value:n,step:1,onChange:async i=>{await e.updateProjectData(i)}})})}function lat({entryData:e,volume:t}){let r=t.transform;if(!r)return null;let o=r.params.channelId,i=t.obj.label,s=e.plugin.state.data.tree.children.get(r.ref).toArray()[0],l=e.findNodesByRef(s).transform;if(!l)return null;let c={volumeType:l.state.isHidden?"off":l.params?.type.name,opacity:l.params?.type.params.alpha};return(0,ln.jsxs)(lo,{header:`${i}`,children:[(0,ln.jsx)(dwe,{params:z2e,values:c,onChangeValues:async u=>{await x1(20),await e.actionUpdateVolumeVisual(u,o,l)}}),(0,ln.jsx)(Oa,{state:e.plugin.state.data,transform:l,customHeader:"none"})]})}function cat(e,t){let r=e.plugin.state.data.tree.children.get(t.ref).toArray()[0],n=IW(e.plugin,r),o=n.transform;if(o.params.descriptions){let i=e.plugin.state.data.tree.children.get(n.transform.ref).toArray()[0];return IW(e.plugin,i).transform}else return o}function PW({model:e,segmentation:t,kind:r}){let n=t.transform;if(!n)return null;let i=n.params.segmentationId,s=cat(e,n);if(!s)return null;let a;return s.params?.type?a=s.params?.type.params.alpha:a=s.params.alpha,(0,ln.jsxs)(lo,{header:`${i}`,children:[(0,ln.jsx)($s,{label:"Opacity",control:(0,ln.jsx)(uwe,{min:0,max:1,value:a,step:.05,onChange:async l=>await e.actionSetOpacity(l,i,r)})}),(0,ln.jsx)(iwe,{model:e,targetSegmentationId:i,targetKind:r})]})}function uat({entryData:e}){let t=Po(e.state.hierarchy);return!t||Po(e.plugin.behaviors.state.isBusy)?null:(0,ln.jsx)(ln.Fragment,{children:(0,ln.jsx)(lo,{header:"Volume data",children:t.volumes.map(n=>{let o=n.transform.params;return(0,ln.jsx)(lat,{entryData:e,volume:n},o.channelId)})})})}function dat({model:e}){if(!e.metadata.value.hasSegmentations())return null;let t=Po(e.state.hierarchy);return!t||Po(e.plugin.behaviors.state.isBusy)?null:(0,ln.jsx)(ln.Fragment,{children:(0,ln.jsxs)(lo,{header:"Segmentation data",children:[t.segmentations.map(n=>(0,ln.jsx)(PW,{model:e,segmentation:n,kind:"lattice"},n.transform.ref)),t.meshSegmentations.map(n=>(0,ln.jsx)(PW,{model:e,segmentation:n,kind:"mesh"},n.transform.ref)),t.geometricSegmentations.map(n=>(0,ln.jsx)(PW,{model:e,segmentation:n,kind:"primitive"},n.transform.ref))]})})}function uwe({value:e,onChange:t,...r}){let[n,o,i]=DW(e);return(0,ln.jsx)(ch,{value:o,disabled:n,onChange:s=>i(t,s),...r})}function TW({onClick:e,...t}){let[r,n,o]=DW(void 0);return(0,ln.jsx)(or,{disabled:r,onClick:()=>o(e,void 0),...t,children:t.children})}function dwe({values:e,onChangeValues:t,...r}){let[n,o,i]=DW(e);return(0,ln.jsx)(An,{isDisabled:n,values:o,onChangeValues:s=>i(t,s),...r})}function DW(e){let[t,r]=(0,Nh.useState)(!1),[n,o]=(0,Nh.useState)(e),i=(0,Nh.useRef)(!1);(0,Nh.useEffect)(()=>o(e),[e]),(0,Nh.useEffect)(()=>(i.current=!0,()=>{i.current=!1}),[]);let s=(0,Nh.useCallback)(async(a,l)=>{r(!0),o(l);try{await a(l)}catch(c){throw i.current&&o(e),c}finally{i.current&&r(!1)}},[]);return[t,n,s]}var kW=typeof window<"u"?window?.location?.hostname==="localhost":!1,NF={DefaultServer:new Yf("volseg-volume-server",kW?"http://localhost:9000/v1":ax)},pwe=tr.create({name:"volseg-v2",category:"misc",display:{name:"Volseg",description:"Volseg"},ctor:class extends tr.Handler{register(){this.ctx.state.data.actions.add(mwe),this.ctx.customStructureControls.set("volseg-v2",jF),this.initializeEntryLists();let e=new Map;this.subscribeObservable(this.ctx.state.data.events.cell.created,t=>{t.cell.obj instanceof ux&&e.set(t.ref,t.cell.obj)}),this.subscribeObservable(this.ctx.state.data.events.cell.removed,t=>{e.has(t.ref)&&(e.get(t.ref).dispose(),e.delete(t.ref))})}unregister(){this.ctx.state.data.actions.remove(mwe),this.ctx.customStructureControls.delete("volseg-v2")}async initializeEntryLists(){let e=this.ctx.config.get(NF.DefaultServer)??ax,r=await new gA(e).getEntryList(10**6);Object.values(r).forEach(n=>n.sort()),this.ctx.customState.volsegAvailableEntries=r}}}),mwe=ki.build({display:{name:"Load Volume & Segmentation"},from:fe.Root,params:(e,t)=>Z2e(t,t.customState.volsegAvailableEntries)})(({params:e,state:t},r)=>ke.create("Loading Volume & Segmentation",n=>t.transaction(async()=>{let o=wW.fromLoadVolsegParamValues(e);if(o.entryId.trim().length===0)throw alert("Must specify Entry Id!"),new Error("Specify Entry Id");o.entryId.includes("-")||(o.entryId=k2e(o.source,o.entryId)),r.behaviors.layout.leftPanelTabName.next("data"),r.state.data.selectQ(a=>a.ofType(bp))[0]||await t.build().toRoot().apply(J2e,{},{state:{isGhost:!kW}}).commit();let s=await t.build().toRoot().apply(X2e,o).commit();if(await t.build().to(s).apply(UF,{},{state:{isGhost:!kW}}).commit(),s.data){let a=s.data;if(s.data.metadata.value.raw.grid.volumes.volume_sampling_info.spatial_downsampling_levels.length>0){let h=await s.data.volumeData.createVolumeGroup(),f=[],C=[],g=s.data.metadata.value.raw.grid.volumes.channel_ids;for(let b of g){let y={timeframeIndex:0,channelId:b},x=await t.build().to(h).apply(FF,y,{tags:[cE]}).commit(),A=await s.data.volumeData.createVolumeRepresentation3D(x,y);C.push(A)}for(let b of C)if(b){let y=b.isovalue.kind==="relative"?b.isovalue.relativeValue:b.isovalue.absoluteValue;f.push({channelId:b.channelId,volumeIsovalueKind:b.isovalue.kind,volumeIsovalueValue:y,volumeType:b.volumeType,volumeOpacity:b.opacity,label:b.label,color:b.color})}await s.data.updateStateNode({channelsData:[...f]})}let c=s.data.metadata.value.raw.grid.segmentation_lattices;if(c&&c.segmentation_ids.length>0){let h=await s.data.latticeSegmentationData.createSegmentationGroup(),f=c.segmentation_ids;for(let C of f){let g=s.data.metadata.value.getDescriptions(C,"lattice",0),b=CA(g),y={timeframeIndex:0,segmentationId:C,segmentLabels:b,ownerId:s.data.ref},x=await t.build().to(h).apply(OF,y,{tags:[uE]}).commit();await s.data.latticeSegmentationData.createSegmentationRepresentation3D(x,y)}}let u=s.data.metadata.value.raw.grid.segmentation_meshes;if(u&&u.segmentation_ids.length>0){let h=await s.data.meshSegmentationData.createMeshGroup(),f=u.segmentation_ids;for(let C of f){let y={meshSegmentParams:a.meshSegmentationData.getMeshSegmentParams(C,0),segmentationId:C,timeframeIndex:0},x=await t.build().to(h).apply(VF,y,{tags:[lE]}).commit();await s.data.meshSegmentationData.createMeshRepresentation3D(x,y)}}let d=a.metadata.value.raw.grid.geometric_segmentation;if(d&&d.segmentation_ids.length>0){let h=await s.data.geometricSegmentationData.createGeometricSegmentationGroup();for(let f of d.segmentation_ids){let g={segmentationId:f,timeframeIndex:0},b=await t.build().to(h).apply(GF,g,{tags:[aE]}).commit();await s.data.geometricSegmentationData.createGeometricSegmentationRepresentation3D(b,g)}}let p=a.metadata.value.getAllAnnotations(0).map(h=>Lh(h.segment_id,h.segmentation_id,h.segment_kind));await AA(p,a)}}).runInContext(n)));async function $F(e,t){await e.build().to(t).apply(Q2e,{},{state:{isGhost:!0}}).commit();let r=await e.build().to(t).apply(Y2e).commit();if(await e.build().to(r).apply(UF,{},{state:{isGhost:!0}}).commit(),r.data){let n=r.data,o=n.metadata.value.raw.grid.volumes.time_info.start,i=n.metadata.value.raw.grid.volumes.channel_ids;n.filesData.query.channel_id&&(i=[n.filesData.query.channel_id]),n.filesData.query.time&&(o=n.filesData.query.time);let s=await r.data.volumeData.createVolumeGroup(),a=[],l=[];for(let m of i){let p={timeframeIndex:o,channelId:m},h=await e.build().to(s).apply(FF,p,{tags:[cE]}).commit(),f=await r.data.volumeData.createVolumeRepresentation3D(h,p);l.push(f)}for(let m of l)if(m){let p=m.isovalue.kind==="relative"?m.isovalue.relativeValue:m.isovalue.absoluteValue;a.push({channelId:m.channelId,volumeIsovalueKind:m.isovalue.kind,volumeIsovalueValue:p,volumeType:m.volumeType,volumeOpacity:m.opacity,label:m.label,color:m.color})}await r.data.updateStateNode({channelsData:[...a]});let c=n.filesData?.latticeSegmentations;if(c){let p=c.filter(f=>f.timeframeIndex===o).map(f=>f.segmentationId),h=await r.data.latticeSegmentationData.createSegmentationGroup();for(let f of p){let C=r.data.metadata.value.getDescriptions(f,"lattice",o),g=CA(C),b={timeframeIndex:o,segmentationId:f,segmentLabels:g,ownerId:r.data.ref},y=await e.build().to(h).apply(OF,b,{tags:[uE]}).commit();await r.data.latticeSegmentationData.createSegmentationRepresentation3D(y,b)}}let u=n.filesData?.geometricSegmentations;if(u){let m=u.map(h=>h.segmentationId),p=await r.data.geometricSegmentationData.createGeometricSegmentationGroup();for(let h of m){let f={segmentationId:h,timeframeIndex:o},C=await e.build().to(p).apply(GF,f,{tags:[aE]}).commit();await r.data.geometricSegmentationData.createGeometricSegmentationRepresentation3D(C,f)}}let d=n.filesData?.meshSegmentations;if(d){let m=d.map(h=>h.segmentationId),p=await r.data.meshSegmentationData.createMeshGroup();for(let h of m){let C={meshSegmentParams:n.meshSegmentationData.getMeshSegmentParams(h,o),segmentationId:h,timeframeIndex:o},g=await e.build().to(p).apply(VF,C,{tags:[lE]}).commit();await r.data.meshSegmentationData.createMeshRepresentation3D(g,C)}}}return r}var fwe={label:"CVSX",description:"CVSX",category:"Miscellaneous",binaryExtensions:["cvsx"],parse:async(e,t)=>$F(e,t)};var hwe=tr.create({name:"CVSXSpec",category:"misc",display:{name:"CVSXSpec",description:"CVSXSpec extension"},ctor:class extends tr.Handler{constructor(){super(...arguments);this.registrables={dataFormats:[{name:"CVSX",provider:fwe}]}}register(){for(let t of this.registrables.dataFormats??[])this.ctx.dataFormats.add(t.name,t.provider)}update(t){let r=this.params.autoAttach!==t.autoAttach;return this.params.autoAttach=t.autoAttach,r}unregister(){for(let t of this.registrables.dataFormats??[])this.ctx.dataFormats.remove(t.name)}},params:()=>({autoAttach:M.Boolean(!1)})});var mat=[["g3d",zfe]],vwe={volseg:_r.Behavior(pwe),cvsx:_r.Behavior(hwe)},pat={customFormats:mat,extensions:Hh(vwe),disabledExtensions:[],layoutIsExpanded:!0,layoutShowControls:!0,layoutShowRemoteState:!0,layoutControlsDisplay:"reactive",layoutShowSequence:!0,layoutShowLog:!0,layoutShowLeftPanel:!0,collapseLeftPanel:!1,collapseRightPanel:!1,disableAntialiasing:Ot.General.DisableAntialiasing.defaultValue,pixelScale:Ot.General.PixelScale.defaultValue,pickScale:Ot.General.PickScale.defaultValue,transparency:Ot.General.Transparency.defaultValue,preferWebgl1:Ot.General.PreferWebGl1.defaultValue,allowMajorPerformanceCaveat:Ot.General.AllowMajorPerformanceCaveat.defaultValue,powerPreference:Ot.General.PowerPreference.defaultValue,viewportShowExpand:Ot.Viewport.ShowExpand.defaultValue,viewportShowControls:Ot.Viewport.ShowControls.defaultValue,viewportShowSettings:Ot.Viewport.ShowSettings.defaultValue,viewportShowSelectionMode:Ot.Viewport.ShowSelectionMode.defaultValue,viewportShowAnimation:Ot.Viewport.ShowAnimation.defaultValue,viewportShowTrajectoryControls:Ot.Viewport.ShowTrajectoryControls.defaultValue,pluginStateServer:Ot.State.DefaultServer.defaultValue,volumeStreamingServer:Ot.VolumeStreaming.DefaultServer.defaultValue,volumeStreamingDisabled:!Ot.VolumeStreaming.Enabled.defaultValue,pdbProvider:Ot.Download.DefaultPdbProvider.defaultValue,emdbProvider:Ot.Download.DefaultEmdbProvider.defaultValue,saccharideCompIdMapType:"default",volumesAndSegmentationsDefaultServer:Qy.DefaultServer.defaultValue,VolumesAndSegmentationsDefaultServer:Qy.DefaultServer.defaultValue},gwe=class e{constructor(t){this.plugin=t}static async create(t,r={}){let n={};for(let u of Object.keys(r))r[u]!==void 0&&(n[u]=r[u]);let o={...pat,...n},i=eN(),s=new Set(o.disabledExtensions??[]),a={actions:i.actions,behaviors:[...i.behaviors,...o.extensions.filter(u=>!s.has(u)).map(u=>vwe[u])],animations:[...i.animations||[]],customParamEditors:i.customParamEditors,customFormats:o?.customFormats,layout:{initial:{isExpanded:o.layoutIsExpanded,showControls:o.layoutShowControls,controlsDisplay:o.layoutControlsDisplay,regionState:{bottom:"full",left:o.collapseLeftPanel?"collapsed":"full",right:o.collapseRightPanel?"hidden":"full",top:"full"}}},components:{...i.components,controls:{...i.components?.controls,top:o.layoutShowSequence?void 0:"none",bottom:o.layoutShowLog?void 0:"none",left:o.layoutShowLeftPanel?void 0:"none"},remoteState:o.layoutShowRemoteState?"default":"none"},config:[[Ot.General.DisableAntialiasing,o.disableAntialiasing],[Ot.General.PixelScale,o.pixelScale],[Ot.General.PickScale,o.pickScale],[Ot.General.Transparency,o.transparency],[Ot.General.PreferWebGl1,o.preferWebgl1],[Ot.General.AllowMajorPerformanceCaveat,o.allowMajorPerformanceCaveat],[Ot.General.PowerPreference,o.powerPreference],[Ot.Viewport.ShowExpand,o.viewportShowExpand],[Ot.Viewport.ShowControls,o.viewportShowControls],[Ot.Viewport.ShowSettings,o.viewportShowSettings],[Ot.Viewport.ShowSelectionMode,o.viewportShowSelectionMode],[Ot.Viewport.ShowAnimation,o.viewportShowAnimation],[Ot.Viewport.ShowTrajectoryControls,o.viewportShowTrajectoryControls],[Ot.State.DefaultServer,o.pluginStateServer],[Ot.State.CurrentServer,o.pluginStateServer],[Ot.VolumeStreaming.DefaultServer,o.volumeStreamingServer],[Ot.VolumeStreaming.Enabled,!o.volumeStreamingDisabled],[Ot.Download.DefaultPdbProvider,o.pdbProvider],[Ot.Download.DefaultEmdbProvider,o.emdbProvider],[Ot.Structure.DefaultRepresentationPreset,ywe.id],[Ot.Structure.SaccharideCompIdMapType,o.saccharideCompIdMapType],[Qy.DefaultServer,o.volumesAndSegmentationsDefaultServer]]},l=typeof t=="string"?document.getElementById(t):t;if(!l)throw new Error(`Could not get element with id '${t}'`);let c=await XCe({target:l,spec:a,render:v2e,onBeforeUIRender:u=>{u.builders.structure.representation.registerPreset(ywe)}});return new e(c)}async loadCvsxFromUrl(t,r){if(r==="cvsx"){let n=await this.plugin.builders.data.download({url:t,isBinary:!0});$F(this.plugin,n)}else throw new Error(`Unknown cvsx format: ${r}`)}handleResize(){this.plugin.layout.events.updated.next(void 0)}dispose(){this.plugin.dispose()}},ywe=Go({id:"preset-structure-representation-viewer-auto",display:{name:"Automatic (w/ Annotation)",group:"Annotation",description:"Show standard automatic representation but colored by quality assessment (if available in the model)."},isApplicable(e){return!!e.data.models.some(t=>Gl.isApplicable(t,"pLDDT"))||!!e.data.models.some(t=>Gl.isApplicable(t,"qmean"))},params:()=>Go.CommonParams,async apply(e,t,r){let n=Jn.resolveAndCheck(r.state.data,e),o=n?.obj?.data;return!n||!o?{}:o.models.some(i=>Gl.isApplicable(i,"pLDDT"))?await wM.apply(e,t,r):o.models.some(i=>Gl.isApplicable(i,"qmean"))?await _M.apply(e,t,r):o.models.some(i=>ol.isApplicable(i))?await SS.apply(e,t,r):await ds.auto.apply(e,t,r)}});export{vwe as ExtensionMap,gwe as Viewer,ywe as ViewerAutoPreset,Fwe as consoleStats,Lwe as setDebugMode,Bwe as setProductionMode,Nwe as setTimingMode,rS as version};
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react/cjs/react-jsx-runtime.production.min.js:
  (**
   * @license React
   * react-jsx-runtime.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

jsoneditor/dist/jsoneditor.min.js:
  (*!
   * jsoneditor.js
   *
   * @brief
   * JSONEditor is a web-based tool to view, edit, format, and validate JSON.
   * It has various modes such as a tree editor, a code editor, and a plain text
   * editor.
   *
   * Supported browsers: Chrome, Firefox, Safari, Edge
   *
   * @license
   * Licensed under the Apache License, Version 2.0 (the "License"); you may not
   * use this file except in compliance with the License. You may obtain a copy
   * of the License at
   *
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
   * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
   * License for the specific language governing permissions and limitations under
   * the License.
   *
   * Copyright (c) 2011-2024 Jos de Jong, http://jsoneditoronline.org
   *
   * @author  Jos de Jong, <wjosdejong@gmail.com>
   * @version 10.0.3
   * @date    2024-04-25
   *)
  (*
   * based on code from:
   *
   * @license RequireJS text 0.25.0 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
   * Available via the MIT or new BSD license.
   * see: http://github.com/jrburke/requirejs for details
   *)
  (*! @license
  ==========================================================================
  SproutCore -- JavaScript Application Framework
  copyright 2006-2009, Sprout Systems Inc., Apple Inc. and contributors.
  
  Permission is hereby granted, free of charge, to any person obtaining a
  copy of this software and associated documentation files (the "Software"),
  to deal in the Software without restriction, including without limitation
  the rights to use, copy, modify, merge, publish, distribute, sublicense,
  and/or sell copies of the Software, and to permit persons to whom the
  Software is furnished to do so, subject to the following conditions:
  
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  DEALINGS IN THE SOFTWARE.
  
  SproutCore and the SproutCore logo are trademarks of Sprout Systems, Inc.
  
  For more information about SproutCore, visit http://www.sproutcore.com
  
  
  ==========================================================================
  @license *)
  (** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js *)
*/
